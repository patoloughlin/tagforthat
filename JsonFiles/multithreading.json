{"total":30059,"page":1,"pagesize":100,"questions":[{"tags":["multithreading","variables","ksh"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13298541,"title":"Setting variables in a thread","body":"<p>I have a lengthy menu script that relies on a few command outputs for it's variables. These commands take several seconds to run each and I would like to spawn new processes to set these variables.  It would look something like this:</p>\n\n<pre><code>VAR1=`somecommand` &amp;\nVAR2=`somecommand` &amp;\n...\nwait\necho $VAR1 $VAR2\n</code></pre>\n\n<p>The problem is that the threads are spawned and die with those variables they set.  I realize that I can do this by sending these to a file and then reading that but I would like to do it without a temp file.  Any ideas?</p>\n"},{"tags":["c#","multithreading","asynchronous","windows-8","winrt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13296296,"title":"Running Async Method in Loop without Stackoverflow Exception","body":"<p>This piece of code keeps throwing a <code>stackoverflow exception</code> and I have a feeling it's either because of the <code>await</code> keyword causing the stack to fill up, or a thread availability issue. However, I'm not sure what the best way of remedying this would be. </p>\n\n<p>The <code>results</code> variable is just a collection of <code>StorageFiles</code> and if it's above 1020 or so, the exception is thrown; otherwise it's <em>usually</em> fine. </p>\n\n<pre><code>private async void GetMusicTest()\n{\n    var sfolder = await StorageFolder.GetFolderFromPathAsync(dir);\n\n    var query =  sfolder.CreateFileQueryWithOptions(queryOptions);\n\n    var results = await query.GetFilesAsync();\n\n    for (int i = 0; i &lt; results.Count; i++)\n    {\n        MusicProperties mp = await results[i].Properties.GetMusicPropertiesAsync();\n        Debug.WriteLine(mp.Title);\n    }\n}\n</code></pre>\n\n<p>This code works fine in a console application, but the error is thrown when used in a desktop WinForm app. </p>\n\n<p>Interestingly, if <code>result.Count()</code> is used instead, then the error is thrown after three iterations, whereas <code>results.Count</code> throws it after iterating through at least half of the collection, if not all (it seems to vary). They both return the same values. What's the best way looping through without causing a stackoverflow exception or using up all available threads?</p>\n"},{"tags":["multithreading","animation","gtk","draw","cairo"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2,"score":0,"question_id":13298385,"title":"draw events not sent by gdk_window_invalidate_rect","body":"<p>Now I am engaged in AI championship and want to display current situation on battlefield using Cairo on GTK window. My application have to use provided framework which works in its own main loop. So, I can not call gtk_main in main thread. So, I am launching GTK main runloop in separate thread:</p>\n\n<pre><code>...\ng_thread_init(NULL);\ng_thread_create(gui_main_loop, data, FALSE, NULL);\n...\n\n...\ngpointer gui_main_loop(gpointer data)\n{\n...\n    gdk_threads_init();\n    gdk_threads_enter();\n...\n    // Here I make my cute UI\n...\n    gtk_main();\n    gdk_threads_leave();\n...\n}\n...\n</code></pre>\n\n<p>I attached handler of \"draw\" event to my drawing area:</p>\n\n<pre><code>...\ngboolean rendering(GtkWidget *widget, cairo_t *c, gpointer data)\n{\n    // Here I render my UI using cairo.\n    return TRUE;\n}\n...\n// I call this function before gtk_main\ng_signal_connect(G_OBJECT(drawing_area), \"draw\", G_CALLBACK(rendering), data);\n...\n</code></pre>\n\n<p>So, my GTK window lives in another thread and redrawn each time I resize window. But I need to update it several times a second to monitor the current situation on battlefield. So, on every iteration several time a second I call invalidate function from my main thread:</p>\n\n<pre><code>...\ngdk_window_invalidate_rect(gtk_widget_get_window(drawing_area), NULL, true);\n...\n</code></pre>\n\n<p>But in several seconds the UI freezes. It reacts on window resizes but ignores gdk_window_invalidate_rect calls. What am I doing wrong?</p>\n\n<p>Sincerely, \nKyrylo V. Polezhaiev.</p>\n"},{"tags":["android","multithreading","sqlite","service"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13146991,"title":"Conflict accessing sqlite database android, from Service and onClick","body":"<p>In my app android, I can access to my sqlite database from: </p>\n\n<p>1) Service android, every 60 seconds.</p>\n\n<p>2) After pressure of button (onclik)</p>\n\n<p>If I press the button while my service is accessing the database an error occurs.</p>\n\n<p>So I insert in the onclickListener, before access to database, a call to stopService()</p>\n\n<p>but the conflict remains, because, even if I call stopService() before access to database, the service is stopped after this!</p>\n\n<p>I tried, using :</p>\n\n<pre><code>private boolean isMyServiceRunning() {\n    ActivityManager manager = (ActivityManager)  getSystemService(Context.ACTIVITY_SERVICE);\n    for (RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {\n        if (\"com.example.MyService\".equals(service.service.getClassName())) {\n           return true;\n        }\n    }\n    return false;\n }\n</code></pre>\n\n<p>suggested in <a href=\"http://stackoverflow.com/questions/600207/android-check-if-a-service-is-running\">android: check if a service is running</a></p>\n\n<p>I tried to call this method, before access to database, in this manner:</p>\n\n<pre><code>    while(isMyServiceRunning())\n    {\n        // do nothing\n    }\n\n    // *** access to my database ***\n</code></pre>\n\n<p>What can I do in order to be sure that my service is stopped before accessing to database?</p>\n\n<p>The error is:</p>\n\n<pre><code>10-30 21:05:43.360: E/SQLiteDatabase(13960): Failed to open the database. closing it.\n10-30 21:05:43.360: E/SQLiteDatabase(13960):        android.database.sqlite.SQLiteDatabaseLockedException: database is locked\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteDatabase.native_setLocale(Native Method)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteDatabase.setLocale(SQLiteDatabase.java:2115)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:984)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:956)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteDatabase.openOrCreateDatabase(SQLiteDatabase.java:1021)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.app.ContextImpl.openOrCreateDatabase(ContextImpl.java:753)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.content.ContextWrapper.openOrCreateDatabase(ContextWrapper.java:221)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at android.database.sqlite.SQLiteOpenHelper.getWritableDatabase(SQLiteOpenHelper.java:149)\n10-30 21:05:43.360: E/SQLiteDatabase(13960):    at host.database.DB_DatabaseManager.open(DB_DatabaseManager.java:134)\n</code></pre>\n"},{"tags":["c","multithreading","fork"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":13286931,"title":"Does fork() create a duplicate instance of all the variables and object created by the parent process for the child process?","body":"<p>Suppose I have a main process running and in its execution it has initialized some pointers and created some instances of a predefined structure.</p>\n\n<p>Now if I fork this main process, is seperate memory allocated for the pointers?And are duplicate instances of the previously existing variables, data structures created for this new process?</p>\n\n<p>As an example of my requirement consider -</p>\n\n<pre><code>struct CKT\n{\n  ...\n}\n\nmain()\n{\n   ...Some computations with the structure and other pointers.....\n   pid_t pid = fork();\n   if(pid == 0) //child\n   {\n       ..some more computations with the structure...but I need a \n       ..separate instance of it with all the pointers in it as well..\n   }\n   else if(pid &gt; 0) // parent\n   {\n       ..working with the original instance of the structure..\n   }\n   // merging the child process with the parent...\n   // after reading the data of the child processes structure's data... \n   // and considering a few cases...\n}\n</code></pre>\n\n<p>Can anyone explain how do I achieve this??</p>\n"},{"tags":["c#","multithreading","scope"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13297199,"title":"What is the scope of a singularity pattern class? (Multi-Threading involved)","body":"<p>For a project I am working on I'm implementing a class as a singularity. The class is responsible for detecting what stage (Dev, Test, Production, etc.) the system is running in, and returning certain values accordingly so our dev team won't have to worry about handling staging settings every time they use those values. In addition, it allows us to override what the stage is currently, for the purpose of pretending to be in a different stage.</p>\n\n<p>My concern has to deal with how the singularity will behave when multi-threading is involved. The code below outlines the basic setup that will be used. </p>\n\n<p>My question is, if program &amp; program2 could be running on different threads at the same time, will the OverrideStage() function (which changes a private variable in the instance) interfere with the other program's expected behavior?</p>\n\n<p>Example:</p>\n\n<p>1) Program starts, sets stage to DEV</p>\n\n<p>2) On another thread, Program2 starts, sets stage to PRODUCTION</p>\n\n<p>3) Back in Program, try to get a value, will the value be in DEV or PRODUCTION?</p>\n\n<pre><code>namespace TESTING\n{\n\nclass Program\n{\n    static void Run()\n    {\n\n        Staging stage = Staging.Instance;\n\n        stage.OverrideStage(Staging.DEV);\n            SqlConnection connDev = new SqlConnection(stage.ConnectionString(\"example\")); // Connection to development database\n            // Do Stuff\n        stage.EndOverride();\n            SqlConnection connBackToAuto = new SqlConnection(stage.ConnectionString(\"example\")); // Connection to detected stage database\n    }\n}\n\nclass Program2\n{             \n    static void Run()\n    {\n        Staging s = Staging.Instance;\n        s.OverrideStage(Staging.PRODUCTION);\n            SqlConnection connDev = new SqlConnection(s.ConnectionString(\"example\")); // Connection to production database\n            // Do stuff\n        s.EndOverride();\n    }\n}\n\n} // End namespace\n</code></pre>\n\n<p>I guess the question can be simplified to:</p>\n\n<p><strong>Are s and stage the same instance of Staging?</strong></p>\n"},{"tags":["java","multithreading","concurrency","thread-safety","synchronized"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":51,"score":-1,"question_id":13295745,"title":"Why should most logic be in the monitor objects and not in the thread objects when writing concurrent software in Java?","body":"<p>[edit]</p>\n\n<p>Ok, let me clarify. </p>\n\n<p>In this particular case we had several classes.</p>\n\n<pre><code>Lift extends Thread\nPerson extends Thread\nLiftView\nMonitor, all methods synchronized.\n</code></pre>\n\n<p>This is nothing we came up with, our task was to implement a lift simulation with persons waiting on different floors, and theses were the class skeletons that were given.</p>\n\n<p>Then our lecturer said to implement most of the logic in the monitor (he was talking about class Monitor as THE monitor) and as little as possible in the threads.</p>\n\n<p>Why would he make a statement like that?</p>\n\n<p>[/edit]</p>\n\n<p>When I took the Realtime and Concurrent programming course our lecturer told us that when writing concurrent programs in Java and using monitors, most of the logic should be in the monitor and as little as possible in the threads that access it. I never really understood why and I really would like to.</p>\n"},{"tags":["c","multithreading","unix","system-programming"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":94,"score":4,"question_id":13283294,"title":"How to make thread in C without using POSIX library <pthread.h>","body":"<p>I want to implement the multiple threading in C without using any of the  POSIX library.\nAny help would be appreciated.</p>\n\n<p>Not : Don't use fork() or vfork().</p>\n"},{"tags":["c++","multithreading","sendmessage","synchronisation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13297057,"title":"C++ Thread safe calls to IE controls","body":"<p>I have a question about thread-safe calls. My dll is working within application that uses Internet Explorer controls to display the data. As I read IE controls aren't thread-safe. And there is a question, on what functions should I focus to call IE controls from another thread? As far I am using CreateWindow and then SendMessage to get thread-safe call from another thread.</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13294088,"title":"Get the next values I'm going to need on background threads before I need them","body":"<p>I'm hoping to find some advice on the best way to achieve fetching a bunch of id values (like a database Identity values) before I need them. I have a number of classes that require a unique id (int) and what I'd like to do is fetch the next available id (per class, per server) and have it cached locally ready. When an id is taken I want to get the next one ready etc.</p>\n\n<p>I've produced some code to demonstrate what I am trying to do. The code is terrible (it should contain locks etc.) but I think it gets the point across. Losing the odd id is not a problem - a duplicate id is (a problem). I'm happy with the guts of GetNextIdAsync - it calls a proc</p>\n\n<pre><code>this.Database.SqlQuery&lt;int&gt;(\"EXEC EntityNextIdentityValue @Key\", \n            new SqlParameter(\"Key\", key))).First();\n</code></pre>\n\n<p>on SQL Server that uses sp_getapplock to ensure each return value is unique (and incremental).</p>\n\n<pre><code>static class ClassId\n{\n    static private Dictionary&lt;string, int&gt; _ids = new Dictionary&lt;string,int&gt;();\n    static private Dictionary&lt;string, Thread&gt; _threads = new Dictionary&lt;string,Thread&gt;();\n\n    static ClassId()\n    {\n        //get the first NextId for all known classes\n        StartGetNextId(\"Class1\");\n        StartGetNextId(\"Class2\");\n        StartGetNextId(\"Class3\");\n    }\n\n    static public int NextId(string key)\n    {\n        //wait for a current call for nextId to finish\n        while (_threads.ContainsKey(key)) { }\n        //get the current nextId\n        int nextId = _ids[key];\n        //start the call for the next nextId\n        StartGetNextId(key);\n        //return the current nextId\n        return nextId;\n    }\n\n    static private void StartGetNextId(string key)\n    {\n        _threads.Add(key, new Thread(() =&gt; GetNextIdAsync(key)));\n        _threads[key].Start();\n    }\n\n    static private void GetNextIdAsync(string key)\n    {\n        //call the long running task to get the next available value\n        Thread.Sleep(1000);\n        if (_ids.ContainsKey(key)) _ids[key] += 1;\n        else _ids.Add(key, 1);\n        _threads.Remove(key);\n    }\n}\n</code></pre>\n\n<p>My question is - what is the best way to always have the next value I'm going to need before I need it? How should the class be arranged and where should the locks be? E.g. lock inside GetNextIdAsync() add the new thread but don't start it and change StartGetNextId() to call .Start()?</p>\n"},{"tags":["c++","multithreading","operating-system","pthreads","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13281446,"title":"platform independent inter thread communication","body":"<p>I have a process which receives multiple jobs and picks a thread from thread pool and assigns a job to it, this thread in turn may spawn another set of threads from its own thread pool. Now when a STOP request for a job comes to the main process, it should be forwarded to corresponding thread for that request and all the threads associated with that  job should clean themselves up and exit, My question is how to notify the worker threads about \"STOP\". </p>\n\n<p>A global variable can be used and worker threads can poll it frequently but there are lot of functions that a worker can be doing, and adding checks everywhere could work.</p>\n\n<p>Is there a clean approach? some kind of messaging layer. btw the code is <strong>C++</strong></p>\n"},{"tags":["c","multithreading","unix","ceil"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13294582,"title":"Unfamiliar errors","body":"<p>I'm writing a program dealing with threads that I've almost got working completely. Unfortunately, I'm hitting an error (repeated 4 times) who's syntax I'm not familiar with. Here's a quick snip-it of my compile commands, and the errors that follow:<br></p>\n\n<pre><code> gcc -o threads threads.cpp -pthread&lt;br&gt;\n/tmp/ccy8maS0.o: In function `tenPercentA()':\nthreads.cpp:(.text+0xde): undefined reference to `ceil'\n/tmp/ccy8maS0.o: In function `tenPercentB()':\nthreads.cpp:(.text+0x1c6): undefined reference to `ceil'\n/tmp/ccy8maS0.o: In function `fiftPercentC()':\nthreads.cpp:(.text+0x2ae): undefined reference to `ceil'\n/tmp/ccy8maS0.o: In function `fiftPercentD()':\nthreads.cpp:(.text+0x396): undefined reference to `ceil'\n/tmp/ccy8maS0.o:(.eh_frame+0x12): undefined reference to `__gxx_personality_v0'\ncollect2: ld returned 1 exit status\n</code></pre>\n\n<p>I've already included the math.h library in my program, and I'm using the correct syntax for the call:</p>\n\n<pre><code>ceil(tempA);\n</code></pre>\n\n<p>Where tempA is a double holding the value I need to be rounded up.\nAny suggestions? I've tried Google'ing these errors but, like most errors, it's hard to find specific examples with the same pattern as yours.<br><br>\nEDIT: I've solved all of the ceil related errors (using -lm on the command line) however the last error still remains, and I have no idea what it means, or how to fix it.</p>\n"},{"tags":["c++","multithreading","boost"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13293612,"title":"C++/boost::thread program hangs after join_all and return from Main","body":"<p>First time posting here, but I've thoroughly search for a solution to this problem and have no solution.  I have a class that calculates the entries for a matrix using basically a statically-scoped thread pool.  When a new calculation needs to be done, a static condition variable signals this.  And when the program ends, a static boolean flag is changed and the main thread calls join_all before exiting.  The problem is that when I return from int main(), the program hangs seemingly during the destruction of the static variables.</p>\n\n<p>Here is the rough source code for the class that performs the calculation:</p>\n\n<pre><code>class FunctionCalculator\n{\n    public:\n        static void createWorkers();\n        static void destroyWorkers();\n        static void calcFunction();\n\n    private:\n        static void run();\n\n        static boost::thread_group workers_;\n        static boost::mutex theLock_;\n\n        static int curIndex_;\n        static unsigned int numCalcsComplete_;\n\n        static boost::condition_variable stateChange_;\n        static boost::condition_variable calculationFinished_;\n\n        static bool finished_;\n\n        static struct SharedCalcData { // some vars } calcData_;\n};\n\n// static member definitions\nint FunctionCalculator::curIndex_;\nunsigned int FunctionCalculator::numCalcsComplete_;\nboost::mutex FunctionCalculator::theLock_;\nboost::condition_variable FunctionCalculator::stateChange_;\nboost::condition_variable FunctionCalculator::calculationFinished_;\nboost::thread_group FunctionCalculator::workers_;\nbool FunctionCalculator::finished_;\nFunctionCalculator::SharedCalcData FunctionCalculator::calcData_;\n\nvoid FunctionCalculator::createWorkers()\n{\n    finished_ = false;\n    curIndex_ = -1;\n\n    for( unsigned int i = 0; i &lt; 4; i++ )\n        workers_.create_thread( boost::bind( &amp;FunctionCalculator::run ) );\n}\n\nvoid FunctionCalculator::destroyWorkers()\n{\n    {\n        boost::mutex::scoped_lock lock( theLock_ );\n\n        finished_ = true;\n        curIndex_ = 0;\n\n        stateChange_.notify_all();\n    }\n\n    workers_.join_all();\n}\n\nvoid FunctionCalculator::run()\n{\n    unsigned int i = 0; // the column of the matrix to fill in\n    while ( true )\n    {\n        {\n            boost::mutex::scoped_lock lock( theLock_ );\n\n            // block if the calculation is finished until there's a new calculation\n            while ( curIndex_ &lt; 0 )\n                stateChange_.wait( lock );\n\n            // check if it's time for threads to die\n            if ( finished_ )\n                break;\n\n            // get the next index to process\n            i = (unsigned int)curIndex_++;\n\n            // signal all threads to block if this is the last thread in the calculation\n            if ( i == 49 )\n                curIndex_ = -1;\n        }\n\n        // perform calculation/fill in matrix\n\n        {\n            boost::mutex::scoped_lock lock( theLock_ );\n\n            ++numCalcsComplete_;\n\n            // wake up the main thread if this was the last thread in the calculation\n            if ( numCalcsComplete_ == 50 )\n               calculationFinished_.notify_one();\n        }\n    }\n}\n\nvoid FunctionCalculator::calcFunction()\n{\n    // assign calcData_\n\n    {\n        boost::mutex::scoped_lock lock( theLock_ );\n\n        curIndex_         = 0;\n        numCalcsComplete_ = 0;\n\n        stateChange_.notify_all();\n\n        while ( curIndex_ &gt;= 0 )\n            calculationFinished_.wait( lock );\n    }\n}\n</code></pre>\n\n<p>Here is some rough code of the main method.  It's actually an object created by main that calls createWorkers() and calcFunction() is actually called by the Gnu Scientific Library (I use static members for this reason), but the idea is this:</p>\n\n<pre><code>int main( int argc, char* argv[] )\n{\n    FunctionCalculator fc;\n\n    FunctionCalculator::createWorkers();\n\n    for ( int i = 0; i &lt; 10; i++ )\n        fc.calcFunction();\n\n    FunctionCalculator::destroyWorkers();\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>After the call to EXIT_SUCCESS, the program hangs but I have verified that the four threads in FunctionCalculator have finished the run() method after destroyWorkers() is called.  Since the program reaches as far as the return from main, my theory is that the problem happens when the static boost library variables are destroyed at the end.  Can anyone see the problem?</p>\n"},{"tags":["ios","multithreading","ios6","nsurlconnection","objective-c-blocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13293640,"title":"How can I get back into my main processing thread?","body":"<p>I have an app that I'm accessing a remote website with <code>NSURLConnection</code> to run some code and then save out some XML files.  I am  then accessing those XML Files and parsing through them for information.  The process works fine except that my User Interface isn't getting updated properly.  I want to keep the user updated through my <code>UILabel</code>.  I'm trying to update the text by using <code>setBottomBarToUpdating:</code>.  It works the first time when I set it to \"Processing Please Wait...\"; however, in the <code>connectionDidFinishLoading:</code> it doesn't update. I'm thinking my NSURLConnection is running on a separate thread and my attempt with the <code>dispatch_get_main_queue</code> to update on the main thread isn't working. How can I alter my code to resolve this? Thanks! [If I need to include more information/code just let me know!]</p>\n\n<p><strong>myFile.m</strong></p>\n\n<pre><code>NSLog(@\"Refreshing...\");\n\ndispatch_sync( dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n     [self getResponse:@\"http://mylocation/path/to/file.aspx\"];\n});\n\n[self setBottomBarToUpdating:@\"Processing Please Wait...\"];\n\nqueue = dispatch_queue_create(\"updateQueue\", DISPATCH_QUEUE_CONCURRENT);\n</code></pre>\n\n<p><strong>connectionDidFinishLoading:</strong></p>\n\n<pre><code>if ([response rangeOfString:@\"Complete\"].location == NSNotFound]) {\n  // failed\n} else {\n  //success\n  dispatch_async(dispatch_get_main_queue(),^ {\n       [self setBottomBarToUpdating:@\"Updating Contacts...\"];\n  });\n\n  [self updateFromXMLFile:@\"http://thislocation.com/path/to/file.xml\"];\n\n  dispatch_async(dispatch_get_main_queue(),^ {\n       [self setBottomBarToUpdating:@\"Updating Emails...\"];\n  });\n\n  [self updateFromXMLFile:@\"http://thislocation.com/path/to/file2.xml\"];  \n\n}\n</code></pre>\n"},{"tags":["c#","multithreading","asynchronous","delegates","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13293229,"title":"At which time and in which context should I call ThreadPool.SetMinThreads","body":"<p>I have an ASP .NET MVC 2 - application, which calls functions of a C#-DLL. </p>\n\n<p>The DLL itself is multithreaded. In the worst case it uses up to 200 threads, which do not run very long.</p>\n\n<p>I use asynchronous delegates in order to generate the threads. In order to speed up the initialization of the delegates, I calculate the number of threads I need in advance and give it to the ThreadPool:</p>\n\n<pre><code>ThreadPool.SetMinThreads(my_num_threads, ...); \n</code></pre>\n\n<p>I just wonder, if I need to do this early enough, such that the ThreadPool has enough time to create the threads? Do I have to consider, <em>when</em> I set the size of the ThreadPool or are the threads available immediately after I call SetMinThreads?</p>\n\n<p>Furthermore, if I set the size outside the DLL in my ASP .NET MVC-application (before I call the DLL), will this setting be available/visible for the DLL?</p>\n"},{"tags":["android","multithreading","activity","resume"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13290485,"title":"Android: how to resume main thread after download is finished","body":"<p>What can I do, if I'm in any Activity and I want download a file (using thread) and at same time I want the main thread waits until download is finished?</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13292627,"title":"Getting Cannot access a disposed object, when trying to hide a form","body":"<p>I have a MDI based charting application. Each child form is a form that contains a chart. Each chart has its own data queue and a dedicated worker thread.</p>\n\n<p>In the worker thread DoWork method, I have a while loop controlled by a bool \"IsChartActive\", which will plot the data on the graph. To plot the data, I call Invoke on the chartForm itself and pass in a delegate to the method that should update the chart.</p>\n\n<p>When the user closes a chart form, instead of actually closing it, I stop the chart updates and want to hide the chart till the user wants to see it again.</p>\n\n<p>To do this I handle the FormClosing event, set Cancel = true, set \"IsChartActive = false\" and call ChartForm.Hide().</p>\n\n<p>But after this I get the \"Cannot access a disposed object\" exception in the DoWork method ( I assume this happens due to the background thread being already at the invoke statement when I set the \"IsChartActive = false\", so it will see the change in the next iteration), when calling invoke on the chart.</p>\n\n<p>Why am I getting this exception, even though the chart is not actually disposed but only hidden?</p>\n\n<pre><code>public void StopChartUpdates()\n        {\n            IsActive = false;\n            updateChartThread.CancelAsync();\n        }\n\n\nprivate void updateChartThread_DoWork(object sender, DoWorkEventArgs e)\n        {\n            while (IsActive &amp;&amp; !updateChartThread.CancellationPending)\n            {\n                try\n                {\n                    ChartView.Invoke(new Action(InvokeOnUiThread));\n\n                }\n                catch (ObjectDisposedException ex)\n                {\n                              //getting this error when calling invoke on ChartView\n                    Trace.WriteLine(\"Exception: \" + ex.Message);\n                }\n                Thread.Sleep(UpdateFrequency);\n            }\n        }\n\nprivate void InvokeOnUiThread()\n        {\n            try\n            {\n                       //update the chart\n            }\n            catch (Exception ex)\n            {\n                Trace.WriteLine(\"Exception: \" + ex.Message);\n            }\n        }\n\nprivate void ChartView_FormClosing(object sender, System.Windows.Forms.FormClosingEventArgs e)\n        {\n            StopChartUpdates();\n            if (e.CloseReason == CloseReason.UserClosing)\n            {\n                ChartView.Hide();\n                e.Cancel = true;\n            }\n        }\n</code></pre>\n"},{"tags":["c++","c","linux","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13291260,"title":"Linux: How to measure memory usage for a thread within process?","body":"<p>I want to measure memory usage for each thread within process. Is it possible? I'm trying to figure out which thread leaks memory.</p>\n"},{"tags":["java","multithreading","concurrency","executorservice"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":13290825,"title":"Control ExecutorService to execute N tasks per second maximum","body":"<p>How to control/limit the tasks that are submitted to a <a href=\"http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html\" rel=\"nofollow\"><code>ExecutorService</code></a>? I have <code>SMSTask</code> that sends SMS messages and I need to control the executor so that it can only send at maximum N messages/second.</p>\n"},{"tags":["multithreading","osx-snow-leopard","eventmachine","ruby-1.9.3","httperf"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13292030,"title":"How to make more than 200 connections to a server?","body":"<p>Following code is a part of an implementation of a service of guaranteed delivery of GET requests.\nWhen client sends a GET request to <code>http://localhost/send?url=http://example.com</code> he should immediately receive HTTP response with code 200. After that service will try to connect to a specified web-site in \"url\" parameter.</p>\n\n<p>I made a load testing of this service using <strong>httperf</strong> utility with these parameters:</p>\n\n<pre><code>httperf --server localhost --uri /send?url=http://ya.ru --port 9000 --num-conns 500 --rate 50 --hog\n</code></pre>\n\n<p>(it makes 500 connections to a server with 50 connections per second rate)</p>\n\n<p>and receive only about 244 immediate responses with code 200, after that service hang out... Where is the problem? The main function is <strong>process_http_request</strong>. I tried to insert <strong>send_response</strong> and <strong>deliver_request_for</strong> methods' invocation inside <strong>EM.defer</strong>, but it did not help - same results...</p>\n\n<pre><code>require 'eventmachine'\nrequire 'em-http-request'\nrequire 'evma_httpserver'\n\n$total_cnt = 0\n\nclass RequestServer &lt; EM::Connection\n    include EM::HttpServer\n    include EM::Deferrable      \n\n    def initialize(queue)       \n        puts $total_cnt += 1\n        @queue = queue          \n    end\n\n    def process_http_request\n        if @http_request_uri == \"/send\"\n            send_response 200, 'OK'             \n            deliver_request_for get_url             \n        end \n    end\n\n private\n    def send_response(status = 200, body = 'OK', type = 'text/plain')\n        puts \"Main thread? #{Thread.main == Thread.current}\"\n        response = EM::DelegatedHttpResponse.new(self)\n        response.status = status\n        response.content_type type\n        response.content = body\n        response.send_response          \n    end     \n\n    def deliver_request_for(url)\n        @queue.push url\n        send_next_request\n    end\n\n\n    def send_next_request\n        @queue.pop do |url|         \n            request = EM::HttpRequest.new(url).get                      \n\n            request.callback do |http|              \n                if http.response_header.status == 200\n                    puts \"Request delivered!\"\n                end \n\n                send_next_request unless @queue.empty?                  \n            end\n        end\n    end\n\n    def get_url\n        if @http_query_string.nil?\n            nil\n        else\n            result = @http_query_string.scan(/^url=(http:\\/\\/.+\\..+)/)\n            result.flatten.first unless result.flatten.empty?\n        end\n    end \nend\n\nEM.run do   \n    EM.start_server '127.0.0.1', 9000, RequestServer, EM::Queue.new\n    puts \"Started server at 127.0.0.1:9000\"\nend\n</code></pre>\n"},{"tags":["c++","multithreading","random"],"answer_count":8,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":2895,"score":6,"question_id":6161322,"title":"using rand() with multiple threads in C++","body":"<p>We want that several threads will run all the same function and in it generate, each, a different random number several times. We tried to do this by putting <code>srand(time(0))</code> at the start of the function, but it seems that they all get the same number.</p>\n\n<p>Do we need to call <code>srand(time(0))</code> only once per program, i.e at the start of <code>main</code> (for example), at the start of each function that is called several times, or something else?</p>\n"},{"tags":["vb.net","multithreading","tcp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13283102,"title":"Using ThreadPool to connect to multiple TCP servers simultaneously","body":"<pre><code>Imports System.IO\nImports System.Threading\nImports System.Net.Sockets\nImports System.Text\n\nModule Module1\n&lt;MTAThread()&gt;\nSub Main()\n    Dim maxthreads As Integer = 10\n    ThreadPool.SetMaxThreads(maxthreads, maxthreads)\n    Dim serverlist() As String = File.ReadAllLines(\"final.txt\")\n\n    Dim servernum As New CountdownEvent(serverlist.GetUpperBound(0) + 1)\n    For Each a In serverlist\n        Dim args(1) As Object\n        args(0) = a\n        args(1) = servernum\n        ThreadPool.QueueUserWorkItem(New WaitCallback(AddressOf ping), args)\n    Next\n    servernum.Wait()\n\n\n    Console.ReadLine()\nEnd Sub\n\nPublic Sub ping(ByVal server() As Object)\n\n    Dim serverinfo() As String = Split(server(0), \",\")\n    Dim socketclient As New TcpClient\n    Console.WriteLine(serverinfo(0))\n\n    Try\n        socketclient.Connect(serverinfo(0), serverinfo(1))\n    Catch ex As Exception\n        If socketclient.Connected = False Then\n            Throw New Exception(\"Server Offline\")\n        Else\n            Throw New Exception(\"Unknown Error Occured\")\n        End If\n    End Try\n\n       Dim stream As NetworkStream = socketclient.GetStream\n        stream.ReadTimeout = 1000\n        stream.WriteTimeout = 1000\n        Dim sendBytes As [Byte]() = {&amp;HFE}\n        stream.Write(sendBytes, 0, sendBytes.Length)\n        Dim bytes(421) As Byte\n        stream.Read(bytes, 0, CInt(421))\n        socketclient.Close()\n        Dim trimbytes(bytes.Length - 3) As Byte\n        Array.Copy(bytes, 3, trimbytes, 0, bytes.Length - 3)\n        Dim returndata As String = Encoding.BigEndianUnicode.GetString(trimbytes)\n\n        Dim sb As New System.Text.StringBuilder\n        For i As Integer = 1 To 241 Step 2\n            If trimbytes(i) &lt;&gt; 0 Then\n                sb.Append(ChrW(BitConverter.ToInt16(trimbytes, i)))\n            End If\n        Next i\n        Dim message() As String = sb.ToString.Split(\"§\")\n\n        'Write processed server information to the console\n        Console.WriteLine(\"Received --&gt;\" &amp; message(1) &amp; \" \" &amp; message(2) &amp; \" | \" &amp; serverinfo(0))\n\n        server(1).signal()\n\n\n\nEnd Sub\nEnd Module\n</code></pre>\n\n<p>Above is my code, what I basically want to do is to get two (or more) ips from the text file, connect to both of them via TCP on two different threads and get the responses from the servers.</p>\n\n<p>Now, the problem here is that; for whatever reason one of the two servers get a response the but the other doesn't. I've made sure both of the servers are in fact online and accepting connections. I've also tried having the same server on both lines of the text file so that the same ip is being used on both threads but this doesn't work either. Even when the two ips are the same, one gets a response but not the other; which must mean I'm doing something horribly wrong.</p>\n\n<p>When I use one server rather than 1+ everything works perfectly and I get the response I'm looking for, anything more than 1 and it looks like the first thread that runs produces the response but not anything that runs later. Any help will be appreciated.</p>\n\n<p>I have also tried using Paarallel.For but ended up running into the same issue.</p>\n\n<pre><code>Parallel.ForEach(serverlist, _\n             Sub(currentElement)\n                 ping(currentElement)\n             End Sub)\n</code></pre>\n"},{"tags":["java","multithreading","spring","hibernate","spring-transactions"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13290404,"title":"LazyInitializationException when accessing collection in Runnable","body":"<p>I'm reading some entities with <a href=\"http://www.hibernate.org/\" rel=\"nofollow\">Hibernate</a>:</p>\n\n<pre><code>Criteria criteria = session.createCriteria(…);\nList&lt;Entity&gt; list = (List&lt;Entity&gt;) criteria.list();\n</code></pre>\n\n<p>Now I'm iterating over this list and want to send every object inside a <code>Runnable</code> to an <code>Executor</code>. I therefore use a <code>RunnableBean</code>.</p>\n\n<pre><code>for (Entity entity : list) {\n    IRunnableBean runnableBean = (IRunnableBean) \n        applicationContext.getBean(\"myRunnableBean\", IRunnableBean.class);\n    runnableBean.setEntity(entity);\n    executor.execute(runnableBean);\n}\n</code></pre>\n\n<p>The <code>RunnableBean</code> looks like this:</p>\n\n<pre><code>RunnableBean implements IRunnableBean {\n\n    // Setter\n\n    @Transactional\n    void run() {\n        entity.getMyCollection();\n    }\n}\n</code></pre>\n\n<p>When I'm accessing the collection, I'm getting a <code>org.hibernate.LazyInitializationException</code> (<code>no session or session was closed</code>).</p>\n\n<p>In Spring's log I see that the transactional method <code>run()</code> is correctly added. What am I doing wrong?</p>\n"},{"tags":["objective-c","ios","database","multithreading","sqlite"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13291036,"title":"sqlite3_prepare_v2 exc_bad_access","body":"<p>I'm getting exc_bad_access when using multiple readers for sqlite on iOS.  WAL is enabled on the database and sqlite3_threadsafety returns 2 so this shouldn't be a problem.</p>\n\n<p>The code I'm using works fine for 100k+ users most of the time, but there are certain multithreading race conditions that cause sqlite3_prepare_v2 to have exc_bad_access.  Basically when I spawn two threads to do a bunch of reads it crashes.</p>\n\n<p>With WAL and threadsafe sqlite, multiple threads shouldn't be a problem but can't figure out what's causing this exc_bad_access.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["python","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":26,"score":3,"question_id":13290429,"title":"Using threading.Lock as context manager","body":"<p>In the documentation of the <a href=\"http://docs.python.org/2/library/threading.html#using-locks-conditions-and-semaphores-in-the-with-statement\" rel=\"nofollow\">threading</a> module it says</p>\n\n<blockquote>\n  <p>All of the objects provided by this module that have acquire() and\n  release() methods can be used as context managers for a with\n  statement. The acquire() method will be called when the block is\n  entered, and release() will be called when the block is exited.</p>\n</blockquote>\n\n<p>I was wondering if itis called in blocking or non blockin mode?</p>\n"},{"tags":["c#","multithreading","gdi+","gameloop"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":13289899,"title":"A simple C# game loop using two threads, is this good?","body":"<p>I'm creating a simple game using GDI+ in C#.</p>\n\n<p>First of all I need a game loop, and a render loop. I've decided to break these in to two seperate threads. It seems to work, and runs extremely fast, but the reason I'm asking here is because I see people use timers for their game loops to make them run at a specific frame rate.</p>\n\n<p>This obviously has the advantage, that you can be sure of the speed in which actors move. But my game loops just runs as fast as possible, like the Update function in Unity3D. Now to make sure that actors always move at the same speed, all I have to do is to multiply the move speed by the frame delta time (the time between each frame).</p>\n\n<p>My render loop also runs as fast as possible. Is this a good game loop, why or why not?</p>\n\n<pre><code>// Constructor\npublic FormDisplay()\n{\n    // Create a thread object, passing in the GameLoop method\n    var gameThread = new Thread(this.GameLoop);\n\n    // Start the game thread\n    gameThread.Start();\n\n    // Create a thread object, passing in the GameLoop method\n    var renderThread = new Thread(this.RenderLoop);\n\n    // Start the render thread\n    renderThread.Start();\n}\n\nprivate void GameLoop()\n{\n    while (true)\n    {\n        // TODO: Insert Game Logic\n    }\n}\n\nprivate void RenderLoop()\n{\n    while (true)\n    {\n        // TODO: Insert Render Logic\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13287270,"title":"Why is onCreate() called multiple times when i use thread for loading native code?","body":"<p>I have an activity in my app that just loading native code on main thread. I am using this code for calling native functions from android code.m able to call but it's repeatedly calling onCreate() multiple times..</p>\n\n<p>This is the code i am using for thread..</p>\n\n<pre><code>PjsuaThread pjsuaThread = new PjsuaThread();\npjsuaThread.start();\n</code></pre>\n\n<p>thread code </p>\n\n<pre><code>class PjsuaThread extends Thread {  \n\n    public void run() {\n        if (pjsua_app.initApp() != 0) { // native function calling           \n            return;\n        } else {                 \n        }\n        pjsua_app.startPjsua(ApjsuaActivity.CFG_FNAME); // native function calling\n        finished = true;         \n    }\n</code></pre>\n"},{"tags":["c++","c","multithreading","recursion","brute-force"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13281539,"title":"Multithreading brute-force and recursive multidimensional loops. Another way?","body":"<p>I like figuring things out myself in terms of programming... So I was thinking of a method to loop through multi-dimensional arrays with dynamic dimensions. (mainly for things like brute force)</p>\n\n<p>The method I came up with to loop through arrays of unknown dimensions is as follows:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* a simple example of the method I'm using */\nvoid func(int *v,char *usable,int len,int D,int d)\n{\n  for(v[d] = 0; v[d] &lt; len; v[d]++)\n  {\n    if(d+1 &lt; D)\n      func(v,len,D,d+1);\n    else\n    {\n      for(int i = 0; i &lt; D; i++)\n        printf(\"%c\",usable[v[i]]);\n      printf(\"\\r\");\n    }\n  }\n}\nint main()\n{\n  int *v,z,min = 4,max = 6;\n  for(z = min; z &lt;= max; z++)\n  {\n    v = malloc(sizeof(int)*z);\n    func(v,\"0123456789\",10,z,0);\n    printf(\"\\n\");\n    free(v);\n  }\n  return 0;\n}\n</code></pre>\n\n<p>I see this as a nice elegant solution but I've come up with more problems when thinking of multi-threading the process. I would like to know <strong>alternate solutions</strong> for this type of process that I haven't discovered, as well as <strong>possible ways of multi-threading</strong> a process like this. One method I tried was creating pre-determined <em>chunks</em> but because of the large amount of values that need to be processed when digits or usable characters increase are too big, they overflow any normal variables.</p>\n\n<p>One might ask: \"Why do you need to create a multithreading brute force.\" And I would reply that the ability to create a multithreaded brute force means the ability to multithread other processes like maze-solving and best-route determination.</p>\n\n<p>Thank you in advanced.</p>\n"},{"tags":["c#","multithreading","queue","synchronize"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13284730,"title":"Synchronize threads access to fixed size queue by threads order - C#","body":"<p>I was asked the following question in an interview:</p>\n\n<p>There is a <strong>fixed size</strong> queue of tasks. Threads want to enqueue task. If the queue is full they should wait. The threads order should remain: if thread1 came with task1 and after that thread2 came with task2, task1 should enter the queue before task2.</p>\n\n<p>Other threads want to dequeue tasks and execute it. If the queue is empty, they should wait, and also their order should remain: If t3 came before t4, t3 should enqueue task before t4.</p>\n\n<p>How to achieve this (in pseudo-code)?</p>\n"},{"tags":["c#","multithreading","design-patterns","timer","singleton"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13288695,"title":"System.Timer as a Singleton","body":"<p>I have data which is constantly being read by many threads. This data needs to be updated daily.</p>\n\n<p>My approach has been to use a <code>ReaderWriterLockSlim</code> to manage access to the data. Every night the first thread to detect the day change applies a <code>WriteLock</code> to the data and updates it.</p>\n\n<p>In order to avoid the constant check for the day change event. I would ideally like to create a System.Timer object as a singleton and have it automatically start and then execute every 24hrs thereafter.</p>\n\n<p>This has been my approach:</p>\n\n<p>First I extended System.Timers to execute the callback on init.</p>\n\n<pre><code>using System.Timers;\n\nnamespace Utilities\n{\n    class AutoStartTimer : Timer\n    {\n        public AutoStartTimer(ElapsedEventHandler callback, int period):base(period)\n        {\n            callback(null, null);\n            AutoReset = true;\n            Elapsed += callback;\n            Enabled = true;\n        }\n    }\n}\n</code></pre>\n\n<p>Then I declared it at a singleton where I needed it.</p>\n\n<pre><code>private static AutoStartTimer _loadDataTimer = \n                                new AutoStartTimer(DataLoader, 86400000); // Daily\n</code></pre>\n\n<p>This approach is working for me so far. However I would like to know if there are any better ways to implement a Singleton Timer which executes once on initialisation and then for a set period afterwards or if anyone has managed to do this more efficiently without extending the Timer class. </p>\n\n<p>I need to use many of these in my current project so I want to make sure I am using a good approach.</p>\n\n<p>Thanks.</p>\n"},{"tags":["multithreading","javafx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13288490,"title":"JavaFX show two process together","body":"<p>I am creating an application using JavaFX. My requirement is that I have to show some data in table in a panel say tblDataList, as fetching data takes time so I am displaying a panel say fetchingData above tblDataList which show the process for fetching data is being done.</p>\n\n<pre><code> // this code show a panel for showing progress of fetching data..\n public void showListingDataProcess() {\n        Stage myStage = new Stage();\n        getListingDatasController(myStage);\n        myStage.setTitle(\"Wait while fetching data...\");\n        myStage.show();\n\n    }\n\n    // this display data in table..\npublic boolean displayDataInTable(){\n\n           Vector vFolderNames = getFolderNames();\n           if (vFolderNames == null) {\n                return false;\n            }\n         final ObservableList&lt;TableData&gt; dataList = FXCollections.observableArrayList();\n            for (int index = 0; index &lt; vFolderNames.size(); index++) {\n                String sData = (String) vFolderNames.get(index);\n                dataList.add(new TableData(true, sData));\n\n            }\n            TableColumn data = new TableColumn(\"Data\");\n            data.setCellValueFactory(\n                    new PropertyValueFactory&lt;TableData, String&gt;(\"data\"));\n            data.setPrefWidth(310);\n\n            TableColumn selectetedColumn = new TableColumn&lt;TableData, Boolean&gt;();\n            selectetedColumn.setText(\"Selected\");\n            selectetedColumn.setMinWidth(40);\n            selectetedColumn.setCellValueFactory(new PropertyValueFactory&lt;TableData, Boolean&gt;(\"selected\"));\n            selectetedColumn.setCellFactory(new Callback&lt;TableColumn&lt;TableData, Boolean&gt;, TableCell&lt;TableData, Boolean&gt;&gt;() {\n                @Override\n                public TableCell&lt;TableData, Boolean&gt; call(TableColumn&lt;TableData, Boolean&gt; p) {\n                    return new CheckBoxTableCell&lt;TableData, Boolean&gt;();\n                }\n            });\n\n            tblDataList.getColumns().setAll(selectetedColumn, data);\n        tblDataList.setItems(dataList);\n    }\n\n    public Void showDataListAndProcess(){\n\n       final Task initTask = new Task() {\n               @Override\n               protected Object call() throws Exception {\n                     showListingDataProcess();\n                     return null;\n                }\n\n            };\n            new Thread(initTask).start();\n\n            try {\n                 if (!displayDataInTable())                  {                                           \n                               System.out.println(\"Failed to show data.\");                                       \n\n                     }\n\n               } catch (Exception ex) {}\n</code></pre>\n\n<p>}</p>\n\n<p>Although I have used -</p>\n\n<pre><code>Platform.runLater(new Runnable() {\n            public void run() {\n  showListingDataProcess();\n}\n});\n</code></pre>\n\n<p>I am getting both panel together visible. I wish to show showListingDataProcess() panel as fetching data start and it is shown until data listing finished in table.</p>\n\n<p>Help me how to do this. Thanks in advance.</p>\n"},{"tags":["c","multithreading","parallel-processing","numbers"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13287377,"title":"Threads and parallel programming","body":"<p>Okay so here's the question.</p>\n\n<p>Say I want to compute the product of n complex numbers.\nnd\nWhat I'm trying to do is that compute the product of the 2*i and 2*i+1 <code>(i=0;i&lt;n/2)</code> complex numbers in threads. ie, clump 2 numbers together and compute their product, therefore I shall get n/2 products. Then again perform the same action on these n/2 products. So on and so forth, and carry on till the value of n is 1.</p>\n\n<p>Here's my code</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;pthread.h&gt;\nstruct complex{\n    int a;\n    int b;\n};\nstruct complex arr[1000];\nstruct arg {\n    struct complex arr1;\n    struct complex arr2;\n    int i;\n};\n//struct arg *argv;\nstruct arg *argv=malloc(sizeof(struct arg));\nvoid *multiplier(struct arg *argv)\n{\n    int real,imaginary;\n    real=(argv-&gt;arr1.a)*(argv-&gt;arr2.a)-(argv-&gt;arr1.b)*(argv-&gt;arr2.b);\n    imaginary=(argv-&gt;arr1.a)*(argv-&gt;arr2.b)+(argv-&gt;arr1.b)*(argv-&gt;arr2.a);\n    arr[argv-&gt;i].a=real;\n    arr[argv-&gt;i].b=imaginary;\n    printf(\"real=%d imaginary=%d no=%d\\n\",real,imaginary,argv-&gt;i);\n    pthread_exit(0);\n}\nint main(void)\n{\n    int n,i,j,flag=0,q;\n    pthread_t tid;\n    pthread_attr_t attr;\n    pthread_attr_init(&amp;attr);\n    scanf(\"%d\",&amp;n);\n    for(i=0;i&lt;n;i++)\n        scanf(\"%d + i%d\",&amp;arr[i].a,&amp;arr[i].b);\n    for(i=0;i&lt;n;i++)\n        printf(\"%d + i%d\\n\",arr[i].a,arr[i].b);\n    while(n!=0)\n    {\n        if(n%2==1)\n            flag=1;\n        else\n            flag=0;\n        for(i=0;i&lt;n/2;i++)\n        {\n            argv-&gt;arr1.a=arr[2*i].a; /* SEG FAULT HERE */\n            argv-&gt;arr1.a=arr[2*i].b;\n            argv-&gt;arr2.a=arr[2*i+1].a;\n            argv-&gt;arr2.a=arr[2*i+1].b;\n            argv-&gt;i=i;\n            pthread_create(&amp;tid,&amp;attr,multiplier,(void *) argv);\n        }\n        pthread_join(tid,NULL);\n        if(flag==1)\n        {\n            arr[n/2].a=arr[n-1].a;\n            arr[n/2].b=arr[n-1].b;\n        }\n        n=n/2;\n    }\n    return(0);\n}\n</code></pre>\n\n<p>However my code gives me seg fault at line 45. I've been trying to figure out what's wrong with it but to no avail. I probably might be making a fundamentally horrendous error, but do  help me out.</p>\n\n<p>EDIT 1:\nProbably the most stupid error ever. \nI can't allocate memory globally like the way I just did.</p>\n\n<p>I just inserted the Malloc into the main fucntion and the program works. Thanks!</p>\n"},{"tags":["java","multithreading","threadpool","threadpoolexecutor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13287498,"title":"ThreadPoolExecutor fixed thread pool with custom behaviour","body":"<p>i'm new to this topic ... i'm using a ThreadPoolExecutor created with Executors.newFixedThreadPool( 10 ) and after the pool is full i'm starting to get a RejectedExecutionException .\nIs there a way to \"force\" the executor to put the new task in a \"wait\" status instead of rejecting it and starting it when the pool is freed ?</p>\n\n<p>Thanks</p>\n\n<p>Issue regarding this \n<a href=\"https://github.com/evilsocket/dsploit/issues/159\" rel=\"nofollow\">https://github.com/evilsocket/dsploit/issues/159</a></p>\n\n<p>Line of code involved <a href=\"https://github.com/evilsocket/dsploit/blob/master/src/it/evilsocket/dsploit/net/NetworkDiscovery.java#L150\" rel=\"nofollow\">https://github.com/evilsocket/dsploit/blob/master/src/it/evilsocket/dsploit/net/NetworkDiscovery.java#L150</a></p>\n"},{"tags":["c#","asp.net-mvc","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13281781,"title":"How to access a thread started initially when page is loaded, later in an ajax method call in c# mvc ?","body":"<p>I am using C# 5.0, VS 2012, MVC4. I have a scenario where I need to cache employees data and query the cache when performing a search on employees info.</p>\n\n<p>I am not displaying all employees initially but wanted to initiate a thread to cache all employees. So in index method when view is displayed, I am doing this</p>\n\n<pre><code>       //Starting a thread to load the cache if its null\n        if (HttpRuntime.Cache[\"AllEmployees\"] == null)\n        {\n            thCacheAllEmployees = new Thread(new ThreadStart(CacheAllEmployees));\n            thCacheAllEmployees.Name = \"CacheAllEmployees\";\n            thCacheAllEmployees.Start();\n        }\n</code></pre>\n\n<p>CacheAllEmployees is a separate method which will query LDAP and stores all employees in Cache. It will take about 15 secs for LDAP query. But within these first 15 secs after view is loaded and cache is not yet loaded, then when user starts typing in search box, I am making a ajax method call to GetFilteredEmployees action method. I want to access previously started thread, check if its alive, then to wait for that thread to complete so that I don't need to do a fresh LDAP query again.</p>\n\n<pre><code>      if (thCacheAllEmployees.IsAlive)\n        {\n            thCacheAllEmployees.Join();\n\n            if (HttpRuntime.Cache[\"AllEmployees\"] != null)\n                return (List&lt;CMSUser&gt;)HttpRuntime.Cache[\"AllEmployees\"];\n        }\n</code></pre>\n\n<p>But the problem is, when its ajax call seems like it will be a new Main Thread and doesn't know about thCacheAllEmployees. So thCacheAllEmployees will be null object. So I need to get the instance of this thread from currently all active threads in application.</p>\n\n<p>I can store thread id of thCacheAllEmployees when view is loaded first time in a session variable, but how can I access that thread from pool of threads when making ajax method call ?</p>\n\n<p>Is there any better way of doing this ? please give ur suggestions.</p>\n"},{"tags":["multithreading","threadpool","boost-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13279696,"title":"can a threadpool(like boost) be initialized into a class constructor and used when class members are called?","body":"<p>Lets say I have a threadpool (example might be <a href=\"http://threadpool.sourceforge.net/\" rel=\"nofollow\">http://threadpool.sourceforge.net/</a>);\nAnd i have this code:</p>\n\n<pre><code>class Demigod{ \npublic:\n   Demigod();\n   void AskObedienceFast();\n   void AskObedienceSlow();\n   void WorkHardGodDamn();\n   ~Demigod();\nprivate:\n   ThreadPool m_PitySlaves;\n   int m_Quota;\n};\nDemigod::Demigod() : m_PitySlaves(manyPlease) { \n}\nvoid Demigod::WorkHardGodDamn(){ \n    //something irelevant just to annoy slaves\n}\nvoid Demigod::AskObedienceFast() { \n    for(int q=0; q&lt;m_Quota; ++q){\n       m_PitySlaves.schedule(boost::bind(&amp;Demigod::WorkHardGodDamn, this)); \n    }\n    m_PitySlaves.wait();\n}\nvoid Demigod::AskObedienceSlow() { \n    ThreadPool poorSouls;\n    for(int q=0; q&lt;m_Quota; ++q){\n       poorSouls.schedule(boost::bind(&amp;Demigod::WorkHardGodDamn, this)); \n    }\n    poorSouls.wait();\n}\nvoid main(){ \n   Demigod someDude;\n   for(size_t i=0; i&lt;dontstop; ++i){ \n      someDude.AskObedienceFast();\n   }\n}\n</code></pre>\n\n<p>Can AskObedienceFast be faster and work in comparison with AskObedienceSlow? \nThis way I can have some thread (slaves) and be ready for work anytime I ask without having to lose time making the threadpool at every call. I know I can verify the code myself, but my question is more broad, if this is not fundamentally lose performance somewhere else, like those threads in the threadpool doing some waiting process? It comes down to avoiding expensive threadpool initialization (and threads). </p>\n"},{"tags":["c","multithreading","openssl","core"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13286526,"title":"C Multithreading openssl ssl3_connect core","body":"<p>I have a Problem by using Multithread with openssl .</p>\n\n<p>the Environment：\nLinux centOS232 2.6.32-279.el6.x86_64 #1 SMP Fri Jun 22 12:19:21 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux</p>\n\n<p>the  error is Segfault!   And the clent exit.</p>\n\n<p>The core stack:</p>\n\n<blockquote>\n  <p>0  asn1_d2i_ex_primitive (pval=0x640280, in=0x7ffff6ffe140, inlen=9,\n  it=0x7ffff77f0840, tag=-1, aclass=0, opt=0 '\\000', \n      ctx=0x7ffff6ffebd0) at tasn_dec.c:770</p>\n  \n  <p>1  0x00007ffff75413f2 in ASN1_item_ex_d2i (pval=0x640280,\n  in=0x7ffff6ffe140, len=9, it=0x7ffff77f0840, tag=-1, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:233</p>\n  \n  <p>2  0x00007ffff7541ba9 in asn1_template_noexp_d2i (val=0x640280,\n  in=0x7ffff6ffe290, len=9, tt=0x7ffff77f6a40, opt=, \n      ctx=0x7ffff6ffebd0) at tasn_dec.c:746 </p>\n  \n  <p>3  0x00007ffff7541eac in asn1_template_ex_d2i (val=0x640280, in=0x7ffff6ffe290, inlen=, tt=0x7ffff77f6a40, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:607</p>\n  \n  <p>4  0x00007ffff75415ca in ASN1_item_ex_d2i (pval=0x7ffff6ffe328,\n  in=0x7ffff6ffe330, len=9, it=0x7ffff77f01e0, tag=, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:448</p>\n  \n  <p>5  0x00007ffff7541c8f in asn1_template_noexp_d2i (val=0x7ffff6ffe518,\n  in=0x7ffff6ffe520, len=11, tt=0x7ffff77f6aa0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:706</p>\n  \n  <p>6  0x00007ffff7541eac in asn1_template_ex_d2i (val=0x7ffff6ffe518,\n  in=0x7ffff6ffe520, inlen=, tt=0x7ffff77f6aa0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:607</p>\n  \n  <p>7  0x00007ffff75414c5 in ASN1_item_ex_d2i (pval=0x7ffff6ffe518,\n  in=0x7ffff6ffe520, len=98, it=0x7ffff77f0220, tag=-1, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:195</p>\n  \n  <p>8  0x00007ffff7541c8f in asn1_template_noexp_d2i (val=0x7ffff6ffe6e0,\n  in=0x7ffff6ffe6e8, len=98, tt=0x7ffff77f6ae0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:706</p>\n  \n  <p>9  0x00007ffff7541eac in asn1_template_ex_d2i (val=0x7ffff6ffe6e0,\n  in=0x7ffff6ffe6e8, inlen=, tt=0x7ffff77f6ae0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:607</p>\n  \n  <p>10 0x00007ffff75414c5 in ASN1_item_ex_d2i (pval=0x7ffff6ffe6e0,\n  in=0x7ffff6ffe6e8, len=410, it=0x7ffff77f0260, tag=-1, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:195</p>\n  \n  <p>11 0x00007ffff753a705 in x509_name_ex_d2i (val=0x63d6f8,\n  in=0x7ffff6ffe830, len=, it=, \n      tag=, aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at x_name.c:186</p>\n  \n  <p>12 0x00007ffff7541083 in ASN1_item_ex_d2i (pval=0x63d6f8,\n  in=0x7ffff6ffe830, len=410, it=0x7ffff77f6a00, tag=-1, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:239</p>\n  \n  <p>13 0x00007ffff7541ba9 in asn1_template_noexp_d2i (val=0x63d6f8,\n  in=0x7ffff6ffe980, len=410, tt=0x7ffff77f6b98, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:746</p>\n  \n  <p>14 0x00007ffff7541eac in asn1_template_ex_d2i (val=0x63d6f8,\n  in=0x7ffff6ffe980, inlen=, tt=0x7ffff77f6b98, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:607</p>\n  \n  <p>15 0x00007ffff75415ca in ASN1_item_ex_d2i (pval=0x63d620,\n  in=0x7ffff6ffea20, len=410, it=0x7ffff77f02e0, tag=, \n      aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:448</p>\n  \n  <p>16 0x00007ffff7541ba9 in asn1_template_noexp_d2i (val=0x63d620,\n  in=0x7ffff6ffeb70, len=587, tt=0x7ffff77f6cc0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:746</p>\n  \n  <p>17 0x00007ffff7541eac in asn1_template_ex_d2i (val=0x63d620,\n  in=0x7ffff6ffeb70, inlen=, tt=0x7ffff77f6cc0, \n      opt=, ctx=0x7ffff6ffebd0) at tasn_dec.c:607</p>\n  \n  <p>18 0x00007ffff75415ca in ASN1_item_ex_d2i (pval=0x7ffff6ffebf8,\n  in=0x7ffff6ffec20, len=587, it=0x7ffff77f0320, \n      tag=, aclass=, opt=0 '\\000', ctx=0x7ffff6ffebd0) at tasn_dec.c:448</p>\n  \n  <p>19 0x00007ffff7542024 in ASN1_item_d2i (pval=0x7ffff6ffebf8, in=, len=, \n      it=) at tasn_dec.c:136</p>\n  \n  <p>20 0x00007ffff7830c3c in ssl3_get_server_certificate (s=0x62a870) at\n  s3_clnt.c:1125</p>\n  \n  <p>21 0x00007ffff7832332 in ssl3_connect (s=0x62a870) at s3_clnt.c:334</p>\n  \n  <p>22 0x00007ffff783a3bc in ssl23_get_server_hello (s=0x62a870) at\n  s23_clnt.c:743</p>\n  \n  <p>23 ssl23_connect (s=0x62a870) at s23_clnt.c:226</p>\n  \n  <p>24 0x00007ffff7ab85fa in ZCY_SSL_create (ssl=0x626940, ssl_ctx=, bio_ctx=0x626948) at ssl_cliapi.c:267</p>\n  \n  <p>25 0x00007ffff701bf12 in Cli_Login (gid=0x7ffff6fff7a0,\n  err=0x7ffff6fff390) at capi.c:1146</p>\n  \n  <p>26 0x00007ffff7a89568 in Login (gid=0x7ffff6fff7a0,\n  err=0x7ffff6fff390) at tmcapi.c:137</p>\n  \n  <p>27 0x00000000004022cb in send_msg (argv=0x605ed0) at\n  ssl_get_send.c:337</p>\n  \n  <p>28 0x0000003efd407851 in start_thread () from /lib64/libpthread.so.0</p>\n  \n  <p>29 0x0000003efd0e811d in clone () from /lib64/libc.so.6</p>\n</blockquote>\n\n<p>thread Support:</p>\n\n<p>I have setted the callback in the ssl code, like the example in \"crypto/threads/mttest.c\" .</p>\n\n<p>Question:\n  but the same code in the other machine2[Linux ph-suse 2.6.27.19-5-default #1 SMP 2009-02-28 04:40:21 +0100 x86_64 x86_64 x86_64 GNU/Linux] is success。    i used the 'ldd' to check whether the  libs is different in machine2, but they are same.</p>\n\n<p>Apologize, i'm pool in english.</p>\n\n<p>who can help me?   thank you!</p>\n"},{"tags":["c#","multithreading","image-processing","aforge"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13287092,"title":"Convert bitmap to byte array for multiple camera","body":"<p>i'm developing a multiple two frame detection project.im using ISPY. i tried the following method:</p>\n\n<pre><code>    private byte[] BitmapToRgbValues(Bitmap bmp)\n    {\n        // Lock the bitmap's bits.\n        Rectangle rect = new Rectangle(0, 0, bmp.Width, bmp.Height);\n        System.Drawing.Imaging.BitmapData bmpData =\n         bmp.LockBits(rect, System.Drawing.Imaging.ImageLockMode.ReadOnly,\n         bmp.PixelFormat);\n\n        // Get the address of the first line.\n        IntPtr ptr = bmpData.Scan0;\n\n        // Declare an array  to hold the bytes  of the bitmap.\n        int bytes = bmpData.Stride * bmp.Height;\n        byte[] rgbValues = new byte[bytes];\n\n        // Copy the RGB values into the array.\n        System.Runtime.InteropServices.Marshal.Copy(ptr, rgbValues, 0, bytes); bmp.UnlockBits(bmpData);\n\n        return rgbValues;\n    }\n</code></pre>\n\n<p>Unfortunately this method freezes my application. it is not significant on 2 or 3 cameras. But with more than 10 cameras, it is a gone case.. I target 100 cameras or 512mb of frames. Ispy uses unmanaged image here to do the image processing. just wondering if there is a way for me to convert the multiple frame efficiently. Below is a sneak peak of how i convert the frame.</p>\n\n<pre><code>    private void VideoNewFrame(object sender, NewFrameEventArgs e)\n    {\n        Bitmap bmOrig = null;\n        if (e.Frame != null)\n        {\n            //more code..\n            bmOrig = e.Frame;\n        }\n        LastFrameUnmanaged = UnmanagedImage.FromManagedImage(bmOrig);\n        SecondFrameBuffer = BitmapToRgbValues(ResizeBitmap(bmOrig, 352, 288));\n        //more code..\n    }\n</code></pre>\n\n<p>SecondFrameBuffer is a byte[] array.</p>\n"},{"tags":["c#","wpf","multithreading","graph","charts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13281914,"title":"How to update a single graph in chart from multiple async threads?","body":"<pre><code> Parallel.foreach(list&lt;&gt; , a=&gt;  \n    {  \n    // do some operation  \n         chart1.Series[0].Points.AddXY(x, y);  \n    });  \n</code></pre>\n\n<p>I want to draw different lines for each thread invoked in parallel. Is there anyway to do this?</p>\n"},{"tags":["multithreading","cuda"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13286376,"title":"launching multiple kernels cuda","body":"<p>I want to launch multiple kernel function in cuda and so I am declaring two separate set of grids,block name and the values of each set is different. e.g:</p>\n\n<pre><code>    dim3 gridDim_1(val_1,1);\n    dim3 blockDim_1(val_2,val_3);\n\n    dim3 gridDim_2(val_4,1);\n    dim3 blockDim_2(val_5,val_6);\n\n    for(i=0;i&lt;somenum;i++)\n   {\n     kernel_1&lt;&lt;&lt;gridDim_1,blockDim_1&gt;&gt;&gt;(agr1,arg2);\n     kernel_2&lt;&lt;&lt;gridDim_2,blockDim_2&gt;&gt;&gt;(agr3,arg4);\n   }\n</code></pre>\n\n<p>But the compiler is throwing error saying error: gridDim_1 is unknown and similar for other declaration of blocks and grids. How then I could launch these 2 kernels with different names of grids and blocks? I need to mention here that the number of blocks in grids and number of threads in blocks depends on the user input somehow.Thanks for help.</p>\n\n<p>Actually the main code is really big and I am also changing every now and then to get rid of the errors.I am posting a part of it only where I believe the problem lies :</p>\n\n<pre><code>int k,sim_step;\nint counter_top,counter_bottom;\n............\n...................\n\nfor(k=0;k&lt;=sim_step;k++)\n{  \n\n    dim3 gridDim(1,1);\n    dim3 blockDim(counter_top,1,1); \n\n    agent_movement_top&lt;&lt;&lt;gridDim,blockDim&gt;&gt;&gt;(args..)  ;\n\n    dim3 gridDim(1,1);\n    dim3 blockDim(counter_bottom,1,1);  \n\n    agent_movement_bot&lt;&lt;&lt;gridDim,blockDim&gt;&gt;&gt;(args...);\n\n} \n</code></pre>\n\n<p>The current error that I am getting is: \nerror LNK2001: unresolved external symbol _gridDim\nerror LNK2001: unresolved external symbol _blockDim</p>\n"},{"tags":["java","multithreading","swing","event-dispatch-thread"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13285644,"title":"Why actionPerform() run in Event Dispatch Thread but componentAdded() is not?","body":"<p>I have Ex1 below:</p>\n\n<pre><code>main(String args[]) {\n    JFrame frame = new JFrame(\"Title\");\n    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n    JButton button = new JButton(\"Press Here\");\n    ContainerListener container = new ContainerAdapter() {\n      public void componentAdded(final ContainerEvent e) {\n          System.out.println(\"On the event thread? : \" +\n                  EventQueue.isDispatchThread());\n      }\n    };\n    frame.getContentPane().addContainerListener(container);\n    frame.add(button, BorderLayout.CENTER);\n    frame.setSize(200, 200);\n    System.out.println(\"I'm about to be realized: \" +\n      EventQueue.isDispatchThread());\n    frame.setVisible(true);\n  }\n</code></pre>\n\n<p>My result is: On the event thread? : FALSE | I'm about to be realized: false</p>\n\n<p>Other Ex2: </p>\n\n<pre><code>public class GridBagLayoutTester\n    extends JPanel implements ActionListener{   \npublic GridBagLayoutTester() {\n    setLayout(new GridBagLayout());\n    GridBagConstraints gbc = new GridBagConstraints();\n\n    JButton button = new JButton(\"Testing\");\n    // do something...\n    button.addActionListener(this);\n    add(button, gbc);\n}\n\npublic void actionPerformed(ActionEvent e) {\n    System.out.println(\"On the event thread? : \" +\n                  EventQueue.isDispatchThread());\n}\n\npublic static void main(String[] args) {\n    JFrame frame = new JFrame(\"GridBagLayoutDemo\");\n    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);    \n    Container contentPane = frame.getContentPane();\n    contentPane.setLayout(new BorderLayout());\n    contentPane.add(new GridBagLayoutTester(), BorderLayout.CENTER);\n    frame.setSize(800, 600);\n    frame.pack();\n    frame.setVisible(true);\n    System.out.println(\"I'm about to be realized: \" +\n      EventQueue.isDispatchThread());\n}   \n</code></pre>\n\n<p>}</p>\n\n<p>result is: I'm about to be realized: false | On the event thread? : TRUE</p>\n\n<p>My question is why Ex1- componentAdded() run in Intial Thread, but Ex2- actionPerformed() run in EDT ?</p>\n"},{"tags":["objective-c","ios","multithreading","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13286197,"title":"How can i call a lot of methods in A thread?","body":"<p>I have a connect method. I want to use it in a thread because it takes long time. But this method triggers other many methods so i get a error message like above.</p>\n\n<p>*<strong>_WebThreadLockFromAnyThread(bool), 0x94316f0: Obtaining the web lock from a thread other than the main thread or the web thread. UIKit should not be called from a secondary thread.*</strong></p>\n\n<p>my code is:</p>\n\n<pre><code>    __weak LoginViewController *weakSelf = self;\n    dispatch_queue_t connectionQueue = dispatch_queue_create(\"connection Queue\", NULL);\n    dispatch_async(connectionQueue, ^{\n        [weakSelf connect];\n        dispatch_async(dispatch_get_main_queue(), ^{\n            [spinner stopAnimating];\n        });\n    });\n</code></pre>\n"},{"tags":["c","multithreading","pthreads"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":81,"score":0,"question_id":13285375,"title":"How to kill a running thread?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2084830/kill-thread-in-pthread\">kill thread in pthread</a>  </p>\n</blockquote>\n\n\n\n<p>Here after a source code containing a launch of thread and then after a while I want to kill it. How to do it ? <strong>Without make any change in the thread function</strong></p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\npthread_t test_thread;\n\nvoid *thread_test_run (void *v) // I must not modify this function\n{\n    int i=1;\n    while(1)\n    {\n       printf(\"into thread %d\\r\\n\",i);\n       i++; \n       sleep(1);\n    }\n    return NULL\n}\n\nint main()\n{\n    pthread_create(&amp;test_thread, NULL, &amp;thread_test_run, NULL);\n\n    sleep (20);\n    // Kill the thread here. How to do it?\n\n   // other function are called here...\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c#",".net","winforms","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1719,"score":0,"question_id":4693996,"title":"Prevent a WinForms PictureBox animated GIF from pausing during processing?","body":"<p>I have a form with 2 controls on it. Control 1 has several search criteria and the user can click a button to start the search. Control 2 has a GridView that will display the search results and also has a PictureBox with an animated Gif in it.</p>\n\n<p>Control 1 has a method in it that has a nested foreach loop that takes upwards of 5 minutes to complete (depends upon the search criteria, sometimes it finishes almost instantly).</p>\n\n<p>What happens is that I call a method on Control 2 that makes the PictureBox visible and the animated Gif starts running. As soon as the foreach loop is hit that takes a while, the image completely stops. Whenever I show any MessageBoxes the image starts running again (I presume it is because the MessageBox is blocking). As soon as the MessageBox is closed, the image stops animating.</p>\n\n<p>I presume I will need to utilize something with threading, but everything I am trying (ImageAnimator, Thread calling a method that calls Invoke, etc.) all seem to not work. Any hints what events/libraries I need to work with in order to make this work? Any good examples to follow?</p>\n"},{"tags":["c++","arrays","multithreading","pointers","void"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13285718,"title":"Passing pointer array as void pointer to new thread in c++","body":"<p>I am currently working on a project where I have to build a shell for a C++ dll, so a new C# GUI can use its functions.\nHowever I got the following problem, in the C++ portion I have to create a new thread for specific reasons, and I want to pass an int array to the new thread.\nNote that the values assigned to the array in the function in which this happens are gained from the C# portion of the code.</p>\n\n<pre><code>__declspec( dllexport ) void CreateReportPane(int &amp;id, int &amp;what)\n{\n    DWORD threadId; \n    int iArray[2] = { id, what};    \n\n    HANDLE hThread = CreateThread( NULL, 0, CreateReportPaneThread, iArray, 0,  &amp;threadId);\n    if (hThread == NULL) \n    {           \n        ExitProcess(3);\n    }    \n}\n</code></pre>\n\n<p>The problem arises in the new thread, I can reliably fetch the first value out of the array, but the 2nd value seems to be released, here is the code on the other side.</p>\n\n<pre><code>DWORD WINAPI CreateReportPaneThread(LPVOID lparam)\n{\n    int id, what;\n    id = *(( int * )lparam);\n    what = *(((int *)lparam)+1) ; \n    CreateReportPaneOriginal(id, what);\n\n    return 0;\n}\n</code></pre>\n\n<p>Is there any way to prevent the values in the array from getting released while not holding the original thread captive?\nA big thank you in advance</p>\n"},{"tags":["asp.net","vb.net","multithreading","iis"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13284590,"title":"global.asax function not calling from Application_Start","body":"<p>I am writing a function in global.asax file which needs to be called from the thread which is declared inside the application_start.\nIt works fine in my debug mode, however not calling the callback function when hosted.</p>\n\n<pre><code>Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)\n        writeLog(\"Application Initialized\")\n        writeLog(\"Thread is starting....\")\n        Dim T As New Threading.Thread(AddressOf UpdateQueue)\n        T.Start()\n        writeLog(\"Thread Started....\")\n    End Sub\n    Sub UpdateQueue()\n        writeLog(\"UpdateQueue entry\")\n        While Q.Count &gt; 0\n         ' Some logic\n        End While\n        writeLog(\"UpdateQueue going for idle state\")\n        Threading.Thread.Sleep(5000)\n        UpdateQueue()\n    End Sub\n</code></pre>\n\n<p>I see the log file like\nThread Starting\nThread Started</p>\n\n<p>but no other message which are printed in \"UpdateQue\" function\nI have tried other methods also.\n1. Using Timers: Same issue as above\n2. Using Thread.Timers: Same issue as abovee\n3. Call the UpdateQueue function directly from application_start: Entering to UpdateQue function and writes to log entry.</p>\n\n<p>I unable to figure out why the issue in server. I am using IIS 7 in my public IP (not from hosting provider) so I can make any changes if required.</p>\n"},{"tags":["multithreading","thread-safety","pthreads","mutex","fractals"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":8385679,"title":"Updating large data matrix thread-safely: now using millions of mutexes?","body":"<p>I was revisting some code I wrote a long time ago, and decided to rewrite it to better make use of threads (and better use of programming in general..).</p>\n\n<p>It is located here: <a href=\"https://github.com/buddhabrot/buddhabrot/blob/master/basic.c\" rel=\"nofollow\">https://github.com/buddhabrot/buddhabrot/blob/master/basic.c</a>: </p>\n\n<p>It is an application that renders a buddhabrot fractal. For reasons out of the scope of this question it is hard to use memoization to optimize this, and basically if you'd profile this, over 99% of the time is spent in the innermost loop that eventually does:</p>\n\n<pre><code>buddhabrot[col][row]++;\n</code></pre>\n\n<p>Multiple threads will execute this code. Since incrementing is not thread-safe, I used a specific mutex lock around this part of the memory. So, each addressable location in the buddhabrot memory has a separate mutex.</p>\n\n<p>Now, this is more efficient than using one lock of course (which would definitely make all the threads wait for each other), but it is less memory efficient; it appears the mutexes take some data as well. I am also wondering about other repercussions in the pthreads implementations with millions of mutexes?</p>\n\n<p>I now have two other strategies to consider:</p>\n\n<ul>\n<li><p>Use a less dense set of mutex locks, for each \"region\" in the map. So, a lock for [col/16][row/16], for instance, would only lock a thread if it visits the same region of 16 pixels as another one. The density of the locks could be dynamically adjusted. \nBut as I was modeling this I was wondering if I'm not solving an existing problem that might even be implemented by kernels, and I also can't really find a way to make this without slowing things down. I also thought about \"trees of mutexes\", but all of this is just too slow inside this loop (to give an indication, after optimizating the order of some maths operations behind the compiler's back I could squeeze out about 30% more processor time). Is there a topic for this, how do I look for mor einformation on \"mutex density planning\"..?</p></li>\n<li><p>Copy the memory for each thread so I don't even have to mutex around it. But this is even more memory-inefficient. It would solve the problem of having millions of mutexes without knowing the repercussions thereof.</p></li>\n</ul>\n\n<p>So, is there anything else, anything better I could do? </p>\n"},{"tags":["multithreading","debugging","language-agnostic"],"answer_count":11,"favorite_count":14,"up_vote_count":25,"down_vote_count":0,"view_count":6701,"score":25,"question_id":499634,"title":"How to detect and debug multi-threading problems?","body":"<p>This is a follow up to <a href=\"http://stackoverflow.com/questions/493311/how-to-write-safe-correct-multi-threaded-code-in-net\">this question</a>, where I didn't get any input on this point. Here the brief question:</p>\n\n<p><strong>Is it possible to detect and debug problems coming from multi-threaded code?</strong></p>\n\n<p>Often we have to tell our customers: \"We can't reproduce the problem here, so we can't fix it. Please tell us the steps to reproduce the problem, then we'll fix it.\" It's a somehow nasty answer if I know that it is a multi-threading problem, but mostly I don't. How do I get to know that a problem is a multi-threading issue and how to debug it?</p>\n\n<p>I'd like to know if there are any special logging frameworks, or debugging techniques, or code inspectors, or anything else to help solving such issues. General approaches are welcome. If any answer should be language related then keep it to .NET and Java.</p>\n"},{"tags":["java","multithreading","epoll"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":378,"score":2,"question_id":10621783,"title":"Is there epoll equivalent in Java?","body":"<p>Is there an equivalent of Linux epoll in Java?</p>\n\n<p>epoll allows a thread to react to a number of heterogenous events.  For instance, I can have a thread that reacts to either a socket event or an input from the console.  In C++ I can implement this by registering stdio and the socket with epoll.  My thread will be triggered by an event from either if these.</p>\n\n<p>Is there a similar facility in Java?  I looked at the nio package, it allows me to register a number of sockets with a selector.  But there does not seem to be away to register the console / standard io with a selector.  Am I not seeing something?  Is there another way to do this?</p>\n\n<p>On the \"why\": I want to write a program that communicates via sockets, and i want to drive this program by entering commands from console.  I know how this can be done by separating console input and the communications to different threads, but i am curious whether there is a way to do this in a single thread.</p>\n\n<p>Thanks.\ndf</p>\n"},{"tags":["java","multithreading","concurrency","iterator"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":28,"score":-3,"question_id":13284227,"title":"How to pass iterated string values to a function which accepts parametres of different type","body":"<p>Can some explain/tell me the solution of this ....Here the code sample goes:</p>\n\n<pre><code>public static void main(String[] args) throws InterruptedException, ExecutionException {\n      queue = new Queue&lt;String&gt;();\n      set = new SET&lt;String&gt;();\n      ExecutorService executor = Executors.newFixedThreadPool(NO_OF_THREADS);                       \n      List&lt;Future&lt;List&lt;String&gt;&gt;&gt; list = new ArrayList&lt;Future&lt;List&lt;String&gt;&gt;&gt;();  \n      System.out.println(\"enter the url\");\n      Scanner sc=new Scanner(System.in);\n      String input=sc.next();\n      l.add(input);\n      queue.enqueue(input);\n      Callable&lt;List&lt;String&gt;&gt; worker = new SimpleCrawler(input);       \n      Future&lt;List&lt;String&gt;&gt; submit = executor.submit(worker);        \n      list.add(submit);\n      ArrayList&lt;?&gt; l1=(ArrayList&lt;?&gt;) submit.get();\n      Iterator&lt;?&gt; itr=l1.iterator();\n\n      while(itr.hasNext())\n         {\n             System.out.println(itr.next());        \n         }\n</code></pre>\n\n<p>How can i pass iterated string again to function submit(...).I want pass first iterated string to function and next iterated value to that function and so  on.....can some explain me this ..thanks         </p>\n"},{"tags":["c#","wpf","multithreading","error-handling","facebook-c#-sdk"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13281922,"title":"Catching exception caused by network error during Facebook photo upload","body":"<p>I have done photo uploading to Facebook event page, mostly by following this <a href=\"http://blog.prabir.me/post/Facebook-CSharp-SDK-Upload-Progress.aspx\" rel=\"nofollow\">tutorial</a>. The result is satisfactory so far, with photos being uploaded to the event page most of the time. However, sometimes when the program is uploading the photo, and the network connection is laggy or severed, the program would crash and throw the <code>System.AggregateException</code>, with message:</p>\n\n<p><code>A Task's exception(s) were not observed either by Waiting on the Task or accessing its Exception property. As a result, the unobserved exception was rethrown by the finalizer thread.</code></p>\n\n<p>Through initial inspection, the InnerException of this is:</p>\n\n<p><code>[Facebook.WebExceptionWrapper]: {\"The underlying connection was closed: An unexpected error occurred on a receive.\"}</code></p>\n\n<p>,and the InnerException of the above exception is <code>System.IO.IOException</code>, and another <code>System.Net.Socket.SocketException</code> inside the IOException, in which, both error messages describe something like <code>{\"An established connection was aborted by the software in your host machine\"}</code>.</p>\n\n<p>The StackTrace of the exceptions gives me only:</p>\n\n<pre><code>at System.Threading.Tasks.TaskExceptionHolder.Finalize()\n</code></pre>\n\n<p>Now obviously, the problem is caused by crappy network connection the system may encounter sometimes. So, how or where do I handle this exception based on the code referenced from this <a href=\"http://blog.prabir.me/post/Facebook-CSharp-SDK-Upload-Progress.aspx\" rel=\"nofollow\">tutorial</a>? I have no idea where I should put the try-catch block at when this happened in another thread, or so it seems like to me.</p>\n\n<p>Thanks in advanced!</p>\n\n<p>Referenced code from the <a href=\"http://blog.prabir.me/post/Facebook-CSharp-SDK-Upload-Progress.aspx\" rel=\"nofollow\">tutorial</a>:</p>\n\n<pre><code>var mediaObject = new FacebookMediaObject\n                              {\n                                  ContentType = \"image/jpeg\",\n                                  FileName = Path.GetFileName(_filename)\n                              }\n                              .SetValue(File.ReadAllBytes(_filename));\n\nvar fb = new FacebookClient(_accessToken);\nfb.PostCompleted += fb_PostCompleted;\nfb.PostAsync(\"/me/photos\", new Dictionary&lt;string, object&gt; { { \"source\", mediaObject } });\n\npublic void fb_PostCompleted(object sender, FacebookApiEventArgs e)\n{\n  if (e.Cancelled)\n  {\n    var cancellationError = e.Error;\n    MessageBox.Show(\"Upload cancelled\");\n  }\n  else if (e.Error == null)\n  {\n    // upload successful.\n    MessageBox.Show(e.GetResultData().ToString());\n  }\n  else\n  {\n    // upload failed\n    MessageBox.Show(e.Error.Message);\n  }\n}\n</code></pre>\n"},{"tags":["objective-c","ios","multithreading","cocoa-touch","uitableview"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13280820,"title":"UITableViewDataSource and Multithreading","body":"<p>I'm running into index beyond bounds exception in one of my <code>UITableViews</code> and I <em>think</em> it could be down to some multithreading issues. Here's what I believe is happening:</p>\n\n<ol>\n<li>I have a <code>UITableView</code> and it's data source is a regular <code>NSMutableArray</code>.</li>\n<li>This <code>NSMutableArray</code> which is backing my <code>UITableView</code> is updated every couple of seconds with the contents of an API response.</li>\n<li>After each update, <code>UITableView</code>'s reloadData is being invoked to ensure that the user sees new data from the API server.</li>\n<li>Sometimes a index beyonds bounds exception gets thrown.</li>\n</ol>\n\n<p>Here's my code:</p>\n\n<pre><code>-(NSMutableArray*) currentBetEvents\n{\n    return  currentMarketId == nil ? [[BFOpenBetsModel sharedInstance] betEvents] :     filteredBetEvents;\n}\n\n- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView\n{    \n    NSArray *betEvents = [self currentBetEvents];\n    return [betEvents count];\n}\n\n-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{\n    NSArray *betEvents = [self currentBetEvents];\n    id obj = [betEvents objectAtIndex:indexPath.section] // this is where it blows up\n</code></pre>\n\n<p>Basically, I get an exception while trying to access an object in the betEvents structure at index 0.</p>\n\n<p>What I <em>believe</em> is happening is:</p>\n\n<ol>\n<li><code>reloadData</code> is called on the <code>UITableView</code></li>\n<li><code>numberOfSectionsInTableView:</code> is invoked which returns a value > 0.</li>\n<li>a rouge thread arrives and clears out the <code>UITableView</code>'s data source.</li>\n<li><code>cellForRowAtIndexPath:</code> is invoked and it bombs.</li>\n</ol>\n\n<p>Is there any way to ensure that this doesn't happen? Do I need to start using some primitive locks on the data source to ensure that it doesn't get updated while the table is being updated?</p>\n\n<p>Thanks,</p>\n\n<p>Sean</p>\n"},{"tags":["c#","windows-services","multithreading","backgroundworker"],"answer_count":12,"favorite_count":6,"up_vote_count":9,"down_vote_count":0,"view_count":7964,"score":9,"question_id":1498498,"title":"Windows Service that runs Periodically","body":"<p>I'm writing a windows service that once started will run every X hours.  The process it completes is fairly intensive, so I want to use a background worker.  I'm using a Settings file to store both the hours between runs and the last time the service ran.</p>\n\n<p>I'm not exactly sure the best way to do this - that is, I want the service to idle using as few resources as possible, and when it runs, it needs to run in the background worker, report what it did, and then go back into idle mode.</p>\n\n<p>I've thought about using 2 background workers.  The first worker would be a private local variable for the service that runs something like this:</p>\n\n<pre><code>while (true)\n{\n      //create new background worker and run\n\n      Thread.Sleep(Settings.Default.SleepTimeHours * 3600000);\n}\n</code></pre>\n\n<p>with a sub worker that is created each iteration of the loop, and destroyed when completed.  To support cancellation, I think I would have to have a local instance of the second worker available in the service, but it will be null if the process currently is not running.  When the secondary worker completes, it would send out my reporting, set the last run time in the settings file, and then dispose of the worker and set the reference to null.</p>\n\n<p>I'm wondering if there is a better way to do this or a best practice.</p>\n\n<p>Thanks</p>\n"},{"tags":["multithreading","crash","websphere","polling","portal"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13281113,"title":"Polling portlet issue in IBM Websphere Portal","body":"<p>I have a problem diagosing an production issue at work. Basically we have an Intranet Portal site running on IBM Websphere Portal (Version 5 or 6). So pages are pretty much built on composition of different portlets, i.e. News portlet, generic links portlets, graphic image portlets etc. We also have a Polling portlet created for internal users to vote on specific questions. However, there's being an issue with this polling portlet causing an outage of the entire Portal when (I was told) multiple users voting at the same time (or configuring the portlet at the same time) that builds up the number of running threads. I've being trying to duplicate the problem on QA/Test environment with load testing tools (e.g. Fiddler) but failed to reproduce the issue. There's limited amount of information I've being given when they approach me for finding the root cause of the problem in the code. Without being able to duplicate the issue there's no way I'm able to ensure I have fixed the problem.</p>\n\n<p>Could anyone advice what other ways I can go in reproducing the issue? Has anyone ever come across with similar issue before? How did you go about reproducing it?</p>\n\n<p>I'm sorry I can't provide much information apart from describing the problem to you. Cheers</p>\n"},{"tags":["c","multithreading","random","posix"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1926,"score":5,"question_id":133546,"title":"Is reading /dev/urandom thread-safe?","body":"<p>This is the code:</p>\n\n<p><code><pre>\n  unsigned int number;\n  FILE* urandom = fopen(\"/dev/urandom\", \"r\");\n  if (urandom) {\n    size_t bytes_read = fread(&amp;number, 1, sizeof(number), urandom);\n    DCHECK(bytes_read == sizeof(number));\n    fclose(urandom);\n  } else {\n    NOTREACHED();\n  }\n</pre></code></p>\n\n<p>If not, how do I make it thread-safe?</p>\n"},{"tags":["c#",".net","multithreading","parallel-processing"],"answer_count":5,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":6330,"score":11,"question_id":3780870,"title":"Using AsParallel()/Parellel.ForEach() guidelines?","body":"<p>Looking for a little advice on leveraging <code>AsParallel()</code> or <code>Parallel.ForEach()</code> to speed this up.</p>\n\n<p>See the method I've got (simplified/bastardized for this example) below.</p>\n\n<p>It takes a list like \"US, FR, APAC\", where \"APAC\" is an alias for maybe 50 other \"US, FR, JP, IT, GB\" etc. countires. The method should take \"US, FR, APAC\", and convert it to a list of \"US\", \"FR\", plus all the countries that are in \"APAC\".</p>\n\n<pre><code>private IEnumerable&lt;string&gt; Countries (string[] countriesAndAliases)\n{\n    var countries = new List&lt;string&gt;();\n\n    foreach (var countryOrAlias in countriesAndAliases)\n    {\n        if (IsCountryNotAlias(countryOrAlias))\n        {\n            countries.Add(countryOrAlias);\n        }\n        else \n        {\n            foreach (var aliasCountry in AliasCountryLists[countryOrAlias]) \n            {\n                countries.Add(aliasCountry);\n            }\n        }\n    }\n\n    return countries.Distinct();\n}\n</code></pre>\n\n<p>Is making this parallelized as simple as changing it to what's below? Is there more nuance to using <code>AsParallel()</code> than this? Should I be using <code>Parallel.ForEach()</code> instead of <code>foreach</code>? What rules of thumb should I use when parallelizing <code>foreach</code> loops?</p>\n\n<pre><code>private IEnumerable&lt;string&gt; Countries (string[] countriesAndAliases)\n{\n    var countries = new List&lt;string&gt;();\n\n    foreach (var countryOrAlias in countriesAndAliases.AsParallel())\n    {\n        if (IsCountryNotAlias(countryOrAlias))\n        {\n            countries.Add(countryOrAlias);\n        }\n        else \n        {\n            foreach (var aliasCountry in AliasCountryLists[countryOrAlias].AsParallel()) \n            {\n                countries.Add(aliasCountry);\n            }\n        }\n    }\n\n    return countries.Distinct();\n}\n</code></pre>\n"},{"tags":["c++","multithreading","winapi","synchronization","critical-section"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13279987,"title":"Leaving critical section after thread crash","body":"<p>I've got thread executing commands from list</p>\n\n<pre><code>do\n{\n    commandExec-&gt;criticalSection.EnterCS();\n    if (!commandExec-&gt;commands.empty())\n    {\n        commandExec-&gt;ExecuteCommand(commandExec-&gt;commands.front());\n        commandExec-&gt;commands.pop_front();\n    }\n    else\n        commandExec-&gt;criticalSection.SuspendThread();\n    commandExec-&gt;criticalSection.LeaveCS();\n} while (commandExec-&gt;maintainCommandExecution);\n</code></pre>\n\n<p>and second thread which adds commands to list:</p>\n\n<pre><code>criticalSection.EnterCS();\ncommands.push_back(Command(code, parameters));\ncriticalSection.LeaveCS();\ncriticalSection.ResumeThread();\n</code></pre>\n\n<p>First thread could crash while executing command, therefore critical section could not be accessed by second thread:</p>\n\n<blockquote>\n  <p>If a thread terminates while it has ownership of a critical section, the state of the critical section is undefined.\n  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682608%28v=vs.85%29.aspx\" rel=\"nofollow\">Source</a></p>\n</blockquote>\n\n<p><strong>So, what's the good way to handle this problem?</strong> \nI could think of some solutions, but they seems tricky (adding third thread, second critical section, etc.)</p>\n\n<p>(criticalSection it's just simple wrapper for CRITICAL_SECTION)</p>\n"},{"tags":["iphone","objective-c","ios","multithreading","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":634,"score":1,"question_id":7693203,"title":"performSelectorOnMainThread with multiple parameter","body":"<p>I am trying to perform this action on the main thread:</p>\n\n<pre><code>[curItem.mButton setBackgroundImage:newArt forState:UIControlStateNormal];\n</code></pre>\n\n<p>So I do this...</p>\n\n<pre><code>cWrapperObject* obj = [cWrapperObject alloc];\n[obj setupParams :curItem.mButton :newArt];\n[obj performSelectorOnMainThread:@selector(setImageForButton) withObject:nil waitUntilDone:YES];\n</code></pre>\n\n<p>I feel like this is bad, does anyone has any suggestions on how I could approach this differently?</p>\n"},{"tags":["c++","multithreading","boost","mutex","boost-thread"],"answer_count":5,"favorite_count":21,"up_vote_count":23,"down_vote_count":0,"view_count":21764,"score":23,"question_id":989795,"title":"Example for boost shared_mutex (multiple reads/one write)?","body":"<p>I have a multithreaded app that has to read some data often, and occasionally that data is updated. Right now a mutex keeps access to that data safe, but it's expensive because I would like multiple threads to be able to read simultaneously, and only lock them out when an update is needed (the updating thread could wait for the other threads to finish).</p>\n\n<p>I think this is what boost::shared_mutex is supposed to do, but I'm not clear on how to use it, and haven't found a clear example.</p>\n\n<p>Does anyone have a simple example I could use to get started?</p>\n"},{"tags":["c#","wpf","multithreading","user-interface","wpf-controls"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":59,"score":4,"question_id":13273289,"title":"WPF Control On Separate UI Thread?","body":"<p>I am making a media player, now.. I have added a realtime search function to search for songs etc. (Some thing like WMP realtime search) i.e while you enter the keywords the searching happens.</p>\n\n<p>During the searching process, accessing the database and loading an IEnumerable is done on another thread via a BackGroundProcess. The UI is updated by invoking a dispatcher of a UIElement.</p>\n\n<p>This process is rather fast, but however while you enter the search keywords in the textbox, there seems to be a small lag, this is beacause the Listbox.ItemSource updating takes some time. \ni.e say you want to search for \"Adele\", when you type in \"a\", the search function loads the results for \"A\", but as we are typing the whole word \"Adele\" , it some time to display the \"d\" \"e\" \"l\" \"e\" and there is a slight lag in between these letters.</p>\n\n<p>During this search process, when I stop updating the UI the search process seems very smooth, this only means to me that the Listbox is locking up the thread, so the rest of the player's UI is stuck there while the Listbox is done with its processing.</p>\n\n<p>So I believe if I can put the Listbox Control to another UI thread, I can maintain the smooth flow of the player irrespective of the time taken to load the Listbox.\nFYI: Data Virutualization is there &amp; ListBox has UI Virtualization is working</p>\n\n<p>How can i put the ListBox control onto another UI Thread?\nWPF, C#</p>\n\n<p>Thanks in advance  :)</p>\n"},{"tags":["c#","multithreading","locking"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13273277,"title":"Prevent Reading and Writing to a File at the Same Time","body":"<p>I have a process that needs to read and write to a file. The application has a specific order to its reads and writes and I want to preserve this order. What I would like to do is implement something that lets the first operation start and makes the second operation wait until the first is done with a first come first served like of queue to access the file. From what I have read file locking seems like it might be what I am looking for but I have not been able to find a very good example. Can anyone provide one?</p>\n\n<p>Currently I am using a TextReader/Writer with .Synchronized but this is not doing what I hoped it would.</p>\n\n<p>Sorry if this is a very basic question, threading gives me a headache :S</p>\n"},{"tags":["c#",".net","multithreading","system.reactive"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":13270559,"title":"ReplaySubject.First() blocks unexpectedly","body":"<p>I am encountering an absolutely bizarre behaviour in a Silverlight application on which I am working. Please see the following code:</p>\n\n<pre><code>var replaySubject = new ReplaySubject&lt;string&gt;(1);\n    replaySubject.OnNext(\"This can never block... surely?\");\n\nvar s = replaySubject.First();\nDebug.WriteLine(s);\n</code></pre>\n\n<p>Basically, my app comes through this piece of code repeated and it always prints out the message... except for in one particular scenario in which the thread blocks on the <code>First()</code> line.</p>\n\n<p>It's always on the UI thread. If I set a break point on the line with <code>First()</code>, and drill into the <code>replaySubject</code> with the debugger, I can see the string in its queue.</p>\n\n<p>Can anyone think of any scenario that would cause the <code>First()</code> call to block here?</p>\n\n<p>BTW: It's RX version 1.1.11111</p>\n"},{"tags":["java","multithreading","jax-ws","cxf"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13253639,"title":"JAX-WS request and response interceptors in same thread as invoke?","body":"<p>I'm wondering if the interceptors for a <code>SOAP</code> request sent over <code>JAX-WS</code> (CXF/JAXB) are guaranteed to run in the same thread as the invocation happens? </p>\n\n<p>The reason I'm asking is because I want to log the raw requests and responses (XML dumps) to the database using some request ID parameter as a key. And I don't know how to pass this ID to the interceptors, except setting it as a ThreadLocal variable prior to the <code>JAXB</code> invocation and retrieving it in the interceptors. Are there any other reasons I'm not seeing which makes this strategy a bad idea?</p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13276124,"title":"Check if parent thread is running","body":"<p>I am wondering how to check to see if a parent thread is still alive/stuck. Basically I have a parent thread sending commands to a child. If parent thread dies or hits a deadlock condition I do not want the child to continue to live. Below is basic framework of my implementation thus far.  </p>\n\n<pre><code>from Queue import Queue\nfrom threading import Thread\n\n    class myClass:\n\n        def __init__(self):\n\n            self.currentCommand = Queue()           \n            t = Thread(target=self._run)\n            t.start()            \n\n        def close(self):\n            self._sendCommand(\"close\")\n\n        def _run(self):\n            while True:\n                if self.currentCommand.empty():\n                    pass\n                    #do some task\n                else:\n                    command = self.currentCommand.get()\n                    if command == \"close\":\n                        #clean up\n                        self.currentCommand.task_done()\n                        break\n                    else:\n                        #do command task\n                        self.currentCommand.task_done()\n\n        def _sendCommand(self, command):\n            self.currentCommand.put(command)\n            self.currentCommand.join()\n</code></pre>\n\n<p>One idea I have is to periodically send computer time to child from parent. If time is greater than a set value child will die. Is there a easier or more effect method? Also within the python documentation, there is an isAlive method within the threading class but I am unsure how to use it.</p>\n"},{"tags":["java","multithreading","threadpool","executorservice"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13277100,"title":"ExecutorService where to store","body":"<p>I need an executor service to invoke a 3rd party service, to save from rtt and latency, planning to fire all the 3rd party request concurrently. </p>\n\n<p>I would like to know if I should create an ExecutorService per request ? or store at thread local? or one per application?</p>\n\n<p>What happens if i never call <code>shutdown</code> explicitly?</p>\n\n<p>Thanks.</p>\n"},{"tags":["multithreading","thread-safety","web.py"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13270257,"title":"Forcing single threaded request handling with web.py","body":"<p>I'm using web.py framework. For debugging purposes, I'd like to force all requests to be handled by a single thread, or simulate such behaviour with a mutex. How can I do that?</p>\n"},{"tags":["java","multithreading","quartz-scheduler"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13269762,"title":"Quartz for iregular interval of hours","body":"<p>I am using Quartz library to schedule <code>Thread</code> (using <code>Jobs</code>).</p>\n\n<p>My boss ask me if it is possible to solve this situation with Quartz:</p>\n\n<p>There is one Process that must be executed only days of the week at 00:00hs, 5:00hs, 9:00hs, and other diferent hours. As you can see, there isn't regular interval of the repeat. There are 5 o 6 different hours.</p>\n\n<p>Is there some <code>ScheduleBuilder</code> to solve this situation?</p>\n\n<p>I tried with <code>DailyTimeIntervalScheduleBuilder</code> but this Schedule work for regular interval of time.</p>\n"},{"tags":["c#","winforms","multithreading","listview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13274990,"title":"C# Thread ListView","body":"<p>I'm a fairly new to .net and I'm still struggling to understand a lot things, and right now I'm trying to accomplish something relatively simple but I've failed every single time, I would like to add a Thread to my program, this Thread would be responsible to perform the Upload operations to a web server and keep my program responsive providing the feedback of the operations to my users by updating a ListView, where the users would see all the status of the file uploads.</p>\n\n<p>I don't know how to put this Thread inside the program to make it responsive, I couldn't find any examples so far and I'm trying to find a little sample to show me the use of Thread and WinForms in action.</p>\n"},{"tags":["objective-c","multithreading","nsthread","nsrunloop","cfrunloop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13274941,"title":"NSRunloop and Timers","body":"<p>I get confused about using the timers with NSRunnloop, for what reason the timers are used ?\nand what is the deference between the below statements :</p>\n\n<p><strong>Code 1:</strong></p>\n\n<pre><code>    NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:1.0f target:self selector:@selector(timerFired:) userInfo:nil repeats:NO];\n    [runloop addTimer:timer forMode:NSRunLoopCommonModes];\n</code></pre>\n\n<p><strong>Code 2</strong></p>\n\n<pre><code>CFRunLoopTimerContext   timerCtxt;\n\nmemset(&amp;timerCtxt, 0, sizeof(CFRunLoopTimerContext));\n_timer = CFRunLoopTimerCreate(NULL,\n                              CFAbsoluteTimeGetCurrent(),\n                              1,         // interval\n                              0,         // flags\n                              0,         // order\n                              (CFRunLoopTimerCallBack)_idleTimerCallBack,\n                              &amp;timerCtxt);\n\n\nCFRunLoopAddTimer([runloop getCFRunLoop], _timer, kCFRunLoopCommonModes);\n</code></pre>\n\n<p>According to the Apple docs here :\n<a href=\"https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSRunLoop_Class/Reference/Reference.html\" rel=\"nofollow\">NSRunLoop Class Reference</a></p>\n\n<blockquote>\n  <p>NSTimer objects are not <strong>\"input\"</strong>—they are a special type</p>\n</blockquote>\n\n<p>in-contrary here : <a href=\"https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html\" rel=\"nofollow\">Run Loops</a> </p>\n\n<blockquote>\n  <p>Input sources deliver asynchronous events, usually messages from another thread or from a different application. <strong>Timer sources</strong> deliver synchronous events</p>\n</blockquote>\n\n<p>Last if I created a run loop in thread to handle downloading should I use Timer ?</p>\n\n<p>Thanks in Advance. </p>\n"},{"tags":["android","multithreading","android-asynctask","android-context"],"answer_count":4,"favorite_count":10,"up_vote_count":20,"down_vote_count":0,"view_count":22961,"score":20,"question_id":2124701,"title":"Android AsyncTask context behavior","body":"<p>I've been working with AsyncTasks in Android and I am dealing with a strange issue.</p>\n\n<p>Take a simple example, an Activity with one AsyncTask. The task on the background does not do anything spectacular, it just sleeps for 8 seconds.</p>\n\n<p>At the end of the AsyncTask in the onPostExecute() method I am just setting a button visibility status to View.VISIBLE, only to verify my results.</p>\n\n<p>Now, this works great until the user decides to change his phones orientation while the AsyncTask is working (within the 8 second sleep window).</p>\n\n<p>I understand the Android activity life cycle and I know the activity gets destroyed and recreated.</p>\n\n<p>This is where the problem comes in. The AsyncTask is referring to a button and apparently holds a reference to the context that started the AsyncTask in the first place.</p>\n\n<p>I would expect, that this old context (since the user caused an orientation change) to either become null and the AsyncTask to throw an NPE for the reference to the button it is trying to make visible.</p>\n\n<p>Instead, no NPE is thrown, the asynctask thinks that the button reference is not null, sets it to visible. The result? Nothing is happening on the screen! </p>\n\n<p>I have tackled this by keeping and updating the context reference into the AsyncTask. This is cumbersome and prone to leaks.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>    public class Main extends Activity {\n\n        private Button mButton = null;\n        private Button mTestButton = null;\n\n        @Override\n        public void onCreate(Bundle savedInstanceState) {\n            super.onCreate(savedInstanceState);\n            setContentView(R.layout.main);\n\n            mButton = (Button) findViewById(R.id.btnStart);\n            mButton.setOnClickListener(new OnClickListener () {\n                @Override\n                public void onClick(View v) {\n                    new taskDoSomething().execute(0l);\n                }\n            });\n            mTestButton = (Button) findViewById(R.id.btnTest);   \n        }\n\n        private class TaskDoSomething extends AsyncTask&lt;Long, Integer, Integer&gt; \n        {\n            @Override\n            protected Integer doInBackground(Long... params) {\n                Log.i(\"LOGGER\", \"Starting...\");\n                try {\n                    Thread.sleep(8000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                return 0;\n            }\n\n            @Override\n            protected void onPostExecute(Integer result) {\n                Log.i(\"LOGGER\", \"...Done\");\n                mTestButton.setVisibility(View.VISIBLE);\n            }\n        }\n}\n</code></pre>\n\n<p>Try executing and while the AsyncTask is working change your phones orientation.</p>\n"},{"tags":["c++","multithreading","ipc","multiprocessing"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13274312,"title":"Decoupling IPC in C++","body":"<p>I'm working on a wide program (C++/Qt on linux) organized in different parts: from an inner engine toward different UI (some of them graphical). So far I've organized this division creating a number of different processes equal to the number of different UI and engine. Every \"user\" process communicates with the core engine via two pipes (opposite directions).</p>\n\n<p>What I would like to obtain is to have every single process running as a stand alone one that doesn't block while communicating with the engine process but simply using an internal custom \"message buffer\" (already built and tested) to store messages and process them when free.</p>\n\n<p>The solution is (I guess) to design every process to spawn an additional thread which takes care of communicating to engine process (and another one for GUI). I am using pthread.h library (POSIX). Is it right? Could someone provide a simple example of how to achieve a communication between a single couple of processes?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","multithreading","task"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":13273929,"title":"c# Task do not work without sleep between them","body":"<p>I'm using Task in c# to send file via FTP in multithread.</p>\n\n<p>here is my function (file is a list of strings)</p>\n\n<pre><code> Task&lt;bool&gt;[] result = new Task&lt;bool&gt;[file.Count];\n        int j = 0;\n        foreach (string f in file)\n        {  \n            result[j] = new Task&lt;bool&gt;(() =&gt; ftp.UploadFtp(f, \"C:\\\\Prova\\\\\" + f + \".txt\", j));\n            result[j].Start();\n            j++;\n\n            //System.Threading.Thread.Sleep(50);\n\n        }\n        Task.WaitAll(result, 10000);\n</code></pre>\n\n<p>and the function to upload files</p>\n\n<pre><code>public static bool UploadFtp(string uploadFileName, string localFileName, int i)\n    {\n        FtpWebRequest request = (FtpWebRequest)WebRequest.Create(\"ftp://127.0.0.1/\" + uploadFileName + \".txt\");\n        //settare il percorso per il file da uplodare\n        //FtpWebRequest request = (FtpWebRequest)WebRequest.Create(\"ftp://desk.txt.it/\");\n        request.Method = WebRequestMethods.Ftp.UploadFile;\n\n        request.Credentials = new NetworkCredential(\"ftp_admin\", \"\");\n        //request.Credentials = new NetworkCredential(\"avio\", \"avio_txt\");\n        try\n        {\n            Console.WriteLine(uploadFileName);\n            Console.WriteLine(i);\n            StreamReader sourceStream = new StreamReader(localFileName);\n            byte[] fileContents = File.ReadAllBytes(localFileName);\n\n            sourceStream.Close();\n            request.ContentLength = fileContents.Length;\n\n            Stream requestStream = request.GetRequestStream();\n            requestStream.Write(fileContents, 0, fileContents.Length);\n            requestStream.Close();\n\n            FtpWebResponse response = (FtpWebResponse)request.GetResponse();\n\n            //MessageBox.Show(\"Upload File Complete, status {0}\", response.StatusDescription);\n\n            response.Close();\n            return true;\n        }\n        catch (Exception e)\n        {\n            return false;\n        }\n\n    }\n</code></pre>\n\n<p>in this way the program try always to save the last file of the list, but if I add a Sleep(50) it uploads the files correctly.\nit seems that the program starts 4 task doing the same job (saving the last file) only if I do not use sleep, but I do not understand why and I don't know how to solve the problem.</p>\n\n<p>Can someone help me? thank you</p>\n"},{"tags":["android","multithreading","android-asynctask","progressdialog"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13272689,"title":"Android: Progress dialog not shown at 1st time (using Thread or AsyncTask for longDuration operation)","body":"<p>I have problem in my app with progress dialog in AsyncTask: \nmy <code>AsyncTask</code> is doing some geting data from internet in <code>doInBackGround()</code>, I am starting progress dialog in <code>onPreExecute()</code>, finish dialog in  <code>onPostExecute()</code>. </p>\n\n<p>I execute this asyncTask when click on Button. 1st time When I click this button (long operation takes place) progress dialog is not shown. But next times Progress dialog is shown normaly.</p>\n\n<p>What can be the problem that 1st time of running <code>AsyncTask</code>, progress dialog isnt shown ?</p>\n\n<p>this is onClick method:</p>\n\n<pre><code>public void onClickFind(View view){\n new Task_Search().execute();\n}\n</code></pre>\n\n<p>This is task <code>Task_Search</code>:</p>\n\n<pre><code>private class Task_Search extends AsyncTask&lt;Void, Void, Void&gt; {\n\n @SuppressWarnings(\"deprecation\")\n protected void onPreExecute() {\n  showDialog(DIALOG_TASKING);\n }\n\n protected Void doInBackground(Void... unused) {\n  //some geting of web content here\n }\n\n @SuppressWarnings(\"deprecation\")\n protected void onPostExecute(Void unused) {\n  dismissDialog(DIALOG_TASKING);\n }\n}\n</code></pre>\n\n<p>progress dialog defined in <code>MainActivity</code>:</p>\n\n<pre><code>@SuppressWarnings(\"deprecation\")\n@Override\nprotected Dialog onCreateDialog(int id) {\n switch (id) {\n case DIALOG_TASKING:\n  mSearchDialog = new ProgressDialog(this);\n  mSearchDialog.setMessage(\"Searching for field number..\");\n  mSearchDialog.setCancelable(true);\n  return mSearchDialog;\n  }\n return super.onCreateDialog(id);\n}\n</code></pre>\n\n<p>Before of using <code>AsyncTask</code> I used separate Thread for downloading data instead: in <code>onClick</code>, I started first <code>progressDialog</code> then Thread, when Thread finished also <code>progressDialog</code> was stoped, \nBehaviour was same:\n1st time of click on Button dialog wasnt shown, next times its shown.</p>\n\n<p>Anybody who can help ?</p>\n"},{"tags":[".net","multithreading","locking","interlocked","synclock"],"answer_count":5,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":5069,"score":8,"question_id":2534547,"title":"Why use SyncLocks in .NET for simple operations when Interlocked class is available?","body":"<p>I've been doing simple multi-threading in VB.NET for a while, and have just gotten into my first large multi-threaded project. I've always done everything using the <code>Synclock</code> statement because I didn't think there was a better way.</p>\n\n<p>I just learned about the <code>Interlocked</code> Class - it makes it look as though all this:</p>\n\n<pre><code>Private SomeInt as Integer\nPrivate SomeInt_LockObject as New Object\n\nPublic Sub IntrementSomeInt\n    Synclock SomeInt_LockObject\n        SomeInt += 1\n    End Synclock\nEnd Sub\n</code></pre>\n\n<p>Can be replaced with a single statement:</p>\n\n<pre><code>Interlocked.Increment(SomeInt)\n</code></pre>\n\n<p>This handles all the locking internally and modifies the number. This would be much simpler than writing my own locks for simple operations (longer-running or more complicated operations obviously still need their own locking).</p>\n\n<p>Is there a reason why I'd rolling my own locking, using dedicated locking objects, when I can accomplish the same thing using the <code>Interlocked</code> methods?</p>\n"},{"tags":["c#","multithreading","compression"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1368,"score":2,"question_id":1211225,"title":"Multithreaded compression in C#","body":"<p>Is there a library in .net that does multithreaded compression of a stream? I'm thinking of something like the built in <code>System.IO.GZipStream</code>, but using multiple threads to perform the work (and thereby utilizing all the cpu cores).</p>\n\n<p>I know that, for example 7-zip compresses using multiple threads, but the C# SDK that they've released doesn't seem to do that.</p>\n"},{"tags":["android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":40,"score":1,"question_id":13271506,"title":"Async task gets UI stuck","body":"<p>I have 2 async tasks (which does server requests) running just before i leave my activity.\nsometimes the activity which runs this async tasks gets stuck until the async tasks finish, and sometimes the next activity shows and gets stuck until the async tasks finishes.</p>\n\n<p>my question is how do i run this task in a way in which my activity's UI doesn't gets stuck (the UI is not dependable on the responses in the async tasks)</p>\n"},{"tags":["c++","multithreading","boost"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13272595,"title":"Do I need to call unlock() in the Boost thread function?","body":"<p>I have the following lines of code where I used C++ Boost thread:</p>\n\n<pre><code>void threadFunc()\n{\nboost::mutex::scoped_lock lock(m_Mutex);\n//some code here...\ncondition.notify_one();\n} \n</code></pre>\n\n<p>So should I call unlock() function before the last line, like the following? What is the difference if I don't call unlock()?</p>\n\n<pre><code>void threadFunc()\n{\nboost::mutex::scoped_lock lock(m_Mutex);\n//some code here...\nlock.unlock();\ncondition.notify_one();\n} \n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":8183205,"title":"What could cause of RejectedExecutionException","body":"<p>I am getting this exception on my tomcat server (+liferay)</p>\n\n<p>java.util.concurrent.RejectedExecutionException\nmy class is like that :</p>\n\n<pre><code>public class SingleExecutor extends ThreadPoolExecutor {\n  public SingleExecutor(){\n    super(1, 1,0L, TimeUnit.MILLISECONDS,new LinkedBlockingQueue&lt;Runnable&gt;());\n  }\n\n  @Override\n  public void execute(Runnable command) {\n    if(command instanceof AccessLogInsert){\n        AccessLogInsert ali = (AccessLogInsert)command;\n        ali.setConn(conn);\n        ali.setPs(ps);\n    }\n    super.execute(command);\n  }\n}\n</code></pre>\n\n<p>I get this exception on the line super.execute(command);\nThis error can occur when the queue is full but the LinkedBlockingQueue size is 2^31, and  I am sure that there is no so many command waiting.</p>\n\n<p>At start everything is stable, but after I redeploy a war it starts occuring. This class is not part of the war but in a jar in tomcat/lib.</p>\n\n<p>Do you have any idea why this happend and how to fix it ?</p>\n\n<p>Thanks</p>\n"},{"tags":["python","multithreading","wxpython","frame"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13263108,"title":"can I use listener thread send different message to multiframe in wxpython?","body":"<p>I have a listener thread send message to a frame in wxpython,it work.but now I want to make multiframe,can I use this listener thread send diffrent message to two frame?If it can do this?How should I do?</p>\n\n<p>Thanks!</p>\n"},{"tags":["vb.net","multithreading","datagridview","bug"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13267509,"title":"DatagridView crashes App when updating causes scrollbars to appear","body":"<p>My vb.net 4.0 project is in-house trading platform.</p>\n\n<p>A separate form called <strong>MsgPad</strong> contains a Datagridview called <strong>MsgPadDG</strong>.</p>\n\n<p>The <strong>Form-load</strong> sub does two things: formats the datagridview and defines a timer for the gridview refresh.</p>\n\n<p>A second Sub, <strong>UpdateMyMsg</strong>, receives updates from a threaded <strong>UIUpdaterEngine</strong> by means of <strong>NewMessage</strong> events, and updates the <strong>MyMessages</strong> Object (fundamentally a datatable).</p>\n\n<p>A third sub, <strong>UpdateMdgPadDGW</strong>, updates/refreshes the datagridview using the invoke method (probably not necessary, because the timer is defined in the UI thread).</p>\n\n<p>Finally The Datagridview properties: rows are defined as <strong>not user-editable</strong>,  <strong>AutoSizeRowsMode = Displayedcells</strong> and <strong>ScrollBars = Both</strong>.</p>\n\n<p>My problem is that the entire App crashes when the updating process adds rows beyond the limit of the datagridview, causing scrollbars to appear. \nI tried without the timer (invoking datasource update directly in the UpdateMyMsg Sub), with the timer, but the problem is always there.\nWeird thing: The <strong>Try-Catch</strong> block doesn't catch anything.</p>\n\n<p>Thanks in advance for your replays.</p>\n\n<p>Edoardo</p>\n\n<p>HERE COMES THE CODE:</p>\n\n<pre><code>Public Class MsgPad\nPrivate WithEvents _MyUIUpdaterEngine As MyUIUpdaterEngine = MyUIUpdaterEngine.Instance\nPrivate MyMessages As New Messages\nPrivate LastUpdate As DateTime = TimeValue(\"08:00:00\")\nPrivate ObjLock As New Object\nPrivate NewMessages As Boolean = False\nDim UpdateDGWTimer As New System.Timers.Timer\n\n Private Sub MsgPad_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load\n    Try\n        '--\n        MsgPadDG.DataSource = MyMessages.DTable\n        '--\n        With MsgPadDG\n            '--\n            .Columns(\"Msg_ID\").Visible = False\n            .Columns(\"I_CommandID\").Visible = False\n            .Columns(\"B_ID\").Visible = False\n            .Columns(\"F_ID\").Visible = False\n            .Columns(\"T_TV\").Visible = False\n            .Columns(\"T_Sign\").Visible = False\n            .Columns(\"T_Mde\").Visible = False\n            .Columns(\"T_QU\").Visible = False\n            .Columns(\"T_QI\").Visible = False\n            .Columns(\"T_QF\").Visible = False\n            .Columns(\"T_PI\").Visible = False\n            .Columns(\"T_PF\").Visible = False\n            '--\n            .Columns(\"Msg_RecDate\").HeaderText = \"Date\"\n            .Columns(\"Msg_RecDate\").Width = 50\n            .Columns(\"Msg_RecDate\").DefaultCellStyle.Format = \"HH:mm:ss\"\n            .Columns(\"I_Symbol\").HeaderText = \"Symbol\"\n            .Columns(\"I_Symbol\").Width = 80\n            .Columns(\"I_Des\").HeaderText = \"Des\"\n            .Columns(\"I_Des\").Width = 180\n            .Columns(\"Msg_Text\").HeaderText = \"Message\"\n            .Columns(\"Msg_Text\").Width = 250\n            '--\n\n        End With\n\n        '--Crea timer per l'Update del DAtagridView\n        AddHandler UpdateDGWTimer.Elapsed, AddressOf UpdateMsgPadDGW\n        UpdateDGWTimer.Interval = 3500\n        UpdateDGWTimer.Enabled = True\n .....\n .....\n End Sub\n\n Private Sub UpdateMyMsg(ByVal CRec As OrderRecord, ByVal Msg As String) Handles _MyUIUpdaterEngine.NewMessage\n\n    Try\n        SyncLock ObjLock\n            '--Aggiorna la tabella MyMessages\n            MyMessages.Add(CRec, Msg)\n            NewMessages = True\n            '--Parla messaggio\n            Dim synth As New SpeechSynthesizer\n            Dim TalkMsg As String = Msg\n            If CRec.I_Des &lt;&gt; Nothing Then TalkMsg += \" su: \" + CRec.I_Des\n            synth.SpeakAsync(TalkMsg)\n        End SyncLock\n .....\n .....\n End Sub\n\n\n Private Sub UpdateMsgPadDGW(source As Object, e As ElapsedEventArgs)\n\n    '--Aggiorna MesssagePad\n    Try\n        SyncLock ObjLock\n            If NewMessages Then\n                MsgPadDG.ControlInvoke(Sub(l)\n                                           MsgPadDG.DataSource = MyMessages.DTable\n                                           MsgPadDG.Refresh()\n                                           MsgPadDG.ClearSelection()\n                                       End Sub)\n                NewMessages = False\n            End If\n        End SyncLock\n .....\n .....\n End Sub\n</code></pre>\n"},{"tags":["iphone","ios","multithreading","uiimageview","three20"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13269740,"title":"Which one is a better iOS Photo Viewer: Three20 or EGOPhotoViewer","body":"<p>I am making an app for showing an image gallery in iOS, and I came across two samples.</p>\n\n<p>I want to know the differences between <a href=\"https://github.com/enormego/three20\" rel=\"nofollow\">Three20</a> and <a href=\"https://github.com/enormego/PhotoViewer\" rel=\"nofollow\">EGOPhotoViewer</a>. I mean both apps are developed by same developer (<a href=\"https://github.com/enormego\" rel=\"nofollow\">enormego</a>).</p>\n\n<ul>\n<li>Is it safe to use them for the app store, I mean it may not get rejected, and compatibility with iOS6?</li>\n<li>Is there any advantage of using EGOPhotoViewer over Three20?</li>\n<li>Is it worth to stick to Three20 for any important feature of cache, thread, etc.</li>\n<li>In code both almost use the same classes and function with different names.</li>\n</ul>\n"},{"tags":["c#","multithreading","waithandle"],"answer_count":4,"favorite_count":8,"up_vote_count":15,"down_vote_count":0,"view_count":5605,"score":15,"question_id":2702545,"title":"Workaround for the WaitHandle.WaitAll 64 handle limit?","body":"<p>My application spawns loads of different small worker threads via <code>ThreadPool.QueueUserWorkItem</code> which I keep track of via multiple <code>ManualResetEvent</code> instances. I use the <code>WaitHandle.WaitAll</code> method to block my application from closing until these threads have completed.</p>\n\n<p>I have never had any issues before, however, as my application is coming under more load i.e. more threads being created, I am now beginning to get this exception:</p>\n\n<p><code>WaitHandles must be less than or equal to 64 - missing documentation</code></p>\n\n<p>What is the best alternative solution to this?</p>\n\n<p><b> Code Snippet </b></p>\n\n<pre><code>List&lt;AutoResetEvent&gt; events = new List&lt;AutoResetEvent&gt;();\n\n// multiple instances of...\nvar evt = new AutoResetEvent(false);\nevents.Add(evt);\nThreadPool.QueueUserWorkItem(delegate\n{\n    // do work\n    evt.Set();\n});\n\n...\nWaitHandle.WaitAll(events.ToArray());\n</code></pre>\n\n<p><b> Workaround </b></p>\n\n<pre><code>int threadCount = 0;\nManualResetEvent finished = new ManualResetEvent(false);\n\n...\nInterlocked.Increment(ref threadCount);\nThreadPool.QueueUserWorkItem(delegate\n{\n    try\n    {\n         // do work\n    }\n    finally\n    {\n        if (Interlocked.Decrement(ref threadCount) == 0)\n        {\n             finished.Set();\n        }\n    }\n});\n\n...\nfinished.WaitOne();\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13268673,"title":"C# threading, thread not persistant","body":"<p>Morning all,</p>\n\n<p>Using C# .NET 4.0 and Visual Studio 2012 Express.</p>\n\n<p>I have a program that runs some SQL stored procedures, then opens and Access database and auto generates the reports then emails them.</p>\n\n<p>I have it set on a date so it runs as soon as midnight comes.</p>\n\n<p>The following is a code sample.</p>\n\n<pre><code>private void button1_Click(object sender, EventArgs e)\n{\n    Thread myUltiThread = new Thread(GetCurrentDate);\n    myUltiThread.Start();\n}\n\nprivate void GetCurrentDate()\n{\n    string myDate = \"\";\n    myDate = DateTime.Today.Day.ToString();\n\n    if(myDate == \"7\" &amp;&amp; myDateToggle == false)\n    {\n        Task t = new Task(() =&gt; RunMonthBackUp());\n        t.Start();\n    }\n\n    if (myDate == \"8\" &amp;&amp; myDateToggle == true)\n    {\n        myDateToggle = false;\n    }\n}\n</code></pre>\n\n<p>So as you can see once the button is pressed my program then starts the thread, which uses the getdate method, this method checks if the date is correct.</p>\n\n<p>if it is then it starts a task that runs the whole process.</p>\n\n<p>My problem is that this is not happening, I believe its because the method is only running once. I have a feeling this is due to my lack of understanding working with threads (only ever deal with tasks usually).</p>\n\n<p>Could someone point out to me where I am going wrong and how to get this set up properly?</p>\n\n<p>Many thanks guys</p>\n"},{"tags":["java","multithreading","ejb","pool","zookeeper"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13256090,"title":"Zookeeper based lock in EJB","body":"<p>I would like to utilize zookeeper to create distributed lock.\nI have the Factory creating LockObject that allow to lock/unlock some value.\nEvery LockObject created by the Factory uses the same org.apache.zookeeper.Zookeeper object.</p>\n\n<p>Now, I would like to use this Factory, as EJB so the other services could use it. We can assume that multiple threads will be using same Zookeeper object simultaneously. What I'm dealing with is to restrict the number of connections that can be created from the application. Is there any kind of connection pool for zookeeper or is single org.apache.zookeeper.Zookeeper object appropriate for this problem? </p>\n\n<p>Best,\nA</p>\n"},{"tags":["multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":13,"score":-4,"question_id":13268209,"title":"Multithreaded web crawler using callable and executor service","body":"<p>i am writing code for a multithreaded web crawler in the call() will first process the given input url and stores the obtained urls in a set and queue again i m calling executor.submit(new Cralin());which will be gives a future object.on itearting that object i m getting exception strings.\n`public SET call(){</p>\n\n<p>//url processing</p>\n\n<p>Future f= executor.submit(new Crawling()); \n}\n`</p>\n"},{"tags":["c","multithreading","exec","fork","shared"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13257983,"title":"How to deal with shared memory and shared semaphores on a fork-exec?","body":"<p>I'd like to add as new feature to a grown application to start execution of another application using fork (2) and exec (3) (currently execl).</p>\n\n<p>Unfortunately the application uses shared memory, shared semaphores and has a huge number of open file descriptors, which are all duplicated when calling fork. I know that I should close all file descriptors, shared resources etc. before calling execl in the child process, but parts of these are handled by third-party libraries and I have no means of accessing them.</p>\n\n<p>To top it all the application is threaded (using posix threads), but that should be ok as long as there are no asynchronous system calls between fork and exec in the child process (according to <a href=\"http://www.linuxprogrammingblog.com/threads-and-fork-think-twice-before-using-them\" rel=\"nofollow\">http://www.linuxprogrammingblog.com/threads-and-fork-think-twice-before-using-them</a>).</p>\n\n<p>The problem I'm facing now is that the execl call seems to somehow corrupt the shared resources, leading to a deadlock in the thread that uses them. This seems only to happen when calling execl as exiting the child process immediatly after fork with _exit (2) does not produce this behaviour.</p>\n\n<p>What is the proper way to deal with shared memory and shared semaphores when spawning a new process with fork and exec?</p>\n"},{"tags":["java","multithreading","gui","rendering","swingworker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13237757,"title":"Java rendering a game map in a SwingWorker does not work properly","body":"<p>I am currently developing a game which requires a grid-like map being drawn on a JPanel (or other container).\nTo achieve this in a reasonable amount of time and to keep my UI responsive i pass the container's graphics object\nto a map renderer which is a subclass of SwingWorker. Then i call the execute method of the map renderer which starts the actual drawing of the map. When the drawing is done a message is printed. All this is starts when i press the M key.</p>\n\n<p>The actual problem is that drawing the map is successful only the first time. When i press the M key repeatedly i never get any other done messages. Also, when i ALT-TAB out of my application (which runs in fullscreen exclusive mode) and back in, my map is not visible anymore. </p>\n\n<p>I suspect the problem somehow lies in not directly drawing in the EDT thread or not correctly passing on that my map renderer is ready.</p>\n\n<p>This is my map renderer class:</p>\n\n<pre><code>    public class MapRenderer extends SwingWorker&lt;Void, Void&gt; {\n\nprivate Graphics2D g;\nprivate WorldMap map;\nprivate int x, y, w, h, l;\n\n\n@Override\nprotected Void doInBackground() throws Exception {\n    drawMap();\n    return null;\n}\n\n@Override\nprotected void done() {\n    super.done();\n    System.out.println(\"Done\");\n}\n\nprivate void drawMap() {\n    int rw = w + 1;\n    int rh = h + 1;\n\n    if (rw &gt;= map.getSize())\n        rw = map.getSize();\n    if (rh &gt;= map.getSize())\n        rh = map.getSize();\n\n    for (int i = 0; i &lt; rw; i++) {\n        for (int j = 0; j &lt; rh; j++) {\n            g.setColor(map.getTiles()[x + i][y + j].getColor());\n            g.fillRect(i * l, j * l, l, l);\n            if (l &gt; 2) {\n                g.setColor(Color.DARK_GRAY);\n                g.drawRect(i * l, j * l, l, l); \n            }\n        }\n    }\n}\n\npublic void setGraphics(Graphics2D g) {\n    this.g = g;\n}\n\npublic void setMap(WorldMap map) {\n    this.map = map;\n}\n\npublic void setViewPoint(Rectangle viewPoint, int squareSize) {\n    this.x = (int) viewPoint.getX();\n    this.y = (int) viewPoint.getY();\n    this.w = (int) viewPoint.getWidth();\n    this.h = (int) viewPoint.getHeight();\n    this.l = squareSize;\n}\n    }\n</code></pre>\n\n<p>This is where the execute() method is called:</p>\n\n<pre><code>private void initializeKeyBindings() { \n    this.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke(\"M\"), \"M\");\n    this.getActionMap().put(\"M\", new AbstractAction() {\n        private static final long serialVersionUID = 1L;\n        @Override\n        public void actionPerformed(ActionEvent e) {\n            drawMap(getGraphics());\n        }\n    });\n}\n\npublic void drawMap(Graphics g) {\n    mapRenderer.setGraphics((Graphics2D) g);\n    mapRenderer.setViewPoint(new Rectangle(0, 0, 1600 / 4, 900 / 4), 4);\n    mapRenderer.execute();\n}\n</code></pre>\n\n<p>I apologize for any sloppy coding, i promise i will clean it up in the future.</p>\n"},{"tags":["c#",".net","multithreading","timer"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":64,"score":-2,"question_id":13153245,"title":"How to excecute method after a delay in threading .timer?","body":"<p>I have a class that created a <strong>threading .timer</strong>.</p>\n\n<pre><code>  System.Threading.Timer timer;\n  TimerCallback cb = new TimerCallback(ProcessTimerEvent);\n    timer = new Timer(cb, reset, 1000, Convert.ToInt64(this.Interval.TotalSeconds));\n}\n\nprivate void ProcessTimerEvent(object obj)\n{\n    if (Tick != null)\n        Tick(this, EventArgs.Empty);\n}\n</code></pre>\n\n<p>I want dispose Timer inside of this and then timer work.</p>\n\n<p>in my TickEvent i excecute a method but don't complate this.</p>\n\n<pre><code> void MyTimer_Tick(object sender, EventArgs e)\n{\n if(value)\n   MyFunction();\n}\n</code></pre>\n\n<p>Timer must be taken to stop until MyFunction complete.</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13257333,"title":"Issuing notify on a single thread awakens all waiting threads","body":"<p>Having three threads waiting on a 4th one, and the latter issuing a notify, all of the waiting threads are awakened.</p>\n\n<p>Here is the source code:</p>\n\n<pre><code>class Reader extends Thread {\n\n  Calculator calc;\n\n  public Reader(Calculator calc) {\n    this.calc = calc;\n  }\n\n  public void run() {\n    synchronized(calc) {\n      try {\n        System.out.println(Thread.currentThread().getName() + \" waiting for calc\");\n        calc.wait();\n      } catch (InterruptedException e) { e.printStackTrace(); }\n      System.out.println(Thread.currentThread().getName() + \" Total is: \" + calc.total);\n    }   \n  }\n\n}\n\nclass Calculator extends Thread {\n\n  public int total = 0;\n\n  public void run() {\n    synchronized(this) {\n      for (int i = 0; i &lt; 50; i++) {\n        total += i;\n      }\n      notify();\n      System.out.println(\"I notified a thread\");\n    }\n  }\n\n}\n\npublic class Notify {\n\n  public static void main(String[] args) {\n    Calculator calc = new Calculator();\n    Reader r1 = new Reader(calc);\n    Reader r2 = new Reader(calc);\n    Reader r3 = new Reader(calc);\n    r1.start();\n    r2.start();\n    r3.start();\n    calc.start();\n  }\n}\n</code></pre>\n\n<p>Here is the output I get:</p>\n\n<pre><code>Thread-2 waiting for calc\nThread-4 waiting for calc\nThread-3 waiting for calc\nI notified a thread\nThread-2 Total is: 1225\nThread-3 Total is: 1225\nThread-4 Total is: 1225\n</code></pre>\n\n<p>Shouldn't only one waiting thread be awakened and execute the <code>System.out.println(Thread.currentThread().getName() + \" Total is: \" + calc.total);</code> instruction ?</p>\n"},{"tags":["c#","multithreading","thread-safety"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":90,"score":5,"question_id":13261300,"title":"Is it okay to \"double check\" before and inside a lock before running the code inside?","body":"<p>On working with thread-safety, I find myself always \"double checking\" before executing code in a lock block and I wondered if I was doing the right thing. Consider the following three ways of doing the same thing:</p>\n\n<p>Example 1:</p>\n\n<pre><code>private static SomeCollection MyCollection;\nprivate static Object locker;\nprivate void DoSomething(string key)\n{\n    if(MyCollection[key] == null)\n    {\n         lock(locker)\n         {\n              MyCollection[key] = DoSomethingExpensive(); \n         }\n    }\n    DoSomethingWithResult(MyCollection[key]);\n}\n</code></pre>\n\n<p>Example 2:</p>\n\n<pre><code>private static SomeCollection MyCollection;\nprivate static Object locker;\nprivate void DoSomething(string key)\n{\n    lock(locker)\n    {\n         if(MyCollection[key] == null)\n         {\n              MyCollection[key] = DoSomethingExpensive(); \n         }\n    }\n    DoSomethingWithResult(MyCollection[key]);\n}\n</code></pre>\n\n<p>Example 3:</p>\n\n<pre><code>private static SomeCollection MyCollection;\nprivate static Object locker;\nprivate void DoSomething(string key)\n{\n    if(MyCollection[key] == null)\n    {\n        lock(locker)\n        {\n             if(MyCollection[key] == null)\n             {\n                  MyCollection[key] = DoSomethingExpensive(); \n             }\n        }\n    }\n    DoSomethingWithResult(MyCollection[key]);\n}\n</code></pre>\n\n<p>I always lean towards Example 3, and here's why I think I'm doing the right thing</p>\n\n<ul>\n<li>Thread 1 enters <code>DoSomething(string)</code></li>\n<li><code>MyCollection[key] == null</code> so Thread 1 obtains a lock, just as Thread 2 enters</li>\n<li><code>MyCollection[key] == null</code> is still true, so Thread 2 waits to obtain the lock</li>\n<li>Thread 1 calculates the value for <code>MyCollection[key]</code> and adds it to the collection</li>\n<li>Thread 1 releases the lock and calls <code>DoSomethingWithResult(MyCollection[key]);</code></li>\n<li>Thread 2 obtains the lock, by which time <code>MyCollection[key] != null</code></li>\n<li>Thread 2 does nothing, releases the lock and continues on its merry way</li>\n</ul>\n\n<p>Example 1 would work, but there is a big risk that Thread 2 could redundantly calculate <code>MyCollection[key]</code>.</p>\n\n<p>Example 2 would work, but every thread would obtain a lock, even if it didn't need to - which could be a (admittedly very small) bottleneck. Why hold up threads if you don't need to?</p>\n\n<p>Am I overthinking this and if so, what is the preferred way of handling these situations?</p>\n"},{"tags":["java","multithreading","cpu","wowza"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13265727,"title":"wowza java high cpu usage","body":"<p>I have problem about cpu usage in wowza.</p>\n\n<p>this is doubtful thread. this thread is took high cpu.</p>\n\n<pre><code>SocketAcceptorIoProcessor-1.0 prio=10 tid=0x0000002a9fb53000 nid=0x2428 runnable         [0x000000004f017000]\njava.lang.Thread.State: RUNNABLE\nat sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\nat sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:210)\nat sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:65)\nat sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:69)\n- locked &lt;0x00000007d82ba4e8&gt; (a sun.nio.ch.Util$2)\n- locked &lt;0x00000007d82ba4d8&gt; (a java.util.Collections$UnmodifiableSet)\n- locked &lt;0x00000007d82ad450&gt; (a sun.nio.ch.EPollSelectorImpl)\nat sun.nio.ch.SelectorImpl.select(SelectorImpl.java:80)\nat org.apache.mina.transport.socket.nio.SocketIoProcessor$Worker.run(Unknown Source)\nat org.apache.mina.util.NamePreservingRunnable.run(Unknown Source)\nat java.lang.Thread.run(Thread.java:662)\n</code></pre>\n\n<p>this thread took high cpu. is this jdk bug or else?</p>\n\n<p>this is my environment.</p>\n\n<p>CentOS release 5.4 (Final)</p>\n\n<p>WowzaMediaServer-3.1.2</p>\n\n<p>java version 1.6.0_23\nJava(TM) SE Runtime Environment (build 1.6.0_23-b05)\nJava HotSpot(TM) 64-Bit Server VM (build 19.0-b09, mixed mode)</p>\n"},{"tags":["java","c","multithreading","jni"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1855,"score":2,"question_id":453776,"title":"How to: Java listening for events captured by C thread","body":"<p>I would like to create a Java program to listen for and respond to events captured by a thread in C.<br>\nCan someone explain how this can be achieved using JNI, or point me to online tutorials?</p>\n\n<p>Thank you.</p>\n"},{"tags":["python","multithreading","gevent"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":13126254,"title":"python thread by gevent?","body":"<pre><code>import threading,gevent,gevent.monkey \nclass test(threading.Thread):\n  def __init__(self):\n    threading.Thread.__init__(self)\n  def run(self):\n    print 1  \n    gevent.sleep(2)  \n    print 2\ngevent.monkey.patch_thread() \nt=test()  \nt.start() \n</code></pre>\n\n<p>why 'print 2' not run, how to do? </p>\n\n<p>If to download files,multithread and gevent, which is faster?</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":60,"score":-1,"question_id":13265053,"title":"Background Worker vs Thread","body":"<p>For long runnings tasks(Asynchronous) in C# 4.0 windows Application.</p>\n\n<p>The choices are:</p>\n\n<ol>\n<li><p>BackgroundWorker (Thread Pool)</p></li>\n<li><p>Thread</p></li>\n</ol>\n\n<p>The above two are recommended for long running tasks(throughout application lifetime). Any other choices? In Additon,</p>\n\n<ul>\n<li><p><strong>BackgroundWorker</strong> - Uses ThreadPool Thread and for long running process with UI updates.</p></li>\n<li><p><strong>Thread</strong> - User defined Thread (Thread Creation overhead etc.) and for long running process (can use priority)</p>\n\n<p>Which would be a best choice </p>\n\n<ol>\n<li><p>if no need for UI update,priority and for Thread (which is created only on application/process start)?</p></li>\n<li><p>if number of tasks increased? (Care of ThreadPool Starvation)</p></li>\n</ol></li>\n</ul>\n\n<p>Any other interesting things?</p>\n"},{"tags":["android","multithreading","sms"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3687,"score":1,"question_id":5517197,"title":"How to create multi thread in android?","body":"<p>I am new to android and i was doing some application which might use\nmulti threading.\nFor example the application threads might do as follows assuming 2\nthreads;</p>\n\n<p>Thread 1\nEven if the overall application runs on foreground thread one should\nrun at all times listening for specific sms;\nImagine the sms to be Intercepted is \"3456\" when this message is sent\nto the phone then thread one will be paused\nand thread 2 will be activated:</p>\n\n<p>Thread 2\nWhen thread to is activated then it will use gps to track the location\nof the phone and will use instance of smsManager to send back the\ncoordinates(log, lat) of the phone or even if possible google map back\nto the phone which sent the message \"3456\" and then thread one will be\nactivated:</p>\n\n<p><em>*</em>*How to make this happen any idea?</p>\n"},{"tags":["c++","multithreading","cross-platform"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":396,"score":2,"question_id":5578559,"title":"Cross platform multithreading in C++?","body":"<p>Basically, the title explains it all; I'm looking to make a game in C++ and I want to use multithreading for stuff like the physics engine and keeping the animation smooth on the loading screen. I've seen a few multithreading libraries, but I'm wondering which is best for my application, which will work well on Windows Mac and Linux. Does such a library exist?</p>\n"},{"tags":["java","multithreading","javafx-2","java.util.concurrent"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13263201,"title":"JavaFX thread synchronization with Java thread","body":"<p>Is there a way to synchronize a JavaFX Platform thread and a standard Java thread? Currently, when triggered, the JavaFX thread fires before the standard Java thread has finished adding all of the images to the observable list, and so the imageList is updated with a blank collection.</p>\n\n<pre><code>private final TilePane imageList;\nfinal File[] files = new File(dir).listFiles();\nfinal List&lt;ImageView&gt; views = FXCollections.observableArrayList();\n\nnew Thread() {\n        @Override\n        public void run() {\n            for (final File file : files) {\n                if (Utils.fileIsImage(file) &amp;&amp; !file.isDirectory()) {\n                    ImageView view = new ImageView(new Image(\"file:\" + file, 72, 72, false, true));\n                    views.add(view);\n                }\n            }\n        }\n    }.start();\n    Platform.runLater(new Runnable() {\n        @Override\n        public void run() {\n            imageList.getChildren().addAll(views);\n        }\n    });\n</code></pre>\n\n<p>I'm relatively new to JavaFX and concurrency, and don't have any experience with thread locks, so any help would be great. Thanks!</p>\n"},{"tags":["python","multithreading","memory","timer","python-2.7"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13261593,"title":"Resource usage of \"time.sleep\" in loop vs. \"threading.Timer\"","body":"<p>First method:</p>\n\n<pre><code>import threading\nimport time\n\ndef keepalive():\n    while True:\n        print 'Alive.'\n        time.sleep(200)\nthreading.Thread(target=keepalive).start()\n</code></pre>\n\n<p>Second method:</p>\n\n<pre><code>import threading\n\ndef keepalive():\n    print 'Alive.'\n    threading.Timer(200, keepalive).start()\n\nthreading.Timer(200, keepalive).start()\n</code></pre>\n\n<p>Which method takes up more RAM? And in the second method, does the thread end after being activated? or does it remain in the memory and start a new thread? (multiple threads)</p>\n"},{"tags":["java","multithreading","java.util.concurrent"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13263560,"title":"Multithreading,Callable,FutureObject","body":"<p>How can I return two individual iterated <code>Set&lt;String&gt;</code> values in a same method to a <code>Future</code> object which is in main method?  I'm using <code>Callable</code> since I have to return a set of string values and store them for furthur use.</p>\n"},{"tags":["multithreading","wcf","postgresql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13263546,"title":"Multi-threaded WCF with PosgreSQL","body":"<p>I'm pretty new in WCF. My WCF-service should work as a wrapper between clients and database, and also I wanted my WCF-service to handle over 100 connetions simultaneously.\nFor that I use PerSession InstanceContextMode and Multiple ConcurrencyMode:</p>\n\n<pre><code>[ServiceBehavior(InstanceContextMode = InstanceContextMode.PerSession, ConcurrencyMode = ConcurrencyMode.Multiple)]\n    public class Service:IService\n    {\n\n       public MyType_1 GetData(MyType_2  value)\n       {\n           ... query to database ....\n           return new MyType_1 { result }\n       }\n    }\n</code></pre>\n\n<p>Service works fine and handles more than 100 connections, shows reasonable results when transfer more than 5mb of data simultaneously.</p>\n\n<p>The problem is that I have to use PostgreSQL on Windows, and I'm not allowed to make more than 30 connections (in other words I'm not allowed to make more than 30 client sessions). I think it's some kind of an operations system limitation, beacause PostgreSQL on Windows creates a new process on each client conneciton, so more than 30 processes created be one - it's not what I'm looking for.</p>\n\n<p>It's seems to me that there is only one reasonable way to solve the problem - add ability for my wcf-service to handle only one connection to database in the background, but how can I do that? And how can other session threads safety work with that?</p>\n\n<p>Any ideas will be appreciated! :)</p>\n"},{"tags":["java","multithreading","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13263409,"title":"Need clarification in Parallel Processing","body":"<p>For example if I use <strong>dual core processor</strong> and write a java program <strong>without</strong> using <strong>threads</strong>. Does it mean the program <strong>execution</strong> is <strong>sequential</strong> and it will only <strong>use  single core</strong> among the dual?</p>\n\n<hr>\n\n<p>For example if I use <strong>dual core processor</strong> and write a java program  <strong>using threads</strong> and synchronisation. Does it mean the program <strong>execution</strong> is <strong>parallel</strong> and it will <strong>use all available cores</strong>(in this case two cores)?</p>\n\n<p>If my reasoning is totally wrong then , what is the <strong>relation</strong> between <strong>threading,cores</strong> and <strong>parallelism</strong>?</p>\n"}]}
{"total":30059,"page":2,"pagesize":100,"questions":[{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":13263079,"title":"run two thread at the same time in java","body":"<p>i have used timertask to schedule my java program. now when the run method of timertask is in process, i want to run two threads which run at the same time and do different functions. here is my code.. please help me..</p>\n\n<pre><code>import java.util.Calendar;\nimport java.util.Date;\nimport java.util.Timer;\nimport java.util.TimerTask;\n\npublic class timercheck extends TimerTask{\n// my first thread\nThread t1 = new Thread(){\n     public void run(){\n        for(int i = 1;i &lt;= 10;i++)\n        {\n            System.out.println(i);\n        }           \n     }\n };\n\n// my second thread\nThread t2 = new Thread(){\n     public void run(){\n        for(int i = 11;i &lt;= 20;i++)\n        {\n            System.out.println(i);\n        }           \n     }\n };\n\npublic static void main(String[] args){\n      long ONCE_PER_DAY = 1000*60*60*24;\n\n     Calendar calendar = Calendar.getInstance();\n     calendar.set(Calendar.HOUR_OF_DAY, 12);\n     calendar.set(Calendar.MINUTE, 05);\n     calendar.set(Calendar.SECOND, 00);\n     Date time = calendar.getTime();\n\n     TimerTask check  = new timercheck();\n     Timer timer = new Timer();\n     timer.scheduleAtFixedRate(check, time ,ONCE_PER_DAY);\n}\n\n@Override    \n// run method of timer task\npublic void run() {\n    t1.start();\n    t2.start();\n}\n}\n</code></pre>\n"},{"tags":["java","multithreading","sockets","objectoutputstream"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":926,"score":1,"question_id":10775709,"title":"java.io.StreamCorruptedException: invalid type code: 00","body":"<p>So basically im writing a client-server multiplayer game.\nI have a SeverCommunicationThread that creates a gameThread if he receives a RequestForGame creates a gameThread. \nWhen i send a RequestForGame exception is thrown java.io.StreamCorruptedException: invalid type code: 00\nI assume it's because both threads try to read the same ObjectInputStream, I don't have much understanding about how it works, i just know how to use it. Could you help me understand what's the problem and how to fix it?\nThanks :)</p>\n\n<pre><code>public class ServerCommunicationThread extends Thread{\nprivate Socket connectionSocket;\nprivate ObjectInputStream inFromClient;\nprivate ObjectOutputStream outToClient;\nprivate String nickname;\nprivate ServerModelManager model;\n\n\npublic ServerCommunicationThread(Socket connectionSocket,\n        ServerModelManager model) throws IOException {\n    this.connectionSocket = connectionSocket;\n    inFromClient = new ObjectInputStream(connectionSocket.getInputStream());\n    outToClient = new ObjectOutputStream(connectionSocket.getOutputStream());\n    this.model = model;\n    start();\n\n}\n\npublic void run() {\n    try {\n        String nickname = (String) inFromClient.readObject();\n        if (model.exists(nickname)){\n            System.out.println(nickname + \" already exists\");\n            outToClient.writeObject(new MessageForClient(\"Please choose another nickname\"));\n        }\n        else\n        {\n            System.out.println(nickname + \" connected, adding to list\");\n            model.addClient(nickname, connectionSocket,outToClient,inFromClient);\n            this.nickname=nickname;\n        }\n        while(true){\n            Object o= inFromClient.readObject();//StreamCorruptedexception\n            if(o instanceof RequestForGame)\n            {\n                RequestForGame r=(RequestForGame)o;\n                String userToPlayWith=r.getUserToPlayWith();\n                if(userToPlayWith.equals(nickname))\n                {\n                    String message=\"Playing with yourself makes your palms hairy, choose another opponent\";\n                    outToClient.writeObject(message);\n                }\n                else\n                {\n                System.out.println(\"received request to play with \"+userToPlayWith+\". starting game\");\n                ClientRepresentative client1=model.getClient(nickname);\n                ClientRepresentative client2=model.getClient(userToPlayWith);\n                ServerGameThread s=new ServerGameThread(client2,client1,client2.getInStream(),client1.getInStream(),client1.getOutStream(),client2.getOutStream());\n                }\n            }\n            else if(o instanceof String)\n            {\n                String s=(String) o;\n                if(s.equals(\"i want to quit\"))\n                {\n                    model.deleteClient(nickname);\n                    inFromClient.close();\n                    String q=\"quit\";\n                    outToClient.writeObject(q);\n                    connectionSocket.close();\n                    System.out.println(nickname+\"has quit without exc\");\n                }\n            }\n        }\n    } catch (EOFException e) {\n        System.out.println(nickname+\" has quit\");\n    }\n    catch (SocketException e)\n    {\n        System.out.println(nickname+\" has quit\");\n    }\n\n    catch (Exception e) {\n\n        e.printStackTrace();\n    }\n}\n\n}\n public class ServerGameThread extends Thread {\n\nprivate ClientRepresentative client1,client2;\nprivate ObjectInputStream inFromClient1,inFromClient2;\nprivate ObjectOutputStream outToClient1,outToClient2;\nprivate Field gameField; \npublic ServerGameThread(ClientRepresentative client1, ClientRepresentative client2,ObjectInputStream inFromClient1,ObjectInputStream inFromClient2,ObjectOutputStream outToClient1,ObjectOutputStream outToClient2)\n{\n    System.out.println(\"startin game thred\");\n    this.client1=client1;//client 1 goes first\n    this.client2=client2;//client 2 started game\n\n\n        this.inFromClient1=inFromClient1;\n        this.inFromClient2=inFromClient2;\n        this.outToClient1=outToClient1;\n        this.outToClient2=outToClient2;\n\n\n        gameField=new Field();\n        System.out.println(\"check\");\n        start();\n}\npublic void run()\n{\n    System.out.println(\"Starting game. players: \"+client1.getNickname()+\";\"+client2.getNickname());\n    try {\n        outToClient1.writeObject(gameField);\n        outToClient2.writeObject(gameField);\n        while(true)\n        {\n            try {\n                System.out.println(\"listening to \"+client1.getNickname());\n                Object o1=inFromClient1.readObject();//read move from client 1.**//StreamCorruptedexception**\n\n                while(!(o1 instanceof PlayerMove))\n                {\n                    o1=inFromClient1.readObject();//read move from client 1.\n                }\n                PlayerMove move1=(PlayerMove)o1;\n                System.out.println(\"received move \"+move1+\" sending to \"+client2.getNickname());\n                outToClient2.writeObject(move1);\n                System.out.println(\"listening to \"+client2.getNickname());\n                Object o2=inFromClient2.readObject();//read move from client 1.\n                while(!(o2 instanceof PlayerMove))\n                {   \n                    o2=inFromClient2.readObject();//read move from client 1.\n                }\n                PlayerMove move2=(PlayerMove)o2;\n                System.out.println(\"received move \"+move2+\" sending to \"+client1.getNickname());\n                outToClient1.writeObject(move2);\n            }\n                catch (ClassNotFoundException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n    } catch (IOException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n\n}\n}    \n</code></pre>\n\n<p>the model.addClient method though i don't think the problem is here</p>\n\n<pre><code>  public void addClient(String nickname, Socket       clientSocket,ObjectOutputStream stream,ObjectInputStream inStream)\n{\n    clients.addClient(nickname, clientSocket,stream,inStream);//add to arraylist\n//send client list to all clients\n    String[] users=this.getAvailableClients();\n    ObjectOutputStream[] streams=clients.getOutStreams();\n    for(int i=0;i&lt;streams.length;i++)\n    {\n        try {\n            streams[i].writeObject(users);\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>The client side proxy that sends objects to server, the methods are triggered by user actions in GUI</p>\n\n<pre><code>  public class Proxy {\nfinal int PORT = 1337;\nString host;\nString nickname;\nprivate Socket clientSocket;\nprivate ObjectOutputStream outToServer;\nprivate ObjectInputStream inFromServer;\nprivate ClientModelManager manager;\npublic Proxy(String nickname,String host,ClientModelManager manager)\n{\n    this.nickname=nickname;\n    this.host=host;\n    this.manager=manager;\n    this.connect(nickname);\n}\npublic void connect(String nick)\n{\n    Socket clientSocket;\n    try {\n        clientSocket = new Socket(host, PORT);\n        System.out.println(\"client socket created\");\n        outToServer = new ObjectOutputStream(clientSocket.getOutputStream());\n        inFromServer=new ObjectInputStream(clientSocket.getInputStream());\n        outToServer.flush();\n        outToServer.writeObject(nick);\n        ClientReceiverThread t=new ClientReceiverThread(inFromServer,manager);\n        t.start();\n    } catch (Exception e) {\n        e.printStackTrace();\n    } \n}\npublic void makeRequest(String user)\n{\n    try\n    {\n    outToServer.writeObject(new RequestForGame(user));\n    }\n    catch(IOException e)\n    {\n        e.printStackTrace();\n    }\n}\npublic void quit()\n{\n    try {\n        outToServer.writeObject(new String(\"i want to quit\"));\n        //clientSocket.close();\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\npublic void sendMove(PlayerMove move)\n{\n    try {\n        outToServer.writeObject(move);\n    } catch (IOException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c","multithreading","sqlite","bots","irc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":13262528,"title":"creating a basic shell in C for an IRC bot with another thread running in the background","body":"<p>At the moment I have a very simple IRC bot written in C.  When I run it, it sets up the connection and joins the specified channel.  All the connection details are hard-coded, but this is not an issue.</p>\n\n<p>What I want to do is have a basic shell run at the same time, meaning the loop I currently have to receive text from the IRC channel and parse it is running in a thread in the background.  From this shell, I want to be able to run commands that may send messages to the IRC channel, or may terminate the program gracefully (meaning both threads will need to be closed).  This shell is not meant to be any kind of job control shell.</p>\n\n<p>The primary point of this bot is to monitor the channel for any URLs posted and store them in an SQLite database.  People in the IRC channel will then be able to search the database for particular URLs.  I also want to be able to perform various database commands from the shell, such as search, but also manual insertions and deletions.  I mention this because I assume I will need to ensure all database access is thread-safe.  Also, ideally, I'd prefer insertions to database to be prioritised over searching, but this is practically last on my list of requirements.</p>\n\n<p>Finally, there is the chance that some commands received from the IRC channel could be spawned off into their own threads.  This could be because they are accessing the database, something which definitely has the potential to be less than instant, but also because they are calling a method to block the thread for a period of time to stagger the transmission of messages to the channel.</p>\n\n<p>This is what I'm asking:</p>\n\n<ul>\n<li>How do I go about setting up this sort of program? What sort of structure do I need to run two main threads at once and potentially pass messages between the two?</li>\n<li>Does access to the socket used for communicating to the IRC channel need to be thread-safe?</li>\n<li>How should I go about making the program thread-safe? Will mutex suffice?</li>\n</ul>\n\n<p>If it matters, the program will almost certainly be running on an Ubuntu Server distribution.</p>\n"},{"tags":["c#",".net","multithreading","architecture","software-engineering"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13261769,"title":"Best architecture to set a realtime logging window to write from different threads like output window in visualstudio","body":"<p>I am designing an application and it runs different components each on a different thread. I need a way to report back to the user interface the state of those components and the tasks they complete and if any errors occurred. My first approach was to write from all the different components to a log file. And then I monitored that file for changes, to reload the changes in a text box (my output window). However I noticed that using file monitor does not perform very well, and it slows downs the component threads and their tasks. So I was thinking to create something like the output windows in vs2010, where they can log any data while debugging, it seems to be very efficient, and can hold a lot of data. Any ideas what would be the best approach? One important fact, is that there should be a way to communicate all the component threads with the logging output window, to display results, avoid collisions, etc. I am using .NET 4.0</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13261869,"title":"Threads: Retrieving then executing object from ArrayList","body":"<p>I am working with threads and need to first retrieve an object from a collection and then execute the method in that object.  I used the ArrayList.get(0) to retrieve the first element, but now how do I execute the run() method for my Runnable object that I just retrieved?</p>\n\n<p>Here is my code so far:</p>\n\n<pre><code>public class MyThread extends Thread{\n\n//Instance Variables\nprivate List&lt;Runnable&gt; requestQueue;\n\n//Constructor\npublic MyThread() {\n    requestQueue = new LinkedList&lt;Runnable&gt;();\n}\n\n//Methods\npublic void run() {\n    while (!requestQueue.isEmpty()) { \n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        requestQueue.get(0);\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c++","multithreading","gcc","c++11"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":104,"score":3,"question_id":13227526,"title":"C++11 Thread not working","body":"<p>My programs looks like below</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;exception&gt;\n\nvoid hello()\n{\n    std::cout &lt;&lt; \"Hello world!!!!\" &lt;&lt; std::endl;\n}\n\nint main()\n{\n    std::cout &lt;&lt; \"In Main\\n\";\n    std::thread t(hello);\n    t.join();\n    return 0;\n}\n</code></pre>\n\n<p>When I compile it using the following command I get no errors</p>\n\n<pre>g++-4.7 -std=c++11 main.cpp</pre>\n\n<p>But when I run it I get the following error</p>\n\n<pre>\nIn Main\nterminate called after throwing an instance of 'std::system_error'\nwhat():  Operation not permitted\nAborted (core dumped)\n</pre>\n\n<p>Could someone help me with where I am going wrong?</p>\n"},{"tags":["python","multithreading","python-multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13260589,"title":"How execute 3 function on 4 threads using Python?","body":"<p>I have 3 function and want execute each on new thread using Python</p>\n\n<p>Each function just a math operations.</p>\n\n<p>I need to start each function in each core of process. In Java it's look like:</p>\n\n<pre><code>Thread threadF1 = new Thread(f1);\nThread threadF2 = new Thread(f2);\nThread threadF3 = new Thread (f3);\n\nthreadF1.start();\nthreadF2.start();\nthreadF3.start();\n</code></pre>\n\n<p>And if i have 4 cores my program uses 75% of CPU.</p>\n\n<p>I wrote this in Python:</p>\n\n<pre><code> thread = Thread(target = F1, args=(N,))\n thread.start()\n\n thread2 = Thread(target = F2, args=(N,))\n thread2.start()\n\n thread3 = Thread(target = F3, args=(N,))\n thread3.start()\n</code></pre>\n\n<p>but it uses just 25%. How force working code in Python using 3/4 cores?</p>\n"},{"tags":["c++","multithreading","block"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13260777,"title":"Thread is blocking whole program","body":"<p>I'm trying to make a multiclient server. I have this thread:</p>\n\n<pre><code>void client_thread(int new_socket)\n{\n    int size;\n    char inbuffer[BUF];\n\n    do\n    {\n        cout &lt;&lt; \"Waiting for messages: \" &lt;&lt; endl;\n        size = recv(new_socket, inbuffer, BUF, 0);\n    } while (true);\n}\n</code></pre>\n\n<p>and this main procedure:</p>\n\n<pre><code>int main()\n{\n    while (true)\n    {\n        //waiting for clients\n        cout &lt;&lt; \"Waiting for connections...\" &lt;&lt; endl;\n        new_socket = accept ( create_socket, (struct sockaddr *) &amp;cliaddress, &amp;addrlen );\n\n        //new client connected\n        if (new_socket &gt; 0)\n        {\n            //start thread\n            thread(client_thread, new_socket).join();\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>When the first client connects, the thread starts and the server is waiting for messages from him. But the server doesn't wait for new clients anymore. I don't know why. Is it because of the infinite <code>do-while</code> loop inside the thread-function? What's the point of threads if they block your whole program if they contain infinite loops?</p>\n"},{"tags":["c++","multithreading","qt","qnetworkaccessmanager"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":13259068,"title":"im doing something wrong with QNetworkAccessManager thread request (the threads never get free)","body":"<p>i know that in version 4.8 each http request gets its own thread to run ,<br>\nim doing links checker app that doing allot of http request in while loop<br>\ni notice in the windows task manager that my app is using more then 1600 threads over time \nand the number never gos down only up until its crash the app . ( i guessing it is the couse )\nmy question is does QNetworkAccessManager has option to use thread pool ?<br>\nor it has option to clean its thread after it finish its http request?  </p>\n\n<p>this is the main loop :</p>\n\n<pre><code>while(!rpm_urlStack-&gt;isEmpty())\n{\n    QString url = rpm_urlStack-&gt;top();\n    rpm_urlStack-&gt;pop();\n\n    QString urlForReq(url);\n\n    bool returnVal = true;\n    QNetworkRequest request;\n\n    request.setUrl(QUrl(urlForReq));\n    request.setRawHeader(\"User-Agent\", USER_AGENT.toUtf8());\n    request.setRawHeader(\"Accept-Charset\", \"ISO-8859-1,utf-8;q=0.7,*;q=0.7\");\n    request.setRawHeader(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\");\n    request.setRawHeader(\"Accept-Language\", \"en-us,en;q=0.5\");\n    request.setRawHeader(\"Connection\", \"Keep-Alive\");\n\n    QEventLoop loop;\n    reply = m_networkManager-&gt;get(request);\n    connect(reply, SIGNAL(finished()), &amp;loop, SLOT(quit()));\n    loop.exit();\n\n    if(!loop.isRunning()) {\n        loop.exec();\n    }\n\n    RequestFinishedHandler(reply);\n}\n\nRequestFinishedHandler(QNetworkReply *reply)\n{\n    if (reply-&gt;error() &gt; 0) {\n        QNetworkReply::NetworkError networkError = reply-&gt;error();\n        QString err = reply-&gt;errorString();\n\n    } else {\n        QVariant vStatusCodeV = reply-&gt;attribute(QNetworkRequest::HttpStatusCodeAttribute);\n        QMutexLocker lock(_pMutex); // _pMutex defined as class member\n        char *buffer;\n        buffer = getCurrentDateTime();\n        QTextStream out(m_file);\n        out &lt;&lt; buffer &lt;&lt;\"  \"&lt;&lt; _sCurrentUrl &lt;&lt; \"\\n\";\n        lock.unlock();\n\n        if(vStatusCodeV.toInt() == 200) {\n            QString ApiResponse;\n            QByteArray data;\n            data=reply-&gt;readAll();\n            ApiResponse.append(QString::fromUtf8(data));\n        }\n    }\n\n    reply-&gt;deleteLater();\n}\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13260322,"title":"how to use .NET Action to execute a method with unknown number of parameters?","body":"<p>Certaintly this is a dumb and basic question but i i'm trying to figure out how this works. </p>\n\n<p>What i want to achieve is to execute some operations on a worker thread while displaying a progress bar to the user. I've created a class </p>\n\n<pre><code>public class ProgressBar\n\n {\n   public void StartAsyncTask(Action action)\n    {\n      Task t = new Task(action);\n      t.start();\n    }\n }\n</code></pre>\n\n<p>I found out that i can send any  method to the StartAsyncTask in the following way:</p>\n\n<pre><code>      ProgressBar pb = new ProgressBar();\n      pb.StartAsyncTask( () =&gt; DoSomething(15, \"something\"));\n\n\n      public void DoSomething(int i, string s)\n       {\n          //do something\n       }\n</code></pre>\n\n<p>First of all, i can't seem to understand what is and how is lambda () => expression translated and how is the Action object passed a delegate with an unknown number of parameters. </p>\n\n<p>I would like to use a </p>\n\n<pre><code>    BackgroundWorker \n</code></pre>\n\n<p>with my ProgressBar but in this case i would need to invoke the action. So something like this:</p>\n\n<pre><code>    void m_backgroundWorker_DoWork(object sender, DoWorkEventArgs e)\n    {\n        Action action = e.Argument as Action; //same action here passed through EventArgs\n       //but already in a worker thread so no need for the Task object \n\n\n       //and now i need to somehow invoke the action object but i don't know what the parameters are. \n\n       action.Invoke( ? ); \n\n        }\n</code></pre>\n\n<p>How is it possible in the first example to execute the action without knowing the parameters in </p>\n\n<pre><code>         StartAsyncTask(Action action) method. \n</code></pre>\n\n<p>Why do i need to know the parameters when invoking the action in this case? </p>\n\n<p>Everything about how/why/when to use \"Action\" is pretty unclear to me even if i read msdn documentation and some other threads here on stackoverflow. \nAny information on this will help me.</p>\n\n<p>Thank you,\nDan</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12470991,"title":"Know Thread Count","body":"<p>i have developed application which uses threads to finish the task and i want to close the running application in middle of the process its closes but thread is running in background. </p>\n\n<p>now i want to show active threads by which my application is created. but difficulty is, when i start the application from vs threads are shown in task manager like 14-19 threads without running the application.</p>\n\n<p>can u tell me to display only those threads which is created by my application and not by system.</p>\n"},{"tags":["android","multithreading","progress-bar","progressdialog"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6910,"score":1,"question_id":2596390,"title":"Android ProgressDialog Progress Bar doing things in the right order","body":"<p>I just about got this, but I have a small problem in the order of things going off.\nSpecifically, in my thread() I am setting up an array that is used by a Spinner.  Problem is the Spinner is all set and done basically before my thread() is finished, so it sets itself up with a null array.</p>\n\n<p>How do I associate the spinners ArrayAdapter with an array that is being loaded by another thread?</p>\n\n<p>I've cut the code down to what I think is necessary to understand the problem, but just let me know if more is needed.  The problem occurs whether or not refreshData() is called.</p>\n\n<p>Along the same lines, sometimes I want to call loadData() from the menu.  Directly following loadData() if I try to fire a toast on the next line this causes a forceclose, which is also because of how I'm implementing ProgressDialog.</p>\n\n<p>THANK YOU FOR LOOKING</p>\n\n<pre><code>public class CMSHome extends Activity { \n\nprivate static List&lt;String&gt; pmList = new ArrayList&lt;String&gt;();\n\n// Instantiate helpers\nPMListHelper plh = new PMListHelper();\nProjectObjectHelper poc = new ProjectObjectHelper();\n\n// These objects hold lists and methods for dealing with them\nprivate Employees employees;\nprivate Projects projects;\n\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.main);\n\n    // Loads data from filesystem, or webservice if necessary\n    loadData();\n\n    // Capture spinner and associate pmList with it through ArrayAdapter\n    spinner = (Spinner) findViewById(R.id.spinner);\n    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(\n                    this, android.R.layout.simple_spinner_item,\n                    pmList);\n    adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\n    spinner.setAdapter(adapter);\n\n    //---the button is wired to an event handler---\n    Button btn1 = (Button)findViewById(R.id.btnGetProjects);\n    btn1.setOnClickListener(btnListAllProjectsListener);\n    spinner.setOnItemSelectedListener(new MyOnItemSelectedListener());\n}\n\n\nprivate void loadData()\n{\n    final ProgressDialog pd = ProgressDialog.show(this,\n            \"Please wait\", \"Loading Data...\", true, false);\n\n    new Thread(new Runnable(){\n        public void run(){\n            employees = plh.deserializeEmployeeData();\n            projects = poc.deserializeProjectData();\n\n            // Check to see if data actually loaded, if not then refresh\n            if ((employees == null) || (projects == null)) {\n                refreshData();\n            }\n\n            // Load up pmList for spinner control\n            pmList = employees.getPMList();\n\n            pd.dismiss();\n        }\n    }).start();\n}\n\nprivate void refreshData()\n{\n    // Refresh data for Projects\n    projects = poc.refreshData();\n    poc.saveProjectData(mCtx, projects);\n\n    // Refresh data for PMList          \n    employees = plh.refreshData();\n    plh.savePMData(mCtx, employees);\n}\n}\n</code></pre>\n\n<p>&lt;----  EDIT  ----->\nI tried changing onCreate() to the following after Jims suggestion.  Not sure if I did this right, still doesn't work:</p>\n\n<pre><code>@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.main);\n\n    mCtx = this;\n\n    // Loads data from filesystem, or webservice if necessary\n    // Would like to extend this to update if files are over x days old\n    final ProgressDialog pd = ProgressDialog.show(this,\n            \"Please wait\", \"Loading Data...\", true, false);\n\n    new Thread(new Runnable(){\n        public void run(){\n            employees = plh.deserializeEmployeeData();\n            projects = poc.deserializeProjectData();\n\n            // Check to see if data actually loaded, if not then refresh\n            if ((employees == null) || (projects == null)) {\n                refreshData();\n            }\n\n            pd.dismiss();\n\n            runOnUiThread(new Runnable() {\n                public void run(){\n                    // Load up pmList for spinner control\n                    pmList = employees.getPMList();\n                }\n            });\n\n        }\n    }).start();\n\n    spinner = (Spinner) findViewById(R.id.spinner);\n    ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(\n            this, android.R.layout.simple_spinner_item, pmList);\n    adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\n    spinner.setAdapter(adapter);\n\n    //---the button is wired to an event handler---\n    Button btn1 = (Button)findViewById(R.id.btnGetProjects);\n    btn1.setOnClickListener(btnListAllProjectsListener);\n    spinner.setOnItemSelectedListener(new MyOnItemSelectedListener());\n}\n</code></pre>\n\n<hr>\n\n<p>Wow, this took forever for me to find a solution, but Im overjoyed to have finally gotten this to work.</p>\n\n<p>Updating the Spinner with a background thread can be accomplished by utilizing a handler.  The handler is called after the main work of the thread is completed.</p>\n\n<pre><code>  mProgressDlg = ProgressDialog.show(this, \"App_Name\", \"Loading data...\", \n                                    true, false);\n  new Thread(new Runnable(){\n            public void run() {\n                    /*Load Data, set pmList in my case*/\n                    mProgressDlg.dismiss();\n                    hRefresh.sendEmptyMessage(REFRESH);\n            }\n    }).start();\n\n\n\nHandler hRefresh = new Handler(){\n\n@Override\npublic void handleMessage(Message msg) {\n   switch(msg.what){\n     case REFRESH:\n                 spinner = (Spinner) findViewById(R.id.spinner);\n                 final ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(\n                         mCtx, android.R.layout.simple_spinner_item, pmList);\n                 adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\n                 spinner.setAdapter(adapter);\n                 spinner.setOnItemSelectedListener(new MyOnItemSelectedListener());\n            break;\n   }\n}\n};\n</code></pre>\n\n<p>Credit to bhatt4982 and his answer on <a href=\"http://stackoverflow.com/questions/1458190/how-can-i-display-a-progress-at-start-up-application-in-android\">this thread</a></p>\n"},{"tags":["multithreading","ffmpeg","h.264"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2953,"score":2,"question_id":7379980,"title":"Thread count option in FFmpeg for FASTEST conversion to h264?","body":"<p>I need to <strong>maximize speed</strong> while converting videos using FFmpeg to h264</p>\n\n<ul>\n<li><strong>Any input format</strong> of source videos</li>\n<li>User's machine can have <strong>any number of cores</strong></li>\n<li>Power and memory consumption are non-issues</li>\n</ul>\n\n<p>Of course, there are a whole bunch of options that can be tweaked but this question is particularly about choosing the best <strong><code>-thread &lt;count&gt;</code></strong> option. I am trying to find an ideal thread count as a function of</p>\n\n<ul>\n<li>no. of cores</li>\n<li>input video format</li>\n<li>h264-friendly values maybe?</li>\n<li>anything else missed above?</li>\n</ul>\n\n<p>I am aware the default <code>-thread 0</code> follows one-thread-per-core approach which is supposed to be optimal. But I am not sure if this is time or space-optimized. Also, on certain testcases, I've seen more threads (say 4 threads on my dual core test machine) finishes quicker than the default.</p>\n\n<p>Any other direction, say configure options w.r.t. threads, worth pursuing?</p>\n"},{"tags":["python","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3638,"score":5,"question_id":1635080,"title":"Terminate a multi-thread python program","body":"<p>How to make a multi-thread python program response to Ctrl+C key event?</p>\n\n<p><strong>Edit:</strong> The code is like this:</p>\n\n<pre><code>import threading\ncurrent = 0\n\nclass MyThread(threading.Thread):\n    def __init__(self, total):\n        threading.Thread.__init__(self)\n        self.total = total\n\n    def stop(self):\n        self._Thread__stop()\n\n    def run(self):\n        global current\n        while current&lt;self.total:\n            lock = threading.Lock()\n            lock.acquire()\n            current+=1\n            lock.release()\n            print current\n\nif __name__=='__main__':\n\n    threads = []\n    thread_count = 10\n    total = 10000\n    for i in range(0, thread_count):\n        t = MyThread(total)\n        t.setDaemon(True)\n        threads.append(t)\n    for i in range(0, thread_count):\n        threads[i].start()\n</code></pre>\n\n<p>I tried to remove join() on all threads but it still doesn't work. Is it because the lock segment inside each thread's run() procedure?</p>\n\n<p><strong>Edit:</strong> The above code is supposed to work but it always interrupted when current variable was in 5,000-6,000 range and through out the errors as below</p>\n\n<pre><code>Exception in thread Thread-4 (most likely raised during interpreter shutdown):\nTraceback (most recent call last):\n  File \"/usr/lib/python2.5/threading.py\", line 486, in __bootstrap_inner\n  File \"test.py\", line 20, in run\n&lt;type 'exceptions.TypeError'&gt;: unsupported operand type(s) for +=: 'NoneType' and 'int'\nException in thread Thread-2 (most likely raised during interpreter shutdown):\nTraceback (most recent call last):\n  File \"/usr/lib/python2.5/threading.py\", line 486, in __bootstrap_inner\n  File \"test.py\", line 22, in run\n</code></pre>\n"},{"tags":["java","multithreading","aop","aspectj","executorservice"],"answer_count":7,"favorite_count":2,"up_vote_count":26,"down_vote_count":0,"view_count":713,"score":26,"question_id":4544128,"title":"How can I make external methods interruptable?","body":"<h2>The Problem</h2>\n\n<p>I'm running multiple invocations of some external method via an <a href=\"http://download.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/ExecutorService.html\" rel=\"nofollow\">ExecutorService</a>. I would like to be able to interrupt these methods, but unfortunately they do not check the interrupt flag by themselves. Is there any way I can force an exception to be raised from these methods?</p>\n\n<p>I am aware that throwing an exception from an arbitrary location is <a href=\"http://download.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html\" rel=\"nofollow\">potentially dangerous</a>, in my specific case I am willing to take this chance and prepared to deal with the consequences.</p>\n\n<h2>Details</h2>\n\n<p>By \"external method\" I mean some method(s) that come from an external library, and I cannot modify its code (well I can, but that will make it a maintenance nightmare whenever a new version is released).</p>\n\n<p>The external methods are computationally expensive, not IO-bound, so they don't respond to regular interrupts and I can't forcefully close a channel or a socket or something. As I've mentioned before, they also do not check the interrupt flag.</p>\n\n<p>The code is conceptually something like:</p>\n\n<pre><code>// my code\npublic void myMethod() {\n    Object o = externalMethod(x);\n}\n\n// External code\npublic class ExternalLibrary {\n    public Object externalMethod(Object) {\n        innerMethod1();\n        innerMethod1();\n        innerMethod1();\n    }\n\n    private void innerMethod1() {\n        innerMethod2();\n        // computationally intensive operations\n    }\n\n    private void innerMethod2() {\n        // computationally intensive operations\n    }\n}\n</code></pre>\n\n<h2>What I've Tried</h2>\n\n<p><a href=\"http://download.oracle.com/javase/1.5.0/docs/api/java/lang/Thread.html#stop%28%29\" rel=\"nofollow\"><code>Thread.stop()</code></a> will theoretically do what I want, but not only is it deprecated but it is also only available for actual threads, while I'm working with executor tasks (which might also share threads with future tasks, for example when working in a thread pool). Nevertheless, if no better solution is found, I will convert my code to use old-fashioned Threads instead and use this method.</p>\n\n<p>Another option I've tried is to mark <code>myMethod()</code> and similar methods with a special \"Interruptable\" annotation and then use AspectJ (which I am admittedly a newbie at) for catching all method invocations there - something like:</p>\n\n<pre><code>@Before(\"call(* *.*(..)) &amp;&amp; withincode(@Interruptable * *.*(..))\")\npublic void checkInterrupt(JoinPoint thisJoinPoint) {\n    if (Thread.interrupted()) throw new ForcefulInterruption();\n}\n</code></pre>\n\n<p>But <code>withincode</code> isn't recursive to methods called by the matching methods, so I would have to edit this annotation into the external code.</p>\n\n<p>Finally, this is similar to <a href=\"http://stackoverflow.com/questions/3178706/how-to-write-interruptable-methods\">a previous question of mine</a> - though a notable difference is that now I'm dealing with an external library.</p>\n"},{"tags":["python","multithreading","mutex","shared-memory"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":39,"score":3,"question_id":13256735,"title":"Mutex appropriate for fast single writer / slow readers (cpython)?","body":"<p>In my application, I have one single thread that is performing very fast processing on log lines to produce a float value. There is usually only a single other thread performing slow reads on the values at intervals. Every so often, other threads can come and go and also perform once-off reads on those values.</p>\n\n<p>My question is about the necessity of a mutex (in cpython), for this specific case where the data is simply the most recent data available. It is not a critical value that must be in sync with anything else (or even the other fields being written at the same time). Just simply... what the value is when it is.</p>\n\n<p>That being said, I know I could easily add a lock (or a readers / write lock) to guard the update of the value, but I wonder if the overhead of the acquire/release in rapid succession for the course of an entire log (lets say average 5000 lines) is not worth it just to do shared resources \"appropriately\".</p>\n\n<p>Based on the docs on <a href=\"http://docs.python.org/2/faq/library#what-kinds-of-global-value-mutation-are-thread-safe\" rel=\"nofollow\">What kinds of global value mutation are thread-safe?</a>, these assignments should be atomic operations.</p>\n\n<p>Here is a basic example of the logic:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import time\nfrom random import random, choice, randint\nfrom threading import Thread \n\nclass DataStructure(object):\n    def __init__(self):\n        self.f_val = 0.0\n        self.s_val = \"\"\n\ndef slow_reader(data):\n    \"\"\" \n    Loop much more slowly and read values \n    anywhere between 1 - 5 second intervals\n    \"\"\"\n    for _ in xrange(10):\n\n        f_val = data.f_val \n        # don't care about sync here\n        s_val = data.s_val\n\n        print f_val, s_val\n\n        # in real code could be even 30 or 60 seconds\n        time.sleep(randint(1,3))\n\ndef fast_writer(data):\n    \"\"\" Update data extremely often \"\"\"\n    for _ in xrange(20000):\n        f_val, s_val = do_work()\n\n        data.f_val = f_val\n        # don't care about sync here\n        data.s_val = s_val \n\n\nFLOAT_SRC = [random()*100 for _ in xrange(100)]\nSTR_SRC = ['foo', 'bar', 'biz', 'baz']\n\ndef do_work():\n    time.sleep(0.001)\n    return choice(FLOAT_SRC), choice(STR_SRC)\n\n\nif __name__ == \"__main__\":\n\n    data = DataStructure()\n\n    threads = [\n        Thread(target=slow_reader, args=(data,)),\n        Thread(target=fast_writer, args=(data,)),\n    ]\n\n    for t in threads:\n        t.daemon=True\n        t.start()\n\n    for t in threads:\n        t.join()\n</code></pre>\n\n<p>This represents the fast log parser (actually being read via a PIPE) doing work on each line, and a slow periodic reader grabbing whatever are the current values at that moment. At any time, another once-read thread could come and go to grab those same values from the data structure.</p>\n\n<p>Is this a situation where a mutex in cpython is not needed at all?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>To clarify a bit more... I don't even need the float and string fields to be in sync from the last write. It is ok if the scheduler decides to switch contexts between the float and string reads. I'm just wondering if I even need the overhead of a lock to simply read whatever value is assigned at any moment in time.</p>\n\n<p>My concern is regarding the fact that the writer is going to be looping, on an extremely fast operating, locking and unlocking a lock that is often un-contended.</p>\n\n<p>Effectively assume this is all I care about in the <code>reader</code>:</p>\n\n<pre><code>def slow_reader(data):\n    for _ in xrange(10):\n        f_val = data.f_val \n        print f_val\n        time.sleep(randint(1,3))\n</code></pre>\n"},{"tags":["java","multithreading","runtime"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":67,"score":1,"question_id":13256188,"title":"Quit Java Program After all Threads Have Completed","body":"<p>I have a password saving program that saves passwords to a text file. The user can add or delete passwords and the data will be re-written to the text file. To prevent the program from being really slow, I create a new thread every time the program needs to save. I have a class that extends Thread and will write all data to the text file specified. The problem I am having is when I try to save all data before the user wants to quit. When the quit button is pressed I create a new thread to save the data and then call the System.exit() function to quit.</p>\n\n<pre><code>Thread t = new SaveThread();\nt.start();\nSystem.exit(0);\n</code></pre>\n\n<p>I have noticed that the program will quit before the thread completes. Is there any way that I can tell java to only quit when my thread has stopped running?</p>\n"},{"tags":["asp.net","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":286,"score":8,"question_id":8109526,"title":"The cross-thread usage of \"HttpContext.Current\" property and related things","body":"<p>I read from &lt; Essential ASP.NET with Examples in C# > the following statement:</p>\n\n<blockquote>\n  <p>Another useful property to know about is the static Current property\n  of the HttpContext class. This property always points to the current\n  instance of the HttpContext class for the request being serviced. This\n  can be convenient if you are writing helper classes that will be used\n  from pages or other pipeline classes and may need to access the\n  context for whatever reason. By using the static Current property to\n  retrieve the context, you can avoid passing a reference to it to\n  helper classes. For example, the class shown in Listing 4-1 uses the\n  Current property of the context to access the QueryString and print\n  something to the current response buffer. <strong>Note that for this static\n  property to be correctly initialized, the caller must be executing on\n  the original request thread, so if you have spawned additional threads\n  to perform work during a request, you must take care to provide access\n  to the context class yourself.</strong></p>\n</blockquote>\n\n<p>I am wondering about the root cause of the bold part, and one thing leads to another, here is my thoughts:</p>\n\n<blockquote>\n  <p>We know that a process can have multiple threads. Each of these threads have their own stacks, respectively. These threads also have access to a shared memory area, the heap.</p>\n  \n  <p>The stack then, as I understand it, is kind of where all the context for that thread is stored. For a thread to access something in the heap it must use a pointer, and the pointer is stored on its stack.</p>\n  \n  <p>So when we make some cross-thread calls, we must make sure that all the necessary context info is passed from the caller thread's stack to the callee thread's stack.</p>\n</blockquote>\n\n<p>But I am not quite sure if I made any mistake.</p>\n\n<p>Any comments will be deeply appreciated.</p>\n\n<p>Thanks.</p>\n\n<h2>ADD</h2>\n\n<p>Here the stack is limited to <strong>user stack</strong>.</p>\n"},{"tags":["c#","multithreading","wcf","socket-timeout-exception"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":110,"score":3,"question_id":12977580,"title":"Starting multiple services on threads","body":"<p>I am trying to open a proxy on a thread (in background), the thread makes a new instance of the proxy, calls a method of the service and immediately after disposes the service.</p>\n\n<p>All of this happens on a thread :</p>\n\n<pre><code>var background = new Thread(() =&gt;\n{\n    var proxy = new AssignmentSvcProxy(new EndpointAddress(worker.Address));              \n\n    try\n    {\n        proxy.Channel.StartWork(workload);\n        proxy.Dispose();                   \n    }\n    catch (EndpointNotFoundException ex)\n    {\n        logService.Error(ex);                        \n        proxy.Dispose();\n        proxy = null;\n    }\n    catch (CommunicationException ex)\n    {\n        logService.Error(ex);\n        proxy.Dispose();\n        proxy = null;\n    }\n    catch (TimeoutException ex)\n    {\n        logService.Error(ex);                    \n        proxy.Dispose();\n        proxy = null;\n    }\n    catch (Exception ex)\n    {\n        logService.Error(ex);                    \n        proxy.Dispose();\n        proxy = null;\n    }                \n\n}) { IsBackground = true };\n\nbackground.Start();\n</code></pre>\n\n<p>I keep seeing intermittent timeout issues happening even though I have set the timeout to max for CloseTimeout, OpenTimeout, ReceiveTimeout, SendTimeout.</p>\n\n<p>I just want to make sure design wise this is not an issue i.e. opening a service on a thread and disposing it?</p>\n\n<p>EDIT :</p>\n\n<p>Proxy internally establishes a channel with custom binding on different endpoints for each thread.</p>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":13238826,"title":"Application not getting installed and returning null on Android for the below code","body":"<p>Hi I'm a newbie to Android please help me out, I'm trying to set time for my Splash screen with the below code but the application doesn't get installed and returns NULL. I'm using Android 4.1.2</p>\n\n<pre><code>public class SplashActivity extends Activity {\n\n    //how long until we go to the next activity\n    protected boolean _active = true;\n    protected int _splashTime = 5000;\n\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_splash);         \n\n        // thread for displaying the SplashScreen\n        Thread splashTread = new Thread() {\n                @SuppressWarnings(\"deprecation\")\n                @Override\n                public void run() {\n                    try {\n                        int waited = 0;\n                        while(_active &amp;&amp; (waited &lt; _splashTime)) {\n                            sleep(100);\n                            if(_active) {\n                                waited += 100;\n                            }\n                        }\n                    } catch(InterruptedException e) {\n                        // do nothing\n                    } finally {\n\n                        stop();\n                    }\n                }\n            };\n            splashTread.start();\n        }\n    }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":13256462,"title":"Run java program in every 15 minutes","body":"<p>Following is a sample code from my program which queries the database and results are copied to different files in a directory. What I want to achieve is following code should run in 15 minutes interval so that Files are updated with the new data. </p>\n\n<pre><code>public class CountryLogtoCSV {\n\nstatic Connection con = null;\nstatic ResultSet rs = null;\n\npublic static void main(String... argv)\n{\nFileWriter  filewriter=null;\n\nFile countryHits=new File(\"countryhits.csv\");\nfilewriter=new FileWriter(countryHits);\nquery = \"SELECT countryID, count(*) as total FROM mobileCountryLog\"\n        + \" WHERE aHitType='ALL' AND aDate&gt;'2012-11-06' GROUP BY countryID\";\n\nrs = Database.getResult(connection,query)\nwhile (rs.next()) {\n\n    //Writing result to File, FileWriter is used \n    filewriter.append(rs.getString(\"countryID\"));\n    filewriter.append(rs.getString(\"total\"));\n    filewriter.flush();\n}   \n\nFile countryUnique=new File(\"countryunique.csv\");\nfilewriter=new FileWriter(countryUnique);\nquery = \"SELECT countryID, count(*) as total FROM mobileCountryLog\"\n        + \" WHERE (aHitType='UNIQUE'AND aDate&gt;'2012-11-06' GROUP BY countryID;\n\nrs = Database.getResult(connection,query)\nwhile (rs.next()) {\n\n    //Writing Result to File, FileWriter is used\n    filewriter.append(rs.getString(\"countryID\"));\n    filewriter.append(rs.getString(\"total\"));\n    filewriter.flush();\n}   \nrs.close(); \n\n}\n\n}\n</code></pre>\n\n<p>How to run this java class in every 15 minutes??</p>\n\n<p>Thanks,</p>\n"},{"tags":["java","concurrency","multithreading","java-2d","interrupted-exception"],"answer_count":13,"favorite_count":5,"up_vote_count":13,"down_vote_count":0,"view_count":4830,"score":13,"question_id":2873449,"title":"Occasional InterruptedException when quitting a Swing application","body":"<p>I recently updated my computer to a more powerful one, with a quad-core hyperthreading processor (i7), thus plenty of real concurrency available. Now I'm <em>occasionally</em> getting the following error when quitting (<code>System.exit(0)</code>) an application (with a Swing GUI) that I'm developing:</p>\n\n<pre><code>Exception while removing reference: java.lang.InterruptedException\njava.lang.InterruptedException\n        at java.lang.Object.wait(Native Method)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\n        at sun.java2d.Disposer.run(Disposer.java:125)\n        at java.lang.Thread.run(Thread.java:619)\n</code></pre>\n\n<p>Well, given that it started to happen with a more concurrency-capable hardware, and it has to do with threads, and it happens occasionally, it's obviously some kind of timing thing. But the problem is that the stack trace is so short. All I have is the listing above. It doesn't include my own code at all, so it's somewhat hard to guess where the bug is.</p>\n\n<p>Has anyone experienced something like this before? Any ideas how to start solving it?</p>\n\n<p><strong>Edit:</strong> Since quitting a Swing application with <code>System.exit(0)</code> may be \"unclean\", but I don't want to set the main frame to <code>EXIT_ON_CLOSE</code> because I want to ensure that there's nothing critical going on when the application quits, I added a mechanism so that it executes the main frame's <code>dispose()</code> method before calling <code>System.exit(0)</code>. So it should be pretty clean now, but the occasional exception still happens. It happens after the <code>System.exit(0)</code> has been called; <code>dispose()</code> works with no problems. That is, it must be coming from a shutdown hook:</p>\n\n<pre><code>mainFrame.dispose(); // No problem! After this returns, all visible GUI is gone.\n// In fact, if there were no other threads around, the VM could terminate here.\nSystem.exit(0); // Throws an InterruptedException from sun.java2d.Disposer.run\n</code></pre>\n\n<p>I even tried explicitly disposing all <code>Window</code>s by looping through <code>Window.getWindows()</code> array (it contains ownerless <code>Dialog</code>s and such), but it made no difference. This issue seems to have little to do with \"cleanness\" (i.e. explicitly releasing native screen resources before quitting). It's something else, but what?</p>\n\n<p><strong>Edit 2:</strong> Setting the default close operation to <code>EXIT_ON_CLOSE</code> made no difference. <a href=\"http://www.google.com/search?q=sun.java2d.Disposer.run(Disposer.java:125\" rel=\"nofollow\">http://www.google.com/search?q=sun.java2d.Disposer.run(Disposer.java:125</a>) finds a few bug reports, so maybe this indeed is a bug in Sun's Java2D implementation. I could imagine that bugs like this can go unfixed for a long time, because they're pretty harmless in practice; an exception from a shutdown hook hardly hurts anyone else. Given that this happens in a GUI app, the exception is not even noticed unless the <code>stderr</code> is directed to a console or log.</p>\n"},{"tags":["javascript","multithreading"],"answer_count":7,"favorite_count":6,"up_vote_count":13,"down_vote_count":0,"view_count":8252,"score":13,"question_id":1160137,"title":"Execute Background Task In Javascript","body":"<p>I have a cpu intensive task that I need to run on the client.   Ideally, I'd like to be able to invoke the function and trigger progress events using jquery so I can update the UI.  </p>\n\n<p>I know javascript does not support threading, but I've seen a few promising articles trying to mimic threading using setTimeout.  </p>\n\n<p>What is the best approach to use for this?  Thanks.</p>\n"},{"tags":["android","multithreading","service","shutdown-hook"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13256345,"title":"Stop thread executing in Service","body":"<p>I have Service which exectutes request to the server and checks updatings. Requests executes in separate thread like this: </p>\n\n<pre><code>    private Runnable run = new Runnable() {\n             JSONObject data;\n            private int beforeCount = 0;\n            private int afterCount = 0;\n              public void run() {\n                      while(isRunning){\n                          int count = 0;\n                          String equality = null;\n                          Calendar calendar = Calendar.getInstance();\n                         java.util.Date now = calendar.getTime();\n                         java.sql.Timestamp currentTimestamp = new java.sql.Timestamp(now.getTime());\n                         String url = \"http://192.168.0.250:81/?identifier=nspid_\"+md5(LoginActivity.passUserId)+\n                                  \",nspc&amp;ncrnd=\"+Long.toString(currentTimestamp.getTime());\n                         Log.i(\"service curr timeStamp\",Long.toString(currentTimestamp.getTime()));\n                         HttpGet rplPost = new HttpGet(url);\n                         rplPost.setHeader(\"Cookie\", CookieStorage.getInstance().getArrayList().get(0).toString());\n                         DefaultHttpClient rplClient = new DefaultHttpClient();\n                        try \n                            {\n                                httpResponse = rplClient.execute(rplPost);  \n                                 data = JSONParser.getParseData(httpResponse);\n                                try\n                                {\n                                if (data.has(KEY_ORDER))\n                                {\n                                    // Parse orders data and save to \n                                                    // objects containtainers\n                                }\n                                else if (data.has(KEY_MESSAGE))\n                                {  // Parse messages data and save to \n                                                    // objects containtainers\n                                 }\n\n\n                                else\n                                {\n                                    isRunning=false;\n\n                                }\n                                }\n                                catch(NullPointerException e)\n                                {\n                                    e.printStackTrace();\n                                }\n\n\n               }\n           }\n\n         };\n</code></pre>\n\n<p>I call it in my Service like this : </p>\n\n<pre><code>  public int onStartCommand(Intent intent, int flags, int startId) {\n\n\n    Thread t = new Thread(run);\n    isRunning = true;\n    t.start();\n    return super.onStartCommand(intent, flags, startId);\n  }\n</code></pre>\n\n<p>and onDestroy() method:</p>\n\n<pre><code> public void onDestroy() {\n    super.onDestroy();\n    isRunning = false;\n    Log.d(LOG_TAG, \"onDestroy\");\n  }\n</code></pre>\n\n<p>When I add parse messages first time, I recieve duplicates of them. I want to stop thread if I get duplicates. I do it like this:</p>\n\n<pre><code>if (json.equals(json))\n{\n\n     isRunning = false;\n\n}\n</code></pre>\n\n<p>where <code>json</code> - is String data of server response. But it doesn't work. I also tried with </p>\n\n<pre><code>t.interrupt();\n</code></pre>\n\n<p>of my thread. It cause NPE;</p>\n\n<p>I also tried to shutdown the client :</p>\n\n<pre><code>httpClient.getConnectionManager().shutdown();\n</code></pre>\n\n<p>and to abort method:</p>\n\n<pre><code>httpGet.abort()\n</code></pre>\n\n<p>but all these methods don't work for me...Please help with it.</p>\n"},{"tags":["c++","multithreading","dll","mfc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13256288,"title":"How to shutdown DLL with user-interface threads?","body":"<p>I have made a DLL with a function that opens a non-modal window.</p>\n\n<pre><code>class CMainFrame : public CFrameWnd\n{\nprotected:\n    CMainFrame() {}\n    DECLARE_DYNCREATE(CMainFrame)\npublic:\n    virtual void PostNcDestroy()\n    { AfxPostQuitMessage(0); }\npublic:\n    virtual ~CMainFrame() {}\n};\nIMPLEMENT_DYNCREATE(CMainFrame, CFrameWnd)\n\nclass CDllApp : public CWinApp\n{\npublic:\n    CDllApp() :\n        m_pDocTemplate(NULL)\n    {};\npublic:\n    virtual BOOL InitInstance()\n    {\n        CWinApp::InitInstance();\n        m_pDocTemplate = new CMultiDocTemplate(IDR_MAINFRAME, RUNTIME_CLASS(C3DGraphDoc),\n            RUNTIME_CLASS(CMainFrame), RUNTIME_CLASS(C3DGraphView));\n        return TRUE;\n    }\npublic:\n    CMultiDocTemplate* m_pDocTemplate;\n};\n\nCDllApp theApp;\n\nclass C3DThread : public CWinThread\n{\n    DECLARE_DYNCREATE(C3DThread)\npublic:\n    virtual BOOL InitInstance()\n    {\n        theApp.m_pDocTemplate-&gt;OpenDocumentFile(NULL);\n    }\n};\nIMPLEMENT_DYNCREATE(C3DThread, CWinThread)\n\nvoid __stdcall ExportedFunction()\n{\n    AfxBeginThread(RUNTIME_CLASS(C3DThread));\n}\n</code></pre>\n\n<p>If I close all windows before exiting main application, then all looks fine, otherwise my threads hang up. So, I think I need to clean up by closing all open documents and I wonder what would be the simplest way to do it gracefully. <code>m_pDocTemplate-&gt;CloseAllDocuments()</code> from theApp doesn't work, since frame windows for documents belong to different threads.</p>\n"},{"tags":["android","multithreading","user-interface","touch"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":56,"score":5,"question_id":13254824,"title":"When the worker thread works, UI becomes choppy","body":"<p>I have a handwriting recognition app - the user draws with their finger, the app recognizes characters. The recognition engine runs in a worker thread that has the the minimal possible priority - <code>Thread.MIN_PRIORITY</code>. It's a purely CPU/memory algorithm, no I/O whatsoever. Still, when the thread is actively working, the UI becomes rather choppy. The finger strokes take a noticeable delay to appear. I also notice touch events getting lost.</p>\n\n<p>Isn't that exactly what threading was supposed to help avoid? Why is the UI thread starved for CPU? How do convince the system to treat the worker thread as, well, a low-priority background thread?</p>\n\n<p>It looks like the system is introducing (willingly or because of CPU starvation) a delay between <code>invalidate()</code> and <code>onDraw()</code>. Can I somehow lower that delay?</p>\n\n<p>Testing on relatively old hardware - HTC Magic with Android 2.1.</p>\n"},{"tags":["c#","multithreading","backgroundworker"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13254716,"title":"Waiting for a background worker to finish without blocking UI thread","body":"<p>I have an application that needs to wait for a background worker to finish before moving on. The background worker is in charge of writing some values to a USB device that initializes it. The problem with the background worker is that my main program can try to access the USB device before the background worker is finished initializing.</p>\n\n<p>While the background worker is working, the UI thread shows a \"please wait\" with an animated progress bar. The progress bar does <strong>not</strong> reflect how far along the background worker is, it merely 'spins'.</p>\n\n<p>I have read a few questions that say not to use a background worker, because I really don't want it to run asynchronously (which is true), however, without using a background worker, my \"please wait\" dialog blocks and doesn't show the animation. I have also read a lot that tells me to only use one UI thread, which then supports the use of a background worker.</p>\n\n<p>I have also tried to put the \"please wait\" spinner in a separate thread, but that introduces complexities and strange race conditions where the \"please wait\" windows tries to close before it has opened.</p>\n\n<p>What is the right way to go about this?</p>\n"},{"tags":["java","multithreading","runnable"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13254587,"title":"Create Multiple Threads in certain time for Java","body":"<p>What is the best way to create 500.000 threads in 5 seconds. (Runnable) I created for loop but it takes lots of time. For example;</p>\n\n<pre><code>startTime = System.currentTimeMills();\n\nfor (int i=0;i&lt;500.000; i++){\n // create thread\n  thread.start();\n}\n\nresultTime = (System.currentTimeMills() - startTime);\n</code></pre>\n\n<p>So the resultTime is bigger than 5 seconds. I know it depends on my hardware and os configuration but i just want to know what is the best way to create multiple threads in certain time?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c","multithreading","kernel","opencl","gpu"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13253693,"title":"Can someone explain what is wrong with this OpenCL program?","body":"<p>I've included the main parts of the host program which I suspect to be incorrect here:</p>\n\n<p><a href=\"http://pastebin.com/qVkv9E11\" rel=\"nofollow\">http://pastebin.com/qVkv9E11</a></p>\n\n<p>I'm not that great with pointers yet and think I may have allocated some variables wrong.</p>\n\n<p>Here is the Kernel program which should give an idea of what my program is trying to do:</p>\n\n<pre><code>    const char *KernelSource =           \"\\n\"\n\"__kernel void sumElements(           \\n\"\n\"   __global float* input,            \\n\"\n\"   __global float output,            \\n\"\n\"   __global int N)                   \\n\"\n\"{                                    \\n\"\n\"   int i = get_global_id(0);         \\n\"\n\"   if(i &lt; N)                         \\n\"\n\"       output += input[i];           \\n\"\n\"}                                    \\n\"\n\"\\n\";\n</code></pre>\n\n<p>Perhaps this is causing the error as I've never tried SIMT writing to one variable as above. Is it possible to do such a thing? I need to get the sum of all the elements in the array.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13247859,"title":"Do I correctly shutdown these simultaneous threads","body":"<p>As in the subject do I correctly shutdown these simultaneous threads?</p>\n\n<p>I assigned a volatile field and check it repeatedly in while loop.</p>\n\n<p><strong>Is there alternative way to do it</strong>(like using synchronize or wait() method), please show me.</p>\n\n<p><strong>EDIT</strong> I edited code. Is there any way of checking if Thread is alive by different method thatn isAlive();?\nPerhaps:</p>\n\n<pre><code>boolean isAlive(){\n    return running;\n}\n</code></pre>\n\n<hr>\n\n<pre><code>import javax.swing.JOptionPane;\n\npublic class Wat extends Thread {\n    private char c;\n    private int interv;\n    private volatile boolean running = true;\n    Object synchObj;\n\n    public Wat(char c, int interv) {\n        this.c = c;\n        this.interv = interv;\n        synchObj = new Object();\n    }\n\n    public void run() {\n        while (running) {\n            synchronized (synchObj) {\n                try {\n                    showChar(c);\n                    synchObj.wait(interv * 100);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n\n    }\n\n    public synchronized static void showChar(char c) {\n        System.out.println(c);\n    }\n\n    public void shutdown() {\n        running = false;\n        synchronized (synchObj) {\n            synchObj.notify();\n        }\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        Wat w1 = new Wat('A', 3);\n        Wat w2 = new Wat('B', 4);\n        Wat w3 = new Wat('C', 5);\n        w1.start();\n        w2.start();\n        w3.start();\n        Object[] options = { \"Shutdown A\", \"Shutdown B\", \"Shutdown C\" };\n        int option;\n        while (w1.isAlive() || w2.isAlive() || w3.isAlive()) {\n            option = JOptionPane.showOptionDialog(null,\n                    \"Which one would you like to shut?\", \"Threads\",\n                    JOptionPane.YES_NO_CANCEL_OPTION,\n                    JOptionPane.QUESTION_MESSAGE, null, options, options[2]);\n            switch (option) {\n            case JOptionPane.YES_OPTION:\n                w1.shutdown();\n                break;\n            case JOptionPane.NO_OPTION:\n                w2.shutdown();\n                break;\n            case JOptionPane.CANCEL_OPTION:\n                w3.shutdown();\n                break;\n            }\n            Thread.sleep(1);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":9225137,"title":"How do I get data (and an event) from a thread into the main service (UI) thread's event loop?","body":"<p>I have an async task which runs in a separate <code>Thread</code> of my <code>Service</code>.</p>\n\n<p>I'd like to get the result of this task back into the main UI thread and wake up the main UI thread to deal with it.</p>\n\n<p>What's the best way of doing this?</p>\n"},{"tags":["multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":13,"score":-5,"question_id":13252883,"title":"Two threads execute same method in different way","body":"<p>i have two files(x,y) and two threads(A,B).I want the the two threads A and B to access the files in such a way that if thread A is process file x the thread B should process file y and viceversa and it should be concurrent.</p>\n\n<p>Now according to the code i have the two threads are processing the same files twice.</p>\n\n<p>what is the better way to implement this scenario.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["iphone","multithreading","opengl-es"],"answer_count":3,"favorite_count":13,"up_vote_count":12,"down_vote_count":0,"view_count":7959,"score":12,"question_id":1253145,"title":"How to use OpenGL ES on a separate thread on iphone?","body":"<p>The OpenGL ES rendering loop is placed on a separate thread in my iphone application. Everything goes fine except that the EAGLContext's presentRenderbuffer method fails. The result is a blank white screen. \nWhen the same code is run on the main thread, presentRenderbuffer succeeds and the graphics is properly shown.\nWhat is the correct way of doing OpenGL on a separate thread?</p>\n"},{"tags":["multithreading","matlab","parallel-processing","posix","mex"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13251165,"title":"Generating multiple threads in Mex file for Matlab","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6759088/multithreading-with-matlab\">Multithreading with Matlab</a>  </p>\n</blockquote>\n\n\n\n<p>I have a bit of code that I want to run in parallel in a Matlab mex file.</p>\n\n<p>Can I call <code>matlabpool</code> and <code>parfor</code> from inside mex file? Or is there any other way to generate parallel threads in mex file using POSIX or MPI?</p>\n"},{"tags":["linux","multithreading","timer"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":21,"score":-1,"question_id":13251052,"title":"Linux timer issue","body":"<p>In my application i have a thread and a timer handler.\nMy timer handler performs some task at regular interval.\nI am facing a dead lock issue when my thread is performing <strong>fprintf</strong> and timer handler is called.\nIs it safe to use <strong>fprintf</strong> in timer handler?</p>\n\n<p>What would be alternative solution?</p>\n"},{"tags":["java","multithreading","function"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":13249451,"title":"What is the simplest way in java to run many methods in separete threads and wait until all will be finished?","body":"<p>I want a method that runs 2 or more methods in <strong>separate threads</strong>. I want be sure that method won't finish before all threads are done.</p>\n"},{"tags":["java","multithreading","concurrency","vaadin"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13249309,"title":"Synchronized with ThreadLocal vs InheritableThreadLocal?","body":"<p>I am implementing a vaadin application following this <a href=\"https://vaadin.com/wiki/-/wiki/Main/ThreadLocal%20Pattern\" rel=\"nofollow\">thread local pattern</a>.</p>\n\n<p>The state of the application is modified by several worker threads. Hence, to notify the application that its state changed, I add a progress indicator.</p>\n\n<p>Reading the progress indicator sample, I see this :</p>\n\n<pre><code>        // All modifications to Vaadin components should be synchronized\n        // over application instance. For normal requests this is done\n        // by the servlet. Here we are changing the application state\n        // via a separate thread.\n        synchronized (getApplication()) {\n            prosessed();\n        }\n</code></pre>\n\n<p>So basically, I think I just have to modify the call to <code>getApplication</code> to get the instance of my application (just call <code>getCurrent</code>):</p>\n\n<pre><code>  private static ThreadLocal&lt;MyApplication&gt; currentApplication = new ThreadLocal&lt;MyApplication&gt;();\n\n    @Override\n    public void init() {\n        setCurrent(this); // So that we immediately have access to the current application\n\n        // initialize mainWindow and other stuff\n\n        // Register a transaction listener that updates our ThreadLocal with each request\n        if (getContext() != null) {\n            getContext().addTransactionListener(this);\n        }   \n    }\n\n    /**\n     * @return the current application instance\n     */\n    public static MyApplication getCurrent() {\n        return currentApplication.get();\n    }\n</code></pre>\n\n<p>The problem is that my worker thread dies of starvation because It cannot acquire the mutex on the application.\nOne solution provided by the vaadin forum is to use <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/InheritableThreadLocal.html\" rel=\"nofollow\">InheritableThreadLocal</a>. It works but I don't get it why. </p>\n\n<p>From the javadoc :</p>\n\n<blockquote>\n  <p>This class extends ThreadLocal to provide inheritance of values from\n  parent thread to child thread: when a child thread is created, the\n  child receives initial values for all inheritable thread-local\n  variables for which the parent has values. Normally the child's values\n  will be identical to the parent's; however, the child's value can be\n  made an arbitrary function of the parent's by overriding the\n  childValue method in this class.</p>\n  \n  <p>Inheritable thread-local variables are used in preference to ordinary\n  thread-local variables when the per-thread-attribute being maintained\n  in the variable (e.g., User ID, Transaction ID) must be automatically\n  transmitted to any child threads that are created.</p>\n</blockquote>\n\n<p>My worker thread cannot get the lock because it does not receive initial values ?\nAm I misinterpreting something ? \nExcept <a href=\"http://stackoverflow.com/questions/9012371/using-inheritablethreadlocal-with-threadpoolexecutor-or-a-threadpoolexecut\">this problem</a>, what are the potential pitfalls of using InheritableThreadLocal I should be aware of ?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","multithreading","boost","vector"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13249472,"title":"It is safe to push_back on a 2D vector on threads?","body":"<p>Lets say I have a 2D array and this function: </p>\n\n<pre><code>void addVec(std::vector&lt;std::vector&lt;short&gt; &gt;&amp; arr, size_t idx){ \n   arr[idx].push_back(idx);\n}\n\nstd::vector&lt;std::vector&lt;short&gt; &gt; arr(2);\nboost::threads th1(addVec, boost::ref(arr), 0);\nboost::threads th2(addVec, booost::ref(arr), 1);\nth1.join();\nth2.join();\n</code></pre>\n\n<p>By now I should have arr[0][0] = 0; and arr[1][0] = 1;\nThe questions is if this is safe? \nInternally the threads should add values to different parts of vector memory, and because it is constructed at the beginning of size 2 only the internal vectors get resized, witch have thread exclusive access. </p>\n"},{"tags":["python","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13244336,"title":"Multithreaded Access to Python bytearray","body":"<p>It seems that since access to NumPy array data doesn't require calls into the Python interpreter, C extensions can manipulate these arrays after releasing the GIL. For instance, in <a href=\"http://stackoverflow.com/questions/8824739/global-interpreter-lock-and-access-to-data-eg-for-numpy-arrays\">this thread</a>.</p>\n\n<p>The built-in Python type bytearray supports the <a href=\"http://docs.python.org/3/c-api/buffer.html\" rel=\"nofollow\">Buffer Protocol</a>, one member of which is</p>\n\n<blockquote>\n  <p>void <strong>*buf</strong></p>\n  \n  <p>A pointer to the start of the logical structure described by the\n  buffer fields. [...]\n  For contiguous arrays, the value points to the beginning of the memory\n  block.</p>\n</blockquote>\n\n<p>My question is, can a C extension manipulate this <strong>buf</strong> after releasing the GIL (Py_BEGIN_ALLOW_THREADS) since accessing it no longer requires calls to the Python C API? Or does the nature of the Python garbage collector forbid this, since the bytearray, and its buf, might be moved during execution?</p>\n"},{"tags":["c","multithreading","algorithm","maze-solving"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":134,"score":3,"question_id":13217938,"title":"Maze solving with constraints","body":"<p>I know solving mazes is a frequently discussed topic here on Stack Overflow. Here is a problem that might interest you all.</p>\n\n<p>A maze in the form of a n*n matrix will be given as input. Each element would lie between 0-9. A sequence of numbers, each between 0-9 again would also be given. The dimension of the matrix and the sequence array is also known. The question is to find all possible paths in the matrix from (0,0) to (n-1,n-1) that satisfies the given sequence. The path can move down,right or down+right only. Has to be done using threads.</p>\n\n<p>The input and output format are illustrated in the examples given below-</p>\n\n<p>Examples:\n    <img src=\"http://gowthams.in/etc/1.PNG\" alt=\"Example1\">\n    <img src=\"http://gowthams.in/etc/2.PNG\" alt=\"Example2\">\n    <img src=\"http://gowthams.in/etc/3.PNG\" alt=\"Example3\"></p>\n\n<p>Each thread can either print its position (i,j) or update in some sort of data structure to be processed later.</p>\n\n<p>What is the best way to approach this problem?</p>\n\n<p>This is a homework problem and I am allowed to ask for help. I am not looking for code of any sort. I just want a few pointers in the right direction.</p>\n\n<p>Thanks!</p>\n"},{"tags":["multithreading","cocos2d-x"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13248873,"title":"How can I load a texture in separate thread in cocos2d-x?","body":"<p>I faced the need to use multi-threading to load an additional texture on-the-fly in order to reduce the memory footprint.</p>\n\n<p>The example case is that I have 10 types of enemy to use in the a single level but the enemies will come out type by type. The context of \"type by type\" means one type of enemy comes out and the player kills all of its instances, then it's time to call in another type. The process goes like this until all types come out, then the level is complete.</p>\n\n<p>You can see it's better to not initially load all enemy's texture at once in the starting time (it's pretty big 2048*2048 with lots of animation frames inside which I need to create them in time of creation for each type of enemy). I turn this to multi-thread to load an additional texture when I need it. But I knew that cocos2d-x is <strong>not thread-safe</strong>. I planned to use CCSpriteFrameCache class to load a texture from .plist + .png file then re-create animation there and finally create a CCSprite from it to represent a new type of enemy instance. If I don't use multi-thread, I might suffer from delay of lag that would occur of loading a large size of texture.</p>\n\n<p>So how can I load a texture in separate thread in cocos2d-x following my goal above? Any idea to avoid thread-safe issue but still can accomplish my goal is also appreciated.</p>\n\n<p>Note: I'm developing on iOS platform.</p>\n"},{"tags":["c#","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":9210,"score":10,"question_id":2797677,"title":"ContextSwitchDeadlock Was Detected error in C#","body":"<p>I am running a C# application, and during run-time I get the following error:</p>\n\n<blockquote>\n  <p>The CLR has been unable to transition from COM context 0x20e480 to COM context 0x20e5f0 for 60 seconds. The thread that owns the destination context/apartment is most likely either doing a non pumping wait or processing a very long running operation without pumping Windows messages. This situation generally has a negative performance impact and may even lead to the application becoming non responsive or memory usage accumulating continually over time. To avoid this problem, all single threaded apartment (STA) threads should use pumping wait primitives (such as CoWaitForMultipleHandles) and routinely pump messages during long running operations.</p>\n</blockquote>\n\n<p>Can anyone please help me out with the problem here?</p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["java","multithreading","swing","sockets"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":350,"score":1,"question_id":9872356,"title":"JAVA - Socket.accept() freezes ui","body":"<p>I'm trying to make a multithreaded server/client app with java ! this code is for listen() method in a class of a package that named Bsocket (iserver.core.socket) :</p>\n\n<pre><code> try {\n     serverSocket = new ServerSocket(port);\n }catch(IOException e ){\n     ui.log(e.toString());//*\n }\nwhile (true){\n    try{\n        clienSocket = serverSocket.accept();\n        ui.log(\"Incomming Connection.\");//*\n        new connectionHandler(clienSocket, ui);\n    }catch(IOException e ){\n        ui.log(e.toString());\n    }\n}\n</code></pre>\n\n<p><code>ui.log(\"Incomming Connection.\");</code> is a method in below of main class of Bgui (iserver.core.ui).Bgui is a jframe that contain a textarea and something else ! the problem is when the accept methods executed , the <code>ui.log</code> did not works ! whats wrong here ? </p>\n"},{"tags":["c++","multithreading","boost","synchronization","boost-thread"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11769917,"title":"Creating a 'synchronization point' between threads","body":"<p>I have a couple of boost::threads which all execute the same function.</p>\n\n<pre><code>void foo(){\n    //Lock Mutex\n    //Do some stuffs, part 1\n    //Unlock Mutex\n    //Do some stuffs, part 2\n    //Lock Mutex\n    //Do some stuffs, part 3\n    //Unlock Mutex\n}\n</code></pre>\n\n<p>In order for my application to work, it is necessary that, before executing part 2 in parallel, all the threads have finished executing part 1.\nI was not able to find any mechanism that would enable me to do that... am I missing something?</p>\n\n<p>Thank you.</p>\n"},{"tags":["android","multithreading","sockets","android-service","socketexception"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13239139,"title":"android service - opening socket throws null exception","body":"<p>I'm trying to create remote service that will take care for all client-server communication for few different apps.\nThe main idea is starting the service from main activity and open a communication socket to a server.\nafter that, the socket will be used by other apps - that's why i want to use remote service for it...</p>\n\n<p>now i have an issue with the socket connection, it throws null exception on my device.\nit works fine on AVD using older android version.</p>\n\n<p>here's some parts of my code:</p>\n\n<p>my main activity:</p>\n\n<pre><code>final ServiceConnection conn = new ServiceConnection() {\n        public void onServiceConnected(ComponentName name, IBinder service) {\n            myRemoteService = ConnectionInterface.Stub.asInterface(service);\n        }\n        public void onServiceDisconnected(ComponentName name) {\n            myRemoteService = null;\n        }\n    };\n\n    final Thread t = new Thread(){\n        public void run(){\n            bindService(new Intent(getApplicationContext(), ConnectionRemoteService.class),conn,Context.BIND_AUTO_CREATE);\n            while(true){}\n        }\n\n   };\n</code></pre>\n\n<p>later on i start the Thread t with t.start();</p>\n\n<p>my ConnectionRemoteService:</p>\n\n<pre><code>package com.mainlauncher;\n\nimport java.io.DataInputStream;\nimport java.io.DataOutputStream;\nimport java.io.IOException;\nimport java.net.Socket;\nimport java.net.UnknownHostException;\nimport java.util.ResourceBundle;\nimport android.app.Service;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.net.wifi.WifiManager;\nimport android.os.IBinder;\nimport android.widget.Toast;\n\npublic class ConnectionRemoteService extends Service {\n\nprivate static final int SERVERPORT = 7777;\nprivate static final String SERVERADDRESS = \"192.168.1.106\";\n\nprivate String deviceID;\nprivate Socket socket;\nprivate DataInputStream in;\nprivate DataOutputStream out;\n\n@Override\npublic void onCreate() {\n    super.onCreate();\n    WifiManager wm = (WifiManager)getSystemService(Context.WIFI_SERVICE);\n    deviceID = wm.getConnectionInfo().getMacAddress();\n    Toast.makeText(this, \"Service On.\", Toast.LENGTH_LONG).show();\n    open();\n}\n\n@Override\npublic void onDestroy() {\n    Toast.makeText(this, \"Service Off.\", Toast.LENGTH_LONG).show();\n    close();\n}\n\n@Override\npublic IBinder onBind(Intent intent) {\n    return myRemoteServiceStub;\n}   \n\nprivate ConnectionInterface.Stub myRemoteServiceStub = new ConnectionInterface.Stub() {\n\n};\n\nvoid open(){\n    try{\n        socket = new Socket(SERVERADDRESS,SERVERPORT);\n        in = new DataInputStream(socket.getInputStream());\n        out = new DataOutputStream(socket.getOutputStream());\n        out.writeUTF(deviceID);\n    }\n    catch(Exception  e){\n        System.err.println(e.getMessage());\n    }\n}\n\nvoid close(){\n    try {\n        if(in!=null)\n            in.close();\n        if(out!=null)\n            out.close();\n        if(socket!=null)\n            socket.close();\n    } \n    catch(Exception  e){\n        System.err.println(e.getMessage());\n    }\n    socket=null;\n\n}\n\n}\n</code></pre>\n\n<p>Main Manifest file:</p>\n\n<pre><code>&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\npackage=\"com.mainlauncher\"\nandroid:versionCode=\"1\"\nandroid:versionName=\"1.0\" &gt;\n\n&lt;uses-sdk\n    android:minSdkVersion=\"8\"\n    android:targetSdkVersion=\"15\" /&gt;\n\n&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;\n&lt;uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\" /&gt;\n\n&lt;application\n    android:icon=\"@drawable/ic_launcher\"\n    android:label=\"@string/app_name\" &gt;\n    &lt;activity android:name=\".MainLauncherWindow\" &gt;\n        &lt;intent-filter&gt;\n            &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n\n            &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n        &lt;/intent-filter&gt;\n    &lt;/activity&gt;\n\n    &lt;service\n        android:name=\".ConnectionRemoteService\"\n        android:process=\":remote\"/&gt;\n&lt;/application&gt;\n</code></pre>\n\n<p></p>\n\n<p>here's DDMS log on \"debug\" mode as requested:</p>\n\n<blockquote>\n  <p>11-06 12:13:45.130: D/InputDispatcher(392): notifyMotion - eventTime=4210399491000, deviceId=6, source=0x1002, policyFlags=0x0, action=0x0, flags=0x0, metaState=0x0, buttonState=0x0, edgeFlags=0x0, xPrecision=1.529167, yPrecision=1.383594, downTime=4210399491000\n  11-06 12:13:45.130: D/InputDispatcher(392):   Pointer 0: id=0, toolType=1, x=66.049042, y=492.196503, pressure=0.233333, size=0.250980, touchMajor=44.054604, touchMinor=44.054604, toolMajor=4.818472, toolMinor=4.818472, orientation=0.000000\n  11-06 12:13:45.130: D/InputDispatcher(392): Dispatch MotionEvent [action=0] ToCurrentInputTarget: 40f9a6a8 com.mainlauncher/com.mainlauncher.MainLauncherWindow (server)\n  11-06 12:13:45.150: D/PowerManagerService(392): setPowerState: mPowerState=0x3, newState=0x3, noChangeLights=false, reason=3, force=false, mProximitySensorActive=false, mBootCompleted=true, mUseSoftwareAutoBrightness=true (repeat:1)\n  11-06 12:13:45.160: D/PowerManagerService(392): setPowerState: mPowerState=0x3, newState=0x3, noChangeLights=false, reason=2, force=false, mProximitySensorActive=false, mBootCompleted=true, mUseSoftwareAutoBrightness=true\n  11-06 12:13:45.160: I/PowerManagerService-JNI(392): [Stability] PowerManagerService_userActivity JNI pass power key event to PowerManagerService userActivity()\n  11-06 12:13:45.160: D/PowerManagerService(392): setTimeoutLocked: now=4210399, timeoutOverride=-1, nextState=0x3, when=4216399 (mKeylightDelay=6000, mDimDelay=2147469000, mScreenOffDelay=7000)\n  11-06 12:13:45.190: D/InputDispatcher(392): notifyMotion - eventTime=4210464940000, deviceId=6, source=0x1002, policyFlags=0x0, action=0x1, flags=0x0, metaState=0x0, buttonState=0x0, edgeFlags=0x0, xPrecision=1.529167, yPrecision=1.383594, downTime=4210399491000\n  11-06 12:13:45.190: D/InputDispatcher(392):   Pointer 0: id=0, toolType=1, x=65.395096, y=492.919250, pressure=0.233333, size=0.219608, touchMajor=38.547779, touchMinor=38.547779, toolMajor=4.818472, toolMinor=4.818472, orientation=0.000000\n  11-06 12:13:45.190: D/InputDispatcher(392): Dispatch MotionEvent [action=1] ToCurrentInputTarget: 40f9a6a8 com.mainlauncher/com.mainlauncher.MainLauncherWindow (server)\n  11-06 12:13:45.220: D/dalvikvm(153): Before fork\n  11-06 12:13:45.230: D/dalvikvm(20210): Fork pid: 0\n  11-06 12:13:45.230: D/dalvikvm(20210): Late-enabling CheckJNI\n  11-06 12:13:45.230: D/dalvikvm(153): Fork pid: 20210\n  11-06 12:13:45.240: D/Performance(392): AutoProf Starting process { Process=com.mainlauncher:remote, ActivityName=com.mainlauncher/.ConnectionRemoteService}, pid=20210\n  11-06 12:13:45.240: I/ActivityManager(392): Start proc com.mainlauncher:remote for service com.mainlauncher/.ConnectionRemoteService: pid=20210 uid=10080 gids={3003}\n  11-06 12:13:45.300: D/ConnSrv_Debug(392): get mDefaultProxy null by 20210/10080\n  11-06 12:13:45.300: D/WifiStateMachine(392): syncRequestConnectionInfo mWifiInfo=SSID: linksys, BSSID: 00:14:bf:e6:13:8f, MAC: 18:87:96:88:cd:68, Supplicant state: COMPLETED, RSSI: -83, Link speed: 36, Frequency: 2462, Net ID: 1, Explicit connect: false\n  11-06 12:13:45.320: D/AndroidRuntime(20210): Shutting down VM\n  11-06 12:13:45.320: W/dalvikvm(20210): threadid=1: thread exiting with uncaught exception (group=0x40a6b228)\n  11-06 12:13:45.320: E/EmbeddedLogger(392): App crashed! Process: com.mainlauncher:remote\n  11-06 12:13:45.320: E/EmbeddedLogger(392): App crashed! Package: com.mainlauncher v1 (1.0)\n  11-06 12:13:45.320: E/AndroidRuntime(20210): FATAL EXCEPTION: main\n  11-06 12:13:45.320: E/AndroidRuntime(20210): java.lang.RuntimeException: Unable to create service com.mainlauncher.ConnectionRemoteService: java.lang.NullPointerException\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.app.ActivityThread.handleCreateService(ActivityThread.java:2593)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.app.ActivityThread.access$1600(ActivityThread.java:139)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1326)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.os.Handler.dispatchMessage(Handler.java:99)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.os.Looper.loop(Looper.java:156)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.app.ActivityThread.main(ActivityThread.java:5025)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at java.lang.reflect.Method.invokeNative(Native Method)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at java.lang.reflect.Method.invoke(Method.java:511)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:784)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:551)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at dalvik.system.NativeStart.main(Native Method)\n  11-06 12:13:45.320: E/AndroidRuntime(20210): Caused by: java.lang.NullPointerException\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at com.android.internal.os.LoggingPrintStream.println(LoggingPrintStream.java:298)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at com.mainlauncher.ConnectionRemoteService.open(ConnectionRemoteService.java:60)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at com.mainlauncher.ConnectionRemoteService.onCreate(ConnectionRemoteService.java:33)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    at android.app.ActivityThread.handleCreateService(ActivityThread.java:2571)\n  11-06 12:13:45.320: E/AndroidRuntime(20210):    ... 10 more\n  11-06 12:13:45.330: E/EmbeddedLogger(392): Application Label: Launcher</p>\n</blockquote>\n\n<p>I get the exception on this line:</p>\n\n<pre><code>socket = new Socket(SERVERADDRESS,SERVERPORT);\n</code></pre>\n\n<p>I know few things that can make that exception:\n1. I use <code>&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;</code> in my main manifest.\n2. The Service run under separated thread, not on the main activity thread.\n3. There's no firewall etc...\n4. I checked connection with the server already (all worked fine without the service).\n5. I'm using android:process=\":remote\" in my manifest too.</p>\n\n<p>any ideas why that exception occurs?\nhow can i debug it to get more details?</p>\n\n<p>it worked find on AVD using OS 2.3, so i think it's something with the main activity thread exception, but i can't find out why.</p>\n\n<p>thanks,\nLioz.</p>\n"},{"tags":["c#","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13248541,"title":"Single Consumer / Single Producer without any form of locking (CAS, mutex, semaphore, atomic operation) whatsoever","body":"<p>I have a question regarding single consumer / single producer problem.\nI'm sure a race condition will occur here but I can't figure out how to specifically code for it.</p>\n\n<pre><code>using System;\nusing System.Threading;\n\nnamespace RaceCondition\n{\n  class Stuff\n  {\n      private bool empty = false;\n\n      public void Consume(object state)\n      {\n          while (true)\n          {\n              if (!empty)\n              {\n                  Console.WriteLine(\"Consumed\");\n                  empty = true;\n              }\n         }\n      }\n\n      public void Produce(object state)\n      {\n          while (true)\n          {\n              if (empty)\n              {\n                  Console.WriteLine(\"Produced\");\n                  empty = false;\n                  Thread.Sleep(3000);\n              }\n          }\n      }\n\n      static void Main(string[] args)\n      {\n          Stuff stuff = new Stuff();\n          ThreadPool.QueueUserWorkItem(new WaitCallback(stuff.Consume));\n          ThreadPool.QueueUserWorkItem(new WaitCallback(stuff.Produce));\n\n          Console.ReadKey();\n      }\n  }\n}\n</code></pre>\n\n<p>My OS is Vista 32 bit.\nThanks.</p>\n"},{"tags":["ruby","multithreading","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13248031,"title":"Accessing IO (Serial port) simulatenously from two different threads","body":"<p>I'm writing a program which reads and writes from and to the serial port.  There are two threads; one thread reads and writes from/to the serial port every 500ms, and the other thread writes to the serial port every 3s.</p>\n\n<p>The issue I'm having is, since 500ms is a multiple of 3s, at 3s, 6s, 9s... the 500ms loop fails to read/write from/to the serial port.  Is there are way to check whether the serial port is in use?</p>\n\n<pre><code>    counter = 0\n    switchRelays = DoEvery([3], 20) do\n        sp.write \"@00 WR #{relays[counter]}\\r\"\n        counter = (counter + 1) % relays.length\n    end\n\n    # This thread samples every 500ms.\n    sp.write \"@00 AI 0\\r\"\n    sleep 0.2\n    sample500 = DoEvery([0.5], 1.0/0.0) do |timeStamp|\n        if switchRelays.alive? == false\n            csv.close\n            puts 'Done'\n            sample500.exit\n        else\n            sleep 0.1\n            analogueStatus = sp.readline\n            sp.write \"@00 AI 0\\r\"\n        end\n    end\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13247539,"title":"JMM sequential consistency","body":"<p>I'm trying to understand \"sequential consistency\" in terms of Java memory model. Definition from JLS, chapter 17 is not that clear to me.</p>\n\n<p>I will give my vision, correct me if I'm wrong. Having program with one thread sequential consistency means that if action1 comes before action2 in the program order, than action2 should see the results of action1.</p>\n\n<p>Having two threads.</p>\n\n<p>Thread1:</p>\n\n<pre><code>action1\naction2\n</code></pre>\n\n<p>Thread2:</p>\n\n<pre><code>action3\naction4\n</code></pre>\n\n<p>If <code>action3</code> sees the result of <code>action2</code>, than it should see the results of <code>action1</code> as well.</p>\n"},{"tags":["java","android","multithreading","runnable"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13247142,"title":"Is AnimationDrawable.start() run in new thread?","body":"<p>I read the doc <a href=\"http://developer.android.com/reference/android/graphics/drawable/AnimationDrawable.html\" rel=\"nofollow\">http://developer.android.com/reference/android/graphics/drawable/AnimationDrawable.html</a></p>\n\n<p>It extends DrawableContainer which seen like a kind of UI, and it implements Runnable, so it should run in a new thread (It should right? since it implements Runnable). Then in this case, should we follow the rule \"only update UI component in UI thread\"?</p>\n\n<p>I have tested a program that perform a heavy loop after AnimationDrawable.start(), and program crashs (with famous stop responding error). Now I am totally confused, is AnimationDrawable.start() run in new thread?</p>\n\n<p>Edit:</p>\n\n<pre><code>AnimationDrawable.start();\n\nfor (int i = 0 ; i&lt; 10000000 ; i ++){\n    System.out.println(i);\n}\n</code></pre>\n"},{"tags":["c#","multithreading","asynchronous","concurrency","threadpool"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2265,"score":3,"question_id":405600,"title":"Detecting that a ThreadPool WorkItem has completed/waiting for completion","body":"<p>For whatever reason, <code>ThreadPool</code>'s <code>QueueWorkItem</code> doesn't return an <code>IAsyncResult</code> or some other handle to the work item, which would allow to wait until it's completed. There are <code>RegisterWait...</code> methods, but you have to pass a <code>WaitHandle</code> and creating them is expensive (see <code>IAsyncResult</code> documentation, which advises you to delay creating a <code>WaitHandle</code> until requested). The Task Parallel Library will fix this lack, but there is a long wait before that's available. So, are there any problems with this design:</p>\n\n<pre><code>public class Concurrent&lt;T&gt; {\n    private ManualResetEvent _resetEvent;\n    private T _result;\n\n    public Concurrent(Func&lt;T&gt; f) {\n        ThreadPool.QueueUserWorkItem(_ =&gt; {\n                                         _result = f();\n                                         if (_resetEvent != null)\n                                             _resetEvent.Set();\n                                     });\n    }\n\n    public WaitHandle WaitHandle {\n        get {\n            if (_resetEvent == null)\n                _resetEvent = new ManualResetEvent(_result != null);\n            return _resetEvent;\n        }\n\n    ...\n</code></pre>\n\n<p>EDIT:\nI asked a <a href=\"http://stackoverflow.com/questions/406915/using-begininvoke-endinvoke-in-a-multithreaded-fashion-how-do-asynccallback-asy\">follow-up question about the concerns which arise when using async delegates instead of the ThreadPool</a>.</p>\n"},{"tags":["java","multithreading"],"answer_count":6,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":6978,"score":5,"question_id":1024482,"title":"Stop/Interrupt threads blocked on waiting input from socket","body":"<p>As the title says I need a way to stop or interrupt  a thread that is blocked waiting on an input from the socket.</p>\n"},{"tags":["multithreading","debugging","gdb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13235921,"title":"How to debug multi-threaded code in GDB?","body":"<p>I am trying to debug multi-threaded program with one thread that waits input from user. When I put a breakpoint at some function of other thread and run app, it switches into same breakpoint and then immediately at input thread, so app waits input from user and I can't do any command in gdb. I simply need see all stack before invoking same function. I can't make bt command in</p>\n"},{"tags":["java","multithreading","design-patterns","singleton"],"answer_count":7,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":302,"score":7,"question_id":11072262,"title":"Singleton & Multithreading in Java","body":"<p>What is the preferred way to work with Singleton class in multithreaded environment?</p>\n\n<p>Suppose if I have 3 thread, and all they try to access <code>getInstance()</code> method of singleton class at the same time - </p>\n\n<ol>\n<li>What would happen if no synchronization is maintained? </li>\n<li>Is it good practice to use synchronized <code>getInstance()</code> method or use synchronized block inside <code>getInstance()</code>. </li>\n</ol>\n\n<p>Please advise if there is any other way out.</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":52,"score":4,"question_id":13246401,"title":"Should my field be volatile when initializing on a background thread?","body":"<p>On application startup, I am instantiating a class on a background thread, then assigning it to a variable.  I later access that variable from my main thread.  This variable is only assigned once.</p>\n\n<p>My understanding is that I don't need to use the volatile keyword here, because the reference could not be cached until it is first accessed in the UI thread. Am I correct in my thinking, or am I missing something?</p>\n"},{"tags":["c++","multithreading","wxwidgets","wx"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13240898,"title":"How do I pass data from a thread using wxThreadEvent?","body":"<p>I have a GUI and a worker thread, and I want to send data from the worker to the GUI. I'm using QueueEvent and wxThreadEvents to preserve model-view separation. I'm getting a baadf00d error somehow.</p>\n\n<pre><code>const int EvtID = 42;\n\nMyFrame::MyFrame()\n{\n  ...\n  // this seems to work correctly,\n  //   but I'm including it in case it is part of the problem\n  Bind(wxEVT_THREAD, (wxObjectEventFunction)&amp;MyFrame::OutputData, this, EvtID);\n  ...\n}\n\nMyFrame::OutputData(wxThreadEvent* event)\n{\n  // should get data from MyThread,\n  //   but outputs 0xBA, 0xAD, 0xF0, 0x0D in successive calls\n  output &lt;&lt; event-&gt;GetInt();\n}\n\nMyThread::CreateOutputWithLocal()\n{\n  wxThreadEvent event(wxEVT_THREAD, EvtID);\n  event.SetInt(getData());\n  //pFrame is a wxEvtHandler*\n  pFrame-&gt;QueueEvent(event.Clone());\n}\n\nMyThread::CreateOutputWithPointer()\n{\n  wxThreadEvent* event = new wxThreadEvent(wxEVT_THREAD, EvtID);\n  event-&gt;SetInt(getData());\n  //pFrame is a wxEvtHandler*\n  pFrame-&gt;QueueEvent(event); // QueueEvent() takes control of the pointer and deletes it\n}\n</code></pre>\n\n<p>Using <code>wxThreadEvent</code>'s <code>SetPayload()</code> and <code>GetPayload()</code> or its <code>SetExtraLong()</code> and <code>GetExtraLong()</code> doesn't seem to make any difference. What do I need to get this to work?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":13234255,"title":"Threads in java behaving in a sequential fashion","body":"<p>I am observing a strange behavior in Java threads where they are seemingly running in a sequential fashion. Following is the code snippet</p>\n\n<pre><code>class ThreadUnsafeClass {\n\n    private static int y;\n\n    public static void incrementY() {\n        y++;\n    }\n\n    public static int getY() {\n        return y;\n    }\n\n}\n\npublic class MultiThreadedClass implements Runnable {\n    int threadId;\n\n    MultiThreadedClass (int threadId) {\n        this.threadId = threadId;\n    }\n\n    @Override\n    public void run() {\n\n        System.out.println(\"Number:\"+ threadId + \";Thread Unsafe Old Value:\" + ThreadUnsafeClass.getY());\n\n        try {\n            if (threadId == 1 || threadId ==2) {\n                Thread.sleep(60000);\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace(); \n        }\n        ThreadUnsafeClass.incrementY();\n\n        System.out.println(\"Number:\"+ threadId + \";Thread Unsafe New Value:\" + ThreadUnsafeClass.getY());\n    }\n\n    public static void main (String []args) {\n        MultiThreadedClass thread1 = new MultiThreadedClass(1);\n        MultiThreadedClass thread2 = new MultiThreadedClass(2);\n        MultiThreadedClass thread3 = new MultiThreadedClass(3);\n        MultiThreadedClass thread4 = new MultiThreadedClass(4);\n        thread1.run();\n        thread2.run();\n        thread3.run();\n        thread4.run();\n   }\n}\n</code></pre>\n\n<p>Following is the output of the same:</p>\n\n<pre><code>Number:1;Thread Unsafe Old Value:0\nNumber:1;Thread Unsafe New Value:1\nNumber:2;Thread Unsafe Old Value:1\nNumber:2;Thread Unsafe New Value:2\nNumber:3;Thread Unsafe Old Value:2\nNumber:3;Thread Unsafe New Value:3\nNumber:4;Thread Unsafe Old Value:3\nNumber:4;Thread Unsafe New Value:4\n</code></pre>\n\n<p>From the above output, it may be noticed that even when threads 1 and 2 are waiting for a reasonable amount of time i.e. 60s threads 3 and 4 still execute only when they have finished executing. Why aren't the threads executing in parallel and when one thread sleeps, why isn't the other thread going ahead with its execution? Am I going wrong somewhere?</p>\n"},{"tags":["c#","winforms","multithreading","invoke"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13243291,"title":"Do you need two seperate InvokeRequired checks when working with 2 forms?","body":"<p>Given</p>\n\n<pre><code>Action closeLoadingAction = new Action(() =&gt;\n{\n  loadingForm.Close();\n  #region - may need to put into second Action\n  panelOnMainForm.Controls.AddRange(physdocControls.ToList&lt;Control&gt;().ToArray());\n  if (Handle != IntPtr.Zero)\n    User32DLL.SetForegroundWindow(this.Handle);//Handle is a property of the mainForm.\n  #endregion\n});\n</code></pre>\n\n<p>Sometimes I get handle not created exceptions even though I check the Invoke required.</p>\n\n<pre><code>if(loadingForm.InvokeRequired)\n   loadingForm.Invoke(closeLoadingAction);\nelse\n   closeLoadingAction();\n</code></pre>\n\n<p>The loading form runs on the same thread as the main form.  The code you see above runs in a seperate thread.  I suspect that I need another check for invoke against the main form. Do I need a second check or is what I have already safe?</p>\n"},{"tags":["c++","linux","multithreading","process","fork"],"answer_count":7,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":821,"score":11,"question_id":6078712,"title":"Is it safe to fork from within a thread?","body":"<p>Let me explain: I have already been developing an application on Linux which forks and execs an external binary and waits for it to finish. Results are communicated by unique to the fork + process shm files. The entire code is encapsulated within a class. Now I am considering threading the process in order to seed things up. Having many different instances of class functions fork and execute the binary concurently(with different parameters) and communicate results with their own unique shm files. Is this thread safe? If I fork within a thread, apart from being safe, is there something I have to watch for? Any advice or help is much appreciated! </p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":8,"favorite_count":4,"up_vote_count":17,"down_vote_count":0,"view_count":288,"score":17,"question_id":13050695,"title":"guarantee that up-to-date value of variable is always visible to several threads on multi-processor system","body":"<p>I'm using such configuration:</p>\n\n<ul>\n<li>.NET framework 4.5</li>\n<li>Windows Server 2008 R2</li>\n<li>HP DL360p Gen8 (2 * Xeon E5-2640, x64)</li>\n</ul>\n\n<p>I have such field somewhere in my program:</p>\n\n<pre><code>protected int HedgeVolume;\n</code></pre>\n\n<p>I access this field from several threads. I assume that as I have multi-processor system it's possible that this threads are executing on different processors.</p>\n\n<p>What should I do to guarantee that any time I use this field the most recent value is \"read\"? And to make sure that when I \"write\" value it become available to all other threads immediately?</p>\n\n<p>What should I do?</p>\n\n<ul>\n<li>just leave field as is.</li>\n<li>declare it <code>volatile</code></li>\n<li>use <code>Interlocked</code> class to access the field</li>\n<li>use .NET 4.5 <code>Volatile.Read</code>, <code>Volatile.Write</code> methods to access the field</li>\n<li>use <code>lock</code></li>\n</ul>\n\n<p>I only need simplest way to make my program work on <strong>this configuration</strong> I don't need my program to work on another computers or servers or operation systems. Also I want <strong>minimal</strong> latency so I'm looking for <strong>fastest</strong> solution that will always work on <strong>this</strong> standard configuration (multiprocessor intel x64, .net 4.5).</p>\n"},{"tags":["java","android","multithreading","android-asynctask","threadpool"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":4023,"score":5,"question_id":7211684,"title":"AsyncTask.executeOnExecutor() before API Level 11","body":"<p>The normal way we do AsyncTask in Android is, from Android API:</p>\n\n<pre><code> private class DoIntenseTask extends AsyncTask&lt;Object, Object, Void&gt; {\n   protected Void doInBackground(Object... params) {\n     for (Object param : params) {\n         Object rtnObj = doIntenseJob(param);\n         publishProgress(rtnObj);\n     }\n     return null;\n   }\n\n   protected void onProgressUpdate(Object... progress) {\n     for (Object rtnObj : progress) {\n       updateActivityUI(rtnObj);\n     }\n   }\n\n }\n</code></pre>\n\n<p>My intense tasks are loosely coupled and the execution order does not matter, by doing this way, a single thread is allocated to run a list of intense tasks. personally I think this is a sort of halfway solution. Yes, the intense job is not running in UI thread anymore, but still need execute one by one (in many cases, we are facing a list of intense job, I think this is also why the methods in AsyncTask are multi-parameterized). Google should make the API more reusable to solve different kind of scenario.  </p>\n\n<p>What I really like to have is run a number of doIntenseJob() in  parallel managed by a threadpool (e.g. poolSize = 5). Looks like google do give a solution by AsyncTask.executeOnExecutor() but unfortunately only available since API level 11. I am developing app on mobile and wonder if there is a workaround that I can achieve the same behavior under API level 11.  </p>\n\n<p>Thanks in advance<br>\nY</p>\n"},{"tags":["java","multithreading","computer-science","semaphore"],"answer_count":5,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":3788,"score":6,"question_id":1221322,"title":"How does semaphore work?","body":"<p>Can the semaphore be lower than 0? I mean, say I have a semaphore with N=3 and I call \"down\" 4 times, then N will remain 0 but one process will be blocked?</p>\n\n<p>And same the other way, if in the beginning I call up, can N be higher than 3? Because as I see it, if N can be higher than 3 if in the beginning I call up couple of times, then later on I could call down more times than I can, thus putting more processes in the critical section then the semaphore allows me.</p>\n\n<p>If someone would clarify it a bit for me I will much appreciate.</p>\n\n<p>Greg</p>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13243283,"title":"Android background thread that updates the UI in multiple activities","body":"<p>I'm very new to Android, this is my first app. I'm just looking for someone to point me in the right direction.</p>\n\n<p>I am building an app that will query a server over tcp/ip every minute. I would like to show the status of this server (up/down) at the top of every activity/screen.</p>\n\n<p>My questions are:</p>\n\n<p>1) What should I use to continuously ping a server in the background across multiple activities? For instance, is there a way to spawn a thread from one activity in such a way that it will continue even if the user goes to a different screen?</p>\n\n<p>2) How can I allow this thread to update a status label on whatever screen the user happens to be viewing?</p>\n"},{"tags":["java","multithreading","locking"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":138,"score":-2,"question_id":10870503,"title":"Why is this code deadlocking?","body":"<p>I need some help concerning deadlocks. I just do not understand why my code is deadlocking here.</p>\n\n<p>I tried different scenarios.</p>\n\n<p>However I still can't find why and where is the problem. Normally it should work\nand I don't find where the deadlock is between <code>debuter</code> and <code>termine</code>.</p>\n\n<pre><code>  public class Interblocking {\n           protected object obj = object();\n           private boolean condition = true;\n\n           public synchronized void debuter() {\n               synchronized(obj) {\n                   while (!condition) {\n                       try {\n                           obj.wait();\n                       } catch (InterruptedExeption ie) {}\n                   }\n                   condition = false;\n               }\n           }\n\n           public synchronized void terminer() {\n               synchronized(obj) {\n                   condition = true;\n                   obj.notifyAll();\n               }\n           }\n        }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13237560,"title":"How correctly shutdown those threads","body":"<p>I would like to make that OptionPanel makes threads shutdown themselves. I know it suppose to be done in the run method of the thread class but I don't know if I should to synchronize something there or not.</p>\n\n<p><em>How to make that these threads will shut themselves after clicking correct option in JOptionPanel?</em></p>\n\n<pre><code>import javax.swing.JOptionPane;\n\npublic class Wat extends Thread {\n    private char c;\n    private int interv;\n    private volatile boolean running = true;\n\n    public Wat(char c, int interv) {\n        this.c = c;\n        this.interv = interv;\n    }\n\n    public void run() {\n\n        while (running) {\n            try {\n                System.out.println(c);\n                Thread.sleep(interv * 100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n    }\n\n    public static void main(String[] args) {\n        Wat w1 = new Wat('A', 3);\n        Wat w2 = new Wat('B', 4);\n        Wat w3 = new Wat('C', 5);\n        w1.start();\n        w2.start();\n        w3.start();\n        Object[] options = { \"Shutdown A\", \"Shutdown B\", \"Shutdown C\" };\n        int option;\n        while (w1.isAlive() || w2.isAlive() || w3.isAlive()) {\n            option = JOptionPane.showOptionDialog(null,\n                    \"Which one would you like to shut?\", \"Threads\",\n                    JOptionPane.YES_NO_CANCEL_OPTION,\n                    JOptionPane.QUESTION_MESSAGE, null, options, options[2]);\n            switch (option) {\n            case JOptionPane.YES_OPTION:\n                w1.running = false;\n                break;\n            case JOptionPane.NO_OPTION:\n                w2.running = false;\n                break;\n            case JOptionPane.CANCEL_OPTION:\n                w3.running = false;\n                break;\n            }\n        }\n\n    }\n\n}\n</code></pre>\n"},{"tags":["c#","multithreading","concurrency","waithandle"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13241888,"title":"How to wait for a thread to finish execution in C#?","body":"<p>I have a function that is called in rapid succession that has a open database connection. \nmy issue is that before one database connection is closed, another instance of the function is called and i could possibly receive a deadlock in the database.</p>\n\n<p>I have tried:</p>\n\n<pre><code>private static WaitHandle[] waitHandles = new WaitHandle[]\n    {\n        new AutoResetEvent(false)\n    };\n\nprotected override void Broadcast(Data data, string updatedBy)\n    {\n        Action newAction = new Action(() =&gt;\n        {\n        DataManagerFactory.PerformWithDataManager( \n            dataManager =&gt;\n            {\n                // Update status and broadcast the changes\n                data.UpdateModifiedColumns(dataManager, updatedBy);\n\n                BroadcastManager.Instance().PerformBroadcast(\n                    data,\n                    BroadcastAction.Update,\n                    Feature.None);\n            },\n            e =&gt; m_log.Error(ServerLog.ConfigIdlingRequestHandler_UpdateFailed() + e.Message));\n            }\n        );\n\n        Thread workerThread = new Thread(new ThreadStart(newAction));\n        ThreadPool.QueueUserWorkItem(workerThread.Start, waitHandles[0]);\n        WaitHandle.WaitAll(waitHandles);\n    }\n</code></pre>\n\n<p>but i recieve a thread error and the program freezes.  It has something to do with the thread start function having no parameters i believe.</p>\n\n<p>Thanks for any help</p>\n"},{"tags":["python","multithreading","thread-local"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":3228,"score":4,"question_id":1408171,"title":"Thread local storage in Python","body":"<p>How do I use thread local storage in Python?</p>\n\n<h3>Related</h3>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/104983/what-is-thread-local-storage-in-python-and-why-do-i-need-it\">What is “thread local storage” in Python, and why do I need it?</a> - This thread appears to be focused more on when variables are shared.</li>\n<li><a href=\"http://stackoverflow.com/questions/1403471/efficient-way-to-determine-whether-a-particular-function-is-on-the-stack-in-pytho/1403485#1403485\">Efficient way to determine whether a particular function is on the stack in Python</a> - Alex Martelli gives a nice solution</li>\n</ul>\n"},{"tags":[".net","vb.net","multithreading","gui","controls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13237811,"title":"Control as parameter on delegate method","body":"<p>I wasn't sure on how to approach the title for this question, so I'll describe my situation hoping I'm being clear about my doubts. (If there's a better suggestion for the title, I'll change it)</p>\n\n<p>For the last few days I've reading around about multithreading and GUI controls modification using that scenario.\nMy question concerns with passing the control to be changed as a parameter of my delegate and method.\nLet's say I have a ListView1 and I want to add a group to it (it's a simple experience and has few code)</p>\n\n<p>According to examples I've seen, the way to do it would be</p>\n\n<pre><code>Private Delegate Sub ResultsAddGroup_Delegate(ByVal FondsGroup As ListViewGroup)\n\nPrivate Sub ResultsAddGroup(ByVal FondsGroup As ListViewGroup)\n    If Me.ListView1.InvokeRequired Then\n        Dim d As New ResultsAddGroup_Delegate(AddressOf ResultsAddGroup)\n        Dim ParamArgs() As Object = New Object() {FondsGroup}\n        Me.ListView1.BeginInvoke(d, ParamArgs)\n    Else\n        Me.ListView1.Groups.Add(FondsGroup)\n    End If\nEnd Sub\n</code></pre>\n\n<p>I usually like to pass the control as a parameter in order to keep the code clear and the methods or functions away from the specific control objects.\nIf I wanted to pass the ListView as a parameter for the above case, like this:</p>\n\n<pre><code>Private Delegate Sub ResultsAddGroup_Delegate(ByVal LView As ListView, ByVal FondsGroup As ListViewGroup)\n\nPrivate Sub ResultsAddGroup(ByVal LView As ListView, ByVal FondsGroup As ListViewGroup)\n    If LView.InvokeRequired Then\n        Dim d As New ResultsAddGroup_Delegate(AddressOf ResultsAddGroup)\n        Dim ParamArgs() As Object = New Object() {LView, FondsGroup}\n        LView.BeginInvoke(d, ParamArgs)\n    Else\n        LView.Groups.Add(FondsGroup)\n    End If\nEnd Sub\n</code></pre>\n\n<p>Would that represent any kind of problem for multithreading and control changing purposes?\nIf so, is there another way to do this without specifying the control?</p>\n\n<p>On another note, is there any problem with the way I usually do my methods (as described above, with passing the control as parameter)?</p>\n\n<p>Thanks </p>\n"},{"tags":["java","multithreading","swing","gui","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13241543,"title":"Accessing a Java Swing GUI from another class","body":"<p>I have three classes - class 1 which creates an instance of class 2 (the GUI), class 2 which implements the GUI and class 3 which tries to update the GUI.</p>\n\n<p>In class 1 I create the GUI like this:</p>\n\n<pre><code>s = new ServerSocket(6067);         \n\n//while(true){                              \n\n    Socket ClientSocket = s.accept();   // Accept connections   \n\n    // Create instance of the GUI (class 2) on a new thread     \n    work w = cpd.new work();\n\n    Thread t = new Thread(w);\n    t.start();\n\n\n    // Create instance of class 3 that uses the GUI on a new thread             \n    Charger cpt = new ChargingPoint(ClientSocket, w.gui);   \n    cpt.start();                                                \n//}\n\n\nclass work implements Runnable{\n\n    GUI gui;\n\n    public void run(){\n\n        try{\n\n            gui = new GUI();\n            gui.setVisible(true);                   \n        }\n\n        catch(Exception e){}\n\n    }\n}\n</code></pre>\n\n<p>In class 2 I implement the GUI and have some methods that allow it to be updated such as this one:</p>\n\n<pre><code>public void updateConsole(String text){\n    Console.append(text + \"\\n\");\n}\n</code></pre>\n\n<p>In class 3 I try to use these methods like below but the code gets stuck when it reaches a statement like this:</p>\n\n<pre><code>gui.updateConsole(\"Data: \" + data);\n</code></pre>\n\n<p>This has worked for me before when I had the GUI class (class 2) as the main class.  I passed an instance of this to all the other classes and they could us this to update the GUI without any issues.  This time however I am creating the GUI from another class (class 1) and this method is no longer working and I'm struggling to work out why.</p>\n\n<p>Any suggestions would be very much appreciated.</p>\n"},{"tags":["asp.net","multithreading","asynchronous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13241325,"title":"How to signal waithandle.waitany when doing async requests?","body":"<p>I have this code? </p>\n\n<p>I dont want to wait until every request is completed that is using waithandle.waitall, just until the correct value is found. Now I'm using to do it this way. But it feels wrong to send manualresetevents to the thread? Or is it how it should be done?</p>\n\n<pre><code>    public static void runprogram()\n    {\n\n        System.Net.ServicePointManager.DefaultConnectionLimit = 20;\n        FetchPageDelegate del = new FetchPageDelegate(FetchPage);\n        List&lt;HtmlDocument&gt; htmllist = new List&lt;HtmlDocument&gt;();\n        List&lt;IAsyncResult&gt; results = new List&lt;IAsyncResult&gt;();\n        List&lt;WaitHandle&gt; waitHandles = new List&lt;WaitHandle&gt;();\n        List&lt;ManualResetEvent&gt; handles = new List&lt;ManualResetEvent&gt;();\n\n        for (int i = 0; i &lt; 20; i++)\n        {\n            ManualResetEvent e = new ManualResetEvent(false);\n            handles.Add(e);\n        }\n\n        for(int i = 0; i &lt; 200; i += 10)\n        {\n            int y = 0;\n            string url = @\"URLTOPARSE\" + i;\n            IAsyncResult result = del.BeginInvoke(url, handles[y], null, null);\n            results.Add(result);\n            waitHandles.Add(result.AsyncWaitHandle);\n\n            y++;\n        }\n        //Here i check for a signal\n        WaitHandle.WaitAny(handles.ToArray());\n\n        //WaitHandle.WaitAll(waitHandles.ToArray());\n\n        foreach (IAsyncResult async in results)\n        {\n\n           FetchPageDelegate delle = (async as AsyncResult).AsyncDelegate as FetchPageDelegate;\n           HtmlDocument htm = delle.EndInvoke(async);\n\n            if(htm.DocumentNode.InnerHtml.Contains(\"ANYTHING TO CHECK FOR(ONLY A TEST\"))\n            { \n                return;\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13223052,"title":"How to return back the object using async task?","body":"<p>I am trying to return back the list of tweets after the parsing from async task ....\nBut I am not getting the arraylist back from the task . \nCan anyone suggest a solution?</p>\n\n<pre><code>public class Main extends ListActivity {\n    String MY_APP_TAG = \"com.list\";\n\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        ArrayList listItems = new ArrayList();\n        new myAsyncTask().execute(listItems);\n\n        setListAdapter(new ArrayAdapter(this, R.layout.tweet, R.id.tweet,listItems));\n        ListView lv = getListView();\n        lv.setTextFilterEnabled(true);\n        lv.setOnItemClickListener(new OnItemClickListener() {\n            @Override\n            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {\n                // When clicked, show a Toaster\n                Toast.makeText(getApplicationContext(), ((TextView) view).getText(), Toast.LENGTH_SHORT).show();\n            }\n        });\n    }\n\n    private class myAsyncTask extends AsyncTask&lt;ArrayList&lt;Object&gt;, Void, Void&gt;\n    {\n        ArrayList&lt;Object&gt; listItems;\n        ProgressDialog dialog;\n        @Override\n        protected void onPreExecute() {\n            dialog = ProgressDialog.show(Main.this, \"\", \"Loading....\");\n        }\n        @Override\n        protected Void doInBackground(ArrayList&lt;Object&gt;... params) {\n\n            String host = \"api.twitter.com\";\n            String twitterURL = \"http://\"+host+\"/1/statuses/user_timeline.json?screen_name=i1990jain&amp;amp;count;=10\";\n            try {\n                HttpClient client = new DefaultHttpClient();\n                BasicHttpContext localContext = new BasicHttpContext();\n                HttpHost targetHost = new HttpHost(host, 80, \"http\");\n                HttpGet httpget = new HttpGet(twitterURL);\n                httpget.setHeader(\"Content-Type\", \"application/json\");\n                HttpResponse response = client.execute(targetHost, httpget, localContext);\n                HttpEntity entity = response.getEntity();\n                Object content = EntityUtils.toString(entity);\n                Log.d(MY_APP_TAG, \"OK: \" + content.toString());\n\n                JSONArray ja = new JSONArray(content.toString());\n\n                for(int i = 0; i &lt; ja.length(); i++){\n                    JSONObject jo = ja.getJSONObject(i);\n                    listItems.add(jo.getString(\"text\"));\n                }\n            } catch(Exception e) {\n                e.printStackTrace();\n            }\n            return null;\n        }\n        @Override\n        protected void onPostExecute(Void result) {\n            dialog.dismiss();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["iphone","multithreading","core-data"],"answer_count":4,"favorite_count":5,"up_vote_count":5,"down_vote_count":0,"view_count":10113,"score":5,"question_id":2280158,"title":"Reset a CoreData persistent store","body":"<p>Basically, what I'm trying to do is to wipe out all data in my CoreData persistent store, then import new data. How would you do this? It seems that the simplest solution is call <code>[NSPersistentStoreCoordinator removePersistentStore:error:]</code> and then remove the file. Is that the best practice available? Is it thread-safe?</p>\n\n<p>Thank you very much,</p>\n\n<h2>#</h2>\n\n<p><strong>Question 0.1: was</strong></p>\n\n<p>I am trying to update the data in a CoreData persistent store. My user is seeing a table view with statistical data. I want to update the application by deleting all existing data, then importing new data. I would like to show a progress view to tell the user that the application is not hanging.</p>\n\n<p>I have added the following <code>resetPersistentStore</code> method in my AppDelegate (<code>persistentStoreCoordinator</code>is given for reference):</p>\n\n<pre><code>// ...\n@property (nonatomic, retain, readonly) NSManagedObjectModel *managedObjectModel;\n@property (nonatomic, retain, readonly) NSManagedObjectContext *managedObjectContext;\n@property (nonatomic, retain, readonly) NSPersistentStoreCoordinator *persistentStoreCoordinator;\n// ...\n\n/**\n Returns the persistent store coordinator for the application.\n If the coordinator doesn't already exist, it is created and the application's store added to it.\n */\n- (NSPersistentStoreCoordinator *)persistentStoreCoordinator {\n\n    if (persistentStoreCoordinator != nil) {\n        return persistentStoreCoordinator;\n    }\n\n    NSURL *storeUrl = [NSURL fileURLWithPath: [[self applicationDocumentsDirectory] stringByAppendingPathComponent: kPersistentStoreFilename]];\n\n NSError *error = nil;\n    persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];\n    if (![persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeUrl options:nil error:&amp;error]) {\n  NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]);\n  abort();\n    }    \n\n    return persistentStoreCoordinator;\n}\n\n/**\n * Will remove the persistent store\n */\n- (NSPersistentStoreCoordinator *)resetPersistentStore {\n NSError *error;\n\n [managedObjectContext lock];\n\n // FIXME: dirty. If there are many stores...\n NSPersistentStore *store = [[persistentStoreCoordinator persistentStores] objectAtIndex:0];\n\n if (![persistentStoreCoordinator removePersistentStore:store error:&amp;error]) {\n  NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]);\n  abort();\n    }  \n\n // Delete file\n if (![[NSFileManager defaultManager] removeItemAtPath:store.URL.path error:&amp;error]) {\n  NSLog(@\"Unresolved error %@, %@\", error, [error userInfo]);\n  abort();\n    } \n\n // Delete the reference to non-existing store\n [persistentStoreCoordinator release];\n persistentStoreCoordinator = nil;\n\n NSPersistentStoreCoordinator *r = [self persistentStoreCoordinator];\n [managedObjectContext unlock];\n\n return r;\n}\n</code></pre>\n\n<p>Then in my view I do (in another thread since I am using <code>MBProgressHUD</code>:</p>\n\n<pre><code>PatrimoineAppDelegate *appDelegate = (PatrimoineAppDelegate *)[[UIApplication sharedApplication] delegate]; \n// Delete everything\n[appDelegate resetPersistentStore];\n</code></pre>\n\n<p>And I get an <code>EXC_BAD_ACESS</code>...</p>\n\n<p>I do not know CoreData or multithreading very well, maybe I'm doing an evident error...</p>\n"},{"tags":["python","django","multithreading","multiprocessing","multiprocess"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13239087,"title":"Django Multiprocessing oddity","body":"<p>In using ./manage.py shell to exercise some code, I've come across something I don't understand.</p>\n\n<pre><code>Python 2.6.6 (r266:84292, Sep 11 2012, 08:34:23)\n[GCC 4.4.6 20120305 (Red Hat 4.4.6-4)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n(InteractiveConsole)\n&gt;&gt;&gt; from multiprocessing import Process\n&gt;&gt;&gt; from django.core.management import call_command\n&gt;&gt;&gt; p = Process(target=call_command(\"processphoto\", 1000))\nSuccessfully populated photo \"1000\"  (This is output from my processphoto command)\n&gt;&gt;&gt;\n</code></pre>\n\n<p>I never get the opportunity to do a <code>p.start()</code> or set any other variables on the process.  It appears to execute on instantation.  When I try to use the code in my view, I don't appear to get multiple processes spawning at all, everything remains on the one core.</p>\n\n<p>What am I doing wrong, or misunderstanding?  I want to generate separate <code>manage.py processphoto</code> commands in separate processes to fully utilize the multi-core server.</p>\n"},{"tags":["c#","asp.net","multithreading","iis7","mutex"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":13235177,"title":"Null reference exception in exception logging masking true error","body":"<p>We've got a long-running process that is initiated by a web request. In order to give the process time to complete, we spin it off on a new thread and use a Mutex to ensure only one instance of the process can run. This code runs as intended in our development and staging environments, but is failing in our production environment with Null Reference Exception. Our application logging does not capture anything and our operations folks are reporting that it is crashing the AppPool. (It would seem to be an environmental problem, but we have to proceed with the assumption that the environments are configured identically.) We have so far been unable to determine where the Null Reference is.</p>\n\n<p>Here is the exception from the Application Event Log:</p>\n\n<pre><code>Exception: System.NullReferenceException\nMessage: Object reference not set to an instance of an object.\nStackTrace:    at Jobs.LongRunningJob.DoWork()\n   at System.Threading.ExecutionContext.runTryCode(Object userData)\n   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n   at System.Threading.ThreadHelper.ThreadStart()\n</code></pre>\n\n<p>And here is the code (slightly sanitized):</p>\n\n<pre><code>public class LongRunningJob: Job\n{\n    private static Mutex mutex = new Mutex();\n\n    protected override void PerformRunJob()\n    {\n        var ts = new ThreadStart(LongRunningJob.DoWork);\n        var thd = new Thread(ts);\n        thd.IsBackground = true;\n        thd.Start();\n    }\n\n    private static void DoWork()\n    {\n        var commandTimeOut = 180;\n\n        var from = DateTime.Now.AddHours(-24);\n        var to = DateTime.Now;\n\n        if (mutex.WaitOne(TimeSpan.Zero))\n        {\n            try\n            {\n               DoSomethingExternal(); // from what we can tell, this is never called\n            }\n            catch (SqlException sqlEx)\n            {\n                if (sqlEx.InnerException.Message.Contains(\"timeout period elapsed\"))\n                {\n                    Logging.LogException(String.Format(\"Command timeout in LongRunningJob: CommandTimeout: {0}\", commandTimeOut), sqlEx);\n                }\n                else\n                {\n                    Logging.LogException(String.Format(\"SQL exception in LongRunningJob: {0}\", sqlEx.InnerException.Message), sqlEx);\n                }\n            }\n            catch (Exception ex)\n            {\n                Logging.LogException(String.Format(\"Error processing data in LongRunningJob: {0}\", ex.InnerException.Message), ex);\n            }\n            finally\n            {\n                mutex.ReleaseMutex();\n            }\n        }\n        else\n        {\n            Logging.LogMessage(\"LongRunningJob is already running.\");\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","multithreading","asynchronous"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13238620,"title":"ASP.NET speed up handling of results from async requests","body":"<p>I just recently converted my websites requests to async, it goes about thrice the speed before, but I discovered a drawback. Let me explain, I use 20 different request towards a page. When page is loaded I parse the results, and add them to a dictionary, when this is done I check the dictionary for they key I provided an I get information on wether the information was found or not.</p>\n\n<p>Now before async this took about 30 secs when running all 20 request. Today I'm running 20 request at about 7 seconds, great improvment, but.... If the old method found the information in the first request, it finished in under 2 seconds. Using this method it always takes 7 seconds. </p>\n\n<p>How should I do to, finish of everything right when the information is found? Instead of doing all twenty requests. This is the code.</p>\n\n<p>EDIT I TRIED TO REMOVE THE WAITALL, BUT THAT GAVE ME WORSE PERFORMANCE.</p>\n\n<pre><code>public decimal GetWebpage(string urltovisit, string visitorurl, string information)\n    {\n        List&lt;HtmlDocument&gt; htmllist = new List&lt;HtmlDocument&gt;();\n        System.Net.ServicePointManager.DefaultConnectionLimit = 10;\n        FetchPageDelegate del = new FetchPageDelegate(FetchPage);\n        List&lt;IAsyncResult&gt; results = new List&lt;IAsyncResult&gt;();\n        List&lt;WaitHandle&gt; waitHandles = new List&lt;WaitHandle&gt;();\n        _visitorUrl = visitorurl;\n        _theSearchedinformation = information;\n\n        for (int i = 0; i &lt; 200; i += 10)\n        {\n            string url = urltovisit + i;\n            IAsyncResult result = del.BeginInvoke(url, null, null);\n            results.Add(result);\n            waitHandles.Add(result.AsyncWaitHandle);\n        }\n\n        WaitHandle.WaitAll(waitHandles.ToArray());\n\n        foreach (IAsyncResult async in results)\n        {\n            FetchPageDelegate pagedelagate = (async as AsyncResult).AsyncDelegate as FetchPageDelegate;\n            //THIS FUNCTION PARSES AND ADDS THE RESULT TO A DICTIONARY\n            DocParser.StartParse(pagedelagate.EndInvoke(async));\n\n            if (GetPostion() != 201)\n            {   //ADD DATA TO DATABASE\n                InsertRankingData(DocParser.GetSearchResults(), _theSearchedinformation);\n                return GetPostion();\n            }\n\n        }\n        return 201;\n      }\n</code></pre>\n\n<p>So should I create a new list of delagates to run the method and class that parses and adds to the dictionary? Or can I use the waithandles to tell that result has been found? Im really clueless here?</p>\n"},{"tags":[".net","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13197144,"title":"How to cancel a bunch of tasks when any of these tasks throws an exception?","body":"<p>I create and start many tasks. \nOne of the task can throw an exception. If this happens I need to stop all the tasks.</p>\n\n<p>Now I just see the only way to do this is to pass CancellationTokenSource to each task and call Cancel() in catch block.</p>\n\n<p>Does TPL support the required feature in a more generic way?</p>\n\n<p>Something like:</p>\n\n<pre><code>Action&lt;Task&gt; onExceptionAction = t =&gt; cancellationTokenSource.Cancel();\nvar task = Task.WhenAnyThrows&lt;MyException&gt;(tasks, onExceptionAction);\n</code></pre>\n\n<p>And task is considered to be completed (or cancelled) if no exception is thrown</p>\n"},{"tags":["multithreading","delphi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13237325,"title":"Invalid handle error in thread","body":"<p>I keep getting \"Thread error: The handle is invalid (6)\" when I attempt to use this thread but I can't see the problem.  Please help if you can, thanks!</p>\n\n<p>stackoverlow is complaining that I didn't explain this enough.  So, I created a thread class which compiles without any errors but when I invoke it with execute it seems to run ok but throws this error in the destructor.</p>\n\n<pre><code>  tdownloadthread = class(tthread)\n    private\n      furl,\n      ffilename,\n      fmsg: string;\n      fdl: tidhttp;\n      readings,bpstotal,avgbps: int64;\n      fpercent: word;\n      fsuccess,fcanceled: boolean;\n      start: tdatetime;\n      fspeed,fremaining: string;\n    public\n      constructor create(url,filename: string);\n      destructor destroy; override;\n      procedure execute; override;\n      procedure DlWork(ASender: TObject; AWorkMode: TWorkMode; AWorkCount: Int64);\n      procedure cancel;\n\n      property success: boolean read fsuccess;\n      property canceled: boolean read fcanceled;\n      property speed: string read fspeed;\n      property percent: word read fpercent;\n      property remaining: string read fremaining;\n      property msg: string read fmsg;\n  end;\n\n\nconstructor tdownloadthread.create(url,filename: string);\nbegin\n  fsuccess:=false;\n  fcanceled:=false;\n\n  fdl:=tidhttp.Create(nil);\n  fdl.OnWork:=dlwork;\n  fdl.HandleRedirects:=true;\n\n  furl:=url;\n  ffilename:=filename;\n\n  freeonterminate:=false;\nend;\n\ndestructor tdownloadthread.Destroy;\nbegin\n  fdl.Free;\nend;\n\nprocedure tdownloadthread.cancel;\nbegin\n  fdl.Disconnect;\n  fcanceled:=true;\nend;\n\nprocedure tdownloadthread.DlWork(ASender: TObject; AWorkMode: TWorkMode; AWorkCount: Int64);\nvar\n  Http: TIdHTTP;\n  ContentLength: Int64;\n  i,h,m,esec,sec,rsec,bps: Integer;\n  f: tdatetime;\nbegin\n  Http := TIdHTTP(ASender);\n  ContentLength := Http.Response.ContentLength;\n\n  if (Pos('chunked', LowerCase(Http.Response.ResponseText)) = 0) and\n     (ContentLength &gt; 0) then\n  begin\n    fpercent := trunc(100*(AWorkCount / ContentLength));\n\n    esec := secondsbetween(now, start);\n\n    if (avgbps &gt; 0) then\n     begin\n       i:=contentlength div avgbps;\n       f:=incsecond(now, i);\n       rsec:=secondsbetween(now, f);\n\n       sec:=rsec - esec;\n\n       h:=sec div 3600;\n       m:=sec div 60 - H * 60;\n       sec:=sec - (H * 3600 + M * 60) ;\n    end;\n\n    if (esec &gt; 0) then\n      bps:=(aworkcount div esec)\n       else\n      bps:=0;\n\n    inc(readings);\n    inc(bpstotal, bps);\n    avgbps:=bpstotal div readings;\n\n    if (avgbps / 1024 &lt; 1024) then\n      fspeed:=format('%2f KB/s', [avgbps / 1024])\n       else\n      fspeed:=format('%2f MB/s', [(avgbps div 1024) / 1024]);\n\n    fremaining:=format('%s m %s s', [zero(m), zero(secno)]);\n  end;\nend;\n\nprocedure tdownloadthread.Execute;\nvar fn,cd: string;\n    data: tmemorystream;\nbegin\n  try\n    start:=now;\n\n    data:=tmemorystream.Create;\n\n    fdl.Get(furl, data);\n    cd:=fdl.Response.ContentDisposition;\n    if (pos('filename=', cd) &gt; 0) then\n      fn:=extractfilepath(paramstr(0))+copy(cd, pos('=', cd)+1, length(cd))\n         else\n      fn:=ffilename;\n    data.SaveToFile(fn);\n    ffilename:=fn;\n    fsuccess:=true;\n\n    data.Free;\n  except\n    on e: exception do\n      begin\n        fsuccess:=false;\n        fmsg:=e.Message;\n      end;\n  end;\nend;\n\nprocedure testdownload;\nvar downloadthread: tdownloadthread;\nbegin\n  downloadthread:=tdownloadthread.create('http://www.someurl.com/filename.old',extractfilepath(paramstr(0))+'filename.new');\n  downloadthread.Execute;\n  if downloadthread.canceled then showmessage('canceled');\n  if downloadthread.success then showmessage('success');\n  if not downloadthread.success then showmessage('error: '+downloadthread.msg);\n  downloadthread.Free;\nend;\n</code></pre>\n"},{"tags":["c#","multithreading","interop","spotify"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13223372,"title":"Libspotify playing problems","body":"<p>I'm writing a C# wrapper around libspotfiy, and have a problem with the track playing. From what I can tell, when I want to start streaming a track for the first time in a session, I should call</p>\n\n<pre><code>sp_session_player_load(sessionHandle, trackHandle)\nsp_session_player_play(sessionHandle, true);\n</code></pre>\n\n<p>This is what I'm doing, and it works fine. The problem start when I want to play something else. With a track still playing, what am I meant to do to play a new one? Should I call</p>\n\n<pre><code>sp_session_player_play(sessionHandle, false);\nsp_session_player_unload(sessionHandle);\n</code></pre>\n\n<p>Before then calling a new round of load/play? I ask because when I do this, I often see my program hang when I call the unload, or call play with an argument of false. I'm using the get_audio_buffer_stats callback. I've got appropriate thread syncronisation in place, so I'm wondering if I'mu sing the api incorrectly?</p>\n"},{"tags":["ios","multithreading","uitableview","nsurlconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13237302,"title":"Missing data when calling reloadData twice","body":"<p>I've a <code>UISearchBar</code> that provide user with instant search.</p>\n\n<p>the user keystrokes causes the app to call a server async. and the result got drawing on a <code>UITableView</code> using reloadData method.</p>\n\n<p>In some cases when the user do to subsequent searches in less a second, this causes the second result not being drawing to the <code>UITableView</code>.</p>\n\n<p><em>I suspect a threading issue</em>. Is there a way to enforce the reloadData to be locked?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>The second call doesn't cause <code>cellForRowAtIndexPath</code>to be called!</p>\n\n<p>Please help</p>\n"},{"tags":["c++","multithreading","synchronization","c++0x","boost-thread"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2290,"score":4,"question_id":4792449,"title":"C++0x has no semaphores? How to synchronize threads?","body":"<p>Hallo,</p>\n\n<p>is it true that C++0x will come without semaphores? There are already some questions on stackoverflow regarding the use of semaphores. I use them (posix semaphores) all the time to let a thread wait for some event in another thread:</p>\n\n<pre><code>void thread0(...)\n{\n  doSomething0();\n\n  event1.wait();\n\n  ...\n}\n\nvoid thread1(...)\n{\n  doSomething1();\n\n  event1.post();\n\n  ...\n}\n</code></pre>\n\n<p>If I would do that with a mutex:</p>\n\n<pre><code>void thread0(...)\n{\n  doSomething0();\n\n  event1.lock(); event1.unlock();\n\n  ...\n}\n\nvoid thread1(...)\n{\n  event1.lock();\n\n  doSomethingth1();\n\n  event1.unlock();\n\n  ...\n}\n</code></pre>\n\n<p>Problem: It's ugly and it's not guaranteed that thread1 locks the mutex first (Given that the same thread should lock and unlock a mutex, you also can't lock event1 before thread0 and thread1 started).</p>\n\n<p>So since boost doesn't have semaphores either, what is the simplest way to achieve the above?</p>\n"},{"tags":["android","multithreading","android-asynctask","thread-pool"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13230523,"title":"Sophisticated threading in android","body":"<p>I'm making an app where I've to perform lot of background operations. </p>\n\n<ul>\n<li>Download data from 30 similar JSON one after the other.</li>\n<li>Change priority/order of above mentioned downloads depending upon user response.</li>\n<li>Download multiple images parallelly on user request</li>\n<li>Stop threads/ check thread status etc.</li>\n</ul>\n\n<p>Which is the best class/API to perform above operation. I've been using <code>AsyncTask</code> but I read somewhere that it has default limitation of 10 background operations and also above functional limitations.</p>\n\n<p>I would also appreciate if you could share peace of code of achieving above tasks.</p>\n"},{"tags":["java","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":79,"score":-2,"question_id":13231439,"title":"Java Threads - Start()","body":"<p>Doing some studying about threads and I'm confused about what the <code>start()</code> method in Java threads actually do.</p>\n\n<p>My current understanding is that the start method doesn't immediately start the thread's execution, but instead moves it to a pool of threads waiting for it be picked for execution by the thread scheduler.</p>\n\n<p>Is this correct? I can't seem to find any good resources about what the methods actually do.</p>\n"},{"tags":["xcode","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13182687,"title":"Xcode stops running without a crash","body":"<p>I'm experiencing a problem whereby my application works fine when the screen is active, but, when the screen is locked or asleep, a certain bit of the code seems to pause the app indefinitely, without actually crashing.</p>\n\n<p>The app uses AVAudioPlayers and boost::threads to play some music tracks. When a track ends, lots of setup has to be called in order for the new track to be prepared. At the same time, the app has to pause for a few seconds. This parallel activity is achieved with boost::threads.</p>\n\n<p>When the screen is active, this all works fine. However, when the screen is inactive, the new track is never played. There is no crash, and, using breakpoints to debug, it seems that the app simply hangs on a certain line - the line changes from debug session to debug session - and gets stuck. Never have I so hoped for an EXC_BAD_ACCESS - but there's nothing. No hint of why the code is hanging.</p>\n\n<p>Could it be that my main thread is blocked? I use a few performSelectorOnMainThread calls, but I've deactivated them when the screen is locked using applicationWillResignActive. However, this hasn't solved the problem.</p>\n\n<p>The boost::thread in which it seems to hang is as follows:</p>\n\n<pre><code>void MyClass::loopThread(int waitSeconds)\n{\n    loopScheduled = true;\n\n    sleep(waitSeconds);\n\n    if ( loopScheduled == true ) {\n\n        if (engine_isRunning()) {\n            joinEngineThread();\n        }\n        startEngineThread();\n        ((CPlusPlus*)m_obj)-&gt;markAsPlaying();\n    }\n}\n</code></pre>\n\n<p>It seems to hang around the</p>\n\n<pre><code>if ( loopScheduled == true ) {\n</code></pre>\n\n<p>line.</p>\n\n<p>What's going on in this thread is that other parallel threads can set loopScheduled to false during the sleep() call, and if loopScheduled is false, the later methods aren't called.</p>\n\n<p>However, in terms of the problem I'm having, loopScheduled should be irrelevant - it's not being set to false by any other method, and is still true after the sleep() call.</p>\n\n<p>Does anyone have any idea what could be going on?</p>\n"},{"tags":["java","multithreading","design-patterns","reactor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13235312,"title":"What are worker threads, and what is their role in the reactor pattern?","body":"<p>I'm trying to undertand the Reactor pattern (concurrent), but in many examples they are talking about 'worker threads'. What are worker threads? In what do they differ from 'normal' threads? And what is their role in the reactor pattern?</p>\n"},{"tags":["android","multithreading","service"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12934235,"title":"Android Prevent system to kill application if service running","body":"<p>My application can start a local service to do download task in background (in thread). \nIf all the activities of my application are destroy (if user press back on all of them for example), the system kills my application even if the local service is still running. \nHow can I prevent that in order the application stopped only when the service finished the download ?</p>\n"},{"tags":["multithreading","servlets","jdbc"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13234602,"title":"Database connections for servlet threads?","body":"<p>With regards to Servlets being multithreaded by default. Does each Servlet instantiate a database connection or is the connection shared between all threads of that servlet?</p>\n\n<p>I am using JDBC as an interface between my servlet and an Oracle database.</p>\n\n<p>If a database connection is shared between all threads , does this mean I should use connection pooling to the database?</p>\n\n<pre><code>       /** Open the connection here **/\n   public void init() {\n          String url = \"server\";\n          String username = \"pwd\";\n          String password = \"usr\";\n          try {\n                 Class.forName(\"oracle.jdbc.OracleDriver\");\n                 conn = DriverManager.getConnection(url, username, password);\n          } catch (Exception e) {\n                 System.err.println(\"Error making pool: \" + e);\n                 conn = null;\n          }\n   }\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c++","multithreading","unix","thread-safety"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13234711,"title":"is IP2Location thread safe?","body":"<p>I am currently looking to use IP2Location within an apache service. One thing I have noticed is that there is little information regarding whether or not IP2Location is thread safe.</p>\n\n<pre><code>IP2Location *IP2LocationObj = IP2Location_open(\"../data/IP-COUNTRY.BIN\");\n</code></pre>\n\n<p>would the below be able to handle being used within multiple threads?</p>\n\n<pre><code>IP2LocationRecord *record = IP2Location_get_all(IP2LocationObj, \"161.11.12.13\");\n</code></pre>\n\n<p>thanks in advance!</p>\n"},{"tags":["asp.net","multithreading","server.transfer"],"answer_count":3,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":18255,"score":11,"question_id":1433448,"title":"Thread was being aborted","body":"<p>I am using <strong>Server.Transfer</strong>. Everything works fine, but exception log shows following exception.</p>\n\n<pre><code>System.Threading.ThreadAbortException: Thread was being aborted.\n   at System.Threading.Thread.AbortInternal()\n   at System.Threading.Thread.Abort(Object stateInfo)\n   at System.Web.HttpResponse.End()\n   at System.Web.HttpServerUtility.Transfer(String path, Boolean preserveForm)\n   at System.Web.HttpServerUtility.Transfer(String path)\n</code></pre>\n\n<p>Any idea to avoid above exception.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":344,"score":1,"question_id":9203195,"title":"Thread hanging causing other threads to hang","body":"<p>is the following method likely to cause a thread to hang which in turn causing other threads to hang that eventually building up a stack and crash the app server?</p>\n\n<pre><code>private static Hashtable content = new Hashtable();\nprivate static int cleanout;\n\nprivate static void cleanoutCache() {\n\n    if(cleanout &gt; 50000) {\n\n        synchronized(PollCacheManager.class) {\n\n            Enumeration emu = content.keys();\n\n            while(emu.hasMoreElements()) {\n\n                String key = (String)emu.nextElement();\n\n                PollCacheStore bean = (PollCacheStore)content.get(key);\n\n                if((System.currentTimeMillis() - bean.getLastInitialized()) &gt; 86400000) {\n\n                    content.remove(key);\n\n                }\n\n            }\n\n            // reset cleanout\n            cleanout = 0;\n\n        }\n\n    }\n\n}\n</code></pre>\n\n<p>Thanks for your help</p>\n\n<hr>\n\n<p>I've pasted a snapshot of the thread dump generated when running my test case simulating the issue I mentioned earlier in <a href=\"http://stackoverflow.com/questions/9203195/java-thread-hanging-causing-other-threads-to-hang\">my previous question</a>.</p>\n\n<p>All \"Servlet.Engine.Transports\" threads are those relevant to my application. It seems they all waiting on the monitor. But no further details were provided as to what resource they are waiting on. I'm a bit new in analysing these thread dumps. Doesn't seemed like a deadlock, not a race condition and not resource contention. However, in the result of my load testing tool, process hanging was obvious. Thanks for your help</p>\n\n<p>Full thread dump:</p>\n\n<pre><code>\"Thread-1727\" prio=5 tid=0x2aea620 nid=0x9a2 waiting on monitor [0xb6481000..0xb6481a00]\n    at java.lang.Thread.sleep(Native Method)\n    at com.ibm.websphere.personalization.util.timer.PznTimerEvents.run(PznTimerEvents.java:222)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Thread-1683\" daemon prio=5 tid=0x1a21668 nid=0x973 runnable [0xb4581000..0xb4581a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at java.io.BufferedInputStream.fill(BufferedInputStream.java:181)\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:220)\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:275)\n    at com.sun.jndi.ldap.Connection.run(Connection.java:581)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Thread-1682\" daemon prio=5 tid=0x4ed830 nid=0x972 runnable [0xb5301000..0xb5301a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at java.io.BufferedInputStream.fill(BufferedInputStream.java:181)\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:220)\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:275)\n    at com.sun.jndi.ldap.Connection.run(Connection.java:581)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Thread-1681\" daemon prio=5 tid=0x1ec1a20 nid=0x971 runnable [0xb5401000..0xb5401a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at java.io.BufferedInputStream.fill(BufferedInputStream.java:181)\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:220)\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:275)\n    at com.sun.jndi.ldap.Connection.run(Connection.java:581)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Servlet.Engine.Transports : 387\" daemon prio=5 tid=0x15386f8 nid=0x943 waiting on monitor [0xb4781000..0xb4781a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 385\" daemon prio=5 tid=0x51e898 nid=0x93e waiting on monitor [0xb3281000..0xb3281a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 384\" daemon prio=5 tid=0x464760 nid=0x93d waiting on monitor [0xb3381000..0xb3381a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 382\" daemon prio=5 tid=0x1141de8 nid=0x8a0 waiting on monitor [0xb3581000..0xb3581a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 380\" daemon prio=5 tid=0x1151ad8 nid=0x6b5 waiting on monitor [0xb3e81000..0xb3e81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 366\" daemon prio=5 tid=0x1a1d110 nid=0x3fb waiting on monitor [0xb4b81000..0xb4b81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 365\" daemon prio=5 tid=0x4e8bd8 nid=0x3fa waiting on monitor [0xb6281000..0xb6281a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 362\" daemon prio=5 tid=0x17055b0 nid=0x3f7 waiting on monitor [0xb3481000..0xb3481a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 356\" daemon prio=5 tid=0x1ddbae0 nid=0x3f1 waiting on monitor [0xb9c01000..0xb9c01a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Servlet.Engine.Transports : 299\" daemon prio=5 tid=0x2519028 nid=0x3b5 waiting on monitor [0xb6001000..0xb6001a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"SoapConnectorThreadPool : 3\" daemon prio=5 tid=0x15d49f0 nid=0x1ae waiting on monitor [0xb2e81000..0xb2e81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Alarm : 3\" daemon prio=5 tid=0x1d24c48 nid=0xa5 waiting on monitor [0xb6381000..0xb6381a00]\n    at java.lang.Object.wait(Native Method)\n    at com.ibm.ws.util.BoundedBuffer.poll(BoundedBuffer.java:192)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"Keep-Alive-Timer:\" daemon prio=8 tid=0x1ec9a38 nid=0x99 waiting on monitor [0xb3f81000..0xb3f81a00]\n    at java.lang.Thread.sleep(Native Method)\n    at sun.net.www.http.KeepAliveCache.run(KeepAliveCache.java:130)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Thread-64\" daemon prio=5 tid=0x4ee700 nid=0x98 waiting on monitor [0xb4081000..0xb4081a00]\n    at java.lang.Thread.sleep(Native Method)\n    at com.ibm.ejs.j2c.poolmanager.TaskTimer.run(TaskTimer.java:119)\n\n\"RT=7:P=908030:O=0:WSTCPTransportConnection[addr=10.24.189.74,port=47148,local=9812]\" daemon prio=5 tid=0x4c73f8 nid=0x97 runnable [0xb4181000..0xb4181a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at com.ibm.rmi.iiop.Connection.readMoreData(Connection.java:909)\n    at com.ibm.rmi.iiop.Connection.createInputStream(Connection.java:742)\n    at com.ibm.rmi.iiop.Connection.doReaderWorkOnce(Connection.java:2447)\n    at com.ibm.rmi.transport.ReaderThread.run(ReaderPoolImpl.java:138)\n\n\"RT=6:P=908030:O=0:WSTCPTransportConnection[addr=10.24.189.74,port=9812,local=47148]\" daemon prio=5 tid=0x3b7860 nid=0x96 runnable [0xb4281000..0xb4281a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at com.ibm.rmi.iiop.Connection.readMoreData(Connection.java:909)\n    at com.ibm.rmi.iiop.Connection.createInputStream(Connection.java:742)\n    at com.ibm.rmi.iiop.Connection.doReaderWorkOnce(Connection.java:2447)\n    at com.ibm.rmi.transport.ReaderThread.run(ReaderPoolImpl.java:138)\n\n\"Thread-63\" daemon prio=5 tid=0x1666990 nid=0x91 waiting on monitor [0xb4681000..0xb4681a00]\n    at java.lang.Thread.sleep(Native Method)\n    at com.ibm.ws.management.RoutingTable$PingThread.run(RoutingTable.java:1025)\n\n\"ProcessDiscovery : 0\" daemon prio=5 tid=0x1c7b4c8 nid=0x8b waiting on monitor [0xb4881000..0xb4881a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"SoapConnectorThreadPool : 2\" daemon prio=5 tid=0x1b82798 nid=0x8a waiting on monitor [0xb4981000..0xb4981a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"SoapConnectorThreadPool : 1\" daemon prio=5 tid=0x1505188 nid=0x89 waiting on monitor [0xb4a81000..0xb4a81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"ORB.thread.pool : 1\" daemon prio=5 tid=0x24cfd20 nid=0x83 waiting on monitor [0xb4c81000..0xb4c81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"ORB.thread.pool : 0\" daemon prio=5 tid=0x15025c0 nid=0x82 waiting on monitor [0xb4d81000..0xb4d81a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.ws.util.BoundedBuffer.take(BoundedBuffer.java:161)\n    at com.ibm.ws.util.ThreadPool.getTask(ThreadPool.java:422)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:669)\n\n\"RT=5:P=908030:O=0:WSSSLTransportConnection[addr=10.25.168.38,port=33762,local=46854]\" daemon prio=5 tid=0x1520f20 nid=0x81 runnable [0xb4e81000..0xb4e81a00]\n    at java.net.SocketInputStream.socketRead(Native Method)\n    at java.net.SocketInputStream.read(SocketInputStream.java:85)\n    at com.ibm.sslite.t.a(Unknown Source)\n    at com.ibm.sslite.t.b(Unknown Source)\n    at com.ibm.sslite.t.a(Unknown Source)\n    at com.ibm.sslite.a.read(Unknown Source)\n    at com.ibm.jsse.a.read(Unknown Source)\n    at com.ibm.rmi.iiop.Connection.readMoreData(Connection.java:909)\n    at com.ibm.rmi.iiop.Connection.createInputStream(Connection.java:742)\n    at com.ibm.rmi.iiop.Connection.doReaderWorkOnce(Connection.java:2447)\n    at com.ibm.rmi.transport.ReaderThread.run(ReaderPoolImpl.java:138)\n\n\"Thread-53\" prio=5 tid=0x29558 nid=0x1 waiting on monitor [0..0xffbedb10]\n\n\"java.net.MulticastSocket@4b3966\" prio=5 tid=0x17dacf8 nid=0x80 runnable [0xb4f81000..0xb4f81a00]\n    at java.net.PlainDatagramSocketImpl.receive(Native Method)\n    at java.net.DatagramSocket.receive(DatagramSocket.java:387)\n    at com.ibm.ws.management.discovery.transport.MulticastServer.run(MulticastServer.java:196)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=9044]\" prio=5 tid=0x157f330 nid=0x7f runnable [0xb5981000..0xb5981a00]\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:463)\n    at java.net.ServerSocket.implAccept(ServerSocket.java:238)\n    at java.net.ServerSocket.accept(ServerSocket.java:217)\n    at com.ibm.jsse.bg.accept(Unknown Source)\n    at com.ibm.ws.http.HttpTransport.run(HttpTransport.java:235)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=9091]\" prio=5 tid=0x15d10c0 nid=0x7e runnable [0xb5a81000..0xb5a81a00]\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:463)\n    at java.net.ServerSocket.implAccept(ServerSocket.java:238)\n    at java.net.ServerSocket.accept(ServerSocket.java:217)\n    at com.ibm.ws.http.HttpTransport.run(HttpTransport.java:235)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=9444]\" prio=5 tid=0x1693c28 nid=0x7d runnable [0xb5b81000..0xb5b81a00]\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:463)\n    at java.net.ServerSocket.implAccept(ServerSocket.java:238)\n    at java.net.ServerSocket.accept(ServerSocket.java:217)\n    at com.ibm.jsse.bg.accept(Unknown Source)\n    at com.ibm.ws.http.HttpTransport.run(HttpTransport.java:235)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=9081]\" prio=5 tid=0x24d2f78 nid=0x7c runnable [0xb5e01000..0xb5e01a00]\n    at java.net.PlainSocketImpl.socketAccept(Native Method)\n    at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:463)\n    at java.net.ServerSocket.implAccept(ServerSocket.java:238)\n    at java.net.ServerSocket.accept(ServerSocket.java:217)\n    at com.ibm.ws.http.HttpTransport.run(HttpTransport.java:235)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"Dispatcher-Thread-52\" daemon prio=1 tid=0x509da0 nid=0x7b waiting on monitor [0xb5f01000..0xb5f01a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at org.apache.log4j.Dispatcher.run(AsyncAppender.java:293)\n\n\"Thread-51\" prio=5 tid=0x254138 nid=0x7a waiting on monitor [0xb5c81000..0xb5c81a00]\n    at java.lang.Thread.sleep(Native Method)\n    at com.ibm.wcm.jobs.Scheduler.run(Scheduler.java:68)\n    at java.lang.Thread.run(Thread.java:479)\n\n\"wcp_1328597020006\" prio=5 tid=0x2a5c628 nid=0x76 waiting on monitor [0xb6101000..0xb6101a00]\n    at java.lang.Object.wait(Native Method)\n    at java.lang.Object.wait(Object.java:415)\n    at com.ibm.wcp.analysis.util.MultiAccessQueue.dequeue(MultiAccessQueue.java:223)\n    at com.ibm.wcp.analysis.event.ListenerThread.run(ListenerThread.java:87)\n</code></pre>\n\n<p>.....more (due to character limit here)</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12987602,"title":"Threads update previous created thread variable?","body":"<p>I am trying to do something as follows - </p>\n\n<ol>\n<li>A thread is created</li>\n<li>When new Thread is created it updates previous thread's variable <code>limit</code></li>\n<li>Progress repeats for 3rd Thread, i.e. this thread updates variable <code>limit</code> for Thread ID1 and ID2..</li>\n</ol>\n\n<p>Here's some sample code</p>\n\n<p><strong>Main Class</strong></p>\n\n<pre><code>public class TaskImplementer {\n    public static int End;\n    public static int threadCount = 5;\n\n    public static void main(String[] args) {\n    int i=0;\n\n    findEnd();\n\n    while (i &lt; threadCount) {\n        if(isPossible()) {      // check for some condition\n        createThread aThread = new createThread(i, End);\n        aThread.start();\n        }\n        i++;\n        //updateGUI();  //updateGUI - show working Threads\n    }\n    }\n\n    private static void findEnd() {\n    //updates End variable\n    }\n\n    private static boolean isPossible() {\n    //.....\n    //Check for a condition\n    return false;\n\n    }\n}\n</code></pre>\n\n<p><strong>createThread class</strong></p>\n\n<pre><code>public class createThread extends Thread {\n    private static int ID;\n    private static int limit;\n    private static int startfromSomething;\n\n    public createThread(int ThreadID, int End) {\n    ID = ThreadID;\n    limit = End;\n    }\n\n    private void doSomething() {\n    //does work\n    }\n\n    @Override\n    public void run() {\n\n    while(startfromSomething &lt; limit) {\n        doSomething();\n    }\n    TaskImplementer.i--;\n    }\n\n}\n</code></pre>\n\n<p>The variable <code>limit</code> needs to be updated by each Thread on successful creation. Is it possible, please suggest something. Thanks in advance.</p>\n"},{"tags":["android","multithreading","android-asynctask","android-activity"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13223289,"title":"AsyncTask Doesn't Resume When Coming Back to Activity Through ActionBar Back Icon","body":"<p>I have an <code>AsyntTask</code> which starts in <code>onCreate</code> and loops infinitely, updating an UI element.</p>\n\n<p>The update is done in this manner (simplified representation of the Async extending class, let's call it <code>asyncExtender().execute()</code>):</p>\n\n<pre><code>doInBackground(){\n    while (!isCancelled()) {\n        Thread.sleep(2000);\n        publishProgress(someValue);\n    }\n}\nprotected void onProgressUpdate() {\n    super.onProgressUpdate(values);\n    // UI update here, e.g. TextView.setText\n}\n</code></pre>\n\n<p>Another activity is started, let's call it SecondActivity. SecondActivity takes advantage of the hierarchical back button in the action bar to return to the previous activity (<code>NavUtils.navigateUpFromSameTask(this)</code> in <code>onOptionsItemSelected</code>).</p>\n\n<p>The issues is that when I tap on the back button <strong>in the action bar</strong> in SecondActivity, the AsyncTask seems to not run anymore in the first activity (the UI doesn't get updated every 2 seconds). On the other hand, if I use <strong>the hardware \"back\" button it works fine</strong> - the AsyncTask keeps running.</p>\n\n<p>Why the difference in behaviour and how to fix it?</p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":43,"score":-1,"question_id":13232504,"title":"Call Method in MultiThreading","body":"<p>I need to call a method multiple time, Using thread.</p>\n\n<p>For Example :</p>\n\n<p><strong>Method:</strong></p>\n\n<pre><code>   private void add(int a, int b)\n        {\n            Console.WriteLine(a + b);\n        }\n</code></pre>\n\n<p><strong>Call</strong></p>\n\n<pre><code>private void call()\n        {\n            for (int i = 0; i &lt; 10; i++)\n            {\n                add(i, 2);\n            }\n        }\n</code></pre>\n\n<p><strong>above is just a example</strong> Like this i need to call add() method in Multithread with different parameter.</p>\n"},{"tags":["c","linux","multithreading","pthreads"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":103,"score":1,"question_id":13232119,"title":"Memory usage doesn't decrease when free() used","body":"<p>I am writing OS independent lockless queue, so far it works great, but there is small problem with memory managment. I am not sure if its gcc problem or mine. Problem: Memory increases when element is added to list, but when element is removed from list (free(elementPointer);) memory usage don't change. </p>\n\n<p>BUT when I use pthreads, N producers and M consumers  <code>(1&lt;N&lt;20, 1&lt;M&lt;20)</code> memory usage is about ~10mb all the time (when trying to add and remove ~10kk elements), so looks like free is working.</p>\n\n<p>And funny thing is that in VS 2010 (same code, no threads) free works fine, memory is released (watched task manager).</p>\n\n<p>I made test, added 1kk elements, after adding all, removed one by one all elements (no threads).</p>\n\n<p>Linux - 0.08 seconds</p>\n\n<p>Windows ~57 seconds</p>\n\n<p>Linux(without free) - 0.07 seconds</p>\n\n<p>Windows(without free) - 0.9 seconds</p>\n\n<p>So, the question is, why memory isn't freed in Linux C when no threads are used ?\nI can post code if necessary .</p>\n\n<p>GCC version: 4.4.3</p>\n"},{"tags":["java","multithreading","swing","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":74,"score":3,"question_id":13228442,"title":"Wait until child Thread Finishe, But Do Not Block Main Thread","body":"<p>I have been working on a java GUI application that on a particular action do some task. I have been doing this task using ExecutorService. Now the working with multiple threads works fine but the problem is that I do not want to block my GUI. User may want to cancel the current operation and may request for another one. But while using the ExecutorService, my main Thread gets blocked. I want to wait for my child threads to finish, invoked using ExecutorService, while still being able to work on GUI.</p>\n\n<p>The updated code is:</p>\n\n<pre><code>    ExecutorService child = Executors.newCachedThreadPool();\nExecutorService es = Executors.newCachedThreadPool();\n\n@Action\npublic void doAction() {\n    /** Some Code goes here */\n    if(Condition){\n        if(!(es.isTerminated()||es.isShutdown())){\n            es.shutdownNow();\n            es = Executors.newCachedThreadPool();\n        }\n        es.execute(new Runnable() {\n            public void run() {\n                if(!(child.isTerminated()||child.isShutdown())){\n                    child.shutdownNow();\n                    child = Executors.newCachedThreadPool();\n                }\n                for(loopConditions){\n                    child.execute(new Runnable() {\n                        public void run() {\n                            //Perform Some Task Here\n                        }\n                    });\n                }\n                child.shutdown();\n                try {\n                    boolean finshed = child.awaitTermination(5, TimeUnit.MINUTES);\n                } catch (InterruptedException ex) {\n                    child.shutdownNow();\n                    Logger.getLogger(MySearchView.class.getName()).log(Level.SEVERE, null, ex);\n                }\n                System.out.println(\"All Child Threads finished Execution\");\n            }\n        });\n        es.shutdown();\n        try {\n            boolean finshed = es.awaitTermination(5, TimeUnit.MINUTES);\n        } catch (InterruptedException ex) {\n            es.shutdownNow();\n            Logger.getLogger(MySearchView.class.getName()).log(Level.SEVERE, null, ex);\n        }\n        System.out.println(\"All Threads finished Execution\");\n        /**\n        * Code that should run after all Threads finishes their Execution\n        */\n    }\n}\n</code></pre>\n"},{"tags":["wpf","multithreading","animation","freeze"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13232917,"title":"WPF animation freezes even if I use new Thread","body":"<p>I am facing a big issue : In my WPF app, the MainWindow contains a Border with a Loading Animation (storyboard). By default it's collapsed. I sometimes make it visible and collapsed when I load a lot of data or when I'm loading a new XAML screen.</p>\n\n<p>First of all, I wasn't using Threading at all and the  animation where both freezing and appearing with lates.</p>\n\n<p>Then I began to use Threading like this :</p>\n\n<pre><code>Messenger.StartAnimation();\nvar task = Task.Factory.StartNew(() =&gt;\n                {\n                    Thread.Sleep(150);\n                }).ContinueWith((a) =&gt;\n                {\n                    // HERE Screen moving + large amount of data loaded with Entity Framework\n                    Thread.Sleep(200);\n\n                    Messenger.StopAnimation();\n                }, CancellationToken.None, TaskContinuationOptions.NotOnFaulted, threadUIContext);\n</code></pre>\n\n<p>This time, the animation worked during 1 second and then it just freezed until all data and new displayed screen where loaded. A It's like the main thread blocks ALL threads.</p>\n\n<p>I've tried to add Timer to Delay my <code>Messenger.StopAnimation()</code> to 3 seconds later. Even this will freeze my animation for 1 second when everything is being changed and loaded on my new screen and then my animation continues for 3 seconds.</p>\n\n<p>I've tried <code>Dispatcher</code>, <code>BackgroundWorker</code> and met same problem that with previous code.</p>\n\n<p>I've tried to put my animation on a popup and even on a new Window which was Transparent. Nothing to do, it always end up freezing for 1 second before stopping...</p>\n\n<p>For info, I use <code>ObservableCollection</code> (I've tried with List, same problem) and I load different screens inside a <code>ContentControl</code> in my <code>MainWindow</code>.</p>\n\n<p>I've watched the techdays video, Fast and Furious and I really wanted to get a smooth animation like on the video, but the freeze seems impossible to remove.</p>\n\n<p>I really need your help on this one. Thanks in advance !</p>\n"},{"tags":["java","multithreading","swing","jlabel"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13226164,"title":"how to move jlabel every second?","body":"<p>i try to move it to the right(x++) every seconds</p>\n\n<p>i try to  move it with thread..</p>\n\n<ol>\n<li>how to do it? (and can see it move every second)</li>\n<li>there are another way to do it without use thread?</li>\n<li>what layout manager that i should use?</li>\n</ol>\n\n<p>heres i try..</p>\n\n<pre><code>public class help {\n    JFrame frame = new JFrame();\n    JLabel label = new JLabel(\"target\");\n\n    public help() {\n        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);\n        frame.setSize(800,600);\n        frame.setLayout(new GridLayout());\n        frame.add(label);\n        label.setPreferredSize(new Dimension(100,100));\n        label.setLocation(400, 300);\n\n        frame.getContentPane().validate();\n        frame.repaint();\n        frame.setVisible(true);\n\n        mysterious();\n    }\n\n    void mysterious(){\n     ////////////////////////////////\n     // part of edit responding David kroukamp  \n    Thread t = new Thread(new Runnable() {\n    @Override\n    public void run() {\n         try{\n\n            for (int z=0; z&lt;10; z++){\n            label.setLocation((label.getLocationOnScreen().x+10), label.getLocationOnScreen().y);\n            Thread.sleep(1000);  \n            } \n        }catch(Exception ae){\n\n    }\n    }\n});\nt.start();\n    //////////////////////////////\n\n\n\n    }\n    public static void main(String[]args){\n        new help();  \n        }\n}\n</code></pre>\n\n<p>thanks a lot for any kind of help</p>\n"},{"tags":["c#","wpf","multithreading","dispatcher"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13230017,"title":"Using ObservableCollection on a new thread","body":"<p>A few days ago I created <a href=\"http://stackoverflow.com/questions/13192247/view-is-not-updated-when-on-a-separate-thread\">this thread</a> because I was unable to update an ObservableCollection from another thread.\nThis was the solution from the thread:</p>\n\n<pre><code>Dispatcher.CurrentDispatcher.BeginInvoke(new Action(delegate\n{\n    TheTVDB theTvdb = new TheTVDB();\n    foreach (TVSeries tvSeries in theTvdb.SearchSeries(\"Dexter\"))\n    {\n        this.Overview.Add(tvSeries);\n    }\n}),\nDispatcherPriority.Background);\n</code></pre>\n\n<p>However, it seems that this is not really the solution as the UI still freezes while doing executing the delegate. My guess is that the above does not really run anything on another thread but instead dispatches it all to the UI thread.\nSo what I really want to do is to create a new thread myself and do the loading (this happens in <code>theTvdb.SearchSeries()</code>). Then I will iterate over the results and add those to my <code>ObservableCollection</code> and this must happen on the UI thread.</p>\n\n<p>Does this approach sound right?</p>\n\n<p>I came up with the below which I thought would load the results and add those to the ObervableCollection and show them in my list view without the UI freezing.</p>\n\n<pre><code>Thread thread = new Thread(new ThreadStart(delegate\n{\n    TheTVDB theTvdb = new TheTVDB();\n    List&lt;TVSeries&gt; dexter = theTvdb.SearchSeries(\"Dexter\");\n\n    foreach (TVSeries tvSeries in dexter)\n    {\n        Dispatcher.CurrentDispatcher.BeginInvoke(new Action(delegate\n        {\n            this.Overview.Add(tvSeries);\n        }),\n        DispatcherPriority.Normal);\n    }\n}));\nthread.SetApartmentState(ApartmentState.STA);\nthread.Start();\n</code></pre>\n\n<p>The above does not produce any error. Instead nothing happens. The UI does not freeze but it is not updated. The objects in <code>Overview</code> is not presented in the UI and I have tested that the binding is correct. The objects will show correctly if I don't load them and add them to the <code>ObservableCollection</code> on another thread.</p>\n\n<p>Another solution I have tried is to use the <a href=\"http://stackoverflow.com/a/2104705/486845\">MTObservableCollection from this answer</a> to a similar question. When using that subclass of the <code>ObservableCollection</code>, I did not dispatch anything myself. This gave me the following error:</p>\n\n<blockquote>\n  <p>Must create DependencySource on same Thread as the DependencyObject.</p>\n</blockquote>\n\n<p>Can anybody please tell me how I can:</p>\n\n<ol>\n<li>Load something on a separate thread</li>\n<li>Use the results from step 1 to update an ObservableCollection which is bound to a listview</li>\n<li>Have the results shown in the UI without the UI freezing</li>\n</ol>\n\n<p>I hope you can help me further.</p>\n\n<p><strong>UPDATE</strong>:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;UserControl\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n    xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n    xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n    xmlns:acb=\"clr-namespace:AttachedCommandBehavior\"\n    mc:Ignorable=\"d\"\n    x:Class=\"TVSeriesLibrary.OverviewView\"\n    x:Name=\"UserControl\"\n    d:DesignWidth=\"512\"\n    d:DesignHeight=\"480\"&gt;\n\n    &lt;UserControl.Resources&gt;\n        &lt;DataTemplate x:Key=\"CoverTemplate\"&gt;\n            &lt;StackPanel Orientation=\"Horizontal\"&gt;\n                &lt;Image Width=\"82\" Height=\"85\" Stretch=\"Fill\" Source=\"{Binding Cover}\" Margin=\"10,10,0,10\"/&gt;\n            &lt;/StackPanel&gt;\n        &lt;/DataTemplate&gt;\n    &lt;/UserControl.Resources&gt;\n\n    &lt;Grid x:Name=\"LayoutRoot\" Background=\"#515050\"&gt;\n        &lt;Grid.Resources&gt;\n            &lt;ResourceDictionary&gt;\n                &lt;Style x:Key=\"ItemContStyle\" TargetType=\"{x:Type ListViewItem}\"&gt;\n                    &lt;Setter Property=\"Background\" Value=\"#282828\" /&gt;\n                    &lt;Setter Property=\"Margin\" Value=\"0,0,0,5\" /&gt;\n                    &lt;Setter Property=\"Padding\" Value=\"0\" /&gt;\n                &lt;/Style&gt;\n            &lt;/ResourceDictionary&gt;\n        &lt;/Grid.Resources&gt;\n\n        &lt;ListView Height=\"112\"\n                  Width=\"488\"\n                  Margin=\"12,150,12,218\"\n                  Foreground=\"#ffffff\"\n                  Background=\"#515050\"\n                  VerticalContentAlignment=\"Center\"\n                  BorderThickness=\"0\"\n                  ItemTemplate=\"{StaticResource CoverTemplate}\"\n                  ItemsSource=\"{Binding Overview}\"&gt;\n            &lt;ListView.ItemsPanel&gt;\n                &lt;ItemsPanelTemplate&gt;\n                    &lt;WrapPanel Orientation=\"Horizontal\" /&gt;\n                &lt;/ItemsPanelTemplate&gt;\n            &lt;/ListView.ItemsPanel&gt;\n        &lt;/ListView&gt;\n\n        &lt;ListView Height=\"170\"\n                  Margin=\"10,298,10,0\"\n                  VerticalAlignment=\"Center\"\n                  Foreground=\"#ffffff\"\n                  Background=\"#515050\"\n                  VerticalContentAlignment=\"Center\"\n                  BorderThickness=\"0\"\n                  Width=\"488\" ScrollViewer.HorizontalScrollBarVisibility=\"Disabled\"\n                  ItemsSource=\"{Binding Path=Overview}\"\n                  SelectedItem=\"{Binding Path=SelectedTVSeries}\"\n                  ItemContainerStyle=\"{StaticResource ItemContStyle}\"&gt;\n            &lt;ListView.Resources&gt;\n                &lt;ResourceDictionary&gt;\n                    &lt;Style x:Key=\"hiddenStyle\" TargetType=\"GridViewColumnHeader\"&gt;\n                        &lt;Setter Property=\"Visibility\" Value=\"Collapsed\"/&gt;\n                    &lt;/Style&gt;\n                &lt;/ResourceDictionary&gt;\n            &lt;/ListView.Resources&gt;\n            &lt;ListView.View&gt;\n                &lt;GridView&gt;\n                    &lt;GridViewColumn Header=\"Cover\" Width=\"auto\" HeaderContainerStyle=\"{StaticResource hiddenStyle}\"&gt;\n                        &lt;GridViewColumn.CellTemplate&gt;\n                            &lt;DataTemplate&gt;\n                                &lt;Image Source=\"{Binding Path=Cover}\" Height=\"50\" Margin=\"-6,0,0,0\" /&gt;\n                            &lt;/DataTemplate&gt;\n                        &lt;/GridViewColumn.CellTemplate&gt;\n                    &lt;/GridViewColumn&gt;\n\n\n                    &lt;GridViewColumn Header=\"Title\" Width=\"200\" HeaderContainerStyle=\"{StaticResource hiddenStyle}\"&gt;\n                        &lt;GridViewColumn.CellTemplate&gt;\n                            &lt;DataTemplate&gt;\n                                &lt;TextBlock Text=\"{Binding Path=Name}\" FontWeight=\"Bold\"&gt;&lt;/TextBlock&gt;\n                            &lt;/DataTemplate&gt;\n                        &lt;/GridViewColumn.CellTemplate&gt;\n                    &lt;/GridViewColumn&gt;\n\n                    &lt;GridViewColumn Header=\"Year\" Width=\"100\" HeaderContainerStyle=\"{StaticResource hiddenStyle}\"&gt;\n                        &lt;GridViewColumn.CellTemplate&gt;\n                            &lt;DataTemplate&gt;\n                                &lt;TextBlock Text=\"{Binding Path=DisplayYear}\"&gt;&lt;/TextBlock&gt;\n                            &lt;/DataTemplate&gt;\n                        &lt;/GridViewColumn.CellTemplate&gt;\n                    &lt;/GridViewColumn&gt;\n\n                    &lt;GridViewColumn Header=\"Button\" Width=\"135\" HeaderContainerStyle=\"{StaticResource hiddenStyle}\"&gt;\n                        &lt;GridViewColumn.CellTemplate&gt;\n                            &lt;DataTemplate&gt;\n                                &lt;Button Content=\"Details\" Width=\"100\" Height=\"20\" /&gt;\n                            &lt;/DataTemplate&gt;\n                        &lt;/GridViewColumn.CellTemplate&gt;\n                    &lt;/GridViewColumn&gt;\n\n                &lt;/GridView&gt;\n            &lt;/ListView.View&gt;\n        &lt;/ListView&gt;\n    &lt;/Grid&gt;\n\n&lt;/UserControl&gt;\n</code></pre>\n"},{"tags":["python","multithreading","asynchronous","twisted"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13112984,"title":"Threads vs Asynchronous Networking (Twisted) Python","body":"<p>I am writing an implementation of a NAT.  My algorithm is as follows:</p>\n\n<ol>\n<li>Packet comes in</li>\n<li>Check against lookup table if external, add to lookup table if internal</li>\n<li>Swap the source address and send the packet on its way</li>\n</ol>\n\n<p>I have been reading about Twisted.  I was curious if Twisted takes advantage of multicore CPUs?  Assume the system has thousands of users and one packet comes right after the other.  With twisted can the lookup table operations be taking place at the same time on each core.  I hear with threads the GIL will not allow this anyway.  Perhaps I could benifit from multiprocessing></p>\n\n<p>Nginix is asynchronous and happily serves thousands of users at the same time.</p>\n"},{"tags":["c#","multithreading","client-server"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":34,"score":3,"question_id":13227701,"title":"multi thread client sending burst string to server","body":"<p>I was about making client server string sending and receiving using networkstream. and I want to replace 1000 client into one application using thread and thread.join. But i cannot solve this problem. Thanks for the reply.</p>\n\n<pre><code>private void button1_Click(object sender, RoutedEventArgs e)\n    {\n        sc = new SocketMe();\n        sc.socketStart();\n        for (int i = 0; i &lt; 10; i++)\n        {\n            //sc = new SocketMe();\n            //this.Dispatcher.Invoke((Action)(() =&gt;\n            //{\n            nomor[i] = new Thread(sc.execution);\n            nomor[i].Start(10);\n            //}));\n        }\n    }\npublic class SocketMe\n{\n    public NetworkStream serverStream; \n    MainWindow mw = new MainWindow();\n    public void socketStart()\n    {\n        mw.clientSocket = new TcpClient();\n        try\n        {\n            mw.clientSocket.Connect(\"localhost\", 4000);\n        }\n        catch (Exception e)\n        {\n            //mw.label3.Content = \"Error ....\" + e.StackTrace;\n        }\n    }\n    public void StringtoSend(String x)\n    {\n        try\n        {\n            socketStart();\n            serverStream = mw.clientSocket.GetStream();\n            byte[] outStream = System.Text.Encoding.ASCII.GetBytes(x);\n            serverStream.Write(outStream, 0, outStream.Length);\n            serverStream.Flush();\n\n            byte[] inStream = new byte[10025];\n            serverStream.Read(inStream, 0, (int)mw.clientSocket.ReceiveBufferSize);\n            string returndata = System.Text.Encoding.ASCII.GetString(inStream);\n            //textBox2.Text = \"Data from Server : \" + returndata;\n            Console.WriteLine(\"Data from Server : \" + returndata); \n        }\n        catch (Exception ex)\n        {\n            //mw.label3.Content = ex.StackTrace;\n        }\n    }\n    public void execution(object data)\n    {\n        socketStart();\n        string[] pertanyaan = { \"one\", \"two\", \"three\", \"four\", \"five\", \"six\", \"seven\", \"eight\", \"nine\", \"ten\" ,\"'{0}'\"};//isi one dengan pertanyaan-pertanyaan yang diinginkan\n        int i;\n        for (i = 0; i &lt; 10; i++)\n        {\n            StringtoSend(pertanyaan[i]);\n            Thread.Sleep(1000);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13115907,"title":"Multi thread with window service in asp.net","body":"<p>Can I use the same process in multiple threads?</p>\n\n<p>There are 5 categories:</p>\n\n<ul>\n<li>1 category - 100000 mail send</li>\n<li>2 category - 10000 mail send</li>\n<li>3 category - 200000 mail send</li>\n<li>4 category - 1000 mail send</li>\n<li>5 category - 300000 mail send</li>\n</ul>\n\n<p>that are using <em>two threads</em>.</p>\n\n<p>Thread time to send mail for each cateogry: [Thread 1] Took 40 mins for category 1; [Thread 2] took 10 mins for category 2\n[Category 3] should be picked up by Thread 2 and after that randomly taking other categories. I am using Asp.net with Window service in backgorund process.</p>\n\n<p>This is the method to get the mail detail : <code>SendNewsLatterStatus</code>\nso that [Category 3] is continuing with Thread 2 and after that randomly taking \ncategory in Thread .. \nIn asp.net with Window service in backgorund process.</p>\n\n<pre><code>            NewsLatterThread1 = new Thread(new ThreadStart(SendNewsLatterStatus));\n            NewsLatterThread1.Name = \"NewsLatter1\";\n\n            NewsLatterThread2 = new Thread(new ThreadStart(SendNewsLatterStatus));\n            NewsLatterThread2.Name = \"NewsLatter2\";\n\n            NewsLatterThread1.Start();\n            NewsLatterThread2.Start();\n\n            NewsLatterThread1.Join();\n            NewsLatterThread2.Join();\n\n            NewsLatterThread1.Abort();\n            NewsLatterThread2.Abort();\n</code></pre>\n\n<p>It's not properly working what is the mistake for that </p>\n"},{"tags":["java","multithreading","web-services","simulation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13227366,"title":"A good way to simulate large number of user request to a web service?","body":"<p>I have a web service that makes of different tomcat containers. They perform different tasks in the web service system. For example, some of them serve as login services, some serve as registration services, some serve as RESTapi services. </p>\n\n<p>I want to simulate large number of different user requests, say more than 10,000 at the same time, to find out where the bottleneck of the web service is as well as to test the stability of the system.</p>\n\n<p>Is there a good way to simulate that using java? As I know, using java multi-thread has a limited number of threads depending on different JVM or OS. So are there other better ways to simulate those requests?</p>\n\n<p>Thanks in advance :-)</p>\n"}]}
{"total":30059,"page":3,"pagesize":100,"questions":[{"tags":["c++","multithreading","network-programming","tbb","lock-free"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13229311,"title":"Intel TBB tasks for serving network connections - good model?","body":"<p>I'm developing a backend for a networking product, that serves a dozen of clients (<code>N</code> = 10-100). Each connection requires 2 periodic tasks, the heartbeat, and downloading of telemetry via SSH, each at <code>H</code> Hz. There are also extra events of different kind coming from the frontend. By nature of every of the tasks, there is a solid part of waiting in <code>select</code> call on each connection's socket, which allows OS to switch between threads often to serve other clients while waiting for response. </p>\n\n<p>In my initial implementation, I create 3 threads per connection (heartbeat, telemetry, extra), each waiting on a single condition variable, which is poked every time there is something to do in a workqueue. The workqueue is filled with the above-mentioned periodic events using a timer and commands from the frontend.</p>\n\n<p>I have a few questions here.</p>\n\n<ol>\n<li><p>Would it be a good idea to switch a worker thread pool approach to Intel TBB tasks? If so, to which value of threads do I need to initialize <code>tbb::task_scheduler_init</code>? </p></li>\n<li><p>In the current approach with 300 threads waiting on a conditional variable, which is <code>signal</code>ed <code>N * H * 3</code> times per second, it is likely to become a bottleneck for scalability (especially on the side which calls <code>signal</code>). Are there any better approaches for waking up just one worker per task?</p></li>\n<li><p>How is waking of a worker thread implemented in TBB?</p></li>\n</ol>\n\n<p>Thanks for your suggestions!</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13157427,"title":"Java ExecutorService only running 2 threads not four","body":"<p>I am working on an application that retrieves files from different URL's. </p>\n\n<p>There is a TreeSet that contains the target to download. This is processed in a loop with each item being called with an ExecutorService. Here's some code:</p>\n\n<pre><code>private void retrieveDataFiles() {\n    if (this.urlsToRetrieve.size() &gt; 0) {\n        System.out.println(\"Target URLs to retrieve: \" + this.urlsToRetrieve.size());\n        ExecutorService executorProcessUrls = Executors.newFixedThreadPool(this.urlsToRetrieve.size());//could use fixed pool based on size of urls to retrieve\n        for (Entry target : this.urlsToRetrieve.entrySet()) {\n            final String fileName = (String) target.getKey();\n            final String url = (String) target.getValue();\n\n            String localFile = localDirectory + File.separator + fileName;\n            System.out.println(localFile);\n            executorProcessUrls.submit(new WikiDumpRetriever(url, localFile));\n            dumpFiles.add(localFile); \n            //TODO: figure out why only 2 files download\n        }\n        executorProcessUrls.shutdown();\n        try {\n            executorProcessUrls.awaitTermination(Long.MAX_VALUE, TimeUnit.NANOSECONDS);\n        } catch (InterruptedException ex) {\n            System.out.println(\"retrieveDataFiles InterruptedException: \" + ex.getMessage());\n        }\n    } else {\n        System.out.println(\"No target URL's were retrieved\");\n    }\n}\n</code></pre>\n\n<p>Then the WikiDumpRetriever:</p>\n\n<pre><code>private static class WikiDumpRetriever implements Runnable {\n\n    private String wikiUrl;\n    private String downloadTo;\n\n    public WikiDumpRetriever(String targetUrl, String localDirectory) {\n        this.downloadTo = localDirectory;\n        this.wikiUrl = targetUrl;\n    }\n\n    public void downloadFile() throws FileNotFoundException, IOException, URISyntaxException {\n        HTTPCommunicationGet httpGet = new HTTPCommunicationGet(wikiUrl, \"\");\n        httpGet.downloadFiles(downloadTo);\n    }\n\n    @Override\n    public void run() {\n        try {\n            downloadFile();\n        } catch (FileNotFoundException ex) {\n            System.out.println(\"WDR: FileNotFound \" + ex.getMessage());\n        } catch (IOException ex) {\n            System.out.println(\"WDR: IOException \" + ex.getMessage());\n        } catch (URISyntaxException ex) {\n            System.out.println(\"WDR: URISyntaxException \" + ex.getMessage());\n        }\n    }\n}\n</code></pre>\n\n<p>As you can see this is an inner class. The TreeSet contains:</p>\n\n<p>Key : Value</p>\n\n<p>enwiki-latest-pages-articles.xml.bz2 : <a href=\"http://dumps.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2\" rel=\"nofollow\">http://dumps.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2</a></p>\n\n<p>elwiki-latest-pages-articles.xml.bz2 : <a href=\"http://dumps.wikimedia.org/enwiki/latest/elwiki-latest-pages-articles.xml.bz2\" rel=\"nofollow\">http://dumps.wikimedia.org/enwiki/latest/elwiki-latest-pages-articles.xml.bz2</a></p>\n\n<p>zhwiki-latest-pages-articles.xml.bz2 : <a href=\"http://dumps.wikimedia.org/enwiki/latest/zhwiki-latest-pages-articles.xml.bz2\" rel=\"nofollow\">http://dumps.wikimedia.org/enwiki/latest/zhwiki-latest-pages-articles.xml.bz2</a></p>\n\n<p>hewiki-latest-pages-articles.xml.bz2 : <a href=\"http://dumps.wikimedia.org/enwiki/latest/hewiki-latest-pages-articles.xml.bz2\" rel=\"nofollow\">http://dumps.wikimedia.org/enwiki/latest/hewiki-latest-pages-articles.xml.bz2</a></p>\n\n<p>The problem is that this process downloads 2 of the four files. I know that all four are available and I know that they can be downloaded. However, only 2 of them process at any time.</p>\n\n<p>Can anyone shed any light on this for me please - what am I missing or what am I getting wrong?</p>\n\n<p>Thanks\nnathj07</p>\n"},{"tags":["java","multithreading","java-ee"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":80,"score":2,"question_id":13229621,"title":"Are Threads in Java platform dependent?","body":"<p>It is obvious that OS scheduling/ threading algorithms have their impact on Java threads but </p>\n\n<p>can we safely say that Threads are OS/machine dependant?</p>\n\n<p>If this is the case then doesn't it make Java platform dependant?</p>\n"},{"tags":["c#","multithreading","backgroundworker","dispatcher"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13222394,"title":"Simple task without freezing the gui","body":"<p>I came across with a little problem. I have two threads one that executes a loop that needs to return/send a number to the GUI's thread every time. For this I use the <b> BackGroundWorker </b> and the <b> ReportProgress </b>.</p>\n\n<p>Let say something like that:</p>\n\n<p>I have a <b> BackGroundWorker </b> that executes (DoWork) a simple loop that counts from 0 to whatever. Every entry to the loop I send the counter using the ReportProgress event to the GUI's thread that will print the counter's value.</p>\n\n<pre><code>    void worker_DoWork(object sender, DoWorkEventArgs e)\n    {\n        int count = 0;\n        BackgroundWorker Worker = (BackgroundWorker)sender;\n\n        while (count &lt; 10000000)\n        {\n            Worker.ReportProgress(count);\n            count++;\n        }\n    }\n\n    void worker_ProgressChanged(object sender, ProgressChangedEventArgs e)\n    {\n        txt.Text = e.ProgressPercentage.ToString();\n    }\n</code></pre>\n\n<p>Now, this opretion freezes the GUI. </p>\n\n<p>I understand that the ReportProgress is invoking the ProgressChange handler at the thread that created the <b> BackGroundWorker </b>, So I think the loop is executeing so fast so the GUI's thread isn't succeeding to print the values as required.</p>\n\n<p>What Can I do to perform a task like that without freezing the GUI?</p>\n\n<p>I heard of the  Dispatcher  but I don't really sure for what it uses for.</p>\n"},{"tags":["ruby","multithreading","applescript","daemon","daemons"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13045780,"title":"Abort trap from AppleScript run from a Ruby script","body":"<p>I have a Ruby program that, amongst other things, executes user-defined blocks of code (the code is on Github, <a href=\"http://github.com/joonty/chain-reactor\" rel=\"nofollow\">here</a>). Many of these blocks contain system commands, and I'm trying to debug a very specific case of executing a piece of AppleScript within a bash script that I'm calling. The script in question is for controlling Spotify by the command line, and <a href=\"http://harishnarayanan.org/projects/shpotify/\" rel=\"nofollow\">this is the code</a>.</p>\n\n<p>The problem I'm getting is that an abort trap error is occurring every time the script is run:</p>\n\n<pre><code>spotify: line 57: 94108 Abort trap    osascript -e 'tell application \"Spotify\" to pause'\n</code></pre>\n\n<p>This must be related to the environment of the Ruby script where the call is made, but I'm having trouble seeing why. Here's the block of code calling it:</p>\n\n<pre><code># Ruby code\nreaction :hello do |event|\n  system \"spotify pause\"\n  system \"say 'Hello world'\"\n  system \"spotify play\"\nend\n</code></pre>\n\n<p>This block is run periodically via a <code>yield</code> statement, when a particular event is triggered through a socket connection. The script is also daemonized, using the ruby gem \"daemons\", to allow it to run in the background (but still as the current user, according to <code>ps</code> and the ruby environment variable). Not only this, but each socket connection starts a new thread, so the code is run in a separate thread from the main one.</p>\n\n<p>In my debugging I've tried running the line <code>system \"spotify pause\"</code> after the daemon starts up the script, without a problem. It also runs fine in the following script:</p>\n\n<pre><code>Thread.new do\n  system(\"spotify pause\")\nend\n</code></pre>\n\n<p>So it isn't starting a new thread or daemonizing in itself that causes the problem, but it seems to be a combination of these things and maybe the fact that the block is being yielded  that means that an abort trap is being raised by the AppleScript in the bash script.</p>\n\n<p>If you can drag yourself up the many, many layers of complication back into reality, I would appreciate any suggestions you have for solving or even debugging this weird case!</p>\n"},{"tags":["android","multithreading","exception"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1172,"score":2,"question_id":7128670,"title":"Best practice: AsyncTask during orientation change","body":"<p>AsyncTask is a great thing to run complex tasks in another thread.</p>\n\n<p>But when there is an orientation change or another configuration change while the AsyncTask is still running, the current activity is destroyed and restarted. And as the instance of AsyncTask is connected to that activity, it fails and causes a \"force close\" message window.</p>\n\n<p>So I am looking for some kind of \"best-practice\" to avoid these errors and prevent AsyncTask from failing.</p>\n\n<p>What I've seen so far is:</p>\n\n<ul>\n<li>Disable orientation changes. / For sure not the way you should handle this.</li>\n<li>Letting the task survive and updating it with the new activity instance via onRetainNonConfigurationInstance</li>\n<li>Just canceling the task when the activity is destroyed and restarting it when the activity is created again.</li>\n<li>Binding the task to the application class instead of the activity instance.</li>\n<li>Some method used in the \"shelves\" project (via onRestoreInstanceState)</li>\n</ul>\n\n<p>Some code examples:</p>\n\n<p>fattybeagle.com/2011/02/14/android-asynctasks-during-a-screen-rotation-part-i/</p>\n\n<p>fattybeagle.com/2011/02/15/android-asynctasks-during-a-screen-rotation-part-ii/</p>\n\n<p>code.google.com/p/shelves/source/browse/trunk/Shelves/src/org/curiouscreature/android/shelves/activity/ShelvesActivity.java</p>\n\n<p>Can you help me to find the best approach which solves the problem best and is easy to implement as well? The code itself is also important as I don't know how to solve this correctly. Thanks for helping :-)</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13228307,"title":"Member component of a form destruction in Windows Forms","body":"<p>I have a project in C#/Windows Forms, where I have a simple form with a <code>PictureBox</code> that i draw images to from a background thread. If I close the form while drawing is active the background thread crashes when trying to perform invoke to update the bitmap, which is quite logical. I tried putting an <code>AutoResetEvent</code> that  the destructor would wait on, so that destructor would not return until all drawing is done and the background thread knows it is supposed to exit. But I concluded that the crash happens before destructor is executed so I started to wonder, at what point are the components of the form destroyed? I assume that before the destructor? So what is a safe place to wait for the drawing to finish? Override <code>Dispose()</code> and do it there?</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":13228164,"title":"Execution order of multiple threads","body":"<p>Let's say we have this scenario:</p>\n\n<pre><code>class Stack{\n\npublic void main{\n\nChildThread1 t1 = new ChildThread1;\nChildThread1 t2 = new ChildThread1;\nChildThread1 t3 = new ChildThread1;\n\n//then we make some ChildThread2 objects and some ChildThread3 objects\n\nChildThread2 s1 = new ChildThread2;\n//...\n\nChildThread3 v1 = new ChildThread3;\n//...\n\n//now we let all threads start in mix order\nt1.start();\nv1.start();\n//...\n\nSOP(\"All threads are ready\");\n\n//then we let them run with join()\nt1.join();\nt2.join();\nt3.join();\n\ns1.join();\n//...\n\nv1.join();\n//...\n</code></pre>\n\n<p>Each type of thread prints its own unique statement when it is running.</p>\n\n<p>I noticed that every time I execute the program, the output is always different. For example, a statement from ChilThread1 t1 will print in the middle of output instead of  beginning (since t1 starts first) or the statement \"all threads are ready\" will pop in middle of thread execution (Example: ChildThread2 is 'all threads are ready' running )</p>\n\n<p>So I tried to find an answer and I found this site: <a href=\"http://www.avajava.com/tutorials/lessons/how-do-i-use-threads-join-method.html\" rel=\"nofollow\">http://www.avajava.com/tutorials/lessons/how-do-i-use-threads-join-method.html</a>\nThe site basically says there's no guarantee order of execution when you use start()</p>\n\n<p>So am I right to assume that this weird order of prints is because start() does not guarantee order of execution? Will this reason also apply to 'all threads are ready' problem?</p>\n"},{"tags":["c++","multithreading","osx","external"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13219027,"title":"C++ external program IO","body":"<p>I need to run an external program from within a c++ application. I need the output from that program (i want to see it while the program is still running) and it also needs to get input. </p>\n\n<p>What is the best and most elegant way to redirect the IO? Should it be running in it's own thread? Any examples?</p>\n\n<p>It's running on OSX.</p>\n\n<p>I implemented it like this:</p>\n\n<pre><code>ProgramHandler::ProgramHandler(std::string prog): program(prog){\n// Create two pipes\nstd::cout &lt;&lt; \"Created Class\\n\";\npipe(pipe1);\npipe(pipe2);\n\nint id = fork();\n\nstd::cout &lt;&lt; \"id: \" &lt;&lt; id &lt;&lt; std::endl;\n\nif (id == 0)\n{\n    // In child\n    // Close current `stdin` and `stdout` file handles\n    close(fileno(stdin));\n    close(fileno(stdout));\n\n    // Duplicate pipes as new `stdin` and `stdout`\n    dup2(pipe1[0], fileno(stdin));\n    dup2(pipe2[1], fileno(stdout));\n\n    // We don't need the other ends of the pipes, so close them\n    close(pipe1[1]);\n    close(pipe2[0]);\n\n    // Run the external program\n    execl(\"/bin/ls\", \"bin/ls\");\n    char buffer[30];\n    while (read(pipe1[0], buffer, 30)) {\n        std::cout &lt;&lt; \"Buf: \" &lt;&lt; buffer &lt;&lt; std::endl;\n    }\n}\nelse\n{\n    // We don't need the read-end of the first pipe (the childs `stdin`)\n    // or the write-end of the second pipe (the childs `stdout`)\n    close(pipe1[0]);\n    close(pipe2[1]);\n\n\n    // Now you can write to `pipe1[1]` and it will end up as `stdin` in the child\n    // Read from `pipe2[0]` to read from the childs `stdout`\n}\n</code></pre>\n\n<p>}</p>\n\n<p>but as an output i get this:</p>\n\n<p>Created Class</p>\n\n<p>id: 84369</p>\n\n<p>id: 0</p>\n\n<p>I don't understand why it s called twice and why it wont fork the first time. What am I doing/understanding wrong.</p>\n"},{"tags":["ruby","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":57,"score":4,"question_id":13225221,"title":"Ruby Pause thread","body":"<p>In ruby, is it possible to cause a thread to pause from a different concurrently running thread.</p>\n\n<p>Below is the code that I've written so far.  I want the user to be able to type 'pause thread' and the sample500 thread to pause.</p>\n\n<pre><code>#!/usr/bin/env ruby\n\n# Creates a new thread executes the block every intervalSec for durationSec.\ndef DoEvery(thread, intervalSec, durationSec)\n    thread = Thread.new do\n        start = Time.now\n\n        timeTakenToComplete = 0\n        loopCounter = 0\n        while(timeTakenToComplete &lt; durationSec &amp;&amp; loopCounter += 1)\n\n            yield\n\n            finish = Time.now\n\n            timeTakenToComplete = finish - start\n\n            sleep(intervalSec*loopCounter - timeTakenToComplete)    \n        end\n    end\nend\n\n# User input loop.\nexit = nil\nwhile(!exit)\n    userInput = gets\n    case userInput\n    when \"start thread\\n\"\n        sample500 = Thread\n        beginTime = Time.now\n        DoEvery(sample500, 0.5, 30) {File.open('abc', 'a') {|file| file.write(\"a\\n\")}}\n    when \"pause thread\\n\"\n        sample500.stop\n    when \"resume thread\"\n        sample500.run\n    when \"exit\\n\"\n        exit = TRUE\n    end\nend\n</code></pre>\n"},{"tags":["c++","multithreading","exception","boost","future"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13226589,"title":"Exception not propogating properly across threads using boost::future/boost::promise","body":"<p>I have the following code I have simplified:</p>\n\n<p>Thread two:</p>\n\n<pre><code>  boost::unique_future&lt;void&gt; future;\n  TaskPtr task(new task::ReloadConfig(future));\n  Listener::PushTask(task);\n  future.wait();\n\n  try\n  {\n    future.get();\n  }\n  catch (const cfg::ConfigError&amp; e)\n  {\n    return cmd::Result::Okay;\n  }\n</code></pre>\n\n<p>Thread two:</p>\n\n<pre><code>  try\n  {\n    cfg::UpdateShared(std::shared_ptr&lt;cfg::Config&gt;(new cfg::Config(configFile)));\n  }\n  catch (...) // should be cfg::ConfigError\n  {\n    promise.set_exception(boost::current_exception());\n    return;\n  }\n\n  promise.set_value();\n</code></pre>\n\n<p>Instead of a the Cfg::ConfigError exception or one of its derived exceptions being propogated from thread two to thread one I get the following:</p>\n\n<blockquote>\n  <p>terminate called after throwing an instance of\n  'boost::exception_detail::clone_impl'<br>\n  what():  std::exception</p>\n</blockquote>\n\n<p>Seems this other person had similar troubles and no answer:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/10857834/how-to-use-boostfuture-get-to-get-user-defined-exception\">how to use boost::future.get() to get user defined exception</a></p>\n\n<p>I also get the following error if I try to use boost::enable_current_exception:</p>\n\n<blockquote>\n  <p>/usr/local/include/boost/exception/exception.hpp:419:20: error: no\n  matching function for call to 'std::runtime_error::runtime_error()'</p>\n</blockquote>\n\n<p>I can get the code working fine without exceptions, by just returning a boolean value, but this is a compromise.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":45,"score":3,"question_id":13225684,"title":"Get data from main thread when something happens in another?","body":"<p>Currently I have a Thread running a Socket listening for connections. When it receives a connection, it needs to upload data gathered in the main thread (i.e. grab data from main thread). However I pass an instance of the Object, but it's never updated with the data that's collected while waiting for a connection.</p>\n\n<p>Is there a proper way to do this? I've googled around and can't seem to find a concrete answer.</p>\n\n<p>Could someone point me in the right direction?</p>\n\n<hr>\n\n<p>Hopefully this makes sense, but i'll try to explain more with an examples.</p>\n\n<pre><code>class MainThread {\n    private void MainThread() {\n        SomeObj obj = new SomeObj(\"DATA Needed\");\n\n        SecondThread second = new SecondThread(obj);\n        second.start();\n    }\n}\n\nclass SecondThread extends Thread {\n    SomeObj obj;\n\n    public void SecondThread(Object obj) {\n    this.obj = obj;\n    }\n    public void run() {\n\n    //Listening for connection\n    //Connection get!\n    //Get updated data (Object obj) from main thread.\n    //Upload\n    }\n}\n</code></pre>\n\n<p>I appreciate any help you can give me. Please let me know if I am approaching this completely wrong! I would rather learn AND get answers than just get answers.</p>\n\n<p>Thanks so much!</p>\n"},{"tags":["multithreading","qt4","signals","slots"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13225138,"title":"Qt4 connect QThread signal with main thread slot","body":"<p>All right here we go:</p>\n\n<p>This is all over the internet, but it does not seems to be working for me, the thing is I have two threads, Worker and p4, p4 sends a time to wait and other params to the worker, and I want that to be processed in a different thread, but then update the main thread with the results.</p>\n\n<p>so, Worker.h looks like this:</p>\n\n<pre><code> #include &lt;QObject&gt;\n\nclass Worker : public QObject\n{\n    Q_OBJECT\npublic:\n    int time;\n    int actual_weight;\n    int supported_weigth;\n\n    Worker();\n    ~Worker();\n\npublic slots:\n    void process();\n\nsignals:\n    void finished();\n};\n</code></pre>\n\n<p>Worker.cpp looks like this:</p>\n\n<pre><code>#include \"worker.h\"\n\n#include &lt;QDebug&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nWorker::Worker()\n{\n}\n\nWorker::~Worker(){\n\n}\n\nvoid Worker::process(){\n\n    cout &lt;&lt; \"sleep!\" &lt;&lt; endl;\n    sleep(this-&gt;time);\n     cout &lt;&lt; \"done!\" &lt;&lt; endl;\n    //more_nonsense_stuff();\n    emit finished();\n\n}\n</code></pre>\n\n<p>and then in my main thread I have this:</p>\n\n<pre><code>QThread* t = new QThread;\nWorker* w = new Worker();\nw-&gt;time = this-&gt;transactions[i].time;\nconnect(t, SIGNAL(started()), w, SLOT(process()));\nconnect(w, SIGNAL(finished()), this, SLOT(update_gui()));\nw-&gt;moveToThread(t);\nt-&gt;start();\n</code></pre>\n\n<p>the thing is that the SLOT update_gui() is defined in the main window header and implemented in the .cpp, but it never gets to execute.</p>\n\n<p>I have tried attaching Qt::DirectConnection, and the gui updates, but when worker is finished... the whole program closes.</p>\n\n<p>I've looked <a href=\"http://doc.qt.digia.com/4.5/threads-mandelbrot.html\" rel=\"nofollow\">this</a> but didn't worked for me (or I didn't understand), also looked at <a href=\"http://doc.qt.digia.com/4.5/threads.html#signals-and-slots-across-threads\" rel=\"nofollow\">this</a> but that says what I'm trying to do is unsafe?? </p>\n\n<p>please help, what am I doing wrong?</p>\n"},{"tags":["c++","c","multithreading","lock-free","memory-barriers"],"answer_count":8,"favorite_count":9,"up_vote_count":12,"down_vote_count":0,"view_count":4069,"score":12,"question_id":1185063,"title":"Memory barriers in userspace? (Linux, x86-64)","body":"<p>It is easy to set memory barriers on the kernel side: the macros mb, wmb, rmb, etc. are always in place thanks to the Linux kernel headers. </p>\n\n<p>How to accomplish this on the user side?</p>\n"},{"tags":["c#","multithreading","httpwebrequest"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13224471,"title":"C# Error on multithreading webrequests","body":"<p>i am trying to make webrequests with multiple threads but if i try with more than 2 i get error</p>\n\n<pre><code>Index was outside the bonds of the array\n</code></pre>\n\n<p>on this line:</p>\n\n<pre><code>string username = ScrapeBox1.Lines[NamesCounter].ToString();\n</code></pre>\n\n<p>Here's the code:</p>\n\n<pre><code>while (working)\n{\n    while (usernamescount &gt; NamesCounter)\n    {\n        string username = ScrapeBox1.Lines[NamesCounter].ToString();\n        string url = \"http://www.someforum.com/members/\" + username + \".html\";\n        var request = (HttpWebRequest)(WebRequest.Create(url));\n        var response = request.GetResponse();\n        request.UserAgent = \"Mozilla/5.0 (Windows NT 6.1; rv:16.0) Gecko/20100101 Firefox/16.0\";\n\n        using (var responseStream = response.GetResponseStream())\n        {\n            using (var responseStreamReader = new StreamReader(responseStream))\n            {\n\n                var serverResponse = responseStreamReader.ReadToEnd();\n                int startpoint = serverResponse.IndexOf(\"Contact Info&lt;/span&gt;\");\n                try\n                {\n                    string strippedResponse = serverResponse.Remove(0, startpoint);\n                    ExtractEmails(strippedResponse);\n\n                }\n                catch { }\n\n\n            }\n        }\n        NamesCounter++;\n        textBox1.Text = NamesCounter.ToString();\n    }\n\n}\n</code></pre>\n"},{"tags":["c","multithreading","posix"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":64,"score":1,"question_id":13223621,"title":"printf doesnt work properly while using threads","body":"<p>hi there a have a little problem with printf while using threads. problem is terminal prints one printf statement a little bit later which should be printed earlier. this is the part where i'm facing with this issue.</p>\n\n<pre><code>.\n.\n.\n        while(1){\n\n        printf(\"waiting for a connection\\n\");\n\n        csock = (int*)malloc(sizeof(int));\n\n        if((*csock = accept( hsock, (struct sockaddr*)&amp;sadr, &amp;addr_size))!= -1){\n            printf(\"---------------------\\nReceived connection from %s\\n\",inet_ntoa(sadr.sin_addr));\n            client_counter++;\n            pthread_create(&amp;thread_id,0,&amp;SocketHandler, (void*)csock );\n        }\n\n        else{\n            fprintf(stderr, \"Error accepting %d\\n\", errno);\n        }\n        }// end while\n.\n.\n.\n</code></pre>\n\n<p>and this is the function which threads' use.</p>\n\n<pre><code>void* SocketHandler(void* lp){\n\n    int *csock = (int*)lp;\n    char buffer[1024];\n    int buffer_len = 1024;\n    int bytecount;\n    char* str_exit=\"exit\";\n\n        while(1){\n\n            memset(buffer, 0, buffer_len);\n\n            if((bytecount = recv(*csock, buffer, buffer_len, 0))== -1){\n            fprintf(stderr, \"Error receiving data %d\\n\", errno);\n            exit(0);\n            }\n\n            if(strcmp(buffer,str_exit)==0){\n                break;\n            }\n\n            printf(\"Received bytes %d\\nReceived string \\\"%s\\\"\\n\", bytecount, buffer);\n            strcat(buffer, \" SERVER ECHO\");\n\n            if((bytecount = send(*csock, buffer, strlen(buffer), 0))== -1){\n            fprintf(stderr, \"Error sending data %d\\n\", errno);\n            exit(0);\n            }\n\n                //printf(\"Sent bytes %d Sent String %s\\n\", bytecount,buffer);\n        }\n\n    printf(\"Client disconnected\\n\");\n    free(csock);\n    return 0;\n}\n</code></pre>\n\n<p>and the output is like this whenever a client (thread) connects to the server.</p>\n\n<pre><code>waiting for a connection\n---------------------\nReceived connection from 127.0.0.1\nwaiting for a connection\nClient disconnected\n---------------------\nReceived connection from 127.0.0.1\nwaiting for a connection\nClient disconnected\n</code></pre>\n\n<p>when the first client connects the output works properly, but when the second one connects the string <code>\"waiting for a connection\"</code> comes after <code>\"Received connection\"</code>. well it should work in contrast way. i will be glad if you can help and thanks anyway</p>\n"},{"tags":["java","multithreading","thread-safety","synchronized"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":10903609,"title":"Multithread security with synchronized in Java","body":"<p>I'm implementing a program that calculates a Julia set. It will use multiple threads, depending on how many processors are available. Each thread calculates a line, but only when that line is not being calculated by another thread. This part WORKS pretty well.</p>\n\n<p>But sometimes when I test it with bigger images (more lines to calculate, for example instead of <code>getHeight() = 1200</code>, I set it to <code>3000</code>, there are some lines which are skipped). I want to make it more secure, so that no line will be calculated twice, and no lines will be skipped. Here is the code of the <code>run()</code> method: </p>\n\n<pre><code> public void run() {\n     while (counter &lt; getHeight()-1) {  \n         synchronized(this) {\n             if (counter &gt;= getHeight() -1) { //so that the last line will not be calculated &gt;2 times.\n                 return;\n             }\n             counter++;\n             image.setRGB(0, counter, getWidth(), 1, renderLine(counter), 0, 0);\n         }\n     }\n  }\n</code></pre>\n\n<p>I want it to work like that: if the current line is being calculated, the thread goes to the next line.. without that it get confused, so that lines get skipped..</p>\n\n<p>I'm trying this actually: </p>\n\n<pre><code> public void run() {\n     while (counter &lt; getHeight()-1 &amp;&amp; !working) {  \n         synchronized(this) {\n             working = true;\n             if (counter &gt;= getHeight() -1) { //so that the last line will not be calculated &gt;2 times.\n                 return;\n             }\n             counter++;\n             image.setRGB(0, counter, getWidth(), 1, renderLine(counter), 0, 0);\n             working = false;\n         }\n     }\n  }\n</code></pre>\n\n<p>but I don't know if it will prevent access to another thread, while a thread is already working, and it will change the value of \"counter\", meaning that lines can be skipped!</p>\n\n<p>Do I need a boolean variable to notify that a thread is actually working on a line? Any advice? </p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13223437,"title":"interactive scripts with threads","body":"<p>I'm trying to wrap the blocking calls in pyaudio with a thread to give me non-blocking access through queues. However, the problem I have is not with pyaudio, or queues, but with the issue of trying to test a thread. In keeping with \"strip the example down to the minimum possible\", all the pyaudio stuff has vanished, to leave only the thread class, and its instantiation in a main.</p>\n\n<p>What I was hoping for was an object that I could create, and leave to get on with its stuff in the background, while I do control things with the console or tk. I figure the following max-stripped down example should have the thread doing stuff, while main runs and asks me if it is working. The raw_input prompt never appears. I would not be surprised at this if I was running it from IDLE, which is not thread safe, but I get the same behaviour if I run the script directly from the OS. I was prepared to see the raw input prompt disappear up the screen pushed by 'running' prints, but not even that happens. The prompt never appears. What's going on? It does respond to ctrl-C and to closing the window, but I'd still like to be able to see main running.</p>\n\n<pre><code>import threading\nimport time\n\nclass TestThread(threading.Thread):\n    def __init__(self):\n        threading.Thread.__init__(self)\n        self.running=True\n        self.run()\n\n    def run(self):        \n        while self.running:\n            time.sleep(0.5)\n            print 'running'                            \n\n    def stop(self):\n        self.running=False\n\nif __name__=='__main__':\n\n    tt=TestThread()\n    a=raw_input('simple stuff working ? -- ')\n    tt.stop()\n</code></pre>\n"},{"tags":["java","multithreading","wait","synchronized"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":13217482,"title":"Creating multithreading java class to process data","body":"<p>I would like to realize class in Java, which will be wait for new data from different threads and when he got it, this class will process it and again go to wait new data. I want to realize this using only <strong>synchronized, wait, notifyAll</strong> commands. I tried some variants:</p>\n\n<p>1) using one thread, which wait by command lockObject.wait(). But when all active threads finish their work, this thread will be waiting forever. Of course, I can make method stopProcess(), but it is not safety, because another programmer can forget to call it.</p>\n\n<p>2) using one daemon-thread, it will not work, because when all active threads finish their work, my daemon-thread die, but he can have some data which he must to process</p>\n\n<p>3)when new data is coming - create new thread, which will process data. while thread is alive(he process given data), he will receive new data. when it is no data coming and all old data was processed, thread finish to work. Minus of this variant is - when data is coming through some period (when thread have time to process old data and die), a new thread will be created. I think it's bad for performance or/and memory. Am I right? </p>\n\n<p>Is it possible to solve my problem using only one or two(may be using daemon and active thread in combination) threads and not using stopProcess() method??</p>\n\n<p>Here some code </p>\n\n<p>My realize of blocking queue</p>\n\n<pre><code>public class BlockingQueue&lt;T&gt; {\n    private Queue&lt;T&gt; queue = new LinkedList&lt;T&gt;();\n\n    public void add(T el){\n        synchronized (queue){\n            queue.add(el);\n        }\n    }\n\n    public T getFirst(){\n        synchronized (queue){\n            return queue.poll();\n        }\n    }\n\n    public int getSize(){\n        synchronized (queue){\n            return queue.size();\n        }\n    }\n}\n</code></pre>\n\n<p>Data class</p>\n\n<pre><code>public class Data {\n    //some data\n\n    public void process(){\n        //process this data\n    }\n} \n</code></pre>\n\n<p>First variant of code</p>\n\n<pre><code>public class ProcessData {\n\n    private BlockingQueue&lt;Data&gt; queue = new BlockingQueue&lt;Data&gt;();\n    private boolean run = false;\n    private Thread processThread;\n    private Object lock = new Object();\n\n    public synchronized void addData(Data data) throws Exception {\n        if (run){\n            if (data != null){\n                queue.add(data);\n                wakeUpToProcess();\n            }\n        }else{\n            throw new Exception(\"\");\n        }\n    }\n\n    public synchronized void start() {\n        if (!run){\n            run = true;\n\n            processThread = new Thread(new Runnable() {\n                public void run() {\n\n                    while (run || queue.getSize()!=0){\n\n                        while(queue.getSize() == 0 &amp;&amp; run){\n                            //if stopProcess was not called\n                            //and no active threads\n                            //it will not die\n                            waitForNewData();\n                        }\n\n                        Data cur;\n                        while(queue.getSize() &gt; 0){\n                            cur = queue.getFirst();\n                            cur.process();\n                        }\n\n                    }\n                }\n            });\n            processThread.start();\n\n        }\n    }\n\n    public synchronized void stopProcess() {\n        if (run){\n            run = false;\n            wakeUpToProcess();\n        }\n    }\n\n    private void waitForNewData(){\n        try{\n            synchronized (lock){\n                lock.wait();\n            }\n        }catch (InterruptedException ex){\n            ex.printStackTrace();\n        }\n    }\n\n    private void wakeUpToProcess(){\n        synchronized (lock){\n            lock.notifyAll();\n        }\n    }\n}\n</code></pre>\n\n<p>In second variant I make processThread as daemon. But when active threads die, processThread finish to work, but there are some data in queue, which i have to process.</p>\n\n<p>Third variant</p>\n\n<pre><code>public class ProcessData {\n\n    private BlockingQueue&lt;Data&gt; queue = new BlockingQueue&lt;Data&gt;();\n    private boolean run = false;\n    private Thread processThread = null;\n\n    public synchronized void addData(Data data) throws Exception {\n        if (run){\n            if (data != null){\n                queue.add(data);\n                wakeExecutor();\n            }\n        }else{\n            throw new Exception(\"ProcessData is stopped!\");\n        }\n    }\n\n    public synchronized void start() {\n        if (!run){\n            run = true;\n        }\n    }\n\n    public synchronized void stopProcess() {\n        if (run){\n            run = false;\n        }\n    }\n\n    public boolean isRunning(){\n        return this.run;\n    }\n\n    protected void wakeExecutor(){\n        if (processThread ==null || !processThread.isAlive()){\n            processThread = new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    Data cur;\n                    while(queue.getSize() &gt; 0){\n                        cur = queue.getFirst();\n                        cur.process();\n                    }\n                }\n            });\n            processThread.start();\n        }\n    }\n}\n</code></pre>\n\n<p>It is important, that data must to process in the order, in which it come from threads. </p>\n"},{"tags":["android","multithreading","simpleadapter"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":20,"score":1,"question_id":13222195,"title":"can't define Adapter in a thread","body":"<p>i'm not copying all the code cause it's too long, but to be concise : </p>\n\n<p>i have a fonction (recup_list_internet) which has a thread in it, which retrieve data from internet (an XML), decoding it, and assign each \"node\" to an element in my adapter.</p>\n\n<p>When doing the decoding outside the Thread, everything works fine.\nSo i modify this to be used inside the thread, create a void run() function in it, displaying my progressDialog, decoding, data is well retrieved, well assigned to my map (=new HashMap();)\nand here is where the problem appears</p>\n\n<pre><code>private void recup_list_internet()\n{\nfinal ArrayList&lt;HashMap&lt;String, String&gt;&gt; listItem = new ArrayList&lt;HashMap&lt;String, String&gt;&gt;();\nfinal Context mContext=this.getBaseContext();\n\n\nThread t = new Thread()\n{\n    public void run()\n    {/* the code here works fine, not displaying it to be more concise*/\n\n    progressDialog.dismiss(); //works fine\n    SimpleAdapter mSchedule = new SimpleAdapter (mContext, listItem, R.layout.affiche_boutique,new String[] {\"img\", \"titre\", \"description\",\"Prix\",\"uniqueID\"}, new int[] {R.id.img,R.id.titre, R.id.description,R.id.prix,R.id.uniqueID}); //works fine\n    maListViewPerso.setAdapter(mSchedule); //doesn't work\n    }\n};\nt.start();\n}\n</code></pre>\n\n<p>here is my log cat :</p>\n\n<pre><code>11-04 19:20:33.070: E/recuperation phonster(546): android.view.ViewRoot$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.\n</code></pre>\n\n<p>It seems that i'm unable to \"access\" to maListViewPero while in my thread...\n(maListViewPerso is defined previously in my onCreate code : </p>\n\n<pre><code>public class DisplayInternet  extends Activity{\nprivate ListView maListViewPerso;\npublic void onCreate(Bundle savedInstanceState)\n{\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.ceinture_lv);\n    maListViewPerso = (ListView) findViewById(R.id.listviewperso);\n    recup_list_internet();\n}   \n</code></pre>\n\n<p>so where can i put this line for its to works ?\n    \"maListViewPerso.setAdapter(mSchedule);\"</p>\n\n<p>because i already try to declare mSchedule outside my thread (in final) but inside my Thread, i'm unable to access it (and so, i'm unable to use it after the \"t.start()\" line</p>\n"},{"tags":["c#","multithreading","events"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13221115,"title":"NullReferenceException when attempting to fire an event","body":"<p>I'm learning about creating events and creating multi-threaded applications. </p>\n\n<p>The method <code>Thread</code> is called by another class which populates the params with search conditions. A <code>BackgroundWorker</code> is created, performs a search and returns the results to <code>worker_RunWorkerCompleted</code>. </p>\n\n<p>Within <code>worker_RunWorkerCompleted</code>, I want to send the results back to my UI which is subscribing to the <code>Fireendofsearch</code> event. </p>\n\n<p>I'm having trouble understanding why my code below throws the following error</p>\n\n<blockquote>\n  <p>Object reference not set to an instance of an object.</p>\n</blockquote>\n\n<p>when I fire the event <code>Fireendofsearch</code></p>\n\n<pre><code>public class BackgroundSearch\n{\n    public event SearchResultCompleteThreaded Fireendofsearch;\n    public EventArgs a = null;\n    public delegate void SearchResultCompleteThreaded(object seachresults, EventArgs a);\n    internal void Thread(string folder, string parms)\n    {\n        var Argument = new List&lt;object&gt; { folder, parms };\n        var worker = new BackgroundWorker {WorkerReportsProgress = false, WorkerSupportsCancellation = false};\n        worker.DoWork += worker_DoWork;          \n        worker.RunWorkerCompleted += worker_RunWorkerCompleted;\n        worker.RunWorkerAsync(Argument);\n    }\n    void worker_DoWork(object sender, DoWorkEventArgs e)\n    {\n        var passedAugue = e.Argument as List&lt;object&gt;;\n        var returnResult = new List&lt;string[]&gt;();\n        if (passedAugue != null)\n        {\n            var result = Directory.GetFiles(passedAugue[0].ToString(), passedAugue[1].ToString(), SearchOption.AllDirectories);\n            foreach (string s in result)\n            {\n                var t = new string[4];\n                t[0] = s;\n                t[1] = File.GetCreationTime(s).ToString();\n                t[2] = File.GetLastAccessTime(s).ToString();\n                t[3] = File.GetLastWriteTime(s).ToString();\n                returnResult.Add(t);\n            }\n        }\n        if (returnResult.Count != 0)\n        {\n            e.Result = returnResult;\n        }            \n    }\n    void worker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n    {\n        if (e.Result != null)\n        {\n            Fireendofsearch(e.Result, a);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","swt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13214110,"title":"display.async and smooth transitions","body":"<p>I have got my custom widget that changes background when hover. It is working nice but I would like to have smooth transition between no background and hover background. It will work with <code>GC.setAlpha()</code>, but:</p>\n\n<pre><code>Display.getDefault().asyncExec(new Runnable() {\n    public void run() {\n        for (int i=0;i&lt;255;i++) {\n            setBG(BGHelper(imgHover,i)); //i - alpha\n            try {\n                Thread.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }   \n});\n</code></pre>\n\n<p>This code wait until <code>i == 255</code>, but it doesn't display a smooth transition. Why?</p>\n"},{"tags":["java","multithreading","performance","concurrency","threadpool"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":129,"score":3,"question_id":12649024,"title":"ExecutorService suitable for a huge amount of short-lived tasks","body":"<p>Is there an ExecutorService that is suitable for a huge amount of very short-lived tasks? I envision something that internally tries busy waiting before switching over to synchronized waiting. Keeping the order of the tasks is not important, but it should be possible to enforce memory consistency (all tasks <em>happen-before</em> the main thread regains control).</p>\n\n<p>The test posted below consists of 100'000 tasks that each generate 100 <code>double</code>s in a row. It accepts the size of the thread pool as command-line parameter and always tests the serial version vs. the parallel one. (If no command-line arg is given, only the serial version is tested.) The parallel version uses a thread pool of fixed size, allocation of the tasks is not even part of the time measurement. Still, the parallel version is <em>never</em> faster than the serial version, I've tried up to 80 threads (on a machine with 40 hyperthreaded cores). Why?</p>\n\n<pre><code>import java.util.ArrayList;\nimport java.util.Random;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class ExecutorPerfTest {\n    public static final int TASKS = 100000;\n    public static final int SUBTASKS = 100;\n\n    static final ThreadLocal&lt;Random&gt; R = new ThreadLocal&lt;Random&gt;() {\n        @Override\n        protected synchronized Random initialValue() {\n            return new Random();\n        }\n    };\n\n    public class SeqTest implements Runnable {\n        @Override\n        public void run() {\n            Random r = R.get();\n            for (int i = 0; i &lt; TASKS; i++)\n                for (int j = 0; j &lt; SUBTASKS; j++)\n                    r.nextDouble();\n        }\n    }\n\n    public class ExecutorTest implements Runnable {\n        private final class RandomGenerating implements Callable&lt;Double&gt; {\n            @Override\n            public Double call() {\n                double d = 0;\n                Random r = R.get();\n                for (int j = 0; j &lt; SUBTASKS; j++)\n                    d = r.nextDouble();\n                return d;\n            }\n        }\n\n        private final ExecutorService threadPool;\n        private ArrayList&lt;Callable&lt;Double&gt;&gt; tasks = new ArrayList&lt;Callable&lt;Double&gt;&gt;(TASKS);\n\n        public ExecutorTest(int nThreads) {\n            threadPool = Executors.newFixedThreadPool(nThreads);\n            for (int i = 0; i &lt; TASKS; i++)\n                tasks.add(new RandomGenerating());\n        }\n\n        public void run() {\n            try {\n                threadPool.invokeAll(tasks);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            } finally {\n                threadPool.shutdown();\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        ExecutorPerfTest executorPerfTest = new ExecutorPerfTest();\n        if (args.length &gt; 0)\n            executorPerfTest.start(new String[]{});\n        executorPerfTest.start(args);\n    }\n\n    private void start(String[] args) {\n        final Runnable r;\n        if (args.length == 0) {\n            r = new SeqTest();\n        }\n        else {\n            final int nThreads = Integer.parseInt(args[0]);\n            r = new ExecutorTest(nThreads);\n        }\n        System.out.printf(\"Starting\\n\");\n        long t = System.nanoTime();\n        r.run();\n        long dt = System.nanoTime() - t;\n        System.out.printf(\"Time: %.6fms\\n\", 1e-6 * dt);\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13221226,"title":"How to wait for the thread to end before continuing with the program","body":"<p>I have this simple program using threads in C#. How can I make sure that all the threads are done executing before I do a <code>Console.ReadKey();</code> to terminate the program (else it goes straight to the <code>ReadKey</code> and I have to press it for the threads to keep executing) </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading;\n\nnamespace Partie_3\n{\n    class Program\n    {\n        static int _intToManipulate;\n        static object _lock;\n        static Thread thread1;\n        static Thread thread2;\n\n        static void Main(string[] args)\n        {\n            _intToManipulate = 0;\n\n            _lock = new object();\n\n            thread1 = new Thread(increment);\n            thread2 = new Thread(decrement);\n\n            thread1.Start();\n            thread2.Start();\n\n            Console.WriteLine(\"Done\");\n            Console.ReadKey(true);\n        }\n\n\n\n        static void increment()\n        {\n            lock (_lock)\n            {\n                _intToManipulate++;\n                Console.WriteLine(\"increment : \" + _intToManipulate);\n            }\n        }\n        static void decrement()\n        {\n            lock (_lock)\n            {\n                _intToManipulate--;\n                Console.WriteLine(\"decrement : \" + _intToManipulate);\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","multithreading","scheduled-tasks"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":58,"score":1,"question_id":13219996,"title":"Custom multi-threaded Http Server isn't a thread safe","body":"<p>There is a simple multi-threaded web server I wrote in C# (the part of the code):</p>\n\n<pre><code>  public class MyServer\n    {\n        private readonly HttpListener _listener = new HttpListener();\n        private int  _dataId;\n        public HttpServer(string prefix, string folder)\n        {\n            System.Threading.ThreadPool.SetMaxThreads(50, 1000);\n            System.Threading.ThreadPool.SetMinThreads(50, 50);\n            //........\n        }\n\n        public void Start()\n        {\n            _listener.Start();\n            while (true)\n             ThreadPool.QueueUserWorkItem(ProcessRequest, _listener.GetContext());\n        }\n\n\n        private void ProcessRequest(object obj)\n        {\n           //.....\n        }\n\n\n}\n</code></pre>\n\n<p>If a send the requests by browser (or whatever using only one main thread) then everything is OK. But if do it by the code below, then the server usually receives the same values for different requests:</p>\n\n<p>Your thought?</p>\n\n<p>--<strong>EDIT</strong>--:</p>\n\n<p>The simple question is, does using only local variables make me sure that my code is thread safe? And vise versa: if I'm using instance variables (not static, <strong>that's _dataId in my case</strong>), must I \"look after\" them to make them thread safe (for instance, by <code>lock</code> keyword)?</p>\n"},{"tags":["c++","multithreading","openmp","fftw","ppl"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":136,"score":3,"question_id":9990363,"title":"Thread IDs with PPL and Parallel Memory Allocation","body":"<p>I have a question about the Microsoft PPL library, and parallel programming in general. I am using FFTW to perform a large set (100,000) of 64 x 64 x 64 FFTs and inverse FFTs. In my current implementation, I use a parallel for loop and allocate the storage arrays within the loop. I have noticed that my CPU usage only tops out at about 60-70% in these cases. (Note this is still better utilization than the built in threaded FFTs provided by FFTW which I have tested). Since I am using fftw_malloc, is it possible that excessive locking is occurring which is preventing full usage?</p>\n\n<p>In light of this, is it advisable to preallocate the storage arrays for each thread before the main processing loop, so no locks are required within the loop itself? And if so, how is this possible with the MSFT PPL library? I have been using OpenMP before, in that case it is simple enough to get a thread ID using supplied functions. I have not however seen a similar function in the PPL documentation.</p>\n"},{"tags":["asp.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13220432,"title":"Optimizing a set 20 webrequests with threads","body":"<p>This is for ASP.NET. I want to improve the time it takes run my function, today it takes around 20-30 seconds, more towards 30secs than 20secs though. That's running on one thread making 20 webrequests.</p>\n\n<p>I'm thinking threads that do all the 20 webreqeusts, in order to quickly find the result or just go through the data (IE do all the 20 requests not finding anything).</p>\n\n<p><br>\n<strong>Here's how it works.</strong><br>\n1. I'm using html agility pack to fetch htmldocuments.<br> 2. Then I parse them for information<br> 3. Lastly I add that information to a dictionary <strong>OR</strong> I move on to the next webrequest until I reach 20 requests made.  </p>\n\n<p>I make at most 20 webRequests, at minimum 1. I have set the function to end when the info I'm searching for is found. Sometimes the info isn't there hence the 20 webrequests(it goes through all the data).</p>\n\n<p>Every webrequest adds between 5-20 entries to the dictionary. This is then compared with the information I sent to it, if it's in the list I get the Key back, otherwise it returns 201. If found it gets added to the database.</p>\n\n<p><strong>QUESTIONS</strong></p>\n\n<p>*A:*If I want to do this with threads, how many should I create? 20 One for each request and let them all loose to do the job? Or should i create like 4 of them making at most 5 requests each?<br><br><em>B:</em> What if two threads are finished at the same time and wants to add info to the directory, can it lock the whole site(I'm using ASP.NET), or will it try to add one from thread A and then one result from Thread B? I have a check already today that checks if the key exists before adding it.</p>\n\n<p><strong>C:What would be the fastest way to this?</strong></p>\n\n<p>This is my code, depicting the loop which just shows that 20 requests are being made?</p>\n\n<pre><code>public void FetchAndParseAllPages()\n    {\n\n        int _maxSearchDepth = 200;\n        int _searchIncrement = 10;\n\n        PageFetcher fetcher = new PageFetcher();\n        for (int i = 0; i &lt; _maxSearchDepth; i += _searchIncrement)\n        {\n            string keywordNsearch = _keyword + i;\n            ParseHtmldocuments(fetcher.GetWebpage(keywordNsearch));\n\n            if (GetPostion() != 201)\n            {   //ADD DATA TO DATABASE\n                InsertRankingData(DocParser.GetSearchResults(), _theSearchedKeyword);\n                return;\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["php","multithreading","thread-safety","zookeeper"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13220338,"title":"Using watches with the ZooKeeper PHP extension","body":"<p>I'm trying to use the <a href=\"https://github.com/andreiz/php-zookeeper\" rel=\"nofollow\">ZooKeeper PHP Extension</a>. I've noticed that it supports watches, just like the underlying C library, by registering a callback.</p>\n\n<p>The C library, according to its <a href=\"http://zookeeper.apache.org/doc/r3.4.4/zookeeperProgrammers.html#C+Binding\" rel=\"nofollow\">documentation</a>, creates an IO thread and an event dispatch thread for handling connection maintenance and callbacks.</p>\n\n<p>My concern is whether exposing such API to PHP is considered safe. Since the callback is a PHP function, you end up with multi-threaded PHP code. I tested it and it seems to run fine, but I wonder how long before I start to encounter concurrency issues.</p>\n"},{"tags":["java","multithreading","swing","concurrency","edt"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13214111,"title":"Dispatch a task from EDT to main?","body":"<p>I've been reading a bit about concurrency (which gives me a headache).</p>\n\n<p>I understand you can set a task to run on the EDT from the main thread using:</p>\n\n<pre><code>SwingUtilities.invokeLater\n</code></pre>\n\n<p>but can you set a task to run on the main thread from the EDT?</p>\n\n<p>As in:</p>\n\n<pre><code>Thread mymainthread=Thread.currentThread();//&lt;referring to the thread that initially kicks off public static void main\n\npublic void mousePressed(MouseEvent e){ //queue a task to run on mymainthread }\n</code></pre>\n\n<p>Can it be done? Is it a bad idea? </p>\n\n<p>The other question on SO similiar to this (<a href=\"http://stackoverflow.com/questions/2436113/make-process-run-on-non-edt-event-dispatch-thread-thread-from-edt\">here</a>) talks about creating a new thread but wouldn't it be safer and simpler to keep using the main if I was aiming for a single thread (+EDT) application?  .......or maybe I've got this all wrong.</p>\n\n<p>EDIT: What I should have explained: I wanted to create objects that would communicate with each other on the main thread (running in a slow loop) so I didn't want any of them be instantiated on a different thread, edt or otherwise.</p>\n"},{"tags":["multithreading","tornado","gil"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13219805,"title":"why do people talk about threading when using Tornado","body":"<p>i'm a beginner in python world, and in tornado, and sometimes, i found that there are people who uses threads with Tornado; for example to <a href=\"http://stackoverflow.com/questions/13103049/how-can-i-hash-a-password-in-tornado-with-minimal-blocking\">handle password hashing</a>.</p>\n\n<p>so now i dont understand, in Python, (CPython) everyone is saying that there is <a href=\"http://wiki.python.org/moin/GlobalInterpreterLock\" rel=\"nofollow\">GIL</a>, and then i found example where threading is used! so those example talking about PyPy or Jython or IronPython? or when Python is reaching some C code? in Tornado there is <a href=\"https://github.com/facebook/tornado/blob/master/tornado/epoll.c\" rel=\"nofollow\">epoll file</a>.</p>\n"},{"tags":["c","windows","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13218501,"title":"Creating array of threads on Windows","body":"<p>I'm trying to create an array of threads. In Linux, I did it this like:</p>\n\n<pre><code>pthread_t thr[MAXCONNECTIONS];\n</code></pre>\n\n<p>On Windows, I don't find any replacement for this. Is there anyway to create an array or something that replaces this?</p>\n"},{"tags":["java","multithreading","observer-pattern","observable"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13218704,"title":"How to observe multiple observable threads","body":"<p>I'm trying to create a program in java where threads are observable objects and a window is the observer. What I don't understand is how do I distinguish the several threads, which all do the same thing, from each other on the update method so that I could update their position individually on the window.</p>\n"},{"tags":["android","multithreading","application"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13209639,"title":"use android Application class run a thread background to post some data to webservice","body":"<p>Could i write a thread in android the Application class?\nthis thread running every 5 minutes to post data to webservice.</p>\n\n<p>the code like that</p>\n\n<pre><code>public class MyApplication  extends Application {\n@Override\npublic void onCreate() {\n    startUploadGPSTimer();\n}\n\nprivate void startUploadGPSTimer() {\n    gpsTimerHandler.postDelayed(runnable, 5* 60 * 1000); // start Timer\n}\n\nprivate Handler gpsTimerHandler = new Handler();\n\nprivate Runnable runnable = new Runnable() {\n    public void run() {\n        Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();\n        params.put(\"latitude\", Global.CUR_LATITUDE);\n        params.put(\"longitude\", Global.CUR_LONGITUDE);\n        WebServiceObj obj = new WebServiceObj(\"upload\",\n                WebServiceMethod.METHOD_UPLOAD_GPS,\n                Utilly.getSoapParams(params));\n        SoapService service = null;\n        SoapObject result = null;\n        service = new SoapService(obj.tag);\n        result = service.LoadResult(obj);\n        Log.i(\"post webservrce  \", result.toString());\n        gpsTimerHandler.postDelayed(this, 5 * 60 * 1000);\n    }\n};\n</code></pre>\n\n<p>the question is when my application enter background , this thread like do not running. Because of the data I post in thread Finally input to Database, and i can't find it in db.</p>\n\n<p>Why?</p>\n\n<p>PS. I write some log when do post data to webservice. and found the log be generated randomly.\n   Very strange</p>\n"},{"tags":["c++","multithreading","synchronization","mutex"],"answer_count":10,"favorite_count":6,"up_vote_count":17,"down_vote_count":0,"view_count":6527,"score":17,"question_id":118199,"title":"C++ Thread, shared data","body":"<p>I have an application where 2 threads are running... Is there any certanty that when I change a global variable from one thread, the other will notice this change? \nI don't have any syncronization or Mutual exclusion system in place... but should this code work all the time (imagine a global <strong>bool</strong> named <strong>dataUpdated</strong>):</p>\n\n<p>Thread 1:</p>\n\n<pre><code>while(1) {\n    if (dataUpdated)\n    \tupdateScreen();\n    doSomethingElse();\n}\n</code></pre>\n\n<p>Thread 2:</p>\n\n<pre><code>while(1) {\n    if (doSomething())\n    \tdataUpdated = TRUE;\n}\n</code></pre>\n\n<p>Does a compiler like gcc optimize this code in a way that it doesn't check for the global value, only considering it value at compile time (because it nevers get changed at the same thred)?</p>\n\n<p>PS: Being this for a game-like application, it really doen't matter if there will be a read while the value is being written... all that matters is that the change gets noticed by the other thread.</p>\n"},{"tags":["c++","multithreading","variables","boost","shared"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13218688,"title":"Boost multithreading and shared variables","body":"<p>First, I'm sorry if this question is somewhere on here already, but my Google skills seem to be failing me.</p>\n\n<p>Basically, I have a function that should check for any incoming messages at any time. There is also a global variable where it should store this message. (I put this function in a thread)</p>\n\n<p>I want to check for incoming messages using something like:</p>\n\n<pre><code>while (global_array[0] != '#') { } // all messages are padded with '#'\n</code></pre>\n\n<p>Sadly, this doesn't seem to be working.</p>\n\n<p>I tried making this '<code>global_array</code>' volatile, but then it wouldn't go with the TCP functions I'm using for Receiving.</p>\n\n<p>I really just need this to work.. Please, any help would be appreciated.</p>\n\n<p>Edit: \"doesn't seem to be working\" -> the variable doesn't seem to be changing 'cause I'm stuck in this loop</p>\n"},{"tags":["c","multithreading","sockets"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13218880,"title":"windows createthread webserver","body":"<p>I wrote a select webserver and I was trying to set this to a multithreaded server. </p>\n\n<p>The program runs but when I go to localhost:9001/index.html</p>\n\n<p>the program just closes it doesn't do anything.</p>\n\n<p>This is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;winsock2.h&gt;\n#include &lt;winsock.h&gt;\n#include &lt;Ws2tcpip.h&gt;\n#include &lt;time.h&gt;\n#include &lt;process.h&gt; \n\n\n#pragma comment(lib, \"ws2_32.lib\" )\n#define BUFFSIZE 1000\n#define PORT \"9001\"\n#define MAXCONNECTIONS 10\n\nint main()\n{\n    WSADATA wsaData;\n    int yes = 1;        // reuse address\n    int rv;\n    int conn = 0;\n    int loop = 0;\n    int listener;       // file descriptor on socket\n    int newfd;          // new client file descriptor\n    struct sockaddr_storage clientaddr; // client address\n    struct addrinfo serverinfo, *socketlist, *sock;\n    socklen_t addrlen;  // length of addres\n    void *newf;\n    HANDLE thr[MAXCONNECTIONS];\n\n\n    if (WSAStartup(MAKEWORD(2,0), &amp;wsaData) != 0) \n    {\n        fprintf(stderr, \"WSAStartup failed.\\n\");\n        exit(1);\n    }\n\n    // Get a socket and bind for listening\n    memset(&amp;serverinfo, 0, sizeof(serverinfo));\n    serverinfo.ai_family = AF_INET;\n    serverinfo.ai_socktype = SOCK_STREAM;\n    serverinfo.ai_flags = AI_PASSIVE; // we search a socket on our side (server side) for listening\n\n    if((rv = getaddrinfo(NULL,PORT,&amp;serverinfo,&amp;socketlist)) != 0)\n    {\n        fprintf(stderr,\"Server: %s\\n\",gai_strerror(rv));\n        exit(1);\n    }\n\n    // loop trough sockets\n    for(sock = socketlist; sock != NULL; sock = sock-&gt;ai_next)\n    {\n        listener = socket(sock-&gt;ai_family, sock-&gt;ai_socktype, sock-&gt;ai_protocol);\n        if(listener &lt; 0)\n        {\n            continue; // not correct socket\n        }\n        setsockopt(listener,SOL_SOCKET,SO_REUSEADDR, &amp;yes, sizeof(int));\n        if(bind(listener, sock-&gt;ai_addr, sock-&gt;ai_addrlen) &lt; 0)\n        {\n            closesocket(listener);\n            continue; // could not bind to socket\n        }\n        break;\n    }\n\n    // if could not get socket\n    if(sock == NULL)\n    {\n        fprintf(stderr,\"Server: %s\\n\",\"Could not bind to socket\");\n        exit(2);\n    }\n\n    // free up list, we have the socket\n    freeaddrinfo(socketlist);\n\n    // listen on socket\n    if(listen(listener,MAXCONNECTIONS) &lt; 0)\n    {\n        perror(\"Server: listen\");\n        exit(3);\n    }\n\n    fprintf(stdout,\"Server: %s\\n\",\"Waiting for connections...\");\n\n    for(;;)\n    {\n        addrlen = sizeof clientaddr;\n        if((newfd = accept(listener,(struct sockaddr*)&amp;clientaddr,&amp;addrlen)) &lt; 0)\n        {\n            perror(\"Server: accept\");\n            exit(4);\n        }\n\n        newf = (void*) newfd;\n\n        // Create thread\n        if (( thr[conn] = CreateThread(NULL,0,client,newf,0,NULL)))\n        {\n            perror(\"Server: pthread_create\");\n            exit(5);\n        }\n\n        if(conn+1 == MAXCONNECTIONS)\n        {\n            loop = 1;\n        }\n        conn = (conn+1) % 10;\n\n        if( loop == 1 )\n        {\n            WaitForSingleObject(thr[conn],NULL);\n            CloseHandle(thr[conn]);\n        }\n\n    }\n    WSACleanup();\n    return 0;\n}\n\nDWORD WINAPI client(void * fd)\n{\n    int i = (int) fd;\n    int recvbytes;      // amount of bytes received\n    char buffer[BUFFSIZE]; // buffer for request\n    char result[BUFFSIZE];\n    char result2[BUFFSIZE];\n    char  * path;\n    char * extension;\n\n    // handle data from request\n    if((recvbytes = recv(i,buffer,BUFFSIZE-1,0)) == -1)\n    {\n        if(recvbytes == 0) //connection closed\n        {\n            fprintf(stdout,\"Server: socket %d goodbye\\n\",i);\n        }\n        else //request error [BAD REQUEST]\n        {\n            perror(\"Server: recv\");\n        }\n        closesocket(i);\n    }\n    else\n    {\n        if(recvbytes &gt; 0)\n        {\n            buffer[recvbytes]='\\0';\n        }\n        fprintf(stdout,\"Server: request received:\\n\");\n        //Get path\n        path = getPath(buffer,0, result);\n        if(strcmp(path,\"error\") != 0)\n        {\n            extension = getPath(buffer,1,result2);\n            if(strcmp(extension,\"error\") != 0)\n            {\n                // send file 200\n                sendData(extension,path,i,200);\n            }\n        }\n        else\n        {\n            // send code 400\n            sendData(\"html\",\"400.html\",i,400);\n        }\n\n        closesocket(i);\n    }\n    return 0;\n}\n</code></pre>\n"},{"tags":["python","multithreading","concurrency","multicore","python-stackless"],"answer_count":2,"favorite_count":3,"up_vote_count":14,"down_vote_count":0,"view_count":3829,"score":14,"question_id":377254,"title":"Stackless python and multicores?","body":"<p>So, I'm toying around with <a href=\"http://www.stackless.com/\" rel=\"nofollow\">Stackless Python</a> and a question popped up in my head, maybe this is \"assumed\" or \"common\" knowledge, but I couldn't find it actually written anywhere on the <a href=\"http://www.stackless.com/\" rel=\"nofollow\">stackless site</a>.</p>\n\n<p>Does <a href=\"http://www.stackless.com/\" rel=\"nofollow\">Stackless Python</a> take advantage of multicore CPUs? In normal Python you have the GIL being constantly present and to make (true) use of multiple cores you need to use several processes, is this true for <a href=\"http://www.stackless.com/\" rel=\"nofollow\">Stackless</a> also?</p>\n"},{"tags":["c#","multithreading"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13218656,"title":"C# Thread Sync Montitor + ResetEvent","body":"<p>I have written a DirectSoundWrapper but I just can access the interfaces through MTA Threads.\nSo I created a Thread that is working in background and executes actions in a queue. \nI've done something like this:</p>\n\n<pre><code>private void MTAQueue()\n{\n    lock (queueLockObj)\n    {\n        do\n        {\n            if (marshalThreadItems.Count &gt; 0)\n            {\n                MarshalThreadItem item;\n                item = marshalThreadItems.Dequeue();\n                item.Action();\n            }\n            else\n            {\n                Monitor.Wait(queueLockObj);\n            }\n        } while (!disposing);\n    }\n}\n</code></pre>\n\n<p>And I Execute an Action like this:</p>\n\n<pre><code>private void ExecuteMTAAction(Action action)\n{\n    if (IsMTAThread)\n        action();\n    else\n    {\n        lock (queueLockObj)\n        {\n            MarshalThreadItem item = new MarshalThreadItem();\n            item.Action = action;\n            marshalThreadItems.Enqueue(item);\n\n            Monitor.Pulse(queueLockObj);\n        }\n    }\n}\n</code></pre>\n\n<p>But now I wanted to wait for the finishing the action is called. So I wanted to use a ManuelResetEvent:</p>\n\n<pre><code>private void ExecuteMTAAction(Action action)\n{\n    if (IsMTAThread)\n        action();\n    else\n    {\n        lock (queueLockObj)\n        {\n            MarshalThreadItem item = new MarshalThreadItem();\n            item.Action = action;\n            item.waitHandle = new ManualResetEvent(false); //setup\n            marshalThreadItems.Enqueue(item);\n\n            Monitor.Pulse(queueLockObj); //here the pulse does not pulse my backgrond thread anymore\n            item.waitHandle.WaitOne(); //waiting\n        }\n    }\n}\n</code></pre>\n\n<p>And my background thread i just edit like this:</p>\n\n<pre><code>item.Action();\nitem.waitHandle.Set();\n</code></pre>\n\n<p>The problem is that the background thread does not get pulsed anymore and just keeps waiting (Monitor.Wait(queueLockObj)) and my mainthread that calls the action waits on the manuelresetevent...?</p>\n\n<p>Why?</p>\n"},{"tags":["c#","multithreading","events","delegates"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2486,"score":5,"question_id":1210026,"title":"Return a value from an Event -- is there a Good Practice for this?","body":"<p>I'm doing a small multi-threaded app that uses asynchronous TCP sockets, but I will get to the point: I'm using a custom event to read a value from a form and the delegate used by the event returns a string when finished.</p>\n\n<p>My question here is: is that correct? is it OK to return values from the events? or is there a better way to do this? (like using a simple delegate to the form to read the values)</p>\n"},{"tags":["c++","multithreading","zeromq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":133,"score":0,"question_id":12124128,"title":"ZeroMQ How can server mantain connections with all clients?","body":"<p>I have the following task:</p>\n\n<p>Clients connect to a server on 1 port (e.g. 8080). The server should remember them and after completing calculation it should send results to the clients. After that server gets some results again and again sends it to all clients. And so on.</p>\n\n<p>How can server mantain connections with all clients?</p>\n"},{"tags":["c","multithreading","testing","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":13217904,"title":"How can I test a thread-safe implementation in c?","body":"<p>I have a thread-safe program which I would like to test (see below). I am not sure how to proceed with starting a test program as this would be my first test program. The result should be a demonstration that uses this thread-safe program implementation and why it is the best alternativ to test a thread-safe program like the example.</p>\n\n<pre><code>#include &lt;errno.h&gt;\n#include &lt;pthread.h&gt;\nstatic pthread_mutex_t listlock = PTHREAD_MUTEX_INITIALIZER;\n\nint accessdata_r(void) {  /* return nonnegative traversal key if successful */ \n   int error;   \n   int key;\n   if (error = pthread_mutex_lock(&amp;listlock)) {        /* no mutex, give up */\n      errno = error;\n      return -1; \n   }\n   key = accessdata();\n   if (key == -1) {\n      error = errno;\n      pthread_mutex_unlock(&amp;listlock);\n      errno = error;\n      return -1;\n   }\n   if (error = pthread_mutex_unlock(&amp;listlock)) {\n      errno = error;\n      return -1;\n   }\n   return key;\n}\n\nint adddata_r(data_t data) {        /* allocate a node on list to hold data */\n   int error;\n   if (error = pthread_mutex_lock(&amp;listlock)) {        /* no mutex, give up */\n      errno = error;\n      return -1;\n   }\n   if (adddata(data) == -1) {\n      error = errno;\n      pthread_mutex_unlock(&amp;listlock);\n      errno = error;\n      return -1;\n   }\n   if (error = pthread_mutex_unlock(&amp;listlock)) {\n      errno = error;\n      return -1;\n   }\n   return 0; \n}\n\nint getdata_r(int key, data_t *datap) {             /* retrieve node by key */\n   int error;\n   if (error = pthread_mutex_lock(&amp;listlock)) {        /* no mutex, give up */\n      errno = error;\n      return -1;\n   }\n   if (getdata(key, datap) == -1) {\n      error = errno;\n      pthread_mutex_unlock(&amp;listlock);\n      errno = error;\n      return -1;\n   }\n   if (error = pthread_mutex_unlock(&amp;listlock)) {\n      errno = error;\n      return -1;\n   }\n   return 0; \n}\n\nint freekey_r(int key) {                                    /* free the key */\n   int error;\n   if (error = pthread_mutex_lock(&amp;listlock)) {        /* no mutex, give up */\n      errno = error;\n      return -1;\n   }\n   if (freekey(key) == -1) {\n      error = errno;\n      pthread_mutex_unlock(&amp;listlock);\n      errno = error;\n      return -1;\n   }\n   if (error = pthread_mutex_unlock(&amp;listlock)) {\n      errno = error; \n      return -1;   \n   } \n   return 0;  \n}\n</code></pre>\n"},{"tags":["c","multithreading","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":13217761,"title":"Inter Thread Communication in C","body":"<p>As a part of my project I have to modify a Numerical Integration Algorithm using threads. </p>\n\n<p>This is roughly what happens in the conventional sequential approach..</p>\n\n<pre><code>void Controller(struct DE)\n{\n    //initialization step\n    for(;;)   //till the entire range has not been covered...\n    {\n         //compute the next time-point solution using the previously known solutions.\n         NIiter();\n         //then check if the result is acceptable or not and take the necessary steps...\n    }\n}\n</code></pre>\n\n<p>Now this is what I intend to do....</p>\n\n<pre><code>void Controller(struct DE)\n{\n    //initialization step\n    for(;;)   //till the entire range has been covered...\n    {\n         //compute the next time using the previously known solution.\n         NIiter();\n         //when I have an approximate solution available..launch a thread to compute the next time-point using this approximate solution as a previous solution...something like forward pipelining...\n         //then check if BOTH the results are acceptable or not and take the necessary steps...\n    }\n}\n</code></pre>\n\n<p>But I dont understand how to notify my controller that the an approximate solution is available...so it can launch a new thread...</p>\n\n<p>This is my first exposure to multi-threaded programming...so forgive me if this seems to be an obvious question..also I am using Pthread library in my project...</p>\n"},{"tags":["c++","multithreading","double-checked-locking"],"answer_count":1,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":501,"score":7,"question_id":5050763,"title":"double checked locking pattern","body":"<p>In <a href=\"http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBIQFjAA&amp;url=http%3A%2F%2Fwww.aristeia.com%2FPapers%2FDDJ_Jul_Aug_2004_revised.pdf&amp;ei=HrNfTeLlBIrIuAP_2PXJBA&amp;usg=AFQjCNHmqLfgOdlZVKlZiSGCY1-KOooLzA\" rel=\"nofollow\">C++ and the Perils of Double-Checked Locking</a>, there's persudo code to implement the pattern correctly which is suggested by the authors. See below,</p>\n\n<pre><code>Singleton* Singleton::instance () {\n    Singleton* tmp = pInstance;\n    ... // insert memory barrier\n    if (tmp == 0) {\n        Lock lock;\n        tmp = pInstance;\n        if (tmp == 0) {\n            tmp = new Singleton;\n            ... // insert memory barrier\n            pInstance = tmp;\n        }\n    }\n    return tmp;\n}\n</code></pre>\n\n<p>I just wonder that whether the first memory barrier can be moved right above the return statement? </p>\n\n<p><strong>EDIT</strong>: Another question: In the linked article, as <a href=\"http://stackoverflow.com/users/363437/vidstige\">vidstige</a> quoted</p>\n\n<blockquote>\n  <p>Technically, you don’t need full bidirectional barriers. The first barrier\n  must prevent downwards migration of Singleton’s construction\n  (by another thread); the second barrier must prevent upwards migration\n  of pInstance’s initialization. These are called ”acquire” and\n  ”release” operations, and may yield better performance than full\n  barriers on hardware (such as Itainum) that makes the distinction.</p>\n</blockquote>\n\n<p>It says that the second barrier doesn't need to be bidirectional, so how can it prevent the assignment to pInstance from being moved before that barrier? Even though the first barrier can prevent upwards migration, but another thread can still have chance to see the un-initialized members.</p>\n\n<p><strong>EDIT</strong>: I think I almost understand the purpose of the first barrier. As <a href=\"http://stackoverflow.com/users/315144/sonicoder\">sonicoder</a> noted, branch prediction may cause tmp to be NULL when the if returns true. To avoid that problem, there must be a acquire barrier to prevent the reading of tmp in return before the reading in if. </p>\n\n<p><strong>EDIT</strong>: For those who is interested in this question, I strongly recommend reading <a href=\"http://www.kernel.org/doc/Documentation/memory-barriers.txt\" rel=\"nofollow\">memory-barriers.txt</a>.</p>\n"},{"tags":["java","multithreading","algorithm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":45,"score":-3,"question_id":13217004,"title":"explain lockset algorithm","body":"<p>Can any one please explain me the lockset algorithm? I cannot understand why it does not show an alarm. What is its draw back in this example?</p>\n\n<blockquote>\n  <p>Let locks held(t) be the set of locks held by thread t.</p>\n  \n  <p>For each v, initialize C(v) to the set of all locks.</p>\n  \n  <p>On each access to v by thread t,</p>\n  \n  <p>set C(v) :5 C(v) ù locks held(t);</p>\n  \n  <p>if C(v) 5 { }, then issue a warning.</p>\n</blockquote>\n"},{"tags":["vb.net","multithreading","serial-port","invokerequired"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13209465,"title":"VB - how to access data from a class running on another thread (serial object)","body":"<p>I am writing a class called Field which uses a serial object to get some values from an Arduino. I have an event being raised by the class (when data is received from the serial port, more or less) and when that happens I need to retrieve data from this class. The code below works, but doesn't seem to do so in the way I need it to. My knowledge of just how threading works is little to none, I just know that the serial port object runs in its own thread which makes working with it a massive pain. </p>\n\n<pre><code>Private Sub Field_eScore() Handles Field.eScore\n\n    If InvokeRequired Then\n        Invoke(Sub() lbl_COM_data.Text = Field.GetComData())\n    Else\n        lbl_COM_data.Text = Field.GetComData()\n    End If\n\nEnd Sub\n</code></pre>\n\n<p>Is there a way to easily access data operating in this other thread that doesn't involve having these “InvokeRequired” If-Then conditionals? Some more information on just how threading works in this case would be awesome too.</p>\n"},{"tags":["vb.net","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13206558,"title":"vb.net halting the execution of a code until a thread is finshed","body":"<p>i have a function that contains the following</p>\n\n<pre><code>  WebUpdateThread = New System.Threading.Thread(AddressOf generatecids)\n    WebUpdateThread.SetApartmentState(ApartmentState.STA)\n    WebUpdateThread.Start()\n\n    'after starting the thread i have some code that i want to run when the thread    finshes its work which takes about 3-4 hours\n'if i put for example \nMsgBox(\"something\")\n</code></pre>\n\n<p>the message box shows as soon as the thread starts, how do i make it wait until the thread is finshed?</p>\n\n<p>is there something more sufficient than an infitine while loop that checks the thread state?</p>\n"},{"tags":["java","multithreading","exception","jpa","concurrency"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13212072,"title":"JPA multithreading org.eclipse.persistence.exceptions.ConcurrencyException","body":"<p>Hi I try to do multithreading with <code>JSOUP</code> and <code>JPA</code> to parse some pages and put the information in database, but I sometimes get this exception:</p>\n\n<pre><code>Exception in thread \"Thread-7\" Local Exception Stack: \nException [EclipseLink-2004] (Eclipse Persistence Services - 2.3.2.v20111125-r10461): org.eclipse.persistence.exceptions.ConcurrencyException\nException Description: A signal was attempted before wait() on ConcurrencyManager. This normally means that an attempt was made to \ncommit or rollback a transaction before it was started, or to rollback a transaction twice.\n    at org.eclipse.persistence.exceptions.ConcurrencyException.signalAttemptedBeforeWait(ConcurrencyException.java:84)\n    at org.eclipse.persistence.internal.helper.ConcurrencyManager.releaseReadLock(ConcurrencyManager.java:489)\n    at org.eclipse.persistence.internal.identitymaps.CacheKey.releaseReadLock(CacheKey.java:386)\n    at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.cloneAndRegisterObject(UnitOfWorkImpl.java:1015)\n    at org.eclipse.persistence.internal.descriptors.ObjectBuilder.buildWorkingCopyCloneNormally(ObjectBuilder.java:731)\n    at org.eclipse.persistence.internal.descriptors.ObjectBuilder.buildObjectInUnitOfWork(ObjectBuilder.java:668)\n    at org.eclipse.persistence.internal.descriptors.ObjectBuilder.buildObject(ObjectBuilder.java:601)\n    at org.eclipse.persistence.internal.descriptors.ObjectBuilder.buildObject(ObjectBuilder.java:560)\n    at org.eclipse.persistence.queries.ObjectLevelReadQuery.buildObject(ObjectLevelReadQuery.java:717)\n    at org.eclipse.persistence.queries.ReadAllQuery.registerResultInUnitOfWork(ReadAllQuery.java:769)\n    at org.eclipse.persistence.queries.ReadAllQuery.executeObjectLevelReadQuery(ReadAllQuery.java:433)\n    at org.eclipse.persistence.queries.ObjectLevelReadQuery.executeDatabaseQuery(ObjectLevelReadQuery.java:1081)\n    at org.eclipse.persistence.queries.DatabaseQuery.execute(DatabaseQuery.java:844)\n    at org.eclipse.persistence.queries.ObjectLevelReadQuery.execute(ObjectLevelReadQuery.java:1040)\n    at org.eclipse.persistence.queries.ReadAllQuery.execute(ReadAllQuery.java:392)\n    at org.eclipse.persistence.queries.ObjectLevelReadQuery.executeInUnitOfWork(ObjectLevelReadQuery.java:1128)\n    at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.internalExecuteQuery(UnitOfWorkImpl.java:2871)\n    at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1516)\n    at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1498)\n    at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1463)\n    at org.eclipse.persistence.internal.jpa.EJBQueryImpl.executeReadQuery(EJBQueryImpl.java:485)\n    at org.eclipse.persistence.internal.jpa.EJBQueryImpl.getSingleResult(EJBQueryImpl.java:773)\n    at database.dao.LinkDAO.getLinkByLink(LinkDAO.java:23)\n    at celsis.CelsisGijos.parsePreke(CelsisGijos.java:160)\n    at celsis.CelsisGijos.runThruePrekes(CelsisGijos.java:139)\n    at celsis.CelsisGijos.runThrueGrupes(CelsisGijos.java:67)\n    at celsis.CelsisGijos.run(CelsisGijos.java:314)\n</code></pre>\n\n<p>It appears in this method in Line 3:</p>\n\n<pre><code>1    public static synchronized XParserLinks getLinkByLink(String link) {\n2        try {\n3            XParserLinks obj = TarpineManager.getInstance().createNamedQuery(\"XParserLinks.findByLink\", XParserLinks.class).setParameter(\"link\", link).getSingleResult();\n4            return obj;\n5        } catch (NoResultException e) {\n6            return null;\n7        }\n8        \n9    }\n</code></pre>\n"},{"tags":["windows","multithreading","sockets","winsock2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13171324,"title":"Porting multithreaded network server from unix to windows","body":"<p>I'm working to port some relatively simple network code from unix to Windows.</p>\n\n<p>In brief, there's a single network thread which manages all network traffic.  This single thread sits inside <code>poll()</code> most of the time (I've already converted this to <code>select()</code>, on Windows), the network thread only waking up when there's incoming network data.  When a client command arrives, the network thread fires the command off to a worker thread to actually perform work on the back-end, and then goes back to listening for more incoming commands.  Commands are asynchronous -- multiple commands can come in on one socket, one right after the next.  At any one time, there can be dozens of outstanding commands on a single connection, all being worked on in various worker threads.</p>\n\n<p>The problem is that when the worker thread wants to send response data, the network thread is probably asleep inside <code>poll()</code> at the time that the worker thread is trying to send its result.  The network thread has to wait for <code>poll()</code> to time out (or another packet to be received) before it will notice that there's new outbound data queued up to be sent.</p>\n\n<p>Under unix, I deal with this by including a pipe amongst the descriptors being watched by <code>poll()</code>, and when a worker thread has outbound data to send, it also writes a byte of data into the pipe to wake up the network thread.  But WinSock only seems to support waiting on sockets, so that approach isn't going to work for me in Windows.  Is there any way for me to salvage this architecture on Windows using WinSock (so I can share most of the code between different platforms), or is there no option but to write a custom network server implementation for use on Windows?</p>\n\n<p>Thanks for any advice!</p>\n"},{"tags":["c#","multithreading","castle-windsor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13216132,"title":"CastleWindsor multi-threaded application","body":"<p>I'm working on a project where multi-threading is involved. Each thread represents a specific product testing and the threads are dynamically created based on the introduction of a product at a test station. </p>\n\n<p>I know that <code>CastleWindsor</code>'s lifestyle per-thread can be used for this purpose. With this approach you cannot kill the instances created for a particular thread till you release the container instance but, the container instance cannot be released as there are other threads running in parallel use it. Waiting till the end of application to perform is not a great solution as there will be unnecessary consumption of memory that could cause problems.</p>\n\n<p>Someone mentioned that it doesn't hurt to create container instance per thread to accomplish the requirement. What I would like to know is if this is a good solution. If not, is there any better way to do this? </p>\n"},{"tags":["windows","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13206414,"title":"Why slim reader/writer exclusive lock outperformance the shared one?","body":"<p>I have tested the performance of slim reader/writer lock under windows 7 using the codefrom <em>Windows Via C/C++</em>.</p>\n\n<p>The result surprised me that the exclusive lock out performance the shared one. Here are the code and the result.</p>\n\n<pre><code>unsigned int __stdcall slim_reader_writer_exclusive(void *arg)\n{\n    //SRWLOCK srwLock;\n    //InitializeSRWLock(&amp;srwLock);\n\n    for (int i = 0; i &lt; 1000000; ++i) {\n        AcquireSRWLockExclusive(&amp;srwLock);\n        g_value = 0;\n        ReleaseSRWLockExclusive(&amp;srwLock);\n    }\n    _endthreadex(0);\n    return 0;\n}\n\nunsigned int __stdcall slim_reader_writer_shared(void *arg)\n{\n\n    int b;\n    for (int i = 0; i &lt; 1000000; ++i) {\n        AcquireSRWLockShared(&amp;srwLock);\n        //b = g_value;\n        g_value = 0;\n        ReleaseSRWLockShared(&amp;srwLock);\n    }\n    _endthreadex(0);\n    return 0;\n}\n</code></pre>\n\n<p><code>g_value</code> is a global int volatile variable.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Lo0RQ.jpg\" alt=\"enter image description here\"></p>\n\n<p>Could you kindly explain why this could happen? </p>\n"},{"tags":["java","multithreading","sockets"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":13115784,"title":"Sending a message to all running client threads","body":"<p>So now, I am making a client server app based multithread. In server side, I make a thread for everysingle connection that accepted.</p>\n\n<p>In thread class, I make a method that send a command to client. What i just want is, how to send a parameter to all running client? For simple statement, i just want to make this server send a message to all connected client.</p>\n\n<p>I've been read <a href=\"http://stackoverflow.com/questions/9969585/how-do-i-send-data-to-all-threaded-clients-in-java\">this post</a> and find <code>sendToAll(String message)</code> method from <a href=\"http://carfield.com.hk/document/java/tutorial/socket_chat.pdf\" rel=\"nofollow\">this link</a>. But when i am try in my code, there is no method like that in <code>ServerSocket</code> . </p>\n\n<p>Okay this is my sample code for server and the thread.</p>\n\n<pre><code>class ServerOne{\n\nServerSocket server = null;\n...\n\nServerOne(int port){\n            System.out.println(\"Starting server on port \"+port);\n    try{\n      server = new ServerSocket(port);\n              System.out.println(\"Server started successfully and now waiting for client\");\n\n    } catch (IOException e) {\n      System.out.println(\"Could not listen on port \"+port);\n      System.exit(-1);\n    }\n}\n\npublic void listenSocket(){ \n    while(true){\n        ClientWorker w;\n        try{\n            w = new ClientWorker(server.accept());\n            Thread t = new Thread(w);\n            t.start();\n        } catch (IOException e) {\n            System.out.println(\"Accept failed: 4444\");\n            System.exit(-1);\n        }   \n    }\n}\n\nprotected void finalize(){\n    try{\n        server.close();\n    } catch (IOException e) {\n        System.out.println(\"Could not close socket\");\n        System.exit(-1);\n    }\n}\n}\n\nclass ClientWorker implements Runnable{\nSocket client;\n\nClientWorker(Socket client){\n    this.client = client;\n}\npublic void run(){\n    ...\n      sendCommand(parameter);\n    ...\n}\n\npublic void sendCommand(String command){\n    PrintWriter out = null;\n    try {\n        out = new PrintWriter(client.getOutputStream(), true);\n        out.println(command);\n    } catch (IOException ex) {}\n}\n\n}\n</code></pre>\n\n<p>Thanks for help :)</p>\n"},{"tags":[".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13214897,"title":"What is the lowest overhead way to limit executing one section of code to 4 threads","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2552192/limiting-the-number-of-threads-executing-a-method-at-a-single-time\">Limiting the number of threads executing a method at a single time</a>  </p>\n</blockquote>\n\n\n\n<p>In a single app we need to limit executing a section of code to 4 threads. This section is not the start/end of the thread, it is a section of code inside the thread.</p>\n\n<p>How to do this with one is easy - create an EventWaitHandle and wait/signal on it. But every way I've thought of to do 4 leaves the possibility of determining I need to wait, another thread exists the section and signals, and I then wait - forever.</p>\n\n<p>So what is the most light-weight way to do this when all threads are in a single app?</p>\n\n<p>Background: We are changing our licensing model to allow a maximum of N (4 in this example) threads calling our library consecutively. Because we're a library, not a server, we don't control the thread usage (like databases can). In the case of a web app, the calling app also doesn't control the number of threads and so we need to pause thread 5 calling us until one the first 4 exit that code.</p>\n"},{"tags":["c++","windows","multithreading","gcc4.7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13212342,"title":"Whats the difference between thread_posixs and thread_win32 in gcc port of windows?","body":"<p>I wanted to download the latest available version of <code>gcc 4.7.2</code> compiler for windows.<br>\nWhen i got to this <a href=\"http://sourceforge.net/projects/mingwbuilds/files/host-windows/releases/4.7.2/32-bit/\" rel=\"nofollow\">page</a> where i was supposed to see a download link , i  confronted with two categories:</p>\n\n<ol>\n<li>threads-posix</li>\n<li>threads-win32 </li>\n</ol>\n\n<p>Whats the difference between these two?<br>\nAre they thread implementations only?I mean are they only different in how they are implemented and thus the ending result (classes, how to use them,etc ) remains the same?<br>\nOr do they impose a specific coding style?  </p>\n"},{"tags":["java","android","multithreading","game"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13113340,"title":"3 Android Threads, how to structure","body":"<p>I'm building an openGL ES 2 game, with Java on Android.</p>\n\n<p>I currently have two threads. The Android UI and openGL.</p>\n\n<p>As far as I understand it, to get the best performance, I need to have another thread for game logic, so the openGL thread can render as fast as possible.</p>\n\n<p>This would leave me with 3. The Android UI, openGL and Game Logic. (Let's call them UI, OGL and GL.)</p>\n\n<p>Correct me if I'm wrong:</p>\n\n<p>UI starts, makes OGL, and GL.\nOGL and GL run, querying UI for input.\nGL sends draw calls to the queue in OGL.</p>\n\n<p>There are two cases here.\nIf GL takes longer to loop than OGL, the next loop of OGL needs to wait for GL to finish before starting it's next loop, as to avoid only rendering half of the calls for last frame.\nIf OGL takes longer than GL, GL needs to wait until OGL is done to start again/send more draw calls.</p>\n\n<p>To accomplish this:</p>\n\n<p>When GL is done with it's loop, it checks OGL to see if it's done drawing the current queue of draw calls. If so, it starts both GL and OGL's next loop. If not, it waits.</p>\n\n<p>When OGL is done, it checks GL. If GL is done, it starts both loops again. If not, it waits for GL, which when done will check OGL, and start both again.</p>\n\n<p>Sorry if this is a little confusingly worded..</p>\n\n<p>To illistrate my idea:</p>\n\n<p><img src=\"http://img840.imageshack.us/img840/2816/stackoverflowthredpictu.jpg\" alt=\"diagram\"></p>\n\n<p>To clarify me question:\n-Will laying things out this way work?\n--If not, what would work better?</p>\n\n<p>-What <em>specific</em> subjects should I look up to accomplish this?\n--ie I don't know how to make threads or send information between them.</p>\n\n<p>This is my first time asking a question here, hope I did it correctly. :)\nThanks!</p>\n"},{"tags":["java","android","multithreading","bitmap"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13214238,"title":"dynamically change bitmap in imageView, android","body":"<p>All,</p>\n\n<p>I have a problem related to imageView, android.<br>\n  I have array which contains of 10 bitmap objects, called <code>bm</code>.<br>\n  I have a imageView, called <code>im</code>.<br></p>\n\n<p>Now I wanna show the bitmaps in the array in im one by one, so I did the following:</p>\n\n<pre><code>new Thread(new Runnable() {\n       public void run() {\n         for(int j=0;j&lt;10;j++){\n             im.setImageBitmap(bm[j]);\n         }\n       }\n      }).start();\n</code></pre>\n\n<p>But the result only shows the last bitmap in the array.</p>\n\n<p>Can someone tell me what to do with this issue?</p>\n\n<p>Millions of thanks!</p>\n"},{"tags":["java","multithreading","random","iostream","pipes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13214144,"title":"Multiple threads communicating with Pipe streams and using PushbackInputStream","body":"<p>The Question is as the following: </p>\n\n<p>Create 3 threads. </p>\n\n<ul>\n<li>first one will generate 10 random numbers, </li>\n<li>the second will sum the even of these 10. </li>\n<li>the third will sum the odd of the same 10 random numbers. </li>\n</ul>\n\n<p>My Problem is: In the 2nd thread i read all the numbers and push them back to the stream but when the 3rd thread wants to read from the stream, the first value read is -1 ?! </p>\n\n<p>Here is the code:</p>\n\n<pre><code>//main program \nimport java.io.*;\npublic class anonymous {\n\npublic static void main(String[] args) throws  IOException, InterruptedException {\n    final PipedOutputStream out= new PipedOutputStream();  \n    final PipedInputStream in= new PipedInputStream(out);\n    Thread1 th1 = new Thread1(out);\n    Thread2 th2 = new Thread2(in);\n    Thread3 th3 = new Thread3(in); \n    Thread t1 = new Thread(th1);\n    Thread t2 = new Thread(th2); \n    Thread t3 = new Thread(th3); \n    t1.start(); \n    t2.start();\n    t2.join();\n    t3.start(); \n    t3.join();\n    System.out.println(\"main finished.\");   \n}\n}\n\n//Thread1\nimport java.io.*;\nimport java.util.Random;\npublic class Thread1 implements Runnable{\nPipedOutputStream out=null;\nRandom r = new Random();\npublic Thread1(PipedOutputStream send){\n    this.out = send; \n}\npublic void run(){\n    int num;\n    System.out.println(\"thread 1 generated random numbers: \");\n    try{\n    for ( int i=0; i&lt;10; i++)\n        {\n        num=r.nextInt(10);\n        System.out.print(num + \" \");\n        out.write(num);\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    } \ntry {\n    out.close();\n} catch (IOException e) {\n    e.printStackTrace();\n}\nSystem.out.println(\"\\nthread 1 finished\");\n}\n}\n\n//Thread2\nimport java.io.*;\npublic class Thread2 implements Runnable{\nPipedInputStream in=null;\npublic Thread2( PipedInputStream get){\n    this.in = get;\n\n}\npublic void run(){ \n    PushbackInputStream push = new PushbackInputStream(in , 10);\n    //PushbackInputStream takes an InputStream and it will read the first 10 bytes\n            // in the stream and push them back to the stream\n    try {\n        byte[] byteArr = new byte[10]; \n        int i, sum=0, idx=0;\n        i=push.read();\n        while (i != -1)\n        { \n            if( i%2 == 0)\n                sum += i; \n            byteArr[idx]=( byte) i;\n            i=push.read();\n            idx++;\n        }\n        push.unread(byteArr,0 , 10);\n        System.out.println(\"thread 2: the sum of even random numbers: \" + sum); \n    } catch (IOException e) {\n        e.printStackTrace();\n    }\nSystem.out.println(\"thread 2 finished\"); \n}\n}\n\n//Thread3\nimport java.io.*;\npublic class Thread3 implements Runnable{\n\nPipedInputStream in;\npublic Thread3( PipedInputStream get){\n    this.in = get;\n}\npublic void run(){\n    try {\n        int i, sum=0;\n        i=in.read();\n        while (i != -1)\n        { \n            if( i%2 == 1)\n                sum += i; \n            i=in.read();\n        }\n        System.out.println(\"thread 3: the sum of odd random numbers:  \" + sum);\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n    try {\n        in.close();\n    } catch (IOException e){\n        e.printStackTrace();\n    } \nSystem.out.println(\"thread 3 finished\"); \n}\n}\n</code></pre>\n\n<p>the output as follows:  </p>\n\n<blockquote>\n  <p>thread 1 generated random numbers:<br>\n  4 8 7 5 6 8 7 1 0 5<br>\n  thread 1 finished<br>\n  thread 2: the sum of even random numbers:  26<br>\n  thread 2 finished<br>\n  thread 3: the sum of odd random numbers:  0<br>\n  thread 3 finished<br>\n  main finished.  </p>\n</blockquote>\n"},{"tags":["multithreading","progress-bar","pygtk"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":18,"score":-1,"question_id":13214243,"title":"Pygtk, progressbar and threading","body":"<p>I have a problem with pygtk, progressbar and threading.<br/>\nI have a main window with a button and a progressbar.<br/>\nA click on the button launch another module to retrieve data from web. This process is rather long, and I want the progressbar to pulse, without the app hangs.<br/>\nI have tried with Threading, but in all of the example I have found, the \"heavy work\" is simulated by a timer.<br/>\nI want the progressbar to pulse while the the function from the second module run.<br/>\nThanks in advance.<br/><br/>\nMauro</p>\n"},{"tags":["c#",".net","multithreading","timer","instance"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13213406,"title":"Creating instance in multi threaded environment","body":"<p>I am using threaded timer which is creating new instance and call a method like below,            </p>\n\n<pre><code>Timer_tick()\n{\n   Car C;\n   C=new Car();\n   C.Start()      ///  this will take time to complete\n}\n</code></pre>\n\n<p>My question is, there is another thread coming with next timer tick and perform same operation.\nThen the second thread remove the reference from first Car instance &amp; it will call the start method on new Car instance, since first object does not finished his start method (still in progress) but it doesn't have the “C” variable reference anymore.\nWill this create any problem to first instance <code>Start()</code> method completeness or execution. \nCan it be collected by GC?</p>\n"},{"tags":["multithreading","azure","parallel-processing"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1209,"score":0,"question_id":5628276,"title":"What's the RIGHT Way to do Multi-Threading in Azure","body":"<p>I've got an Azure app that needs 3 distinctly unique tasks to run as long-running processes.  I could easily spin up 3 Worker Roles, but that would cost 3x more than I need to spend given how simple the tasks are.  I'd like to run each task in its own thread since each task is very different in the amount of time they take to complete, and how frequently the need to run.</p>\n\n<p>Given that scenario, or even a general multi-threading Azure scenario, what's the best way you know of to have each task run independently?</p>\n\n<p>A few considerations I'd like to propose are:</p>\n\n<ul>\n<li>Keep the CPU utilization low (not always possible with EventWaitHandles..?).</li>\n<li>Uses the most current framework utilities (i.e. TPL or PLINQ).</li>\n<li>Graceful shutdown and restart in case of an unrecoverable exception.</li>\n</ul>\n\n<p>Thanks for the suggestions, links, or code samples.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Here's what I've settled on - Given the code is bound for the Azure cloud, a self-healing option seems the most appropriate.  This approach aims to take a collection of threads and delegate their work to a diversity of \"units of work.\"  </p>\n\n<p>Here's how it's glued together.  First, a simple class to wrap a diversity of workers.</p>\n\n<pre><code>public class ThreadWorker\n{\n    internal void RunInternal()\n    {\n        try\n        {\n            Run();\n        }\n        catch (SystemException)\n        {\n            throw;\n        }\n        catch (Exception)\n        {\n        }\n    }\n\n    public virtual void Run()\n    {\n    }\n\n    public virtual void OnStop()\n    {\n    }\n}\n</code></pre>\n\n<p>Next, the code to keep a series of threads alive indefinitely.  This involves a list of threads, a list of \"workers\" (one per thread), and an infinite loop that checks the status of each thread on a given interval.</p>\n\n<p>Note that an exception that terminates a thread won't tear down the other threads.  If an unhandled exception is encountered, the thread will be restarted the next time the event wait handle responds.</p>\n\n<pre><code>private readonly List&lt;Thread&gt; _threads = new List&lt;Thread&gt;();\nprivate readonly List&lt;ThreadWorker&gt; _workers = new List&lt;ThreadWorker&gt;();\nprivate EventWaitHandle EventWaitHandle = new EventWaitHandle(false, EventResetMode.ManualReset);\n\npublic override void Run()\n{\n    foreach (var worker in _workers)\n    {\n        _threads.Add(new Thread(worker.RunInternal));\n    }\n\n    foreach (var thread in _threads)\n    {\n         thread.Start();\n    }\n\n    while (!EventWaitHandle.WaitOne(500))\n    {\n         // Restart any threads that have stopped running\n         for (var i = 0; i &lt; _threads.Count; i++)\n         {\n               if (_threads[i].IsAlive)\n               {\n                   continue;\n               }\n\n                _threads[i] = new Thread(_workers[i].RunInternal);\n                _threads[i].Start();\n          }\n\n          EventWaitHandle.WaitOne(2000);\n    }\n}\n</code></pre>\n\n<p>Simple enough - the main thread (in this case an Azure worker role's Run method) blocks for half a second between checks to the active list of threads.  Terminated threads are re-started and the host thread then blocks for 2 seconds before checking the worker threads' health again.</p>\n\n<p>Adding workers is as simple as adding a list of classes that inherit from the ThreadWorker base class</p>\n\n<pre><code>_workers.Add(new SomeWorker());\n_workers.Add(new AnotherWorker());\n</code></pre>\n\n<p>And, finally, the concrete workers:</p>\n\n<pre><code>public class SomeWorker: ThreadWorker\n{\n    public override void Run()\n    {\n        while (true)\n        {\n            // Do your long running work here.\n\n            Thread.Sleep(2000); // Take a breather - not necessary.\n        }\n    }\n}\n\npublic class AnotherWorker: ThreadWorker\n{\n    public override void Run()\n    {\n        while (true)\n        {\n            // Do your long running work here.\n        }\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","qt","qt4","qthread"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13212623,"title":"QThread hungs up when calling isRunning on it","body":"<p>I have a <code>QThread</code> that fetches data from the web. Sometimes the user asks for something else, and the data needs to be fetched changes as well.</p>\n\n<p>In my current configuration, I call <code>terminate()</code> upon the thread, change the input data, and call <code>start()</code> on the thread again. Now, that works fine, but sometimes I get the main eventloop stuck when calling <code>isRunning()</code> or <code>isFinished()</code> upon a terminated thread. It gets stuck forever, and does not recover until I kill the process.</p>\n\n<ol>\n<li>Why would <code>isRunning()</code> or <code>isFinished()</code> hung in the first place? They don't suppose to block.</li>\n<li>Is this workflow acceptable? If not, how can I stop a thread's process when I don't need it no more (or how can I abandon it)?</li>\n</ol>\n"},{"tags":["c#","multithreading","parallel-processing","concurrentdictionary","blockingcollection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13150998,"title":"Can Bounded BlockingCollections Lose Data During Adds","body":"<p>I have a BlockingCollection(ConcurrentBag, 50000) where I am trying to use a very small Bounded Capacity of 50,000 for the producer threads in order to maximize the number of records I can process in my consumer thread's ConcurrentDictionary.  The producer is much, much faster than the consumer and will consume most of the memory otherwise.</p>\n\n<p>Unfortunately, I immediately noticed that the total number of records in my ConcurrentDictionary is now substantially lower than it should be after adding the bounded capacity of 50,000 when my test data executes.  I read that the BlockingCollection's .add method should block indefinitely until there is space in the collection for the add to execute.  However, this does not appear to be the case.   </p>\n\n<p><strong>Questions:</strong>      </p>\n\n<ol>\n<li><p>Will a BlockingCollection's .add method eventually time out or silently fail if too many add's are called before capacity in the BlockingCollection frees up?</p></li>\n<li><p>If the answer to #1 is yes, how many adds can I attempt after the Bounding Capacity has been exceeded without losing data?</p></li>\n<li><p>If many BlockingCollection .add() methods are called which are waiting / blocking for capacity and the CompleteAdding() method is called, will those waiting / blocking adds continue to wait and then eventually add or do they silently fail?  </p></li>\n</ol>\n"},{"tags":["java","multithreading","spring","amazon-ec2"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13211937,"title":"Blocked threads in getBeanFactory","body":"<p>I have a high throughput server, running with spring IOC (2.5.6) on Amazon EC2 (Virginia). In the past few days I didn't do any changed in the code (only some configuration changes), but suddenly I started seeing crazy locking issue with spring. The application seem to spend 60%-80% of it's time trying to get beans (different beans, from different areas of the code), and a thread dump shows most threads are stuck in the following manner:</p>\n\n<pre><code>Thread 15148: (state = BLOCKED)\n - org.springframework.context.support.AbstractRefreshableApplicationContext.getBeanFactory() @bci=6, line=151 (Compiled frame)\n - org.springframework.context.support.AbstractApplicationContext.getBean(java.lang.String) @bci=1, line=880 (Compiled frame)\n</code></pre>\n\n<p>Our application is very IO intensive, so I expect to see most of the time spent on database connections and HTTP client access. \nI'm not sure which additional information I can provide here.</p>\n\n<p>Anyone seen something of that sort?</p>\n"},{"tags":["ios","multithreading","core-data","nsmanagedobjectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13204589,"title":"Core Data managed object context design recommendation","body":"<p>We are working on an Enterprise-level application, which will store tens of thousands of objects with Core Data, and we are having issues on several fronts.</p>\n\n<hr>\n\n<p>Our application has several independent systems which operate on the data when needed. These systems include discovery of items, loading of items, synchronization and UI display. If we design our software correctly, there should be little to none merge conflicts due to the different systems modifying same objects. Each system has its own operation queues, all performing in the background. We wish to keep all object creation and modification in the background to minimize UI performance issues, especially during initial ramp up, where thousands of objects might be created from data on the server. Here we have hit several problems with our various design attempts. Huge memory consumption during these ramp ups, and incorrect orchestration of all the contexts and child contexts, causing deadlocks and crashes.\nWe have attempted the following designs:</p>\n\n<ul>\n<li>One root <code>NSPrivateQueueConcurrencyType</code> managed object context which has one child <code>NSMainQueueConcurrencyType</code> context. The UI fetched results controllers use this child context to fetch results from. From the <code>NSMainQueueConcurrencyType</code> child context, we created one <code>NSPrivateQueueConcurrencyType</code> child context, which we called \"savingContext\" and each background operation created a child context of that \"savingContext\", did its changes, and finally did what we called a \"deep save\", recursively saving to the top. We initially chose this design to not have to deal with <code>NSManagedObjectContextDidSaveNotification</code> notifications from many different child contexts. We wrapped every call to the <code>NSPrivateQueueConcurrencyType</code> contexts and access to objects with <code>performBlockAndWait:</code>. Functionally, this design performed. All changes and inserts were saved to the persistent store, and UI was updated with the changes. This, introduced two issues. One was laggy UI during ramp up because of merged changes going through the <code>NSMainQueueConcurrencyType</code> child context, and more importantly, very high memory usage during ramp up. We would hit prohibitive RAM usages due to inability to call <code>reset</code> recursively on contexts (as the main UI child context is there too) and/or lack of knowledge when to call <code>refreshObject:mergeChanges:</code>. So we went a different road.</li>\n<li>Have two top-level contexts linked with the persistent store coordinator, one <code>NSPrivateQueueConcurrencyType</code> for save child contexts, and a <code>NSMainQueueConcurrencyType</code> for UI display. The <code>NSMainQueueConcurrencyType</code> listens to <code>NSManagedObjectContextDidSaveNotification</code> notifications from the main <code>NSPrivateQueueConcurrencyType</code> context and merges them in the main thread. Each background operation creates a child context of the main <code>NSPrivateQueueConcurrencyType</code> context, also with private queue concurrency type, does what it does, performs a \"deep save\" recursively, which performs a save on the current context, a recursive call of deep save to its parent, calls reset on the current context and saves again. This way we avoid the memory issues, as created objects are released quickly after save. However, with this design, we have hit a plethora of issues such as dead locks, <code>NSInternalInconsistencyException</code> exceptions and fetched results controllers not updating the UI despite there being save notifications for the <code>NSMainQueueConcurrencyType</code> context. This also cause initial load times in the UI to slow a lot. In the previous design, the fetched results controller returned results very fast, while this has the UI blocked for several seconds until the view loads (we initialize the fetched results controller in <code>viewDidLoad</code>).</li>\n</ul>\n\n<p>We have tried many intermediate designs, but they all revolve around the same issues, either very high memory usage, fetched results controller not updating the UI or deadlocks and <code>NSInternalInconsistencyException</code> exceptions.</p>\n\n<hr>\n\n<p>I am really getting frustrated. I can't but feel as if our designs are overtly complicated for something that should be rather simple, and it is just our lack of understanding some fundamental that is killing us.</p>\n\n<hr>\n\n<p>So what would you guys suggest? What arrangement would you recommend for our contexts? How should we manage different contexts in different threads? Best practices for freeing up inserted objects and resetting contexts? Avoiding dead locks? All help would be appreciated at this point.</p>\n\n<hr>\n\n<p>I have also seen recommendations for the MagicalRecords category. Is it recommended? We have are already invested in using Core Data types, how difficult would it be to migrate using MR?</p>\n"},{"tags":["c","multithreading","parallel-processing","openmp"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13209686,"title":"openMP:why am I not getting different thread ids when i uses \" #pragma omp parallel num_threads(4)\"","body":"<p>Why am I not getting different thread ids when I uses \" #pragma omp parallel num_threads(4)\". All the thread ids are 0 in this case. \nBut when I comment the line and use default number of threads, I got different thread ids.\nNote:- variable I used variable tid to get thread id.</p>\n\n<pre><code>#include &lt;omp.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main (int argc, char *argv[]) \n{\nint nthreads, tid;\nint x = 0;\n\n#pragma omp parallel num_threads(4)\n#pragma omp parallel private(nthreads, tid)\n  {\n  /* Obtain thread number */\n tid = omp_get_thread_num();\n  printf(\"Hello World from thread = %d\\n\", tid);\n\n  // /* Only master thread does this */\n   if (tid == 0) \n     {\n     nthreads = omp_get_num_threads();\n     printf(\"Number of threads = %d\\n\", nthreads);\n     }\n\n  }\n\n\n}\n</code></pre>\n\n<p>Output of above code:-</p>\n\n<p>Hello World from thread = 0</p>\n\n<p>Hello World from thread = 0</p>\n\n<p>Number of threads = 1</p>\n\n<p>Hello World from thread = 0</p>\n\n<p>Number of threads = 1</p>\n\n<p>Hello World from thread = 0</p>\n\n<p>Number of threads = 1</p>\n\n<p>Number of threads = 1</p>\n\n<p>Output when I comment the line mentioned above:-\nHello World from thread = 3</p>\n\n<p>Hello World from thread = 0</p>\n\n<p>Number of threads = 4</p>\n\n<p>Hello World from thread = 1</p>\n\n<p>Hello World from thread = 2</p>\n"},{"tags":["c#","multithreading","windows-phone-7","xna","invalid"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12477311,"title":"Invalid cross-thread access from XNA GamerService","body":"<p>I am asking the user of my app per the XNA GamerService dialog-box, if he really wants to delete a specific product.</p>\n\n<p>And if he presses yes, this will take action:</p>\n\n<pre><code>private void OnMessageBoxAction(IAsyncResult ar)\n        {\n            int? selectedButton = Guide.EndShowMessageBox(ar);\n            switch (selectedButton)\n            {\n                case 0:\n                    WebClient cweight = new WebClient();\n                    cweight.Encoding = System.Text.Encoding.GetEncoding(\"ISO-8859-1\");\n\n                    cweight.Credentials = new NetworkCredential(op.username, op.userpass);\n                    cweight.DownloadStringCompleted += new DownloadStringCompletedEventHandler(deleted);\n                    cweight.DownloadStringAsync(new Uri(\"http://mydomain.com\"));\n                    break;\n\n                case 1:\n                    Debug.WriteLine(\"1 pressed\");\n                    break;\n\n                default:\n                    Debug.WriteLine(\"default pressed\");\n                    break;\n            }\n        }\n</code></pre>\n\n<p>and when the download completes, I invoke the login method:</p>\n\n<pre><code>private void deleted(object sender, DownloadStringCompletedEventArgs e)\n        {\n            Debug.WriteLine(\"\\n[#] deleted\");\n\n            if (e.Error != null)\n            {\n                Debug.WriteLine(\"Delete problem\");\n            }\n\n            Debug.WriteLine(\"Delete successful\");\n            login(null, null);\n        }\n</code></pre>\n\n<p>later on at <code>login</code> I get the invalid cross-thread access at <code>globalprogress.Visibility = System.Windows.Visibility.Visible;</code> and I am pretty sure, that that error would occur through the whole login method.</p>\n"},{"tags":["windows","multithreading","winapi","suspend"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2508,"score":4,"question_id":3444190,"title":"Windows SuspendThread doesn't? (GetThreadContext fails)","body":"<p>We have an Windows32 application in which one thread can stop another to inspect its \nstate [PC, etc.], by doing SuspendThread/GetThreadContext/ResumeThread.</p>\n\n<pre><code>if (SuspendThread((HANDLE)hComputeThread[threadId])&lt;0)  // freeze thread\n   ThreadOperationFault(\"SuspendThread\",\"InterruptGranule\");\nCONTEXT Context, *pContext;\nContext.ContextFlags = (CONTEXT_INTEGER | CONTEXT_CONTROL);\nif (!GetThreadContext((HANDLE)hComputeThread[threadId],&amp;Context))\n   ThreadOperationFault(\"GetThreadContext\",\"InterruptGranule\");\n</code></pre>\n\n<p>Extremely rarely, on a multicore system, GetThreadContext returns error code 5 (Windows system error code \"Access  Denied\").</p>\n\n<p>The SuspendThread documentation seems to clearly indicate that the targeted thread is suspended, if no error is returned. We are checking the return status of SuspendThread and ResumeThread; they aren't complaining, ever.</p>\n\n<p>How can it be the case that I can suspend a thread, but can't access its context?</p>\n\n<p>This blog\n<a href=\"http://www.dcl.hpi.uni-potsdam.de/research/WRK/2009/01/what-does-suspendthread-really-do/\" rel=\"nofollow\">http://www.dcl.hpi.uni-potsdam.de/research/WRK/2009/01/what-does-suspendthread-really-do/</a></p>\n\n<p>suggests that SuspendThread, when it returns, may have <em>started</em> the \nsuspension of the other thread, but that thread hasn't yet suspended.  In this case, I can kind of see how GetThreadContext would be problematic, but this seems like a stupid way to define SuspendThread. (How would the call of SuspendThread know when the target thread was actually suspended?)</p>\n\n<p>EDIT: <em>I lied.</em> I said this was for Windows. </p>\n\n<p>Well, the strange truth is that I don't see this behavior under Windows XP 64 (at least not in the last week and I don't really know what happened before that)... but we have been testing this Windows application under Wine on Ubuntu 10.x.  The <a href=\"http://source.winehq.org/source/dlls/ntdll/thread.c#L766\" rel=\"nofollow\">Wine source for the guts of GetThreadContext</a> contains\nan Access Denied return response on line 819 when an attempt to grab the thread state fails for some reason. I'm guessing, but it appears that Wine GetThreadStatus believes that a thread just might not be accessible repeatedly.  Why that would be true after a SuspendThead is beyond me, but there's the code.  Thoughts?</p>\n\n<p>EDIT2: <em>I lied again</em>.  I said we only saw the behavior on Wine.  Nope... we have now found a Vista Ultimate system that seems to produce the same error (again, rarely).   So, it appears that Wine and Windows agree on an obscure case. It also appears that the mere enabling of the Sysinternals Process monitor program aggravates the situation and causes the problem to appear on Windows XP 64; I suspect a Heisenbug.  (The Process Monitor\ndoesn't even exist on the Wine-tasting (:-) machine or the XP 64 system I use for development).</p>\n\n<p>What on earth is it?</p>\n\n<p>EDIT3: Sept 15 2010.  I've added careful checking to the error return status, without otherwise disturbing the code, for SuspendThread, ResumeThread, and GetContext.  I haven't seen <em>any</em> hint of this behavior on Windows systems since I did that.  Haven't gotten back to the Wine experiment.</p>\n\n<p>Nov 2010: Strange.  It seems that if I compile this under VisualStudio 2005, it fails on Windows Vista and 7, but not earlier OSes.  If I compile under VisualStudio 2010, it doesn't fail anywhere.  One might point a finger at VisualStudio2005, but I'm suspicious of a location-sensitivve problem, and different optimizers in VS 2005 and VS 2010 place the code a slightly different places.</p>\n\n<p>Nov 2012: Saga continues.  We see this failure on a number of XP and Windows 7 machines, at a pretty low rate (once every several thousand runs).  Our Suspend activities are applied to threads that mostly execute pure computational code but that sometimes make calls into Windows.    I don't recall seeing this issue when the PC of the thread was in our computational code.   Of course, I can't see the PC of the thread when it hangs because GetContext won't give it to me, so I can't directly confirm that the problem only happens when executing system calls.  But, all our system calls are channeled through one point, and so far the evidence is that point was executed when we get the hang. So the indirect evidence suggests GetContext on a thread only fails if a system call is being executed by that thread.    I haven't had the energy to build a critical experiment to test this hypothesis yet.</p>\n"},{"tags":["wpf","multithreading","user-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":122,"score":0,"question_id":7272683,"title":"Updating UI when XML changes","body":"<p>I have a UI in a window, which is bound to an XML file. I need to update the UI whenever I manually go and change my XML file.</p>\n\n<p>Following is the <a href=\"http://whatis.techtarget.com/fileformat/WAML-XPlore-Web-Application-Markup-Language-Alfega-Technologies-Inc\" rel=\"nofollow\">WAML</a> file:</p>\n\n<pre><code>&lt;Window x:Class=\"WpfApplication1.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\"&gt;\n    &lt;Window.Resources&gt;\n        &lt;XmlDataProvider x:Key=\"dataSource\" Source=\"Data/Media.xml\"&gt;\n        &lt;/XmlDataProvider&gt;\n    &lt;/Window.Resources&gt;\n    &lt;Grid&gt;\n        &lt;ListBox Name=\"listBox1\" DataContext=\"{Binding Source={StaticResource dataSource}, XPath=/Media/Book/@Title, Mode=OneWay}\" /&gt;\n    &lt;/Grid&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>The following is the XML file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;\n&lt;Media&gt;\n    &lt;Book Author='John' Title='Fish are my aaaa friends' /&gt;\n    &lt;Book Author='Dave' Title='Fish are my enemies' /&gt;\n    &lt;Book Author='Jane' Title='Fish are my food' /&gt;\n&lt;/Media&gt; \n</code></pre>\n\n<p>I have a window object in the service layer. To initialise it, I did the following: </p>\n\n<p><code>winobj.DataContext = node.OuterXml; winobj.Show();</code> where <code>node</code> is my XML string which I get from the server. If I ask you to update this winobj or reset its datacontext so that the UI is updated, how will you do it?</p>\n\n<p>My UI is bound in the following way.</p>\n\n<pre><code>&lt;Window.Resources&gt;\n    &lt;XmlDataProvider x:Key=\"Data\" XPath=\"//WindowUpdate\" /&gt;\n&lt;/Window.Resources&gt;\n&lt;Label Content=\"{Binding Source={StaticResource Data},\n       XPath=Window/Children/Label[@id\\=\\'lblInterval\\']/@text}\" ...\n</code></pre>\n"},{"tags":["objective-c","multithreading","cocoa","concurrency"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13210130,"title":"Put object and delegate on a separate thread (concurrency)","body":"<p>I would like to <strong>set a</strong> <code>NSSpeechRecognizer</code> <strong>delegate to run on a separate thread</strong> from the main thread. In the delegate, I want to be able to call a function on the main thread when needed.</p>\n\n<p>How do I accomplish this?</p>\n\n<p><strong>EDIT</strong>\nI have tried this (I kept the actual delegate method on the main thread):</p>\n\n<pre><code>-(void)speechRecognizer:(NSSpeechRecognizer *)sender didRecognizeCommand:(id)aCmd {\n    [self performSelectorInBackground:@selector(testtherun:) withObject:aCmd];\n}\n\n-(void)testtherun:(id)aCmd{\n   //accomplish tasks\n}\n</code></pre>\n\n<p>But what I really need is for the entire method to be on a separate thread, not just the code within the method. How do I do so?</p>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13210230,"title":"How can we get performance improved after getting another new application server?","body":"<p>Currently we have one application server, and we have a windows service running on it - retrieving data from database, filling out to a DataTable, and then do some kind of caculation and update each row in DataTable, finally save changes into Database.</p>\n\n<p>And soon we would get another application server, what/how can we gain from this added physical resource(processor), HOW can we use multiple threads technology to improve the performance? Is there any best practices which i can follow in this case of multiple application servers?</p>\n\n<p>Any comments is welcome.</p>\n"},{"tags":["android","multithreading","handlers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13209783,"title":"3 Threads + 3 Handlers don't work","body":"<p>I have 3 threads and 1 handler in each thread. But it only works one, the other 2 handlers clear the textview completely. </p>\n\n<p>Code:</p>\n\n<pre><code> Thread getServerStatus = new Thread() {                     \n        public void run() {                                                                         \n            Document doc;\n            try {\n                doc = dereference(\"my url\");\n                String text = doc.select(\"div#serverstatus\").toString();\n                Message msg = handler_serverstatus.obtainMessage();\n                msg.obj = text;\n                handler_serverstatus.sendMessage(msg);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n\n        }\n\n        Handler handler_serverstatus = new Handler()\n        {\n            public void handleMessage(Message msg)\n            {\n                 String text = (String)msg.obj;\n                 TextView tv = (TextView)findViewById(R.id.server_status);\n                 if(text.contains(\"online\")) {\n                     //tv.setTextColor(2);\n                     tv.setText(\"online\");\n                 } else if(text.contains(\"offline\")) {\n                     tv.setText(\"offline\");\n                 } else {\n                     tv.setText(\"Error #1\");\n                 }\n            }\n\n        };\n    };\n\n    Thread getPlayersOnline = new Thread() {                     \n        public void run() {                                                                         \n            Document doc;\n            try {\n                doc = dereference(\"my url\");\n                String text = doc.select(\"div#players_on\").toString();\n                Message msg = handler_players.obtainMessage();\n                msg.obj = text;\n                handler_players.sendMessage(msg);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n\n        }\n\n        Handler handler_players = new Handler()\n        {\n            public void handleMessage(Message msg)\n            {\n                 String text = (String)msg.obj;\n                 TextView tv = (TextView)findViewById(R.id.players_online);\n                 text = text.replace(\"&lt;div id=\\\"players_on\\\"&gt;\", \"\");\n                 text = text.replace(\"&lt;/div&gt;\", \"\");\n                 tv.setText(text);\n            }\n\n        };\n    };\n\n    Thread getPlayersMax = new Thread() {                     \n        public void run() {                                                                         \n            Document doc;\n            try {\n                doc = dereference(\"url\");\n                String text = doc.select(\"div#players_max\").toString();\n                Message msg = handler_players_max.obtainMessage();\n                msg.obj = text;\n                handler_players_max.sendMessage(msg);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n\n        }\n\n        Handler handler_players_max = new Handler()\n        {\n            public void handleMessage(Message msg)\n            {\n                 String text = (String)msg.obj;\n                 TextView tv = (TextView)findViewById(R.id.players_max);\n                 text = text.replace(\"&lt;div id=\\\"players_max\\\"&gt;\", \"\");\n                 text = text.replace(\"&lt;/div&gt;\",  \"\");\n                 tv.setText(text);\n            }\n\n        };\n    };\n\n    public void ButtonClick(View view) throws IOException {\n        getServerStatus.start();\n        getPlayersOnline.start();\n        getPlayersMax.start();\n    }\n\n    private Document dereference(String uri) throws IOException {\n        Connection connection = Jsoup.connect(uri);\n        return connection.get();\n    }\n</code></pre>\n\n<p>Is this maybe totally wrong?</p>\n"},{"tags":[".net","vb.net","multithreading","web-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":13019135,"title":"InvalidOperationException when invoking web service using threads VB. Net","body":"<p>I added a web reference to my project.</p>\n\n<p>I'm using threads, they call to web service of this way:</p>\n\n<pre><code>Private Sub principal()\n    Dim arrayH As New ArrayList\n    Dim h As Thread\n    Dim z As Integer = 150\n\n    For i As Integer = 1 To Z\n        h= New Thread(AddressOf doWork)\n        arrayH.Add(h)\n    Next\n\n\n    For Each _h As Thread In arrayH\n        _h.Start()\n    Next\nEnd Sub\n\nPrivate Sub doWork()\n    Dim service As webService.Query\n    Dim parameter, response As String\n\n    parameter = \"...\"'The parameter is a xml\n\n    Try\n        service = New Query\n        response = service.Report(parameter)\n\n    Catch ex As Exception\n        'do something\n    End Try\n\nEnd Sub\n</code></pre>\n\n<p>When there are many threads (Z = 150) it throws:</p>\n\n<pre><code>System.InvalidOperationException\n\nThere is an error in XML document (1, 279).\n\nUnable to read data from the transport connection: The connection was closed. \n</code></pre>\n\n<p>In case that Z is small no problem. How do I avoid this?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":87,"score":3,"question_id":13209691,"title":"Static method, static field and multitheading in C#","body":"<p>I have 1 static class and 1 field and 2 methods within it:</p>\n\n<pre><code> static class MyClass{\n\n       private static HttpClient client = new HttpClient();\n       private static string SendRequestToServer(int id)\n       {\n          Task&lt;HttpResponseMessage&gt; response = client.GetAsync(\"some string\");\n          responseTask.ContinueWith(x =&gt; PrintResult(x));\n          return \"some new value\";\n        }\n\n        private static void Print(Task&lt;HttpResponseMessage&gt; task)\n        {\n            Task&lt;string&gt; r = task.Result.Content.ReadAsStringAsync();\n            r.ContinueWith(resultTask =&gt; Console.WriteLine(\"result is: \" + resultTask.Result));\n        }\n }\n</code></pre>\n\n<p>The question is, if many threads start using <code>MyClass</code> and its methods, would it cause some problems?</p>\n"},{"tags":["objective-c","ios","multithreading","core-data","nsmanagedobjectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13146139,"title":"Creating ManagedObjectContext and merging after concurrent core data update","body":"<p>I <em>know</em> I'm missing quite a bit here, but I can't find any tutorials with code and it's been driving me nuts.</p>\n\n<p>I have an app that shows items in a table view (pulled from core data) that can be updated via pull-to-refresh. The updater pulls new data from a REST API and stores it in core data, and refreshes the master set of data contained within my TableViewController.</p>\n\n<p>Obviously I would like the pull-to-refresh to be non-blocking, and so I've implemented it within a MOC:performBlock method call.  Everything seems to work but I'm randomly getting application crashes when performing database operations within my model and I know it's because I'm managing my MOCs and persistent object model incorrectly.  If anyone could point me in the right direction I'd be grateful.</p>\n\n<p>Here's the method that actually performs the data and table refresh.  Below I will list a bunch of auxiliary code that may be useful:</p>\n\n<pre><code>-(void)refresh {\n\n    NSManagedObjectContext *child = [[NSManagedObjectContext alloc]initWithConcurrencyType:NSPrivateQueueConcurrencyType];\n    [child setParentContext:self.db];\n\n    [child performBlock:^{\n        model = [[CustomersModel alloc] init];\n        self.custs = [model getUpdatedCustomers:self.db];\n        self.workingSet = self.custs;\n        dispatch_async(dispatch_get_main_queue(), ^{\n\n            [super performSelector:@selector(stopLoading) withObject:nil afterDelay:1.0];\n        });\n    }];\n}\n\n-(void)stopLoadingComplete {\n\n    ...\n    [self.tableView reloadData];\n}\n</code></pre>\n\n<p>Here's my appdelegate code for setting up MOC, persistent data store etc:</p>\n\n<pre><code>- (NSManagedObjectContext *)managedObjectContext\n{\n\n    if (__managedObjectContext != nil)\n    {\n        return __managedObjectContext;\n    }\n\n    NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator];\n    if (coordinator != nil)\n    {\n        __managedObjectContext = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];\n        [__managedObjectContext setPersistentStoreCoordinator:coordinator];\n    }\n    return __managedObjectContext;\n}\n</code></pre>\n\n<p>Here's my app delegate code for assigning MOC to UITableViewControllers:</p>\n\n<pre><code>CustomerListViewController *clvc = [[CustomerListViewController alloc] initWithNibName:@\"CustomerListViewController\" bundle:nil withManagedContext:self.managedObjectContext];\nclvc.detailViewController = detailViewController;\nUINavigationController *clvcNav = [[UINavigationController alloc] initWithRootViewController:clvc];\n</code></pre>\n\n<p>Here's my customer list view controller's code for assigning MOC:</p>\n\n<p>customerlistview.h:</p>\n\n<pre><code>#import &lt;UIKit/UIKit.h&gt;\n#import \"CustomersModel.h\"\n#import \"SearchBarTableViewController.h\"\n\n@interface CustomerListViewController : SearchBarTableViewController\n{\n    CustomersModel *model;\n}\n\n- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil withManagedContext:(NSManagedObjectContext *)db;\n\n@property (retain) IBOutlet UISearchBar *searchBar;\n@property (strong, nonatomic)NSManagedObjectContext *db;\n@property (strong, nonatomic)NSArray *custs, *workingSet;\n\n@end\n</code></pre>\n\n<p>customerlistview.m:</p>\n\n<pre><code>- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil withManagedContext:(NSManagedObjectContext *)passedDB {\n\n    self.db = passedDB;\n    return [self initWithNibName:nibNameOrNil bundle:nibBundleOrNil];\n}\n</code></pre>\n"},{"tags":["vb.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13208893,"title":"Why is my VB.NET htmlelementcollection code throwing cast errors when used in threading?","body":"<p>I have written some code in VB.NET which 'grabs' the src/URL of an image based on its 'alt' attribute. It works perfectly on some sites, but on others it requires threading - to wait until the images have loaded, because the images have not loaded by the time the DocumentCompleted occurs.</p>\n\n<p>My problem is that when my code is used with threading, I get an <code>invalidcastexception</code> error.</p>\n\n<p>Here is my code, and where the error occurs:</p>\n\n<pre><code>Private Sub WB1_DocumentCompleted(sender As Object, e As WebBrowserDocumentCompletedEventArgs) Handles WB1.DocumentCompleted\n    urlBox.Text = e.Url.ToString()\n\n    If urlBox.Text = \"URL_GOES_HERE\"\n        Dim success As Integer = site.fill() 'calls another function, returns 1 on success\n        If success = 1 Then\n            Dim captchaThread As New Thread(New ThreadStart(AddressOf getCaptchaURL))\n            captchaThread.Start()\n        End If\n    End If\nEnd Sub\n\nPublic Function getCaptchaURL()\n    Thread.Sleep(5000) 'Tell thread to sleep so images can load\n    Dim URL As String\n    Dim images As HtmlElementCollection = WB1.Document.GetElementsByTagName(\"img\") 'This is where I get the 'invalidcastexception' error\n    For Each element As HtmlElement In images\n        Dim source As String = element.GetAttribute(\"alt\").ToString\n        If source = \"CAPTCHA Image\" Then\n            URL = element.GetAttribute(\"src\")\n            MessageBox.Show(URL) 'Show URL to check the source has been grabbed\n        End If\n    Next\n    Return URL 'Return URL for further functions\nEnd Function\n</code></pre>\n\n<p>So, to clarify, this code: <code>Dim images As HtmlElementCollection = WB1.Document.GetElementsByTagName(\"img\")</code> gives me an error when used with threads, but doesn't when not used in threads.</p>\n"},{"tags":["java","multithreading","swing","event-dispatch-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13208668,"title":"MultiThreading Swing Event Dispatcher Thread","body":"<p>I already have a post related to the multithreading issue but I have some new questions+code. I have a multiball game project and it requires me to parse an XML file to obtain information about the ball(like size, speed, initial position etc). Now, I wanted to create a different thread to parse the XML file, but I cannot figure out a way to do it. Here is my code:</p>\n\n<p>main() starts here:</p>\n\n<pre><code>public class BounceBallApp extends JFrame{\n\n    public BounceBallApp()\n    {\n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        setTitle(\"BounceBallApp\");          \n        setSize(300,300);       \n        setVisible(true);\n        add(new BallWorld());\n        validate();\n    }\n\n    public static void main(String[] args) \n    {\n        /*Create main GUI in the Event Dispatch Thread*/\n        SwingUtilities.invokeLater(new Runnable()\n        {\n            public void run()\n            {\n                new BounceBallApp(); //main frame\n            }\n        });\n\n    }\n}\n</code></pre>\n\n<p>Within the constructor for BallWorld(), I have an inner class BallContainer(), which contains a Start button:</p>\n\n<pre><code>jbtStart.addActionListener(new ActionListener()\n            {public void actionPerformed(ActionEvent e)\n            {\n                //Populate the ballList arraylist\n                if(filePathField.getText().equals(\" \"))\n                {\n                    JOptionPane.showMessageDialog(null, \"Please input the XML file\",\"Information\", JOptionPane.INFORMATION_MESSAGE);        \n                }\n                else\n                {\n                    XMLFilePath = filePathField.getText();\n\n                    ballList = new BallList(XMLFilePath);//I want to put this in a thread\n                    JOptionPane.showMessageDialog(null,\"Game started!\",\"Bouncing Balls\",JOptionPane.INFORMATION_MESSAGE);\n                    for(Ball ball:ballList.ballsArrayList) \n                    {\n                        timer.setDelay(1000/ball.getSpeed()); //change the delay of the timer to the ball's speed\n                        timer.start(); //start the timer\n                        bTimer = true; //timer is now on                    \n                    }\n                }\n\n            }\n            });\n\n        }\n</code></pre>\n\n<p>Now the problem is that if I put the parsing process in another thread, then I have to wait for the ballsArrayList to fill before I can continue with the application. I was thinking of using invokeAndWait() but I read that that method cannot be called from the Event Dispatch Thread. So, How can I achieve this? Or is it even worthwhile? \nAlso, I wanted to move the calculation for moving the ball (calculating the x,y coords) to a thread, but again, I don't know how to implement it. </p>\n\n<pre><code>for(Ball ball:ballList.ballsArrayList) \n            {\n                ball.draw(g);                   \n                ball.move(ballContainerWidth,ballContainerHeight,buttonPanel.getHeight());                  \n            }\n\npublic void move(int ballContainerWidth,int ballContainerHeight,int buttonPanelHeight)\n {\n\n     if((this.getX()+this.getsize()+this.getDx()) &gt; ballContainerWidth) \n        {\n            this.setDx(-Math.abs(this.getDx()));\n        }\n\n        //the height/depth to which the balls can bounce is the (main ball container height) minus (button panel height)\n        if((this.getY()+this.getsize()+this.getDy()) &gt; ballContainerHeight-buttonPanelHeight) \n        {\n            this.setDy(-Math.abs(this.getDy()));\n        }\n\n        if((this.getX()-this.getsize()) &lt; 0 )\n        {\n            this.setDx(Math.abs(this.getDx()));\n        }\n\n        if((this.getY()-this.getsize()) &lt; 0 )\n        {\n            this.setDy(Math.abs(this.getDy()));\n        }\n\n\n        int newX = (int)Math.round((this.getX()+this.getDx()));\n        int newY = (int)Math.round((this.getY()+this.getDy()));\n        this.setX(newX);\n        this.setY(newY);\n }\n</code></pre>\n\n<p>Sorry for the long post, but multithreading is all new to me. I am a bit confused about it.</p>\n"},{"tags":["java","multithreading","java-ee","servlets","struts2"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13203731,"title":"Is the use of servlet better than the action-classes in struts2?","body":"<p>As it is known, that <strong>Servlets</strong> use individual threads for the respective <em>requests</em> and this improves the efficiency of server.\nWhereas, in the struts2 framework, each mapped <strong>Action-Class</strong> has its own object been created for the respective <em>requests</em>.</p>\n\n<p>Now, how is it a good practice(optimised) in struts2 to have individual objects as compared to just threads in ordinary servlets ? Why don't we just have servlets !?</p>\n"},{"tags":["ios","multithreading","objective-c-blocks","nsoperation","grand-central-dispatch"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1689,"score":2,"question_id":5965728,"title":"Using block or NSOperation for loading Image?","body":"<p>I need to know if it's better to use NSOperation or Block to load a large number of image into a UIScrollView? I create all the Imageview and positioning each UIImageView in the right position into the scroll.</p>\n\n<p>To avoid memory warning I choose to load the image once at time. My idea is to create a sort of queue and insert all the image to load in the queue. I have to use block or NSOperation to do this?</p>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":24,"score":-1,"question_id":13206033,"title":"The control flow of my main method (which basically tells a bunch of threads to run) is not working the way it should","body":"<p>My main method is trying to start and terminate each and every thread in sequential order before it goes onto the next one on the line below. This means that the object guest0 is stuck waiting for one of the DeskEmployee objects to release a semaphore it has acquired, and the rest of the program simply fails to execute. How do I get it not to do this?</p>\n\n<pre><code>public static void main(String[] args) {\n        Project2 proj = new Project2();\n        Project2.Guest guest0 = proj.new Guest();\n        Project2.Guest guest1 = proj.new Guest();\n        Project2.Guest guest2 = proj.new Guest();\n        Project2.Guest guest3 = proj.new Guest();\n        Project2.Guest guest4 = proj.new Guest();\n        Project2.Guest guest5 = proj.new Guest();\n        Project2.Guest guest6 = proj.new Guest();\n        Project2.Guest guest7 = proj.new Guest();\n        Project2.Guest guest8=proj.new Guest();\n        Project2.Guest guest9 = proj.new Guest();\n        Project2.Guest guest10 = proj.new Guest();\n        Project2.Guest guest11 = proj.new Guest();\n        Project2.Guest guest12 = proj.new Guest();\n        Project2.Guest guest13 = proj.new Guest();\n        Project2.Guest guest14 = proj.new Guest();\n        Project2.Guest guest15 = proj.new Guest();\n        Project2.Guest guest16 = proj.new Guest();\n        Project2.Guest guest17 = proj.new Guest();\n        Project2.Guest guest18 = proj.new Guest();\n        Project2.Guest guest19 = proj.new Guest();\n        Project2.Guest guest20 = proj.new Guest();\n        Project2.Guest guest21 = proj.new Guest();\n        Project2.Guest guest22 = proj.new Guest();\n        Project2.Guest guest23 = proj.new Guest();\n        Project2.Guest guest24 = proj.new Guest();\n        Project2.DeskEmployee employee0=proj.new DeskEmployee(0);\n        Project2.DeskEmployee employee1=proj.new DeskEmployee(1);\n        Project2.Bellhop bellhop0=proj.new Bellhop(0);\n        Project2.Bellhop bellhop1=proj.new Bellhop(1);\n        guest1.run();\n        guest2.run();\n        guest3.run();\n        guest4.run();\n        guest5.run();\n        guest6.run();\n        guest7.run();\n        guest8.run();\n        guest9.run();\n        guest10.run();\n        guest11.run();\n        guest12.run();\n        guest13.run();\n        guest14.run();\n        guest15.run();\n        guest16.run();\n        guest17.run();\n        guest18.run();\n        guest19.run();\n        guest20.run();\n        guest21.run();\n        guest22.run();\n        guest23.run();\n        guest24.run();\n        employee0.run();\n        employee1.run();\n        bellhop0.run();\n        bellhop1.run();\n    }\n</code></pre>\n"},{"tags":["java","android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13207531,"title":"Background thread Android","body":"<p>I have a question about threading in android</p>\n\n<p>If call a method which is in my activity from a <strong>run()</strong> method of a new thread is that method executed in that new thread or in main thread. for example.</p>\n\n<pre><code>  ...\n  public void run()\n   {\n    someMethod(); //some method declared in activity  \n    }\n  ...\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","jvm"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":81,"score":2,"question_id":13207277,"title":"Java memory barriers","body":"<p>I'm reading JSR 133 Cookbook and have the following question about memory barriers. An example of inserted memory barriers is in the book, but only writing and reading from local variables is used. Suppose I have the following variables</p>\n\n<pre><code>int a;\nvolatile int b;\n</code></pre>\n\n<p>And the code</p>\n\n<pre><code>b=a;\n</code></pre>\n\n<p>Do I understand correctly that this one line would produce the following instructions</p>\n\n<pre><code>load a\nLoadStore membar\nstore b\n</code></pre>\n"},{"tags":["multithreading","spring","asynchronous","thread-synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13206792,"title":"Spring @Async limit number of threads","body":"<p>My question is very similar to this one : <a href=\"http://stackoverflow.com/questions/4324212/async-prevent-a-thread-to-continue-until-other-thread-have-finished\">@Async prevent a thread to continue until other thread have finished</a></p>\n\n<p>Basically i need run ~ hundreds of computations in more threads. I want to run only some amount of parallel threads e.g. 5 threads with 5 computationis in paralell.</p>\n\n<p>I am using spring framework and @Async option is natural choice. I do not need full-featured JMS queue, that`s a bit overhead for me.</p>\n\n<p>Any ideas ?\nThank you</p>\n"},{"tags":["android","multithreading","eclipse","logcat"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1606,"score":4,"question_id":5494101,"title":"Display Android Thread ID in LogCat","body":"<p>By default, LogCat on Eclipse displays 5 informational columns:</p>\n\n<pre><code>Time       Level  pid   tag message \n</code></pre>\n\n<p>Is it possible to add a 6th column, displaying <strong>thread id</strong>?</p>\n"},{"tags":["c#","multithreading","bindinglist"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13170158,"title":"How to call cross thread BindingList<T> in C#","body":"<p>Need to make an addition to a program that is currently in production and I can't really do much architecture changes.</p>\n\n<p>Main Thread (T1) -> GUI Elements\nOther Threads  (T2...) -> Calculation Elements (and outside events).</p>\n\n<p>There is an object class <code>Foo</code> that is running on T2. \nFoos are created based on various outside events.</p>\n\n<p>I need to add a DataGrid to a new form that will simply display the properties of different Foo objects.</p>\n\n<p><code>Foo</code> implements <code>INotifyPropertyChanged</code> </p>\n\n<p>winform <code>GridForm</code> has a <code>BindingList&lt;Foo&gt; FooList</code>  object. GridView's data is bound to it.</p>\n\n<p>Obviously I am making a x-thread call when I call <code>NotifyPropertyChanged</code> in my <code>Foo</code>\nand that doesnt work.</p>\n\n<p>I cannot spawn my <code>Foo</code> objects from the main thread, nor i can make the form on Thread2.</p>\n\n<p>Im scratching my head here on how to invoke the main thread.</p>\n\n<p>I do have a static class <code>Foo-Brain</code> that has a reference to the main form (and thus I can get the GUI thread.). The question is how to tie this all together.</p>\n\n<p>Any ideas?</p>\n\n<p>(I was thinking about duplicating <code>Foo</code> objects and running them on the GUI thread and have the <code>FooList</code> containt those, but that seems way to hacky and inefficient).</p>\n\n<p>Thanks.</p>\n\n<p>PS. Hope everyone is alright with Sandy. </p>\n\n<p>EDIT: Sample Code:</p>\n\n<pre><code>         class Person : INotifyPropertyChanged // this is the object that will be updated from a\n     //different thread; It will have the reference to the main form (GUI)\n        {\n        public event PropertyChangedEventHandler PropertyChanged;\n        string comments;  \n        private Form1 mainForm = null;\n\n        private void NotifyPropertyChanged(string name)\n        {\n            if (PropertyChanged == null) return;\n            PropertyChanged(this, new PropertyChangedEventArgs(name));         \n\n        }\n\n\n            public Person(string comments, Form1 f) \n{\n             this.mainForm = f;\n            this.comments = comments;\n        }\n\n        public string Comments {\n            get { return comments; }\n            set\n { comments = value;\n            NotifyPropertyChanged(\"Comments\");\n            }\n        }\n}\n</code></pre>\n\n<p>The code from GUI form:</p>\n\n<pre><code> private void Form1_Load(object sender, EventArgs e)\n    {\n        gridControl.DataSource = gridDataList;\n    }\n\n    private void runmethread()\n    {\n        Thread t = new Thread(anotherthread);\n        t.Start();\n\n    }\n\n    private void anotherthread()\n    {\n        gridDataList[0].Comments = \"NEW THREAD\";\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        runmethread();\n    }\n\n    private void button2_Click(object sender, EventArgs e)\n    {\n        gridDataList[0].Comments = \"OLD THREAD\";\n    }\n</code></pre>\n\n<p>obviously button1_click with cause the x-thread problem (what I am trying to solve)</p>\n"},{"tags":["ruby","multithreading","raise","rescue"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13203268,"title":"ruby can't rescue or see abort from Thread.abort_on_exception","body":"<p>I need to immediately catch exceptions in threads and stop all threads, so I'm using abort_on_exception in my script.  Unfortunately this means the exception is not raised to the parent thread - perhaps this is because the exception ends up happening in a global scope??</p>\n\n<p>Anyways, here's an example showing the issue:</p>\n\n<pre><code>Thread.abort_on_exception = true\n\nbegin\n  t = Thread.new {\n    puts \"Start thread\"\n    raise saveMe\n    puts \"Never here..\"\n  } \n  t.join\nrescue =&gt; e\n  puts \"RESCUE: #{e}\"\nensure\n  puts \"ENSURE\"\nend\n</code></pre>\n\n<p>How can I rescue that exception that's raised in the thread when using abort_on_exception?</p>\n\n<p>Here's a new example that shows something even more boggling.  The thread is able to kill execution inside the begin block, but it does it without raising any exceptions??</p>\n\n<pre><code>Thread.abort_on_exception = true\nbegin\n  t = Thread.new { raise saveMe }                     \n  sleep 1\n  puts \"This doesn't execute\"\nrescue =&gt; e \n  puts \"This also doesn't execute\"\nensure\n  puts \"But this does??\"\nend   \n</code></pre>\n"},{"tags":["c++","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13205446,"title":"How to create a thread inside a class function?","body":"<p>I am very new to C++. </p>\n\n<p>I have a class, and I want to create a thread inside a class's function. And that thread(function) will call and access the class function and variable as well.\nAt the beginning I tried to use Pthread, but only work outside a class, if I want to access the class function/variable I got an out of scope error. \nI take a look at Boost/thread but it is not desirable because of I don't want to add any other library to my files(for other reason).</p>\n\n<p>I did some research and cannot find any useful answers.\nPlease give some examples to guide me. Thank you so much!</p>\n\n<p>Attempt using pthread(but I dont know how to deal with the situation I stated above):</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n\nvoid* print(void* data)\n{\n    std::cout &lt;&lt; *((std::string*)data) &lt;&lt; \"\\n\";\n    return NULL; // We could return data here if we wanted to\n}\n\nint main()\n{\n    std::string message = \"Hello, pthreads!\";\n    pthread_t threadHandle;\n    pthread_create(&amp;threadHandle, NULL, &amp;print, &amp;message);\n    // Wait for the thread to finish, then exit\n    pthread_join(threadHandle, NULL);\n    return 0;\n}\n</code></pre>\n"},{"tags":["objective-c","ios","multithreading","html-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13205859,"title":"Reducing lag when downloading large amount of data from webpage","body":"<p>I am getting data via RSS feeds and displaying each article in a table view cell.  Each cell has an image view, set to a default image. If the page has an image, the image is to be replaced with the image from the article. As of now, each cell downloads the source code from the web page, causing the app to lag when I push the view controller and when I try scrolling.      </p>\n\n<p>Here is what I have in the <code>cellForRowAtIndexPath:</code> method.</p>\n\n<pre><code>    NSString * storyLink = [[stories objectAtIndex: storyIndex] objectForKey: @\"link\"];\n    storyLink = [storyLink stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]];\n    NSString *sourceCode = [NSString stringWithContentsOfURL:[NSURL URLWithString:storyLink] encoding:NSUTF8StringEncoding error:&amp;error];\n\n    NSString *startPt = @\"instant-gallery\";\n    NSString *startPt2 = @\"&lt;img src=\\\"\";\n\n    if ([sourceCode rangeOfString:startPt].length != 0) { //webpage has images\n    // find the first  \"&lt;img src=...&gt;\" tag starting from \"instant-gallery\"\n    NSString *trimmedSource = [sourceCode substringFromIndex:NSMaxRange([sourceCode rangeOfString:startPt])];\n    trimmedSource = [trimmedSource substringFromIndex:NSMaxRange([trimmedSource rangeOfString:startPt2])];\n    trimmedSource = [trimmedSource substringToIndex:[trimmedSource rangeOfString:@\"\\\"\"].location];\n\n    NSURL *url = [NSURL URLWithString:trimmedSource];\n    NSData *data = [NSData dataWithContentsOfURL:url];\n    UIImage *image = [UIImage imageWithData:data];\n    cell.picture.image = image;\n</code></pre>\n\n<p>Someone suggested using <code>NSOperationQueue</code>. Would this way be a good solution?</p>\n\n<p>EDIT:</p>\n\n<pre><code>  dispatch_queue_t someQueue = dispatch_queue_create(\"cell background queue\", NULL);\n    dispatch_async(someQueue, ^(void){\n\n        NSError *error = nil;\n        NSString * storyLink = [[stories objectAtIndex: storyIndex] objectForKey: @\"link\"];\n        storyLink = [storyLink stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]];\n        NSString *sourceCode = [NSString stringWithContentsOfURL:[NSURL URLWithString:storyLink] encoding:NSUTF8StringEncoding error:&amp;error];\n\n        NSString *startPt = @\"instant-gallery\";\n        NSString *startPt2 = @\"&lt;img src=\\\"\";\n\n        if ([sourceCode rangeOfString:startPt].length != 0) { //webpage has images\n            // find the first  \"&lt;img src=...&gt;\" tag starting from \"instant-gallery\"\n            NSString *trimmedSource = [sourceCode substringFromIndex:NSMaxRange([sourceCode rangeOfString:startPt])];\n            trimmedSource = [trimmedSource substringFromIndex:NSMaxRange([trimmedSource rangeOfString:startPt2])];\n            trimmedSource = [trimmedSource substringToIndex:[trimmedSource rangeOfString:@\"\\\"\"].location];\n\n            NSURL *url = [NSURL URLWithString:trimmedSource];\n            NSData *data = [NSData dataWithContentsOfURL:url];\n            UIImage *image = [UIImage imageWithData:data];\n\n            dispatch_async(dispatch_get_main_queue(), ^(void){\n                cell.picture.image = image;\n            });\n        });\n        dispatch_release(someQueue);\n\n        return cell;\n    }\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/CcaZB.png\" alt=\"enter image description here\"></p>\n"},{"tags":["java","android","multithreading","concurrency","android-handler"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13192607,"title":"multithreading in android : message passing","body":"<p><strong>Is the Android <a href=\"http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/2.1_r2/android/os/Handler.java\" rel=\"nofollow\">Handler</a> an implementation of concurrent <a href=\"http://en.wikipedia.org/wiki/Message_passing#Synchronous_versus_asynchronous_message_passing\" rel=\"nofollow\">message passing</a>?</strong></p>\n\n<p>It seems that by using <code>HandlerThread</code>, it's easy to communicate between several worker threads. But, as I understand it, message passing in concurrency is based on using shared memory. I tried to understand the mechanism of implementation of Handler, but it's still not clear for me.</p>\n\n<p>How does the Android <code>Handler</code> work in simple words?</p>\n"},{"tags":["c#",".net","multithreading","timer"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":79,"score":4,"question_id":13205024,"title":"Memory leak around timer delegate","body":"<p>Sometimes users wants to schedule a large set of timers and don't want to manage the references to those timers.\n<br>In case the user does not reference a timer, the timer may be collected by the GC before it was executed.\n<br>I created the class Timers to serve as a place holder for newly created timers:</p>\n\n<pre><code>static class Timers\n{\n    private static readonly ILog _logger = LogManager.GetLogger(typeof(Timers));\n\n    private static readonly ConcurrentDictionary&lt;Object, Timer&gt; _timers = new ConcurrentDictionary&lt;Object, Timer&gt;();\n\n    /// &lt;summary&gt;\n    /// Use this class in case you want someone to hold a reference to the timer.\n    /// Timer without someone referencing it will be collected by the GC even before execution.\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"dueTime\"&gt;&lt;/param&gt;\n    /// &lt;param name=\"action\"&gt;&lt;/param&gt;\n    internal static void ScheduleOnce(TimeSpan dueTime, Action action)\n    {\n        if (dueTime &lt;= TimeSpan.Zero)\n        {\n            throw new ArgumentOutOfRangeException(\"dueTime\", dueTime, \"DueTime can only be greater than zero.\");\n        }\n        Object obj = new Object();\n\n        Timer timer = new Timer(state =&gt;\n        {\n            try\n            {\n                action();\n            }\n            catch (Exception ex)\n            {\n                _logger.ErrorFormat(\"Exception while executing timer. ex: {0}\", ex);\n            }\n            finally\n            {\n                Timer removedTimer;\n                if (!_timers.TryRemove(obj, out removedTimer))\n                {\n                    _logger.Error(\"Failed to remove timer from timers\");\n                }\n                else\n                {\n                    removedTimer.Dispose();\n                }\n            }\n        });\n        if (!_timers.TryAdd(obj, timer))\n        {\n            _logger.Error(\"Failed to add timer to timers\");\n        }\n        timer.Change(dueTime, TimeSpan.FromMilliseconds(-1));\n    }\n}\n</code></pre>\n\n<p>If I don't dispose the removed timer, it results with a memory leak.\n<br>Seems like someone is holding a reference to the Timer's delegate after the timer was removed from the <code>_timers</code> collection.</p>\n\n<p>The question is, why do I get a memory leak if I don't dispose the timer?</p>\n"},{"tags":["java","multithreading","servlets","heroku","grizzly"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13205637,"title":"How to multithread in Grizzly","body":"<p>I'm implementing a Java RESTful webservice on Heroku.  Currently my entry point looks like</p>\n\n<pre><code>public class Main\n{\n\n    public static final String BASE_URI = getBaseURI();\n\n    public static void main( String[] args ) throws Exception\n    {\n        final Map&lt;String, String&gt; initParams = new HashMap&lt;String, String&gt;();\n        initParams.put( \"com.sun.jersey.config.property.packages\", \"services.contracts\" );\n        initParams.put( \"com.sun.jersey.api.json.POJOMappingFeature\", \"true\" );\n\n        System.out.println( \"Starting grizzly...\" );\n        SelectorThread threadSelector =\n        GrizzlyWebContainerFactory.create( BASE_URI, initParams );\n\n        System.out.println( String.format( \"Jersey started with WADL available at %sapplication.wadl.\", BASE_URI,\n                BASE_URI ) );\n    }\n\n    private static String getBaseURI()\n    {\n        return \"http://localhost:\" + ( System.getenv( \"PORT\" ) != null ? System.getenv( \"PORT\" ) : \"9998\" ) + \"/\";\n    }\n\n}\n</code></pre>\n\n<p>where the <code>initParms</code> contains RESTful services being hosted.  I understand that GrizzlyWebContainerFactory.create() returns an instance of <code>ServletContainer</code> (<code>SelectorThread</code>), but how would I multithread the returned <code>threadSelector</code> such that multiple <code>SelectorThread</code>'s can handle the incoming requests under one process (aka web dyno)?  The reason is to increase performance of a single dyno in handling requests.</p>\n\n<p>Any suggestions appreciated!  Thanks!</p>\n"},{"tags":["multithreading","wcf","asynchronous","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":17,"score":-2,"question_id":13205422,"title":"ReportExecution2005.asmx pdf multithreading","body":"<p>I have created a web service that consumes reportexecution2005.asmx that calls 4 different reports (one for each department) about 150 times each report(with different parameters) and generates about 600 pdfs using file IO. Ideally I want it to be multithreaded so it can run multiple reports at the same time and start generating the pdf. \nI'd appreciate any help on this.</p>\n"},{"tags":["multithreading","coldfusion","dependency-injection","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":78,"score":3,"question_id":13190209,"title":"How to make a shared resource thread-safe when using dependency injection?","body":"<p>My current application is using single instance of an object as a global variable for many of the main components, which I understand is considered inferior to using dependency injection. </p>\n\n<p>I wish to make my applications open source in the future, but first I want to refactor the code to use the most recommended techniques for team collaboration so that other developers will be able to change my source code more easily.</p>\n\n<p>Example of a shared resource: In the CFML language, you have the Server scope, which is shared memory that is available to any request for the entire server instance.</p>\n\n<p>Here is my new design concept for managing changes to the Server scope:</p>\n\n<ol>\n<li>Create a single instance of component named ServerMemoryManager which provides an interface for writing and reading to the server scope.</li>\n<li>Any other code that needs to access the server scope will be injected with a reference to the single instance of the ServerMemoryManager via an init() function or a setServerMemoryManager() function.</li>\n<li>Whenever a component reads/writes data to the ServerMemoryManager object, it will be able to internally lock the server scope so that no 2 threads can simultaneous write to the same piece of memory in the server scope.</li>\n</ol>\n\n<p>Is this the best way to manage a shared resource (shared memory, filesystem, etc) that requires locking in order to be thread-safe?</p>\n\n<p>Please describe any additional methods that can be used to manage a shared resource that requires locking during certain read/write operations which are considered best practices.</p>\n\n<p><strong>Edit:</strong> Based on the accepted answer, instead of locking scope=\"server\", I will use named locks and manage the shared resources with more fine-grained locking.  This may allow using multiple objects to manage the shared resources assuming they are all managing different keys in shared memory or files in the filesystem.  For example, one application could have its own unique key or directory assigned to it so that it wouldn't conflict with another application trying to change a shared resource.</p>\n\n<p><strong>Edit2:</strong> I found I could use a single component named scope.cfc for each scope if I pass the scope into the init function when I create the object.  I am now using fine-grained named locks.  Let me know if it can be improved. The actual revised code now looks like this (I excluded the code for read, delete, clear).  It also doesn't seem that it is required to have a single instance of the scope.cfc component anymore.</p>\n\n<pre><code>            &lt;cfcomponent&gt;\n                &lt;cfscript&gt;\n                variables.scope=false;\n                variables.scopeName=false;\n                &lt;/cfscript&gt;\n                &lt;cffunction name=\"init\" access=\"public\" output=\"no\" returntype=\"scope\"&gt;\n                    &lt;cfargument name=\"scope\" type=\"struct\" required=\"yes\"&gt;\n                    &lt;cfargument name=\"scopeName\" type=\"string\" required=\"yes\"&gt;\n                    &lt;cfscript&gt;\n                    variables.scope=arguments.scope;\n                    variables.scopeName=arguments.scopeName;\n                    return this;\n                    &lt;/cfscript&gt;\n                &lt;/cffunction&gt;\n                &lt;cffunction name=\"write\" access=\"public\" output=\"no\" returntype=\"boolean\"&gt;\n                    &lt;cfargument name=\"key\" type=\"string\" required=\"yes\"&gt;\n                    &lt;cfargument name=\"value\" type=\"any\" requires=\"yes\"&gt;\n                    &lt;cfargument name=\"timeout\" type=\"numeric\" required=\"no\" default=\"10\"&gt;\n                    &lt;cftry&gt;\n                        &lt;cflock type=\"exclusive\" name=\"zcore-#variables.scopeName#-scope-#arguments.key#\" timeout=\"#arguments.timeout#\" throwontimeout=\"yes\"&gt;\n                            &lt;cfscript&gt;\n                            variables.scope[arguments.key]=arguments.value;\n                            &lt;/cfscript&gt;\n                        &lt;/cflock&gt;\n                        &lt;cfcatch type=\"lock\"&gt;&lt;cfreturn false&gt;&lt;/cfcatch&gt;\n                    &lt;/cftry&gt;\n                    &lt;cfreturn true&gt;\n                &lt;/cffunction&gt;\n            &lt;/cfcomponent&gt;\n</code></pre>\n\n<p>** Edit3:** I tested the performance of reading from server scope through a component method like this and found it to be 20 times slower then reading the server scope directly when using a read only lock and 4 times slower without a lock.  The overhead of an extra function call hundreds or thousands of times per request will be too slow.  Tests done on Railo 3.3.x.</p>\n\n<p>I prefer to build a large object in a non-public request and then set a single shared memory scope key then try to write an incomplete object to the scopes.  Example:</p>\n\n<pre><code>&lt;cfscript&gt;\nts=structnew();\nts.largeObject=buildLargeObject();\nserver.cachedObject=ts;\n&lt;/cfscript&gt;\n</code></pre>\n\n<p>This lets you avoid locking across the entire application when you only write complete objects to shared memory since updating a single struct key is thread-safe.  However, when you build the large object on startup, you need to be sure it is locked until that object is fully created.  </p>\n\n<p>I'm going to make the scope variable become directly readable by using the this scope instead of variables scope in the init function to avoid slowing down the application.</p>\n"},{"tags":["java","multithreading","nullpointerexception"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13205316,"title":"nullpointer exception for thread","body":"<p>I am implementing a tcp java client/server app based on a tut on the internet\nI changed some methods and get error of nullpointerexception</p>\n\n<p>The error comes from the run(). Its in a Connection class that extends the Thread class. run() is supposed to listen to incoming communication. I start the server class, listen to a port. So I have a succefful connection. Then the app reports error when I try to listen to incoming communication through the run() method</p>\n\n<p>establish a connection and start:</p>\n\n<pre><code>Connection c = new Connection(host,port);\n                Scanner chatConsole = new Scanner(System.in);\n                String text = \"\";\n\n                while (!text.equalsIgnoreCase(\"halt\")){         \n                    text = chatConsole.nextLine();\n                    c.start();\n</code></pre>\n\n<p>Exception in thread \"Thread-1\" java.lang.NullPointerException </p>\n\n<p>The run()</p>\n\n<pre><code>public void run(){//watch for incoming communication\n    String msg;\n\n    try{//loop reading lines and display msg\n        while ((msg = in.readLine()) != null) {\n            System.out.println(msg);\n        }\n    }catch (IOException e) {\n        System.err.println(e);\n    }   \n}\n</code></pre>\n\n<p>This is the constructor for the class if its helpful to debug. </p>\n\n<pre><code>public Connection(String iniName, int iniPort){\n        host = iniName;\n        port = iniPort;\n\n        try {\n            server = new Socket(host, port);\n        }catch (UnknownHostException e){\n            System.err.println(e);\n            System.exit(1);\n        }\n\n        try{\n            stdIn = new BufferedReader(new InputStreamReader(System.in));\n            PrintWriter out = new PrintWriter(server.getOutputStream(), true); //output stream to server\n            BufferedReader in = new BufferedReader(new InputStreamReader(server.getInputStream()));\n        }catch(Exception e){\n            System.err.println(e);\n        }\n    }\n</code></pre>\n\n<p>Thank you</p>\n"},{"tags":["multithreading","process","fork","pipe"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13203300,"title":"I'm having trouble handling the threads that handle the pipes in my heavy process handling program","body":"<p>So here's the thing:</p>\n\n<p>I'm supposed to make two funcitions and a struct that will allow for heavy processes handling. This is job.h:</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;pthread.h&gt;\n\ntypedef struct {\n    pid_t pid;\n    pthread_t pidA;\n    pthread_t pidB;\n\n    char *in;\n    char *out;\n    ssize_t size_in;\n    ssize_t size_out;\n    ssize_t max_out;\n\n} Job;\n\nvoid jobStart(Job *job, char **argv,\n       char *in, ssize_t size_in,\n       char *out, ssize_t max_out);\n\nint jobWait(Job *job, ssize_t *size_out);\n</code></pre>\n\n<p>The structure was defined by me, it's subject to change. What can't change is the header of the functions that I have to design on t3.c</p>\n\n<p>jobStart is supposed to make a child process with two pipes, one towards the child process and one from the child process. In the father program two separate threads will be handling the pipes. \"in\" is what the writing thread will send into the pipe while \"out\" is where I have to store what I receive from the reading pipe. If \"out\" excedes the limit \"max_out\" I'm supposed to kill the process. jobWait must return the waitpid return and make size_out the size of \"out\". It must also wait on the process to end and the threads to join.</p>\n\n<p>This is how I'm handling t3.c as of now:</p>\n\n<pre><code>#define _POSIX_C_SOURCE 1\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdarg.h&gt;\n#include &lt;signal.h&gt;\n#include \"job.h\"\n\n\ntypedef struct{\n    Job *job;\n    int fds;\n} Info;\n\nvoid write_pipe(int fds, char *in){\n    FILE *chorro;\n    printf(\"1\\n\");\n\n    chorro = fdopen(fds, \"w\");\n\n    printf(\"1a\\n\");\n\n    fprintf (chorro, \"%s\\n\" , in);\n\n    printf(\"1b\\n\");\n\n    fclose(chorro);\n}\n\nvoid read_pipe(Job *job, int fds){\n    FILE *chorro;\n    char c;\n    printf(\"2\\n\");\n\n    (job-&gt;size_out)=0;\n\n    printf(\"2z\\n\");\n\n    (job-&gt;out)=\"\";\n\n    printf(\"2a\\n\");\n\n    chorro = fdopen(fds, \"r\");\n\n    printf(\"2b\\n\");\n\n    while((c = fgetc (chorro)) != EOF){\n        printf(\"2c\\n\");\n        strcat(job-&gt;out,&amp;c);\n        printf(\"2d\\n\");\n        (job-&gt;size_out)++;\n        if(job-&gt;size_out&gt;=(job-&gt;max_out)){\n            kill(job-&gt;pid, SIGKILL);\n            pthread_kill(job-&gt;pidA,NULL);\n            pthread_kill(job-&gt;pidB,NULL);\n        }\n    }\n\n    printf(\"2h\\n\");\n\n    fclose(chorro);\n}\n\nvoid *read_thread(void *ptr){\n    Info *info=(Info*)ptr;\n    printf(\"3\\n\");\n    read_pipe(info-&gt;job, info-&gt;fds);\n    return NULL;\n}\n\nvoid *write_thread(void *ptr){\n    Info *info=(Info*)ptr;\n    printf(\"4\\n\");\n    write_pipe(info-&gt;fds, (info-&gt;job)-&gt;in);\n    return NULL;\n}\n\nvoid jobStart(Job *job, char **argv,\n       char *in, ssize_t size_in,\n       char *out, ssize_t max_out){\n\n    //job=(Job*)malloc((sizeof(int)*10)+max_out+size_in+10);\n\n    int fdsA[2];\n    int fdsB[2];\n\n    printf(\"5\\n\");\n\n    strcpy(job-&gt;in,in);\n    job-&gt;size_in=size_in;\n    job-&gt;max_out=max_out;\n\n    printf(\"5a\\n\");\n\n    pipe(fdsA);\n    pipe(fdsB);\n\n\n    printf(\"5b\\n\");\n\n    if((job-&gt;pid=fork())==-1){\n        fprintf(stderr, \"No pudo forkear.\\n\");\n    } \n\n    printf(\"5c\\n\");\n\n    if(job-&gt;pid==0){ //hijo\n\n        close(STDIN_FILENO);\n        dup(fdsA[0]);\n        close(fdsA[0]);\n        close(fdsA[1]);\n\n        close(STDOUT_FILENO);\n        dup(fdsB[1]);\n        close(fdsB[1]);\n        close(fdsB[0]);\n\n        execvp(argv[0],argv);\n        fprintf(stderr,\"execvp falló, dafuq?\\n\");\n        exit(1);\n\n    }\n\n\n    else{\n\n        close(fdsA[0]);\n        close(fdsB[1]);\n\n        Info info1;\n        Info info2;\n\n        info1.job=job;\n        info2.job=job;\n        info1.fds=fdsA[1];\n        info2.fds=fdsB[0];\n\n        printf(\"5d\\n\");\n\n\n        pthread_create(&amp;job-&gt;pidB, NULL, write_thread, &amp;info2);\n        pthread_create(&amp;job-&gt;pidA, NULL, read_thread, &amp;info1);\n\n        sleep(30);\n\n    }\n\n}\n\n\nint jobWait(Job *job, ssize_t *size_out){\n\n    printf(\"6\\n\");\n\n    int status;\n    pid_t pid;\n\n    pid=waitpid(job-&gt;pid,&amp;status, 0);\n    pthread_join(job-&gt;pidA,NULL);\n    pthread_join(job-&gt;pidB,NULL);\n    size_out=job-&gt;size_out;\n    free(job);\n    return pid;\n}\n</code></pre>\n\n<p>Those printf(\"numberletter\\n\") are there to better understand where I'm failing. Also I'm switching between the read and the write because both are failing and I can't see how is either failing. The sleep is so the main program (the test) doesn't start new stuff that may confound me. Here's the test-t3 in case you need see it:</p>\n\n<pre><code>#include \"job.h\"\n\n#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n  {\n    /* cat */\n    const int MAX_OUT= 100;\n    char *argv[]= {\"cat\", NULL};\n    char *in= \"hello world!\\n\";\n    char out[MAX_OUT];\n    Job job;\n    ssize_t size;\n    int rc;\n    jobStart(&amp;job, argv, in, strlen(in), out, MAX_OUT);\n    rc= jobWait(&amp;job, &amp;size);\n    printf(\"rc= %d, size= %ld\\n\", rc, size);\n    fwrite(out, size, 1, stdout);\n    printf(\"\\n---------------------------------------------\\n\");\n  }\n\n  {\n    /* ls -l */\n    const int MAX_OUT= 10000;\n    char *argv[]= {\"ls\", \"-l\", NULL};\n    char *in= \"no se usa\\n\";\n    char out[MAX_OUT];\n    Job job;\n    ssize_t size;\n    int rc;\n    jobStart(&amp;job, argv, in, strlen(in), out, MAX_OUT);\n    rc= jobWait(&amp;job, &amp;size);\n    printf(\"rc= %d, size= %ld\\n\", rc, size);\n    fwrite(out, size, 1, stdout);\n    printf(\"\\n---------------------------------------------\\n\");\n  }\n\n  {\n    /* cat en paralelo con ls -l */\n    const int MAX_OUT= 10000;\n    char *argv1[]= {\"cat\", NULL};\n    char *in1= \"hello world!\\n\";\n    char out1[MAX_OUT];\n    char *argv2[]= {\"ls\", \"-l\", NULL};\n    char *in2= \"no se usa\\n\";\n    char out2[MAX_OUT];\n    Job job1, job2;\n    ssize_t size1, size2;\n    int rc1, rc2;\n    jobStart(&amp;job1, argv1, in1, strlen(in1), out1, MAX_OUT);\n    jobStart(&amp;job2, argv2, in2, strlen(in2), out2, MAX_OUT);\n    rc1= jobWait(&amp;job1, &amp;size1);\n    rc2= jobWait(&amp;job2, &amp;size2);\n    printf(\"rc1= %d, size1= %ld\\n\", rc1, size1);\n    fwrite(out1, size1, 1, stdout);\n    printf(\"rc2= %d, size2= %ld\\n\", rc2, size2);\n    fwrite(out2, size2, 1, stdout);\n    printf(\"\\n---------------------------------------------\\n\");\n  }\n\n  {\n    /* Chequea que se mata un proceso que excede max_out */\n    const int MAX_OUT= 40;\n    char *argv[]= {\"ls\", \"-l\", NULL};\n    char *in= \"\";\n    char out[MAX_OUT];\n    Job job;\n    ssize_t size;\n    int rc;\n    jobStart(&amp;job, argv, in, strlen(in), out, MAX_OUT);\n    rc= jobWait(&amp;job, &amp;size);\n    printf(\"rc= %d, size= %ld\\n\", rc, size);\n    fwrite(out, size, 1, stdout);\n    printf(\"\\n---------------------------------------------\\n\");\n  }\n\n  return 0;\n}\n</code></pre>\n\n<p>Right now the programs goes up to \"1a\" on the write process, and \"2b\" on the read process. </p>\n\n<p>This means (afaik) that on the writing </p>\n\n<pre><code>fprintf (chorro, \"%s\\n\" , in);\n</code></pre>\n\n<p>is failing and on the reading</p>\n\n<pre><code>while((c = fgetc (chorro)) != EOF){\n</code></pre>\n\n<p>is failing. </p>\n\n<p>And I just can't find why :(</p>\n\n<p>Any help would be very much loved. :)</p>\n"},{"tags":["c#","multithreading","thread-safety","threadpool","thread-sleep"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":42,"score":-2,"question_id":13202902,"title":"Stopping only one thread","body":"<p>I have many threads in my application, how do I stop only one thread from them? If I use <code>Thread.Sleep()</code> it stops the whole application, I just want to stop a single thread. How do I do that? I am using c#.</p>\n"},{"tags":["c#","wpf","multithreading","listbox","backgroundworker"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13202683,"title":"Updating Listbox in the background WPF","body":"<p>I am trying to make a hyper-terminal like program and i am having trouble getting the serial port to get a line and post it in the list box in the background. In the example below it will freeze the whole program while the the for loop runs 100 times and then spit out all 100 lines... i want it to update line by line and i am not sure why its doing it.</p>\n\n<p>I also tried backgroundworker but it seemed to do the same thing.</p>\n\n<p>Thanks in advance...</p>\n\n<pre><code>    static System.Threading.Thread thread;\n    public void button2_Click(object sender, RoutedEventArgs e)\n    {\n        if(Sp.IsOpen){\n            stop = false;\n\n            thread = new System.Threading.Thread(\n                new System.Threading.ThreadStart(\n                  delegate()\n                  {\n                    System.Windows.Threading.DispatcherOperation\n                      dispatcherOp = listBox1.Dispatcher.BeginInvoke(\n                      System.Windows.Threading.DispatcherPriority.Normal,\n                      new Action(\n                        delegate()\n                        {\n                            for(int y = 0; y &lt;100; y++)\n                            {\n                                String line = Sp.ReadLine();\n                                listBox1.Items.Add(line);\n                            }\n                        }\n                               ));\n\n              }\n          ));\n            thread.Start();\n\n\n        }else{\n            item.Content = (\"No Comm Ports are Open\");\n            item.IsSelected = true;\n            listBox1.Items.Add(item);\n        }\n\n    }\n</code></pre>\n"},{"tags":["c++","multithreading","sdl"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13198778,"title":"Can't use SDL Threads","body":"<p>I'm using Visual Studio 2012 with SDL and I'm doing a simple threading task but I always get these errors: </p>\n\n<pre><code>argument of type \"int (mainGame::*)(void *ptr)\" is incompatible with parameter of type \"int (__cdecl *)(void *)\"\n</code></pre>\n\n<p>The other error I'm getting:</p>\n\n<pre><code>error C3867: 'mainGame::gameEvents': function call missing argument list; use '&amp;mainGame::gameEvents' to create a pointer to member\n</code></pre>\n\n<p>This is how the function is written:</p>\n\n<pre><code>int gameEvents(void *ptr){\n   //do things here.\nreturn 0;\n}\n</code></pre>\n\n<p>This is the code I'm using to call the function:</p>\n\n<pre><code>SDL_Thread* gh;  \n gh = SDL_CreateThread(gameEvents,NULL);\n</code></pre>\n"},{"tags":["c++","multithreading","concurrency","locking"],"answer_count":6,"favorite_count":5,"up_vote_count":6,"down_vote_count":0,"view_count":836,"score":6,"question_id":168249,"title":"How do I use an arbitrary string as a lock in C++?","body":"<p>Let's say I have a multithreaded C++ program that handles requests in the form of a function call to <code>handleRequest(string key)</code>. Each call to <code>handleRequest</code> occurs in a separate thread, and there are an arbitrarily large number of possible values for <code>key</code>.</p>\n\n<p>I want the following behavior:</p>\n\n<ul>\n<li>Simultaneous calls to <code>handleRequest(key)</code> are serialized when they have the same value for <code>key</code>.</li>\n<li>Global serialization is minimized.</li>\n</ul>\n\n<p>The body of <code>handleRequest</code> might look like this:</p>\n\n<pre><code>void handleRequest(string key) {\n    KeyLock lock(key);\n    // Handle the request.\n}\n</code></pre>\n\n<p><b>Question:</b> How would I implement <code>KeyLock</code> to get the required behavior?</p>\n\n<p>A naive implementation might start off like this:</p>\n\n<pre><code>KeyLock::KeyLock(string key) {\n    global_lock-&gt;Lock();\n    internal_lock_ = global_key_map[key];\n    if (internal_lock_  == NULL) {\n        internal_lock_  = new Lock();\n        global_key_map[key] = internal_lock_;\n    }\n    global_lock-&gt;Unlock();\n    internal_lock_-&gt;Lock();\n}\n\nKeyLock::~KeyLock() {\n    internal_lock_-&gt;Unlock();\n    // Remove internal_lock_ from global_key_map iff no other threads are waiting for it.\n}\n</code></pre>\n\n<p>...but that requires a global lock at the beginning and end of each request, and the creation of a separate <code>Lock</code> object for each request. If contention is high between calls to <code>handleRequest</code>, that might not be a problem, but it could impose a lot of overhead if contention is low.</p>\n"},{"tags":["c#","multithreading","concurrency","locking"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13201929,"title":"Concurrent access to list: what happens if objects are removed or the list is set to null?","body":"<p>I have a List with objects <strong>List&lt;> my_objects</strong>. Several threads can change this list. Let's suppose that I do not have any locking mechanism for controlling the access to the list.</p>\n\n<p>What happens, if I'm working with an object of the list and suddenly another thread sets the array to null?</p>\n\n<pre><code>    MyObject o = my_objects[i];\n\n    //now a second thread has set my_objects to null\n    o.myMethod();\n</code></pre>\n\n<p>Will a NullPointerException occur?</p>\n\n<p>Furthermore, what happens if a second thread removes the considered object from the list while I'm working with it in the first thread?</p>\n\n<pre><code>   //second thread:\n   //y = i\n   MyObject o2 = my_objects[y];\n\n   my_objects.Remove(o2);\n</code></pre>\n"},{"tags":["c#","multithreading","locking"],"answer_count":10,"favorite_count":32,"up_vote_count":111,"down_vote_count":0,"view_count":26926,"score":111,"question_id":251391,"title":"Why is lock(this) {...} bad?","body":"<p>The <a href=\"http://msdn.microsoft.com/en-us/library/c5kehkcz%28v=vs.110%29.aspx\">MSDN documentation</a> says that</p>\n\n<pre><code>public class SomeObject\n{\n  public void SomeOperation()\n  {\n    lock(this)\n    {\n      //Access instance variables\n    }\n  }\n}\n</code></pre>\n\n<p>is \"is a problem if the instance can be accessed publicly\". I'm wondering why? Is it because the lock will be held longer than necessary? Or is there some more insidious reason?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13201562,"title":"Capturing events whenever a new thread starts or ends in C#","body":"<p>I have a highly multithreaded application , where threads are started from multiple places and i would like to know if i can hook into the running process and just get alerted whenever a new Managed Thread is spawned. I should be able to get the following information</p>\n\n<ol>\n<li>The parent thread</li>\n<li>New thread</li>\n<li>the method from which the new thread is started like <code>&lt;className&gt;.&lt;methodName&gt;</code></li>\n</ol>\n\n<p>The application is in C# 3.5</p>\n"}]}
{"total":30059,"page":4,"pagesize":100,"questions":[{"tags":[".net","winforms","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12811924,"title":"Multithread control of .net winform app","body":"<p>I am working on a .net Windows form app using VS2010.\nIn this app, I need four background threads for underlying data transmission. When ALL the four threads finished,  another round of 4 underlying data transmissions will be started using the four threads again.   The form UI need to be responsive all the time.  My problem is: how can I control the running of the 4 threads? like: how do I know that all threads are finished?  using a volatile global counter ?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","multithreading","lazy-loading"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":80,"score":4,"question_id":13198726,"title":"C++ Thread Safe Lazy Load","body":"<p>I have a property which is similar to the following:</p>\n\n<pre><code>private:\nFoo* myFoo_m;\n\npublic:\nFoo getMyFoo() const\n{\n    if (myFoo_m == NULL)\n    {\n       myFoo_m = new Foo();\n       // perform initialization\n</code></pre>\n\n<p>This works well in a single-threaded environment, but <strong>how do I handle this in a multi-threaded environment?</strong> Most of the info I've found deals with static singletons, but in this case, myFoo is a public instance property.</p>\n\n<p>I am porting this over from C# (where I can use Lazy) and Java (where I can use double check locking), but it doesn't seem that there is a straightforward way to do this in C++. <strong>I cannot rely on any external libraries (no BOOST), and this needs to work on windows and linux.</strong> I also cannot use C++11.</p>\n\n<p>Any insight would be good. I am new to C++.</p>\n"},{"tags":["c#","multithreading","resharper"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":117,"score":7,"question_id":13199043,"title":"Why does ReSharper think that \"thread.Name == null\" is always false?","body":"<p>I am writing a helper method for conveniently setting the <code>Name</code> of a <code>Thread</code>:</p>\n\n<pre><code>public static bool TrySetName(this Thread thread, string name)\n{\n    try\n    {\n        if (thread.Name == null)\n        {\n            thread.Name = name;\n            return true;\n        }\n        return false;\n    }\n    catch (InvalidOperationException)\n    {\n        return false;\n    }\n}\n</code></pre>\n\n<p>It's working as intended. ReSharper, however, claims that the condition is always false and the corresponding code is heuristically unreachable. That's wrong. A <code>Thread.Name</code> is always null until a string is assigned.</p>\n\n<p><img src=\"http://i.stack.imgur.com/p0Xxy.png\" alt=\"\"></p>\n\n<p>So, why does ReSharper think it is? And is there some way to tell ReSharper it isn't (other than <code>// ReSharper disable ...</code>)?</p>\n\n<p>I'm using ReSharper 5.1.3.</p>\n"},{"tags":["multithreading","visual-studio-2010","concurrency","parallel-processing","ppl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11615770,"title":"How to set number of PPL threads to one?","body":"<p>I have a number crunching function, so I have paralleled it by using PPL..however another developer requires this function to be run in serial because of some reason..I need to give a parameter so that he can call my function in serial mode...I dont want to duplicate the code so I need a way to limit the number of PPL threads..Although I have sad</p>\n\n<pre><code>Concurrency::SchedulerPolicy sp( 1, Concurrency::MaxConcurrency, 1 );\nCurrentScheduler::Create(sp);\n</code></pre>\n\n<p>PPL creates two threads and running my code in parallel...Any suggestions how to serialize a ppl enhanced code.</p>\n"},{"tags":["c++","multithreading","c++11","openmp"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":114,"score":5,"question_id":13197510,"title":"Why do c++11 threads become unjoinable when using nested OpenMP pragmas?","body":"<p>The following code should be pretty straightforward but seems to end up in a hanging situation when trying to do a .join() on the threads with nested OpenMP code. Using GCC compiler 4.7.2 x64 with pthreads from <a href=\"http://sourceforge.net/projects/mingwbuilds\" rel=\"nofollow\">http://sourceforge.net/projects/mingwbuilds</a> with <code>g++ threadexample.cpp -Wall -std=c++11 -fopenmp -o threads</code></p>\n\n<pre><code>// threadexample.cpp\n#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;omp.h&gt;\n\nusing namespace std;\n\nvoid hello(int a) {\n\n    #pragma omp parallel for\n        for (int i=0;i&lt;5;++i) {\n            #pragma omp critical\n            cout &lt;&lt; \"Hello from \" &lt;&lt; a &lt;&lt; \"! \" &lt;&lt; \"OMP thread iter \" &lt;&lt; i &lt;&lt; endl;\n        }\n\n    cout &lt;&lt; \"About to return from hello function\" &lt;&lt; endl;\n}\n\nint main (int argc, char ** argv) {\n\n    thread t1(hello, 1); //fork\n    cout &lt;&lt; \"t1 away!\" &lt;&lt; endl;\n    thread t2(hello, 2);\n    cout &lt;&lt; \"t2 away!\" &lt;&lt; endl;\n\n    t1.join(); //join\n    cout &lt;&lt; \"thread 1 joined\" &lt;&lt; endl;\n    t2.join();\n    cout &lt;&lt; \"thread 2 joined\" &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c#","multithreading","priority"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":44,"score":1,"question_id":13198966,"title":"Set Thread priority with console.readline? c#","body":"<p>I'm wondering if you can change the priority of a thread by letting the user enter a string (Lowest, BelowNormal etc)? As far as I know, the \"ThreadPriority\" is an enum but I don't know how to do it.</p>\n\n<pre><code>thread.Priority = ThreadPriority.BelowNormal\n</code></pre>\n\n<p>How can I change the BelowNormal to something the user enter (ReadLine)?</p>\n\n<p>Thanks! </p>\n"},{"tags":["objective-c","ios","multithreading","core-bluetooth"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":13188882,"title":"CoreBluetooth delegates on main queue/main thread?","body":"<p>A queue is specified in the initialiser of CBCentralManager, <code>-initWithDelegate:queue:</code>.</p>\n\n<p>From performance concerns, is it better to schedule the Core Bluetooth delegates to a background thread/queue? Does UI operation, e.g. tracking a panning or zooming gesture, interfere with Bluetooth?</p>\n"},{"tags":["java","multithreading","concurrency","parallel-processing","executorservice"],"answer_count":8,"favorite_count":8,"up_vote_count":21,"down_vote_count":0,"view_count":17536,"score":21,"question_id":1250643,"title":"How to wait for all threads to finish, using ExecutorService?","body":"<p>I need to execute some amount of tasks 4 at a time, something like this:</p>\n\n<pre><code>ExecutorService taskExecutor = Executors.newFixedThreadPool(4);\nwhile(...) {\n    taskExecutor.execute(new MyTask());\n}\n//...wait for completion somehow\n</code></pre>\n\n<p>How can I get notified once all of them are complete? For now I can't think about anything better than setting some global task counter and decrease it at the end of every task, then monitor in infinite loop this counter to become 0; or get a list of Futures and in infinite loop monitor isDone for all of them. What are better solutions not involving infinite loops?</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading","runnable"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":59,"score":1,"question_id":13198511,"title":"What it is the Best implementation for 3 Threads started by another one","body":"<p>I need to implement this situation on Java:</p>\n\n<p>I have 3 Threads for 3 different actions. Each action have to be executed in a different time. For example, action 1 it must run every 60min, action 2, have to be run every 40min and action 3 it must run every 120min.</p>\n\n<p>Then, I have one Thread to call the other 3 Threads</p>\n\n<p>What it is the Best implementation?</p>\n\n<p>Use Timer?, Use Runnable?</p>\n\n<p>Made a \"While true\" and inside do a GetTime and compare to know if I have to run some of the Thread?</p>\n\n<p>Or maybe Sleep the Main Thread?</p>\n\n<p>Thanks for the ideas and sorry for my poor english</p>\n"},{"tags":["c++","multithreading","file-io"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":13198122,"title":"Multi threaded application in C++","body":"<p>I'm working on a Multi Threaded application programmed in C++. I uses some temporary files to pass data between my threads. One thread writes the data to be processed into files in a directory. Another thread scans the directory for work files and reads the files and process them further, then delete those files. I have to use these files , because if my app gets killed when , i have to retain the data which has not been processed yet. </p>\n\n<p>But i hate to be using multiple files. I just want to use a single file. One thread continuously writing to a file and other thread reading the data and deleting the data which has been read. \n Like a vessel is filled from top and at bottom i can get and delete the data from vessel. How to do this efficiently in C++ , first is there a way ..? </p>\n"},{"tags":["c#","multithreading","exception","string.format"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13197981,"title":"String.Format failing with strange error","body":"<p>I have a method running with the following code:</p>\n\n<pre><code>private void WriteToDb()\n{\n    using (SqlConnection dbConnection = new SqlConnection(_conStr))\n    {\n        dbConnection.Open();\n        using (SqlBulkCopy sbc = new SqlBulkCopy(_conStr))\n        {\n            sbc.DestinationTableName = \"tblLog\";\n            try\n            {\n                sbc.WriteToServer(_tblLog);\n            }\n            catch (Exception e)\n            {\n                Console.WriteLine(String.Format(\"{0} Error writing log info: {1} \\n {3}\", DateTime.Now.ToString(), e.Message, e.StackTrace));\n            }\n        }\n    }\n\n    _tblLog.Rows.Clear();\n}\n</code></pre>\n\n<p>I am receiving an exception from the <code>String.Format()</code> method with the following stack trace:</p>\n\n<blockquote>\n  <p>Unhandled Exception: System.FormatException: Index (zero based) must be greater than or equal to zero and less than the size of the argument list.\n  at System.Text.StringBuilder.AppendFormat(IFormatProvider provider, String format, Object[] args)\n  at System.String.Format(IFormatProvider provider, String format, Object[] args)\n  at System.String.Format(String format, Object arg0, Object arg1, Object arg2)\n  at MyCompany.MyClient.MySoftware.Logger.WriteToDb()</p>\n</blockquote>\n\n<p>I can really see the source of this error. As far as I see I am not using any collection in that method. I also have to munch that this method is multi-threaded, but again I could not think of a possible impact.</p>\n\n<p>Thank you!</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13189926,"title":"Close loading form when all threads are complete","body":"<p>I want to know when all my async threads have completed so I know when to close my loading form.  My code never closes the loading form.  I don't know why.  I'm unsure how to correctly pass my ManualResetEvent object to the async thread too.</p>\n\n<p>I'm also open to a simpler means to achieve my goal of knowing when to close the loading form.</p>\n\n<p><strong>UPDATE</strong><br /></p>\n\n<p>After reading the advice here I've updated my class.  Unfortunetly, it still does not work.  I feel closer though.  It's just that the callback never fires.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.Threading.Tasks;\nusing System.Threading;\n\nnamespace BrianTests\n{\n\n    public class TaskInfo\n    {\n        public RegisteredWaitHandle Handle;\n        public string OtherInfo = \"default\";\n        public Form loading;\n    }\n\n\n    public partial class AsyncControlCreateTest : Form\n    {\n        //List&lt;ManualResetEvent&gt; MREs = new List&lt;ManualResetEvent&gt;();\n        Form loading = new Form() { Text = \"Loading...\", Width = 100, Height = 100 };\n        CountdownWaitHandle cdwh;\n\n        public AsyncControlCreateTest()\n        {\n            InitializeComponent();       \n        }\n\n        private void AsyncControlCreateTest_Load(object sender, EventArgs e)\n        {            \n            loading.Show(this);//I want to close when all the async threads have completed\n            CreateControls();\n        }  \n\n        private void CreateControls()\n        {\n            int startPoint= 0;\n            int threadCount = 2;\n            cdwh = new CountdownWaitHandle(threadCount);\n\n            for (int i = 0; i &lt; threadCount; i++)\n            {\n                ManualResetEvent mre = new ManualResetEvent(initialState: true);                \n                UserControl control = new UserControl() { Text = i.ToString() };                \n                control.Load += new EventHandler(control_Load);\n                Controls.Add(control);\n                control.Top = startPoint;\n                startPoint += control.Height;\n                //MREs.Add(mre);\n                //mre.Set();//just set here for testing\n            }\n            Task.Factory.StartNew(new Action(() =&gt; \n                {   \n            TaskInfo info = new TaskInfo();\n            info.loading = loading;\n            try\n            {\n                info.Handle = ThreadPool.RegisterWaitForSingleObject(cdwh, WaitProc, info, 4000, executeOnlyOnce: false);\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(ex.Message);\n            }\n                })); \n        }\n\n        public static void WaitProc(object state, bool timedOut)\n        {//this callback never occurs...\n            TaskInfo ti = (TaskInfo)state;\n\n            string cause = \"TIMED OUT\";\n            if (!timedOut)\n            {\n                cause = \"SIGNALED\";\n                // If the callback method executes because the WaitHandle is \n                // signaled, stop future execution of the callback method \n                // by unregistering the WaitHandle. \n                if (ti.Handle != null)\n                    ti.Handle.Unregister(null);\n            }\n\n            Console.WriteLine(\"WaitProc( {0} ) executes on thread {1}; cause = {2}.\",\n                ti.OtherInfo,\n                Thread.CurrentThread.GetHashCode().ToString(),\n                cause\n            );\n            ti.loading.Close();\n        }\n\n\n        void control_Load(object sender, EventArgs e)\n        {\n            RichTextBox newRichTextBox = new RichTextBox();\n            UserControl control = sender as UserControl;\n            control.Controls.Add(newRichTextBox);            \n\n            Task.Factory.StartNew(new Action(() =&gt; \n                {                    \n                   Thread.Sleep(2000);\n                   newRichTextBox.Invoke(new Action(() =&gt; newRichTextBox.Text = \"loaded\"));\n                   cdwh.Signal();\n                })); \n        }      \n    }\n\n    public class CountdownWaitHandle : WaitHandle\n    {\n        private int m_Count = 0;\n        private ManualResetEvent m_Event = new ManualResetEvent(false);\n\n        public CountdownWaitHandle(int initialCount)\n        {\n            m_Count = initialCount;\n        }\n\n        public void AddCount()\n        {\n            Interlocked.Increment(ref m_Count);\n        }\n\n        public void Signal()\n        {\n            if (Interlocked.Decrement(ref m_Count) == 0)\n            {\n                m_Event.Set();\n            }\n        }\n\n        public override bool WaitOne()\n        {\n            return m_Event.WaitOne();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading","android-asynctask"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13195666,"title":"Start Two AsyncTasks for parallel Computing and continue when they've finished","body":"<p>I have to edit huge bitmap files, so I want to use all cores of my device to speed up the process. I thought it would be a good solution to:</p>\n\n<ul>\n<li>Count the number of available cores</li>\n<li>Split the image into [numberofcores] parts</li>\n<li>For each core create a new thread and let this thread handle one part of the image</li>\n</ul>\n\n<p>How do I make sure all threads are done before I continue with other tasks, like saving the picture or return a message that the bitmap has been processed completely?</p>\n"},{"tags":[".net","multithreading","thread-safety",".net-2.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13197295,"title":"How do I elegantly finalize objects that own threads and raise events?","body":"<p>The question is about what to do when the caller <em>forgets</em> to dispose of my object. Thus I've skipped implementing <code>IDisposable</code> for brevity. My questions are: <strong>How dangerous is the last code sample?</strong> Can it be improved? Or maybe I'm obsessing over elegance too much? Or maybe there's another pattern to do this better already?</p>\n\n<p>The story begins with an attempt to wrap some long running process so it an be safely accessed from the main thread.</p>\n\n<pre><code>Public Class ThisCantRaiseEvents\n    Private client As UdpClient\n\n    Public Sub New(ByVal client As UdpClient)\n        Me.client = client\n        Dim thread As New Thread(AddressOf DoWork)\n        thread.IsBackground = True\n        thread.Start(client)\n    End Sub\n\n    Public Event PacketReceived As EventHandler\n\n    Protected Overrides Sub Finalize()\n        client.Close()\n    End Sub\n\n    Private Shared Sub DoWork(ByVal state As Object)\n        Dim client As UdpClient = DirectCast(state, UdpClient)\n        Try\n            While True\n                client.Receive(Nothing)\n            End While\n        Catch ex As Exception\n        End Try\n    End Sub\nEnd Class\n</code></pre>\n\n<p>The naive attempt at dispatching events to the main thread. Works well but never goes out of scope because its own thread keeps it alive. (Remember, threads don't die if their Thread object goes out of scope.)</p>\n\n<pre><code>Public Class ThisWillLeak\n    Private client As UdpClient\n    Private mainThread As Control\n\n    Public Sub New(ByVal client As UdpClient, ByVal control As Control)\n        Me.client = client\n        Me.mainThread = control\n        Dim thread As New Thread(AddressOf DoWork)\n        thread.IsBackground = True\n        thread.Start()\n    End Sub\n\n    Public Event PacketReceived As EventHandler\n\n    Protected Overrides Sub Finalize()\n        client.Close()\n    End Sub\n\n    Protected Overridable Sub OnPacketReceived(ByVal e As EventArgs)\n        RaiseEvent PacketReceived(Me, e)\n    End Sub\n\n    ' The worker thread has a pointer to ThisWillLeak\n    ' and so it will live forever!\n    Private Sub DoWork(ByVal state As Object)\n        Try\n            While True\n                client.Receive(Nothing)\n                mainThread.BeginInvoke(New Action(Of EventArgs) _\n                (AddressOf OnPacketReceived), EventArgs.Empty)\n            End While\n        Catch ex As Exception\n        End Try\n    End Sub\nEnd Class\n</code></pre>\n\n<p>' This was my first attempt at solving the problem in the previous sample. Alas, it get very ugly very quickly as the DoWork method becomes more complex.</p>\n\n<pre><code>Public Class ThisIsVeryUgly\n    Private client As UdpClient\n    Private mainThread As Control\n\n    Public Sub New(ByVal client As UdpClient, ByVal control As Control)\n        Me.client = client\n        Me.mainThread = control\n        Dim thread As New Thread(AddressOf DoWork)\n        thread.IsBackground = True\n        thread.Start(New WeakReference(Me))\n    End Sub\n\n    Public Event PacketReceived As EventHandler\n\n    Protected Overrides Sub Finalize()\n        client.Close()\n    End Sub\n\n    Protected Overridable Sub OnPacketReceived(ByVal e As EventArgs)\n        RaiseEvent PacketReceived(Me, e)\n    End Sub\n\n    Private Shared Sub DoWork(ByVal state As Object)\n        Dim weakThis As WeakReference = DirectCast(state, WeakReference)\n        Dim this As ThisIsVeryUgly = DirectCast(weakThis.Target, ThisIsVeryUgly)\n        Dim client As UdpClient = this.client\n        this = Nothing\n        Try\n            While True\n                client.Receive(Nothing)\n                this = DirectCast(weakThis.Target, ThisIsVeryUgly)\n                this.mainThread.BeginInvoke(New Action(Of EventArgs) _\n                (AddressOf this.OnPacketReceived), EventArgs.Empty)\n                this = Nothing\n                ' Repeat for every other place we need to raise an event! Ugh!\n            End While\n        Catch ex As Exception\n        End Try\n    End Sub\nEnd Class\n</code></pre>\n\n<p>This is my newest invention. It's elegant but has the potential to cause problems because the <code>sender</code> argument of the events it raises is not what the user would expect. <strong>Can this cause me any problems?</strong></p>\n\n<pre><code>Public Class ThisIsAlmostGood\n    Private client As UdpClient\n    Private worker As WorkThread\n\n    Public Sub New(ByVal client As UdpClient, ByVal mainThread As Control)\n        Me.client = client\n        worker = New WorkThread(client, mainThread)\n    End Sub\n\n    Public Custom Event PacketReceived As EventHandler\n        AddHandler(ByVal value As EventHandler)\n            AddHandler worker.PacketReceived\n        End AddHandler\n        RemoveHandler(ByVal value As EventHandler)\n            RemoveHandler worker.PacketReceived\n        End RemoveHandler\n        RaiseEvent(ByVal sender As Object, ByVal e As EventArgs)\n        End RaiseEvent\n    End Event\n\n    Protected Overrides Sub Finalize()\n        client.Close()\n    End Sub\n\n    Private Class WorkThread\n        Private client As UdpClient\n        Private mainThread As Control\n\n        Public Sub New(ByVal client As UdpClient, ByVal mainThread As Control)\n            Me.client = client\n            Me.mainThread = mainThread\n            Dim thread As New Thread(AddressOf DoWork)\n            thread.IsBackground = True\n            thread.Start()\n        End Sub\n\n        Public Event PacketReceived As EventHandler\n\n        Protected Overridable Sub OnPacketReceived(ByVal e As EventArgs)\n            ' But the user expects a pointer to ThisIsAlmostGood,\n            ' not WorkThread! Should I pass Nothing instead?\n            RaiseEvent PacketReceived(Me, e)\n        End Sub\n\n        Private Sub DoWork(ByVal state As Object)\n            Try\n                While True\n                    client.Receive(Nothing)\n                    mainThread.BeginInvoke(New Action(Of EventArgs) _\n                    (AddressOf OnPacketReceived), EventArgs.Empty)\n                End While\n            Catch ex As Exception\n            End Try\n        End Sub\n    End Class\nEnd Class\n</code></pre>\n"},{"tags":["multithreading","locking","deadlock","mutex"],"answer_count":5,"favorite_count":33,"up_vote_count":51,"down_vote_count":0,"view_count":33931,"score":51,"question_id":187761,"title":"Recursive Lock (Mutex) vs Non-Recursive Lock (Mutex)","body":"<p>POSIX allows mutexes to be recursive. That means the same thread can lock the same mutex twice and won't deadlock. Of course it also needs to unlock it twice, otherwise no other thread can obtain the mutex. Not all systems supporting pthreads also support recursive mutexes, but if they want to be <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/pthread_mutexattr_gettype.html\" rel=\"nofollow\">POSIX conform, they have to</a>.</p>\n\n<p>Other APIs (more high level APIs) also usually offer mutexes, often called Locks. Some systems/languages (e.g. Cocoa Objective-C) offer both, recursive and non recursive mutexes. Some languages also only offer one or the other one. E.g. in Java mutexes are always recursive (the same thread may twice \"synchronize\" on the same object). Depending on what other thread functionality they offer, not having recursive mutexes might be no problem, as they can easily be written yourself (I already implemented recursive mutexes myself on the basis of more simple mutex/condition operations).</p>\n\n<p>What I don't really understand: What are non-recursive mutexes good for? Why would I want to have a thread deadlock if it locks the same mutex twice? Even high level languages that could avoid that (e.g. testing if this will deadlock and throwing an exception if it does) usually don't do that. They will let the thread deadlock instead.</p>\n\n<p>Is this only for cases, where I accidentally lock it twice and only unlock it once and in case of a recursive mutex, it would be harder to find the problem, so instead I have it deadlock immediately to see where the incorrect lock appears? But couldn't I do the same with having a lock counter returned when unlocking and in a situation, where I'm sure I released the last lock and the counter is not zero, I can throw an exception or log the problem? Or is there any other, more useful use-case of non recursive mutexes that I fail to see? Or is it maybe just performance, as a non-recursive mutex can be slightly faster than a recursive one? However, I tested this and the difference is really not that big.</p>\n"},{"tags":["c#","multithreading","thread-safety","consumer","blockingcollection"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13195474,"title":"BlockingCollection multiple consumer","body":"<p>I have the following code with one producer thread and multiple consumer threads. Do you know if multiple consumers are thread safe. For example is there any chance that thread 1 is consuming and while do that thread 2 consume in parallel and change the value of the item that is used in thread 1?</p>\n\n<pre><code>namespace BlockingColl\n{\npublic partial class Form1 : Form\n{\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        try\n        {\n            for (int i = 0; i &lt; 3; i++)\n            {\n\n                ThreadPool.QueueUserWorkItem((x) =&gt;\n                   {\n                       foreach (var item in bc.GetConsumingEnumerable())\n                       {\n                           Console.WriteLine(Thread.CurrentThread.ManagedThreadId + \" - \" + item + \" - \" + DateTime.Now.ToString(\"MM/dd/yyyy hh:mm:ss.fff tt\"));\n                       }\n                   });\n            }\n        }\n        catch (Exception)\n        {\n\n            throw;\n        }\n    }\n\n    private void button2_Click(object sender, EventArgs e)\n    {\n        for (int i = 0; i &lt; 3; i++)\n        {\n\n            ThreadPool.QueueUserWorkItem((x) =&gt;\n               {\n                   Cache.Consume();\n               });\n        }\n\n\n        for (int i = 0; i &lt; 50000; i++)\n        {\n            Cache.bc.TryAdd(new Client() { ClientId = i, ClientName = \"Name\" + i });\n        }\n    }\n}\n\nstatic class Cache\n{\n    public static BlockingCollection&lt;Client&gt; bc = new BlockingCollection&lt;Client&gt;();\n\n\n    public static void Consume()\n    {\n        foreach (var item in bc.GetConsumingEnumerable())\n        {\n            Console.WriteLine(Thread.CurrentThread.ManagedThreadId + \" - \" + item + \" - \" + DateTime.Now.ToString(\"MM/dd/yyyy hh:mm:ss.fff tt\"));\n        }\n    }\n}\n\npublic class Client\n{\n    public int ClientId { get; set; }\n    public string ClientName { get; set; }\n}\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["multithreading","matlab","memory-leaks","parallel-processing","job-scheduling"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13194300,"title":"how to restart matlab local scheduler in a clean state?","body":"<p>I have 9 parallel jobs using matlab local scheduler configuration of parallel toolbox which will be triggered at scheduled times. </p>\n\n<p>I want the deployed application to run continuously but the problem is when a job is finished, although I destroy the jobs on the worker side and also clear the job objects on the client side, it remains in the client. Therefore, after hours of continuous running, the deployed application will crash.</p>\n\n<p>one possibility is to restart the job manager after a certain time, but there is still a problem with using the local scheduler profile. for example if I try to start the workers in clean state by setting \"RestartWorker\" property to true, I will get this error:</p>\n\n<blockquote>\n  <p>The name 'RestartWorker' is not an accessible property for an instance\n  of class 'simpleparalleljob'.</p>\n</blockquote>\n\n<p>I prefer not to setup a cluster and buy a commercial scheduler like MATLAB Distributed Computing Server (MDCS).</p>\n\n<p>I was wondering if anybody has a solution? </p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["c#","windows","multithreading","windows-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13193079,"title":"Running a task in windows service","body":"<p>I am making a windows service and one of its task is to ask for a free disk space every 1 hour, I know how to get the free space when the service starts but how to check for it every 1 hour?</p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":73,"score":-1,"question_id":13173816,"title":"Python Thread problems","body":"<p>I'm trying to make a program that does this:</p>\n\n<ol>\n<li>Calls program 1 in a thread</li>\n<li>Calls program 2 in another thread</li>\n<li>If program 1 ends first, kill program 2, or vice-versa.</li>\n</ol>\n\n<p>I've been trying for a long time and these are my current problem:</p>\n\n<ol>\n<li>I can't import Thread module (not threading!).</li>\n<li>Function or Class, that is the question.</li>\n</ol>\n\n<p>I already know how to call the processes using subprocess.Popen and how to kill them usign a command line function. I also know how to get the PID.</p>\n\n<p>Here's my actual code:</p>\n\n<pre><code>import threading, subprocess, shlex\n\nclass Prog1(threading.Thread):\n    def __init__(self, arg=''):\n        self.arg = arg\n        threading.Thread.__init__(self)\n\n    def run(self):\n        p = subprocess.Popen(shelx.split(self.arg))\n        global p.pid\n        subprocess.Popen(shelx.split(\"kill -9 \" + q.pid))\n\n\nclass Prog2(threading.Thread):\n    def __init__(self, arg=''):\n        self.arg = arg\n        threading.Thread.__init__(self)\n\n    def run(self):\n        q = subprocess.Popen(shelx.split(self.arg))\n        global q.pid\n        subprocess.Popen(shelx.split(\"kill -9 \" + p.pid))\n</code></pre>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":7,"favorite_count":2,"up_vote_count":18,"down_vote_count":0,"view_count":6765,"score":18,"question_id":117690,"title":"Wait until any of Future<T> is done","body":"<p>I have few asynchronous tasks running and I need to wait until at least one of them is finished (in the future probably I'll need to wait util M out of N tasks are finished).\nCurrently they are presented as Future, so I need something like</p>\n\n<pre><code>/**\n * Blocks current thread until one of specified futures is done and returns it. \n */\npublic static &lt;T&gt; Future&lt;T&gt; waitForAny(Collection&lt;Future&lt;T&gt;&gt; futures) \n        throws AllFuturesFailedException\n</code></pre>\n\n<p>Is there anything like this? Or anything similar, not necessary for Future. Currently I loop through collection of futures, check if one is finished, then sleep for some time and check again. This looks like not the best solution, because if I sleep for long period then unwanted delay is added, if I sleep for short period then it can affect performance.</p>\n\n<p>I could try using </p>\n\n<pre><code>new CountDownLatch(1)\n</code></pre>\n\n<p>and decrease countdown when task is complete and do </p>\n\n<pre><code>countdown.await()\n</code></pre>\n\n<p>, but I found it possible only if I control Future creation. It is possible, but requires system redesign, because currently logic of tasks creation (sending Callable to ExecutorService) is separated from decision to wait for which Future. I could also override </p>\n\n<pre><code>&lt;T&gt; RunnableFuture&lt;T&gt; AbstractExecutorService.newTaskFor(Callable&lt;T&gt; callable)\n</code></pre>\n\n<p>and create custom implementation of RunnableFuture with ability to attach listener to be notified when task is finished, then attach such listener to needed tasks and use CountDownLatch, but that means I have to override newTaskFor for every ExecutorService I use - and potentially there will be implementation which do not extend AbstractExecutorService. I could also try wrapping given ExecutorService for same purpose, but then I have to decorate all methods producing Futures.</p>\n\n<p>All these solutions may work but seem very unnatural. It looks like I'm missing something simple, like </p>\n\n<pre><code>WaitHandle.WaitAny(WaitHandle[] waitHandles)\n</code></pre>\n\n<p>in c#. Are there any well known solutions for such kind of problem?</p>\n\n<p>UPDATE:</p>\n\n<p>Originally I did not have access to Future creation at all, so there were no elegant solution. After redesigning system I got access to Future creation and was able to add countDownLatch.countdown() to execution process, then I can countDownLatch.await() and everything works fine.\nThanks for other answers, I did not know about ExecutorCompletionService and it indeed can be helpful in similar tasks, but in this particular case it could not be used because some Futures are created without any executor - actual task is sent to another server via network, completes remotely and completion notification is received.</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13193487,"title":"Multithreading multiball game","body":"<p>I am working on a school project about multiple balls bouncing. So far, I managed to create the app and everything works ok. But, I also need to implement multi-threading in the app, and this is where I am stuck. I was thinking of one ball one thread, but I am not sure of how to implement it. Here is my code so far (part):</p>\n\n<pre><code>public void paintComponent(Graphics g)\n        {\n            super.paintComponent(g);\n\n            //The balls are painted only after the timer is started\n            if(bTimer)\n            {\n                for(Ball ball:ballList.ballsArrayList) \n                {\n                    Thread ballThread = new Thread(ball);\n                    ballThread.start();\n                    ball.draw(g);\n\n                    /*other code for moving the ball*/\n                }\n            }\n        }\n</code></pre>\n\n<p>In the class Ball:</p>\n\n<pre><code>     public void draw(Graphics g) {\n          Color color = new Color(this.getColorR(),this.getColorG(),this.getColorB());\n          g.setColor(color);\n          int radius = this.getsize();\n          g.fillOval((int)(this.getX() - radius), (int)(this.getY() - radius), (int)(2 *     \n          radius), (int)(2 * radius));\n\n       }\n\n     public void run() {  \n\n            String name = Thread.currentThread().getName();  \n\n            for (int i = 0; i &lt; 200; i++) {  \n\n                //ball.draw(g); ??\n\n                try {  \n                    Thread.sleep(50); \n                    System.out.println(\"Sleeping\");\n                } catch (Exception ex) {}  \n            }  \n        }  \n</code></pre>\n\n<p>I was thinking that I could put the ball.draw() function in the run() function for the thread. But I don't know how I can do that or if it's a good idea. Multi-threading is still difficult for me to understand and implement =((</p>\n"},{"tags":["c#","multithreading","thread-safety","aforge"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":45,"score":4,"question_id":13193709,"title":"Unexpected data loss during static Queue.Enqueue in multithread process","body":"<blockquote>\n  <p>private Queue _queueObject = new\n  Queue();</p>\n  \n  <p>private static Queue _queueItem = new\n  Queue();</p>\n  \n  <p>private static int permitEntryCount = 0;</p>\n  \n  <p>private int allowThreadEntry = 0;</p>\n</blockquote>\n\n<p>I have 2 queue variables as shown above.       </p>\n\n<blockquote>\n<pre><code>public Camera(IVideoSource source, MotionDetector detector)\n{\n   VideoSource = source; \n   _motionDetector = detector;\n   VideoSource.NewFrame += VideoNewFrame; \n   MainForm.OnRegisterClickedEvent += new MainForm.RegisterClickedEventHandler(MainForm_OnRegisterClickedEvent);\n   MainForm.OnReceiveMultipleFrameEvent += new MainForm.ReceiveMultipleFrameEventHandler(MainForm_OnReceiveMultipleFrameEvent);\n}\n</code></pre>\n</blockquote>\n\n<p>I have a Camera class, and shown above is part of the constructor implementation. The video source always listening to event VideoNewFrame; The code i show below is one segment of the code in VideoNewFrame. </p>\n\n<pre><code>FrameObjectElement frameObj = new FrameObjectElement();\nframeObj.cameraID = CW.Camobject.id;\nframeObj.cameraTag = _FPGAFrameCount / 2;\nframeObj.FirstFrameBuffer = BitmapToRgbValues(twoframe_arg.GetFirstBitmap(352, 288));\nframeObj.SecondFrameBuffer = BitmapToRgbValues(twoframe_arg.GetSecondBitmap(352, 288));\n\nif (_queueObject.Count &gt; 5)\n    _queueObject.Clear();\n\n_queueObject.Enqueue(frameObj);\n\nif (allowThreadEntry == permitEntryCount &amp;&amp; isClear) \n{\n    if (_queueObject.Count !=  0)\n    {\n        lock (this)\n        {\n            _queueItem.Enqueue(_queueObject.Peek());\n        }\n        Debug.WriteLine(\"Thread ID: \" + Thread.CurrentThread.ManagedThreadId.ToString() +\n        \" - \" + _queueObject.Count.ToString() +\n        \" queue in QueueObject : Camera ID : \" + _queueObject.Peek().cameraID.ToString() +\n        \" : Camera Tag : \" + _queueObject.Peek().cameraTag.ToString() + \n        \" : Queue item count : \" + _queueItem.Count.ToString());\n\n        _queueObject.Dequeue();\n\n        if (_queueItem.Count == numberOfCamera &amp;&amp; isAllow)\n        {\n            CurrentID = CW.Camobject.id;\n            isAllow = false;\n        }\n\n        allowThreadEntry++;\n        if (_queueItem.Count == numberOfCamera)\n        {\n            if (CurrentID == CW.Camobject.id)\n            {\n                isClear = false;\n                //allowEntry = false;\n\n                //Debug.WriteLine(\"-- Count: \" + allowThreadEntry.ToString() + \" --\");\n\n                foreach (FrameObjectElement foE in _queueItem)\n                {\n                    Debug.WriteLine(\"Current Camera ID: \" + CW.Camobject.id +\n                        \" : Camera ID : \" + foE.cameraID.ToString() +\n                        \" : Camera Tag : \" + foE.cameraTag.ToString() + \" :\");\n                }\n\n                MultipleFrameEventArgs newMul = new MultipleFrameEventArgs();\n                newMul.itemObj = _queueItem;\n\n                if (OnMultupleFrameEvent != null)\n                    OnMultupleFrameEvent(newMul);\n\n                _queueItem.Clear();\n                isAllow = true;\n                isClear = true;\n                Debug.WriteLine(\"Queue item count: \" + _queueItem.Count.ToString() +\n                    \" : isClear : \" + isClear.ToString());\n            }\n        }   \n    }\n}\n</code></pre>\n\n<p>Basically what am i trying to achieve here is to collect the frame id, tag, its first and second frame and then store in an object(struct FrameObjectElement). Every collection of 2 frames will represent 1 camera tag, thus the meaning of its role here.  Then the frameobject is enqueued in '_queueObject'. Next i would have a condition 'if(allowThreadEntry == permitEntryCount)'. So what is being done here is everytime this function is accessed, 'allowThreadEntry' will increment while 'permitCountEntry' remain the same. Then this function will go on and enqueue the first element in '_queueObject' to '_queueItem' and once a desired count of _queueItem is satisfied, it would raise a signal to another Class. This class will respond back by raising a signal which Camera class has earlier subscibed as shown ' MainForm.OnReceiveMultipleFrameEvent += new MainForm.ReceiveMultipleFrameEvent(MainForm_OnReceiveMultipleFrameEvent)'.</p>\n\n<blockquote>\n  <p>void\n  MainForm_OnReceiveMultipleFrameEvent(MainForm.ReceiveMultpleFrameEventArgs\n  e)    {       permitEntryCount++;     }</p>\n</blockquote>\n\n<p>Upon receiving the signal, permitEntryCount will be incremented thus allowing the function to be accessed again. Why i do this is because this class is created depends on how many object camera i have. If i hav 11 cameras, i would have 11 workerThread running processing this class. I queue up their frames in a non static queue and gather their first element into a static queue which is to be passed for my other process. The problem i am facing here is as below:</p>\n\n<blockquote>\n  <p>=============================  Count : 1760 ===============================</p>\n  \n  <p>Queue item count: 0 : isClear : True</p>\n  \n  <p>Thread ID: 17 - 3 queue in QueueObject : Camera ID : 3 : Camera Tag :\n  3372 : Queue item count : 1</p>\n  \n  <p>Thread ID: 24 - 6 queue in QueueObject : Camera ID :10 : Camera Tag :\n  4367 : Queue item count : 2</p>\n  \n  <p>Thread ID: 23 - 5 queue in QueueObject : Camera ID : 9 : Camera Tag :\n  4415 : Queue item count : 3</p>\n  \n  <p>Thread ID: 19 - 1 queue in QueueObject : Camera ID : 5 : Camera Tag :\n  4108 : Queue item count : 4</p>\n  \n  <p>Thread ID: 20 - 5 queue in QueueObject : Camera ID : 6 : Camera Tag :\n  3768 : Queue item count : 5</p>\n  \n  <p>Thread ID: 14 - 1 queue in QueueObject : Camera ID : 0 : Camera Tag :\n  2837 : Queue item count : 6</p>\n  \n  <p>Thread ID: 21 - 1 queue in QueueObject : Camera ID : 7 : Camera Tag :\n  3246 : Queue item count : 7</p>\n  \n  <p>Thread ID: 16 - 1 queue in QueueObject : Camera ID : 2 : Camera Tag :\n  3552 : Queue item count : 8</p>\n  \n  <p>Thread ID: 18 - 6 queue in QueueObject : Camera ID : 4 : Camera Tag :\n  3117 : Queue item count : 9</p>\n  \n  <p>Thread ID: 15 - 3 queue in QueueObject : Camera ID :1 : Camera Tag :\n  2315 : Queue item count : 10</p>\n  \n  <p>Thread ID: 22 - 4 queue in QueueObject : Camera ID :8 : Camera Tag :\n  4853 : Queue item count : 11</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 3 : Camera Tag : 3372 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID :10 : Camera Tag : 4367 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 9 : Camera Tag : 4415 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 5 : Camera Tag : 4108 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 6 : Camera Tag : 3768 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 0 : Camera Tag : 2837 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 7 : Camera Tag : 3246 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 2 : Camera Tag : 3552 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 4 : Camera Tag : 3117 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 1 : Camera Tag : 2315 :</p>\n  \n  <p>Current Camera ID: 8 : Camera ID : 8 : Camera Tag : 4853 :</p>\n  \n  <p>=============================  Count : 1761 ===============================</p>\n  \n  <p>Queue item count: 0 : isClear : True</p>\n  \n  <p>Thread ID: 14 - 1 queue in QueueObject : Camera ID : 0 : Camera Tag :\n  2838 : Queue item count : 1</p>\n  \n  <p>Thread ID: 16 - 1 queue in QueueObject : Camera ID : 2 : Camera Tag :\n  3553 : Queue item count : 2</p>\n  \n  <p>Thread ID: 21 - 1 queue in QueueObject : Camera ID : 7 : Camera Tag :\n  3247 : Queue item count : 3</p>\n  \n  <p>Thread ID: 24 - 1 queue in QueueObject : Camera ID :10 : Camera Tag :\n  4374 : Queue item count : 4</p>\n  \n  <p>Thread ID: 23 - 6 queue in QueueObject : Camera ID : 9 : Camera Tag :\n  4416 : Queue item count : 5</p>\n  \n  <p>Thread ID: 17 - 4 queue in QueueObject : Camera ID : 3 : Camera Tag :\n  3373 : Queue item count : 7</p>\n  \n  <p>Thread ID: 15 - 3 queue in QueueObject : Camera ID : 1 : Camera Tag :\n  2316 : Queue item count : 7</p>\n  \n  <p>Thread ID: 18 - 6 queue in QueueObject : Camera ID : 4 : Camera Tag :\n  3118 : Queue item count : 8</p>\n  \n  <p>Thread ID: 20 - 6 queue in QueueObject : Camera ID : 6 : Camera Tag :\n  3769 : Queue item count : 9</p>\n  \n  <p>Thread ID: 22 - 4 queue in QueueObject : Camera ID :8 : Camera Tag :\n  4854 : Queue item count : 10</p>\n</blockquote>\n\n<p>I should have different count number in '_queueItem' since every object created can access only one time in this segment thus letting me know that their element will be enqueued into '_queueItem'. But unfortunately, somehow after the program runs a while, there will be an occurance as shown above. Either i apply lock or not on this part '_queueItem.Enqueue(_queueObject.Peek());' i will still have the problem. May i know where i did wrong?</p>\n"},{"tags":["java","multithreading","virtual-machine","working-directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13123513,"title":"Server Client in Java: could not start client","body":"<p>I coded a tiny thread-based TCP Server and a Client, but I could not start the Client. Java VM seems to have problems.</p>\n\n<pre><code>chris@chris-UX31E:~/workspace/verteilte/build$ java Client localhost 9000 9002\nError occurred during initialization of VM\njava.lang.Error: Properties init: Could not determine current working directory.\n    at java.lang.System.initProperties(Native Method)\n    at java.lang.System.initializeSystemClass(System.java:1115)\n</code></pre>\n\n<p>Whats wrong with the environment/working directory? </p>\n"},{"tags":["c#","multithreading","printing","webbrowser"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":66,"score":4,"question_id":13143556,"title":"Threads for WebBrowser.Print()","body":"<p>I'm trying to create GUI program that generates HTML invoices, and sends them for printing. <br>I have this working. However, now I want to introduce threading.</p>\n\n<p>I have a form with a <code>BackgroundWorker</code>. The Background worker runs this code:</p>\n\n<pre><code>#region BackGroundWorker   \nprivate void bg_htmlGeneration_DoWork(object sender, DoWorkEventArgs e)\n{\n   //SOME MORE CODE..\n\n   foreach (XElement ele in Lib.GetInvoiceElement(inv, ico.Supplier))\n   {\n      PrintDocument(Lib.CreateHTMLFile());\n   }\n}\n#endregion  \n\n\npublic void PrintDocument(string fileName)\n{\n    var th = new Thread(() =&gt;\n    {\n        WebBrowser webBrowserForPrinting = new WebBrowser();\n        webBrowserForPrinting.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(PrintDocumentHandler);\n        webBrowserForPrinting.Url = new Uri(fileName);\n        Application.Run();\n    });\n    th.SetApartmentState(ApartmentState.STA);\n    th.Start();\n}\n\npublic void PrintDocumentHandler(object sender, WebBrowserDocumentCompletedEventArgs e)\n{\n    ((WebBrowser)sender).Print();\n    ((WebBrowser)sender).Dispose();\n    Application.ExitThread();\n}\n</code></pre>\n\n<p>Everything runs through fine. However, the <code>WebBrowser</code> object refuses to print. There are no errors (that are obvious), the program finishes off with nothing sent to the printer. <br>When I take away the threading, the program works again.</p>\n\n<p>My knowledge of threading is weak, and I'm pretty much teaching myself - so presumably I'm misunderstanding how threading priority is set.</p>\n\n<p>Here's How it should work:</p>\n\n<ol>\n<li>User selects Invoice(s) on Main Form, chooses to print.</li>\n<li>Background thread goes away and prints them while user continues on the program.</li>\n</ol>\n\n<p>Any ideas would be appreciated.</p>\n"},{"tags":["c#","wpf","multithreading","dispatcher"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13192247,"title":"View is not updated when on a separate thread","body":"<p>I am trying to load some data in a separate thread, then add the loaded data to an ObservableCollection and update the view through ba binding.</p>\n\n<p>First, I was doing the following:</p>\n\n<pre><code>public OverviewViewModel()\n{\n    Thread thread = new Thread(new ThreadStart(delegate\n    {\n        TheTVDB theTvdb = new TheTVDB();\n        foreach (TVSeries tvSeries in theTvdb.SearchSeries(\"Dexter\"))\n        {\n            this.Overview.Add(tvSeries);\n        }\n    }));\n    thread.SetApartmentState(ApartmentState.STA);\n    thread.Start();\n}\n</code></pre>\n\n<p>This gave the following error:</p>\n\n<blockquote>\n  <p>This type of CollectionView does not support changes to its\n  SourceCollection from a thread different from the Dispatcher thread.</p>\n</blockquote>\n\n<p>So I read on this forum that I should use the Dispatcher, so I put <code>this.Overview.Add(tvSeries)</code> into a call to the Dispatcher.</p>\n\n<pre><code>Dispatcher.CurrentDispatcher.BeginInvoke((Action)delegate\n{\n    this.Overview.Add(tvSeries);\n},\nDispatcherPriority.Normal);\n</code></pre>\n\n<p>Now, it doesn't crash anymore but the view is not updated. Nothing happens, the view is just empty. I have tested the functionality by running it on the main thread. Then the view is updated correctly.</p>\n\n<p>Does anyone know why the view is not updated and how I can fix this?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>The below approach seems to work and it seems to do everything asynchronously. Can anyone confirm that this is the right approach for doing things asyncronously?</p>\n\n<pre><code>Dispatcher.CurrentDispatcher.BeginInvoke(new Action(delegate\n{\n    TheTVDB theTvdb = new TheTVDB();\n    foreach (TVSeries tvSeries in theTvdb.SearchSeries(\"Dexter\"))\n    {\n        this.Overview.Add(tvSeries);\n    }\n}),\nDispatcherPriority.Background);\n</code></pre>\n"},{"tags":["iphone","objective-c","multithreading","uiscrollview","nsautoreleasepool"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1075,"score":1,"question_id":5095639,"title":"iOS detachNewThreadSelector leaking","body":"<p>I have a UIScrollView that I am loading some images in.  Sometimes I am apply an effect to an image and it takes a bit to do the pre-loading so I decided to do this on a different thread using detachNewThreadSelector.  I am using the KTPhotoBrowser that is on gitHub for this.  </p>\n\n<p>So basically, I have a function as so.</p>\n\n<pre><code>- (void)setCurrentIndex:(NSNumber *)newIndex\n{\n\n   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n\n   currentIndex_ = [newIndex integerValue];\n\n   [self loadPhoto:currentIndex_];\n   [self loadPhoto:currentIndex_ + 1];\n   [self loadPhoto:currentIndex_ - 1];\n   [self unloadPhoto:currentIndex_ + 2];\n   [self unloadPhoto:currentIndex_ - 2];\n\n  [self setTitleWithCurrentPhotoIndex];\n  [self toggleNavButtons];\n  [pool release];\n\n}\n</code></pre>\n\n<p>I call this using </p>\n\n<pre><code>[NSThread detachNewThreadSelector:@selector(setCurrentIndex:) toTarget:self withObject:[NSNumber numberWithInt:5]];\n</code></pre>\n\n<p>When I run this, it appears to be throwing a leak.  I am beginning to wonder if I should be putting the AutoRelease pool around the code in the loadPhoto method.  If you are curious about this code, I have included it below.</p>\n\n<pre><code>- (void)loadPhoto:(NSInteger)index\n{\n   if (index &lt; 0 || index &gt;= photoCount_) {\n      return;\n   }\n\n   id currentPhotoView = [photoViews_ objectAtIndex:index];\n   if (NO == [currentPhotoView isKindOfClass:[KTPhotoView class]]) {\n      // Load the photo view.\n      CGRect frame = [self frameForPageAtIndex:index];\n      KTPhotoView *photoView = [[KTPhotoView alloc] initWithFrame:frame];\n      [photoView setScroller:self];\n      [photoView setIndex:index];\n      [photoView setBackgroundColor:[UIColor clearColor]];\n\n      // Set the photo image.\n      if (dataSource_) {\n         if ([dataSource_ respondsToSelector:@selector(imageAtIndex:photoView:)] ==    NO) {\n            UIImage *image = [dataSource_ imageAtIndex:index];\n            [photoView setImage:image];\n         } else {\n        [dataSource_ imageAtIndex:index photoView:photoView];\n         }\n      }\n\n      [scrollView_ addSubview:photoView];\n      [photoViews_ replaceObjectAtIndex:index withObject:photoView];\n      [photoView release];\n   } else {\n      // Turn off zooming.\n      [currentPhotoView turnOffZoom];\n   }\n}\n</code></pre>\n\n<p>Any ideas would be greatly appreciated.</p>\n"},{"tags":["asp.net","multithreading","architecture"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13183553,"title":"ASP.NET and multithreading best practices","body":"<p>I am working on ASP.NET project and yesterday I saw a piece of code that uses System.Threading.Thread to offload some tasks to a new thread. The thread runs a few SQL statements and logs the result.</p>\n\n<p>Isn't it better to use another approach? For example to have a Windows Service that performs the SQL batch. Then the web page will just enqueue the batch (via WCF).</p>\n\n<p>In general, what are the best practices for multithreading in ASP.NET? Are there justified usages of threads/TPL tasks/etc. in a web page?</p>\n"},{"tags":["javascript","jquery","ajax","multithreading","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13175068,"title":"2 or more async requests in javascript to load image or do anything else","body":"<p>Single request and response model at one time do not utilizes full network/internet bandwidth, thus resulting in low performance. (benchmark is of half speed utilization)</p>\n\n<p><strong>how to make this code use 2 or 3 or more async requests instead of one.(ajax)</strong>\nor do i need multi threading? and is it possible in javascript?</p>\n\n<p>(<strong>this is for making a video out of an ip</strong> )\nevery time the image changes on request. and yes i need to be async with multiple fetch requests (not single as i explained above) or you recomend threads?</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;  &lt;script language=\"JavaScript\"&gt;\n    // Global vars\n    img = 'http://pastebin.com/i/t.gif';\n    timeout = 1000;\n    next = 0;\n\n    function onLoad( ) {\n        setTimeout( 'reloadImage( )', timeout );\n    }\n\n    // Reloader\n    function reloadImage( ) {\n        next = ( new Date( ) ).getTime( ) + timeout;\n        document.images.dv.src = img + \"?\" + next;\n    }\n    &lt;/script&gt;\n    &lt;/head&gt; \n\n    &lt;body&gt;\n    &lt;img src=\"img\" name=\"dv\" onLoad=\"onLoad( )\"&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n\n\n\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;div id=\"container\"&gt;&lt;/div&gt;\n\n&lt;script language=\"JavaScript\"&gt;\nvar canLoad = true;\nvar container = document.getElementById(\"container\");\nvar image = document.createElement(\"img\");\nimage.onload = function() {\n    canLoad = true;\n    console.log(\"Image reloaded.\");\n}\nvar imageUrl = \"http://url/snapshot.jpg\";\nvar fps = 2;\n\ncontainer.appendChild(image);\n\nfunction loadImage() {\n    if (canLoad) {\n    canLoad = false;\n    var str = new Date().getTime();\n    image.setAttribute(\"src\", imageUrl + \"?\" + str);\n    console.log(\"Reloaded now.\");\n    } else {\n    console.log(\"Can't reload now.\");\n    }\n}\n\nsetInterval(loadImage, fps); // 30 fps\n\n&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["java","vector","multithreading","thread-safety"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4509,"score":2,"question_id":1658697,"title":"java Vector and thread safety","body":"<p>I'm wondering if this code will do any trouble:</p>\n\n<p>I have a vector that is shared among many threads. Every time a thread has to add/remove stuff from the vector I do it under a <code>synchronized</code> block. However, the main thread has a call:</p>\n\n<pre><code>System.out.println(\"the vector's size: \"+ vec.size());\n</code></pre>\n\n<p>which isn't <code>synchronized</code>.</p>\n\n<p>Should this cause trouble?</p>\n"},{"tags":["c#","multithreading","events","autoresetevent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":69,"score":-2,"question_id":13191281,"title":"AutoResetEvent doesn't work by some reason","body":"<p><strong>upd</strong> I've found that AutoResetEvent is works as expected. It seems I have exception somewhere inside <code>CalculateAndNotify</code>. So this question is not about AutoResetEvent anymore. But if you can suggest how to better calculate indexes in HFT software - comments are welcome.</p>\n\n<p>==============================================================================\nI add below the full listing of my class. There are two important methods. <code>Calculate</code> is recalculating the index value every time <code>InstrumentUpdated</code> is called.</p>\n\n<pre><code>class CompositeIndex : CustomIndex\n{\n    //private Tuple&lt;Instrument, double&gt;[] _instrumentsWithWeight;\n    //private int[] _instrumentIds;\n    //private double[] _ammounts;\n    //private double[] _cachedProduct; // one thread writes here and another thread reads. so need to use \"Volatile\"\n    //private volatile bool _initialized;\n\n    //AutoResetEvent are = new AutoResetEvent(false);\n\n    //public CompositeIndex(string indexId, Tuple&lt;Instrument, double&gt;[] instrumentsWithWeight)\n    //    : base(indexId, GetInstruments(instrumentsWithWeight))\n    //{\n    //    _instrumentsWithWeight = instrumentsWithWeight;\n    //    _instrumentIds = new int[_instrumentsWithWeight.Count()];\n    //    _ammounts = new double[Commons.Constants.MAX_INSTRUMENTS_NUMBER_IN_SYSTEM];\n    //    _cachedProduct = new double[Commons.Constants.MAX_INSTRUMENTS_NUMBER_IN_SYSTEM];\n\n        Task.Factory.StartNew(() =&gt;\n                {\n                    while(true)\n                    {\n                        if (_initialized)\n                        {\n                            break;\n                        }\n                        Thread.Sleep(1000);\n                    }\n                    while (true)\n                    {\n                        are.WaitOne();             // hangs here!\n                        CalculateAndNotify();\n                    }\n                }\n            , TaskCreationOptions.LongRunning);\n    }\n\n    //private static List&lt;Instrument&gt; GetInstruments(Tuple&lt;Instrument, double&gt;[] instrumentsWithWeight)\n    //{\n    //    List&lt;Instrument&gt; result = new List&lt;Instrument&gt;();\n    //    for (int i = 0; i &lt; instrumentsWithWeight.Count(); i++)\n    //    {\n    //        result.Add(instrumentsWithWeight[i].Item1);\n    //    }\n    //    return result;\n    //}\n\n    //protected override void Calculate()\n    //{\n    //    double result = 0;\n    //    for (int i = 0; i &lt; _instrumentIds.Count(); i++)\n    //    {\n    //        int instrumentId = _instrumentIds[i];\n    //        // we assign 0 weself so this comparision is OK\n    //        double cachedProduct = Volatile.Read(ref _cachedProduct[instrumentId]);\n    //        if (cachedProduct == 0)\n    //        {\n    //            Value = null;\n    //            return;\n    //        }\n    //        result += cachedProduct;\n    //    }\n    //    Value = result;\n    //}\n\n    //private object _initializeLock = new object();\n\n    //private bool Initialize()\n    //{\n    //    lock (_initializeLock)\n    //    {\n    //        if (_initialized)\n    //        {\n    //            return true;\n    //        }\n    //        for (int i = 0; i &lt; _instrumentsWithWeight.Count(); i++)\n    //        {\n    //            Instrument instrument = _instrumentsWithWeight[i].Item1;\n    //            double weight = _instrumentsWithWeight[i].Item2;\n    //            _instrumentIds[i] = instrument.Id;\n    //            _ammounts[instrument.Id] = weight;\n    //        }\n    //        _initialized = true;\n    //        return true;\n    //    }\n    //}\n\n    public override void InstrumentUpdated(Instrument instrument)\n    {\n        //if (!_initialized)\n        //{\n        //    if (!Initialize())\n        //    {\n        //        return;\n        //    }\n        //}\n        //int instrumentId = instrument.Id;\n        //bool useSecurityInsteadOfOrderBook = instrument.GateId == 1;\n\n        //decimal? value;\n        //if  (useSecurityInsteadOfOrderBook)\n        //{\n        //    InstrumentInfo ii = Markets.GetInstrumentInfo(instrument);\n        //    value = ii.MedianOrAskOrBid;\n        //} else\n        //{\n        //    Glass glass = Markets.GetGlass(instrument);\n        //    value = glass.MedianOrAskOrBid;\n        //}\n\n\n        //if (value == null)\n        //{\n        //    Volatile.Write(ref _cachedProduct[instrumentId], 0);\n        //}\n        //else\n        //{\n        //    Volatile.Write(ref _cachedProduct[instrumentId], ((double)value) * _ammounts[instrumentId]);\n        //}\n        are.Set();      // called many times!\n    }\n\n}\n</code></pre>\n\n<p>I've added some tracing and noticed that:\nOne thread hangs at <code>are.WaitOne()</code>. Despite of the fact that another thread call <code>are.Set()</code> many times the first thread is not released.\nWhy? What's wrong with my code?</p>\n"},{"tags":["c#","multithreading","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":13175027,"title":"What gets put on a thread pool thread in Task when using async/await?","body":"<p>Please consider the following code</p>\n\n<pre><code>    public static async Task&lt;int&gt; Answer()\n    {\n        await Task.Delay(1000);\n        return 42;\n    }\n\n    static void Main(string[] args)\n    {\n        for (int j = 0; j &lt; 20; j++)\n        {\n            Console.WriteLine(j +\" \" + Thread.CurrentThread.IsThreadPoolThread);\n            if (j == 1)\n            {\n                new Task( async ()=&gt;\n                    {\n                        int answer = await Answer();\n                        Console.WriteLine(answer + \" \" + Thread.CurrentThread.IsThreadPoolThread);\n                    }).Start();\n            }\n\n            Thread.Sleep(200);\n        }\n\n        return;\n</code></pre>\n\n<p>Can you guess what the <code>CurrentThread.IsThreadPoolThread</code> when printing answer is?</p>\n\n<p>It appears that <code>Task.Delay(..)</code> is doing it, for if I remove await, then the answer is <code>False</code>. However, I can not seem to find that <code>Delay</code> actually puts stuff on the thread pool in the documentation.</p>\n\n<p>This brings me to the more general question. What in Task <em>does</em> actually start up a thread pool thread besides <code>Run(..)</code>?</p>\n\n<p><strong>Edit:</strong><br>\nReplacing <code>new Task(...)</code> with <code>Ask()</code></p>\n\n<pre><code>    public static async void Ask()\n    {\n        int answer = await Answer();\n        Console.WriteLine(answer + \" \" + Thread.CurrentThread.IsThreadPoolThread);\n    }\n</code></pre>\n\n<p>yields the same result</p>\n"},{"tags":["c#","multithreading","performance","parallel-processing","threadpool"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":938,"score":1,"question_id":349513,"title":"Using Parallel.For to test SQL queries and comparison with the ThreadPool","body":"<p>I'm looking for a way to easily load test and benchmark some of our SQL (using ADO.NET, nothing fancy using LINQ or PLINQ) that has to be performant when running under high parallel load.</p>\n\n<p>I've thought of using the new parallel extensions CTP and specifically <code>Parallel.For</code> / <code>Parallel.ForEach</code> to simply run the SQL over 10k iterations or so - but I've not been able to find any data on what these have been optimized for.</p>\n\n<p>Essentially I'm worried that because database access is inherently I/O bound, it won't create sufficient load. Does anyone know if Parallel. For is  intelligent enough to use > x threads (where x = # of CPUs) if the tasks it is executing are not totally CPU bound? I.e. does it behave in a similar manner to the managed thread pool?</p>\n\n<p>Would be rather cool if it was so!</p>\n\n<p><b>EDIT: As @CVertex has kindly referred to below, you can set the number of threads independently. Does anyone know if the parallel libraries by default are intelligent enough to keep adding threads if a job is I/O bound?</b></p>\n"},{"tags":["c#",".net","multithreading","generics","threadpool"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":1,"view_count":1586,"score":4,"question_id":323558,"title":"Generic ThreadPool in .NET","body":"<p>Here's a relatively common task for me, and, I think, for many a .NET programmer:<br>\nI want to use the .NET ThreadPool for scheduling worker threads that need to process a given type of tasks.</p>\n\n<p>As a refresher, the signatures for the queueing method of the ThreadPool and its associated delegate are:</p>\n\n<pre><code>public static bool QueueUserWorkItem (\n    WaitCallback callBack,\n    Object state\n)\npublic delegate void WaitCallback (Object state)\n</code></pre>\n\n<p>Therefore, a typical generic worker thread class would look something like:</p>\n\n<pre><code>public class Worker&lt;T&gt; {\n    public void schedule(T i_task) {\n        ThreadPool.QueueUserWorkItem(execute, i_task)\n    }\n    private void execute(Object o){\n        T task = (T)o;  //What happened to the type safety?  \n        executeTask(task);\n    }\n    private void executeTask(T i_task){\n        //process i_task\n    }\n}\n</code></pre>\n\n<p>Notice the type of the <code>state</code> parameter? It's <em><code>Object</code></em> !</p>\n\n<p>What's the compelling reason why the .NET team chose not to make the <code>QueueUserWorkItem</code> method (or the whole <code>ThreadPool</code> class) generic? I can't believe they just overlooked it.</p>\n\n<p>Here's how I'd like to see it:</p>\n\n<pre><code>//in the ThreadPool class:\npublic static bool QueueUserWorkItem&lt;T&gt; (\n    WaitCallback&lt;T&gt; callBack,\n    T state\n)\npublic delegate void WaitCallback&lt;T&gt; (T state)\n</code></pre>\n\n<p>This would make the worker class type-safe (and a lot clearer, IMHO):</p>\n\n<pre><code>public class Worker&lt;T&gt; {\n    public void schedule(T i_task) {\n        ThreadPool.QueueUserWorkItem&lt;T&gt;(execute, i_task)\n    }\n    private void execute(T i_task){\n        //process i_task\n    }\n}\n</code></pre>\n\n<p>I must be missing something.</p>\n"},{"tags":["c#","multithreading","threadpool"],"answer_count":8,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":3097,"score":7,"question_id":358721,"title":"be notified when all background threadpool threads are finished","body":"<p>I have a scenario when I start 3..10 threads with ThreadPool.\nEach thread does its job and returns to the ThreadPool.\nWhat are possible options to be notified in main thread when all background threads have finished?</p>\n\n<p>Currently I'm using a homegrown method with incrementing a variable for each of created threads and decrementing it when a background thread is about to finish.\nThis works just fine, but I was curious if there are better options.</p>\n\n<p>Thanks,\nValve.</p>\n"},{"tags":["java","multithreading","swing","swingutilities","invokelater"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13180909,"title":"Custom Modal Dialog","body":"<p>I am creating my own dialog which is basically a JPanel set as the glasspane on a JFrame. I want to make my dialog modal in the sense that all the code after the setVisible() is not executed while the dialog is visible and once the dialog is closed, the rest of the code after the setVisible() must continue.</p>\n\n<p>To achieve this I am using a thread to display my dialog. I know that the SwingUtilities.invokeLater() method must be used to update the gui because it is executed in another thread. However my dialog does not show on the screen.</p>\n\n<p>Here is my code example:</p>\n\n<pre><code>final JFrame frame = new JFrame();\nframe.setBounds(0, 0, 1024, 768);\nframe.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\nframe.getContentPane().setLayout(null);\n\nJButton button = new JButton(\"Text\");\nbutton.setBounds(200, 300, 110, 50);\nbutton.addActionListener(new ActionListener() {\n\n    boolean dispose;\n\n    public void actionPerformed(ActionEvent e) {\n        try {\n            Thread thread = new Thread(new Runnable() {\n                public void run() {\n                    final JPanel panelGlass = new JPanel(null);\n                    panelGlass.setBounds(frame.getBounds());\n                    panelGlass.setBackground(Color.red);\n                    frame.setGlassPane(panelGlass);\n\n                    JButton btnClose = new JButton(\"close\");\n                    btnClose.setBounds(100, 100, 110, 50);\n                    btnClose.addActionListener(new ActionListener() {\n                        public void actionPerformed(ActionEvent e) {\n                            dispose = true;\n                        }\n                    });\n                    panelGlass.add(btnClose);\n\n                    SwingUtilities.invokeLater(new Runnable() {\n                        public void run() {\n                            dispose = false;\n                            panelGlass.setVisible(true);\n                        }\n                    });\n\n                    while (!dispose) {\n                        try {\n                            Thread.sleep(100);\n                        } catch (InterruptedException ex) {\n                            Logger.getLogger(Main.class.getName()).log(Level.SEVERE, null, ex);\n                        }\n                    }\n                    panelGlass.setVisible(false);\n                }\n            });\n            thread.start();\n            thread.join();\n        } catch (Exception ex) {\n            Logger.getLogger(Main.class.getName()).log(Level.SEVERE, null, ex);\n        }\n    }\n});\nframe.getContentPane().add(button);\n\nframe.setVisible(true);\n</code></pre>\n\n<p>Why is my dialog not shown?</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":1984,"score":9,"question_id":1922290,"title":"Number of Threads in Java","body":"<p>How can i see the number of threads in a java process? </p>\n"},{"tags":["c","multithreading","homework","client-server"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":401,"score":4,"question_id":2888244,"title":"Need help with threads in a client/server","body":"<p>For college, I am developing a local relay chat. I have to program a chat server and client that will only work on sending messages on different terminal windows on the same computer with threads and fifos.</p>\n\n<p>The fifos part I am having no trouble, the threads part is the one that is giving me some headaches.</p>\n\n<p>The server has one thread for receiving commands from a fifo (used by all clients) and another thread for each client that is connected.</p>\n\n<p>For each client that is connected I need to know a certain information. Firstly, I was using global variables, which worked as longs as there was only one client connected, which is much of a chat, to chat alone. </p>\n\n<p>So, ideally I would have some data like:</p>\n\n<p>-nickname<br>\n-name<br>\n-email<br>\n-etc...  </p>\n\n<p>per client that is connected. However, I don't know how to do that.</p>\n\n<p>I could create a client_data[MAX_NUMBER_OF_THREADS] where client_data was a struct with everything I needed to have access to, but this would require to, in every communication between server and client to ask for the id of the client in the array client_data and that does not seem very pratical</p>\n\n<p>I could also instantiate a client_data immediately after creating the thread but it would only be available in that block, and that is not very pratical either.</p>\n\n<p>As you can see I am in need of a little guidance here. Any comment, piece of code or link to any relevant information is greatly appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c","multithreading","chat"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":388,"score":3,"question_id":8194853,"title":"chat server-client in C. using threads or processes?","body":"<p>First of all the environment I m working on is Windows 7 and Visual Studio 2010.</p>\n\n<p>I already wrote a server that uses select method to retrieves data from more than one client.</p>\n\n<p>Also I wrote and the client that connected to the server above, by running ( <code>client.exe localhost 4444 Peter</code>). \"Peter\" is the username that this user wants to use. </p>\n\n<p>Now lets say we have 2 users connected on the server. Each of them has the ability to run the command <code>/help</code>. This returns some other commands that user can use. One command of these is <code>/listusr</code> that returns the all the users on the server. </p>\n\n<p>One other command is the <code>/talk2</code> and here is where my problem-question begins. I want to let user choose to which of the other users want to talk. E.g if you want to talk to Peter you give <code>/talk2 Peter</code>.</p>\n\n<p>My question is how I'm gonna start something like this. How the server will send the message from me to the Peter (I have to add here that when a new user connected server saves his username and his socket number in a struct) ? </p>\n\n<p>I need to create new threads for each conversation  or new processes ? Can someone give me some hint or advice to continue my project ? I'm little confused on how to manage at this point .</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["multithreading","semaphore"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":37,"score":-2,"question_id":13189589,"title":"MutiThreading using Semaphore","body":"<p>I have the following program that should simulate a hotel check-in. The output the be as follow, or at least the wording should be like below:</p>\n\n<ol>\n<li>Guest 0 enters hotel with 1 bags</li>\n<li>Guest 1 enters hotel with 4 bags</li>\n<li>Guest 2 enters hotel with 3 bags </li>\n<li>Front desk employee 0 registers guest 0 and assigns room 1 </li>\n<li>Front desk employee 1 registers guest 1 and assigns room 2 </li>\n<li>Front desk employee 0 registers guest 2 and assigns room 3</li>\n<li>Guest 0 receives room key for room 1 from front desk employee 0</li>\n<li>Guest 1 receives room key for room 2 from front desk employee 1</li>\n<li>Guest 0 enters room 1 Guest 2 receives room key for room 3 from\nfront desk employee 0</li>\n<li>Guest 1 requests help with bags</li>\n<li>Guest 0 retires for the evening</li>\n<li>Guest 2 requests help with bags </li>\n<li>Bellhop 0 receives bags from guest 1</li>\n<li>Bellhop 1 receives bags from guest 2</li>\n<li>Guest 1 enters room 2</li>\n<li>Guest 2 enters room 3 </li>\n<li>Bellhop 0 delivers bags to guest 1 </li>\n<li>Bellhop 1 delivers bags to guest 2</li>\n<li>Guest 1 receives bags from bellhop 0 and gives tip</li>\n<li>Guest 2 receives bags from bellhop 1 and gives tip</li>\n<li>Guest 1 retires for the evening</li>\n<li>Guest 2 retires for the evening</li>\n<li><p>Simulation done</p>\n\n<p>import java.util.concurrent.*;\nimport java.util.Random;</p>\n\n<p>public class SleepingBarber extends Thread {</p>\n\n<p>/* PREREQUISITES */</p>\n\n<p>/* we create the semaphores. First there are no customers and \n   the barber is asleep so we call the constructor with parameter\n   0 thus creating semaphores with zero initial permits. \n   Semaphore(1) constructs a binary semaphore, as desired. */</p>\n\n<pre><code>public static Semaphore customers = new Semaphore(0);\npublic static Semaphore barber = new Semaphore(0);\npublic static Semaphore accessSeats = new Semaphore(1);\n public static Random rd = new Random();\n</code></pre>\n\n<p>/* we denote that the number of chairs in this barbershop is 5. */</p>\n\n<pre><code>public static final int CHAIRS = 5;\n</code></pre>\n\n<p>/* we create the integer numberOfFreeSeats so that the customers\n   can either sit on a free seat or leave the barbershop if there\n   are no seats available */</p>\n\n<p>public static int numberOfFreeSeats = CHAIRS;</p>\n\n<p>/* THE CUSTOMER THREAD */</p>\n\n<p>class Customer extends Thread {</p>\n\n<p>/* we create the integer iD which is a unique ID number for every customer\n     and a boolean notCut which is used in the Customer waiting loop */</p>\n\n<p>int iD;\n  int bG;\n  int fD;\n  boolean notCut=true;</p>\n\n<p>/* Constructor for the Customer */</p>\n\n<p>public Customer(int i, int b, int d) {\n    iD = i;\n     bG = b;\n     fD = d;\n  }</p>\n\n<p>public void run() {<br>\n    while (notCut) {  // as long as the customer is not cut \n      try {\n      accessSeats.acquire();  //tries to get access to the chairs\n      if (numberOfFreeSeats > 0) {  //if there are any free seats\n        System.out.println(\"Guest \" + this.iD + \" enter hotel with \"+this.bG+ \" bags\");\n        numberOfFreeSeats--;  //sitting down on a chair\n        customers.release();  //notify the barber that there is a customer\n        accessSeats.release();  // don't need to lock the chairs anymore<br>\n        try {\n    barber.acquire();  // now it's this customers turn but we have to wait if the barber is busy\n        notCut = false;  // this customer will now leave after the procedure\n        this.get_haircut();  //cutting...\n          //this.cutHair(this.iD);\n        } catch (InterruptedException ex) {}\n      }<br>\n      else  {  // there are no free seats\n        //System.out.println(\"There are no free seats. Customer \" + this.iD + \" has left the barbershop.\");\n        accessSeats.release();  //release the lock on the seats\n        notCut=false; // the customer will leave since there are no spots in the queue left.\n      }\n     }\n      catch (InterruptedException ex) {}\n    }\n  }</p>\n\n<p>/* this method will simulate getting a hair-cut */</p>\n\n<p>public void get_haircut(){\n    System.out.println(\"Guest \" + this.iD + \" recieve key for room \");\n    try {\n    sleep(5050);\n    } catch (InterruptedException ex) {}\n  }</p>\n\n<p>}</p>\n\n<p>/* THE BARBER THREAD */</p>\n\n<p>class Barber extends Thread {</p>\n\n<p>int fD; \n  public Barber(int a) {\n    fD = a;</p>\n\n<p>}</p>\n\n<p>public void run() {\n    while(true) {  // runs in an infinite loop\n      try {\n      customers.acquire(); // tries to acquire a customer - if none is available he goes to sleep\n      accessSeats.release(); // (room) at this time he has been awaken -> want to modify the number of available seats\n        numberOfFreeSeats++; // one chair gets free\n      barber.release();  // the barber is ready to cut\n      accessSeats.release(); // we don't need the lock on the chairs anymore\n        //System.out.println(\"Guest \"+ fD);\n      this.cutHair(this.fD);  //cutting...\n    } catch (InterruptedException ex) {}\n    }\n  }</p>\n\n<pre><code>/* this method will simulate cutting hair */\n</code></pre>\n\n<p>public void cutHair(int e){\n    System.out.println(\"Employee \" +e+\" register guest and assign room \" );\n    try {\n      sleep(5000);\n    } catch (InterruptedException ex){ }\n  }\n}       </p>\n\n<p>/* main method */</p>\n\n<p>public static void main(String args[]) {</p>\n\n<pre><code>SleepingBarber barberShop = new SleepingBarber();  //Creates a new barbershop\nbarberShop.start();  // Let the simulation begin\n</code></pre>\n\n<p>}</p>\n\n<p>public void run(){ </p>\n\n<p>for (int a = 1; a &lt; 3; a ++)\n  {\n   Barber giovanni = new Barber(a);  //Giovanni is the best barber ever \n   giovanni.start();  //Ready for another day of work</p>\n\n<p>/* This method will create new customers for a while */</p>\n\n<p>for (int i=1; i&lt; 25; i++) {\n     int x = rd.nextInt(6);\n     Customer aCustomer = new Customer(i, x, a);\n      aCustomer.start();</p>\n\n<pre><code> try {\n   sleep(2000);\n } catch(InterruptedException ex) {};\n</code></pre>\n\n<p>}  }\n    } \n}</p></li>\n</ol>\n\n<p>Any input would be greatly appreciated.</p>\n"},{"tags":["multithreading","haskell","parallel-processing"],"answer_count":1,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":200,"score":8,"question_id":13188747,"title":"Why is my program faster with one core not two core?","body":"<p>I'm currently trying to understand how to program in parallel in Haskell.  I'm following the paper \"A Tutorial on Parallel and Concurrent Programming in Haskell\" by Simon Peyton Jones and Satnam Singh.  The source code are as followed:</p>\n\n<pre><code>module Main where\nimport Control.Parallel\nimport System.Time\n\nmain :: IO ()\nmain = do\n      putStrLn \"Starting computation.....\"\n      t0 &lt;- getClockTime\n      pseq r1 (return())\n      t1 &lt;- getClockTime\n      putStrLn (\"sum: \" ++ show r1)\n      putStrLn (\"time: \" ++ show (secDiff t0 t1) ++ \" seconds\")\n      putStrLn \"Finish.\"\n\nr1 :: Int\nr1 = parSumFibEuler 38 5300\n\n-- This is the Fibonacci number generator\nfib :: Int -&gt; Int\nfib 0 = 0\nfib 1 = 1\nfib n = fib (n-1) + fib (n-2)\n\n-- Gets the euler sum\nmkList :: Int -&gt; [Int]\nmkList n = [1..n-1]\n\nrelprime :: Int -&gt; Int -&gt; Bool\nrelprime x y = gcd x y == 1\n\neuler :: Int -&gt; Int\neuler n = length $ filter (relprime n) (mkList n)\n\nsumEuler :: Int -&gt; Int\nsumEuler = sum.(map euler).mkList\n\n-- Gets the sum of Euler and Fibonacci (NORMAL)\nsumFibEuler :: Int -&gt; Int -&gt; Int\nsumFibEuler a b = fib a + sumEuler b\n\n-- Gets the sum of Euler and Fibonacci (PARALLEL)\nparSumFibEuler :: Int -&gt; Int -&gt; Int\nparSumFibEuler a b =\n  f `par` (e `pseq`(f+e))\n    where\n    f = fib a\n    e = sumEuler b\n\n-- Measure time\nsecDiff :: ClockTime -&gt; ClockTime -&gt; Float\nsecDiff (TOD secs1 psecs1) (TOD secs2 psecs2)\n  = fromInteger (psecs2 -psecs1) / 1e12 + fromInteger (secs2- secs1)\n</code></pre>\n\n<p>I compiled it with the following command:</p>\n\n<pre><code>ghc --make -threaded Main.hs\n</code></pre>\n\n<p>a) Ran it using 1 core:</p>\n\n<pre><code>./Main +RTS -N1\n</code></pre>\n\n<p>b) Ran it using 2 core:</p>\n\n<pre><code>./Main +RTS -N2\n</code></pre>\n\n<p>However, the one core ran 53.556sec.  Whereas, the two core ran 73.401sec.  I don't understand how 2 cores can actually run slower then 1 core.  Maybe the message passing overhead is too big for this small program?  The paper have completely different outcomes compared to mines.  Following are the output details.</p>\n\n<p>For 1 core:</p>\n\n<pre><code>Starting computation.....\nsum: 47625790\ntime: 53.556335 seconds\nFinish.\n  17,961,210,216 bytes allocated in the heap\n      12,595,880 bytes copied during GC\n         176,536 bytes maximum residency (3 sample(s))\n          23,904 bytes maximum slop\n               2 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     34389 colls,     0 par    2.54s    2.57s     0.0001s    0.0123s\n  Gen  1         3 colls,     0 par    0.00s    0.00s     0.0007s    0.0010s\n\n  Parallel GC work balance: -nan (0 / 0, ideal 1)\n\n                        MUT time (elapsed)       GC time  (elapsed)\n  Task  0 (worker) :    0.00s    (  0.00s)       0.00s    (  0.00s)\n  Task  1 (worker) :    0.00s    ( 53.56s)       0.00s    (  0.00s)\n  Task  2 (bound)  :   50.49s    ( 50.99s)       2.52s    (  2.57s)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time   50.47s  ( 50.99s elapsed)\n  GC      time    2.54s  (  2.57s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time   53.02s  ( 53.56s elapsed)\n\n  Alloc rate    355,810,305 bytes per MUT second\n\n  Productivity  95.2% of total user, 94.2% of total elapsed\n\ngc_alloc_block_sync: 0\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n\n<p>For 2 core:</p>\n\n<pre><code>Starting computation.....\nsum: 47625790\ntime: 73.401146 seconds\nFinish.\n  17,961,210,256 bytes allocated in the heap\n      12,558,088 bytes copied during GC\n         176,536 bytes maximum residency (3 sample(s))\n         195,936 bytes maximum slop\n               3 MB total memory in use (0 MB lost due to fragmentation)\n\n                                    Tot time (elapsed)  Avg pause  Max pause\n  Gen  0     34389 colls, 34388 par    7.42s    4.73s     0.0001s    0.0205s\n  Gen  1         3 colls,     3 par    0.01s    0.00s     0.0011s    0.0017s\n\n  Parallel GC work balance: 1.00 (1432193 / 1429197, ideal 2)\n\n                        MUT time (elapsed)       GC time  (elapsed)\n  Task  0 (worker) :    1.19s    ( 40.26s)      16.95s    ( 33.15s)\n  Task  1 (worker) :    0.00s    ( 73.40s)       0.00s    (  0.00s)\n  Task  2 (bound)  :   54.50s    ( 68.67s)       3.66s    (  4.73s)\n  Task  3 (worker) :    0.00s    ( 73.41s)       0.00s    (  0.00s)\n\n  SPARKS: 0 (0 converted, 0 overflowed, 0 dud, 0 GC'd, 0 fizzled)\n\n  INIT    time    0.00s  (  0.00s elapsed)\n  MUT     time   68.87s  ( 68.67s elapsed)\n  GC      time    7.43s  (  4.73s elapsed)\n  EXIT    time    0.00s  (  0.00s elapsed)\n  Total   time   76.31s  ( 73.41s elapsed)\n\n  Alloc rate    260,751,318 bytes per MUT second\n\n  Productivity  90.3% of total user, 93.8% of total elapsed\n\ngc_alloc_block_sync: 12254\nwhitehole_spin: 0\ngen[0].sync: 0\ngen[1].sync: 0\n</code></pre>\n"},{"tags":["objective-c","ios","multithreading","uitableviewcontroller","afnetworking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13023691,"title":"UITableViewController executes delate functions before network request finishes","body":"<p>I'm having trouble trying to populate a <code>UITableView</code> with the results of a network request. It seems that my code is alright as it works perfectly when my network is speedy, however, when it's not, the function \n<code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath-</code> still executes, which results in a bad access error. I presume that this is because the array that the aforesaid function attempts to utilize has not been populated. This brings me to my question: Is there anyway that I can have the <code>UITableView</code> delegate methods delayed to avoid this?</p>\n\n<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{\nstatic NSString *CellIdentifier = @\"AlbumsCell\";\n//UITableViewCell *basicCell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier forIndexPath:indexPath];\n\nAlbumsCell *cell = (AlbumsCell *)[tableView dequeueReusableCellWithIdentifier:CellIdentifier];\n\nif (!cell) {\n    **// Here is where the Thread 1: EXC_BAD_ACCESS (code=2 address=0x8)**\n    cell = [[[AlbumsCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];\n}\n\n    Album *album = [_albums objectAtIndex:[indexPath row]];\n    [cell setAlbum:album];\n\nreturn cell;\n}\n</code></pre>\n"},{"tags":["c++","multithreading","gcc","boost","boost-asio"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":84,"score":4,"question_id":13146433,"title":"boost:asio thread pool implementation for occasionally synchronized tasks","body":"<p>I have a \"main\" function that performs many small, independent tasks each once per time step. However, after each time step, I must wait for all of the tasks to complete before stepping forward.</p>\n\n<p>I want to make the program multithreaded. I have tried implementations with the boost-offshoot threadpool, and I've tried using a vector of (shared pointers to) threads, and I've tried the asio threadpool ideas (using an io_service, establishing some work, then distributing run to the threads and posting handlers to the io_service). </p>\n\n<p>All of these seem to have a lot of overhead creating and destroying threads for my \"many small tasks,\" and I want a way, preferably using the asio tools, to instantiate one io_service, one thread_group, posting handlers to the io_service, and waiting for a single time step's work to be finished before posting more tasks. Is there a good way to do this? Here's (stripped down) code for what I have working now:</p>\n\n<pre><code>boost::asio::io_service io_service;\nfor(int theTime = 0; theTime != totalTime; ++theTime)\n{\n    io_service.reset();\n    boost::thread_group threads;\n    // scoping to destroy the work object after work is finished being assigned\n    {\n        boost::asio::io_service::work work(io_service);\n        for (int i = 0; i &lt; maxNumThreads; ++i)\n        {\n            threads.create_thread(boost::bind(&amp;boost::asio::io_service::run,\n                &amp;io_service));\n        }\n\n        for(int i = 0; i &lt; numSmallTasks; ++i)\n        {\n            io_service.post(boost::bind(&amp;process_data, i, theTime));\n        }\n    }\n    threads.join_all(); \n}\n</code></pre>\n\n<p>Here's what I had rather have (but don't know how to implement):</p>\n\n<pre><code>boost::asio::io_service io_service;\nboost::thread_group threads;\nboost::asio::io_service::work work(io_service);\nfor (int i = 0; i &lt; maxNumThreads; ++i)\n{\n    threads.create_thread(boost::bind(&amp;boost::asio::io_service::run,\n         &amp;io_service));\n}\n\nfor(int theTime = 0; theTime != totalTime; ++theTime)\n{\n    for(int i = 0; i &lt; numSmallTasks; ++i)\n    {\n        io_service.post(boost::bind(&amp;process_data, i, theTime));\n    }\n    // wait here until all of these tasks are finished before looping \n    // **** how do I do this? *****\n}\n// destroy work later and join all threads later...\n</code></pre>\n"},{"tags":["c#","wpf","multithreading","gui","dispatcher"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1176,"score":2,"question_id":6180650,"title":"Getting UI dispatcher in class library","body":"<p>I'd like to design a class library and plan to use mutli-threading (i.e. <code>BackgroundWorker</code>). I will have to watch out for the thread context, from which updates are made for fields, if I plan to bind them to the GUI of the library consuming frontend. It's not a good idea to pass the reference of the GUI dispatcher to the library, as I read. But how can I get access to the dispatcher of the application that will use the library? Is this possible?</p>\n\n<p>I tried <code>Application.Current.Dispatcher</code> and added a reference to <code>WindowBase</code> (as I didn't have the possibility to add <code>System.Windows</code>), but still can't resolve the dispatcher object.</p>\n"},{"tags":["c++","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":13187679,"title":"Preventing variables from going out of scope so they persist for another thread","body":"<p>I have a function that creates a bunch of local variables, then passes their addresses to a function that runs in a separate thread - something like this: </p>\n\n<pre><code>void MyFunction()\n{\n    MyClass a;\n    AnotherClass b;\n    ...\n    FinalClass z;\n\n    CallFunctionInNewThread(&amp;a,&amp;b,&amp;c,...,&amp;z);\n}\n</code></pre>\n\n<p>Of course, these variables are destroyed when the MyFunction goes out of scope (so the function in a thread is now pointing to garbage), so this setup doesn't work. What are my options here? If I allocate the variables on the heap with 'new', I will never get a chance to delete them. If I make them smart pointers or similar, I'd have to make the threaded function accept them as smart pointers, or their reference count will not be increased so they will still get destroyed immediately. It seems like they kind of want to be member variables of a wrapper class of MyFunction, but there are a few hundred lines and tens of these things and that would just be crazy messy. Are there any other choices?</p>\n"},{"tags":["python","multithreading","class","inheritance","initialization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13187762,"title":"Python threading override init","body":"<p>I am using threading.py and I have the following code:    </p>\n\n<pre><code>import threading  \nclass MyClass(threading.Thread):  \n    def __init__(self,par1,par2):\n       threading.Thread.__init__(self)  \n       self.var1 = par1  \n       self.var2 = par2  \n    def run(self):\n       #do stuff with var1 and var2 while conditions are met\n... \n... \n... \nmyClassVar = MyClass(\"something\",0.0)\n</code></pre>\n\n<p>And I get the following error:  </p>\n\n<pre><code>18:48:08    57  S E myClassVar = MyClass(\"something\",0.0)  \n18:48:08    58  S E File \"C:\\Python24\\Lib\\threading.py\", line 378, in `__init__`  \n18:48:08    59  S E assert group is None, \"group argument must be None for now\"  \n18:48:08    60  S E AssertionError: group argument must be None for now  \n</code></pre>\n\n<p>I am kind of new using python, it is the first time I use threading...</p>\n\n<p>What is the bug here?</p>\n\n<p>Thank you,</p>\n\n<p>Jonathan</p>\n"},{"tags":["iphone","objective-c","ios","multithreading","ipad"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":235,"score":2,"question_id":7508246,"title":"How do i run a proccess without blocking user interface in my iphone app","body":"<p>I am accessing the photo library on the iphone and it takes a long time to import the pictures i select in my aplication, how do i run the process on a secondary thread , or what solution do i use to not block the user interface? </p>\n"},{"tags":["c++","multithreading","testing","pthreads","execution"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":74,"score":0,"question_id":13167318,"title":"How to verify if a pthread function began execution","body":"<p>Example:</p>\n\n<pre>\nvoid start(void)\n{\n   pthread_create(&threadID, Null, run_thread_function,arguments);\n\n   //is there a way to ensure if the run_thread_function(basically new thread) started   \n   //execution before returning from this(start) function    \n\n}\n</pre>\n"},{"tags":["c++","multithreading","boost","boost-asio"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":354,"score":2,"question_id":9057508,"title":"boost::io_service, threads and std::set","body":"<p>If there is something more difficult than debugging a multithreaded app that is trying to describe the bug itself.</p>\n\n<ul>\n<li>I have two boost::threads (application and display). </li>\n<li>Both use the same asio::io_service to do their work. \nThe display thread has a std::set of type window* which is a class I use to wrap winapi window management. </li>\n<li>I use a custom message queue to communicate these two threads. </li>\n<li>One of these messages (terminate) is used to notify the display thread that it must not \"post\" any more methods and that it must call thread_group.remove_thread and remove itself.</li>\n<li>The thread has a variable (state) that flags the state of the thread (running, paused, terminated). </li>\n<li>If it is running it \"posts\" it's update() method that iterates an std::set and calls the  update method in each window* it contains.</li>\n<li>If it is terminated, it clears the std::set, removes itself from the thread_group and doesn't post any more work.</li>\n</ul>\n\n<p>The problem: Once a while, when trying to close the app, the thread's update method gets ran after the thread got \"terminated\" and the std::set got cleared. Then the update method tries to iterate the std::set and a SIGSEGV takes place. This only happens 1 every 10 runs of the application and I'm having a hard time trying to guess what's wrong.</p>\n\n<p>I'll try to post the relevant code, if more is needed I'll try to add it.</p>\n\n<pre><code>int main(int argc, char **argv)\n{\n    boost::asio::io_service ios;\n    boost::asio::strand     strand(ios);\n    boost::thread_group     threads;\n    owl::system::pump       pump;\n\n    application app(&amp;threads, &amp;strand, &amp;pump);\n    owl::system::display display(&amp;strand, &amp;pump);\n\n    ios.run();\n    threads.join_all();\n\n    return 0;\n}\n...\nvoid display::on_terminate()\n{\n    close_all_windows();\n}\n...\nvoid display::close_all_windows()\n{\n    windows.move_first();\n    while (!windows.eof())\n    {\n        window* win = windows.value();\n        win-&gt;destroy();\n        delete win;\n        windows.move_next();\n    }\n    windows.clear();\n    check_no_window();\n}\n...\nvoid display::on_update()\n{\n    if (windows.size())\n    {\n        windows.move_first();\n        while (!windows.eof())\n        {\n            windows.value()-&gt;update();\n            windows.move_next(); // Here happens the SIGSEGV\n        }\n    }\n}\n</code></pre>\n\n<p>The class display inherits the class subsystem that manages thread execution. This is the relevant code involving the execution of on_update()</p>\n\n<pre><code>void subsystem::do_update()\n{\n    message* msg;\n\n    size_t message_count = messages.size();\n    for (size_t i=0; i&lt;message_count; i++)\n    {\n        msg = messages[i];\n        process_message(msg);\n        strand-&gt;dispatch(strand-&gt;wrap(boost::bind(&amp;message::deallocate, msg)));\n    }\n\n    switch (state)\n    {\n        case running:\n        {\n            on_update();\n        }\n        break;\n        case paused:\n        {\n            // Do not update. Just check the queue and sleep\n            sleep(10);\n        }\n        break;\n        case terminated:\n        {\n            do_terminate();\n            return;\n        }\n        break;\n    }\n        strand-&gt;post(strand-&gt;wrap(boost::bind(&amp;subsystem::check_for_messages, this)));\n}\n\nvoid subsystem::check_for_messages()\n{\n        messages.clear();\n    pump-&gt;get_messages(this, messages);\n    ios-&gt;post(boost::bind(&amp;subsystem::do_update, this));\n}\n</code></pre>\n\n<p>The SIGSEGV occurs exactly when trying to increment the std::set iterator.</p>\n\n<pre><code>Child process PID: 2272\nProgram received signal SIGSEGV, Segmentation fault.\nIn std::_Rb_tree_increment(std::_Rb_tree_node_base const*) ()\nstl_tree.h:269\n</code></pre>\n"},{"tags":["multithreading","boost","boost-asio","future"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13157502,"title":"How do you post a boost packaged_task to an io_service in C++03?","body":"<p>This is a follow-on from a previous question (<a href=\"http://stackoverflow.com/questions/13146433/boostasio-thread-pool-implementation-for-occasionally-synchronized-tasks\" title=\"here\">here</a>), but I'm working on a multithreaded application and I would like to post a Boost packaged_task to a threaded io_service. I'm stuck using a C++03 compiler (so std::move is out), and the packaged_task is not copyable. I've tried wrapping it in a shared_ptr and passing that, and a lot of other things. Here is my current attempt and the subsequent compiler errors. Any idea how to get this to work?</p>\n\n<pre><code>boost::asio::io_service io_service;\nboost::thread_group threads;\nboost::asio::io_service::work work(io_service);\nfor (int i = 0; i &lt; maxNumThreads; ++i)\n{\n    threads.create_thread(boost::bind(&amp;boost::asio::io_service::run,\n        &amp;io_service));\n}\nstd::vector&lt;boost::shared_future&lt;bool&gt; &gt; pending_data; // vector of futures\n\nbool process_data(int,int){...}\n...\n\nfor(int theTime = 0; theTime != totalScenarioTime; ++theTime)\n{\n    for(int i = 0; i &lt; numSmallTasks; ++i)\n    {\n        boost::packaged_task&lt;bool&gt; task(boost::bind(&amp;process_data,i,theTime));\n        boost::shared_future&lt;bool&gt; fut(task.get_future());\n        pending_data.push_back(fut); // C++11 possible: (std::move(fut) when fut is a unique_future);\n        io_service.post(task); // C++11 possible: (std::move(task));    \n    }\n    // After loop - wait until all futures are evaluated\n    boost::wait_for_all(pending_data.begin(), pending_data.end()); \n    pending_data.clear();\n}\n</code></pre>\n\n<p>This results in:</p>\n\n<pre><code>In file included from ../boostlibs/boost/asio/io_service.hpp:767:0,\n             from ../boostlibs/boost/asio/basic_io_object.hpp:19,\n             from ../boostlibs/boost/asio/basic_socket.hpp:19,\n             from ../boostlibs/boost/asio/basic_datagram_socket.hpp:20,\n             from ../boostlibs/boost/asio.hpp:20,\n             from ../main.cpp:13:\n../boostlibs/boost/asio/impl/io_service.hpp: In member function ‘void boost::asio::io_service::post(const CompletionHandler&amp;) [with CompletionHandler = boost::packaged_task&lt;bool&gt;]’:\n../main.cpp:256:23:   instantiated from here\n../boostlibs/boost/asio/impl/io_service.hpp:95:67: error: no matching function for call to ‘boost::packaged_task&lt;bool&gt;::packaged_task(const boost::packaged_task&lt;bool&gt;&amp;)’\n../boostlibs/boost/asio/impl/io_service.hpp:95:67: note: candidates are:\n../boostlibs/boost/thread/future.hpp:1372:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::detail::thread_move_t&lt;boost::packaged_task&lt;R&gt; &gt;) [with R = bool]\n../boostlibs/boost/thread/future.hpp:1372:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::detail::thread_move_t&lt;boost::packaged_task&lt;bool&gt; &gt;’\n../boostlibs/boost/thread/future.hpp:1318:9: note: boost::packaged_task&lt;R&gt;::packaged_task() [with R = bool]\n../boostlibs/boost/thread/future.hpp:1318:9: note:   candidate expects 0 arguments, 1 provided\n../boostlibs/boost/thread/future.hpp:1314:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::packaged_task&lt;R&gt;&amp;) [with R = bool, boost::packaged_task&lt;R&gt; = boost::packaged_task&lt;bool&gt;]\n../boostlibs/boost/thread/future.hpp:1314:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::packaged_task&lt;bool&gt;&amp;’\n../boostlibs/boost/asio/detail/handler_type_requirements.hpp:95:26: error:   initializing argument 1 of ‘T&amp; boost::asio::detail::lvref(T) [with T = boost::packaged_task&lt;bool&gt;]’\n../boostlibs/boost/asio/impl/io_service.hpp:95:67: error: no matching function for call to ‘boost::packaged_task&lt;bool&gt;::packaged_task(const boost::packaged_task&lt;bool&gt;&amp;)’\n../boostlibs/boost/asio/impl/io_service.hpp:95:67: note: candidates are:\n../boostlibs/boost/thread/future.hpp:1372:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::detail::thread_move_t&lt;boost::packaged_task&lt;R&gt; &gt;) [with R = bool]\n../boostlibs/boost/thread/future.hpp:1372:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::detail::thread_move_t&lt;boost::packaged_task&lt;bool&gt; &gt;’\n../boostlibs/boost/thread/future.hpp:1318:9: note: boost::packaged_task&lt;R&gt;::packaged_task() [with R = bool]\n../boostlibs/boost/thread/future.hpp:1318:9: note:   candidate expects 0 arguments, 1 provided\n../boostlibs/boost/thread/future.hpp:1314:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::packaged_task&lt;R&gt;&amp;) [with R = bool, boost::packaged_task&lt;R&gt; = boost::packaged_task&lt;bool&gt;]\n../boostlibs/boost/thread/future.hpp:1314:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::packaged_task&lt;bool&gt;&amp;’\n../boostlibs/boost/asio/detail/handler_type_requirements.hpp:96:32: error:   initializing argument 1 of ‘const T&amp; boost::asio::detail::clvref(T) [with T = boost::packaged_task&lt;bool&gt;]’\n../boostlibs/boost/asio/impl/io_service.hpp:97:3: error: no matching function for call to ‘boost::packaged_task&lt;bool&gt;::packaged_task(const boost::packaged_task&lt;bool&gt;&amp;)’\n../boostlibs/boost/asio/impl/io_service.hpp:97:3: note: candidates are:\n../boostlibs/boost/thread/future.hpp:1372:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::detail::thread_move_t&lt;boost::packaged_task&lt;R&gt; &gt;) [with R = bool]\n../boostlibs/boost/thread/future.hpp:1372:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::detail::thread_move_t&lt;boost::packaged_task&lt;bool&gt; &gt;’\n../boostlibs/boost/thread/future.hpp:1318:9: note: boost::packaged_task&lt;R&gt;::packaged_task() [with R = bool]\n../boostlibs/boost/thread/future.hpp:1318:9: note:   candidate expects 0 arguments, 1 provided\n../boostlibs/boost/thread/future.hpp:1314:9: note: boost::packaged_task&lt;R&gt;::packaged_task(boost::packaged_task&lt;R&gt;&amp;) [with R = bool, boost::packaged_task&lt;R&gt; = boost::packaged_task&lt;bool&gt;]\n../boostlibs/boost/thread/future.hpp:1314:9: note:   no known conversion for argument 1 from ‘const boost::packaged_task&lt;bool&gt;’ to ‘boost::packaged_task&lt;bool&gt;&amp;’\n../boostlibs/boost/asio/detail/impl/task_io_service.hpp:54:6: error:   initializing argument 1 of ‘void boost::asio::detail::task_io_service::post(Handler) [with Handler = boost::packaged_task&lt;bool&gt;]’\n</code></pre>\n\n<p>Using boost::move(task) results in the two errors:</p>\n\n<pre><code>error: no match for call to ‘(boost::detail::thread_move_t&lt;boost::packaged_task&lt;bool&gt; &gt;) ()’\nerror: no match for call to ‘(boost::detail::thread_move_t&lt;boost::packaged_task&lt;bool&gt; &gt;) ()’\n</code></pre>\n"},{"tags":["multithreading","qt","qt4"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13184555,"title":"Creating a QWidget in a non-GUI thread","body":"<p>Yes, I know that you cannot use GUI things from non-GUI threads. However, it seems reasonable to be able to create a QWidget object, send it to the GUI thread, and then send signals to it. However, when I try to do so, I get errors that widgets cannot be moved. However, this seems to works:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n#include &lt;QApplication&gt;\n#include &lt;QtConcurrentRun&gt;\n#include &lt;QDialog&gt;\n\nclass BasicViewer : public QDialog\n{\nQ_OBJECT\n\npublic:\n  void Function(const float a)\n  {\n    std::cout &lt;&lt; a &lt;&lt; std::endl;\n  }\n};\n\nstruct BasicViewerWrapper : public QObject\n{\nQ_OBJECT\npublic:\n  BasicViewer WrappedBasicViewer;\n\n  void Function(const float a)\n  {\n    WrappedBasicViewer.Function(a);\n  }\n};\n\n#include \"main.moc\" // For CMake's automoc\n\nvoid Function2()\n{\n  BasicViewerWrapper basicViewerWrapper;\n  basicViewerWrapper.moveToThread(QCoreApplication::instance()-&gt;thread());\n\n  basicViewerWrapper.Function(2.0f);\n}\n\nvoid Function1()\n{\n  Function2();\n}\n\nint main(int argc, char *argv[])\n{\n  QApplication app(argc, argv);\n\n  QtConcurrent::run(Function1);\n\n  std::cout &lt;&lt; \"End\" &lt;&lt; std::endl;\n  return app.exec();\n}\n</code></pre>\n\n<p>I have created a wrapper class with the same API as the QWidget that stores an instance of the QWidget I wanted to create directly. I AM allowed to create that wrapper, move it to the GUI thread, and then use it. My question is, is there a way to do this without having to write this wrapper? It seems quite tedious, and since the concept works, I don't understand why it cannot be done directly. Any thoughts?</p>\n\n<p>----------- EDIT ---------------</p>\n\n<p>The first example was a bad one, because it did not attempt to do anything with GUI elements. This example indeed generates \"Cannot create children for a parent that is in a different thread.\"</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n#include &lt;QApplication&gt;\n#include &lt;QtConcurrentRun&gt;\n#include &lt;QMessageBox&gt;\n\nclass BasicViewer : public QMessageBox\n{\nQ_OBJECT\n\npublic:\n\n};\n\nstruct BasicViewerWrapper : public QObject\n{\nQ_OBJECT\npublic:\n  BasicViewer WrappedBasicViewer;\n\n  void exec()\n  {\n    WrappedBasicViewer.exec();\n  }\n};\n\n#include \"main.moc\" // For CMake's automoc\n\nvoid Function2()\n{\n  BasicViewerWrapper basicViewerWrapper;\n  basicViewerWrapper.moveToThread(QCoreApplication::instance()-&gt;thread());\n  basicViewerWrapper.exec();\n}\n\nvoid Function1()\n{\n  Function2();\n}\n\nint main(int argc, char *argv[])\n{\n  QApplication app(argc, argv);\n\n  QtConcurrent::run(Function1);\n\n  return app.exec();\n}\n</code></pre>\n\n<p>----------- EDIT 2 ----------------</p>\n\n<p>I thought this would work, since the member object gets created after the thread of the Wrapper has been moved:</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n#include &lt;QApplication&gt;\n#include &lt;QtConcurrentRun&gt;\n#include &lt;QMessageBox&gt;\n\nclass BasicViewer : public QMessageBox\n{\nQ_OBJECT\n\npublic:\n\n};\n\nstruct BasicViewerWrapper : public QObject\n{\nQ_OBJECT\npublic:\n  BasicViewer* WrappedBasicViewer;\n\n  void exec()\n  {\n    WrappedBasicViewer-&gt;exec();\n  }\n\n  void create()\n  {\n    WrappedBasicViewer = new BasicViewer;\n  }\n};\n\n#include \"main.moc\" // For CMake's automoc\n\nvoid Function2()\n{\n  BasicViewerWrapper basicViewerWrapper;\n  basicViewerWrapper.moveToThread(QCoreApplication::instance()-&gt;thread());\n  basicViewerWrapper.create();\n  basicViewerWrapper.exec();\n}\n\nvoid Function1()\n{\n  Function2();\n}\n\nint main(int argc, char *argv[])\n{\n  QApplication app(argc, argv);\n\n  QtConcurrent::run(Function1);\n\n  return app.exec();\n}\n</code></pre>\n\n<p>Unfortunately, it does not. Can anyone explain why?</p>\n\n<p>--------------- EDIT 3 --------------------</p>\n\n<p>I'm unsure why this works? It uses a signal to trigger the GUI component, but isn't the GUI object (the QDialog) still created in the non-GUI thread?</p>\n\n<pre><code>#include &lt;iostream&gt;\n\n#include &lt;QApplication&gt;\n#include &lt;QtConcurrentRun&gt;\n#include &lt;QMessageBox&gt;\n\nclass DialogHandler : public QObject\n{\nQ_OBJECT\n\nsignals:\n  void MySignal(int* returnValue);\n\npublic:\n  DialogHandler()\n  {\n    connect( this, SIGNAL( MySignal(int*) ), this, SLOT(MySlot(int*)), Qt::BlockingQueuedConnection );\n  }\n\n  void EmitSignal(int* returnValue)\n  {\n    emit MySignal(returnValue);\n  }\n\npublic slots:\n  void MySlot(int* returnValue)\n  {\n    std::cout &lt;&lt; \"input: \" &lt;&lt; *returnValue &lt;&lt; std::endl;\n    QMessageBox* dialog = new QMessageBox;\n    dialog-&gt;addButton(QMessageBox::Yes);\n    dialog-&gt;addButton(QMessageBox::No);\n    dialog-&gt;setText(\"Test Text\");\n    dialog-&gt;exec();\n    int result = dialog-&gt;result();\n    if(result == QMessageBox::Yes)\n    {\n      *returnValue = 1;\n    }\n    else\n    {\n      *returnValue = 0;\n    }\n\n    delete dialog;\n  }\n};\n\n#include \"main.moc\" // For CMake's automoc\n\nvoid MyFunction()\n{\n  DialogHandler* dialogHandler = new DialogHandler;\n  dialogHandler-&gt;moveToThread(QCoreApplication::instance()-&gt;thread());\n\n  int returnValue = -1;\n  dialogHandler-&gt;EmitSignal(&amp;returnValue);\n\n  std::cout &lt;&lt; \"returnValue: \" &lt;&lt; returnValue &lt;&lt; std::endl;\n}\n\nint main(int argc, char *argv[])\n{\n  QApplication app(argc, argv);\n\n  QtConcurrent::run(MyFunction);\n\n  std::cout &lt;&lt; \"End\" &lt;&lt; std::endl;\n  return app.exec();\n}\n</code></pre>\n"},{"tags":["iphone","objective-c","ios","multithreading","osx"],"answer_count":1,"favorite_count":6,"up_vote_count":3,"down_vote_count":0,"view_count":1289,"score":3,"question_id":7290931,"title":"GCD, Threads, Program Flow and UI Updating","body":"<p>I'm having a hard time figuring out how to put this all together.\nI have a puzzle solving app on the mac.\nYou enter the puzzle, press a button, and while it's trying to find the number of solutions,\nmin moves and such I would like to keep the UI updated.\nThen once it's finished calculating, re-enable the button and change the title.</p>\n\n<p>Below is some sample code from the button selector, and the solving function:\n( Please keep in mind I copy/paste from Xcode so there might be some missing {} or\nsome other typos.. but it should give you an idea what I'm trying to do.</p>\n\n<p>Basicly, user presses a button, that button is ENABLED=NO, Function called to calculate puzzle.  While it's calculating, keep the UI Labels updated with moves/solution data.\nThen once it's finished calculating the puzzle, Button is ENABLED=YES;</p>\n\n<p>Called when button is pressed:</p>\n\n<pre><code>- (void) solvePuzzle:(id)sender{\n    solveButton.enabled = NO;\n    solveButton.title = @\"Working . . . .\";\n\n    // I've tried using this as a Background thread, but I can't get the code to waitTilDone before continuing and changing the button state.\n    [self performSelectorInBackground:@selector(createTreeFromNode:) withObject:rootNode];\n\n    // I've tried to use GCD but similar issue and can't get UI updated.\n    //dispatch_queue_t queue = dispatch_queue_create(\"com.gamesbychris.createTree\", 0);\n    //dispatch_sync(queue, ^{[self createTreeFromNode:rootNode];});\n\n    }\n\n    // Need to wait here until createTreeFromNode is finished.\n    solveButton.enabled=YES;\n    if (numSolutions == 0) {\n    solveButton.title = @\"Not Solvable\";\n    } else {\n        solveButton.title = @\"Solve Puzzle\";\n    }\n}\n</code></pre>\n\n<p>Needs to run in background so UI can be updated:</p>\n\n<pre><code>-(void)createTreeFromNode:(TreeNode *)node\n{\n   // Tried using GCD\n   dispatch_queue_t main_queue = dispatch_get_main_queue();\n\n ...Create Tree Node and find Children Code...\n\nif (!solutionFound){\n    // Solution not found yet so check other children by recursion.\n   [self createTreeFromNode:newChild];\n   } else {\n   // Solution found.\n   numSolutions ++;\n   if (maxMoves &lt; newChild.numberOfMoves) {\n       maxMoves = newChild.numberOfMoves;\n    }\n    if (minMoves &lt; 1 || minMoves &gt; newChild.numberOfMoves) {\n        solutionNode = newChild;\n        minMoves = newChild.numberOfMoves;\n\n        // Update UI on main Thread\n\n        dispatch_async(main_queue, ^{\n                        minMovesLabel.stringValue = [NSString stringWithFormat:@\"%d\",minMoves];\n                        numSolutionsLabel.stringValue = [NSString stringWithFormat:@\"%d\",numSolutions];\n                        maxMovesLabel.stringValue = [NSString stringWithFormat:@\"%d\",maxMoves];\n                    });\n                }                        \n</code></pre>\n"},{"tags":["java","multithreading","awt","sleep","event-dispatch-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13185462,"title":"Border formatting not updating before thread.sleep()","body":"<p>Hope my first question isn't too obvious or badly researched. The below code is from the MouseListener's mouseClicked event. I was hoping to change the border color to green to show the user what he/she has clicked on, start the sleep timer and then change it back to black. Unfortunately, the change only takes place after the Thread.sleep (and probably a whole host of methods). Currently the change back to black is commented and the color change does change to green (permanently). If it isn't commented, there is no visible color change. What is going on here?</p>\n\n<p>Thanks</p>\n\n<pre><code>    JLabel myLabel = (JLabel) e.getSource();\n    myLabel.setBorder(BorderFactory.createLineBorder(Color.green));\n\n    try {\n        Thread.sleep(2000);\n    } catch (InterruptedException e1) {\n        // TODO Auto-generated catch block\n        e1.printStackTrace();\n    }\n\n    //myLabel.setBorder(BorderFactory.createLineBorder(Color.black));\n</code></pre>\n"},{"tags":["c++","multithreading","variables","dll","modify"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":50,"score":0,"question_id":13184665,"title":"C++ How to make a dll modify a variable from main thread?","body":"<p>I currently have a dll which helps me with some operations, and i would like that my dll can modify a variable of the main thread. Do I somehow send the class(the variable has a typename of a class) to the dll, should i also make the dll include the file where the class is defined(.h file).</p>\n\n<p>So basically, how can i make a dll modify a variable from another thread(In this case, the main thread)?</p>\n\n<p>Edit:</p>\n\n<p>The variable i want to change is like this:</p>\n\n<p>Group&lt; UMesh > InstancedMesh</p>\n\n<p>Group is a template class and UMesh is another class.</p>\n"},{"tags":["c#",".net","wpf","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13185184,"title":"Task.Wait vs Task.RunSyncronously where task has call to WPF Dispatcher.Invoke","body":"<p>I have a <code>Task</code> that I am starting and wish to wait for completion in a WPF app. Inside this task I invoke an <code>Action</code> on the dispatcher.</p>\n\n<p>If I use <code>Task.Wait()</code> it appears to hang as if the method never finished. Also, breakpoints inside the Dispatcher.Invoke are never hit.</p>\n\n<p>If I use <code>Task.RunSyncronously()</code> it appears to work correctly and breakpoints inside the Dispatcher are hit.</p>\n\n<p>Why is there a difference?</p>\n\n<p>Code sample below:</p>\n\n<pre><code>Task task = new Task(LoadStuff);\n\n    // never returns\n    task.Start();\n    task.Wait();\n\n    // vs\n\n    // works\n    task.RunSyncronously()\n\n\nprivate void LoadStuff()\n{\n    ObservableCollection&lt;StuffObj&gt; stuff = Stuff.Load(arg1, true);\n\n    DispatchHelper.RunOnDispatcher(() =&gt;\n    {\n        ...\n    });\n}\n\npublic static class DispatchHelper\n{\n    public static void RunOnDispatcher(Action action)\n    {\n        Application.Current.Dispatcher.Invoke(action);\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","winforms","multithreading","animation"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":90,"score":3,"question_id":13160571,"title":"building smooth animation in C#","body":"<p>First here's the code.</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\n\nnamespace winform_project\n{\n  public partial class Form1 : Form\n  {\n    void movement_correct(PictureBox pic, int i)\n    {\n        System.Threading.Thread.Sleep(25);\n        pic.Top += (i - 1);\n        pic.Left += (i + 3);\n    }\n\n    void movement_up(PictureBox pic, int i)\n    {\n        System.Threading.Thread.Sleep(25);\n        pic.Top -= (i - 1);\n        pic.Left -= (i + 3);\n    }\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        for (int i = 0; i &lt; 5; i++)\n        {\n            movement_correct(pictureBox1, i);\n            movement_correct(pictureBox2, i);\n            movement_correct(pictureBox3, i);\n            movement_correct(pictureBox4, i);\n            movement_correct(pictureBox5, i);\n            movement_correct(pictureBox6, i);\n            movement_correct(pictureBox7, i);\n            movement_correct(pictureBox8, i);\n            movement_correct(pictureBox9, i);\n            movement_correct(pictureBox10, i);\n        }\n\n        for (int i = 0; i &lt; 5; i++)\n        {\n            movement_up(pictureBox1, i);\n            movement_up(pictureBox2, i);\n            movement_up(pictureBox3, i);\n            movement_up(pictureBox4, i);\n            movement_up(pictureBox5, i);\n            movement_up(pictureBox6, i);\n            movement_up(pictureBox7, i);\n            movement_up(pictureBox8, i);\n            movement_up(pictureBox9, i);\n            movement_up(pictureBox10, i);\n        }\n\n    }\n }\n}\n</code></pre>\n\n<p>There are 10 dummy picture boxes. Whenever i click the button they start to move a bit(sort of like the enemies in space invaders).</p>\n\n<p>I am trying to make a smooth animation in winforms. The problem is that the animation in not as smooth as i want it to be. In my code all the boxes aren't moving simultaneously, there is a little bit of noticeable gap in their movement. What i want is smooth movement.</p>\n\n<p>I was thinking of multi threading it but then realized it would mean one thead for each objects. Is there any other way(Within winforms).</p>\n\n<p>Thanks for the help.</p>\n"},{"tags":["iphone","ios","multithreading","xcode","grand-central-dispatch"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2527,"score":3,"question_id":6928752,"title":"How to stop the execution of tasks in a dispatch queue?","body":"<p>If I have a serial queue, how can I, from the main thread, tell it to immediately stop execution and cancel all of its tasks?</p>\n"},{"tags":["c#","wpf","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13160140,"title":"Event in the wrong thread?","body":"<p>I have a question about threading.</p>\n\n<p>I have a WPF application, that should show the status of some queries. For this I have created a class, that runs multiple queries in multiple thread (backgroundworker). I've also created an event, so I can react while the queries are running.</p>\n\n<pre><code>    private void cmdStart(object sender, RoutedEventArgs e)\n    {\n        QuerySetup qs = new QuerySetup();\n        //Filling qs with some data\n        //...\n        SqlProxy sql = new SqlProxy();\n        sql.QueryCompleted += new SqlProxy.QueryCompletedEventHandler(sql_QueryCompleted);\n\n        //Starts the backgroundworker\n        sql.RunSQL(qs);\n    }\n\n    private void sql_QueryCompleted(QueryResult qr)\n    {\n        lstStatus.Items.Clear();\n        lstStatus.Items.Add(qr.RuntimeTotal);\n        //... and some more...\n    }\n</code></pre>\n\n<p>Now I get an error message that tells me, that I can't access lstStatus because it's owned by a different thread. </p>\n\n<p>But why? Shouldn't the event be in the same thread as the GUI? How can I solve my problem?</p>\n"},{"tags":["java","multithreading","performance"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":1381,"score":2,"question_id":5538847,"title":"Multi threaded game - updating, rendering, and how to split them","body":"<p>So, I'm working on a game engine, and I've made pretty good progress. However, my engine is single-threaded, and the advantages of splitting updating and rendering into separate threads sounds like a very good idea.</p>\n\n<p>How should I do this? Single threaded game engines are (conceptually) very easy to make, you have a loop where you update -> render -> sleep -> repeat. However, I can't think of a good way to break updating and rendering apart, especially if I change their update rates (say I go through the update loop 25x a second, and have 60fps for rendering) - what if I begin updating halfway through a render loop, or vice versa?</p>\n"},{"tags":["java","multithreading","file","http"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13184005,"title":"Process Large File for HTTP Calls in Java","body":"<p>I have a file with millions of lines in it that I need to process.  Each line of the file will result in an HTTP call.  I'm trying to figure out the best way to attack the problem.</p>\n\n<p>I obviously could just read the file and make the calls sequentially, but it would be incredibly slow.  I'd like to parallelize the calls, but I'm not sure if I should read the entire file into memory (something I'm not a huge fan of) or try to parallelize the reading of the file as well (which I'm not sure would make sense).</p>\n\n<p>Just looking for some thoughts here on the best way to attack the problem.  If there is an existing framework or library that does something similar I'm happy to use that as well.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","multithreading","performance","c#-4.0","parallel-processing"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":84,"score":4,"question_id":13176529,"title":"Parallel GZip Decompression of Log Files - Tweaking MaxDegreeOfParallelism for the Highest Throughput","body":"<p>We have up to 30 GB of GZipped log files per day. Each file holds 100.000 lines and is between 6 and 8 MB when compressed. The simplified code in which the parsing logic has been stripped out, utilises the Parallel.ForEach loop. </p>\n\n<p>The maximum number of lines processed peaks at MaxDegreeOfParallelism of 8 on the two-NUMA node, 32 logical CPU box (Intel Xeon E7-2820 @ 2 GHz):</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>using System;\n\nusing System.Collections.Concurrent;\n\nusing System.Linq;\nusing System.IO;\nusing System.IO.Compression;\n\nusing System.Threading.Tasks;\n\nnamespace ParallelLineCount\n{\n    public class ScriptMain\n    {\n        static void Main(String[] args)\n        {\n            int    maxMaxDOP      = (args.Length &gt; 0) ? Convert.ToInt16(args[0]) : 2;\n            string fileLocation   = (args.Length &gt; 1) ? args[1] : \"C:\\\\Temp\\\\SomeFiles\" ;\n            string filePattern    = (args.Length &gt; 1) ? args[2] : \"*2012-10-30.*.gz\";\n            string fileNamePrefix = (args.Length &gt; 1) ? args[3] : \"LineCounts\";\n\n            Console.WriteLine(\"Start:                 {0}\", DateTime.UtcNow.ToString(\"yyyy-MM-ddTHH:mm:ss.fffffffZ\"));\n            Console.WriteLine(\"Processing file(s):    {0}\", filePattern);\n            Console.WriteLine(\"Max MaxDOP to be used: {0}\", maxMaxDOP.ToString());\n            Console.WriteLine(\"\");\n\n            Console.WriteLine(\"MaxDOP,FilesProcessed,ProcessingTime[ms],BytesProcessed,LinesRead,SomeBookLines,LinesPer[ms],BytesPer[ms]\");\n\n            for (int maxDOP = 1; maxDOP &lt;= maxMaxDOP; maxDOP++)\n            {\n\n                // Construct ConcurrentStacks for resulting strings and counters\n                ConcurrentStack&lt;Int64&gt; TotalLines = new ConcurrentStack&lt;Int64&gt;();\n                ConcurrentStack&lt;Int64&gt; TotalSomeBookLines = new ConcurrentStack&lt;Int64&gt;();\n                ConcurrentStack&lt;Int64&gt; TotalLength = new ConcurrentStack&lt;Int64&gt;();\n                ConcurrentStack&lt;int&gt;   TotalFiles = new ConcurrentStack&lt;int&gt;();\n\n                DateTime FullStartTime = DateTime.Now;\n\n                string[] files = System.IO.Directory.GetFiles(fileLocation, filePattern);\n\n                var options = new ParallelOptions() { MaxDegreeOfParallelism = maxDOP };\n\n                //  Method signature: Parallel.ForEach(IEnumerable&lt;TSource&gt; source, Action&lt;TSource&gt; body)\n                Parallel.ForEach(files, options, currentFile =&gt;\n                    {\n                        string filename = System.IO.Path.GetFileName(currentFile);\n                        DateTime fileStartTime = DateTime.Now;\n\n                        using (FileStream inFile = File.Open(fileLocation + \"\\\\\" + filename, FileMode.Open))\n                        {\n                            Int64 lines = 0, someBookLines = 0, length = 0;\n                            String line = \"\";\n\n                            using (var reader = new StreamReader(new GZipStream(inFile, CompressionMode.Decompress)))\n                            {\n                                while (!reader.EndOfStream)\n                                {\n                                    line = reader.ReadLine();\n                                    lines++; // total lines\n                                    length += line.Length;  // total line length\n\n                                    if (line.Contains(\"book\")) someBookLines++; // some special lines that need to be parsed later\n                                }\n\n                                TotalLines.Push(lines); TotalSomeBookLines.Push(someBookLines); TotalLength.Push(length);\n                                TotalFiles.Push(1); // silly way to count processed files :)\n                            }\n                        }\n                    }\n                );\n\n                TimeSpan runningTime = DateTime.Now - FullStartTime;\n\n                // Console.WriteLine(\"MaxDOP,FilesProcessed,ProcessingTime[ms],BytesProcessed,LinesRead,SomeBookLines,LinesPer[ms],BytesPer[ms]\");\n                Console.WriteLine(\"{0},{1},{2},{3},{4},{5},{6},{7}\",\n                    maxDOP.ToString(),\n                    TotalFiles.Sum().ToString(),\n                    Convert.ToInt32(runningTime.TotalMilliseconds).ToString(),\n                    TotalLength.Sum().ToString(),\n                    TotalLines.Sum(),\n                    TotalSomeBookLines.Sum().ToString(),\n                    Convert.ToInt64(TotalLines.Sum() / runningTime.TotalMilliseconds).ToString(),\n                    Convert.ToInt64(TotalLength.Sum() / runningTime.TotalMilliseconds).ToString());\n\n            }\n            Console.WriteLine();\n            Console.WriteLine(\"Finish:                \" + DateTime.UtcNow.ToString(\"yyyy-MM-ddTHH:mm:ss.fffffffZ\"));\n        }\n    }\n}\n</code></pre>\n\n<p>Here's a summary of the results, with a clear peak at MaxDegreeOfParallelism = 8:</p>\n\n<p><img src=\"http://i.stack.imgur.com/VvFz1.png\" alt=\"enter image description here\"></p>\n\n<p>The CPU load (shown aggregated here, most of the load was on a single NUMA node, even when DOP was in 20 to 30 range):</p>\n\n<p><img src=\"http://i.stack.imgur.com/hZoUW.png\" alt=\"enter image description here\"></p>\n\n<p>The only way I've found to make CPU load cross 95% mark was to split the files across 4 different folders and execute the same command 4 times, each one targeting a subset of all files.</p>\n\n<p>Can someone find a bottleneck?</p>\n"},{"tags":["java","multithreading","jersey","jax-rs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13169065,"title":"Jax-rs / Jersey inter-thread communication","body":"<p>Is there a way to make the handling threads in Jax-rs / Jersey communicate between them?\nIf so, what would be the best way?</p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13181135,"title":"Threading problems","body":"<p>Here's the code I have:</p>\n\n<pre><code>import threading, subprocess, shlex\n\nclass Prog1(threading.Thread):\n    def __init__(self, arg=''):\n        self.arg = arg\n        threading.Thread.__init__(self)\n\n    def run(self):\n        global p1\n        p1 = subprocess.Popen(shlex.split(self.arg))\n\n\nclass Prog2(threading.Thread):\n    def __init__(self, arg=''):\n        self.arg = arg\n        threading.Thread.__init__(self)\n\n    def run(self):\n        global p2\n        p2 = subprocess.Popen(shlex.split(self.arg))\n\ndef main(p1, p2):\n    p_1 = Prog1(p1).start()\n    p_2 = Prog2(p2).start()\n    while True:\n        if not p_1.isAlive():\n            subprocess.Popen(shlex.split(\"kill -9 \" + p2.pid))\n            break\n        if not p_2.is_alive():\n            subprocess.Popen(shlex.split(\"kill -9 \" + p1.pid))\n            break\n</code></pre>\n\n<p>What I want to do:</p>\n\n<ol>\n<li>Run two programs at the same time.</li>\n<li>Open the CLI of those programs in separate prompts.</li>\n<li>Find which program ends first</li>\n<li>Kill the other program.</li>\n<li>End both threads.</li>\n</ol>\n"},{"tags":["c#","multithreading","thread-safety","counter"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":105,"score":4,"question_id":13181740,"title":"C# Thread safe fast(est) counter","body":"<p>What is the way to obtain a thread safe counter in C# with best possible performance?</p>\n\n<p>This is as simple as it gets:</p>\n\n<pre><code>public static long GetNextValue()\n{\n    long result;\n    lock (LOCK)\n    {\n        result = COUNTER++;\n    }\n    return result;\n}\n</code></pre>\n\n<p>But are there faster alternatives?</p>\n"},{"tags":["c#","multithreading","progress-bar"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13181350,"title":".NET equivalent of Android SDK's AsyncTask (i need to display a progress bar while executing operations on a backround thread)","body":"<p>I'm in a basic C# .NET 4.0 WinForms application.\nWhat i want to do is to write some logic to display a progress bar on the GUI thread while executing background operations on a background thread.</p>\n\n<p>Android has implemented <a href=\"http://developer.android.com/reference/android/os/AsyncTask.html\" rel=\"nofollow\">AsyncTask</a> class which has some methods that need override: onPreExecute, doInBackground, onProgressUpdate and onPostExecute. OnPreExecute you can show the progress bar and on PostExecute (when the doInBackground method returns) you can hide it. </p>\n\n<p>I read <a href=\"http://msdn.microsoft.com/en-us/library/vstudio/hh191443.aspx\" rel=\"nofollow\">here</a>  that .NET 4.5 comes with something similar built in. Is there anything similiar in .NET 4.0? \nIf not, is it a good idea to implement something like android's AsyncTask or is there a more conventional way to do this in C#? </p>\n\n<p>Regards,</p>\n\n<p>Dan</p>\n"},{"tags":["python","multithreading","signals","freebsd","top-command"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":9827820,"title":"Running 'top' in thread produces SIGTTOU","body":"<p>For reasons I won't go into, I need to run a variant of 'top -m io -d 2 10' within a subprocess from a Python thread on FreeBSD 8.1. The trouble is, it seems that sometimes SIGTTOU gets produced (under certain code-dependent conditions that I haven't yet deciphered), halting top and the thread entirely. Other times, it seems that SIGTTOU is not produced, but top or the thread get stuck anyway.</p>\n\n<p>The output from top should produce two sets of IO stats for the top 10 processes on the system, where the first set is \"absolute\" numbers and the second set is the incremental difference of the stats since the last set, one second earlier. Running this command on the terminal or within a shell script, whether redirecting the output or not, works fine.</p>\n\n<p>When the problem occurs, it seems that 'top' writes the first set of outputs, but then hangs/receives SIGTTOU before it can output the second set. In the sample code below, only one set of process stats is written to the output file.</p>\n\n<p>I discovered the SIGTTOU signal running the python script under 'truss', but it seems that interactions between 'truss' and 'top' themselves may be a confounding matter, since simply running <code>truss top -d 2</code> produces the signal and hangs, as below:</p>\n\n<pre><code>...\nioctl(1,TIOCGETA,0xffffe460)             = 0 (0x0)\nioctl(1,TIOCGETA,0xc6b138)           = 0 (0x0)\nioctl(1,TIOCGETA,0xffffe410)             = 0 (0x0)\nioctl(1,TIOCGWINSZ,0xffffe460)           = 0 (0x0)\nioctl(1,TIOCGWINSZ,0xffffe930)           = 0 (0x0)\nioctl(1,TIOCGETA,0x50e560)           = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGINT|SIGQUIT|SIGTSTP,0x0) = 0 (0x0)\nioctl(1,TIOCGETA,0x50e560)           = 0 (0x0)\nSIGNAL 22 (SIGTTOU)\n</code></pre>\n\n<p>Here's a sample Python script that reproduces the hang and/or SIGTTOU:</p>\n\n<pre><code>import subprocess\nfrom threading import Thread\n\ndef run():\n    with open(\"top.log\", \"wb\") as f:\n        subprocess.Popen((\"/usr/bin/top\", \"-m\", \"io\", \"-d\", \"2\", \"10\"), stdout=f, stderr=f, stdin=subprocess.PIPE).communicate()\n\nif __name__ == \"__main__\":\n    th = Thread(target=run)\n    print \"Starting\"\n    th.start()\n    th.join()\n</code></pre>\n\n<p>On my last run through, this sample program did not produce SIGTTOU, but top did hang. Truss shows:</p>\n\n<pre><code>....\nopen(\"/usr/local/lib/python2.7/lib-tk/_heapq.pyc\",O_RDONLY,0666) ERR#2 'No such file or directory'\nstat(\"/usr/local/lib/python2.7/lib-dynload/_heapq\",0x7fffffffa500) ERR#2 'No such file or directory'\nopen(\"/usr/local/lib/python2.7/lib-dynload/_heapq.so\",O_RDONLY,0666) = 5 (0x5)\nfstat(5,{ mode=-rwxr-xr-x ,inode=238187,size=22293,blksize=16384 }) = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGKILL|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\nopen(\"/usr/local/lib/python2.7/lib-dynload/_heapq.so\",O_RDONLY,057) = 6 (0x6)\nfstat(6,{ mode=-rwxr-xr-x ,inode=238187,size=22293,blksize=16384 }) = 0 (0x0)\npread(0x6,0x80074c2e0,0x1000,0x0,0xffff800800653120,0x8080808080808080) = 4096 (0x1000)\nmmap(0x0,1069056,PROT_NONE,MAP_PRIVATE|MAP_ANON|MAP_NOCORE,-1,0x0) = 34389442560 (0x801c54000)\nmmap(0x801c54000,12288,PROT_READ|PROT_EXEC,MAP_PRIVATE|MAP_FIXED|MAP_NOCORE,6,0x0) = 34389442560 (0x801c54000)\nmmap(0x801d56000,12288,PROT_READ|PROT_WRITE,MAP_PRIVATE|MAP_FIXED,6,0x2000) = 34390499328 (0x801d56000)\nmmap(0x0,36864,PROT_READ|PROT_WRITE,MAP_PRIVATE|MAP_ANON,-1,0x0) = 34366377984 (0x800655000)\nclose(6)                     = 0 (0x0)\nmmap(0x0,832,PROT_READ|PROT_WRITE,MAP_ANON,-1,0x0) = 34366414848 (0x80065e000)\nmunmap(0x80065e000,832)              = 0 (0x0)\nsigprocmask(SIG_SETMASK,0x0,0x0)         = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGKILL|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\nsigprocmask(SIG_SETMASK,0x0,0x0)         = 0 (0x0)\nclose(5)                     = 0 (0x0)\nclose(4)                     = 0 (0x0)\nclose(3)                     = 0 (0x0)\nclose(2)                     = 0 (0x0)\nfstat(1,{ mode=crw------- ,inode=102,size=0,blksize=4096 }) = 0 (0x0)\nioctl(1,TIOCGETA,0xffffe400)             = 0 (0x0)\nStarting\nwrite(1,\"Starting\\n\",9)              = 9 (0x9)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGKILL|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\n_umtx_op(0x7fffffffe1d8,0x3,0x1,0x0,0x0,0x0)     = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGABRT|SIGEMT|SIGKILL|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2) = 0 (0x0)\nsigprocmask(SIG_SETMASK,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGABRT|SIGEMT|SIGKILL|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2) = 0 (0x0)\nsigprocmask(SIG_SETMASK,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\nmmap(0x7fffffbde000,135168,PROT_READ|PROT_WRITE,MAP_STACK,-1,0x0) = 140737484021760 (0x7fffffbde000)\nmprotect(0x7fffffbde000,4096,PROT_NONE)      = 0 (0x0)\nthr_new(0x7fffffffe220,0x68,0x800a9f4c0,0x186fc,0xffffffff,0x0) = 0 (0x0)\nsigprocmask(SIG_SETMASK,0x0,0x0)         = 0 (0x0)\nmmap(0x0,2097152,PROT_READ|PROT_WRITE,MAP_PRIVATE|MAP_ANON,-1,0x0) = 34390511616 (0x801d59000)\nmmap(0x801f59000,684032,PROT_READ|PROT_WRITE,MAP_PRIVATE|MAP_ANON,-1,0x0) = 34392608768 (0x801f59000)\nmunmap(0x801d59000,684032)           = 0 (0x0)\n_umtx_op(0x8010127f8,0x10,0x1,0x0,0x0,0x0)   = 0 (0x0)\n_umtx_op(0x800e0b438,0xf,0x0,0x0,0x0,0x0)    = 0 (0x0)\n_umtx_op(0x800e0b438,0x10,0x1,0x0,0x0,0x0)   = 0 (0x0)\n_umtx_op(0x800e0b438,0x10,0x1,0x0,0x0,0x0)   = 0 (0x0)\n_umtx_op(0x800e0b438,0x10,0x1,0x0,0x0,0x8080808080808080) = 0 (0x0)\nopen(\"top.log\",O_WRONLY|O_CREAT|O_TRUNC,0666)    = 2 (0x2)\nfstat(2,{ mode=-rw-r--r-- ,inode=70860,size=0,blksize=16384 }) = 0 (0x0)\npipe(0x7fffffbfd910)                 = 0 (0x0)\npipe(0x7fffffbfd870)                 = 0 (0x0)\nfcntl(6,F_GETFD,)                = 0 (0x0)\nfcntl(6,F_SETFD,FD_CLOEXEC)          = 0 (0x0)\nsigprocmask(SIG_BLOCK,SIGHUP|SIGINT|SIGQUIT|SIGABRT|SIGEMT|SIGKILL|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGSTOP|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2) = 0 (0x0)\nfork()                       = 21503 (0x53ff)\nsigprocmask(SIG_SETMASK,SIGHUP|SIGINT|SIGQUIT|SIGILL|SIGTRAP|SIGABRT|SIGEMT|SIGFPE|SIGBUS|SIGSEGV|SIGSYS|SIGPIPE|SIGALRM|SIGTERM|SIGURG|SIGTSTP|SIGCONT|SIGCHLD|SIGTTIN|SIGTTOU|SIGIO|SIGXCPU|SIGXFSZ|SIGVTALRM|SIGPROF|SIGWINCH|SIGINFO|SIGUSR1|SIGUSR2,0x0) = 0 (0x0)\nclose(6)                     = 0 (0x0)\nclose(3)                     = 0 (0x0)\nread(5,0x801e31024,1048576)          = 0 (0x0)\nclose(5)                     = 0 (0x0)\nfcntl(4,F_GETFL,)                = 2 (0x2)\nfstat(4,{ mode=p--------- ,inode=0,size=0,blksize=4096 }) = 0 (0x0)\nclose(4)                     = 0 (0x0)\n</code></pre>\n\n<p>I've looked into SIGTTOU and found references to the TOSTOP termios flag, and I've fiddled with it in the main thread, in the child thread, and in the environment invoking Python, all to no avail. It's been an educational process, but I'm not there yet.</p>\n\n<p>I've run tests to make sure that the top process is created in and appears to stay in the process group of the Python process (based on the SIGTTOU documentation, if it weren't, this would be the reason for SIGTTOU), and that seems fine: the PGRP ends up being the same as the Python PID/PGRP.</p>\n\n<p>I've tried running 'top' with subprocess.check_output and with .Popen() using shell=True, shell=False, and redirecting std{out,err,in} all over the place, none of which seems to change this end result. I've tried running 'top' using a '/bin/sh -c' command executed through subprocess, also to no avail.</p>\n\n<p>Without doing something semi-weird like running 'top' within a shell script which my Python thread invokes, or resorting to os.fork() instead of using threading, how can I get around this issue, and what's the root cause?</p>\n"},{"tags":["android","multithreading","opengl-es","interpolation","frame-rate"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12569240,"title":"Interpolation in Android OpenGL ES Environment","body":"<p>Trying to setup a game loop thread for a test animation, I have come across a few problems. There are errors shown during start up and the Android program runs through the splash screen, but then terminates. This is the red highlighted Logcat error.    </p>\n\n<pre><code>09-24 16:09:18.731: E/AndroidRuntime(569): FATAL EXCEPTION: GLThread 76\n09-24 16:09:18.731: E/AndroidRuntime(569): java.lang.NullPointerException\n09-24 16:09:18.731: E/AndroidRuntime(569):  at \ncom.spacewrecksoftware.iceward.GLrenderer.onSurfaceCreated(GLrenderer.java:22)\n09-24 16:09:18.731: E/AndroidRuntime(569):  at \nandroid.opengl.GLSurfaceView$GLThread.guardedRun(GLSurfaceView.java:1446)\n09-24 16:09:18.731: E/AndroidRuntime(569):  at \nandroid.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1216)\n</code></pre>\n\n<p>This program creates a texture that moves back and forth on a landscape screen with a test implementation of interpolation rendering for smoother animation at higher frame rates.\nHere is the gameloop, renderer, menu, object, and state files in that order.</p>\n\n<p>GameLoop:</p>\n\n<pre><code>import android.os.SystemClock;\n\npublic class GameLoop extends Thread {\npublic static int deltaTime;\nboolean gameRunning = true;\npublic void setRunning(boolean running) {\n    this.gameRunning = running;\n}\npublic ObjectState previous= new ObjectState(0, 0, 10/1000, 0);\npublic ObjectState current= new ObjectState(0, 0, 10/1000, 0);\npublic Globject button= new Globject(previous, current);\npublic void run() {\n\n    int ticksPerSec = 30;\n    int skipTicks = 1000 / ticksPerSec;\n    int maxFrameskip = 5;\n    long nextGameTick = SystemClock.uptimeMillis();\n    int loops;\n    long interpolation;\n    long oldTimeSinceStart = 0;\n\n    while (gameRunning) {\n\n\n        loops = 0;\n        while( SystemClock.uptimeMillis() &gt; nextGameTick &amp; loops &lt; maxFrameskip){\n            long timeSinceStart = SystemClock.uptimeMillis();\n              deltaTime = (int) (timeSinceStart - oldTimeSinceStart);\n             oldTimeSinceStart = timeSinceStart;\n            updateGame();\n             nextGameTick += skipTicks;\n                loops++;\n            }\n        interpolation = SystemClock.uptimeMillis() + skipTicks - nextGameTick \n                /  skipTicks ;\n        drawGame(interpolation);\n    }\n}\nint switchit = 1;\nprivate void updateGame() {\n    if (switchit==1){   \n        if (button.now.position_x&lt;=-10){        \n             switchit=0;\n             button.past.velocity_x=0-button.past.velocity_x;\n        }\n        else{\n    button.past=button.now.copy(button.now);\n    button.now=button.past.addDt(button.past, deltaTime);\n        }\n    }\n    else if(switchit==0){   \n        if (button.now.position_x&gt;=10){     \n             switchit=1;\n             button.past.velocity_x=0-button.past.velocity_x;\n        }\n        else{\n            button.past=button.now.copy(button.now);\n            button.now=button.past.addDt(button.past, deltaTime);\n        }\n    }\n\n}\nprivate void drawGame(float interpolation) {\n    button.past=button.past.interpolate(button.past, button.now, interpolation);\n    Menu.menuSurface.requestRender();\n\n}\n}\n</code></pre>\n\n<p>Renderer:</p>\n\n<pre><code>import javax.microedition.khronos.egl.EGLConfig;\nimport javax.microedition.khronos.opengles.GL10;\n\nimport android.content.Context;\nimport android.opengl.GLSurfaceView.Renderer;\nimport android.opengl.GLU;\n\n\npublic class GLrenderer implements Renderer {\n\nprivate Globject object1;   \nprivate Context context;\nlong startTime;\npublic GLrenderer(Context context) {\n    this.context = context;\n    object1 = new Globject(null, null);\n}\npublic void onSurfaceCreated(GL10 gl, EGLConfig config) {       \n    //Load the texture for the cube once during Surface creation\n    object1.now.position_x=0;\n    object1.past.position_x=0;\n    object1.loadGLTexture(gl, this.context);\n    gl.glEnable(GL10.GL_BLEND);\n    gl.glBlendFunc(GL10.GL_SRC_ALPHA, GL10.GL_ONE_MINUS_SRC_ALPHA);\n    gl.glEnable(GL10.GL_TEXTURE_2D);            //Enable Texture Mapping\n    gl.glShadeModel(GL10.GL_SMOOTH);            //Enable Smooth Shading\n    gl.glClearColor(0.0f, 0.666f, 0.831f, 1f); \n    gl.glClearDepthf(1.0f);                     //Depth Buffer Setup\n    gl.glEnable(GL10.GL_DEPTH_TEST);            //Enables Depth Testing\n    gl.glDepthFunc(GL10.GL_LEQUAL);             //The Type Of Depth Testing To Do\n\n    gl.glHint(GL10.GL_PERSPECTIVE_CORRECTION_HINT, GL10.GL_NICEST); \n}\n/**\n * Here we do our drawing\n */\npublic void onDrawFrame(GL10 gl) {\n    gl.glClear(GL10.GL_COLOR_BUFFER_BIT | GL10.GL_DEPTH_BUFFER_BIT);    \n    gl.glLoadIdentity();        \n\n    gl.glTranslatef(0.0f, 0.0f, -20f);  \n    gl.glPushMatrix();\n    gl.glTranslatef( object1.past.position_x, 0, 0);    \n    object1.draw(gl);\n    gl.glPopMatrix();\n\n}\n\n/**\n * If the surface changes, reset the view\n */\npublic void onSurfaceChanged(GL10 gl, int width, int height) {\n    if(height == 0) {                       //Prevent A Divide By Zero By\n        height = 1;                         //Making Height Equal One\n    }\n\n    gl.glViewport(0, 0, width, height);     //Reset The Current Viewport\n    gl.glMatrixMode(GL10.GL_PROJECTION);    //Select The Projection Matrix\n    gl.glLoadIdentity();                    //Reset The Projection Matrix\n\n    //Calculate The Aspect Ratio Of The Window\n    GLU.gluPerspective(gl, 45.0f, (float)width / (float)height, 0.1f, 100.0f);\n\n    gl.glMatrixMode(GL10.GL_MODELVIEW);     //Select The Modelview Matrix\n    gl.glLoadIdentity();                    //Reset The Modelview Matrix\n}\n}\n</code></pre>\n\n<p>Menu:</p>\n\n<pre><code>import android.app.Activity;\nimport android.opengl.GLSurfaceView;\nimport android.os.Bundle;\nimport android.view.MotionEvent;\nimport android.view.SurfaceHolder;\n\npublic class Menu extends Activity\n{\nstatic GLSurfaceView menuSurface;\nprivate GameLoop thread;\n@Override\npublic void onCreate(Bundle savedInstanceState) \n{\n\n    super.onCreate(savedInstanceState);\n    menuSurface = new GLSurfaceView(this);\n        menuSurface.setRenderer(new GLrenderer(this));\n        menuSurface.setRenderMode(0);\n    setContentView(menuSurface);\n    thread = new GameLoop();\n    thread.setRunning(true);\n    thread.start();\n}\n\n@Override\nprotected void onResume() \n{\n    super.onResume();\n    menuSurface.onResume();\n}\n\n@Override\nprotected void onPause() \n{   \n    super.onPause();\n    menuSurface.onPause();\n}   \npublic boolean onTouchEvent(MotionEvent event) {\n            return super.onTouchEvent(event);   \n}\npublic void surfaceDestroyed(SurfaceHolder holder) {\nboolean retry = true;\nwhile (retry) {\n    try {\n        thread.join();\n        retry = false;\n    } catch (InterruptedException e) {\n        // try again shutting down the thread\n    }\n}\n}\n}\n</code></pre>\n\n<p>Object:    note-the image is a power of 2, four by one texture.</p>\n\n<pre><code>import java.io.IOException;\nimport java.io.InputStream;\nimport java.nio.ByteBuffer;\nimport java.nio.ByteOrder;\nimport java.nio.FloatBuffer;\n\nimport javax.microedition.khronos.opengles.GL10;\n\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.graphics.BitmapFactory;\nimport android.opengl.GLUtils;\n\npublic class Globject {\n\nprivate FloatBuffer vertexBuffer;\n\nprivate FloatBuffer textureBuffer;\n\nprivate ByteBuffer indexBuffer;\n\n\nprivate int[] textures = new int[1];\npublic ObjectState past;\npublic ObjectState now;\n\nprivate float vertices[] = {\n                    //Vertices according to faces\n                    -4.0f, 1.0f,  //Vertex 0\n                    -4.0f, -1.0f,  //v1\n                    4.0f, 1.0f,   //v2\n                    4.0f, -1.0f   //v3\n\n                                        };\n\n/** The initial texture coordinates (u, v) */   \nprivate float texture[] = {         \n                    //Mapping coordinates for the vertices  \n                    0.0f, 0.0f,\n                    0.0f, 1.0f,             \n                    1f, 0.0f,\n                    1f, 1.0f\n\n\n                                        };\n\n/** The initial indices definition */   \nprivate byte indices[] = {\n\n        0,1,2,3             \n                                        };\n\npublic Globject(ObjectState past2,ObjectState now2) {\n\n    now=now2;\n    past=past2;\n\n    ByteBuffer byteBuf = ByteBuffer.allocateDirect(vertices.length * 4);\n    byteBuf.order(ByteOrder.nativeOrder());\n    vertexBuffer = byteBuf.asFloatBuffer();\n    vertexBuffer.put(vertices);\n    vertexBuffer.position(0);\n\n    //\n    byteBuf = ByteBuffer.allocateDirect(texture.length * 4);\n    byteBuf.order(ByteOrder.nativeOrder());\n    textureBuffer = byteBuf.asFloatBuffer();\n    textureBuffer.put(texture);\n    textureBuffer.position(0);\n\n    //\n    indexBuffer = ByteBuffer.allocateDirect(indices.length);\n    indexBuffer.put(indices);\n    indexBuffer.position(0);\n}\n\npublic void draw(GL10 gl) {\n    gl.glBindTexture(GL10.GL_TEXTURE_2D, textures[0]);\n\n    //Point to our buffers\n    gl.glEnableClientState(GL10.GL_VERTEX_ARRAY);\n    gl.glEnableClientState(GL10.GL_TEXTURE_COORD_ARRAY);\n\n    //Set the face rotation\n    gl.glFrontFace(GL10.GL_CW);\n\n    //Enable the vertex and texture state\n    gl.glVertexPointer(2, GL10.GL_FLOAT, 0, vertexBuffer);\n    gl.glTexCoordPointer(2, GL10.GL_FLOAT, 0, textureBuffer);\n\n    //Draw the vertices as triangles, based on the Index Buffer information\n    gl.glDrawElements(GL10.GL_TRIANGLE_STRIP, indices.length, GL10.GL_UNSIGNED_BYTE, indexBuffer);\n\n    //Disable the client state before leaving\n    gl.glDisableClientState(GL10.GL_VERTEX_ARRAY);\n    gl.glDisableClientState(GL10.GL_TEXTURE_COORD_ARRAY);\n}\n\npublic void loadGLTexture(GL10 gl, Context context) {\n    //Get the texture from the Android resource directory\n    InputStream is = context.getResources().openRawResource(R.drawable.custom_button1);\n    Bitmap bitmap = null;\n    try {\n        bitmap = BitmapFactory.decodeStream(is);\n\n    } finally {\n        //Always clear and close\n        try {\n            is.close();\n            is = null;\n        } catch (IOException e) {\n        }\n    }\n\n    //Generate one texture pointer...\n    gl.glGenTextures(1, textures, 0);\n    //...and bind it to our array\n    gl.glBindTexture(GL10.GL_TEXTURE_2D, textures[0]);\n\n    //Create Nearest Filtered Texture\n    gl.glTexParameterf(GL10.GL_TEXTURE_2D, GL10.GL_TEXTURE_MIN_FILTER, GL10.GL_LINEAR);\n    gl.glTexParameterf(GL10.GL_TEXTURE_2D, GL10.GL_TEXTURE_MAG_FILTER, GL10.GL_LINEAR);\n\n    //Different possible texture parameters, e.g. GL10.GL_CLAMP_TO_EDGE\n    gl.glTexParameterf(GL10.GL_TEXTURE_2D, GL10.GL_TEXTURE_WRAP_S, GL10.GL_REPEAT);\n    gl.glTexParameterf(GL10.GL_TEXTURE_2D, GL10.GL_TEXTURE_WRAP_T, GL10.GL_REPEAT);\n\n    //Use the Android GLUtils to specify a two-dimensional texture image from our bitmap\n    GLUtils.texImage2D(GL10.GL_TEXTURE_2D, 0, bitmap, 0);\n\n    //Clean up\n    bitmap.recycle();\n}   \n}\n</code></pre>\n\n<p>State:</p>\n\n<pre><code>public class ObjectState {\npublic float position_x;\npublic float position_y;\npublic float velocity_x;\npublic float velocity_y;\npublic ObjectState(float position_x2, float position_y2, float velocity_x2, float velocity_y2) {\n    position_x = position_x2;\n    position_y = position_y2;\n    velocity_x = velocity_x2;\n    velocity_y = velocity_y2;\n}\npublic ObjectState copy(ObjectState state0) {\nObjectState state1= new ObjectState(state0.position_x, state0.position_y,\n        state0.velocity_x, state0.velocity_y);\nreturn state1;\n}  \npublic ObjectState subtract(ObjectState state, ObjectState state1){\n    ObjectState  state2=state.copy(state);\n    state2.position_x=(state1.position_x-state.position_x);\n    state2.position_y=(state1.position_y-state.position_y);\n    state2.velocity_x=(state1.velocity_x-state.velocity_x);\n    state2.velocity_y=(state1.velocity_y-state.velocity_y);\nreturn state2;\n}\npublic ObjectState addDt(ObjectState state, int deltaTime){\n    ObjectState  state1=state.copy(state);\n    state1.position_x=(state1.velocity_x*deltaTime)+state1.position_x;\n    state1.position_y=(state1.velocity_y*deltaTime)+state1.position_y;\nreturn state1;\n}\npublic ObjectState interpolate(ObjectState state, ObjectState state2,float interpolate){\n    ObjectState  state1=state.copy(state);\n    state1.position_x=(state1.subtract(state2, state).position_x*interpolate)+state.position_x;\n    state1.position_y=(state1.subtract(state2, state).position_y*interpolate)+state.position_y;\n    state1.velocity_x=(state1.subtract(state2, state).velocity_x*interpolate)+state.velocity_x;\n    state1.velocity_y=(state1.subtract(state2, state).velocity_y*interpolate)+state.velocity_y;\nreturn state1;\n}\n}\n</code></pre>\n\n<p>I haven't been able to find a problem, help would be much appreciated!  Thanks!</p>\n"},{"tags":["ios","multithreading","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13167049,"title":"Know if GCD thread is running","body":"<p>In my iOS app I am download a fairly large amount of data in a background thread. What I need to do is somehow check when the user reopens the app if this task is still running or if it has been canceled. </p>\n\n<p>If the user hits the home button for example, and then comes back to the app, the thread will continue which is good. But what if somehow the thread gets torn down by the OS. How can I on app resume know if a thread is running.</p>\n\n<p>Thanks!</p>\n\n<p>Some Code:</p>\n\n<pre><code>// Starts a background thread and also allows it to run in the background if the user exits app\ndispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n    UIBackgroundTaskIdentifier bgTask = 0;\n    bgTask = [[UIApplication sharedApplication] beginBackgroundTaskWithExpirationHandler:^{\n        [self endBackgroundUpdateTask:bgTask];\n    }];\n\n// Code here to run in background\n\n// Tell the main thread its done, and also remove itself from background execution\ndispatch_async( dispatch_get_main_queue(), ^{\n    NSLog(@\"Done with background thread\");\n    [self endBackgroundUpdateTask:bgTask];\n});\n</code></pre>\n"},{"tags":["ios","multithreading","methods"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13169923,"title":"How to stop method from executing before the last one finishes","body":"<p>I have 3 classes</p>\n\n<ul>\n<li>View Class</li>\n<li>Request Class</li>\n<li>Response Class</li>\n</ul>\n\n<p>Ia calling two methods in my request class from my view class like so;</p>\n\n<pre><code>[eRequests GetM:IdString];\n[eRequests GetY:IdString SubID:subIdString];\n</code></pre>\n\n<p>My thread starts to execute the first line and gets halfway though its process then the next request starts before the first has even come back. </p>\n\n<p>I would like to prevent this from happening however I am not really sure how to proceed.</p>\n\n<p>The thing thats stopping me is that a request like this will go through these steps</p>\n\n<ol>\n<li>Call request method - inside ViewClass</li>\n<li>Create packet and send request receive the data returned from the db - inside Requestclass</li>\n<li>Send data to ResponseClass - inside Requestclass</li>\n<li>decode data and send relevant information back to receiver method in ViewClass - inside Response Class</li>\n</ol>\n\n<p>The thing I'm abit stuck on is when the thread comes back to the viewclass but inside the different method how do I get back to the second request?</p>\n\n<p>Anyway if anyone can provide some help on allowing me to execute one method call at a time that would be hugely appreciated!</p>\n"},{"tags":["c#","multithreading","xna"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2451,"score":3,"question_id":3162436,"title":"Threading in XNA","body":"<p>I have a game in XNA which needs to do network calls. In the update method I determine what needs to be sent and then add it to a list of stuff to send. Then I run the network call. This slows down the application alot obviously. So I first tried creating a new thread like this in the update to make it do it on a seperate thread:</p>\n\n<pre><code>Thread thread; \nthread = new Thread(\nnew ThreadStart(DoNetworkThing));\nthread.Start();\n</code></pre>\n\n<p>I presume creating threads has overhead etc which results in this being even slower.\nFinally, I made a method that has <code>while(true){DoNetworkThing();}</code> in it which will keep looping round and run the network call over and over again(it does check if its already busy with one, and whether there is stuff to send). That method I called in the LoadContent method in a thread, so it will run alongside the game in its own thread.\nBut that is really slow too.</p>\n\n<p>So what am I doing wrong? What is the best way of doing this?\nThanks</p>\n"},{"tags":["iphone","ios","multithreading","uitableview","uitableviewcell"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13178288,"title":"Downloading data to fill \"placeholders\" in UITableViewCell on another thread to prevent lags","body":"<p>What I have is an app with a UITableViewController, that is filled with custom UITableViewCells. I have some data available to feed the cells, however I need to download some extra content (pics, etc). </p>\n\n<p>So what I do in the viewDidLoad method, I init a UITableViewCell object, fill all the labels with the info I have already available. Then I launch one of the cell class's methods to download the data. After I'm done with the specific cell, I put it into a NSMutableArray and proceed with the next cell.</p>\n\n<p>Then in the cellForRowAtIndexPath method I return the cell at the specific index from the mutable array.</p>\n\n<p>What happens is that until all the data isn't downloaded, my tableView is stuck... I'm not sure if this is the right approach, but I think I have to launch the method which downloads and then fills the extra content to the cell on another thread. How can I do that?</p>\n\n<p>Thanks a lot in advance!</p>\n"},{"tags":["c++","multithreading","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":13173078,"title":"Creating multiple threads C++","body":"<p>Im writing a program that multiplies two matrices using a variable number of threads and then compares execution time for each run. The user specifies the maximum number of threads to use and then the program does the multiplication with 1 thread, again with 2, 3, 4....up to max_threads (we don't have to worry about max_threads being more than 8). So whats the best way to create the threads for each run? Here's my best shot in the dark.</p>\n\n<p>EDIT: I have to use pthread.</p>\n\n<pre><code>//Ive already called multiplyMatrices for the single thread run. Start with 2 threads.\nfor (int h=2; h &lt;= max_threads; h++)\n{\n    for(int i = 0; i &lt; h; i++)\n    {   \n        pthread_create(thr_id[i],NULL, multiplyMatrices, i);\n    }\n\n    for(int i = 0; i &lt; h; i++)\n    {\n        pthread_join(thr_id[i],NULL);\n    }\n}\n</code></pre>\n\n<p>The code for multiplyMatrices is below.</p>\n\n<pre><code>void* multiplyMatrices(void* val)\n{    \n    for(int i = 0; i &lt; n; i = i*val)\n    {\n        for(int j = 0; j &lt; p; j++)\n    {\n            c[i][j] = 0;\n            for(int k = 0; k &lt; m; k++)\n        {\n                c[i][j] += matrix_A[i][k] * matrix_B[k][j];\n            }\n        }\n    val++;\n    }\n    pthread_exit(0);\n}\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13172322,"title":"Thread order synchronization","body":"<p>Suppose I have a Queue of Tasks, and each Task have a locking object (syncObject) which controls shared resource access, Queue can have multiple Task  which share same instances of syncObject. And I have N concurrent threads that should dequeue Tasks and proccess them in queue order, this means acquire lock on syncObject in the order of queue. </p>\n\n<p>Code explanation:</p>\n\n<pre><code>abstract class Task\n{\n    public readonly Object SyncObject = new Object();\n}\n\nQueue&lt;Task&gt; taskQueue = new Queue&lt;Task&gt;();\nObject queueLock = new Object();\n\nvoid TakeItemThreadedMethod()\n{\n    Task task;\n    lock(queueLock) task = taskQueue.Dequeue();\n    //Between this lines is my problem,\n    //Other thread can dequeue next task and it may share same syncObject and\n    //acquire lock on it before this thread, thought this task was first in queue\n    lock(task.SyncObject)\n    {\n        //Do some work here\n    }\n}\n</code></pre>\n\n<p><strong>How to start proccessing Tasks (acquire Task.SyncObject lock) that share the same SyncObject in the order they were in Queue.</strong></p>\n"},{"tags":["c++","multithreading","curl","libcurl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13160290,"title":"curl_easy_perform crashes when the URL is not correct","body":"<p>I have a problem trying to download files using <code>libcurl</code>. The program works with multiple threads, every thread that needs to download a file creates a <code>libcurl</code> handle to work with.</p>\n\n<p>When the URL is correct everything works, but if there is a mistake in the URL the program crashes. In debug mode, if the URL is not correct <code>curl_easy_perform</code> returns an error connection code and the program works. In contrast, it crashes in release.</p>\n\n<p>How could I fix this error?</p>\n\n<p>Here is the code that I use to download the file, irrelevant code has been supressed:</p>\n\n<pre><code>LoadFileFromServer\n(\n    string&amp; a_sURL\n)\n{\n    string  sErrorBuffer;\n\n    struct DownloadedFile updateFile = { sFilenameToWrite,  // name to store the local file if succesful\n                                         NULL };            // temp buffer\n\n    CURL*   pCurl = curl_easy_init();\n\n    curl_easy_setopt( pCurl, CURLOPT_URL, a_sURL.data() );\n    curl_easy_setopt( pCurl, CURLOPT_FOLLOWLOCATION, 1L );\n    curl_easy_setopt( pCurl, CURLOPT_ERRORBUFFER, sErrorBuffer );\n    curl_easy_setopt( pCurl, CURLOPT_WRITEFUNCTION, BufferToFile );\n    curl_easy_setopt( pCurl, CURLOPT_WRITEDATA, &amp;updateFile );\n    curl_easy_setopt( pCurl, CURLOPT_NOPROGRESS, 0 );\n    curl_easy_setopt( pCurl, CURLOPT_CONNECTTIMEOUT, 5L );\n\n    CURLcode res = curl_easy_perform( pCurl );\n\n    curl_easy_cleanup( pCurl );\n}\n\nint BufferToFile\n( \n    void *  a_buffer, \n    size_t  a_nSize, \n    size_t  a_nMemb, \n    void *  a_stream \n)\n{\n    struct DownloadedFile *out = ( struct DownloadedFile * ) a_stream;\n    if( out &amp;&amp; !out-&gt;stream ) \n    {\n        // open file for writing \n        if ( 0 != fopen_s( &amp;( out-&gt;stream ), out-&gt;filename.c_str(), \"wb\" ) )\n            return -1;\n        if( !out-&gt;stream )\n            return -1; /* failure, can't open file to write */\n    }\n\n    return fwrite( a_buffer, a_nSize, a_nMemb, out-&gt;stream );\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":14,"favorite_count":50,"up_vote_count":110,"down_vote_count":0,"view_count":42464,"score":110,"question_id":1036754,"title":"Difference between wait() and sleep()","body":"<p>What is the difference between a <code>wait()</code> and <code>sleep()</code> in Threads?</p>\n\n<p>Is my understanding that a <code>wait()</code>-ing Thread is still in running mode and uses CPU cycles but a <code>sleep()</code>-ing does not consume any CPU cycles correct?</p>\n\n<p>Why do we have <em>both</em> <code>wait()</code> and <code>sleep()</code>: how does their implementation vary at a lower level?</p>\n"},{"tags":["c#","winforms","multithreading","ui-thread"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":4142,"score":6,"question_id":1149402,"title":"How to detect if we're on a UI thread?","body":"<p>For the sake of argument, consider a UI thread as a thread that has had a call to <code>Application.Run()</code> or one of it's overloads called on it and has an active message loop running.</p>\n\n<p>Is there a way of detecting if we're currently executing on such a thread?</p>\n\n<p>The reason I want this is because I have a class with a private function that is long-running. The class itself is already multithreaded, and the usage of this class is such that it might be used from either the UI or from background threads doing processing. This function also falls into this net. But I don't want it to block up the UI thread. So I want to detect if I am running on a UI thread and if so, fork the function call into a background thread (probably <code>ThreadPool</code>, but that's a non-issue for this discussion). This is entirely well-behaved, but the background threads are probably relying on the output of the function, so blocking for them is better, whereas the UI thread is accessing it in a more \"set-and-forget\" manner.</p>\n"},{"tags":["asp.net-mvc","multithreading","asp.net-mvc-3","castle-windsor","lifestyle"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13177078,"title":"Castle Windsor lifestyle configurable per consumer? (Threading issue in ASP.NET MVC3 application.)","body":"<p>In my ASP.NET MVC3 application, the normal Castle Windsor lifestyle is \"PerWebRequest.\"\nThis has worked very well so far.</p>\n\n<p>However, now I need some tasks (e.g. email sending) to be executed on a different thread, after the web request has ended (to be exact, this is a custom form of event handling).\nWith the \"PerWebRequest\" lifestyle, this leads to ObjectDisposedExceptions.</p>\n\n<p>According to <a href=\"http://stackoverflow.com/questions/7203745/windsor-composite-lifestyle-for-asp-net-process\">this thread</a>, the Hybrid lifestyle from the Castle.Windsor.Lifestyles contrib project would do just what I want.\nBut I'd like to know if there is another option, without adding another dependency.\nLike to always have my event handlers use the \"PerThread\" lifestyle or something similar, whilst all other consumers still would use the \"PerWebRequest\" default.</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","multithreading","jvm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":40,"score":-3,"question_id":13176691,"title":"how does jvm detects deadlock condition. What is the data structure and algorithm JVM implements to detect htread deadlock.","body":"<p>I have been trying to find whether JVM has some way to find if some threads are in deadlock condition. I am unable to find any. Please let me know if any one of you gets any pointer on this.</p>\n"},{"tags":["java","multithreading","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13175951,"title":"Concurrent modification exception within synchronized methods","body":"<p>I made some modifications on my multithread program and started to get <code>ConcurrentModificationException</code> s at an object's <code>HashTable</code>, so I made all accesses to this <code>HashTable</code> into <code>synchronised</code> methods to avoid concurrent accesses to my object, unlike my expectation it didn't solved the problem. Here is a outline of the design used:</p>\n\n<p>First I've got a <code>JTable</code> that displays some data of an usb device, this <code>JTable</code> asks for a communication-core object that implements <code>Observer</code> (the one that reads and writes data to my device) through an <code>Observable</code> object the data it wants, the data it wants depends of which rows are displayed so it's updated when the user scrolls de table, than this communication-core object gets this notification through <code>synchronized update</code> method that calls other <code>synchronized</code> method that updates a <code>HashTable</code> which saves the last read values for after use (this communication class notifies back my <code>JTable</code> class and other objects when it reads values though other <code>Observable</code> object). The exception is occuring in this last method while updates the <code>HashTable</code>. Here is a simplification of the code:</p>\n\n<p>The following methods are of the communication-core object</p>\n\n<pre><code>public synchronized void update(Observable o, Object arg)\n{\n    // do some other work\n    // calls the second synchronized method\n    updateMonitorList();\n}\n\nprivate synchronized void updateMonitorList()\n{\n    // updates a list of monitoring addresses (no problem here)\n    // m_lastValues is the HashTable that is giving me headaches\n    Iterator&lt;Parameter&gt; itr = m_lastValues.keySet().iterator();\n    while (itr.hasNext())\n    {\n        // removes the currently not used parameters from the HashTable\n        Parameter p = itr.next(); // concurrent exception here WHY? :/\n        boolean contains = false;\n        for (int i = 0; i &lt; m_monitorList.size(); i++)\n        {\n            if (p.equals(m_monitorList.get(i)))\n            {\n                contains = true;\n                break;\n            }\n        }\n        if (!contains)\n        {\n            m_lastValues.remove(p);\n        }\n    }\n    // more operations with the HashTable\n    for (int i = 0; i &lt; m_monitorList.size(); i++)\n    {\n        // adds newly added parameters to the hashtable\n        boolean contains = false;\n        for (Observer key : m_requestedParameters.keySet())\n        {\n            if (key.equals(m_monitorList.get(i)))\n            {\n                contains = true;\n                break;\n            }\n        }\n        if (!contains)\n        {\n            m_lastValues.put(m_monitorList.getAt(i), m_monitorList.getAt(i).m_intUserSetting);\n        }\n    }\n}\n\n// this method is used to know if a value has changed\nprivate synchronized boolean getParameterChanged(Parameter currentParamer)\n{\n    Integer v = m_lastValues.get(currentParamer);\n    return v == null || v != currentParamer.m_intUserSetting;\n}\n</code></pre>\n\n<p>I need this approach because I have multiple windows that asks for values from the usb device, and this communication object takes care of it, there was no problem with concurrency before I added this <code>HashTable</code> of last values. This <code>m_lastValues</code> <code>HashTable</code> is not used in any other method not listed above.</p>\n\n<p>Any suggestions? Thanks in advance.</p>\n\n<p><strong>[ EDIT ]</strong></p>\n\n<p>Actually that was not a multithread problem, it was just a misunderstood exception meaning. As @Tudor pointed out the problem was the <code>remove()</code> method inside the <code>while</code> loop. Here is how I solved it:</p>\n\n<p>This code goes into <code>updateMonitorList()</code> method, note that <code>no Iterator was needed</code> (the first question was with a <code>for</code> loop like that), actually the <code>Iterator</code> made no difference:</p>\n\n<pre><code>    ArrayList&lt;Parameter&gt; remove = new ArrayList&lt;Parameter&gt;();\n    for (Parameter p : m_lastValues.keySet())\n    {\n        boolean contains = false;\n        for (int i = 0; i &lt; m_monitorList.size(); i++)\n        {\n            if (p.equals(m_monitorList.get(i)))\n            {\n                contains = true;\n                break;\n            }\n        }\n        if (!contains)\n        {\n            remove.add(p);\n        }\n    }\n    for (int i = 0; i &lt; remove.size(); i++)\n    {\n        m_lastValues.remove(remove.get(i));\n    }\n</code></pre>\n"},{"tags":["android","multithreading","android-layout","listview"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13174586,"title":"How to get the status of the child view of ListView?","body":"<p>I have a problem with my application. I have a ListView with items in the spinner, and in the main layout I have one ImageView and ListView. When user selects value in the spinner, in the main layout, I want that ImageView should change image according to the selected value in the spinner.</p>\n\n<p>Please help me, I have tried using RunUIThread without effect. Also, tell me how can I achieve this by using RunUIThread?</p>\n\n<p>Thanks so much everyone!</p>\n\n<p>Sourcode:</p>\n\n<p>first is itemList:</p>\n\n<pre><code>@Override\npublic View getView(final int position, View convertView, ViewGroup parent) {\n\n    final Options option = getItem(position);\n    convertView = inflate.inflate(R.layout.option_item, null);\n\n    TextView txtTitle = (TextView) convertView.findViewById(R.id.optionitem_textview_Title);\n    final TextView txtValue = (TextView) convertView.findViewById(R.id.optionitem_textview_Value);\n    LinearLayout llo = (LinearLayout) convertView.findViewById(R.id.optionitem_linearlayout_Click);\n\n    txtTitle.setText(option.getOpt_name());\n    txtValue.setText(option.getOpt_list().get(0).getValue() + \"\");\n\n    llo.setOnClickListener(new OnClickListener() {\n\n        @Override\n        public void onClick(View v) {\n\n            String[] value = new String[option.getOpt_list().size()];\n            String[] arrpos = new String[option.getOpt_list().size()];\n\n            for (int i = 0; i &lt; option.getOpt_list().size(); i++)\n            {\n                value[i] = option.getOpt_list().get(i).getValue();\n                arrpos[i] = i + \"\";\n            }\n            new SingleChoiceDialog(_context, \"Select \" + option.getOpt_name(), value, arrpos, new OnDialogCloseListener() {\n\n                @Override\n                public void onClose(String choice, Object value) {\n\n                    int pos = Integer.parseInt(value.toString());\n                    if (pos &gt;= 0)\n                    {\n                        option.setOpt_choice(choice);\n                        option.setOpt_priceChoice(option.getOpt_list().get(pos).getPrice() + \"\");\n                        txtValue.setText(choice);\n                    }\n                }\n            }).show();\n        }\n    });\n\n    return convertView;\n}\n</code></pre>\n\n<p>main layout: </p>\n\n<pre><code>&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:layout_width=\"fill_parent\"\nandroid:layout_height=\"fill_parent\"\nandroid:background=\"@drawable/background\"\nandroid:orientation=\"vertical\" &gt;\n\n\n        &lt;LinearLayout\n            android:layout_width=\"fill_parent\"\n            android:layout_height=\"fill_parent\"\n            android:orientation=\"vertical\" &gt;\n\n               &lt;Gallery\n                    android:id=\"@+id/itemdetail_gallery_imageProduct\"\n                    android:layout_width=\"fill_parent\"\n                    android:layout_height=\"210dp\" /&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"fill_parent\"\n                android:layout_height=\"wrap_content\"\n                android:orientation=\"vertical\"\n                android:padding=\"5dp\" &gt;\n\n                &lt;ihnel.lib.adapterview.MyListView\n                    android:id=\"@+id/itemdetail_listview_Optionitems\"\n                    android:layout_width=\"fill_parent\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_margin=\"2dp\"\n                    android:layout_weight=\"1\"\n                    android:cacheColorHint=\"#0000\"\n                    android:fadingEdge=\"none\"\n                    android:focusable=\"true\"\n                    android:scrollbars=\"none\"\n                    android:tag=\"itemdetail_lvOptionitem\" /&gt;\n\n            &lt;/LinearLayout&gt;\n        &lt;/LinearLayout&gt;\n</code></pre>\n\n<p></p>\n\n<p>and MainActivity with listOption:</p>\n\n<pre><code>opt_adapter = new OptionListviewAdapter(ItemDetailActivity.this, R.layout.option_item, new LinkedList&lt;Options&gt;());\n            lvOptionItem.getAdapterView().setAdapter(opt_adapter);\n            opt_adapter.setList(optionItem);\n            opt_adapter.notifyDataSetChanged();\n</code></pre>\n\n<p>I want when select option in SingleChoiceDialog of listview item, in main activity can get a value and change image in gallery, currently i do not have the idea to do this .Please help me.</p>\n"},{"tags":["multithreading","powershell","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1154,"score":2,"question_id":249809,"title":"using system.thread.threadpool in powershell","body":"<p>I am after a example of some code in powershell using the threadpool. my friends at google can not help me. Any example would be great.</p>\n\n<p>Donald</p>\n"},{"tags":[".net","multithreading","threadpool"],"answer_count":7,"favorite_count":22,"up_vote_count":58,"down_vote_count":0,"view_count":17009,"score":58,"question_id":230003,"title":"Thread vs ThreadPool","body":"<p>What is the difference between using a new thread and using a thread from the thread pool? What performance benefits are there and why should I consider using a thread from the pool rather than one I've explicitly created? I'm thinking specifically of .NET here, but general examples are fine.</p>\n"},{"tags":[".net","multithreading","asynchronous","threadpool"],"answer_count":2,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":2423,"score":5,"question_id":192539,"title":"Use asynchronous delegates or ThreadPool.QueueUserWorkItem for massive parallelism?","body":"<p>I have a .NET application that processes around 300,000 records in a batch import, and it takes a few seconds per record so I would like to parallelize this. In the following code, what's the difference between <code>ProcessWithAnsycDelegates()</code> and <code>ProcessWithThreadPool()</code>?</p>\n\n<pre><code>public class ResultNotification\n { public EventHandler event Success;\n   public EventHandler event Fail;\n   internal void Notify(bool sucess) {if (success) Success(); else Fail();}\n }\n\npublic static class Processor\n { public ResultNotification ProcessWithAnsycDelegates(Record record)\n    { var r = new ResultNotification();\n      Func&lt;Record,bool&gt; processRecord=new RecordProcessor().ProcessRecord;\n      processRecord.BeginInvoke\n                     ( record\n                      ,ar =&gt; result.Notify(processRecord.EndInvoke(ar))\n                      ,null); \n      return r;    \n    }\n\n   public ResultNotification ProcessWithThreadPool(Record r)\n    { var r  = new ResultNotification();\n      var rp = new RecordProcessor();\n      ThreadPool.QueueWorkUserItem(_=&gt;result.Notify(rp.ProcessRecord(r)));\n      return r;\n    }\n }\n</code></pre>\n"},{"tags":[".net","multithreading","concurrency","threadpool"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1045,"score":4,"question_id":150645,"title":"When ThreadPool.QueueUserWorkItem returns false","body":"<p>The MSDN states that the method returns</p>\n\n<blockquote>\n  <p>true if the method is successfully\n  queued; NotSupportedException is\n  thrown if the work item is not queued.</p>\n</blockquote>\n\n<p>For testing purposes how to get the method to return <code>false</code>? Or it is just a \"suboptimal\" class design?</p>\n"},{"tags":["ruby","multithreading","threadpool","deadlock"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":4348,"score":8,"question_id":81788,"title":"Deadlock in ThreadPool","body":"<p>I couldn't find a decent ThreadPool implementation for Ruby, so I wrote mine (based partly on code from here: <a href=\"http://snippets.dzone.com/posts/show/3276\">http://snippets.dzone.com/posts/show/3276</a> , but changed to wait/signal and other implementation for ThreadPool shutdown. However after some time of running (having 100 threads and handling about 1300 tasks), it dies with deadlock on line 25 - it waits for a new job there. Any ideas, why it might happen?</p>\n\n<pre><code>require 'thread'\nbegin\n  require 'fastthread'\nrescue LoadError\n  $stderr.puts \"Using the ruby-core thread implementation\"\nend \n\nclass ThreadPool\n  class Worker\n    def initialize(callback)\n      @mutex = Mutex.new\n      @cv = ConditionVariable.new\n      @callback = callback\n      @mutex.synchronize {@running = true}\n      @thread = Thread.new do\n        while @mutex.synchronize {@running}\n          block = get_block\n          if block\n            block.call\n            reset_block\n            # Signal the ThreadPool that this worker is ready for another job\n            @callback.signal\n          else\n            # Wait for a new job\n            @mutex.synchronize {@cv.wait(@mutex)} # &lt;=== Is this line 25?\n          end\n        end\n      end\n    end\n\n    def name\n      @thread.inspect\n    end\n\n    def get_block\n      @mutex.synchronize {@block}\n    end\n\n    def set_block(block)\n      @mutex.synchronize do\n        raise RuntimeError, \"Thread already busy.\" if @block\n        @block = block\n        # Signal the thread in this class, that there's a job to be done\n        @cv.signal\n      end\n    end\n\n    def reset_block\n      @mutex.synchronize {@block = nil}\n    end\n\n    def busy?\n      @mutex.synchronize {!@block.nil?}\n    end\n\n    def stop\n      @mutex.synchronize {@running = false}\n      # Signal the thread not to wait for a new job\n      @cv.signal\n      @thread.join\n    end\n  end\n\n  attr_accessor :max_size\n\n  def initialize(max_size = 10)\n    @max_size = max_size\n    @workers = []\n    @mutex = Mutex.new\n    @cv = ConditionVariable.new\n  end\n\n  def size\n    @mutex.synchronize {@workers.size}\n  end\n\n  def busy?\n    @mutex.synchronize {@workers.any? {|w| w.busy?}}\n  end\n\n  def shutdown\n    @mutex.synchronize {@workers.each {|w| w.stop}}\n  end\n  alias :join :shutdown\n\n  def process(block=nil,&amp;blk)\n    block = blk if block_given?\n    while true\n      @mutex.synchronize do\n         worker = get_worker \n         if worker\n           return worker.set_block(block)\n         else\n           # Wait for a free worker\n           @cv.wait(@mutex)\n         end\n      end\n    end\n  end\n\n  # Used by workers to report ready status\n  def signal\n    @cv.signal\n  end\n\n  private\n  def get_worker\n    free_worker || create_worker\n  end\n\n  def free_worker\n    @workers.each {|w| return w unless w.busy?}; nil\n  end\n\n  def create_worker\n    return nil if @workers.size &gt;= @max_size\n    worker = Worker.new(self)\n    @workers &lt;&lt; worker\n    worker\n  end\nend\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":1796,"score":8,"question_id":3488703,"title":"When exactly do you use the volatile keyword in Java?","body":"<p>I have read \"<a href=\"http://www.javamex.com/tutorials/synchronization_volatile_when.shtml\">When to use 'volatile' in Java?</a>\" but I'm still confused. How do I know when I should mark a variable volatile? What if I get it wrong, either omitting a volatile on something that needs it or putting volatile on something that doesn't? What are the rules of thumb when figuring out what variables should be volatile in multithreaded code?</p>\n"},{"tags":["winforms","multithreading","backgroundworker","threadpool","begininvoke"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12834545,"title":"C# Download Manager (Thread, ThreadPool, BeginInvoke, BackgroundWorker)","body":"<p>So here it is. I want to make some test download manager (winforms), and want to use 4 different ways (managers):<br>\n1. BackGroundWorker manager\n2. Thread manager\n3. ThreadPool manager\n4. Delegate.BeginInvoke manager<br>\n Download from ftp. Of course make it async for multidownloading, and when i want to add new download, previous download might still work. So, my problem is architecture. I imagine this smth like:<br>\n1) create interface IDownloadManager. Here - enum Status(Idle, download, downloaded, canceled, errorDownloaded), some events (DownloadStarted, DownloadComleted, DownloadCancelled, DownloadStopped), method for Percent, method for Start.<br>\n2) ManagerFactory class, that creates selected Manager.<br>\n3) IManagerFactory interface, that handle with creating Manager<br>\n4) ManagerHost class, where stores all information of current managers.  </p>\n\n<p>Can anyone tell me, where is my architecture mistakes? give me some advises, suggestions etc..Thanks for reading and helping!</p>\n"},{"tags":["java","multithreading","thread-safety","threadpool"],"answer_count":4,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":357,"score":9,"question_id":13120167,"title":"How to kill a thread which has a while(true)?","body":"<p>I am trying to close all my thread in my threadpool.</p>\n\n<p>Usually I try:</p>\n\n<pre><code>        while(!Thread.currentThread().isInterrupted()) {...\n</code></pre>\n\n<p>To close the while loop...</p>\n\n<p>But I have one Thread which only consists about</p>\n\n<pre><code>        while(!Thread.currentThread().isInterrupted()) {//which is true\n</code></pre>\n\n<p>This is how I close the threads:</p>\n\n<pre><code>pool.shutdownNow();\n</code></pre>\n\n<p>So how would you close such a Thread?</p>\n"},{"tags":["java","multithreading","quartz-scheduler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13161679,"title":"How do I make Quartz Cron Expression to run at once for a specific year?","body":"<p>I'm using <b>Quartz 2.1.x Distribution</b> to run a program in Periodic manner. Means in hourly, daily, weekly, yearly basis. I'm able to schedule the program correctly. <BR/>\nThe problem is in Aperiodic scheduling: With the help of Aperiodic Scheduling I want to achieve something like this --> <b>\"0 59 12 26 10 ? 2013\"</b> <BR/>which means it will run on 26th October of 2013 at 12:59 PM. Which should run only once. When I try to execute the above expression with Quartz gives me error. Please suggest me how to perform Aperiodic Scheduling using Quartz or any other API.<BR/>\nThanks,<BR/>\nSanchit</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":707,"score":8,"question_id":2333407,"title":"Threads in Java","body":"<p>What is the difference between threads in java and native threads?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13172434,"title":"Java : Synchronization of code","body":"<p>I have this piece of code below as shown .\nOur Application runs on 5 web servers controlled by a Load Balancer ,all connecting to one Memcache instance .</p>\n\n<p>I guess that this piece of synchrnozation works only for one Instance .</p>\n\n<p>Please let me know how can i synchrnoze this piece of code when 5 web servers are trying to access the Memcache</p>\n\n<pre><code>public class Memcache {\n    private MemcachedClient memclient = null;  \n    private static Memcache instance = null;\n\n    public static Memcache getInstance() {\n        if (instance == null) {\n            try {\n                synchronized (Memcache.class) {\n                    instance = new Memcache();\n                }\n            } catch (IOException e) {\n                throw new RuntimeException(e);\n            }\n        }\n        return instance;\n    }\n\n    private Memcache() throws IOException {\n        MemcachedClientBuilder builder = new XMemcachedClientBuilder();\n        memclient = builder.build();\n\n    }\n\n}\n</code></pre>\n"},{"tags":["ruby-on-rails","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13121404,"title":"Mutlithreading in Ruby on Rails","body":"<p>in my controller I have a series of nested loops</p>\n\n<pre><code>x.downto(0)\n   y.downto(0)\n      z.downto(0)\n</code></pre>\n\n<p>I would like to ask whether I can split these up in multiple threads kind like</p>\n\n<pre><code>#pragma omp parallel for\n</code></pre>\n\n<p>does in C.</p>\n\n<p>I have tried to use the</p>\n\n<pre><code>Thread.new do\n</code></pre>\n\n<p>method but it does not seem to have any effect.</p>\n\n<p>Thanx in advance.</p>\n"},{"tags":["java","android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13171749,"title":"UI thread freezes","body":"<p>I am creating a new thread using the following function. </p>\n\n<pre><code>public void toCallAsynchronous() {\n    mThread = new Thread() {\n        public void run() {\n            while (true) {\n                try {\n                    // do something here\n                    if(mLoggedIn)\n                    {\n                        boolean syncresult = mDownload.syncData();\n                    }\n                    Log.d(TAG, \"local Thread sleeping\");\n                    Thread.sleep(10000);\n                    //mHandler.postDelayed(this, 1000);\n                } catch (InterruptedException e) {\n                    Log.e(TAG, \"local Thread error\", e);\n                }\n            }\n        }\n    };\n    mThread.start();\n}\n</code></pre>\n\n<p>I am calling this in onResume as I want this thread to start only when user has login into his account. The synData function accesses the server for new files, downloads them and update entry into a database. Could you please identify what I am doing wrong here ?</p>\n"},{"tags":["c#",".net","multithreading","sockets","tcp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":69,"score":-1,"question_id":13082781,"title":"I am getting NULL or 0 in between data read from TCP Socket, What's wrong in my code?","body":"<p>I have written TCP listener in C# with the help of following links</p>\n\n<ul>\n<li><a href=\"http://www.codeproject.com/csharp/BasicTcpServer.asp\" rel=\"nofollow\">http://www.codeproject.com/csharp/BasicTcpServer.asp</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/fx6588te.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/fx6588te.aspx</a></li>\n</ul>\n\n<p>Basically it uses </p>\n\n<pre><code>socket.BeginAccept(AcceptConnection,state); \n</code></pre>\n\n<p>above code to accept the incoming data asynchronously.</p>\n\n<p>My code works fine for hours and days, but sometimes it receive NULL in between the data, but the packet begins and ends as expected.</p>\n\n<p>Sometimes, I get packet data like the following for some records (approx 10 out of 2000)</p>\n\n<p>3,8,99642889,,1,2,9\n123456789123456789,12345678910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023456789,355964043393650,23.59678611,58.44552500,330,10/26/2012.</p>\n\n<p>there are around 10592 0's in between the data.</p>\n\n<p>Wondering if is there any issue in Reading data?,is there any possibility of getting the code stuck somewhere while reading and receiving NULL that time?</p>\n\n<p>I just want to confirm it , so that I can check the solution in right direction.</p>\n\n<p>//MORE INFORMATION ADDED\nTo receive Data from socket , following is the code:</p>\n\n<pre><code>  var data = new StringBuilder();\n  while (true)\n  {\n      var message = new byte[8192];\n      tcpClient.ReceiveBufferSize = 8192;\n      int bytesRead = 0;\n      try\n      {\n          tcpClient.LingerState = new LingerOption(true, 10);\n\n          int socketReadTimeOut = _configurationManager.SocketReadTimeout;\n          if (socketReadTimeOut &gt; 0)\n              tcpClient.ReceiveTimeout = socketReadTimeOut;\n\n          bytesRead = tcpClient.Receive(message);\n      }\n      catch (Exception ex)\n      {\n          if (tcpClient.Connected) { tcpClient.Shutdown(SocketShutdown.Both); }\n          tcpClient.Close();\n          tcpClient.Dispose();\n          break;\n      }\n      if (bytesRead == 0)\n      {\n          break;\n          //the client has disconnected from the server\n      }\n\n      //message has successfully been received\n      foreach (var b in message)\n      {\n          data.Append((char)b);\n      }\n  }\n  return data.ToString();\n</code></pre>\n\n<p>}</p>\n\n<p>You can see that I am using tcpClient.Receive to recevie data with defined buffer size and receive timeout.</p>\n\n<p>Is there any possibility to miss the character in the above code, or to repeat a value like 0 to n number of times (because of buffer is large 8192). (just thinking in another way.)</p>\n\n<p>Is there possibility that receive timeouts sometime and then it fills 0's or nulls in the remaining buffer space?</p>\n"},{"tags":["java","multithreading","deadlock"],"answer_count":15,"favorite_count":18,"up_vote_count":32,"down_vote_count":0,"view_count":20392,"score":32,"question_id":217113,"title":"Deadlock in Java","body":"<p>Long time ago, I saved a sentence from a Java reference book: <em>\"Java has no mechanism to handle deadlock. it won't even know deadlock occurred.\" (Head First Java 2nd Edition, p.516)</em></p>\n\n<p>So, what is about it? Is there a way to catch deadlock case in Java? I mean, is there a way that our code understands a deadlock case occurred?</p>\n"},{"tags":["java","multithreading","exception","exception-handling"],"answer_count":6,"favorite_count":5,"up_vote_count":26,"down_vote_count":0,"view_count":3689,"score":26,"question_id":2126997,"title":"Who is calling the Java Thread interrupt() method if I'm not?","body":"<p>I've read and re-read Java Concurrency in Practice, I've read several threads here on the subject, I've read the IBM article <a href=\"http://www.ibm.com/developerworks/java/library/j-jtp05236.html\" rel=\"nofollow\">Dealing with InterruptedException</a> and yet there's something I'm simply not grasping which I think can be breaked down in two questions:</p>\n\n<ol>\n<li><p>If I'm never ever interrupting other threads myself, what can trigger an <em>InterruptedException</em>?</p></li>\n<li><p>If I'm never ever interrupting other threads myself using <em>interrupt()</em> (say because I'm using other means to cancel my working threads, like poison pills and <em>while (!cancelled)</em> style loop [as both explained in JCIP]), what does an <em>InterruptedException</em> then mean?  What am I supposed to do upon catching one?  Shutdown my app?  </p></li>\n</ol>\n"},{"tags":["objective-c","multithreading","nstimer"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13169220,"title":"NSTimer starts after the method which is called after it finishes","body":"<p>Im using an NSTimer to update a UIProgressView so that every second the progess is increased by 0.1.</p>\n\n<pre><code>-(void)updateBar{\n     NSLog(@\"Increase by 0.1\");\n     pbar.progress=pbar.progress+0.1;\n }\n\n -(void)foo{\n    NSLog(\"START Foo\");\n    //Does some stuff that takes about 10sec\n    NSLog(\"FINISH Foo\");\n }\n\n -(void) viewDidLoad{\n     pbar = [[UIProgressView alloc] initWithFrame:CGRectMake(-280, 500, 730, 90)];\n     pbar.progressViewStyle = UIProgressViewStyleDefault;\n     pbar.progressTintColor = [UIColor colorWithRed:68.0/255 green:186.0/255 blue:41.0/255 alpha:1.0];\n     pbar.progress = 0.0;\n     pbar.transform = CGAffineTransformMakeRotation(90 * M_PI / 180.0);\n     [self.view addSubview:pbar];\n\n     [NSTimer scheduledTimerWithTimeInterval: 1.0 target:self selector:@selector(updateBar) userInfo:nil repeats: YES];\n\n     [self foo];\n }\n</code></pre>\n\n<p>So ideally the UIProgressView's progress increases during the time the foo method is running. However, the timer starts after the foo method finishes so my console ends up looking like this...</p>\n\n<pre><code>START Foo\nFINISH Foo\nIncrease by 0.1\nIncrease by 0.1\nIncrease by 0.1\nAnd so on ....\n</code></pre>\n\n<p>Any idea why this might happen? And more importantly how do I get it to do what I want and get the timer to start running before foo is called.</p>\n"},{"tags":["multithreading","direct3d11","dxgi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":10202367,"title":"What should I do with multiple swapchains in DXGI?","body":"<p>It's confusing here. Is it that one swap chain cannot be accessed concurrently, or DXGI is completely not thread safe?</p>\n\n<p>If I have 2 swap chains for 2 display on one card, what is the best way I swap them? I can hardly find any resource on multiple swap chains.</p>\n"},{"tags":["java","multithreading","time","observer-pattern","simulator"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13166850,"title":"Fire events based on a text file","body":"<p>I have a text file that contains records of events, each with a timestamp. I want to create an engine that simulates the data from the file, in real time. Eventually my project will work with live data, but I am trying to create a testing framework.</p>\n\n<p>In other words:</p>\n\n<ol>\n<li><code>Simulator</code> Thread\n<ul>\n<li>Read file, create event when timestamp occurs</li>\n</ul></li>\n<li><code>Worker</code> thread\n<ul>\n<li>Process data (this is the code will remain when we go to production)</li>\n</ul></li>\n<li>Event handoff / <code>Notifier</code> thread??? (See below)</li>\n</ol>\n\n<p>I am trying to figure out how best to implement <code>Simulator</code>. It seems wrong to me to read one line at a time, and then sleep the number of milliseconds until that event occurs. Some events are less than 10 ms apart. What I'd like to do is have an event queue so that I can get ahead when events are far apart, so that I have minimal processing to do when they are near each other.</p>\n\n<p>Perhaps <code>Simulator</code> should really be 2 threads, one that reads the file and puts events in the queue, and one that handles them and fires off events to the work thread (see above, <code>Notifier</code> thread). Does that sound reasonable? Below is some code that outlines what I'm thinking. Am I on the right track? Not included here is the thread that reads the file and creates <code>MyEvent</code>s.</p>\n\n<pre><code>public class Notifier implements Runnable {\n    private long firstStartTime;\n    private long realStartTime;\n    private Worker theWorker;\n\n    public void run() {\n        while(true) {\n            if (eventQueue.peek().getTriggerTime() - this.firstStartTime &gt;=\n                    System.currentTimeMillis() - this.realStartTime) {\n                GlobalQueue.getInstance().offer(eventQueue.poll());\n                theWorker.notify();\n            }\n        }\n    }\n}\n\npublic class GlobalQueue implements Queue&lt;MyEvent&gt; {\n    private Queue&lt;MyEvent&gt; myQueue;\n    private static GlobalQueue _instance = new GlobalQueue();\n    private GlobalQueue() {\n        myQueue = new LinkedList&lt;MyEvent&gt;();\n    }\n    public static getInstance() { return _instance; }\n}\n\npublic class Worker implements Observer, Runnable {\n    public void run() {\n        while(true) {\n            if(events.peek() != null) {\n                 MyEvent event = GlobalQueue.getInstance().poll();\n                 // handle the event\n            }\n            wait();\n        }\n    }\n}\n</code></pre>\n\n<p>What do you think? Good, or would you make major design changes?</p>\n"},{"tags":["c++","multithreading","pthreads","mutex","access-violation"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":45,"score":3,"question_id":13165822,"title":"Pthread_mutex_lock returning access error","body":"<p>I'm writing a program that reads and processes large amounts of data. To speed up the process I've implemented multithreaded reading/processing using the Pthreads library for C++. When I call pthread_mutex_lock(&amp;lock1) on my mutex however, my program errors out giving me an \"access violation reading location\" error on the address of lock1. I needed to run these threads on methods of a class, which required some maneuvering to pull off within the restrictions of the pthread library and it's somewhere in that maneuvering that I made my mistake. Below is the abbreviated version of my code, sorry for the tl;dr. Shortened it as much as possible without leaving out any sections critical to the multithreading:</p>\n\n<pre><code>#include \"pthread.h\"\n#include &lt;assert.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;Windows.h&gt;\n\n\n/*Ideally I need to create one instance of this object that has the run_stuff method \nbeing executed by two different threads.  I need both threads to have access to the \nsame private variables, and have ensured that those variables won't be accessed at the \nsame time. That is the end goal of my multithreading*/\n\nclass test_obj {\npublic:\n    test_obj();\n    void run_stuff(int); //the method I want to run on two different threads using the same private variables\nprivate:\n    int count;\n    void switch_gate1();//switches the value of gate 1\n    void switch_gate2();\n    bool test_gate1(int); //checks to see if gate 1 equals thread id\n    bool test_gate2(int);\n    bool gate1, gate2; //can only be accessed under a locked mutex\n    pthread_mutex_t lock1, lock2;\n};\n\n/*This structure is what I pass to pthread_create*/\nstruct thread_args { //arguements passed to a thread when it is created\n    thread_args() {a = new test_obj;}; //constructor: create new test_obj instance\n    test_obj *a; //pointer to a test_obj instance, I think both threads receive a pointer to the same instance\n    int t_id; //ID of thread being created\n};\n\nclass thread_helper { //managing function to create threads and call run_stuff method\npublic:\n    thread_helper() {args = new thread_args;};\n    void my_method(); //called from main, creates threads and runs them\nprivate:\n    thread_args *args; //pointer to a thread_args obj\n    static void* execute(void *ptr); //method to be run by created threads\n    pthread_t m_thread1, m_thread2; //the two threads\n};\n\nint main() {\n    thread_helper c; \n    c.my_method();\n    return 0;\n}\n\ntest_obj::test_obj() {\n    count = 0; //not important right now, test variable\n    gate1 = 0; //thread 0 gets first access\n    gate2 = 0; //thread 0 gets first access\n}\n\nvoid thread_helper::my_method() {\n    int error_code;\n    thread_args *a, *b;\n    *a = *b = *args;\n    a-&gt;t_id = 0;\n    b-&gt;t_id = 1;\n    error_code = pthread_create(&amp;m_thread1, NULL, &amp;thread_helper::execute, (void*)a); //create thread 0 to run execute method\n    assert(0 == error_code); //check for success\n    error_code = pthread_create(&amp;m_thread2, NULL, &amp;thread_helper::execute, (void*)b);\n    assert(0 == error_code);\n    error_code = pthread_join(m_thread1, NULL);//wait for thread 0\n    assert(0 == error_code);\n    error_code = pthread_join(m_thread2, NULL); //wait for thread 1\n    assert(0 == error_code);\n}\n\nvoid* thread_helper::execute(void *ptr) {\n    thread_args *b = (thread_args*)ptr;//recast ptr back into thread_args type\n    int t_id = b-&gt;t_id;//save thread id\n    b-&gt;a-&gt;run_stuff(t_id);//access test_obj object from thread_args (should be same object for both threads) and run method\n    return NULL;\n}\n\nvoid test_obj::run_stuff(int t_id) {\n    for(int i = 0; i &lt; 2; i++) { //run twice (give a chance for threads to flip flop)\n    //-----Part 1\n    while(!test_gate1(t_id)){//while not allowed to proceed\n        Sleep(500);//sleep\n    }\n    printf(\"thread %d reporting in\\n\", t_id);//thread has gained access to part 1, print id\n    switch_gate1();//allow opposite thread in\n    //-----Part 2\n    while(!test_gate2(t_id)){//wait for access to part 2\n        Sleep(500);\n    }\n    //count++; //just a dummy place for now, will be used later to check access\n    switch_gate2();//allow opposite thread in\n    }\n}\n\nbool test_obj::test_gate1(int t_id) {//returns true if id of calling thread matches value of gate 1\n//a return value of true means a thread is allowed to proceed, false otherwise\n    pthread_mutex_lock(&amp;lock1);**//secure access to gate THIS IS WHAT ERRORS OUT**\n    if(t_id == gate1){//check gate\n        pthread_mutex_unlock(&amp;lock1);//release gate\n        return true;//return\n    }\n    else {\n        pthread_mutex_unlock(&amp;lock1);\n        return false;\n    }\n}\n\nbool test_obj::test_gate2(int t_id) {\n    pthread_mutex_lock(&amp;lock2);\n    if(t_id == gate2){\n        pthread_mutex_unlock(&amp;lock2);\n        return true;\n    }\n    else {\n        pthread_mutex_unlock(&amp;lock2);\n        return false;\n    }\n}\n\n/*Switch gate functions are designed to obtain access to the boolean gate (prevent the opposing thread from checking the gate by means of mutex), then switch the value of the boolean gate and release the gate for the other thread to check.*/\nvoid test_obj::switch_gate1() {\n    pthread_mutex_lock(&amp;lock1);//secure access to gate\n    gate1 = !gate1; //flip gate\n    pthread_mutex_unlock(&amp;lock1); //release gate\n}\n\nvoid test_obj::switch_gate2() {\n    pthread_mutex_lock(&amp;lock2);\n    gate2 = !gate2;\n    pthread_mutex_unlock(&amp;lock2);\n}\n</code></pre>\n\n<p>Sorry about the formatting. Any one have any idea why that lock would have access violation errors? I've tried putting it everywhere. Private, public, and even global as a last resort. They all give the same error.  Thanks in advance.</p>\n\n<p>EDIT: Fixed an error in passing my thread_args variable to pthreads_create. Works as expected now after that and the initialize/destroy fix.</p>\n"},{"tags":["mysql","multithreading","perl","fork","message-queue"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":13162235,"title":"To fork or not to fork?","body":"<p>I am re-developing a system that will send messages via http to one of a number of suppliers. The original is perl scripts and it's likely that the re-development will also use perl.</p>\n\n<p>In the old system, there were a number of perl scripts all running at the same time, five for each supplier. When a message was put into the database, a random thread number (1-5) and the supplier was chosen to ensure that no message was processed twice while avoiding having to lock the table/row. Additionally there was a \"Fair Queue Position\" field in the database to ensure that a large message send didn't delay small sends that happened while the large one was being sent.</p>\n\n<p>At some times there would be just a couple of messages per minute, but at other times there would be a dump of potentially hundreds of thousands of messages. It seems to me like a resource waste to have all the scripts running and checking for messages all of the time so I am trying to work out if there is a better way to do it, or if the old way is acceptable.</p>\n\n<p>My thoughts right now lie with the idea of having one script that runs and forks as many child processes as are needed (up to a limit) depending on how much traffic there is, but I am not sure how best to implement it such that each message is processed only once, while the fair queuing is maintained.</p>\n\n<p>My best guess right now is that the parent script updates the DB to indicate which child process should handle it, however I am concerned that this will end up being less efficient than the original method. I have little experience of writing forking code (last time I did it was about 15 years ago).</p>\n\n<p>Any thoughts or links to guides on how best to process message queues appreciated!</p>\n"}]}
{"total":30059,"page":5,"pagesize":100,"questions":[{"tags":["java","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":882,"score":6,"question_id":11360401,"title":"Java Synchronized list","body":"<p>I have a pre-populated array list. And I have multiple threads which will remove elements from the array list. Each thread calls the remove method below and removes one item from the list. Does the following code give me consistent behavior ?</p>\n\n<pre><code>ArrayList&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;String&gt;());\n\nvoid remove(String item)\n{\n     do something; (doesn't work on the list)\n     list.remove(item);\n}\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["multithreading","tbb","intel-ipp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":13038977,"title":"combining Intel IPP and TBB","body":"<p>I am trying to gain further improvement in my Image Resizing algorithm by combining IPP and TBB. The two ways that I can accomplish this task are:</p>\n\n<ol>\n<li>Use IPP without TBB</li>\n<li>Use IPP with TBB inside a parallel_for loop</li>\n</ol>\n\n<p>My question is that I have coded the application, and I get correct result. But surprisingly, my computational time is larger when they are combined. To avoid clutter, I only paste part of my code in here. But I can provide the whole code if needed. For the first case when I use only IPP, the code is like: (The base of the algorithm was borrowed from the Intel TBB sample code for Image resizing)</p>\n\n<pre><code>ippiResizeSqrPixel_8u_C1R(src, srcSize, srcStep, srcRoi, dst, dstStep, dstRoi, \nm_nzoom_x,m_nzoom_y,0, 0, interpolation, pBufferWhole);\n</code></pre>\n\n<p>and the parallel_for loop looks like this:</p>\n\n<pre><code>parallel_for(\n    blocked_range&lt;size_t&gt;(0,CHUNK),\n    [=](const blocked_range&lt;size_t&gt; &amp;r){\n        for (size_t i= r.begin(); i!= r.end(); i++){\n            ippiResizeSqrPixel_8u_C1R(src+((int)(i*srcWidth*srcHeight)), srcSize, \nsrcStep, srcRoi, dst+((int)(i*dstWidth*dstHeight)), dstStep, dstRoi, \nm_nzoom_x,m_nzoom_y,0, 0, interpolation, pBuffer);\n        }\n    }\n);\n</code></pre>\n\n<p><code>src</code> and <code>dst</code> are pointers to the source image and the destination image. When TBB is used, the image is partitioned into <code>CHUNKS</code> parts and the parallel_for loops through all the <code>CHUNKS</code> and uses an IPP function to resize each CHUNK independently. The value for <code>dstHeight</code>, <code>srcHeight</code>, <code>srcRoi</code>, and <code>dstRoi</code> are modified to accommodate the partitioning of the image, and <code>src+((int)(i*srcWidth*srcHeight))</code> and <code>dst+((int)(i*dstWidth*dstHeight))</code> will point to the beginning of each partition in the source and destination image.</p>\n\n<p>Apparently, IPP and TBB can be combined in this manner -- as I get the correct result -- but what baffles me is that the computational time deteriorates when they're combined compared to when IPP is used alone. Any thought on what could be the cause, or how I could solve this issue? </p>\n\n<p>Thanks! </p>\n"},{"tags":["c#","multithreading","deadlock","manualresetevent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":13160479,"title":"Is this code [theoretically] thread-unsafe?","body":"<p>I'm experiencing a strange deadlock in the code that I've written.</p>\n\n<p>The idea is to implement an asynchronous operation whose <strong>Stop</strong> is synchronous -- the caller has to wait until it completes. I've simplified the part where real work is done to a simple property increment (<code>++Value</code>, see below); in reality though, a heavy COM component is invoked which is very sensitive to threads.</p>\n\n<p>The deadlock I'm experiencing is in the <code>Stop()</code> method where I explicitly wait for a manual-reset event that identifies a completed operation.</p>\n\n<p>Any ideas what I could have done wrong? The code should be self-contained and compilable on its own.</p>\n\n<pre><code>using System;\nusing System.ComponentModel;\nusing System.Threading;\nusing System.Windows.Forms;\n\nusing ThreadingTimer = System.Threading.Timer;\n\nnamespace CS_ManualResetEvent\n{\n    class AsyncOperation\n    {\n        ThreadingTimer   myTimer;                 //!&lt; Receives periodic ticks on a ThreadPool thread and dispatches background worker.\n        ManualResetEvent myBgWorkerShouldIterate; //!&lt; Fired when background worker must run a subsequent iteration of its processing loop.\n        ManualResetEvent myBgWorkerCompleted;     //!&lt; Fired before the background worker routine exits.\n        BackgroundWorker myBg;                    //!&lt; Executes a background tasks\n        int              myIsRunning;             //!&lt; Nonzero if operation is active; otherwise, zero.\n\n        public AsyncOperation()\n        {\n            var aTimerCallbac = new TimerCallback(Handler_Timer_Tick);\n            myTimer = new ThreadingTimer(aTimerCallbac, null, Timeout.Infinite, 100);\n\n            myBg = new BackgroundWorker();\n            myBg.DoWork += new DoWorkEventHandler(Handler_BgWorker_DoWork);\n\n            myBgWorkerShouldIterate = new ManualResetEvent(false);\n            myBgWorkerCompleted = new ManualResetEvent(false);\n        }\n\n        public int Value { get; set; }\n\n        /// &lt;summary&gt;Begins an asynchronous operation.&lt;/summary&gt;\n        public void Start()\n        {\n            Interlocked.Exchange(ref myIsRunning, 1);\n\n            myTimer.Change(0, 100);\n\n            myBg.RunWorkerAsync(null);\n        }\n\n        /// &lt;summary&gt;Stops the worker thread and waits until it finishes.&lt;/summary&gt;\n        public void Stop()\n        {\n            Interlocked.Exchange(ref myIsRunning, 0);\n\n            myTimer.Change(-1, Timeout.Infinite);\n\n            // fire the event once more so that the background worker can finish\n            myBgWorkerShouldIterate.Set();\n\n            // Wait until the operation completes; DEADLOCK occurs HERE!!!\n            myBgWorkerCompleted.WaitOne();\n\n            // Restore the state of events so that we could possibly re-run an existing component.\n            myBgWorkerCompleted.Reset();\n            myBgWorkerShouldIterate.Reset();\n        }\n\n        void Handler_BgWorker_DoWork(object sender, EventArgs theArgs)\n        {\n            while (true)\n            {\n                myBgWorkerShouldIterate.WaitOne();\n\n                if (myIsRunning == 0)\n                {\n                    //Thread.Sleep(5000);   //What if it takes some noticeable time to finish?\n\n                    myBgWorkerCompleted.Set();\n\n                    break;\n                }\n\n                // pretend we're doing some valuable work\n                ++Value;\n\n                // The event will be set back in Handler_Timer_Tick or when the background worker should finish\n                myBgWorkerShouldIterate.Reset();\n            }\n\n            // exit\n        }\n\n        /// &lt;summary&gt;Processes tick events from a timer on a dedicated (thread pool) thread.&lt;/summary&gt;\n        void Handler_Timer_Tick(object state)\n        {\n            // Let the asynchronous operation run its course.\n            myBgWorkerShouldIterate.Set();\n        }\n    }\n\n    public partial class Form1 : Form\n    {\n        private AsyncOperation myRec;\n        private Button btnStart;\n        private Button btnStop;\n\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        private void Handler_StartButton_Click(object sender, EventArgs e)\n        {\n            myRec = new AsyncOperation();\n            myRec.Start();\n\n            btnStart.Enabled = false;\n            btnStop.Enabled = true;\n        }\n\n        private void Handler_StopButton_Click(object sender, EventArgs e)\n        {\n            myRec.Stop();\n\n            // Display the result of the asynchronous operation.\n            MessageBox.Show (myRec.Value.ToString() );\n\n            btnStart.Enabled = true;\n            btnStop.Enabled = false;\n        }\n\n        private void InitializeComponent()\n        {\n            btnStart = new Button();\n            btnStop  = new Button();\n            SuspendLayout();\n\n            // btnStart\n            btnStart.Location = new System.Drawing.Point(35, 16);\n            btnStart.Size = new System.Drawing.Size(97, 63);\n            btnStart.Text = \"Start\";\n            btnStart.Click += new System.EventHandler(Handler_StartButton_Click);\n\n            // btnStop\n            btnStop.Enabled = false;\n            btnStop.Location = new System.Drawing.Point(138, 16);\n            btnStop.Size = new System.Drawing.Size(103, 63);\n            btnStop.Text = \"Stop\";\n            btnStop.Click += new System.EventHandler(Handler_StopButton_Click);\n\n            // Form1\n            ClientSize = new System.Drawing.Size(284, 94);\n            Controls.Add(this.btnStop);\n            Controls.Add(this.btnStart);\n            Text = \"Form1\";\n            ResumeLayout(false);\n        }\n    }\n\n    static class Program\n    {\n        /// &lt;summary&gt;\n        /// The main entry point for the application.\n        /// &lt;/summary&gt;\n        [STAThread]\n        static void Main()\n        {\n            Application.EnableVisualStyles();\n            Application.SetCompatibleTextRenderingDefault(false);\n            Application.Run(new Form1());\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13166417,"title":"IllegalMoniterStateException","body":"<p>I get an illegalMoniterStateException whenever I call wait() and notify() or notifyAll(). The javadoc says that I should be getting that exception if my thread \"has attempted to wait on an object's monitor or to notify other threads waiting on an object's monitor without owning the specified monitor.\"</p>\n\n<p>However, here is an example of the code where I call those methods above.</p>\n\n<pre><code>//note that doSomething will be called by a thread from another class, not this one\npublic void doSomething(){\n    while(objectsCurrentlyDoingSomething() &gt;= thisClass'sCapacity){\n         synchronized(objectLock){ //objectLock is created at top of class like this:\n             wait(2000);           //private static final Object objectLock = new Object();\n         }\n    }\n\n    //rest of code\n}\n</code></pre>\n\n<p>Then later on I release one threads hold on that lock by saying that if object finishes, decreases number of objects currently using and notify().</p>\n\n<pre><code>....object finished......\nsynchronized(objectLock){\n    notify();\n}\n</code></pre>\n"},{"tags":["multithreading","perl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":6553598,"title":"Load modules in Perl at run time and share it between threads","body":"<p>Is it possible to load modules at run time, <code>require '/file_path/file_name.pm';</code> , and share the memory between threads?</p>\n\n<p>Basically, I have a pool of threads, if thread#1 decides to load a module, I want the module available to all the threads!  </p>\n"},{"tags":["iphone","objective-c","multithreading","nsurlconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13166243,"title":"NSUrlConnection Background Thread Lockup","body":"<p>I've written some classes to handle my connections and xml parsing, but, I'm encountering issues when using a button press to issue the command. </p>\n\n<pre><code>-(IBAction)testClass:(id)sender{\n\nConnectionHandler *connectionTest = [[ConnectionHandler alloc] initWithRequestType:3];\n\n}\n</code></pre>\n\n<p>Everything runs fine, the connection is made, XML is parsed...but as soon as the button method hits that ending parenthesis the thread goes into lock down and the app freezes. All the connection/XML parsing is standard stuff. Is there something I'm missing to prevent the thread from freezing? </p>\n\n<p>The thread error: EXC_BAD_ACCESS(code=2,address=0x163cc)</p>\n"},{"tags":["objective-c","ios","multithreading","core-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13166240,"title":"Is NSFetchRequest with an NSPredicate containing a NSManagedObjectID safe to pass across thread boundaries?","body":"<p>If I've created an <code>NSFetchRequest</code> on the main thread like so:</p>\n\n<pre><code>NSManagedObject *bar = ...;\nNSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@\"Foo\"];\n[fetchRequest setPredicate:[NSPredicate predicateWithFormat:@\"SELF.bar == %@\",\n                            [bar objectID]]];\n</code></pre>\n\n<p>Is it safe to pass this <code>NSFetchRequest</code> with an <code>NSPredicate</code> that contains a <code>NSManagedObjectID</code> to a background thread like so?</p>\n\n<pre><code>NSManagedObject *bar = nil;\nNSFetchRequest *fetchRequest = [NSFetchRequest fetchRequestWithEntityName:@\"Foo\"];\n[fetchRequest setPredicate:[NSPredicate predicateWithFormat:@\"SELF.bar == %@\",\n                            [bar objectID]]];\n\nNSPersistentStoreCoordinator *persistentStoreCoordinator = ...;\n[[NSBlockOperation blockOperationWithBlock:^{\n    NSManagedObjectContext *managedObjectContext = [NSManagedObjectContext new];\n    [managedObjectContext setPersistentStoreCoordinator:nil];\n    NSArray *foos = [managedObjectContext executeFetchRequest:fetchRequest\n                                                        error:NULL];\n}] start];\n</code></pre>\n"},{"tags":["java","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13164324,"title":"Concurrent operation in a synchronized block","body":"<p>There is a scenario in my Application where a Thread under its run method while(true) condition does this OPeration .</p>\n\n<p>Under its while true condition , it continuasally fetches information from a  External Data Source(Memcache)  , adds / removes content from it,  depending on newly  logged in or logged out users , and finally  updates  it back to Memcache .</p>\n\n<p>Some Snipet of code </p>\n\n<pre><code>public class MonitoringThread extends Thread \n{\npublic void run() {\nwhile(true)\nString  response = Memcache.get(\"USERINFO\");\n// Some checks will be made on response and builds a new response and updates back to Memcache .\nsynchronized (response)\n{\nMemcache.set(\"USERINFO\" , response) ;\n}\n}\n}\n</code></pre>\n\n<p>My question is </p>\n\n<ol>\n<li><p><strong>I have kept a Synchronized block on  a set operation (Is this correct ) or it should be done while doing a get Operation ??</strong></p></li>\n<li><p><strong>And the parameter that is passed to the Synchronied block , whether this should be this (the class itself) or the String  response</strong> </p></li>\n</ol>\n\n<p>Some more information .</p>\n\n<p>Our Application runs on 5 Web Server instances controlled by  a Load Balancer . ( All these 5 Instances will do that get Operation and Updates Data back ) </p>\n\n<p>Please share your ideas .</p>\n\n<p>Thanks for reading , have a great day .</p>\n\n<p><strong>Edited Part</strong> </p>\n\n<p>Thanks for the response , </p>\n\n<p>I have changed the synchronized block parameter , please let me know what is fesable appproach below </p>\n\n<p><strong>Option 1</strong> </p>\n\n<p>Using synchronied block in the Thread </p>\n\n<pre><code>synchronized (Memcache.class)\n{\nMemcache.set(\"USERINFO\" , response) ;\n}\n\n\nclass Memcache\n{\npublic static boolean set(String key, Object value) {\nMemcacheClient.set(key, 0, value);\n}\n</code></pre>\n\n<p>Or </p>\n\n<p>Using Synchronied block in the Memcache class itself </p>\n\n<pre><code>class Memcache\n{\nsynchronized (Memcache.class)\n{\npublic static boolean set(String key, Object value) {\nMemcacheClient.set(key, 0, value);\n}\n</code></pre>\n\n<p>// other methods\n    }</p>\n"},{"tags":["multithreading","google-app-engine","transactions","gae-datastore","objectify"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":13019565,"title":"XG transaction isolation fails during test that generates unique sequence number (Objectify4)","body":"<p>I have to generate a unique invoice number in a XG transaction that includes the following <strong>3 entity groups</strong> in my data model :</p>\n\n<ul>\n<li><p>(toplevel) ContactRoot &lt;-- (ancestor) &lt;--- <strong>Contact</strong> : contact must be updated to status Client during the transaction</p></li>\n<li><p>(toplevel) <strong>CustomerSettings</strong> : holds the next sequence number to use; there is one and only one instance of the CustomerSettings with a fixed, static ID; the sequence number must be increased +1 during the transaction</p></li>\n<li><p>(toplevel) InvoiceRoot &lt;-- (ancestor) &lt;--- <strong>Invoice</strong> : assign new unique invoice number based on the sequence number in CustomerSettings;</p></li>\n</ul>\n\n<p>This is the essential part of the DAO implementation (irrelevant business rules checks etc removed) :</p>\n\n<pre><code>public void saveInvoice(final Invoice invoice) throws BusinessRuleException {\n\n    final Objectify ofy = ObjectifyService.factory().begin().cache(true);\n    ofy.transact(new Work&lt;Void&gt;() {\n\n        @Override\n        public Void run() {\n            CustomerSettings customerSettings = ofy.load()\n                    .key(Key.create(CustomerSettings.class, CustomerSettings.ID)).safeGet();\n            Contact contact = ofy.load().key(createContactKey(invoice.getContactId()).safeGet();\n            contact.setContactType(ContactType.CLIENT);\n            ofy.save().entity(contact).now();\n            String invoiceNumber = generateSequence(ofy, customerSettings);\n            invoice.setInvoiceNumber(invoiceNumber);\n            ofy.save().entity(invoice).now();\n            return null;\n        }\n    });\n}\n</code></pre>\n\n<p>And the simplified version to generate the next sequence number where the next sequence number is increased for the next call and the CustomerSettings must be transactionally updated (I have this synchronized but I guess that is not really useful)\n :</p>\n\n<pre><code>private synchronized String generateSequence(Objectify ofy, CustomerSettings settings) {\n    String ret = \"\";\n    int sequence = settings.getNextSequence();\n    settings.setNextSequence(sequence + 1);\n    ofy.save().entity(settings).now();\n    ret = \"\" + sequence;\n    return ret;\n}\n</code></pre>\n\n<p>This is what my unit test looks like for a <strong>variable thread count</strong> :</p>\n\n<pre><code>private void test(final int threadCount) throws InterruptedException, ExecutionException {\n    final Environment currentEnvironment = ApiProxy.getCurrentEnvironment();\n    Callable&lt;String&gt; task = new Callable&lt;String&gt;() {\n        @Override\n        public String call() {\n            ApiProxy.setEnvironmentForCurrentThread(currentEnvironment);\n            return generateInvoiceNumber();\n        }\n    };\n    List&lt;Callable&lt;String&gt;&gt; tasks = Collections.nCopies(threadCount, task);\n    ExecutorService executorService = Executors.newFixedThreadPool(threadCount);\n    List&lt;Future&lt;String&gt;&gt; futures = executorService.invokeAll(tasks);\n    List&lt;String&gt; resultList = new ArrayList&lt;String&gt;(futures.size());\n    // Check for exceptions\n    for (Future&lt;String&gt; future : futures) {\n        // Throws an exception if an exception was thrown by the task.\n        resultList.add(future.get());\n    }\n    // Validate the IDs\n    Assert.assertEquals(futures.size(), threadCount);\n    List&lt;String&gt; expectedList = new ArrayList&lt;String&gt;(threadCount);\n    for (long i = 1; i &lt;= threadCount; i++) {\n        expectedList.add(\"\" + i);\n    }\n    Collections.sort(resultList);\n    Assert.assertEquals(expectedList, resultList);\n}\n\n@SuppressWarnings(\"unchecked\")\nprivate String generateInvoiceNumber() {\n    InvoiceDAO invoiceDAO = new InvoiceDAO();\n    Invoice invoice = ... create a valid invoice\n    invoiceDAO.saveInvoice(invoice);\n    log.info(\"generated invoice number : \" + invoice.getInvoiceNumber());\n    return invoice.getInvoiceNumber();\n}\n</code></pre>\n\n<p>for instance when I run this with 32 threads simultaneous :</p>\n\n<pre><code>@Test\npublic void test32() throws InterruptedException, ExecutionException {\n    test(32);\n}\n</code></pre>\n\n<p><strong>But subsequent threads do not see that a previous transaction increased the invoice number sequence.</strong></p>\n\n<p>This is the result :</p>\n\n<blockquote>\n  <p>junit.framework.AssertionFailedError: expected:&lt;[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,\n  25, 26, 27, 28, 29, 30, 31, 32]> but was:&lt;[1, 1, 1, 1, 1, 1, 1, 1, 1,\n  1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3,\n  3]></p>\n</blockquote>\n\n<p>I went through the docs already a couple of times, can't figure out why this is not working ? </p>\n\n<blockquote>\n  <p>If you access more than one entity group in a transaction, the\n  transaction with be an XG transaction. If you do access only one, it\n  is not. The standard limit of 5 EGs applies to all transactions.\n  <a href=\"http://code.google.com/p/objectify-appengine/wiki/Transactions\" rel=\"nofollow\">objectify transactions documentation</a></p>\n</blockquote>\n\n<p>what am I doing wrong ?</p>\n"},{"tags":["multithreading","visual-studio-2008","visual-studio-debugging","exit-code"],"answer_count":1,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":50,"score":7,"question_id":13163785,"title":"Is it possible to break on thread exit with specific error code?","body":"<p>I was wondering if it was possible to configure visual studio 2008 debugger to stop execution when a thread exits with a precise error code (or at least any non-zero value). My app use a tremendous number of threads, so it's impossible to track them all manually. </p>\n\n<p>Is there a way to tell VS2008 to break when ANY thread in the program hits \"exit(X);\" (X being different from 0) and display source ?</p>\n"},{"tags":["java","multithreading","java-ee","ejb","threadpool"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13161634,"title":"Thread creation in JavaEE EJB/Web containers","body":"<p>I read in Adam Bien's JavaEE night hacks book that while thread creation is prohibited on EJB containers, this is not the case for web containers. He actually creates a thread pool executor in his x-ray probe which runs on Tomcat.</p>\n\n<p>I'm a little confused now. While I faced situations in which I had to do manual thread-pool management in an EE app, I can somehow understand why it would be a bad idea to manually create threads in a JavaEE container. However, I don't understand the difference between an EJB container and a web container respecting thread creation when you can deploy a great portion of EJBs to either one. If there is nothing wrong with a session bean spawning threads in a web container, what issue could be caused by deploying the same session bean to an EJB container?</p>\n"},{"tags":["android","multithreading","asynchronous","download","mp3"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":237,"score":0,"question_id":5803774,"title":"How to download an MP3 file","body":"<p>I want to download an mp3 file using an <code>AsyncTask</code> or a thread.</p>\n\n<p>How can I do this?</p>\n"},{"tags":["java","multithreading","runnable","executorservice"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13161625,"title":"Same Runnable class being passed twice to the ExecutorService running two/multiple threads at the same time","body":"<p>I have multiple runnable classes and I want to run them with executor service through a centralized class (call it Launcher class which contains list of all runnables).</p>\n\n<p>I wrote a <code>Launcher</code> class which takes all the beans to instantiate using <code>applicationContext.getBean()</code>. Each runnable class also defines a <code>pool size</code> for it (number of threads to spawn for this runnable).</p>\n\n<pre><code>public class DaemonsLauncher {\n\n    @Autowired\n    private ApplicationContext appContext;\n\n    private List&lt;Daemon&gt; daemons = new ArrayList&lt;Daemon&gt;();\n\n    private ScheduledThreadPoolExecutor executor;\n\n    private void initThreadPool() throws Exception {\n        //daemonNames coming at run time from somewhere.\n                List&lt;String&gt; daemonList = Arrays.asList(daemonNames.split(Constant.COMMA));\n        //Pool size will now be summation of all the pool sizes.\n        int poolSize = 0;\n        for (String dName : daemonList) {\n            Daemon daemon = appContext.getBean(dName, Daemon.class);\n            poolSize += daemon.getPoolSize();\n            daemons.add(daemon);\n        }\n        executor = new ScheduledThreadPoolExecutor(poolSize);\n    }\n\n    public void launchDaemons() throws Exception {\n        for (Daemon daemon : daemons) {\n            for (int currentThreadCount = 1; currentThreadCount &lt;= daemon.getPoolSize(); currentThreadCount++) {\n                executor.scheduleWithFixedDelay(daemon, 0, XYZ, ABC);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>In the process of doing it, I add all runnables to a <code>List&lt;Daemon&gt;</code> (where Daemon is a abstract runnable class which is extended by other daemons).</p>\n\n<pre><code>public abstract class Daemon implements Runnable {\n\n    protected int poolSize = 1;\n\n    public int getPoolSize() {\n        return poolSize;\n    }\n\n    @Override\n    public void run() {\n                //Calls run methods of individual runnables here.\n        }\n    }\n\n}\n</code></pre>\n\n<p>As you can see, I add same instance of each runnable class multiple times(depending on poolSize) while executing.</p>\n\n<p><code>executor</code> being a <code>ScheduledThreadPoolExecutor</code>.</p>\n\n<p>The moment, run method of <code>R</code> is called, I find same instance of runnable class both the times since they were taken only once by <code>appContext.getBean()</code> (checked by printing hasCode and toString).</p>\n\n<p>But these multiple instances of runnable class run at the same time.</p>\n\n<p>What might be the issue with this sort of case? Are these multiple threads running for same runnable will cause issues or it will go fine?</p>\n\n<p>As an alternative, depending on poolSize, I can get multiple instances of the Runnable class even before this loop and loop only once depending on all the 'Runnable' entries present in the List.</p>\n\n<ol>\n<li>All beans are prototype in nature (though it will not come into picture as I have called appContext.getBean only once).</li>\n<li><p>A <code>sample Runnable class</code>.</p>\n\n<pre><code>  public class R extends Daemon {\n        @Override\n        public void runIndividualDaemon() {\n            //Called by run of Daemon class.\n                    logger.info(\"Running Daemon.\" + this.hashCode() + \" \" + this.toString());\n                   }\n        }\n        @Override\n        protected void init() throws Exception {\n            this.poolSize = 5;\n        }\n</code></pre>\n\n<p>}</p></li>\n</ol>\n\n<p>Thanks,</p>\n"},{"tags":["java","multithreading","cyclicbarrier"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":10949272,"title":"Exclude a specific thread from CyclicBarrier","body":"<p>For my homework I have to make a game of several kings moving across the chess board. Each king must move from his unique starting to unique ending position in own thread. Before making his move king must sleep for up to 10 milliseconds (a bit of randomness) then wait for others to make their moves. </p>\n\n<p>I've solved the problem of kings waiting for each other to make a move with <code>CyclicBarrier</code>, but the problem arises when one of the kings gets to his ending position thus stopping his own thread. The <code>CyclicBarrier</code> is then waiting for the thread to call the await() method but that never happens since the thread isn't running anymore.</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["c#",".net","winforms","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13162782,"title":"Problems trying to pass events between threads","body":"<p>i need some clarifications about the multithreading programming model, becuase, rarely i have to deal with it (mostly all the time i do web-programming).</p>\n\n<h2>Antecedents</h2>\n\n<p>i have a program that i have made in C# basically it's a data monitor and execute pooling every specific ammount of time over the database, let's say 1 minute.</p>\n\n<p>How this application is relatively simple i decided use a monolithic structure,\ni made the all the GUI in range of classes, and i made an object that deals with the connection and data retrieving.</p>\n\n<p>to deal with the requeriment of the pooling time i used a <code>System.Timers.Timer</code>, which is basically a Thread wrapping with a firing timed event, here i executed the data pooling.</p>\n\n<p>When new data is found i need to fire a method in X class that belongs to the GUI (now running in the main thread) from the function triggered by the timer (in other thread by definition).</p>\n\n<p>the first time i tried to call the method directly to the method triggered by the timer, resulting in a cross-thread error: because the method resides in X class and was not contructed in the timer thread.</p>\n\n<p>Then i tried again using other approach. I created a event with his respective delegate in the class that read the data and subscribe the GUI objects to that event.  </p>\n\n<h2>Problem</h2>\n\n<p>now when i fire the event .net produces an exception saying me that the sender object instance is null, exactly don't know why, but i suspects that is because the object itself it's created with the GUI objects in the main thread and when i decide to send the object from the other thread (that it's generating the event), the instance simply doesn't exists because wasn't created there.</p>\n\n<p>This is the function called when the timer expires:</p>\n\n<pre><code>    private void PoolearMensajes(object Sender, ElapsedEventArgs e)\n    {\n        try\n        {\n            pRdr.getPendingMessages(); &lt;--- This function creates the exception\n            if (pRdr.MensajesPendientes &gt; 0)\n            {\n                this.oSysIcon.Text = pRdr.MensajesPendientes.ToString() + \" tickets pendientes\";\n                this.oSysIcon.BalloonTipIcon = ToolTipIcon.Info;\n                this.oSysIcon.BalloonTipText = pRdr.MensajesPendientes.ToString() + \" tickets pendientes\";\n                this.oSysIcon.BalloonTipTitle = \"Información\";\n                this.oSysIcon.ShowBalloonTip(3000);\n                System.Media.SystemSounds.Exclamation.Play();\n            }\n        }\n        catch (Exception ex)\n        {\n            this.oSysIcon.BalloonTipTitle = \"Error\";\n            this.oSysIcon.Text = \"Ha ocurrido un error.\";\n            this.oSysIcon.BalloonTipIcon = ToolTipIcon.Error;\n            this.oSysIcon.BalloonTipText = ex.Message;\n            this.oSysIcon.ShowBalloonTip(3000);\n            System.Media.SystemSounds.Exclamation.Play();\n        }\n    }\n</code></pre>\n\n<p>Here is the method resides in the data retriever object that was created in main thread:</p>\n\n<pre><code>    public delegate void TicketsFoundHandler(object sender, TicketEventArgs ta);\n    public event TicketsFoundHandler TicketsFound;\n\n    public void getPendingMessages()\n    {\n        string sSQL;\n        sSQL = \" an SQL Query that counts rows;\";\n        oCmd = new SqlCommand(sSQL, oConn);\n        oConn.Open();\n        this.i_pendmsg = (int)oCmd.ExecuteScalar();\n        if (this.i_pendmsg &gt; 0)\n        {\n            TicketEventArgs ta = new TicketEventArgs(\"\", this.i_pendmsg);\n            TicketsFound(this, ta); &lt;---- ERROR!\n        }\n        oConn.Close();\n    }\n</code></pre>\n\n<p>The Error message it's: <code>Object reference not set to an instance of an object</code>.</p>\n\n<p>any ideas , any improvements, or something i haven't cosidered ?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":11399449,"title":"C# Method Name Expected - Multithreading","body":"<p>I've  created this program in C# but I'm getting a 'Method Name Expected' error. What am I doing wrong?</p>\n\n<pre><code>for (int i = 0; i &lt; numberofThreads2; i++)     \n{   \n    Thread thread1 = new Thread(new ThreadStart (Start(1, 2, 3, 4, 5)));\n    thread1.Start();\n}\n</code></pre>\n"},{"tags":["c#",".net","multithreading","parallel-extensions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":33,"score":-2,"question_id":13160224,"title":"System.Threading.Task library in .net specifically Parallel.ForEach","body":"<p>I looked at microsoft's tutorial on Tasks on MSDN... It was good for what it showed, but I still have questions  In there example... found at this URL: <a href=\"http://msdn.microsoft.com/en-us/library/dd460699.aspx\" rel=\"nofollow\">MSDN Link</a></p>\n\n<p>They show an example where they show a Parallel.ForEach() static method call.  In that method call they have four parameters... Does the first Parameter have to be an Array of Ints?  Or could it be a collection or object of any kind that all the thread are working on?  Looks like the second parameter is an Action, which is a delegate that doesn't return a value (or a void).  What the heck is that second variable for?  Thread Local initializer?  Why Initialize to 0?  What the hell is being set  here?  The 3rd parameter is just a delegate (or a function point as I like to think of them with)  is the right side of the lambda expression the actual function?  for instance, could I put the name of an actual function on that side without having to write it out right there?  For example...</p>\n\n<pre><code>    public int localSum(int n, ParallelLoopState loopState, int localSum) {\n        localSum += n;\n        Console.WriteLine(\"Thread={0}, n={1}, localSum={2}\", Thread.CurrentThread.ManagedThreadId, n, localSum);\n        return localSum;\n    }\n\n(n, loopState, localSum) =&gt; localSum(int n, ParallelLoopState loopState, int localSum),\n</code></pre>\n"},{"tags":["multithreading","concurrency","race-condition","locks","condition-variable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13150566,"title":"multiple threads but only one allowed to use method","body":"<p>So basically the situation I am in is I have a bunch of threads each doing different calculations throughout the week. At the end of the week, every thread calls function X() and then starts calculating for the next week and repeats this cycle. </p>\n\n<p>However, only one thread is allowed to actually do the operations in method X() and only when all threads have reached method X(). Furthermore, none of the threads can continue on their way until the one thread that got to use method X() is finished. </p>\n\n<p>So I'm having difficulty implementing this. I feel like I need to use a condition variable but I'm still shaky with threads and whatnot. </p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":83,"score":6,"question_id":13154074,"title":"How Java thread.stop() work?","body":"<p>I am actually looking for an easier way to kill the thread not matter where the thread is running at. But most of the solutions in internet point me to use boolean flag to control the execution of the thread, if I want to stop the thread then set the boolean variable to false.</p>\n\n<p>But what if the task that in the runnable is a LONG linear task, which mean the task is not repeating? In that case, it is not so easy to create a 'while' loop to cover the whole block of task.</p>\n\n<p>It is really so temptative to use Thread.stop but the warning \"Deprecated\" seem like quite dangerous to use. I have read through this article \n<a href=\"http://docs.oracle.com/javase/1.5.0/docs/guide/misc/threadPrimitiveDeprecation.html\">Why Are Thread.stop, Thread.suspend, Thread.resume and Runtime.runFinalizersOnExit Deprecated?</a> </p>\n\n<p>but I can't understand  </p>\n\n<blockquote>\n  <p>If any of the objects previously protected by these monitors were in\n  an inconsistent state, other threads may now view these objects in an\n  inconsistent state. Such objects are said to be damaged.</p>\n</blockquote>\n\n<p>What does the \"inconsistent state\" mean? I appreciate if anyone can explain about this.</p>\n\n<p>I want to extend my question to a more lower level of view, let say <code>i = i + 1;</code> in JVM (perhaps assembly language alike), maybe this Java statement will be split into few smaller instructions, for example like <code>move i ; add i ; get i into memory 0x0101</code> (This is an example! I totally don't know assembly language!)</p>\n\n<p>Now, if we call thread.stop, where actually will it stop at? Will the thread stop after a COMPLETED Java statement, or could be in the middle of the \"assemble language\"? If the answer is the second, could it be reason that we said </p>\n\n<blockquote>\n  <p>Such objects are said to be damaged.</p>\n</blockquote>\n\n<p>?</p>\n\n<p>Ok, my question is kind of confused, hope someone can understand and explain. Thanks in advance.</p>\n"},{"tags":["python","multithreading","exception","parent-child","watchdog"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1250,"score":4,"question_id":6866900,"title":"Python - Have parent thread handle child threads Exception","body":"<p>Is there a way to have the parent that spawned a new thread catch the spawned threads exception?  Below is a real basic example of what I am trying to accomplish.  It should stop counting when Exception is raised, but I don't know how to catch it.  Are exceptions thread safe?  I would love to be able to use the <code>Subprocess</code> module, but I am stuck using Python 2.3 and am not sure how else to do this.  Possibly using the <code>threading</code> module?</p>\n\n<pre><code>import time\nimport thread\n\ndef test(): \n    try:\n        test = thread.start_new_thread(watchdog, (5,))\n        count(10)\n    except:\n        print('Stopped Counting')\n\ndef count(num):\n    for i in range(num):\n        print i\n        time.sleep(1)\n\ndef watchdog(timeout):\n    time.sleep(timeout)\n    raise Exception('Ran out of time')\n\nif __name__ == '__main__':\n    test()\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My original code was a little misleading.  It am really looking for something more like this:</p>\n\n<pre><code>import time\nimport thread\nimport os\n\ndef test(): \n    try:\n        test = thread.start_new_thread(watchdog, (5,))\n        os.system('count_to_10.exe')\n    except:\n        print('Stopped Counting')\n\ndef watchdog(timeout):\n    time.sleep(timeout)\n    raise Exception('Ran out of time')\n\nif __name__ == '__main__':\n    test()\n</code></pre>\n\n<p>I am trying to create a watchdog to kill the os.system call if the program hangs up for some reason.</p>\n"},{"tags":["java","multithreading","shutdown-hook"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":70,"score":6,"question_id":13158847,"title":"java shutdown hook with more than one thread","body":"<p>I am trying to get a shutdown hook to work on my ubuntu server, however I seem to have an issue with more than one thread.  Using the a basic ShutdownHook, the following bit of code does work when I kill the process using <code>kill &lt;PID&gt;</code>, meaning the shutdown behavior is activated.</p>\n\n<pre><code>public static void main(String[] args) {\n    ShutdownHook shutDown = new ShutdownHook();\n    shutDown.attachShutDownHook();\n\n    while(true){}\n}\n</code></pre>\n\n<p>however this same code with an additional thread does not</p>\n\n<pre><code>public static void main(String[] args) {\n    ShutdownHook shutDown = new ShutdownHook();\n    shutDown.attachShutDownHook();\n\n    (new Thread() {\n        public void run() {\n            while ( true ) {}\n        }\n    }).start();\n\n    while(true){}\n}\n</code></pre>\n\n<p>Any ideas?</p>\n\n<pre><code>class ShutdownHook {\n\n    ShutdownHook() {\n    }\n\n    public void attachShutDownHook() {\n\n            Runtime.getRuntime().addShutdownHook(new Thread() {\n                    @Override\n                    public void run() {\n                            System.out.println(\"Shut down hook activating\");\n                    }\n            });\n            System.out.println(\"Shut Down Hook Attached.\");\n\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","windows-phone-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13156427,"title":"How to load images for a image in background thread?","body":"<p>I am using a panorama page which has a Image and a text blocks.</p>\n\n<p>The images for the image is loaded from web, that i have images links and the caption in a List. Now am using binding in xaml for the image and text block.</p>\n\n<p>The images are getting loaded automatically but when it takes more time due to more number of parorama pages my application gets closed due to overtime of UI response time.</p>\n\n<p>So i hope the images should loaded out of UI thread and in someother background thread.</p>\n\n<p>Is there any possibility to load these kind of images in lazy loading.</p>\n"},{"tags":["java","multithreading","concurrency","java.util.concurrent","message-passing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13158123,"title":"Consumer Producer using message passing (not shared memory)","body":"<p>I am a little confused about message passing between several threads in Java. In many places it's written that currently it's not supported by the standard ways, but there are some libraries like <a href=\"http://www.malhar.net/sriram/kilim/\" rel=\"nofollow\">kilim</a>. I've found <a href=\"http://docs.oracle.com/javase/6/docs/api/java/nio/channels/package-summary.html\" rel=\"nofollow\">java nio</a>.</p>\n\n<ol>\n<li><p>isn't nio for this purpose?</p></li>\n<li><p>what are there the ways of passing data between thread (shared\nmemory, sending messages),something else? (java io - is it the way of using shared memory ?)</p></li>\n<li><p>where can I find a sample of implementing Consumer Producer task\nusing message passing(not using shared memory)?</p></li>\n</ol>\n\n<p>Thanks in advance for any help.</p>\n"},{"tags":["c#",".net","winforms","multithreading","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13157886,"title":"Performing long running UI changes without blocking the main thread","body":"<p>Is there anyway to run a large number of UI updates without effecting the main thread in a C# winforms application?</p>\n\n<p>I would like to avoid a long delay when a user clicks a specific event (which in my case is many close form calls to dispose of memory) </p>\n\n<p>I know i can use <code>BackgroundWorker</code> to perform lengthy operations in the \"do work\" event, but the problem is that you cant change any UI in this event (it will cause a cross thread exception) - so i cant put my large number of close form calls here. </p>\n\n<p>And I cant put the close form calls in the \"worker completed\" event because this is run on the main thread, and will eventually lockup the main thread causing a bad user experience.</p>\n\n<p>I have thought about spawning a thread to handle closes only when the appication session is idle, but not sure if this is going to be a bit messy.</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13155629,"title":"Can we change the lock after thread enter synchronized block?","body":"<p>I am asking this question is just for curiosity, I know it is stupid to do such thing.</p>\n\n<pre><code>public void doSomething() \n{\n      synchronized(object_A){\n        count++;\n        average = count/total;\n      }\n}\n</code></pre>\n\n<p>Now let say I have 2 thread run concurrently (calling function doSomething()), while the first thread already enter the block, let say at the line \"count++\", the second thread is blocked and waiting the lock.</p>\n\n<p>Now I try to do <code>object_A = new LockObject()</code> (in another thread). Now what happen to thread 1 and thread 2? </p>\n\n<p>Will thread 2 enter the block? Since it already executed statement \"synchronized(object_A)\", is it too late to change the lock?</p>\n\n<p>Will thread 1 change the lock while in the sync block (assume thread 1 still in the block)? </p>\n"},{"tags":["c#","multithreading","locking"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":63,"score":4,"question_id":12968559,"title":"How to provoke simulataneous access to shared resource?","body":"<p>I am creating an component which performs sequential processing on inputs. As it will be hosted in serveral different processes, I need it to be thread safe. At first, I intentionally left out thread safety from the code. Now it is time to introduce that.</p>\n\n<p>First, I wanted to provoke an error to start with, but was not able to. Here is a simplified version of the code for the processing engine:</p>\n\n<pre><code>public Document DoOrchestration(Document input)\n{\n    Document output = new Document();\n\n    foreach (var orchestrationStep in m_OrchestrationSteps)\n    {\n        var processor = GetProcessor(orchestrationStep).Clone();\n\n        output = processor.Process(input);\n\n        input = output;\n    }\n\n    return output;\n}\n</code></pre>\n\n<p>The processors can be developed by other people in my organisation, and that can include some complex initialization. They may also be thread unsafe, so I use the Prototype Pattern to get unique instances of the to avoid threading issues in those.</p>\n\n<p>To test this function I used the following code:</p>\n\n<pre><code>for (int i = 0; i &lt; 20000; i++)\n{\n    Thread t = new Thread(() =&gt; TestOrchestration(i));\n    t.Start();\n}\n\nvoid TestOrchestration(int number)\n{\n    Document doc = new Document(string.Format(\"Test {0}\", number));\n    doc = DoOrchestration(doc);\n    if (doc.ToString().Substring(0,35) != strExpectedResult)\n    {\n        System.Console.WriteLine(\"Error: {0}\", doc.ToString();\n    }\n}\n</code></pre>\n\n<p>I expected that some of the threads would collide with another and mix up their results, but to my suprise that did not happen.</p>\n\n<p>There is probably a easy and logical explanation to this, but it eludes me. Or is it just that the code is too simple to result in two threads fiddling with the input/output variables at the same time?</p>\n\n<p>Best regards,\nJonas</p>\n"},{"tags":["multithreading","soap","client","cxf"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13136167,"title":"Are CXF client proxies thread safe?","body":"<p>I'm using CXF to generate SOAP client classes. In the <a href=\"http://cxf.apache.org/faq.html#FAQ-AreJAXWSclientproxiesthreadsafe%3F\" rel=\"nofollow\">CXF documentation</a>, they write</p>\n\n<blockquote>\n  <p>Are JAX-WS client proxies thread safe?</p>\n  \n  <p>Official JAX-WS answer: No. According to the JAX-WS spec, the client proxies are NOT thread safe. To write portable code, you should treat them as non-thread safe and synchronize access or use a pool of instances or similar.</p>\n  \n  <p>CXF answer: CXF proxies are thread safe for MANY use cases. The exceptions are:</p>\n</blockquote>\n\n<p>(I'm omitting their description of these use cases)</p>\n\n<blockquote>\n  <p>For most \"simple\" use cases, you can use CXF proxies on multiple threads. The above outlines the workarounds for the others. </p>\n</blockquote>\n\n<p>Does anyone have any contrary experiences? Encountered multi-threading issues that aren't described in their faq? Or is their description accurate and they are basically safe to use? </p>\n"},{"tags":["java","multithreading","threadpool","runnable"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13154680,"title":"How to close all Threads running in my java application?","body":"<p>I want to close all thread which I started previously.</p>\n\n<p><strong>Thread.currentThread()</strong> gives me current thread, but what about others? How can I get them?</p>\n\n<p>I think <strong>Thread.activeCount()</strong> returns the count of active threads in thread's  thread group, but I does not use <strong>ThreadGroup</strong>,\nI just started threads using <strong>Thread thread = new Thread(new MyRunnable())</strong>.</p>\n\n<p>So how can I achieve this?\nthanks in advance...</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":68,"score":-1,"question_id":12881812,"title":"Thread Creation","body":"<p>I've made an experiment on GOF Factory Method Pattern and use Threads for this.\nI used the GOF Factory Method Pattern for dynamically create threads in C# .Net. The code structure is exactly the same described in the Factory Method pattern Example. I know creating new threads is not considered good practice. But sometimes you have to consider some not good enough practices to accomplish your requirements. I need to know that is it safe to create threads dynamically by this pattern or is there any better pattern or technology to create and manage threads in run time??? I am going to implement this in my project where I need to create several Threads in run time.</p>\n"},{"tags":["c#","winforms","multithreading","signalr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13154171,"title":"How to show a windows from in a SignalR callback method?","body":"<p>I am working on a simple chat application that uses SignalR for its communication.\nI want to show a MessageForm whenever a private message is received from another user.\nThe problem is , the callback method is running on a different thread and it seems that there's a problem merging the new form loop with the main form,thus the application hangs \nHere's my callback method :</p>\n\n<pre><code>private void MessageReceived(object sender, Client.MessageEventArgs args)\n    {\n        var form = new MessageForm();\n        form.MessageReceived(sender,args);\n        form.Show();\n    }\n</code></pre>\n\n<p>So the question is how I can create the form so that it uses the main form loop ?</p>\n"},{"tags":["c#","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":59,"score":4,"question_id":13153745,"title":"How can I pause and continue a TPL task?","body":"<p>I have scenario where I have a couple of background tasks (TPL tasks) which run on their own individual schedules. Task 1 is deemed to have a higher priority than Task 2. </p>\n\n<p>If the scheduler wants to run Task 1, I need to check if Task 2 is running and pause it while Task 1 completes execution. </p>\n\n<p>Is this even possible? If yes, how can I achieve this?</p>\n"},{"tags":["multithreading","perl","unix"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13153160,"title":"shared queue between threads in different child processes","body":"<p>I have N fork()ed processes with M threads each (but of course, how else?). The threads are supposed to wait for jobs being submitted into some queue and eventually post some results within the same queue. All threads have the same priority and respect the same data flow (deque() a task, enque() it's results as a list of new tasks). How should I proceed with the queue implementation? </p>\n\n<p>I tried a quick rewrite of a <a href=\"http://search.cpan.org/~jdhedden/Thread-Queue-2.12/lib/Thread/Queue.pm\" rel=\"nofollow\">Thread::Queue</a> using an <a href=\"http://search.cpan.org/~msouth/IPC-Shareable-0.61/lib/IPC/Shareable.pm\" rel=\"nofollow\">IPC::Shareable</a> as a <a href=\"http://cpansearch.perl.org/src/JDHEDDEN/Thread-Queue-2.12/lib/Thread/Queue.pm\" rel=\"nofollow\">@queue</a>, with <a href=\"http://cpansearch.perl.org/src/JDHEDDEN/Thread-Queue-2.12/lib/Thread/Queue.pm\" rel=\"nofollow\">enqueue()/dequeue()</a> using a two-level (thread/process) lock,  but it turned out to be wrong (can't really <a href=\"http://search.cpan.org/~jdhedden/threads-shared-1.42/lib/threads/shared.pm\" rel=\"nofollow\">:share</a> <a href=\"http://search.cpan.org/~msouth/IPC-Shareable-0.61/lib/IPC/Shareable.pm\" rel=\"nofollow\">IPC::Shareable</a>'s tied array). I guess I did not want to have each thread carrying its own <a href=\"http://search.cpan.org/~msouth/IPC-Shareable-0.61/lib/IPC/Shareable.pm\" rel=\"nofollow\">IPC::Shareable</a> instance (without thinking too much)?</p>\n\n<p>Should I just freeze/thaw the tasks over an <a href=\"http://search.cpan.org/~mhx/IPC-SysV-2.03/lib/IPC/Msg.pm\" rel=\"nofollow\">IPC::Msg</a> and implement the locks and CVs with semaphores, keeping per-thread <a href=\"http://search.cpan.org/~mhx/IPC-SysV-2.03/lib/IPC/Msg.pm\" rel=\"nofollow\">IPC::Msg</a> instances? It sounds pretty weird to directly instantiate IPC primitives within a thread (hence my attempt to :share IPC::Shareables at thread level).</p>\n\n<p>Have some of you monks did it proper and sound same time? A flat implementation, with no middleware queue managers and such? Can you please share a thought, maybe a module?</p>\n\n<p>Thanks!</p>\n\n<p>P.S. I'd rather not opt for a heavy existing implementation like mpi, rabbitmq, etc.</p>\n\n<pre><code>#!/usr/bin/perl\nuse strict;\nuse warnings;\nuse Carp qw/croak/;\nuse threads;\nuse threads::shared;\n\nuse insert::your::queue::impl::here;     \n\nque_make_init();\n\nmy $numthreads = 4;\nmy $numprocs = 4;\n\nsub runthreads \n{\n    foreach (1..$numthreads) {\n    @retcodes = map { $_-&gt;join } threads-&gt;create( sub {\n        my $q = que_get_process_level_shared_instance();\n        while ( (my $task = @q-&gt;get())) {\n            @q-&gt;put(process($task));\n        }\n    });\n    }\n    #do_something(@retcodes) ...\n    exit(0);\n\n}\n\nmy %proctable = map {\n        croak unless defined (my $pid = fork());\n        runthreads if $pid == 0;\n        $pid =&gt; -1;\n    } (0..$numprocs-1);\n\n#waitpid(), etc\n__END__\n</code></pre>\n"},{"tags":["c#","winforms","multithreading","cross-threading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13152075,"title":"Multithreading in C# - Update Labels","body":"<p>So I have 3 labels and have to update all three of them at the same time using a random number until the user clicks a button that stops it.</p>\n\n<p>This is what I have on my start button</p>\n\n<pre><code>private void start_Click(object sender, EventArgs e)\n{\n        t1 = new Thread(new ThreadStart(FirstNumber));\n        t2 = new Thread(new ThreadStart(SecondNumber));\n        t3 = new Thread(new ThreadStart(ThirdNumber));\n\n        t1.Start();\n        t2.Start();\n        t3.Start();\n}\n</code></pre>\n\n<p>This is what the methods that generate the random numbers look like</p>\n\n<pre><code>public void FirstNumber()\n{\n        int j = r.Next(0, 50);\n        int k = r.Next(50, 100);\n        for (int i = j; i &lt;= k; i++)\n        {\n            number1.Text = i.ToString();\n            Thread.Sleep(200);\n        }\n}\n</code></pre>\n\n<p>When I debug I get the following error:</p>\n\n<blockquote>\n  <p>Cross-thread operation not valid: Control 'number2' accessed from a thread other than the thread it was created on.</p>\n</blockquote>\n\n<p>I don't understand how I am meant to create controls for each thread, so any help is appreciated. </p>\n\n<p>One more thing, will the user be able to click the stop button while the labels are being updated? Or do I need to add another thread that waits for the user input?</p>\n\n<p>Thanks a lot!</p>\n"},{"tags":["android","multithreading","sockets","udp","datagram"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13138262,"title":"udp connecting to device","body":"<p>here is my Code</p>\n\n<pre><code>package com.example.messenger;\n\nimport java.io.IOException;\nimport java.net.DatagramPacket;\nimport java.net.DatagramSocket;\nimport java.net.InetAddress;\nimport java.net.SocketException;\nimport java.net.UnknownHostException;\n\nimport android.annotation.SuppressLint;\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.os.StrictMode;\nimport android.view.Menu;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.widget.TextView;\n\n@SuppressLint(\"NewApi\")\npublic class MainActivity extends Activity implements View.OnClickListener {\n    Button Send;\n    EditText IPAdresse;\n    EditText TEXT;\n    TextView RXtext,tstep,rstep;\n    private static final int TIMEOUT_MS = 1000;\n    private static final int server_port = 13011;\n\n    @SuppressLint({ \"NewApi\", \"NewApi\", \"NewApi\" })\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();\n\n        StrictMode.setThreadPolicy(policy); \n\n        IPAdresse = (EditText) findViewById(R.id.etIPAdresse);\n        IPAdresse.setText(\"192.168.2.32\");\n        TEXT = (EditText) findViewById(R.id.etTEXT);\n        Send = (Button) findViewById(R.id.bSendaa);\n        RXtext = (TextView) findViewById(R.id.tvRXtext);\n        tstep = (TextView) findViewById(R.id.tvTstep);\n        rstep = (TextView) findViewById(R.id.tvRstep);\n        Send.setOnClickListener(this);\n\n\n        new Thread(new Runnable() {\n\n            @Override\n            public void run() {\n                // TODO Auto-generated method stub\n\n                String text;\n                byte[] message = new byte[1500];\n                DatagramSocket s;\n\n                while(true){\n                try {\n                    s= new DatagramSocket(server_port);\n                    rstep.setText(\"1\");\n                    s.setBroadcast(true);\n                    rstep.setText(\"2\");\n                    s.setSoTimeout(TIMEOUT_MS);\n                    rstep.setText(\"3\");\n\n                    while(true){\n                        DatagramPacket p = new DatagramPacket(message, message.length);\n                        rstep.setText(\"4\");\n                        //InetAddress test = InetAddress.getByName(\"192.168.1.101\");\n                        //rstep.setText(\"5\");\n                        //s.connect(test,12345);\n                        //rstep.setText(\"6\");\n                        s.receive(p);\n                        rstep.setText(\"xxx\");\n                        text = new String(message, 0, p.getLength());\n                        RXtext.setText(text);\n                    }\n                } catch (SocketException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                    rstep.setText(\"fail socket create\");\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                    rstep.setText(\"fail receive\");\n                }\n\n                }\n            }\n        });\n        }\n\npublic void onClick(View arg0) {\n    // TODO Auto-generated method stub\n    switch(arg0.getId()){\n    case R.id.bSendaa:\n        tstep.setText(\"1\");\n        String messageStr= TEXT.getText().toString();\n        tstep.setText(\"2\");\n\n        DatagramSocket s;\n        try {\n            s = new DatagramSocket();\n            tstep.setText(\"3\");\n            s.setBroadcast(true);\n            tstep.setText(\"4\");\n            s.setSoTimeout(TIMEOUT_MS);\n            tstep.setText(\"5\");\n            InetAddress local = InetAddress.getByName(IPAdresse.getText().toString());\n            tstep.setText(\"6\");\n            int msg_length=messageStr.length();\n            tstep.setText(\"7\");\n            byte[] message = messageStr.getBytes();\n            tstep.setText(\"8\");\n            DatagramPacket p = new DatagramPacket(message, msg_length,local,server_port);\n            tstep.setText(\"9\");\n            s.connect(local,server_port);\n            tstep.setText(\"10\");\n            s.send(p);\n            tstep.setText(\"sending complete\");\n\n\n        } catch (SocketException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        } catch (UnknownHostException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n            tstep.setText(\"sending failed\");\n        }\n    }\n}\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.activity_main, menu);\n        return true;\n    }\n}\n</code></pre>\n\n<p>My android phone's Ip is 192.168.2.32 , I saw it in wifi settings. So when I debug it row by row , I saw that my virtual device sent the packet , but I don't know why my phone can't get  it. Can anybody help me?\nThanks\nRegards</p>\n"},{"tags":["c++","multithreading"],"answer_count":7,"favorite_count":10,"up_vote_count":21,"down_vote_count":0,"view_count":60308,"score":21,"question_id":266168,"title":"Simple example of threading in C++","body":"<p>Can someone post a simple example of starting two (Object Oriented) threads in C++. </p>\n\n<p>I'm looking for actual C++ thread objects that I can extend run methods on (or something similar) as opposed to calling a C-style thread library.</p>\n\n<p>Thanks.</p>\n\n<p>Update - I left out any OS specific requests in the hopes that whoever replied would reply with cross platform libraries to use. I'm just making that explicit now.</p>\n"},{"tags":["java","multithreading","compression","gzip"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13149012,"title":"Java- Difference in compression for single thread and multithread","body":"<p>So I'll preface this by saying that my multithreaded program fails to output something that gzip can successfully decompress, so there might be other issues. But what I've noticed is that the compression size of each block for single thread and multithread is radically different.</p>\n\n<p>In my single threaded run, I have a GZIPOutputStream(System.out, true) with SYNC_FLUSH set. I read from system.in continually until my buffer is full.</p>\n\n<pre><code>GZIPOutputStream compressor = new GZIPOutputStream(System.out, true);\nbytesRead = inBytes.read(buff,0,BLOCK_SIZE);\n....\nwhile(bytesRead != -1)\n{\n    offset += bytesRead;\n    if (offset == BLOCK_SIZE)\n    {\n        compressor.write(buff,0,offset);\n        compressor.flush();\n        offset = 0;\n    }\n\n    if((bytesRead=inBytes.read(buff,offset,BLOCK_SIZE-offset)) == -1) {\n        compressor.write(buff,0,offset);\n        compressor.finish();\n    }\n}\ncompressor.close();\n</code></pre>\n\n<p>As you can see, after a have a full buffer, I tell compressor to write to output, and then I call flush. The assures that I force it to compress and flush out any remaining output, so when it goes to write again, it doesn't have any left over data in the buffer.</p>\n\n<p>So it's quite similar to as if your original input had been that length to begin with (so each block is it's own individual stream). </p>\n\n<p>So in my multithreaded program, instead of having one GZIPOutputStream write and flush, I just have a bunch of threads that each have their own GZIPOutputStream. So basically, replace that part with a call to a thread</p>\n\n<pre><code>List&lt;Future&lt;byte[]&gt;&gt; results = new ArrayList&lt;Future&lt;byte[]&gt;&gt;();\nbytesRead = inBytes.read(buff,0,BLOCK_SIZE);\n\nwhile(bytesRead != -1)\n{\n    offset += bytesRead;\n    if (offset == BLOCK_SIZE)\n    {\n        results.add(exec.submit(new workerThread(buff,offset)));\n        offset = 0;\n    }\n\n    if((bytesRead=inBytes.read(buff,offset,BLOCK_SIZE-offset)) == -1) {\n        results.add(exec.submit(new workerThread(buff,offset)));\n    }\n}\n</code></pre>\n\n<p>Where I just pass the buffer to them to compress. All my threads do is</p>\n\n<pre><code>private ByteArrayOutputStream bOut = new ByteArrayOutputStream();\nprivate byte[] finalOut;\n....\npublic byte[] call() {\n    try{\n        GZIPOutputStream compress = new GZIPOutputStream (bOut, true);\n        compress.write(input,0,size);\n        compress.flush();\n        compress.close();\n     }\n     catch (IOException e)\n     {\n        e.printStackTrace();\n        System.exit(-1);\n     }\n     finalOut = bOut.toByteArray();\n     return finalOut;\n }\n</code></pre>\n\n<p>I think all I've literally done is given the compression job to the threads. I didn't change anything else. However, when I run my multi-threaded program and hexdump the result, I noticed that each block usually differs a lot between the two programs. I used a small buffer and small input so it was more easily read.</p>\n\n<p>I get a crc error with my multithreaded program, which means at least that gzip recognizes the format and begins decompressing. It's just that when it's done, the final result doesn't match what it expected from the CRC (such as the size of the decompressed output and such).</p>\n\n<p>I'm honestly not sure why this happens. I would have expected some much more obvious error, but this one seems so random. It's definitely compressing. And the first few bytes between the single threaded and multithreaded program (after the header of course) are often the same, so I don't think I'm concatenating out of order (plus the executor.get() function should handle that).</p>\n\n<p>I'm just stumped. I know gzip can decompress concatenated streams. I literally split my input in half and output it separately then combined them in my singlethread program and it decompressed just fine.</p>\n\n<p>For the record, I just tried it on a file with 328 \"A\" characters, so it's not very large. The GZIPOutputStream's hexdump for a single thread is </p>\n\n<pre><code>0000000 8b1f 0008 0000 0000 0000 7472 581c 0000\n0000010 0000 ffff 681a 0004 0000 ffff 21a2 02e2\n0000020 0000 ff00 03ff a800 5bff 5c79 0001 0000\n</code></pre>\n\n<p>And for multithreaded it's</p>\n\n<pre><code>0000000 8b1f 0008 0000 0000 0000 7472 19a4 22e0\n0000010 1146 0000 ff00 03ff 7500 5f6c 80d1 0000\n0000020 1f00 088b 0000 0000 0000 a200 e221 4622\n0000030 0011 0000 ffff 0003 6c75 d15f 0080 0000\n0000040 8b1f 0008 0000 0000 0000 21a2 02e2 0000\n0000050 ff00 03ff 8a00 193b 5c21 0000 0000     \n</code></pre>\n\n<p>They're pretty different.</p>\n\n<p>Wow this ended up being really long. Sorry about that. Just really puzzled and stuck.</p>\n"},{"tags":["java","multithreading","concurrency","thread-safety"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13151166,"title":"Collections.synchronizedMap(new LinkedHashMap()); is not making Map threadsafe","body":"<p>I'm using following construct for creating a threadsafe <code>Map</code>.</p>\n\n<pre><code>Collections.synchronizedMap(new LinkedHashMap());\n</code></pre>\n\n<p>Though I'm getting <code>ConcurrentModificationException</code> error.</p>\n"},{"tags":["python","multithreading"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":3576,"score":4,"question_id":3393612,"title":"Run certain code every n seconds","body":"<p>Is there a way to, for example, print <code>Hello World!</code> every n seconds?\nFor example, the program would go through whatever code I had, then once it had been 5 seconds (with <code>time.sleep()</code>) it would execute that code. I would be using this to update a file though, not print Hello World.</p>\n\n<p>For example:</p>\n\n<pre><code>startrepeat('print('Hello World'), .01) #repeats print('Hello World') ever .01 seconds \nfor i in range(5):\n    print(i)\n\n&gt;&gt; Hello World!\n&gt;&gt; 0\n&gt;&gt; 1\n&gt;&gt; 2\n&gt;&gt; Hello World!\n&gt;&gt; 3\n&gt;&gt; Hello World!\n&gt;&gt; 4\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13150197,"title":"Prohibiting One Task when another is running","body":"<p>So let's say I'm creating and starting a bunch of threads in a for loop, that is being executed in the run method of a launcher thread. Let's also say that I want to be able to interrupt the launcher thread and all threads that the thread has created, and I do this through a button. </p>\n\n<p>So something like this -</p>\n\n<pre><code>try{\n            for(int i = 0; i &lt; n;i++){\n\n                Worker currThread = new Worker(someArgs);\n                workerThreads.add(currThread);\n                currThread.start();\n            }\n        } catch (InterruptedException e){\n            e.printStackTrace();\n        }\n</code></pre>\n\n<p>BUTTON-</p>\n\n<pre><code>public void actionPerformed(ActionEvent arg0) {\n\n    List&lt;Worker&gt; threads = launchThread.getWorkerThreads();\n        for(int i = 0; i &lt; threads.size();i++){\n            threads.get(i).interrupt();\n        }\n        launchThread.interrupt();\n\n    }\n</code></pre>\n\n<p>Now, let's say that I want to make it so that the interrupts cannot occur at the same time as thread creation. I think a way to do this would be to construct a dummy object and put both pieces of code inside a lock </p>\n\n<pre><code>synchronized(dummyObject){\n//thread creation or interruption code here (shown above) \n}\n</code></pre>\n\n<p>Will this way work? I ask because I'm not sure how to test to see if it will. </p>\n"},{"tags":["java","multithreading","image","graphics","concurrency"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13150173,"title":"Drawing Images from a Thread","body":"<p>I am making a program where a character will be animated in a thread away from the rest of the program.</p>\n\n<pre><code>Thread trollAnimation = new Thread() {\n\n    public void run() {\n        if (battling) {\n            frame++;\n\n            switch (frame) {\n            case 1: case 5: case 9:\n                g.drawImage(troll1, 0, 0, null);\n                break;\n            case 2: case 4: case 6: case 8:\n                g.drawImage(troll2, 0, 0, null);\n                break;\n            case 3: case 7:\n                g.drawImage(troll3, 0, 0, null);\n                break;\n            case 10:\n                g.drawImange(troll4, 0, 0, null);\n                break;\n            }\n\n            if (frame == 10) {\n                frame = 1;\n            }\n        }\n    }\n};\n</code></pre>\n\n<p>On each line that says g.drawImage..., an error is thrown that says \"g cannot be resolved\".  In addition to the problem with drawing images, how do i stop the thread properly when battling == false?</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":13149343,"title":"Simple Multi-Threading in Java","body":"<p>Currently, I'm running on a thread-less model that isn't working simply because I'm running out of memory before I can process the data I'm being handed. I've made all the changes that I can to optimize the code, and it's still just not quite quick enough.</p>\n\n<p>Clearly I should move on to a threaded model. I'm wondering what the simplest, easiest way to do the following is:</p>\n\n<ul>\n<li>The main thread passes some info to the worker</li>\n<li>That worker performs some work that I'll refactor out of the main method</li>\n<li>The workers will disappear and new ones will be instantiated when needed</li>\n</ul>\n\n<p>I've never worked with java threading and from what I've read up on it seems pretty complicated, even if what I'm looking for seems pretty simple.</p>\n"},{"tags":["multithreading","operating-system","scheduler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":15,"score":-4,"question_id":13149980,"title":"Multithreading basic scheduler","body":"<p>Can I ask someone to write the scheduler based on the existing source code for me? Or hiring. </p>\n"},{"tags":["objective-c","multithreading","osx","cocoa","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13148684,"title":"Deadlock using dispatch_semaphore_t in a concurrent queue","body":"<p>I am developing a MacOS X application which runs a large number of background jobs, using GCD. The background jobs use CLucene to index documents, and access Core Data on a child context.</p>\n\n<p>These jobs are all spawned in short order (using dispatch_async on a queue created with DISPATCH_QUEUE_CONCURRENT), but only 4 do actual work at once. This is accomplished using a dispatch_semaphore_t, by waiting on it when a job begins and releasing it when the job completes.</p>\n\n<p>I'm seeing a very strange, reliably reproducible deadlock when:</p>\n\n<ol>\n<li>Background jobs are still running</li>\n<li>The user switches focus to another application, and then back</li>\n</ol>\n\n<p>NSWindow is apparently deadlocking trying to send a notification while displaying the menu bar. This is the stack trace of the main thread when this happens:</p>\n\n<pre><code>\n#0  0x00007fff870ae6c2 in semaphore_wait_trap ()\n#1  0x00007fff8b1bf486 in _dispatch_semaphore_wait_slow ()\n#2  0x00007fff8b69c12b in -[_NSDNXPCConnection sendMessage:waitForAck:] ()\n#3  0x00007fff8b57ced5 in _CFXNotificationPost ()\n#4  0x00007fff8b58bbf3 in CFNotificationCenterPostNotification ()\n#5  0x00007fff902ae174 in HIS_XPC_CFNotificationCenterPostNotification ()\n#6  0x00007fff8bd3612a in BroadcastToolboxMessage ()\n#7  0x00007fff8bd6d063 in MenuBarInstance::Show(MenuBarAnimationStyle, unsigned char, unsigned char, unsigned char) ()\n#8  0x00007fff8bd98144 in SetMenuBarObscured ()\n#9  0x00007fff8bd97e0f in HIApplication::HandleActivated(OpaqueEventRef*, unsigned char, OpaqueWindowPtr*) ()\n#10 0x00007fff8bd95407 in HIApplication::EventObserver(unsigned int, OpaqueEventRef*, void*) ()\n#11 0x00007fff8bd636e0 in _NotifyEventLoopObservers ()\n#12 0x00007fff898dc018 in -[NSWindow sendEvent:] ()\n#13 0x00007fff898d8744 in -[NSApplication sendEvent:] ()\n#14 0x00007fff897ee2fa in -[NSApplication run] ()\n#15 0x00007fff89792cb6 in NSApplicationMain ()\n#16 0x0000000100001e52 in main at /Users/mspong/dev/Indx/Indx/Indx/main.m:13\n#17 0x00007fff86b7b7e1 in start ()\n\n</code></pre>\n\n<p>All running background jobs finish their work, but no further jobs get access to the aforementioned semaphore. Every thread is stuck on semaphore_wait_trap.</p>\n\n<p>I can't imagine what I could possibly be doing to (apparently) cause unrelated semaphores (both mine and Apple's) to get stuck. Can anybody offer some advice on how to investigate this further?</p>\n"},{"tags":["java","multithreading","synchronization"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13148001,"title":"Spurious wakeups, wait() and notifyAll()","body":"<p>I have N threads that do these things in loop: increase shared variable, checks if shared variable value is N (if so put value to queue) and do wait(). I have one more threat that checks the q variable. If queue is true, it does notifyAll(). After that N threads should wake up, and do another run of loop. But it seems that some threads are waking up without notification. I've read about spurious wakeups, but I don't know what condition should I put to while() to check if it was spurious wake up.</p>\n\n<p>Bellow is example of my code (not the same, but very similar in meaning):</p>\n\n\n\n<p>Shared class is shared between all threads:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>class Shared {\n    volatile int v = 0;\n}\n</code></pre>\n\n<p>I create 10 threads and run them.</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>class NThreads implements Runnable {\n    private Shared shared;\n    private QThread q;\n    static int N = 0; /* N - number of threads */\n\n    public NThreads(QThread q, Shared shared) {\n        this.q = q;\n        this.shared = shared;\n        ++N;\n    }\n\n    @Override\n    public void run() {\n        for (int i=0;i&lt;1048575;++i) {\n            doSomeCalculations();\n            loop();\n        }\n    }\n\n    private void loop() {\n        synchronized (shared) {\n            if (++shared.v == N) {\n                shared.v = 0;\n                synchronized (Q) {\n                    q.q = true;\n                }\n                shared.wait();\n            } else {\n                shared.wait();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>There is only one QThread that waits for modification of q and then invoke notifyAll();</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>class QThread implements Runnable {\n    private Shared shared;\n    volatile boolean q = false;\n\n    public QThread(Shared shared) {\n        this.shared = shared;\n    }\n\n    @Override\n    public void run() {\n        for (;;) {\n            if (q) {\n                synchronized (this) {\n                    q = false;\n                }\n                synchronized (shared) {\n                    shared.notifyAll();\n                }\n            }\n            doSomethingElse();\n            // or even: Thread.yield();\n        }\n    }\n}\n</code></pre>\n\n<p>Main class that runs everything:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>class Main {\n    public static void main(String[] args) {\n        Shared shared = new Shared();\n        QThread qt = new QThread(shared);\n        NThread[] nt = new NThread[10];\n        for (int i=0; i&lt;nt.length; ++i) {\n            nt[i] = new NThread(qt, shared);\n        }\n        Thread[] threads = new Thread[nt.length+1];\n        threads[0] = new Thread(qt);\n        for (int i=0; i&lt;nt.length; ++i) {\n            threads[1+i] = new Thread(nt[i]);\n        }\n\n        for (int i=0; i&lt;threads.length; ++i) {\n            threads[i].start();\n        }\n\n        for (int i=0; i&lt;threads.length; ++i) {\n            threads[i].join();\n        }\n    }\n}\n</code></pre>\n\n<p>Sometimes there are threads (from NThreads) that finishes their loops, but other threads no. I think that is because of spurious wakeups. How to write condition to take cake of spurious wakeups and be sure that all threads can continue their work?</p>\n\n<p>Maybe there is useful class in java.util.concurrent? But I didn't see anything interesting... :(</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13148070,"title":"Restricting the thread access to a given block code","body":"<p>I am recently using java threads and I am trying to implement a method that restricts a block of code to be execute only by one thread, lets called \"single\".</p>\n\n<p>One solution that i already implement is as follows:</p>\n\n<pre><code>if(readFlag())\n{\n  synchronized(this)\n  {\n  flag = false;  \n  // do some work\n  }\n} \n</code></pre>\n\n<p>Where :</p>\n\n<pre><code>public Boolean synchronized readFlag() {return flag;}\n</code></pre>\n\n<p>This naive solution works fine for only one \"single\" block, but the problem appears when i try to use multiple \"single\" code blocks since i can not use the same flag since different threads can be trying to enter different \"single\" code blocks at the same time.</p>\n\n<p>Another solution could be the use of an array of flags variables one for each \"single\" but this solution would have problems (or require the use of barriers) when execution \"single\" code blocks inside loops, beside not being very flexible.</p>\n\n<p>my question is: How could i improve this solution to allow the execution of various \"single\" code blocks and to allow the execution of the same single code block multiple times (e.g. a single code block inside a loop).</p>\n"},{"tags":["android","multithreading","service","cpu"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13148261,"title":"Android service and main thread CPU usage","body":"<p>In Android, is the main thread favored in the use of the CPU, compared to Service? If yes, can I give, for a certain period, the complete control of CPU to android service? Or more generally give different priority?</p>\n"},{"tags":[".net","wpf","multithreading","backgroundworker","delegatecommand"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13147894,"title":"Why this DelegateCommand does not refresh correctly the CanExecute with background workers?","body":"<p>Using a DelegateCommand in WPF I'm facing the following issue:</p>\n\n<p>Executing the Command1 in a background worker prevents the window from refreshing correctly the CanExecute of the buttons, if the command is executed on the UI thread everything works as expected. Clicking outside the button the CanExecute is correcyly refreshed. Any hint? </p>\n\n<p>(Down it's the code of the DelegateCommand, sorry if it's too large. As far as I know this is a common implementation of a DelegateCommand)</p>\n\n<p>XAML:</p>\n\n<pre><code> &lt;Window x:Class=\"BackgroundWorkTest.MainWindow\"\n     xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n     xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n     Title=\"MainWindow\" Height=\"350\" Width=\"525\"&gt;\n    &lt;StackPanel&gt;\n          &lt;Button Command=\"{Binding Command1}\" Content=\"1\" /&gt;\n          &lt;Button Command=\"{Binding Command2}\" Content=\"2\" /&gt;\n    &lt;/StackPanel&gt;\n &lt;/Window&gt;\n</code></pre>\n\n<p>C#:</p>\n\n<pre><code>using System.ComponentModel;\nusing System.Windows;\nusing System.Windows.Input;\nusing Utils.Wpf;\n\nnamespace BackgroundWorkTest\n{\npublic partial class MainWindow : Window\n{\n    private bool _canCommand1 = true;\n    private bool _canCommand2 = true;\n\n    private readonly BackgroundWorker _backgroundWorker;\n\n    public ICommand Command1 { get; private set; }\n    public ICommand Command2 { get; private set; }\n\n    public MainWindow()\n    {\n        this.Command1 = new DelegateCommand(this.ExecuteCommand1, this.CanCommand1);\n        this.Command2 = new DelegateCommand(this.ExecuteCommand2, this.CanCommand2);\n\n        _backgroundWorker = new BackgroundWorker();\n        _backgroundWorker.DoWork += _backgroundWorker_DoWork;\n        _backgroundWorker.RunWorkerCompleted += _backgroundWorker_RunWorkerCompleted;\n\n        InitializeComponent();\n\n        this.DataContext = this;\n    }\n\n    private void _backgroundWorker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n    {\n        System.Threading.Thread.Sleep(2000);\n    }\n\n    private void _backgroundWorker_DoWork(object sender, DoWorkEventArgs e)\n    {\n        System.Threading.Thread.Sleep(2000);\n        _canCommand2 = true;\n        _canCommand1 = false;\n    }\n\n    private bool CanCommand2()\n    {\n        return _canCommand2;\n    }\n\n    private void ExecuteCommand2()\n    {\n        _canCommand2 = false;\n        _canCommand1 = true;\n    }\n\n    private bool CanCommand1()\n    {\n        return _canCommand1;\n    }\n\n    private void ExecuteCommand1()\n    {\n        _backgroundWorker.RunWorkerAsync();\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>DelegateCommand C#:</p>\n\n<pre><code>    public class DelegateCommand : ICommand\n{\n    #region Constructors\n\n    /// &lt;summary&gt;\n    ///     Constructor\n    /// &lt;/summary&gt;\n    public DelegateCommand(Action executeMethod)\n        : this(executeMethod, null, false)\n    {\n    }\n\n    /// &lt;summary&gt;\n    ///     Constructor\n    /// &lt;/summary&gt;\n    public DelegateCommand(Action executeMethod, Func&lt;bool&gt; canExecuteMethod)\n        : this(executeMethod, canExecuteMethod, false)\n    {\n    }\n\n    /// &lt;summary&gt;\n    ///     Constructor\n    /// &lt;/summary&gt;\n    public DelegateCommand(Action executeMethod, Func&lt;bool&gt; canExecuteMethod, bool isAutomaticRequeryDisabled)\n    {\n        if (executeMethod == null)\n        {\n            throw new ArgumentNullException(\"executeMethod\");\n        }\n\n        this._executeMethod = executeMethod;\n        this._canExecuteMethod = canExecuteMethod;\n        this._isAutomaticRequeryDisabled = isAutomaticRequeryDisabled;\n    }\n\n    #endregion\n\n    #region Public Methods\n\n    /// &lt;summary&gt;\n    ///     Method to determine if the command can be executed\n    /// &lt;/summary&gt;\n    public bool CanExecute()\n    {\n        if (this._canExecuteMethod != null)\n        {\n            return this._canExecuteMethod();\n        }\n        return true;\n    }\n\n    /// &lt;summary&gt;\n    ///     Execution of the command\n    /// &lt;/summary&gt;\n    public void Execute()\n    {\n        if (this._executeMethod != null)\n        {\n            this._executeMethod();\n        }\n    }\n\n    /// &lt;summary&gt;\n    ///     Property to enable or disable CommandManager's automatic requery on this command\n    /// &lt;/summary&gt;\n    public bool IsAutomaticRequeryDisabled\n    {\n        get\n        {\n            return this._isAutomaticRequeryDisabled;\n        }\n        set\n        {\n            if (this._isAutomaticRequeryDisabled != value)\n            {\n                if (value)\n                {\n                    CommandManagerHelper.RemoveHandlersFromRequerySuggested(this._canExecuteChangedHandlers);\n                }\n                else\n                {\n                    CommandManagerHelper.AddHandlersToRequerySuggested(this._canExecuteChangedHandlers);\n                }\n                this._isAutomaticRequeryDisabled = value;\n            }\n        }\n    }\n\n    /// &lt;summary&gt;\n    ///     Raises the CanExecuteChaged event\n    /// &lt;/summary&gt;\n    public void RaiseCanExecuteChanged()\n    {\n        this.OnCanExecuteChanged();\n    }\n\n    /// &lt;summary&gt;\n    ///     Protected virtual method to raise CanExecuteChanged event\n    /// &lt;/summary&gt;\n    protected virtual void OnCanExecuteChanged()\n    {\n        CommandManagerHelper.CallWeakReferenceHandlers(this._canExecuteChangedHandlers);\n    }\n\n    #endregion\n\n    #region ICommand Members\n\n    /// &lt;summary&gt;\n    ///     ICommand.CanExecuteChanged implementation\n    /// &lt;/summary&gt;\n    public event EventHandler CanExecuteChanged\n    {\n        add\n        {\n            if (!this._isAutomaticRequeryDisabled)\n            {\n                CommandManager.RequerySuggested += value;\n            }\n            CommandManagerHelper.AddWeakReferenceHandler(ref this._canExecuteChangedHandlers, value, 2);\n        }\n        remove\n        {\n            if (!this._isAutomaticRequeryDisabled)\n            {\n                CommandManager.RequerySuggested -= value;\n            }\n            CommandManagerHelper.RemoveWeakReferenceHandler(this._canExecuteChangedHandlers, value);\n        }\n    }\n\n    bool ICommand.CanExecute(object parameter)\n    {\n        return this.CanExecute();\n    }\n\n    void ICommand.Execute(object parameter)\n    {\n        this.Execute();\n    }\n\n    #endregion\n\n    #region Data\n\n    private readonly Action _executeMethod;\n    private readonly Func&lt;bool&gt; _canExecuteMethod;\n    private bool _isAutomaticRequeryDisabled;\n    private List&lt;WeakReference&gt; _canExecuteChangedHandlers;\n\n    #endregion\n}\n</code></pre>\n\n<p>And the CommandManager:</p>\n\n<pre><code>    internal class CommandManagerHelper\n{\n    internal static void CallWeakReferenceHandlers(List&lt;WeakReference&gt; handlers)\n    {\n        if (handlers != null)\n        {\n            // Take a snapshot of the handlers before we call out to them since the handlers\n            // could cause the array to me modified while we are reading it.\n\n            EventHandler[] callees = new EventHandler[handlers.Count];\n            int count = 0;\n\n            for (int i = handlers.Count - 1; i &gt;= 0; i--)\n            {\n                WeakReference reference = handlers[i];\n                EventHandler handler = reference.Target as EventHandler;\n                if (handler == null)\n                {\n                    // Clean up old handlers that have been collected\n                    handlers.RemoveAt(i);\n                }\n                else\n                {\n                    callees[count] = handler;\n                    count++;\n                }\n            }\n\n            // Call the handlers that we snapshotted\n            for (int i = 0; i &lt; count; i++)\n            {\n                EventHandler handler = callees[i];\n                handler(null, EventArgs.Empty);\n            }\n        }\n    }\n\n    internal static void AddHandlersToRequerySuggested(List&lt;WeakReference&gt; handlers)\n    {\n        if (handlers != null)\n        {\n            foreach (WeakReference handlerRef in handlers)\n            {\n                EventHandler handler = handlerRef.Target as EventHandler;\n                if (handler != null)\n                {\n                    CommandManager.RequerySuggested += handler;\n                }\n            }\n        }\n    }\n\n    internal static void RemoveHandlersFromRequerySuggested(List&lt;WeakReference&gt; handlers)\n    {\n        if (handlers != null)\n        {\n            foreach (WeakReference handlerRef in handlers)\n            {\n                EventHandler handler = handlerRef.Target as EventHandler;\n                if (handler != null)\n                {\n                    CommandManager.RequerySuggested -= handler;\n                }\n            }\n        }\n    }\n\n    internal static void AddWeakReferenceHandler(ref List&lt;WeakReference&gt; handlers, EventHandler handler)\n    {\n        AddWeakReferenceHandler(ref handlers, handler, -1);\n    }\n\n    internal static void AddWeakReferenceHandler(ref List&lt;WeakReference&gt; handlers, EventHandler handler, int defaultListSize)\n    {\n        if (handlers == null)\n        {\n            handlers = (defaultListSize &gt; 0 ? new List&lt;WeakReference&gt;(defaultListSize) : new List&lt;WeakReference&gt;());\n        }\n\n        handlers.Add(new WeakReference(handler));\n    }\n\n    internal static void RemoveWeakReferenceHandler(List&lt;WeakReference&gt; handlers, EventHandler handler)\n    {\n        if (handlers != null)\n        {\n            for (int i = handlers.Count - 1; i &gt;= 0; i--)\n            {\n                WeakReference reference = handlers[i];\n                EventHandler existingHandler = reference.Target as EventHandler;\n                if ((existingHandler == null) || (existingHandler == handler))\n                {\n                    // Clean up old handlers that have been collected\n                    // in addition to the handler that is to be removed.\n                    handlers.RemoveAt(i);\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["python","multithreading","vim","multiprocessing"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":13144176,"title":"Python: Continuously and cancelably repeat execution with fixed interval","body":"<p>What is the best way to continuously repeat the execution of a given function at a fixed interval while being able to terminate the executor (thread or process) immediately?</p>\n\n<p>Basically I know two approaches:</p>\n\n<ol>\n<li>use multiprocessing and function with infinite cycle and <code>time.sleep</code> at the end. Processing is terminated with <code>process.terminate()</code> in any state.</li>\n<li>use threading and constantly recreate timers at the end of the thread function. Processing is terminated by <code>timer.cancel()</code> while sleeping.</li>\n</ol>\n\n<p>(both “in any state” and “while sleeping” are fine, even though the latter may be not immediate). The problem is that I have to use both multiprocessing and threading as the latter appears not to work on ARM (some fuzzy interaction of python interpreter and vim, outside of vim everything is fine) (I was using the second approach there, have not tried threading+cycle; no code is currently left) and the former spawns way too many processes which I would like not to see unless really required. This leads to a problem of having to code two different approaches while <code>threading</code> with cycle is just a few more imports for drop-in replacements of all <code>multiprocessing</code> stuff wrapped in <code>if</code>/<code>else</code> (except that there is no <code>thread.terminate()</code>). Is there some better way to do the job?</p>\n\n<p>Currently used code is <a href=\"https://bitbucket.org/ZyX_I/aurum/src/1dc9ed228ca82ad6bf5b718df07148064420a9d7/python/aurum/repeatedcmd.py\" rel=\"nofollow\">here</a> (currently with cycle for both jobs), but I do not think it will be much useful to answer the question.</p>\n\n<p><strong>Update</strong>: The reason why I am using this solution are functions that display file status (and some other things like branch) in version control systems in vim statusline. These statuses must be updated, but updating them immediately cannot be done without using hooks and I have no idea how to set hooks temporary and remove on vim quit without possibly spoiling user configuration. Thus standard solution is cache expiring after N seconds. But when cache expired I need to do an expensive shell call and the delay appears to be noticeable, the more noticeable the heavier IO load is. What I am implementing now is updating values for viewed buffers each N seconds in a separate process thus delays are bothering that process and not me. Threads are likely to also work because GIL does not affect calls to external programs.</p>\n"},{"tags":["java","multithreading","caching","locking","volatile"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13144008,"title":"Cache Not updating for MCS Lock in Java","body":"<p>I'm getting some really odd cache behavior for an MCS Lock in Java. Basically, it will work for up to four threads (the number of cores on my machine), but will get stuck for more. When I debug, I see that the program is getting stuck on the line</p>\n\n<pre><code>while (qnode.locked);\n</code></pre>\n\n<p>Inside of the lock() function. When debugging, I can see that one of the thread's QNode has locked set to false, but I'm guessing that's because the debugger causes the cache to update. I just threw \"volatile\" onto all variables as a desperate attempt to no avail. Here's the class that I'm using:</p>\n\n<pre><code>class MCSLock\n{\nprivate volatile AtomicReference&lt;QNode&gt; tail;\nprivate volatile ThreadLocal&lt;QNode&gt; myNode;\n\npublic MCSLock()\n{\n    tail = new AtomicReference&lt;QNode&gt;(null);\n    myNode = new ThreadLocal&lt;QNode&gt;()\n            {\n                protected QNode initialValue() { return new QNode(); }\n            };\n}\n\npublic void lock()\n{\n    QNode qnode = myNode.get();\n    QNode pred = tail.getAndSet(qnode);\n    if (pred != null)\n    {\n        qnode.locked = true;\n        pred.next = qnode;\n        while (qnode.locked);\n    }\n}\n\npublic void unlock()\n{\n    QNode qnode = myNode.get();\n    if (qnode.next == null)\n    {\n        if (tail.compareAndSet(qnode, null)) return;\n        while (qnode.next == null);\n    }\n    qnode.next.locked = false;\n    qnode.next = null;\n}\n\nprivate class QNode\n{\n    volatile boolean locked = false;\n    volatile QNode next = null;\n}\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":35,"score":-4,"question_id":13147993,"title":"Primitives and Threading","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9983591/what-operations-are-atomic-operations\">What operations are atomic operations</a>  </p>\n</blockquote>\n\n\n\n<p>Let's say that I have an instance variable and multiple threads incrementing it. </p>\n\n<p>Is that thread safe? Will the variable always increment by one if each thread increments it by one? </p>\n\n<p>How do I make it thread safe? By declaring it volatile? </p>\n"},{"tags":["multithreading","gwt","tomcat","memory-leaks"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13147902,"title":"Tomcat not shutting down properly with threaded GWT app using ExecutorService","body":"<p>I'm having problems with a Google Web Toolkit Application that uses two SingleThreadExecutor threads and one FixedThreadPool. I can see from the catalina.out log that the threads aren't being shut down properly which causes the tomcat process to keep running:</p>\n\n<pre><code>INFO: Stopping service Catalina\nOct 30, 2012 2:16:48 PM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads\nSEVERE: The web application [/btq] appears to have started a thread named [pool-4-thread-1] but has failed to stop it. This is very likely to create a memory leak.\nOct 30, 2012 2:16:48 PM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads\nSEVERE: The web application [/btq] appears to have started a thread named [pool-5-thread-1] but has failed to stop it. This is very likely to create a memory leak.\nOct 30, 2012 2:16:48 PM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads\nSEVERE: The web application [/btq] appears to have started a thread named [Thread-4] but has failed to stop it. This is very likely to create a memory leak.\n</code></pre>\n\n<p>I found some reference to using a ServletContextListener to handle this kind of thing, but I'm having problems getting it to work in my situation.</p>\n\n<p>In one attempt I added the ServletContextListener to my GUIImpl class which is the server side implementation of the GWT code:</p>\n\n<pre><code>public class GUIImpl extends RemoteServiceServlet implements GUI, ServletContextListener\n</code></pre>\n\n<p>I guess this maybe isn't the way this is normally done, but I tried to do it this way because the class that instantiates the ExecutorService's is in another package that contains some shared code with other projects. My implementation just calls some shutdown functions on other classes, but I am getting some exceptions.</p>\n\n<pre><code>    @Override\npublic void contextDestroyed(ServletContextEvent event) {\n\n    this.context = event.getServletContext();\n    context.log( \"FUNCTION: GUIImpl.contextDestroyed - called\" );\n\n    // Tell the Presenter to shut down\n    presenter.shutdown();\n}\n</code></pre>\n\n<p>The Presenter class has an instance of a FileSystemMonitor class which is the one that instantiates the Executors. The exception in the logs is:</p>\n\n<pre><code>Oct 30, 2012 2:16:48 PM org.apache.catalina.core.ApplicationContext log\nINFO: FUNCTION: GUIImpl.contextDestroyed - called\nOct 30, 2012 2:16:48 PM org.apache.catalina.core.StandardContext listenerStop\nSEVERE: Exception sending context destroyed event to listener instance of class com.mdaus.btq.gui.server.GUIImpl\njava.lang.NullPointerException\n  at com.mdaus.btq.gui.server.GUIImpl.contextDestroyed(GUIImpl.java:1236)\n  at org.apache.catalina.core.StandardContext.listenerStop(StandardContext.java:4831)\n  at org.apache.catalina.core.StandardContext.stopInternal(StandardContext.java:5478)\n  at org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232)\n  at org.apache.catalina.core.ContainerBase$StopChild.call(ContainerBase.java:1575)\n  at org.apache.catalina.core.ContainerBase$StopChild.call(ContainerBase.java:1564)\n  at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n  at java.util.concurrent.FutureTask.run(FutureTask.java:166)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n  at java.lang.Thread.run(Thread.java:722)\n\nOct 30, 2012 2:16:48 PM org.apache.catalina.core.ApplicationContext log\nINFO: SessionListener: contextDestroyed()\nOct 30, 2012 2:16:48 PM org.apache.catalina.core.ApplicationContext log\nINFO: ContextListener: contextDestroyed()\n</code></pre>\n\n<p>Sorry if the question is a little long and confusing, but I'm a little confused right now, as I did not write the original code.</p>\n\n<p>Does anyone have ideas as to how I can shut down these threads?</p>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":4,"view_count":87,"score":-3,"question_id":13147243,"title":"I want to make the execution order of threads sequentially one after another","body":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\nusing namespace std;\n\nint count = 0;\n\nDWORD WINAPI Tf1 ( LPVOID n )\n{\n    HANDLE hEvent = OpenEvent ( EVENT_ALL_ACCESS , false, (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) { return -1; }\n    // Loop through and wait for an event to occur\n    for ( ;; )\n    {\n        // Wait for the Event\n        WaitForSingleObject ( hEvent, INFINITE );\n        count++;\n        printf(\"In function1, Counter value: %d\\n\",count);\n        //    No need to Reset the event as its become non signaled as soon as\n        //    some thread catches the event.\n        if( count &gt; 7 ) return 0;\n    }\n    CloseHandle(hEvent);\n    return 0;\n}\n\nDWORD WINAPI Tf2 ( LPVOID n )\n{\n\n    HANDLE hEvent = OpenEvent ( EVENT_MODIFY_STATE , false, (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) return -1; \n\n    for ( ;; )\n    {\n        if( count % 2 == 0) \n            SetEvent (hEvent);\n        else\n        {\n            count++;\n            printf(\"In function2, Counter value: %d\\n\",count);\n        }\n        //    No need to Reset the event as its become non signaled as soon as\n        //    some thread catches the event.\n        if( count &gt; 7 ) return 0;\n    }\n    CloseHandle(hEvent);\n    return 0;\n}\n\nint main()\n{\n    //    Create an Auto Reset Event which automatically reset to \n    //    Non Signalled state after being signalled\n    HANDLE     hEvent = CreateEvent ( NULL , false , false , (LPCWSTR)\"MyEvent\" );\n    if ( !hEvent ) return -1;\n    //    Create a Thread Which will wait for the events to occur\n    HANDLE mutex = CreateMutex(NULL, FALSE, NULL);\n\n    DWORD Id;\n    HANDLE hThrd1 = CreateThread ( NULL, 0, (LPTHREAD_START_ROUTINE)Tf1,0,0,&amp;Id );\n    HANDLE hThrd2 = CreateThread ( NULL, 0, (LPTHREAD_START_ROUTINE)Tf2,0,0,&amp;Id );\n\n    if ( !hThrd1 ) { CloseHandle (hEvent); return -1; }\n    if ( !hThrd2 ) { CloseHandle (hEvent); return -1; }\n    // Wait for a while before continuing....\n    Sleep ( 1000 );\n    // Give the signal twice as the thread is waiting for 2 signals to occur\n\n    // Wait for the Thread to Die\n    WaitForSingleObject ( hThrd1, INFINITE );\n    WaitForSingleObject ( hThrd2, INFINITE );\n\n    CloseHandle ( hThrd1 );\n    CloseHandle ( hThrd2 );\n    CloseHandle ( hEvent );\n\n    system ( \"PAUSE\" );\n    return 0;\n}\n</code></pre>\n\n<p><strong>O/P:</strong></p>\n\n<pre><code>In function1, Counter value: 1\nIn function1, Counter value: 3\nIn function2, Counter value: 2\nIn function2, Counter value: 4\nIn function2, Counter value: 6\nIn function1, Counter value: 5\nIn function1, Counter value: 7\nIn function2, Counter value: 8\n</code></pre>\n\n<p><strong>Desired O/P:</strong></p>\n\n<pre><code>In function1, Counter value: 1\nIn function2, Counter value: 2\nIn function1, Counter value: 3\nIn function2, Counter value: 4\nIn function1, Counter value: 5\nIn function2, Counter value: 6\nIn function1, Counter value: 7\nIn function2, Counter value: 8\n</code></pre>\n\n<p>I know i am not utilizing the power of threads. But my requirement is like this. How can i achieve this?</p>\n"},{"tags":["c++","multithreading","c++11","condition-variable"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":114,"score":6,"question_id":13142255,"title":"What is the difference between std::condition_variable::wait_for and std::condition_variable::wait_until?","body":"<p>The <a href=\"http://en.cppreference.com/w/cpp/thread/condition_variable\">reference I'm using</a> explains the two in the following way:</p>\n\n<ul>\n<li><p><code>wait_for</code> \"blocks the current thread until the condition variable is woken up or after the specified timeout duration\"</p></li>\n<li><p><code>wait_until</code> \"blocks the current thread until the condition variable is woken up or until specified time point has been reached\"</p></li>\n</ul>\n\n<p>What is the difference? Will <code>wait_until</code> spin so that the thread can continue exactly (more or less) when it is signaled, whereas <code>wait_for</code> just adds the thread back into scheduling at that point?</p>\n"},{"tags":["java","multithreading","resume","suspend"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":48,"score":0,"question_id":13146993,"title":"Pausing/resuming multiple threads in java","body":"<p>Trying to write a program that will run, suspend, and resume 3 threads.  </p>\n\n<p>here's the coding:</p>\n\n<pre><code>class Connectthread implements Runnable\n{\npublic void run()\n{\n    for(int j=0;j&lt;90;j+=10)\n    System.out.println(\"Connecting...\" + j + \" Secs\");\n}\n}\n\nclass DLoadthread implements Runnable\n{\npublic void run()\n{\n    for(int d=0;d&lt;60;d+=10)\n    System.out.println(\"Downloading...\" + d + \" Secs\");\n}\n}\nclass Runthread implements Runnable\n{\npublic void run()\n{\n    for(int r=0;r&lt;120;r+=10)\n    System.out.println(\"Running...\" + r + \" Secs\");\n}\n}\nclass EHAunitThread\n{\nConnectthread ct=new Connectthread();\nDLoadthread dt=new DLoadthread();\nRunthread rt=new Runthread();\n\npublic void main(String arg[])\n{\n    //putting threads into ready state.\n    System.out.print(\"Starting threads\\n\");\n    ct.start();\n    dt.start();\n    rt.start();\n\n    System.out.print(\"Sleeping 3 seconds\\n\");\n    safeSleep(3000, \"Threads first sleep time interrupted\\n\");\n    System.out.print(\"Suspending threads\\n\");\n    ct.suspend();\n    dt.suspend();\n    rt.suspend();\n\n    System.out.print(\"Sleep 5 seconds\\n\");\n    safeSleep(5000, \"Threads second sleep time interrupted\\n\");\n    System.out.print(\"Resume threads\\n\");\n    ct.resume();\n    dt.resume();\n    rt.resume();\n\n    try\n    {\n        ct.join();\n        dt.join();\n        rt.join();\n    }\n    catch (InterruptedException e)\n    {\n        System.out.print(\"Join interrupted\");\n    }\n\n    System.out.print(\"Testcase Completed\");\n    System.exit(0);\n}\n}\n</code></pre>\n\n<p>it keeps giving me 14 of these <code>error:cannot find symbol</code> messages when i try to compile it.</p>\n\n<p>To my knowledge, the coding <em>looks</em> correct as far as grammar is concerned. What am I doing wrong here?</p>\n"},{"tags":["c#",".net","multithreading","thread-safety","thread-synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13146551,"title":"Console.writeline() multithreading problems","body":"<p>I am trying to mock up of a chat client. First here's the code</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading;\n\nnamespace thread\n{\n    class Program\n    {\n\n    public static Thread t1;\n    public static Thread t2;\n    public static bool flag;\n    public static Random rand = new Random();\n\n    static void Main(string[] args)\n    {\n        t1 = new Thread(first);\n        t2 = new Thread(second);\n        t1.Start();\n        t2.Start();\n\n        Console.Read();\n    }\n\n    public static void first()\n    {\n\n        string[] phrase = { \"Hello\", \"random\", \"blah,blah\", \"computer\", \"Welcome\", \"This is chat bot\" };\n        while (!flag)\n        {\n            Thread.Sleep(4000);\n            Console.WriteLine(\"{0}\", phrase[rand.Next(6)]);\n        }\n    }\n\n    public static void second()\n    {\n        string input = \"\";\n        while (input!=\"x\")\n        {\n\n            input=Console.ReadLine();\n            if (input==\"x\")\n            {\n                break;\n            }\n\n        }\n        flag = true;\n    }\n\n\n   }\n}\n</code></pre>\n\n<p>Ok so this program would automatically print some text on console, and i can write my message on the screen too. Now the problem is that whenever i am typing a long sentence,\nanything that takes more than 4 seconds to type. Then instead of the automated message being printed on the next line it just gets append to whatever i am typing. I am really new to multi threading so i am not exactly sure what's the problem. I think both the threads are using the same console class.</p>\n\n<p>Help would be appreciated in this regard.</p>\n"},{"tags":["c#","multithreading","aforge"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13146339,"title":"how to properly exit a multi threaded program","body":"<p>Well i made a program based on Aforge (it's a video library).<br>\nThis library creates its own refresh events for the next video frame from camera.<br>\nSo far so good, earlier people have helped me with multi threading so these Aforge threads could report back to the main program thread, again so far so good, it works great.</p>\n\n<p>Te code can be seen here :\n<a href=\"http://stackoverflow.com/questions/12966288/how-to-do-multithreading-when-using-outside-referenced-code\">how to do multithreading when using outside referenced code</a></p>\n\n<p>But now i regularly notice a new program error. <br>\nThe problem starts when i want to exit the program.<br>\nAt the moment the Aforge thread might still be active.<br>\nAnd it wants to write back to main form that is closed.</p>\n\n<p>Somehow i need to stop the other thread before i close the program.<br>\nThere is an option in Aforge to do something like camera stop, but its not enough.<br>\nBut then still my code wants to write on the main form thats allready closing.<br></p>\n\n<p>Is there a way to stop all threads, or some safeway to close from the originating thread ?\nI even placed the back reporting to the main program in a try catch construction but it didnt work well, the only way of stopping it in these situations is to press the stop execution button within visual studio itself.</p>\n"},{"tags":["java","multithreading","jdbc","queue","connection-pooling"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13145588,"title":"Java single worker thread for SQL update statements","body":"<p>I'm working on a Java-based server in which I will have multiple threads (one thread for each connected user + some extra). There will be some database connection involved, so I was thinking that each time the server makes a <em>SELECT</em> query to the database it will start a new thread for this, to prevent blocking from the current thread. I'm planning on using a connection pool for this and I think I know how to do that. (I've looked into <a href=\"http://www.mchange.com/projects/c3p0/index.html\" rel=\"nofollow\">C3P0</a>) However, there will be a lot of <em>UPDATE</em> statements involved also, but it's not important that these are ran directly, it's ok with a delay here. And since there might be a lot of <em>UPDATE</em> statements, I'm thinking of having a single worker thread for all <em>UPDATE</em> statements. As I see it, this will have the advantage of being able to re-use <code>PreparedStatement</code>-objects</p>\n\n<p><strong>The question:</strong>\nHow can I, from the other threads, tell the <em>UPDATE</em>-worker thread to run some statements? I know about multithreading and how to make threads \"talk\" to each other using synchronized blocks, but with the database involved it suddenly feels more complex. I have read that prepared statements and connections should not be shared between threads.</p>\n\n<p><strong>The idea I have right now on how to solve it:</strong> (doesn't feel like a good solution)</p>\n\n<p>Use a <code>LinkedBlockingQueue</code> (or another kind of Queue) of a custom class with information about which kind of UPDATE statement to call and which parameters to send it. And then the worker thread will read from this queue when it's notified (which it will be when something is added to the queue) and there it will run the appropriate method which will use the appropriate prepared statement, set the params, and call it.</p>\n\n<p><strong>Edit:</strong> A bad think that I see myself with this approach is that the params might be ints, String, double, or whatever. How to store them in the custom class? Doesn't feel good to store them all as String.</p>\n\n<p>Am I on the right track here or is there a better way to solve this?</p>\n"},{"tags":["c++","multithreading","global","member"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":13143327,"title":"Multithreading Design, protect global member in C++","body":"<p>I am writing a c++ app with QT, with a focus at speed optimization.\nI want to have a few global objects with read only access for different threads.\nBefore I open the threads, I have to initialize the global objects and fill them with data.</p>\n\n<p>How I can protect the set functions of my Global Objects, but still have access from the main function?</p>\n\n<p>Example code like it is now:</p>\n\n<p>myClass.h</p>\n\n<pre><code>class MyObjectClass {\npublic:\nvoid SetSome(const QList&lt;QString&gt; &amp;value);\nQList&lt;QString&gt; GetSome() const;\n\nprivate:\n    QList&lt;QString&gt; m_myMember;\n};\n</code></pre>\n\n<p>main.cpp    </p>\n\n<pre><code>#include \"global.h\" // some like: extern MyObjectClass g_InihalizedInMain;\n#include \"anyThread.h\"\n\nint main(){\n\ng_InitializedInMain.SetSome() // This Shut work\n\nMyThread thread;\nthread.start();\n\n//..\nreturn 0;\n}\n</code></pre>\n\n<p>anyThread.cpp:</p>\n\n<pre><code>#include \"global.h\"\n\nvoid thread::run()\n{\nMyObjectClass newObject = g_InihalizedInMain; //This shut work\ng_InitializedInMain.GetSome();                  //This shut work\ng_InitializedInMain.SetSome();                  //This shut not work and give me an error during compile time\nnewObject.SetSome();                    //This shut work\n}\n</code></pre>\n\n<p>I would be happy if you have a few design ideas for me, thanks a lot!</p>\n"},{"tags":["vb.net","multithreading","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13144352,"title":"Trouble Marshalling the Ui Thread","body":"<p>I'm trying to update the text of a label from a seperate class on a separate thread. The other class raises an event which is handled here</p>\n\n<pre><code>    Private Sub handleChangeUI(ByVal sender As System.Object)\n    Dim ytde As Data_Entry_Form.YTD = CType(sender, Data_Entry_Form.YTD)\n\n    UpdateExcelLabel(ytde.LabelMessage)\nEnd Sub\n</code></pre>\n\n<p>And in the updateExcelLabel method I was hoping to change the label's text with the following</p>\n\n<pre><code> Private Delegate Sub updateExcelDelegate(txt As String)\nPublic Sub UpdateExcelLabel(text As String)\n    If Me.lblExcel.InvokeRequired = True Then\n        Dim del As New updateExcelDelegate(AddressOf UpdateExcelLabel)\n        Me.lblExcel.BeginInvoke(del, text)\n    Else\n        Me.lblExcel.Visible = True\n        Me.lblExcel.Text = text\n        Me.lblExcel.Refresh()\n    End If\nEnd Sub\n</code></pre>\n\n<p>For some reason the Me.lblExcel.InvokeRequired is always returning true. I'm still very new when it comes to delegates and multi-threading so any help would be greatly appreciated.</p>\n"},{"tags":["java","multithreading","classpath"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13136509,"title":"NoClassDefFoundError in threads","body":"<p>Hi I got a exception NoClassDefFoundError when I run a thread.\nThis process runs well when i execute without threads, but when I execute the start method, I got this error in different statements</p>\n\n<p>Is it possible that threads got a different class path that the main thread?</p>\n\n<p>thanks\nedit to add code</p>\n\n<p>Run method:</p>\n\n<pre><code>public void run(){\n    try{\n        boolean startAction = HeapThread.addAction(idCliente, idThread, Constants.ACTION_CREATE_TOPIC);\n        if (!startAction) {\n            synchronized (this){\n                this.wait();\n            }\n        }\n        createTopic();\n    }\n    catch(Exception ex){\n        log.error(\"Error\", ex);\n    }\n    finally {\n        Long nextIdThread = HeapThread.getNextAction(idCliente, idThread, Constants.ACTION_CREATE_TOPIC);\n        if (nextIdThread &gt; 0){\n            log.debug(\"Thread\");\n            ThreadState thread = HeapThread.getState(nextIdThread);\n            synchronized (thread) {\n                thread.notify();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>createTopic() function calls searchBlog() and there I call this</p>\n\n<pre><code>try{\n        sessionId = SessionWS.createSession(url, false);\n        CrawlerSearch crawler = new CrawlerSearchAPIService(new URL(url + Constants.URL_CRAWLER), new QName(Constants.QNAME_CRAWLER, \"CrawlerSearchAPIService\")).getCrawlerSearchAPIPort();\n        // para cada topico obtnemos 10 blogs\n        for (Long idTopic : blogsTopics.keySet()) {\n</code></pre>\n\n<p>...</p>\n\n<p>and full exception is:</p>\n\n<pre><code>java.lang.NoClassDefFoundError: com/befasoft/common/business/webservices/client/Session\nat com.befasoft.common.business.webservices.client.SessionAPIService.getSessionAPIPort(SessionAPIService.java:56)\nat com.befasoft.common.business.webservices.SessionWS.createSession(SessionWS.java:21)\nat com.humanlike.web.tools.Crawler.searchBlogs(Crawler.java:50)\nat com.humanlike.web.theads.CreateTopic.createTopic(CreateTopic.java:164)\nat com.humanlike.web.theads.CreateTopic.run(CreateTopic.java:63)\n</code></pre>\n"},{"tags":[".net","multithreading","threadabortexception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13140961,"title":"LegacyUnhandledExceptionPolicy doesn't allow to catch (and swallow) ThreadAbortException?","body":"<p>I'm using .NET 1.1 compability mode for unhandled exception handling. The problem is that when LegacyUnhandledExceptionPolicy is set to \"1\" (which is what I want), I cannot catch and swallow ThreadAbortException.</p>\n\n<p><strong>Example code:</strong></p>\n\n<p>App.config:</p>\n\n<pre><code>&lt;configuration&gt;\n   &lt;runtime&gt;\n      &lt;legacyUnhandledExceptionPolicy enabled=\"1\"/&gt;\n   &lt;/runtime&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>   class Program {\n\n      static void Main(string[] args) {\n         AppDomain.CurrentDomain.UnhandledException += _onBackgroundThreadCrash;\n         var t = new Thread(_worker) { IsBackground = true };\n         t.Start();\n         Thread.Sleep(1000);\n         t.Abort();\n         Console.ReadLine();\n      }\n\n      private static void _worker() {\n         try {\n            while (true);\n         } catch (ThreadAbortException) { \n            // expected thread exit, don't rethrow\n         }\n      }\n\n      private static void _onBackgroundThreadCrash(object sender, UnhandledExceptionEventArgs e) {\n         Console.WriteLine(e.ExceptionObject as Exception);\n      }\n\n   }\n</code></pre>\n\n<p>When legacy exceptions handling is \"0\" (OFF), the above code swallows ThreadAbortException queitly, as expected.</p>\n\n<p>But, when legacy exceptions handling is \"1\" the above code prints ThreadAbortException to console, which is not what I expect.</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks.</p>\n"},{"tags":["python","multithreading","multiprocessing"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12159328,"title":"Race condition using multiprocessing and threading together","body":"<p>I wrote the sample program.\nIt creates 8 threads and spawns process in each one</p>\n\n<pre><code>import threading\nfrom multiprocessing import Process\n\ndef fast_function():\n    pass\n\ndef thread_function():\n    process_number = 1\n    print 'start %s processes' % process_number\n    for i in range(process_number):\n        p = Process(target=fast_function, args=())\n        p.start()\n        p.join()\n\ndef main():\n    threads_number = 8\n    print 'start %s threads' % threads_number\n    threads = [threading.Thread(target=thread_function, args=()) \n            for i in range(threads_number)]\n\n    for thread in threads:\n        thread.start()\n\n    for thread in threads:\n        thread.join()\n</code></pre>\n\n<p>It crashes with several exceptions like this</p>\n\n<pre><code>Exception in thread Thread-3:\nTraceback (most recent call last):\n  File \"/usr/lib/python2.6/threading.py\", line 532, in __bootstrap_inner\n    self.run()\n  File \"/usr/lib/python2.6/threading.py\", line 484, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"./repeat_multiprocessing_bug.py\", line 15, in thread_function\n    p.start()\n  File \"/usr/lib/python2.6/multiprocessing/process.py\", line 99, in start\n    _cleanup()\n  File \"/usr/lib/python2.6/multiprocessing/process.py\", line 53, in _cleanup\n    if p._popen.poll() is not None:\n  File \"/usr/lib/python2.6/multiprocessing/forking.py\", line 106, in poll\n    pid, sts = os.waitpid(self.pid, flag)\nOSError: [Errno 10] No child processes\n</code></pre>\n\n<p>Python version 2.6.5. Can somebody explain what I do wrong?</p>\n"},{"tags":["c#",".net","multithreading","visual-studio-2010","visual-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13142599,"title":"How to manually kill a specific (running) thread from Visual Studio","body":"<p>For the purpose of testing, I need to <strong>manually</strong> kill a named thread (in a debugging session) from Visual Studio - or any other tool that allows me to do that?</p>\n\n<p>But the <code>Threads</code> Debug Window in Visual Studio 2010 only has a <code>Freeze</code> option in the thread's context menu, and Sysinternal's <a href=\"http://en.wikipedia.org/wiki/Process_Explorer\" rel=\"nofollow\">ProcessExplorer</a> only lists processes, not threads.</p>\n\n<p>Is there a way to manually kill a specific (running) thread?</p>\n"},{"tags":["multithreading","qt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13142051,"title":"Qt threading stopped UI from responding","body":"<p>I think I might misunderstood several concepts in Qt's threading,</p>\n\n<p>In my window class, which is derived from QWidget:</p>\n\n<pre><code>class Widget \n{\n   Q_OBJECT\npublic:\n   Widget::Widget (QObject *parent = 0) : QObject(parent)\n   {\n     moveToThread(&amp;th); // still stuck\n     connect (&amp;th, SIGNAL(started()), SLOT(doWork())); \n     th.start();\n   }\nprivate:\n   QThread th;\nprivate slots:\n  void doWork () \n  { \n     // hmm, this stuck the UI\n     while (1) \n     { \n       qDebug() &lt;&lt; \"Sleeping\"; \n     } \n  };\n};\n</code></pre>\n\n<p>The forever loop stuck the UI, it shouldn't be, since that was called by the QThread.\nCan anyone point out what's wrong about this code?</p>\n"},{"tags":["java","multithreading","attributes"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":13142934,"title":"Sharing objects between multiple threads in a game","body":"<p>Programming language: JAVA / Android</p>\n\n<h1>Thread \"Structure\"</h1>\n\n<p>Main Thread (starts other treads)</p>\n\n<p>---(multiple attributes)</p>\n\n<p>---AI thread</p>\n\n<p>---TouchListener thread</p>\n\n<p>---Scripting thread</p>\n\n<p>---Render thread</p>\n\n<h1>Description</h1>\n\n<p>An example for an attribute would be an actor that is instructed by the scritping thread;\nhas it's route calculated by the AI thread and the 3D coordinates changed by the renderer.</p>\n\n<p>All the threads are NOT private inner classes with access to the attributes, instead they are simple classes which implement Runnable</p>\n\n<h1>Question</h1>\n\n<p>How to share objects (the attributes) between those endlessly running threads?\nEvery thread must have access to all the resources of the main thread.\n(the question is not about how to syncronize them, I know \"syncronized\" and the concept of locks already)</p>\n"},{"tags":["multithreading","rabbitmq","blocking","bulk"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13142646,"title":"Publishing messages in background with Pika","body":"<p>I'm trying to do a bulk endpoint with pika, but pika doesn't publish anything, I'm not receiving any errors, I have a workaround but I don't like it. Here it's the code that doesn't work:</p>\n\n<pre><code>class Controller:\n\n    def __init__(self):\n        self.event = None\n        self.channel = None\n        self.messages = []\n\n    def on_connected(self, connection):\n        self.connection = connection\n        connection.channel(self.on_channel_open)\n\n    def on_channel_open(self, channel_):\n        result = channel_.queue_declare(queue = \"queue\", durable=True, auto_delete=False,\n                          callback=self.on_queue_declared)\n        self.channel = channel_\n\n\n    def on_queue_declared(self, data):\n        self.channel.basic_qos(prefetch_count=10)\n        self.channel.queue_bind(exchange='exchange',\n                   queue=data.method.queue,\n                   routing_key=\"routingKey\")\n        self.channel.basic_consume(self.handle_delivery, queue=data.method.queue)\n\n    def handle_delivery(self, channel, method_frame, header_frame, body):\n        if self.event and self.event.isAlive():\n            self.event.cancel()\n\n        messages.append((method_frame, header_frame, body))\n\n        if len(messages) == BATCH_SIZE:\n            self.process(messages)\n        elif len(messages) &gt; 0:   \n            self.event = Timer(10, self.process, ())\n            self.event.start()\n\n    def process(self):\n        for data in self.messages:\n            body = data[2]\n            header_frame = data[1]\n            method_frame = data[0]\n            make_something(body)\n            self.channel.basic_publish(exchange='',\n                    routing_key= 'otherRoutingKey',\n                    body=\"data\")\n            channel.basic_ack(delivery_tag=method_frame.delivery_tag)\n\nif __name__ == '__main__':\n\n    controller = Controller()\n\n    host = (len(sys.argv) &gt; 1) and sys.argv[1] or '127.0.0.1'\n    parameters = pika.ConnectionParameters(host)\n    connection = SelectConnection(parameters, controller.on_connected)\n    try:\n        connection.ioloop.start()\n    except KeyboardInterrupt:\n        connection.close()\n        connection.ioloop.start()\n</code></pre>\n\n<p>And Here the workaround. Instead of</p>\n\n<pre><code>self.channel.basic_publish(exchange='', routing_key= 'otherRoutingKey', body=\"data\")\n</code></pre>\n\n<p>I'm using a blocking connection in the same place:</p>\n\n<pre><code>    connection = pika.BlockingConnection(pika.ConnectionParameters( host='localhost'))\n    channel = connection.channel()\n    channel.basic_publish(exchange='', routing_key= 'otherRoutingKey',\n                body=\"data\")\n</code></pre>\n\n<p>I don't like I'm mixing two types of connections. What is the way to do this?</p>\n"},{"tags":["multithreading","language-agnostic"],"answer_count":18,"favorite_count":25,"up_vote_count":24,"down_vote_count":0,"view_count":2538,"score":24,"question_id":1321615,"title":"What are multi-threading DOs and DONTs?","body":"<p>I am applying my new found knowledge of threading everywhere and getting lots of surprises</p>\n\n<p>Example:<br /></p>\n\n<blockquote>\n  <p>I used threads to add numbers in an\n  array. And outcome was different every\n  time. The problem was that all of my\n  threads were updating the same\n  variable and were not synchronized.</p>\n</blockquote>\n\n<ul>\n<li>What are some known thread issues?</li>\n<li>What care should be taken while using\nthreads?</li>\n<li>What are good multithreading resources.</li>\n<li>Please provide examples.</li>\n</ul>\n\n<p>sidenote:<br />(I renamed my program <code>thread_add.java</code> to <code>thread_random_number_generator.java</code>:-)</p>\n"},{"tags":["c++","c","multithreading","corba","orbacus"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":141,"score":0,"question_id":13009694,"title":"Use multiple ORBs through different threads (multithreaded multi-orb client application) - how?","body":"<p><sub>This question is related to: <a href=\"http://stackoverflow.com/questions/12933790/is-it-possible-to-have-several-orb-objects-in-the-same-process\"><strong>Is it possible to have several ORB objects in the same process?</strong></a> </sub></p>\n\n<p>So, thanks to @BrianKelly I found information about the <code>ORB</code> identifier (even though there was no such information in all <code>ORBACUS</code> docs, that I have) and I successfully created a simple application, that connects to different <code>CORBA</code> servers and successfully executed several <code>CORBA</code> requests.</p>\n\n<p>So far, so good.</p>\n\n<p>Now, what I want to do, is to make this application multithreaded and to start a separate thread for the connection to the different servers. But <code>ORB_init</code> crashes.</p>\n\n<p>Here's a very short code, that I use for testing:</p>\n\n<pre><code>#include &lt;OB/CORBA.h&gt;\n\npthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\nvoid* run( void * );\n\nstruct config { const char* nameservice; const char* id; const char* exe; };\n\nconst bool mt = true;\n\nint main()\n{\n    config cfg1 = { \"NameService=corbaloc::10.102.8.15:13069/NameService\", \"1\", \"test\" };\n    config cfg2 = { \"NameService=corbaloc::192.168.1.99:13069/NameService\", \"2\", \"test\" };\n\n    if( mt )\n    {   \n        pthread_t t1, t2;\n\n        pthread_create( &amp;t1, NULL, run, (void*)&amp;cfg1 ); \n        pthread_create( &amp;t2, NULL, run, (void*)&amp;cfg2 ); \n\n        pthread_join( t1, NULL ); pthread_join( t2, NULL );\n    }\n    else\n    {\n        run( (void*)&amp;cfg1 );\n        run( (void*)&amp;cfg2 );\n    }\n\n    printf( \"SUCCESS!\\n\" );\n    return 0;\n}\n\nvoid* run( void* arg )\n{\n    pthread_mutex_lock( &amp;mutex );\n\n    int argc = 2; char* argv[3];\n\n    config* cfg = (config*)arg;\n    argv[0] = (char*)cfg-&gt;exe;\n    argv[1] = (char*)cfg-&gt;nameservice;\n    argv[2] = NULL;\n\n    CORBA::ORB_var m_varOrb = CORBA::ORB_init( argc, argv, cfg-&gt;id );\n\n    pthread_mutex_unlock( &amp;mutex );\n    return NULL;\n}\n</code></pre>\n\n<p>So, when <code>mt</code> is <code>false</code>, everything's fine, I can extend the code to create some server specific objects, to execute different requests, etc. But then <code>mt</code> is <code>true</code>, the second thread fails calling <code>ORB_init</code>. See the stack trace below.</p>\n\n<p>I'm pretty sure that I'm missing something very simple and stupid, but what?</p>\n\n<pre><code>$ g++ -g3 -ggdb -Wall -Wshadow -march=i486 \n      -DUNIX -DLINUX -DPTHREADS -DMULTITHREAD -D_REENTRANT\n      -I. -I/usr/local/include/OB/ -I/usr/local/include/JTC/ \n      -I/usr/include/OB/ -I/usr/include/JTC/ -L/usr/local/lib \n      -lpthread -lm -lz -lrt -ldl -lOB -lJTC -lCosNaming \n      test.cpp\n</code></pre>\n\n<p>Stacktrace:</p>\n\n<pre><code>#0  0x00566402 in __kernel_vsyscall ()\n#1  0x0080dfd0 in raise () from /lib/i686/nosegneg/libc.so.6\n#2  0x0080f9b1 in abort () from /lib/i686/nosegneg/libc.so.6\n#3  0x03dc490b in ~RefCount \n    (this=Could not find the frame base for \"~RefCount\".) \n    at ../../include/OB/RefCount_Ts_Linux-x86-32.h:43\n#4  0x03ef8965 in ORBInstance \n    (this=Could not find the frame base for \"ORBInstance\".) \n    at ORBInstance.cpp:276\n#5  0x03f134fe in ORB_impl \n    (this=Could not find the frame base for \"ORB_impl\".) \n    at ORB_impl.cpp:281\n#6  0x03f24740 in OBCORBA::ORB_init \n    (ac=Could not find the frame base for \n        \"OBCORBA::ORB_init(int&amp;, char**, OB::Properties*, \n                           OB::Logger*, OB::Reactor*, \n                           char const*, char const*)\". ) \n    at ORB_init.cpp:994\n#7  0x03f249d9 in CORBA::ORB_init \n    (ac=Could not find the frame base for \n         \"CORBA::ORB_init(int&amp;, char**, char const*, char const*)\".) \n    at ORB_init.cpp:1014\n#8  0x0804895d in run (arg=0xbfe8b544) at test_server.cpp:45\n#9  0x007334d2 in start_thread () from /lib/i686/nosegneg/libpthread.so.0\n#10 0x008b848e in clone () from /lib/i686/nosegneg/libc.so.6\n</code></pre>\n"},{"tags":["android","multithreading","handler"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":13140855,"title":"Thread Synchronization and selective thread killing","body":"<p>Hi I am new to android development and recently i found a deadlock for my situation in Thread related mangle. I am trying to synchronize two countdown timers in my Android application with two renew buttons, so whenever i click on them, i would like them to start again with default values and again start counting down. But for this i am using Handlers to post data to Progress-Dialog and Thread objects to start new lines of execution for running two different PDialogs.\nMy Code goes like this :</p>\n\n<pre><code>    package com.example.progressbar;\n\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.os.Handler;\nimport android.os.Message;\nimport android.util.Log;\nimport android.view.View;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.ProgressBar;\nimport android.widget.TextView;\n\npublic class LordClass extends Activity {\n\n    ProgressBar bar_one, bar_two;\n    TextView textView_one, textView_two;\n    Button button_one, button_two;\n    final int TOTAL_ONE = 20;\n    final int TOTAL_TWO = 10;\n    int total_two = TOTAL_TWO;\n    int total_one = TOTAL_ONE;\n    private static Thread[] threads = new Thread[] {};\n\n    boolean isRunning_one = true;\n    boolean isRunning_two = true;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n        textView_one = (TextView) findViewById(R.id.text_one);\n        bar_one = (ProgressBar) findViewById(R.id.progressBar_one);\n        button_one = (Button) findViewById(R.id.btnone);\n        textView_two = (TextView) findViewById(R.id.text_two);\n        bar_two = (ProgressBar) findViewById(R.id.progressBar_two);\n        button_two = (Button) findViewById(R.id.btntwo);\n\n        // if first renew button is clicked\n        button_one.setOnClickListener(new OnClickListener() {\n\n            public void onClick(View v) {\n                total_one = TOTAL_ONE;\n                MyThread myThread = new MyThread();\n                myThread.MyThreadRun(bar_one, handler_one, isRunning_one,\n                        TOTAL_ONE);\n                // isRunning_one = false;\n            }\n        });\n\n        // if second renew button is clicked\n        button_two.setOnClickListener(new OnClickListener() {\n\n            public void onClick(View v) {\n                total_two = TOTAL_TWO;\n                MyThread myThread = new MyThread();\n                myThread.MyThreadRun(bar_two, handler_two, isRunning_two,\n                        TOTAL_TWO);\n                // isRunning_one = false;\n            }\n        });\n\n    }\n\n    Handler handler_one = new Handler() {\n        // int total_one = TOTAL_ONE;\n        public void handleMessage(Message message) {\n\n            total_one -= 1;\n            String timeRemaining = String.valueOf(total_one).toString();\n            textView_one.setText(timeRemaining + \" Seconds Left\");\n            bar_one.incrementProgressBy(1);\n        }\n\n    };\n\n    Handler handler_two = new Handler() {\n        // int total_two = TOTAL_TWO;\n        public void handleMessage(Message message) {\n\n            total_two -= 1;\n            String timeRemaining = String.valueOf(total_two).toString();\n            textView_two.setText(timeRemaining + \" Seconds Left\");\n            bar_two.incrementProgressBy(1);\n        }\n\n    };\n\n    public class MyThread {\n\n        public void MyThreadRun(final ProgressBar bar, final Handler handler,\n                final boolean isRunning, final int total) {\n\n            bar.setProgress(0);\n\n            Thread background = new Thread(new Runnable() {\n\n                public void run() {\n\n                    try {\n\n                        for (int i = 0; i &lt; total &amp;&amp; isRunning; i++) {\n                            Thread.sleep(1000);\n                            handler.sendMessage(handler.obtainMessage());\n                        }\n\n                    } catch (Throwable e) {\n                    }\n\n                }\n            });\n\n            // isRunning = true;\n\n            Log.i(\"No of Threads\", \"\" + Thread.activeCount());\n\n            background.start();\n        }\n\n    }\n}\n</code></pre>\n\n<p>With this i would get the Effect of two PDialogs, but here is the problem.\nProblem :</p>\n\n<p>When i click the same 'renew' button again and again, i get a new thread each time and thereby leading to undesired behaviors like countdown going into negative limits, mainly due to more than one thread running on the same code over and over again.</p>\n\n<p>My LogCat Shows (on each click) :</p>\n\n<ul>\n<li>10-30 19:18:09.812: I/No of Threads(22400): 5 </li>\n<li>10-30 19:18:10.772: I/No of Threads(22400): 6</li>\n<li>10-30 19:18:11.403: I/No of Threads(22400): 7</li>\n<li>10-30 19:18:12.112: I/No of Threads(22400): 8</li>\n<li>10-30 19:18:12.802: I/No of Threads(22400): 9 </li>\n<li>10-30 19:18:13.443: I/No of Threads(22400): 9 </li>\n<li>10-30 19:18:14.232: I/No of Threads(22400): 10 </li>\n<li>10-30 19:18:14.992: I/No of Threads(22400): 11 </li>\n<li>10-30 19:18:15.722: I/No of Threads(22400): 12 </li>\n<li>10-30 19:18:16.162: I/No of Threads(22400): 13</li>\n<li>10-30 19:18:16.912: I/No of Threads(22400): 13 </li>\n<li>10-30 19:18:27.223: I/No of Threads(22400): 10 </li>\n<li>10-30 19:18:30.712: I/No of Threads(22400): 9 </li>\n<li>10-30 19:18:40.943: I/No of Threads(22400): 5 </li>\n<li>10-30 19:18:43.563: I/No of Threads(22400): 5</li>\n</ul>\n\n<p>Please help me to resolve this problem and help me to attain Thread Synchronization.</p>\n"},{"tags":["java","multithreading","drools","drools-guvnor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13137234,"title":"JVM running out of connections resulting into high CPU utilization and OutOfMemoryException","body":"<p>We have a 64 bit linux machine and we make multiple HTTP connections to other services and Drools Guvnor website(Rule engine if you don't know) is one of them. In drools, we create knowledge base per rule being fired and creation of knowledge base makes a HTTP connection to Guvnor website.</p>\n\n<p>All other threads are blocked and CPU utilization goes up to ~100% resulting into OOM. We can make changes to compile the rules after 15-20 mins. but I want to be sure of the problem if someone has already faced it.</p>\n\n<p>I checked for <code>\"cat /proc/sys/kernel/threads-max\"</code> and it shows 27000 threads, Can it be a reason?</p>\n\n<p>I have a couple of question:</p>\n\n<ol>\n<li>When do we know that we are running over capacity?</li>\n<li>How many threads can be spawned internally (any rough estimate or formula relating diff parameters will work)?</li>\n<li>Has anyone else seen similar issues with Drools? Concurrent access to Guvnor website is basically causing the issue. </li>\n</ol>\n\n<p>Thanks,</p>\n"},{"tags":["asp.net","mysql","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13139566,"title":"Using Threads to get Data","body":"<p>In a project on <code>asp.net</code> and <code>mysql</code>, we need data from 4 different databases. For that we use the main thread, and get each datatable one by one in sequence and processes it. Now we need to optimize it, and we  assume that we can save time by using threads to get datatables.</p>\n\n<p>The main problem, I am assuming, how we let main thread to wait for all threads to complete? <br> Any Idea? <br> Thanks.</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":969,"score":1,"question_id":7193047,"title":"Multithread webservice acessing and modifying List object not threadsafe","body":"<p>I learnt the hard way when my multi-threaded app was modifying the same object and the List object couldn't handle the two thread adding a object to the list at the exact same time.</p>\n\n<p>I did some research and found i can use a lock to avoid this from happening, after a month of the application running smoothly it happend again even with the lock object in place. I don't understand how this still cab be happening.\nthe error messages are the same as before:\n1- Source array was not long enough. Check srcIndex and length, and the array's lower bounds.\n2- Index was outside the bounds of the array.</p>\n\n<p>in the class private members I have this member variable</p>\n\n<pre><code>private static readonly object _syncLock = new object();\n</code></pre>\n\n<p>in the public function</p>\n\n<pre><code>public Dictionary&lt;int, QueuedLetter&gt; GetXMLFragment(Dictionary&lt;int, QueuedLetter&gt; queuedLetters, GroupNode GroupNode, GroupNode ParentGroupNode, StoredProcedure storedProcedure)\n</code></pre>\n\n<p>This is where I use the _synclock object the lines of code are as followed</p>\n\n<pre><code>XmlFragment xf = new XmlFragment();\nxf.Fragment = xe;\nxf.LetterQueueOID = lq.LetterQueueOID;\nxf.ParentGroupNodeName = ParentGroupNodeName;\nxf.LinkingField = GroupNode.LinkingField;\nxf.GroupNodeName = GroupNode.GroupNodeName;\n\nlock (_syncLock)\n{\n   if (lq.Fragments == null)\n      lq.Fragments = new List&lt;XmlFragment&gt;();\n   lq.Fragments.Add(xf);\n}\n</code></pre>\n\n<p>I use a thread pool to create the multi-Threading functionality in another class it calls a starting function in the same class as where the lock happens above</p>\n\n<pre><code>events[i] = new AutoResetEvent(false);\nAttachFragments f = new AttachFragments(events[i], groupNodeOID, QueuedLetters, string.Format(\"Failed while fragment Data : {0}, was executing \", groupNodeName));\nf.OnException += ThreadErroredOut;\nThreadPool.QueueUserWorkItem(new WaitCallback(f.UpdateFragments));\n</code></pre>\n\n<p>If you can give me some advise on what I am doing wrong, that would be greatly appreciated.</p>\n\n<p>I have thought about using \nthe Thread-Safe Collections in .NET 4.0 <a href=\"http://msdn.microsoft.com/en-us/library/dd997305.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/dd997305.aspx</a>\nbut I haven't used it and if i change it to this, this would cause big changes in the code which would require a more in depth testing by are Q.A. team.</p>\n\n<p>The stack traces of the two exceptions:\n1- Source array was not long enough. Check srcIndex and length, and the array's lower bounds.:\n   at System.Array.Copy(Array sourceArray, Int32 sourceIndex, Array destinationArray, Int32 destinationIndex, Int32 length, Boolean reliable)     at System.Collections.Generic.List<code>1.Insert(Int32 index, T item)     at JE.ThunderHead.Business.AttachFragments.GetXMLFragment(Dictionary</code>2 queuedLetters, GroupNode GroupNode, GroupNode ParentGroupNode, StoredProcedure storedProcedure) in C:\\TFS\\LMS\\Release\\LM_05\\LM_05.01\\Solutions\\ThunderHead\\JE.Thunderhead.Business\\AttachFragments.cs:line 135     at JE.ThunderHead.Business.AttachFragments.UpdateFragments(Object stateinfo) in C:\\TFS\\LMS\\Release\\LM_05\\LM_05.01\\Solutions\\ThunderHead\\JE.Thunderhead.Business\\AttachFragments.cs:line 99</p>\n\n<p>2- Index was outside the bounds of the array:\n   at System.Collections.Generic.List<code>1.Add(T item)     at JE.ThunderHead.Business.AttachFragments.GetXMLFragment(Dictionary</code>2 queuedLetters, GroupNode GroupNode, GroupNode ParentGroupNode, StoredProcedure storedProcedure) in C:\\TFS\\LMS\\Release\\LM_05\\LM_05.01\\Solutions\\ThunderHead\\JE.Thunderhead.Business\\AttachFragments.cs:line 231</p>\n"},{"tags":["c++","multithreading","performance","c++11","atomic"],"answer_count":3,"favorite_count":3,"up_vote_count":7,"down_vote_count":1,"view_count":304,"score":6,"question_id":13135834,"title":"std::atomic<bool> is VERY slow","body":"<p>I've been using volatile bool for years for thread execution control and it worked fine</p>\n\n<pre><code>// in my class declaration\nvolatile bool stop_;\n\n-----------------\n\n// In the thread function\nwhile (!stop_)\n{\n     do_things();\n}\n</code></pre>\n\n<p>Now, since c++11 added support for atimic operations, I decied to try that instead</p>\n\n<pre><code>// in my class declaration\nstd::atomic&lt;bool&gt; stop_;\n\n-----------------\n\n// In the thread function\nwhile (!stop_)\n{\n     do_things();\n}\n</code></pre>\n\n<p>But it's several orders of magnitude slower than the <code>volatile bool</code>!</p>\n\n<p>Simple test case I've written takes about 1 second to complete with <code>volatile bool</code> approach. With <code>std::atomic&lt;bool&gt;</code> however I've been waiting for about 10 minutes and gave up!</p>\n\n<p>I tried to use <code>memory_order_relaxed</code> flag with <code>load</code> and <code>store</code> to the same effect. </p>\n\n<p>My platform:\nWindows 7 64 bit\nMinGW gcc 4.6.x</p>\n\n<p>What I'm doing wrong?</p>\n\n<p><strong>UPD</strong></p>\n\n<p>Yes, I know that volatile does not make a variable thread safe. My question is not about volatile, it's about why atomic is redicolously slow.</p>\n\n<p><strong>UPD2</strong>\n@all, thank you for your comments - I will try all the suggested when I get to my machine tonight.</p>\n"},{"tags":["objective-c","multithreading","image","uiscrollview"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3557,"score":3,"question_id":4278697,"title":"adding UIImageView in UIScrollview with large image blocks thread","body":"<p>I am loading an image in a UIImageView which I then add to a UIScrollView.\nThe image is a local image and is about 5000 pixels in height.</p>\n\n<p>The problem is that when I add the UIImageView to the UIScrollView the thread is blocked.\nIt is obvious because when I do this I can not scroll the UIScrollView till the image is displayed.</p>\n\n<p>Here's the example.</p>\n\n<pre><code>UIScrollView *myscrollview = [[UIScrollView alloc] initWithFrame:CGRectMake(0, 0, 768, 1004)];\nmyscrollview.contentSize = CGSizeMake(7680, 1004);\nmyscrollview.pagingEnabled = TRUE;\n\n[self.view addSubview:myscrollview];\n\nNSString* str = [[NSBundle mainBundle] pathForResource:@\"APPS.jpg\" ofType:nil inDirectory:@\"\"];\nNSData *imageData = [NSData dataWithContentsOfFile:str];\nUIImageView *singleImageView = [[UIImageView alloc] initWithImage:[UIImage imageWithData:imageData]];\n\n    //the line below is the blocking line\n[scrollView addSubview:singleImageView];\n</code></pre>\n\n<p>It is the last line in the script that blocks the scroller. When I leave it out everything works perfect, except for the fact the image is not showing of course.</p>\n\n<p>I seem to recall that using multithreading does not work on UIView operations so I guess that's out of the question ass well.</p>\n\n<p>Thanks for your kind help.</p>\n"},{"tags":["multithreading","process","procfs"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13133732,"title":"finding out thread information","body":"<p>I have a list of processes running in my system and the threads belonging to these processes. I want to know if there is anyway to get the complete information about a specific thread, for example: priority, function it executes, etc.</p>\n"},{"tags":["c++","multithreading","c++11","pthreads"],"answer_count":3,"favorite_count":3,"up_vote_count":8,"down_vote_count":1,"view_count":357,"score":7,"question_id":13134186,"title":"C++11 std::threads vs posix threads","body":"<p>Why should I prefer one or another in practice?\nWhat are technical differences except that std::thread is a class?</p>\n"},{"tags":["android","multithreading","threadpool"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13080367,"title":"Android - Async Task behavior in 2.3.3 and 4.0 OS","body":"<p>I am testing an application where we have a list view with list of images retrieved over network. When i run the application on android device 2.3.3 (WIFI speed 512 KBPS) and check the DDMS (Thread Viewer), the number of threads keeps increasing till 50 from 25. But when i test the same application on device 4.0 (WIFI speed 5 MBPS), number of threads did not increase. </p>\n\n<p>Can anyone help me understand why this is happening ? Is it due to android OS difference or any other reason ?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["multithreading","delphi","connection","datasnap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13135166,"title":"How to manage a datasnap connection for multiple threads","body":"<p>I have come to the conclusion that only 1 client thread can access the server through a connection. But how to manage this?</p>\n\n<p>Do I need to lock the connection every time I use the TSQLConnection. With a Server Method for instance?</p>\n\n<p>How to automate my Server Methods to Lock and Unlock the Connection to my server?</p>\n\n<p>Should i convert all my server method calls From</p>\n\n<pre><code>ServerMethod();\n</code></pre>\n\n<p>to</p>\n\n<pre><code>Try\n  Datamodule.lock;\n  ServerMethod\nFinally\n  Datamodule.unlock;\nend;\n</code></pre>\n\n<p>Or Should I give my Threads New Connections?</p>\n\n<p>I use other threads for printing, this needs information from the server.\nPrinting should be done in the background but stil uses the SQL connection from the main Application.</p>\n\n<p><strong>Edit</strong>: The problem with creating a new connection is that the server creates a new ClientSession. So i need to Create and close this Session. Is there a way to create a new connection to the same session?</p>\n"},{"tags":["java","multithreading","thread-safety"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":2,"view_count":249,"score":0,"question_id":9884645,"title":"How and why This code is Thread Safe..?","body":"<p>This is the my code..</p>\n\n<pre><code>@immutable // This is not a standard annotation .Only for Showing that behavior of Class \nclass OneValueCached{\n    private final BigInteger lastNumber;\n    private final BigInteger[] lastFactors;\n    public OneValueCached(BigInteger i,BigInteger[] factors){\n        lastNumber=i;\n        lastFactors=Arrays.copyOf(factors, factors.length);\n    }\n\n    public BigInteger[] getFactors(BigInteger i){\n        if(lastNumber==null || !lastNumber.equals(i))\n            return null;\n        else \n            return Arrays.copyOf(lastFactors, lastFactors.length);\n    }\n}\n\n@threadSafe // This is not a standard annotation .Only for Showing that behavior of Class \npublic class VolatileCachedFactorizer implements Servlet{\n    private volatile OneValueCached cache=new OneValueCached(null, null);\n\n    public void service(ServletRequest req, ServletResponce resp){\n        BigInteger i= extractFromRequest(req);\n        BigInteger[] factors=cache.getFactors(i);\n        if(factors==null){   // ---&gt; line 1\n            factors=factor(i);  // --&gt; line 2\n            cache=new OneValueCached(i, factors);\n        }\n\n        encodeIntoResponse(resp,factors);\n    }\n}\n</code></pre>\n\n<p>Why class <strong>VolatileCachedFactorizer</strong> is thread according to <strong>Book</strong> But My point is..<br>\n<strong>1.  @ Line 1</strong>  if 2 thread coming at same time at that point 1st <code>thread</code> check condition and found <strong>factor=null</strong> and 2nd <code>thread</code> also check same condition at the same time after 1st <code>thread</code>  suspend at line <strong>2nd</strong> and found  <strong>factor=null</strong><br>\nAnd both will be create new <code>OneValueCached</code> Object Then how this code is thread safe..  According to book this is thread safe..   </p>\n\n<p>Thank's</p>\n"},{"tags":["multithreading","biztalk","orchestration"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13133754,"title":"Threading in BizTalk Orchestration","body":"<p>I want to get some records from the Database and then on the basis of the User ID and Password as credentials I need to call another web-service. \nI want to do this using threading with in Orchestration? Can I do threading with in orchestration. Means can I start some threads in Orchestration it self to make this thing work faster.</p>\n\n<p>Thanks,\nDinesh Arora.</p>\n"},{"tags":["python","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13136800,"title":"Haven't started thread but Python throws exception 'Thread already start'","body":"<p>I am writing a producer-consumer application. The producer threads start fine but when I try to start the consumer threads, I get an exception. Here's the relevant code:</p>\n\n<pre><code>#Producer threads\n    for i in range(nThreads):\n        self.producerThreads.append(MailThread(i, settings.MAX_EMAILS_PERPASS, self.toFetchQueue, self.rawEmailsQueue, self.stopEvent))\n        self.producerThreads[i].start()\n        logging.info('Started producer thread %d', i)\n\n    #Consumer threads\n    #for i in range(settings.MAX_CONS_THREADS):\n    try:\n        self.consumerThreads.append(ProcessThread(i, settings.STORE_DIRECTORY, settings.DELETE_ONPIPE, self.rawEmailsQueue, self.stopEvent))\n        self.consumerThreads[i].start()\n        logging.info('Started consumer thread %d', i)\n    except Exception, e:\n        logging.error('Failed to start consumer thread %s', str(e))\n</code></pre>\n\n<p>Here's the consumer class:</p>\n\n<pre><code>import logging, commands, threading, uuid, os, settings, Queue\n\nclass ProcessThread(threading.Thread):\n\"\"\"\nClass to process the emails. \n\"\"\"\ndef __init__(self, threadCount, storeDirectory, deleteOnPipe, rawEmailsQueue, stopEvent):\n    self.threadCount = threadCount\n    self.rawEmailsQueue = rawEmailsQueue\n    self.stopEvent = stopEvent\n    self.storeDirectory = storeDirectory\n    self.deleteOnPipe = deleteOnPipe\n    threading.Thread.__init__(self)\n\ndef run(self):\n    logging.info('Run process for consumer thread %d', self.threadCount)\n\n    while not self.stopEvent.is_set():\n        try:\n            emailContainer = rawEmailsQueue.get(False)\n            logging.debug('Got a new email')\n\n        except Queue.Empty:\n            logging.debug('No emails in queue, going to sleep for a while')\n            sleep(0.1)\n            continue\n</code></pre>\n\n<p>#Rest of processing code</p>\n\n<p>I couldn't get correct indentation, it's fine in my code</p>\n"},{"tags":["java","multithreading","debugging"],"answer_count":7,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":2900,"score":6,"question_id":2081766,"title":"How to Debug a deadlock in Java using Eclipse","body":"<p>Hello<br>\nWhat techniques can one use to debug what appears to be a deadlock in a Java program.\nMy IDE is Eclipse and I think I've identifid the two deadlocked threads. In the debugger, right-clicking any of the threads in question and selecting suspend suspends the thread and displays the code currently being executed. Attempting step-into or step-over the line question appears to have no effect - the thread state changes to \"Stepping\" with control never returning to the debugger unless suspend is clicked again.<br>\nThanks</p>\n"},{"tags":["iphone","multithreading","performselector"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13050637,"title":"iPhone NSDestinationInvalidException after hitting home button while NSURLConnection active","body":"<p>I'm having trouble understanding an Exception, which is thrown a couple of seconds after the home button is pressed.</p>\n\n<p><code>*** Terminating app due to uncaught exception 'NSDestinationInvalidException', reason: '*** -[GMMLoader performSelector:onThread:withObject:waitUntilDone:modes:]: target thread exited while waiting for the perform'</code></p>\n\n<p>I'm programing an application, which uses a webservice to load different datasets. The webservice is added to an operationQueue.</p>\n\n<pre><code>WebService* op = \n    [[WebService alloc] initWithSearchString:self.searchBar.text\n      notificationCenter:self.progressNotification];\n    [self.queue addOperation:op];\n\n[op addObserver:self \n         forKeyPath:@\"isFinished\" \n            options:NSKeyValueObservingOptionNew \n            context:NULL];\n\n[op release];\n</code></pre>\n\n<p>In the <code>-(void) start</code> message of the web service, I call this start selector to be performed in the main thread, to be able to interact with the UI.</p>\n\n<pre><code>- (void)start\n{\n    if (![NSThread isMainThread]){\n\n        [self performSelectorOnMainThread:@selector(start) withObject:nil waitUntilDone:YES];\n        return;\n    }\n    ...\n}\n</code></pre>\n\n<p>All of this works fine, but when I press the home button while the web service is active, I get the mentioned exception.</p>\n\n<p>My guess is, the main thread is halted after the home button was pressed (Is that so?). So the action which is currently running is no longer updated / valid.</p>\n\n<p>I tried to listen to the event <code>UIApplicationWillResignActiveNotification</code> to react on the home button press by canceling or suspend the operations in queue. However this did not help. Am I right with my guess, that this error occurs because of the halted main thread?\nHow else could I manage to stop / cancel the current webservice thread?</p>\n\n<p>Thank you in advance\nZerd</p>\n"},{"tags":["java","debugging","swing","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":270,"score":3,"question_id":3153574,"title":"How to detect Swing thread policy violations","body":"<p>I am looking for an automatic way to detect violations of the Swing's single threaded policy in my code.  I'm looking for something along the lines of some AOP code you drop into the VM while the swing app is running and have it log any places where a swing component is modified outside of the EDT.</p>\n\n<p>I'm not an AOP guy but I would imagine creating an AOP proxy around every java.swing.* class which looks like </p>\n\n<pre><code>AOP_before(Method m, Object args[]) {\n if (!isEventDispatchThread(Thread.currentThread()) {\n  logStack(new RuntimeException(\"violation!\"));\n }\n\n invoke(m, args);\n}\n</code></pre>\n\n<p>Anyone know of a project or utility that does this?</p>\n"},{"tags":["c++","multithreading","nonatomic"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":83,"score":3,"question_id":13135479,"title":"Dangers of simultaneous write and read of a boolean in a simple situation","body":"<p>I've read some similar questions but the situations described there are bit more complicated.   </p>\n\n<p>I have a <code>bool b</code> initialized as <code>false</code> in the heap and two threads. I do understand that operations with <code>bools</code> are <code>not atomic</code>, but please read the question till the end.</p>\n\n<p>First thread can set <code>b = true</code> only once and doesn't do anything else with it.\nSecond thread checks <code>b</code> in a loop and if it's <code>true</code> does some actions.</p>\n\n<p>Do I need to use some synchronization mechanism(like mutexes) to protect <code>b</code>? \nWhat can happen if I don't? With <code>ints</code> I can obviously get arbitrary values when I read and write in the same time. But with <code>bools</code> there are just <code>true</code> and <code>false</code> and I don't mind to once get <code>false</code> instead of <code>true</code>. Is it a potential <code>SIGSEGV</code>?</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13136123,"title":"Two way flow in a producer / consumer scenario","body":"<p>I am trying to find a solution for a queuing problem I have. In the typical scenario, the producer puts something on the queue and the consumer takes it off. How about if we have a producer that also consumes and  a consumer that initially takes something off the queue and then puts something (like a result) back on the queue. As such, there is a two way flow if you follow. Is it possible to synchronize two threads to do this effectively? Naively, I had put a loop in the run method of one of my threads only to discover that the other thread will only run once and then dies.. Apologies if this appears vague..Hopefully someone can point me in the right direction</p>\n\n<p>Cheers</p>\n"},{"tags":["multithreading","posix","file-descriptor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":559,"score":0,"question_id":5057737,"title":"simultaneous read on file descriptor from two threads","body":"<ol>\n<li><p><strong>my question</strong>: in Linux (and in FreeBsd, and generally in UNIX) is it possible/legal to read single file descriptor simultaneously from two threads?</p></li>\n<li><p>I did some search but found nothing, although a lot of people ask like question about reading/writing from/to socket fd at the same time (meaning reading when other thread is writing, not reading when other is reading). I also have read some man pages and got no clear answer on my question.</p></li>\n<li><p>Why I ask it. I tried to implement simple program that counts lines in stdin, like wc -l. I actually was testing my home-made C++ io engine for overhead, and discovered that wc is 1.7 times faster. I trimmed down some C++ and came closer to wc speed but didn't reach it. Then I experimented with input buffer size, optimized it, but still wc is clearly a bit faster. Finally I created 2 threads which read same STDIN_FILENO in parallel, and this at last was faster than wc! But lines count became incorrect... so I suppose some junk comes from reads which is unexpected. Doesn't kernel care what process read?</p></li>\n</ol>\n\n<p>Edit: I did some research and discovered just that calling read directly via syscall does not change anything. Kernel code seem to do some sync handling, but i didnt understand much (read_write.c)</p>\n"},{"tags":["java","multithreading","sockets","nio"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2903,"score":3,"question_id":4877292,"title":"java.nio vs new thread for each socket","body":"<p>I am developping a 1 to many server-client application, which is a small project.</p>\n\n<p>Since socket IO is blocking. I am looking for a solution for this.</p>\n\n<p>Could anyone tell me what is the good/bad for each of the 2 solutions?</p>\n\n<ol>\n<li>use java.nio</li>\n<li>new a single thread for every client that connected.</li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["c#","multithreading",".net-4.0"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":806,"score":2,"question_id":9581712,"title":"How to restart a Thread in C# .Net 4.0?","body":"<p>I'm using C# .Net4.0 in VS 2010.\nHow do I restart a <code>Thread</code>?</p>\n\n<p>Its like I want to <code>Abort()</code> the thread and <code>Start()</code> it from the beginning again?\nIs it possible?</p>\n"},{"tags":["multithreading","scala"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13134066,"title":"Is there any Executor connecting to Broker?","body":"<p>I need to execute the same task many times as much as possible within given milliseconds. So I made it using scala.actors.threadpool.Executors as following code.</p>\n\n<pre><code>import actors.threadpool.{TimeUnit, Future, Executors}\nimport collection.mutable.ListBuffer\n\nobject TaskRepeater {\n\n  def repeat(task: Runnable, millisecs: Long): Int = {\n    val exector = Executors.newCachedThreadPool\n    val remover = Executors.newCachedThreadPool\n\n    val queue = ListBuffer[Future]()\n    def removeDone() {\n      (queue filter (_.isDone)) foreach { f =&gt;\n        queue.remove(queue indexOf f)\n      }\n    }\n\n    val lock = new EasyLock()\n\n    val maxQueueSize = scala.collection.parallel.availableProcessors\n\n    val queueAvaiable = lock.mkCondition(queue.size &lt; maxQueueSize)\n\n    var cnt = 0\n\n    val start = System.nanoTime()\n\n    while(System.nanoTime() - start &lt; millisecs * 1000000) {\n      lock {\n        queueAvaiable.waitUntilFulfiled()\n\n        cnt += 1\n        val r = exector.submit(task)\n        queue += r\n\n        remover.submit(runneble {\n          r.get()\n          lock {\n            removeDone()\n            queueAvaiable.signalIfFulfilled()\n          }\n        })\n      }\n    }\n\n    exector.shutdown()\n    remover.shutdown()\n\n    assert(exector.awaitTermination(1, TimeUnit.SECONDS))\n\n    cnt\n  }\n\n  def runneble(f: =&gt; Unit) = new Runnable {\n    def run() {\n      f\n    }\n  }\n}\n\nimport actors.threadpool.locks.{Condition, ReentrantLock}\n\nclass EasyLock {\n  val lock = new ReentrantLock\n\n  def mkCondition(f: =&gt; Boolean): EasyCondition = {\n    new EasyCondition(lock.newCondition(), f)\n  }\n\n  def apply(f: =&gt; Unit) {\n    lock.lock()\n    try {\n      f\n    } finally {\n      lock.unlock()\n    }\n  }\n}\n\nclass EasyCondition(c: Condition, condition: =&gt; Boolean) {\n\n  def waitUntilFulfiled(f: =&gt; Unit) {\n    while (!condition) {\n      c.await()\n    }\n    f\n  }\n\n  def signalAllIfFulfilled() {\n    if (condition) c.signalAll()\n  }\n\n  def signalIfFulfilled() {\n    if (condition) c.signal()\n  }\n}\n</code></pre>\n\n<p>But this is a bit complex. Instead, I think, Broker of Twitter and some Executor which connects with the Broker and sends a finished task to the Broker, if exists, could make it easier. </p>\n\n<p>The following is a pseudo code</p>\n\n<pre><code>val b = new Broker\nval e = new Executor // connects with the broker anyway\ne.runTask\nval o = b.recv\no.sync() // wait until the task finishes\n</code></pre>\n\n<p>Is there any Executor like this?</p>\n"},{"tags":["python","multithreading","networking","asynchronous","twisted"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13131542,"title":"Getting object instances from a Twisted factory (Python)","body":"<p>I am using the autobhan websockets library with the following code:</p>\n\n<pre><code>    from twisted.internet import reactor\n    from autobahn.websocket import WebSocketServerFactory, \\\n                                   WebSocketServerProtocol, \\\n                                   listenWS\n\n\n    class EchoServerProtocol(WebSocketServerProtocol):\n\n       def onMessage(self, msg, binary):\n          self.sendMessage(msg, binary)\n\n       def sendRandomMessage(message):\n          self.sendMessage(message,true)\n\n\n    if __name__ == '__main__':\n\n       factory = WebSocketServerFactory(\"ws://192.168.1.135:9999\", debug = False)\n       factory.protocol = EchoServerProtocol\n       listenWS(factory)\n       reactor.run()\n\n       #insert random code here.  Things happen independent of the connection state.\n       #somehow access EchoServerProtocolINSTANCE.sendMessage(\"MESSAGE_HERE\")\n</code></pre>\n\n<p>The code works well for receiving messages, but how can I access the instance of EchoServerProtocol in order to send arbitrary messages at any time?</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":5,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":826,"score":5,"question_id":8579657,"title":"Java: What's the difference between Thread start() and Runnable run()","body":"<p>Say we have these two Runnables:</p>\n\n<pre><code>class R1 implements Runnable {\n    public void run() {...}\n    ...\n}\n\nclass R2 implements Runnable {\n    public void run() {...}\n    ...\n}\n</code></pre>\n\n<p>Then what's the difference between this:</p>\n\n<pre><code>public class Foo {\n    public static void main() {\n        R1 r1 = new R1();\n        R2 r2 = new R2();\n\n        r1.run();\n        r2.run();\n    }\n}\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code>public class Foo {\n    public static void main() {\n        R1 r1 = new R1();\n        R2 r2 = new R2();\n\n        Thread t1 = new Thread(r1);\n        Thread t2 = new Thread(r2);\n\n        t1.start();\n        t2.start();\n    }\n}\n</code></pre>\n\n<p>[Now I have to write some more text because it says that \"my post does not have much context to explain the code sections\"].</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":6,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":765,"score":8,"question_id":2674174,"title":"What is the difference between Thread.start() and Thread.run()?","body":"<p>Why do we call the <code>start()</code> method, which in turn calls the <code>run()</code> method?<br>\nCan't we directly make a call to <code>run()</code>?   </p>\n\n<p>Please give an example where there is a difference.</p>\n"},{"tags":["multithreading","uiimageview","uiimage","nsoperation","afnetworking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":22,"score":-1,"question_id":13078481,"title":"Several redeclaration errors occur when AFDownloadRequestOperation is added","body":"<p>When I add <code>AFDownloadRequestOperation</code> I get several errors that result in the inability for me to successfully build my project... </p>\n\n<p>These errors all seem to be of a redeclaration nature. My first mind is to go into the files that display the error and individually delete the other declarations. </p>\n\n<p>But I figured that it may cause more errors and/or not be the best method to resolve my issue. Is anyone familiar with this issue? </p>\n\n<p>I have attached a screenshot of what I see.</p>\n"},{"tags":["linux","multithreading","linux-kernel","operating-system","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13133369,"title":"Linux Pthreads User level or kernel level","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4004662/how-are-pthreads-on-linux-seen-by-scheduler\">how are pthreads on linux seen by scheduler</a>  </p>\n</blockquote>\n\n\n\n<p>Are Linux pthreads user level threads or Kernel level threads ?</p>\n"},{"tags":["c","multithreading","pthreads","mutex"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13132621,"title":"C Reader Writer Threads Lock Unlock","body":"<p>Im trying to complete what I thought would be simple task but after several days have reached a breaking point.</p>\n\n<p>I am trying to simulate a database using multiple readers and a single writer.  When I run my program it deadlocks.</p>\n\n<p>I was trying to base it on this algorithm:</p>\n\n<pre><code> 1 semaphore accessMutex;     // Initialized to 1\n 2 semaphore readersMutex;    // Initialized to 1\n 3 semaphore orderMutex;      // Initialized to 1\n 4 \n 5 unsigned int readers = 0;  // Number of readers accessing the resource\n 6 \n 7 void reader()\n 8 {\n 9   P(orderMutex);           // Remember our order of arrival\n10 \n11   P(readersMutex);         // We will manipulate the readers counter\n12   if (readers == 0)        // If there are currently no readers (we came first)...\n13     P(accessMutex);        // ...requests exclusive access to the resource for readers\n14   readers++;               // Note that there is now one more reader\n15   V(orderMutex);           // Release order of arrival semaphore (we have been served)\n16   V(readersMutex);         // We are done accessing the number of readers for now\n17 \n18   ReadResource();          // Here the reader can read the resource at will\n19 \n20   P(readersMutex);         // We will manipulate the readers counter\n21   readers--;               // We are leaving, there is one less reader\n22   if (readers == 0)        // If there are no more readers currently reading...\n23     V(accessMutex);        // ...release exclusive access to the resource\n24   V(readersMutex);         // We are done accessing the number of readers for now\n25 }\n26 \n27 void writer()\n28 {\n29   P(orderMutex);           // Remember our order of arrival\n30   P(accessMutex);          // Request exclusive access to the resource\n31   V(orderMutex);           // Release order of arrival semaphore (we have been served)\n32 \n33   WriteResource();         // Here the writer can modify the resource at will\n34 \n35   V(accessMutex);          // Release exclusive access to the resource\n36 }\n</code></pre>\n\n<p>However I am trying to implement it using only pthreads rather than semaphores.  As you can expect here is what the mess turned out to be:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#define MAX 5 //size of buffer\n\npthread_mutex_t mutex; //pthread_mutex type\npthread_cond_t condw, condr; //reader/writer cond var\nint buffer = 0, rc = 0;\n\npthread_mutex_t db; //pthread_mutex type\n\n//reader-writer header:\nvoid* writer(void* ptr);\nvoid* reader(void* ptr);\n\nvoid use_data();\nvoid write_database();\nvoid readdb();\n\nint main(int argc, char** argv)\n{\n  pthread_t read,write;\n  //allow signal back and forth\n  pthread_mutex_init(&amp;mutex,0); //init mutex\n  pthread_cond_init(&amp;condw, 0); //init writer\n  pthread_cond_init(&amp;condr,0); //init reader\n\n    pthread_mutex_init(&amp;db,0); //init db\n\n  //this calls the void* reader function\n  pthread_create(&amp;write,0,writer,0); //create thread\n  pthread_create(&amp;read,0,reader,0); //create thread\n\n  //let them join\n  pthread_join(read,0);\n  pthread_join(write,0);\n\n  //destroy them\n  pthread_cond_destroy(&amp;condw);\n  pthread_cond_destroy(&amp;condr);\n  pthread_mutex_destroy(&amp;db);\n  pthread_mutex_destroy(&amp;mutex);\n\n  return 0;\n}//end main\n\nvoid* reader(void* arg)\n{\n  while(1) //if there is a reader lock the db \n  {\n    pthread_mutex_lock(&amp;mutex);\n    rc++;\n    if(rc==1)\n    {\n      pthread_mutex_lock(&amp; db);\n    }\n    pthread_mutex_unlock(&amp;mutex);\n    readdb();\n    pthread_mutex_lock(&amp;mutex);\n    rc--;\n    if(rc==0) \n    {\n      pthread_mutex_unlock(&amp;db);\n    }\n    pthread_mutex_unlock(&amp;mutex);\n    use_data();\n  }\n}\n\nvoid* writer(void* arg)\n{\n  while(1) //unlock the db\n  {\n    pthread_mutex_lock(&amp;db);\n    write_database();\n    pthread_mutex_unlock(&amp;db);\n  }\n}\n\nvoid use_data(){}\nvoid write_database(){}\nvoid readdb(){}\n</code></pre>\n\n<p>Any help with a working solution and explanation where we went wrong is appreciated as it would help me and my colleagues out.  Regards.</p>\n"},{"tags":["java","multithreading","compression","gzip"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13132136,"title":"Java-Multithreaded Compression with Deflater","body":"<p>So this is an assignment that I've sort of hit a wall on. At this point, I'm mostly hoping to have more eyes since I honestly can't see anything wrong with my code anymore after redoing and refining it so many times.</p>\n\n<p>We needed to write a multithreaded compressor in Java that can be decompressed correctly with the gzip -d call. We cannot use the GZIPOutputStream call. Instead, we have generate a header and trailer manually and use a Deflater to compress the data. We read from standard input and write to standard output.</p>\n\n<p>Basically, I used and Executor to maintain a thread pool. I read the input as it comes in and write it into a buffer of a set size. Once the buffer is full, I pass that block of data to a thread (put a task in the queue). Each thread has it's own Deflater and is passed the input and any other information it needs to compress that data. I also use the last 32Kb of each block as a dictionary for the next block.</p>\n\n<p>I've confirmed that my header and trailer are correct. I used GZIPOutputStream to compress a file and used hexdump to get the bytes so I can compare it with my output. I've checked of files of different sizes and the header and trailer are identical, so in all likelyhood the issue is in the compressed data. The error that I get is: invalid compressed data--crc error </p>\n\n<p>I have confirmed that when I pass in an input that is relatively small (so that there is only one thread since I never fill up the buffer, there is only one task in the queue) the output is correct. I can call gzip -d on the compressed data and get back the exact same input.</p>\n\n<p>In other words, the problem is in when there is enough data that more than one thread is up and running. I used a hexdump on my output for the large file and compared it with GZIPOutputStream's hexdump an they're quite similar (not exactly the same, but even the case with the small file the hexdump was also slightly different for the compressed data. And in that case, gzip -d still worked). That's also how I know the header and trailer are correct.</p>\n\n<p>Incoming code dump</p>\n\n<pre><code>import java.lang.Runtime;\nimport java.lang.String;\nimport java.lang.Integer;\nimport java.util.Arrays;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\nimport java.nio.ByteBuffer;\nimport java.io.*;\nimport java.util.zip.*;\n\n/*Warning: Do not compress files larger than 2GB please. Since this is just\n  an assignment and not meant to replace an actual parallel compressor, I cut corners\n  by casting longs to ints, since it's easier to convert to 4 bytes*/\n\npublic class Main {\n    private static final int BLOCK_SIZE = 128*1024;\n    private static final int DICT_SIZE = 32*1024;\n    private static byte[] header = {(byte)0x1f, (byte)0x8b, (byte)0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};\n\n    public static void main(String[] args){\n\n    class workerThread implements Callable&lt;byte[]&gt; {\n        private boolean lastBlock;\n        private boolean dictAvailable;\n        private byte[] input;\n        private byte[] dictionary;\n        private int lastSize;       \n\n        private byte[] output = new byte[BLOCK_SIZE];\n        private int compressedLength;\n        private ByteArrayOutputStream bOut = new ByteArrayOutputStream();\n        Deflater compress = new Deflater (Deflater.DEFAULT_COMPRESSION, true);\n\n        workerThread(boolean last, byte[] blockIn, byte[] dict, boolean useDictionary, int lastBSize){\n            this.lastBlock = last;\n            this.input = blockIn;\n            this.dictionary = dict;\n            this.dictAvailable = useDictionary;\n            this.lastSize = lastBSize;\n        }\n\n        public byte[] call() {\n            //System.out.println(\"running thread \");\n            if (lastBlock) {\n                // System.out.println(\"Last block!\");\n                compress.setInput(input,0,lastSize);\n                if(dictAvailable) {\n                    compress.setDictionary(dictionary);\n                }\n                compress.finish();\n                compressedLength = compress.deflate(output,0,BLOCK_SIZE,Deflater.SYNC_FLUSH);\n            }\n            else {\n                //System.out.println(\"Not last block!\");\n                compress.setInput(input,0,BLOCK_SIZE);\n                if(dictAvailable) {\n                    compress.setDictionary(dictionary);\n                }\n                compressedLength = compress.deflate(output,0,BLOCK_SIZE,Deflater.SYNC_FLUSH);\n            }\n            byte[] finalOut = Arrays.copyOfRange(output,0,compressedLength);\n            return finalOut;\n        }\n    }\n\n    getProcessors p = new getProcessors();\n    boolean useDict = true;\n    int numProcs = p.getNumProcs();\n    boolean customProcs = false;\n    boolean foundProcs = false;\n    boolean foundDict = false;\n\n    /*Checking if arguments are correct*/\n    ........\n    /*Correct arguments, proceeding*/\n\n    BufferedInputStream inBytes = new BufferedInputStream(System.in);\n    byte[] buff = new byte[BLOCK_SIZE];\n    byte[] dict = new byte[DICT_SIZE];\n    int bytesRead = 0;\n    int offset = 0;\n    int uncompressedLength = 0;\n    int lastBlockSize = 0;\n    boolean isLastBlock = false;\n    boolean firstBlockDone = false;\n\n    /*Using an executor with a fixed thread pool size in order to manage threads\n    as well as obtain future results to maintain synchronization*/\n    ExecutorService exec = Executors.newFixedThreadPool(numProcs);\n    CRC32 checksum = new CRC32();\n    checksum.reset();\n    List&lt;Future&lt;byte[]&gt;&gt; results = new ArrayList&lt;Future&lt;byte[]&gt;&gt;();\n\n    //byte[] temp;\n\n    System.out.write(header,0,header.length);\n    try{\n        bytesRead = inBytes.read(buff,0, BLOCK_SIZE);\n        while (bytesRead != -1)  {\n            uncompressedLength += bytesRead;\n            checksum.update(buff,offset,bytesRead);\n            offset += bytesRead;\n\n            if (offset == BLOCK_SIZE) {\n                offset = 0;\n                if(!firstBlockDone){ \n                firstBlockDone = true;\n                results.add(exec.submit(new workerThread(isLastBlock,buff,dict,false,lastBlockSize)));\n                }\n                 else {\n                     results.add(exec.submit(new workerThread(isLastBlock,buff,dict,useDict,lastBlockSize)));\n                 }\n\n                 if (useDict) {\n                     System.arraycopy(buff, BLOCK_SIZE-DICT_SIZE, dict, 0, DICT_SIZE);\n                 }\n            }\n\n             /*Implementation warning! Because of the way bytes are read in, this program will fail if\n             the file being zipped is exactly a multiple of 128*1024*/\n             if((bytesRead=inBytes.read(buff,offset,BLOCK_SIZE-offset)) == -1) {\n                 isLastBlock = true;\n                 lastBlockSize = offset;\n                 results.add(exec.submit(new workerThread(isLastBlock,buff,dict,useDict,lastBlockSize)));\n             }\n        }    \n        try {\n            for(Future&lt;byte[]&gt; result: results) {\n            //System.out.println(\"Got result!\");\n            System.out.write(result.get(),0,result.get().length);\n            //temp = result.get();\n            }\n        }\n        catch (InterruptedException ex) {\n            ex.printStackTrace();\n            System.err.println(\"Interrupted thread!\");\n        } \n        catch (ExecutionException ex) {\n            ex.printStackTrace();\n            System.err.println(\"Interrupted thread!\");\n        }\n        finally{ \n            exec.shutdownNow();\n        }\n\n    /*Converting CRC sum and total length to bytes for trailer*/\n    byte[] trailer = new byte[8];\n    getTrailer trail = new getTrailer(checksum.getValue(),uncompressedLength);\n    trail.writeTrailer(trailer,0);\n    System.out.write(trailer);\n\n    }\n    catch (IOException ioe) {\n        ioe.printStackTrace();\n        System.out.println(\"IO error.\");\n        System.exit(-1);    \n    }\n    catch (Throwable e) {\n        System.out.println(\"Unexpected exception or error.\");\n        System.exit(-1);\n    }\n    }\n}\n</code></pre>\n\n<p>Ah whoops, the formatting got thrown off a bit by the code block format. </p>\n\n<p>As you can see, I keep reading from input until buff is full. The reason being since this is not a file, there's a chance that the first call to read does not read enough bytes to fill the array (leaving me with a bunch of nulls that I don't want messing up anything). Once it is full, I give it to the Executor so the thread will execute the task. I implemented Callable instead of Runnable so that I could return the ouput as a byte array AND because I need the future interface. The exec.get() method allows me to the keep the threads synchornized. I've tested that with an arbitrary case (printing out numbers 1 - 100 to make sure, and they do indeed print in order).</p>\n\n<p>There is a flaw where this program won't work with files that are a multiple of BLOCK_SIZE, but that's not even the issue I'm on right now. This program works when the input is small enough that I only run one thread.</p>\n\n<p>For each block except for the last one, I call deflate with the SYNC_FLUSH option. This is so I can end on a byte boundary. The last block I compress normally and call finish on.</p>\n\n<p>Sorry for the really long post. I just honestly need more opinions besides my own because I can't seem to find the mistake. In case anyone is wonderful enough to want to compile and run it to see for themselves, here are the other classes I had (just to get the number of processes and generate the trailer. Both of these work fine).</p>\n\n<pre><code>import java.io.*;\n\npublic class getTrailer {\n    private long crc;\n    private int total;\n    public getTrailer (long crcVal, int totalIn) {\n        this.crc = crcVal;\n        this.total = totalIn;\n    } \n    public void writeTrailer(byte[] buf, int offset) throws IOException {\n        writeInt((int)crc, buf, offset); // CRC-32 of uncompr. data\n        writeInt(total, buf, offset + 4); // Number of uncompr. bytes\n    }\n\n    /* Writes integer in Intel byte order to a byte array, starting at a\n    * given offset\n    */\n\n    public void writeInt(int i, byte[] buf, int offset) throws IOException {\n        writeShort(i &amp; 0xffff, buf, offset);\n        writeShort((i &gt;&gt; 16) &amp; 0xffff, buf, offset + 2);\n    }\n\n   /*\n    * Writes short integer in Intel byte order to a byte array, starting\n    * at a given offset\n    */\n\n    public void writeShort(int s, byte[] buf, int offset) throws IOException {\n        buf[offset] = (byte)(s &amp; 0xff);\n        buf[offset + 1] = (byte)((s &gt;&gt; 8) &amp; 0xff);\n    }\n}\n</code></pre>\n\n<p>The trailer function is literally copy pasted from JAva's docs</p>\n\n<pre><code>public class getProcessors {\n    private Runtime runner = Runtime.getRuntime();\n    private int nProcs = runner.availableProcessors();\n\n    int getNumProcs() {\n        return nProcs;\n    }\n}\n</code></pre>\n\n<p>I realize how long this is, but I really need someone else's opinion. If anyone sees anything they think might be causing issues, please tell me. I don't need someone to write the program for me (I think I'm almost there) but I just...can't see anything wrong.</p>\n"},{"tags":["c","regex","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13132311,"title":"regexec.c: No such file or directory. in regexec.c","body":"<p>I write a mutithread crawler using c,and i use the regex.h regular expression library to extract links in the page ,but when I use gdb to debug,it doesn't work,output is :</p>\n\n<pre>\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7ffff55db700 (LWP 5318)]\n0x00007ffff78e8873 in re_search_internal (preg=0x603220, \n    string=0x7ffff7f84043 \"\\\">\\307ǲ\\274˹1983\\304\\352¼\\322\\364\\306ع⣺20\\304\\352ǰ\\276\\315\\271\\271˼iPad\\263\\373\\320\\316<em>(923\\310˲\\316\\323\\353)</em>\\n</li>\\n\\n|xGv00|d13bb5f82196eb4c8485c64020fbb40e\", ' ' , \"\\r\\n\", ' ' ..., length=35136, start=0, range=35136, \n    stop=35136, nmatch=2, pmatch=0x603210, eflags=0) at regexec.c:661\n661 regexec.c: No such file or directory.\n    in regexec.c\n</pre>\n"},{"tags":["android","multithreading","android-canvas"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13131952,"title":"Is there an easy way to set up Android to only update screen when it needs to?","body":"<p>I am making a board game. The board doesn't ever move, but pieces on top of it sometimes do depending on user interaction. There are also UI elements which may update periodically.</p>\n\n<p>Right now the way I set it up is by overwriting the <code>onDraw()</code> method of a <code>SurfaceView</code> subclass. I have a drawing thread that constantly calls <code>postInvalidate()</code> in a while loop:</p>\n\n<pre><code>class PanelThread extends Thread\n{\n        //...\n    long sleepTime = 0;\n    long nextGameTick = System.currentTimeMillis();\n\n    @Override\n    public void run()\n    {\n        Canvas c;\n        while (_run)\n        { // When setRunning(false) occurs, _run is\n            c = null; // set to false and loop ends, stopping thread\n            try\n            {\n                c = _surfaceHolder.lockCanvas(null);\n                synchronized (_surfaceHolder)\n                {\n                    // Insert methods to modify positions of items in onDraw()\n                    _panel.postInvalidate();\n                }\n            } finally\n            {\n                if (c != null)\n                {\n                    _surfaceHolder.unlockCanvasAndPost(c);\n                }\n            }\n        }\n            nextGameTick += MILLISECONDS_PER_FRAME;\n        sleepTime = nextGameTick - System.currentTimeMillis();\n        if(sleepTime &gt;= 0)\n        {\n            try\n            {\n                sleep(sleepTime, 0);\n            } catch (InterruptedException e)\n            {\n                continue;\n            }\n        }\n        else\n        {\n            //we're behind, fuck it.\n            System.out.println(\"behind!\");\n            nextGameTick = System.currentTimeMillis();\n        }\n    }\n}\n</code></pre>\n\n<p>This is not efficient and is taking a lot of CPU. Is there a easy way to get android to only update when something changes? </p>\n"},{"tags":["c#","wpf","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13131305,"title":"Threading serial port query and using the result in a ListView control","body":"<p>I have a device in which if I send a properly formatted string; I get a string back. I would like to use this returned string in a WPF ListView control but I'm having trouble infinitely querying the device on the other end of the serial port. I would like to refresh the data every 3 or so seconds.<br>\nHere is the application logic:</p>\n\n<pre><code>            public static void queryDevice()\n        {\n            SerialPort _serialPort = new SerialPort(\"COM3\", 115200, Parity.None, 8, StopBits.One);\n            _serialPort.Handshake = Handshake.None;\n            ObservableCollection&lt;string&gt; store= new ObservableCollection&lt;string&gt; { \" \", \" \", \" \" };\n            string[] query = new string[3] { \"t02\", \"t03\", \"t04\" };\n            while (true)\n            {\n                for (int i = 0; i &lt; 3; i++)\n                {\n                    string add = SerialCom.returnData(query[i], _serialPort);//returns data depending on which query was sent\n                    if (store[i] != add)\n                    {\n                        store.Add(add);\n                    }\n                }\n                Thread.wait(300);\n\n            }\n        }\n</code></pre>\n\n<p>I'm trying to find the best way to thread this code as putting this code in the UI thread locks the UI thread up. I am planning to use the ObservableCollection as the datasource for the ListView on that note. </p>\n\n<p>Thanks!</p>\n"}]}
{"total":30059,"page":6,"pagesize":100,"questions":[{"tags":["ruby","multithreading","concurrency","locking","datamapper"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12023798,"title":"Odd bug with DataMapper, Mutexes, and Threads?","body":"<p>I have a database full of URLs that I need to test HTTP response time for on a regular basis.  I want to have many worker threads combing the database at all times for a URL that hasn't been tested recently, and if it finds one, test it.</p>\n\n<p>Of course, this could cause multiple threads to snag the same URL from the database.  I don't want this.  So, I'm trying to use Mutexes to prevent this from happening.  I realize there are other options at the database level (optimistic locking, pessimistic locking), but I'd at least prefer to figure out why this isn't working.</p>\n\n<p>Take a look at this test code I wrote:</p>\n\n<pre><code>threads = []\nmutex = Mutex.new\n\n50.times do |i|\n  threads &lt;&lt; Thread.new do\n    while true do \n      url = nil\n\n      mutex.synchronize do\n        url = URL.first(:locked_for_testing =&gt; false, :times_tested.lt =&gt; 150)\n        if url\n          url.locked_for_testing = true\n          url.save \n        end\n      end\n\n      if url\n        # simulate testing the url\n        sleep 1\n\n        url.times_tested += 1\n        url.save\n\n        mutex.synchronize do\n          url.locked_for_testing = false\n          url.save\n        end\n      end\n    end\n\n    sleep 1\n  end\nend\n\nthreads.each { |t| t.join }\n</code></pre>\n\n<p>Of course there is no real URL testing here.  But what <em>should</em> happen is at the end of the day, each URL should end up with \"times_tested\" equal to 150, right?</p>\n\n<p>(I'm basically just trying to make sure the mutexes and worker-thread mentality are working)</p>\n\n<p>But each time I run it, a few odd URLs here and there end up with times_tested equal to a much lower number, say, 37, and locked_for_testing frozen on \"true\"</p>\n\n<p>Now as far as I can tell from my code, if any URL gets locked, it will <em>have</em> to unlock.  So I don't understand how some URLs are ending up \"frozen\" like that.</p>\n\n<p>There are no exceptions and I've tried adding begin/ensure but it didn't do anything.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c","multithreading","function","parameter-passing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13131982,"title":"create thread - passing arguments","body":"<p>I am attempting on creating multiple threads that each thread calculates a prime. I am trying to pass a second argument to a function using thread create. It keeps throwing up errors.</p>\n\n<pre><code>void* compute_prime (void* arg, void* arg2)\n{\n</code></pre>\n\n<p>here is my main() with the create thread. &amp;primeArray[i] after &amp;max_prime is giving me the errors.</p>\n\n<pre><code> for(i=0; i&lt; num_threads; i++)\n {\n    primeArray[i]=0;\n    printf(\"creating threads: \\n\");\n    pthread_create(&amp;primes[i],NULL, compute_prime, &amp;max_prime, &amp;primeArray[i]);\n    thread_number = i;\n    //pthread_create(&amp;primes[i],NULL, compPrime, &amp;max_prime);\n }\n\n /* join threads */\n for(i=0; i&lt; num_threads; i++)\n{\n    pthread_join(primes[i], NULL);\n    //pthread_join(primes[i], (void*) &amp;prime);\n    //pthread_join(primes[i],NULL);\n    //printf(\"\\nThread %d produced: %d primes\\n\",i, prime);\n    printf(\"\\nThread %d produced: %d primes\\n\",i, primeArray[i]);\n    sleep(1);\n}\n</code></pre>\n\n<p>the error i get is:</p>\n\n<pre><code>myprime.c: In function âmainâ:\nmyprime.c:123: warning: passing argument 3 of âpthread_createâ from incompatible pointer type\n/usr/include/pthread.h:227: note: expected âvoid * (*)(void *)â but argument is of type âvoid * (*)(void *, void *)â\nmyprime.c:123: error: too many arguments to function âpthread_createâ\n</code></pre>\n\n<p>It works fine if i take out the second argument.</p>\n"},{"tags":["java","multithreading","swing","nio"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13056080,"title":"Stop Watching A Directory for Changes (cleanup)","body":"<p>I implemented a directory watcher following the java tutorial: <a href=\"https://blogs.oracle.com/thejavatutorials/entry/watching_a_directory_for_changes\" rel=\"nofollow\">https://blogs.oracle.com/thejavatutorials/entry/watching_a_directory_for_changes</a></p>\n\n<p>I have it on a separate thread that updates a JList. Everything seems to be working fine, what I wanted to know is: Do I need to do some type of cleanup somewhere and what would be the best way to do so if that's the case. Because that thread is basically waiting the whole time just in case something happens, after that it goes back to waiting for the next change.</p>\n\n<p>Thanks for the help.</p>\n"},{"tags":["vb.net","winforms","multithreading","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13130814,"title":"Trouble Udating UI from a Seperate Thread","body":"<p>I've been messing around with the answer given here\n<a href=\"http://stackoverflow.com/questions/661561/how-to-update-the-gui-from-another-thread-in-c\">How to update the GUI from another thread in C#?</a></p>\n\n<p>I'm getting the error Method 'System.Windows.Forms.Label' Text not found from the following code</p>\n\n<pre><code>Private Delegate Sub setControlPropertyThreadSafeDelegate(control As Control, propertyName As String, propertyValue As Object)\n\nPublic Sub setControlPropertyThreadSafe(control As Control, propertyName As String, propertyValue As Object)\n    If control.InvokeRequired = True Then\n        control.Invoke(New setControlPropertyThreadSafeDelegate(AddressOf setControlPropertyThreadSafe), New Object() {control, propertyName, propertyValue})\n    Else\n        control.GetType().InvokeMember(propertyName, Reflection.BindingFlags.SetProperty, Nothing, control, New Object() {control, propertyName, propertyValue}) 'This is where the error occurs\n    End If\nEnd Sub\n</code></pre>\n\n<p>From a separate thread I calling this method with the following line </p>\n\n<pre><code>UI.setControlPropertyThreadSafe(UI.lblExcel, \"Text\", \"Inserting Data into YTD Template\")\n</code></pre>\n\n<p>Any help regarding this error will be much appreciated.</p>\n"},{"tags":["c","multithreading","signals","posix","block"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":94,"score":3,"question_id":13114678,"title":"posix threads block signal and unblock","body":"<p>Is there a way to block certain signals and unblock other signals in the same set?\nI just dont seem to get my head around it!</p>\n\n<p>An example</p>\n\n<pre><code>sigset_t set;\nsigemptyset(&amp;set);\n\nsigaddset(&amp;set, SIGUSR1);\n// Block signal SIGUSR1 in this thread\npthread_sigmask(SIG_BLOCK, &amp;set, NULL);\nsigaddset(&amp;set, SIGALRM);\n// Listen to signal SIGUSR2\npthread_sigmask(SIG_UNBLOCK, &amp;set, NULL);\n\n\npthread_t printer_thread1, printer_thread2;\npthread_create(&amp;printer_thread1, NULL, print, (void *)&amp;f1);\npthread_create(&amp;printer_thread2, NULL, print, (void *)&amp;f2);\n\nbool tl = true;\nwhile(1)\n{\n    if(tl)\n    {\n        // thread1 does something\n        kill(pid, SIGUSR1);\n        // main thread waits for SIGALRM\n        sigwait(&amp;set, &amp;sig);\n        tl = !tl;\n    }\n    else\n    {\n        // thread2 does something\n        kill(pid, SIGUSR2);\n        // main thread waits for SIGALRM\n        sigwait(&amp;set, &amp;sig);\n        tl = !tl;\n    }\n}\n</code></pre>\n\n<p>I am not allowed to use Mutexs, semaphores etc only signals.</p>\n\n<p>Can someone help? :)</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1578,"score":3,"question_id":3141672,"title":"c# inter-thread communication","body":"<p>hello i want to threads to collaborate a producer and a consumer. \nthe consumer is rather slow, and the producer is very fast and works in bursts.</p>\n\n<p>for example the consumer can process one message per 20 seconds, and the producer can produce 10 messages in one second, but does it about once in a long while so the consumer can catch up.</p>\n\n<p>i want something like:</p>\n\n<pre><code>Stream commonStream;\nAutoResetEvent commonLock;\n\nvoid Producer()\n{\n  while (true)\n  {\n    magic.BlockUntilMagicAvalible();\n    byte[] buffer = magic.Produce();\n    commonStream.Write(buffer);\n    commonLock.Set();\n  }\n}\n\nvoid Consumer()\n{\n  while(true)\n  { \n    commonLock.WaitOne();\n    MagicalObject o = binarySerializer.Deserialize(commonStream);\n    DoSomething(o);\n  }\n}\n</code></pre>\n"},{"tags":["java","multithreading","swing","jdialog","swingworker"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":62,"score":4,"question_id":13131061,"title":"Safely open and close modal JDialog (using SwingWorker)","body":"<p>I needed a way to get some data from a database and prevent the user from modifying existing data for that moment.</p>\n\n<p>I created a SwingWorker to make the db update and a modal JDialog to show user what is going on (with a JProgressBar). The modal dialog has defaultCloseOperation set to DO_NOTHING, so it can only be closed with a proper call - I use <code>setVisible(false)</code>.</p>\n\n<pre><code>MySwingWorkerTask myTask = new MySwingWorkerTask();\nmyTask.execute();\nmyModalDialog.setVisible(true);\n</code></pre>\n\n<p>The SwingWorker does some stuff within doInBackground() and lastly it calls:</p>\n\n<pre><code>myModalDialog.setVisible(false);\n</code></pre>\n\n<p>My only concern and my question:\nIs is possible that the SwingWorker executes the <code>setVisible(false)</code> before it is <code>setVisible(true)</code> in the line after worker spawn?</p>\n\n<p>If so the <code>setVisible(true)</code> could block forever (the user can't close the modal window).</p>\n\n<p>Do I have to implement something as:</p>\n\n<pre><code>while (!myModalDialog.isVisible()) {\n    Thread.sleep(150);\n}\nmyModalDialog.setVisible(false);\n</code></pre>\n\n<p>to make sure it will actually get closed?</p>\n"},{"tags":["c","linux","multithreading","pthreads","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13122406,"title":"Why do we need a condition check before pthread_cond_wait","body":"<p>I am trying to learn basics of pthread_cond_wait. In all the usages, I see either </p>\n\n<pre><code>if(cond is false)\n   pthread_cond_wait\n</code></pre>\n\n<p>or</p>\n\n<pre><code>while(cond is false)\n   pthread_cond_wait\n</code></pre>\n\n<p>My question is, we want to cond_wait only because condition is false. Then why should i take the pain of explicitly putting an if/while loop. I can understand that without any if/while check before <code>cond_wait</code> we will directly hit that and it wont return at all. Is the condition check solely for solving this purpose or does it have anyother significance. If it for solving an unnecessary condition wait, then putting a condition check and avoiding the cond_wait is similar to polling?? I am using cond_wait like this.</p>\n\n<pre><code>void* proc_add(void *name){\n    struct vars *my_data = (struct vars*)name;\n    printf(\"In thread Addition and my id = %d\\n\",pthread_self());\n    while(1){\n    pthread_mutex_lock(&amp;mutexattr);\n    while(!my_data-&gt;ipt){  // If no input get in\n            pthread_cond_wait(&amp;mutexaddr_add,&amp;mutexattr);  // Wait till signalled\n            my_data-&gt;opt = my_data-&gt;a + my_data-&gt;b;\n            my_data-&gt;ipt=1;\n            pthread_cond_signal(&amp;mutexaddr_opt);\n    }\n    pthread_mutex_unlock(&amp;mutexattr);\n    if(my_data-&gt;end)\n            pthread_exit((void *)0);\n    }\n}\n</code></pre>\n\n<p>The logic is, I am asking the input thread to process the data whenever an input is available and signal the output thread to print it. </p>\n\n<p>Thanks\nChidambaram</p>\n"},{"tags":["python","multithreading","client-side-validation"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13130502,"title":"Multithreading in such a way that I am able to accept multiple clients in Python","body":"<p>I am expected to write a server that can handle multiple clients in Python, and so far I am able to deal with one connection(from a client)but I really don't know how to extend my program to handle multiple clients. I tried looking at Twisted, but couldn't really grasp it.</p>\n\n<p>Any recommendations, or sample code that can help me understand how to handle multiple clients? Ideally, I should be able to have multiple clients connected to the server, and based on the input they pass once they are connected, I should be able to do all sort of fascinating things by parsing their input, etc.</p>\n\n<p>I really look forward to your responses, and thank you in advance for your time. I'm a long time lurker.</p>\n\n<p>P.S\nI already looked at most other multithreading examples of Python, they didn't quite honestly help.</p>\n\n<p>Thanks.</p>\n"},{"tags":["javascript","multithreading","parallel-processing"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1376,"score":6,"question_id":3897625,"title":"Parallel JavaScript Code","body":"<p>Is it possible to run JavaScript code in parallel in the browser? I'm willing to sacrifice some browser support (IE, Opera, anything else) to gain some edge here.</p>\n"},{"tags":["java","multithreading","deadlock"],"answer_count":6,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13130715,"title":"can not reproduce deadlock using the next code","body":"<p>can not reproduce deadlock using the next code</p>\n\n<p>I am trying yo get a deadlock using the next code, \nbut it seems that it works good. </p>\n\n<p>Please see below:</p>\n\n<pre><code>public class Deadlock {\n\n    static Object lock1 = new Object();\n    static Object lock2 = new Object();\n\n    public static void main(String[] args) {\n\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while (true) {\n                    synchronized (lock1) {\n                        System.out.println(\"Thread 1: locked lock1\");\n                    }\n                    try {\n                        Thread.sleep(100);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (lock2) {\n                        System.out.println(\"Thread 1: locked lock2\");\n                    }\n                }\n            }\n        }).start();\n\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while (true) {\n                    synchronized (lock2) {\n                        System.out.println(\"Thread 2: locked lock2\");\n                    }\n                    try {\n                        Thread.sleep(50);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    synchronized (lock1) {\n                        System.out.println(\"Thread 2: locked lock1\");\n                    }\n                }\n            }\n        }).start();\n\n    }\n\n}\n</code></pre>\n\n<p>What I don't understand in this case or what's wrong in this code?</p>\n"},{"tags":["java","multithreading","hibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13129593,"title":"Unknown Entity in multithreading hibernate","body":"<p>We are converting a large database from one DBMS to another. We are mostly using JDBC for this but there are some Hibernate calls mixed in. So far, a small portion of the database is taking seven hours to migrate. To mitigate this, we decided we could migrate different parts of the database simultaneously. We rewrote the migration routine to use threads. After wading through Java heap space issues and making sure we had separate JDBC and Hibernate sessions in each thread, we found ourselves with one last problem: We are getting Unknown entity: exceptions everywhere. We are creating a SchemaExport and executing it before any migration thread starts. What are we missing?</p>\n"},{"tags":["java","multithreading","interrupt"],"answer_count":3,"favorite_count":0,"up_vote_count":9,"down_vote_count":1,"view_count":223,"score":8,"question_id":12572456,"title":"What are the differences between calling System.exit(0) and Thread.currentThread().interrupt() in the main thread of a Java program?","body":"<p>Both cause a program to stop executing. It's clear that there must be some differences in how this happens, though. What are they?</p>\n"},{"tags":["java","multithreading","sockets"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13116927,"title":"Single java thread using excess system resources","body":"<p>I am trying to create a server listener. It sits back and waits for data coming from the client and performs setting actions due to the nature of the data. But right now, after receiving the first data stream, it goes into a resource hog, the memory usage shoots up and the CPU usage is maxing out a single core.</p>\n\n<p>1 - How can I fix this? How can I make it <strong>listen</strong> without all the resource hog, as you can see it is a really really small program.</p>\n\n<p>2 - The client itself that sends these data streams, runs once. It starts up, connects to the server, sends the data and quits. While the server is still \"on\", if I retry running the client again, the server doesn't receive the data. </p>\n\n<p>Server Code:</p>\n\n<pre><code>package mediaserver;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\npublic class Main {\n    ServerSocket ss;\n    Socket s;\n    BufferedReader br;\n\n    public Main() throws IOException{\n        ss = new ServerSocket(1111);\n        s = ss.accept();\n        br = new BufferedReader(new InputStreamReader(s.getInputStream()));\n        new Thread(new runner()).start();\n    }\n\n    class runner implements Runnable{\n\n        public void run(){\n          while(true){\n            try {\n                String n = br.readLine();\n                System.out.println(n);\n            } catch (IOException ex) {\n            }\n             finally{\n                 try {\n                       s.close();\n                       ss.close();\n                    } catch (IOException ex) {\n                    }\n\n             }\n          }\n        }\n    }\n\n    public static void main(String[] args) throws IOException {\n        new Main();\n    }\n\n}\n</code></pre>\n\n<p>Client Code</p>\n\n<pre><code>package mediaserver;\n\nimport java.io.BufferedWriter;\nimport java.io.IOException;\nimport java.io.OutputStreamWriter;\nimport java.net.Socket;\nimport java.net.UnknownHostException;\n\npublic class test {\npublic static void main(String [] args) throws UnknownHostException, IOException, InterruptedException{\n    Socket s = new Socket(\"127.0.0.1\", 1111);\n    BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));\n    bw.write(\"\");\n    bw.newLine();\n    bw.flush();\n\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","networking","concurrency"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13129538,"title":"high resolution timer in java","body":"<p>I want to simulate TCP in Java.</p>\n\n<p>For that I have multiple threads, like sender and receiver threads for every TCP connection.</p>\n\n<p>My problem is, I want to pause (like Thread.sleep()) threads for microseconds time interval. So that I can simulate flow control, where sender thread will block for microseconds before sending next packet, and at same time CPU can be used by receiving and data processing threads. But I couldn't find any methods which perform sleep() or wait() for microsecond or nanosecond resolution. How can I block (pause) threads in Java with micro or nanosecond resolution?</p>\n\n<p>I found System.nanoTime() method, but there no methods for blocking threads for specified micro or nano seconds. If there any such methods, then please let me know. System.nanoTime() just gives relative time interval in nanoseconds.</p>\n\n<p>I can use System.nanoTime() to perform nanosecond delay in threads using busy-loop, but that will waste CPU, which could have been used for receiving data thread or processing thread.</p>\n\n<p>Another confusing question:</p>\n\n<p>By surfing internet, I found Thread.sleep() or wait() methods blocks for at least specified milliseconds or in multiple of 10ms, whichever is less, without thread interrupt, in Windows System. But when I run sample examples, I found very different results. Like threads are sleeping less than specified milliseconds. Some threads are giving me 100 microsecond sleep. Is it error in time measured? Is not System.nanoTime() that much accurate? See below example where I am getting very different results. Thread priorities are also not giving predicted results.</p>\n\n<pre><code>public class MyClass {\n    public static void main(String args []){\n        Runnable r = new Runnable() {\n            public void run() {\n                long s = System.nanoTime();\n                //Thread.yield();  // Try for yield, need to check - in how much time high priority thread will be scheduled back after yielding\n                try{\n                    Thread.sleep(1);\n                }catch(Exception e){\n\n                }\n                long e = System.nanoTime() - s;\n                System.out.println(Thread.currentThread().getName()+e);\n            }\n        };\n\n        Thread t1 = new Thread(r, \"Thread T1: \");\n        t1.setPriority(Thread.MAX_PRIORITY);\n        t1.start();\n\n        Thread t2 = new Thread(r, \"Thread T2: \");\n        t2.setPriority(Thread.MIN_PRIORITY);\n        t2.start();\n\n        Thread t3 = new Thread(r, \"Thread T3: \");\n        t3.setPriority(Thread.NORM_PRIORITY);\n        t3.start();\n\n        Thread t4 = new Thread(r, \"Thread T4: \");\n        t4.setPriority(Thread.MAX_PRIORITY);\n        t4.start();\n\n        long s = System.nanoTime();\n        try{\n            Thread.sleep(1);\n        }catch(Exception e){\n\n        }\n        long e = System.nanoTime() - s;\n        System.out.println(\"Main: \"+e);\n    }\n}\n</code></pre>\n\n<p>In my System with Intel Core i5, 2.53 GHz, I am getting outputs similar like below in multiple runs. *New-line in below output is not printed in this post, I have copied output from console, but its giving me new-line in my my console, that's not problem.</p>\n\n<p>Thread T1: 736682\nThread T3: 700212\nThread T2: 478559\nMain: 548257\nThread T4: 458299</p>\n\n<p>Second run - </p>\n\n<p>Thread T3: 27555\nThread T2: 139799\nThread T1: 152361\nMain: 93199\nThread T4: 29986</p>\n\n<p>Third run - </p>\n\n<p>Thread T4: 724525\nThread T2: 1050319\nMain: 752486\nThread T1: 941316\nThread T3: 1000883</p>\n\n<p>Fourth run - </p>\n\n<p>Thread T1: 174243\nThread T2: 166543\nThread T3: 1005745\nMain: 1023170\nThread T4: 915787</p>\n\n<p>In above runs, I am getting microseconds blocking. :O</p>\n\n<p>Please guide me on this.</p>\n\n<p>Apologize for long post. Thank you for reading whole post.</p>\n"},{"tags":[".net","multithreading","threadabortexception","thread-abort"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13126486,"title":"Is it ok to call thread.Abort() when the Form is closing? If not, then will the global flag be good enough?","body":"<p>First of all, Thread.Abort() is evil - got it!  Now let me explain my situation...</p>\n\n<p><strong>Situation:</strong></p>\n\n<p>I have a dashboard that only displays current running status to the user.  It executes various select queries against a Sql Server DB and performs some calculations that are eventually displayed to the user on the dashboard.  The user can open multiple dashboards at the same time.  I have a timer thread that refreshes the dashboard every few seconds.  That timer thread spawns another thread (actually queues work on a threadpool) to perform long running calculations/queries.    </p>\n\n<p><strong>The Problem:</strong></p>\n\n<p>When the user clicks the X to close the Dashboard window, it needs to shut down right away (say within a second, I think 2 seconds is too long).  So I use this code:</p>\n\n<pre><code>    private void Form1_FormClosing(object sender, FormClosingEventArgs e)\n    {\n        _timerThread.Abort();\n    }\n\n    private void Timer_Elapsed(object sender, ElapsedEventArgs e)\n    {\n        // we're on the timer thread now\n\n        try\n        {\n            RefreshUi();\n        }\n        catch (ThreadAbortException)\n        {\n            System.Threading.Thread.ResetAbort();\n        }\n        catch (Exception ex)\n        {\n            MessageBox.Show(ex.ToString());\n        }\n    }\n</code></pre>\n\n<p>The problem is sometimes the ThreadAbortException is caught, and sometimes it isn't.  I find it's mostly uncaught when in the middle of executing queries.</p>\n\n<p><em>[UPDATE]</em> I've recently discovered I can catch the ThreadAbortException if I check the innerexception.</p>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Is it ok use Thread.Abort() in this case?  If so, how do I ALWAYS catch the ThreadAbortException so the user doesn't see it when closing the Form? (from what I've read I don't think this is possible)</li>\n<li>If it's not ok to use Thread.Abort() (which is what I think most of you will answer), then here are my other concerns with using a \"global boolean flag\" to tell the thread(s) when to shutdown.\n<ul>\n<li>I'm concerned the threads won't stop themselves within the 1 second time limit. (For example, I may have some queries that take 1-2 seconds to run)</li>\n<li>I will have to clutter my code with: if(shouldShutdown) statements.</li>\n<li>Should I make the shouldShutdown flag static so all my classes can use it?  Will this pose a problem if the user can open multiple dashboards at the same time? (I'm concerned about the static variable being shared across all dashboards. This I definetely don't want.)</li>\n<li>When the worker threads see they have to shutdown, should they throw an exception or just return?  If they just return, then I'll have to add even more if(shouldShutdown) checks because it's ok for some functions to return false.  If throwing an exception is ok, which exception do you recommend?  A custom one?</li>\n</ul></li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13114097,"title":"SwingUtilities.invokeLater on full speed thread","body":"<p>I have a thread that does display updates on my JFrame by using SwingUtilities.invokeLater. The thread's speed is adjustable, and when it set to full speed (no sleeping between updates),  my program gets slowed down badly. I guess the problem is my thread is generating too much SwingUtilities.invokeLater events that JFrame's thread can not consume. So is there anything I can do on my thread to remove previously added but not consumed events? Or should I use some other ways to update JFrame without using SwingUtilities.invokeLater?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["python","multithreading","arguments","typeerror"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13128860,"title":"TypeError: start() takes exactly 1 argument (0 given)?","body":"<p><strong>I have something like this:</strong> </p>\n\n<pre><code>class thread1(threading.Thread):\n    def __init__(self):\n        file = open(\"/home/antoni4040/file.txt\", \"r\")\n        data = file.read()\n        num = 1\n        while True:\n           if str(num) in data:\n               clas = ExportToGIMP\n               clas.update()\n           num += 1     \nthread = thread1\n        thread.start()\n        thread.join()\n</code></pre>\n\n<p><strong>And I get this error:</strong></p>\n\n<pre><code>TypeError: start() takes exactly 1 argument (0 given)\n</code></pre>\n\n<p><strong>Why?</strong></p>\n"},{"tags":["c#","multithreading","gui"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13127552,"title":"Need help setting up threads/background worker in GUI","body":"<p>I'm using C# and Winforms in Visual Studio 2010</p>\n\n<p>I have a program with which I am trying to read output through a serial port and print it to the screen.  It originally started as a Console program but has now evolved to where we would like to have the output be in a field on a form.  I have the code that parses out the output I'm looking for off the serial port written and working, I just need to change the Console.WriteLine to label.text = \"\";, basically.  I have merged the function that listens to the serial port into the GUI code so everything is in the same file.</p>\n\n<p>I'm getting hung up on how to get the function to write to the label, though.  It is STATIC so I cant just say 'label.text ='.  I tried creating a new form object inside the function to use, and that allowed me to access the control on the form, but doesnt update the form I see at runtime (I'm guessing because I've created a new instance of the form rather than accessed the existing instance?)</p>\n\n<p>I need to have the serial listener run at the same time as the GUI as well, so the GUI label will update with the results it gets from running the function in close to real-time, so Ive tried to set it up to be threaded, with the GUI being one thread that is started by main() and the serial listener being another thread which is started when i click the button to start it.  However, I run into the same issue with not being able to access the label in the serial listener thread because it has to be static to be initialized using system.threading.</p>\n\n<p>I'm thinking maybe I need to use a background worker for the serial listener but I have absolutely zero experience with those.  Would a background worker be able to update the label on the GUI in real time?</p>\n\n<p>I cant post specific code but heres the general idea:</p>\n\n<p>Main() starts GUIthread</p>\n\n<p>GUI has button to start serial listener\nOnClick button starts ListenerThread\nListenerThread outputs to console, want to output to a form label instead</p>\n\n<p>Cant access GUI.Label because Listener is static out of necessity to be threaded\nCreating new GUI instance inside Listener allows me to call the controls for that instance, but they dont update the GUI at runtime</p>\n\n<p>have ensured label is public.</p>\n"},{"tags":["c++","multithreading","c++11","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":115,"score":3,"question_id":13099660,"title":"C++11: why does std::condition_variable use std::unique_lock?","body":"<p>I am a bit confused about the role of <code>std::unique_lock</code> when working with <code>std::condition_variable</code>. As far as I understood the <a href=\"http://en.cppreference.com/w/cpp/thread/unique_lock\" rel=\"nofollow\">documentation</a>, <code>std::unique_lock</code> is basically a bloated lock guard, with the possibility to swap the state between two locks.</p>\n\n<p>I've so far used <code>pthread_cond_wait(pthread_cond_t *cond, pthread_mutex_t *mutex)</code> for this purpose (I guess that's what the STL uses on posix). It takes a mutex, not a lock.</p>\n\n<p>What's the difference here? Is the fact that <code>std::condition_variable</code> deals with <code>std::unique_lock</code> an optimization? If so, how exactly is it faster?</p>\n"},{"tags":["c#","multithreading","user-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":135,"score":0,"question_id":9069352,"title":"Responsive UI in windows form accessing device data","body":"<p>I have C# windows form application that queries data from a connected device. I currently start a System.Timer.Timer that  is set to fire every 20ms and grab data from the connected tool. This works fine but of course the UI becomes unresponsive for updates of data counts, end-result of calcs on the data etc etc. I also display the data in a couple OpenGL windows so there is quite a bit going on.</p>\n\n<pre><code>_timer1 = new System.Timers.Timer{\nInterval = Convert.ToDouble(txtElapse.Text),\nEnabled = true};    \n_timer1.Elapsed += Timer1Elapsed;\n</code></pre>\n\n<p>I then use then invalidate the form to redraw for the OpenGL and that is where all my calcs etc are carried out.</p>\n\n<p>My question is to do with threading, basically at what point or to what object do I apply the thread logic to? The timer itself? If i do that I am unable to debug, it just sits there. I have done a fair amount of research to do with ThreadPools, Backgroundworker, Thread etc but nothing for this situation as I believe (mistakenly?) that the timer runs on its own thread by default.</p>\n"},{"tags":["java","multithreading","concurrency","executorservice","java.util.concurrent"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":13103939,"title":"Using synchronizers from concurrent package. FutureTask always returns null","body":"<p>Can anyone tell why in the following snippet using a <code>FutureTask</code> does not work?<br>\nMy understanding is that we can use <code>FutureTask</code>, right?<br>\nTo give a full description:<br>\nI have stumbled across some subtle bug in my code.<br>\nBriefly I have created a class that uses a <code>SingleThreadPoolExecutor</code> to run <code>Callable</code>s passed as parameters.<br>\nI use it in order to run background tasks and display a progress dialog in an Eclipse application.<br>\nCode is:  </p>\n\n<pre><code>public class TaskRunner &lt;T&gt;  {  \n\n    final static ExecutorService threadPool = Executors.newSingleThreadExecutor();  \n    private T taskResult;  \n\n    public T runTask(Callable&lt;T&gt; task, Shell currentShell) throws CustomException{          \n        if(currentShell == null){  \n            currentShell = new Shell();  \n        }  \n        final Callable&lt;T&gt; taskToRun = task;       \n\n        ProgressMonitorDialog progressDialog = new ProgressMonitorDialog(currentShell);  \n        try {  \n            progressDialog.run(false, true, new IRunnableWithProgress() {  \n\n                @SuppressWarnings(\"unchecked\")  \n                @Override  \n                public void run(IProgressMonitor monitor) throws InvocationTargetException, InterruptedException {  \n                    monitor.beginTask(\"Saving your data!\", 100);  \n\n                    FutureTask&lt;T&gt; task = createTask(taskToRun);  \n                    Future&lt;?&gt; result = threadPool.submit(task);  \n                    while(!result.isDone()){  \n                        monitor.worked(1);  \n                    }                     \n                    try {  \n                        taskResult = (T) result.get();  \n                        if(taskResult == null){  \n                            System.out.println(\"Result here in return is NULL!\");  \n                        }  \n\n                    } catch (ExecutionException e1) {  \n                        logger.error(e1);  \n                    }   \n                    catch(Exception e){  \n                        logger.error(e);  \n                    }               \n                }  \n            });  \n        } catch (InvocationTargetException e) {  \n            logger.error(e);  \n        } catch (InterruptedException e) {  \n            logger.error(e);  \n        }       \n        return taskResult;  \n    }  \n\n    private static &lt;T&gt; FutureTask&lt;T&gt; createTask(Callable&lt;T&gt; theTask){  \n        return new FutureTask&lt;T&gt;(theTask);   \n    }  \n}  \n</code></pre>\n\n<p>And the code task:  </p>\n\n<pre><code>public class MyTask implements Callable&lt;ComplexObject&gt; {    \n\n    private Util helper;  \n    private String filePath;  \n\n    public LoadKeystoreTask(Util helper, String filePath) {  \n        this.helper = helper;     \n        this.filePath = filePath;  \n    }  \n\n    @Override  \n    public Container call() throws Exception {        \n        ComplexObject result = helper.loadData(filePath);  \n        if(result == null){  \n            System.out.println(\"ComplexObject IS NULL!\");  \n        }  \n        else{  \n            System.out.println(\"ComplexObject IS NOT NULL!\");  \n        }   \n        return result;  \n    }  \n}   \n</code></pre>\n\n<p><strong>Problem:</strong><br>\nWhile the <code>helper.loadData</code> correctly returns the result (verified via debugging and print statements) this line:  </p>\n\n<pre><code>taskResult = (T) result.get(); \n</code></pre>\n\n<p><strong>always</strong> is <code>null</code>.<br>\nI.e to simplify it is printed:  </p>\n\n<blockquote>\n  <p>ComplexObject IS NOT NULL!<br>\n  Result here in return is NULL!  </p>\n</blockquote>\n\n<p>This is verified to be caused by submitting a <code>FutureTask</code>.<br>\nIf I submit a <code>Callable</code> instead:</p>\n\n<p>I.e. just chang to:  </p>\n\n<pre><code>Future&lt;?&gt; result = threadPool.submit(taskToRun);\n</code></pre>\n\n<p>it works! Why does wrapping with <code>FutureTask</code> causes this problem?    </p>\n"},{"tags":["android","multithreading","activity"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13122638,"title":"Prioritising new Activity","body":"<p>I have activity A that needs to do things upon exit\n-Save stuff  to a database\n-Start Activity B</p>\n\n<p>As saving can take a while, i though i should start a new thread to have the database access running in the backgroud, while the user is busy reading the content of activity B. (B does not use the saved data btw).</p>\n\n<p>So I have in Activity A</p>\n\n<pre><code> FinishStuff(){\n Intent ourIntent = new Intent(this, ActivityB.class);\n startActivity(ourIntent);\n\n handler = new Handler();\n handler.post(dbSaver);\n}\n public Runnable dbSaver = new Runnable() {\n\n @Override\n public void run() {\n     saveToDbs();\n }\n</code></pre>\n\n<p>Howevever, What happens is that OnCreate() of activity B is called immediately, but the screen space where my new Activity should go is black until, saveToDBs() is finished at which stage Activity B gets displayed.\nAny way to solve this?\nTIA</p>\n"},{"tags":["c","multithreading","signals","posix","mask"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13113885,"title":"POSIX Threads and signal masks","body":"<p>Is there a way to change the signal mask of a thread from another thread?\nI am supposed to write a multithreaded C application that doesn't use mutex, semaphores and condition variables, only signals.</p>\n\n<p>So it would look like something like this:\nThe main Thread sends SIGUSR1 to its process and and one of the 2 threads (not including the main thread), will respond to the signal and block SIGUSR1 from the sigmask and sleep. Then the main thread sends SIGUSR1 again, the other thread will respond, block SIGUSR1 from its  sigmask, unblock SIGUSR1 from the other threads sigmask, so it will respond to SIGUSR1 again.</p>\n\n<p>So essentially whenever the main thread sends SIGUSR1 the two other threads swap between each other.</p>\n\n<p>Can somebody help?</p>\n"},{"tags":["python","multithreading","decorator","canonical"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":43,"score":6,"question_id":13125276,"title":"What is the \"correct\" way to make a stoppable thread in Python, given stoppable pseudo-atomic units of work?","body":"<p>I'm writing a threaded program in Python. This program is interrupted very frequently, by user (CRTL+C) interaction, and by other programs sending various signals, all of which should stop thread operation in various ways. The thread does a bunch of units of work (I call them \"atoms\") in sequence. </p>\n\n<p>Each atom can be stopped quickly and safely, so making the thread itself stop is fairly trivial, but my question is: <strong>what is the \"right\", or canonical way to implement a stoppable thread, given stoppable, pseudo-atomic pieces of work to be done?</strong> </p>\n\n<p>Should I poll a <code>stop_at_next_check</code> flag before each atom (example below)? Should I decorate each atom with something that does the flag-checking (basically the same as the example, but hidden in a decorator)? Or should I use some other technique I haven't thought of?</p>\n\n<p>Example (simple stopped-flag checking):</p>\n\n<pre><code>class stoppable(Thread):\n    stop_at_next_check = False\n    current_atom = None\n\n    def __init__(self):\n        Thread.__init__(self)\n\n    def do_atom(self, atom):\n        if self.stop_at_next_check:\n            return False\n        self.current_atom = atom\n        self.current_atom.do_work()\n        return True     \n\n    def run(self):\n        #get \"work to be done\" objects atom1, atom2, etc. from somewhere\n\n        if not do_atom(atom1):\n            return\n\n        if not do_atom(atom2):\n            return\n\n        #...etc\n\n    def die(self):\n        self.stop_at_next_check = True\n        self.current_atom.stop()\n</code></pre>\n"},{"tags":["c++","multithreading","posix","condition-variable","barrier"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13124688,"title":"Implementing logarithm barrier in posix","body":"<p>I've been trying to implement logarithm barrier with condition variables (number of condition variables is equal to the number of threads, and the number of signals should be logarithmic) using this algorithm (listed <a href=\"http://www.cs.utsa.edu/~whaley/teach/cs4823/LEC/pthreads_ho.pdf\" rel=\"nofollow\">here</a>, page 21):</p>\n\n<pre><code>typedef struct barrnode {\n  pthread_mutex_t countlock;\n  pthread_cond_t OkGoUp, OkGoDown;\n  int count;\n} mybarr_t;\n\ntypedef struct barrnode my_lgbarr_t[NT];\n\nvoid mybarr_init(my_lgbarr_t b) {\n  for (i=0; i &lt; NT; i++) {\n    b[i].count = 0;\n    pthread_mutex_init(&amp;b[i].countlock, NULL);\n    pthread_cond_init(&amp;b[i].OkGoUp, NULL);\n    pthread_cond_init(&amp;b[i].OkGoDown, NULL);\n  }\n}\n\nvoid my_lgbarrier(my_lgbarr_t b, int Iam) {\n  i = 2; base = 0;\n  do {\n    k = base + Iam / i;\n    if (Iam%i == 0) { // even stay in\n      pthread_mutex_lock(&amp;b[k].countlock);\n      b[k].count++;\n      while (b[k].count &lt; 2)\n        pthread_cond_wait(&amp;b[k].OkGoUp, &amp;b[k].countlock);\n      pthread_mutex_unlock(&amp;b[k].countlock);\n    } else { // odd nodes signal &amp; leave\n      pthread_mutex_lock(&amp;b[k].countlock);\n      b[k].count++;\n      if (b[k].count == 2)\n        pthread_cond_signal(&amp;b[k].OkGoUp);\n      while (b[k].count != 0)\n        pthread_cond_wait(&amp;b[k].OkGoDown, &amp;b[k].countlock)\n      pthread_mutex_unlock(&amp;b[k].countlock);\n      break;\n    }\n    base += NT/i;\n    i *= 2;\n  } while (i &lt;= NT);\n\n  for(i /= 2; i &gt; 1; i /= 2) {\n    base = base - NT/i;\n    k = base + Iam/i;\n    pthread_mutex_lock(&amp;b[k].countlock);\n    b[k].count = 0;\n    pthread_mutex_unlock(&amp;b[k].countlock);\n    pthread_cond_signal(&amp;b[k].OkGoDown);\n  }\n}\n</code></pre>\n\n<p>The problem is that it takes too long to execute and then suddenly it just stops working. I'd like to ask you what could be the problem. Thanks.</p>\n"},{"tags":["c#","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":11,"down_vote_count":2,"view_count":262,"score":9,"question_id":13125105,"title":"Why so much difference in performance between Thread and Task?","body":"<p><em>Windows 7, Intel CORE i3, 64 bit, RAM 4Gb, 2.27 GHz<br>\n.NET Framework 4.0</em></p>\n\n<p>I have the following code:</p>\n\n<pre><code>static void Main(string[] args)\n{\n    var timer = new Stopwatch();\n    timer.Start();\n\n    for (int i = 0; i &lt; 0xFFF; ++i)\n    {\n        // I use one of the following line at time\n        Task.Factory.StartNew(() =&gt; { });\n        new Thread(() =&gt; { }).Start();\n    }\n\n    timer.Stop();\n\n    Console.WriteLine(timer.Elapsed.TotalSeconds);\n    Console.ReadLine();\n}\n</code></pre>\n\n<p>If I use Task the output is always less then <strong>0.01 seconds</strong>, but if I use Thread the output is always greater than <strong>40 seconds</strong>!<br>\nHow is it possible? Why so much difference?</p>\n"},{"tags":["c#","multithreading","idisposable"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":104,"score":6,"question_id":13124201,"title":"Should I implement IDisposable for a class containing a Thread","body":"<p>I have a class that uses the <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.thread%28v=vs.90%29.aspx\" rel=\"nofollow\">Thread</a> class:</p>\n\n<pre><code>class A\n{\n    public Thread thread\n    { get; set; }\n}\n</code></pre>\n\n<p>Should I implement IDisposable and set Thread property to null?</p>\n\n<pre><code>class A : IDisposable\n{\n    public Thread Thread\n    { get; set; }\n\n    protected bool Disposed\n    { get; set; }\n\n\n    public void Dispose()\n    {\n        Dispose(true);\n        GC.SuppressFinalize(this);\n    }\n\n    protected virtual void Dispose(bool disposing)\n    {\n        if (!this.Disposed)\n        {\n            if (disposing)\n            {\n                if (Thread != null)\n                    Thread = null;\n            }\n\n            Disposed = true;\n        }\n    }\n}\n</code></pre>\n\n<p>Or not?<br>\nWhy?</p>\n"},{"tags":["java","android","multithreading","crash-reports","acra"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13125028,"title":"How to log stack trace from all of the threads using ACRA","body":"<p>everybody!</p>\n\n<p>Now I'm trying to use ACRA for sending crash reports on my e-mail.\nI have the next ACRA settings:</p>\n\n<pre><code>@ReportsCrashes(\nformKey = \"\",\nmailTo = \"developer@email.com\",\nadditionalSharedPreferences = {\n    CSConfig.pref.PREFERENCES\n},\ncustomReportContent = {\n    ReportField.PHONE_MODEL,\n    ReportField.ANDROID_VERSION,\n    ReportField.APP_VERSION_NAME,\n    ReportField.APP_VERSION_CODE,\n    ReportField.STACK_TRACE,\n    ReportField.AVAILABLE_MEM_SIZE,\n    ReportField.SHARED_PREFERENCES,\n    ReportField.LOGCAT\n},\nmode = ReportingInteractionMode.TOAST,\nresToastText = R.string.crash_toast_msg\n</code></pre>\n\n<p>)</p>\n\n<p>The question is: how to tell ACRA to send the stack trace from all\nof the threads running (like in debug) to me?</p>\n\n<p>Thanks!\nI will be really appreciated for the answers!</p>\n"},{"tags":["python","multithreading","networking","asynchronous","twisted"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13114728,"title":"Sending arbitrary data with Twisted","body":"<p>An example of my code is as follows.  I would like to arbitrarly send data at various points in the program.  Twisted seems great for listening and then reacting, but how to I simply send data.</p>\n\n<pre><code>    from twisted.internet.protocol import DatagramProtocol\n    from twisted.internet import reactor\n    import os\n\n    class listener(DatagramProtocol):\n\n        def __init__(self):\n\n        def datagramReceived(self, data, (host, port)):\n            print \"GOT \" + data\n\n        def send_stuff(data):\n            self.transport.write(data, (host, port))\n\n    reactor.listenUDP(10000, listener())\n    reactor.run()\n\n    ##Some things happen in the program independent of the connection state\n    ##Now how to I access send_stuff\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":13123774,"title":"Get the status of thread in multithreading","body":"<p>I have created threads dynamically.</p>\n\n<pre><code>static void Main(string[] args)\n{\n\n    int ThreadCount =Convert.ToInt32ConfigurationManager.AppSettings[\"Threads\"]);\n    List&lt;Thread&gt; th = new List&lt;Thread&gt;();\n    for (int i = 0; i &lt; ThreadCount; i++)\n    {\n      Thread t = new Thread(print);\n      th.Add(t);\n    }\n    foreach (Thread t in th)\n    {\n       t.Start();\n    }\n }\n public static void print()\n {\n    console.writeline(\"123\");\n }\n</code></pre>\n\n<p>I want to know when this threads will complete.\nOn completion of these threads I want to print a message of \"DONE\"</p>\n\n<p>How can I do this.</p>\n"},{"tags":["java","multithreading","concurrent-programming"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13124143,"title":"java multithreading issue","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/767372/java-string-equals-versus\">Java String.equals versus ==</a>  </p>\n</blockquote>\n\n\n\n<p>I am writing a program to simulate the hare and turtle race!\nI am using getName() to see which objects thread is executing and based on that i am increment the objects value. This is my code:</p>\n\n<pre><code>public void run()\n{\n    try{\n    for(int i=0;i&lt;100;i++)\n\n    {\n                System.out.println(Thread.currentThread().getName());\n        if(Thread.currentThread().getName() == \"HARE\")\n        {\n\n            hare++;\n            System.out.println(\"hare thread\");\n            Thread.sleep(100);\n            if(hare ==  49) \n            {\n                Thread.sleep(2000);\n            }   \n        }\n        if(Thread.currentThread().getName() == \"TURTLE\")\n        {\n            turtle++;\n            Thread.sleep(250);  \n        System.out.println(\"Turtle Thread\");\n\n        }\n</code></pre>\n\n<p>The problem is that even thought it detects the name of the thread accurately but it never goes inside the if block.\nP.S I am new to java multithreading.\nThank you for going through the code.</p>\n"},{"tags":["c++","linux","multithreading","gcc","c++11"],"answer_count":1,"favorite_count":7,"up_vote_count":18,"down_vote_count":0,"view_count":265,"score":18,"question_id":13106049,"title":"C++11: GCC 4.8 `thread_local` Performance Penalty?","body":"<p>From the <a href=\"http://gcc.gnu.org/gcc-4.8/changes.html#cxx\">GCC 4.8 draft changelog</a>:</p>\n\n<blockquote>\n  <p>G++ now implements the <a href=\"http://gcc.gnu.org/gcc-4.8/cxx0x_status.html\">C++11</a> <code>thread_local</code> keyword; this differs from\n  the GNU <code>__thread</code> keyword primarily in that it allows dynamic\n  initialization and destruction semantics. Unfortunately, this support\n  requires a run-time penalty for references to non-function-local\n  <code>thread_local</code> variables even if they don't need dynamic initialization,\n  so users may want to continue to use <code>__thread</code> for TLS variables with\n  static initialization semantics.</p>\n</blockquote>\n\n<p>What is precisely the nature and origin of this run-time penalty?</p>\n\n<p>Obviously to support non-function-local thread_local variables there needs to be a thread initialization phase before the entry to every thread main (just as there is a static initialization phase for global variables), but are they refering to some run-time penalty beyond that?</p>\n\n<p>Roughly speaking what is the architecture of gcc's new implementation of thread_local?</p>\n"},{"tags":["c++","multithreading","mpi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":132,"score":2,"question_id":13108937,"title":"MPI: How to start three functions which will be executed in different threads","body":"<p>I have 3 function and 4 cores. I want execute each function in new thread using MPI and C++\nI write this</p>\n\n<pre><code>int rank, size;\nMPI_Init(&amp;argc, &amp;argv);\nMPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);\nMPI_Comm_size(MPI_COMM_WORLD,&amp;size);\nsize--;\nif (rank == 0)\n{\n    Thread1();\n}\nelse \n{\n    if(rank == 1)\n    {\n        Thread2();\n    }\n    else\n    {\n        Thread3();\n    }\n}\nMPI_Finalize();\n</code></pre>\n\n<p>But it execute just Thread1(). How i must change code?</p>\n\n<p>Thanks!</p>\n"},{"tags":["multithreading","gui","qt4","embedded","assert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13008264,"title":"How to make an assert window in QT","body":"<p>I currently have a very long running GUI-Application in QT. Later that application is going to be tested and run on an embedded device without a keyboard in full screen.</p>\n\n<p>For easier debugging I have a custom assert macro, which allows me to ignore certain asserts (may include known buggy parts I have to work around for now) etc. For the time being I just print something on the console such as \"Assertion: XXXX failed; abort/ignore\". This is fine when I start the application within a console, but ultimately fails when I run it on the final device. In that case the assert will just block the main thread waiting for input and make the GUI hang badly without hope for recovery.</p>\n\n<p>Now I am thinking about how to remedy this situation. One Idea is to just have the assert crash, as the standard assert does. But I do not really like that Idea, since there are a lot of know problems, and I've always found ignorable asserts very helpful when testing applications. Also I would have to put the messages into a separate file, so I can later see what happened while testing. Reading these files afterwards is possible, but I would prefer a simpler way to find out what went wrong.</p>\n\n<p>The other idea was to make a window instead. However the asserts may be triggered in any thread and I can only create new windows in the GUI thread. Also the main event loop may be blocked by the assert, so I cannot be sure that it will handle the events correctly. I would somehow need a fully responsive stand-alone window in a separate thread, which only handles a few buttons.</p>\n\n<p>Is this somehow possible in QT4?</p>\n"},{"tags":["python","multithreading","pygtk"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13122984,"title":"Python&PyGTK: Transport data to threading","body":"<p>I would like to transfer data to threading class, but I can't get what is wrong. The code below is from this <a href=\"http://stackoverflow.com/questions/13108018/pythonpygtk-stop-while-on-button-click/13108681\">question</a> and I changed it a little.</p>\n\n<p>This is a code:</p>\n\n<pre><code>import gtk, gobject, threading, time\n\ngobject.threads_init()\n\nclass T(threading.Thread):\n    pause = threading.Event()\n    stop = False\n\n    def start(self, data, *args):\n        super(T, self).start()\n\n    def run(self, data):\n        while not self.stop:\n            self.pause.wait()\n            gobject.idle_add(lambda *a : self.rungui(data))\n            time.sleep(0.1)\n\n    def rungui(self, data):\n        print \"printed\"\n        print data\n\nthread = T()\n\nclass Start:\n\n        def toggle_thread(self, data=None, *args):\n                if not thread.is_alive():\n                    thread.start(data)\n                    thread.pause.set()\n                    self.button.set_label('Pause Thread')\n                    return\n\n                if thread.pause.is_set():\n                    thread.pause.clear()\n                    self.button.set_label('Resume Thread')\n                else:\n                    thread.pause.set()\n                    self.button.set_label('Pause Thread')\n\n        def __init__(self):\n                thread = T()\n                window = gtk.Window()\n                self.button = gtk.ToggleButton('Start Thread')\n                data = 3\n                self.button.connect('toggled', lambda *a : self.start(data), None)\n                window.add(self.button)\n                self.button.show()\n                window.show()\n\n        def start(self, data=None):\n                self.toggle_thread(data)\n\n        def main(self):\n                gtk.main()\n\nif __name__ == \"__main__\":\n        start = Start()\n        start.main()\n</code></pre>\n\n<p>What do I have to correct to get threading fully working?</p>\n"},{"tags":["c#","sql-server","multithreading","sockets","client"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":77,"score":3,"question_id":13121531,"title":"Multi Client Server - common way for 2 way connection in","body":"<p>I just want to know how the proper way of doing 2 way connection with one socket is (C#).</p>\n\n<p>I need the client sending and also receiving data from the server without to open the port on the client-pc / router.</p>\n\n<p>The server will be a multiplayer game server and the clients should not extra open a port to play the game.</p>\n\n<p>So does a simple socket connection work in 2 ways (server has a socket listener, and client connects to the server socket)?</p>\n\n<p>Hope that text pretty much explains my question.</p>\n"},{"tags":["c#","asp.net","multithreading","web-services","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13117007,"title":"Checking the database for new rows at regular intervals of time","body":"<p>I'm creating a web application in which I need to Check the Database in regular Intervals for any new rows Updated in the table. If any Rows have been updated and return the Rows to the user.</p>\n\n<p>When I refresh the Page I update the rows in my Website. But I need to Know If any new Rows have been added to the Table without refreshing the Page</p>\n\n<p>How can I achieve this ??\nCan you suggest me a Method (Probably which doesn't slow down the web site).</p>\n\n<p>Can I achieve this using web services??</p>\n"},{"tags":["objective-c","multithreading","grand-central-dispatch"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13111517,"title":"How Do I Make Sure That Dispatch Notify is Called at the Right Time","body":"<p>I have scenario where I have to iterate over a list of account numbers, go and fetch the detail information for these accounts and then pass the aggregated information to completionBlock. In order to facilitate this I'm using dispatch_group_* methods. Unfortunately, the completion block is being called <em>before</em> the group has finished even though I have explicitly called </p>\n\n<p><code>dispatch_group_wait(_imfDispatchGroup, DISPATCH_TIME_FOREVER);</code></p>\n\n<p>Example of console log (original):</p>\n\n<blockquote>\n  <p>2012-10-28 13:58:46.722 ThreadingHell[81909:303] inside loginResponse</p>\n  \n  <p>2012-10-28 13:58:46.724 ThreadingHell[81909:303] inside account loop\n  for obj: account1</p>\n  \n  <p>2012-10-28 13:58:46.724 ThreadingHell[81909:303] inside account loop\n  for obj: account2</p>\n  \n  <p>2012-10-28 13:58:46.724 ThreadingHell[81909:1b03] inside details:\n  L0i6kRVzGG details</p>\n  \n  <p>2012-10-28 13:58:46.724 ThreadingHell[81909:1a03] inside details:\n  SE0QjhO8Hh details</p>\n  \n  <p>2012-10-28 13:58:46.724 ThreadingHell[81909:303] inside account loop\n  for obj: account3</p>\n  \n  <p>2012-10-28 13:58:46.725 ThreadingHell[81909:1a03] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_015</p>\n  \n  <p>2012-10-28 13:58:46.725 ThreadingHell[81909:1803] inside details:\n  9SsGYOX3u5 details</p>\n  \n  <p>2012-10-28 13:58:46.725 ThreadingHell[81909:1a03] details are found\n  for account</p>\n  \n  <p>2012-10-28 13:58:46.725 ThreadingHell[81909:303] inside account loop\n  for obj: account4</p>\n  \n  <p>2012-10-28 13:58:46.725 ThreadingHell[81909:1b03] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_015</p>\n  \n  <p>2012-10-28 13:58:46.726 ThreadingHell[81909:1803] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_015</p>\n  \n  <p>2012-10-28 13:58:46.726 ThreadingHell[81909:303] inside account loop\n  for obj: acount5</p>\n  \n  <p>2012-10-28 13:58:46.726 ThreadingHell[81909:1a03] success account\n  looop</p>\n  \n  <p>2012-10-28 13:58:46.726 ThreadingHell[81909:1b03] details are found\n  for account</p>\n  \n  <p>2012-10-28 13:58:46.726 ThreadingHell[81909:2303] inside details:\n  wSXis5bIVs details</p>\n  \n  <p>2012-10-28 13:58:46.728 ThreadingHell[81909:1803] details are found\n  for account</p>\n  \n  <p>2012-10-28 13:58:46.728 ThreadingHell[81909:2403] inside details:\n  SrIfbzBLr7 details</p>\n  \n  <p>2012-10-28 13:58:46.728 ThreadingHell[81909:1a03] current instance of\n  accountDetails: (\n      \"L0i6kRVzGG details\" )</p>\n  \n  <p>2012-10-28 13:58:46.728 ThreadingHell[81909:1803] success account\n  looop</p>\n  \n  <p>2012-10-28 13:58:46.728 ThreadingHell[81909:1b03] success account\n  looop</p>\n  \n  <p>2012-10-28 13:58:46.729 ThreadingHell[81909:2403] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_015</p>\n  \n  <p>2012-10-28 13:58:46.729 ThreadingHell[81909:303] !!!!!!!!!! about to\n  call completion block. This should be last</p>\n  \n  <p>2012-10-28 13:58:46.729 ThreadingHell[81909:2303] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_015</p>\n  \n  <p>2012-10-28 13:58:46.730 ThreadingHell[81909:1803] current instance of\n  accountDetails: (\n      \"L0i6kRVzGG details\",\n      \"9SsGYOX3u5 details\" )</p>\n  \n  <p>2012-10-28 13:58:46.730 ThreadingHell[81909:1b03] current instance of\n  accountDetails: (\n      \"L0i6kRVzGG details\",\n      \"9SsGYOX3u5 details\",\n      \"SE0QjhO8Hh details\" )</p>\n  \n  <p>2012-10-28 13:58:46.731 ThreadingHell[81909:2403] details are found\n  for account</p>\n  \n  <p>2012-10-28 13:58:46.731 ThreadingHell[81909:2303] details are found\n  for account</p>\n  \n  <p>2012-10-28 13:58:46.732 ThreadingHell[81909:2403] success account\n  looop</p>\n  \n  <p>2012-10-28 13:58:46.731 ThreadingHell[81909:303] obj: { }</p>\n  \n  <p>2012-10-28 13:58:46.732 ThreadingHell[81909:2303] success account\n  looop</p>\n  \n  <p>2012-10-28 13:58:46.732 ThreadingHell[81909:303] error: (null)</p>\n  \n  <p>2012-10-28 13:58:46.732 ThreadingHell[81909:2403] current instance of\n  accountDetails: (\n      \"L0i6kRVzGG details\",\n      \"9SsGYOX3u5 details\",\n      \"SE0QjhO8Hh details\",\n      \"wSXis5bIVs details\" )</p>\n</blockquote>\n\n<p>// UPDATED LOG from latest commit [https://github.com/kwylez/ThreadingHell/tree/80cc29fab142b4dc1f386df747c5142b28e2dd84]</p>\n\n<blockquote>\n  <p>2012-10-28 16:32:38.984 ThreadingHell[83171:303] inside loginResponse\n  2012-10-28 16:32:38.987 ThreadingHell[83171:303] inside account loop\n  for obj: account1 2012-10-28 16:32:38.987 ThreadingHell[83171:303]\n  inside account loop for obj: account2 2012-10-28 16:32:38.987\n  ThreadingHell[83171:1b03] inside details: CP3ioYdvXp details\n  2012-10-28 16:32:38.987 ThreadingHell[83171:303] inside account loop\n  for obj: account3 2012-10-28 16:32:38.987 ThreadingHell[83171:1a03]\n  inside details: 6k635XoJOV details 2012-10-28 16:32:38.987\n  ThreadingHell[83171:1b03] inside completion for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_0\n  2012-10-28 16:32:38.988 ThreadingHell[83171:1a03] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_0\n  2012-10-28 16:32:38.988 ThreadingHell[83171:1b03] details are found\n  for account 2012-10-28 16:32:38.988 ThreadingHell[83171:303] inside\n  account loop for obj: account4 2012-10-28 16:32:38.988\n  ThreadingHell[83171:1803] inside details: 2TjGF1fdaZ details\n  2012-10-28 16:32:38.989 ThreadingHell[83171:1a03] details are found\n  for account 2012-10-28 16:32:38.990 ThreadingHell[83171:1b03] success\n  account looop 2012-10-28 16:32:38.991 ThreadingHell[83171:1b03]\n  current instance of accountDetails: (\n      \"CP3ioYdvXp details\" ) 2012-10-28 16:32:38.990 ThreadingHell[83171:303] inside account loop for obj: acount5\n  2012-10-28 16:32:38.990 ThreadingHell[83171:2303] inside details:\n  0YiuX9gHsu details 2012-10-28 16:32:38.990 ThreadingHell[83171:1a03]\n  success account looop 2012-10-28 16:32:38.990\n  ThreadingHell[83171:1803] inside completion for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_0\n  2012-10-28 16:32:38.992 ThreadingHell[83171:2303] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_0\n  2012-10-28 16:32:38.992 ThreadingHell[83171:1b03] inside details:\n  9RcyOfjRa5 details 2012-10-28 16:32:38.992 ThreadingHell[83171:1a03]\n  current instance of accountDetails: (\n      \"CP3ioYdvXp details\",\n      \"6k635XoJOV details\" ) 2012-10-28 16:32:38.992 ThreadingHell[83171:1803] details are found for account 2012-10-28\n  16:32:39.005 ThreadingHell[83171:1803] success account looop\n  2012-10-28 16:32:39.005 ThreadingHell[83171:1b03] inside completion\n  for __66-[ModelManager\n  getAccountDetailsForAccountNumber:completionBlock:]_block_invoke_0\n  2012-10-28 16:32:39.005 ThreadingHell[83171:2303] details are found\n  for account 2012-10-28 16:32:39.006 ThreadingHell[83171:1b03] details\n  are found for account 2012-10-28 16:32:39.006\n  ThreadingHell[83171:2303] success account looop 2012-10-28\n  16:32:39.006 ThreadingHell[83171:1803] current instance of\n  accountDetails: (\n      \"CP3ioYdvXp details\",\n      \"6k635XoJOV details\",\n      \"2TjGF1fdaZ details\" ) 2012-10-28 16:32:39.007 ThreadingHell[83171:1b03] success account looop 2012-10-28\n  16:32:39.007 ThreadingHell[83171:2303] current instance of\n  accountDetails: (\n      \"CP3ioYdvXp details\",\n      \"6k635XoJOV details\",\n      \"2TjGF1fdaZ details\",\n      \"0YiuX9gHsu details\" ) 2012-10-28 16:32:39.008 ThreadingHell[83171:1b03] current instance of accountDetails: (\n      \"CP3ioYdvXp details\",\n      \"6k635XoJOV details\",\n      \"2TjGF1fdaZ details\",\n      \"0YiuX9gHsu details\",\n      \"9RcyOfjRa5 details\" ) 2012-10-28 16:32:39.008 ThreadingHell[83171:303] !!!!!!!!!! about to call completion block.\n  This should be last 2012-10-28 16:32:39.009 ThreadingHell[83171:303]\n  obj: { } 2012-10-28 16:32:39.009 ThreadingHell[83171:303] error:\n  (null)</p>\n</blockquote>\n\n<p>What \"order of operation\" have I missed?</p>\n\n<p>Here is link to example project on github (code was too much to put here): </p>\n\n<p><a href=\"https://github.com/kwylez/ThreadingHell\" rel=\"nofollow\">https://github.com/kwylez/ThreadingHell</a></p>\n"},{"tags":["c#","multithreading","monotouch"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13116816,"title":"Asynchronous method?","body":"<p>I need to make webservice calls asynchronously in Monotouch, as the UIAlertView only shows up after work was done.</p>\n\n<p>Current code (pseudo)</p>\n\n<pre><code>Class LoginviewController\n{\n        void Login(credentials)  \n        {  \n            showAlert(\"Logging in\") ;   \n            bool authenticated = service.Authenticate(Credentials);  \n        }\n }       \n\n class Service\n {\n       Public bool Authenticate(object Credentials)\n       {\n          object[] results = this.Invoke(\"GetAuth\", Credentials)\n       }\n }\n</code></pre>\n\n<p>I am in the process of moving the Service methods to an async model, With Authenticate being made up of <code>BeginAuthenticate(), EndAuthenticate(), AuthenticateAsync(), OnAuthenticateOperationCompleted()</code> and of course <code>Authenticate()</code>.  </p>\n\n<p>When all of these have completed I need to run OnAuthenticateCompleted() on the LoginViewController, so I will use <code>BeginInvokeOnMainThread(delegate....</code>  </p>\n\n<p>This is where I get stuck.</p>\n\n<p>How do I get the method <code>OnAuthenticateCompleted()</code> in LoginViewController class instance executed from the services class?</p>\n\n<p>EDIT: Solution:</p>\n\n<p>Added a OnAuthenticateCompleted event handler that is hooked up in Login(), and called the AuthenticateAsync() method instead of Authenticate().  </p>\n\n<pre><code>Class LoginviewController\n    {\n            void Login(credentials)  \n            {  \n                showAlert(\"Logging in\") ;   \n                service.AuthenticateCompleted += new GetAuthenticationCompletedEventHandler(OnAuthenticateCompleted);\n                service.AuthenticateAsync(Credentials);  \n            }\n\n            public void OnAuthenticateCompleted(obj sender, GetAuthenticationCompletedEventArgs args)\n            {\n                bool authenticated = (bool)args.Results;\n                //do stuff\n                hideAlert();\n            }\n     }     \n</code></pre>\n"},{"tags":["python","multithreading","shell","wxpython","stdout"],"answer_count":4,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":899,"score":1,"question_id":4183404,"title":"multithreading issue with wx.TextCtrl (or underlying GTK+)","body":"<p>I am developing a GUI to launch an external long-term running background program. This background program can be given input command via stdin and use stdout and stderr to keep printing out output and error messages. I use a wx.TextCtrl object inside the GUI to give input and print output. My current code is as follows, which is mainly inspired by the \"how to implemente a shell GUI window\" post: <a href=\"http://stackoverflow.com/questions/989129/wxpython-how-to-create-a-bash-shell-window\">wxPython: how to create a bash shell window?</a>    </p>\n\n<p>However, my following code uses \"buffer previous output\" approach, i.e., I use a thread to buffer the output. The buffered transaction output could be only rendered when I give next input command and press \"return\" button. Now, I want to see the output messages timely, therefore I want to have the feature that \"the output can always be spontaneously printed out (directly flushed out) from the background subprocess and I could also interfere to type some input command via stdin and have the output printed.</p>\n\n<pre><code>class BashProcessThread(threading.Thread):\n    def __init__(self, readlineFunc):\n        threading.Thread.__init__(self)\n        self.readlineFunc = readlineFunc\n        self.lines = []\n        self.outputQueue = Queue.Queue()\n        self.setDaemon(True)\n\n    def run(self):\n        while True:\n           line = self.readlineFunc()\n           self.outputQueue.put(line)\n           if (line==\"\"):\n            break\n        return ''.join(self.lines)\n\n    def getOutput(self):\n        \"\"\" called from other thread \"\"\"            \n        while True:\n            try:\n                line = self.outputQueue.get_nowait()\n                lines.append(line)\n            except Queue.Empty:\n                break\n        return ''.join(self.lines)\n\nclass myFrame(wx.Frame):\n    def __init__(self, parent, externapp):\n        wx.Window.__init__(self, parent, -1, pos=wx.DefaultPosition)\n        self.textctrl = wx.TextCtrl(self, style=wx.TE_PROCESS_ENTER|wx.TE_MULTILINE)\n        launchcmd=[\"EXTERNAL_PROGRAM_EXE\"]\n        p = subprocess.Popen(launchcmd, stdin=subprocess.PIPE, \n                stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n        self.outputThread = BashProcessThread(p.stdout.readline)\n        self.outputThread.start()\n        self.__bind_events()         \n        self.Fit()\n\n    def __bind_events(self):\n        self.Bind(wx.EVT_TEXT_ENTER, self.__enter)\n\n    def __enter(self, e):\n        nl=self.textctrl.GetNumberOfLines()\n        ln =  self.textctrl.GetLineText(nl-1)\n        ln = ln[len(self.prompt):]     \n        self.externapp.sub_process.stdin.write(ln+\"\\n\")\n        time.sleep(.3)\n        self.textctrl.AppendText(self.outputThread.getOutput())\n</code></pre>\n\n<p>How should I modify the above code to achieve this? Do I still need to use thread? Can I code a thread as follows?</p>\n\n<pre><code>class PrintThread(threading.Thread):\n    def __init__(self, readlineFunc, tc):\n        threading.Thread.__init__(self)\n        self.readlineFunc = readlineFunc\n        self.textctrl=tc\n        self.setDaemon(True)\n\n    def run(self):\n        while True:\n            line = self.readlineFunc()\n            self.textctrl.AppendText(line)\n</code></pre>\n\n<p>However, when I tried with the above code, it crashes. </p>\n\n<p>I have errors from Gtk, as follows. </p>\n\n<pre><code>(python:13688): Gtk-CRITICAL **: gtk_text_layout_real_invalidate: assertion `layout-&gt;wrap_loop_count == 0' failed\nSegmentation fault\n</code></pre>\n\n<p>or sometimes the error</p>\n\n<pre><code> (python:20766): Gtk-CRITICAL **: gtk_text_buffer_get_iter_at_mark: assertion `GTK_IS_TEXT_MARK (mark)' failed\nSegmentation fault\n</code></pre>\n\n<p>or sometimes the error</p>\n\n<pre><code>(python:21257): Gtk-WARNING **: Invalid text buffer iterator: either the iterator is uninitialized, or the characters/pixbufs/widgets in the buffer have been modified since the iterator was created.\nYou must use marks, character numbers, or line numbers to preserve a position across buffer modifications.\nYou can apply tags and insert marks without invalidating your iterators,\nbut any mutation that affects 'indexable' buffer contents (contents that can be referred to by character offset)\nwill invalidate all outstanding iterators\nSegmentation fault\n</code></pre>\n\n<p>or sometimes the error</p>\n\n<pre><code>Gtk-ERROR **: file gtktextlayout.c: line 1113 (get_style): assertion failed: (layout-&gt;one_style_cache == NULL)\naborting...\nAborted\n</code></pre>\n\n<p>or other error message, but different error message each time, really weird!</p>\n\n<p>It seems the wx.TextCtrl or the underlying gui control of GTK+ has some problem with multi-threading. sometimes I do not type any input commands, it also crashes. I search from the certain post on the internet, and looks like it is dangerous to call a GUI control from a secondary thread. </p>\n\n<p>I found my mistake. As pointed out in <a href=\"http://stackoverflow.com/questions/1496092/wxpython-threads-and-window-events\">wxpython -- threads and window events</a> or in chapter 18 of the book \"WxPython in action\" by Noel and Robin:</p>\n\n<blockquote>\n  <p>The most important point is that GUI operations must take place in the main thread, or the one that the application loop is running in. Running GUI operations in a separate thread is a good way for your application to crash in unpredictable and hard-to-debug ways...</p>\n</blockquote>\n\n<p>My mistake is I tried to pass the <code>wx.TextCtrl</code> object to another thread. This is not right. I will reconsider my design.</p>\n"},{"tags":["multithreading","qt","signals"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13121310,"title":"Adding signal to custom Qthread","body":"<p>I´m trying to add a signal to my qthread, but I get an some errors: </p>\n\n<p>error: undefined reference to `vtable for RFDongleCommunication'</p>\n\n<p>error: undefined reference to `RFDongleCommunication::newLogger(unsigned char, unsigned char)'</p>\n\n<p>This is my header file:</p>\n\n<pre><code>#ifndef RFDONGLECOMMUNICATION_H\n#define RFDONGLECOMMUNICATION_H\n#include &lt;QThread&gt;\n#include \"qextserialport.h\"\n#include &lt;QtGui&gt;\n\nclass RFDongleCommunication: public QThread\n{\n    Q_OBJECT\n\npublic:\n    explicit RFDongleCommunication(QextSerialPort * port);\n\n    QextSerialPort * rfport;\n    QByteArray data;\n\nsignals:\n\n    void newLogger(uchar,uchar);\n\nprivate:\n\n    void run();\n\n};\n\n#endif // RFDONGLECOMMUNICATION_H\n</code></pre>\n\n<p>And the cpp file</p>\n\n<pre><code>#include \"rfdonglecommunication.h\"\n#include \"QDebug\"\n\nRFDongleCommunication::RFDongleCommunication(QextSerialPort * port)\n{\n    rfport=port;\n}\n\nvoid RFDongleCommunication::run()\n{\n    while(!(rfport-&gt;bytesAvailable()));\n    data = rfport-&gt;readAll();\n\n    uchar id = data[1];\n    uchar type = data[2];\n    emit newLogger(id,type); \n}\n</code></pre>\n\n<p>Does anybody see what I´m doing wrong?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":50,"score":3,"question_id":13120066,"title":"how to achieve the threadsafe without using the sychronization method or block?","body":"<p>can any body explain alternate way to acheve the threadsafe without using the synchronization at method level block level</p>\n\n<pre><code>public synchronized int disp()\n {\n\n  }\n\n\n\n or\n public int  disp()\n {\n  Synchronized\n   {}\n  }\n</code></pre>\n"},{"tags":["multithreading","selenium","webdriver","selenium2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13119592,"title":"How can we pause/resume WebDriver test execution on press of a button","body":"<p>I want to pause /resume my webdriver test case execution on press of a button.</p>\n\n<p>The way i come up is to use Thread class suspend and resume methods. But i want to make sure that it should not pause while webdriver is typing text or something. As if it will do the browser may loose the focus from that point. So i want to ensure atomic execution of element.sendKeys or element.click. </p>\n\n<p>Please suggest any ideas???</p>\n"},{"tags":["c++","multithreading","posix"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":13117790,"title":"Multithreaded matrix multiplication in C++","body":"<p>I've been having trouble with this parallel matrix multiplication code, I keep getting an error when trying to access a data member in my structure.</p>\n\n<p>This is my main function:</p>\n\n<pre><code>struct arg_struct\n{\n  int* arg1;\n  int* arg2;\n  int arg3;\n  int* arg4;\n};\n\n\nint main()\n{\n  pthread_t allthreads[4];\n  int A [N*N];\n  int B [N*N];\n  int C [N*N];\n  randomMatrix(A);\n  randomMatrix(B);\n  printMatrix(A);\n  printMatrix(B);\n  struct arg_struct *args = (arg_struct*)malloc(sizeof(struct arg_struct));\n  args.arg1 = A;\n  args.arg2 = B;\n  int x;\n  for (int i = 0; i &lt; 4; i++)\n  {\n     args.arg3 = i;\n     args.arg4 = C;\n     x = pthread_create(&amp;allthreads[i], NULL, &amp;matrixMultiplication, (void*)args); \n     if(x!=0)\n     exit(1);\n  }\n\n  return 0;\n}\n</code></pre>\n\n<p>and the matrixMultiplication method used from another C file:</p>\n\n<pre><code>void *matrixMultiplication(void* arguments)\n{\n     struct arg_struct* args = (struct arg_struct*) arguments;\n     int block = args.arg3;\n     int* A = args.arg1;\n     int* B = args.arg2;\n     int* C = args-&gt;arg4;\n     free(args);\n     int startln = getStartLineFromBlock(block);\n     int startcol = getStartColumnFromBlock(block);\n     for (int i = startln; i &lt; startln+(N/2); i++)\n     {\n        for (int j = startcol; j &lt; startcol+(N/2); j++)\n        {\n          setMatrixValue(C,0,i,j);\n          for(int k = 0; k &lt; N; k++)\n          {\n             C[i*N+j] += (getMatrixValue(A,i,k) * getMatrixValue(B,k,j));\n             usleep(1);\n          } \n        }\n     }\n}\n</code></pre>\n\n<p>Another error I am getting is when creating the thread: \"invalid conversion from ‘void (<em>)(int</em>, int*, int, int*)’ to ‘void* (<em>)(void</em>)’ [-fpermissive]\n\"</p>\n\n<p>Can anyone please tell me what I'm doing wrong?</p>\n"},{"tags":["c++","multithreading","directed-acyclic-graphs"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":9879387,"title":"How can I combine several functions in the form of a DAG at runtime","body":"<p>I have several classes that each subclass an Operator.\nAn Operator has several inputs and outputs, of various types: image, number, string.\nEach subclass implements a run() method that does the computation.\nNow I would like to design a container for these Operators, to make bigger Operators from the simple ones.\nThe container should be as efficient as possible, so I'm planning to use threads. I have found an example in the Boost graph library that allows me to compute the order in which I should do the computation: <a href=\"http://www.boost.org/doc/libs/1_49_0/libs/graph/doc/file_dependency_example.html\" rel=\"nofollow\">http://www.boost.org/doc/libs/1_49_0/libs/graph/doc/file_dependency_example.html</a> , but I think there may be an even better way to do this: each operator could wait in a blocked state until all of its inputs are ready.\nIt would be good if the container subclassed Operator, allowing to recursively combine them.\nI have a feeling this is a known design pattern.</p>\n"},{"tags":["java","multithreading","tcp","interrupt"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13118930,"title":"shutdown TCP thread server","body":"<p>I coded a little TCP thread Server, which creates a new thread for every server.accept(). Nearly everything works great, but I have problems to kill all threads per interrupt. (I use a ServiceExecutor to manage the threads. Therefore I use the shutdownNow method to reach the interrupt-methods) The Worker-instances use a BufferedReader and it's readline-method to receive and compute the input. AFAIK the <strong>readline blocks</strong> and <em>would not react on an interrupt</em>, but how to stop it? </p>\n\n<pre><code>while(!isInterrupted()){\n\n   try {\n          clientSocket = this.serverSocket.accept();\n        } catch(IOException e){\n            break;\n        }\n\n        this.threadPool.execute(new ThreadWorker(clientSocket));\n    }\n\n    threadPool.shutdownNow();\n\n    try{\n        serverSocket.close();\n    }catch(IOException e){\n        //todo\n    }\n</code></pre>\n\n<p>I tried to close the ServerSocket to kill the Input/Output Streams, but it didn't work as expected.</p>\n"},{"tags":["java","multithreading","concurrency","concurrenthashmap"],"answer_count":8,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":163,"score":6,"question_id":12483487,"title":"Is this code a thread-safe one?","body":"<p>I want to process a flow of client requests. Each request has its special type. First I need to initialize some data for that type, and after this I can start processing the requests. When the client type comes for the first time, I just initialize the corresponding data. After this all the following requests of that type are processed using that data. </p>\n\n<p>I need to do this in a thread-safe manner.</p>\n\n<p>Here is a code I have written. Is it thread-safe?</p>\n\n<pre><code>public class Test {\n\n    private static Map&lt;Integer, Object&gt; clientTypesInitiated = new ConcurrentHashMap&lt;Integer, Object&gt;();\n\n    /* to process client request we need to \n    create corresponding client type data.\n    on the first signal we create that data, \n    on the second - we process the request*/\n\n    void onClientRequestReceived(int clientTypeIndex) {\n        if (clientTypesInitiated.put(clientTypeIndex, \"\") == null) {\n            //new client type index arrived, this type was never processed\n            //process data for that client type and put it into the map of types\n            Object clientTypeData = createClientTypeData(clientTypeIndex);\n            clientTypesInitiated.put(clientTypeIndex, clientTypeData);\n        } else {\n            //already existing index - we already have results and we can use them\n            processClientUsingClientTypeData(clientTypesInitiated.get(clientTypeIndex));\n        }\n    }\n\n    Object createClientTypeData(int clientIndex) {return new Object();}\n\n    void processClientUsingClientTypeData(Object clientTypeData) {}\n}\n</code></pre>\n\n<p>From one hand, ConcurrentHashMap cannot produce map.put(A,B) == null two times for the same A. \nFrom the other hand, the assignment and comparisson operation is not thread-safe. </p>\n\n<p>So is this code is ok?\nIf not, how can I fix it?</p>\n\n<p>UPDATE:\nI have accepted the answer of Martin Serrano because his code is thread-safe and it is not prone to double initialization issue. But I would like to note, that I have not found any isssues with my version, posted as an answer below, and my version does not require synchronization.</p>\n"},{"tags":["c#","multithreading","backgroundworker","threadpool","download-manager"],"answer_count":4,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":1036,"score":5,"question_id":6913487,"title":"C# Downloader: should I use Threads, BackgroundWorker or ThreadPool?","body":"<p>I'm writing a downloader in C# and stopped at the following problem: what kind of method should I use to parallelize my downloads and update my GUI?</p>\n\n<p>In my first attempt, I used 4 Threads and at the completion of each of them I started another one: main problem was that my cpu goes 100% at each new thread start.</p>\n\n<p>Googling around, I found the existence of BackgroundWorker and ThreadPool: stating that I want to update my GUI with the progress of each link that I'm downloading, what is the best solution?</p>\n\n<p>1) Creating 4 different BackgroundWorker, attaching to each ProgressChanged event a Delegate to a function in my GUI to update the progress?</p>\n\n<p>2) Use ThreadPool and setting max and min number of threads to the same value?</p>\n\n<p>If I choose #2, when there are no more threads in the queue, does it stop the 4 working threads? Does it suspend them? Since I have to download different lists of links (20 links each of them) and move from one to another when one is completed, does the ThreadPool start and stop threads between each list?</p>\n\n<p>If I want to change the number of working threads on live and decide to use ThreadPool, changing from 10 threads to 6, does it throw and exception and stop 4 random threads?</p>\n\n<p>This is the only part that is giving me an headache.\nI thank each of you in advance for your answers.</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13119202,"title":"C# Pause/Kill/Stop/Abort a thread","body":"<p>I know there a lot of questions about this, but neither one of them worked with me.\nSo the problem is that I have a thread that is reading some MODBUS devices and I want to be able to start/stop the reading. When connect is chosen I start the thread and when disconnect is chosen I abort the thread. When I start the aborted thread I receive the following excepton:</p>\n\n<blockquote>\n  <p>System.Threading.ThreadStateException: Thread has already been started.\n      at (wrapper managed-to-native) System.Threading.Thread:Thread_internal\n      (System.Threading.Thread,System.MulticastDelegate)\n      at System.Threading.Thread.Start () [0x00000] in :0 \n      at Vyshka.MainClass.Main (System.String[] args) [0x00096] in /home/Vyshka/Main.cs:53 </p>\n</blockquote>\n"},{"tags":["android","multithreading","android-asynctask","android-ui","android-handler"],"answer_count":2,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":66,"score":3,"question_id":13117183,"title":"Why use AsyncTaskLoader with LoaderManager, instead of simple Handler?","body":"<p>Running asynchronous tasks off of the UI thread then modifying the UI is a common issue in android development, so I decided to take some time, research, and play around with different techniques and find what works best for me.</p>\n\n<p>What I considered important factors:</p>\n\n<ul>\n<li>Should work reliably</li>\n<li>Code readability</li>\n<li><code>Activity</code> or <code>Fragment</code> should be kept clean of as much of thread management as possible</li>\n</ul>\n\n<p>Here is the summary of my impressions (which may be wrong and some are just opinions) about the various methods:</p>\n\n<h2>AsyncTask</h2>\n\n<p>I was using simple <code>AsyncTask</code> without <code>LoaderManager</code> when I first jumped into Android:</p>\n\n<ul>\n<li>Had intermittent issues, I wrote my own <code>AsyncTaskManager</code> to manage them with the activity life cycle.</li>\n<li>There are some limitations to number of tasks and memory leaks have been reported before.</li>\n<li>Biggest issue with these was that they made my code extremely convoluted, and simplifying the code defeated the purpose of using them in the first place.</li>\n</ul>\n\n<h2>AsyncTaskLoader with LoaderManager</h2>\n\n<p>This seems to be the <strong>recommended</strong> way to do this, so I researched it a bit:</p>\n\n<ul>\n<li>After reading about these a bit, it seems the main reason this method is recommended is because it manages the tasks with the <code>Fragment</code> life cycle, and from my understanding basically just restarts the tasks if necessary. It doesn't seem to be able to receive the results of a task started before an activity was restarted after the activity restarts.</li>\n<li>All the task parameters seem to have to be <code>Parcelable</code> or <code>Serialiazable</code> to go into a <code>Bundle</code> object.</li>\n</ul>\n\n<h2>Handler, Threads, with Messages</h2>\n\n<p>This is the method I settled on:</p>\n\n<ul>\n<li>Easy to implement, extremely customizable.</li>\n<li>You get access to the thread executing the task: set priority, set thread name for debugging, set daemon, and etc.</li>\n<li>Seems much more responsive than with using AsyncTasks, based on an eye test where I click a button a lot of times and watch the results and threads flash by ;) I could benchmark this.</li>\n<li>To handle life cycle issues, can write a singleton class that manages messages (persists while the process is alive). Stores them when a given activity's handler is not set up, then forwards them to the activity handler if it asks for its missed messages. Meaning a task doesn't have to restart with the same parameters, which can be critical for tasks that are non-idempotent.</li>\n</ul>\n\n<hr>\n\n<p>So I came to the conclusion that using <code>Handler</code>, <code>Threads</code>, and <code>Messages</code> is a much better solution, but I'm convinced I'm missing something because nearly everywhere I looked the recommendation was to use the <code>AsyncTaskLoader</code> method. What am I missing?</p>\n\n<p>Thanks for the input. </p>\n"},{"tags":["wpf","multithreading","winapi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":10102757,"title":"What is alternative to C# WPF Dispatcher.Invoke(...) when using C function pointers and hooks?","body":"<p>How can do the same thing as C# WPF Dispatcher.Invoke(...) does in terms of C function pointers and Winapi hooks/messages?</p>\n\n<p>I want ask Windows C message loop to invoke my function pointer. I PostThreadMessage user defined message(WM_USER+XXX) from worker thread and invoke function  pointer in WH_GETMESSAGE hook. But seems my message is not handled or arrived to hook. Standard messages I post DO.</p>\n"},{"tags":["multithreading","process","pid"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13118392,"title":"unknown process listed in top -H","body":"<p>When I run \"top -H\" on my system, I get an unnamed entry with a hex(0x2ddd7f7c).\nI got the pid value and tried to check if its listed in \"/proc\". It wasn't listed. But surprisingly, I was able to \"cd\" to it. When and how is this possible? How do I find out what process/thread this is? I tried to do check the \"/proc//exe\", it points to another application of mine.</p>\n"},{"tags":["c","multithreading","synchronization","pthreads","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":13069970,"title":"Multiple producer single consumer with Circular Buffer","body":"<p>Need help in getting the following to work.</p>\n\n<p>I have a multiple producer threads (each writing say 100 bytes of data) to ringbuffer.\nAnd one single reader(consumer) thread ,reads 100 bytes at a time and writes to stdout.(Finally i want to write to files based on the data)</p>\n\n<p>With this implementation ,I get the data read from ring buffer wrong sometimes. see below \nSince the ringbuffer size is small it becomes full and some part of data is loss.This is not my current problem. </p>\n\n<blockquote>\n  <p>** Questions:</p>\n</blockquote>\n\n<ol>\n<li>On printing the data thats read from ringbuffer ,some data gets\ninterchanged !!I'm unable to find the bug.  </li>\n<li>Is the logic/approach correct ? (or) Is there a\nbetter way to do this</li>\n</ol>\n\n<blockquote>\n  <p><strong>ringbuffer.h</strong></p>\n</blockquote>\n\n<pre><code>#define RING_BUFFER_SIZE  500\nstruct ringbuffer\n{\n    char *buffer;\n    int wr_pointer;\n    int rd_pointer;\n    int size;\n    int fill_count;\n};\n</code></pre>\n\n<blockquote>\n  <p><strong>ringbuffer.c</strong></p>\n</blockquote>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt; \n#include &lt;string.h&gt;\n#include \"ringbuffer.h\"\n\nint init_ringbuffer(char *rbuffer, struct ringbuffer *rb, size_t size)\n{\n    rb-&gt;buffer = rbuffer;\n    rb-&gt;size = size;\n        rb-&gt;rd_pointer = 0;\n        rb-&gt;wr_pointer = 0; \n        rb-&gt;fill_count = 0;\n    return 0;\n}\n\nint rb_get_free_space (struct ringbuffer *rb)\n{ \n    return (rb-&gt;size -  rb-&gt;fill_count);\n}\n\nint rb_write (struct ringbuffer *rb, unsigned char * buf, int len)\n{\n    int availableSpace;\n    int i;\n\n    availableSpace = rb_get_free_space(rb);\n    printf(\"In Write AVAIL SPC=%d\\n\",availableSpace);\n    /* Check if Ring Buffer is FULL */\n    if(len &gt; availableSpace)\n    {\n       printf(\"NO SPACE TO WRITE - RETURN\\n\");\n       return -1;\n    }\n\n    i = rb-&gt;wr_pointer;\n    if(i == rb-&gt;size) //At the end of Buffer \n    {\n       i = 0;\n    }    \n    else if (i + len &gt; rb-&gt;size)\n    {\n        memcpy(rb-&gt;buffer + i, buf, rb-&gt;size - i);\n        buf += rb-&gt;size - i;\n        len = len - (rb-&gt;size - i);\n        rb-&gt;fill_count += len;\n        i = 0;\n    }\n    memcpy(rb-&gt;buffer + i, buf, len);\n    rb-&gt;wr_pointer = i + len;\n    rb-&gt;fill_count += len;\n\n    printf(\"w...rb-&gt;write=%tx\\n\", rb-&gt;wr_pointer );\n    printf(\"w...rb-&gt;read=%tx\\n\", rb-&gt;rd_pointer );\n    printf(\"w...rb-&gt;fill_count=%d\\n\", rb-&gt;fill_count );\n    return 0;\n}\n\nint rb_read (struct ringbuffer *rb, unsigned char * buf, int max)\n{\n    int i;\n\n    printf(\"In Read,Current DATA size in RB=%d\\n\",rb-&gt;fill_count);\n    /* Check if Ring Buffer is EMPTY */\n    if(max &gt; rb-&gt;fill_count) \n    {\n      printf(\"In Read, RB EMPTY - RETURN\\n\");\n      return  -1; \n    }  \n\n    i = rb-&gt;rd_pointer;\n    if (i == rb-&gt;size)\n    {\n       i = 0;\n    }\n    else if(i + max &gt; rb-&gt;size)\n    {\n        memcpy(buf, rb-&gt;buffer + i, rb-&gt;size - i);\n        buf += rb-&gt;size - i;\n        max = max - (rb-&gt;size - i);\n        rb-&gt;fill_count -= max;\n        i = 0;\n    }\n    memcpy(buf, rb-&gt;buffer + i, max);\n    rb-&gt;rd_pointer = i + max;\n    rb-&gt;fill_count -= max;\n\n    printf(\"r...rb-&gt;write=%tx\\n\", rb-&gt;wr_pointer );\n    printf(\"r...rb-&gt;read=%tx\\n\", rb-&gt;rd_pointer );\n    printf(\"DATA READ ---&gt; %s\\n\",(char *)buf);\n    printf(\"r...rb-&gt;fill_count=%d\\n\", rb-&gt;fill_count );\n    return 0;\n}\n</code></pre>\n"},{"tags":["c++","multithreading","boost","interrupt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13104040,"title":"How can I pause/interrupt boost::thread within another thread?","body":"<pre><code>void workerFunc()  //first thread\n{  \n    for (int x=0;x&lt;30;x++) //count up to 29\n    {\n        cout &lt;&lt; x &lt;&lt; endl;\n        Sleep(1000); //one sec delay\n    }\n}    \n\nvoid test()   //second thread\n{\n    for (int y=30;y&lt;99;y++)  //count up to 98\n    {\n        cout &lt;&lt;'\\t'&lt;&lt; y &lt;&lt; endl;        \n        Sleep (1000); //delay one sec\n    }\n}\n\nint main(int argc, char* argv[])   \n{  \n    cout &lt;&lt; \"Main started \" &lt;&lt; endl; \n    boost::thread workerThread(workerFunc);    //start the 1st thread\n    boost::thread t1(test); //start the second thread\n    cin.get();     \n    return 0;  \n}\n</code></pre>\n\n<p>Hi, When the thread for <code>test()</code> with y=35, I want to pause/interrupt the thread in       <code>workerFunc()</code> within thread for <code>test()</code></p>\n\n<p>How can I achieve this? </p>\n"},{"tags":["iphone","objective-c","ios","multithreading","cocoa-touch"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13082219,"title":"Value of int variable doesn't change in the timer loop","body":"<p>I have the following code in a method</p>\n\n<pre><code>for(i=0; i&lt;count;i++){\n        self.deltaFlag = 0;\n        thumbNail = [moviePlayer thumbnailImageAtTime:12 timeOption:MPMovieTimeOptionNearestKeyFrame];\n        self.deltaFlag =1;\n        }\n</code></pre>\n\n<p>(assume value of <code>moviePlayer</code> changes in every iteration of the loop)</p>\n\n<p>Generating the thumbnail takes some time so this is when my progress bar should increase in value. but even though i set <code>deltaFlag</code> to 1. It is never 1 in the loop method which. What might be going wrong? I though it might be something to do with threads. But don't know how to get around the problem. \nHere is the code that instantiates the timer: </p>\n\n<pre><code>NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:.02 target:self selector:@selector(tick:) userInfo:nil repeats:YES];\n[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];\n</code></pre>\n\n<p>And here is the method <code>tick:</code>\nThis is the method where I am not able to get the right value of <code>deltaFlag</code>.</p>\n\n<pre><code>- (void)tick:(NSTimer *)timer {\n\n\n    CGFloat delta =  .01/12;\n\n    static CGFloat p = 0.00;\n\n    if (self.deltaFlag==0 &amp;&amp; p&lt;=segments) {\n        p += delta;\n        [hud setProgress:p];\n    }\n    else{   \n        p=segments;\n    }\n\n    if (segments &gt;= .99) {\n        p = .99;\n        [timer invalidate];\n        [hud setProgress:0];\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":167,"score":8,"question_id":13117849,"title":"Is a static final char[] thread safe?","body":"<p>So if I have</p>\n\n<pre><code>private static final char[] SOME_CHARS;\n</code></pre>\n\n<p>Is that thread safe? By that I mean if I have multiple threads referring to the chars in that array (but not changing them), will anything go wrong?</p>\n\n<p>e.g. </p>\n\n<pre><code>private class someThread extends Thread(){\n\n\n   public void run(){\n     for(int i = 0; i &lt; someIndexInSomeChars;i++){\n        System.out.println(SOME_CHARS[i]);\n     }\n}\n</code></pre>\n\n<p>In other words do I need to put the char[] into some sort of Java collection with thread support?</p>\n"},{"tags":["iphone","ios","multithreading","nsrunloop"],"answer_count":1,"favorite_count":9,"up_vote_count":12,"down_vote_count":0,"view_count":3723,"score":12,"question_id":7222449,"title":"NSDefaultRunLoopMode vs NSRunLoopCommonModes","body":"<p>Dear good people of stackoverflow, </p>\n\n<p>Just like the last time, I hereby bring up a question I recently tumble upon. I hope someone out there could shed some light on me.</p>\n\n<p>Whenever I try to download a big file behind scrollview, mkmapview or something, the downloading process gets halted as soon as I touch iPhone screen. Thankfully, an awesome blog post by <a href=\"http://www.pixeldock.com/blog/how-to-avoid-blocked-downloads-during-scrolling/\">Jörn</a> suggests an alternative option, using NSRunLoopCommonModes for connection. </p>\n\n<p>That gets me look into detail of the two modes, NSDefaultRunLoopMode and NSRunLoopCommonModes, but the apple document does not kindly explain, other than saying</p>\n\n<p>NSDefaultRunLoopMode</p>\n\n<blockquote>\n  <p>The mode to deal with input sources other than NSConnection objects.\n  This is the most commonly used run-loop mode.</p>\n</blockquote>\n\n<p>NSRunLoopCommonModes</p>\n\n<blockquote>\n  <p>Objects added to a run loop using this value as the mode are monitored by all run loop modes that have been declared as a member of the set of “common\" modes; see the description of CFRunLoopAddCommonMode for details.</p>\n</blockquote>\n\n<p>CFRunLoopAddCommonMode</p>\n\n<blockquote>\n  <p>Sources, timers, and observers get registered to one or more run loop modes and only run when the run loop is running in one of those modes. Common modes are a set of run loop modes for which you can define a set of sources, timers, and observers that are shared by these modes. Instead of registering a source, for example, to each specific run loop mode, you can register it once to the run loop’s common pseudo-mode and it will be automatically registered in each run loop mode in the common mode set. Likewise, when a mode is added to the set of common modes, any sources, timers, or observers already registered to the common pseudo-mode are added to the newly added common mode.</p>\n</blockquote>\n\n<p>Can anyone please explain the two in human language? </p>\n"},{"tags":["c#","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13115852,"title":"Is there any elegant way to cancel/stop a long running thread?","body":"<p>I know about CancellationToken support in TPL, but (IMO) that could work only if I have appropriate token.ThrowifCancellationRequested(), which is not possible in my scenario.</p>\n\n<p>Is there any other elegant way (other than aborting the thread altogether) to achieve this?</p>\n\n<p>I do not care about the transactional state of the thread.\nI do not care at what state the thread is stopped/cancelled.</p>\n\n<p>Thanks for your interest!</p>\n\n<p>More Details:\nI need to spawn a new thread (Task/Threadpool/Thread) to call an API which calls multiple stored procedures to fetch near 1million records, and then it does some decoration (business calculation) on each of the records.\nIn the end, this API returns a data table which is a business significant report.\nI want to give the users the option to cancel this processing mid-way, if needed. For instance, if wrong of set of filters are set.\nThe API <em>only</em> does the read-only operations, so no transaction management is required.</p>\n"},{"tags":["iphone","xcode","multithreading","uiwebview","background"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13114685,"title":"how can I use UIWebview as always working on background","body":"<p>I would like to set <code>UIWebview</code> always running on background.\n<code>UIWebview</code> is not working when iPhone entered '<code>applicationDidEnterBackground</code>'.\nso I want <code>UIWebview</code> to run always on backgroud.\nIs it possible?</p>\n"},{"tags":["asp.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13116751,"title":"asp.net with Multiple thread using lock method","body":"<p>In that code i want to use Lock(this) method with using multiple thread in asp.net how to use it please explain me .   I want to use multiple thread in it method so please </p>\n\n<pre><code>    try\n    {\n\n        List&lt;spEMS_MailSentSchedularListResult&gt; dSchedularResult = ESManager.SendSchedularList();\n        if (dSchedularResult != null)\n        {\n</code></pre>\n\n<p>// Here I want to Lock method so can you please explain for that </p>\n\n<pre><code>            for (int i = 0; i &lt; dSchedularResult.Count; i++)\n            {\n                try\n                {\n                    string strBody = \"\";\n\n                    #region Creating STRBODY\n                    strBody = AppConstant.MAIN_DIV_TAG_START + AppConstant.MAIN_TABLE_TAG_START_BGCOLOR.ToString() +\n\n                                AppConstant.MAIN_TABLE_TR_TD_START_ALIGNMENT.ToString() +\n\n                                AppConstant.MAIN_TABLE_TR_TD_END.ToString();\n                    #endregion\n\n\n                }\n                catch (Exception ex)\n                {\n                    Page_Error(ex);\n                }\n            }\n        }\n    }\n    catch (Exception ex)\n    {\n        Page_Error(ex);\n    }\n    finally\n    {\n        ESManager = null;\n    }\n}\n</code></pre>\n\n<p>Now i hanve mentioned about where the code of lock is creating please Give me positive reply Thanks... </p>\n"},{"tags":["objective-c","multithreading","ios","nsautoreleasepool"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1838,"score":2,"question_id":4785621,"title":"iOS autoreleased with no pool in place - but I am creating ARP!","body":"<p>So, I am using [NSThread detachNewThreadSelector] to spawn a new thread and I am getting \"autoreleased with no pool in place \" errors in the console. I know this can happen if you fail to create an auto release pool, but the thing is, I am creating one. I use similar code in other parts of the same app and do NOT get these errors.</p>\n\n<p>Here is the relevant code: </p>\n\n<pre><code>- (void) startThread:(NSString*)strURL\n{\n    // start new thread to load image\n    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n    [NSThread detachNewThreadSelector:@selector(loadImageFromURL:) toTarget:self withObject:strURL];\n    [pool release];\n}\n\n- (void) loadImageFromURL:(NSString*)strURL\n{\n    NSNumber* nn = [NSNumber numberWithInt:self.tag];\n    NSLog(@\"loadURL: Tag number == %i\", [nn intValue]);\n\n   // other code here actually does the work\n}\n</code></pre>\n\n<p>Now, there was more code in loadImageFromURL which actually does the work (of loading an image from a remote server) - but the problem manifests itself without that code, so I've removed it (just so you don't think I have a pointless thread which does nothing!). I left in just one line of code which demonstrates the problem - it creates an autoreleased NSNumber object.</p>\n\n<p>When this code runs, it reports this to the console:</p>\n\n<p><code>__NSAutoreleaseNoPool(): Object 0x535c0e0 of class NSCFNumber autoreleased with no pool in place - just leaking</code></p>\n\n<p>Of course, the real code creates many other AR objects and all of them get reported as well.</p>\n\n<p>Would be grateful for any tips or pointers which might help! </p>\n\n<p>Thanks! </p>\n"},{"tags":["multithreading","signals","semaphore"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13116436,"title":"producer/consumer","body":"<p>This is an example for an unbounded producers/consumers:</p>\n\n<pre><code>conditionvar *cv;\nlock *lk;\nint avail=0;\n\n/* producer */\nwhile(1){\nacquire(lk);\n/* produce next */\navail ++;\nsignal (cv, lk);\nrelease(lk);\n}\n\n/* consumer */\nwhile(1){\nacquire(lk);\nif(avail==0)\nwait(cv,lk);\n/* consume next */\navail --;\nrelease(lk);\n}\n</code></pre>\n\n<p>If I want to make this a bounded solution, would the steps be to have the producer fill the buffer until its full, while the consumer is locked, then once the buffer is filled, lock the producer and unlock the consumer until the buffer is one item from being empty, then lock it and have the producer start?</p>\n"},{"tags":["java","multithreading","callback","threadpool","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13116192,"title":"Java set a callback from ExecutorService","body":"<p>I have a fixedThreadPool that I am using to run a bunch of worker threads to achieve parallel execution of a task with many components.</p>\n\n<p>When all threads have finished, I retrieve their results (which are quite large) using a method (getResult) and write them to a file. </p>\n\n<p>Ultimately, to save memory and be able to see intermediate results, I'd like each thread to write its result to the file as soon as it finishes execution and then free its memory.</p>\n\n<p>Ordinarily, I'd add code to that effect to the end of the run() method. However, certain other objects in this class also calls these threads, but DO NOT want them to write their results to file - instead they use their results to perform other calculations, which are eventually written to file.</p>\n\n<p>So, I was wondering if it's possible to attach a callback function to the event of a thread finishing using the ExecutorService. That way, I can immediately retrieve its result and free the memory in that scenario, but not break the code when those threads are used in other scenarios.</p>\n\n<p>Is such a thing possible?</p>\n"},{"tags":["c++","c","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13115989,"title":"Daemonizing Multithreaded Server","body":"<p>I am writing a multithreaded web server which has to run in daemon mode.I have written the code but the program gets crashed when run in daemon mode. If I don't include the code for daemonizing the server, the program is running fine. Can anybody tell me where I am going wrong?</p>\n\n<pre><code>pid_t pid,cid;\npid = fork();\nif(pid&lt;0)\n{\nexit(EXIT_FAILURE);\n }\nif(pid&gt;0)\n{\n    exit(EXIT_SUCCESS);\n }\numask(0);\ncid=setsid();\nstd::cout&lt;&lt;\"Process id after:\"&lt;&lt;pid&lt;&lt;std::endl;\nstd::cout&lt;&lt;\"Session id:\"&lt;&lt;cid&lt;&lt;std::endl;\nclose(STDIN_FILENO);\nclose(STDOUT_FILENO);\nclose(STDERR_FILENO);\n\npthread_t t1,t2;\npthread_t threads[threadnum];\npthread_attr_t attr;\nif ((s = socket(AF_INET, soctype, 0)) &lt; 0) {\n    perror(\"socket\");\n    exit(1);\n}\npthread_attr_init(&amp;attr);\npthread_create(&amp;t1,NULL,setup_server,NULL);  // thread for accepting the requests\npthread_create(&amp;t2,NULL,scheduler,NULL);     // thread for scheduling the requests\n</code></pre>\n"},{"tags":["multithreading","r","class","parallel-processing","s4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13111003,"title":"Make parallel clusters within a S4 class","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13002200/s4-classes-multiple-types-per-slot\">S4 Classes: Multiple types per slot</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to make my first R package.\nI plan to create a S4 class \"test\" that contains data and some methods to process data.\nIn my case, the processing of data can be improved by multi-threading.\nI have tested <code>parLapply()</code> and it increases performance.</p>\n\n<p>The problem is that I do not want to call:</p>\n\n<pre><code>cl &lt;- makeCluster(N)\nparLapply(cl, x, FUN, ...)\nstopCluster(cl)\n</code></pre>\n\n<p>in each method I want to make parallel. This is because it is not elegant and, I presume, the repeated creation (and destruction) of the teams of thread costs.</p>\n\n<p>Therefore, I was thinking about (simply) having a <code>cluster</code> object within my class \"test\".\nThen I could, for instance, make a \"test\" object \"o\" and call a method of \"test\" <code>setNumbrOfThreads(o) &lt;- 4</code>.</p>\n\n<p>However, I have trouble with the implementation. Since <code>?makeCluster()</code> states the return value is '''An object of class 'c(\"SOCKcluster\", \"cluster\")''', I have tried :</p>\n\n<pre><code>setClass(\"test\",\n    representation(\n        data = \"list\",\n        nThreads = \"numeric\",\n        cluster = c(\"SOCKcluster\", \"cluster\") #This seems incorrect\n    ),\n    prototype(\n        data = NULL,\n        nThreads = 1,\n        cluster = makeCluster(1) # \"cluster = NULL\" does not help\n    )\n) \n</code></pre>\n\n<p>R complained that <code>element 3 of the representation was not a single character string\n</code>.\nSo I tried without more success: <code>cluster = \"cluster\"</code> or <code>cluster = \"SOCKcluster\"</code> (in representation).</p>\n\n<p>My question is:</p>\n\n<p><strong>How can I can I create an S4 class with a member object of class c(\"SOCKcluster\", \"cluster\") ?</strong></p>\n\n<p>Thank you,</p>\n"},{"tags":["java","multithreading","udp"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13115115,"title":"UDP - Multithreading","body":"<p>Basically, I have a graphical swing application. I need to use UDP to send and receive data, but I don't want any receive(packet) calls in the application's code. I decided to run the receiving end of the program on a separate thread. The thread has an int field that gets updated to the value from incoming packets. How would I get the value of this field from the thread. Can I just call the get method for the field, or do I have to interrupt the thread first?</p>\n"},{"tags":["android","xml","multithreading","android-3.0"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":650,"score":1,"question_id":6863994,"title":"Android 3.1 Xml Parsing NullPointerException","body":"<p>I have code written for Android 2.2 that is supposed to parse xml from a webpage to a String. It works fine on an Android 2.2 emulator, but it gives me a NullPointerException on my Android 3.1 tablet. Here is the code:</p>\n\n<pre><code>Log.d(\"refreshMeta\", \"refreshing meta.\");\n            url = new URL(\"http://www.chineseoutreach.ca/media/Cstreaming.xml\");\n            URLConnection connection;\n            connection = url.openConnection();\n\n            HttpURLConnection httpConnection = (HttpURLConnection)connection;\n            int responseCode = httpConnection.getResponseCode();\n\n            if (responseCode == HttpURLConnection.HTTP_OK) {\n                InputStream in = httpConnection.getInputStream();\n                Log.d(\"Connection\",\"connected\");\n                DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n                DocumentBuilder db = dbf.newDocumentBuilder();\n\n                Document dom = db.parse(in);\n                Element docEle = dom.getDocumentElement();\n                NodeList nl = docEle.getElementsByTagName(\"nowplaying\");\n                Element entry = (Element)nl.item(0);\n\n                try {\n                    Element eartist = (Element)entry.getElementsByTagName(\"artist\").item(0);\n                sartist = eartist.getFirstChild().getNodeValue();\n                Log.d(\"Artist\",sartist);\n                }\n                catch(NullPointerException e) {\n                    sartist = \"\";\n                    Log.d(\"Connection\",e.toString());\n                }\n</code></pre>\n\n<p>Log on Android 3: </p>\n\n<p>refreshmeta: refreshing meta.</p>\n\n<p>Connection: Connected </p>\n\n<p>Connection: java.lang.NullPointerException</p>\n\n<p>EDIT\nThis is the line that causes it. \nElement eartist = (Element)entry.getElementsByTagName(\"artist\").item(0);</p>\n\n<p>Edit 2</p>\n\n<p>07-28 13:10:01.483: ERROR/Null(6189): my message</p>\n\n<p>07-28 13:10:01.483: ERROR/Null(6189): java.lang.NullPointerException</p>\n\n<p>07-28 13:10:01.483: ERROR/Null(6189):     at com.ciam.app.CiamInfoActivity.refreshMeta(CiamInfoActivity.java:280)</p>\n\n<p>07-28 13:10:01.483: ERROR/Null(6189):     at com.ciam.app.CiamInfoActivity.access$0(CiamInfoActivity.java:257)</p>\n\n<p>07-28 13:10:01.483: ERROR/Null(6189):     at com.ciam.app.CiamInfoActivity$2.run(CiamInfoActivity.java:123)\n07-28 13:10:01.483: ERROR/Null(6189):     at java.lang.Thread.run(Thread.java:1020)</p>\n\n<p>I suspect that there are some differences between the way xml is parsed on android 2 and android 3. Any ideas? Thanks in advance.</p>\n"},{"tags":["python","multithreading","logging","multiprocessing","locks"],"answer_count":1,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":119,"score":5,"question_id":12984003,"title":"Status of mixing multiprocessing and threading in Python","body":"<p>What are best practices or work-arounds for using both multiprocessing and user threads in the same python application in Linux with respect to Issue 6721, Locks in python standard library should be sanitized on fork?</p>\n\n<p>Why do I need both?  I use child processes to do heavy computation that produce data structure results that are much too large to return through a queue -- rather they must be immediately stored to disk.  It seemed efficient to have each of these child processes monitored by a separate thread, so that when finished, the thread could handle the IO of reading the large (eg multi GB) data back into the process where the result was needed for further computation in combination with the results of other child processes.\nThe children processes would intermittently hang, which I just (after much head pounding) found was 'caused' by using the logging module.  Others have documented the problem here:</p>\n\n<p><a href=\"https://twiki.cern.ch/twiki/bin/view/Main/PythonLoggingThreadingMultiprocessingIntermixedStudy\">https://twiki.cern.ch/twiki/bin/view/Main/PythonLoggingThreadingMultiprocessingIntermixedStudy</a></p>\n\n<p>which points to this apparently unsolved python issue: Locks in python standard library should be sanitized on fork;  <a href=\"http://bugs.python.org/issue6721\">http://bugs.python.org/issue6721</a></p>\n\n<p>Alarmed at the difficulty I had tracking this down, I answered:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/6244401/are-there-any-reasons-not-to-mix-multiprocessing-and-threading-module-in-python\">Are there any reasons not to mix Multiprocessing and Threading module in Python</a></p>\n\n<p>with the rather unhelpful suggestion to 'Be careful' and links to the above.</p>\n\n<p>But the lengthy discussion re: Issue 6721 suggests that it is a 'bug' to use both multiprocessing (or os.fork) and user threads in the same application.  With my limited understanding of the problem, I find too much disagreement in the discussion to conclude what are the work-arounds or strategies for using both multiprocessing and threading in the same application.  My immediate problem was solved by disabling logging, but I create a small handful of other (explicit) locks in both parent and child processes, and suspect I am setting myself up for further intermittent deadlocks.</p>\n\n<p>Can you give practical recommendations to avoid deadlocks while using locks and/or the logging module while using threading and multiprocessing in a python (2.7,3.2,3.3) application?</p>\n"},{"tags":[".net","multithreading","timer","lifetime"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":13105908,"title":"object lifetime in multithreaded environment","body":"<p>Following <a href=\"http://msdn.microsoft.com/en-us/library/system.timers.timer%28v=vs.110%29.aspx\" rel=\"nofollow\">System.Timers.Timer</a>, I created a console app to exercise:</p>\n\n<pre><code>public class Program\n{\n    //private static System.Timers.Timer aTimer;\n\n    public static void Main()\n    {\n        short_running_method();\n\n        Console.WriteLine(\"Press the Enter key to exit the program.\");\n        Console.ReadLine();\n\n\n    }\n\n    static void short_running_method()\n    {\n        // Normally, the timer is declared at the class level, \n        // so that it stays in scope as long as it is needed. \n        // If the timer is declared in a long-running method,   \n        // KeepAlive must be used to prevent the JIT compiler  \n        // from allowing aggressive garbage collection to occur  \n        // before the method ends. You can experiment with this \n        // by commenting out the class-level declaration and  \n        // uncommenting the declaration below; then uncomment \n        // the GC.KeepAlive(aTimer) at the end of the method. \n        System.Timers.Timer aTimer; \n\n        // Create a timer with a ten second interval.\n        aTimer = new System.Timers.Timer(10000);\n\n        // Hook up the Elapsed event for the timer.\n        aTimer.Elapsed += new ElapsedEventHandler(OnTimedEvent);\n\n        // Set the Interval to 2 seconds (2000 milliseconds).\n        aTimer.Interval = 2000;\n        aTimer.Enabled = true;\n\n        // If the timer is declared in a long-running method, use \n        // KeepAlive to prevent garbage collection from occurring \n        // before the method ends. \n        //GC.KeepAlive(aTimer);\n    }\n\n\n    // Specify what you want to happen when the Elapsed event is  \n    // raised. \n    private static void OnTimedEvent(object source, ElapsedEventArgs e)\n    {\n        Console.WriteLine(\"The Elapsed event was raised at {0}\", e.SignalTime);\n    }\n}\n</code></pre>\n\n<p>I understand (correct me if i am wrong) the timer object declared at class-level is alive as long as the Program is running and the event keeps firing infinitely. By commenting out the class level declared timer object and uncommenting the declaration within the short_running_method, I suppose the atimer object should be garbage collected after certain amount of time if GC.KeepAlive(aTimer) is not used and the event should stop firing. However, in my experiment the event seems never stop, even after 30 minutes it's still getting raised. Can someone clarify why this is happening?</p>\n"},{"tags":["multithreading","concurrency","parallel-processing","cpu-cores"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":33,"score":1,"question_id":13114618,"title":"Multithreading & parallelism with regards to the number of CPU cores","body":"<p>I've read somewhere that real multi-threading is limited to the number of CPU cores you are running. Does that mean that all you get if you have, say, a dual core CPU, is real multi-threading with just... 2 parallel threads?</p>\n"},{"tags":["java","multithreading","multicore","knapsack-problem"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2700,"score":2,"question_id":1896065,"title":"How to ensure Java threads run on different cores","body":"<p>I am writing a multi-threaded application in Java in order to improve performance over the sequential version. It is a parallel version of the dynamic programming solution to the 0/1 knapsack problem. I have an Intel Core 2 Duo with both Ubuntu and Windows 7 Professional on different partitions. I am running in Ubuntu. </p>\n\n<p>My problem is that the parallel version actually takes longer than the sequential version. I am thinking this may be because the threads are all being mapped to the same kernel thread or that they are being allocated to the same core. Is there a way I could ensure that each Java thread maps to a separate core?</p>\n\n<p>I have read other posts about this problem but nothing seems to help. </p>\n\n<p>Here is the end of main() and all of run() for the KnapsackThread class (which extends Thread). Notice that they way I use slice and extra to calculate myLowBound and myHiBound ensure that each thread will not overlap in domain of the dynProgMatrix. Therefore there will be no race conditions.</p>\n\n<pre><code>    dynProgMatrix = new int[totalItems+1][capacity+1];\n    for (int w = 0; w&lt;= capacity; w++)\n        dynProgMatrix[0][w] = 0;\n    for(int i=0; i&lt;=totalItems; i++)\n        dynProgMatrix[i][0] = 0;\n    slice = Math.max(1,\n            (int) Math.floor((double)(dynProgMatrix[0].length)/threads.length));\n    extra = (dynProgMatrix[0].length) % threads.length;\n\n    barrier = new CyclicBarrier(threads.length);\n    for (int i = 0; i &lt;  threads.length; i++){\n        threads[i] = new KnapsackThread(Integer.toString(i));\n    }\n    for (int i = 0; i &lt; threads.length; i++){\n        threads[i].start();\n    }\n\n    for (int i = 0; i &lt; threads.length; i++){\n        try {\n            threads[i].join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\npublic void run(){\n    int myRank = Integer.parseInt(this.getName());\n\n    int myLowBound;\n    int myHiBound;\n\n    if (myRank &lt; extra){\n        myLowBound = myRank * (slice + 1);\n        myHiBound = myLowBound + slice;\n    }\n    else{\n        myLowBound = myRank * slice + extra;\n        myHiBound = myLowBound + slice - 1;\n    }\n\n    if(myHiBound &gt; capacity){\n        myHiBound = capacity;\n    }\n\n    for(int i = 1; i &lt;= totalItems; i++){\n        for (int w = myLowBound; w &lt;= myHiBound; w++){\n\n            if (allItems[i].weight &lt;= w){\n               if (allItems[i].profit + dynProgMatrix[i-1][w-allItems[i].weight]\n                        &gt; dynProgMatrix[i-1][w])\n                {\n                    dynProgMatrix[i][w] = allItems[i].profit +\n                                      dynProgMatrix[i-1][w- allItems[i].weight];\n                }\n                else{\n                    dynProgMatrix[i][w] = dynProgMatrix[i-1][w];\n                }\n            }\n            else{\n                dynProgMatrix[i][w] = dynProgMatrix[i-1][w];\n            }\n        }\n        // now place a barrier to sync up the threads\n        try {\n            barrier.await(); \n        } catch (InterruptedException ex) { \n            ex.printStackTrace();\n            return;\n        } catch (BrokenBarrierException ex) { \n            ex.printStackTrace(); \n            return;\n        }\n    }\n}\n</code></pre>\n\n<h3>Update:</h3>\n\n<p>I have written another version of the knapsack that uses brute force. This version has very little synchronization because I only need to update a bestSoFar variable at the end of a single thread's execution. Therefore, each thread pretty much should execute completely in parallel except for that small critical section at the end.</p>\n\n<p>I ran this versus the sequential brute force and still it takes longer. I don't see any other explanation than that my threads are being run sequentially, either because they are being mapped to the same core or to the same native thread.</p>\n\n<p>Does anybody have any insight?</p>\n"},{"tags":["multithreading","homework","haskell","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":475,"score":3,"question_id":5926501,"title":"Comparing Haskell threads to kernel threads - is my benchmark viable?","body":"<p>This one is actually for my university project. In my essay, I need to inlcude evidence that Haskell threads are faster to create than plain kernel threads. I know that it's better to refer to some research paper, but the point is that I have to do the benchmarking myself. </p>\n\n<p>Here is what I've come up with. I've written two programs, in C (using pthreads) and Haskell, which create many threads, but those threads do absolutely nothing. I need to measure only the speed of creating a thread.</p>\n\n<p>Here's the source code for the C program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n\nvoid* thread_main(void*);\n\nint main(int argc, char* argv[])\n{\n   int n,i;\n    pthread_t *threads;\n    pthread_attr_t pthread_custom_attr;\n\n    if (argc != 2)\n    {\n        printf (\"Usage: %s n\\n  where n is no. of threads\\n\",argv[0]);\n       return 1;\n   }\n\n    n=atoi(argv[1]);\n\n    threads=(pthread_t *)malloc(n*sizeof(*threads));\n    pthread_attr_init(&amp;pthread_custom_attr);\n\n    for (i=0; i&lt;n; i++)\n    {\n        pthread_create(&amp;threads[i], &amp;pthread_custom_attr, thread_main, (void *)(0));\n    }\n\n    for (i=0; i&lt;n; i++)\n    {\n        pthread_join(threads[i],NULL);\n    }\n}\n\nvoid* thread_main(void* p)\n{\n   return 0;\n}\n</code></pre>\n\n<p>and for the Haskell program:</p>\n\n<pre><code>module Main (main) where\n\nimport System.IO.Unsafe\nimport System\nimport Control.Concurrent\nimport Control.Exception\n\nchildren :: MVar [MVar ()]\nchildren = unsafePerformIO (newMVar [])\n\nwaitForChildren :: IO ()\nwaitForChildren = do\n   cs &lt;- takeMVar children\n   case cs of\n      []   -&gt; return ()\n      m:ms -&gt; do\n         putMVar children ms\n         takeMVar m\n         waitForChildren\n\nforkChild :: IO () -&gt; IO ThreadId\nforkChild io = do\n   mvar &lt;- newEmptyMVar\n   childs &lt;- takeMVar children\n   putMVar children (mvar:childs)\n   forkIO (io `finally` putMVar mvar ())\n\nforkKids :: Int -&gt; IO ()\nforkKids 0 = return ()\nforkKids n = do\n   forkChild (threadMain)\n   forkKids (n-1)\n\nthreadMain = return ()\n\nmain = do\n   args &lt;- getArgs\n   forkKids (read (head args))\n   waitForChildren\n</code></pre>\n\n<p>Now, what I do is I run each program with the same argument (e.g. 10000) and measure their running time with <code>time -f%e</code>, then take the arithmetic mean of the running times. It shows that creating Haskell threads in an order of magnitude faster.</p>\n\n<p>Now, my question is: is this a correct benchmark? or is there some factor that I need to take into account to get accurate results?</p>\n\n<p>Thanks</p>\n"},{"tags":["java","multithreading","image","graphics","awt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13114317,"title":"Java won't draw my image when method is called using threads","body":"<p>I have this flower program where it is supposed to drop flowers from above.... I need it to wait a few seconds then call the method to drop the flower. I know the method runs because i have it print out the falling y values. But it won't draw it on the screen. I really don't know what I'm doing wrong. Here is some of the code...</p>\n\n<pre><code>    //Ignore starting here\n    import java.awt.*;\n    import javax.swing.*;\n    import java.awt.event.*;\n    import java.util.Random;\n    //Ignore ending here\n\n    public class RedFlower implements ActionListener{\n        Timer time;\n        ImageIcon i = new ImageIcon(\"graphics//flowers//red_flower.png\");\n        Image flower = i.getImage();\n        int y, x;\n        int dy = 1;\n        public void dropFlower(){\n            Random rnd = new Random();\n            y = 50;\n            x = rnd.nextInt(1216);\n            time = new Timer(5, this);\n            time.start();\n}\npublic void actionPerformed(ActionEvent e){// used for stoping the timer when off the screen\n    int checky = y++;\n    if(checky &lt; 720){\n        y++;\n    }else{\n        time.stop();\n    }\n    System.out.println(y);\n\n}\n//everything after this is what i call in the other method\n    public Image getImage(){\n    return flower;\n}\npublic int getX(){\n    return x;\n}\npublic int getY(){\n    return y;\n}\n    }\n</code></pre>\n\n<p>Now this is my drawing code...</p>\n\n<pre><code>    public void paintComponent(java.awt.Graphics g){\n    super.paintComponent(g);\n    Graphics2D g2d = (Graphics2D) g;\n\n    g2d.drawImage(rf.getImage(), rf.getX(), rf.getY(), null);// rf is what i called the method\n    g2d.drawImage(sc.getImage(), sc.getX(), sc.getY(), null);//this is the basket that you control\n}\n</code></pre>\n\n<p>Also a weird thing is when i make pressing a button call the method it works but not when the thread runs it...</p>\n"},{"tags":["c++","c","multithreading","winapi","console"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13109805,"title":"Win32 Where is the console code running? Console hang when used from multiple threads","body":"<p>I have a Win32 app in C++ that uses two threads.\nThread A creates a console window using <code>AllocConsole()</code>.\nThread B prints into this console using <code>WriteFile</code> into the console handle (got from <code>GetStdHandle</code>).</p>\n\n<p>For some reason, when both threads print simultaniously to the console my process hangs.</p>\n\n<p>How can I fix this hang? What causes it?\nI want to debug the message loop for the console (It's a window right? So it should have messages) but I don't know how to access it?</p>\n"},{"tags":["multithreading","qt","mvc","model-view"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":13113743,"title":"Qt application with MVC and multithreading","body":"<p>This Qt application I am working on has model view controller in main thread, while the data structure under dataModel and the data model are modified by a network working thread (basically it is getting data from server). \nThe application crashes ramdonly. Based on my triage, it shows it crashes at some Qt deep model functions triggered by my data model modification. So I put lock on those data model functions. But now it still crashes. </p>\n\n<p>What is right design for this case? I also tried to promote data model modification to main thread, which means once data structure is changed, it emits a signal to controller, then the slot function in controller modifies the data model. This crashes too. plus this design looks weird. data structure changes model directly seems a better design, but it will keep model in working thread. I looked at a lot of model/view examples, all of them model contains data and model is not in worker thread. So none of them is my case.</p>\n\n<p>Thanks,</p>\n"},{"tags":["multithreading","sqlite","firemonkey"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13113644,"title":"XE3, TSQLConnection, Multiple Threads, SQLite, OSX","body":"<p>I am in the process of testing an app that has been working on Windows 7 &amp; 8 nicely on OSX, using FireMonkey 2 (XE3).</p>\n\n<p>For some reason I am getting crashes with OSX and the debugger isn't really giving much of a clue as to what the problem is.</p>\n\n<p>Until now I have been using a single TSQLConnection and using this throughout my application and in multiple threads. Since the problems on OSX have been happening, I have been looking at maybe the causes being the TSQLConnection, used in multiple threads.</p>\n\n<p>So I am here hoping to find a definitive answer as to how to use TSQLConnection/SQLite on multiple threads, if there is anything I need to do in order to ensure there are no conflicts with threads or do I just use it as is without having to worry about possible conflicts?</p>\n\n<p>Jason</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13113460,"title":"Unexpected output for 2 threads modifying a shared BlockingQueue","body":"<p>I have the followings:</p>\n\n<pre><code>public class ProducerConsumer {\n\n  private BlockingQueue&lt;Integer&gt; q;\n  private Random rnd;\n  private boolean run;\n\n  public ProducerConsumer(){\n    rnd = new Random();\n    q = new ArrayBlockingQueue&lt;&gt;(10);\n    run = true;\n  }\n\n  // high leve - with ArrayBlockingQueue\n\n  public void QProducer() throws InterruptedException{       \n    int i;\n    while(run){\n        i  = rnd.nextInt(100);\n\n        q.put(i);\n        System.out.println(i +\" Added. Size is: \"+ q.size());\n    }\n  } \n\n  public void  QConsumer() throws InterruptedException{\n    int i;\n    while(run){\n      Thread.sleep(100);\n      if (rnd.nextInt(10) == 0) {\n\n          i = q.take();\n          System.out.println(i + \" Taken. Size is: \"+ q.size());\n      }\n    }\n  }\n\npublic void changeRun(){\n    run = false;\n }    \n}\n</code></pre>\n\n<hr>\n\n<pre><code> public static void main(String[] args) throws InterruptedException {\n\n    // Producer Consumer\n\n    final ProducerConsumer pc = new ProducerConsumer();\n\n    Thread t1 = new Thread(new Runnable() {\n\n        @Override\n        public void run() {\n            try {\n                pc.QProducer();\n            } catch (InterruptedException ex) {\n                Logger.getLogger(Threading.class.getName()).log(Level.SEVERE, null, ex);\n            }\n        }\n    });\n\n    Thread t2 = new Thread(new Runnable() {\n\n        @Override\n        public void run() {\n            try {\n                pc.QConsumer();\n            } catch (InterruptedException ex) {\n                Logger.getLogger(Threading.class.getName()).log(Level.SEVERE, null, ex);\n            }\n        }\n    });\n\n    t1.start();\n    t2.start();\n\n    Scanner scn = new Scanner(System.in);\n\n    scn.nextLine();\n    pc.changeRun();\n\n    t1.join();\n    t2.join();\n\n}\n</code></pre>\n\n<p>Ouptput:</p>\n\n<pre><code>20 Added. Size is: 1\n8 Added. Size is: 2\n71 Added. Size is: 3\n72 Added. Size is: 4\n61 Added. Size is: 5\n97 Added. Size is: 6\n6 Added. Size is: 7\n64 Added. Size is: 8\n58 Added. Size is: 9\n27 Added. Size is: 10\n20 Taken. Size is: 10 *\n93 Added. Size is: 10\n8 Taken. Size is: 9\n95 Added. Size is: 10\n71 Taken. Size is: 10 *\n70 Added. Size is: 10\n72 Taken. Size is: 10 *\n85 Added. Size is: 10\n61 Taken. Size is: 9\n43 Added. Size is: 10\n64 Added. Size is: 10 **\n... \n</code></pre>\n\n<p>I wonder how can there be numbers that are taken, and yet the size remains the same ( * ),\nand howcome values are added after Queue is full ( ** ).\nAFAIU, BlockingQueue is sychronized, and waits for values to to be added if queue is empty, and to be removed if full.\nThank you in advance.</p>\n"},{"tags":["c#","multithreading","bulletphysics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13096451,"title":"How do I get bulletphysics/bulletsharps' multithreading working?","body":"<p>That is to say, what is the minimum set of code I need to set up the BulletSharp physics engine wrappers' \"DynamicsWorld\" to use \"BulletSharp.MultiThreaded.ParallelConstraintSolver\"? Alternately, I could probably work it out from the same set of code for the BulletPhysics engine itself.</p>\n\n<p>If I have not phrased the right question, I would appreciate clarification; I only started using it today. (Yes, I have written a quick program using the standard classes).</p>\n\n<p>BulletPhysics is a C++ library; the wrapper is written in C#.</p>\n\n<p><a href=\"http://bulletphysics.org/wordpress/\" rel=\"nofollow\">http://bulletphysics.org/wordpress/</a></p>\n\n<p><a href=\"http://code.google.com/p/bulletsharp/\" rel=\"nofollow\">http://code.google.com/p/bulletsharp/</a></p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","winforms","multithreading","parallel-processing"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13112561,"title":"C# Threading, 1st Task DoSomething, 2nd Task update a WinFormLabel (Realtime)?","body":"<p>Lets say I have Task 1:</p>\n\n<pre><code>private void Task1()\n{\n    //Here is some Code, could be any \"longer\" Task - \n    //For Example: Grab all words from a .txt File and fill in a List&lt;String&gt;\n}\n</code></pre>\n\n<p>Then I have an other Task 2:</p>\n\n<pre><code>private void Task2(string word)\n{\n   //So lets say theres a Label on my WinForm..\n   //Now While Task1 is grabbing the words, Task2 should fill a Label \n   //with the added 'word' (parameter) - (Task2 will be called from Task1\n}\n</code></pre>\n\n<p>Actually I don't know how to make this possible, or whats the best way. On the UI I should be able to see the <code>Label.Text</code> changing (every word).. So I need to make a second Thread? How could I do this? Maybe someone could help me, cheers</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I tried it now with the Backgroundworker, but something seems to be false.. its actually not working, nothing happens on the form</p>\n\n<p>Code:</p>\n\n<pre><code>public void CreateAndSaveAMatch(DateTime date) //That method is being called several times\n{   \n    //HERE IS CODE, WHICH CREATES AND SAVES A MATCH\n\n    // Start the asynchronous operation.\n    backgroundWorker1.RunWorkerAsync(date);\n\n}\n\nprivate void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)\n{      \n    backgroundWorker1.ReportProgress(0, Convert.ToDateTime(e.Argument).ToShortDateString());          \n}\n\nprivate void backgroundWorker1_ProgressChanged(object sender, ProgressChangedEventArgs e)\n{\n    label1.Text = (string)e.UserState; //here on the Label I would like to show the Date\n}\n</code></pre>\n"},{"tags":["java","multithreading","animation","music"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13113336,"title":"Adding music to an animation in Java with theads","body":"<p>I'm trying to add music to an already existing animation I have that runs for x amount of time. I need the animation to stop when the music stops. How would I go about doing this without using the Swing way? I understand I'm going to need to create threads, but how can I determine when the music is done playing in order to stop the animation?</p>\n"},{"tags":["java","multithreading","concurrency","producer-consumer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13112415,"title":"Multithreaded read & write of a file , cannot stop operation, writes bad file","body":"<p>I have the task of tranfering large files , files that are about 5 GB in size, therefore a read &amp; write operattion. </p>\n\n<p>I wrote a single threaded version which reads 5k at a time , and immediately writes the 5K to another location, the signle threaded version works fine , I use a zip folder of 412 MB for testing it takes about 5 secs.  </p>\n\n<p>My goal is to actually write a multithreaded version , the natural design pattern that came to mind was the producer(reader) consumer(writer) pattern.</p>\n\n<p>Below is first the single threaded version which I based my multithreaded version on: </p>\n\n<hr>\n\n<pre><code>   import java.net.*;\nimport java.io.*;\nimport java.nio.*;\nimport java.util.Arrays;\n\npublic class ReadWrite {\n\n    URI readFrom = null;\n    URI writeTo = null;\n    //streams\n    FileInputStream fis = null;\n    FileOutputStream fos = null;\n    // good buffer size in Java is generally between 2k to 8k\n    byte[] byteBuffer = new byte[5 * 1024];\n    //just for testing \n    private int readSoFar = 0;\n    //const\n    ReadWrite(URI readFrom, URI writeTo) {\n        this.readFrom = readFrom;\n        this.writeTo = writeTo;\n\n    }\n\n    public URI getReadFrom() {\n        return readFrom;\n    }\n\n    public void setReadFrom(URI readFrom) {\n        this.readFrom = readFrom;\n    }\n\n    public URI getWriteTo() {\n        return writeTo;\n    }\n\n    public void setWriteTo(URI writeTo) {\n        this.writeTo = writeTo;\n    }\n\n    public void process() throws FileNotFoundException {\n\n        // by chunks therefore buffer\n        File fileToRead = new File(readFrom);\n        File fileToWrite = new File(writeTo);\n        try {\n            // if read &amp; write destinations exist\n            if (fileToRead.exists()) {\n                fis = new FileInputStream(fileToRead);\n                // instantiate OutputStream\n\n                fos = new FileOutputStream(fileToWrite);\n                // read a chunk, then write , update read position, until there\n                // is no more to read\n                try {\n                    int writeCounter = 0;\n                    // read\n                    while ((fis.read(byteBuffer, 0, byteBuffer.length)) != -1) {\n\n                        try {\n                            //just for testing &amp; seeing output/progress\n                            readSoFar= readSoFar + byteBuffer.length;\n                            System.out.println(\"readSoFar:\" + readSoFar);\n                            // write\n                            fos.write(byteBuffer);\n                            // clear previous data\n                            Arrays.fill(byteBuffer, (byte) 0);\n                            System.out.println(\"writeCounter: \" + writeCounter);\n                            writeCounter++;\n                        } catch (IOException exc) {\n                            exc.printStackTrace();\n\n                        }\n                    }\n                } catch (IOException exc) {\n                    exc.printStackTrace();\n                }\n\n            } else {\n                throw new FileNotFoundException();\n            }\n        } finally {\n            if (fis != null) {\n                try {\n                    fis.close();\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n            if (fos != null) {\n                try {\n                    fos.flush();\n                    fos.close();\n\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n        }\n    }// end class ReadWrite\n\n}\n</code></pre>\n\n<hr>\n\n<p>The main class FileCopy (Single threaded): </p>\n\n<pre><code>public class FileCopy {\n\n    public static void main(String[] args) {\n\n     try {\n        try {\n            //wls1033_dev.zip\n            new ReadWrite( new URI(\"file:/C:/Users/anaim/Pictures/wls1033_dev.zip\"),new URI(\"file:/C:/Users/anaim/Pictures/result/wls1033_dev.zip\")).process();\n        } catch (URISyntaxException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    } catch (FileNotFoundException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n\n    }\n\n}//end main class\n</code></pre>\n\n<p>The output should look something like this:</p>\n\n<p>.\n.\n.\nreadSoFar:423198720\nwriteCounter: 82655\nreadSoFar:423203840\nwriteCounter: 82656\nreadSoFar:423208960\nwriteCounter: 82657</p>\n\n<p>An obviously the destination file should not be curropted &amp; identical to the original file. </p>\n\n<hr>\n\n<p>Below is the multithreaded version , which is based on the single threaded code , except thread logic &amp; locks via syncronization,wait,notify is implemented. The multithreading is actually working there are no deadlocks, or liveliness issues, however the read/write operation DOES NOT TERMINATE. </p>\n\n<p>The issue seems to be with the variable \"<strong>readState\" and its getReadState()</strong> method that seems to be not operating correctly when called in the main class, when readState == -1, <strong>than the read/write should terminate.</strong> </p>\n\n<p>Multithreaded read &amp; write (class ReadProducerWriteConsumer) provides a readProcess &amp; writeProcess that wait with synchronized sections based on the value of the \"boolean empty\" variable/flag  </p>\n\n<pre><code>import java.net.*;\nimport java.io.*;\nimport java.nio.*;\nimport java.util.Arrays;\n\npublic class ReadProducerWriteConsumer {\n\n    URI readFrom = null;\n    URI writeTo = null;\n    //\n    FileInputStream fis = null;\n    FileOutputStream fos = null;\n    // good buffer size in Java is generally between 2k to 8k\n    byte[] byteBuffer = new byte[1024];\n    //\n    File fileToRead = null;\n    File fileToWrite = null;\n    //\n    private int readSoFar = 0;\n    int writeCounter = 0;\n    //\n    volatile private int readState = 0;\n    // Consumer &amp; Producer state , hence has anything been read in order to be\n    // written\n    boolean empty = true;\n\n    ReadProducerWriteConsumer(URI readFrom, URI writeTo) {\n        this.readFrom = readFrom;\n        this.writeTo = writeTo;\n        //\n        fileToRead = new File(readFrom);\n        fileToWrite = new File(writeTo);\n    }\n\n    public long getReadState() {\n        return this.readState;\n    }\n\n    public void setReadState(int readState) {\n        this.readState = readState;\n    }\n\n    public URI getReadFrom() {\n        return readFrom;\n    }\n\n    public void setReadFrom(URI readFrom) {\n        this.readFrom = readFrom;\n    }\n\n    public URI getWriteTo() {\n        return writeTo;\n    }\n\n    public void setWriteTo(URI writeTo) {\n        this.writeTo = writeTo;\n    }\n\n    public synchronized void readProcess() throws FileNotFoundException {\n\n        // while false, while data is being written , wait\n        while (empty == false) {\n            try {\n                wait();\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n\n        // by chunks therefore buffer\n        File fileToRead = new File(readFrom);\n\n        try {\n            // if read &amp; write destinations exist\n            if (fileToRead.exists()) {\n                fis = new FileInputStream(fileToRead);\n                // read a chunk\n                try {\n                    // while readSoFar!=-1\n                    while (((this.readState = fis.read(byteBuffer, 0,\n                            byteBuffer.length)) != -1) &amp;&amp; empty != false) {\n\n                        // just for testing &amp; seeing output/progress\n                        readSoFar = readSoFar + byteBuffer.length;\n                        System.out.println(\"readSoFar:\" + readSoFar);\n\n                        // read a chunck , now that buffer is full set emoty to\n                        // false\n                        empty = false;\n\n                    }\n                } catch (IOException exc) {\n                    exc.printStackTrace();\n                }\n\n            } else {\n                throw new FileNotFoundException();\n            }\n        } finally {\n            if (fis != null) {\n                try {\n                    fis.close();\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n            // new data has been read , notify all threads waiting to consume\n            // data\n            notifyAll();\n        }\n    }\n\n    public synchronized void writeProcess() throws FileNotFoundException {\n        // while true, therefore there is nothing to write, wait\n        while (empty == true) {\n            try {\n                wait();\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n        // by chunks therefore buffer\n        File fileToWrite = new File(writeTo);\n\n        try {\n            // instantiate OutputStream\n            fos = new FileOutputStream(fileToWrite);\n            // then write , update read position\n\n            // write\n            try {\n                fos.write(byteBuffer);\n                // clear previous data\n                Arrays.fill(byteBuffer, (byte) 0);\n                System.out.println(\"writeCounter: \" + writeCounter);\n                writeCounter++;\n            } catch (IOException exc) {\n                exc.printStackTrace();\n\n            }\n\n        } finally {\n\n            if (fos != null) {\n                try {\n                    fos.flush();\n                    fos.close();\n\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n            // new data has been written , notify all threads waiting to\n            // read/produce more data\n            empty = true;\n            notifyAll();\n        }\n    }\n\n}//end class ReadProducerWriteConsumer\n</code></pre>\n\n<hr>\n\n<p>readRunnable class implements a runnable and calls ReadProducerWriteConsumer.readProcess()</p>\n\n<pre><code>import java.io.FileNotFoundException;\n\npublic class readRunnable implements Runnable {\n    ReadProducerWriteConsumer ReaderProducerWriterConsumer = null;\n\n    public readRunnable(ReadProducerWriteConsumer readerProducerWriterConsumer) {\n        super();\n        ReaderProducerWriterConsumer = readerProducerWriterConsumer;\n    }\n\n    @Override\n    public void run() {\n        // TODO Auto-generated method stub\n        try {\n            ReaderProducerWriterConsumer.readProcess();\n        } catch (FileNotFoundException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    }\n    // call ReaderProducerWriterConsumer read method\n}//end readRunnable class\n</code></pre>\n\n<hr>\n\n<p>writeRunnable class implements a runnable and calls ReadProducerWriteConsumer.writeProcess()</p>\n\n<pre><code>import java.io.FileNotFoundException;\n\n\npublic class writeRunnable implements Runnable\n    {\n        ReadProducerWriteConsumer ReaderProducerWriterConsumer = null; \n\n        public writeRunnable (ReadProducerWriteConsumer readerProducerWriterConsumer) {\n            super();\n            ReaderProducerWriterConsumer = readerProducerWriterConsumer;\n        }\n\n        @Override\n        public void run() {\n            // TODO Auto-generated method stub\n            try {\n                ReaderProducerWriterConsumer.writeProcess();\n            } catch (FileNotFoundException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n        //ReaderProducerWriterConsumer write method\n    }//end writeRunnable\n</code></pre>\n\n<hr>\n\n<p>The main class that instantiates the threads and creates read/write threads until there is no more to read , this condition is checked with the ReadProducerWriteConsumer.getReadState() </p>\n\n<pre><code>import java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.net.MalformedURLException;\nimport java.net.URI;\nimport java.net.URISyntaxException;\nimport java.net.URL;\nimport java.nio.ByteBuffer;\nimport java.nio.channels.FileChannel;\nimport java.nio.file.Paths;\nimport java.util.Arrays;\n\npublic class FileCopy {\n\n    public static void main(String[] args) {\n\n        ReadProducerWriteConsumer ReaderProducerWriterConsumer = null;\n        try {\n            ReaderProducerWriterConsumer = new ReadProducerWriteConsumer(\n                    new URI(\"file:/C:/Users/anaim/Pictures/pic.png\"), new URI(\n                            \"file:/C:/Users/anaim/Pictures/result/pic.png\"));\n        } catch (URISyntaxException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n        Thread readThread = null;\n        Thread writeThread = null;\n\n        while (ReaderProducerWriterConsumer.getReadState() != -1) {\n\n            readThread = new Thread(new readRunnable(\n                    ReaderProducerWriterConsumer));\n\n            writeThread = new Thread(new writeRunnable(\n                    ReaderProducerWriterConsumer));\n\n            readThread.start();\n            writeThread.start();\n\n            try {\n                readThread.join();\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n            try {\n                writeThread.join();\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n\n\n\n    }\n\n}// end main class\n</code></pre>\n\n<p>Therefore, the  issue with the multithreaded version is that the read/write operation does not stop ,and hence the write operation yields a corrupted file. </p>\n\n<p>Please advise with a intelligent solution. Thanks.</p>\n"},{"tags":["java","multithreading","critical-section"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":511,"score":4,"question_id":3963908,"title":"Java, multiple threads with only one executing at a time","body":"<p>I am working on an assignment and have to create two classes, one represents a person, and the other representing a bridge. Only one person can be \"crossing\" the bridge at any one time, but there could be people waiting to cross</p>\n\n<p>I easily implemented this with multi-threading allowing for multiple people to cross at once, but I am having issues when changing it to allow only one thread to run...</p>\n\n<p>My main problem is the class design they want, I have to begin the threads within the person class, but the bridge class needs to be able to wait and notify them to start/stop</p>\n\n<p>Any ideas how I can do this?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":13096452,"title":"How Do You Stop A Thread Blocking for Network I/O?","body":"<p>I am currently trying to write a very simple chat application to introduce myself to java socket programming and multithreading.  It consists of 2 modules, a psuedo-server and a psuedo-client, however my design has lead me to believe that I'm trying to implement an impossible concept.  </p>\n\n<h2>The Server</h2>\n\n<p>The server waits on localhost port 4000 for a connection, and when it receives one, it starts 2 threads, a listener thread and a speaker thread.  The speaker thread constantly waits for user input to the console, and sends it to the client when it receives said input.  The listener thread blocks to the ObjectInputStream of the socket for any messages sent by the client, and then prints the message to the console.</p>\n\n<h2>The Client</h2>\n\n<p>The client connects the user to the server on port 4000, and then starts 2 threads, a listener and s speaker.  These threads have the same functionality as the server's threads, but, for obvious reasons, handle input/output in the opposite way.</p>\n\n<h2>The First Problem</h2>\n\n<p>The problem I am running into is that in order to end the chat, a user must type \"Bye\".  Now, since my threads have been looped to block for input:</p>\n\n<pre><code>    while(connected()){\n\n        //block for input\n        //do something with this input\n        //determine if the connection still exists (was the message \"Bye\"?)\n    }\n</code></pre>\n\n<p>Then it becomes a really interesting scenario when trying to exit the application.  If the client types \"Bye\", then it returns the sending thread and the thread that listened for the \"Bye\" on the server also returns.  This leaves us with the problem that the client-side listener and the server-side speaker do not know that \"Bye\" has been typed, and thus continue execution.  </p>\n\n<p>I resolved this issue by creating a class Synchronizer that holds a boolean variable that both threads access in a synchronized manner:</p>\n\n<pre><code>public class Synchronizer {\n\n    boolean chatting;\n\n    public Synchronizer(){\n\n        chatting = true;\n        onChatStatusChanged();\n    }\n\n    synchronized void stopChatting(){\n\n        chatting = false;\n        onChatStatusChanged();\n    }\n\n    synchronized boolean chatting(){\n\n        return chatting;\n    }\n\n    public void onChatStatusChanged(){\n\n     System.out.println(\"Chat status changed!: \" + chatting);\n    }\n}\n</code></pre>\n\n<p>I then passed the same instance of this class into the thread as it was created.  There was still one issue though.</p>\n\n<h2>The Second Problem</h2>\n\n<p>This is where I deduced that what I am trying to do is impossible using the methods I am currently employing.  Given that one user has to type \"Bye\" to exit the chat, the other 2 threads that aren't being utilized still go on to pass the check for a connection and begin blocking for I/O.  While they are blocking, the original 2 threads realize that the connection has been terminated, but even though they change the boolean value, the other 2 threads have <strong>already</strong> passed the check, and are already blocking for I/O.  </p>\n\n<p>This means that even though you will terminate the thread on the next iteration of the loop, you will still be trying to receive input from the other threads that have been properly terminated.  This lead me to my final conclusion and question.</p>\n\n<h2>My Question</h2>\n\n<p>Is it possible to asynchronously receive and send data in the manner which I am trying to do?  (2 threads per client/server that both block for I/O)  Or must I send a heartbeat every few milliseconds back and forth between the server and client that requests for any new data and use this heartbeat to determine a disconnect?</p>\n\n<p>The problem seems to reside in the fact that my threads are blocking for I/O before they realize that the partner thread has disconnected.  This leads to the main issue, how would you then asynchronously stop a thread blocking for I/O?</p>\n\n<p>I feel as though this is something that should be able to be done as the behavior is seen throughout social media.</p>\n\n<p>Any clarification or advice would be greatly appreciated!</p>\n"},{"tags":["java","android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13111594,"title":"I want run a function without hanging program for second","body":"<p>when i run </p>\n\n<pre><code>msgcheck.setOnClickListener(new View.OnClickListener() {            \n        @Override\n        public void onClick(View v) {\n\n            if(msgcheck.isChecked()){\n                //hedearMsg\n\n\n                final Dialog dialog = new Dialog(this);\n                dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\n                dialog.getWindow().setBackgroundDrawable(new ColorDrawable(android.graphics.Color.TRANSPARENT));\n                dialog.setContentView(R.layout.custommsg);\n                dialog.setCancelable(true);\n                dialog.show();\n\n                Thread t = new Thread() {\n                  public void run() {\n                     // Do something on another thread\n                      PopulatePeopleList();\n\n                  }\n                };\n                t.run();\n\n        }\n    });\n</code></pre>\n\n<p>my program hang a few second and then show dialog<br>\ni want run this dialog without hanging and PopulatePeopleListfunc work anyone idea?</p>\n"},{"tags":["c","arrays","multithreading","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13111816,"title":"Array of threads in C","body":"<p>I am trying to do a consumer / producer program with multiple consumers and producers. Im just trying to do something simple as have a producer add a random number to a shared array and have a consumer take it out.</p>\n\n<p>I am getting errors though with the thread create. I see the error and what its saying but not sure how to fix it.</p>\n\n<p>I will show you the producer function and main and i will separate them for easy reading.</p>\n\n<pre><code>#define BUFFER_SIZE 30\n\nstruct sharedBuffer{\n\nint resource[BUFFER_SIZE];\nint produced, consumed;\nint in;\nint out;\n\n};\n\nstruct sharedBuffer shared;\nstruct sharedBuffer s_instance = { in:0, out:0, };\n\nvoid *producer(void *arg){\n\nint item = 0;\nint itemCount =0;\n//shared.in =0;\n  while (1) {\n    item = produceItem();           //generate the random number\n   // while (shared.produced == BUFFER_SIZE);   //spin if buffer is full\n\n    if(shared.produced == BUFFER_SIZE){\n        fprintf (stdout, \"Producer added : %d items \\n\",  shared.produced);\n       return NULL;\n\n    }\n    /* put new item in buffer */\n    shared.resource[shared.in] = item;\n    shared.in = (shared.in+1) % BUFFER_SIZE;\n    shared.resource[shared.in] = item;\n    fprintf (stdout, \"Producer added: %d \\n\",  item);\n    shared.produced++;\n    //item++;\n    itemCount++;\n}\n}\n</code></pre>\n\n<p>Here is main()</p>\n\n<pre><code>int main(int argc, char* argv[])\n{\n\nint i;\nint result;\nint num_producers;\nint num_consumers;\n\npthread_attr_t attrs;\npthread_attr_init (&amp;attrs);\n//int producerArray[num_producers],consumerArray[num_consumers];\npthread_t producer[num_producers],consumer[num_consumers];\n\nprintf(\"Enter the number of Producers: \\n\");\n\nscanf(\"%d\", &amp;num_producers);\n\nprintf(\"Enter the number of Consumers: \\n\");\n\nscanf(\"%d\", &amp;num_consumers);  \n\nfor(i=0; i&lt; num_producers; i++)\n{\n    //producerArray[i]=0;\n    //pthread_create(&amp;producer[i],NULL, producer,&amp;producerArray[i]);\n    pthread_create(&amp;producer[i],NULL, producer,NULL);\n}\n\nfor(i=0; i&lt; num_consumers; i++)\n{\n    //consumerArray[i]=0;\n    // pthread_create(&amp;tid[i], NULL, &amp;compute_prime, NULL);\n    //pthread_create(&amp;consumer[i],NULL, consumer, &amp;consumerArray[i]);\n    pthread_create(&amp;consumer[i], NULL, consumer, NULL);\n}\n\nfor(i=0;i&lt;num_producers;i++)\n{\n    pthread_join(producer[i],NULL);\n    //printf(\"\\nThe Producer (%d) produced: [%d] Items\",i,producerArray[i]);\n    sleep(1);\n}\n\nreturn 0;\n}\n</code></pre>\n\n<p>Here is the error i am getting.</p>\n\n<pre><code>Consumer_producer2.c:125: warning: passing argument 3 of âpthread_createâ from  incompatible pointer type\n/usr/include/pthread.h:227: note: expected âvoid * (*)(void *)â but argument is of type âpthread_t *â\nConsumer_producer2.c:133: warning: passing argument 3 of âpthread_createâ from incompatible pointer type\n/usr/include/pthread.h:227: note: expected âvoid * (*)(void *)â but argument is of type âpthread_t *â\n</code></pre>\n\n<p>if i run it i get a Segmentation fault\nThank you.</p>\n"},{"tags":["java","multithreading","loops","tcp","main"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":13111308,"title":"Simple Java Threaded TCP Server thread","body":"<pre><code>/*main method*/\n\nServer server = new Server(tcpPort);\nnew Thread(server).start();\n\ntry {\n\n  Thread.sleep(1000*60); /* 60 seconds*/\n} catch (InterruptedException e) {\n  e.printStackTrace();\n}\n\nserver.stop;\n...\n</code></pre>\n\n<p>This is the code I've written. A Server thread is started, and runs for 60 seconds. How do I change this to run infinitely, ending when a user enters Enter via a BufferedReader or something.</p>\n\n<p>I've tried it with </p>\n\n<pre><code>while(!input.equals(\"\")) { /* just pseudocoded here...*/\nThread.sleep(10);   \n}\n</code></pre>\n\n<p>but this will my Server stop from working correctly. My clients won't even connect to it anymore. Have I made a design mistake or is this an easy problem to solve?</p>\n"},{"tags":["java","multithreading","gzip","concatenation","deflate"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13105481,"title":"Wrap deflated data in gzip format","body":"<p>I think I'm missing something very simple. I have a byte array holding deflated data written into it using a Deflater:</p>\n\n<pre><code>deflate(outData, 0, BLOCK_SIZE, SYNC_FLUSH)\n</code></pre>\n\n<p>The reason I didn't just use GZIPOutputStream was because there were 4 threads (variable) that each were given a block of data and each thread compressed it's own block before storing that compressed data into a global byte array. If I used GZIPOutputStream it messes up the format because each little block has a header and trailer and is it's own gzip data (I only want to compress it).</p>\n\n<p>So in the end, I've got this byteArray, outData, that's holding all of my compressed data but I'm not really sure how to wrap it. GZIPOutputStream writes from an buffer with uncompressed data, but this array is all set. It's already compressed and I'm just hitting a wall trying to figure out how to get it into a form. </p>\n\n<p>EDIT: Ok, bad wording on my part. I'm writing it to output, not a file, so that it could be redirected if needed. A really simple example is that </p>\n\n<pre><code>cat file.txt | java Jzip | gzip -d | cmp file.txt\n</code></pre>\n\n<p>should return 0. The problem right now is if I write this byte array as is to output, it's just \"raw\" compressed data. I think gzip needs all this extra information. </p>\n\n<p>If there's an alternative method, that would be fine to. The whole reason it's like this is because I needed to use multiple threads. Otherwise I would just call GZIPOutputStream.</p>\n\n<p>DOUBLE EDIT: Since the comments provide a lot of good insight, another method is that I just have a bunch of uncompressed blocks of data that were originally one long stream. If gzip can read concatenated streams, if I took those blocks (and kept them in order) and gave each one to a thread that calls GZIPOutputStream on its own block, then took the results and concatenated them. In essence, each block now has header, the compressed info, and trailer. Would gzip recognize that if I concatenated them?</p>\n\n<p>Example: </p>\n\n<pre><code>cat file.txt\nHello world! How are you? I'm ready to set fire to this assignment.\n\njava Testcase &lt; file.txt &gt; file.txt.gz\n</code></pre>\n\n<p>So I accept it from input. Inside the program, the stream is split up into\n\"Hello world!\" \"How are you?\" \"I'm ready to set fire to this assignment\" (they're not strings, it's just an array of bytes! this is just illustration)</p>\n\n<p>So I've got these three blocks of bytes, all uncompressed. I give each of these blocks to a thread, which uses</p>\n\n<pre><code>public static class DGZIPOutputStream extends GZIPOutputStream\n{\n    public DGZIPOutputStream(OutputStream out, boolean flush) throws IOException\n    {\n        super(out, flush);\n    }\n    public void setDictionary(byte[] b)\n    {\n        def.setDictionary(b);\n    }\n    public void updateCRC(byte[] input)\n    {\n        crc.update(input);\n    }                       \n}\n</code></pre>\n\n<p>As you can see, the only thing here is that I've set the flush to SYNC_FLUSH so I can get the alignment right and have the ability to set the dictionary. If each thread were to use DGZIPOutputStream (which I've tested and it works for one long continuous input), and I concatenated those three blocks (now compressed each with a header and trailer), would gzip -d file.txt.gz work?</p>\n\n<p>If that's too weird, ignore the dictionary completely. It doesn't really matter. I just added it in while I was at it.</p>\n"},{"tags":["vb.net","multithreading","progress-bar","backgroundworker","invokerequired"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12533412,"title":"Multithreading for a progressbar and code locations (vb.net)?","body":"<p>I am stuck updating a progressbar from a different thread.\nI did get it running in the simplest way, but then cleaning the code gets me stuck.</p>\n\n<p>My testing code looks like all the examples on the web related to backgroundworker and BeginInvoke.</p>\n\n<p>FormP is the Progressbar-Form.\nThis works:</p>\n\n<p><code>\nPublic Class Form1</p>\n\n<pre><code>Private Delegate Sub delegate_ProgressUpdate(ByVal paramValue As Integer, ByVal paramMax As Integer)\n\nPrivate Sub Button1_Click(sender As System.Object, e As System.EventArgs) Handles Button1.Click\n    ' Test 01:\n    ' Show Progressbar via BGW\n    ' All functions are within Form1\n    Dim bgw As New BackgroundWorker()\n    AddHandler bgw.DoWork, AddressOf BGW_Sample01_DoWork\n\n    FormP.Show(Me)\n    bgw.RunWorkerAsync()\nEnd Sub\n\nPrivate Sub invokeMe_ProgressUpdate(ByVal paramValue As Integer, ByVal paramMax As Integer)\n    FormP.ProgressBar1.Maximum = paramMax\n    FormP.ProgressBar1.Value = paramValue\n    FormP.ProgressBar1.Update()\nEnd Sub\n\nPrivate Sub BGW_Sample01_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs)\n    For i As Integer = 1 To 10\n        Threading.Thread.Sleep(500) ' Test delay\n        Me.BeginInvoke(New delegate_ProgressUpdate(AddressOf invokeMe_ProgressUpdate),\n                       i, 10)\n    Next\n    MessageBox.Show(\"Fertig\")\nEnd Sub\n</code></pre>\n\n<p></code></p>\n\n<p>If I try to make things work more orderly encapsulated in FormP, it doesn't work.</p>\n\n<p><code>\n</p>\n\n<pre><code>Private Sub Button2_Click(sender As System.Object, e As System.EventArgs) Handles Button2.Click\n    Dim bgw As New BackgroundWorker\n    AddHandler bgw.DoWork, AddressOf BGW_Sample02_DoWork\n    FormP.Show(Me)\n    bgw.RunWorkerAsync()\nEnd Sub\n\nPrivate Sub BGW_Sample02_DoWork(sender As Object, e As System.ComponentModel.DoWorkEventArgs)\n    For i As Integer = 1 To 10\n        Threading.Thread.Sleep(500)\n        FormP.SetProgress(i, 10)\n    Next\n    MessageBox.Show(\"Fertig\")\nEnd Sub\n</code></pre>\n\n<p>' ########## FormP #################</p>\n\n<p>Public Class FormP</p>\n\n<pre><code>Private Delegate Sub delegate_ProgressUpdate(ByVal value As Integer, ByVal maximum As Integer)\n\nPublic Sub SetProgress(ByVal paramValue As Integer, ByVal paramMaximum As Integer)\n    If Me.InvokeRequired Then\n        Me.Invoke(New delegate_ProgressUpdate(AddressOf Me.SetProgress), paramValue, paramMaximum)\n    Else\n        Me.ProgressBar1.Maximum = paramMaximum\n        Me.ProgressBar1.Value = paramValue\n        Me.ProgressBar1.Update()\n    End If\nEnd Sub\n</code></pre>\n\n<p>End Class\n</code></p>\n\n<p>FormP does not freeze, but UI is not updated.\nActually Me.InvokeRequired is false and I think that's where I begin to miss some important parts.\nI tried Form1.InvokeRequired here, but it's false as well.\nMy understanding is: the calling thread here is the bgw thread, no matter in what class the code is that this thread calls...\nThat seems not to be it?</p>\n\n<p>Thanks for any thoughts.</p>\n\n<p>Michael</p>\n"},{"tags":["vb.net","multithreading","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13106373,"title":"accessing datatable and variables inside Backgroundworker","body":"<p>in my program i use a Datatable which is filled at loading of form. And i use backgroundworker to do some network operations. Inside doWork() of backgroundworker i need data from datatable and also object of a class that i created in loading of form. Data in datatable and class object is updated inside Dowork() and also this values from datatable and class object is updated in a listivew in ProgressChanged of backgroundworker.\nBoth datatable and class object is declared global to Form1.\nBut i read this is not thread safe.So how to use in correct to use it in thread safe way?</p>\n"},{"tags":["java","multithreading","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13111007,"title":"Java- Assigning finished thread objects to new threads","body":"<p>Ok, the wording of the title is a bit odd but I didn't really know how to express it. Basically, from what I understand about Java and threads is you make a thread, it runs, it dies. However, the thread OBJECT is still there. What I want to know if something like this is valid</p>\n\n<pre><code>int numWorkers = Integer.parseInt(args[0]);\nint threadPoolSize = Integer.parseInt(args[1]);\nExecutorService tpes = Executors.newFixedThreadPool(threadPoolSize);\nWorkerThread[] workers = new WorkerThread[numWorkers];\nwhile(some condition)    \n    for (int i = 0; i &lt; numWorkers; i++) {\n        workers[i] = new WorkerThread(i, *some changing parameters*);\n        tpes.execute(workers[i]);\n    }\n</code></pre>\n\n<p>Basically what this situation is that we have some condition that we don't know when it will be satisfied. Let's say I'm using 8 threads. I create all 8 threads, they do their thing and return. I put their results together and realize I'm not done yet. However, for example, workers[0] already exists. I created it with a new WorkerThread() call. But it's dead now since it's done running. If I were to call, AGAIN, workers[0] = new WorkerThread(0, <em>new parameter</em>)...is that allowed? I need more threads, I have an array already of (now) dead threads...can I just point them at something else? Do the old threads get properly collected by the GC?</p>\n"},{"tags":["java","multithreading","threadpool","executor"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13110313,"title":"Java- FixedThreadPool with known pool size but unknown workers","body":"<p>So I think I sort of understand how fixed thread pools work (using the Executor.fixedThreadPool built into Java), but from what I can see, there's usually a set number of jobs you want done and you know how many to when you start the program. For example</p>\n\n<pre><code>int numWorkers = Integer.parseInt(args[0]);\nint threadPoolSize = Integer.parseInt(args[1]);\nExecutorService tpes =\n    Executors.newFixedThreadPool(threadPoolSize);\nWorkerThread[] workers = new WorkerThread[numWorkers];\nfor (int i = 0; i &lt; numWorkers; i++) {\n    workers[i] = new WorkerThread(i);\n    tpes.execute(workers[i]);\n}\n</code></pre>\n\n<p>Where each workerThread does something really simple,that part is arbitrary. What I want to know is, what if you have a fixed pool size (say 8 max) but you don't know how many workers you'll need to finish the task until runtime.</p>\n\n<p>The specific example is: If I have a pool size of 8 and I'm reading from standard input. As I read, I split the input into blocks of a set size. Each one of these blocks is given to a thread (along with some other information) so that they can compress it. As such, I don't know how many threads I'll need to create as I need to keep going until I reach the end of the input. I also have to somehow ensure that the data stays in the same order. If thread 2 finishes before thread 1 and just submits its work, my data will be out of order!</p>\n\n<p>Would a thread pool be the wrong approach in this situation then? It seems like it'd be great (since I can't use more than 8 threads at a time).</p>\n\n<p>Basically, I want to do something like this:</p>\n\n<pre><code>ExecutorService tpes = Executors.newFixedThreadPool(threadPoolSize);\nBufferedInputStream inBytes = new BufferedInputStream(System.in);\nbyte[] buff = new byte[BLOCK_SIZE];\nbyte[] dict = new byte[DICT_SIZE];\nWorkerThread worker;\nint bytesRead = 0;\n\nwhile((bytesRead = inBytes.read(buff)) != -1) {\n   System.arraycopy(buff, BLOCK_SIZE-DICT_SIZE, dict, 0, DICT_SIZE);\n   worker = new WorkerThread(buff, dict)   \n   tpes.execute(worker);\n}\n</code></pre>\n\n<p>This is not working code, I know, but I'm just trying to illustrate what I want.</p>\n\n<p>I left out a bit, but see how buff and dict have changing values and that I don't know how long the input is. I don't think I can't actually do this thought because, well worker already exists after the first call! I can't just say worker = new WorkerThread a bunch of time since isn't it already pointing towards an existing thread (true, a thread that might be dead) and obviously in this implemenation if it did work I wouldn't be running in parallel. But my point is, I want to keep creating threads until I hit the max pool size, wait till a thread is done, then keep creating threads until I hit the end of the input.</p>\n\n<p>I also need to keep stuff in order, which is the part that's really annoying.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":13109587,"title":"How to control threads to print in certain order in JAVA?","body":"<p>There is one class which extends Thread and it takes \"Symbol\"(Clubs, Heart, Dice, Spade) as a parameter in its constructor.\nWe've four threads of this type one each for each symbol. Now they want to print as given below:</p>\n\n<p>Dice A\nHearts A\nSpade A\nClubs A\nDice 2\nHearts 2\nSpade 2\nClubs 2\n.\n.\nand so on till J, Q, K for all the symbols</p>\n\n<p>How to achieve this. I thought of using wait/notify, but we've to some how make sure that each thread takes turn in a particular order and also we've to continue printing for all the values A, 2, 3, ... , 10, J, Q, K.</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":13109929,"title":"Make a part of a java program wait... not the whole program","body":"<p>I have a flower game that is supposed to drop flowers at predetermined times. I have a level class and level1() is a method. Inside the level1 method i use...</p>\n\n<pre><code>Thread.wait(10000);\n</code></pre>\n\n<p>but it makes the whole program wait until it hits that mark. I want the program to load up then do the wait. I also tried...</p>\n\n<pre><code>public static void waiting(int n) {        \n    long t0, t1;\n\n    t0 = System.currentTimeMillis();\n\n    do{\n        t1 = System.currentTimeMillis();\n    }\n    while (t1 - t0 &lt; n);\n}\n</code></pre>\n\n<p>But it does not make any difference either. Is there a better way to do this?\nHere is the methods code...</p>\n\n<pre><code>    package net.blockydigital;\n\n    public class Level {\n        RedFlower rf;\n        PinkFlower pf;\n        WhiteFlower wf;\n        YellowFlower yf;\n        public Level(){\n            rf = new RedFlower();\n            pf = new PinkFlower();\n            wf = new WhiteFlower();\n            yf = new YellowFlower();\n        }\n        public void level1(){\n            try{\n            Thread.sleep(10000);\n            }catch(Exception e){\n                e.printStackTrace();\n            }\n            rf.dropFlower();\n        }\n     }    \n</code></pre>\n\n<p>And then this is where i call the code...</p>\n\n<pre><code>    public PlayGame(){\n    sc = new ShoppingCart();\n    pf = new PinkFlower();\n    rf = new RedFlower();\n    wf = new WhiteFlower();\n    yf = new YellowFlower();\n    s = new Shoes();\n    l = new Level();\n    addKeyListener(new AL());\n    setFocusable(true);\n    setBackground(Color.WHITE);\n    clock = new Timer(5, this);\n    clock.start();\n    l.level1();\n}\n</code></pre>\n\n<p>I hope adding this code helps!!!</p>\n"},{"tags":["java","multithreading","java-ee","thread-safety","ejb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13109489,"title":"Creating Message Listener pool with Executers","body":"<p>I had to create a message Listener (for some jms topic) in a stand alone application.\nSince each message I receive has to do some processing. </p>\n\n<p>This behavior delaying my whole performance. </p>\n\n<p>So I decided to create kind of POOL to my message listeners. (as in MDB'S in ejb's).</p>\n\n<p>I started using Executor class(Java) this way:</p>\n\n<pre><code>import java.util.concurrent.Executor;\nimport java.util.concurrent.Executors; \n\n    private Executor threadPool = Executors.newCachedThreadPool();\n    @Override\n    public void onMessage(final Message msg)\n    {\n        Runnable t = new Runnable()\n        {\n            public void run()\n            {\n                execute(msg);\n                log.trace(received messge\");\n            }\n        };\n        threadPool.execute(t);\n    }\n\npublic void execute(Message msg)\n{\n   // do some long running process)\n}\n</code></pre>\n\n<p>In this way I make sure my application wont stuck from one message to another while processing by creating separate Thread for each execution.</p>\n\n<p>I would like to have your suggestions by your experience.. \nis that kind if implementation might cause any future problems? on what should I pay attention(I know concurrency is an issue)? </p>\n"},{"tags":["android","multithreading","google-maps"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12985135,"title":"Hcreate thread inside a android map","body":"<p>Im trying to implement an Android app, \nIn the main activity it's displaying a google map , and Im trying to implement a Video view also on the same layout .\nSo With in the main map activity (while map is displaying) im trying to implement a thread which will invoke the videoview activity(to do recording) below the map view at the same time.</p>\n\n<p>Is this possible ?\nbecause Im getting lot of errors.\nPlease can anyone help me..?\nThanks</p>\n\n<p>public class MainActivity extends MapActivity implements Runnable{</p>\n\n<pre><code>private MapView mapView;\nprivate MyLocationOverlay myLocationOverlay;\nprivate Button playerbtn;//button to start player\nprivate Button recorderbtn;//button for recorder\nprivate VideoView mVideoView;\nprivate Uri mVideoUri;\n\n/** Called when the activity is first created. */\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    mVideoView = (VideoView) findViewById(R.id.videoview);\n    playerbtn= (Button)findViewById(R.id.playback);\n    recorderbtn = (Button)findViewById(R.id.recording);\n\n    // main.xml contains a MapView\n    setContentView(R.layout.main); \n\n    // extract MapView from layout\n    mapView = (MapView) findViewById(R.id.mapview);\n    mapView.setBuiltInZoomControls(true);\n\n    // create an overlay that shows our current location\n    myLocationOverlay = new FixedMyLocationOverlay(this, mapView);\n\n    // add this overlay to the MapView and refresh it\n    mapView.getOverlays().add(myLocationOverlay);\n    mapView.postInvalidate();\n\n    // call convenience method that zooms map on our location\n    zoomToMyLocation();\n\n\n\n}\n\n//--videoview\n\npublic void recordingListner(View view) {\n\n    Thread toRun = new Thread()\n       {\n              public void run()\n              {\n\n                 final Intent intent = new Intent(MainActivity.this, VideoRecorder.class);\n                handleCameraVideo(intent);\n                startActivity(intent);    \n\n              }\n       };\n       toRun.start(); \n</code></pre>\n\n<p>}</p>\n\n<pre><code>private void handleCameraVideo(Intent intent) {\n    mVideoUri = intent.getData();\n    mVideoView.setVideoURI(mVideoUri);\n    mVideoView.setVisibility(View.VISIBLE);\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13109391,"title":"definition of variable","body":"<p>I have problem with declaration of variable. iam trying  to prepare code using Multi threading\nbut i have problem with declaration of variable. Now iam  confused, whether is possible to put Scanner into second not main class- i suppose that yes, but i don´t know how declare variable. Exception is - <strong><em>Exception in thread \"main\" java.lang.RuntimeException: Uncompilable source code - non-static variable this cannot be referenced from a static context</em></strong>\n    at test1.PIN.main ...</p>\n\n<pre><code>public class PIN{\n\n    static int a;\n\nclass Runner extends Thread{\n\npublic void run(){\n\n    Scanner sc = new Scanner(System.in);\n    for(int i= 1; i&lt;4; i++){\n    System.out.println(\"PUT your PIN: \");\n    int a = sc.nextInt();\n\n                try {\n                    Thread.sleep(100);\n                } catch (InterruptedException ex) {\n                    Logger.getLogger(PIN.class.getName()).log(Level.SEVERE, null, ex);\n                }\n\n if(a ==1234){\n     System.out.println(\"PIN  OK\");\n } else {System.out.println(\"PIN NOK\");}   \n\n}\n}\n}\n\npublic static void main(String[] args){\n\n    Runner r = new Runner();\n    r.start();\n</code></pre>\n"},{"tags":["c++","multithreading","c++11"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":569,"score":4,"question_id":10673585,"title":"Start thread with member function","body":"<p>I am trying to execute a <code>std::thread</code> with a member function which is <code>void()</code>. I can't figure out any syntax where it works - the compiler complains no matter what. What is the correct way to spawn a no-arg member function via <code>std::thread</code>?</p>\n\n<pre><code>#include &lt;thread&gt;\nclass blub {\n  void test() {\n  }\npublic:\n  std::thread spawn() {\n    return std::thread(test);\n  }\n};\n</code></pre>\n"},{"tags":["android","multithreading","audio","real-time","signal-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13108845,"title":"how to implement real-time audio processing on android?","body":"<p>I'm trying to implement and audio processor and android, where the input will be sine wave generated, and then some effects will be impemented (echo, distortion, etc.) so how should I design my application regarding threading and buffering.</p>\n\n<p>Please help if there is any architecture that should be followed</p>\n"},{"tags":["java","multithreading","synchronized"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13108824,"title":"get unexpected values using synchronize","body":"<p>I have a simple snippet of code and try to experiment a little with it, but in the next code I get unclear for me order of output data:</p>\n\n<pre><code>public class Main {\n\n    static int n = 100;\n\n    public static synchronized int decreaseValue(){\n        return --n;\n    }\n\n    public static void main(String[] args) throws InterruptedException, IOException {\n\n\n        Thread t1 = new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while(true){\n                    try {\n                        System.out.println(\"Thread1: \"+ decreaseValue());\n                        Thread.sleep(2000);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        },\"Thread1\");\n        t1.start(); \n\n        Thread t2 = new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while(true){\n                    try {\n                        System.out.println(\"Thread2: \"+ decreaseValue());\n                        Thread.sleep(2000);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        },\"Thread2\");\n        t2.start();\n\n\n        while(true){\n            try {\n                System.out.println(\"Main Thread: \"+ decreaseValue());\n                Thread.sleep(2000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Can not understand, why I get the such values in the next order:</p>\n\n<p>Thread1: 89\n        Thread2: 90\n        Main Thread: 88</p>\n\n<p>PLEASE PAY ATTENTION TO THE N VALUE NOT TO THE ORDER OF CALLING THREADS:</p>\n\n<pre><code>Thread1: 99\nThread2: 98\nMain Thread: 97\nMain Thread: 95\nThread2: 94\nThread1: 96\nMain Thread: 92\n</code></pre>\n"}]}
{"total":30059,"page":7,"pagesize":100,"questions":[{"tags":["c#","multithreading",".net-3.5","backgroundworker"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1340,"score":3,"question_id":6108485,"title":"c# backgroundWorker not raising ProgressChanged or RunWorkerCompleted events","body":"<p>Using C# .NET 3.5.</p>\n\n<p>It seems I'm not the only one, since a search seems to bring up a lot of similar questions, however reading through them I seem still to be missing the solution.</p>\n\n<p>I'm raising an event with a button click on my UI, which is then supposed to start a backgroundWorker to get some time consuming work done - in this case, I want it to collect information from a form and a) write to an xml file as well as b) insert the information into a remote database.</p>\n\n<p>This is exactly what the backgroundWorker was designed and intended to do I believe.</p>\n\n<p>Here is the event raising code.</p>\n\n<pre><code>private void btnFinish_Click(object sender, EventArgs e)\n{\n    clkFinish.setInstant();\n    curAct.setTimeFinish(DateTime.Now);\n    btnStart.Enabled = true;\n    bgwDataWorker.RunWorkerAsync();\n    for (int i = 0; i &lt; 20; i++)\n    {\n        Console.WriteLine(\"Thread a: \" + i);\n        Thread.Sleep(100);\n        if (i == (20 - 1))\n        {\n            Console.WriteLine(\"Finished\");\n        }\n    }\n\n}\n</code></pre>\n\n<p>As you can see, I have some code there which I've used as a counterbalance to the background worker code, which is here:</p>\n\n<pre><code>private void bgwDataWorker_DoWork(object sender, DoWorkEventArgs e)\n{\n    Console.WriteLine(\"Running in a different thread now\");\n    int count = 0;\n    for (int i = 0; i &lt; 21; i++)\n    {\n        Console.WriteLine(\"Thread b: \" + i);\n        Thread.Sleep(100);\n        (sender as BackgroundWorker).ReportProgress(5 * i, null);\n        if (i == (21 - 1))\n        {\n            count = i;\n        }\n    }\n    e.Result = count;\n}\n</code></pre>\n\n<p>So far, everything seems to be working up to this point.</p>\n\n<p>My problem is that when the code in the DoWork method is finished, nothing is happening. Here are the ProgressChanged and RunWorkerComplete methods.</p>\n\n<pre><code>private void bgwDataWorker_ProgressChanged(object sender, ProgressChangedEventArgs e)\n{\n    Console.WriteLine(e.ProgressPercentage);\n}\n\nprivate void bgwDataWorker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n{\n    Console.WriteLine(\"Result is \" + e.Result.ToString());\n\n}\n</code></pre>\n\n<p>This has me baffled. </p>\n\n<p>I've tried running the <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker%28v=VS.90%29.aspx\" rel=\"nofollow\">examples from MSDN</a> and I'm experiencing the same problems. RunWorkerCompleted and ReportProgress events are simply not being raised for some reason and I don't understand why.</p>\n\n<p>Thanks for reading.</p>\n\n<p>Alan</p>\n"},{"tags":["c#","multithreading","timer"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":2042,"score":5,"question_id":3641147,"title":"Object Disposed exception and multi thread application","body":"<p>I have an application that start System.Threading.Timer, then this timer every 5 seconds read some information from a linked database and update GUI on main form of application;</p>\n\n<p>Since the System.Threading.Timer create another thread for the Tick event, i need to use Object.Invoke for updating User Interface on the main Form of application with code like this :</p>\n\n<pre><code>this.Invoke((MethodInvoker)delegate()\n  {\n       label1.Text = \"Example\";\n  });\n</code></pre>\n\n<p>The app work very well, but sometimes when the user close the main form and then close the application, if the second thread on timer_tick event is updating the user interface on main thread the user get an ObjectDisposedException.</p>\n\n<p>How can i do for stop and close the threading timer before closing the main form and avoiding then Object disposed exception ?</p>\n"},{"tags":["java","android","multithreading","bluetooth"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13103940,"title":"socket already in closing state - Android Bluetooth","body":"<p>This is my first question here, i hope you can help me.\nI've devoloped an android app that use the bluetooth comunication(i'm using the sample BluetoothChatService) to send something to a server, but in logcat i see this strange ,essage, when it's connected(setState() 2 -> 3), LogCat show me that socket already in closing state and i'cant send nothing and the application on the server side doesn't receive what i try to send.</p>\n\n<pre><code>10-27 22:23:38.859: I/BluetoothChatService(16586): END mAcceptThread, socket Type:Secure\n10-27 22:23:38.869: D/BluetoothChatService(16586): setState() 2 -&gt; 3\n10-27 22:23:38.869: I/BluetoothChatService(16586): BEGIN mConnectedThread\n10-27 22:23:52.699: D/BluetoothSocket(16586): socket already in closing state:android.bluetooth.BluetoothSocket@405308f8\n10-27 22:23:52.699: D/BluetoothSocket(16586): socket already in closing state:android.bluetooth.BluetoothSocket@40526d50\n10-27 22:23:52.699: D/BluetoothSocket(16586): socket already in closing state:android.bluetooth.BluetoothSocket@40525978\n</code></pre>\n\n<p><em>PS when i tried the debug i've seen that the state it was 1(LISTENING)...probably i've done a stupid mistake because is my first application using bluetooth</em></p>\n\n<p><strong>Thanks!</strong></p>\n\n<p>EDIT</p>\n\n<pre><code>public void CercaDispositivo()\n{\n    Set&lt;BluetoothDevice&gt; pairedDevices = bAdapter.getBondedDevices();\n\n    bCon=new BluetoothChatService(this);\n    // If there are paired devices, add each one to the ArrayAdapter\n    if (pairedDevices.size() &gt; 0) \n    {\n        for (BluetoothDevice device : pairedDevices) \n        {\n            bDev=device;\n            if(bCon.getState()==bCon.STATE_CONNECTED)\n                break;                  \n            Connetti();\n            BluetoothState.setText(\"Connected! :D\");\n            break;\n\n        }\n    } \n    else \n    {\n        BluetoothState.setText(\"No paired device!\");\n    }\n\n    return;\n}\n\npublic void Connetti()\n{\n\n    bCon.start();\n    bCon.connect(bDev, false);      \n    ReadyToComunicate=true;\n}\n</code></pre>\n\n<p><strong>2nd EDIT</strong></p>\n\n<p>Here is my BluetoothChatService MODIFIED by me: <a href=\"http://andysite.altervista.org/BluetoothChatService.java\" rel=\"nofollow\">BluetoothChatService.java</a></p>\n"},{"tags":["c","linux","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13108159,"title":"How to measure context switching on Linux?","body":"<p>I'm reading some google interview questions these days and one made me think, it's \n\"Write a C program to measure the time spent in context switch in Linux\".</p>\n\n<p>It has been discussed on the internet, and even here : <a href=\"http://stackoverflow.com/questions/2368384/write-a-c-program-to-measure-time-spent-in-context-switch-in-linux-os\">Write a C program to measure time spent in context switch in Linux OS</a></p>\n\n<p>I had an idea that wasn't discussed (to the best of my google-fu) : can I modify the kernel to measure time spent in context switch, recompile it, and then write a C program that trigger context switches, and use my custom kernel to do the measurement.</p>\n\n<p>Of course, doing so will probably introduce a bias, but it (the bias) mays be measured and/or estimated.</p>\n\n<p>Is there anything blatantly wrong in my reasoning?</p>\n\n<p>Sorry if this has already been discussed, or if the title is misleading.</p>\n"},{"tags":["java","multithreading","synchronization","mutex"],"answer_count":6,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":932,"score":8,"question_id":249867,"title":"Synchronising twice on the same object?","body":"<p>I was wondering if in Java I would get any odd behaviour if I synchronise twice on the same object?</p>\n\n<p>The scenario is as follows</p>\n\n<pre><code>pulbic class SillyClassName {\n\n    object moo;\n    ...\n    public void method1(){\n        synchronized(moo)\n        {\n            ....\n            method2();\n            ....\n        }\n    }\n\n    public void method2(){\n        synchronized(moo)\n        {\n            doStuff();\n        }\n    }\n}\n</code></pre>\n\n<p>Both methods use the object and are synchronised on it. Will the second method when called by the first method stop because it's locked?</p>\n\n<p>I don't think so because it's the same thread but I'm unsure of any other odd results that might occur.</p>\n"},{"tags":["c#","multithreading","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13105640,"title":"Asynchronous I/O with multiple thread C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10806951/how-to-limit-the-amount-of-concurrent-async-i-o-operations\">How to limit the amount of concurrent async I/O operations?</a>  </p>\n</blockquote>\n\n\n\n<p>Let say i have an string array</p>\n\n<pre><code>string[] domains = { \"domain1.com\", \"domain2.com\" ,..., \"domain100.com\"};\n</code></pre>\n\n<p>I want to write an app that use 5 threads to send request to those domains and save the response header to the same log file in order of started. For example:</p>\n\n<pre><code>Thread 1\ndomain1.com\nResponse header\n\n\nThread 2\ndomain2.com\nResponse header\n\n\nThread 3\ndomain3.com\nResponse header\n\nThread 4\ndomain4.com\nResponse header\n\n\nThread 5\ndomain5.com\nResponse header\n\n\nThread 1\ndomain6.com\nResponse header\n\nThread 2\ndomain7.com\nResponse header\n</code></pre>\n\n<p>I'm kind of new at programming multithread so hope you can help me out. Thanks a lot</p>\n"},{"tags":["mysql","sql","multithreading","parallel-processing"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13107086,"title":"Creating indexes concurrently in MySQL","body":"<p>I found a procedure in pl/sql that creates indexes with <strong>multiple threads</strong>:</p>\n\n<pre><code>declare l_job number;\nbegin\n    dbms_job.submit( l_job, 'execute immediate ''alter index idx1 rebuild'';' );\n    commit;\n    dbms_job.submit( l_job, 'execute immediate ''alter index idx2 rebuild'';' );\n    commit;\nend;\n</code></pre>\n\n<p>This procedure will be executed in parallel. </p>\n\n<p>Can I write such procedure in MySQL?  Can MySQL execute a procedure in a separate thread?</p>\n"},{"tags":["java","multithreading","compression"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13106585,"title":"Java- reusing a thread with the same run but different parameters","body":"<p>I still have some trouble wrapping my head around threads, and I'm trying to do this in the simplest way possible. I know that threads all have to have a run method they inherited from the Runnable class, but they can have additional methods as well, correct?</p>\n\n<p>The reason being, I have a thread with some private variables and a run method. It calls it's run function, and once it's done, I want to reuse the thread with the exact same run method. It does exactly the same thing, just with different variables. So can I add something like a setArray method (the thread contains a private byte array) so I can just simply call run again with this new array, or is that not allowed. I guess to put it simply, it'd be something like</p>\n\n<pre><code>Thread thread = new MyThread();\nthread.start();\n\n// Check if the thread has finished in a non-blocking way\nif (thread.isAlive() == false) {\n    thread.setArray(newArray)\n    thread.start();\n}\n</code></pre>\n\n<p>Basically I only have a fixed number of threads and when the first thread is done running, I want to change the parameters a bit and have it run again. I don't wan them to die, which seems to be what join does.</p>\n\n<p>For the specific problem, I have say 4 threads, that each are give a set size block of a larger byte array. Each thread compresses that array with a Deflater and passes their result to a manager object that handles the synchronization. Once the first thread (as in the thread that got the first part of the array, not the first to finish) is done, it moves on to the next block not assigned to a thread.</p>\n\n<p>I know thread pools are an option, but it seems a bit overkill plus I really don't understand them (I'm still having trouble with just normal threads).</p>\n"},{"tags":["android","multithreading","dialog","background"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3344,"score":1,"question_id":5186818,"title":"Android show dialog from background thread in any activity of application","body":"<p>I tried to look clear answer for it but wasn't able to find it anywhere. I am running background thread in main activity that checks for certain variable and if it is true it should show alert dialog. I also want this dialog to show up on any focused activity of the application. I tried it by adding Looper.prepare() and Looper.loop() to the thread but it does not work properly and it affects while() loop that I use to check variable in that thread. Can anyone please help me in finding out what is the best way to implement this? </p>\n\n<p>Thanks.</p>\n"},{"tags":["multithreading","event-driven","event-driven-design"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":1,"view_count":90,"score":4,"question_id":13106075,"title":"Why are threads so expensive, that event-driven non-blocking IO is better on benchmarks","body":"<p>I recently started learning about node.js, a javascript library on top of V8 known for its non-blocking IO and incredible speed.</p>\n\n<p>To my understanding, node does not wait for IO to respond, but runs an event loop (similar to a game loop) that keeps checking unfinished operations and continues/completes them as soon as IO responds. Node performance was compared to Apache HTTPD with node being significantly faster while using less memory.</p>\n\n<p>Now if you read about Apache, you learn it uses 1 thread per user, which supposedly slows it down significantly and this is where my question appears:</p>\n\n<p>If you compare threads to what node does internally in its event loop, you start seeing the similarities: Both are abstractions of an unfinished process that waits for a resource to respond, both check if the operation made progress regularly and then don't occupy the CPU for a certain amount of time (at least I think a good blocking API sleeps for a few milliseconds before rechecking).</p>\n\n<p>Now where is that striking, critical difference that makes threads so much worse?</p>\n"},{"tags":["c#","multithreading","lambda"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":2,"view_count":56,"score":1,"question_id":13105011,"title":"Lambda expression as ThreadStart strange behavior","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/512166/c-sharp-the-foreach-identifier-and-closures\">C# - The foreach identifier and closures</a><br>\n  <a href=\"http://stackoverflow.com/questions/3190578/from-eric-lipperts-blog-dont-close-over-the-loop-variable\">From Eric Lippert’s blog: “don’t close over the loop variable”</a>  </p>\n</blockquote>\n\n\n\n<p>I'm using a lambda expression as <code>ThreadStart</code> parameter, to run a method in a new thread using <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.thread%28v=vs.90%29.aspx\" rel=\"nofollow\">Thread</a> class. This is my code:</p>\n\n<pre><code>delegate void del();\n\nstatic void Do(int i)\n{\n    Console.WriteLine(i);\n}\n\nstatic del CreateLoop(del Do)\n{\n    return () =&gt;\n    {\n        while (true)\n        {\n            Do();\n            Thread.Sleep(500);\n        }\n    };\n}\n\nstatic void Main(string[] args)\n{\n    int n = 0;\n    var loop = CreateLoop(() =&gt; Do(n));\n    new Thread(() =&gt; loop()).Start();\n    Thread.Sleep(500);\n    n = 1;\n}\n</code></pre>\n\n<p>And this is the output:</p>\n\n<pre><code>0\n1\n1\n1\n...\n</code></pre>\n\n<p>How is it possible? <br>\nWhy if I change the value of my integer variable <code>n</code>, also changes the value of <code>i</code> (<code>Do</code>'s parameter)?</p>\n"},{"tags":["java","android","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13098245,"title":"How to draw a route in parallel with location on google maps","body":"<p>I am developing a google maps app in which I am collecting the gps traces of the device(vehicle) traversed. I would like to draw the route using these points in parallel,i.e, I would like to run another activity which draws on top of the google maps using mapoverlay. So, let me give examples.\nSuppose X is my main activity in which I would be collecting and saving in my local server. Y be another activity which should/will be called in the main activity(X) which draws the route from the collected data(pulling from my server) in sync to activity X.\nHow can I do that. Should I implement threads or do I need to call mapoverlay which extends overlay in onLocationUpdates method. Can some one please update me with an example?\nThanks</p>\n"},{"tags":["c#","multithreading","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13105726,"title":"run foreach loop via parallel to build result list","body":"<p>I am looping thro data from tblCustomer and checking if the address is valid or not. If not, then I am adding this to my return list.\nThe problem, there are 37000 rows to validate. The validation is done via external library. It's taking about 1hr. I want to do this threaded so I can do it much faster.\nCan someone help me rewrite it? Also I read somewhere to wrap this in parallel class for or foreach. Few things that I am wondering - </p>\n\n<ol>\n<li><p>how many threads will it create? how can we control that? </p></li>\n<li><p>can we say how many records each thread will process? </p></li>\n<li><p>and I think the most imp question: this dll has static class that will validate the address. Is it going to give me any performance gain when I split it into threads..or will it take the same time?</p></li>\n</ol>\n\n<hr>\n\n<pre><code> List&lt;tblCustomer&gt; customers = new List&lt;tblCustomer&gt;();\n            int i = 0;\n            foreach (var customer in DataContext.tblCustomers)\n            {\n                string addressToValidate = string.Format(\"{0}, {1}; {2} {3}\", GetSafeString(customer.MailingCity), GetSafeString(customer.MailingState), GetSafeString(customer.MailingAddress), GetSafeString(customer.MailingAddress2));\n                isTripValid = PCM.PCMSAddStop(tripId, addressToValidate.Trim()) == 1;\n                if (!isTripValid)\n                { \n                    customers.Add(customer);\n                }\n                i++;\n                if (i == 1000)\n                {\n                    PCM.PCMSClearStops(tripId);\n                    i = 0;\n                }\n            }\n            PCM.PCMSCloseServer(serverID);\n            PCM.PCMSDeleteTrip(tripId);\n\n            return customers;\n</code></pre>\n"},{"tags":["vb.net","visual-studio-2010","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5458,"score":2,"question_id":2240702,"title":"Crossthread operation not valid... - VB.NET","body":"<p>I am using vb.net, and in my program I get this 'crossthread operation not valid' error when I run my backgroundworker that will make this textbox enabled true. My main sub will first turn the enabled to false, and when the backgroundworker runs it will turn it back true then exit. Why does it give me an error? FYI: There is more code to this but I don't want to make it any more confusing...</p>\n\n<p>Here is the stack trace:</p>\n\n<pre><code>at System.Windows.Forms.Control.get_Handle()\n   at System.Windows.Forms.Control.OnEnabledChanged(EventArgs e)\n   at System.Windows.Forms.Control.set_Enabled(Boolean value)\n   at Helium.Form1.BackgroundWorker1_DoWork(Object sender, DoWorkEventArgs e) in C:\\Users\\Kevin\\documents\\visual studio 2010\\Projects\\Helium\\Helium\\Form1.vb:line 167\n   at System.ComponentModel.BackgroundWorker.OnDoWork(DoWorkEventArgs e)\n   at System.ComponentModel.BackgroundWorker.WorkerThreadStart(Object argument)\n</code></pre>\n\n<p>and here is the exact error message:</p>\n\n<pre><code>{\"Cross-thread operation not valid: Control 'mainText' accessed from a thread other than the thread it was created on.\"}\n</code></pre>\n\n<p>Can someone please help me out! </p>\n\n<p>Thanks,</p>\n\n<p>KEvin</p>\n"},{"tags":["c","multithreading","operating-system","deadlock"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":63,"score":0,"question_id":13103999,"title":"Simulating deadlock of threads in C","body":"<p>This is just the beginning of a bigger simulation. The idea is to have 3 threads and 2 files and a deadlock would appear with the usual conditions and I have hard coded just that specifically. </p>\n\n<p>It happens that the threads run and then the process aborts on the console with Abort (core dumped). I have the output below... Is this a deadlock?? My apologies for not getting the output in the preferred format but the backtraces to the memory are not being easy to format. </p>\n\n<pre><code>Time Interval 4000250\n*** glibc detected *** ./a.out: double free or corruption (out): 0x00007fa2dc000b00 *** \n ======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x7e626)[0x7fa2e351d626]\n/lib/x86_64-linux-gnu/libc.so.6(fclose+0x155)[0x7fa2e350d2a5]\n./a.out[0x400a05]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x7e9a)[0x7fa2e3863e9a]\n/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7fa2e35914bd]\n======= Memory map: ========\n00400000-00401000 r-xp 00000000 07:00 163351                              /home/kartheek    /Desktop/a.out\n00601000-00602000 r--p 00001000 07:00 163351                             /home/kartheek    /Desktop/a.out\n</code></pre>\n\n<p>00602000-00603000 rw-p 00002000 07:00 163351                             /home/kartheek/Desktop/a.out\n    00923000-00944000 rw-p 00000000 00:00 0                                  [heap]\n    7fa2d4000000-7fa2d4021000 rw-p 00000000 00:00 0 \n    7fa2d4021000-7fa2d8000000 ---p 00000000 00:00 0 \n    7fa2dc000000-7fa2dc021000 rw-p 00000000 00:00 0 \n    7fa2dc021000-7fa2e0000000 ---p 00000000 00:00 0 \n    7fa2e2287000-7fa2e229c000 r-xp 00000000 07:00 4805                       /lib/x86_64-    linux-gnu/libgcc_s.so.1\n    7fa2e229c000-7fa2e249b000 ---p 00015000 07:00 4805                       /lib/x86_64-    linux-gnu/libgcc_s.so.1\n    7fa2e249b000-7fa2e249c000 r--p 00014000 07:00 4805                       /lib/x86_64-    linux-gnu/libgcc_s.so.1\n7fa2e249c000-7fa2e249d000 rw-p 00015000 07:00 4805                       /lib/x86_64-linux-gnu/libgcc_s.so.1\n7fa2e249d000-7fa2e249e000 ---p 00000000 00:00 0 \n7fa2e249e000-7fa2e2c9e000 rw-p 00000000 00:00 0 \n7fa2e2c9e000-7fa2e2c9f000 ---p 00000000 00:00 0 \n7fa2e2c9f000-7fa2e349f000 rw-p 00000000 00:00 0 \n7fa2e349f000-7fa2e3652000 r-xp 00000000 07:00 4784                       /lib/x86_64-linux-gnu/libc-2.15.so\n7fa2e3652000-7fa2e3851000 ---p 001b3000 07:00 4784                       /lib/x86_64-linux-gnu/libc-2.15.so\n7fa2e3851000-7fa2e3855000 r--p 001b2000 07:00 4784                       /lib/x86_64-linux-gnu/libc-2.15.so\n7fa2e3855000-7fa2e3857000 rw-p 001b6000 07:00 4784                       /lib/x86_64-linux-gnu/libc-2.15.so\n7fa2e3857000-7fa2e385c000 rw-p 00000000 00:00 0 \n7fa2e385c000-7fa2e3874000 r-xp 00000000 07:00 4864                       /lib/x86_64-linux-gnu/libpthread-2.15.so\n7fa2e3874000-7fa2e3a73000 ---p 00018000 07:00 4864                       /lib/x86_64-linux-gnu/libpthread-2.15.so\n7fa2e3a73000-7fa2e3a74000 r--p 00017000 07:00 4864                       /lib/x86_64-linux-gnu/libpthread-2.15.so\n7fa2e3a74000-7fa2e3a75000 rw-p 00018000 07:00 4864                       /lib/x86_64-linux-gnu/libpthread-2.15.so\n7fa2e3a75000-7fa2e3a79000 rw-p 00000000 00:00 0 \n7fa2e3a79000-7fa2e3a9b000 r-xp 00000000 07:00 4764                       /lib/x86_64-linux-gnu/ld-2.15.so\n7fa2e3c80000-7fa2e3c83000 rw-p 00000000 00:00 0 \n7fa2e3c97000-7fa2e3c9b000 rw-p 00000000 00:00 0 \n7fa2e3c9b000-7fa2e3c9c000 r--p 00022000 07:00 4764                       /lib/x86_64-linux-gnu/ld-2.15.so\n7fa2e3c9c000-7fa2e3c9e000 rw-p 00023000 07:00 4764                       /lib/x86_64-linux-gnu/ld-2.15.so\n7fffa77ef000-7fffa7810000 rw-p 00000000 00:00 0                          [stack]\n7fffa784f000-7fffa7850000 r-xp 00000000 00:00 0                          [vdso]\nffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]\nAborted (core dumped)</p>\n\n<p>I don't know what that means in the output but the fact that it says Aborted puts me to think that I might be close. </p>\n\n<p>The code works as:</p>\n\n<p>Create the threads\nThread1 accesses file1 and waits in written mode\nThread2 also accesses file1 and tries to make changes to it and then this is what happens</p>\n\n<p>Now, the next step is to create a monitor thread that will run at a higher priority. Is there anyway to allow the deadlock to occur and then free it? I mean, I have in mind one solution where with the help of mutex conditions, we can check for a clashing situation, but that would be deadlock avoidance, something that I do not want. Is there anyway to allow the deadlock to occur and then prevent the abortion of the program so that the monitor thread can free the resources accordingly???</p>\n\n<p>Here is the code please. Again, apologies for the formatting.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;pthread.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;sched.h&gt;\n\nFILE *fp1;\nFILE *fp2;\nstruct sched_param schedparam1,schedparam2,schedparam3;\nint policy=SCHED_RR;\nint mutex1[3]= {0,0,0},mutex2[3]= {0,0,0};\n\nvoid *routine1(void *arg)\n{\nint a;\nprintf(\"before\");\nfp1= fopen(\"file1.txt\", \"w\");\nusleep(250000);\nprintf(\"woke up\");\nfp2= fopen(\"file2.txt\", \"w\");\na=fclose(fp1);\nprintf(\"%d\\n\",a);\nfclose(fp2);\n}\n\nvoid *routine2(void *arg)\n{\nprintf(\"asdasd\");\nfp2=fopen(\"file2.txt\",  \"w\");\nfp1=fopen(\"file1.txt\",  \"w\");\nfclose(fp1);\nfclose(fp2);\n}\n</code></pre>\n\n<p>//void *monitor_function(void *arg)\n//{</p>\n\n<pre><code>void main()\n{\npthread_t thread1, thread2, thread3,thread4;\npthread_attr_t at1,at2,at3;\nint iret1, iret2,iret3,iret4;\nstruct timespec tp;\nschedparam1.sched_priority = 10;\nsched_setscheduler(getpid(),policy,&amp;schedparam1);\nsched_rr_get_interval(getpid(),&amp;tp);\n\nprintf(\"\\nTime Interval %ld\\n\",tp.tv_nsec);\n\\\nprintf(\"test\");\n\nschedparam1.sched_priority = 10; //Set Nice value of Thread\nschedparam2.sched_priority = 10;\nschedparam3.sched_priority = 10;\n\n/* Set attributes*/\n\n\npthread_attr_init(&amp;at1);\npthread_attr_setinheritsched(&amp;at1, PTHREAD_INHERIT_SCHED); // To inherit parent thread     properties use PTHREAD_INHERIT_SCHED\npthread_attr_setschedpolicy(&amp;at1, policy);\npthread_attr_setschedparam(&amp;at1, &amp;schedparam1);\n\n\npthread_attr_init(&amp;at2);\npthread_attr_setinheritsched(&amp;at2, PTHREAD_INHERIT_SCHED);\npthread_attr_setschedpolicy(&amp;at2,policy);\npthread_attr_setschedparam(&amp;at2, &amp;schedparam2);\n\npthread_attr_init(&amp;at3);\npthread_attr_setinheritsched(&amp;at3, PTHREAD_INHERIT_SCHED);\npthread_attr_setschedpolicy(&amp;at3, policy);\npthread_attr_setschedparam(&amp;at3, &amp;schedparam3);\n\n//iret1 = pthread_create( &amp;thread1, &amp;at1, monitor_function,NULL);\n\niret2 = pthread_create( &amp;thread2,&amp;at1, routine1,NULL);\niret3 = pthread_create( &amp;thread3,&amp;at2, routine2,NULL);\n//iret4 = pthread_create( &amp;thread4,&amp;at3, NULL,NULL);\n\n\npthread_join( thread2, NULL);\npthread_join( thread3, NULL);\n//pthread_join( thread1, NULL);\n\nprintf(\"\\nThread create 1 returns: %d\\n\",iret1);\n\nprintf(\"Thread create 2 returns: %d\\n\",iret2);\nprintf(\"Thread create 3 returns: %d\\n\",iret3);\nexit(0);\n\n\n\n//fp1= fopen(\"file1.txt\", \"w\");\n//fp2= fopen(\"file2.txt\", \"w\");\n\n}\n</code></pre>\n"},{"tags":["java","multithreading","tcp"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":13105488,"title":"Java TCP Multi-thread issue","body":"<p>My program works fine and many users can connect and send commands to the server.\nBut when a user spams the server with commands the server blocks out all other clients and the server doesn't receive messages from clients other than the one that spammed.\nWhy is this?</p>\n\n<p>TCPAccept Connections</p>\n\n<hr>\n\n<pre><code>    package game.server;\n\nimport java.io.IOException;\nimport java.net.Socket;\n\npublic class TCPAcceptConnections implements Runnable\n{\n    public static Socket clientSocket = null;;\n    int clientID = -1;\n\n    public void run()\n    {\n        while(Main.TCP)\n        {\n            try\n            {\n                clientSocket = TCPServer.serverSocket.accept();\n                System.out.println(\"Client Connected.\");\n                clientID++;\n\n                new TCPClientManager(clientSocket, clientID).run();\n            } \n            catch (IOException e)\n            {\n                System.out.println(\"Couldn't create client socket.\");\n                System.exit(-1);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>TCPClientManager:</p>\n\n<hr>\n\n<pre><code>    package game.server;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.PrintWriter;\nimport java.net.Socket;\n\npublic class TCPClientManager implements Runnable\n{\n    Socket client;\n\n    int clientID;\n\n    static PrintWriter out;\n    static BufferedReader in;\n    String inputLine, outputLine;\n\n    boolean destroy = false;\n\n    public TCPClientManager(Socket cs, int id)\n    {\n        try\n        {\n            client = cs;\n            clientID = id;\n            out = new PrintWriter(client.getOutputStream(), true);\n            in = new BufferedReader(new InputStreamReader(client.getInputStream()));\n        } catch(IOException e)\n        {\n            e.printStackTrace();\n        }\n    }\n\n    public void run()\n    {\n        System.out.println(\"Created TCPManager for client.\");\n        String command;\n\n        while(!destroy)\n        {\n            try\n            {\n                if((command = in.readLine()) != null) //If received something\n                {\n                    System.out.println(\"Commad received: \" + command);\n                        System.out.println(\" \" + Commands.proccessCommand(command));\n                    System.out.println(\"Command proccessed\");\n                }\n                else\n                {\n                    client.close();\n                    destroy = true;\n                }\n            } catch (IOException e)\n            {\n                try\n                {\n                    client.close();\n                } catch (IOException e1)\n                {\n                    e1.printStackTrace();\n                    destroy = true;\n                }\n                System.out.println(\"Client lost connection.\");\n                destroy = true;\n            }\n        }\n        System.out.println(\"TCPManager for client destroyed.\");\n    }\n}\n</code></pre>\n\n<p>Commands:</p>\n\n<hr>\n\n<pre><code>package game.server;\n\npublic class Commands\n{\n    public static String proccessCommand(String command)\n    {\n        if(command.equalsIgnoreCase(\"cp\"))\n        {\n            System.out.println(\"Creating player...\");\n                System.out.println(\"    Retrieved client\");\n            return \"Player Created\";\n        }\n        else\n        {\n            return \"Unkown command: \" + command;\n        }\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","fork","php-pcntl","pcntl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":10871293,"title":"How does pcntl_fork work in PHP?","body":"<p>I'm confused about pcntl_fork in PHP. I know it does multi-threading, but how does it work and how would I use it in a script?</p>\n"},{"tags":["asp.net","asp.net-mvc","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2259,"score":4,"question_id":3794741,"title":"ASP.NET MVC Multithreading","body":"<p>I want to implement such logic in my asp-net-mvc application:</p>\n\n<p><code>user clicks a button</code> -></p>\n\n<p><code>server executes some time-consuming logic in ~15 threads (i get data from really slow independent sources)</code> -></p>\n\n<pre><code>when all work is done, server merges the results and passes it back to user\n</code></pre>\n\n<p>The other day i've seen an article which explained why creating new Threads in asp-net application is highly not recommended, and ThreadPool is the one that should be used. \nWhat are best practices for mvc in this case? Why shouldnt i create my threads, backgroundworkers, tasks, whatever by myself and use threadpool? The Application will be hosted on a public server, if it matters.</p>\n\n<p>Thanks, Ilya.</p>\n"},{"tags":["c++","multithreading","gcc","c++11","atomic"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13103645,"title":"Using atomics with std::thread in c++11","body":"<p>I have a thread that I want to sit in a loop until I'm ready to exit the program, at which point I want it to break out of the loop and exit so I can call <code>std::thread::join</code> on it. In the days of c++03, I would just use a bool protected by a lock in order to tell the thread when to exit. This time I thought I would take advantage of the new atomics library (specifically <code>std::atomic_bool</code>), but I'm having trouble. Below is my test case:</p>\n\n<pre><code>#include &lt;atomic&gt;\n#include &lt;thread&gt;\n#include &lt;cstdio&gt;\n\nusing namespace std;\n\nvoid setBool(atomic_bool&amp; ab)\n{\n    ab = true;\n}\n\nint main()\n{\n    atomic_bool b;\n    b = false;\n    thread t(setBool, b);\n    t.join();\n    printf(\"Atomic bool value: %d\\n\", b.load());\n    return 0;\n}\n</code></pre>\n\n<p>The declaration of <code>thread t</code> spits out <a href=\"http://pastebin.com/SpRQW4W1\" rel=\"nofollow\">this</a> monstrosity when I try to compile. The central part of the error seems to be:</p>\n\n<blockquote>\n  <p>invalid initialization of non-const reference of type ‘std::atomic_bool&amp;’ from an rvalue of type ‘std::atomic_bool’</p>\n</blockquote>\n\n<p>Why can I not get a reference to an <code>atomic_bool</code>? What should I do instead?</p>\n"},{"tags":["c++","multithreading","c++11","terminate-handler"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":13104124,"title":"Must user provided terminate() function be thread-safe?","body":"<p>As stated in <a href=\"http://en.cppreference.com/w/cpp/error/terminate\">http://en.cppreference.com/w/cpp/error/terminate</a> there are many reasons to call terminate. I can imagine case where just almost in the same time some of these reasons happen in two threads. </p>\n\n<p><strong>Q1</strong> Can the terminate function set by <code>std::set_terminate</code> be called twice or more at the same time, by the same time I mean second call begins before first has ended. </p>\n\n<pre><code>  Thread1   Thread2\n    |          |\n    _          |\n    t          |\n    e          |\n    r          |\n    m          |\n    i          _\n    n          t\n    a          e\n    t          r\n    e          m\n    -          ?\n</code></pre>\n\n<p><strong>Q2</strong> If Q1==YES, then what happens if first terminate ended. I guess if it ended with std::abort, then program ends, but what happens if user provided terminate does not abort program?    </p>\n\n<p><strong>Q3</strong> Is the terminate function set by <code>std::set_terminate</code> called in context of the thread which caused this terminate call?    </p>\n"},{"tags":["java","string","multithreading","share"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13081147,"title":"Object updated by different thread only partially visible for another thread","body":"<p>I am doing multi-thread programming and encounter a wired issue: object update is only partially visible for another thread. Here is the pseudo code:</p>\n\n<p>Initial state: thread A is running and thread B is blocked</p>\n\n<pre><code>Class C {\n    public int i;\n    public String s;\n}\n</code></pre>\n\n<p>Thread A:</p>\n\n<pre><code>...\n// c is an object of class C and is accessible by both thread A and B\nc.i = 10;\nc.s = \"success\";\nwakeup thread B:\n</code></pre>\n\n<p>Thread B:</p>\n\n<pre><code>// after wakeup\nassert(c.i == 10);\nassert(c.s.equals(\"success\"));\n</code></pre>\n\n<p>The issue is: in thread B, sometimes the value of string c.s actually is null. But I expect it to have the value \"success\". On the other hand, if I put Thread.sleep(sometime) before the assert statements, then I can see the expected value for c.s. I do not know why it happens.</p>\n\n<p>I tried to declare filed variable s as volatile but it does not help. </p>\n\n<p>Thanks!</p>\n\n<p><strong>Update</strong>\nThanks for all the replies/answers. After more experiments and investigations, I believe it is a bug of the framework I am using. The framework manages the suspend/resume of threads and it runs into messy when there are many concurrent requests/connections (like 10k threads).</p>\n"},{"tags":["c#","multithreading","memory",".net-4.5"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":13101062,"title":"Why do my threads seemingly take up less than 1MB of memory?","body":"<p>I'm trying to get a better grasp of the .NET threading model. I've heard and read multiple times (most recently when watching this video: <a href=\"http://channel9.msdn.com/Shows/AppFabric-tv/AppFabrictv-Threading-with-Jeff-Richter\" rel=\"nofollow\">AppFabric.tv - Threading with Jeff Richter</a>) that .NET threads take up at least 1MB of memory (because they set aside 1MB for their stack).\nNow, I tried to write some code to demonstrate this, but I end up with results like</p>\n\n<pre><code>297 threads are using 42MB of memory\n298 threads are using 43MB of memory\n299 threads are using 40MB of memory\n300 threads are using 40MB of memory\n</code></pre>\n\n<p>So, the threads are seemingly not using 1MB of memory each.\nI have tried to the best of my ability to reproduce the program demonstrated 5 minutes into the aforementioned video, but I don't seem to get the same result and I don't understand why. As the memory consumption seems to be falling at times, I guess threads must be exiting or be put on a back burner somewhere? Or maybe I'm not measuring memory properly?</p>\n\n<p>The program used to get the results above looks like this:</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        ManualResetEvent manualReset = new ManualResetEvent(false);\n        int createdThreads = 0;\n        try\n        {\n            while (true)\n            {\n                Thread t = new Thread(WaitOneEvent);\n                t.Start(manualReset);\n                createdThreads++;\n                Console.WriteLine(\"{0} threads are using {1}MB of memory\", createdThreads, System.Diagnostics.Process.GetCurrentProcess().PrivateMemorySize64 / (1024 * 1024));\n            }\n        }\n        catch (OutOfMemoryException)\n        {\n            Console.WriteLine(\"Out of memory at {0} threads\", createdThreads);\n            System.Diagnostics.Debugger.Break();\n            manualReset.Set();\n        }\n    }\n\n    private static void WaitOneEvent(object eventObject) {\n        ((ManualResetEvent)eventObject).WaitOne();\n    }\n}\n</code></pre>\n\n<p>Any insight would be greatly appreciated.</p>\n"},{"tags":["android","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2078,"score":2,"question_id":5391085,"title":"How do I terminate HandlerThreads?","body":"<p>Following Googles examples for using a Service, I created a couple of threads like this.  I can't use IntentService, because I'm doing something that involves waiting for callbacks.</p>\n\n<p>However, I don't know how to terminate a Thread started in this manner. As I understand it, Threads automatically terminate when the run() method returns.  However, this kind of thread doesn't have a run method.  My Threads are leaking--they stay alive after stopSelf().</p>\n\n<pre><code>@Override\npublic void onCreate() {\n\n    HandlerThread thread = new HandlerThread(\"ServiceStartArguments\",\n            android.os.Process.THREAD_PRIORITY_BACKGROUND);\n    thread.start();\n    HandlerThread thread2 = new HandlerThread(\"CallbackHandling\",\n            android.os.Process.THREAD_PRIORITY_BACKGROUND);\n    thread2.start();\n\n    mServiceLooper = thread.getLooper();\n    mCallbackLooper = thread2.getLooper();\n    mServiceHandler = new MyHandler(mServiceLooper);\n    mCallbackHandler = new Handler(mCallbackLooper);\n}\n\n@Override\npublic int onStartCommand(Intent intent, int flags, int startId) {\n    Toast.makeText(this, \"service starting\", Toast.LENGTH_SHORT).show();\n\n    // For each start request, send a message to start a job and deliver the\n    // start ID so we know which request we're stopping when we finish the job\n    Message msg = mServiceHandler.obtainMessage();\n    msg.arg1 = startId;\n    mServiceHandler.sendMessage(msg);\n    mMainThreadHandler=new Handler();\n    // If we get killed, after returning from here, restart\n    return START_STICKY;\n}\n\nprivate final class MyHandler extends Handler {\n    public MyHandler(Looper looper) {\n        super(looper);\n    }\n    @Override\n    public void handleMessage(Message msg) {\n        cycle();\n\n\n        // Stop the service using the startId, so that we don't stop\n        // the service in the middle of handling another job\n        stopSelf(msg.arg1);\n    }\n}\n\nprotected void cycle() {\n    ...\n    mCallbackHandler.post(new Runnable(){\n        public void run(){\n            goAskForSomeCallbacks();\n        }\n    });\n\n    try {\n        Thread.sleep(GIVE_UP_TIME);\n    } catch (InterruptedException e){\n        //The callback will interrupt this thread to stop it from waiting\n        Log.d(TAG,\"Got early callback, stop waiting.\");\n    }\n    Thread.interrupted(); //clear the interrupt\n    doStuff(); \n\n}\n</code></pre>\n"},{"tags":["c","linux","multithreading","posix"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":238,"score":1,"question_id":2673543,"title":"How to signal a buffer full state between posix threads","body":"<p>I have two threads, the main thread 'A' is responsible for message handling between a number of processes. When thread A gets a buffer full message, it should inform thread B and pass a pointer to the buffer which thread B will then process.</p>\n\n<p>When thread B has finished it should inform thread A that it has finished. </p>\n\n<p>How do I go about implementing this using posix threads using C on linux. I have looked at conditional variables, is this the way to go? . I'm not experienced in multi threaded programming and would like some advice on the best avenue to take.</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","multithreading","boost","signals","clutter"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1105,"score":6,"question_id":3831767,"title":"C++ - Clutter 1.0 - calling function from thread causes segfault","body":"<p>I am struggling with calling a clutter function from an extra thread.\nI use boost::thread for threading and the clutter library 1.0.</p>\n\n<p>To be specific, the thread contains a looped function that emits boost::signals2::signal with parameters of x and y coordinates every once in a while.\nThat signal is connected to a function that hands those variables to clutter, i.e. x,y in</p>\n\n<blockquote>\n  <p>clutter_stage_get_actor_at_pos(CLUTTER_STAGE(actor),\n  CLUTTER_PICK_ALL, x, y);</p>\n</blockquote>\n\n<p>And that is where i get a segfault.</p>\n\n<p>Apparently clutter has some thread-handling routines. I tried calling</p>\n\n<blockquote>\n  <p>g_thread_init(NULL);</p>\n  \n  <p>clutter_threads_init();</p>\n</blockquote>\n\n<p>before starting clutter_main(). I also tried enclosing the clutter function in</p>\n\n<blockquote>\n  <p>clutter_threads_enter();</p>\n  \n  <p>clutter_stage_get_actor_at_pos(CLUTTER_STAGE(actor),\n  CLUTTER_PICK_ALL, x, y);</p>\n  \n  <p>clutter_threads_leave();</p>\n</blockquote>\n\n<p>but that does also not do the trick..</p>\n\n<p>Every hint is appreciated, thank you in advance!</p>\n\n<p><strong>Addendum</strong></p>\n\n<p>I just forged a minimal sample of what I am trying to do. I already 'protected' the clutter_main() routine as suggested. Some functions of clutter seem to work (e.g setting stage color or setting actor position) from the seperate thread.  Is there still something wrong with my code?</p>\n\n<pre><code>#include &lt;clutter/clutter.h&gt;\n#include &lt;boost/thread.hpp&gt;\n\n\nClutterActor *stage;\nClutterActor* rect = NULL;\n\n\nvoid receive_loop()\n{\nwhile(1)\n{\n    sleep(1);\n    clutter_threads_enter();\n\n    ClutterActor* clicked =  clutter_stage_get_actor_at_pos(CLUTTER_STAGE(stage), CLUTTER_PICK_ALL,300, 500);\n\n    clutter_threads_leave();\n}\n\n}\n\n\nint main(int argc, char *argv[]) \n{\n\n    clutter_init(&amp;argc, &amp;argv);\n\ng_thread_init(NULL);\nclutter_threads_init();\n\n\n    stage = clutter_stage_get_default();\n    clutter_actor_set_size(stage, 800, 600);\n\n\nrect = clutter_rectangle_new();\nclutter_actor_set_size(rect, 256, 128);\nclutter_actor_set_position(rect, 300, 500);\nclutter_group_add (CLUTTER_GROUP (stage), rect);    \n\n\n    clutter_actor_show(stage);\n\n\nboost::thread thread = boost::thread(&amp;receive_loop);\n\n\nclutter_threads_enter();\n    clutter_main();\nclutter_threads_leave();\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["android","multithreading","handler","android-asynctask","loc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":708,"score":0,"question_id":4860404,"title":"Can't call handler in an AsyncTask?","body":"<p>I want to create a background thread (execute even if my activity dies) that update my data location et send it to my server with an http resquest. But it occurs an exception:</p>\n\n<pre><code>02-01 07:50:18.172: ERROR/Exception1(277): Can't create handler inside thread that has not called Looper.prepare()\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>public class Messagerie extends Activity {\nprivate LocationManager locationManager;\nprivate String locationProvider = LocationManager.NETWORK_PROVIDER;\n\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    setContentView(R.layout.messagerie);\n\n    new UpdateLocation().execute();\n\n}\n\npublic void majCoordonnes() {\n    StringBuilder stringBuilder = new StringBuilder(\"Fournisseur :\");\n    stringBuilder.append(\"\\n\");\n    stringBuilder.append(locationProvider);\n    stringBuilder.append(\" : \");\n    Location location = locationManager.getLastKnownLocation(locationProvider);\n\n    if (location != null) {\n\n        double latitude = location.getLatitude();\n        double longitude = location.getLongitude();\n\n        String lat = String.valueOf(latitude);\n        String lon = String.valueOf(longitude);\n\n        stringBuilder.append(latitude);\n        stringBuilder.append(\", \");\n        stringBuilder.append(longitude);\n\n\n                    //Send location to server in an AsyncTask\n        new sendLocation().execute(lat, lon);\n\n\n    } else {\n        stringBuilder.append(\"Non déterminée\");\n    }\n    Log.d(\"MaPositionMaj\", stringBuilder.toString());\n}\n\n\n/**\n * Ecouteur utilisé pour les mises à jour des coordonnées\n */\nclass MajListener implements android.location.LocationListener {\n    public void onLocationChanged(Location location) {\n        majCoordonnes();\n    }\n    public void onProviderDisabled(String provider){\n    }\n    public void onProviderEnabled(String provider){\n    }\n    public void onStatusChanged(String provider, int status, Bundle extras){\n    }\n};\n\n\n\n\n//Requête GET, mise à jour des infos\nprivate class UpdateLocation extends AsyncTask&lt;String, Void, String&gt; {\n\n    String resp;\n\n    @Override\n    protected String doInBackground(String... params) {\n\n        try {\n        //Recuperation Location\n        String locationContext = Context.LOCATION_SERVICE;\n        locationManager = (LocationManager) getSystemService(locationContext);\n        if (locationManager != null &amp;&amp; locationProvider != null) {\n\n            majCoordonnes();\n            locationManager.requestLocationUpdates(locationProvider, 120000, 500, new MajListener());\n\n\n        }\n        } catch (Exception e){\n            Log.e(\"Exception1\", e.getMessage());\n        }\n\n        return resp;\n    }\n\n\n    @Override\n    protected void onPostExecute(String result) {\n\n\n    }\n\n\n    @Override\n    protected void onPreExecute() {\n    // Things to be done before execution of long running operation. For example showing ProgessDialog\n    }\n\n\n    @Override\n    protected void onProgressUpdate(Void... values) {\n\n    }\n}\n</code></pre>\n\n<p>EDIT: I think I have to use a Service instead of an asyncTask.</p>\n"},{"tags":["c#","multithreading","service","multiple","task"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13096594,"title":"Avoiding multiple threading starvation?","body":"<p>I have a windows service that starts X number of threads, in this sample 5 threads:</p>\n\n<pre><code>foreach (Tasks task in service.Tasks)\n{\n    Thread t = new Thread(() =&gt; StartCollection(task.TaskID));\n    t.IsBackground = true;\n    t.Start();\n}\n</code></pre>\n\n<p>All each thread does is write a timestamp to the database. The result for each thread ID (taskID) is this:</p>\n\n<pre><code>TaskID  LastRun \n2       27-10-2012 02:42:44\n3       27-10-2012 03:42:17\n4       27-10-2012 03:42:16\n5       27-10-2012 02:37:16\n6       27-10-2012 02:37:20\n</code></pre>\n\n<p>Clearly thread 3+4 gets all the attention, the other threads seems to be starving. Here are the things I have tried to avoid that:</p>\n\n<ul>\n<li>Putting in a Thread.Sleep(x)</li>\n<li>Using Task Parallel Library (result is almost the same, except I got 3 tasks running (4+5+6) most of the time, with LongRunning set)</li>\n<li>Increasing ThreadPool MinThreads with different values (had no effect)</li>\n</ul>\n\n<p>What is the best method to run multiple tasks/threads and making sure all threads gets busy, no matter if the thread IS long running or not?</p>\n\n<p>Specs: I'm running on an i7 with 4 cores and hyperthreading (4/8), CPU load is never above 6% and most cores are doing minimal work.</p>\n\n<p>EDIT: ---</p>\n\n<p>I wonder if it might be better to start X number of services, instead of few services with X number of threads? </p>\n\n<p>Here is the method we call in all 5 threads. LastRun is the timestamp field I refer to.</p>\n\n<pre><code>    private void StartCollection(long _taskID)\n    {\n        try\n        {\n            bool doStop = false;\n            while (!doStop)\n            {\n                using (DataService ds = new DataService(DataService.ConnectionString))\n                {\n                    Tasks task = (from tsk in ds.entityContext.Tasks\n                                  where tsk.TaskID == _taskID\n                                  select tsk).FirstOrDefault();\n                    if (task == null || task.CanKill == 1)\n                    {\n                        doStop = true;\n                    }\n                    else\n                    {\n                        task.CurrentDeviceID = -1;  // No devices\n                        foreach (Devices device in task.Devices)\n                        {\n                             // TODO: Call the device handling here\n                        }\n                        task.LastRun = DateTime.Now;  // Timestamp\n                        ds.entityContext.SaveChanges();\n                    }\n                }\n            }\n        }\n        catch (Exception exp)\n        {\n            // TODO: \n        }\n    }\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13100609,"title":"Replacing AppDomain.GetCurrentThreadId(); with ManagedThreadId","body":"<p>GetCurrentThreadId() has been deprecated, and MSDN states ManagedThreadId replaces it.</p>\n\n<p>However, I'm getting different results and the latter causes an exception in my code. My code is adapted from <a href=\"http://stackoverflow.com/questions/12328751/set-thread-processor-affinity-in-microsoft-net\">this post</a>.</p>\n\n<pre><code>        public static void SetThreadProcessorAffinity(params byte[] cpus)\n        {\n            if (cpus == null)\n            {\n                throw new ArgumentNullException(\"cpus\");\n            }\n\n            if (cpus.Length == 0)\n            {\n                throw new ArgumentException(@\"You must specify at least one CPU.\", \"cpus\");\n            }\n\n            // Supports up to 64 processors\n            long cpuMask = 0;\n            byte max = (byte)Math.Min(Environment.ProcessorCount, 64);\n\n            foreach (byte cpu in cpus)\n            {\n                if (cpu &gt;= max)\n                {\n                    throw new ArgumentException(@\"Invalid CPU number.\");\n                }\n\n                cpuMask |= 1L &lt;&lt; cpu;\n            }\n\n            // Ensure managed thread is linked to OS thread; does nothing on default host in current .Net versions\n            Thread.BeginThreadAffinity();\n\n#pragma warning disable 618\n            // The call to BeginThreadAffinity guarantees stable results for GetCurrentThreadId,\n            // so we ignore the obsolete warning\n            int osThreadId = AppDomain.GetCurrentThreadId();\n            osThreadId = Thread.CurrentThread.ManagedThreadId;// NOT THE SAME VALUE\n#pragma warning restore 618\n\n            // Find the ProcessThread for this thread\n            ProcessThread thread = Process.GetCurrentProcess().Threads.Cast&lt;ProcessThread&gt;()\n                .Where(t =&gt; t.Id == osThreadId).Single();\n\n            // Set the thread's processor affinity\n            thread.ProcessorAffinity = new IntPtr(cpuMask);\n        }\n</code></pre>\n\n<p>I can see the issue is one gets the thread's process ID while the other gets the app's process id.</p>\n\n<p>How do I get this to work without using the deprecated method? The original SO article states to use PInvonke, but I don't know how, and that isn't what MSDN states.</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":4448116,"title":"Out of proc COM sluggishness","body":"<p>I'm presently working on a side-by-side application (C#, WinForms) that injects messages into an application via COM. </p>\n\n<p>This application uses multiple foreach statements, polling entity metrics from the application that accepts COM. A ListBox is used to list each entity, and when a user selects one from this list, a thread is created and executed, calling a method that retrieves the required data.</p>\n\n<p>When a user selects a different entity from the list, the running thread is aborted and a new thread is created for the newly selected entity.</p>\n\n<p>I've spent a day looking into my threading and memory usage, and have come to a conclusion that everything is fine. Never is there more than 6 threads running concurrently (all unique for executing different members), and via the Windows task manager, my application never peaks >10 CPU%, 29M MEM.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":48,"score":1,"question_id":13099610,"title":"Send thread to background","body":"<p>I am trying to implement a music player.\nI wrote a class which extends from Thread and overwrote its Start()-Method to play a random song. </p>\n\n<p>Playing a song works, but I want to send that thread to the background, which doesn't work:</p>\n\n<pre><code>File file = new File(\"song.mp3\");\nPlayEngine plengine = new PlayEngine(); //This class extends from Thread\n\nplengine.Play(file); //This just sets the file to play in a variable\nplengine.Start(); //And this finally plays the file itself\n\nSystem.out.println(\"Next task:\"); // I don't get to this point. Only when the song has finished.\n</code></pre>\n\n<p>As you can see in the code above, I'd like to go to the printed line right after launching the thread.</p>\n"},{"tags":["multithreading","scala","io","future"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":175,"score":3,"question_id":13097754,"title":"Asynchronous IO in Scala with futures","body":"<p>Let's say I'm getting a (potentially big) list of images to download from some URLs. I'm using Scala, so what I would do is :</p>\n\n<pre><code>import scala.actors.Futures._\n\n// Retrieve URLs from somewhere\nval urls: List[String] = ...\n\n// Download image (blocking operation)\nval fimages: List[Future[...]] = urls.map (url =&gt; future { download url })\n\n// Do something (display) when complete\nfimages.foreach (_.foreach (display _))\n</code></pre>\n\n<p>I'm a bit new to Scala, so this still looks a little like magic to me :</p>\n\n<ul>\n<li>Is this the right way to do it? Any alternatives if it is not?</li>\n<li>If I have 100 images to download, will this create 100 threads at once, or will it use a thread pool?</li>\n<li>Will the last instruction (<code>display _</code>) be executed on the main thread, and if not, how can I make sure it is?</li>\n</ul>\n\n<p>Thanks for your advice!</p>\n"},{"tags":["java","multithreading","swing","jframe"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13097935,"title":"updating DefaultListModel on another thread","body":"<p>I have a program that need to update the content of <code>JList</code>, which is <code>DefaultListModel</code> on another thread. Since the number of contents may change from time to time, so I just clear all content and add new content into <code>DefaultListModel</code> when updating. But seems I ran into an issue that <code>JFrame</code> starts refreshing while my thread is doing update. I got exceptions like this </p>\n\n<pre><code>Exception in thread \"AWT-EventQueue-0\" \njava.lang.ArrayIndexOutOfBoundsException: 3\n</code></pre>\n\n<p>Here is an <strong>example of the code</strong> </p>\n\n<pre><code>    DefaultListModel model;\n    JList jList;\n    JScrollPane jScrollPane;\n\n    Thread thread;\n    public Frame() {\n        this.setTitle(\"ASM_SIMULATOR\");\n        this.setBounds(100, 100, 500, 500);\n        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        this.getContentPane().setLayout(null);\n\n        model = new DefaultListModel();\n        jList = new JList(model);\n        jScrollPane = new JScrollPane(jList);\n\n        jList.setBounds(50, 50, 300, 200);\n        jScrollPane.setBounds(50, 50, 300, 200);\n\n        this.getContentPane().add(jScrollPane);\n\n        this.setVisible(true);\n\n        thread = new Thread(new Runnable() {\n            @Override\n            public void run() {\n                while (true) {\n\n                    makeData();\n                    try {\n                        Thread.sleep(200);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n\n        });\n\n        thread.start();\n    }\n\n    public void makeData() {\n        System.out.println(\"makeData()\");\n        model.clear();\n\n        for (int i = 0; i &lt; 20; i++) {\n            model.addElement((int) (Math.random() * 100));\n        }\n\n    }\n\n    public static void main(String[] args) {\n        new Frame();\n\n    }\n</code></pre>\n"},{"tags":["android","multithreading","handler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13098392,"title":"Android, Handler is running in main thread or other thread?","body":"<p>I have following code.</p>\n\n<pre><code>public class SplashScreen extends Activity {\n    private int _splashTime = 5000;\n\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.splash);\n\n        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,\n                 WindowManager.LayoutParams.FLAG_FULLSCREEN);\n\n        new Handler().postDelayed(new Thread(){\n           @Override\n           public void run(){\n             Intent mainMenu = new Intent(SplashScreen.this, MainMenu.class);\n             SplashScreen.this.startActivity(mainMenu);\n             SplashScreen.this.finish();\n             overridePendingTransition(R.drawable.fadein, R.drawable.fadeout);\n           }\n        }, _splashTime);\n    }\n}\n</code></pre>\n\n<p>I have problem in analyze of this code. As far as know handler is running in main thread. but it has thread which is running in other thread. </p>\n\n<p><strong>MainMenu.class</strong> will be run in main thread or second thread?\nif main <strong>thread</strong> is stopped for 5 seconds ANR will be raise. Why when I am stopping it with delay <code>(_splashTime)</code> ANR doesn't display (even if i increase it to more than 5 seconds)</p>\n"},{"tags":["c#","asp.net",".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":90,"score":1,"question_id":13094076,"title":"C# Web App thread","body":"<p>i'm in trouble. In my web app i have a code that creates a thread on the Click event of a button to perform a data intensive task, the is like this:</p>\n\n<pre><code>protected void button_Click(object sender, EventArgs e)\n{\n    // Show loader image\n    loader.Show();\n\n    // Creating the thread\n    System.Threading.ParameterizedThreadStart ts = new System.Threading.ParameterizedThreadStart(RunThread);\n    Thread t = new Thread(ts);\n    t.Name = \"BackgroundThread\";\n    t.Priority = ThreadPriority.AboveNormal;\n    t.Start(HttpContext.Current);\n}\nprivate void RunThread(object state)\n{\n    // Setting the current thread property as the background thread\n    CurrentThread = Thread.CurrentThread;\n\n    if (IsThreadRunning(CurrentThread))\n    {\n        CurrentThread.Join(TimeSpan.FromMinutes(6d));\n    }\n\n    // DO SOME HEAVY STUFF\n}\n</code></pre>\n\n<p>In the button click i show the loader. The problem is: Even calling <strong>Join</strong> in the <strong>BackgroundThread</strong>, the Page_Load event gets called frequently making the page refresh. In other words, while the <strong>RunThread</strong> doesn´t finish, the Page_Load is getting called. Could i prevent this from happening?</p>\n\n<p><strong>OBS: What i wanna do is: show the loader while the data intensive thread is running without make repetitive refreshs on the page.</strong></p>\n"},{"tags":["java","android","multithreading","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13097156,"title":"Using AsyncTask, but experiencing unexpected behaviour","body":"<p>Please refer to the following code which continuously calls a new <code>AsyncTask</code>. The purpose of the <code>AsyncTask</code> is to make an HTTP request, and update the string <code>result</code>.</p>\n\n<pre><code>package room.temperature;\n\nimport java.io.BufferedReader;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.util.ArrayList;\nimport java.util.concurrent.ExecutionException;\n\nimport org.apache.http.HttpEntity;\nimport org.apache.http.HttpResponse;\nimport org.apache.http.NameValuePair;\nimport org.apache.http.client.HttpClient;\nimport org.apache.http.client.entity.UrlEncodedFormEntity;\nimport org.apache.http.client.methods.HttpPost;\nimport org.apache.http.impl.client.DefaultHttpClient;\n\nimport android.app.Activity;\nimport android.os.AsyncTask;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.widget.TextView;\n\npublic class RoomTemperatureActivity extends Activity {\n\n    String result = null;\n    StringBuilder sb=null;\n\n    TextView TemperatureText, DateText;\n    ArrayList&lt;NameValuePair&gt; nameValuePairs;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        TemperatureText = (TextView) findViewById(R.id.temperature); \n        DateText = (TextView) findViewById(R.id.date); \n        nameValuePairs = new ArrayList&lt;NameValuePair&gt;();\n\n        for (int i = 0; i &lt; 10; i++) {          \n            RefreshValuesTask task = new RefreshValuesTask();\n            task.execute(\"\");\n        }\n    }\n\n    // The definition of our task class\n    private class RefreshValuesTask extends AsyncTask&lt;String, Integer, String&gt; {\n        @Override\n        protected void onPreExecute() {\n            super.onPreExecute();\n        }\n\n        @Override\n        protected String doInBackground(String... params) {\n            InputStream is = null;\n\n            try {\n                HttpClient httpclient = new DefaultHttpClient();\n                HttpPost httppost = new HttpPost(\"http://mywebsite.com/roomtemp/tempscript.php\");\n                httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));\n                HttpResponse response = httpclient.execute(httppost);\n                HttpEntity entity = response.getEntity();\n                is = entity.getContent();\n            }\n\n            catch(Exception e)  {\n                Log.e(\"log_tag\", \"Error in http connection\" + e.toString());\n            }\n\n            try {\n                BufferedReader reader = new BufferedReader(new InputStreamReader(is,\"iso-8859-1\"),8);\n                sb = new StringBuilder();\n                sb.append(reader.readLine());\n                is.close();\n                result=sb.toString();\n            }\n\n            catch(Exception e)  {\n                Log.e(\"log_tag\", \"Error converting result \" + e.toString());\n            }\n\n            return result;\n        }\n\n        @Override\n        protected void onProgressUpdate(Integer... values) {\n            super.onProgressUpdate(values);\n        }\n\n        @Override\n        protected void onPostExecute(String result) {\n            super.onPostExecute(result);\n            //System.out.println(result);\n            setValues(result);\n        }\n    }\n\n    public void setValues(String resultValue) {\n        System.out.println(resultValue);\n        String[] values = resultValue.split(\"&amp;\");\n\n        TemperatureText.setText(values[0]);\n        DateText.setText(values[1]);\n    }\n}\n</code></pre>\n\n<p>The problem I am experiencing relates to the <code>AsyncTask</code> in some way or the function <code>setValues()</code>, but I am not sure how. Essentially, I want each call to the <code>AsyncTask</code> to run, eventually in an infinite while loop, and update the <code>TextView</code> fields as I have attempted in <code>setValues</code>. I have tried since yesterday after asking a <a href=\"http://stackoverflow.com/questions/13080358/main-xml-not-loading-when-a-loop-of-any-sort-introduced-in-android-code\">question</a> which led to this code, for reference. </p>\n\n<p>Oh yes, I did try using the <code>AsyncTask</code> <code>get()</code> method, but that didn't work either as I found out that it is actually a synchronous call, and renders the whole point of <code>AsyncTask</code> useless.</p>\n"},{"tags":["android","multithreading","android-audiorecord"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13097048,"title":"Android: when a child thread finishes, unfortunately the whole app stops ! (audio recorder)","body":"<p>i need help in resolving a few bugs related to my android application !</p>\n\n<p>I have been developing an app, which records audio using AudioRecorder class and plays it without any delay using AudioTrack.</p>\n\n<p>The audio plays back successfully, but When i try to stop the recording thread by setting a boolean isRecording = false, the whole app crashes.</p>\n\n<p>I have attached the code in the post too. Please help me with this guys, am very new to multithreading and stuff. Thanks in advance :)</p>\n\n<pre><code>package gp.android.test;\n\nimport android.app.Activity;\nimport android.media.AudioFormat;\nimport android.media.AudioManager;\nimport android.media.AudioRecord;\nimport android.media.AudioTrack;\nimport android.media.MediaRecorder;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.View;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\npublic class voicestream extends Activity{\n\nThread thread;\nAudioTrack audioTrack;\nTextView tv;\nboolean isRecording;\n\npublic void record() {\nint frequency = 11025;\nint channelConfiguration = AudioFormat.CHANNEL_CONFIGURATION_MONO;\nint audioEncoding = AudioFormat.ENCODING_PCM_16BIT;\n\ntry {\n// Create a new AudioRecord object to record the audio.\nint bufferSize = AudioRecord.getMinBufferSize(frequency, channelConfiguration,             audioEncoding);\nAudioRecord audioRecord = new AudioRecord(MediaRecorder.AudioSource.MIC, \nfrequency, channelConfiguration, \naudioEncoding, bufferSize);\n\nshort[] buffer = new short[bufferSize]; \naudioRecord.startRecording();\n\naudioTrack = new AudioTrack(AudioManager.STREAM_MUSIC, \n    11025, \n    AudioFormat.CHANNEL_CONFIGURATION_MONO,\n    AudioFormat.ENCODING_PCM_16BIT, \n    bufferSize, \n    AudioTrack.MODE_STREAM);\naudioTrack.play();\n\nwhile (isRecording) {\nint bufferReadResult = audioRecord.read(buffer, 0, bufferSize);\naudioTrack.write(buffer, 0, bufferReadResult);\n}\n//This loop has to stop peacefully without disturbing the activity !!\naudioRecord.stop();\n\n} catch (Exception e) {\nToast.makeText(voicestream.this, e.getMessage(), 5000).show();\n}\n}\n\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.voicestream);\n    tv = (TextView) findViewById(R.id.stream_status);\n    Button startb = (Button) findViewById(R.id.startstream);\n    Button stopb = (Button) findViewById(R.id.stopstream);\n\n    startb.setOnClickListener(new OnClickListener() {\n        public void onClick(View arg0) {\n            isRecording = true;\n            thread = new Thread(new Runnable() {\n            public void run() {\n            record();\n            tv.setText(\"recording ..\");\n            } \n            });\n\n            thread.start();\n\n            try {\n                synchronized (this) {\n                    wait(2000);\n                }\n            } catch (Exception e) {\n                Toast.makeText(voicestream.this, e.getMessage(), 1000).show();\n            }\n        }\n    });\n\n    stopb.setOnClickListener(new OnClickListener() {\n        public void onClick(View v) {\n            //When i press stop button it crashes !\n            isRecording = false;\n        }\n    });\n\n        tv.setText(\"finished playing :)\");\n        //finish();\n}\n}\n</code></pre>\n"},{"tags":["java","multithreading","compression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13096415,"title":"Dividing input stream into blocks","body":"<p>I have an assignment where we need to write a (very simplified) multithreaded compression program in java (using the built in GzipOutputStream is fine). I understand mostly how to do everything else, but there's one part of the instructions that specifies that we have to dividing the input stream into 128kB blocks, and each thread will work on compressing one of those blocks.</p>\n\n<p>I think I'm missing something glaringly obvious, but at the moment the only way I can think of to split up the input stream is using the IO InpuStream's read() command (which reads one byte at a time) and manually counting up to 128 or if we reach the end of the file first. But that seems horribly inefficient. </p>\n\n<p>Another thing, which is somewhat off tangent and I'm still busily googling to try and figure out, is that it says we're supposed to use the last 32kB of each previous block to prime the compression dictionary for the next block. I vaguely understand what that means, although I'm not entirely sure how to implement it or if it affects how I should treat the input stream byte by byte.</p>\n\n<p>EDIT: To specify, unless I'm thinking of a different dictionary, the deflater class can take in an int that sets the compression level (1 to 9) but... I'm not sure how to get that to correspond to 32kB, unless I have to write a new dictionary altogether. We're only doing compression, so there's no need for the inflater class or such.</p>\n"},{"tags":["multithreading","visual-studio-2010","sockets","visual-c++","client"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13093356,"title":"Can you use the same socket to send the request to server from which you previously send in c++","body":"<p>Suppose you connected to a server through socket connection and for onetime you send the request to the server and receive the response then again you try to send the request to the server but send(); returns -1 because server was down after a while server comes up,can you use the same socket to send request to the server ?</p>\n"},{"tags":["c++","multithreading","c++11","stdthread"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":174,"score":3,"question_id":12993451,"title":"C++11: std::thread pooled?","body":"<p>In C++03 I used pthread with a self-built thread pool that always kept a couple of threads running (since <code>pthread_create</code> is slow), this way I was able to launch threads for small tasks without thinking about performance issues.</p>\n\n<p>Now, in C++11 we have <code>std::thread</code>. I guess the standard doesn't say anything about the specific implementation, so my question is about the standard library implementations. Are they generally opting for a pooled approach where constructing <code>std::thread</code>s is cheap (and e.g. doesn't call <code>pthread_create</code> on posix), or will <code>std::thread</code> just be a wrapper?</p>\n\n<p>In other words, is a thread pool still recommended in C++11, or should I just create a <code>std::thread</code> whenever I need one and leave performance up to the standard library?</p>\n"},{"tags":["c#","multithreading","xna-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13095770,"title":"Threading in C# with XNA KeyboadInput","body":"<p>I am a bit new to threading (not new to C#, just haven't done much threading). Can someone explain to me why this does not work?</p>\n\n<p>I have a thread which calls a method I will call \"Loop\". Loop contains a while loop which will continuously run, and on every loop of the while I want it to check if the A Key is down (using Microsoft's Keyboard class within the XNA Framework). But for some reason it never registers that anything is being pressed.</p>\n\n<pre><code>static Thread thread = new Thread(Loop);\nstatic bool abort = false;\n\npublic static void Begin()\n{\n    thread.Start();\n}\n\nprivate static void Loop()\n{\n    while (!abort)\n    {\n        if (Keyboard.GetState().IsKeyDown(Keys.A))\n            Console.WriteLine(\"A pressed.\");\n    }\n}\n</code></pre>\n\n<p>Might anyone know why the Console.WriteLine() is never being called?</p>\n\n<p>EDIT:</p>\n\n<p>I guess I should explain a little bit. What I am actually trying to do is create something similar to ActionScript's events in C#. So I want to pass a \"condition\" and an \"action\" to call if that condition is met in this separate class which contains this thread. What this would do would allow me to just add \"event listeners\" to objects and it would automatically constantly check if one of the events gets triggered, rather than leave it to me to write If statements in code to check for the events.</p>\n\n<p>Upon trying to do so, the first thing I tested was regarding this XNA Keyboard stuff, because it was one of the reasons I originally wanted to build this system, but it didn't work. So I created the standalone code which i posted above to see if I had made an error in my previous code and it still didn't work.</p>\n"},{"tags":["php","multithreading","curl","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":13094698,"title":"PHP send POST request in separate thread and forget","body":"<p>My app processes bookings, and upon process I would like it to send the booking details to whichever of my app's partners made the booking, so they can store a reference to the booking, <strong>AND</strong> without hold up the other processing my app has to do.</p>\n\n<p>I've thought about how to send a message to a partner, and my solution would be to send a cURL POST request to whichever of my partner's is making the booking <em>(besides answering my question maybe someone has a better solution than this?)</em>. </p>\n\n<p>Each partner would have a specific URL that they would setup to receive this POST request and store the booking information we send them.</p>\n\n<p><strong>THE PROBLEM:</strong>\nIf we try send this POST request and their web server is slow or down then we may wait unnecessarily long to get a response, which in turn would delay the confirmation of the booking of the actual user making use of our service.</p>\n\n<p><strong>IDEAL SOLUTION:</strong>\nI would like to send this PHP cURL request in another thread so we can continue on our merry way and confirm the booking. If in the other thread there is a delay, this will not hold us up.</p>\n\n<p>Other solutions I have considered are:</p>\n\n<ul>\n<li>Calling an external script (e.g. written in python) to send this request. I've read that using <strong>exec()</strong> can be very resource intensive. We have lots of bookings so we would be sending lots of these booking POSTs. So ideally we need something resource conscience.</li>\n<li>Using sockets. I'm not familiar with the configuration of these and I'm worried about our socket server being down. It also feels like a mission to maintain. Maybe I'm wrong?</li>\n<li>Using a service like <a href=\"http://pusher.com/\" rel=\"nofollow\">Pusher</a> which is effectively a socket service. The disadvantage is that if the listener misses a message they will never get it again. E.g. the partner would miss storing that booking.</li>\n</ul>\n\n<p>It would be great to get some feedback about what I'm trying to accomplish here, especially from someone that has been in need of a solution for the same kind of situation I'm in. Thanks for any help!</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13093223,"title":"Thread Dependency Java","body":"<p>I have a main class which spawns a thread, let's call them MainClass and MyThread.</p>\n\n<pre><code>public class MainClass extends javax.swing.JFrame {\n   int sharedVariable;\n   MyThread threadInstance;\n   public MainClass (){\n      sharedVariable = 2;\n      threadInstance = new MyThread(this);\n      threadInstance.run();\n   }\n\n  public int getSharedVariable(){ return sharedVariable; }\n\n  public static void main(String[] args){\n    //begin main class\n }\n} \n\n\npublic class MyThread implements Runnable {\n\n     MainClass class;\n     public MyThread(MainClass main_class){\n         this.main_class= main_class;\n      }\n\n     @Override\n     public run(){\n\n     while(this.main_class is still active){\n\n      //grab status of sharedVariable and wait for x amount of time.\n      }\n     }\n    } \n</code></pre>\n\n<p>The problem is I do not know how to implement the while condition which checks if the MainClass instance is still alive and if it is, it has to use the this.main_class.getSharedVariable() to get the value of sharedVariable, then wait for x amount of time. MainClass has the main method .</p>\n"},{"tags":["iphone","objective-c","multithreading","sqlite"],"answer_count":6,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":7468,"score":4,"question_id":745565,"title":"How to properly call SQLite functions from background thread on iPhone?","body":"<p>I'm using an SQLite database in my iPhone app. At startup, there are some database actions that I want to perform in a separate thread. (I'm doing this mainly to minimize startup time.)</p>\n\n<p>Occasionally/randomly, when these database calls are made from the background thread, the app will crash with these errors:</p>\n\n<pre><code>2009-04-13 17:36:09.932 Action Lists[1537:20b] *** Assertion failure in -[InboxRootViewController getInboxTasks], /Users/cperry/Dropbox/Projects/iPhone GTD/GTD/Classes/InboxRootViewController.m:74\n2009-04-13 17:36:09.932 Action Lists[1537:3d0b] *** Assertion failure in +[Task deleteCompletedTasksInDatabase:completedMonthsAgo:], /Users/cperry/Dropbox/Projects/iPhone GTD/GTD/Classes/Data Classes/Task.m:957\n2009-04-13 17:36:09.933 Action Lists[1537:20b] *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Error: failed to prepare statement with message 'library routine called out of sequence'.'\n2009-04-13 17:36:09.933 Action Lists[1537:3d0b] *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Error: failed to prepare statement with message 'library routine called out of sequence'.'\n</code></pre>\n\n<p>Although I can't reliably reproduce the error, I've convinced myself that it is due to the fact that SQLite functions are being called in both active threads. How <em>should</em> I be calling SQLite functions from a separate thread? Is there a trick I'm missing? I'm pretty new to the iPhone, SQLite, and Objective-C, so it might be something that's obvious to you, but not so obviouse to me.</p>\n\n<p>Here are some code samples.</p>\n\n<p>MainApplication.m:</p>\n\n<pre><code>- (void)applicationDidFinishLaunching:(UIApplication *)application {\n\n    // Take care of jobs that have to run at startup\n    [NSThread detachNewThreadSelector:@selector(startUpJobs) toTarget:self withObject:nil];\n}\n\n// Jobs that run in the background at startup\n- (void)startUpJobs {\n\n    // Anticipating that this method will be called in its own NSThread, set up an autorelease pool.\n    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n\n    // Get user preferences\n    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];\n\n    // This Class Method calls SQLite functions and sometimes causes errors.\n    [Task revertFutureTasksStatus:database];\n\n\n    [pool release];\n}\n</code></pre>\n\n<p>Task.m:</p>\n\n<pre><code>static sqlite3_stmt *revert_future_statement = nil;\n\n+ (void) revertFutureTasksStatus:(sqlite3 *)db {\n\n    if (revert_future_statement == nil) {\n    \t// Find all tasks that meet criteria\n        static char *sql = \"SELECT task_id FROM tasks where ((deleted IS NULL) OR (deleted=0)) AND (start_date &gt; ?) AND (status=0) AND (revert_status IS NOT NULL)\";\n        if (sqlite3_prepare_v2(db, sql, -1, &amp;revert_future_statement, NULL) != SQLITE_OK) {\n            NSAssert1(0, @\"Error: failed to prepare update statement with message '%s'.\", sqlite3_errmsg(db));\n        }\n    }\n\n    // Bind NOW to sql statement\n    NSDate *now = [[NSDate alloc] init];\n    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];\n    [formatter setDateFormat:@\"yyyy-MM-dd\"];\n    NSString *nowString = [formatter stringFromDate:now];\n    sqlite3_bind_text(revert_future_statement, 1, [nowString UTF8String], -1, SQLITE_TRANSIENT);\n    [now release];\n    [formatter release];\n\n    // We \"step\" through the results - once for each row.\n    while (sqlite3_step(revert_future_statement) == SQLITE_ROW) {\n\n        // Do things to each returned row\n\n    }\n\n    // Reset the statement for future reuse.\n    sqlite3_reset(revert_future_statement);\n}\n</code></pre>\n"},{"tags":["python","multithreading","kill","keyboardinterrupt"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3281,"score":2,"question_id":4136632,"title":"Ctrl-c i.e. KeyboardInterrupt to kill threads in python","body":"<p>I read somewhere that KeyboardInterrupt exception is only read by the main thread in Python. I also read that the main thread is blocked while the child thread executes. So, does this mean that Ctrl-c can never reach to the child thread. I tried the following code:</p>\n\n<pre><code>def main():\n try:\n  thread1.start() #thread is totally blocking e.g. while (1)\n     thread1.join()\n    except KeyboardInterrupt:\n     print \"Ctrl-c pressed ...\"\n     sys.exit(1)\n</code></pre>\n\n<p>In this case there is no effect of Ctrl-c on the execution. It's like it is not able to listen to the interrupt. Am I understanding this the wrong way? Is there any other way to kill the thread using Ctrl-c?</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13092404,"title":"Get messages from thread","body":"<p>In First class have method \"listen\" which listening client socket</p>\n\n<pre><code>public void listen() throws IOException {       \n\n        while (true) {\n            socket = this.serverSocket.accept();\n\n            DataOutputStream out = new DataOutputStream( socket.getOutputStream() );\n            this.outputStreams.put(socket, out);\n\n\n            Thread miltiServer;\n\n            miltiServer = new Thread() {\n                @Override\n                public void run() {                    \n                    InputStream sin = null;\n\n                    try {                   \n                        sin = socket.getInputStream();\n                        ObjectInputStream in = new ObjectInputStream(sin);\n                        message = (AgentData) in.readObject();\n\n                    } catch (ClassNotFoundException ex) {\n\n                    } catch (IOException ex) {\n\n                    } \n                }\n            };\n\n            miltiServer.start();\n        }\n</code></pre>\n\n<p>In Second class i need to read and analyze messages which recieved from client socket. I don't know how to get messages in other class. I have idea to use Callable interface, but if i use it, return statement will exit from infinitive cycle. </p>\n"},{"tags":["c++","multithreading","boost","smart-pointers"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1847,"score":3,"question_id":2160334,"title":"Boost weak_ptr's in a multi-threaded program to implement a resource pool","body":"<p>I'm thinking of using boost::weak_ptr to implement a pool of objects such that they will get reaped when nobody is using one of the objects.  My concern, though, is that it's a multi-threaded environment, and it seems there's a race condition between the last shared_ptr to an object going out of scope and a new shared_ptr being constructed from the weak_ptr.  Normally, you'd protect such operations with lock or something; however, the whole point here is that you don't know when the shared_ptr might be going out of scope.</p>\n\n<p>Am I misunderstanding something about boost::shared_ptr and boost::weak_ptr?  If not, does anybody have any good suggestions on what to do?</p>\n\n<p>Thanks.</p>\n\n<p>Andrew</p>\n"},{"tags":["c++","multithreading","visual-studio","sockets","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13090924,"title":"How to check socket connection after every minute in C++","body":"<p>I have implemented a design in C++ that is:-\nI parse an XML file which contain the ip and port of several servers,for each ip and port i first call the connect to server function in which i make a TCP socket connection with the server whether the connection is established or not i make a thread for each ip and port,if connection is not established i send the status of the server that connection is not established and if connection is established i then make a request to the server and receive response from the server in the thread.This is done after every minute for each thread.\nNow the problem that i am facing is,if connection terminates or if the server power goes,how to again make a connection i mean after every one minute before sending request and receiving response from the server i have to check whether the connection is still there or not.\nCan you please tell me how to do that?</p>\n"},{"tags":["java","multithreading","java-ee","synchronized"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":81,"score":-1,"question_id":13088214,"title":"Why Synchronization isn't working in the following Code?","body":"<p>This code sometime throwing an Exception even i have used  <code>synchronized</code> Method <code>removeFirst</code> within <code>synchronized</code> block of run method, I am adding and removing element on a <code>synchronizedList</code>.</p>\n\n<pre><code>public class NameDropper extends Thread {\n\n    private NameList n1;\n\n    public NameDropper(List list) {\n        this.n1 = new NameList(list);\n    }\n\n    public static void main(String[] args) {\n        List l = Collections.synchronizedList(new LinkedList());\n        NameDropper n = new NameDropper(l);\n        n.n1.add(\"Ozymandias\");\n        Thread[] t = new NameDropper[10];\n        for (int i = 1; i &lt;= 10; i++) {\n            t[i - 1] = new NameDropper(l);\n            t[i - 1].setName(\"T\" + Integer.toString(i - 1));\n            t[i - 1].start();\n        }\n    }\n\n    public void run() {\n        synchronized (this) {\n            try {\n                Thread.sleep(50);\n                String name = n1.removeFirst();\n                System.out.println(Thread.currentThread().getName() + \": \"\n                    + name);\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n     }\n}\n\nclass NameList {\n    private List names = null;\n\n    public NameList(List list) {\n        this.names = list;\n    }\n\n    public synchronized void add(String name) {\n        names.add(name);\n    }\n\n    public synchronized String removeFirst() {\n        if (names.size() &gt; 0)\n            return (String) names.remove(0);\n        else\n            return null;\n      }\n}\n</code></pre>\n\n<p>The exception it is throwing:</p>\n\n<pre><code>T1: Ozymandias    \nT2: null    \n*Exception in thread \"T3\" java.lang.IndexOutOfBoundsException: Index: 0, Size: 0    \n    at java.util.LinkedList.entry(Unknown Source)\n    at java.util.LinkedList.remove(Unknown Source)\n    at java.util.Collections$SynchronizedList.remove(Unknown Source)\n    at NameList.removeFirst(NameDropper.java:57)*\nT0: null    \nT8: null    \n*at NameDropper.run(NameDropper.java:33)*      \nT6: null    \nT4: null    \nT9: null    \nT7: null    \nT5: null    \n</code></pre>\n"},{"tags":["android","multithreading","android-asynctask"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13089521,"title":"I'm using AsyncTask and getting threading errors","body":"<p>I'm making a request to the Yelp API through an AsyncTask innerclass.  When I try to print the result in onPostExecute() i get errors.  Heres my code:</p>\n\n<pre><code>public class MainActivity extends Activity {\n\nYelp yelp = new yelp(....);\nyelp.execute();\npublic class Yelp extends AsyncTask&lt;String,Void,Response&gt; {\n    double _long = 1;\n    double _lat= 1;\n    String _term = \"sushi\";     \n  OAuthService service;\n  Token accessToken;\n  public Yelp(String consumerKey, String consumerSecret, String token, String tokenSecret) {\n    this.service = new ServiceBuilder().provider(YelpApi2.class).apiKey(consumerKey).apiSecret(consumerSecret).build();\n    this.accessToken = new Token(token, tokenSecret);\n  }\n\n    @Override\n    protected void onPostExecute(Response re) {\n        try{\n            System.out.println(re.getBody());\n        }\n        catch(Exception e){\n            e.printStackTrace();\n        }\n     }\n\n    @Override\n    protected Response doInBackground(String... params) {\n        OAuthRequest request = new OAuthRequest(Verb.GET, \"http://api.yelp.com/v2/search\");\n        request.addQuerystringParameter(\"term\", _term);\n        request.addQuerystringParameter(\"ll\", _lat + \",\" + _long);\n        this.service.signRequest(this.accessToken, request);\n        Response r = request.send();\n        return r;\n    }\n}\n}\n</code></pre>\n\n<p>And my error msgs:</p>\n\n<pre><code>10-26 10:55:45.630: W/System.err(1060): android.os.NetworkOnMainThreadException\n10-26 10:55:45.640: W/System.err(1060):     at android.os.StrictMode$AndroidBlockGuardPolicy.onNetwork(StrictMode.java:1117)\n10-26 10:55:45.640: W/System.err(1060):     at libcore.io.BlockGuardOs.recvfrom(BlockGuardOs.java:163)\n10-26 10:55:45.640: W/System.err(1060):     at libcore.io.IoBridge.recvfrom(IoBridge.java:513)\n10-26 10:55:45.640: W/System.err(1060):     at java.net.PlainSocketImpl.read(PlainSocketImpl.java:488)\n10-26 10:55:45.640: W/System.err(1060):     at java.net.PlainSocketImpl.access$000(PlainSocketImpl.java:46)\n10-26 10:55:45.651: W/System.err(1060):     at java.net.PlainSocketImpl$PlainSocketInputStream.read(PlainSocketImpl.java:240)\n10-26 10:55:45.651: W/System.err(1060):     at java.io.BufferedInputStream.read(BufferedInputStream.java:304)\n10-26 10:55:45.651: W/System.err(1060):     at libcore.net.http.FixedLengthInputStream.read(FixedLengthInputStream.java:45)\n10-26 10:55:45.651: W/System.err(1060):     at java.io.InputStreamReader.read(InputStreamReader.java:244)\n10-26 10:55:45.651: W/System.err(1060):     at org.scribe.utils.StreamUtils.getStreamContents(StreamUtils.java:29)\n10-26 10:55:45.651: W/System.err(1060):     at org.scribe.model.Response.parseBodyContents(Response.java:40)\n10-26 10:55:45.651: W/System.err(1060):     at org.scribe.model.Response.getBody(Response.java:66)\n10-26 10:55:45.660: W/System.err(1060):     at com.example.first.MainActivity$Yelp.onPostExecute(MainActivity.java:109)\n10-26 10:55:45.670: W/System.err(1060):     at com.example.first.MainActivity$Yelp.onPostExecute(MainActivity.java:1)\n10-26 10:55:45.670: W/System.err(1060):     at android.os.AsyncTask.finish(AsyncTask.java:631)\n10-26 10:55:45.670: W/System.err(1060):     at android.os.AsyncTask.access$600(AsyncTask.java:177)\n10-26 10:55:45.670: W/System.err(1060):     at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:644)\n10-26 10:55:45.681: W/System.err(1060):     at android.os.Handler.dispatchMessage(Handler.java:99)\n10-26 10:55:45.690: W/System.err(1060):     at android.os.Looper.loop(Looper.java:137)\n10-26 10:55:45.690: W/System.err(1060):     at android.app.ActivityThread.main(ActivityThread.java:4745)\n10-26 10:55:45.710: W/System.err(1060):     at java.lang.reflect.Method.invokeNative(Native Method)\n10-26 10:55:45.710: W/System.err(1060):     at java.lang.reflect.Method.invoke(Method.java:511)\n10-26 10:55:45.720: W/System.err(1060):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:786)\n10-26 10:55:45.720: W/System.err(1060):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:553)\n10-26 10:55:45.730: W/System.err(1060):     at dalvik.system.NativeStart.main(Native Method)\n10-26 10:59:03.251: D/testtt(1109): BUS3333333TEDDDD\n10-26 10:59:03.351: D/ddd(1109): BUSTEDDDD\n10-26 10:59:03.521: D/gralloc_goldfish(1109): Emulator without GPU emulation detected.\n10-26 10:59:05.431: D/dalvikvm(1109): GC_FOR_ALLOC freed 174K, 4% free 8126K/8391K, paused 53ms, total 56ms\n10-26 10:59:05.440: W/System.err(1109): android.os.NetworkOnMainThreadException\n10-26 10:59:05.451: W/System.err(1109):     at android.os.StrictMode$AndroidBlockGuardPolicy.onNetwork(StrictMode.java:1117)\n10-26 10:59:05.451: W/System.err(1109):     at libcore.io.BlockGuardOs.recvfrom(BlockGuardOs.java:163)\n10-26 10:59:05.451: W/System.err(1109):     at libcore.io.IoBridge.recvfrom(IoBridge.java:513)\n10-26 10:59:05.461: W/System.err(1109):     at java.net.PlainSocketImpl.read(PlainSocketImpl.java:488)\n10-26 10:59:05.461: W/System.err(1109):     at java.net.PlainSocketImpl.access$000(PlainSocketImpl.java:46)\n10-26 10:59:05.471: W/System.err(1109):     at java.net.PlainSocketImpl$PlainSocketInputStream.read(PlainSocketImpl.java:240)\n10-26 10:59:05.471: W/System.err(1109):     at java.io.BufferedInputStream.read(BufferedInputStream.java:304)\n10-26 10:59:05.471: W/System.err(1109):     at libcore.net.http.FixedLengthInputStream.read(FixedLengthInputStream.java:45)\n10-26 10:59:05.481: W/System.err(1109):     at java.io.InputStreamReader.read(InputStreamReader.java:244)\n10-26 10:59:05.481: W/System.err(1109):     at org.scribe.utils.StreamUtils.getStreamContents(StreamUtils.java:29)\n10-26 10:59:05.481: W/System.err(1109):     at org.scribe.model.Response.parseBodyContents(Response.java:40)\n10-26 10:59:05.492: W/System.err(1109):     at org.scribe.model.Response.getBody(Response.java:66)\n10-26 10:59:05.492: W/System.err(1109):     at com.example.first.MainActivity$Yelp.onPostExecute(MainActivity.java:104)\n10-26 10:59:05.492: W/System.err(1109):     at com.example.first.MainActivity$Yelp.onPostExecute(MainActivity.java:1)\n10-26 10:59:05.501: W/System.err(1109):     at android.os.AsyncTask.finish(AsyncTask.java:631)\n10-26 10:59:05.501: W/System.err(1109):     at android.os.AsyncTask.access$600(AsyncTask.java:177)\n10-26 10:59:05.501: W/System.err(1109):     at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:644)\n10-26 10:59:05.501: W/System.err(1109):     at android.os.Handler.dispatchMessage(Handler.java:99)\n10-26 10:59:05.511: W/System.err(1109):     at android.os.Looper.loop(Looper.java:137)\n10-26 10:59:05.511: W/System.err(1109):     at android.app.ActivityThread.main(ActivityThread.java:4745)\n10-26 10:59:05.521: W/System.err(1109):     at java.lang.reflect.Method.invokeNative(Native Method)\n10-26 10:59:05.521: W/System.err(1109):     at java.lang.reflect.Method.invoke(Method.java:511)\n10-26 10:59:05.521: W/System.err(1109):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:786)\n10-26 10:59:05.521: W/System.err(1109):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:553)\n10-26 10:59:05.531: W/System.err(1109):     at dalvik.system.NativeStart.main(Native Method)\n</code></pre>\n"},{"tags":["c#","multithreading","io","task-parallel-library","async-await"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":13084596,"title":"UDP listener with task-based asynchronous pattern","body":"<p>I am messing around with a UDP listener and the TAP.</p>\n\n<p>I have a class that is responsible for listening for incoming UDP and that can be started and stopped.\nThe Start() method simply calls the following method</p>\n\n<pre><code>    private async void Listen()\n    {\n        var resp = await _udpClient.ReceiveAsync().ConfigureAwait(continueOnCapturedContext: false);\n\n        var eventHandler = PacketReceived;\n        if (eventHandler != null)\n            eventHandler(this, new UdpPacketReceivedEventArgs(resp));\n\n        if (_running)\n            Listen();\n    }\n</code></pre>\n\n<p>Is this correct? I am a bit worried that I might exhaust the thread pool, because the thread is being kept alive by spawning a new Listen() call.</p>\n"},{"tags":["wpf","multithreading","dispatcher","print-preview"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":251,"score":4,"question_id":11358647,"title":"How to access separate thread generated WPF UI elements from the Dispatcher thread?","body":"<p>I need to generate a print preview (a long one) using wpf UI elements like FixedDocument, FlowDocument, PageContent, BlockUIContainer and all those. To keep my UI responsive i'm doing this part on a separate Thread class thread (BackgroundWorker won't work since i need an STA thread). Everything is OK upto this point.<br>\nBut after displaying the print preview now i need to print, and clicking Print icon on the generated preview throws the infamous \"The calling thread cannot access this object because a different thread owns it.\" exception. So, is there any way around? </p>\n\n<p>EDIT (CODE):  </p>\n\n<pre><code>Dispatcher.CurrentDispatcher.Invoke(new Action(() =&gt;  \n    {  \n        Thread thread = new Thread(() =&gt;  \n            {  \n                FixedDocument document = renderFlowDocumentTemplate(report);  \n                PrintPreview preview = new PrintPreview();  \n                preview.WindowState = WindowState.Normal;  \n                preview.documentViewer.Document = document;  \n                preview.ShowDialog();  \n            });  \n        thread.SetApartmentState(ApartmentState.STA);  \n        thread.Start();  \n    }));`\n</code></pre>\n\n<p>Ok here, the RenderFlowDocumentTemplate() generates the print preview (which contains the UI elements) and fills the them with Report data. PrintPreview is a custom window that contains a DocumentViewer element that actually holds and displays the preview, and contains the Print icon, upon clicking which i'm supposd to get the PrintDialog window.  </p>\n\n<p>EDIT (XAML):  </p>\n\n<pre><code>&lt;cw:CustomWindow x:Class=\"MyApp.Reports.PrintPreview\"\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n    xmlns:cw=\"clr-namespace:MyApp.UI.CustomWindows;assembly=MyApp.UI.CustomWindows\"&gt;    \n    &lt;DocumentViewer Margin=\"0,30,0,0\" Name=\"documentViewer\"&gt;&lt;/DocumentViewer&gt;\n&lt;/cw:CustomWindow&gt;`\n</code></pre>\n"},{"tags":["c#","multithreading","exception","folderbrowserdialog"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":2381,"score":1,"question_id":6860153,"title":"Exception when using FolderBrowserDialog","body":"<p>I'm getting the following Exception when trying to use FolderBrowserDialog:\n<code>System.Threading.ThreadStateException: Current thread must be set to single thread apartment (STA) mode before OLE calls can be made. Ensure that your Main function has STAThreadAttribute marked on it. This exception is only raised if a debugger is attached to the process.</code></p>\n\n<p>I have Googled this problem extensively and the solutions that everybody suggests seem to be to put <code>[STAThreadAttribute]</code> above the Main method, to delete all dll's from the Debug folder, or to use the <code>Invoke</code> method.  I have tried all of these, and I still get the same exception.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>public partial class Form1 : Form\n{\n    public event EventHandler ChooseLocationHandler = null;\n\n    public string DestFolder\n    {\n        set { textBox1.Text = value; }\n        get { return textBox1.Text; }\n    }\n\n    public Form1()\n    {\n        InitializeComponent();\n    }\n\n    private void ChooseLocationButton_Click(object sender, EventArgs e)\n    {\n        if (ChooseLocationHandler != null)\n            ChooseLocationHandler(this, e);\n    }\n}\n</code></pre>\n\n<p>And in my presenter is the following:</p>\n\n<pre><code>public partial class Presenter\n{\n    Form1 myForm;\n    public Presenter()\n    {\n        myForm = new Form1();\n        myForm.ChooseLocationHandler += ChooseLocationHandler;\n        myForm.Show();\n    }\n\n    public void ChooseLocationHandler(object obj, EventArgs e)\n    {\n        Form1 sender = (Form1)obj;\n\n        FolderBrowserDialog fbd = new FolderBrowserDialog();\n        fbd.RootFolder = System.Environment.SpecialFolder.MyComputer;\n        fbd.ShowNewFolderButton = true;\n        if (fbd.ShowDialog() == DialogResult.Cancel)\n            return;\n\n        sender.DestFolder = fbd.SelectedPath;\n    }\n}\n</code></pre>\n\n<p>I'm getting the Exception on fbd.ShowDialog().</p>\n"},{"tags":["multithreading","delphi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":13085188,"title":"Access violation at tcriticalsection.create","body":"<p>I am programming a multi-threaded chat server application. Thus critical section are very necessary. I just made a wrapper class for threaded tree view. It works perfectly in the client but the server raises an AV.</p>\n\n<p>There are two forms, FormServer (which practically does almost no processing except for gui painting) and the DataModuleServer which does all the heavy lifting.</p>\n\n<p>The FormServer gets created first.</p>\n\n<p>Actually the threaded tree view is inside another wrapper class TRoomTree.</p>\n\n<p><strong>TDataModuleServer.Create</strong></p>\n\n<pre><code>procedure TDataModuleServer.cr(Sender: TObject);\nbegin\n  Rooms := TRoomTree.Create (FormServer.tvRooms);\n</code></pre>\n\n<p>tvRooms : the visual treeview</p>\n\n<p><strong>TRoomTree.Create</strong></p>\n\n<pre><code>constructor TRoomTree.Create (TV : TTreeView);\nbegin\n\n  if Assigned (TV) then\n    fTreeView.Create (TV)\n  else\n    exit;\n</code></pre>\n\n<p>fTreeView : the threaded tree view;</p>\n\n<p><strong>TThreadTreeView.Create</strong></p>\n\n<pre><code>constructor TThreadTreeView.Create (TreeView : TTreeView = nil);\nbegin\n\n  fLock := TCriticalSection.Create;\n\n  if Assigned (TreeView) then\n    fTreeView := TreeView\n  else\n    fTreeView := TTreeView.Create (nil);\n\nend;\n</code></pre>\n\n<p>fTreeView : the normal tree view;</p>\n\n<p>Now the TCriticalSection.Create raises an AV exception in ntdll.dll.</p>\n\n<p><strong>Call Stack</strong></p>\n\n<pre><code>:76cac41f KERNELBASE.RaiseException + 0x58\n:0040469c NotifyNonDelphiException + $1C\n:77ecb42b ; ntdll.dll\nuThreadTreeView.TThreadTreeView.Create($26B4300) \nuRoomTree.TRoomTree.Create($26B4300)\nuServer.TDataModuleServer.cr($26A48B0)\nClasses.TDataModule.DoCreate\nClasses.TDataModule.AfterConstruction\nSystem.@AfterConstruction($26A48B0)\nClasses.TDataModule.Create(???)\nForms.TApplication.CreateForm(???,(no value))\nPlayburnServer.PlayburnServer\n:773833aa kernel32.BaseThreadInitThunk + 0x12\n:77ea9ef2 ntdll.RtlInitializeExceptionChain + 0x63\n:77ea9ec5 ntdll.RtlInitializeExceptionChain + 0x36\n</code></pre>\n\n<p>Any help will be greatly appreciated.</p>\n"},{"tags":["c#","multithreading","hash"],"answer_count":6,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":900,"score":9,"question_id":9895077,"title":"C# Threading - Reading and hashing multiple files concurrently, easiest method?","body":"<p>I've been trying to get what I believe to be the simplest possible form of threading to work in my application but I just can't do it.</p>\n\n<p>What I want to do: I have a main form with a status strip and a progress bar on it. I have to read something between 3 and 99 files and add their hashes to a string[] which I want to add to a list of all files with their respective hashes. Afterwards I have to compare the items on that list to a database (which comes in text files).\nOnce all that is done, I have to update a textbox in the main form and the progressbar to 33%; mostly I just don't want the main form to freeze during processing.</p>\n\n<p>The files I'm working with always sum up to 1.2GB (+/- a few MB), meaning I should be able to read them into byte[]s and process them from there (I have to calculate CRC32, MD5 and SHA1 of each of those files so that should be faster than reading all of them from a HDD 3 times).</p>\n\n<p>Also I should note that some files may be 1MB while another one may be 1GB. I initially wanted to create 99 threads for 99 files but that seems not wise, I suppose it would be best to reuse threads of small files while bigger file threads are still running. But that sounds pretty complicated to me so I'm not sure if that's wise either.</p>\n\n<p>So far I've tried workerThreads and backgroundWorkers but neither seem to work too well for me; at least the backgroundWorkers worked SOME of the time, but I can't even figure out why they won't the other times... either way the main form still froze.\nNow I've read about the Task Parallel Library in .NET 4.0 but I thought I should better ask someone who knows what he's doing before wasting more time on this.</p>\n\n<p>What I want to do looks something like this (without threading):</p>\n\n<pre><code>List&lt;string[]&gt; fileSpecifics = new List&lt;string[]&gt;();\n\nint fileMaxNumber = 42; // something between 3 and 99, depending on file set\n\nfor (int i = 1; i &lt;= fileMaxNumber; i++)\n{\n    string fileName = \"C:\\\\path\\\\to\\\\file\" + i.ToString(\"D2\") + \".ext\"; // file01.ext - file99.ext\n    string fileSize = new FileInfo(fileName).Length.ToString();\n    byte[] file = File.ReadAllBytes(fileName);\n    // hash calculations (using SHA1CryptoServiceProvider() etc., no problems with that so I'll spare you that, return strings)\n    file = null; // I didn't yet check if this made any actual difference but I figured it couldn't hurt\n    fileSpecifics.Add(new string[] { fileName, fileSize, fileCRC, fileMD5, fileSHA1 });\n}\n\n// look for files in text database mentioned above, i.e. first check for \"file bundles\" with the same amount of files I have here; then compare file sizes, then hashes\n// again, no problems with that so I'll spare you that; the database text files are pretty small so parsing them doesn't need to be done in an extra thread.\n</code></pre>\n\n<p>Would anybody be kind enough to point me in the right direction? I'm looking for the easiest way to read and hash those files quickly (I believe the hashing takes some time in which other files could already be read) and save the output to a string[], without the main form freezing, nothing more, nothing less.</p>\n\n<p>I'm thankful for any input.</p>\n\n<p>EDIT to clarify: by \"backgroundWorkers working some of the time\" I meant that (for the very same set of files), maybe the first and fourth execution of my code produces the correct output and the UI unfreezes within 5 seconds, for the second, third and fifth execution it freezes the form (and after 60 seconds I get an error message saying some thread didn't respond within that time frame) and I have to stop execution via VS.</p>\n\n<p>Thanks for all your suggestions and pointers, as you all have correctly guessed I'm completely new to threading and will have to read up on the great links you guys posted.\nThen I'll give those methods a try and flag the answer that helped me the most. Thanks again!</p>\n"},{"tags":["python","multithreading","scope"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":413,"score":2,"question_id":2352934,"title":"Are python functions threadsafe? (Particularly this one?)","body":"<p>Before answering, please understand I do NOT want you to do the work for me.  I would rather appreciate a worded answer as to why my (possibly theoretical) problem exists, and an explanation of the process to go about fixing it.  I find it harder to learn properly when someone just does the work for me.  Thank you in advance.</p>\n\n<p>I have this function:  It does exactly what it looks like it's doing.  It is using the html from a page which contains a facebook ID and returning the ID once found.</p>\n\n<pre><code>def getID(data): #Find an ID from HTML input.\n    data = str(data)\n    appstring = 'http://apps.facebook.com/castle_age/keep.php?user=' #We're gonna find this in the html.\n    appstr_start_pos = data.find(appstring) #Tell us where we found it oh mighty one!\n    if appstr_start_pos != -1: #If we find it.\n        begin_ID_pos = appstr_start_pos + len(appstring)\n        end_ID_pos = data.find('\"', begin_ID_pos) #Find the end quote, that'll be the end of our ID string.\n\n        our_ID = data[begin_ID_pos:end_ID_pos]\n        return our_ID\n</code></pre>\n\n<p>Right now I do not have it packaged in one of my classes which uses the thread.Threading method, but I am still calling it regularly.  My code right now is only running one thread, and it's possible that I might need to call this function from another threaded class; is this possible?  If not, how can I use this function between threaded classes?</p>\n\n<p>A more simple form of the question:  If I call this function from a multi-threaded environment, will I have problems, or do I need to move it into its own class?  Is there a way to keep the function available between 2 different threaded objects (if so what's the easiest way)?</p>\n\n<p>Here is the full code: <a href=\"http://pastebin.com/txH8PvL3\" rel=\"nofollow\">http://pastebin.com/txH8PvL3</a> -- Please keep in mind that it is a WIP, as practice for learning threading...</p>\n"},{"tags":["c++","windows","multithreading","boost"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":1,"view_count":201,"score":2,"question_id":13014635,"title":"Boost Mutex implementation for Windows","body":"<p>As far as I know in old versions of Boost <code>boost::mutex</code> implementation for Windows was done using critical sections. But in the newest version of Boost 1.51 I discovered that now mutex implementation is based on Events.</p>\n\n<p>Does anybody know what is the rational behind this change? Was it done because of performance reasons? Do critical sections become deprecated?</p>\n"},{"tags":["python","multithreading","numpy","machine-learning","scikit-learn"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":114,"score":1,"question_id":13068257,"title":"Multiprocessing scikit-learn","body":"<p>I got linearsvc working against training set and test set using <code>load_file</code> method i am trying to get It working on Multiprocessor enviorment.</p>\n\n<p>How can i get multiprocessing work on <code>LinearSVC().fit()</code> <code>LinearSVC().predict()</code>? I am not really familiar  with datatypes of scikit-learn yet.</p>\n\n<p>I am also thinking about splitting samples into multiple arrays but i am not familiar with numpy arrays and scikit-learn data structures. </p>\n\n<p>Doing this it will be easier to put into multiprocessing.pool() , with that , split samples into chunks , train them and combine trained set  back later , would it work ? </p>\n\n<p>EDIT:\nHere is my scenario:</p>\n\n<p>lets say , we have 1 million files in training sample set , when we want to distribute processing of Tfidfvectorizer on several processors we have to split those samples (for my case it will only have two categories , so lets say 500000 each samples to train) . My server have 24 cores with 48 GB , so i want to split each topics into number of chunks 1000000 / 24 and process Tfidfvectorizer on them. Like that i would do to Testing sample set , as well as SVC.fit() and decide(). Does it make sense? </p>\n\n<p>Thanks. </p>\n\n<p>PS: Please do not close this .</p>\n"},{"tags":["javascript","multithreading","asynchronous"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":665,"score":4,"question_id":3693550,"title":"Mutual Exclusion for N Asynchronous Threads","body":"<p>I've got an asynchronous application, meaning that at any given time there can be N events. Is there a known algorithm for doing mutual exclusion for N threads, without hardcoding each thread to have an ID?</p>\n"},{"tags":["c#","wpf","multithreading"],"answer_count":7,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":93,"score":4,"question_id":13088436,"title":"Preforming a block of code only once","body":"<p>The following code block, preforms loading of an object in C#.</p>\n\n<pre><code>public bool IsModelLoaded { get; set; }\npublic override MyObject Load()\n    {\n        if (!IsModelLoaded)\n        {\n            Model = MyService.LoadMyObject(Model);\n            IsModelLoaded = true;\n        }\n        return Model;\n    }\n</code></pre>\n\n<p>My intention is to run this block only once, and hence loading the Model only once.\nNevertheless, this code block runs twice from 2 different threads..</p>\n\n<p>How can I make sure that this block runs only once? (on multiplethreads).</p>\n\n<p>Thank You.</p>\n"},{"tags":["multithreading","performance","sql-server-2008","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":9561903,"title":"The query processor could not start the necessary thread resources","body":"<p>I having this error on my mssql server especially when there are many records inserted at the same time:\n <em>\"100|The query processor could not start the necessary thread resources for parallel query execution.\"</em> </p>\n\n<p>i try google search the problem to upgrade my sql performance so that can avoid this error, and plenty of it suggests to set maxdrop on the query or the max degree of parallelism on the mssql. </p>\n\n<p>But how can i know how many the value of the maxdrop or max degree of parallelism i should set to? \nand how i check the maximum value of max degree of parallelism of my server can run?\nif i change the max degree of parallelism of the server, means all the store proc will run following that setting, so will it affect other performance? or i just need to set the maxdrop on certain store proc?</p>\n"},{"tags":["ios","multithreading","uiviewcontroller"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13086416,"title":"problems with UIViewController switching","body":"<p>I have a little problem with an application.<br>\nWhen I switch the Views there will be a time delay about 3 to 10 seconds, after this app run two sorting algorythmen. (Quick and Bubblesort) in an extra thread. I dont know where the problem exists. </p>\n\n<p>Here the code snippet:  </p>\n\n<pre><code>[alert show];\ndispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, (unsigned long)NULL), ^(void) {\n     time = [Sort sortRuns:(int)slider_durchlaeufe.value WithCapacity:(int)slider_ArraySize.value Reference:alert]; //time is a global reference to my Time object\n     [self setDataForStatistik]; // a Method to set the statisik for the next view \n     [alert dismissWithClickedButtonIndex:0 animated:true];\n  });\n</code></pre>\n\n<p>I think the failure is in this code snippet.</p>\n\n<p>I hope you can help me. </p>\n\n<p>Robybyte</p>\n"},{"tags":["java","multithreading","thread-safety","thread-synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13086891,"title":"Access a Set that is modified by other threads","body":"<p>There is an <code>ExecutorService</code> that has 3 threads that each one add <code>Pair&lt;String,Integer&gt;</code> objects to a <code>TreeSet&lt;Pair&lt;String,Integer&gt;&gt;</code>. The addToSet() method is declared <code>synchronized</code> and everything works fine. But I must implement a new thread that execute a scheduled task that has to access this Set and print all the values. The problem is that sometimes the scheduled thread crashes(the other threads work fine). I think that it crashes because the Set is being modified by the other 3 threads during the for loop of the printer(scheduled thread).  </p>\n"},{"tags":["c","linux","multithreading","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13087398,"title":"Pthread condition wait and signal","body":"<p>I have a doubt regarding pthread_cond_wait and pthread_cond_signal functions. I was not able to understand after reading the man pages also.</p>\n\n<p>Please consider the following code.</p>\n\n<pre><code>void* thread_handler(){\n... // counts till COUNT_LIMIT is reached\nif (count == COUNT_LIMIT) {\n  pthread_cond_signal(&amp;count_threshold_cv);\n  printf(\"inc_count(): thread %ld, count = %d  Threshold reached.\\n\",\n         my_id, count);\n}\nprintf(\"inc_count(): thread %ld, count = %d, unlocking mutex\\n\",\n       my_id, count);\n...\n}\n\nvoid* thread_handler1(){\n... // waits till the previous thread has finished counting\npthread_mutex_lock(&amp;count_mutex);\nwhile (count&lt;COUNT_LIMIT) {\n   pthread_cond_wait(&amp;count_threshold_cv, &amp;count_mutex);\n   printf(\"watch_count(): thread %ld Condition signal received.\\n\", my_id);\n}\npthread_mutex_unlock(&amp;count_mutex);\npthread_exit(NULL);\n}\n</code></pre>\n\n<p>The code is working as per expectations. I am trying to understand the code. Here is how the program works</p>\n\n<ol>\n<li><p>Enter thread_handler1 and do cond_wait. From the man page i understood that cond_wait will immediatly release the lock atomically. <strong>So why are they releasing the lock again below in thread_handler1</strong></p></li>\n<li><p>After first thread has satisfied the condition and hits the condition signal <strong>I expected the thread which was blocking to execute its steps. Instead i got the printfs below the thread which executed the cond_signal. Why is this happening</strong></p></li>\n<li><p>Overall why do we need to take a lock before waiting and signalling. Cant this be done without a lock.</p></li>\n</ol>\n\n<p>For a briefer look at the program, please see the <a href=\"https://computing.llnl.gov/tutorials/pthreads/\" rel=\"nofollow\">Complete program</a> here. You can find it under the section \"Using Conditional Variables\"</p>\n\n<p>Thanks in advance</p>\n\n<p>Chidambaram</p>\n"},{"tags":["c#","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13086995,"title":"How can I do a threaded Client socket","body":"<p>I've done a simple ASPX page with just one <code>&lt;asp:Button&gt;</code>. This page will do a connection with a Windows Form application via Socket. </p>\n\n<p><strong>How Should Work</strong></p>\n\n<p>Everytime that I click in my <code>&lt;asp:Button&gt;</code> I have to pass some information to my Windows Form read, and then I will print it. </p>\n\n<p><strong>TCP Server Code</strong></p>\n\n<pre><code>public partial class PaginaTeste : System.Web.UI.Page\n{\n    private TcpListener tcpListener;\n    private Thread listenThread;\n\n    protected void Page_Load(object sender, EventArgs e)\n    {\n    }\n\n    protected void btnBotao_OnClick(object sender, EventArgs e)\n    {\n        this.tcpListener = new TcpListener(IPAddress.Any, 8849);\n        this.listenThread = new Thread(new ThreadStart(ListenForClients));\n        this.listenThread.Start();\n    }\n\n    private void ListenForClients()\n    {\n        this.tcpListener.Start();\n\n        while (true)\n        {\n            //blocks until a client has connected to the server\n            TcpClient client = this.tcpListener.AcceptTcpClient();\n\n            //create a thread to handle communication \n            //with connected client\n            Thread clientThread = new Thread(new ParameterizedThreadStart(HandleClientComm));\n            clientThread.Start(client);\n        }\n    }\n\n    private void HandleClientComm(object client)\n    {\n        TcpClient tcpClient = (TcpClient)client;\n        NetworkStream clientStream = tcpClient.GetStream();\n\n        byte[] message = new byte[4096];\n        int bytesRead;\n\n        while (true)\n        {\n            bytesRead = 0;\n\n            try\n            {\n                string serverResponse = \"571764;10.\";                        \n                Byte[] sendBytes = Encoding.ASCII.GetBytes(serverResponse);\n                clientStream.Write(sendBytes, 0, sendBytes.Length);\n                clientStream.Flush();\n            }\n            catch\n            {\n                //a socket error has occured\n                break;\n            }\n\n            if (bytesRead == 0)\n            {\n                //the client has disconnected from the server\n                break;\n            }\n        }\n\n        tcpClient.Close();\n    }\n</code></pre>\n\n<p><strong>Client Code (Windows Form)</strong></p>\n\n<pre><code>   public partial class Form1 : Form\n    {\n        TcpClient clientsocket2;\n        Thread thread;\n\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        private void Form1_Load(object sender, EventArgs e)\n        {         \n        }\n\n        private void button3_click(object sender, EventArgs e)\n        {\n            this.clientsocket2 = new TcpClient();\n           clientsocket2.Connect(\"server_ip\", 8849);       \n            this.thread = new Thread(new ThreadStart(this.imprimir));\n            this.thread.Start();\n        }\nprotected void imprimir()\n        {       \n            NetworkStream serverStream = clientsocket2.GetStream();\n            byte[] inStream = new byte[10025];\n            serverStream.Read(inStream, 0, (int)clientsocket2.ReceiveBufferSize);\n            string returndata = System.Text.Encoding.ASCII.GetString(inStream);\n\n            string r = \"Printing Test\";\n            int retorno = -1;\n\n            retorno = IniciaPorta(\"COM7\");            \n\n            if (retorno == 1)\n            {\n                ConfiguraModeloImpressora(7);\n                BematechTX(r);\n                AcionaGuilhotina(1);\n                FechaPorta();\n            }\n\n            clientSocket.Close();\n        }\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>If I click once in my <code>&lt;asp:Button&gt;</code> and initiallize my <code>Client Application</code> works fine. In the second time that I click in my <code>&lt;asp:Button&gt;</code> the parameter that I pass to my <code>Client Application</code> return empty. </p>\n\n<p><strong>Where I read empty in my client application</strong></p>\n\n<p><code>string returndata = System.Text.Encoding.ASCII.GetString(inStream);</code></p>\n"},{"tags":["windows","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13086831,"title":"Instruct win32 threads to run on a single processor core","body":"<p>I have a test program which would be much simpler if it could rely on threads being scheduled in strict priority order on Windows.  I'm seeing a low priority thread running alongside higher priority threads and wonder if this is happening because the different threads are being scheduled on different processor cores.</p>\n\n<p>Is there a way to force all Win32 threads in a process to use a single processor core?  <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686247%28v=vs.85%29.aspx\" rel=\"nofollow\">SetThreadAffinityMask</a> looks like it might be interesting but its docs aren't entirely clear and I'm not sure how to use it.</p>\n"},{"tags":["c#","multithreading","tcpclient"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":13085811,"title":"Again .NET TcpClient and Threads","body":"<p>I've read much on TcpClient and multithreading at stackoverflow but think I didn't find a clear answer to this.</p>\n\n<p>I have an application with 3 identical threads.\n(calling the same method on each thread object)</p>\n\n<p>Every thread creates his own (local) TcpClient instance and opens a tcp connection to his server (different IP addresses).</p>\n\n<p>The threads are supposed to do the same things only on a different server.\nThe 3 server machines are running identical server software.</p>\n\n<p>Now the 3 threads start a server request 'at the same time'.</p>\n\n<p>Are the TcpClient objects totally isolated on each thread ?\nOr may it be that the underlying streams are unwillingly shared ?</p>\n\n<p>I got the feeling that sometimes a thread gets data that's not from 'his' server.\nFor examlpe all threads are polling for a 'ready' flag. \nOnly Server 1 is ready and sets the flag, but thread 1 AND thread 2 see the flag set.</p>\n\n<p>There's a good chance that I'm doing things wrong.\nBut it would help to surely know that communication on the TcpClient objects in this way is safe.</p>\n\n<p>Thanks a lot for any suggestions,\nRalf</p>\n\n<p>PS: And yes, I am currently reading books and documentation on multithreading in C# 8-))</p>\n"},{"tags":["c#",".net","multithreading","backgroundworker"],"answer_count":5,"favorite_count":0,"up_vote_count":16,"down_vote_count":0,"view_count":5141,"score":16,"question_id":2542326,"title":"Proper way to Dispose of a BackGroundWorker","body":"<p>Would this be a proper way to dispose of a BackGroundWorker?  I'm not sure if it is necesary to remove the events before calling .Dispose().  Also is calling .Dispose() inside the RunWorkerCompleted delegate ok to do?</p>\n\n<pre><code>public void RunProcessAsync(DateTime dumpDate)\n{\n    BackgroundWorker worker = new BackgroundWorker();\n    worker.RunWorkerCompleted += new RunWorkerCompletedEventHandler(worker_RunWorkerCompleted);\n    worker.DoWork += new DoWorkEventHandler(worker_DoWork);\n    worker.RunWorkerAsync(dumpDate);\n}\n\nvoid worker_DoWork(object sender, DoWorkEventArgs e)\n{\n    // Do Work here\n}\n\nvoid worker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n{\n    BackgroundWorker worker = sender as BackgroundWorker;\n    worker.RunWorkerCompleted -= new RunWorkerCompletedEventHandler(worker_RunWorkerCompleted);\n    worker.DoWork -= new DoWorkEventHandler(worker_DoWork);\n    worker.Dispose();\n}\n</code></pre>\n"},{"tags":["iphone","objective-c","ios","multithreading","mqtt"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":667,"score":3,"question_id":7996279,"title":"How to create a background thread in iOS which continues after the app has been hidden from view","body":"<p>I am new to iPhone development and working through <strong>SamsTechYourself</strong> iPhone Development. I am trying to write an app that receives push notifications from an <code>MQTT</code> broker (similar to Facebook Messenger). </p>\n\n<p>I have compiled a C library called <code>libmosquitto</code> and have it running on the emulator, however I  am stuck trying to figure out how to make it continue to listen for notifications, while the app is in the background. My book mentions modes for <code>VOIP</code> and background sounds but does not go into much detail. </p>\n\n<p>Could anyone point me to a good tutorial in iPhone and background processes or gives me some tips on how to get started? </p>\n\n<p>What I want is a twitter like app, which gives a little popup info when a new message has been pushed from the broker.</p>\n"},{"tags":["c","multithreading","queue","arm","interrupt"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":13078394,"title":"What's the race condition in these two interrupt service routines?","body":"<p>I'm using an ARM microcontroller for a real-time systems course in my university. In the project I'm working on at the moment, I'm implementing the vector field histogram (VFH) algorithm.</p>\n\n<p>The problem is: I need to communicate between threads; more specifically, I want to have a thread that gets sensor data from rangefinders, make the necessary transformations to it and deposit them in a queue. Them, another thread must get this data and process it, etc.</p>\n\n<p>At the moment, I'm using a simpler version of it - one thread gets data from the ADCs (SensorAcquisitionHandler), another outputs the average of the first 5 items (at most) to a display (ControlSignalHandler).</p>\n\n<pre><code>/* Queue used to store data from the rangefinder sensors. */\nstatic unsigned int Sensors[100];\nstatic int SensorsHead = 0;\nstatic int SensorsTail = 0;\n\nvoid SensorAcquisitionHandler(void) {\n    /* Clear the interrupt. */\n    ADCIntClear(ADC0_BASE, 1);\n\n    int i; /* Index for the measurements buffer. */\n\n    /* There are only 3 rangefinders used. */\n    if (ADCSequenceDataGet(ADC0_BASE, 1, rangeBuffer) == 3) {\n        /* Put rangeBuffer's data into SensorDataQueue. */\n        /* Also, when using SensorDataQueue, must put what's the direction of \n        the corresponding range measurement. */\n\n        /* Critical section ahead!!! Turn off interrupts!!! */\n        IntMasterDisable();\n\n        /* Temporarily using the simple FIFO... */\n        for (i = 0; i &lt; 3; ++i) {\n            if (SensorsHead &lt; 100) {\n                Sensors[SensorsHead] = rangeBuffer[i];\n                SensorsHead++;\n            }\n        }\n\n        /* All is fine, turn on interrupts. */\n        IntMasterEnable();\n    }\n}\n\nvoid ControlSignalHandler(void) {\n    /* Clear the timer interrupt. */\n    TimerIntClear(TIMER0_BASE, TIMER_TIMA_TIMEOUT);\n\n    unsigned char i; /* Index for the measurements buffer. */\n    unsigned long average = 0;\n    char buffer[20];\n\n    /* Average first n (n &lt;= 5) elements from Sensors queue. */\n    for (i = 0; i &lt; 5 &amp;&amp; SensorsTail &lt; SensorsHead; ++i) {\n        average += Sensors[SensorsTail];\n        SensorsTail++;\n    }\n\n    IntMasterDisable();\n    average /= i;\n\n    sprintf(buffer, \"%d  \", average);\n\n    average = 0;\n\n    if (SensorsTail &gt;= SensorsHead) {\n        SensorsTail = 0;\n        SensorsHead = 0;\n    }\n\n    Display96x16x1StringDraw(buffer, 0, 0);\n    IntMasterEnable();\n}\n</code></pre>\n\n<p>The result is relatively stable for some time but, at random intervals, gets extremely high (the result is ~330 almost all the time). Also, when I use a symbolic debugger during the \"very high value\" moments, the indexes SensorTail and SensorHead can get to 300+ (the queue is a 100-element array).</p>\n\n<p>This sounds like some kind of overflow, but I can't visualize how it's happening. Can someone help me find it?</p>\n\n<p>I know the answer to the problem is \"use a thread-safe queue\", but I want to understand how a race condition is happening here, how the indexes are getting messed up, etc. Thank you!</p>\n"},{"tags":["java","multithreading","thread-safety","javac"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":13082037,"title":"Sharing a resource among Threads, different behavior in different java versions","body":"<p>This is the first time I've encountered something like below. </p>\n\n<ul>\n<li><p>Multiple Threads (Inner classes implementing Runnable) sharing a Data Structure (instance variable of the upper class). </p></li>\n<li><p>Working: took classes from Eclipse project's bin folder, ran on a Unix machine.</p></li>\n<li><p>NOT WORKING: directly compiled the src on Unix machine and used those class files. Code compiles and then runs with no errors/warnings, but one thread is not able to access shared resource properly.</p></li>\n<li><p>PROBLEM: One thread adds elements to the above common DS. Second thread does the following...</p>\n\n<pre><code>while(true){\n if(myArrayList.size() &gt; 0){\n //do stuff\n }\n</code></pre>\n\n<p>}</p></li>\n<li><p>The Log shows that the size is updated in Thread 1. </p></li>\n<li><p>For some mystic reason, the workflow is not enetering if() ... </p></li>\n</ul>\n\n<p>Same exact code runs perfectly if I directly paste the class files from Eclipse's bin folder.</p>\n\n<p>I apologize if I missed anything obvious. </p>\n\n<p>Code:</p>\n\n<pre><code>ArrayList&lt;CSRequest&gt; newCSRequests = new ArrayList&lt;CSRequest&gt;();\n</code></pre>\n\n<p>//Thread 1</p>\n\n<pre><code>private class ListeningSocketThread implements Runnable {\n    ServerSocket listeningSocket;\n\n    public void run() {\n        try {\n            LogUtil.log(\"Initiating...\");\n            init(); // creates socket\n            processIncomongMessages();\n            listeningSocket.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private void processIncomongMessages() throws IOException {     \n        while (true) {\n            try {\n                processMessage(listeningSocket.accept());\n            } catch (ClassNotFoundException e) {                    \n                e.printStackTrace();\n            }\n        }\n    }\n\n    private void processMessage(Socket s) throws IOException, ClassNotFoundException {\n        // read message\n        ObjectInputStream ois = new ObjectInputStream(s.getInputStream());\n        Object message = ois.readObject();\n        LogUtil.log(\"adding...: before size: \" + newCSRequests.size());\n        synchronized (newCSRequests) {\n                newCSRequests.add((CSRequest) message);\n        }\n        LogUtil.log(\"adding...: after size: \" + newCSRequests.size()); // YES, THE SIZE IS UPDATED TO &gt; 0\n        //closing....\n\n    }\n\n........\n</code></pre>\n\n<p>}</p>\n\n<pre><code>//Thread 2\nprivate class CSRequestResponder implements Runnable {\n\n        public void run() {\n            LogUtil.log(\"Initiating...\"); // REACHES..\n            while (true) {\n//              LogUtil.log(\"inside while...\"); // IF NOT COMMENTED, FLOODS THE CONSOLE WITH THIS MSG...\n                if (newCSRequests.size() &gt; 0) { // DOES NOT PASS\n                    LogUtil.log(\"inside if size &gt; 0...\"); // NEVER REACHES....\n                    try {\n                        handleNewCSRequests();\n                    } catch (IOException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n....\n}\n</code></pre>\n\n<p><strong>UPDATE</strong>\nThanks a lot @maasg ... </p>\n\n<p>Solution was to add synchronized(myArrayList) before I check the size in the Thread 2.</p>\n"},{"tags":["c#",".net","multithreading","backgroundworker","picturebox"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":160,"score":2,"question_id":12581529,"title":"C# Backgroundworker: What way to periodically update a PictureBox?","body":"<p>I'm using a BackgroundWorker to periodically check a hardware switch. Due to it is connected via a slow RS485 network, I have to delay the next status update.\nOn switch Status change I want to update an OK/nOK Picture Box. This is realized as a green OK pictureBox over a nOK pictureBox. No real work is done here.</p>\n\n<p>For expandability I decided to use the Backgroundworker. Finally I want to have a hidden worker, which a) provides globally the Status of three switches and b) updates on StatusChange the PictureBoxes.\nOnce the Backgroundworker is started, it works as expected. However the GUI freezes. </p>\n\n<p>The <a href=\"http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx\" rel=\"nofollow\">MSDN BackgroundWorker Class Note 1</a>\nsays, that GUI should be updated via ProgressChanged. I tried to raise this Event by Worker_Switch.ReportProgress(fakeProgress++) and failed. The PictureBox wasn't updated anymore.</p>\n\n<p><em>Snippet from designer</em></p>\n\n<pre><code>this.Worker_Switch = new System.ComponentModel.BackgroundWorker();\n// \n// Worker_Switch\n// \nthis.Worker_Switch.WorkerSupportsCancellation = true;\nthis.Worker_Switch.DoWork += new System.ComponentModel.DoWorkEventHandler(this.Worker_Switch_DoWork);\n</code></pre>\n\n<p><em>Snippet from Main Form</em></p>\n\n<pre><code>delegate void SetEventCallback(object sender, DoWorkEventArgs e);   // Threadsafe calls for DoWork\n\nprivate void btnBackgroundworker_Click(object sender, EventArgs e)\n{\n    if (!Worker_Switch.IsBusy)\n    {\n        Worker_Switch.RunWorkerAsync();                              \n    }\n}\n\nprivate void Worker_Switch_DoWork(object sender, DoWorkEventArgs e)\n{\n    // Worker Thread has no permission to change PictureBox \"pictureBoxSwitchrightOK\"\n        // Therefore this method calls itsself in the MainThread, if necessary.\n    while (!Worker_Switch.CancellationPending)\n    {\n      if (this.pictureBoxSwitchrightOK.InvokeRequired)              // Worker Thread\n    {\n            System.Threading.Thread.Sleep(400);\n        SetEventCallback myCall = new SetEventCallback(Worker_Switch_DoWork);\n        this.Invoke(myCall, new object[] { sender, e });\n    }\n    else                                                            // Main Thread\n    {\n        // Turns OK Picture Box invisible, if nOk State (Switch pushed)\n        pictureBoxSwitchrightOK.Visible = SwitchOK(\"right\");  // true: OK (green)\n        this.Refresh();\n\n    }\n}\n\nprivate bool SwitchOK(string rightOrLeft)               // select one of the switches\n{ (...)}                                    // gets hardware switch status\n</code></pre>\n\n<p><strong>Edit:</strong> Special Thanks to laszlokiss88 (3 possibilities) and JMK (for simplicity with <code>System.Windows.Forms</code> Timer from toolbox)</p>\n\n<p>This alternative from Toolbox also worked:</p>\n\n<pre><code>this.timer_Switch.Enabled = true;\n    this.timer_Switch.Interval = 400;\n    this.timer_Switch.Tick += new System.EventHandler(this.timer_Switch_Tick);\n\n    private void timer_Switch_Tick(object sender, EventArgs e)\n{\n    motorSwitchControl.Init();        // globally available Switch status                                               \n    SwitchRight = SwitchOK(\"right\");\n    SwitchRightOK.Visible = SwitchRight; \n\n    SwitchLeft = SwitchOK(\"left\");    // globally available Switch status\n    SwitchLeftOK.Visible = SwitchLeft;  \n    SwitchAllOK = SwitchRight &amp; SwitchLinks;\n    this.Refresh();\n}\n</code></pre>\n\n<p>a) Is it correct, that the Sleep() actually happens in the Worker Thread?\n- no Main Thread</p>\n\n<p>b) What is going wrong, if I manipulate user interface objects in DoWork? (Contrary to MSDN Note)\n- works in Main Thread?</p>\n\n<p>c) What is the correct way to periodically update a PictureBox? DoWork, ProgressChanged, RunWorkerCompleted...?\n- Three possibilities from laszlokiss88 answer.</p>\n"},{"tags":["c#","multithreading","timer","watin"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13001833,"title":"watIn - working with timer in winform","body":"<p>im using WatiN for app im working on. in the app i got a list of sites: <code>List&lt;string&gt; sites;</code></p>\n\n<p>and i got a timer that im runing every few second to load and send data or get data from the current site.</p>\n\n<p>when i try runing this code nothing happend, not even Exception. i have no idea why.</p>\n\n<pre><code>private void watiNMethod()\n    {\n        Settings.AutoStartDialogWatcher = false;\n\n                Settings.AutoStartDialogWatcher = false;\n                ie = new IE(webBrowser1.ActiveXInstance);\n\n                ie.GoTo(sites[runing]);\n                ie.WaitForComplete();\n                MessageBox.Show(\"done loading\");\n    }\n\n    int runing;\n    Thread watInThread;\n    private void button1_Click(object sender, EventArgs e)\n    {\n        timer = new System.Windows.Forms.Timer();\n\n        timer.Start();\n\n        watInThread = new Thread(watiNMethod);\n        watInThread.SetApartmentState(ApartmentState.STA);\n\n        runing = 0;\n\n    }\n\n    private void timer_tick(object sender, EventArgs e)\n    {\n\n        if (runing &lt;= sites.Count)\n        {\n            watInThread.Start();\n        }\n        else\n        {\n            timer.Stop();\n        }\n\n        runing++;\n    }\n</code></pre>\n\n<p>i want to be able to load to the web browser control, wait for him to complete with WatiN methods, and send data to the site or just get data from him.</p>\n\n<p>im not sure how do this, becuse i have to use Thread to run WatiN inside the <code>WebBrowswer</code> Control.</p>\n\n<p>(sorry for my english)</p>\n"},{"tags":["c++","multithreading","asynchronous","c++11"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":114,"score":3,"question_id":13078942,"title":"Segmentation fault (core dumped) using async in C++11","body":"<p>I created a function to convert an existing tree object to a string. Format of the string is </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>parent ( child1 ) ( child2 ( childOfChild2 ) )\n</code></pre>\n\n<p>The program outputs the string correctly, does some other work, but at the and crashes with </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Segmentation fault (core dumped)\n</code></pre>\n\n<p>This is the function (<code>getTree(this-&gt;root)</code> outputs whole tree):</p>\n\n<pre class=\"lang-c++ prettyprint-override\"><code>template &lt;typename T&gt;\nstring Tree&lt;T&gt;::getTree(const Node&lt;T&gt;&amp; node) {\n    if (node.isLeaf()){\n        return to_string(node.value);\n    }\n\n    vector&lt;future&lt;string&gt;&gt; results; //each element represents a subtree connected to \"node\"\n    for (auto child:node.children){\n        results.push_back(move(async(&amp;Tree&lt;T&gt;::getTree,this,ref(*child))));\n    }\n\n    string children(\"\");\n    for (auto&amp; result:results){\n        children+=string(\" (\") + result.get()+ string(\") \");     //this creates Segmentation fault, but the output is correct\n        //children+=string(\"\");                                  //this does not create Segmentation fault\n        //children+=string(\"foo\");                               //this creates Segmentation fault\n    }\n\n    return to_string(node.value)+children;\n}  \n</code></pre>\n\n<p>Some info about the variables:</p>\n\n<pre><code>vector&lt;shared_ptr&lt;Node&gt;&gt; children;\n</code></pre>\n\n<p>Please tell if you need more info. The full source is <a href=\"https://dl.dropbox.com/u/107383231/tree.cpp\" rel=\"nofollow\">tree.cpp</a> and <a href=\"https://dl.dropbox.com/u/107383231/tree.h\" rel=\"nofollow\">tree.h</a>.</p>\n"},{"tags":["java","multithreading","groovy","thread-safety"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13076785,"title":"Simple Groovy thread manager","body":"<p>I wrote a little thread manager in Groovy. The manager takes an array, a task to execute on an array, and a chunk size. The task is then executed in a separate thread, and the results added to a result array.</p>\n\n<p>This is the class code:</p>\n\n<pre><code>class ParallelManager {\n\n  static def _threads = []\n  static def _threadsFinishedCorrectly = []\n  static  def _results = []\n\n  static def runParallelTask( def dataArray, def taskFunc, int chunkSize ){\n    assert chunkSize &gt; 0\n    assert taskFunc\n    if (dataArray.size()==0) return\n\n    assert dataArray.size() &gt;= 0\n\n    def subArray = partitionArray(dataArray, chunkSize)\n    assert subArray.size() &gt; 0\n\n    subArray.each{ arrChunk-&gt;\n        _threads.add( Thread.start{\n\n            def chunkResults = taskFunc(arrChunk)\n            assert chunkResults != null \n            _results.add(chunkResults) // EXCEPTION HERE\n            _threadsFinishedCorrectly.add(true)\n        })\n    }\n\n    // wait for all threads to finish\n    _threads.each{ it.join() }\n    log.info(\"Waiting for all threads to finish...\")\n\n    assert _threadsFinishedCorrectly.size() == _threads.size(),'some threads failed.'\n    assert _results.size() == _threads.size() \n    log.info(\"${_threads.size()} finished.\")\n\n    return _results\n}\n\n/**\n* Util function\n* @param array\n* @param size\n* @return\n*/\n  static def partitionArray(array, size) {\n   def partitions = []\n   int partitionCount = array.size() / size\n\n   partitionCount.times { partitionNumber -&gt;\n       def start = partitionNumber * size\n       def end = start + size - 1\n       partitions &lt;&lt; array[start..end]\n   }\n\n   if (array.size() % size) partitions &lt;&lt; array[partitionCount * size..-1]\n   return partitions\n}\n</code></pre>\n\n<p>The manager can be called like this:</p>\n\n<pre><code>  def parallFunc = { array-&gt;\n        log.info \"I'm multiplying $array by 2\"\n        return array.collect{it*2}\n    }\n\n  def results = ParallelManager.runParallelTask( [1,2,3,4,5,6,7,8], parallFunc, 3)\n</code></pre>\n\n<p>This code occasionally throws this Exception at the line marked above:</p>\n\n<pre><code> Exception in thread \"Thread-3\" java.lang.ArrayIndexOutOfBoundsException: 1\n [java]     at java.util.ArrayList.add(ArrayList.java:352)\n [java]     at java_util_List$add.call(Unknown Source)\n</code></pre>\n\n<p>Do you have a fix for this issue? I think a little thread manager like this one will be useful to many people to speed up common tasks in their code.</p>\n\n<p>Cheers,\nMulone</p>\n"},{"tags":["c#","multithreading","refactoring","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13083077,"title":"How to handle the state of a method that runs in a BackgroundWorker","body":"<p>The code that I'm working on at the moment had a method that ran in the UI thread. But it was taking a long time, so I decided to put it in a BackgroundWorker. The code was normally editing the UI and when I changed the thread there came the problem of editing the controls in the UI thread. So what I did was to make the method report it's state, and change the UI in ProgressChanged event. To report the progress, this method takes one object named \"userState\", but for my purposes, I had to report more than one object. So I chose to do the following:</p>\n\n<pre><code>        // Create a dictionary to keep method state for reporting.\n        // \"state\" item represents a state type; \"error\", \"update\", \"success\".\n        // \"message\"d item represents the message associated with the state.\n        // \"result\" item represents the function result.\n        // \"invisiblecolumns\" item represents the invisible columns this method finds.\n        var methodState = new Dictionary&lt;string, object&gt; { { \"state\", \"update\" }, { \"message\", string.Empty }, \n                                                           { \"result\", null }, { \"invisiblecolumns\", null } };\n</code></pre>\n\n<p>But I'm not sure if this is a good way to do it. What would your suggestion be as to how to handle the reporting process in a background worker? What is a good practice? And is what I did a good workaround?</p>\n"},{"tags":["wpf","multithreading","user-interface","concurrency"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":710,"score":1,"question_id":5266341,"title":"WPF UI thread freezes momentarily when a mouseup event triggers an animation","body":"<p>I have a WPF application that is constantly animating. One interaction (mouseup) and animation in particular seems to freeze the UI thread for long enough to be very noticable.</p>\n\n<p>Concurrency Visualizer shows me my UI thread is blocked for 300 - 500ms. It also shows the stack while it's blocked and the unblocking stack:</p>\n\n<p><strong>Main thread stack while frozen</strong>:<br>\nCategory = Synchronization<br>\nDelay = 495.2472 ms  </p>\n\n<pre><code>ntoskrnl.exe!SwapContext_PatchXRstor\nntoskrnl.exe!KiSwapContext\nntoskrnl.exe!KiCommitThreadWait\nntoskrnl.exe!KeWaitForSingleObject\nntoskrnl.exe!NtWaitForSingleObject\nntoskrnl.exe!KiSystemServiceCopyEnd\nntdll.dll!NtWaitForSingleObject\nkernelbase.dll!WaitForSingleObjectEx\nwpfgfx_v0400.dll!CMilConnection::SynchronizeChannel\nwpfgfx_v0400.dll!CMilChannel::SyncFlush\nwpfgfx_v0400.dll!MilComposition_SyncFlush\nclr.dll!DoNDirectCallWorker\npresentationcore.dll!System.Windows.Media.Composition.DUCE+Channel.**SyncFlush**\npresentationcore.dll!System.Windows.Media.MediaContext.NotifyChannelMessage\npresentationcore.dll!System.Windows.Media.MediaContextNotificationWindow.MessageFilter\nwindowsbase.dll!MS.Win32.HwndWrapper.WndProc\nwindowsbase.dll!MS.Win32.HwndSubclass.DispatcherCallbackOperation\nwindowsbase.dll!System.Windows.Threading.ExceptionWrapper.InternalRealCall\nwindowsbase.dll!MS.Internal.Threading.ExceptionFilterHelper.TryCatchWhen\nwindowsbase.dll!System.Windows.Threading.Dispatcher.WrappedInvoke\nwindowsbase.dll!System.Windows.Threading.Dispatcher.InvokeImpl\nwindowsbase.dll!MS.Win32.HwndSubclass.SubclassWndProc\nwindowsbase.dll!dynamicClass.IL_STUB_ReversePInvoke\nclr.dll!UMThunkStubAMD64\nuser32.dll!UserCallWinProcCheckWow\nuser32.dll!DispatchMessageWorker\nclr.dll!DoNDirectCall__PatchGetThreadCall\nwindowsbase.dll!dynamicClass.IL_STUB_PInvoke\nwindowsbase.dll!System.Windows.Threading.Dispatcher.PushFrameImpl\npresentationframework.dll!System.Windows.Application.RunInternal\npresentationframework.dll!System.Windows.Application.Run\nxqstream.windows.exe!IQ.IR.Stream.WPF.App.Main\n</code></pre>\n\n<p><strong>Unblocking Stack:</strong></p>\n\n<pre><code>ntoskrnl.exe! ?? ?? ::FNODOBFM::`string'\nntoskrnl.exe!NtSetEvent\nntoskrnl.exe!KiSystemServiceCopyEnd\nntdll.dll!ZwSetEvent\nkernelbase.dll!SetEvent\nwpfgfx_v0400.dll!CMilConnection::PostMessageToClient\nwpfgfx_v0400.dll!CMilServerChannel::SignalFinishedFlush\nwpfgfx_v0400.dll!CComposition::FlushChannels\nwpfgfx_v0400.dll!CPartitionThread::RenderPartition\nwpfgfx_v0400.dll!CPartitionThread::Run\nwpfgfx_v0400.dll!CPartitionThread::ThreadMain\n</code></pre>\n\n<p>The main thread is waiting on a background thread. That background thread is doing a number of things, but this stack takes up ~3/4 of the time:</p>\n\n<p><strong>Blocking thread's largest task:</strong>\nCategory = I/O<br>\nDelay = 347.5122 ms  </p>\n\n<pre><code>ntoskrnl.exe!SwapContext_PatchXRstor\nntoskrnl.exe!KiSwapContext\nntoskrnl.exe!KiCommitThreadWait\nntoskrnl.exe!KeWaitForSingleObject\ndxgmms1.sys!VIDMM_GLOBAL::CloseOneAllocation\ndxgmms1.sys!VidMmCloseAllocation\ndxgkrnl.sys!DXGDEVICE::DestroyAllocations\ndxgkrnl.sys!DXGDEVICE::ProcessTerminationList\ndxgkrnl.sys!DXGDEVICE::TerminateAllocations\ndxgkrnl.sys!DXGDEVICE::DestroyAllocation\ndxgkrnl.sys!DxgkDestroyAllocation\nwin32k.sys!NtGdiDdDDIDestroyAllocation\nntoskrnl.exe!KiSystemServiceCopyEnd\ngdi32.dll!ZwGdiDdDDIDestroyAllocation\nd3d9.dll!DeallocateCB\ndlumd64.dll![dlumd64.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\nnvd3dumx.dll![nvd3dumx.dll]\ndlumd64.dll![dlumd64.dll]\ndlumd64.dll![dlumd64.dll]\nd3d9.dll!DdBltLH\nd3d9.dll!CSwapChain::PresentMain\nd3d9.dll!CSwapChain::Present\nwpfgfx_v0400.dll!CD3DDeviceLevel1::PresentWithD3D\nwpfgfx_v0400.dll!CD3DDeviceLevel1::Present\nwpfgfx_v0400.dll!CHwDisplayRenderTarget::PresentInternal\nwpfgfx_v0400.dll!CHwDisplayRenderTarget::Present\nwpfgfx_v0400.dll!CHwHWNDRenderTarget::Present\nwpfgfx_v0400.dll!CDesktopRenderTarget::Present\nwpfgfx_v0400.dll!CDesktopHWNDRenderTarget::Present\nwpfgfx_v0400.dll!CSlaveHWndRenderTarget::Present\nwpfgfx_v0400.dll!CRenderTargetManager::Present\nwpfgfx_v0400.dll!CComposition::Present\nwpfgfx_v0400.dll!CPartitionThread::PresentPartition\nwpfgfx_v0400.dll!CPartitionThread::Run\nwpfgfx_v0400.dll!CPartitionThread::ThreadMain\n</code></pre>\n\n<p>I've read SyncFlush() is called after several MilCore functions and appears to cause the changes that have been sent to be processed immediately (credit to Ray Burns). </p>\n\n<p>I'd like to get rid of this freeze, but I'm also hoping to develop a better understanding of what WPF is doing in this situation so that I can build a better mental model of how WPF works.</p>\n"},{"tags":["mysql","multithreading","process"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":5226,"score":3,"question_id":621516,"title":"How can I set the max number of mysql processes or threads?","body":"<p>ps axuw| grep mysql indicates only mysql process but if I run htop I can see 10 rows each one of them with a separate PID. So I wonder if they are threads or processes that for some reason I cannot see using ps.</p>\n\n<p>Would it make any sense to try to limit them to 2 on my development machine where I don't need concurrent access of many clients.</p>\n\n<p>BTW Running on Ubuntu 8.10</p>\n"},{"tags":["java","multithreading","join","interrupt"],"answer_count":6,"favorite_count":10,"up_vote_count":58,"down_vote_count":1,"view_count":62151,"score":57,"question_id":671049,"title":"How do you kill a thread in Java?","body":"<p>How do you kill a thread in Java?</p>\n"},{"tags":["multithreading","visual-c++","dll","process","createprocess"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13081128,"title":"Create Process by passing a Function in Visual C++","body":"<p>I am a newbie in C++ working on a module which needs parallel processing.</p>\n\n<p>I need to create 2 or 3 process by passing different functions (which perform some specific task) to each process created from main (similar to <a href=\"http://msdn.microsoft.com/en-us/library/kdzttdcb%28v=vs.80%29.aspx\" rel=\"nofollow\">_beginthread</a>) in C++ where the main should exit as soon as after creating all process and the new processes created would continue until they finish.</p>\n\n<p>When I tried with threads, My main should wait until all my threads get completed if not as soon as my main exits, all my childs are getting killed. But I don't want this approach because there are many main methods which are present in multiple DLLs. I need to call each main in every DLL and those main(s) will take care of creating the required number of processes.</p>\n\n<p>I tried looking at <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx\" rel=\"nofollow\">CreateProcess</a> function which has the following syntax.</p>\n\n<pre><code>BOOL WINAPI CreateProcess(\n  _In_opt_     LPCTSTR lpApplicationName,\n  _Inout_opt_  LPTSTR lpCommandLine,\n  _In_opt_     LPSECURITY_ATTRIBUTES lpProcessAttributes,\n  _In_opt_     LPSECURITY_ATTRIBUTES lpThreadAttributes,\n  _In_         BOOL bInheritHandles,\n  _In_         DWORD dwCreationFlags,\n  _In_opt_     LPVOID lpEnvironment,\n  _In_opt_     LPCTSTR lpCurrentDirectory,\n  _In_         LPSTARTUPINFO lpStartupInfo,\n  _Out_        LPPROCESS_INFORMATION lpProcessInformation\n);\n</code></pre>\n\n<p>Based on that I understood what ever functions I am talking about in the beginning which I will be passing to process(es) should be created as separate console application (Eg: exe) and then use here.</p>\n\n<p>Is my understanding correct? or is there any other way to really call a function in separate process which are independent of each other?</p>\n\n<p>Please let me know if any further information is required</p>\n"},{"tags":["multithreading","matlab"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13072936,"title":"matlab multithreaded functions","body":"<p>\"sort\" is one of the built-in functions in matlab(R2010a) that takes advantage of\nmultithreading. When I use \"sort\" on a large matrix, on a machine with\n8 cores, I can see that all the cores are activated but the reported\ncpu usage for each is never above 25%. While my own openmp \"mex\" fully\nemploys all the cores.\nIs there a way of forcing matlab to use all ?</p>\n\n<p>Thanks in advance,</p>\n\n<p>Kamran </p>\n"},{"tags":["java","multithreading","solr","solrcloud"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13081425,"title":"Invalid thread ID parameter: 0 java, how could this happen?","body":"<p>I use solr 4.0 and I meet a weird error. I run a solr cloud with one shard three nodes.The ThreadDumpHandler tells there is a invalid thread with id 0. </p>\n\n<pre><code>ThreadMXBean tmbean = ManagementFactory.getThreadMXBean();\nlong[] tids = tmbean.getAllThreadIds();\nlog.info(\"all threads tids:\" + (tids == null? \"null\" :tids.length));\nif (tids != null) {\n  for (long l :tids) {\n    log.info(String.valueOf(l));\n  }\n  log.info(\"all thread infos:\");\n  NamedList&lt;SimpleOrderedMap&lt;Object&gt;&gt; lst = new NamedList&lt;SimpleOrderedMap&lt;Object&gt;&gt;();\n  for (long l :tids) {\n    if (l &gt; 0) {\n      ThreadInfo ti = tmbean.getThreadInfo(l, Integer.MAX_VALUE);\n      if (ti != null) {\n        log.info(ti.toString());\n        lst.add( \"thread\", getThreadInfo( ti, tmbean ) );\n      }\n    } else {\n      log.info(\"invalid thread id:\" + l);\n    }\n\n  }\n  system.add( \"threadDump\", lst );\n}\n</code></pre>\n"},{"tags":["python","multithreading","decorator","memoization","gil"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13079842,"title":"A thread-safe memoize decorator","body":"<p>I'm trying to make a memoize decorator that works with multiple threads.</p>\n\n<p>I understood that I need to use the cache as a shared object between the threads, and acquire/lock the shared object. I'm of course launching the threads:</p>\n\n<pre><code>for i in range(5):\n            thread = threading.Thread(target=self.worker, args=(self.call_queue,))\n            thread.daemon = True\n            thread.start()\n</code></pre>\n\n<p>where worker is:</p>\n\n<pre><code>def worker(self, call):\n    func, args, kwargs = call.get()\n    self.returns.put(func(*args, **kwargs))\n    call.task_done()\n</code></pre>\n\n<p>The problem starts, of course, when I'm sending a function decorated with a memo function (like <a href=\"http://code.activestate.com/recipes/325905-memoize-decorator-with-timeout/\" rel=\"nofollow\">this</a>) to many threads at the same time.</p>\n\n<p>How can I implement the memo's cache as a shared object among threads?</p>\n"},{"tags":["android","multithreading","handler"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":507,"score":1,"question_id":9215540,"title":"handler.post(runnable) doesnt always execute the run method in android","body":"<p>I have created a Handler instance in the main ui thread(mUIHandler) and from a worker thread(other thread) when i am trying to execute the run method of the runnable the run method gets executed almost 9 out of 10 times but there is that 1 time when it doesn't get executed.</p>\n\n<p><strong>mUIHandler.post(uiRunnable)</strong> --> does it not always guarantee to execute the run method present in the runnable?</p>\n\n<p>I even added log methods to check and could see that the logs till the post method innvocation gets executed but the run method logs don't get displayed.</p>\n\n<p>How does the post(runnable) work internally? does it guarantee that the ui thread(thread with the handler) will excute this as soon as post is invoked?</p>\n\n<p>Any help would be appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","multithreading","console-application","finalizer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13080123,"title":"Java using finalize for child thread shutdown?","body":"<p>I am writing a multi-threaded java console application that I am intending to kill via Ctrl-C. In this situation, if I have a class that encapsulates a single thread is it good practice to shutdown the child thread in the encapsulating classes finalize method?</p>\n\n<p>Is it possible to get artifacts of the original application left running if you Ctrl-C the original app and all threads are not shutdown properly?</p>\n\n<p>pseudo code:</p>\n\n<pre><code>public class ParentClass {\n\nThread childThread = new Thread(new ExampleRunnable());\n\n  @Override protected void finalize() throws Throwable {\n   childThread.shutdown();\n  }\n}\n\npublic class ExampleRunnable implements Runnable {\n\n private volatile boolean alive = false;\n\n @Override\n public void run() {\n  alive = true;\n  while(alive) {\n   //do some work\n  }\n }\n\n  public void shutdown() {\n   alive = false;\n  }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","delegates","invoke"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13048926,"title":"CallbackOnCollectedDelegate was detected on Invoke() between threads","body":"<p>I've read solutions to similar problems, but I'm having trouble getting them to work in my case.  I'm getting the following error on a C# .NET 4.0 project running in Visual Studio 2010:</p>\n\n<blockquote>\n  <p>CallbackOnCollectedDelegate was detected Message: A callback was made\n  on a garbage collected delegate of type\n  'VLCMTest!VLCMTest.Data+VCECLB_GrabFrame_CallbackEx::Invoke'. This may\n  cause application crashes, corruption and data loss. When passing\n  delegates to unmanaged code, they must be kept alive by the managed\n  application until it is guaranteed that they will never be called.</p>\n</blockquote>\n\n<p>Here is my situation:  I have a background thread that is notified when a frame of data is collected. </p>\n\n<pre><code>protected AutoResetEvent frameGrabbed;\npublic event EventHandler&lt;DataFrameInfo&gt; FrameGrabbedEvent;\n\n    private void DataCollectionThread()\n    {\n        while (true)\n        {\n            frameGrabbed.WaitOne();\n\n            lock (locker)\n            {\n                FrameGrabbedEvent(this, new DataFrameInfo(lastFrame.BufferIndex, lastFrame.FrameNumber, lastFrame.FrameTimestamp));\n            }\n        }\n    }\n</code></pre>\n\n<p>The DataFrameInfo class stores some information about the frame (index into the frame buffers, frame number, and timestamp).  I create an instance of this class and pass it to the main thread so the data can be displayed.  The code in the main thread looks like this:</p>\n\n<pre><code>    // Delegate for the Invoke call, \n    // make it static to prevent a problem with garbage collection\n    delegate void GetFrameDelegate(DataFrameInfo frameInfo);\n    private static GetFrameDelegate d;\n\n    /// &lt;summary&gt;\n    /// Did we just receive a frame?\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"source\"&gt;&lt;/param&gt;\n    /// &lt;param name=\"args\"&gt;&lt;/param&gt;\n    void frameGrabbed(object source, DataFrameInfo args)\n    {\n        if (this.InvokeRequired)\n        {\n            // It's on a different thread, so use Invoke.\n            d = new GetFrameDelegate(GetFrame);\n            this.Invoke(d, new object[] { args });\n            return;\n        }\n\n        // Get the Frame\n        GetFrame(args);\n    }\n\n    private void GetFrame(DataFrameInfo frameInfo)\n    {\n        // Call Display Frame\n        Debug.WriteLine(\"Frame: The bufferIndex is \" + frameInfo.BufferIndex);\n        Debug.WriteLine(\"Frame: The number is \" + frameInfo.FrameNumber);\n        Debug.WriteLine(\"Frame: The timestamp is \" + frameInfo.FrameTimestamp / 1000);\n    }\n</code></pre>\n\n<p>The FrameGrabbedEvent is connected to the frameGrabbed() function.  Since frameGrabbed() is being called from another thread, Invoke should be required.  Then for now, I'm just trying to dump out the frame details before I work on displaying the data.  </p>\n\n<p>Interestingly enough, the program will run fine for a while.  As soon as I move the main window of the program around the desktop, the error appears almost instantly.  I must be changing the timing just enough that an object is getting garbage collected before it's used.  It seemed like the solution most suggested was to make the delegate static, but that's not working for me.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Sounds like I missed some relevant code.  Below is the code that causes the frameGrabbed event.  Essentially it's an interrupt handler that is called by a DLL that I'm using.  </p>\n\n<p>I declare the following:</p>\n\n<pre><code>// Function pointer used by StartGrabEx\npublic delegate void GrabFrame_CallbackEx(IntPtr userData, ref FrameInfoEx frameInfo);\n</code></pre>\n\n<p>Then I start the data collection with:</p>\n\n<pre><code>    public void Start()\n    {\n\n        // Start grabbing frames\n        isGrabRunning = true;\n        GrabFrame_CallbackEx callback = new GrabFrame_CallbackEx(GrabCallback);\n        StartGrabEx(callback);\n    }\n</code></pre>\n\n<p>The GrabCallback function then looks like this:</p>\n\n<pre><code>    FrameInfo lastFrame;\n\n    private void GrabCallback(IntPtr userData, ref FrameInfoEx frameInfo)\n    {\n        // Are we grabbing frames?\n        if (!isGrabRunning)\n        {\n            return;\n        }\n\n        lock (locker)\n        {\n            lastFrame = new DataFrameInfo(bufferIndex, frameInfo.number, frameInfo.timestamp);\n        }\n\n        // We've captured a frame, notify the DataCollectionThread\n        frameGrabbed.Set();\n    }\n</code></pre>\n\n<p>Looking over this update, perhaps the problem is with lastFrame, although I thought I changed the code to update lastFrame in GrabCallback (rather than using new) and that still failed.</p>\n\n<p><strong>Update #2</strong></p>\n\n<p>Perhaps I should also mention that the DataCollectionThread is declared as such:</p>\n\n<pre><code>DataCollectionThread = new Thread(DataCollectionThread );\nDataCollectionThread .Name = \"DataCollectionThread \";\nDataCollectionThread .IsBackground = true;\nDataCollectionThread .Start();\n</code></pre>\n"},{"tags":["java","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13063135,"title":"what's the state of java thread when socket io.read() can't get any data","body":"<p>as titled, what's the state of java thread when socket io.read() can't get any data.\nMany articles mentioned the io will be blocked, but jdk say blocking occured in getting lock monitor?<br>\nhow to understand it?</p>\n"},{"tags":["objective-c","multithreading","blocks","gcd","sendasynchronousrequest"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12685239,"title":"Are Objective-C blocks always executed in a separate thread?","body":"<p>Are Objective-C blocks always executed in a separate thread?</p>\n\n<p>Specifically, I'm asking about the sendAsynchronousRequest:queue:completionHandler method of the NSURLConnection class. This is the scenario:</p>\n\n<blockquote>\n  <p>Main thread (1st thread) calls the sendAsynchronousRequest method the\n  sendAsynchronousRequest is executed on a 2nd thread, managed by the\n  NSOperationQueue when method is completed and calls\n  commpletionHandler, which thread is it executed on?   2nd thread? yet\n  another 3rd thread? or the 1st thread?</p>\n</blockquote>\n\n<p>Thanks!</p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13057060,"title":"Adding more information to Thread Executors?","body":"<p>It is possible to create various type of Thread Executors in Java, <code>singleThreadedExecutor</code>, <code>fixedThreadedExecutor</code> etc.  Is there any way I can add something so that when I invoke <code>getThreadName()</code> and <code>getThreadID()</code> on an executing thread, I can see what Thread executor it has come from?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","multithreading","boost"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13076202,"title":"boost::unique_lock and boost::shared_lock for reader writer locks","body":"<p>We have implemented a reader writer lock with </p>\n\n<pre><code> typedef boost::unique_lock&lt;boost::shared_mutex&gt; WriterLock;\n typedef boost::shared_lock&lt;boost::shared_mutex&gt; ReadersLock;\n</code></pre>\n\n<p>where we have many multithreaded readers and only a few writers. \nReaders share access with other readers but block on a writer.\nWriter blocks until it has exclusive access to the resource. </p>\n\n<p>We could not find this in the boost documentation...\nWhat is the policy to prevent Writer starvation?<br>\nFor example if there are many readers all pounding the lock from a thread pool, is there any guarantee upper limit on number of lock tries before the writer finally acquires the lock?</p>\n\n<p>We been seeing performance numbers that seem to indicate the write has to wait until there are no readers at all and there are rare cases where that is a long time, since new readers can request locks while the current readers are being serviced. In that case it seems that in our code the writer is has to wait a very long time until there are no reads at all.</p>\n\n<p>We would prefer a more queue like system, where when a writer request a lock, all the current readers drain out but all new incoming readers block behind the writer request. </p>\n\n<p>What is the behavior of the upgradeable lock concept in Boost?\n<a href=\"http://www.boost.org/doc/libs/1_35_0/doc/html/thread/synchronization.html#thread.synchronization.mutex_concepts.upgrade_lockable\" rel=\"nofollow\">Boost threads</a></p>\n\n<p>Its does not say either way how it handles writer starvation. </p>\n"},{"tags":["java","multithreading","spring","executorservice","apache-commons-dbcp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13076124,"title":"Apache DBCP with executor or multithreaded environment","body":"<p>I have the following code in my services.xml</p>\n\n<pre><code>&lt;bean id=\"executorService\" class=\"java.util.concurrent.Executors\" factory-method=\"newFixedThreadPool\"&gt;\n    &lt;constructor-arg value=\"10\" /&gt;\n&lt;/bean&gt;\n&lt;task:annotation-driven executor=\"executor\" /&gt;\n\n&lt;task:executor id=\"executor\" pool-size=\"10\" queue-capacity=\"100\" rejection-policy=\"CALLER_RUNS\" /&gt;\n</code></pre>\n\n<p>In the same project, I also have connections to the database, that use dbcp.BasicDataSource.</p>\n\n<p>I've read that DBCP is effective mostly when your app is single-threaded, NOT multi-threaded. The use of executor tells me that the app is multi-threaded. Do you think the use of DBCP here is not proper? Would this be a good practice? Or, am i living an age-old myth that DBCP can't handle multi-hreaded environment?</p>\n\n<p>Any guidance in the right direction would be appreciated.</p>\n"},{"tags":["java","multithreading","swt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13075755,"title":"Java: Invalid thread access","body":"<p>I am java noob programmer and I have got problem with SWT Exception Invalid thread access, I have look for that and I have found that <em>It happens when you try to act upon an interface item from a thread that's not the UI thread.</em> but I don't know how to fix it.</p>\n\n<p><strong>Problem:</strong>\nI have got 4 classes:</p>\n\n<ul>\n<li>notify - create swt window that shows notify</li>\n<li>main thread - download content from the net and using notify class shows notifications</li>\n<li>Window - it shows tray icon, settings and it is main class - it start main thread</li>\n<li>class that shows notifications in second swt window.</li>\n</ul>\n\n<p>Problem is that it crash with Invalid thread access. I have no idea how to <strong>show two swt windows (completely different classes)</strong></p>\n\n<hr>\n\n<p>That application downloads webpage, parse it and get information I want. Then using class <em>notify</em> it shows notification. I added class <em>Window</em> that is SWT Window and it shows tray icon, there are settings it also is main class and that class run <em>ZadaneReader</em> thread. <strong>First question:</strong> should I add SWT window (main goal of that is: tray icon and settings) in other way?</p>\n\n<p>My application contains following classes:</p>\n\n<ul>\n<li>ZadaneReader - it downloads webpage, parse it and with class <em>Notify</em>, it shows notification</li>\n<li>Notify - that class shows notifiations with 2 ways:\na) using exec <em>notify-send</em> (but it is Ubuntu only in that way) and b) it create object UniNotifyWindow that is second SWT window that shows notifications</li>\n<li>UniNotifyWindow - swt window that shows its own notification</li>\n<li>Window - settings, tray icon, <strong>main class at the moment</strong> it start its thread and ZadaneReader thread</li>\n</ul>\n\n<p>At the moment: it works when I am not using UniNotifyWindow <strong>or</strong> I am not using Window (start Zadane thread with tester class).</p>\n\n<p>I suppose it is noobish question and I have made many mistakes, but I wish you won't blame me but I would be pleased if you could tell me what I am doing wrong.</p>\n\n<p><strong>Source:</strong> <a href=\"https://docs.google.com/open?id=0B5VL4J_7HrgaTkt4a1Q2VVQxZEE\" rel=\"nofollow\">https://docs.google.com/open?id=0B5VL4J_7HrgaTkt4a1Q2VVQxZEE</a></p>\n"},{"tags":["vb.net","multithreading","timer","delegates","callback"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13075458,"title":"using thread callback to fire event through timer","body":"<p>Ok I am using a vb.net dll class (not a form application).</p>\n\n<p>In this class I am using a method that creates a timer and in the end will call a method that will throw an event.</p>\n\n<p><code>timerDriver = New System.Timers.Timer()</code></p>\n\n<p><code>timerDriver.Interval = 500</code></p>\n\n<p><code>timerDriver.Enabled = True</code></p>\n\n<p><code>AddHandler timerDriver.Elapsed, AddressOf DriverLicenseInTray</code></p>\n\n<p>I'm gonna describe part of the process as if it were working</p>\n\n<p>So the user presses a button on a .asp page that starts the scanner.  Once the scanner has been started, the timer process is constantly listening without locking out the page (basically this process does not effect anything the user is doing).  Now, the software is watching for a card to be inserted into this scanner.  As soon as this is true, it calls a method that processes the card.  After the card has been processed it calls <code>RaiseEvent ProcessCard</code> which throws the event to a .asp page that has an appropriate event handler.</p>\n\n<p>The issue I'm having is <code>RaiseEvent</code>.  It is raising it on the wrong thread because of the timer.  Does anyone know how to fix this?</p>\n\n<p>I've searched and I see that I will probably have to use a delegate BUT i don't have  Me.Invoke or anything.invoke.  and if i'm right, invoke is what fires the event on the main thread?  I've searched the msdn pages like crazy and their fixes are not fixing mine.</p>\n\n<p>I know that the RaiseEvent to the .asp is working because if i throw that on the main method, before the timer, the .asp page catches it.</p>\n"},{"tags":["java","multithreading","synchronization"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":145,"score":2,"question_id":13022734,"title":"Reverse read write lock","body":"<p>Usually we use ReadWriteLocks with read locks while reading, and write locks while writing. But a fancy case in which I thought using in reverse can help. But hopefully you guys can tell me a better way.</p>\n\n<p>Here is what I want. There will be lot of writes, but sparingly low amount of read. Example is an average calculator of latency of requests, say for example. </p>\n\n<p>Treat almost as pseudo code.</p>\n\n<pre><code>metric.addValue(latency); // Called a lot.\n\nmetric.getAverage(); // Called sparingly.\n</code></pre>\n\n<p>We can do the following:</p>\n\n<pre><code>addValue(value) {\n  atomicCount.increment();\n  atomicSum.increment(value);\n}\n\ngetAverage() {\n  return atomicCount.get() != 0 ? atomicSum.get() / atomicCount.get() : 0.0;\n}\n</code></pre>\n\n<p>The problem is in getAverage(), we \"may\" count a few extra counts. But most often probably correct values, and sometimes one extra count. But I just want it more precise.</p>\n\n<p>Here is the trick:</p>\n\n<pre><code>ReadWriteLock rw = /* write preference, or a fair lock. */;\nLock read = rw.readLock();\nLock write = rw.writeLock();\n\naddValue(value) {\n  read.lock(); // Using read lock when mutating. \n  try { \n    atomicCount.increment();\n    atomicSum.increment(value);\n  } finally {\n    read.unlock();\n  }\n}\n\ngetAverage() {\n  write.lock(); // Using write lock when reading.\n  try {\n    return atomicCount.get() != 0 ? atomicSum.get() / atomicCount.get() : 0.0;\n  } finally {\n    write.unlock();\n  }\n}\n</code></pre>\n\n<p>My question is, can I do better?</p>\n\n<p>Salt: I know about (cast) issues, and calling count.get() multiple times etc can be avoided for better performance, but didn't want to clutter the code too much.</p>\n"},{"tags":["vb.net","multithreading","visual-studio-2010","delegates","invoke"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13072621,"title":"vb.net: listbox.items.add() throws exception in same class","body":"<p>I'm not even sure I understand this situation enough to come up with a proper title. I come from a modest understanding of VB6 and having to climb a steep learning curve for VB 2010.</p>\n\n<p>I am trying to create a multi-client server program that will communicate with my Enterprise iPhone app. I found a relatively simple example to build upon here: <a href=\"http://www.strokenine.com/blog/?p=218\" rel=\"nofollow\">http://www.strokenine.com/blog/?p=218</a>. I have been able to modify the code enough to make it work with my app, but with one glitch: I can't get access to the controls on the form to add items, even though the method is invoked within the form's class. (I tried this on the original code too, and it does the same thing. I don't know how the author managed to get it to work.)</p>\n\n<p>Here's the code segment in question:</p>\n\n<pre><code>Public Class Server 'The form with the controls is on/in this class.\nDim clients As New Hashtable 'new database (hashtable) to hold the clients\n\n\n    Sub recieved(ByVal msg As String, ByVal client As ConnectedClient)\n    Dim message() As String = msg.Split(\"|\") 'make an array with elements of the message recieved\n    Select Case message(0) 'process by the first element in the array\n        Case \"CHAT\" 'if it's CHAT\n            TextBox3.Text &amp;= client.name &amp; \" says: \" &amp; \" \" &amp; message(1) &amp; vbNewLine 'add the message to the chatbox\n            sendallbutone(message(1), client.name) 'this will update all clients with the new message\n            '                                       and it will not send the message to the client it recieved it from :)\n        Case \"LOGIN\" 'A client has connected\n            clients.Add(client, client.name) 'add the client to our database (a hashtable)\n            ListBox1.Items.Add(client.name) 'add the client to the listbox to display the new user\n    End Select\n\nEnd Sub\n</code></pre>\n\n<p>Under Case \"LOGIN\" the code tries to add the login ID to the listbox. It throws an exception: \"A first chance exception of type 'System.InvalidOperationException' occurred in System.Windows.Forms.dll\" The listbox (all controls, for that matter) is in the same class, Server.vb and Server.vb [Design]. </p>\n\n<p>The data comes in from another class that is created whenever a client logs on, which raises the event that switches back to the Server class:</p>\n\n<pre><code>Public Class ConnectedClient\n\nPublic Event gotmessage(ByVal message As String, ByVal client As ConnectedClient)    'this is raised when we get a message from the client\nPublic Event disconnected(ByVal client As ConnectedClient)    'this is raised when we get the client disconnects\n\nSub read(ByVal ar As IAsyncResult) 'this will process all messages being recieved\n    Try\n        Dim sr As New StreamReader(cli.GetStream) 'initialize a new streamreader which will read from the client's stream\n        Dim msg As String = sr.ReadLine() 'create a new variable which will be used to hold the message being read\n        RaiseEvent gotmessage(msg, Me) 'tell the server a message has been recieved. Me is passed as an argument which represents \n        '                               the current client which it has recieved the message from to perform any client specific\n        '                               tasks if needed\n        cli.GetStream.BeginRead(New Byte() {0}, 0, 0, AddressOf read, Nothing) 'continue reading from the stream\n    Catch ex As Exception\n        Try 'if an error occurs in the reading purpose, we will try to read again to see if we still can read\n            Dim sr As New StreamReader(cli.GetStream) 'initialize a new streamreader which will read from the client's stream\n            Dim msg As String = sr.ReadLine() 'create a new variable which will be used to hold the message being read\n            RaiseEvent gotmessage(msg, Me) 'tell the server a message has been recieved. Me is passed as an argument which represents \n            '                               the current client which it has recieved the message from to perform any client specific\n            '                               tasks if needed\n            cli.GetStream.BeginRead(New Byte() {0}, 0, 0, AddressOf read, Nothing) 'continue reading from the stream\n        Catch ' IF WE STILL CANNOT READ\n            RaiseEvent disconnected(Me)  'WE CAN ASSUME THE CLIENT HAS DISCONNECTED\n        End Try\n\n    End Try\nEnd Sub\n</code></pre>\n\n<p>I hope I am making sense with all this. It all seems to bounce back and forth, it seems so convoluted.</p>\n\n<p>I've tried using Me.listbox1 and Server.listbox1 and several other similar structures, but to no avail.</p>\n\n<p>I'm reading a lot about Invoke and Delegates, but would that be necessary if the method and the control are in the same class? Or do I have a fundamental misperception of what a class is?</p>\n\n<p>Many thanks for any help I can get.</p>\n"},{"tags":["python","multithreading","web-crawler","crawler","web-mining"],"answer_count":6,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":600,"score":5,"question_id":7653276,"title":"Fast internet crawler","body":"<p>I'd like to do perform data mining on a large scale. For this, I need a fast crawler. All I need is something to download a web page, extract links and follow them recursively, but without visiting the same url twice. Basically, I want to avoid looping.</p>\n\n<p>I already wrote a crawler in python, but it's too slow. I'm not able to saturate a 100Mbit line with it. Top speed is ~40 urls/sec. and for some reason it's hard to get better results. It seems like a problem with python's multithreading/sockets. I also ran into problems with python's gargabe collector, but that was solvable. CPU isn't the bottleneck btw.</p>\n\n<p>So, what should I use to write a crawler that is as fast as possible, and what's the best solution to avoid looping while crawling?</p>\n\n<p>EDIT:\nThe solution was to combine <code>multiprocessing</code> and <code>threading</code> modules. Spawn multiple processes with multiple threads per process for best effect. Spawning multiple threads in a single process is not effective and multiple processes with just one thread consume too much memory.</p>\n"},{"tags":["python","multithreading","gil"],"answer_count":5,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":1327,"score":8,"question_id":2830880,"title":"Does a multithreaded crawler in Python really speed things up?","body":"<p>Was looking to write a little web crawler in python. I was starting to investigate writing it as a multithreaded script, one pool of threads downloading and one pool processing results. Due to the GIL would it actually do simultaneous downloading? How does the GIL affect a web crawler? Would each thread pick some data off the socket, then move on to the next thread, let it pick some data off the socket, etc..? </p>\n\n<p>Basically I'm asking is doing a multi-threaded crawler in python really going to buy me much performance vs single threaded?</p>\n\n<p>thanks!</p>\n"},{"tags":["c#","multithreading","thread-abort"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":95,"score":3,"question_id":13073293,"title":"Why my Thread does not stop?","body":"<p>I have the following code, where I start a <code>Thread</code> using a <code>ParameterizedThreadStart</code> object as constructor argument:</p>\n\n<pre><code>static object obj = new object();\n\nstatic void Main(string[] args)\n{\n    ParameterizedThreadStart start = (o) =&gt;\n    {\n        ThreadTest(o);\n    };\n\n    var t = new Thread(() =&gt; start(obj));\n    t.Name = \"t\";\n    t.Start();\n\n    Thread.Sleep(3000);\n    obj = null;\n\n    // Why the Thread (t) continue here??\n    Console.ReadKey();\n}\n\n\nprivate static void ThreadTest(object o)\n{\n    while (o != null)\n    {\n        Console.WriteLine(Thread.CurrentThread.Name);\n        Thread.Sleep(1000);\n    }\n}\n</code></pre>\n\n<p>After I set <code>obj</code> to <code>null</code> in the <code>ThreadTest</code> method the argument <code>o</code> is still a valid object, why?<br>\nHow can I set the argument <code>o</code> to <code>null</code> using <code>obj</code>?</p>\n\n<p><a href=\"http://msmvps.com/blogs/peterritchie/archive/2007/08/22/thead-abort-is-a-sign-of-a-poorly-designed-program.aspx\" rel=\"nofollow\">I would prefer not to use Thread.Abort</a></p>\n"},{"tags":["python","multithreading","timer","interrupt"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":52,"score":3,"question_id":13071831,"title":"Interrupting a timer","body":"<p>I'm creating part of a program right now for a personal project and I need some help on one aspect of it.</p>\n\n<p>Here is how the program works:</p>\n\n<ol>\n<li>User enters the amount of time to run</li>\n<li>User enters the text - Files are modified </li>\n<li>Timer is started </li>\n<li><em>optional</em> User can enter \"password\" to interrupt the timer </li>\n<li>Actions are reversed</li>\n</ol>\n\n<p>I have all of the steps coded except the Timer because I'm trying to figure out the best way to do this. Ideally, I'd like the timer to be displaying a countdown, and if the user enters a certain \"password\" the timer is interrupted and it skips to step number 5. </p>\n\n<p>Would the best way to do this be with a thread? I haven't worked much with threads in the past. I just need someway for the timer to be displayed while also giving control back to the user in case they want to enter that password.</p>\n\n<p>Thanks for any help you provide.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>import time\nimport urllib\nimport sys\n\ndef restore():\n     backup = open(r'...backupfile.txt','r')\n     text = open(r'...file.txt', 'w+')\n     text.seek(0)\n\n     for line in backup:\n         text.write(line)\n\n     backup.close()\n     text.close()\n\ntext = open(r'...file.txt', 'a+')\nbackup = open(r'...backupfile.txt','w+')\ntext.seek(0)\n\nfor line in text:\n    backup.write(line)\n\nbackup.close()\n\nwhile True:\n    url = raw_input('Please enter a URL: ')\n    try:\n        if url[:7] != 'http://':\n            urllib.urlopen('http://' + url) \n        else:\n            urllib.urlopen(url)\n    except IOError:\n        print \"Not a real URL\"\n        continue \n\n    text.write(url)\n\n    while True:\n        choice = raw_input('Would you like to enter another url? (y/n): ')\n        try:\n            if choice == 'y' or choice == 'n':\n                break\n        except:\n            continue\n\n        if choice == 'y':\n            text.seek(2)\n            continue\n\n        elif choice == 'n':\n            while True:\n                choice = raw_input('Would you to restore your file to the original backup (y/n): ')\n                try:\n                    if choice == 'y' or choice == 'n':\n                        break\n                except:\n                    continue\n\n            if choice == 'y':\n                text.close()\n                restore()\n                sys.exit('Your file has been restored')\n            else:\n                text.close()\n                sys.exit('Your file has been modified')\n</code></pre>\n\n<p>As you can see, I haven't added the timing part yet. It's pretty straight forward, just adding urls to a text file and then closing them. If the user wants the original file, reverse() is called.</p>\n"},{"tags":["java","android","multithreading","garbage-collection","android-asynctask"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13053487,"title":"Variables lose data once Async Task task is executed","body":"<p>I have a an activity with AsyncTask sub-classed.  I lose all my variables once the async task is executed.  I am stepping through my code in debug mode.  As soon as \"MyAsync().execute()\" finishes the \"formatedURL\" variable (and all the others) have no values. before that, they have the correct values. Then, for some odd reason, they lose the values.  Am i making a simple OO mistake or is garbage collection doing something i am not aware of.</p>\n\n<pre><code>public class NearbyList extends Activity {\n\n    double lat;\n    double lng;\n    String restName;\n    GPSHandling gps;\n    String formatedURL;\n    JSONObject jobject;\n    ArrayList&lt;HashMap&lt;String, String&gt;&gt; listOfHM;\n    ArrayList&lt;String&gt; listOfValues;\n    String currentName;\n    ListView lv;\n    Context context;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.nearby_places_list);\n\n        context = getApplicationContext();\n        gps = new GPSHandling(this);\n        lat = gps.getMyLatitude();\n        lng = gps.getMyLongitude();\n        restName =\"\";\n        formatedURL = GooglePlacesStuff.placesURL(lat, lng, 16000, \"food\", restName, true);  //make a proper url. next step is to get a JSON object from this.\n\n\n        new MyAsync().execute();// in order to run networking it must not be done in the UIthread. I use async task to take care of this in order to \n           //reduce the code of doing complex threading since this is a simple calculation\n    }\n        class MyAsync extends AsyncTask&lt;Void, Integer, Boolean&gt;{\n            @Override\n            protected Boolean doInBackground(Void... params) {\n                try {\n                    jobject = GooglePlacesStuff.getTheJSON(formatedURL);\n                    listOfHM = JSONextractor.getJSONHMArrayL(jobject);\n                    // iterate through and get the names of the nearby restaurants from the array of hasmap strings\n                    for(int i =0 ; i &lt; listOfHM.size() ;i++ ){\n                        currentName = listOfHM.get(i).get(JSONextractor.TAG_NAME);\n                        listOfValues.add(currentName);\n                    }\n                    return true;\n                } catch (Exception e){\n                    Log.e(\"Nearby List Activity\", \"exception\", e);\n                    return false;}\n            }\n\n            @Override\n            protected void onPostExecute(Boolean result){\n                super.onPostExecute(result);\n                if (result){\n                    ListAdapter adapter = new SimpleAdapter(context, listOfHM, R.layout.nearby_places_list, new String[]{JSONextractor.TAG_NAME,\n                            JSONextractor.TAG_VICINITY, JSONextractor.TAG_GEO_LOC_LAT}, new int[]{ R.id.name, R.id.vicinity, R.id.phone});\n\n                    // adding data to listview\n                    lv.setAdapter(adapter);\n                } else{\n                    Toast.makeText(getApplicationContext(), \"Need Internet &amp; GPS access for this to work\", Toast.LENGTH_LONG).show();\n                }\n                gps.stopUsingGPS();  // stop using the gps after i get the list to save on resource\n            }\n        }\n}\n</code></pre>\n\n<p>Edit1:\nlooks like it is trying to run \"super.onCreate(Bundle savedInstanceState)\" multiple times in the doinbackground() method</p>\n\n<p>Edit2: if i make the values static they don't get lost.  Its weird, even the variable \"jobject\" which is assigned inside the async task wont take an assignment unless its a static variable....  never seen anything like this</p>\n"},{"tags":["c#","asp.net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13072036,"title":"ASP.NET Multithreading","body":"<p>I have an ASP.NET page which sends an email to a list of of users - this list can be fairly large, and we find the ASP.NET page will often timeout.</p>\n\n<p>What we want to do is send these emails in a new thread, so the ASP.NET page refreshes to the user while the email process is working in the background.</p>\n\n<p>I'm having a bit of a hard time getting my head around what I need to do though. Here's the button click event on my ASP.NET page currently:</p>\n\n<pre><code>    protected void btnSend_Click(object sender, EventArgs e)\n    {    \n        //Populate form data session\n        _FormInfo = new Dictionary&lt;string, string&gt;();\n        _FormInfo.Add(\"Name\", txtName.Text);\n        _FormInfo.Add(\"Postcode\", txtPostcodeDone.Text);\n\n        PostcodeSearcher.PostcodeEmailer(_Companies, _FormInfo);\n        mv.ActiveViewIndex = 3;\n    }\n</code></pre>\n\n<p>And here's the method I want to call (inside the PostcodeSearcher class)</p>\n\n<pre><code> public static void PostcodeEmailer(List&lt;Company&gt; companies, Dictionary&lt;string, string&gt; quote)\n        {\n            ...\n        }\n</code></pre>\n\n<p>As you can see the method I need to call in a new thread needs to accept parameters - all I can find online is for calling a new thread without parameters. Any ideas?</p>\n"}]}
{"total":30059,"page":8,"pagesize":100,"questions":[{"tags":["android","multithreading","android-asynctask","android-handler"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":11812657,"title":"What is the difference between Handler (MessageQueue) and AsyncTask (SERIAL_EXECUTOR), performance wise?","body":"<p>There are a couple ways of getting data Asynchronously in your app. One is a <code>Handler</code> and another one is an <code>AsyncTask</code>. Now I've used both, and would like to know which one performs better/more efficiently at some tasks.</p>\n\n<p>Thusfar, I've mostly used <code>AsyncTasks</code> in getting Webdata, and <code>Handler</code>'s in getting data from <code>Services</code> to <code>Activities</code>.</p>\n\n<p>I would like to know if there is an advantage to using <code>Handler</code>'s for Webdata, or using AsyncTasks for refreshing UI from <code>Services</code>. What is the big difference?</p>\n"},{"tags":["c#","sql-server","multithreading","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":13030082,"title":"Parallel reading from SQL Server","body":"<p>I was looking through dozens of articles, but couldn't find a solution.</p>\n\n<p>Here is the logic :</p>\n\n<p>I have a Winform (VS2010) application, that needs to read data from SQL Server 2008 R2 Express table <code>A</code>, process some calculations and store in a different table <code>B</code>.</p>\n\n<p>I want to use parallel <code>ForEach</code> in order to shorten execution time (otherwise the calculation + SQL process takes days.....)</p>\n\n<p>I have to read from SQL, because the database has over 5 million rows, each read returns a few hundreds rows.</p>\n\n<p>Lists are defined as :</p>\n\n<pre><code>BindingList&lt;ItemsClass&gt; etqM = new BindingList&lt;ItemsClass&gt;();\nBindingList&lt;ItemsClass&gt; etqC = new BindingList&lt;ItemsClass&gt;();\n</code></pre>\n\n<p>The parallel execution :</p>\n\n<pre><code>Parallel.ForEach(etqC, cv =&gt; {\n            readData(ref etqM, \"tableA\", \"WHERE ID LIKE '\" + cv.Name + \"%'\");\n            IList&lt;ItemsClass&gt; eResults = etqM.OrderBy(f =&gt; f.ID).ToList();\n\n            foreach (ItemsClass R in eResults)\n            {\n                //calculations comes here\n\n                etqM[rID] = R;\n            }\n\n            Parallel.ForEach(etqM, r =&gt; {\n                // part 2 of calculations comes here\n                }\n            });\n            exportList(etqM, \"tableB\", true);\n        });\n</code></pre>\n\n<p>The SQL Read function :\nThe function gets a List, Table name + conditions for the SQL\nread from SQL the records, and transform them to the List format.</p>\n\n<pre><code>public void readData&lt;T&gt;(ref BindingList&lt;T&gt; etqList, string tableName, string conditions)\n    {\n        SqlConnection myConnection = new SqlConnection();\n        SqlCommand myCommand = new SqlCommand();\n        myCommand.CommandTimeout = 0;\n        myCommand.Connection = myConnection;\n\n        etqList.Clear();            \n        openConn(myConnection);\n        SqlDataReader myReader = null;\n\n        try\n        {\n            int totalResults;\n            myCommand.CommandText = \"SELECT COUNT (*) FROM \" + tableName + \" \" + conditions;\n            totalResults = (int)myCommand.ExecuteScalar();\n\n            if (totalResults &gt; 0)\n            {\n                myCommand.CommandText = \"SELECT * FROM \" + tableName + \" \" + conditions;\n                myReader = myCommand.ExecuteReader();\n                etqList = ConvertTo&lt;T&gt;(convertReaderToDT(myReader));\n            }\n        }\n        catch (Exception ex) { }\n        finally\n        {\n            try { myReader.Close(); }\n            catch { }\n        }\n        closeConn(myConnection);\n    }\n</code></pre>\n\n<p>The SQL export function : this function exports the given list to the table name.</p>\n\n<pre><code>private void exportListToSql&lt;T&gt;(IEnumerable&lt;T&gt; etqList, string tableName)\n{\n        SqlConnection myConnection = new SqlConnection();\n        SqlCommand myCommand = new SqlCommand();\n        myCommand.CommandTimeout = 0;\n        myCommand.Connection = myConnection;\n        openConn(myConnection);\n\n        try\n        {\n            actionTotalCount++;\n            DataTable dt = new DataTable(tableName);\n            dt = ToDataTable(etqList);//List Name\n            var bulkCopy = new SqlBulkCopy(myConnection,\n                SqlBulkCopyOptions.TableLock |\n                SqlBulkCopyOptions.FireTriggers |\n                SqlBulkCopyOptions.UseInternalTransaction,\n                null\n                );\n            bulkCopy.DestinationTableName = tableName;\n            bulkCopy.BatchSize = BATCH_SIZE;\n            bulkCopy.WriteToServer(dt);\n        }\n        catch (Exception ex) {  }\n        finally { closeConn(myConnection); }\n    }\n</code></pre>\n\n<p>SQL <code>openConn</code> and <code>closeConn</code> :</p>\n\n<pre><code>void openConn(SqlConnection myConnection)\n{\n        if (myConnection.State == ConnectionState.Open) return;\n        myConnection.ConnectionString = \"Data Source=\" + DB_NAME + \";Initial Catalog=APPDB;Integrated Security=True;Connect Timeout=120;Asynchronous Processing=true;\";\n\n        try { myConnection.Open(); actionTotalCount++; }\n        catch (System.Exception ex) { MessageBox.Show(ex.Message); }\n}\n\nvoid closeConn(SqlConnection myConnection)\n{\n        if (myConnection.State == ConnectionState.Fetching || myConnection.State == ConnectionState.Executing || myConnection.State == ConnectionState.Connecting) return;\n        try { myConnection.Dispose(); }\n        catch (System.Exception ex) { MessageBox.Show(ex.Message); }\n}\n</code></pre>\n\n<p>The problem is : once I execute, I get this message :</p>\n\n<blockquote>\n  <p><em>ExecuteScalar requires an open and available connection. The connection's current state is closed.</em></p>\n</blockquote>\n\n<p>This message arrives for all threads, except the first one.</p>\n\n<p>Any ideas ?</p>\n"},{"tags":["c#","multithreading","asynchronous","await"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":13071019,"title":"async long blocking method running in the UI thread after awaiting","body":"<p>Its something around:</p>\n\n<pre><code>async Task foo(...)\n{\n   await Task.Yield();\n   [long blocking I/O statements]\n}\n</code></pre>\n\n<p>But the problem is that it still runs in the UI thread after the await. I made sure by getting the Thread.CurrentThread.ManagedThreadId for both the UI thread and the thread after await, and the UI thread is becoming not responsive.</p>\n\n<p>So what should I do ? Should I use threads in the traditional way instead of relying  on async/await ? or is there a way to make it run in a new non-UI thread after the await ?</p>\n"},{"tags":["performance","multithreading","jvm","multicore"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":4254,"score":2,"question_id":1649402,"title":"Would a multithreaded Java application exploit a multi-core machine very well?","body":"<p>If I write a multi-threaded java application, will the JVM take care of utilizing all available cores? Do I have to do some work?</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":13070724,"title":"Swingworker problems in java 1.7","body":"<p>I have two Java programs (client and server) which worked perfect for years until I upgraded to java 1.7.</p>\n\n<p>Now I have the following killer problem with SwingWorker: the <code>done()</code> function is called very late (30-90 seconds) after returning from <code>doInBackground()</code>. I put a println just before the return from <code>doInBackground()</code> and it is shown all the time. The println at the beginning of <code>done()</code> is called very late.</p>\n\n<p>This never happens if I run the programs from Netbeans IDE, only when I run them from command line or by clicking the .jar file (I'm in Windows XP - but happens on other OS's too). Also, never happens with Java 1.6 or earlier.</p>\n\n<p>I am using SwingWorker.jar version 1.2.</p>\n"},{"tags":["c#","multithreading","performance"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":13070339,"title":"Parallel.For vs regular threads","body":"<p>I'm trying to understand why Parallel.For is able to outperform a number of threads in the following scenario: consider a batch of jobs that can be processed in parallel. While processing these jobs, new work may be added, which then needs to be processed as well. The <code>Parallel.For</code> solution would look as follows:</p>\n\n<pre><code>var jobs = new List&lt;Job&gt; { firstJob };\nint startIdx = 0, endIdx = jobs.Count;\nwhile (startIdx &lt; endIdx) {\n  Parallel.For(startIdx, endIdx, i =&gt; WorkJob(jobs[i]));\n  startIdx = endIdx; endIdx = jobs.Count;\n}\n</code></pre>\n\n<p>This means that there are multiple times where the Parallel.For needs to synchronize. Consider a bread-first graph algorithm algorithm; the number of synchronizations would be quite large. Waste of time, no?</p>\n\n<p>Trying the same in the old-fashioned threading approach:</p>\n\n<pre><code>var queue = new ConcurrentQueue&lt;Job&gt; { firstJob };\nvar threads = new List&lt;Thread&gt;();\nvar waitHandle = new AutoResetEvent(false);\nint numBusy = 0;\nfor (int i = 0; i &lt; maxThreads; i++) \n  threads.Add(new Thread(new ThreadStart(delegate {\n    while (!queue.IsEmpty || numBusy &gt; 0) {\n      if (queue.IsEmpty)\n        // numbusy &gt; 0 implies more data may arrive\n        waitHandle.WaitOne();\n\n      Job job;\n      if (queue.TryDequeue(out job)) {\n        Interlocked.Increment(ref numBusy);\n        WorkJob(job); // WorkJob does a waitHandle.Set() when more work was found\n        Interlocked.Decrement(ref numBusy);\n      }\n    }\n    // others are possibly waiting for us to enable more work which won't happen\n    waitHandle.Set(); \n})));\nthreads.ForEach(t =&gt; t.Start());\nthreads.ForEach(t =&gt; t.Join());\n</code></pre>\n\n<p>The <code>Parallel.For</code> code is of course much cleaner, but what I cannot comprehend, it's even faster as well! Is the task scheduler just that good? The synchronizations were eleminated, there's no busy waiting, yet the threaded approach is consistently slower (for me). What's going on? Can the threading approach be made faster?</p>\n\n<p>Edit: thanks for all the answers, I wish I could pick multiple ones. I chose to go with the one that also shows an actual possible improvement.</p>\n"},{"tags":["c#","multithreading","parallel-processing","task-parallel-library"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":135,"score":2,"question_id":13058486,"title":"Parallel tasks with a long pause","body":"<p>I have a function which is along the lines of</p>\n\n<pre><code>   private void DoSomethingToFeed(IFeed feed)\n   {\n      feed.SendData(); // Send data to remote server\n      Thread.Sleep(1000 * 60 * 5); // Sleep 5 minutes\n      feed.GetResults(); // Get data from remote server after it's processed it\n   }\n</code></pre>\n\n<p>I want to parallelize this, since I have lots of feeds that are all independent of each other.  Based on <a href=\"http://stackoverflow.com/a/6195821/298754\">this answer</a>, leaving the <code>Thread.Sleep()</code> in there is not a good idea.  I also want to wait after all the threads have spun up, until they've all had a chance to get their results.</p>\n\n<p>What's the best way to handle a scenario like this?</p>\n\n<p><strong>Edit, because I accidentally left it out:</strong> I had originally considered calling this function as <code>Parallel.ForEach(feeds, DoSomethingToFeed)</code>, but I was wondering if there was a better way to handle the sleeping when I found the answer I linked to.</p>\n"},{"tags":["c","multithreading","posix","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13069680,"title":"How to restart a posix thread from another thread (monitor thread in my case)","body":"<p>I am trying to handle a deadlock situation and need to restart a deadlocked thread from the monitor thread by resource pre-emption and rollback strategy for posix threads..Im clueless about how to restart a thread from another thread ,Kindly help! </p>\n"},{"tags":["java","multithreading","concurrency","wait","notify"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13057240,"title":"wait(long timeout) in a while loop?","body":"<p>I've read that you're supposed to put Object.wait() calls in Java in a while loop. The reason is that this thread may be woken up and the condition that you were waiting to notify on is still false.</p>\n\n<p>What about wait(long timeout). Here, you don't want to loop on the condition since you want it to time out after the specified amount of time. But if you don't put it in a loop then how can you ensure that it won't be woken up early?</p>\n"},{"tags":["android","multithreading","android-layout","reset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13061105,"title":"android thread reset","body":"<p>my code is:</p>\n\n<pre><code>public class EventDialog2 extends Dialog implements OnTouchListener{\n\n    TextView textv;\n    Context con;\n    Thread t;\n    int flag=0;\n    public EventDialog2(Context context, int dialogslideanim) {\n        super(context, dialogslideanim);\n        con = context;\n\n        requestWindowFeature(Window.FEATURE_NO_TITLE);\n        setContentView(R.layout.dialog2);\n        getWindow().setGravity(Gravity.BOTTOM);\n        timing();\n        LinearLayout line = (LinearLayout) findViewById(R.id.linear2);\n        line.setOnTouchListener(this);\n        line.removeAllViews();\n        for (int i = 0; i &lt; 15; i++) {\n            TextView tv = new TextView(con);\n            tv.setText(\"TestProcess \" + i);\n            tv.setTextColor(Color.BLACK);\n            line.addView(tv);\n\n        }\n\n    }\n\n\n    private void timing() {\n        // TODO Auto-generated method stub\n        if(flag==1){\n        t.stop();\n\n            flag=0;\n        }\n\n        t = new Thread(new Runnable() {\n\n            public void run() {\n                try {\n\n                    t.sleep(3000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n\n                }\n\n\n                dismiss();\n\n            }\n        });\n        t.start();\n    }\n\n\n    public boolean onTouch(View v, MotionEvent event) {\n        System.out.println(\"touched\");\n        flag=1;\n        timing();\n        return false;\n    }\n}\n</code></pre>\n\n<p>Here thread is working perfectly as it will sleep after 3 seconds. But i need that the thread should get <strong>reset</strong> when we touched in the dialog and should sleep after 3 seconds from the touch. Please help me.\nThanks</p>\n"},{"tags":["java","android","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":13067764,"title":"Synchronised Keyword","body":"<p>I am developing an app which downloads images and saves them to the sdcard. The class which interacts with the sdcard looks like this...</p>\n\n<pre><code>public class SDCardImageManagerImp implements SDCardImageManager {\n\n    private Context context;\n\n    @Inject\n    public SDCardImageManagerImp(Context context) {\n        this.context = context;\n    }\n\n    @Override\n    public void saveToSDCard(String id, Bitmap bitmap) throws FileNotFoundException {\n        FileOutputStream outputStream = context.openFileOutput(id, Context.MODE_PRIVATE);\n        bitmap.compress(Bitmap.CompressFormat.JPEG, 100, outputStream);\n    }\n\n    @Override\n    public Bitmap getImage(String id) throws FileNotFoundException {\n        return BitmapFactory.decodeStream(context.openFileInput(id));\n    }\n\n    @Override\n    public void deleteImage(String id) {\n        context.deleteFile(id);\n    }\n\n}\n</code></pre>\n\n<p>This class is a singleton as I read writing to a disk with multiple threads can hinder performance. However I do have multiple threads downloading the data and sending it to this class. So my questions is should all of the methods in this class have the syncronized key work on them?</p>\n"},{"tags":["java","regex","multithreading"],"answer_count":5,"favorite_count":4,"up_vote_count":15,"down_vote_count":0,"view_count":4477,"score":15,"question_id":1360113,"title":"Is Java Regex Thread Safe?","body":"<p>I have a function that uses Pattern.compile and a Matcher to search a list of strings for a pattern.  This function is used in multiple threads.  Each thread will have a unique pattern passed to the Pattern.compile when the thread is created.  The number of threads and patterns are dynamic, meaning that I can add more patterns and threads during configuration.</p>\n\n<p>Do I need to put a \"synchronize\" on this function if it uses regex?  Is regex in java thread safe?</p>\n\n<p>TIA</p>\n"},{"tags":["python","multithreading","gui","pygtk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13067004,"title":"Threading not working with pygtk and always hangs","body":"<p>Here is a small implementation of my problem. when i click \"Press\" button it hangs and some time it is not. How can overcome this hang ? \nhere  is my code.</p>\n\n<p>To install Sane \"sudo apt-get install python-imaging-sane\"</p>\n\n<pre><code>import gtk\nimport gtk.glade\nimport threading\nimport os\nimport sane\ngtk.gdk.threads_init()\nclass process(threading.Thread):\n    def __init__(self,main_object):\n        self.main_object = main_object\n        threading.Thread.__init__(self)\n\n    def run(self):\n        sane_version = sane.init()\n        sane_devices = sane.get_devices()\n        gtk.threads_enter()\n        self.main_object.pb.set_fraction(self.main_object.value)\n        gtk.threads_leave()\n        self.main_object.value = self.main_object.value + .1\n\n\nclass main():\n    def __init__(self):\n        #GUI\n        window = gtk.Window()\n        window.set_default_size(200,200)\n        vbox = gtk.VBox(False,0)\n\n        self.pb = gtk.ProgressBar()\n        button = gtk.Button(\"Press me \")\n        button.connect(\"clicked\",self.fun_to_call)\n        vbox.pack_end(self.pb)\n        vbox.pack_end(button)\n        button.show()\n        self.pb.show()\n        vbox.show()\n        window.add(vbox)\n\n        self.value = .1\n        window.show()\n\n    def fun_to_call(self,data=None):\n        pro = process(self)\n        pro.start()\n\n\nmain()\ngtk.main()\n</code></pre>\n"},{"tags":["wpf","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13045577,"title":"WPF Dispatcher.BeginInvoke Throw Exception","body":"<p>I am using Threadpool.QueueUserWorkItem like following</p>\n\n<pre><code>public void TestMain()\n    {\n        try\n        {\n            ThreadPool.QueueUserWorkItem(x =&gt;\n                {\n                    this.Dispatcher.BeginInvoke(new Action(() =&gt; this.BackGroundMethod()));\n                }\n            );\n        }\n        catch (Exception ex)\n        {\n            MessageBox.Show(ex.Message);\n        }\n\n    }\n\n    private void BackGroundMethod()\n    {\n        try\n        {\n            int a = 0;\n            int b = 100;\n            var error = b / a;\n        }\n        catch(Exception)\n        {\n            throw;\n        }\n    }\n</code></pre>\n\n<p>By this way, TestMain() can not catch exception.\nProgram will shut down...</p>\n\n<p>How can i catch this error?</p>\n\n<p>Thx.</p>\n"},{"tags":["multithreading","web-services","restlet"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12915300,"title":"Restlet Client Handle Web Service being down","body":"<p>I am new to Restlet and I have a client where  it calls a web service and the web service is used to get a list of file names and data from the files. If the web service goes down while the client is running and I start the web service up again, the client does not continue to work anymore. Can someone explain to me why the client does not call the web service anymore?</p>\n\n<p>The client only works again when I kill the process and restart it again.</p>\n"},{"tags":["linux","multithreading","process","scheduling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13066156,"title":"Linux process and threads scheduling","body":"<p>I'm playing around with linux scheduling with sched.h and bump into some questions.</p>\n\n<p>From what I know, Linux scheduler do not treat threads and processes differently when scheduling. Threads are just like process which shares common resources. </p>\n\n<p>Ok, Say I have Process-A and it is set to CPU core 0 and SCHED_FIFO property is set; which will runs until another higher priority tasks kicks in. If Process-A creates a new thread, will the thread inherit the same property? (i.e. be bind to CPU 0 with SCHED_FIFO properties or will it be DEFAULT?)</p>\n\n<p>Thanks!</p>\n"},{"tags":["c++","windows","multithreading","winapi","token"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":5141997,"title":"Is there a way to set a token for another process?","body":"<p>There is SetThreadToken() function but no such function as \"SetProcessToken()\".</p>\n\n<p>Is there a way to set a token for another process? How to write \"SetProcessToken()\"?</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13057202,"title":"Make a Scheduled Call to run One More time","body":"<p>We have a scheduled task that runs every 10 seconds and a thread pool with 3 threads that actually update a static common map. Every 10 seconds the scheduled action prints this map.\nThe problem is that I want the scheduler to stop printing after the 3 threads finish with the map. But here is the key. I don't want to stop scheduler instantly, I want to print first ( the final version of the map) and then finishes.</p>\n\n<pre><code>public class myClass implements ThreadListener {\n    public static ArrayList&lt;Pair&lt;String, Integer&gt;&gt; wordOccurenceSet = new ArrayList&lt;Pair&lt;String, Integer&gt;&gt;();\n    int numberOfThreads = 0;\n    ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);\n    public void getAnswer(Collection&lt;CharacterReader&gt; characterReaders, Outputter outputter) {\n\n\n\n\n        ExecutorService executor = Executors.newFixedThreadPool(characterReaders.size());\n         OutputterWriteBatch scheduledThread = new OutputterWriteBatch(outputter,wordOccurenceSet);\n\n        scheduler.scheduleAtFixedRate(scheduledThread, 10, 10, TimeUnit.SECONDS);\n        for (CharacterReader characterReader : characterReaders) {\n            NotifyingRunnable runnable = new CharacterReaderTask(characterReader, wordOccurenceSet);\n            runnable.addListener(this);\n\n            executor.execute(runnable);\n        }\n\n\n\n    }\n\n\n    @Override\n    public void notifyRunnableComplete(Runnable runnable) {\n        numberOfThreads += 1;\n        if(numberOfThreads == 3 ){\n         //All threads finished...  What can I do to terminate after one more run?\n        }\n    }\n}\n</code></pre>\n\n<p>The Listener actually just get notified when a thread finishes.</p>\n"},{"tags":["objective-c","multithreading","uitableview","core-data","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13064952,"title":"Data not loading into core data database","body":"<p>I'm trying to put some data in the database. I'm using the following code also in other views. There does it work. But on this view it doesn't work. You can see the code below.</p>\n\n<pre><code>- (void)fetchKlassementIntoDocument:(UIManagedDocument *)document\n{\n        NSLog(@\"log\");\n    dispatch_queue_t fetchKlassement = dispatch_queue_create(\"klassement fetcher\", NULL);\n    dispatch_async(fetchKlassement, ^{\n        NSLog(@\"Log2\");\n        NSLog(@\"log3\");\n        NSArray *klassement  = [GenkData getRanking];\n        [document.managedObjectContext performBlock:^{\n       NSLog(@\"klassement array %@\",klassement);\n            for (NSDictionary *genkInfo in klassement ) {\n            [Klassement klassementWithGenkInfo:genkInfo inManagedObjectContext:document.managedObjectContext];\n                NSLog(@\"inserted klassement\");\n            }\n            NSLog(@\"Log4\");\n            [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:NULL];\n            NSLog(@\"Log5\");\n       NSLog(@\"Log 6\");\n         }];\n    });\n    NSLog(@\"Log7\");\n    dispatch_release(fetchKlassement);\n    NSLog(@\"Log8\");\n}\n</code></pre>\n\n<p>This gives the following error log.</p>\n\n<pre><code>2012-10-25 10:50:07.527 RacingGenk[17989:907] log\n2012-10-25 10:50:07.528 RacingGenk[17989:907] Log7\n2012-10-25 10:50:07.529 RacingGenk[17989:907] Log8\n2012-10-25 10:50:07.531 RacingGenk[17989:4f03] Log2\n2012-10-25 10:50:07.532 RacingGenk[17989:4f03] log3\n2012-10-25 10:50:07.604 RacingGenk[17989:907] *** Terminating app due to uncaught exception 'NSRangeException', reason: '*** -[__NSArrayI objectAtIndex:]: index 0 beyond bounds for empty array'\n</code></pre>\n\n<p>After fetching the data I fill up a tableview with this data. I think that's why the error came up. But can somebody say me what is going wrong ?</p>\n\n<p>Kind regards.</p>\n"},{"tags":["android","multithreading","view","ui-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":85,"score":4,"question_id":13063408,"title":"No error \"Only the original thread that created a view hierarchy can touch its views\" when the view is updated without delay","body":"<p>I was faced with an interesting problem. If you write the following code in the <code>onCreate/onStart/onResume</code> method of activity:</p>\n\n<pre><code>final Button myButton = (Button)findViewById(R.id.myButton);\nfinal TextView myTextView = (TextView)findViewById(R.id.myTextView);\nfinal Thread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        myTextView.setText(\"Hello text\");\n    }\n});\nmyButton.setOnClickListener(new OnClickListener() {\n    @Override\n        public void onClick(View v) {\n        thread.start();\n    }\n});\n</code></pre>\n\n<p>or: </p>\n\n<pre><code>final TextView myTextView = (TextView)findViewById(R.id.myTextView);\nfinal Thread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        try {\n            Thread.currentThread().sleep(500);\n        }\n        catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        myTextView.setText(\"Hello text\");\n    }\n});\nthread.start();\n</code></pre>\n\n<p>how it should be, an error is thrown </p>\n\n<pre><code>android.view.ViewRoot $ CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.\"\n</code></pre>\n\n<p><strong>It is clear that in this case I must update the view in ui-thread</strong> <code>(Handler, AsyncTask, runOnUiThread, view.post).</code></p>\n\n<p>But if you update the view in another thread without delay (without sleep calling or without starting the thread by pressing a button), <strong>exception will not be thrown</strong>.</p>\n\n<pre><code>final TextView myTextView = (TextView)findViewById(R.id.myTextView);\nfinal Thread thread = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        myTextView.setText(\"Hello text\");\n    }\n});\nthread.start();\n</code></pre>\n\n<p>Can anybody tell me why there is such a behavior?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I have learned the source code of Android and came to the following conclusions.\n   Nandeesh wrote the truth. \nWhen initializing the view called dispatchAttachedToWindow (AttachInfo info, int visibility) method of View, which initializes the mAttachInfo field. mAttachInfo object has mViewRootImpl field. If it is null, getViewRootImpl will returned as null:</p>\n\n<pre><code>public ViewRootImpl getViewRootImpl() {\n        if (mAttachInfo != null) {\n            return mAttachInfo.mViewRootImpl;\n        }\n        return null;\n    }\n</code></pre>\n\n<p>ViewRootImpl contains checkThread method. It compares threads: the thread that created the view and thread of the request for the view update. </p>\n\n<pre><code> void checkThread() {\n        if (mThread != Thread.currentThread()) {\n            throw new CalledFromWrongThreadException(\n                    \"Only the original thread that created a view hierarchy can touch its views.\");\n        }\n    }\n</code></pre>\n\n<p>Thus, if the view was not initialized, there is no check and change do not throws exceptions.</p>\n"},{"tags":["multithreading","java-ee","asynchronous","glassfish","log4j"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":164,"score":2,"question_id":8787685,"title":"Asynchronous Logging in Java EE using AsynchAppender","body":"<p>We would like to use <code>Log4J's \"AsynchAppender\"</code> within our Java EE application. The application is deployed on a <code>Glassfish V2 app-server</code>.</p>\n\n<p>Log4J's \"AsynchAppender\" is based on a thread implementation. Threads in turn should be avoided within Java EE applications. Are there any experiences using the \"AsynchAppender\"? What are best practices doing asynchronous logging using Log4J in Java EE applications?</p>\n"},{"tags":["ruby","multithreading","ruby-1.9"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":83,"score":4,"question_id":13064113,"title":"Loops in multiple threads","body":"<p>I have the following code (<a href=\"http://www.tutorialspoint.com/ruby/ruby_multithreading.htm\" rel=\"nofollow\">from a Ruby tutorial</a>):</p>\n\n<pre><code>require 'thread'\n\ncount1 = count2 = 0\ndifference = 0\ncounter = Thread.new do\n   loop do\n      count1 += 1\n      count2 += 1\n   end\nend\nspy = Thread.new do\n   loop do\n      difference += (count1 - count2).abs\n   end\nend\nsleep 1\n\nputs \"count1 :  #{count1}\"\nputs \"count2 :  #{count2}\"\nputs \"difference : #{difference}\"\ncounter.join(2)\nspy.join(2)\nputs \"count1 :  #{count1}\"\nputs \"count2 :  #{count2}\"\nputs \"difference : #{difference}\"\n</code></pre>\n\n<p>It's an example for using <code>Mutex.synchronize</code>. On my computer, the results are quite different from the tutorial. After calling <code>join</code>, the counts are sometimes equal:</p>\n\n<pre><code>count1 :  5321211\ncount2 :  6812638\ndifference : 0\ncount1 :  27307724\ncount2 :  27307724\ndifference : 0\n</code></pre>\n\n<p>and sometimes not:</p>\n\n<pre><code>count1 :  4456390\ncount2 :  5981589\ndifference : 0\ncount1 :  25887977\ncount2 :  28204117\ndifference : 0\n</code></pre>\n\n<p>I don't understand how it is possible that the difference is still <code>0</code> even though the counts show very different numbers.</p>\n\n<p>The <code>add</code> operation probably looks like this:</p>\n\n<pre><code>val = fetch_current(count1)\nadd 1 to val\nstore val back into count1\n</code></pre>\n\n<p>and something similar for <code>count2</code>. Ruby can switch execution between threads, so it might not finish writing to a variable, but when the CPU gets back to the thread, it should continue from the line where it was interrupted, right?</p>\n\n<p>And there is still just one thread that is writing into the variable. How is it possible that, inside the <code>loop do</code> block, <code>count2 += 1</code> is executed much more times? </p>\n"},{"tags":["java","android","multithreading","android-ndk","jni"],"answer_count":2,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":201,"score":9,"question_id":8575413,"title":"What are the consequences if we try to attach a Native Thread permanently to the DVM (JVM)?","body":"<p>Is it feasible to attach a native thread permanently to the JVM (AttachCurrentThread) (or) is it better to attach when ever required (calling java functions) and detach immediately once the work is done</p>\n\n<p>I wrote a sample native app with the above cases, didn't find any difference. But by googling, vaguely I came to know that, when attached to JVM , JVMs thread scheduling is responsible for scheduling else OS will schedule the native thread (if not attached). Is this true?</p>\n\n<p>It is important to detach any thread that has been previously attached; otherwise, the program will not exit when you call DestroyJavaVM. - <a href=\"http://java.sun.com/developer/onlineTraining/Programming/JDCBook/jniref.html#attach\">http://java.sun.com/developer/onlineTraining/Programming/JDCBook/jniref.html#attach</a></p>\n\n<p>Will there by any performance issues?<br>\nPlease let me know if anyone knows, its one my important design aspect.</p>\n\n<p>Thanks &amp; Regards.</p>\n"},{"tags":["c++","multithreading","winapi","createfile","readdirectorychangesw"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13063710,"title":"CreateFile ,ReadDirectoryChanges issue","body":"<p>I’m using <code>ReadDirectoryChangesW</code> to spy a folder that I opened with <code>CreateFile</code>, once a file was added I call a function (<code>OnFileChanged</code>) that read the size and open it for reading, my application works fine for small sized file but the problem occurs when I try to copy a big file into my folder(7,24 M), and I get <code>Permission denied</code> error after calling fopen to read it. </p>\n\n<p>the watching process is based on <a href=\"http://sumatrapdf.googlecode.com/svn/trunk/src/FileWatch.h\" rel=\"nofollow\">this</a></p>\n\n<pre><code>    void Init(const QString FullPath)\n    {    ...\n         hDir = CreateFile(\n                dirPath, // pointer to the directory containing the tex files\n                FILE_LIST_DIRECTORY|GENERIC_READ,                // access (read-write) mode\n                FILE_SHARE_READ|FILE_SHARE_DELETE|FILE_SHARE_WRITE,  // share mode\n                NULL, // security descriptor\n                OPEN_EXISTING, // how to create\n                FILE_FLAG_BACKUP_SEMANTICS  | FILE_FLAG_OVERLAPPED , // file attributes\n                NULL); // file with attributes to copy\n\n\n            SecureZeroMemory (&amp;overl, sizeof(overl));\n            SecureZeroMemory(buffer, sizeof(buffer));\n            overl.hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);\n\n            // watch the directory\n           BOOL res= ReadDirectoryChangesW(\n                 hDir, /* handle to directory */\n                 &amp;buffer[curBuffer], /* read results buffer */\n                 sizeof(buffer[curBuffer]), /* length of buffer */\n                 FALSE, /* monitoring option */\n                 FILE_NOTIFY_CHANGE_FILE_NAME ,\n                 //FILE_NOTIFY_CHANGE_LAST_WRITE, /* filter conditions */\n                 NULL, /* bytes returned */\n                 &amp;overl, /* overlapped buffer */\n                 NULL); /* completion routine */\n\n    }\n\nvoid StartWatchThread()\n{\n    // if the thread already exists then stop it\n    if (IsThreadRunning())\n        SynchronousAbort();\n\n    //CrashIf(!hDir);\n    if(!hDir)\n       { qDebug()&lt;&lt;\" handle \"&lt;&lt;hDir&lt;&lt;\" last error\"&lt;&lt;GetLastError();\n        exit(-1);}\n\n    else\n    {// reset the hEvtStopWatching event so that it can be set if\n    // some thread requires the watching thread to stop\n    ResetEvent(hEvtStopWatching);\n\n    DWORD watchingthreadID;\n    qDebug()&lt;&lt;\"befrore creating thread\";\n    hWatchingThread = CreateThread(NULL, 0, WatchingThread, this, 0, &amp;watchingthreadID);\n    qDebug()&lt;&lt;\"watchingthreadID\"&lt;&lt;watchingthreadID;\n    }\n}\n\n\nDWORD WINAPI WatchingThread(void *param)\n{\n    //qDebug()&lt;&lt;\"in WatchingThread\";\n    FileWatcher *fw = (FileWatcher *)param;\n\n    HANDLE hp[2] = { fw-&gt;hEvtStopWatching, fw-&gt;overl.hEvent };\n    for (;;)\n    {\n\n        DWORD dwObj = WaitForMultipleObjects((sizeof(hp)/(sizeof(hp[0])))\n                                             , hp, FALSE, INFINITE);\n        if (dwObj == WAIT_OBJECT_0) // the user asked to quit the program\n        {\n            qDebug()&lt;&lt;\"in WatchingThread the user asked to quit the program\";\n            //exit(-1);\n            break;\n        }\n        if (dwObj != WAIT_OBJECT_0 + 1)\n        {\n            // BUG!\n            //assert(0);\n            qDebug()&lt;&lt;\"dwObj \"&lt;&lt;dwObj&lt;&lt;\" last error \"&lt;&lt;GetLastError();\n            break;\n        }\n        //qDebug()&lt;&lt;\"WatchingThread fw-&gt;NotifyChange() \";\n\n        //if (fw-&gt;wakeup)\n            fw-&gt;NotifyChange();\n\n    }\n    return 0;\n} \n\n\nbool NotifyChange()\n{\n    //qDebug()&lt;&lt;\"in NotifyChange\";\n\n    GetOverlappedResult(hDir, &amp;overl, &amp;dwNumberbytes, FALSE);\n\n    FILE_NOTIFY_INFORMATION *pFileNotify = (FILE_NOTIFY_INFORMATION *)buffer[curBuffer];\n    // Switch the 2 buffers\n    curBuffer = (curBuffer + 1) % (sizeof(buffer)/(sizeof(buffer[0])));\n    SecureZeroMemory(buffer[curBuffer], sizeof(buffer[curBuffer]));\n    // start a new asynchronous call to ReadDirectory in the alternate buffer\n    ReadDirectoryChangesW(\n         hDir, /* handle to directory */\n         &amp;buffer[curBuffer], /* read results buffer */\n         sizeof(buffer[curBuffer]), /* length of buffer */\n         FALSE, /* monitoring option */\n         FILE_NOTIFY_CHANGE_FILE_NAME  ,\n         //FILE_NOTIFY_CHANGE_LAST_WRITE, /* filter conditions */\n         NULL, /* bytes returned */\n        &amp;overl, /* overlapped buffer */\n         NULL); /* completion routine */\n\n    // Note: the ReadDirectoryChangesW API fills the buffer with WCHAR strings.\n    for (;;) {\n\n        if (pFileNotify-&gt;Action == FILE_ACTION_ADDED)\n        {\n            qDebug()&lt;&lt;\"in NotifyChange if \";\n                char szAction[42];\n                char szFilename[MAX_PATH] ;\n                memset(szFilename,'\\0',sizeof( szFilename));\n                strcpy(szAction,\"added\");\n                wcstombs( szFilename, pFileNotify-&gt;FileName, MAX_PATH);\n\n                OnFileChanged(szFilename,szAction);\n                qDebug()&lt;&lt;\"in NotifyChange after OnFileChanged \";\n\n        }\n\n        // step to the next entry if there is one\n        if (!pFileNotify-&gt;NextEntryOffset)\n            return false;\n        pFileNotify = (FILE_NOTIFY_INFORMATION *)((PBYTE)pFileNotify + pFileNotify-&gt;NextEntryOffset);\n    }\n    pFileNotify=NULL;\n    return true;\n}\n</code></pre>\n\n<p>I couldn't figure out how is handling the file and don't let me read it?\nI tried to call Sleep() after calling <code>OnFileChanged</code> and wake up when it finish but in vain. \nAny idea please .</p>\n"},{"tags":["ios","multithreading","opengl-es","texture"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":13032381,"title":"How to get notified when glTexImage2D finished upload?","body":"<p>I want to render after a texture is uploaded to OpenGL, but I cannot get notified about the completition.</p>\n\n<p>I do want to avoid using animation, or any kind of repetitive rendering.</p>\n\n<p>Is glTexImage2D asynchronous at all? As far as I know, almost every OpenGL call is async.</p>\n\n<hr>\n\n<p>It would be great anyway, if I could be informed about a glDrawArrays completition as well.</p>\n\n<p><strong>EDIT:</strong> Seems that glTexImage2D is a synchronous call, so \"nowhow\" is a suitable answer.</p>\n"},{"tags":["c++","multithreading","threadpool"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":73,"score":5,"question_id":13063322,"title":"c++ threadpool with shared read only memory","body":"<p>I am a newbie in concurrent programming in C++\nI want to code a server( on a linux box ) based on the thread pool pattern where\nthreads need to read ( and only read ) from a shared memory\nto answer incoming requests</p>\n\n<p>I am very confused :(\nI wonder if something needs to be done to synchronize threads \nwhen they access the read only memory and how to do it ( using memory map file maybe ? )</p>\n"},{"tags":["c#","multithreading",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":13026744,"title":"What is a good way to parallelize many HTTP web requests?","body":"<p>I am building a generic URI retrieval system. Essentially there's a generic class <code>Retriever&lt;T&gt;</code> and it maintains a queue of URIs to be retrieved. It has a separate thread that handles that queue as fast as it can. An example of a type of URI, as indicated in the question title, is HTTP type URIs.</p>\n\n<p>The problem is, when I get down to requesting that the resource be retrieved, via an abstract method <code>T RetrieveResource(Uri location)</code>, it slow down due to a lack of asynchrony.</p>\n\n<p>Changing the return type of <code>RetrieveResource</code> to <code>Task&lt;T&gt;</code> was my first thought. However, that seems to make tasks pile up and cause lots of problems when we have thousands of outstanding tasks. It appears to create many actual threads instead of utilizing the thread pool. I imagine this just slows everything down because there are too many things going on at once, so nothing individually is making significant progress.</p>\n\n<p>It's expected that we will have a large number of queued items to retrieve and that they cannot be handled as fast as they are enqueued. There is an opportunity for the system to catch up, over time; but it's definitely not quick.</p>\n\n<p>I've also thought about instead of maintaining a queue and a thread to handle it... to just queue a work item on the <code>ThreadPool</code>. However, I'm not sure that this is ideal if say I need to shut the system down before all work items are handled or later want to allow for prioritization or something.</p>\n\n<p>We also know that retrieving a resource is a time consuming process (0.250 - 5 seconds), but not necessarily a resource intense process. We are fine parallelizing this out to hundreds of requests.</p>\n\n<p>Our requirements are:</p>\n\n<ul>\n<li>URIs can be enqueued from any thread, even when the system is working on the queue</li>\n<li>Retrieval may need to later be capable of being prioritized</li>\n<li>Retrieval should be able to be paused</li>\n<li>Minimal spinning should occur when nothing is being retrieved (<code>BlockingCollection</code> is useful here).</li>\n</ul>\n\n<p>Is there a good way to parallelize this without introducing unnecessary complexity?</p>\n\n<p>Below is some existing code we have, as an example.</p>\n\n<pre><code>public abstract class Retriever&lt;T&gt; : IRetriever&lt;T&gt;, IDisposable\n{\n    private readonly Thread worker;\n    private readonly BlockingCollection&lt;Uri&gt; pending;\n    private volatile int isStarted;\n    private volatile int isDisposing;\n\n    public event EventHandler&lt;RetrievalEventArgs&lt;T&gt;&gt; Retrieved;\n\n    protected Retriever()\n    {\n        this.worker = new Thread(this.RetrieveResources);\n        this.pending = new BlockingCollection&lt;Uri&gt;(new ConcurrentQueue&lt;Uri&gt;());\n        this.isStarted = 0;\n        this.isDisposing = 0;\n    }\n\n    ~Retriever()\n    {\n        this.Dispose(false);\n    }\n\n    private void RetrieveResources()\n    {\n        while (this.isDisposing == 0)\n        {\n            while (this.isStarted == 0)\n            {\n                Monitor.Wait(this.pending);\n            }\n\n            Uri location = this.pending.Take();\n\n            // This is what needs to be concurrently done.\n            // In this example, it's synchronous, but just on a separate thread.\n            T result = this.RetrieveResource(location);\n\n            // At this point, we would fire our event with the retrieved data\n        }\n    }\n\n    protected abstract T RetrieveResource(Uri location);\n\n    protected void Dispose(bool disposing)\n    {\n        if (Interlocked.CompareExchange(ref this.isDisposing, 1, 0) == 1)\n        {\n            return;\n        }\n\n        if (disposing)\n        {\n            this.pending.CompleteAdding();\n            this.worker.Join();\n        }\n    }\n\n    public void Add(Uri uri)\n    {\n        try\n        {\n            this.pending.Add(uri);\n        }\n        catch (InvalidOperationException)\n        {\n            return;\n        }\n    }\n\n    public void AddRange(IEnumerable&lt;Uri&gt; uris)\n    {\n        foreach (Uri uri in uris)\n        {\n            try\n            {\n                this.pending.Add(uri);\n            }\n            catch (InvalidOperationException)\n            {\n                return;\n            }\n        }\n    }\n\n    public void Start()\n    {\n        if (Interlocked.CompareExchange(ref this.isStarted, 1, 0) == 1)\n        {\n            throw new InvalidOperationException(\"The retriever is already started.\");\n        }\n\n        if (this.worker.ThreadState == ThreadState.Unstarted)\n        {\n            this.worker.Start();\n        }\n\n        Monitor.Pulse(this.pending);\n    }\n\n    public void Stop()\n    {\n        if (Interlocked.CompareExchange(ref this.isStarted, 0, 1) == 0)\n        {\n            throw new InvalidOperationException(\"The retriever is already stopped.\");\n        }\n    }\n\n    public void Dispose()\n    {\n        this.Dispose(true);\n        GC.SuppressFinalize(this);\n    }\n}\n</code></pre>\n\n<p>To build on the example above... a solution to this that I think adds too much complexity or rather, weird code... would be this.</p>\n\n<pre><code>    private void RetrieveResources()\n    {\n        while (this.isDisposing == 0)\n        {\n            while (this.isStarted == 0)\n            {\n                Monitor.Wait(this.pending);\n            }\n\n            Uri location = this.pending.Take();\n\n            Task&lt;T&gt; task = new Task&lt;T&gt;((state) =&gt;\n                {\n                    return this.RetrieveResource(state as Uri);\n                }, location);\n\n            task.ContinueWith((t) =&gt;\n                {\n                    T result = t.Result;\n                    RetrievalEventArgs&lt;T&gt; args = new RetrievalEventArgs&lt;T&gt;(location, result);\n\n                    EventHandler&lt;RetrievalEventArgs&lt;T&gt;&gt; callback = this.Retrieved;\n                    if (!Object.ReferenceEquals(callback, null))\n                    {\n                        callback(this, args);\n                    }\n                });\n\n            task.Start();\n        }\n    }\n</code></pre>\n"},{"tags":["c++","multithreading","visual-c++","beginthread"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13062895,"title":"Visual C++ Threads Simple Example","body":"<p>I am trying to create a basic thread from main by passing a function to _beginthread.\nBut My output is not getting completed.</p>\n\n<p>I am getting the following output:</p>\n\n<pre><code>Starting thread\n48\nMain ends\nI\n</code></pre>\n\n<p>Could someone please clarify what is wrong in the following code?   </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;process.h&gt;\nusing namespace std;\n\nvoid test(void *param)\n{\n    cout &lt;&lt; \"In thread function\" &lt;&lt; endl;\n    Sleep(1000); // sleep for 1 second\n    cout &lt;&lt; \"Thread function ends\" &lt;&lt; endl;\n    _endthread();\n}\n\n\nint main()\n{\n    cout &lt;&lt; \"Starting thread\" &lt;&lt; endl;\n    cout &lt;&lt; _beginthread(test,0,NULL);\n    cout &lt;&lt; \"Main ends\" &lt;&lt; endl;\n    return 0;\n}\n</code></pre>\n"},{"tags":["iphone","objective-c","multithreading","core-data","asihttprequest"],"answer_count":3,"favorite_count":6,"up_vote_count":9,"down_vote_count":0,"view_count":4718,"score":9,"question_id":3474960,"title":"Generic approach to NSManagedObjectContext in multi-threaded application","body":"<p>I've read a number of posts here about NSManagedObjectContext and multi-threaded applications.  I've also gone over the CoreDataBooks example to understand how separate threads require their own NSManagedObjectContext, and how a save operation gets merged with the main NSManagedObjectContext.  I found the example to be good, but also too application specific.  I'm trying to generalize this, and wonder if my approach is sound.</p>\n\n<p>My approach is to have a generic function for fetching the NSManagedObjectContext for the current thread.  The function returns the NSManagedObjectContext for the main thread, but will create a new one (or fetch it from a cache) if called from within a different thread.  That goes as follows:</p>\n\n<pre><code>+(NSManagedObjectContext *)managedObjectContext {\n    MyAppDelegate *delegate = (MyAppDelegate *)[[UIApplication sharedApplication] delegate];\n    NSManagedObjectContext *moc = delegate.managedObjectContext;\n\n    NSThread *thread = [NSThread currentThread];\n\n    if ([thread isMainThread]) {\n        return moc;\n    }\n\n    // a key to cache the context for the given thread\n    NSString *threadKey = [NSString stringWithFormat:@\"%p\", thread];\n\n    // delegate.managedObjectContexts is a mutable dictionary in the app delegate\n    NSMutableDictionary *managedObjectContexts = delegate.managedObjectContexts;\n\n    if ( [managedObjectContexts objectForKey:threadKey] == nil ) {\n        // create a context for this thread\n        NSManagedObjectContext *threadContext = [[[NSManagedObjectContext alloc] init] autorelease];\n        [threadContext setPersistentStoreCoordinator:[moc persistentStoreCoordinator]];\n        // cache the context for this thread\n        [managedObjectContexts setObject:threadContext forKey:threadKey];\n    }\n\n    return [managedObjectContexts objectForKey:threadKey];\n}\n</code></pre>\n\n<p>Save operations are simple if called from the main thread.  Save operations called from other threads require merging within the main thread.  For that I have a generic <code>commit</code> function:</p>\n\n<pre><code>+(void)commit {\n    // get the moc for this thread\n    NSManagedObjectContext *moc = [self managedObjectContext];\n\n    NSThread *thread = [NSThread currentThread];\n\n    if ([thread isMainThread] == NO) {\n        // only observe notifications other than the main thread\n        [[NSNotificationCenter defaultCenter] addObserver:self\n                                             selector:@selector(contextDidSave:)\n                                                 name:NSManagedObjectContextDidSaveNotification\n                                               object:moc];\n    }\n\n    NSError *error;\n    if (![moc save:&amp;error]) {\n        // fail\n    }\n\n    if ([thread isMainThread] == NO) {\n        [[NSNotificationCenter defaultCenter] removeObserver:self \n                                                    name:NSManagedObjectContextDidSaveNotification \n                                                  object:moc];\n    }\n}\n</code></pre>\n\n<p>In the <code>contextDidSave:</code> function we perform the merge, if called by the notification in <code>commit</code>.</p>\n\n<pre><code>+(void)contextDidSave:(NSNotification*)saveNotification {\n    MyAppDelegate *delegate = (MyAppDelegate *)[[UIApplication sharedApplication] delegate];\n    NSManagedObjectContext *moc = delegate.managedObjectContext;\n\n    [moc performSelectorOnMainThread:@selector(mergeChangesFromContextDidSaveNotification:)\n                      withObject:saveNotification\n                   waitUntilDone:YES];\n}\n</code></pre>\n\n<p>Finally, we clean-up the cache of NSManagedObjectContext with this:</p>\n\n<pre><code>+(void)initialize {\n    [[NSNotificationCenter defaultCenter] addObserver:self \n                                             selector:@selector(threadExit) \n                                                 name:NSThreadWillExitNotification \n                                               object:nil]; \n}\n\n+(void)threadExit {\n    MyAppDelegate *delegate = (MyAppDelegate *)[[UIApplication sharedApplication] delegate];\n    NSString *threadKey = [NSString stringWithFormat:@\"%p\", [NSThread currentThread]];  \n    NSMutableDictionary *managedObjectContexts = delegate.managedObjectContexts;    \n\n    [managedObjectContexts removeObjectForKey:threadKey];\n}\n</code></pre>\n\n<p>This compiles and seems to work, but I know threading problems can be tricky due to race conditions.  Does anybody see a problem with this approach?</p>\n\n<p>Also, I'm using this from within the context of an asynchronous request (using ASIHTTPRequest), which fetches some data from a server and updates and inserts the store on the iPhone.  It seems NSThreadWillExitNotification doesn't fire after the request completes, and the same thread is then used for subsequent requests.  This means the same NSManagedObjectContext is used for separate requests on the same thread.  Is this a problem?</p>\n"},{"tags":["c#","multithreading","invoke"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13062228,"title":"How to avoid UI hanging with Invoke?","body":"<p>This simple code below makes UI thread hanging.</p>\n\n<pre><code>    private void button1_Click(object sender, EventArgs e)\n    {\n        Thread t = new Thread(Func);\n        t.Start();\n    }\n    private void Func()\n    {\n        this.Invoke((Action)(() =&gt;\n        {\n            while (true)\n                ; \n        }));\n    }\n</code></pre>\n\n<p>I'd like to have Func() invoked in a different working thread without any UI thread freezing every time I click the button.</p>\n\n<p>What would be the best solution to make it work?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["multithreading","c#-4.0","ftp","timeout","tcpclient"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13036590,"title":"Regarding tcpclient timeout","body":"<p>I have tcplistener on port 21 waiting for incoming connections.When tcplistener receives an incoming request,i establish a control connection through instantiating a new Tcpclient,the FTP command and response are done on control channel.\n   If there is any request for data transfer like LIST,RETR,STOR commands on tcplistener,i will establish a new TCpclient on output(IPaddress and Port) provide by PORT command.The second Tcpclient will handle the requested data transfer.</p>\n\n<p>ISSUE: During huge file transfer,the first tcpclient(control channel) would be idle..It gets disposed\\closed in 60 seconds.</p>\n\n<p>WORKAROUND: to attach a thread to tcpclient while will keep on sending the keep alive command \"NOOP\" to tcplistener with Thread.Sleep for few seconds untill data transfer is complete.</p>\n\n<p>QUESTION:I tried socket level settings like socket.IOCOntrol for control channel tcpclient but it did not work out.How i attach a thread to tcpclient which send the keep live commands / or any other better suggestions to keep control channel live during file transfers.</p>\n\n<p>Regards,\nVivek</p>\n"},{"tags":["android","multithreading","android-emulator","android-asynctask"],"answer_count":4,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":2061,"score":3,"question_id":9119627,"title":"Android SDK AsyncTask doInBackground not running (subclass)","body":"<p><strong>As of 15/2/2012 I have yet to find a good explanation to nor a reason why this does not work. The closest to a solution is to use the traditional <a href=\"http://stackoverflow.com/a/4085140/1107464/\">Thread</a> approach, but then why include a class that does not (seem to) work in the Android SDK?</strong></p>\n\n<p>Evenin' SO!</p>\n\n<p>I have an AsyncTask subclass:</p>\n\n<pre><code>// ParseListener had a callback which was called when an item was parsed in a\n// RSS-xml, but as stated further down it is not used at all right now.\nprivate class xmlAsync extends AsyncTask&lt;String, RSSItem, Void&gt; implements ParseListener\n</code></pre>\n\n<p>That is executed like this:</p>\n\n<pre><code>xmlAsync xmlThread = new xmlAsync();\n\nxmlThread.execute(\"http://www.nothing.com\");\n</code></pre>\n\n<p>Now this subclass has run into a little error. Previously it did some xml-parsing, but when I noticed that it's <strong>doInBackground()</strong> wasn't called I stripped it down, line by line, finally ending up with just this:</p>\n\n<pre><code>@Override\nprotected Void doInBackground(String... params) \n{\n    Log.v(TAG, \"doInBackground\");\n        return null;\n}\n</code></pre>\n\n<p>Which, for some reason, logged nothing. However, I added this:</p>\n\n<pre><code>@Override\nprotected void onPreExecute() \n{\n        Log.v(TAG, \"onPreExecute\");\n        super.onPreExecute();\n}\n</code></pre>\n\n<p>And that line is indeed logged when executing the thread. <strong><em>So somehow onPreExecute() is called but not doInBackground()</em></strong>. I have another AsyncTask running in the background at the same time which works just fine.</p>\n\n<p>I'm currently running the app on an emulator, SDK Version 15, Eclipse, Mac OS X 10.7.2, close to the North Pole.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<pre><code>@Override\n    protected void onProgressUpdate(RSSItem... values) {\n\n        if(values[0] == null)\n        {\n                            // activity function which merely creates a dialog\n            showInputError();\n        }\n        else\n        {\n\n            Log.v(TAG, \"adding \"+values[0].toString());\n            _tableManager.addRSSItem(values[0]);\n        }\n\n\n        super.onProgressUpdate(values);\n    }\n</code></pre>\n\n<p>_tableManager.addRSSItem() more or less adds a row to a SQLiteDatabase, initialized with the activity's context. publishProgress() is called by the Interface ParseListener's callback. However, since I don't even do anything except log.v in doInBackground() I first found this unnecessary to even bring up.</p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p>Alright, just to be perfectly clear, this is the other AsyncTask, executing in the same activity and working perfectly fine.</p>\n\n<pre><code>private class dbAsync extends AsyncTask&lt;Void, RSSItem, Void&gt;\n{\n    Integer prevCount;\n    boolean run;\n\n    @Override\n    protected void onPreExecute() {\n        run = true;\n        super.onPreExecute();\n    }\n\n    @Override\n    protected Void doInBackground(Void... params) {\n        // TODO Auto-generated method stub\n        run = true;\n        prevCount = 0;\n\n        while(run)\n        {\n            ArrayList&lt;RSSItem&gt; items = _tableManager.getAllItems();\n\n            if(items != null)\n            {\n                if(items.size() &gt; prevCount)\n                {\n                    Log.v(\"db Thread\", \"Found new item(s)!\");\n                    prevCount = items.size();\n\n                    RSSItem[] itemsArray = new RSSItem[items.size()];\n\n                    publishProgress(items.toArray(itemsArray));\n                }\n            }               \n\n            SystemClock.sleep(5000);\n        }\n\n        return null;\n    }\n\n    @Override\n    protected void onProgressUpdate(RSSItem... values) {\n\n        ArrayList&lt;RSSItem&gt; list = new ArrayList&lt;RSSItem&gt;();\n\n        for(int i = 0; i &lt; values.length; i++)\n        {\n            list.add(i, values[i]);\n        }\n\n        setItemsAndUpdateList(list);\n\n        super.onProgressUpdate(values);\n    }\n\n    @Override\n    protected void onCancelled() {\n        run = false;\n\n        super.onCancelled();\n    }\n}\n</code></pre>\n\n<p><strong>EDIT 3:</strong></p>\n\n<p>Sigh, sorry I'm bad at asking questions. But here is the initialization of the Tasks.</p>\n\n<pre><code>xmlAsync _xmlParseThread;\ndbAsync _dbLookup;\n\n/** Called when the activity is first created. */\n@Override\npublic void onCreate(Bundle savedInstanceState) {\nsuper.onCreate(savedInstanceState);\nsetContentView(R.layout.main);\n\n_dbLookup = new dbAsync();\n_dbLookup.execute();\n\n_xmlParseThread = new xmlAsync();       \n_xmlParseThread.execute(\"http://www.nothing.com\", null);\n}\n</code></pre>\n"},{"tags":["multithreading","webdriver","testng","logback"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":642,"score":1,"question_id":7000678,"title":"Logging parallel threads in logback","body":"<p>I'll try to make a brief description of my Selenium framework so that I can explain my problem.</p>\n\n<p>I use <strong>Selenium 2</strong> (current version 2.3.1) + <strong>testNG 5.14</strong></p>\n\n<p>I set testng.xml file to run the tests in the test suite in parallel, just 2 instances</p>\n\n<p>For logging purposes, I use <strong>logback</strong> (I've read is the next best thing in the log world)</p>\n\n<p>My problem is that when checking what the application logs I get something like this:</p>\n\n<blockquote>\n  <p>18:48:58.551 [TestNG] INFO  d.a.a.s.t.setup.TestConfiguration -\n  Retrieving random User from User Pool</p>\n  \n  <p>18:48:58.551 [TestNG] INFO  d.a.a.s.t.setup.TestConfiguration -\n  Retrieving random User from User Pool</p>\n  \n  <p>18:48:58.551 [TestNG] DEBUG d.a.a.s.t.setup.TestConfiguration -\n  Creating DataSource for acccessing DataBase</p>\n  \n  <p>18:48:58.551 [TestNG] DEBUG d.a.a.s.t.setup.TestConfiguration -\n  Creating DataSource for acccessing DataBase</p>\n  \n  <p>18:48:58.552 [TestNG] DEBUG d.a.a.s.t.setup.TestConfiguration -\n  Launching SQL Query</p>\n  \n  <p>18:48:58.552 [TestNG] DEBUG d.a.a.s.t.setup.TestConfiguration -\n  Launching SQL Query</p>\n  \n  <p>18:48:59.613 [TestNG] TRACE d.a.a.s.t.setup.TestConfiguration - Query\n  succesful</p>\n  \n  <p>18:48:59.613 [TestNG] TRACE d.a.a.s.t.setup.TestConfiguration - Query\n  succesful</p>\n</blockquote>\n\n<p>As you may see, it is impossible to see the difference between the two threads that are running at the same time. My question is, is there a way I can configure the logback settings so that they also add a number or Id to identify each thread that is running?</p>\n\n<p>PD Just in case it may help, my <strong>logback.xml</strong> file looks like this:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n\n  &lt;appender name=\"FILE\" class=\"ch.qos.logback.core.FileAppender\"&gt;\n    &lt;file&gt;logs/selenium.log&lt;/file&gt;\n\n    &lt;encoder&gt;\n      &lt;pattern&gt;%date %level [%thread] %logger{10} [%file:%line] %msg%n&lt;/pattern&gt;\n    &lt;/encoder&gt;\n  &lt;/appender&gt;\n\n  &lt;appender name=\"STDOUT\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt;\n    &lt;!-- encoders are assigned the type\n         ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;\n    &lt;encoder&gt;\n      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;\n    &lt;/encoder&gt;\n  &lt;/appender&gt;\n\n  &lt;root level=\"trace\"&gt;\n    &lt;appender-ref ref=\"FILE\" /&gt;\n    &lt;appender-ref ref=\"STDOUT\" /&gt;\n  &lt;/root&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>Thank you for your help =)</p>\n\n<p>}Panacea{</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13060723,"title":"Java multithreading method access","body":"<p>Can I access the process method in Runner class from a thread's run method even without creating a Runner object ?Why ? </p>\n\n<pre><code>class Runner {\n  public void process() {\n    // some multithreaded code\n  }\n}\n\nmain() {\nThread t1 = new Thread(new Runnable() {\n                public void run() {\n                    process();\n                }\n           });\nt1.start();        \n}\n</code></pre>\n"},{"tags":["c","multithreading","for-loop"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13059874,"title":"Threads receiving the same ID in C","body":"<p>Here is a block of code that creates a number of threads provided by the user, each thread then generates a random number and calculates its squareroot.  I cannot figure out why the threads are getting the same ID, line 64 is the culprit as it is where the threads are being created.  I suspect that there is something happening in the loop that is causing the threads to all be generated at the same time.</p>\n\n<pre><code>////////////////////////////////////////////////\n//\n//\n// Zach\n//\n// \n//\n//\n////////////////////////////////////////////////\n\n\n\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;math.h&gt;\n\n\n\n\n\nvoid *squareroot(void *num1)\n{\n  int *id = (int *)num1;\n  int incoming = rand()/100;\n  float *outgoing = (float *)malloc(sizeof(float));\n  printf(\"%d \\n\", *id);\n  printf(\"%d\\n\", incoming);\n  *outgoing = 5.000;\n  //Calculate the square root of the number passed to the function\n  *outgoing = sqrt(incoming);\n  return outgoing;\n\n}\n\n\nint main(int argc, char* argv[])//testing funcion\n{\n  srand(time(NULL));\n  int i, j;\n  int *temp = (int *)malloc(sizeof(int));\n  if (argc != 2) \n  {\n\n    printf (\"ERROR: Enter a number\\n\");\n    return 1;\n\n  }\n\n  int loop = atoi(argv[1]); //grabbing the integer supplied by user\n  pthread_t thread_id[loop];\n  void *exit_status;\n  float *thread_result;\n\n  for(i = 0; i &lt; loop; i++)\n  {\n\n    pthread_create(&amp;thread_id[i], NULL, squareroot, &amp;i);\n  }\n\n\n  for(j = 0; j &lt; loop; j++)\n  {\n    pthread_join(thread_id[j], &amp;exit_status);\n    thread_result = (float *)exit_status;\n    printf(\"%f\\n\", *thread_result);\n\n  }\n\n\n}\n</code></pre>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13053253,"title":"Concurrent reads on a file in python","body":"<p>I have a file onto which I have written some data. Say 8 bytes of data\nNow using my python script, I want to read the first four bytes using one thread and the next 4 bytes using another thread while the first thread is still running or suspended. \nHow can I do this using python? i.e\n1) Read first 4 bytes using thread1 from file1\n2) while thread1 running or suspended, read next 4 bytes from file1 using thread2</p>\n"},{"tags":["c++","multithreading","winapi","critical-section"],"answer_count":9,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":5568,"score":5,"question_id":1008726,"title":"Win32 Read/Write Lock Using Only Critical Sections","body":"<p>I have to implement a read/write lock in C++ using the Win32 api as part of a project at work.  All of the existing solutions use kernel objects (semaphores and mutexes) that require a context switch during execution.  This is far too slow for my application.</p>\n\n<p>I would like implement one using only critical sections, if possible.  The lock does not have to be process safe, only threadsafe.  Any ideas on how to go about this?</p>\n"},{"tags":[".net","multithreading","synchronization","plinq"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13048673,"title":"Does PLINQ respect SynchronizationContext?","body":"<p>Say, I have the following code:</p>\n\n<pre><code>IPrincipal capturedPrincipal = Thread.CurrentPrincipal;\nmyseq.AsParallel().Select(x =&gt;\n{\n    Thread.CurrenctPrincipal = capturedPrincipal;\n    /*call code protected with CAS*/\n});\n</code></pre>\n\n<p>to be sure <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.thread.currentprincipal.aspx\" rel=\"nofollow\"><code>Thread.CurrenctPrincipal</code></a> will be propagated to every thread where <code>Select</code>'s delegate will be executed on. I've realized that if I had proper <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.aspx\" rel=\"nofollow\"><code>SynchronizationContext</code></a> set up this would happen automatically. So does PLINQ use <code>SynchronizationContext</code> when queuing work items on <code>ThreadPool</code>? And if no, why?</p>\n\n<p>p.s.</p>\n\n<p>I think it's important to note that the code above is executed in WCF environment hosted under IIS/WAS (no ASP.NET compatibility).</p>\n\n<p><strong>Edit:</strong>\nFound <a href=\"http://stackoverflow.com/questions/8319439/does-the-thread-identity-get-transferred-when-using-plinq-extensions\">a similar question</a> confirming same behavior I witness.</p>\n\n<p><strong>Edit2:</strong>\nModified casperOne's test a bit and it fails saying threadid <em>is the same</em>:</p>\n\n<pre><code>    [Test]\n    public void Test1()\n    {\n        var principal = new GenericPrincipal(new GenericIdentity(\"test\"), new string[0]);\n        Thread.CurrentPrincipal = principal;\n        int threadID = Thread.CurrentThread.ManagedThreadId;\n\n        Enumerable.Range(0, 4000).AsParallel()\n            .WithExecutionMode(ParallelExecutionMode.ForceParallelism)\n            .Select(x =&gt;\n                {\n                    Assert.AreSame(Thread.CurrentPrincipal, principal);\n                    Assert.AreNotEqual(Thread.CurrentThread.ManagedThreadId, threadID);\n                    return x;\n                })\n            .ToArray();\n    }\n</code></pre>\n"},{"tags":["objective-c","multithreading","cocoa","serial-port","usb"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13059726,"title":"High CPU consumption and latency while reading serial data","body":"<p>I have two functions in my software that cause important latency problems. The software is written in Objective-C. I receive serial data from an usb device and my goal is to encapsulate them and then to send them to another object which will process the data.</p>\n\n<p>This section of the program causes large cpu and latency issues and I don't know how to solve this at all.  The device only sends data when its state changes, thus when lots of changes occur well everything becomes laggy..</p>\n\n<pre><code>- (void)getSerialData {\n    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);\n    dispatch_async(queue, ^{\n    [self getSerialDataLoop];\n    });\n}\n\n- (void)getSerialDataLoop {\n\nreadThreadRunning = YES;\n\nchar byte_buffer[2]; // buffer for holding incoming data\nint numBytes=0; // number of bytes read during read\nNSString *text;\n\n// this will loop untilthe serial port closes\nwhile(TRUE) {\n    // read() blocks until some data is available or the port is closed\n    numBytes = (int)read(serialFileDescriptor, byte_buffer, 1); // read up to the size of the buffer\n\n    if(numBytes&gt;0) {\n        ///text = [NSString stringWithCString:byte_buffer encoding:NSSymbolStringEncoding];\n        if(![text isEqualToString:@\"\"]){\n            text = [NSString stringWithUTF8String:byte_buffer];\n            [self performSelectorOnMainThread:@selector(processNSStringData:) withObject:text waitUntilDone:YES];\n        }\n    } else {\n        break; // Stop the thread if there is an error\n    }\n\n}\n// make sure the serial port is closed\nif (serialFileDescriptor != -1) {\n    close(serialFileDescriptor);\n    serialFileDescriptor = -1;\n}\n\n// mark that the thread has quit\nreadThreadRunning = FALSE;\n}\n</code></pre>\n\n<p>Do you have any ideas or pointers?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13058801,"title":"Threads calling both static and non-static method","body":"<p>Disclaimer: This code is copied from <a href=\"http://stackoverflow.com/q/4415468/547453\">synchronized blocks for static and non-static methods</a></p>\n\n<p>I made some modification to it. I want to know how to make threads call both <strong>synchronized</strong> static and non-static methods. I can make it work by wrapping the non-static method in a <strong>synchronized</strong> block. Is there any other way?</p>\n\n<pre><code>public class StaticNonStaticSynch  \n{ \n public static void main(String[] args)  \n { \n      final StaticNonStaticTest staticNonStaticTest = new StaticNonStaticTest(); \n  Runnable runnable1 = new Runnable()  \n  { \n   @Override \n   public void run()  \n   { \nstaticNonStaticTest.nonStaticMethod(); \n   } \n  }; \n\n  Runnable runnable2 = new Runnable()  \n  { \n   @Override \n   public void run()  \n   { \n    StaticNonStaticTest.staticMethod(); \n   } \n  }; \n\n  Thread thread1 = new Thread(runnable1, \"First Thread\"); \n  Thread thread2 = new Thread(runnable2, \"Second Thread\"); \n\n  thread1.start(); \n  thread2.start(); \n } \n} \n\nclass StaticNonStaticTest \n{ \n\n void nonStaticMethod() \n { \n //synchronized (StaticNonStaticTest.class){ \n   for(int i=0;i&lt;50;i++) \n   { \n    System.out.println(\"Non - Static method called by \" + Thread.currentThread().getName() +\" : = \"+i); \n   } \n// } \n } \n static synchronized void staticMethod() \n {  \n   for(int i=0;i&lt;50;i++) \n   { \n    System.out.println(\"Static method called by \" + Thread.currentThread().getName() +\" : = \"+i); \n   } \n } \n} \n</code></pre>\n"},{"tags":["java","multithreading","getter"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":63,"score":3,"question_id":9929772,"title":"How to reach a method of an object that implements Runnable in Java?","body":"<p>I have an object called <code>OBJ</code>, that implements <code>Runnable</code>.\nIt has a few members, a constructor, a run() method and a getter for a certain count (one of the members).\nIn my main method, I have an array of threads which each thread is a <code>new OBJ</code>, and which each one, in the <code>run()</code> method, do a certain calculation and saves it in its count.</p>\n\n<p>Now, I would like to have another loop (other than the loop I've started all my threads with), and for each thread wait for it to finish, and then use count getter to sum all the counts I've got from the threads.</p>\n\n<p>How can I reach the getter through the threads?</p>\n"},{"tags":["multithreading","shell","unix","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13059553,"title":"Synchronization of processes in the shell?","body":"<p>I am forking off a bunch of processes, and I want to create a \"Barrier\" for my main original process to wait until all of the other processes finish. The code flow looks like so:</p>\n\n<pre><code>#...the main thread is executing now, and reaches this foreach loop:\n\nforeach arg (myArgs)\n\n    some_command arg &amp; #these are the processes being forked off\n\nend\n\n#I want the main thread to WAIT here until all the above processes finish!\n\n#... More code below here for the main thread to continue with\n</code></pre>\n\n<p>I'm not sure what synchronization primitive I want, or even what's available in the unix shell environment. Maybe something like a barrier for the main thread? </p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["c#","multithreading","thread-sleep","parallel-for"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":755,"score":6,"question_id":6195672,"title":"Does Thread.Sleep hinder other threads?","body":"<p>Here is a console program want 10 threads start in batch, wait 5 seconds, and stop in batch.</p>\n\n<pre><code>    static void Main(string[] args)\n    {\n        System.Threading.Tasks.Parallel.For(0, 10, (index) =&gt;\n        {\n            Action&lt;int&gt; act = (i) =&gt;\n            {\n                Console.Write(\"start {0} \", i);\n                Thread.Sleep(5000);\n            };\n\n            act.BeginInvoke(index, OnTaskComplete, index);\n        });\n\n        Console.ReadKey();\n    }\n\n    static void OnTaskComplete(IAsyncResult res)\n    {\n        Console.Write(\"finish {0} \", res.AsyncState);\n    }\n</code></pre>\n\n<p>but the result is not what I expected, 10 threads start one-by-one SLOWLY(around 1 second interval), even some \"finish\" comes out before some \"start\".</p>\n\n<p>when comment out Thread.Sleep, all threads start and finish in flash.</p>\n\n<p>Does thread.Sleep affect other threads? Is there anyway to make a pure idle time?</p>\n\n<p>/-----------------------------edit-----------------------------</p>\n\n<p>same problem also happen in:</p>\n\n<pre><code>    static void Main(string[] args)\n    {\n        System.Threading.Tasks.Parallel.For(0, 10, (index) =&gt;\n        {\n            Console.Write(\"start {0} \", index);\n            Thread.Sleep(5000);\n            Console.Write(\"fnish {0} \", index);\n        });\n\n        Console.ReadKey();\n    }\n</code></pre>\n\n<p>----------------------Edit------------------------</p>\n\n<p>finally I found a lovely way to substitute thread.sleep</p>\n\n<pre><code>        static void Main(string[] args)\n        {\n            System.Threading.Tasks.Parallel.For(0, 10, (index) =&gt;\n            {\n                Console.Write(\"start {0} \", index);\n\n                var t1 = new System.Threading.Timer(new TimerCallback(MyTimerCallback), index, 5000, 0); \n            });\n\n            Console.ReadKey();\n        }\n\n        static void MyTimerCallback(object o)\n        {\n            Console.Write(\"Timer callbacked \");\n        }\n</code></pre>\n"},{"tags":["java","multithreading","list","thread-safety","linked-list"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4246,"score":1,"question_id":3362018,"title":"Is LinkedList thread-safe when I'm accessing it with offer and poll exclusively?","body":"<p>I have a linked list <code>samples</code>:</p>\n\n<pre><code>protected LinkedList&lt;RawDataset&gt; samples = new LinkedList&lt;RawDataset&gt;();\n</code></pre>\n\n<p>I'm appending elements to the list in thread 1 like this:</p>\n\n<pre><code>this.samples.offer(data);\n</code></pre>\n\n<p>And I'm retrieving elements from it in a second thread like so:</p>\n\n<pre><code>public RawDataset retrieveSample() {\n    return this.samples.poll();\n}\n</code></pre>\n\n<p>Would this be considered as thread-safe? Even though thread 1 and 2 are both modifying the list they only do so on either the head or the tail of the list exclusively, right?</p>\n\n<p>If it isn't can anyone point me to a class in the Java API that comes with <code>poll</code>/<code>offer</code> and is sure to be thread-safe?</p>\n\n<p>Thank you in advance.</p>\n\n<p>BTW: <code>Collections.synchronizedList(new LinkedList())</code> won't give me access to <code>offer</code>/<code>poll</code>.</p>\n"},{"tags":["multithreading","perl","memory-leaks","leak"],"answer_count":1,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":155,"score":8,"question_id":12990085,"title":"Perl memory leak in threads (threads don't release memory)","body":"<p>I am now searching for 2 weeks about this problem and seems that I can't find any answer just searching on the web.</p>\n\n<p>So, here is two piece of code:</p>\n\n<p>1:</p>\n\n<pre><code>#! /usr/bin/perl\n\n#\n# RELEASE MEMORY\n#\n\nuse threads;\n\nmy @child;\n\n$ii=0;\n\n\nwhile (1)\n{\n  my @child = threads-&gt;new(\\&amp;test, \"test\");\n  $_-&gt;detach for @child;\n  print \"$ii\\n\";\n  $ii++;\n}\n\nsub test {\n    my ($ee) = 0;    \n}\n</code></pre>\n\n<p>2: </p>\n\n<pre><code>#! /usr/bin/perl\n\n#\n# DO NOT RELEASE MEMORY\n#\n\nuse threads;\n\nmy @child;\n\n$ii=0;\n\n\nfor($ii=0;$ii&lt;2000;$ii++) {\n    my @child = threads-&gt;new(\\&amp;test, \"test\");\n    $_-&gt;detach for @child;\n    print \"$ii\\n\";\n}\n\nwhile(1)\n{\n  sleep(10);\n}\n\nsub test {\n    my ($ee) = 0;    \n}\n</code></pre>\n\n<p>So here's the problem. The first code run only one infinite loop and it release memory back to operating system about each 2 seconds (according to ps) </p>\n\n<p>The second code is releasing memory too but only when he's running inside the \"for\" loop.\nOnce it exit the for loop and enter the infinite loop all the memory that have not been freed into the for loop is never released back to the operating system.</p>\n\n<p>Is anybody experiencing the same issue ? </p>\n\n<p>Perl: (v5.16.1) built for x86_64-linux-thread-multi</p>\n\n<p>OS: Debian 6.0.5</p>\n\n<p>Thanks a lot</p>\n\n<hr>\n\n<p>Edit 1:\nI used 800 threads and all verified that they exit by printing the $ee var.</p>\n\n<p>But once entering the while(1) loop here's the ps aux | grep perl output:</p>\n\n<pre><code>root@srv:~# ps aux | grep perl\nroot      6807 41.5  2.5 387780 209580 pts/0   S+   16:38   0:02 /opt/ActivePerl-5.16/bin/perl /home/tttlast.pl\nroot      7627  0.0  0.0   7548   856 pts/1    S+   16:38   0:00 grep perl\n</code></pre>\n\n<p>So all thread exited but the memory usage is still 2.5% of my server total memory.\nSo unless I kill the program the memory is still in use.</p>\n\n<hr>\n\n<p>Edit 2:</p>\n\n<p>I resolved my problem, I changed my structure. In fact the main program (the long running one) have been separated and I use small program who wait before all threads finish to exit.</p>\n\n<p>This way It doesn't full the virtual memory and other daemon are not killed.</p>\n\n<p>Thanks to everyone leading me to that solution.</p>\n"},{"tags":["c#",".net","multithreading","globalization","currentuiculture"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3862,"score":0,"question_id":2727694,"title":"Thread.CurrentThread.CurrentUICulture not working consistently","body":"<p>I've been working on a pet project on the weekends to learn more about C# and have encountered an odd problem when working with localization. To be more specific, the problem I have is with System.Threading.Thread.CurrentThread.CurrentUICulture.</p>\n\n<p>I've set up my app so that the user can quickly change the language of the app by clicking a menu item. The menu item in turn, saves the two-letter code for the language (e.g. \"en\", \"fr\", etc.) in a user setting called 'Language' and then restarts the application.</p>\n\n<pre><code>Properties.Settings.Default.Language = \"en\";\nProperties.Settings.Default.Save();\nApplication.Restart();\n</code></pre>\n\n<p>When the application is started up, the first line of code in the Form's constructor (even before InitializeComponent()) fetches the Language string from the settings and sets the CurrentUICulture like so:</p>\n\n<pre><code>public Form1()\n{\n    Thread.CurrentThread.CurrentUICulture = new CultureInfo(Properties.Settings.Default.Language);\n    InitializeComponent();\n}\n</code></pre>\n\n<p>The thing is, this doesn't work consistently. Sometimes, all works well and the application loads the correct language based on the string saved in the settings file. Other times, it doesn't, and the language remains the same after the application is restarted. </p>\n\n<p>At first I thought that I didn't save the language before restarting the application but that is definitely not the case. When the correct language fails to load, if I were to close the application and run it again, the correct language would come up correctly. So this implies that the Language string has been saved but the CurrentUICulture assignment in my form constructor is having no effect sometimes.</p>\n\n<p>Any help? Is there something I'm missing of how threading works in C#? This could be machine-specific, so if it makes any difference I'm using Pentium Dual-Core CPU.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Vlad asked me to check what the CurrentThread's CurrentUICulture is. So I added a MessageBox on my constructor to tell me what the CurrentUICulture two-letter code is as well as the value of my Language user string.</p>\n\n<pre><code>MessageBox.Show(string.Format(\"Current Language: {0}\\nCurrent UI Culture: {1}\", Properties.Settings.Default.Language, Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName));\n</code></pre>\n\n<p>When the wrong language is loaded, both the Language string and CurrentUICulture have the wrong language. So I guess the CurrentUICulture has been cleared and my problem is actually with the Language Setting. </p>\n\n<p>So I guess the problem is that my application <strong>sometimes</strong> loads the previously saved language string rather than the last saved language string. If the app is restarted, it will then load the actual saved language string.</p>\n"},{"tags":["objective-c","ios","multithreading","uiview","uiactivityindicatorview"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13058750,"title":"Can I build UIView elements on a separate thread?","body":"<p>I have an app that has to load and render a fair amount of content onto screen (mostly loading from a database). </p>\n\n<p>I won't post all the code here but in effect it simply builds up a set of UIView objects that are added to a UIScrollView object. Nothing too complicated, just loaded quite a lot of stuff. This currently takes a second or so render everything (running on the main thread).</p>\n\n<p>I want to show an activity indicator whilst the loading is happening, and I <em>think</em> the best way to do this is to have the method that takes a long time happen on a background thread and \"report back\" when it is complete.</p>\n\n<p>The question is this. I know all the actual drawing is done by the main thread, so is it possible to create a new thread and have that build up a set of UIView objects that are then drawn on screen?</p>\n"},{"tags":["c#","multithreading","linq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":13057963,"title":"Run Linq query on new thread","body":"<p>After following the MSDN guide to create a new thread to update a UI control I'm getting a strange error. I had this same query run in the load method and it worked just fine, now running in the new thread I get the right number of results, but instead of getting the names of the fields I just get DataSet written 16 time in my comboBox. Can anyone help me with this?</p>\n\n<pre><code>private void Form1_Load(object sender, EventArgs e)\n    {\n        recipeListComboBox.Items.Clear();\n        Thread QueryThread = new Thread(new ThreadStart(updateRecipeList));\n        QueryThread.Start();\n    }\n\n private void updateRecipeList()\n    {\n\n        IEnumerable&lt;string&gt; list = recipeList.getList();\n\n        foreach (string a in list)\n            UpdateRecipeComboBox(a);\n    }\n\n private void UpdateRecipeComboBox(string text)\n    {\n        if (this.recipeListComboBox.InvokeRequired)\n        {\n            UpdateRecipeComboBoxCallBack d = new UpdateRecipeComboBoxCallBack(UpdateRecipeComboBox);\n            Invoke(d, new object[] { text });\n        }\n\n        else\n        {\n            this.recipeListComboBox.Items.Add(Text);\n        }\n    }\n\n    delegate void UpdateRecipeComboBoxCallBack(string text);\n</code></pre>\n\n<p>before I put this on a new thread it looked like this:</p>\n\n<pre><code>private void Form1_Load(object sender, EventArgs e)\n{\n     recipeListComboBox.Items.Clear();\n     IEnumerable&lt;string&gt; list = recipeList.getList();\n\n     foreach (string a in list)\n          recipeComboBox.Items.Add(a);\n</code></pre>\n\n<p>this would retrun a list of 16 different recipies in the database, now I just get dataSet printed 16 times.</p>\n\n<p>Thanks for any help!!</p>\n\n<p>Craig</p>\n"},{"tags":["java","multithreading","arraylist"],"answer_count":4,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":160,"score":8,"question_id":12981168,"title":"Need Fool Proof Synchronization of ArrayList in A Multi-threaded Environment","body":"<p>I've been at this for a week now doing my research on how to properly synchronize an ArrayList.</p>\n\n<p>My main issue in a nutshell is I have a \"master\" ArrayList of objects. Different threads may come in and add/set/remove from this list. I need to be sure that when one thread is iterating through the ArrayList, another is not changing it.</p>\n\n<p>Now I've read many articles on the \"best\" way of handling this:</p>\n\n<ul>\n<li>use collections.synchronizedlist</li>\n<li>use CopyOnWriteArrayList</li>\n<li>use synchronized() blocks in conjunction with collections.synchronizedlist</li>\n<li>use Vector (many people are against this)</li>\n</ul>\n\n<p>Using synchronized blocks around every iteration, add/set/remove block seems to be kind of what I want, but people have said there is a lot of overhead.</p>\n\n<p>So then I started playing with CopyOnWriteArrayList (I do way more reads than writes for my master ArrayList). This is fine for reading, but what a lot of forum threads neglect to mention is that elements cannote be added, set, or removed from the iterator itself. For example (a basic version, but imagine it in a multi-threaded environment):</p>\n\n<pre><code>public static void main(String[] args) {\n\n    class TestObject{\n        private String s = \"\";\n        public TestObject(String s){\n            this.s = s;\n        }\n\n        public void setTheString(String s){\n            this.s = s;\n        }\n\n        public String getTheString(){\n            return s;\n        }\n    }\n\n    CopyOnWriteArrayList&lt;TestObject&gt; list = new CopyOnWriteArrayList&lt;TestObject&gt;();\n    list.add(new TestObject(\"A\"));\n    list.add(new TestObject(\"B\"));\n    list.add(new TestObject(\"C\"));\n    list.add(new TestObject(\"D\"));\n    list.add(new TestObject(\"E\"));\n\n    ListIterator&lt;TestObject&gt; litr = list.listIterator();\n\n    while(litr.hasNext()){\n      TestObject test = litr.next();\n      if(test.getTheString().equals(\"B\")){\n         litr.set(new TestObject(\"TEST\"));\n      }\n    }\n}\n</code></pre>\n\n<p>the line \"litr.set(new TestObject(\"TEST\"));\" would throw a</p>\n\n<pre><code>java.lang.UnsupportedOperationException\n</code></pre>\n\n<p>And looking at the Java Documentation there is a specific line describing this behavior:</p>\n\n<p>\"Element-changing operations on iterators themselves (remove, set, and add) are not supported. These methods throw UnsupportedOperationException.\"</p>\n\n<p>So then you are forced to modify that list by using </p>\n\n<pre><code>list.set(litr.previousIndex(), new TestObject(\"TEST\"));\n</code></pre>\n\n<p>Now technically shouldn't this present a synchronization issue? If another thread were to come in at the same time, and say, remove all elements from \"list\" the iterator would not see that, it would go to set the \"list\" at a given index and would throw an exception because the element at that point no longer exists. I just don't understand the point of CopyOnWriteArrayList if you cant add an element through the iterator itself. </p>\n\n<p>Am I missing the point with using CopyOnWriteArrayList?</p>\n\n<p>Do I wrap every iterator that ends up having to add/set/remove an element in a synchronized block?</p>\n\n<p>This HAS to be a common issue with multi-threading. I would have thought someone would have made a class that could handle all this without worry... </p>\n\n<p>Thanks in advance for having a look at this!</p>\n"},{"tags":["multithreading","ios6","nstimer","ios5.1","nsrunloop"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12929526,"title":"do runloops/multi-threading/timers behave differently on iOS6?","body":"<p>I just installed Xcode 4.5 to start testing some code on iOS6 devices.. I wanted my existing code to be runnable on both iOS 5 and iOS 6 obviously. The same code (below) that used to work on Xcode 4.3 stopped working on Xcode 4.5:</p>\n\n<pre><code>-(BOOL)readFromRingBuffer\n{                \n    NSDate *fireDate = [NSDate dateWithTimeIntervalSinceNow:0];\n    ringBufferReaderTimer = [[NSTimer alloc] initWithFireDate:fireDate\n                                                    interval:0.25\n                                                      target:self\n                                                     selector:@selector(readRingBufferDataBit)\n                                                    userInfo:NULL\n                                                     repeats:YES];\n\n    NSRunLoop *runLoop = [NSRunLoop currentRunLoop];\n    [runLoop addTimer:ringBufferReaderTimer forMode:NSDefaultRunLoopMode];\n}\n</code></pre>\n\n<p>I had to put this line for the method to fire:<code>[ringBufferReaderTimer fire];</code> (didn't have to do this on XCode 4.3)</p>\n\n<p>but then it would go through the method once and nothing would happen.. in general.. I see weird things happening.. is there something I need to know about threading in iOS6 that I'm not aware of? A quick googling doesn't tell me much..</p>\n"},{"tags":["multithreading","perl"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":13051958,"title":"Perl parallel HTTP requests - out of memory","body":"<p>First of all, I'm new to Perl.\nI want to make multiple (e.g. 160) HTTP GET requests on a REST API in Perl. Executing them one after another takes much time, so I was thinking of running the requests in parallel. Therefore I used threads to execute more requests at the same time and limited the number of parallel requests to 10. \nThis worked just fine for the first time I ran the program, the second time I ran 'out of memory' after the 40th request. </p>\n\n<p>Here's the code: (@urls contains the 160 URLs for the requests)</p>\n\n<pre><code>while(@urls) {\n  my @threads;\n  for (my $j = 0; $j &lt; 10 and @urls; $j++) {\n    my $url = shift(@urls);\n    push @threads, async { $ua-&gt;get($url) };\n  }\n\n  for my $thread (@threads) {\n  my $response = $thread-&gt;join;\n  print \"$response\\n\"; \n }\n}\n</code></pre>\n\n<p>So my question is, why am I NOT running out of memory the first time but the second time (am I missing something crucial in my code)? And what can I do to prevent it?\nOr is there a better way of executing parallel GET requests?</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13055951,"title":"Numbering of ThreadPool in java","body":"<p>Hello I am using threadPool with two threads in a funciton.</p>\n\n<p>This funciton is called by multiple clients in a synchronized way.</p>\n\n<p>in that function I am using </p>\n\n<pre><code>ExecutorService executor = Executors.newFixedThreadPool(2);\n</code></pre>\n\n<p>and after finishing the task I am shutting down the executor.</p>\n\n<pre><code>executor.shutdown();\n</code></pre>\n\n<p>But in logs I have lines like this</p>\n\n<pre><code>[pool-120069-thread-1]\n</code></pre>\n\n<p>Does that mean 120069 pools are alive, or its just way of numbering the pool. Even after shutting it down it continue with the numbering ?</p>\n"},{"tags":["c++","multithreading","boost","threadpool","boost-asio"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":12880954,"title":"boost thread pool","body":"<p>I need a threadpool for my application, and I'd like to rely on standard (C++11 or boost) stuff as much as possible. I realize there is an unofficial(!) boost thread pool class, which basically solves what I need, however I'd rather avoid it because it is not in the boost library itself -- why is it still not in the core library after so many years?</p>\n\n<p>In some posts on this page and elsewhere, people suggested using boost::asio to achieve a threadpool like behavior. At first sight, that looked like what I wanted to do, however I found out that all implementations I have seen have no means to join on the currently active tasks, which makes it useless for my application. To perform a join, they send stop signal to all the threads and subsequently join them. However, that completely nullifies the advantage of threadpools in my use case, because that makes new tasks require the creation of a new thread.</p>\n\n<p>What I want to do is:</p>\n\n<pre><code>ThreadPool pool(4);\nfor (...)\n{\n    for (int i=0;i&lt;something;i++)\n        pool.pushTask(...);\n    pool.join();\n    // do something with the results\n}\n</code></pre>\n\n<p>Can anyone suggest a solution (except for using the existing unofficial thread pool on sourceforge)? Is there anything in C++11 or core boost that can help me here?</p>\n"},{"tags":["multithreading","msmq"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":367,"score":1,"question_id":1126841,"title":"MSMQ for Managing Threads?","body":"<p>I am building an application where I have inputs from printers over the network (on specific ports) and other files which are created into a folder locally or through the network. The user can create different threads to monitor different folders at the same time, as well as threads to handle the input from threes printers over the network. The application is supposed to process the input data according to its type and output it. On the other end of the application, there would be 4 threads waiting for input data from the input threads (could be 10 or 20 threads) to process and apply 4 different tasks.\nAs we will have many threads running at the same time, I thought I would use MSMQ to manage these threads. Does using MSMQ fit in this scenario or should I use another technique? Managing these threads in terms of scheduling, prioritizing, etc.</p>\n\n<p>(P.S: I was thinking to build my own ThreadEngine class that will take care of all of these things until I heard about MSMQ, which am still not sure if it’s the right thing to use)</p>\n"},{"tags":["vb.net","multithreading","data-binding","datatable"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13055035,"title":"Cannot add rows to DataTable from another thread","body":"<p>Here is a code sample, you will need to place a <code>ListBox</code> called <code>list_of_items</code> onto the form, to reproduce the issue I'm having:</p>\n\n<pre><code>Imports System.Threading.Tasks\n\nPublic Class Form1\n  Dim _dt As DataTable\n\n  Private Sub Form1_Load() Handles MyBase.Load\n    _dt = New DataTable\n    With _dt.Columns\n      .Add(\"key\")\n      .Add(\"value\")\n    End With\n    With list_of_items\n      .ValueMember = \"key\"\n      .DisplayMember = \"value\"\n      .DataSource = _dt\n    End With\n    Dim addItemsTask As New Task(AddressOf AddThreeItems)\n    addItemsTask.Start() 'does not add anything when done\n    'AddThreeItems() #doing this instead works!\n  End Sub\n\n  Private Sub AddThreeItems()\n    Threading.Thread.Sleep(2000)\n    With _dt.Rows\n      .Add({\"1\", \"One\"})\n      .Add({\"2\", \"Two\"})\n      .Add({\"3\", \"Three\"})\n    End With\n    Me.Invoke(Sub() Me.Text = \"Separate thread is done\")\n  End Sub\nEnd Class\n</code></pre>\n\n<p>Problem is that rows do get added physically, so <code>DataTable.Rows.Count</code> increases, but visually nothing happens. I tried calling <code>Refresh</code>, resetting <code>DataSource</code> to <code>Nothing</code> and back - it does not help. If I switch this to single thread processing, rows get added just fine with the illustrated approach. What could be the issue?</p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13050061,"title":"python Threadsafe lock on loop","body":"<p>Can someone please tell me if the following is threadsafe or not and if it isnt what must I do to make it so. Note, this only a small sample, not sure if it compiles.</p>\n\n<pre><code>TIMER = True\ntime_lock = threading.Lock()\ndef timing():\n    while TIMER:\n        print time.time()\n\ntimer = threading.Thread(target=timing)\ntimer.start()\n\nwhile True:\n    time_lock.aquire()\n    if doSomeStuff():\n        TIMER = True\n    if otherThings():\n        break\n    time_lock.aquire()\n    TIMER = False\n    time_lock.release()\n\ntime_lock.aquire()\nTIMER = False\ntime_lock.release()\n</code></pre>\n"},{"tags":["java","multithreading","spring","tomcat7","httpconnection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13040150,"title":"Spring WS and MultiThreadedHttpConnectionManager","body":"<p>I have a web service on Spring WS 2.1.0. Web service runs on Tomcat 7 and implements an endpoint with one transactional method that read data from database and generate different reports. Tomcat 7 runs behind Apache Server via JServ protocol.</p>\n\n<p>During stress test via Apache JMeter I came to conclusion that simultaneous requests are handled serially. At first I tried to tune database connection pool (commons-dbcp and later tomcat-jdbc) but result was the same. Endpoint method only reads data, so there are no read-after-write or write-after-read dependencies and transactions could by handled in parallel. Thus the problem is in HTTP connections handling.</p>\n\n<p>After some searching (and googling, of course) I found out that Spring WS comes with the default connection manager(SimpleHttpConnectionManager) which is single threaded. The good practise is to replace SimpleHttpConnectionManager with MultiThreadedHttpConnectionManager. I found sample code that looks like this:</p>\n\n<pre><code>&lt;bean id=\"httpClient\" class=\"org.apache.commons.httpclient.HttpClient\"&gt;\n    &lt;constructor-arg&gt;\n        &lt;bean class=\"org.apache.commons.httpclient.MultiThreadedHttpConnectionManager&gt;\n            &lt;property name=\"maxConnectionsPerHost\" value=\"20\"/&gt;\n            &lt;property name=\"maxTotalConnections\" value=\"100\"/&gt;\n        &lt;/bean&gt;\n    &lt;/constructor-arg&gt;\n&lt;/bean&gt;\n</code></pre>\n\n<p>But this example isn't rather clear to me because I don't understand how Spring uses HttpClient (refers to ID or autowiring it).  So how can I use MultiThreadedHttpConnectionManager with Spring in my case? Where should I inject configured instance of this class? </p>\n"},{"tags":["c","multithreading","task","openmp"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":86,"score":3,"question_id":13034718,"title":"Producer-Consumer using OpenMP-Tasks","body":"<p>I'm trying to implement a parallel algorithm using tasks within OpenMP.\nThe parallel programming pattern is based on the producer-consumer idea, but\nsince the consumer process is slower than the producer, I want to use a few\nproducers and several consumers.\nThe main idea is to create as many OS threads as producers and then each of\nthese will create tasks to be done in parallel (by the consumers). Every\nproducer will be associated with a proportional number of consumers (i.e\nnumCheckers/numSeekers).\nI'm running the algorithm on an Intel Dual-chip server with 6 cores per chip.\nThe thing is that when I use only one producer(seeker) and an increasing number\nof consumers(checkers) the performance decays very fast as the number of\nconsumers grows (see table below), even though the correct number of cores are\nworking at a 100%.\nOn the other hand, if I increase the number of producers, the average time\ndecreases or at least stays stable, even with a proportional number of\nconsumers.\nIt seems to me that all the improvement is made by the division of the input\namong the producers, and the tasks are only bugging. But again, I don't have any\nexplanation for the behavior with one producers. Am I missing something in the\nOpenMP-Task logic? Am I doing something wrong?</p>\n\n<pre><code>-------------------------------------------------------------------------\n|   producers   |   consumers   |   time        |\n-------------------------------------------------------------------------\n|       1       |       1       |   0.642935    |\n|       1       |       2       |   3.004023    |\n|       1       |       3       |   5.332524    |\n|       1       |       4       |   7.222009    |\n|       1       |       5       |   9.472093    |\n|       1       |       6       |   10.372389   |\n|       1       |       7       |   12.671839   |\n|       1       |       8       |   14.631013   |\n|       1       |       9       |   14.500603   |\n|       1       |      10       |   18.034931   |\n|       1       |      11       |   17.835978   |\n-------------------------------------------------------------------------\n|       2       |       2       |   0.357881    |\n|       2       |       4       |   0.361383    |\n|       2       |       6       |   0.362556    |\n|       2       |       8       |   0.359722    |\n|       2       |      10       |   0.358816    |\n-------------------------------------------------------------------------\n</code></pre>\n\n<p>The main section of my code is as fallow:</p>\n\n<pre><code>int main( int argc, char** argv) {\n\n  // ... process the input (read from file, etc...)\n\n  const char *buffer_start[numSeekers];\n  int buffer_len[numSeekers];\n\n  //populate these arrays dividing the input\n  //I need to do this because I need to overlap the buffers for\n  //correctness, so I simple parallel-for it's not enough \n\n  //Here is where I create the producers\n  int num = 0;\n  #pragma omp parallel for num_threads(numSeekers) reduction(+:num)\n  for (int i = 0; i &lt; numSeekers; i++) {\n      num += seek(buffer_start[i], buffer_len[i]);\n  }\n\n  return (int*)num;\n}\n\nint seek(const char* buffer, int n){\n\n  int num = 0;\n\n  //asign the same number of consumers for each producer \n  #pragma omp parallel num_threads(numCheckers/numSeekers) shared(num)\n  {\n    //only one time for every producer\n    #pragma omp single\n    {\n      for(int pos = 0; pos &lt; n; pos += STEP){\n    if (condition(buffer[pos])){\n      #pragma omp task shared(num)\n      {\n        //check() is a sequential function\n        num += check(buffer[pos]);\n      }\n    }\n      }\n      #pragma omp taskwait\n    }\n  return num;\n}\n</code></pre>\n"},{"tags":["iphone","objective-c","ios","multithreading","mkannotationview"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":13035825,"title":"MKAnnotationView showing callout with no text","body":"<p><strong>Update</strong>:Michael got it right. Here is my solution:</p>\n\n<pre><code>- (void) connectNextCarOnMainThread:(id)annotation{\n    [self performSelectorOnMainThread:@selector(connectNextCar:) withObject:annotation waitUntilDone:YES];\n}\n\n- (void) connectNextCar:(id)annotation{\n    Pin *pin = (Pin *)annotation;\n    MKMapRect zoomRect = MKMapRectNull;\n    MKMapPoint annotationPoint = MKMapPointForCoordinate(pin.coordinate);\n    MKMapRect pointRect = MKMapRectMake(annotationPoint.x, annotationPoint.y, 3, 3);\n    if (MKMapRectIsNull(zoomRect)) {\n         zoomRect = pointRect;\n    } else {\n         zoomRect = MKMapRectUnion(zoomRect, pointRect);\n    }\n    [mapView setVisibleMapRect:zoomRect animated:YES];\n    [mapView selectAnnotation:pin animated:YES];\n\n    NSInteger currentIndex=[self.annotations indexOfObject:annotation];\n    if(currentIndex &lt; [self.annotations count]){\n        [self performSelector:@selector(connectNextCarOnMainThread:) withObject:[self.annotations objectAtIndex:currentIndex+1] afterDelay:5];\n    }\n}\n</code></pre>\n\n<p><br /></p>\n\n<hr>\n\n<p>I want to achieve a simple feature: center and select one of my annotations every X seconds. But I'm getting some strange behavior in my annotation callouts.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>- (void)mapView:(MKMapView *)mapView regionDidChangeAnimated:(BOOL)animated{\n    if(self.movedToFitPins){\n        for(id &lt;MKAnnotation&gt; pin in self.annotations)\n            [self.mapView addAnnotation:pin];\n        self.movedToFitPins = NO;\n        [self performSelectorInBackground:@selector(fakeCarConnections) withObject:nil];\n    }\n}\n\n- (void) fakeCarConnections {\n    for (Pin *annotation in self.annotations)\n    {\n        [NSThread sleepForTimeInterval : 10.0];\n        MKMapRect zoomRect = MKMapRectNull;\n        MKMapPoint annotationPoint = MKMapPointForCoordinate(annotation.coordinate);\n        MKMapRect pointRect = MKMapRectMake(annotationPoint.x, annotationPoint.y, 3, 3);\n        if (MKMapRectIsNull(zoomRect)) {\n            zoomRect = pointRect;\n        } else {\n            zoomRect = MKMapRectUnion(zoomRect, pointRect);\n        }\n        [mapView setVisibleMapRect:zoomRect animated:YES];\n        [mapView selectAnnotation:annotation animated:YES];\n    }\n}\n</code></pre>\n\n<p>So, what is happening is that I do focus on the Annotation, the callout bubble does open but with no text inside. If i click in the annotation, the callout opens up correctly with the text.<br />\nHere is the catch: if I comment the sleepForTimeInterval line, the code works fine, but I only see the last annotation since it passes trough all the others.</p>\n"},{"tags":["java","multithreading","safe"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13032766,"title":"Is reference update thread safe?","body":"<pre><code>public class Test{\n   private MyObj myobj = new MyObj(); //it is not volatile\n\n\n   public class Updater extends Thred{\n      myobje = getNewObjFromDb() ; //not am setting new object\n   }\n\n   public MyObj getData(){\n    //getting stale date is fine for \n    return myobj;\n   }\n\n\n}\n</code></pre>\n\n<p>Updated regularly updates myobj <br>\nOther classes  fetch data using getData <br>\nIS this code thread safe without using volatile keyword? <br>\nI think yes.  Can someone confirm?</p>\n"},{"tags":["php","multithreading","design","cron"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12987282,"title":"PHP : Delay instructions with CLI or Crontab and NOT Sleep()","body":"<p><strong>Context</strong><br>\nI need to warn my website's users of events by sending them an email when they're offline or display them a javascript notification if they're online (using websockets/push events).<br>\nSome of these events should be triggered <strong>after a certain amount of time</strong> (for specific app/business logic).</p>\n\n<p>I won't use <em>sleep()</em> since it may causes performances issues.</p>\n\n<p>How would you manage to do that using Crontab and/or CLI  ?</p>\n"},{"tags":["c#","wpf","multithreading","usercontrols","loading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":145,"score":0,"question_id":12954531,"title":"Loading animation in new window when WPF datagrid is loading","body":"<p>I have found this : <a href=\"http://stackoverflow.com/questions/2114264/how-to-show-a-loading-graphic-animation-when-wpf-data-binding-is-taking-place?answertab=votes#tab-top\">How to show a loading graphic/animation when wpf data binding is taking place</a></p>\n\n<p>But don't understand how to apply it for my work.</p>\n\n<p>I have My MainWindow. It call all my user controls in it.</p>\n\n<p>On a user control, I have a DataGrid. after press \"Go\" button, the datagrid load data from MySQL. It take a long time to do and I want to show a dialog window with \"Please Wait\" during the loading of the datagrig.</p>\n\n<p>I have found the link below but don't understant how to call it correctly.</p>\n\n<p>Do I need to put this \"loader\" in a new class file like \"Loader.cs\" andthe button call it ? Ok but how to close it when datagrid is finished ?</p>\n\n<p>I'm lost... Well if an other solution exist and simply to use...</p>\n\n<p>Thanks by advance</p>\n\n<p><strong>EDIT TEST 1 :</strong></p>\n\n<p>Tried an simple test with slider to get a time to wait and a button.</p>\n\n<pre><code>using System;\nusing System.ComponentModel;\nusing System.Windows;\nusing System.Windows.Controls;\n\nnamespace TEST_LoadingPage\n{\n/// &lt;summary&gt;\n/// Logique d'interaction pour MainWindow.xaml\n/// &lt;/summary&gt;\npublic partial class MainWindow : Window\n{\n    public MainWindow()\n    {\n        InitializeComponent();\n    }\n\n    private void btnTester_Click(object sender, RoutedEventArgs e)\n    {\n        Window waitWindow = new Window { Height = 100, Width = 200, WindowStartupLocation = WindowStartupLocation.CenterScreen, WindowStyle = WindowStyle.None };\n        waitWindow.Content = new TextBlock { Text = \"Veuillez patienter...\", FontSize = 30, HorizontalAlignment = HorizontalAlignment.Center, VerticalAlignment = VerticalAlignment.Center };\n\n        BackgroundWorker worker = new BackgroundWorker();\n        worker.DoWork += delegate\n        {\n            Dispatcher.BeginInvoke(new Action(delegate { waitWindow.ShowDialog(); }));\n            lbReussite.Visibility = Loop.Pause(slider.Value);\n            Dispatcher.BeginInvoke(new Action(delegate() { waitWindow.Close(); }));\n        };\n        worker.RunWorkerAsync();\n    }\n}\n\npublic class Loop\n{\n    public static System.Windows.Visibility Pause(double duree)\n    {\n        try\n        {\n            DateTime begin = new DateTime();\n            DateTime end = new DateTime();\n            int i = 0;\n            begin = DateTime.Now;\n            end = DateTime.Now.AddSeconds(duree);\n\n            while (DateTime.Now &lt;= end)\n                i++;\n\n            return System.Windows.Visibility.Visible;\n        }\n        catch (Exception)\n        {\n            return System.Windows.Visibility.Hidden;\n        }\n    }\n}\n}\n</code></pre>\n\n<p>but don't work with error :</p>\n\n<blockquote>\n  <p>The calling thread can not access this object because a different thread owns it</p>\n</blockquote>\n\n<p>I know its a courant error but I don't see \"DispatcherTimer\" or else that I've seen before in precedent project... So I'll try the second code tomorrow BUT. I don't understand where i put my method :(</p>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>I tried with your code... I'm too stupide maybe.</p>\n\n<p>I've write the class in a Loader.cs and in my MainWiondow (its a test)</p>\n\n<pre><code>public partial class MainWindow : Window\n{\n    public MainWindow()\n    {\n        InitializeComponent();\n    }\n\n    private void btnTester_Click(object sender, RoutedEventArgs e)\n    {\n        Loader&lt;List&lt;Donnees&gt;&gt; loader = new Loader&lt;List&lt;Donnees&gt;&gt;(GenerateList((int)slider.Value);\n        loader.JobFinished += new Loader&lt;Donnees&gt;.OnJobFinished(loader_JobFinished);\n        loader.Load();\n\n    }\n\n    private List&lt;Donnees&gt; GenerateList(int number)\n    {\n        List&lt;Donnees&gt; list = new List&lt;Donnees&gt;();\n        for (int i = 1; i &lt;= number; i++)\n        {\n            Donnees data = new Donnees();\n            data.Id = i;\n            data.Name = \"Ligne \" + i;\n            list.Add(data);\n        }\n        return list;\n    }\n\n    void loader_JobFinished(object sender, List&lt;Donnees&gt; result)\n    {\n        result = GenerateList((int)slider.Value);\n        dgDataGrid.ItemsSource = result;\n    }\n\n}\n\npublic class Donnees\n{\n    #region Properties\n\n    private int id;\n    public int Id\n    {\n        get { return id; }\n        set { id = value; }\n    }\n\n    private string name;\n    public string Name\n    {\n        get { return name; }\n        set { name = value; }\n    }\n\n    #endregion\n\n    public Donnees()\n    {\n        id = -1;\n        name = \"\";\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading","junit","roboguice","robolectric"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13020225,"title":"RoboGuice 2.0 and Robolectric 1.1 Testing RoboAsyncTask","body":"<p>I am currently using both RoboGuice 2.0 and Robolectric 1.1 in my Android application.  I've noticed that the RoboLooperThread is gone in 2.0 and I'm having difficulties having any RoboAsyncTask's be invoked.  When the main test thread calls <code>.execute()</code> on the <code>RoboAsyncTask</code>, the RoboAsyncTask's <code>call()</code> method is never called.  My question is how can I force the test thread to switch to and from the UI thread so that way the task can be executed?</p>\n\n<p>Thanks,</p>\n\n<p>Vince</p>\n"},{"tags":["c++","multithreading","locking"],"answer_count":11,"favorite_count":15,"up_vote_count":25,"down_vote_count":0,"view_count":21987,"score":25,"question_id":244316,"title":"Reader/Writer Locks in C++","body":"<p>I'm looking for a good reader/writer lock in C++. We have a use case of a single infrequent writer and many frequent readers and would like to optimize for this. Preferable I would like a cross-platform solution, however a Windows only one would be acceptable. </p>\n"},{"tags":["multithreading","stl"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2189,"score":3,"question_id":268153,"title":"Multithread read and write to a ::stl::vector, vector resource hard to release","body":"<p>I am writing code in VS2005 using its STL.\nI have one UI thread to read a vector, and a work thread to write to a vector.\nI use ::boost::shared_ptr as vector element.</p>\n\n<pre><code>vector&lt;shared_ptr&lt;Class&gt;&gt; vec;\n</code></pre>\n\n<p>but I find, if I manipulate the vec in both thread in the same time(I can guarantee they do not visit the same area, UI Thread always read the area that has the information)</p>\n\n<p>vec.clear() seem can not release the resource. problem happend in shared_ptr, it can not release its resource.</p>\n\n<p>What is the problem?\nDoes it because when the vector reach its order capacity, it reallocates in memory, then the original part is invalidated.</p>\n\n<p>As far as I know when reallocating, iterator will be invalid, why some problem also happened when I used vec[i].\n//-----------------------------------------------</p>\n\n<p>What kinds of lock is needed?\nI mean: If the vector's element is a shared_ptr, when a thread A get the point smart_p, the other thread B will wait till A finishes the operation on smart_p right?\nOr just simply add lock when thread is trying to read the point, when the read opeation is finished, thread B can continu to do something.</p>\n"},{"tags":["c++","multithreading","posix"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":13051423,"title":"POSIX: How can I suspend thread?","body":"<p>I know some trick with condition, but it is not helpful.</p>\n\n<p>Suppose that I have infinite loop in my thread function. How can I suspend only this thread, not all process?</p>\n"},{"tags":["java","multithreading","applet"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13050912,"title":"Trying to add buttons to a java applet that bounces a ball using thread","body":"<p>I have the following program coded to add the Start and Pause buttons to an applet that bounces a ball vertically. The applet that just bounces the ball vertically works fine but when I try to add buttons, the ball is stagnant. Could anyone help? Also, I do not want to use swing or JFrames in this applet. This is just a basic thread applet.</p>\n\n<p>The code I have is as follows:</p>\n\n<pre><code>import java.applet.*;\nimport java.awt.*;\nimport java.awt.event.*;\n/* &lt;applet code=\"bounceevent\" width=500 height=500&gt;&lt;/applet&gt; */\npublic class bounceevent extends Applet implements ActionListener, Runnable\n{\n    int i,j;\n    int flag,flag1,flag2;\n    Thread t;\n    Label l1;\n    Button b1,b2;\n    public void init()\n    {\n        t=new Thread(this);\n        j=0;\n        t.start();\n        flag=0;\n        flag1=1;\n        flag2=0;\n        l1=new Label(\"Bouncer\");\n        b1=new Button(\"Start\");\n        b2=new Button(\"Pause\");\n        b1.addActionListener(this);\n        b2.addActionListener(this);\n        add(l1);\n        add(b1);\n        add(b2);\n    }\n    public void run()\n    {\n    }\n    public void actionPerformed(ActionEvent ae)\n    {\n        String action=ae.getActionCommand();\n        if(action.equals(\"Start\"))\n        {\n            b1.setEnabled(false);\n            b1.setLabel(\"Play\");\n            repaint();\n            try\n            {\n                for(;;)\n                {\n                    t.start();\n                    t.sleep(30);\n                    //System.out.println(\"Flag\" +flag+ \"Flag1\" +flag1);\n                    if(flag==0 &amp;&amp; flag1==1)\n                    {\n                        //System.out.println(\"JJJ\" +j);\n                        if(j!=200)\n                        {\n                            i=i+1;\n                            j=j+5;\n                            //System.out.println(i);\n                            //System.out.println(j);\n                            repaint();\n                        }\n                        else\n                        {\n                            flag=1;\n                            flag1=0;\n                        }\n                    }\n                    if(flag==1 &amp;&amp; flag1==0)\n                    {\n                        if(j!=0)\n                        {\n                            i=i+1;\n                            j=j-5;\n                            //System.out.println(\"poornima\");\n                            repaint();\n                        }\n                        else\n                        {\n                            flag=0;\n                            flag1=1;\n                        }\n                    }\n                }\n            }\n            catch(InterruptedException e){}\n        }\n        if(action.equals(\"Play\"))\n        {\n            resume();\n        }\n        if(action.equals(\"Pause\"))\n        {\n            b1.setEnabled(true);\n            pause();\n        }\n    }\n    synchronized public void resume()\n    {\n        flag2=0;\n        notify();\n    }\n    public void pause()\n    {\n        flag2=1;\n    }\n    public void paint(Graphics g)\n    {\n        System.out.println(\"i\" +i+ \"j\" +j);\n        g.setColor(Color.blue);\n        g.fillOval(i,j,25,25);\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading",".net-3.5"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":81,"score":4,"question_id":13039941,"title":"C# Threading - lock - how to check lock occurrences","body":"<p>Im using locking object in my application with multiple threads.</p>\n\n<p>How i can check how many times other threads tried to work on locked object, or how much time i wasted on trying to update locked object?</p>\n\n<p>My code is based on best answer here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/13003145/multiple-threads-updating-array\">Mutliple threads updating array</a></p>\n\n<p>Edit: code copied over:</p>\n\n<pre><code>float[] bestResult;\nobject sync = new Object();\n\nlock (sync) \n{\n    if (bestResult[0] &gt; calculatedData[0]) {\n        bestResult = calculatedData;\n    }\n}\n</code></pre>\n"},{"tags":["vb.net","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13047614,"title":"Limit number of running threads?","body":"<p>I have inherited some code below that works fine, the only problem is, I want to be able to limit the number of threads that run at any one time, at the moment I have around 8-10 jobs that run in parallel, I want to limit the number of threads to maybe 3 or 4 at any time, is this possible with the code below without too many changes?</p>\n\n<pre><code>Public Sub threading_Example()\n\n Dim threadList As New List(Of Thread)\n\n For n = 0 To numJobs 'about 8-10 normally\n\n     Dim new_job As New System.Threading.Thread(New System.Threading.ParameterizedThreadStart(AddressOf do_Job))\n     Dim job As New Job\n\n     'job.stuff = stuff\n\n     newJob.Start(job)\n     threadList.Add(new_job)\n\n Next\n\n For Each t As Thread In threadList\n     t.Join()\n Next\n\nEnd Sub\n\nPublic Sub do_Job(ByVal job As Object)\n   'do task \nEnd Sub\n</code></pre>\n"},{"tags":["java","multithreading","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":11987377,"title":"What is the difference between intrinsic and monitor locks in java?","body":"<p>Could someone share any code examples with these locks?</p>\n"},{"tags":["java","android","multithreading"],"answer_count":1,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":1422,"score":7,"question_id":6544192,"title":"Android thread stime,utime?","body":"<p>What does this mean and what's the difference?</p>\n\n<p><code>stime</code> and <code>utime</code> in <code>DDMS</code></p>\n"},{"tags":["java","multithreading","thread-synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":13041708,"title":"Threads Communication in Java","body":"<p>I want to have 3 threads doing a task concurrently and also I want a thread that do a scheduled task over a period of time (runs every 10 secs). But I want when the 3 threads finish to run only once the scheduled task and then I want this thread to terminate. \nWhat is the best way to implement these threads? Is the ExecutorService Interface suitable for this.</p>\n"},{"tags":["multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":11,"score":1,"question_id":13047397,"title":"several walkers walking on a grid: How to organize the threads?","body":"<p>My algorithm is processing DEMs. a DEM (Digital Elevation Model) is a representations of ground topography where elevation is known at grid nodes.</p>\n\n<p>My problem can be summarized as follows:\nQ is a queue containing nodes to visit.\nat start, the boundary of the grid is pushed in Q.</p>\n\n<pre><code>while Q is not empty, do \n   remove Node N from the top of Q\n   if N was never visited then do \n      consider the 8 neighbors of N\n      among them select the unvisited ones\n      among them select those with a higher elevation than N's\n      push these at Q's tail\n      mark N as visited\n  done\ndone\n</code></pre>\n\n<p>As described, the algorithm will mark as 'visited' every node that can be reached from the border by a continuously ascendant path. It is worth noticing that the order of processing the nodes in the queue is unimportant. Note also that some points may request a tortuous ascendant path to be reached from the border. Think for example to a cone with a furrow spiraling around it. The ridge of the furrow is such a unique and tortuous path capable of reaching the top of the cone without never descending into the furrow.</p>\n\n<p>Anyway, I want to mutithread this algorithm. I am still in the first step of wondering which is the best organization of data and threads in order to have as least pain as possible at debugging the beast when it is written.</p>\n\n<p>My first thought is to divide the grid into tiles and split the Queue in as many tiles as there is in the grid. The tiles are piled in a work-list. A few threads are parsing the work-list and grab any tile where something can be done at the moment.</p>\n\n<p>Working on a specific tile will firstly need that the tile's queue is not empty. I may also need that the neighboring tiles can be locked if the walker's tile has to visit a node at the edge of the tile.</p>\n\n<p>I am thinking that when a walker cannot lock a neighboring tile while it needs to, then it can skip to the next node in the local queue, or even the thread itself can release the tile to the work-list and seek for another tile to work on.</p>\n\n<p>My actual experience of multi-thread programming is good enough to understand that this lovely description is very likely to turn into a nightmare when I will debug it. However I am not experienced enough to evaluate the various possibilities of programming the algorithm and make a good decision, having in mind that I will not be given a month to debug a spaghetti dish. </p>\n\n<p>Thanks for reading :)</p>\n"},{"tags":["multithreading","communication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":49,"score":-2,"question_id":13028363,"title":"vb.net client multithreaded to server communication","body":"<p>My first post here, great site!\nI wanted to share a my experience with vb.net (vs2010 express :) ) in creating a client / server program that uses multiple threads on the client side.</p>\n\n<p>what is the issue there? if not using syncLock on client side in the send/receive part you could see that the response back from the server is mixed up with other thread communications.</p>\n\n<p>Create 2 seperate projects. 1 for the client and the other for the server.</p>\n\n<p>Execute the server side.\nExecute the client side.</p>\n\n<p>The client runs in a loop until you write \"bye\" in the console line.\nOn each keyboard click that you press it will create 4 threads and send the thread Id to the server. Then server will send back the thread Id that sent it.</p>\n\n<p>it the client console out you will see a message : \nthe thread id sent to server - the thread id got from server</p>\n\n<p>Notice that the following code has a variable called : withSyncLock</p>\n\n<p>Execute the client with it as TRUE , then change it to false and execute the code again.</p>\n\n<p>notice when the SyncLock is not defined the thread id that sent it is not the same thread id that server sent back.</p>\n\n<p>That give the feeling on how multiple threads act if no CS (critical segment) is defined.</p>\n\n<p>Client Side Code:</p>\n\n<p>Module Client</p>\n\n<pre><code>Imports System.Net\nImports System.Net.Sockets\n\nModule Client\n\n    Private destination As IPEndPoint = Nothing\n    Private clientSocket As Socket = Nothing\n    Private Delegate Sub SenderDelegate(ByVal withSyncLock As Boolean)\n\n    Sub Main()\n\n        Dim remoteName As String = \"localhost\"\n        Dim resolvedHost As IPHostEntry = Nothing\n\n        ' Try to resolve the remote host name or address\n        resolvedHost = Dns.GetHostEntry(remoteName)\n        Console.WriteLine(\"Client: GetHostEntry() is OK...\")\n\n\n        Dim sockType As SocketType = SocketType.Stream\n        Dim sockProtocol As ProtocolType = ProtocolType.Tcp\n\n        Dim remotePort As Integer = 5150\n\n        Dim udpConnect As Boolean = False\n\n\n        ' Try each address returned\n        Dim addr As IPAddress\n        For Each addr In resolvedHost.AddressList\n            ' Create a socket corresponding to the address family of the resolved address\n            clientSocket = New Socket(addr.AddressFamily, sockType, ProtocolType.Tcp)\n            Console.WriteLine(\"Client: Socket() is OK...\")\n\n            Try\n                ' Create the endpoint that describes the destination\n                destination = New IPEndPoint(addr, remotePort)\n                Console.WriteLine(\"Client: IPEndPoint() for the destination is OK...\")\n\n                Console.WriteLine(\"Client: Attempting connection to: {0}\", destination.ToString())\n\n                clientSocket.Connect(destination)\n                Console.WriteLine(\"Client: Connect() is OK...\")\n\n            Catch err As SocketException\n                ' Connect failed so close the socket and try the next address\n                clientSocket.Close()\n                Console.WriteLine(\"Client: Close() is OK...\")\n                clientSocket = Nothing\n            End Try\n\n        Next\n\n        Dim withSyncLock As Boolean = True\n\n        Dim clientSenderObject As New Sender(clientSocket, destination)\n        Dim senderObject As SenderDelegate\n        Dim commandString As String = Console.ReadLine()\n\n        While commandString &lt;&gt; \"bye\"\n            For counter = 0 To 4\n                senderObject = New SenderDelegate(AddressOf clientSenderObject.SendToServer)\n                senderObject.BeginInvoke(withSyncLock, Nothing, Nothing)\n            Next\n            commandString = Console.ReadLine()\n        End While\n\n        clientSenderObject.bye = True\n        senderObject = New SenderDelegate(AddressOf clientSenderObject.SendToServer)\n        senderObject.Invoke(withSyncLock)\n        clientSenderObject.clientSocket.Close()\n        Console.ReadLine()\n    End Sub\n\n    Public Function ByteArrayToObject(ByVal _ByteArray() As Byte) As Object\n        Try\n            ' convert byte array to memory stream\n            Dim _MemoryStream As New System.IO.MemoryStream(_ByteArray)\n\n            ' create new BinaryFormatter\n            Dim _BinaryFormatter As New System.Runtime.Serialization.Formatters.Binary.BinaryFormatter()\n\n            ' set memory stream position to starting point\n            _MemoryStream.Position = 0\n\n            ' Deserializes a stream into an object graph and return as a object.\n            Return _BinaryFormatter.Deserialize(_MemoryStream)\n        Catch _Exception As Exception\n            ' Error\n            Console.WriteLine(\"Exception caught in process: {0}\", _Exception.ToString())\n        End Try\n\n        ' Error occured, return null\n        Return Nothing\n    End Function\n\n\n    Public Function ObjectToByteArray(ByVal _Object As Object) As Byte()\n\n        Try\n            ' create new memory stream\n            Dim _MemoryStream As New System.IO.MemoryStream()\n\n            ' create new BinaryFormatter\n            Dim _BinaryFormatter As New System.Runtime.Serialization.Formatters.Binary.BinaryFormatter()\n\n            ' Serializes an object, or graph of connected objects, to the given stream.\n            _BinaryFormatter.Serialize(_MemoryStream, _Object)\n\n            ' convert stream to byte array and return\n            Return _MemoryStream.ToArray()\n        Catch _Exception As Exception\n            ' Error\n            Console.WriteLine(\"Exception caught in process: {0}\", _Exception.ToString())\n        End Try\n\n        ' Error occured, return null\n        Return Nothing\n\n    End Function\n\nEnd Module\n</code></pre>\n\n<p>Sender Class</p>\n\n<pre><code>Imports System.Net\nImports System.Net.Sockets\n\nPublic Class Sender\n\n    Public clientSocket As Socket\n    Public destination As IPEndPoint\n    Public bye As Boolean\n    Dim SendnReceive As New Object\n\n    Sub New(ByVal _clientSocket As Socket, ByVal _destination As IPEndPoint)\n\n        clientSocket = _clientSocket\n        destination = _destination\n    End Sub\n\n    Public Sub SendToServer(ByVal withSyncLock As Boolean)\n\n        Dim bufferSize As Integer = 256\n        Dim rc As Integer\n        Dim sendBuffer(bufferSize) As Byte\n        Dim recvBuffer(bufferSize) As Byte\n\n        If Not bye Then\n            sendBuffer = ObjectToByteArray(Threading.Thread.CurrentThread.ManagedThreadId)\n        Else\n            sendBuffer = ObjectToByteArray(\"bye\")\n        End If\n\n        ' Make sure we have a valid socket before trying to use it\n        If (Not IsNothing(clientSocket)) And (Not IsNothing(destination)) Then\n            Try\n\n                If withSyncLock Then\n                    ' Send the request to the server\n                    SyncLock SendnReceive\n                        rc = clientSocket.Send(sendBuffer)\n                        Console.WriteLine(\"Client: Send() is OK...\")\n                        Console.WriteLine(\"Client: Sent request of {0} bytes\", rc)\n\n                        ' For TCP, shutdown sending on our side since the client won't send any more data\n\n                        'clientSocket.Shutdown(SocketShutdown.Send)\n                        Console.WriteLine(\"Client: Shutdown() is OK...\")\n\n                        ' Receive data in a loop until the server closes the connection. For\n                        '    TCP this occurs when the server performs a shutdown or closes\n                        '    the socket. For UDP, we'll know to exit when the remote host\n                        '    sends a zero byte datagram.\n\n                        '   Do\n                        rc = clientSocket.Receive(recvBuffer)\n\n                        Console.WriteLine(\"Client: Receive() is OK...\")\n                        Console.WriteLine(\"Client: Read {0} bytes\", rc)\n                        '   Loop Until rc = 0\n                    End SyncLock\n                Else\n                    ' Send the request to the server\n                    'SyncLock SendnReceive\n                    rc = clientSocket.Send(sendBuffer)\n                    Console.WriteLine(\"Client: Send() is OK...\")\n                    Console.WriteLine(\"Client: Sent request of {0} bytes\", rc)\n\n                    ' For TCP, shutdown sending on our side since the client won't send any more data\n\n                    'clientSocket.Shutdown(SocketShutdown.Send)\n                    Console.WriteLine(\"Client: Shutdown() is OK...\")\n\n                    ' Receive data in a loop until the server closes the connection. For\n                    '    TCP this occurs when the server performs a shutdown or closes\n                    '    the socket. For UDP, we'll know to exit when the remote host\n                    '    sends a zero byte datagram.\n\n                    '   Do\n                    rc = clientSocket.Receive(recvBuffer)\n\n                    Console.WriteLine(\"Client: Receive() is OK...\")\n                    Console.WriteLine(\"Client: Read {0} bytes\", rc)\n                    '   Loop Until rc = 0\n                    'End SyncLock\n                End If\n\n                Dim receivedString As String\n                receivedString = ByteArrayToObject(recvBuffer)\n\n                If Not bye Then\n                    Console.WriteLine(\"sent to server : \" &amp; Threading.Thread.CurrentThread.ManagedThreadId &amp; \" - got from server : \" &amp; receivedString)\n                Else\n                    Console.WriteLine(\"what did server said to my bye ? : \" &amp; receivedString)\n                End If\n\n\n            Catch err As SocketException\n                Console.WriteLine(\"Client: Error occurred while sending or receiving data.\")\n                Console.WriteLine(\"   Error: {0}\", err.Message)\n            End Try\n        Else\n            Console.WriteLine(\"Client: Unable to establish connection to server!\")\n        End If\n\n    End Sub\n\nEnd Class\n</code></pre>\n\n<p>Server Side Code</p>\n\n<pre><code>Imports System.Net.Sockets\nImports System.Net\n\nModule Server\n    Private Delegate Sub clientRequestDelegate(ByVal clientSocket As Socket)\n\n    Sub Main()\n\n        Dim localPort As Integer = 5150\n        Dim serverSocket As Socket = Nothing\n\n        Dim localAddress As IPAddress = IPAddress.Any\n        Dim sockType As SocketType = SocketType.Stream\n        Dim sockProtocol As ProtocolType = ProtocolType.Tcp\n\n        Dim localEndPoint As IPEndPoint = New IPEndPoint(localAddress, localPort)\n\n        ' Create the server socket\n        serverSocket = New Socket(localAddress.AddressFamily, sockType, ProtocolType.Tcp)\n\n        Console.WriteLine(\"Server: Socket() is OK...\")\n\n        ' Bind the socket to the local interface specified\n        serverSocket.Bind(localEndPoint)\n        Console.WriteLine(\"Server: Bind() is OK...\")\n\n        Console.WriteLine(\"Server: {0} server socket bound to {1}\", sockProtocol.ToString(), localEndPoint.ToString())\n\n        ' set the socket to listening\n        serverSocket.Listen(1)\n        Console.WriteLine(\"Server: Listen() is OK. I'm TCP listening for connection...\")\n\n        'Dim senderAddress As IPEndPoint = New IPEndPoint(localAddress, 0)\n\n        While True\n            Dim processClientRequestDelegateObject As New clientRequestDelegate(AddressOf Receive)\n            ' Wait for a client connection\n            processClientRequestDelegateObject.BeginInvoke(serverSocket.Accept(), Nothing, Nothing)\n        End While\n\n    End Sub\n\n    Private Sub Receive(ByVal clientSocket As Socket)\n        Dim rc As Integer\n        Dim bufferSize As Integer = 256\n        Dim receiveBuffer(bufferSize) As Byte\n        Dim sendBuffer(bufferSize) As Byte\n\n        Console.WriteLine(\"Server: Accept() is OK...\")\n        Console.WriteLine(\"Server: Accepted connection from: {0}\", clientSocket.RemoteEndPoint.ToString())\n\n        ' Service clients in a loop\n        While (True)\n\n            ' Receive the request from the client in a loop until the client shuts\n            ' the connection down via a Shutdown.\n            Console.WriteLine(\"Server: Ready to receive using Receive()...\")\n\n            ' Do\n            rc = clientSocket.Receive(receiveBuffer)\n            Console.WriteLine(\"Server: Read {0} bytes\", rc)\n            'Loop Until rc = 0\n\n            Dim receivedString As String\n            Dim sendString As String\n            receivedString = ByteArrayToObject(receiveBuffer)\n\n            If receivedString.Contains(\"bye\") Then\n                sendString = \"Good Bye 2 u 2 !\"\n            Else\n                sendString = receivedString\n            End If\n\n            Console.WriteLine(\"got from client : \" &amp; receivedString)\n\n            sendBuffer = ObjectToByteArray(sendString)\n\n            ' Send the indicated number of response messages\n            Console.WriteLine(\"Server: Ready to send using Send()...\")\n            'For i = 0 To 0\n            rc = clientSocket.Send(sendBuffer)\n            Console.WriteLine(\"Server: Sent {0} bytes\", rc)\n            ' Next\n\n            If receivedString.Contains(\"bye\") Then\n                Exit While\n            End If\n        End While\n\n        clientSocket.Close()\n        Console.WriteLine(\"Server: socketClose() is OK\")\n    End Sub\n\n    Public Function ByteArrayToObject(ByVal _ByteArray() As Byte) As Object\n        Try\n            ' convert byte array to memory stream\n            Dim _MemoryStream As New System.IO.MemoryStream(_ByteArray)\n\n            ' create new BinaryFormatter\n            Dim _BinaryFormatter As New System.Runtime.Serialization.Formatters.Binary.BinaryFormatter()\n\n            ' set memory stream position to starting point\n            _MemoryStream.Position = 0\n\n            ' Deserializes a stream into an object graph and return as a object.\n            Return _BinaryFormatter.Deserialize(_MemoryStream)\n        Catch _Exception As Exception\n            ' Error\n            Console.WriteLine(\"Exception caught in process: {0}\", _Exception.ToString())\n        End Try\n\n        ' Error occured, return null\n        Return Nothing\n    End Function\n\n\n    Public Function ObjectToByteArray(ByVal _Object As Object) As Byte()\n\n        Try\n            ' create new memory stream\n            Dim _MemoryStream As New System.IO.MemoryStream()\n\n            ' create new BinaryFormatter\n            Dim _BinaryFormatter As New System.Runtime.Serialization.Formatters.Binary.BinaryFormatter()\n\n            ' Serializes an object, or graph of connected objects, to the given stream.\n            _BinaryFormatter.Serialize(_MemoryStream, _Object)\n\n            ' convert stream to byte array and return\n            Return _MemoryStream.ToArray()\n        Catch _Exception As Exception\n            ' Error\n            Console.WriteLine(\"Exception caught in process: {0}\", _Exception.ToString())\n        End Try\n\n        ' Error occured, return null\n        Return Nothing\n\n    End Function\nEnd Module\n</code></pre>\n\n<p>if you have any questions or comments, please do say.</p>\n\n<p>Thanks!</p>\n\n<p>Guy</p>\n"},{"tags":["c#","multithreading","wcf","silverlight"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":77,"score":4,"question_id":13044511,"title":"ManualResetEvent is not working with WCF and silverlight","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6147288/why-does-manualresetevent-fail-to-work-in-this-synchronous-call-using-silverligh\">Why does ManualResetEvent fail to work in this synchronous call using Silverlight 4?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a below code in MainPage.Xaml.cs</p>\n\n<pre><code> ManualResetEvent wait = new ManualResetEvent(false);\n Service1Client wcf = new Service1Client();\n wcf.DoWorkCompleted += (o, ev) =&gt;\n {\n   int s = (int)ev.Result;\n   wait.Set();\n };\n wcf.DoWorkAsync();\n wait.WaitOne();\n\n//My other part of code where I'd like the value of `int s`.\n....\n</code></pre>\n\n<p>Service1.svc.cs has the code below .</p>\n\n<pre><code>public class Service1 : IService1\n{\n  public int DoWork()\n  {\n    return 5;\n  }\n}\n</code></pre>\n\n<p>Till the <code>DoWork</code> is completed I want my code to wait so I have written this code. Though after <code>WaitOne</code> instruction (Service1.svc.cs) method <code>DoWork()</code> won't be called at all. Application will stay there only doesn't do anything. I have worked on this before in another machine in SilverLight 4 and it was working as expected. Now I'm using SilverLight 3.</p>\n"},{"tags":[".net","multithreading","vba","excel-vba","com-interop"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13014644,"title":"Excel VBA fails to call a COM method (built with .NET) that uses multithreading","body":"<p>This C# code is in a .NET 4.5 <code>ComVisible</code> assembly:</p>\n\n<h1>C# Code</h1>\n\n<pre class=\"lang-c# prettyprint-override\"><code>[InterfaceType(ComInterfaceType.InterfaceIsDual)]\n[Guid(\"22341223-9264-12AB-C1B4-B4F112014C31\")]\npublic interface IComWithTask\n{\n    void LongExecutionMethod(double x);\n    void LongExecutionMethodAsync(double x);\n}\n\n[InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]\n[Guid(\"23844123-9274-12CB-C1F4-B4F1521E4F33\")]\npublic interface IComWithTaskEvents\n{\n    void OnLongExecutionMethodComplete(double x);\n}\n\n[ClassInterface(ClassInterfaceType.None)]\n[ComSourceInterfaces(typeof(IComWithTaskEvents))]\n[Guid(\"E4F27AA4-1932-2196-1234-121CF2722C42\")]\n[ProgId(\"ComWithTask\")]\npublic class ComWithTask : IComWithTask\n{\n    [ComVisible(false)]\n    public delegate void LongExecutionMethodComplete(double x);\n    public event LongExecutionMethodComplete OnLongExecutionMethodComplete;\n\n    public void LongExecutionMethod(double x)\n    {\n        if (OnLongExecutionMethodComplete != null)\n        {\n            OnLongExecutionMethodComplete(x * x);\n        }\n    }\n\n    public void LongExecutionMethodAsync(double x)\n    {\n        Task.Factory.StartNew(state =&gt;\n        {\n            var onLongExecutionMethodComplete = OnLongExecutionMethodComplete;\n            if (onLongExecutionMethodComplete != null)\n            {\n                onLongExecutionMethodComplete(x * x);\n            }\n        }, null);\n    }\n}\n</code></pre>\n\n<p>From Excel 2010 32bit VBA, I've got the following behavior:</p>\n\n<h1>VBA Code</h1>\n\n<pre class=\"lang-vba prettyprint-override\"><code>Private WithEvents oComWithTask As ComWithTask\n\nPublic Sub Class_Initialize()\n    Set oComWithTask = New ComWithTask\nEnd Sub\n\nPublic Sub LongExecutionMethod()\n    ' Works as expected\n    Call oComWithTask.LongExecutionMethod(2)\nEnd Sub\n\nPublic Sub LongExecutionMethodAsync()\n    ' Does NOT work!\n    Call oComWithTask.LongExecutionMethodAsync(3)\nEnd Sub\n\nPrivate Sub oComWithTask_OnLongExecutionMethodComplete(ByVal x As Double)\n    MsgBox x\nEnd Sub\n</code></pre>\n\n<p>I am aware that I am spinning a thread inside .NET when calling <code>LongExecutionMethodAsync</code>, and I am aware that office applications are single threaded.</p>\n\n<p>I did find a great literature on calling COM components from .NET in a multithreaded way, but couldn't find any resource that goes the other way around, i.e. VBA calling a multithreaded .NET wrapped with COM method.</p>\n\n<blockquote>\n  <p>Any thoughts on how to make <code>LongExecutionMethodAsync</code> work with\n  multithreading and could you point me to any related resource on this\n  subject? \n  Also, do you have other suggestions for triggering async events in VBA?</p>\n</blockquote>\n"},{"tags":["c#","multithreading","file","task-parallel-library","multiprocessing"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13045996,"title":"Whether there should be a difference to copy files in parallel and not in parallel?","body":"<p>I tried to copy 200 files with both below solutions but I didn't saw the difference ( I used <code>System.Diagnostics.Stopwatch</code> to measure time). In both cases it took 8 seconds. Should not the second(Parallel) solution be faster? I thought because it is IO operations using Parallel will speed up the copy.</p>\n\n<p>What I'm missing?</p>\n\n<pre><code>// Case1 - Regular iteration\nforeach (FileInfo file in files)\n{\n    string temppath = Path.Combine(destDirName, file.Name);\n    file.CopyTo(temppath, false);\n}\n\n// Case2 - Parallel\nParallel.ForEach(files, file =&gt;\n{\n    string temppath = Path.Combine(destDirName, file.Name);\n    file.CopyTo(temppath, false);\n});\n</code></pre>\n"},{"tags":["java","python","multithreading","jcc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13046370,"title":"Can I create a new Thread inside the Java library interfaced with JCC and utterly called from Python?","body":"<p>The problem I have is the following: I have a Java library in which threads are created. I want to interface this library, and I continuously get JavaError Python exceptions.</p>\n\n<p>Is it possible to interface a thread-creating library?</p>\n"},{"tags":["c++","multithreading","pointers","thread-safety"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13034669,"title":"Null pointer check thread safety","body":"<p>I am protecting pointer with mutex for writes already like this</p>\n\n<pre><code>// thread1\nif(pointer)\n{\n   boost::mutex::scoped_lock lock(pointer_mutex);\n   if(pointer)\n      pointer-&gt;DoStuff();\n}\n\n// thread2\nif(pointer)\n{\n   boost::mutex::scoped_lock lock(pointer_mutex);\n   if(pointer)\n      pointer = anotherPointer;\n}\n\n// thread3\nif(pointer)\n{\n   boost::mutex::scoped_lock lock(pointer_mutex);\n   pointer = 0;\n}\n</code></pre>\n\n<p>i do not want want to put that mutex outside of the block, because pointer is null 99.999 of the time.</p>\n\n<p>this works fine with no crashes, but i not experienced enough declare it thread safe.</p>\n\n<p>my question is:</p>\n\n<p>Are if(pointer) pointer = 0;  pointer = anotherPointer; atomic?</p>\n\n<p>Thank you.</p>\n"},{"tags":["android","multithreading","httpresponse"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13046204,"title":"Playing with Android Http Request and Response","body":"<p>I made a test project just testing http request and response behavior, There is a simple http class extending Asynctask to make request and get response. I am performing some string manipulation on http response, there is a problem my code which is using http response is executing before getting the response from class, which results null pointer exception. So to resolve this i made a thread and all code dependent on http response put in that thread. Now every thing is working fine.But i want to know is there any other technique to handle this? or my approach is good? Please suggest.</p>\n"},{"tags":["c++","multithreading","boost","memory-leaks","boost-thread"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13045608,"title":"Boost condition timed_wait causing memory-leaks","body":"<p>I am getting a weird memory-leak issue. In the following code, <code>blockCondition</code> is <code>boost::condition</code> where lock is defined as <code>boost::mutex::scoped_lock lock(blockingMutex)</code>, where <code>blockingMutex</code> is an <code>boost::mutex</code>.</p>\n\n<pre><code>boost::xtime xt;\nboost::xtime_get(&amp;xt, 1);\nxt.sec += 10;\nif(!blockCondition.timed_wait(lock, xt))\n{\n    xt.sec += 5;\n}\n</code></pre>\n\n<p>Specifically, the line <code>if(!blockCondition.timed_wait(lock, xt))</code> uses up some extra memory, I have no clue why!</p>\n\n<p>Is there any issues in how this code is being used that could give memory-leaks. I am using the Boost with version 1.47.0. Please help!</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":72,"score":3,"question_id":13045341,"title":"Double check locking of class member in C#","body":"<p>Is it correct to use double check locking with not static fields?</p>\n\n<pre><code>class Foo\n{ \n   private SomeType member;\n   private readonly object memeberSync = new object();\n   public SomeType Memeber\n   { \n      get\n      {\n         if(member == null)\n         { \n            lock(memeberSync)\n            {\n               if(member == null)\n               {\n                  member = new SomeType();\n               } \n            }\n         }\n         return object;\n      }\n   }\n}\n</code></pre>\n"},{"tags":["c#",".net","winforms","multithreading","savefiledialog"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":1098,"score":3,"question_id":6069983,"title":"SaveFileDialog: InvalidOperationException due to \"owner\" parameter in a multi-threaded application","body":"<p>Sorry for the long post, but I tried to explain the problem very detailed so that no confusion should arise. The last sentence contains the actual question.</p>\n\n<p>I'm programming a multi-thread application with C#/.NET.</p>\n\n<p>The application consists of a main window, which visualizes data, coming from a pressure sensor. The sensor data is acquired in an own thread.</p>\n\n<p>The data is also logged in an instance of class <code>ListView</code>:</p>\n\n<p><img src=\"http://i.stack.imgur.com/iO05j.png\" alt=\"enter image description here\"></p>\n\n<p>There is the possibility to save the logged data to file on disk via a \"Save\" button (should open an instance of .NET class <code>SaveFileDialog</code>).</p>\n\n<p>This <code>SaveFileDialog</code> is also running in an own thread.\nNow there's a problem when calling the method <code>SaveFileDialog.ShowDialog()</code>:</p>\n\n<blockquote>\n  <p>System.InvalidOperationException was unhandled\n        Message=\"Cross-thread operation not valid: Control 'tlpMain' accessed from a thread other than the thread it was created on.\"\n        Source=\"System.Windows.Forms\"</p>\n</blockquote>\n\n<p>The problem arises because the owner (the main window) of the <strong>SaveFileDialog</strong> is running in another thread.</p>\n\n<p>Here's the code, which creates the thread for the SaveFileDialog():</p>\n\n<pre><code>private void bSave_Click(object sender, EventArgs e)\n{\n    Thread saveFileDialog = new Thread(OpenSaveFileDialog);\n    saveFileDialog.SetApartmentState(ApartmentState.STA);\n    saveFileDialog.Start();\n}\n</code></pre>\n\n<p>Code for method OpenSaveFileDialog():</p>\n\n<pre><code>private void OpenSaveFileDialog()\n{\n    SaveFileDialog saveFileDialog = new SaveFileDialog();\n    saveFileDialog.Filter = \"Text Files (*.txt)|*.txt|CSV (*.csv)|*.csv|All Files (*.*)|*.*\";\n    saveFileDialog.FilterIndex = 0;\n\n    /* Call \"ShowDialog\" with an owner (\"this.Parent\") to achieve, so that\n     * the parent window is blocked and \"unclickable\".\n     * \n     * Danger of an \"InvalidOperationException\" because \"this.Parent\" control\n     * is running (was created) in another thread.\n     * But \"this.Parent\" should not be modified by this method call.\n     */\n    DialogResult pressedButton = saveFileDialog.ShowDialog(this.Parent);\n    ...\n</code></pre>\n\n<p>The <strong>InvalidOperationException</strong> is only thrown/displayed when running the application with Visual Studio's debugger. It is no problem - so far - when running the application \"normally\".</p>\n\n<p>But I would like to avoid this problem.</p>\n\n<p>I tried to build a wrapper method (SaveFileDialog):</p>\n\n<pre><code>private void OpenSaveFileDialog()\n{\n    SaveFileDialog saveFileDialog = new SaveFileDialog();\n    ...\n    SaveFileDialog(saveFileDialog, this.Parent);\n}\n</code></pre>\n\n<p>Wrapper method :</p>\n\n<pre><code>private void SaveFileDialog(SaveFileDialog saveFileDialog, Control owner)\n{\n    if (owner.InvokeRequired)\n        BeginInvoke(new dSaveFileDialog(SaveFileDialog), new object[] { saveFileDialog, owner });\n    else\n    {\n        DialogResult pressedButton = saveFileDialog.ShowDialog(owner);\n        ...\n</code></pre>\n\n<p>This leads to a <code>TargetInvocationException</code> although the <code>Main()</code> method is labeled with <code>[STAThreadAttribute]</code>:</p>\n\n<blockquote>\n  <p>InnerException: System.Threading.ThreadStateException\n         Message=\"Current thread must be set to single thread apartment (STA) mode before OLE calls can be made. Ensure that your Main function has STAThreadAttribute marked on it. This exception is only raised if a debugger is attached to the process.\"\n         Source=\"System.Windows.Forms\"</p>\n</blockquote>\n\n<p>Does anybody have a clue how to open the <code>SaveFileDialog</code> in a way, so that the main window will be blocked (\"unclickable\") without having the (thread) trouble?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","multithreading","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13043934,"title":"Multi-Threading a Task","body":"<p>Is there a way to multi-thread this method? The problem that I can see is that the only shared state is the cloning of the image source which takes up about half of the method time. There are about 5 to 10 thousand recipients in the list.</p>\n\n<p>I've tried a ConcurrentQueue with one action added clones and another TryDequeue and processing them but over 500 items it only saves 7 seconds. Is there a way to have the imgSrc roll back or undo the changes so it doesn't have to create a new clone?</p>\n\n<pre><code>    public static void CreateImages(string fileSrc, string pathDestination, IEnumerable&lt;Recipient&gt; recipients)\n    {\n        var sfCenter = new StringFormat();\n        sfCenter.Alignment = StringAlignment.Center;\n        sfCenter.LineAlignment = StringAlignment.Center;\n\n        using (var imgSrc = new System.Drawing.Bitmap(fileSrc))\n        {\n            foreach (var rec in recipients)\n            {\n                using (var imgCopy = imgSrc.Clone() as Bitmap)\n                using (var graphicImage = Graphics.FromImage(imgCopy))\n                {\n                    graphicImage.SmoothingMode = SmoothingMode.AntiAlias;\n                    graphicImage.DrawString(rec.Name, new Font(\"Arial\", 16, FontStyle.Bold), Brushes.Black, new Rectangle(170, 105, 650, 50), sfCenter);\n                    // plus other activity\n                    var fileOut = pathDestination + rec.ID + \".jpg\";\n                    imgCopy.Save(fileOut, ImageFormat.Jpeg);\n                }\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["c#","winforms","multithreading","gui"],"answer_count":20,"favorite_count":104,"up_vote_count":118,"down_vote_count":1,"view_count":108355,"score":117,"question_id":661561,"title":"How to update the GUI from another thread in C#?","body":"<p>What is the simplest way to update a label from another thread?</p>\n\n<p>My problem: I have a winform(thread1), from that I'm starting another thread(thread2).\nWhile thread2 is processing some files, I would like to update a label on the winform with status from thread2.</p>\n\n<p>How can I do that?</p>\n"},{"tags":["python","multithreading","eventlet"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":157,"score":2,"question_id":12996254,"title":"What are the advantages of multithreaded programming in Python?","body":"<p>When I hear about multithreaded programming, I think about the opportunity to accelerate my program, but it is not?</p>\n\n<pre><code>import eventlet\nfrom eventlet.green import socket\nfrom iptools import IpRangeList\n\n\nclass Scanner(object):\n    def __init__(self, ip_range, port_range, workers_num):\n        self.workers_num = workers_num or 1000\n        self.ip_range = self._get_ip_range(ip_range)\n        self.port_range = self._get_port_range(port_range)\n        self.scaned_range = self._get_scaned_range()\n\n    def _get_ip_range(self, ip_range):\n        return [ip for ip in IpRangeList(ip_range)]\n\n    def _get_port_range(self, port_range):\n        return [r for r in range(*port_range)]\n\n    def _get_scaned_range(self):\n        for ip in self.ip_range:\n            for port in self.port_range:\n                yield (ip, port)\n\n    def scan(self, address):\n        try:\n            return bool(socket.create_connection(address))\n        except:\n            return False\n\n    def run(self):\n        pool = eventlet.GreenPool(self.workers_num)\n        for status in pool.imap(self.scan, self.scaned_range):\n            if status:\n                yield True\n\n    def run_std(self):\n        for status in map(self.scan, self.scaned_range):\n            if status:\n                yield True\n\n\nif __name__ == '__main__':\n    s = Scanner(('127.0.0.1'), (1, 65000), 100000)\n    import time\n    now = time.time()\n    open_ports = [i for i in s.run()]\n    print 'Eventlet time: %s (sec) open: %s' % (now - time.time(),\n                                                len(open_ports))\n    del s\n    s = Scanner(('127.0.0.1'), (1, 65000), 100000)\n    now = time.time()\n    open_ports = [i for i in s.run()]\n    print 'CPython time: %s (sec) open: %s' % (now - time.time(),\n                                                len(open_ports))\n</code></pre>\n\n<p>and <strong>results:</strong></p>\n\n<pre><code>Eventlet time: -4.40343403816 (sec) open: 2\nCPython time: -4.48356699944 (sec) open: 2\n</code></pre>\n\n<p>And my question is, if I run this code is not on my laptop but on the server and set more value of workers it will run faster than the CPython's version?\nWhat are the advantages of threads?</p>\n\n<p><strong>ADD:</strong>\nAnd so I rewrite app with use original cpython's threads</p>\n\n<pre><code>import socket\nfrom threading import Thread\nfrom Queue import Queue\n\nfrom iptools import IpRangeList\n\nclass Scanner(object):\n    def __init__(self, ip_range, port_range, workers_num):\n        self.workers_num = workers_num or 1000\n        self.ip_range = self._get_ip_range(ip_range)\n        self.port_range = self._get_port_range(port_range)\n        self.scaned_range = [i for i in self._get_scaned_range()]\n\n    def _get_ip_range(self, ip_range):\n        return [ip for ip in IpRangeList(ip_range)]\n\n    def _get_port_range(self, port_range):\n        return [r for r in range(*port_range)]\n\n    def _get_scaned_range(self):\n        for ip in self.ip_range:\n            for port in self.port_range:\n                yield (ip, port)\n\n    def scan(self, q):\n        while True:\n            try:\n                r = bool(socket.create_conection(q.get()))\n            except Exception:\n                r = False\n            q.task_done()\n\n    def run(self):\n        queue = Queue()\n        for address in self.scaned_range:\n                queue.put(address)\n        for i in range(self.workers_num):\n                worker = Thread(target=self.scan,args=(queue,))\n                worker.setDaemon(True)\n                worker.start()\n        queue.join()\n\n\nif __name__ == '__main__':\n    s = Scanner(('127.0.0.1'), (1, 65000), 5)\n    import time\n    now = time.time()\n    s.run()\n    print time.time() - now\n</code></pre>\n\n<p>and result is</p>\n\n<pre><code> Cpython's thread: 1.4 sec\n</code></pre>\n\n<p>And I think this is a very good result. I take as a standard nmap scanning time:</p>\n\n<pre><code>$ nmap 127.0.0.1 -p1-65000\n\nStarting Nmap 5.21 ( http://nmap.org ) at 2012-10-22 18:43 MSK\nNmap scan report for localhost (127.0.0.1)\nHost is up (0.00021s latency).\nNot shown: 64986 closed ports\nPORT      STATE SERVICE\n53/tcp    open  domain\n80/tcp    open  http\n443/tcp   open  https\n631/tcp   open  ipp\n3306/tcp  open  mysql\n6379/tcp  open  unknown\n8000/tcp  open  http-alt\n8020/tcp  open  unknown\n8888/tcp  open  sun-answerbook\n9980/tcp  open  unknown\n27017/tcp open  unknown\n27634/tcp open  unknown\n28017/tcp open  unknown\n39900/tcp open  unknown\n\nNmap done: 1 IP address (1 host up) scanned in 0.85 seconds\n</code></pre>\n\n<p>And my question is now: how threads implemented in Eventlet as I can understand this is not threads but something special for Eventlet and why they dont speed up tasks?</p>\n\n<p>Eventlet is used by many of the major projects like OpenStack and etc. \nBut why? Just do the heavy queries to a DB in asynchronous manner or something else?</p>\n"},{"tags":["c++","c","windows","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":13043124,"title":"How to call 3 threads sequentially many times?","body":"<p>How to call 3 threads sequentially many times? For example: In iteration 1, execution order should be \"Thread0->thread1->thread2\" then in iteration 2 should be same i.e \"Thread0 -> thread1->thread2\" and so on. The sample code is just executing 3 threads only once. It is not going to 2nd iteration.</p>\n\n<pre><code>    Thread0 = CreateThread( NULL,0,ThreadProc0, NULL, CREATE_SUSPENDED, &amp;ThreadID);\n    Thread1 = CreateThread( NULL,0,ThreadProc1, NULL, CREATE_SUSPENDED, &amp;ThreadID);\n    Thread2 = CreateThread( NULL,0,ThreadProc2, NULL, CREATE_SUSPENDED, &amp;ThreadID);\n\n    for(i=0;i&lt;iterations;i++)                //Iterations in calling threads\n    {\n        ResumeThread(Thread0);\n        WaitForSingleObject(Thread0, INFINITE);\n        ResumeThread(Thread1);\n        WaitForSingleObject(Thread1, INFINITE);\n        ResumeThread(Thread2);\n        WaitForSingleObject(Thread2, INFINITE);\n    }\n\n    // Close thread and semaphore handles\n</code></pre>\n"},{"tags":["php","multithreading","apache","cli"],"answer_count":9,"favorite_count":17,"up_vote_count":45,"down_vote_count":0,"view_count":36712,"score":45,"question_id":209774,"title":"Does PHP have threading?","body":"<p>I found this <a href=\"http://pecl.php.net/package/threads\" rel=\"nofollow\">PECL package called threads</a>, but there is not a release yet. And nothing is coming up on the PHP website.</p>\n"},{"tags":["php","multithreading","zend-framework"],"answer_count":8,"favorite_count":6,"up_vote_count":16,"down_vote_count":0,"view_count":11095,"score":16,"question_id":2585656,"title":"Threads in PHP","body":"<p>I am creating a web application using zend, here i create an interface from where user-A can send email to more than one user(s) &amp; it works excellent but it slow the execution time because of which user-A wait too much for the \"acknowledged response\" ( which will show after the emails have sent. )</p>\n\n<p>In Java there are \"Threads\" by which we can perform that task (send emails) &amp; it does not slow the rest application.</p>\n\n<p>Is there any technique in PHP/Zend just like in Java by which we can divide our tasks which could take much time eg: sending emails.</p>\n\n<p>Thanks..</p>\n"},{"tags":["iphone","objective-c","ios","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":13023332,"title":"How can one thread determine if a different thread has crashed?","body":"<p>I have a background thread that is doing a bunch of work - loading the application.  The main thread is displaying progress on a UIProgressView.</p>\n\n<p>The background thread is being spawned with performSelectorInBackground (though, I'm not wed to this method if a different approach makes this problem easier to solve)</p>\n\n<pre><code>[self performSelectorInBackground:@selector(loadAppInBackground) withObject:self];\n</code></pre>\n\n<p>On a couple occasions a bug has caused the background thread to crash (different bugs as the app evolves) which results in the progress bar stopping, but the user getting no clear indication that anything is wrong.</p>\n\n<p>I'd like to detect this situation and fail more gracefully than simply hanging until the user gives up on waiting.</p>\n\n<p>Because the duration of the load process can vary greatly, simply timing out isn't an ideal option.</p>\n\n<p>What's the best way for the foreground thread to detect that the background thread has failed?  Since the foreground thread is busy dealing with the UI, would it require a second background thread to monitor the first?  That seems ugly.  Either way, what's the best mechanism to check the status of another thread?  Is there some thread-to-thread communication mechanism that could be used to \"ping\" the background process?</p>\n"},{"tags":["ios","multithreading","uiimageview","afnetworking","afjsonrequestoperation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":44,"score":-1,"question_id":13041281,"title":"Issue accessing UIImage outside of AFImageRequestOperation ImageRequestOperationWithRequest: success block","body":"<p>I'm trying to display an image returned from AFImageRequestOperation ImageRequestOperationWithRequest: but it appears that the image is only available inside the success block. I've tried saving it to a class instance variable but when I NSLog it, it shows up as null. However, when I NSLog the same instance variable inside the success block, after setting it with the retrieved UIImage, it actually shows a hexadecimal value (as expected). Any help here is greatly appreciated. </p>\n\n<p>Here's the code where issue occurs:</p>\n\n<pre><code>imageRequest = [AFImageRequestOperation imageRequestOperationWithRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:urlString]] success:^(UIImage *image) {\n    globalImage = image; // trying to have accessible image outside of success handler\n    [self setImageThumbImage:image]; trying to set image that class will use \n    NSLog(@\"Image is: %@\", self.albumThumbImage); // logs an actual value\n    imageRequest = nil;\n}];\n\n[albumImageRequest start];\nNSLog(@\"The second albumThumbImage retrieval returns: %@\", globalImage); // logs null\n\nreturn self;\n\n}\n</code></pre>\n"},{"tags":["java","multithreading","sockets","networking","udp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":13040381,"title":"Sending and receiving an acknowledgement using Datagram UDP","body":"<p>I'm new to socket programming and programming a Java UDP simple client-server application. I'm writing a time/date server client. The client can ask the server for the time and date and it waits for a response. Also, every minute, the server updates all clients with the current time. The client needs to </p>\n\n<ol>\n<li><p>be able to initiate contact with the server and wait for a message back</p></li>\n<li><p>listen for periodic updates from the server</p></li>\n</ol>\n\n<p>How can I do this using a single DatagramSocket?</p>\n\n<p>I was thinking of creating two threads: one that listens and one that writes. The problem is that in the case that the client initiates contact with the server, it needs to wait to receive an acknowledgement from the server. So, the writing thread also needs to listen for packets from the server sometimes. But in this case, I have two threads listening and the wrong thread will get the acknowledgement.</p>\n\n<p>Is there a way to specify which thread gets the input? Or is there some other way to solve this problem?</p>\n\n<p>I've been searching for this answer but unable to find it. The closest I've found is <a href=\"http://stackoverflow.com/questions/8449064/java-sockets-can-you-send-from-one-thread-and-receive-on-another\">Java sockets: can you send from one thread and receive on another?</a></p>\n"},{"tags":["objective-c","ios","multithreading","uiimage","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13041041,"title":"setImage: forState: lagging the UI","body":"<p>I have a tableview which runs some code for fetching a UIImage from NSData in a background thread, then in the foreground it calls <code>[button setImage:image forState:UIControlStateNormal];</code>.</p>\n\n<p>The problem is that it freezes the UI for a split second on that line, until it's complete. This means that the UI freezes while it sets it as the image. Because the user is scrolling, this is very noticeable and jittery. Is there any way to avoid my UI from freezing like this?</p>\n\n<pre><code>dispatch_queue_t cellSetupQueue = dispatch_queue_create(\"Setup\", NULL);\ndispatch_async(cellSetupQueue, ^{\n    UIImage *image = [self.mediaDelegate largeThumbnailForMediaAtIndex:indexPath.row];\n    dispatch_async(dispatch_get_main_queue(), ^{     \n        [self.thumbnailButton setImage:image forState:UIControlStateNormal];\n    });\n});\n\ndispatch_release(cellSetupQueue);\n</code></pre>\n"},{"tags":["java","multithreading","command-line","command-prompt"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13040946,"title":"return to command line when program output is done","body":"<p>Wrote a multi-thread program to print out odd and even numbers in sequence untill the sequence reached 30.</p>\n\n<pre><code>import java.util.concurrent.Executor;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class NumPrintTX\n{\npublic static void main(String[] args)\n{\n    final int max = 31;\n    final AtomicInteger i = new AtomicInteger(0);\n    Executor dd = Executors.newFixedThreadPool(2);\n\n    final Object lock = new Object();\n\n    dd.execute(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            while (i.get() &lt; max)\n            {\n                if (i.get() % 2 == 0)\n                {\n                    System.out.print(\" \" + i.getAndAdd(1));\n\n                    synchronized(lock)\n                    {\n                        lock.notify();\n                    }\n                }\n                else\n                {\n                    synchronized(lock)\n                    {\n                        try\n                        {\n                            lock.wait();\n                        }\n                        catch (InterruptedException e)\n                        {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                    }\n                }\n            }\n        }\n    });\n    dd.execute(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            while (i.get() &lt; max)\n            {\n                if (i.get() % 2 != 0)\n                {\n                    System.out.print(\" \" + i.getAndAdd(1));\n\n                    synchronized(lock)\n                    {\n                        lock.notify();\n                    }\n                }\n                else\n                {\n                    synchronized(lock)\n                    {\n                        try\n                        {\n                            lock.wait();\n                        }\n                        catch (InterruptedException e)\n                        {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                    }\n                }\n            }\n        }\n    });\n    do\n    {\n        try \n        {\n            Thread.currentThread().sleep(1000);\n            }\n        catch (InterruptedException e)\n        {\n            e.printStackTrace();\n        }\n    }\n    while (i.get() != max);\n}\n}\n</code></pre>\n\n<p>when the program runs, it comes out just fine, but it won't go to the next line so i could enter another command for whatever i want to do next.  Any ideas why this is and what i can do to fix it?</p>\n\n<p>modified code:\n    import java.util.concurrent.Executor;\n    import java.util.concurrent.Executors;\n    import java.util.concurrent.atomic.AtomicInteger;</p>\n\n<pre><code>public class NumPrintTX\n{\npublic static void main(String[] args)\n{\n    final int max = 31;\n    final AtomicInteger i = new AtomicInteger(0);\n    Executor dd = Executors.newFixedThreadPool(2);\n\n    final Object lock = new Object();\n\n    dd.execute(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            while (i.get() &lt; max)\n            {\n                if (i.get() % 2 == 0)\n                {\n                    System.out.print(\" \" + i.getAndAdd(1));\n\n                    synchronized(lock)\n                    {\n                        lock.notify();\n                    }\n                }\n                else\n                {\n                    synchronized(lock)\n                    {\n                        try\n                        {\n                            lock.wait();\n                        }\n                        catch (InterruptedException e)\n                        {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                    }\n                }\n            }\n        }\n    });\n    dd.execute(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            while (i.get() &lt; max)\n            {\n                if (i.get() % 2 != 0)\n                {\n                    System.out.print(\" \" + i.getAndAdd(1));\n\n                    synchronized(lock)\n                    {\n                        lock.notify();\n                    }\n                }\n                else\n                {\n                    synchronized(lock)\n                    {\n                        try\n                        {\n                            lock.wait();\n                        }\n                        catch (InterruptedException e)\n                        {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                    }\n                }\n            }\n        }\n    });\n    do\n    {\n        try \n        {\n            Thread.currentThread().sleep(1000);\n            }\n        catch (InterruptedException e)\n        {\n            e.printStackTrace();\n        }\n    }\n    while (i.get() != max);\n}\npublic void close()\n{\nSystem.exit(0);\n}\n}\n</code></pre>\n"},{"tags":["python","multithreading","gevent"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":86,"score":3,"question_id":13040458,"title":"Why is `gevent.spawn` different than a monkeypatched `threading.Thread()`?","body":"<p>While double checking that <code>threading.Condition</code> is correctly monkey patched, I noticed that a monkeypatched <code>threading.Thread(…).start()</code> behaves differently from <code>gevent.spawn(…)</code>.</p>\n\n<p>Consider:</p>\n\n<pre><code>from gevent import monkey; monkey.patch_all()\nfrom threading import Thread, Condition\nimport gevent\n\ncv = Condition()\n\ndef wait_on_cv(x):\n    cv.acquire()\n    cv.wait()\n    print \"Here:\", x\n    cv.release()\n\n# XXX: This code yields \"This operation would block forever\" when joining the first thread\nthreads = [ gevent.spawn(wait_on_cv, x) for x in range(10) ]\n\n\"\"\"\n# XXX: This code, which seems semantically similar, works correctly\nthreads = [ Thread(target=wait_on_cv, args=(x, )) for x in range(10) ]\nfor t in threads:\n    t.start()\n\"\"\"\n\ncv.acquire()\ncv.notify_all()\nprint \"Notified!\"\ncv.release()\n\nfor x, thread in enumerate(threads):\n    print \"Joining\", x\n    thread.join()\n</code></pre>\n\n<p>Note, specifically, the two comments starting with <code>XXX</code>.</p>\n\n<p>When using the first line (with <code>gevent.spawn</code>), the first <code>thread.join()</code> raises an exception:</p>\n\n<pre>\nNotified!\nJoining 0\nTraceback (most recent call last):\n  File \"foo.py\", line 30, in \n    thread.join()\n  File \"…/gevent/greenlet.py\", line 291, in join\n    result = self.parent.switch()\n  File \"…/gevent/hub.py\", line 381, in switch\n    return greenlet.switch(self)\ngevent.hub.LoopExit: This operation would block forever\n</pre>\n\n<p>However, <code>Thread(…).start()</code> (the second block), everything works as expected.</p>\n\n<p>Why would this be? What's the difference between <code>gevent.spawn()</code> and <code>Thread(…).start()</code>?</p>\n"},{"tags":["multithreading","perl"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":142,"score":6,"question_id":13040333,"title":"What perl built in functions are atomic?","body":"<p>I'm writing some threaded code and I'm wondering what Perl built in functions and operators are atomic and safe to use on a shared variable without locking.  For example, I've been told <code>++</code>, <code>--</code>, <code>+=</code> and the like are not because they are implemented as two operations.</p>\n\n<p>Is there a list somewhere?  In particular are <code>push</code>, <code>pop</code>, <code>shift</code>, <code>unshift</code> and <code>splice</code> on a shared array atomic?</p>\n\n<p>Thanks.</p>\n"},{"tags":["objective-c","multithreading","blocks"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13039102,"title":"How do I deal with arbitrary signatures in Objective-C blocks?","body":"<p><strong>How do I refactor arbitrary blocks?</strong></p>\n\n<p>I have two functions with vastly different signatures that I would like to pass as a block so that I can ensure thread-safety, since setenv() and unsetenv() are not guaranteed to be thread-safe:</p>\n\n<p><strong>Old Code</strong></p>\n\n<pre><code>-(X*)foo1\n{\n  X* x;\n  @synchronized( self )\n  {\n    setenv( ... );\n    x = worker_1( ... );\n    unsetenv( ... );\n  }\n  return x;\n}\n\n-(Y*)foo2\n{\n  Y* y;\n  @synchronized( self )\n  {\n    setenv( ... );\n    y = worker_2( ... );\n    unsetenv( ... );\n  }\n  return y;\n}\n</code></pre>\n\n<p>Note that the two chunks of code are <strong>identical</strong> except that the signatures to worker_1() and worker_2() are vastly different.</p>\n\n<p>In other words, I need to refactor the <strong>same wrappers</strong>, but <strong>completely different guts returning arbitrary objects</strong>.</p>\n\n<p><strong>New Code</strong></p>\n\n<pre><code>- (void)aThreadSafeWrapper:my_block  // broken: needs fixing\n{\n    @synchronized( self )\n    {\n       setenv( ... );\n       my_block();                   // broken: needs fixing\n       unsetenv( ... );\n    }\n}\n</code></pre>\n\n<p><em>Is there any way I can accomplish this refactoring in Objective-C?</em></p>\n"},{"tags":["java","multithreading","concurrency","pthreads","javac"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":13018486,"title":"Concurrency: Cache Coherence Issue or Compiler Optimization?","body":"<p>From my understanding, if Hardware supports Cache coherence on a multi-processor system, then writes to a shared variable will be visible to threads running on other processors. In order to test this, I wrote a simple program in Java and pThreads to test this </p>\n\n<pre><code>public class mainTest {\n\n    public static int i=1, j = 0;\n    public static void main(String[] args) {\n\n    /*\n     * Thread1: Sleeps for 30ms and then sets i to 1\n     */\n    (new Thread(){\n        public void run(){\n            synchronized (this) {\n                try{\n                       Thread.sleep(30);\n                       System.out.println(\"Thread1: j=\" + mainTest.j);\n                       mainTest.i=0;\n                   }catch(Exception e){\n                       throw new RuntimeException(\"Thread1 Error\");\n                }\n            }\n        }\n    }).start();\n\n    /*\n     * Thread2: Loops until i=1 and then exits.\n     */\n    (new Thread(){\n        public void run(){\n            synchronized (this) {\n                while(mainTest.i==1){\n                    //System.out.println(\"Thread2: i = \" + i); Comment1\n                    mainTest.j++;\n                }\n                System.out.println(\"\\nThread2: i!=1, j=\" + j);\n            }\n        }\n    }).start();\n\n   /*\n    *  Sleep the main thread for 30 seconds, instead of using join. \n    */\n    Thread.sleep(30000);\n    }\n}\n\n\n\n\n/* pThreads */\n\n#include&lt;stdio.h&gt;\n#include&lt;pthread.h&gt;\n#include&lt;assert.h&gt;\n#include&lt;time.h&gt;\n\nint i = 1, j = 0;\n\nvoid * threadFunc1(void * args) {\n    sleep(1);\n    printf(\"Thread1: j = %d\\n\",j);\n    i = 0;\n}\n\nvoid * threadFunc2(void * args) {\nwhile(i == 1) {\n        //printf(\"Thread2: i = %d\\n\", i);\n        j++;\n    }\n}\n\nint main() {\n    pthread_t t1, t2;\n    int res;\n    printf(\"Main: creating threads\\n\");\n\n    res = pthread_create(&amp;t1, NULL, threadFunc1, \"Thread1\"); assert(res==0);\n    res = pthread_create(&amp;t2, NULL, threadFunc2, \"Thread2\"); assert(res==0);\n\n    res = pthread_join(t1,NULL); assert(res==0);\n    res = pthread_join(t2,NULL); assert(res==0);\n\n    printf(\"i = %d\\n\", i);\n    printf(\"Main: End\\n\");\n    return 0;\n}    \n</code></pre>\n\n<p>I noticed that the pThread program always ends. (I tested it for different sleep times for thread1). However the Java program ends only a very few times; does not end most of the times.\nIf I uncomment the Comment1 in java program, then it ends all the time. Also if I use volatile, then it ends for java in all cases.</p>\n\n<p>So my confusion is, </p>\n\n<ol>\n<li><p>if cache coherence is done in hardware, then 'i=0' should be visible to other threads unless \ncompiler optimized the code. But if compiler optimized the code, then I don't understand why the thread ends sometimes and doesn't sometimes. Also adding a System.out.println seems to change the behavior. </p></li>\n<li><p>Can anyone see a compiler optimization that Java does (which is not done by C compiler), which is causing this behavior?</p></li>\n<li><p>Is there something additional that the Compiler has to do, to get Cache coherence even if the hardware already supports it? (like enable/disable)</p></li>\n<li><p>Should I be using Volatile for all shared variables by default?</p></li>\n</ol>\n\n<p>Am I missing something? Any additional comments are welcome.</p>\n"},{"tags":["c++","arrays","multithreading","shared-memory"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":13027351,"title":"c++ lockless c-style shared array (for adding elements)","body":"<p>is there a known, working code to add elements to a shared, initialized c-style array (of objects) in multiple threads simultaneously without having to use lock on that resource? i mean, to a continuous memory block where elements are not linked by pointers.</p>\n\n<p>i mean, algorithm, not libraries etc.\ni just want to fill an array with elements in, say, 20 threads without locks or having to specify array ranges for threads where to fill (much like lockfree linked lists).</p>\n\n<p>im using slackware 13.37 64 bit, pthreads, intel c++ compiler, tcmalloc allocator.</p>\n\n<p>update : thanks guys for your answers, you all have been helpful with your ideas; if i could, i would mark all your ideas as answers. however, im still struggling with my code. so ill put the code up later in another thread to see whats happening exactly with my code, so people could really focus.</p>\n"},{"tags":["c++","multithreading","winapi","object","inheritance"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13039559,"title":"Creating thread in the base class which run a method from the subclasses","body":"<p>I don't know if this this even possible but I have an idea of creating an abstract class to make threads using WinAPI. This class would be inheritaded by class which will define the function to execute in the thread.</p>\n\n<p>I have two classes:</p>\n\n<pre><code>class XYZ{\n//...\n\nclass ABC: public XYZ{\n//...\n</code></pre>\n\n<p>And i have a construct</p>\n\n<pre><code>ABC::ABC()\n{\n    addThread(this,1);\n}\n</code></pre>\n\n<p>addThread is defined inside XYZ class:</p>\n\n<pre><code>void addThread(void* self, int a)\n{\n    DWORD ThreadID;\n    THREAD_DATA *threadData;\n    threadData-&gt;self = self;\n    threadData-&gt;thread_id = a;\n    CreateThread(NULL, 0, createThread, threadData, 0, &amp;ThreadID);\n}\n</code></pre>\n\n<p>As you can see i am creating a structure which contains two fields: object of the superclasses and the number of thread (so the method can know which data use).</p>\n\n<p>This is how the structure looks like:</p>\n\n<pre><code>typedef struct _THREAD_DATA {\nvoid*       self;\nint     thread_id;\n} THREAD_DATA;\n</code></pre>\n\n<p>The createThread in an static method of XYZ class:</p>\n\n<pre><code>static DWORD WINAPI createThread(void* _threadData)\n{\n    THREAD_DATA* threadData = (THREAD_DATA*) _threadData;\n    return threadData-&gt;self-&gt;execute(threadData-&gt;thread_id);\n}\n</code></pre>\n\n<p>And here is the place where everything goes wrong.\nMy VSC++ 2010 is underlining the first word \"threadDataself\" in the second line of the static method body. <strong>After compilation I get an error:</strong></p>\n\n<blockquote>\n  <p>left of '->execute' must point to class/struct/union/generic type</p>\n</blockquote>\n\n<p>I have no idea how to fix it. I wrote this code using those links:\n<a href=\"http://goo.gl/7VYC3\" rel=\"nofollow\">http://goo.gl/7VYC3</a> &amp; <a href=\"http://goo.gl/ETfe7\" rel=\"nofollow\">http://goo.gl/ETfe7</a></p>\n\n<p>The execute method is decalared in the XYZ class as:</p>\n\n<pre><code>virtual DWORD execute(int i);\n</code></pre>\n\n<p>and then defined in the ABC class as</p>\n\n<pre><code>DWORD ABC::execute(int i){\n//...\n</code></pre>\n\n<p>Can anyone please help me? I would appreciate any tips how to make this works.</p>\n"}]}
{"total":30059,"page":9,"pagesize":100,"questions":[{"tags":["c++","multithreading","boost-thread","boost-mutex"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":13031720,"title":"multithreaded program producer/consumer [boost]","body":"<p>I'm playing with boost library and C++. I want to create a multithreaded program that contains a producer, conumer, and a stack. The procuder fills the stack, the consumer remove items (int) from the stack. everything work (pop, push, mutex) But when i call the pop/push winthin a thread, i don't get any effect </p>\n\n<p>i made this simple code  : </p>\n\n<pre><code>#include \"stdafx.h\"\n#include &lt;stack&gt;\n#include &lt;iostream&gt;\n#include &lt;algorithm&gt;\n#include &lt;boost/shared_ptr.hpp&gt;\n#include &lt;boost/thread.hpp&gt;\n#include &lt;boost/date_time.hpp&gt; \n#include &lt;boost/signals2/mutex.hpp&gt;\n#include &lt;ctime&gt;\n\nusing namespace std;\n\n/ *\n* this class reprents a stack which is proteced by mutex\n* Pop and push are executed by one thread each time.\n*/\nclass ProtectedStack{\nprivate : \nstack&lt;int&gt; m_Stack;\nboost::signals2::mutex m;\n\npublic : \nProtectedStack(){\n}\nProtectedStack(const ProtectedStack &amp; p){\n\n}\nvoid push(int x){\n    m.lock();\n    m_Stack.push(x);\n    m.unlock();\n}\n\nvoid pop(){\n    m.lock();\n    //return m_Stack.top();\n    if(!m_Stack.empty())\n        m_Stack.pop();\n    m.unlock(); \n}\nint size(){\n    return m_Stack.size();\n}\nbool isEmpty(){\n    return m_Stack.empty();\n}\nint top(){\n    return m_Stack.top();\n}\n};\n\n/*\n*The producer is the class that fills the stack. It encapsulate the thread object \n*/\n\nclass Producer{\npublic:\nProducer(int number ){\n    //create thread here but don't start here\nm_Number=number;\n\n\n}\nvoid fillStack (ProtectedStack&amp; s ) {\n    int object = 3; //random value\n    s.push(object);\n    //cout&lt;&lt;\"push object\\n\";\n}\n\nvoid produce (ProtectedStack &amp; s){\n    //call fill within a thread \n    m_Thread = boost::thread(&amp;Producer::fillStack,this, s);  \n}\n\n private :\nint m_Number;\nboost::thread m_Thread;\n\n};\n\n\n/* The consumer will consume the products produced by the producer */ \n\nclass Consumer {\nprivate : \nint m_Number;\nboost::thread m_Thread;\npublic:\nConsumer(int n){\n    m_Number = n;\n}\n\nvoid remove(ProtectedStack &amp;s ) {\n\n     if(s.isEmpty()){ // if the stack is empty sleep and wait for the producer      to fill the stack\n        //cout&lt;&lt;\"stack is empty\\n\";\n        boost::posix_time::seconds workTime(1); \n        boost::this_thread::sleep(workTime);\n     }\n     else{\n        s.pop(); //pop it\n        //cout&lt;&lt;\"pop object\\n\";\n\n     }\n\n}\n\nvoid consume (ProtectedStack &amp; s){\n    //call remove within a thread \n    m_Thread = boost::thread(&amp;Consumer::remove, this, s);  \n}\n\n};\n\n\nint main(int argc, char* argv[])  \n{  \n\n\n\nProtectedStack s;\n\n\n    Producer p(0);\n    p.produce(s);\n\n    Producer p2(1);\n    p2.produce(s);\n\n    cout&lt;&lt;\"size after production \"&lt;&lt;s.size()&lt;&lt;endl;\n    Consumer c(0);\n    c.consume(s);\n    Consumer c2(1);\n    c2.consume(s);\n    cout&lt;&lt;\"size after consumption  \"&lt;&lt;s.size()&lt;&lt;endl;\n\ngetchar();\nreturn 0;  \n}  \n</code></pre>\n\n<p>After i run that in VC++ 2010 / win7 \ni got : \n0\n0</p>\n\n<p>Could you please help me understand why when i call fillStack function from the main i got an effect but when i call it from a thread nothing happens? \nThank you</p>\n"},{"tags":["objective-c","ios","multithreading","core-data","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13038875,"title":"Working with dispatch queues in Objective-c","body":"<p>I am very new to IOS, and I'm getting data from a webservice. This data I store into core-data. At the moment, I am loading in all of my data in, in the first view controller (tableview). But this takes about 10 min to fill up the tableview and store all the data in the core database. So I was wondering what the best practice is. So I want to work with dispatch queues. But what is the best way of using it?</p>\n\n<ul>\n<li><p>First method  </p>\n\n<ol>\n<li>First store data from first view</li>\n<li>Fill up tableview with this data</li>\n<li>store rest of the data in db.</li>\n</ol></li>\n</ul>\n\n<p>But what if you go to the next view and not all data is loaded in?</p>\n\n<ul>\n<li><p>Second method</p>\n\n<ol>\n<li>store data from first view</li>\n<li>Fill up tableview with this data?</li>\n<li>When the user goes to the second view, store data for second view </li>\n<li>Load second view with this data.</li>\n</ol></li>\n</ul>\n\n<p>You always store the data correctly, but the user still needs to wait before it can use the app. (because the data is not loaded in for that view.)</p>\n\n<p>At the moment I'm using the first method. And working with dispatch queues. I'm using it like this.</p>\n\n<pre><code>- (void)fetch1:(UIManagedDocument *)document\n{\n    dispatch_queue_t fetchQ = dispatch_queue_create(\"NewsFetch\", NULL);\n    dispatch_async(dispatch_get_main_queue(), ^{\n        //store data in core database for firstViewController and save document.\n        [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:NULL];\n        [self loadFirstTableView];\n        [self fetch2];\n    });\n    dispatch_release(fetchQ);\n\n}\n- (void)fetch2:(UIManagedDocument *)document\n{\n    dispatch_queue_t fetchAlbum = dispatch_queue_create(\"Album fetcher\", NULL);\n    dispatch_async(fetchAlbum, ^{\n       //store data for secondViewController\n        [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:NULL];\n\n\n    dispatch_release(fetchAlbum);\n}\n</code></pre>\n\n<p>Can anybody help me?</p>\n\n<p>Kind regards</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>How I get my data from the webservice is at the following way.</p>\n\n<pre><code> NSArray *news = [GenkData getNews]; //gets all the data from webservice as JSON\n        for (NSDictionary *genkInfo in news) {\n            [News newsWithGenkInfo:genkInfo  inManagedObjectContext:document.managedObjectContext];\n        }\n        [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:NULL];\n</code></pre>\n\n<p>And this is how I setup my tableview.</p>\n\n<pre><code>- (void)setupFetchedResultsController // attaches an NSFetchRequest to this UITableViewController\n{\n    NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@\"News\"];\n\n    request.sortDescriptors = [NSArray arrayWithObjects:[NSSortDescriptor sortDescriptorWithKey:@\"date\" ascending:YES],nil];\n\n    self.fetchedResultsController = [[NSFetchedResultsController alloc] initWithFetchRequest:request\n                                managedObjectContext:self.genkDatabase.managedObjectContext\n                                sectionNameKeyPath:nil\n                                cacheName:nil];\n\n}\n</code></pre>\n"},{"tags":["java","multithreading","algorithm","homework","thread-safety"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2724,"score":2,"question_id":6017281,"title":"Odd even number printing using thread","body":"<p><strong>Odd even number printing using thread.Create one thread class, two instance of the thread. One will print the odd number and the other will print the even number.</strong></p>\n\n<p>I did the following coding. But it comes to dead lock state. Can some one please explain what might be the reason for that?</p>\n\n<pre><code>public class NumberPrinter implements Runnable{\nprivate String type;\nprivate static boolean oddTurn=true;\n\n\npublic NumberPrinter(String type){\n    this.type=type;\n}\npublic void run() {\n    int i=type.equals(\"odd\")?1:2;\n    while(i&lt;10){\n        if(type.equals(\"odd\"))\n            printOdd(i);\n        if(type.equals(\"even\"))\n            printEven(i);\n        i=i+2;\n    }\n\n}\n\nprivate synchronized void printOdd(int i){\n    while(!oddTurn){\n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n    System.out.println(type + i);\n    oddTurn=false;\n    notifyAll();\n}\n\nprivate synchronized  void printEven(int i){\n    while(oddTurn){\n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace(); \n        }\n    }\n    System.out.println(type + i);\n    oddTurn=true;\n    notifyAll();\n\n}\n\npublic static void main(String[] s){\n    Thread odd=new Thread(new NumberPrinter(\"odd\"));\n    Thread even=new Thread(new NumberPrinter(\"even\"));\n    odd.start();\n    even.start();\n\n}\n}\n</code></pre>\n\n<p><strong>Out Put:</strong>\nodd1\neven2</p>\n\n<hr>\n\n<p>then comes to deadlock!!!!!!</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["java","multithreading","queue","jms","message-queue"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13037157,"title":"Queuing / Worker Thread architecture for a single java process","body":"<p>I have the following problem to solve.</p>\n\n<p>I need to write a java program that:</p>\n\n<ol>\n<li>reads JSON object j1,j2,...,jn from a web service.</li>\n<li>does some number crunching on each object to come up with j1',j2',...,jn'</li>\n<li>Sends objects j1',j2',...,jn' to a web service.</li>\n</ol>\n\n<p>The computational, space requirements for steps 1,2, and 3 can vary at any given time.</p>\n\n<p>For example:</p>\n\n<ol>\n<li>The time it takes to process a JSON object at step 2 can vary depending on the contents of the JSON Object.</li>\n<li>The rate of objects being produced by the webservice in step 1 can go up or down with time.</li>\n<li>The consuming web service in step 3 can get backlogged.</li>\n</ol>\n\n<p>To address the above design concerns want to implement the following architecture:</p>\n\n<p><img src=\"http://i.stack.imgur.com/326Xj.png\" alt=\"enter image description here\"></p>\n\n<ol>\n<li>Read JSON objects from the external webservice and place them on a Q</li>\n<li>An automatically size adjusting worker thread pool that consumes JSON objects from the Q and processes them. After processing them, places the resulting objects on the second Q</li>\n<li>An automatically size adjusting worker thread pool that consumes JSON objects from the second Q to send them to the consuming webservice.</li>\n</ol>\n\n<p>Question:</p>\n\n<blockquote>\n  <p>I am curious if there is framework which I can use to solve this problem?</p>\n</blockquote>\n\n<p>Notes:</p>\n\n<ol>\n<li>I can solve this using a range of components like custom Queues, Threadpools using the concurrency package -- however I'm looking for a solution that allows the writing of such a solution.</li>\n<li>This is not going to live inside a container. This will be a Java process where the entry point is public static void main(String args[])</li>\n<li>However if there is a container suited to this paradigm I would like to learn about it.</li>\n<li>I could split this into multiple processes, however I'd like to keep it very simple and in a single process.</li>\n</ol>\n\n<p>Thanks. </p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading","algorithm","java.util.concurrent"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":7,"view_count":635,"score":-6,"question_id":11411890,"title":"Java: How to print odd and even numbers from 2 separate threads using Executor framework","body":"<p>I want an algorithm that prints odd numbers and even numbers in separate threads . The output should be sequential <code>1,2,3.4 ,.....</code> Executor framework can be used here . I have seen a <a href=\"http://stackoverflow.com/questions/2742520/program-to-print-odd-numbers-and-even-numbers-on-seperate-threads\">related question on SO</a> but that is in C . I want a Java implementation here .</p>\n"},{"tags":["c#","multithreading","c#-4.0","activex"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12547574,"title":"Running a server on a separate thread","body":"<p>I have a program that retrieves data from a serial device, and then puts it in a server that is accessible by certain programs that can handle this protocol. This server is a third party program that is in the form of an active x control. </p>\n\n<p>The hardware devices require a Thread.Sleep, which is unfortunate. The programs that monitor the server sometimes query the server during the time when a thread is sleeping. This causes it to think the server has failed. </p>\n\n<p>My next idea was to put the server on a separate thread, one solely dedicated for the server tasks. In the UI thread, I run the following code:</p>\n\n<pre><code>        Thread workerThread = new Thread(DoServerWork);\n        workerThread.SetApartmentState(ApartmentState.STA);\n        workerThread.Start();\n</code></pre>\n\n<p>In the delegate, I have</p>\n\n<pre><code>    public void DoServerWork()\n    {\n        rtu = new AxASMBSLVLib.AxASMBSLV();\n        rtu.CreateControl();\n        rtu.BeginInit();\n        rtu.OpenPort();\n\n        while (true)\n        {\n\n        }\n    }\n</code></pre>\n\n<p>The problem is that the server starts to work, and then becomes unresponsive in about 5 seconds. My initial thought is that the thread is exiting, but the while(true) should prevent that from happening. Any thoughts?</p>\n"},{"tags":["java","multithreading","static"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":63,"score":-2,"question_id":13033824,"title":"Multi-threaded code in a static initalizer block produces deadlock","body":"<p>I have a class that needs to provide a fast classification service.  For example, I want to write code like \"classify(\"Ac Kd Kh 3c 3s\")\" that quickly returns TWO_PAIR.  (This isn't the application but you get the jist)</p>\n\n<p>Because I need the classification to be quick I want to precompute, and then store, a look-up table that lists the classification output for all possible inputs.  In the interest of time I want to parallelize this precomputation.  HOWEVER, attempting to use \"classifySlowly\" from a 2nd thread creates a deadlock.  </p>\n\n<pre><code>public class Classifcation Service {\n  enum CLASS {TYPE_A, TYPE_B, ...};\n\n  static CLASS[] preComputedClassLookUpTable;\n\n  static {\n    preComputedClassLookUpTable = constructLookUpTableInParallel();\n  }\n\n  //Note: using this method from with constructLookUpTableInParallel causes deadlock\n  private static CLASS classifySlowly(Object classifyMe) {\n    //do time intensive work to classify the input\n    // -- uses no other methods from this class\n    return classification;\n  }\n\n  public static CLASS classify(Object classifyMe) {\n    //use the lookup table to do a quick classification\n    return classification;\n  }   \n}\n</code></pre>\n\n<p>So my question is:  Is there a way to precompute this lookup table IN PARALLEL from within the static initalizer block?</p>\n\n<p>The only (poor) alternative I see is to switch from:</p>\n\n<pre><code>preComputedClassLookUpTable = constructLookUpTableInParallel();\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>preComputeClassLookUpTable = loadLookUpTableFromFile();\nif(preComputedClassLookUpTable == null) {\n  System.out.println(\"WARNING:  Construction incomplete, Must call computeAndSaveLookUpTableFile();}\n}\n</code></pre>\n\n<hr>\n\n<p>I thought this would be too much but here is the implementation of constructLookUpTableInParallel</p>\n\n<pre><code>private static CLASS[] constructLookUpTableInParallel() {\n\n  //build a collection of Runnables by iterating over all possible input Objects\n  //wrap each possible input in an anonymous Runnable that calls classifySlowly.\n\n  //submit the collection of Runnables to a new ExecutorService\n  //process runnables...\n  //shutdown executor service      \n}\n</code></pre>\n\n<p>////////END OF POORLY WORDED ORIGINAL QUESTION ///////////</p>\n\n<p>The solution that works somewhat cleanly is splitting the classifySlowly(Object classifyMe) and classify(Object classifyMe) methods into two different classes.  </p>\n\n<p>This will allow the (first) class that contains \"public static CLASS classifySlowly(Object classifyMe)\" to be fully loaded by the time the (second) class that contains \"public static CLASS classifyQuickly(Object classifyMe)\" needs to use the classifySlowly method.  Now, that the 2nd static inialization block don't require any of its own static methods it can be fully parallelized.</p>\n"},{"tags":["c#","multithreading","linq-to-sql","thread-safety","datacontext"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":13037470,"title":"LINQ To SQL Thread Safety","body":"<p>I want to ask whether the following code is thread safe:\nConsider that Save1 and Save2 will be executed concurrently. Is there any problem with the thread safety of the datacontext?</p>\n\n<pre><code>public class Test1()\n{\n    private void Save1()\n    {        \n        using(TestLinqToSQL obj = new TestLinqToSQL())\n        {        \n             obj.SaveRecord(new Client (){Id = 1, Name = \"John Doe\");\n        }\n    }\n\n    private void Save2()\n    {        \n         using(TestLinqToSQL obj = new TestLinqToSQL())\n         {        \n             obj.SaveRecord(new Client (){Id = 2, Name = \"Mike Tyson\");\n         }\n    }         \n}\n\n\n\npublic class TestLinqToSQL : IDisposable\n{\n    public void SaveRecord(Client newClient)\n    {\n        using(ClientDatacontext cont = new ClientDatacontext())\n        {\n            cont.InsertRecord(newClient);\n        }        \n    }\n}\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["c++","multithreading","boost","concurrency"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12647217,"title":"Making a C++ class a Monitor (in the concurrent sense)","body":"<p>I want to ensure that only one thread at a time can run a method of my C++ class. In other words, make the class behave like a <a href=\"http://en.wikipedia.org/wiki/Monitor_%28synchronization%29\" rel=\"nofollow\">Monitor</a>.</p>\n\n<p>Is there a pattern, templatized way to do this, or some Boost class I can use? Because my only idea so far is adding a Critical Section member, and acquire it at the beginning of each method and release it at the end (using RAII, of course). But that seems very redundant, and I can't reuse it for some other class.</p>\n"},{"tags":["c#","multithreading","mergesort"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":319,"score":3,"question_id":10580224,"title":"Threaded merge sort slower then serial implementation (solved)","body":"<p>For school we got a task to create a multithreaded application. We chose to make a multithreaded implementation of merge sort.</p>\n\n<p>We however can't manage to make it work faster then the serial implementation.</p>\n\n<p>I have already tried the following:</p>\n\n<ul>\n<li>implementation with unlimited threads (code example 1) (was extremely slow) </li>\n<li>implementation with limited threads (code example 2) (4 threads max - still really slow)</li>\n<li>implementation using Parallel.Invoke (code example 3) (still slower)</li>\n<li>complex implementation also with a parallel merge function (just shamefully slow)</li>\n</ul>\n\n<p>When I use the analyze tools in Visual Studio (Instrumentation part) I found the timings for the functions called and the threaded solution is always extremely slower then the serial implementation.</p>\n\n<p>I can't see any possible reason for this.</p>\n\n<p>(for example: with 5000000 numbers to sort; serial implementation: 16.717,17; parallel: 20.259,97; results with just 1 extra thread)</p>\n\n<p>I tested it on both machines I own:</p>\n\n<ul>\n<li>Intel Core 2 Quad Q9450 @ 2.66Ghz</li>\n<li>Intel Core i7 Q720 @1.60Ghz</li>\n</ul>\n\n<p>I can't for my live figure out how this is possible, shouldn't this just speed up the process?</p>\n\n<p>I would be really greatefull if somebody would be able to help me out.</p>\n\n<p>code example 1:</p>\n\n<pre><code>ParallelMerge pMerge = new ParallelMerge(T, p1, q1 -1, p2, q2-1, A, p3);\nThread thread = new Thread(new ThreadStart(pMerge.parallel_merge));\nthread.Start();\n\nParallelMerge pMerge2 = new ParallelMerge(T, q1 + 1, r1, q2, r2, A, q3 + 1);\npMerge2.parallel_merge();\nthread.Join();\n</code></pre>\n\n<p>code example 2:</p>\n\n<pre><code>if(depthRemaining &gt; 0)\n{\n   ParallelMerge pMerge = new ParallelMerge(T, p1, q1 -1, p2, q2-1, A, p3);\n   thread thread = new Thread(new ThreadStart(pMerge.parallel_merge));\n   thread.Start();\n   ParallelMerge pMerge2 = new ParallelMerge(T, q1 + 1, r1, q2, r2, A, q3 + 1);\n   pMerge2.parallel_merge(); \n   thread.Join();\n}\nelse\n{\n   ParallelMerge pMerge = new ParallelMerge(T, p1, q1 -1, p2, q2-1, A, p3);\n   pMerge.parallel_merge(); \n   ParallelMerge pMerge2 = new ParallelMerge(T, q1 + 1, r1, q2, r2, A, q3 + 1);\n   pMerge.parallel_merge(); \n}\n</code></pre>\n\n<p>code example 3:</p>\n\n<pre><code>if (depthRemaining &gt; 0)\n{\n   Parallel.Invoke(\n      () =&gt; threaded_merge_sort(getallen, p, q, depthRemaining-1));\n\n   threaded_merge_sort(getallen, q + 1, r, 0);\n}\nelse\n{\n   threaded_merge_sort(getallen, p, q, 0);\n   threaded_merge_sort(getallen, q+1, r, 0);\n}\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","thread-local"],"answer_count":8,"favorite_count":44,"up_vote_count":86,"down_vote_count":0,"view_count":23601,"score":86,"question_id":817856,"title":"When and how should I use a ThreadLocal variable?","body":"<p>When should I use a <code>ThreadLocal</code> variable?</p>\n\n<p>How is it used?</p>\n"},{"tags":["objective-c","multithreading","grand-central-dispatch"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":377,"score":3,"question_id":8199363,"title":"Is dataWithContentsOfURL bad when launching the app?","body":"<p>I make an app that accesses some data on the first launch and then displays it.  I've been downloading this data this way:</p>\n\n<pre><code>NSData *data = [NSData dataWithContentsOfURL:url];\n</code></pre>\n\n<p>Is this bad?  Right now I've set the method that contains this to run in a background thread using GCD, but I heard that since <code>dataWithContentsOfURL</code> is synchronous, it's bad.  Are there any opinions on this? </p>\n"},{"tags":["java","multithreading","hibernate","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":206,"score":0,"question_id":9992716,"title":"Multithreading on Hibernate's 'session.flush'","body":"<p>First of all, is this possibly ready-made?</p>\n\n<blockquote>\n  <p>Hibernate 3.6 , JDBC batch_size 500 , using Hilo generator on the\n  200.000 entities.</p>\n</blockquote>\n\n<p>In my example case, I have a request that takes 56 seconds, and I am creating 200,000 entities in the session. So, the <code>session.flush()</code> command takes 32 of those 56 seconds with only one CPU core at %100.</p>\n\n<p>Is there a way to get the list of entities that need to be updated and create the SQL statements, say in four threads?</p>\n"},{"tags":["c#","multithreading","events"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13035846,"title":"SystemEvents.SessionEnding not fired until a Process (opened before) gets closed","body":"<p>I'm trying to do some things in a program exacly when the user closes session.</p>\n\n<p>Here is the code:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>using System;\nusing System.Diagnostics;\nusing Microsoft.Win32;\nusing System.Windows.Forms;\nusing System.Threading;\n\npublic class MyProgram\n{\n    static Process myProcess = null;\n    public MyProgram()\n    {\n    }\n\n    // Entry point\n    static void Main(string[] args)\n    {\n        SystemEvents.SessionEnding += SessionEndingEvent; // Does not trigger inmediately, only fires after \"myProcess\" gets closed/killed \n        myProcess = CreateProcess(\"notepad.exe\", null);\n        myProcess.Exited += pr_Exited; // Invoked at \"myProcess\" close (works ok)\n        try\n        {\n            myProcess.Start();\n        }\n        catch (Exception e2) { MessageBox.Show(e2.ToString()); }\n\n        System.Windows.Forms.Application.Run(); // Aplication loop\n    }\n\n    static void SessionEndingEvent(object sender, EventArgs e)\n    {\n        MessageBox.Show(\"Session ending fired!\");\n    }\n\n    static void pr_Exited(object sender, EventArgs e)\n    {\n        MessageBox.Show(\"Process Closed\");\n    }\n\n    static Process CreateProcess(String path, String WorkingDirPath)\n    {\n        Process proceso = new Process();\n        proceso.StartInfo.FileName = path;\n        proceso.StartInfo.WorkingDirectory = WorkingDirPath;\n        proceso.EnableRaisingEvents = true;\n        return proceso;\n    }\n}\n</code></pre>\n\n<p>I open my application, it opens a notepad.\nWhen I close session:</p>\n\n<ul>\n<li><p>If I have no modified anything in notepad (so it no needs\nconfirmation at exit) the SO closes notepad and SessionEnding event\nis fired (so it's ok in this case) and Process.Exited later.</p></li>\n<li><p>If I have changed something in notepad, notepad ask me if I want to\nsave, and my event is not fired until notepad process gets closed.</p></li>\n</ul>\n\n<p>In other words, my program only gets the notification when the process I started is not running. I want to get my event called in any situation, regardless of whether the process is open or not.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["python","multithreading","performance","concurrency","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13031886,"title":"Python concurrency performance","body":"<p>I'm facing concurrency in Python for the first time with the goal in mind to optimize my script. Basically I have a script which invokes third party jar tools using os.system against some files. My first \"procedural\" version took about 135 seconds to complete, after using threads (<strong>threading.Thread</strong> and <strong>threading.Queue</strong>) 127 and now switching to multiprocess (<strong>multiprocessing.Process</strong> and <strong>multiprocessing.JoinableQueue</strong>) 113 seconds... but it's still a lot of time... could you give me some feedback and/or point me to an article that may solve my problem?</p>\n\n<p>(I'm using Python 2.7.1 and I would like to avoid 3d party modules)</p>\n"},{"tags":["c#",".net","multithreading","file-io"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":13024433,"title":"Better way to handle asynchronous log writing","body":"<pre><code>public static class LogWriter\n{\n    private static ReaderWriterLockSlim writeLock = new ReaderWriterLockSlim();\n    public static void WriteExceptionLog(string content)\n    {\n        #if DEBUG\n        MessageBox.Show(content);\n        #endif\n        WriteLog(content, Constant.EXCEPTION_LOG_PATH);\n    }\n    public static void WriteLog(string content, string path)\n    {\n        try\n        {\n            writeLock.EnterWriteLock();\n            string directory = Path.GetDirectoryName(path);\n            if (!Directory.Exists(Path.GetDirectoryName(directory)))\n                Directory.CreateDirectory(directory);\n            using (StreamWriter writeFile = new StreamWriter(path, true))\n            {\n                content = DateTime.Now + \" : \" + content;\n                writeFile.WriteLine(content);\n            }\n        }\n        catch (Exception ex)\n        {\n            MessageBox.Show(ex.Message);\n        }\n        finally\n        {\n            writeLock.ExitWriteLock();\n        }\n    }\n}\n</code></pre>\n\n<p>I have a class that writes logs. Because I am writing to a log asynchronously, I need to put a lock and release it when write is done but this seems to be somewhat of a clunky solution and maybe even bad for performance.</p>\n\n<p>What is a better way to handle this?</p>\n"},{"tags":["multithreading","mongodb","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13034252,"title":"MongoCursor rewind in separate threads","body":"<p>I have a situation in which several search procedures are parallelized into different threads.  Each thread gets the same <code>pymongo.cursor.Cusor</code> objects to look through for its results, but each thread performs different processing.  I created a demo procedure that just looks like this:</p>\n\n<pre><code>class SearchProcedure(Thread):\n\n    weight = 0.1\n\n    def __init__(self,weight=None):\n        if weight:\n            self.weight = float(weight)\n        Thread.__init__(self)\n\n    def start(self,query):\n        self.query = query\n        Thread.start(self)\n\n    def run(self):\n        if hasattr(self,'places'):\n            for p in self.places.values():\n                print p.name\n\n        if hasattr(self,'posts'):\n            for s in self.posts.values():\n                s.rewind()\n                print [(sh['name'],sh['description']) for sh in s]\n\n    def attach_eligible(self,queue,**kwargs):\n        self.queue = queue\n        for (name,value) in kwargs.items():\n            setattr(self,name,value)\n</code></pre>\n\n<p>The <code>attach_eligible</code> method is where the properties for places and posts are added to the procedure object.  Again, the <code>posts</code> property is a set of mongo cursors that can be iterated through.  I use <code>rewind</code> before running through the results to reset the cursor to its original state if another thread has already unwound it.  The idea is the each thread will use different criteria to search the objects and then emit its results into the <code>queue</code> property for use in the calling/instantiating scope.</p>\n\n<p>The first thread runs through fine, but all subsequent threads the utilize the cursor output the following error:</p>\n\n<pre><code>  File \"/usr/local/lib/python2.7/dist-packages/pymongo/cursor.py\", line 668, in __send_message\n    assert response[\"starting_from\"] == self.__retrieved\nAssertionError\n</code></pre>\n\n<p>Rewinding, it would seem, has no effect.  Is this because the cursors are passed in by reference?  Would they too need to be contained within a queue to preserve lock status?  Is it even possible to do something like this with mongo cursors?  It would be nice if I could, since it would make the processing of the search criteria much more performant to have it executed concurrently.</p>\n"},{"tags":["ios","multithreading","ios6","nsmanagedobjectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13033785,"title":"Cannot invoke code on the main thread from the background thread in iOS6","body":"<p>When saving a managed object context on a background thread I am listening to the NSManagedObjectContextDidSaveNotification and trying to merge it on the main thread.</p>\n\n<p>However when I try to forward the request to the main thread, none of the code is executed neither using</p>\n\n<pre><code>[self performSelectorOnMainThread:@selector(executeThisCode:) withObject:saveNotification waitUntilDone:NO]; \n</code></pre>\n\n<p>nor with</p>\n\n<pre><code>dispatch_async(dispatch_get_main_queue(), ^{\n    ...execute this code\n});\n</code></pre>\n\n<p>Strangely, it all works fine with iOS 5.1 and iOS 5.0, but not with iOS 6. Any ideas? </p>\n"},{"tags":["c#","multithreading","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13028146,"title":"what happens to a mutex object if not released by parent applicaiton","body":"<p>I have a named mutex in my application.</p>\n\n<pre><code> private Mutex TaskExitStatus = new Mutex(false, \"TaskExit\")\n</code></pre>\n\n<p>I acquire the mutex in a method using TaskExitStatus.WaitOne()</p>\n\n<p>What will happen if I am not releasing the mutex while exiting the application? Will the mutex be disposed safely?</p>\n\n<p><strong>Update 1:</strong>\nWill both named and unnamed mutex behave the same when not released on application exit?</p>\n\n<p><strong>Update 2</strong>\nThis is what i read from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms682411%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN link</a></p>\n\n<blockquote>\n  <p>Use the CloseHandle function to close the handle. The system closes\n  the handle automatically when the process terminates. The mutex object\n  is destroyed when its last handle has been closed.</p>\n</blockquote>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13033142,"title":"What is this number in the java log file?","body":"<p>I have a number in the beginning of my log file:</p>\n\n<pre><code>[10/17/12 17:44:03:341 CDT] 00000066 servlet       I com.ibm.ws.webcontainer.servlet.ServletWrapper init SRVE0242I: [WC].....\n</code></pre>\n\n<p>I don't know what it is, or if this is enough info for anyone to tell what it is.\nMy goal is to grab this number in code to be used somewhere.\nIt's not the thread id, I tried:</p>\n\n<pre><code>Thread.currentThread().getId()\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["java","multithreading","concurrentmodification"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13030254,"title":"Exception while removing from list used by thread","body":"<p>thats part of my code:</p>\n\n<pre><code>public List&lt;Integer&gt; _list = new ArrayList&lt;&gt;();\n\npublic void removeInteger(Integer i)\n{\n    _list.remove(i);\n}\n\npublic class CheckThread implements Runnable\n{\n    @Override\n    public void run()\n    {\n        synchronized(_list) \n        {\n            Iterator&lt;Integer&gt; it=_list.iterator(); \n            while(it.hasNext()) \n            {\n                Integer i = it.next();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Thread is running all the time(didnt write that part) and when i remove from list using removeInteger method, i have got ConcurrentModificationException. Any idea how to solve that problem?</p>\n"},{"tags":["c++","linux","multithreading","synchronization","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":13030413,"title":"Windows Event implementation in Linux using conditional variables?","body":"<p>I am trying to implement very simple Windows events in Linux. Only for my scenario - 3 threads, 1 main and 2 secondary. Each of secondary threads raise 1 event by SetEvent and main thread wait it. Example:</p>\n\n<pre><code>int main()\n{\n    void* Events[2];\n    Events[0] = CreateEvent();\n    Events[1] = CreateEvent();\n\n    pthread_start(Thread, Events[0]);\n    pthread_start(Thread, Events[1]);\n\n    WaitForMultipleObjects(2, Events, 30000) // 30 seconds timeout\n\n    return 0;\n}\n\nint* thread(void* Event)\n{\n    // Do something\n    SetEvent(Event);\n    // Do something\n}\n</code></pre>\n\n<p>So, to implement it, i use conditional variables. But my question is - is this a right way? Or i doing something wrong? My implementation:</p>\n\n<pre><code>// Actually, this function return pointer to struct with mutex and cond\n// here i just simplified example\nvoid* CreateEvent(mutex, condition)\n{\n    pthread_mutex_init(mutex, NULL);\n    pthread_cond_init(condition, NULL);\n}\n\nbool SetEvent (mutex, condition)\n{\n    pthread_mutex_lock(mutex);\n    pthread_cond_signal(condition);\n    pthread_mutex_unlock(mutex);\n}\n\nint WaitForSingleObject(mutex, condition, timeout)\n{\n    pthread_mutex_lock(mutex);\n    pthread_cond_timedwait(condition, mutex, timeout);\n    pthread_mutex_unlock(mutex);\n}\n\n// Call WaitForSingleObject for each event. \n// Yes, i know, that its a wrong way, but it should work in my example.\nint WaitForMultipleObjects(count, mutex[], condition[], timeout);\n</code></pre>\n\n<p>And all seems good, but i think, that problem will appear when i call WaitFor.. function in Main thread before SetEvent in secondary thread will be called. In Windows, it worked well, but in Linux - only idea is described above.</p>\n\n<p>Maybe you tell me the better way to solve it? Thank you.</p>\n\n<p><strong>UPD:</strong> Timeout is very important, because one of the secondary threads may not pass SetEvent().</p>\n"},{"tags":["java","multithreading","concurrency","sms","producer-consumer"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13030136,"title":"Executing 2 lists of tasks concurrently","body":"<p>Basically I am building an SMS application that reads pending SMS messages from the database and then send them all. There are 2 types of SMS messages; <em>normal messages</em> which can be sent at any time, and <em>urgent messages</em> which must be sent before any <em>normal message</em>. I am using multi-threading within the application.</p>\n\n<p>I want to have 2 queues of <em>tasks</em>; one for the normal messages and one for the urgent messages. Then threads in a pool would execute the tasks from the two queues, <strong>taking into account that no SMS mesages from the <em>normal messages</em> can be sent unless there are no <em>urgent messages</em></strong>.</p>\n\n<p>The implementation would be something as follows:</p>\n\n<pre><code>public class SMSApplication\n{\n    private Queue&lt;SMSTask&gt; normalMessages = new Queue&lt;SMSTask&gt;(); // not necessarily java.util.Queue\n    private Queue&lt;SMSTask&gt; urgentMessages = new Queue&lt;SMSTask&gt;();\n\n    // ...\n\n    public void addNormalMessage(SMSTask task)\n    {\n        normalMessages.add(task);\n    }\n\n    public void addUrgentMessage(SMSTask task)\n    {\n        urgentMessages.add(task);\n    }\n\n    public void runApplication()\n    {\n        /* iterate over the queues, create new threads or select existing ones from a pool, and then execute the tasks */\n    }\n}\n</code></pre>\n\n<p>What is the best approach to achieve that? Can I accomplish that using <a href=\"http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html\" rel=\"nofollow\"><code>BlockingQueue</code></a>?</p>\n"},{"tags":["c#","multithreading","windows-phone-7","xna"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12987684,"title":"Thread doesn't run in background","body":"<p>I am trying to play a sound in a new thread, so that other sounds don't interrupt it, while it is playing.</p>\n\n<p>But it doesn't work. Although the new thread runs in background (I assume), the sounds which are played afterwards interrupt it.</p>\n\n<pre><code>ParameterizedThreadStart pts;\n        Thread t;\n\nprivate void playStreak(Object p)\n        {\n            SoundEffect sound = SoundEffect.FromStream(Application.GetResourceStream(new Uri(\"SOUNDFX/BOMB.wav\", UriKind.Relative)).Stream);\n            SoundEffectInstance instance = sound.CreateInstance();\n            instance.Play();\n        }\n\nprivate void playAsThread()\n{\n     pts = new ParameterizedThreadStart(playStreak);\n     t = new Thread(pts);\n     t.Name = \"Streak sound!\";\n     t.Start();\n}\n</code></pre>\n\n<p>I want to play various sounds without interrupting each other.</p>\n"},{"tags":["php","multithreading","curl","download"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":433,"score":2,"question_id":7099952,"title":"How can I download multiple parts of a file in parallel with PHP's curl library?","body":"<p>I decided to start a project about download acceleration with curl in PHP, using curl_multi functions.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>set_time_limit(0);\nerror_reporting(E_ALL);\n$fileurl = \"http://hq-scenes.com/tv.exe\";\n$filename = basename($fileurl);\n$size = getFileSize($fileurl);\n$splits = range(0, $size, round($size/5));\n$megaconnect = curl_multi_init();\n$partnames = array();\nfor ($i = 0; $i &lt; sizeof($splits); $i++) {\n    $ch[$i] = curl_init();\n    curl_setopt($ch[$i], CURLOPT_URL, $fileurl);\n    curl_setopt($ch[$i], CURLOPT_RETURNTRANSFER, 0); \n    curl_setopt($ch[$i], CURLOPT_FOLLOWLOCATION, 0); \n    curl_setopt($ch[$i], CURLOPT_VERBOSE, 1);\n    curl_setopt($ch[$i], CURLOPT_BINARYTRANSFER, 1);\n    curl_setopt($ch[$i], CURLOPT_FRESH_CONNECT, 0);\n    curl_setopt($ch[$i], CURLOPT_CONNECTTIMEOUT, 10);\n    $partnames[$i] = $filename . $i;\n    $bh[$i] = fopen(getcwd(). '/' . $partnames[$i], 'w+');\n    curl_setopt($ch[$i], CURLOPT_FILE, $bh[$i]);\n        $x = ($i == 0 ? 0 : $splits[$i]+1);\n        $y = ($i == sizeof($splits)-1 ? $size : $splits[$i+1]);\n        $range = $x.'-'.$y;\n    curl_setopt($ch[$i], CURLOPT_RANGE, $range);\n    curl_setopt($ch[$i], CURLOPT_USERAGENT, \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.29 Safari/535.1\");\n    curl_multi_add_handle($megaconnect, $ch[$i]); \n}\n\n$active = null;\n\ndo {\n    $mrc = curl_multi_exec($megaconnect, $active);\n} while ($mrc == CURLM_CALL_MULTI_PERFORM);\n\nwhile ($active &amp;&amp; $mrc == CURLM_OK) {\n    if (curl_multi_select($megaconnect) != -1) {\n        do {\n            $mrc = curl_multi_exec($megaconnect, $active);\n        } while ($mrc == CURLM_CALL_MULTI_PERFORM);\n    }\n}\n$final = fopen($filename, \"w+\");\nfor ($i = 0; $i &lt; sizeof($splits); $i++) {\n    $contents = fread($bh[$i], filesize($partnames[$i]));\n    fclose($bh[$i]);\n    fwrite($final, $contents);\n}\nfclose($final);\n\nfunction getFileSize($url) {\n    $ch = curl_init($url);\n    curl_setopt($ch, CURLOPT_NOBODY, true);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_HEADER, true);\n    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n    $h = fopen('header', \"w+\");\n    curl_setopt($ch, CURLOPT_WRITEHEADER, $h);\n\n    $data = curl_exec($ch);\n    curl_close($ch);\n\n    if (preg_match('/Content-Length: (\\d+)/', $data, $matches)) {\n        return $contentLength = (int)$matches[1];\n    }\n    else return false;\n}\n</code></pre>\n\n<p>Everything goes OK, except one thing:</p>\n\n<p>The last part file doesn't reach the end of the file.\nthe actual file size is : 3279848 bytes</p>\n\n<p>ranges are:</p>\n\n<pre><code>0-655970\n655971-1311940\n1311941-1967910\n1967911-2623880\n2623881-3279848\n</code></pre>\n\n<p>part files with size</p>\n\n<pre><code>tv.exe0 655360\ntv.exe1 655360\ntv.exe2 655360\ntv.exe3 655360\ntv.exe4 655360\n</code></pre>\n\n<p>That makes the final file 3276800 bytes length, but it must be 3279848 bytes.\nAnd of course the executable didn't work :(</p>\n\n<p>Notice that the part files have the same size. Even the last one, which should have some more bytes. So the problem is in the download range or something, not in the merge process.</p>\n\n<p>What did I do wrong?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":5,"view_count":57,"score":-3,"question_id":13030771,"title":"Multithreading for java application","body":"<p>I want to make my single threaded java application mutithreaded. I do fetch data from external systems. I am doing 4 different queries from external systems. This queried data is stored in a common session. I want to query in a concurrent manner. How can it be done? Also, as this queried data is stored in common session, synchronization needs to be implemented. How it should be done ?</p>\n"},{"tags":["java","swing","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1364,"score":6,"question_id":2564388,"title":"Java's Swing Threading","body":"<p>My understanding is that if I start up another thread to perform some actions, I would need to <code>SwingUtilities.invokeAndWait</code> or <code>SwingUtilities.invokeLater</code> to update the GUI while I'm in said thread. Please correct me if I'm wrong.</p>\n\n<p>What I'm trying to accomplish is relatively straightforward: when the user clicks submit, I want to (before performing any actions) disable the submit button, perform the action, and at the end of the action re-enable the button. My method to perform the action updates the GUI directly (displays results) when it gets the results back.</p>\n\n<p>This action basically queries a server and gets some results back.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>boolean isRunning = false;\n\nsynchronized handleButtonClick() {\n  if ( isRunning == false ) {\n    button.setEnabled( false );\n    isRunning = true;\n    doAction();\n  }\n}\n\ndoAction() {\n  new Thread() {\n    try {\n      performAction(); // Concern A\n    } catch ( ... ) {\n      displayStackTrace( ... ); // Concern B\n    } finally {\n      SwingUtilities.invokeLater ( /* simple Runnable to enable button */ );\n      isRunning = false;\n    }\n  }\n}\n</code></pre>\n\n<p>For both of my concerns above, do I would have to use <code>SwingUtilities.invokeAndWait</code> since they both will update the GUI? All GUI updates revolve around updating <code>JTextPane</code>. Do I need to in my thread check if I'm on EDT and if so I can call my code (regardless of whether it updates the GUI or not) and NOT use <code>SwingUtilities.invokeAndWait</code>?</p>\n\n<p>EDIT: Here is what I am doing now:</p>\n\n<pre><code>handleButtonClick() {\n  if ( isRunning == true )\n     return;\n  disable button;\n  SwingWorker task = new MyTask();\n  task.execute();\n}\n\n...inside MyTask\ndoInBackground() {\n  return performAction();\n}\n\ndone() {\n  result = get();\n  enable button;\n  isRunning = false;\n  interpret result (do most of the GUI updates here);\n}\n</code></pre>\n\n<p>While <code>performAction()</code> does some GUI updates, I have wrapped those in:</p>\n\n<pre><code>if ( SwingUtil.isEDT() )\n  doGUIupdate()\nelse\n  SwingUtil.invokeLater( new Runnable() {\n    run() {\n      doGUIupdate();\n    }\n  } );\n</code></pre>\n\n<p>Hopefully this is a step in the right direction, please comment if you believe there are better ways to handle my situation.</p>\n"},{"tags":["multithreading","core-data"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":187,"score":0,"question_id":6966444,"title":"Odd Core Data crash in background thread","body":"<p>I have a background thread persisting JSON data downloaded from a web service in Core Data. This works as expected, except for odd and erratic occasions. I have not been able to identify why this occurs, and can cannot reproduce. This has occurred on both the simulator and on the device, so it is not memory related.</p>\n\n<p>The method that crashes is as follows; </p>\n\n<pre><code>+ (Hotspot *)insertOrUpdateWithDictionary:(NSDictionary *)hotspotJSON error:(NSError **)error {\nNSManagedObjectContext *moc = [[ContentProviderController sharedContentProviderController] managedObjectContext];\nHotspot *hotspot = [Hotspot managedObjectWithPrimaryKey:[hotspotJSON objectForKey:@\"id\"] error:error];\nif (*error == nil) {\n    if (hotspot) {\n        // Delete hotspot and cascade to other managed objects\n        [moc deleteObject:hotspot];\n    }\n    hotspot = [NSEntityDescription insertNewObjectForEntityForName:@\"Hotspot\" inManagedObjectContext:moc];\n    [hotspot setJSONProperties:hotspotJSON error:error];\n} \nif (*error == nil) {\n    return hotspot;\n}\nreturn nil;\n</code></pre>\n\n<p>}</p>\n\n<p>managedObjectWithPrimaryKey looks like this;</p>\n\n<pre><code>+ (Hotspot *)managedObjectWithPrimaryKey:(NSString *)primaryKey error:(NSError **)error {\nif (primaryKey) {\n    NSFetchRequest *fetchRequest = [[NSFetchRequest alloc] init];\n    [fetchRequest setEntity:[NSEntityDescription entityForName:NSStringFromClass([self class]) inManagedObjectContext:[[ContentProviderController sharedContentProviderController] managedObjectContext] ]];\n    NSPredicate *predicate = [NSPredicate predicateWithFormat:@\"(hotspotId like %@)\", primaryKey];\n    [fetchRequest setPredicate:predicate];\n    [fetchRequest setFetchLimit:1];\n    NSArray *results = [[[ContentProviderController sharedContentProviderController] managedObjectContext] executeFetchRequest:fetchRequest error:error];\n    RELEASE_SAFELY(fetchRequest);\n    if (*error == nil &amp;&amp; results) {\n        return ([results count] &gt; 0) ? [results objectAtIndex:0] : nil;\n    } else {\n        GTMLoggerError(@\"error while retrieving process with hotspotId=%@; %@\", primaryKey, [*error description]);\n        return nil;\n    }    \n} else {\n    *error = [NSError errorWithDomain:kCoreDataPersistenceError code:1000 userInfo:[NSDictionary dictionaryWithObject:@\"Attempt to access an Hotspot with an invalid (null) hotspotId.\" forKey:NSLocalizedDescriptionKey]];\n    return nil;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>setJSONProperties is simply setting the managed object properties as follow;</p>\n\n<pre><code>- (void)setJSONProperties:(NSDictionary *)dictionary error:(NSError **)error {\nNSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n</code></pre>\n\n<p>//set hotspot properties here</p>\n\n<pre><code>RELEASE_SAFELY(pool);\n</code></pre>\n\n<p>}</p>\n\n<p>The crash logs looks as follows;</p>\n\n<pre><code>** Call stack at first throw:\n(\n    0   CoreFoundation                      0x36b5964f __exceptionPreprocess + 114\n    1   libobjc.A.dylib                     0x33db2c5d objc_exception_throw + 24\n    2   CoreFoundation                      0x36b58edf __NSFastEnumerationMutationHandler + 214\n    3   libobjc.A.dylib                     0x33db936d objc_enumerationMutation + 24\n    4   CoreData                            0x36ee5c89 -[NSManagedObjectContext executeFetchRequest:error:] + 1888\n    5   magazine                            0x000cd76d +[Page managedObjectWithPrimaryKey:error:] + 288\n    6   magazine                            0x000ccc65 -[Hotspot setJSONProperties:error:] + 724\n    7   magazine                            0x000cc943 +[Hotspot insertOrUpdateWithDictionary:error:] + 194\n    8   magazine                            0x000c3d39 -[ContentProviderController persistHotspots:] + 368\n    9   magazine                            0x000c05e5 -[ContentProviderController doPersistenceJobForIssueObjectId:] + 704\n    10  CoreFoundation                      0x36b5c7a4 __invoking___ + 68\n    11  CoreFoundation                      0x36ad443d -[NSInvocation invoke] + 108\n    12  Foundation                          0x34f8043f -[NSInvocationOperation main] + 78\n    13  Foundation                          0x34f19d1b -[__NSOperationInternal start] + 658\n    14  Foundation                          0x34f19a7f -[NSOperation start] + 22\n    15  Foundation                          0x34f7fecb ____startOperations_block_invoke_2 + 46\n    16  libdispatch.dylib                   0x339d88e7 _dispatch_call_block_and_release + 10\n    17  libdispatch.dylib                   0x339d362d _dispatch_worker_thread2 + 252\n    18  libsystem_c.dylib                   0x3483c591 _pthread_wqthread + 264\n    19  libsystem_c.dylib                   0x3483cbc4 _init_cpu_capabilities + 4294967295\n)\n</code></pre>\n\n<p>I fully understand that an object should not be mutated while enumerating, but what I don't understand is why a separate managed object(Page) is seen in this thread(-[Hotspot setJSONProperties:error:] + 724). Each managed object is persisted sequentially, so a \"Page\" object would have been persisted before this \"Hotspot\" object.</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":13011839,"title":"How many times has my loop been iterated","body":"<p>I have a very contrived issue.</p>\n\n<p>Imagine I have a class which has one method only and one field. Like:</p>\n\n<pre><code>public class WhereAmI\n{\n    public int Number = 0;\n    public void Looping()\n    {\n         for (int i = 0; i &lt; 100; i++)\n        {\n            Number = i;\n            Sleep(10000);\n        }\n    }\n}\n</code></pre>\n\n<p>I call it from another class in the normal way you would expect</p>\n\n<pre><code>WhereAmI wai = new WhereAmI();\nwai.Looping();\nint CurrentNumber = wai.Number;\n</code></pre>\n\n<p>What I want is a way to see what number I'm currently up to and display that on screen. I've tried similar to the above but this won't work because the compiler won't move past the wai.Loopping() method until it's complete.</p>\n\n<p>I assume I have to do this on a new thread and then get into the world of cross threading? I then thought my design must be wrong and I've over complicating this! </p>\n\n<p>Any one care to pass their opinion or suggestion on this?</p>\n\n<p>Thank you</p>\n"},{"tags":["iphone","objective-c","xcode","multithreading","grand-central-dispatch"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":217,"score":0,"question_id":10295337,"title":"Waiting Until Dispatch Queue has Completed - Timing - iPhone","body":"<p>Say I have an app with the following method strucutre :</p>\n\n<pre><code>[self method1];\n[self method2];\n</code></pre>\n\n<p>And that method 1 contains a dispatch queue such as :</p>\n\n<pre><code>[exportSession exportAsynchronouslyWithCompletionHandler:^{\n    switch (exportSession.status) {\n        case AVAssetExportSessionStatusFailed:{\n            NSLog (@\"FAIL\");\n            break;\n        }\n        case AVAssetExportSessionStatusCompleted: {\n            NSLog (@\"SUCCESS\");\n}\n};\n }];\n</code></pre>\n\n<p>I want to only proceed to execute [method2] once the dispatch queue in method1 has completed. What is the best way to achieve this ?</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13028530,"title":"How do i stop blocking read on BufferedReader.readline()?","body":"<p>I have a small program whereby in the main thread, I ask for input from the user in the console.</p>\n\n<pre><code>System.out.print(\"Alternatively, enter peer's ID to connect:\");\nInputStreamReader reader = new InputStreamReader(System.in);\nBufferedReader bReader = new BufferedReader(reader);\nString peerID = bReader.readLine();\n</code></pre>\n\n<p>and in a separate thread I listen from my sockets' InputStream. If I receive something from this stream, i then try to \"unblock\" the readLine by calling <code>System.in.close()</code> without waiting for the user's input. The main thread can then proceed to do something with the information obtained either from the socket's read or from the user.</p>\n\n<p>Somehow it seem to work on my Mac, but if I try it on Windows, stepping through the debugger, I've found that <code>System.in.close()</code> blocks and the whole program will hangs.</p>\n\n<p>Any idea why and how should i unblock <code>readline()</code>? Otherwise what would be a good way of rewriting the logic?</p>\n"},{"tags":["c++","multithreading","low-latency"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":152,"score":5,"question_id":13020695,"title":"What is the fastest way to send data from one thread to another in C++?","body":"<p>I have tried an experiment where I built a simple Producer/Consumer program. They run in separate threads. The producer generates some data and the consumer picks it up in another thread. The messaging latency I achieved is approximately 100 nano seconds. Can anybody tell me if this is reasonable or are there significantly faster implementations out there? </p>\n\n<p>I'm not using locks ... just simple memory counters. My experiment is described here:</p>\n\n<p><a href=\"http://tradexoft.wordpress.com/2012/10/22/how-to-move-data-between-threads-in-100-nanoseconds/\">http://tradexoft.wordpress.com/2012/10/22/how-to-move-data-between-threads-in-100-nanoseconds/</a></p>\n\n<p>Basically the consumer waits on a counter to be incremented and then it calls the handler function. So not much code really. Still I was surprised it took 100ns.</p>\n\n<p>The consumer looks like this:</p>\n\n<pre><code> void operator()()\n    {\n      while (true)\n      {\n        while (w_cnt==r_cnt) {};\n        auto rc=process_data(data);\n        r_cnt++;\n        if (!rc)\n          break;\n      }\n    }\n</code></pre>\n\n<p>The producer simply incremnts w_cnt when it has data available.</p>\n\n<p>Is there a faster way?</p>\n"},{"tags":["ruby","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13027794,"title":"ruby thread not wait","body":"<p>In ruby I want to execute some local command which will generate a file,then I want to read the contents of the file,and modify it.</p>\n\n<p>However I always get null.</p>\n\n<p>This is the code:</p>\n\n<pre><code>exec \"java -jar xx.jar --output main.txt\";\ncontent=IO.read('main.txt');\ncontent=\"somethinkg:\"+content;\nFile.open('main.txt','w') do |f|\n  f.puts content\nend\n</code></pre>\n\n<p>the main.txt is generated,however I can not modify the content.</p>\n\n<p>Then I think it maybe caused by the thread,when the <code>main.txt</code> is being read,the java command is not complete,so the content is empty.</p>\n\n<p>Then I tried this:</p>\n\n<pre><code>t=Thread.new do\n  exec \"java -jar xx.jar --output main.txt\";\nend\nt.join\ncontent=IO.read('main.txt');\nputs content\ncontent=\"somethinkg:\"+content;\nFile.open('main.txt','w') do |f|\n  f.puts content\nend\n</code></pre>\n\n<p>However nothing changed,I can not still get the content.</p>\n\n<p>What is the problem?</p>\n"},{"tags":["c#","multithreading","concurrency"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":169,"score":3,"question_id":10796328,"title":"Do properties have volatile effect?","body":"<p>In the code below will <code>read1</code> be always equal to <code>read2</code>, provided property <code>Flag</code> can be changed from other threads? Concern here is that <code>Flag</code> may get inlined.</p>\n\n<pre><code>private bool Flag {get; set;}\n\npublic void MultithreadedMethod()\n{\n    var read1 = Flag;\n\n    /* some more code */\n\n    var read2 = Flag;    \n}\n</code></pre>\n\n<p><strong>UPD</strong>: Some other thread may change <code>Flag</code>'s value during <code>/* some more code */</code> execution. In this case <code>read1</code> should be different from <code>read2</code>. Will it <em>always</em> be the case? Won't inlining turn the property into an non-volatile field that will cause <code>read1</code> to be equal to <code>read2</code> despite tha fact <code>Flag</code> was changed between reads?</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":608,"score":1,"question_id":5788159,"title":"Event handling in multithreaded application","body":"<p>I'm designing a stand-alone, multi-threaded application in Java.\nI'm trying to choose the best event-handling solution for his project.</p>\n\n<p>I have 1-3 threads generating events (e.g comm thread completes file upload), while other threads might want to be registered for notification on this event.\nI want the event-generating and event listening to be as uncoupled as possible.</p>\n\n<p>What do you suggest?</p>\n"},{"tags":["c#","multithreading","timer","wait"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13026980,"title":"Wait with return statement until Timer elapsed","body":"<p>I have a method that returns a bool value, but should wait with returning the value until the System.Timers.Timer raises the elapsed event, because the value I want to return is set in the elapsed event of the timer.</p>\n\n<pre><code>public static bool RecognizePushGesture()\n{\n    List&lt;Point3D&gt; shoulderPoints = new List&lt;Point3D&gt;();\n    List&lt;Point3D&gt; handPoints = new List&lt;Point3D&gt;();\n    shoulderPoints.Add(Mouse.shoulderPoint);\n    handPoints.Add(Mouse.GetSmoothPoint());\n    Timer dt = new Timer(1000);\n    bool click = false;\n\n    dt.Elapsed += (o, s) =&gt;\n    {\n        shoulderPoints.Add(Mouse.shoulderPoint);\n        handPoints.Add(Mouse.GetSmoothPoint());\n        double i = shoulderPoints[0].Z - handPoints[0].Z;\n        double j = shoulderPoints[1].Z - handPoints[1].Z;\n        double k = j - i;\n        if (k &gt;= 0.04)\n        {\n            click = true;\n            dt.Stop();\n        }\n    };\n\n    dt.Start();\n\n    //should wait with returning the value until timer raises elapsed event\n    return click;\n}\n</code></pre>\n\n<p>Thanks, Tim</p>\n"},{"tags":["python","multithreading","concurrency","process","multiprocess"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13026437,"title":"Python threading - listen to network while compiling","body":"<p>In python (2.6.6) what is the best way I can have a thread/process checking a network (message queue) for things while concurrently doing work (compiling). If i receive a command down the message queue, i must be able to kill and spawn compile threads.</p>\n"},{"tags":["c","linux","multithreading","sockets","kernel"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":171,"score":1,"question_id":10389454,"title":"Any benefit in sockets from multiple cores? (Linux)","body":"<p>Cant find myself the answer for such a question:</p>\n\n<p>Is there any benefit/boost to sockets in general at multi-core machine. I mean is there maybe some kind of sharing access to packets queue incoming to kernel from the ethernet-card driver or smth.</p>\n\n<p>I understand that when it comes up to API call there can be multiple threads working with one socket instance, but it is up to programmer to synchronize and play correctly with calls to read/write/close/select etc. So at that level i see benefit only in working with dispatched packets and post processing etc... Or there is no speed boost until the packet copied during system call and transferred to user space?</p>\n"},{"tags":["java","multithreading","loops","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13011739,"title":"How to run multiple java runtime jobs and wait for all of them to finish?","body":"<p>I have this code to run a job with a progress bar in java:</p>\n\n<pre><code>private void createNewJobRun(final int i) {\n    Job job = new Job(\"Experiment \" //$NON-NLS-1$\n            + getName()) {\n        @Override\n        protected IStatus run(IProgressMonitor monitor) {\n\n            monitor.beginTask(\"Experiment is running ...\", 100); //$NON-NLS-1$\n            //call here my own functions that to the actual work\n\n            monitor.done();\n            return Status.OK_STATUS;\n        }\n    };\n    job.schedule();\n\n\n\n}\n</code></pre>\n\n<p>The problem is that I want to call this function many times but only the first job runs and the others are almost simultaneously started but I never see their results...Although their progress monitor is shown. How do I wait for all of them to finish in some way or the problem is something else?</p>\n"},{"tags":["objective-c","multithreading","web-services","core-data","grand-central-dispatch"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13026508,"title":"Working with threads in objective-C","body":"<p>I am building an app that calls a webservice to get data and put it into core data. In my first viewController I load first all the news items in because this is the first thing I want to show.  But when that is loaded in and showed on screen. I want it to load all the other data in. </p>\n\n<p>I'm doing it like this. First I check if my database is set. When this is set. I am going to call a usedocument function. Which is going to see in which state my document is. </p>\n\n<pre><code>    - (void)useDocument\n    {\n        NSLog(@\"Comses in the use document\");\n        if (![[NSFileManager defaultManager] fileExistsAtPath:[self.genkDatabase.fileURL path]]) {\n            // does not exist on disk, so create it\n            [self.genkDatabase saveToURL:self.genkDatabase.fileURL forSaveOperation:UIDocumentSaveForCreating completionHandler:^(BOOL success) {\n                NSLog(@\"create\");\n                [self fetchNewsIntoDocument:self.genkDatabase];\n                [self setupFetchedResultsController];\n            }];\n        } else if (self.genkDatabase.documentState == UIDocumentStateClosed) {\n            NSLog(@\"closed news\");\n            // exists on disk, but we need to open it\n            [self.genkDatabase openWithCompletionHandler:^(BOOL success) {\n                [self setupFetchedResultsController];\n            }];\n        } else if (self.genkDatabase.documentState == UIDocumentStateNormal) {\n            NSLog(@\"normal\");\n            // already open and ready to use\n            [self setupFetchedResultsController];\n        }  \n}\n</code></pre>\n\n<p>Here is my FetchNewsIntoDocument.</p>\n\n<pre><code>- (void)fetchNewsIntoDocument:(UIManagedDocument *)document\n{\n    NSLog(@\"Fetch data\");\n    dispatch_queue_t fetchQ = dispatch_queue_create(\"NewsFetch\", NULL);\n    dispatch_async(dispatch_get_main_queue(), ^{\n\n        NSArray *news           = [GenkData getNews];\n        int newsId          = 0;\n        for (NSDictionary *genkInfo in news) {\n            NSLog(@\"Begint met nieuwsitem\");\n            newsId++;\n            [News newsWithGenkInfo:genkInfo inManagedObjectContext:document.managedObjectContext withNewsId:newsId];\n            NSLog(@\"Einde met nieuwsitem\");\n        }\n        [document saveToURL:document.fileURL forSaveOperation:UIDocumentSaveForOverwriting completionHandler:NULL];\n        [self setupFetchedResultsController];\n\n        // note that we don't do anything in the completion handler this time\n\n    });\n    dispatch_release(fetchQ);\n\n}\n</code></pre>\n\n<p>Now I have a function like this the same for albums. But I want it to get called after news is loaded in and showed. But the next time the app starts up, it should check whether data is already loaded in or not.</p>\n\n<p>Hope anybody can help me</p>\n\n<p>Kind regards</p>\n"},{"tags":["c#",".net","multithreading","wcf","thread-safety"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":97,"score":8,"question_id":13023310,"title":"Is WCF's DataContractSerilaizer thread safe?","body":"<p>I've been converting a fairly large system from Remoting to WCF and everything seems to be running well, except we frequently get the following exception: \"System.InvalidOperationException: Collection was modified; enumeration operation may not execute.\"  I haven't had any luck tracking it down because it only happens when there are hundreds of calls getting passed through, and I can only assume it's because an object is being modified as it's being serialized.  </p>\n\n<p>The classes all use: <code>[DataContract(IsReference=true)]</code>.  </p>\n\n<p>There were no similar exceptions when using remoting, so I'm wondering if anyone has had a similar problem in WCF or can let me know that it probably is the serializer -- in which case I assume I have to write my own serializers to perform <code>locks</code> where necessary (which is a big undertaking I'd prefer to avoid).</p>\n\n<p>The following is the stack trace:</p>\n\n<p><code>WCF Error:    at System.Collections.Generic.List1.Enumerator.MoveNextRare()\n   at WriteArrayOfLineToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , CollectionDataContract )\n   at System.Runtime.Serialization.CollectionDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerializeReference(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)\n   at WriteLineGroupToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )\n   at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithoutXsiType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle declaredTypeHandle)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerialize(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.InternalSerializeReference(XmlWriterDelegator xmlWriter, Object obj, Boolean isDeclaredType, Boolean writeXsiType, Int32 declaredTypeID, RuntimeTypeHandle declaredTypeHandle)\n   at WriteLineToXml(XmlWriterDelegator , Object , XmlObjectSerializerWriteContext , ClassDataContract )\n   at System.Runtime.Serialization.ClassDataContract.WriteXmlValue(XmlWriterDelegator xmlWriter, Object obj, XmlObjectSerializerWriteContext context)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeAndVerifyType(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, Boolean verifyKnownType, RuntimeTypeHandle declaredTypeHandle, Type declaredType)\n   at System.Runtime.Serialization.XmlObjectSerializerWriteContext.SerializeWithXsiTypeAtTopLevel(DataContract dataContract, XmlWriterDelegator xmlWriter, Object obj, RuntimeTypeHandle originalDeclaredTypeHandle, Type graphType)\n   at System.Runtime.Serialization.DataContractSerializer.InternalWriteObjectContent(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n   at System.Runtime.Serialization.DataContractSerializer.InternalWriteObject(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n   at System.Runtime.Serialization.XmlObjectSerializer.WriteObjectHandleExceptions(XmlWriterDelegator writer, Object graph, DataContractResolver dataContractResolver)\n   at System.Runtime.Serialization.XmlObjectSerializer.WriteObject(XmlDictionaryWriter writer, Object graph)\n   at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameterPart(XmlDictionaryWriter writer, PartInfo part, Object graph)\n   at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeParameter(XmlDictionaryWriter writer, PartInfo part, Object graph)\n   at System.ServiceModel.Dispatcher.DataContractSerializerOperationFormatter.SerializeBody(XmlDictionaryWriter writer, MessageVersion version, String action, MessageDescription messageDescription, Object returnValue, Object[] parameters, Boolean isRequest)\n   at System.ServiceModel.Dispatcher.OperationFormatter.SerializeBodyContents(XmlDictionaryWriter writer, MessageVersion version, Object[] parameters, Object returnValue, Boolean isRequest)\n   at System.ServiceModel.Dispatcher.OperationFormatter.OperationFormatterMessage.OperationFormatterBodyWriter.OnWriteBodyContents(XmlDictionaryWriter writer)\n   at System.ServiceModel.Channels.BodyWriter.WriteBodyContents(XmlDictionaryWriter writer)\n   at System.ServiceModel.Channels.BodyWriterMessage.OnWriteBodyContents(XmlDictionaryWriter writer)\n   at System.ServiceModel.Channels.Message.OnWriteMessage(XmlDictionaryWriter writer)\n   at System.ServiceModel.Channels.Message.WriteMessage(XmlDictionaryWriter writer)\n   at System.ServiceModel.Channels.BufferedMessageWriter.WriteMessage(Message message, BufferManager bufferManager, Int32 initialOffset, Int32 maxSizeQuota)\n   at System.ServiceModel.Channels.BinaryMessageEncoderFactory.BinaryMessageEncoder.WriteMessage(Message message, Int32 maxMessageSize, BufferManager bufferManager, Int32 messageOffset)\n   at System.ServiceModel.Channels.FramingDuplexSessionChannel.EncodeMessage(Message message)\n   at System.ServiceModel.Channels.FramingDuplexSessionChannel.OnSend(Message message, TimeSpan timeout)\n   at System.ServiceModel.Channels.OutputChannel.Send(Message message, TimeSpan timeout)\n   at System.ServiceModel.Dispatcher.DuplexChannelBinder.DuplexRequestContext.OnReply(Message message, TimeSpan timeout)\n   at System.ServiceModel.Channels.RequestContextBase.Reply(Message message, TimeSpan timeout)\n   at System.ServiceModel.Dispatcher.ImmutableDispatchRuntime.Reply(MessageRpc&amp; rpc)</code></p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13024787,"title":"Creating a timer with ScheduledExecutorService","body":"<p>So I'm trying to figure out how to create a timer, I came across this:\n<a href=\"http://stackoverflow.com/questions/3104088/using-scheduledexecutorservice-to-start-and-stop-timer\">using ScheduledExecutorService to start and stop timer</a></p>\n\n<p>The example they have seems to work pretty well. I'm just wondering if I'm utilizing this correctly:</p>\n\n<pre><code>  public class TimerTest \n{\n  private ScheduledExecutorService  es = null;\n  private  boolean timeIsUp = false;\n  private ScheduledFuture futureHandler = null;\n  private  TimeKeeper timeKeeper = null;\n  private  String subject = \"\";\n  private  int siteNo;\n  private  long time; \n  private  boolean stop;\n\n\n\n\npublic  void endTimer()\n{\n    System.out.println(\"we should shutdown everything here\");\n    es.shutdownNow();\n}\n\npublic  boolean stopTimer()\n{\n\n    if (timeKeeper != null)\n    {\n        timeKeeper.deactivate();\n    }\n    futureHandler.cancel(true);\n return true;\n\n}\npublic  boolean isTimeup()\n{\n    return timeKeeper.isTimeUp();\n}\npublic void startTimer(long mseconds, String subj, int sNo)\n{\n    subject = subj;\n    siteNo = sNo;\n    time = mseconds;\n    timeKeeper = new TimeKeeper();\n    callScheduler(mseconds);\n\n}\n\npublic  boolean isTimerRunning()\n{\n    return (es.isShutdown() || es == null);\n\n}\npublic void resetTimer(long t)\n {\n    stopTimer();\n    callScheduler(t);\n }\n\npublic  void resetTimer()\n{\n\n   resetTimer(time);  \n}\n\nprivate  void callScheduler(long mseconds)\n{\n    if (es == null)\n        es = Executors.newScheduledThreadPool(3);\n    timeKeeper = new TimeKeeper();\n    futureHandler = es.schedule( timeKeeper, mseconds, TimeUnit.MILLISECONDS);\n\n}\n\n\nprivate class TimeKeeper implements Runnable  {\n    //volatile for thread-safety\n\n    private volatile boolean isActive = true;  \n    private volatile boolean isTimeUp = false;\n    public void run ()   {  \n        if (isActive){\n            callAlert();\n            isTimeUp = true;\n        }\n    }  \n    public void deactivate(){\n        isActive = false;\n    }\n\n    public boolean isTimeUp()\n    {\n        return isTimeUp;\n    }\n    private void callAlert()\n    {\n        System.out.println(\"you are in the callAlert method\");\n    }\n  }\n\n }\n</code></pre>\n\n<p>And here is the Test:</p>\n\n<pre><code> public static void main(String[] args) {\n    // TODO Auto-generated method stub\n     long pastTime = System.currentTimeMillis();\n     TimerTest timer = new TimerTest();\n    timer.startTimer(15000, \"bh\", 1);\n    long time;\n    int count =0;\n    boolean stop = false;\n    while(true)\n    {\n\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n        time = System.currentTimeMillis() - pastTime;\n\n        if (time &gt; 3000)\n        {\n            if (!stop){\n                System.out.println(\"we are reseting the timer\");\n                timer.resetTimer(4000);\n\n                timer.stopTimer();\n                try {\n                    Thread.sleep(3995);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n                break;\n\n            }\n            stop = true;\n\n\n        }\n        if (timer.isTimeup())\n        {\n            System.out.println(\"our time is up\");\n            timer.endTimer();\n            break;\n        }\n        if (!stop)\n            System.out.println(\"hello\");\n        else\n        {\n            if (count == 0)\n                System.out.println(\"we wait 10 seconds from now\");\n            count++;\n        }\n\n\n    }\n    timer.resetTimer(1200);\n    while (true)\n    {\n        if (timer.isTimeup())\n        {\n            timer.isTimeup();\n            System.out.println(\"breaking after time is up\");\n            break;\n        }\n    }\n    timer.endTimer();\n\n}\n</code></pre>\n\n<p>This seems to work, I'm might of missed something that I need, this is my first time working with the ScheduledExecutorService Do you guys see any problems with this code? \nI don't want there to be conflict with thread collision. </p>\n"},{"tags":["c#","multithreading","httpclient"],"answer_count":3,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":2712,"score":6,"question_id":2960056,"title":"Trying to run multiple HTTP requests in parallel, but being limited by Windows (registry)","body":"<p>I'm developing an application (winforms C# .NET 4.0) where I access a lookup functionality from a 3rd party through a simple HTTP request. I call an url with a parameter, and in return I get a small string with the result of the lookup. Simple enough.</p>\n\n<p>The challenge is however, that I have to do lots of these lookups (a couple of thousands), and I would like to limit the time needed. Therefore I would like to run requests in parallel (say 10-20). I use a ThreadPool to do this, and the short version of my code looks like this:</p>\n\n<pre><code>public void startAsyncLookup(Action&lt;LookupResult&gt; returnLookupResult)\n{\n this.returnLookupResult = returnLookupResult;\n\n foreach (string number in numbersToLookup)\n {\n  ThreadPool.QueueUserWorkItem(lookupNumber, number);\n }\n}\n\npublic void lookupNumber(Object threadContext)\n{\n string numberToLookup = (string)threadContext;\n string url = @\"http://some.url.com/?number=\" + numberToLookup;\n\n WebClient webClient = new WebClient();\n Stream responseData = webClient.OpenRead(url);\n\n LookupResult lookupResult = parseLookupResult(responseData);\n returnLookupResult(lookupResult);\n}\n</code></pre>\n\n<p>I fill up <code>numbersToLookup</code> (a <code>List&lt;String&gt;</code>) from another place, call <code>startAsyncLookup</code> and provide it with a call-back function <code>returnLookupResult</code> to return each result. This works, but I found that I'm not getting the throughput I want.</p>\n\n<p>Initially I thought it might be the 3rd party having a poor system on their end, but I excluded this by trying to run the same code from two different machines at the same time. Each of the two took as long as one did alone, so I could rule out that one.</p>\n\n<p>A colleague then tipped me that this might be a limitation in Windows. I googled a bit, and found amongst others <a href=\"http://www.pctools.com/guides/registry/detail/536/\">this post</a> saying that by default Windows limits the number of simultaneous request to the same web server to 4 for HTTP 1.0 and to 2 for HTTP 1.1 (for HTTP 1.1 this is actually according to the specification (RFC2068)).</p>\n\n<p>The same post referred to above also provided a way to increase these limits. By adding two registry values to <code>[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]</code> (MaxConnectionsPerServer and MaxConnectionsPer1_0Server), I could control this myself.</p>\n\n<p>So, I tried this (sat both to 20), restarted my computer, and tried to run my program again. Sadly though, it didn't seem to help any. I also kept an eye on the Resource Monitor (<a href=\"http://img708.imageshack.us/img708/2306/resourcemonitor.jpg\">see screen shot</a>) while running my batch lookup, and I noticed that my application (the one with the title blacked out) still only was using two TCP connections.</p>\n\n<p>So, the question is, why isn't this working? Is the post I linked to using the wrong registry values? Is this perhaps not possible to \"hack\" in Windows any longer (I'm on Windows 7)?</p>\n\n<p>Any ideas would be highly appreciated :)</p>\n\n<p>And just in case anyone should wonder, I have also tried with different settings for MaxThreads on ThreadPool (everyting from 10 to 100), and this didn't seem to affect my throughput at all, so the problem shouldn't be there either.</p>\n"},{"tags":["python","windows","multithreading","python-3.x"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":195,"score":2,"question_id":6244401,"title":"Are there any reasons not to mix Multiprocessing and Threading module in Python","body":"<p>I am considering using Python to implement a program, which requires extensive multi-threading. Another requirement is that it will run on desktops, so having many processes, will make the application appear to be messy and harder to kill (in Task Manager). Therefore, I am considering using both the Threading and the Multiprocessing modules to reduce the number of processes. As far as I understand the GIL will apply only to a single process. My question is: Is there any reasons not to mix using the two modules? </p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13022049,"title":"To change properites of control in another thread out of Main (UI) thread","body":"<p>I'm now implementing the network program using the namedpipe and C#. Within the server program's main method, I started one thread named \"ReadingMessage\" which is to read the messages from the client program. In this thread, it needs to change the properties of controls (Text of textbox, Position of labels, etc.) based on the messages returned from the client. Therefore, it had cross-threaded errors in this procedure (\"ReadingMesssage between UI thread\"). I found out that there are two ways to solve this problem </p>\n\n<ol>\n<li>Invoke the controls using Delegate</li>\n<li>Form.CheckForIllegalCrossThreadCalls = false;</li>\n</ol>\n\n<p>I tested both of them but there is one problem. When the form started as first time, the properties of control are changed without any errors. When the form is closed and started again as second time, the properties of control are not changed and any error messages are not shown. I catch the breakpoint to the code where the properties of controls are instructed to change. The code run smoothly but the problem still occurs.</p>\n\n<p>I don't know what's that problem. Therefore, if anyone knows this problem, please suggest me...</p>\n\n<p><strong>Update: (Posting Code and Correcting some errors in my first question)</strong></p>\n\n<p>The thread <strong>is not in the main method</strong> of server program. I was wrong because I wanted to describe my question in short. Now, I will describe my question in more detail. There is one button click event in the main form of server program. </p>\n\n<pre><code>//Main Form\npublic partial class MainForm : Form\n{\n    private void btnButton_Click(object sender, EventArgs e)\n    {\n       AnotherForm aform = new AnotherForm(); //This is the form where threading run\n       aform.show();    \n    }\n}\n\n//AnotherForm\npublic partial class AnotherForm : Form\n{\n    private void CargoLoading_Load(object sender, EventArgs e)\n    {\n        (new System.Threading.Thread(readingMessage)).Start(myPipe);    \n    }\n}\n\nprivate void readingMessage(Object myPipeObject) //Read the messages send from the client machine\n{\n     while (true)\n     {\n         //Code of serverstream\n         SetTextofTextBox1(\"AnyText\"); //Code where the properties of control are instructed to change\n     }\n}\n\nprivate void SetTextofTextBox1(string text)\n{\n     if (this.txtTextBox1.InvokeRequired) //the debugger return false at second time of this form is opened\n     {\n         SetTextCallback d = new SetTextCallback(SetTextofTextBox1);\n         this.Invoke(d, new object[] { text });\n     }\n     else\n     {\n          this.txtTextBox1.Text = text;\n          this.txtTextBox1.Update();\n     }\n}\n</code></pre>\n\n<p>That's all the code where problem occur. When \"AnotherForm\" is open as first time, it's OK. But it is opened again as second time, the properties of control (text of TextBox1) is not effected and not changed. At there, I noticed that the debugger return false to <code>Control.InvokeRequired</code> at this second time. Really sorry for all for long question because I'm a novice as a programmer.</p>\n\n<p>Still expecting your suggestions...</p>\n\n<p><strong>Update 2:</strong> </p>\n\n<p>Finally I tried all the ways but it doesn't come out the best solution. Therefore, I would like to suggest all to just avoid this condition and re-write some of your code in another concept when u meet this situation like me.</p>\n"},{"tags":["objective-c","multithreading","cocoa","nsoperation"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":411,"score":2,"question_id":4812173,"title":"Why NSOperation uses 100% CPU cycle when not doing anything?","body":"<p>I just ran into a weird behaviour with NSOperation that I fixed but do not understand. </p>\n\n<p>I subclassed NSOperation by following the documentation. When I use the main method below, the application will use 100% or more of the CPU time.</p>\n\n<pre><code>-(void)main \n{\n    @try \n    {\n        NSAutoreleasePool* pool = [[NSAutoreleasePool alloc] init];\n\n        //Cycle forever until told to cancel\n        while (![self isCancelled])\n        {\n\n        }\n\n        [pool release];\n    }\n    @catch(...) \n    {\n        // Do not rethrow exceptions.\n    }\n\n    //Finish executing\n    [self completeOperation]; //Send notificatios using KVO\n}\n</code></pre>\n\n<p>Conversely when I use the following main method, the application uses 3% of the CPU time.</p>\n\n<pre><code>-(void)main \n{\n    @try \n    {\n        NSAutoreleasePool* pool = [[NSAutoreleasePool alloc] init];\n\n        //Create the initial delayed timers\n        NSTimer *startUpTimer = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(timerFireMethod:) userInfo:nil repeats:YES];\n\n        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];\n        [runLoop addTimer:startUpTimer forMode:NSRunLoopCommonModes];\n        [runLoop run];\n\n        //Cycle forever until told to cancel\n        while (![self isCancelled])\n        {\n\n        }\n\n        [pool release];\n    }\n    @catch(...) \n    {\n        // Do not rethrow exceptions.\n    }\n\n    //Finish executing\n    [self completeOperation]; //Send notificatios using KVO\n}\n</code></pre>\n\n<p>This strange behaviour appears to be attributed to the timer. If the timer is asked to not repeat itself, the application uses 100% CPU time, but if the timer is asked to repeat itself, then the CPU usage is normal.</p>\n\n<p>It appears that when nothing is running on the thread, the CPU usage is really high (I would assume it would be the opposite). Any suggestions on why this is the case? </p>\n\n<p>Thanks. </p>\n"},{"tags":["c","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13021015,"title":"Passing a parameter to threads in a loop","body":"<p>I need to create 10 threads and print out the threadId with which thread printed.</p>\n\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\nDWORD WINAPI xprint(LPVOID Param)\n{\nDWORD tID = GetCurrentThreadId();\nint count = *(int*)Param + 1;\n\nfprintf(stderr, \"Thread Number:%d ThreadID:%d\\n\", count, tID);\n\nreturn 0;\n}\n\nint main ()\n{\n   DWORD ThreadID[10];\n   HANDLE ThreadHandle[10];\n   int i;\n\n   for(i=0; i&lt;10; i++){\n\n    ThreadHandle[i] = CreateThread(\n      NULL,\n          0,\n          xprint,\n          &amp;i,\n          0,\n          &amp;ThreadID[i]);\n\n    if (ThreadHandle[i] == NULL) {\n        fprintf(stderr,\"Can't create thread!\\n\");\n        return -1;\n        }\n    }\n\n    for (i=0; i&lt;10; i++){\n            WaitForSingleObject(ThreadHandle[i],INFINITE);\n        CloseHandle(ThreadHandle[i]);\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Thread Number:1 ThreadID:4952\nThread Number:1 ThreadID:5284\nThread Number:1 ThreadID:5084\nThread Number:1 ThreadID:5656\nThread Number:1 ThreadID:5292\nThread Number:1 ThreadID:3072\nThread Number:1 ThreadID:5904\nThread Number:1 ThreadID:3620\nThread Number:1 ThreadID:6056\nThread Number:1 ThreadID:5676\n</code></pre>\n\n<p>I don't know where i did wrong.\nmy desired output should look something like this.</p>\n\n<p>output:</p>\n\n<pre><code>Thread Number:10 ThreadID:4952\nThread Number:8 ThreadID:5284\nThread Number:3 ThreadID:5084\nThread Number:9 ThreadID:5656\nThread Number:1 ThreadID:5292\nThread Number:2 ThreadID:3072\nThread Number:5 ThreadID:5904\nThread Number:6 ThreadID:3620\nThread Number:4 ThreadID:6056\nThread Number:7 ThreadID:5676\n</code></pre>\n\n<p>The Thread Number should be *out of order.</p>\n\n<p><em>*</em> After posting this question i ran the program a few more times\noutput:</p>\n\n<pre><code>Thread Number:2 ThreadID:4500\nThread Number:7 ThreadID:5740\nThread Number:7 ThreadID:3772\nThread Number:1 ThreadID:4732\nThread Number:2 ThreadID:4252\nThread Number:2 ThreadID:4264\nThread Number:2 ThreadID:5544\nThread Number:2 ThreadID:4116\nThread Number:2 ThreadID:5240\nThread Number:2 ThreadID:4804\n</code></pre>\n\n<p>it seems like the thread number is random. but in any case, no same number should appear twice.</p>\n"},{"tags":["c","eclipse","multithreading","posix"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13022381,"title":"Not able to include pthread.h in Windows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2150938/can-i-get-cs-pthread-h-to-compile-in-windows\">Can I get C’s pthread.h to compile in Windows?</a>  </p>\n</blockquote>\n\n\n\n<p>I am using eclipse on Windows 7.I am trying multi threaded programming in C.But I am not able to include pthread.h.It says No such file or directory.It worked on another Windows 7 machine but does not seem to work on this one.Please help me out.</p>\n"},{"tags":["multithreading","silverlight","windows-phone-7","draw"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13012583,"title":"How to draw many polygons and polylines in sub thread in wp7","body":"<p>I am developing a Windows Phone App which needs draw a lot of polygons and polylines in runtime. </p>\n\n<p>I have searched the google and stackoverflow found that <code>Dispatcher.BeginInovoke()</code> can't satisfy my needs. Because I must create the <code>DependencyObject</code>s such as <code>Polygon</code> and <code>Polyline</code> in my non-UI thread. Can you help me? </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["python","multithreading","multiprocessing","bottle","tftpy"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13021762,"title":"Starting python bottle in a thread/Process and another daemon next to it","body":"<p>Ok, so this may be a little bit unorthodox or I'm just stupid or both :)</p>\n\n<p>I'm trying a very simple setup where I start a bottle server in one <code>Process</code> instance and start a smallish TFTP server in another instance.</p>\n\n<pre><code>#!/usr/bin/env python\nimport bottle\nimport sys\nimport tftpy\nfrom multiprocessing import Process\n\ndef main():\n    try:\n        t = Process(target=bottle.run(host='0.0.0.0', port=8080))\n        t.daemon = True\n        t.start()\n        t.join()\n        h = Process(target=tftpy.TftpServer('/srv/tftp').listen('0.0.0.0', 69))\n        h.start()\n        h.join()\n\n    except KeyboardInterrupt:\n        sys.stdout.write(\"Aborted by user.\\n\")\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>\n\n<p>Unless I'm totally crazy, I'd expect them to start up in parallel. In reality, what happens is that bottle starts and locks whole thing up. If I exit bottle, TFTP daemon starts.</p>\n\n<p>I also tried a similar approach with <code>threading</code> module, with about same results.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#","multithreading","serial-port"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":109,"score":2,"question_id":12913952,"title":"Retrieve multiple serial port in same time using background worker","body":"<p>i want to ask about read data from serial port using background worker. Is it possible to retrieve data from one serial port or more using one worker? I can retrieve data when only use one serial port in worker. When i use two or more ports, i can't retrieve data anymore (without error message). Here is my code :</p>\n\n<pre><code>  private void worker_DoWork(object sender, DoWorkEventArgs e)\n  {\n        String p = \"\";\n        String s = \"\";\n        Int32 b = 0;\n        MethodInvoker get_selectedPort = new MethodInvoker(() =&gt;\n            {\n                p = comboBoxPressure.SelectedItem.ToString();\n                s = comboBoxStrain.SelectedItem.ToString();\n                b = Convert.ToInt32(comboBoxBaudrate.SelectedItem.ToString());\n            });\n        this.Invoke(get_selectedPort);\n\n        SerialPort portPressure = new SerialPort();  // serial port 1\n        portPressure.PortName = p;\n        portPressure.BaudRate = b;\n        portPressure.Parity = Parity.None;\n        portPressure.StopBits = StopBits.One;\n        portPressure.DataBits = 8;\n        portPressure.Handshake = Handshake.None;\n\n        SerialPort portStrain = new SerialPort(); // serial port 2\n        portStrain.PortName = s;\n        portStrain.BaudRate = b;\n        portStrain.Parity = Parity.None;\n        portStrain.StopBits = StopBits.One;\n        portStrain.DataBits = 8;\n        portStrain.Handshake = Handshake.None;\n\n        try\n        {\n            portPressure.Open();\n            portStrain.Open();\n        }\n        catch (Exception error)\n        {\n            MessageBox.Show(\"Error while trying open serial port!\\r\\n\" + error.Message, \"COM Port Error\", MessageBoxButtons.OK, MessageBoxIcon.Error);\n            worker.CancelAsync();\n            return;\n        }\n\n        while (!worker.CancellationPending)\n        {               \n            System.Threading.Thread.Sleep(100);\n            this.dataPressure = portPressure.ReadExisting();\n            this.dataStrain = portStrain.ReadExisting();\n            BeginInvoke((Action)(() =&gt; updateData()));\n        }\n\n        portPressure.Close();\n        portStrain.Close();\n    }\n\n}\n</code></pre>\n"},{"tags":["c#","multithreading","variables","locking"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2842,"score":2,"question_id":4081986,"title":"Lock on a variable in multiple threads","body":"<p>I am very new to C# and I wanted to ask if I have this situation in MULTI THREADS (pseudo code):</p>\n\n<pre><code>public class ClassA\n{\n     ClassB c = new ClassB();\n     public void someMethod()\n     {\n          c.myVar = 1;\n          // Some other stuff\n          c.myVar = 0;\n     }\n}\n\npublic class ClassB\n{\n     private int myVar;\n\n     public void MethodA()\n     {\n        if(myVar = 1)\n              myVar = 0;\n     }\n}\n</code></pre>\n\n<p>If someMethod() and MethodA() can be active in separate threads, then MethodA() could evaluate the if statement as true; but before it sets myVar = 0 someMethod sets myVar = 0 making it incorrect to have set myVar to 0 in MethodA()!!</p>\n\n<p>Basically, how do I lock myVar: can I lock{} on myVar's property (set, get) or do I need to use Interlock (I have no experience yet of Interlock though)?</p>\n"},{"tags":[".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":13020764,"title":"Thread.Sleep() vs. Monitor.Wait/Monitor.Pulse","body":"<p>I have a windows service that can host one or more background threads.  Each background thread starts a polling loop to check for work.  I've been using the following pattern to implement the loop:</p>\n\n<pre><code>new Thread(DoWork).Start();\n\nprivate void DoWork()\n{\n    while(keepRunning)\n    {\n        Console.WriteLine(DateTime.Now);\n        Thread.Sleep(1000);\n    }\n}\n</code></pre>\n\n<p>I'm trying to find an alternative that will consume less CPU.  I've been able to achieve a polling loop using a Timer with a recursive method:</p>\n\n<pre><code>var timer = new Timer(WakeUp, null, Timeout.Infinite, 1000)\ntimer.Change(0, 1000);\n\nprivate void WakeUp(object state)\n{\n    lock (locker)\n        Monitor.Pulse(locker);\n}\n\nprivate void DoWork()\n{\n    lock (locker)\n    {\n        if (!keepRunning) return;\n        Console.WriteLine(DateTime.Now);\n        Monitor.Wait(locker);\n        DoWork();\n    }\n}\n</code></pre>\n\n<p>Are there any advantages to using one pattern over the other?  Is there a better pattern for setting up a polling loop in a background thread?</p>\n"},{"tags":["java","multithreading"],"answer_count":18,"favorite_count":98,"up_vote_count":188,"down_vote_count":0,"view_count":90018,"score":188,"question_id":541487,"title":"\"implements Runnable\" vs. \"extends Thread\"","body":"<p>From what time I've spent with threads in Java, I've found these two ways to write threads.</p>\n\n<pre><code>public class ThreadA implements Runnable {\n    public void run() {\n    \t//Code\n    }\n}\n//with a \"new Thread(threadA).start()\" call\n\n\npublic class ThreadB extends Thread {\n    public ThreadB() {\n    \tsuper(\"ThreadB\");\n    }\n    public void run() {\n    \t//Code\n    }\n}\n//with a \"threadB.start()\" call\n</code></pre>\n\n<p>Is there any significant difference in these two blocks of code?</p>\n"},{"tags":["android","multithreading","blackberry","android-asynctask","invokelater"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":91,"score":6,"question_id":12982021,"title":"Blackberry class equivalent to AsyncTask?","body":"<p>I searched a lot on this. But couldn't get a solution. </p>\n\n<p>My requirement is to have a thread (alive all the time) that maintains a socket connection between Blackberry device and a server and exchanges commands. Similar to request and response. My problem is that I need to have this thread running in the background all the time and keep the UI available to user. So, When there is a command from the server, this thread parses it and updates the UI and also if there's an action from the Blackberry user, it sends it to the server and server in turn handles it. </p>\n\n<p>I developed the same application in Android using <code>AsyncTask</code> and it's working excellent. But in Blackberry, as there's no such class, I used <code>invokeLater()</code> option. The communication works fine between Server and the BB device. But UI is frozen in BlackBerry. </p>\n\n<p>Anyone have any idea how to get this right?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13019773,"title":"Call class.method in new thread that requires a parameter","body":"<p>Okay so right now I have essentially this code:</p>\n\n<pre><code>class a {\n\npublic void ab() {\n    b thread = new b();\n     thread.bb(this);\n    }\n}\n\nclass b {\n\n    public void bb(a _a) {\n     //execute code here in new thread so ab can continue running\n    }\n}\n</code></pre>\n\n<p>However this doesn't open it in a new thread, and yes I did research this, all the solutions I found didn't leave any option to send a parameter (this) to the bb method</p>\n\n<p>How to call class.method in new thread that requires a parameter?</p>\n"},{"tags":["c++","multithreading","synchronization","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":78,"score":5,"question_id":13019532,"title":"pthreads: a thread that triggers other threads","body":"\n\n<p>Hello,\nI'm new to multi-thread programming.\nI'm trying to create a code that creates a thread THREAD1, that, after it has done something, it triggers two other threads, say THREAD2 and THREAD3, and then exits.</p>\n\n<p>I wrote two possible solutions.</p>\n\n<p>1) Use of condition variables (DOESN'T WORK: in some case I get a deadlock):</p>\n\n\n\n<pre class=\"lang-c prettyprint-override\"><code>pthread_mutex_t ready_mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t  ready_cond  = PTHREAD_COND_INITIALIZER;\nbool ready = false;\n\nvoid* trigger(void*);\nvoid* func1(void*);\nvoid* func2(void*);\n\nint main()\n{\n    pthread_t thread1;\n    pthread_t thread2;\n    pthread_t thread3;  \n    pthread_create(&amp;thread1, 0, &amp;trigger, 0);\n    pthread_create(&amp;thread2, 0, &amp;func1, 0);\n    pthread_create(&amp;thread3, 0, &amp;func2, 0);\n    pthread_join(thread1, 0);\n    pthread_join(thread2, 0);\n    pthread_join(thread3, 0);\n}\n\nvoid *trigger(void*)\n{\n    pthread_mutex_lock(&amp;ready_mutex);\n    ready = true;\n    pthread_cond_broadcast(&amp;ready_cond);\n    pthread_mutex_unlock(&amp;ready_mutex);\n    return 0;\n}\n\nvoid *func1(void*)\n{\n    while (!ready) // Needed to avoid spuriuos wake-up\n    {\n        pthread_mutex_lock(&amp;ready_mutex);\n        pthread_cond_wait(&amp;ready_cond, &amp;ready_mutex);\n        pthread_mutex_unlock(&amp;ready_mutex);\n    }\n    std::cout &lt;&lt; \"In 'func1'&gt;&gt; Do something\" &lt;&lt; std::endl;\n    return 0;\n}\n\nvoid *func2(void*)\n{\n    while (!ready) // Needed to avoid spuriuos wake-up\n    {\n        pthread_mutex_lock(&amp;ready_mutex);\n        pthread_cond_wait(&amp;ready_cond, &amp;ready_mutex);\n        pthread_mutex_unlock(&amp;ready_mutex);\n    }\n    std::cout &lt;&lt; \"In 'func2'&gt;&gt; Do something\" &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre>\n\n<p>2) THREAD1 directly creates the two other threads.</p>\n\n\n\n<pre class=\"lang-c prettyprint-override\"><code>pthread_mutex_t ready_mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t  ready_cond  = PTHREAD_COND_INITIALIZER;\n\npthread_t thread1;\npthread_t thread2;\npthread_t thread3;\n\nvoid* trigger(void*);\nvoid* func1(void*);\nvoid* func2(void*);\n\nint main()\n{\n    pthread_create(&amp;thread1, 0, &amp;trigger, 0);\n\n    pthread_join(thread1, 0);\n    pthread_join(thread2, 0);\n    pthread_join(thread3, 0);\n}\n\nvoid *trigger(void*)\n{\n    std::cout &lt;&lt; \"In 'trigger'&gt;&gt; Do something\" &lt;&lt; std::endl;\n\n    pthread_create(&amp;thread2, 0, &amp;func1, 0);\n    pthread_create(&amp;thread3, 0, &amp;func2, 0);\n\n    return 0;\n}\n\nvoid *func1(void*)\n{\n    std::cout &lt;&lt; \"In 'func1'&gt;&gt; Do something\" &lt;&lt; std::endl;\n\n    return 0;\n}\n\nvoid *func2(void*)\n{\n    std::cout &lt;&lt; \"In 'func2'&gt;&gt; Do something\" &lt;&lt; std::endl;\n\n    return 0;\n}\n</code></pre>\n\n<p>I would like to know your opinion.\nThank you very much</p>\n"},{"tags":["java","multithreading","session","timeout","idle"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13002283,"title":"Session - timeout - idle handling Multi-treads in Java","body":"<p>I am trying to get my head around session - timeout - idle handling Multi-treads in Java.</p>\n\n<p>I have a server &amp; client application comunicating via telnet where I need to check if the user has been typing (anything), clicking (anywhere), or moved the mouse  within a periode of time. </p>\n\n<p>If not, the user will be prompted with a dialog box, asking if he wants to conntinue session or not. ...(and If not, the user will automatically be logged out within the next minute or so.)</p>\n\n<p>My application has multiple threads. ( - One user per thread). So I am not sure how to approatch this the best (<strong>and easiest</strong>) way?</p>\n\n<p>I know it is a wide and far-fetched question, but I was hoping some of you could give me a pointer or tip in the right direction... :) </p>\n\n<p>I was kind of hoping for a simple method that could check:\n(a bit pseudo code on the fly:)</p>\n\n<pre><code>if (idle = true){\ntimer.start();\nif (timer &gt; 120sec)\ndisplayWaringJFrame(\"Continue Session?  - YES or NO ?)\ndisplayTimer.start();\nif (displayTimer &gt; 30sec)\napplication.user.closeSession()\n</code></pre>\n\n<p>...or something like that! :)</p>\n"},{"tags":["java","multithreading","synchronization","mutex","semaphore"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13017683,"title":"A Mutex for inter-threading usages in Java?","body":"<p>I want a Mutex in Java which let me to wait on it in a thread and release it in another thread. I know that I can use a Semaphore with capacity of 1 but the problem is that the \"acquire()\" method throws \"InterruptedException\". Is there any special synchronization way for this purpose in Java?</p>\n"},{"tags":["c","multithreading","operating-system","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":12964325,"title":"pthreads: using multiple threads to calculate successive prime numbers","body":"<p>I am trying to get the example code to work such that multiple threads will calculate the sum of successive prime numbers (note that the original author's algorithm for successive prime calculation is very inefficient). So far, running unit tests shows that the output is inconsistent, i.e. it will change slightly each time I run the program. I will post the modified source code in C, along with output for debugging purposes.</p>\n\n<p>Source:</p>\n\n<pre><code>/************************************************************************\n * Code listing from \"Advanced Linux Programming,\" by CodeSourcery LLC  *\n * Copyright(C) 2001 by New Riders Publishing                           *\n * See COPYRIGHT for license information.                               *\n ***********************************************************************/\n\n/*\n * Modified By : Dylan Gleason\n * Class       : CST 352 - Operating Systems\n * Date        : 10/18/2012\n */\n\n#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\n#define DEBUG 0  /* Set to 1 to enable debug statements */\n\n/* global variables to be accessed by each thread */\nint current_sum = 2;\nint primes_to_compute = 0;\n\n/* create mutex for ensuring serial access to global data */\nint thread_flag;\npthread_cond_t cond;\npthread_mutex_t lock;\n\n/* print the thread info for debugging purposes */\nvoid print_thread_info() \n{\n   printf(\"Current thread ID        : %u\\n\",(unsigned int*)pthread_self());\n   printf(\"Current sum of primes    : %d\\n\", current_sum);\n   printf(\"Current prime to compute : %d\\n\\n\", primes_to_compute);\n}\n\n/* initialize the mutex and return an integer value to determine if\n   initialization failed or not */\nint initialize_mutex()\n{\n   int success = 1;\n\n   if(pthread_mutex_init(&amp;lock, NULL) == 0 &amp;&amp;\n      pthread_cond_init(&amp;cond, NULL) == 0)\n      success = 0;\n   thread_flag = 0;\n\n   return success;\n}\n\n/* set the value of the wait thread flag to the value which the client\n   passes */\nvoid set_thread_flag(int is_waiting)\n{\n   pthread_mutex_lock(&amp;lock);   /* lock mutex */\n\n   /* set the wait flag value, and then signal in case the prime\n      function is blocked, waiting for flag to become set. However,\n      prime function can't actually check flag until the mutex is\n      unlocked */\n   thread_flag = is_waiting;\n   pthread_cond_signal(&amp;cond);   \n   pthread_mutex_unlock(&amp;lock); /* unlock mutex */\n}\n\nvoid in_wait()\n{\n   while(!thread_flag)\n      pthread_cond_wait(&amp;cond, &amp;lock);\n}\n\n\n/* Compute successive prime numbers(very inefficiently). Return the\n   Nth prime number, where N is the value pointed to by *ARG. */\nvoid* compute_prime(void* arg)\n{   \n   while(1)\n   {\n      pthread_mutex_lock(&amp;lock);\n      in_wait();\n      pthread_mutex_unlock(&amp;lock);\n\n      int sum;\n      int factor;\n      int is_prime = 1;\n\n      set_thread_flag(0);\n      pthread_mutex_lock(&amp;lock);\n      sum = current_sum;\n\n      if(DEBUG)\n      {\n         printf(\"First lock\\n\");\n         print_thread_info();\n      }\n\n      pthread_mutex_unlock(&amp;lock);\n      set_thread_flag(1);          /* tell next thread to go! */\n\n      /* wait until ready-flag is released from current thread */\n      pthread_mutex_lock(&amp;lock);\n      in_wait();\n      pthread_mutex_unlock(&amp;lock);\n\n      /* Test primality by successive division. */\n      for(factor = 2; factor &lt; sum; ++factor)\n      {  \n         if(sum % factor == 0)\n         {\n            is_prime = 0;\n            break;\n         }\n      }\n\n      /* Is this the prime number we're looking for? */\n      if(is_prime)\n      {\n         int number;\n\n         set_thread_flag(0);\n         pthread_mutex_lock(&amp;lock);\n\n         /* only decrement primes_to_compute if is greater than zero! */\n         if(primes_to_compute &gt; 0)\n         {\n            --primes_to_compute;\n         }       \n         if(DEBUG)\n         {\n            printf(\"Second lock\\n\");\n            print_thread_info();\n         }\n\n         number = primes_to_compute;\n         pthread_mutex_unlock(&amp;lock);\n         set_thread_flag(1);\n\n         pthread_mutex_lock(&amp;lock);\n         in_wait();\n         pthread_mutex_unlock(&amp;lock);\n\n         if(number  == 0)\n         {\n            set_thread_flag(0);\n            pthread_mutex_lock(&amp;lock);\n            void* sum =(void*) current_sum;\n\n            if(DEBUG)\n            {\n               printf(\"Third lock\\n\");         \n               print_thread_info();\n            }\n\n            pthread_mutex_unlock(&amp;lock);\n            set_thread_flag(1);\n            return sum;\n         }\n      }\n\n      set_thread_flag(0);\n      pthread_mutex_lock(&amp;lock);\n      ++current_sum;\n\n      if(DEBUG)\n      {\n         printf(\"Fourth lock\\n\");\n         print_thread_info();\n      }\n\n      pthread_mutex_unlock(&amp;lock);\n      set_thread_flag(1);\n   }\n\n   return NULL;\n}\n\nint main(int argc, char* argv[])\n{\n   int prime;\n   pthread_t tid[5];   \n\n   /* Check command-line argument count */\n   if(argc != 2)\n   {\n      printf(\"Error: wrong number of command-line arguments\\n\");\n      printf(\"Usage: %s &lt;integer&gt;\\n\", argv[0]);\n      exit(1);\n   }\n\n   /* Check to see if mutex initialized correctly */\n   if(initialize_mutex() != 0)\n   {\n      printf(\"Mutex initialization failed.\\n\");\n      exit(1);\n   }\n\n   primes_to_compute = atoi(argv[1]);\n   printf(\"Successive primes to be computed: %d\\n\\n\", primes_to_compute);\n\n   /* Execute five different threads to calculate the prime summation */\n   int t = 0;\n   set_thread_flag(1);\n\n   for(t; t &lt; 5; ++t)\n      pthread_create(&amp;tid[t], NULL, &amp;compute_prime, NULL);\n\n   /* Wait for the prime number thread to complete, then get result. */\n   t = 0;\n   for(t; t &lt; 5; ++t)\n      pthread_join(tid[t],(void*) &amp;prime);\n\n   /* Print the largest prime it computed. */\n   printf(\"The %dth prime number is %d.\\n\", atoi(argv[1]), prime);\n\n   return 0;\n}\n</code></pre>\n\n<p>Unit test (executing program five times):</p>\n\n<pre><code>Test successive primes up to 100:\n\nSuccessive primes to be computed: 100\nThe 100th prime number is 547.\n\nSuccessive primes to be computed: 100\nThe 100th prime number is 521.\n\nSuccessive primes to be computed: 100\nThe 100th prime number is 523.\n\nSuccessive primes to be computed: 100\nThe 100th prime number is 499.\n\nSuccessive primes to be computed: 100\nThe 100th prime number is 541.\n</code></pre>\n\n<p>Note that the output of non-threaded version if the number for successive primes to calculate is <code>100</code>, the result will always be <code>541</code>. Clearly I am not able to grok the correct usage of the mutexes above - if someone has more experience in this area I would be very grateful! Also, <strong>please note</strong> that I am not concerned with the efficiency/correctness of the actual prime number algorithm, but rather the algorithm for making sure that the threads execute properly with consistent results.</p>\n"},{"tags":["multithreading","perl","file","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13009209,"title":"Using semaphores while modyifing file in perl","body":"<p>I'm kind of newbie to threads in perl.</p>\n\n<p>I have a file with a list of projects (each project is in a separate line), and i want to build those projects in parallel. \nCurrently, each thread:</p>\n\n<ol>\n<li>opens the file as \"read\" mode</li>\n<li>saves a list of some projects (= some file lines)</li>\n<li>closes the file</li>\n<li>opens the file again- as \"write\" mode</li>\n<li>rewrites it without the lines that were selected</li>\n</ol>\n\n<p>in order to make sure each thread is the only one to access the file, im trying to use semaphore.</p>\n\n<p>for some reason, threads collisons are occurred, and i can't figure out what am i doing wrong.</p>\n\n<p>i can see (in my \"REPORT\" which also gets the current time for each build) \nthat deifferent threads select the same projects from the \"shared\" file (it happens only once in a while, but still..)</p>\n\n<p>i'm not even sure if my $semaphore decleration is legal as \"my\" variable.</p>\n\n<p>Any help would be truly appreciated!! </p>\n\n<p>Thanks.</p>\n\n<hr>\n\n<p>here's a part of my code:</p>\n\n<pre><code>    my $semaphore = Thread::semaphore-&gt;new() ;\n\nsub build_from_targets_list{\n\n    #...\n    open(REPORT, \"+&gt;$REPORT_tmp\");  # Open for output\n    #....\n    @threads =();\n\n\n    for ($i = 0; $i &lt; $number_of_cores; $i++){\n        my $thr = threads-&gt;new(\\&amp;compile_process, $i,*REPORT);\n        push @threads, $thr;\n    }\n\n    $_-&gt;join for @threads;\n    close (REPORT);\n}\n### Some stuff..\n\n\nsub compile_process{\n\n    *REPORT = shift(@_);\n    #...\n\n    while (1){\n        $semaphore-&gt;down();\n        open (DATA_FILE, $shared_file);\n        flock(DATA_FILE, 2);\n        while ($record = &lt;DATA_FILE&gt;) {\n            chomp($record);\n            push(@temp_target_list,$record);    \n        }\n\n\n        # ... choose some lines (=projects)...\n        # remove the projects that should be built by this thread:\n        for ($k = 0; $k &lt; $num_of_targets_in_project; $k++){            \n            shift(@temp_target_list);\n\n        }\n\n        close(DATA_FILE);       \n        open (REWRITE,\"&gt;$shared_file\");\n\n        flock(REWRITE, 2);\n\n        seek(REWRITE, 0, 0); \n        foreach $temp_target (@temp_target_list){\n\n            print REWRITE \"$temp_target\\n\";\n\n        }\n\n        close (REWRITE);\n\n        ## ... BUILD selected projects...\n\n        $semaphore-&gt;up();\n        }\n}\n</code></pre>\n"},{"tags":["java","multithreading","servlets","asynchronous"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13017685,"title":"Perform Asynchronus db tasks in java servlet application","body":"<p>I have a jsp/servlet based web app.</p>\n\n<p>I have a button <strong>\"Clean Up\"</strong> which calls a servlet and the request goes till DAO class.DAO class performs different DB activities like, moving data from Master table to backup table, then deleting data from master table etc.</p>\n\n<p>As of now this activity is Synchronous and user needs to wait until a response is sent.</p>\n\n<p>I want to implement the same scenario as an Asynch task with user just getting a message as \n\" Clean Up Activities Triggered\" </p>\n\n<p>What could be the best/easiest way to perform this task.  I cannot use scheduler.</p>\n\n<p>My Container is TomCat. </p>\n"},{"tags":["ios","multithreading","animation","multiple","flip"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13016543,"title":"Multiple flip animation not working","body":"<p>I'm having a trouble with something weird. I'm trying to create a grid of UIViews flipping endlessly. For this purpose, I created the following class:</p>\n\n<pre><code>@implementation LMFlipViewController\n\n@synthesize viewOne=_viewOne, viewTwo=_viewTwo, animationDuration=_animationDuration, pause=_pause, animationFlag=_animationFlag;\n\n-(LMFlipViewController *)initWithViewOne:(UIView *)viewOne viewTwo:(UIView *)viewTwo animationDuration:(CGFloat)animationDuration andPauseInBetweenAnimation:(CGFloat)pause {\n    [super init];\n    [self.view setFrame:viewOne.bounds];\n    _viewOne=viewOne;\n    _viewTwo=viewTwo;\n    _animationDuration=animationDuration;\n    _pause=pause;\n    return self;\n}\n\n-(void)viewDidLoad{\n    [super viewDidLoad];\n    NSLog(@\"0\");\n    _animationFlag=NO;\n}\n\n-(void)viewDidUnload{\n    [super viewDidUnload];\n}\n\n-(void)viewWillAppear:(BOOL)animated {\n    [self.view addSubview:_viewOne];\n//    [self performSelector:@selector(loopAnimation) withObject:nil afterDelay:_pause];\n    [NSTimer scheduledTimerWithTimeInterval:_pause\n                                     target:self\n                                   selector:@selector(loopAnimation)\n                                   userInfo:nil\n                                    repeats:NO];\n    NSLog(@\"1\");\n}\n\n-(void)triggerAnimation {\n    NSLog(@\"5\");\n    if (_animationFlag) {\n        NSLog(@\"Animation flag: YES\");\n        _animationFlag=NO;\n        [UIView transitionWithView:self.view duration:_animationDuration options:(UIViewAnimationOptionTransitionFlipFromLeft) animations: ^{\n            [_viewTwo removeFromSuperview];\n        } completion:^(BOOL finished) {\n            [UIView transitionWithView:self.view duration:_animationDuration options:(UIViewAnimationOptionTransitionFlipFromLeft) animations: ^{\n                [self.view addSubview:_viewOne];\n            } completion:nil];\n        }];\n    }else{\n        NSLog(@\"Animation flag: NO\");\n        _animationFlag=YES;\n        [UIView transitionWithView:self.view duration:_animationDuration options:(UIViewAnimationOptionTransitionFlipFromLeft) animations: ^{\n            [_viewOne removeFromSuperview];\n        } completion:^(BOOL finished) {\n            [UIView transitionWithView:self.view duration:_animationDuration options:(UIViewAnimationOptionTransitionFlipFromLeft) animations: ^{\n                [self.view addSubview:_viewTwo];\n            } completion:nil];\n        }];\n    }\n    NSLog(@\"6\");\n}\n\n-(void)loopAnimation {\n    NSLog(@\"2\");\n    [self triggerAnimation];\n    NSLog(@\"3\");\n//    [self performSelector:@selector(loopAnimation) withObject:nil afterDelay:_pause];\n    [NSTimer scheduledTimerWithTimeInterval:_pause\n                                     target:self\n                                   selector:@selector(loopAnimation)\n                                   userInfo:nil\n                                    repeats:NO];\n    NSLog(@\"4\");\n}\n\n@end\n</code></pre>\n\n<p>Then, I've tried this class like this:</p>\n\n<pre><code>- (void)viewDidLoad {\n    [super viewDidLoad];\n    UIView *viewOne=[[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 50)];\n    viewOne.backgroundColor=[UIColor redColor];\n\n    UIView *viewTwo=[[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 50)];\n    viewTwo.backgroundColor=[UIColor purpleColor];\n\n    LMFlipViewController *flipViewController=[[LMFlipViewController alloc] initWithViewOne:viewOne viewTwo:viewTwo animationDuration:0.5 andPauseInBetweenAnimation:3];\n    [self.view addSubview:flipViewController.view];\n\n    UIView *viewThree=[[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 50)];\n    viewThree.backgroundColor=[UIColor blackColor];\n\n    UIView *viewFour=[[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 50)];\n    viewFour.backgroundColor=[UIColor blueColor];\n\n    LMFlipViewController *flipViewControllerTwo=[[LMFlipViewController alloc] initWithViewOne:viewThree viewTwo:viewFour animationDuration:0.5 andPauseInBetweenAnimation:3];\n    [flipViewControllerTwo.view setFrame:CGRectMake(0, 60, 100, 50)];\n    [self.view addSubview:flipViewControllerTwo.view];\n}\n</code></pre>\n\n<p>This way worked perfectly. The point is, I need to instanciate several flip views this way and I need them implemented in a \"for\" loop. So I tried this:</p>\n\n<pre><code>- (void)viewDidLoad {\n    [super viewDidLoad];\n    for (int i=0;i&lt;2;i++) {\n        UIView *viewOne=[[UIView alloc] initWithFrame:CGRectMake(0, i*60, 100, 50)];\n        viewOne.backgroundColor=[UIColor redColor];\n\n        UIView *viewTwo=[[UIView alloc] initWithFrame:CGRectMake(0, i*60, 100, 50)];\n        viewTwo.backgroundColor=[UIColor purpleColor];\n\n        [self.view addSubview:[[LMFlipViewController alloc] initWithViewOne:viewOne viewTwo:viewTwo animationDuration:0.5 andPauseInBetweenAnimation:3].view];\n    }\n}\n</code></pre>\n\n<p>When I try with the loop, the first view is animating correctly but the others are not. The animation is just skipped and the view switch is made straight.</p>\n\n<p>Does anyone know why ? My guess would be it's a thread issue or something like this but I'm clueless about these stuffs. Any help is welcomed. Thx.</p>\n"},{"tags":["c++","multithreading","qt","http"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13017089,"title":"How to i create Qt multithreaded http client in which each thread invoke http request","body":"<p>after really allot of digging i unanable to create simple http client that invoking \nhttp request in each thread , \nnow i know that from version 4.8 each http request has its own thread . but this is now the case in my app.<br>\ni need to do more stuff in the thread like writing to file and preform calculation and manipulations on strings .<br>\nhow can i take simple example like in the  :<br>\n 4.8.2\\examples\\network\\http\\</p>\n"},{"tags":["java","multithreading","wait","synchronized","notify"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12945001,"title":"How to avoid race conditions on alternating synchronous threads?","body":"<p>I'm trying to remember my old CS days.</p>\n\n<p>Been trying to properly implement, with the lowest possible primitives, a pair of synchronized threads. Of course I should use better concurrency tools on production code (stuff from java.util.concurrency, probably). But hey, I'm doing this for the challenge. Here is my code (this is my first question, so if this is much too long, please forgive me):</p>\n\n<pre><code>public class Test {\n\n    public volatile Object locker1 = new Object();\n    public volatile Object locker2 = new Object();\n    public volatile Object locker3 = new Object();\n\n    public class MyRunnable2 implements Runnable {\n        public void run() {\n\n            System.out.println( \"MyRunnable2 started\" );\n\n\n\n            synchronized( locker3 ) {\n                    try {\n                        System.out.println( \"r2: waiting for locker3\" );\n                        locker3.wait();\n                        System.out.println( \"r2: got locker3\" );\n                    } catch ( java.lang.InterruptedException e ) {\n                        System.out.println( \"e: \" + e );\n                    }\n            }\n\n\n\n            for ( int c = 0; c &lt; 50; ++c ) {\n\n                synchronized( locker2 ) {\n\n                    try {\n                        System.out.println( \"r2: waiting for locker2\" );\n                        locker2.wait();\n                        System.out.println( \"r2: got locker2\" );\n                    } catch ( java.lang.InterruptedException e ) {\n                        System.out.println( \"e: \" + e );\n                    }\n                }\n\n                System.out.println( \"r2: \" + ( c ) );\n                try {\n                    Thread.sleep(1);\n                } catch ( Exception e ) {\n                }\n\n                synchronized( locker1 ) {\n                    System.out.println( \"r2: signaling locker1\" );\n                    locker1.notify();\n                    System.out.println( \"r2: locker1 signaled\" );\n                }\n            }\n        }\n    }\n\n    public class MyRunnable1 implements Runnable {\n        public void run() {\n            System.out.println( \"MyRunnable1 started\" );\n\n            synchronized( locker3 ) {\n                    try {\n                        System.out.println( \"r1: waiting for locker3\" );\n                        locker3.wait();\n                        System.out.println( \"r1: got locker3\" );\n                    } catch ( java.lang.InterruptedException e ) {\n                        System.out.println( \"e: \" + e );\n                    }\n            }\n\n            for ( int c = 0; c &lt; 50; ++c ) {\n\n\n                synchronized( locker1 ) {\n\n                    try {\n                        System.out.println( \"r1: waiting for locker1\" );\n                        locker1.wait();\n                        System.out.println( \"r1: got locker1\" );\n                    } catch ( java.lang.InterruptedException e ) {\n                        System.out.println( \"e: \" + e );\n                    }\n                }\n\n                System.out.println( \"r1: \" + ( c ) );\n                try {\n                    Thread.sleep(1);\n                } catch ( Exception e ) {\n                }\n\n                synchronized( locker2 ) {\n                    System.out.println( \"r1: signaling locker2\" );\n                    locker2.notify();\n                    System.out.println( \"r1: locker2 signaled\" );\n                }\n\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        Test t = new Test();\n        t.test();\n    }\n\n    public void test() {\n        MyRunnable1 r1 = new MyRunnable1();\n        MyRunnable2 r2 = new MyRunnable2();\n        Thread t1 = new Thread( r1 );\n        Thread t2 = new Thread( r2 );\n        t1.start();\n        t2.start();\n\n        try {\n            Thread.sleep(1000);\n        } catch ( Exception e ) {\n\n        }\n        synchronized( locker3 ) {\n            System.out.println( \"main: signaling locker3\" );\n            locker3.notifyAll();\n            System.out.println( \"main: locker3 signaled\" );\n        }\n\n        try {\n            Thread.sleep(1000);\n        } catch ( Exception e ) {\n\n        }\n\n        synchronized( locker1 ) {\n            System.out.println( \"main: signaling locker1\" );\n            locker1.notify();\n            System.out.println( \"main: locker1 signaled\" );\n        }\n\n\n        try {\n            t1.join();\n            t2.join();\n\n\n        } catch ( java.lang.InterruptedException e ) {\n            System.out.println( \"e: \" + e );\n        }\n    }\n}\n</code></pre>\n\n<p><strong>My question is</strong>: How can I avoid the race condition at Test.test()? Most of the time, this works - but I'm not satisfied with the sleep call.\nAlso, please, I ask you people to evaluate my style. I'm always open to self-improvement.</p>\n\n<p><strong>EDIT</strong>: Just to make it clearer. I want MyRunnable1 to always run first. Print a number and then wait for MyRunnable2 to print the same number. Then it would print a second number and then wait for MyRunnable2 again. And so on.</p>\n\n<p>I guess I can't comfortably use java.util.concurrency until I know what happens under the hood.</p>\n"},{"tags":["c#","java","multithreading","mono"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":13005326,"title":"Multithreading with Java / Benchmarking against Mono","body":"<p>I'm working on a simple benchmark testing out both Mono's ParallelFX against Java on several Linux boxes. The test for .NET runs great on Windows and Linux alike, but I'm having some kind of snag with the Java version...</p>\n\n<p>I can see the specified number of threads starting up, but they run in a strange fashion. It acts like they start up, but they finish very slowly. They continue to start, but take forever to finish. It seems like it should be exceeding the limit of the thread pool, and my CPU usage looks to me like it's only using one or two cores (I've got an i7 processor so something like 8 should try to be used).</p>\n\n<p>Yes, I know I am not being \"thread safe\" with my integers and probably other stuff too. I don't really care right now. Something larger is an issue here.</p>\n\n<h1>C# Version</h1>\n\n<pre><code>public class Program\n{\n    static void Main(string[] args)\n    {\n        const int numberOfCycles = 1000;\n        const int numbersPerCycle = 1000000;\n\n        Stopwatch swG = Stopwatch.StartNew();\n\n        int threadCount = 0;\n        int completeCount = 0;\n        Parallel.For(0, numberOfCycles, x =&gt;\n            {\n                Console.WriteLine(string.Format(\"Starting cycle {0}. Thread count at {1}\", x, threadCount++));\n\n                Random r = new Random();\n                Stopwatch sw = Stopwatch.StartNew();\n                List&lt;double&gt; numbers = new List&lt;double&gt;();\n                for (int i = 0; i &lt; numbersPerCycle; i++)\n                {\n                    numbers.Add(r.NextDouble() * 1000);\n                }\n                numbers.Sort();\n                double min = numbers.Min();\n                double max = numbers.Max();\n\n                completeCount++;\n                Console.WriteLine(string.Format(\"{0} cycles complete: {1:#,##0.0} ms. Min: {2:0.###}  Max: {3:0.###}\", completeCount, sw.ElapsedMilliseconds, min, max));\n                threadCount--;\n            });\n\n        Console.WriteLine(string.Format(\"All {0} cycles complete. Took {1:#,##0.0} ms.\", numberOfCycles, swG.ElapsedMilliseconds));\n        Console.WriteLine(\"Press any key to continue.\");\n        Console.ReadKey();\n    }\n}\n</code></pre>\n\n<h1>Java Version</h1>\n\n<p>P.S. I am lazy and stole the Stopwatch class from here: <a href=\"http://stackoverflow.com/questions/8255738/is-there-a-stopwatch-in-java\">Is there a stopwatch in java</a></p>\n\n<pre><code>public class JavaMonoTest {\n\n    static int threadCount = 0;\n    static int completeCount = 0;\n    static String CLRF = \"\\r\\n\";\n\n    public static void main(String[] args) throws IOException, InterruptedException {\n        final int numberOfCycles = 1000;\n        final int numbersPerCycle = 1000000;\n        final int NUM_CORES = Runtime.getRuntime().availableProcessors();\n\n        //Setup the running array\n        List&lt;Integer&gt; cyclesList = new LinkedList&lt;Integer&gt;();\n        for(int i = 0; i &lt; numberOfCycles; i++){\n            cyclesList.add(i);\n        }\n\n        Stopwatch swG = new Stopwatch();\n        swG.start();\n\n       ExecutorService exec = Executors.newFixedThreadPool(NUM_CORES);\n       try {\n           for (final Integer x : cyclesList) {\n               exec.submit(new Runnable() {\n                   @Override\n                   public void run() {\n                       System.out.printf(\"Starting cycle %s. Thread count at %s %s\", x, threadCount++, CLRF);\n\n                       Random r = new Random();\n                       Stopwatch sw = new Stopwatch();\n                       sw.start();\n                       List&lt;Double&gt; numbers = new LinkedList&lt;Double&gt;();\n                       for (int i = 0; i &lt; numbersPerCycle; i++)\n                       {\n                           numbers.add(r.nextDouble() * 1000);\n                       }\n                       Collections.sort(numbers);\n                       double min = Collections.min(numbers);\n                       double max = Collections.max(numbers);\n\n                       completeCount++;\n                       System.out.printf(\"%s cycles complete: %.2f ms. Min: %.2f  Max: %.2f %s\", completeCount, sw.getElapsedTime(), min, max, CLRF);\n                       threadCount--;\n                   }\n               });\n           }\n       } finally {\n           exec.shutdown();\n       }\n       exec.awaitTermination(1, TimeUnit.DAYS);\n\n        System.out.printf(\"All %s cycles complete. Took %.2f ms. %s\", numberOfCycles, swG.getElapsedTime(), CLRF);\n        System.out.println(\"Press any key to continue.\");\n        System.in.read();\n    }\n}\n</code></pre>\n\n<h1>Updated C# Version to Match Java Version In Answer</h1>\n\n<pre><code>public class Program\n{\n    static void Main(string[] args)\n    {\n        const int numberOfCycles = 1000;\n        const int numbersPerCycle = 1000000;\n\n        Stopwatch swG = Stopwatch.StartNew();\n\n        int threadCount = 0;\n        int completeCount = 0;\n        Parallel.For(0, numberOfCycles, x =&gt;\n            {\n                Console.WriteLine(string.Format(\"Starting cycle {0}. Thread count at {1}\", x, Interlocked.Increment(ref threadCount)));\n\n                Random r = new Random();\n                Stopwatch sw = Stopwatch.StartNew();\n                double[] numbers = new double[numbersPerCycle];\n                for (int i = 0; i &lt; numbersPerCycle; i++)\n                {\n                    numbers[i] = r.NextDouble() * 1000;\n                }\n                Array.Sort(numbers);\n                double min = numbers[0];\n                double max = numbers[numbers.Length - 1];\n\n                Interlocked.Increment(ref completeCount);\n                Console.WriteLine(string.Format(\"{0} cycles complete: {1:#,##0.0} ms. Min: {2:0.###}  Max: {3:0.###}\", completeCount, sw.ElapsedMilliseconds, min, max));\n                Interlocked.Decrement(ref threadCount);\n            });\n\n        Console.WriteLine(string.Format(\"All {0} cycles complete. Took {1:#,##0.0} ms.\", numberOfCycles, swG.ElapsedMilliseconds));\n        Console.WriteLine(\"Press any key to continue.\");\n        Console.ReadKey();\n    }\n}\n</code></pre>\n"},{"tags":["c#","wpf","multithreading","asynchronous","hierarchy"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13016998,"title":"Multithreading in object hierarchy","body":"<p>I'm creating a LOB application in WPF using C# and MVVM.  I have created factories to construct all of my objects and they work ok but they're slow for complex object graphs.  I would like to know if it's advisable to implement asynchronous creation of each level of the complex object's hierarchy.  For example if objA has a large collection of objB and each objB has a large collection of objC, can I asynchronously create the child collections of each type ?  If so how?  I'm new to mutithreaded coding and I'm having trouble picking a direction.  BackgroundWorker vs TPL vs Rx.  Any guidance would be greatly appreciated.</p>\n"},{"tags":["ios","multithreading","nsthread","nsoperationqueue","gcd"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12995344,"title":"Which is the best of GCD, NSThread or NSOperationQueue?","body":"<p>What's the best way of multithreading in iOS as we have three options GCD, NSThread, and NSOperationQueue? I am confused in which one is the best? If none, then which should be used in what scenario and how they differ and also, if someone has some good example of using NSOperationqueue, please share so that I can learn.</p>\n"},{"tags":["c","multithreading","parallel-processing"],"answer_count":1,"favorite_count":2,"up_vote_count":7,"down_vote_count":1,"view_count":241,"score":6,"question_id":13002540,"title":"Serial code much slower than using only one thread in C?","body":"<p>So, I was doing some benchmark tests with threads, and i wrote these pieces of code:</p>\n\n<p>resp_threadless[] and resp_threaded[] are global int arrays and their size is n;</p>\n\n<pre><code>int n = 100000;\n\nvoid function() {\n  for (long j = 0; j &lt; n; ++j) {\n    int count = 0;\n    double x = vetor[j];\n      while (x &gt; 1.0) {\n      x = sqrt(x);\n      ++count;\n    }\n   resp_threadless[j] = count;\n  }\n}\n\nDWORD WINAPI function_th( LPVOID lpParam ) {\nfor (long j = 0; j &lt; n; ++j) {\n    int count = 0;\n    double x = vetor[j];\n      while (x &gt; 1.0) {\n      x = sqrt(x);\n      ++count;\n    }\n   resp_threadless[j] = count;\n  }\n}\n</code></pre>\n\n<p>I benchmarked the first function by just calling her:</p>\n\n<pre><code>function();\n</code></pre>\n\n<p>And the second one like this:</p>\n\n<pre><code>HANDLE hThreadArray[1];\nDWORD dwThreads[1];\nhThreadArray[0] = CreateThread(NULL, 0, function_th, NULL , 0, &amp;(dwThreads[0]));\nWaitForMultipleObjects(1, hThreadArray, TRUE, INFINITE);\nCloseHandle(hThreadArray[0]);\n</code></pre>\n\n<p>Keep in mind that I know that calling multiple threads using function_th() will not parallelize it, this is just a test because i was having really strange results, so I decided to see what would happen with one thread and one function using the SAME code.</p>\n\n<p>I tested this in a Intel Atom N270, and windows XP with NUMPROC = 1.</p>\n\n<p>Results:\nSerial code: 1485 ms\nOne Thread: 425 ms</p>\n\n<p>I've had similar results using multiprocessor machines, and even with code using semaphores to parallelize the work done by the threads.</p>\n\n<p>Does anyone has any idea of what could be happening?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Inverting the order, running multiple times each one, etc... -> No change</p>\n\n<p>Higher N -> Thread one is proportionally even faster</p>\n\n<p>Using QueryPerformanceCounter() -> No change</p>\n\n<p>Thread Creation Overhead -> Should make the threaded even one slower, not faster</p>\n\n<p>Original code: <a href=\"http://pastebin.com/tgmp5p1G\" rel=\"nofollow\">http://pastebin.com/tgmp5p1G</a></p>\n"},{"tags":["java","sql","multithreading","jdbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13013725,"title":"How to clean cancel execution of a heavy SQL in the middle of executing?","body":"<p>There are two threads of execution, one is the thread that connects via JDBC and executes a heavy query, something like this:</p>\n\n<pre><code>Statement stmtData = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);\nResultSet rsData = stmtData.executeQuery(\"SELECT * from hugeTable\");\n</code></pre>\n\n<p>and the second is the one which starts the first mentioned thread and of course cancels it if requested by user, let's say in the middle of executing query by DBMS which might take a long time.</p>\n\n<p>I tried calling interrupt() method of first thread in the second one, hoping it would throw InterruptedException in the first one, but it didn't.</p>\n\n<p>So how to cancel the execution of the query <strong>quick and clean</strong>?</p>\n"},{"tags":["c#","multithreading",".net-4.0","interlocked"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13013555,"title":"Interlocked.Exchange clarification","body":"<p>I have a few simple (hopefully) questions that I have been unable to find answers for - </p>\n\n<p>Say I have objects a, b that are accessible to multiple threads.</p>\n\n<pre><code>Interlocked.Exchange(ref a, b)\n</code></pre>\n\n<p>If 'b' is not volatile, will this operation treat it as such? i.e. will it take the latest value of this variable from memory? If so, is that read 'atomic' with the write? I understand that the main purpose of Interlocked.Exchange is that you will get the previous value of 'a' as an atomic operation with the new write. But my main confusion is around what value of 'b' is actually written to 'a'.</p>\n\n<p>My second question is related to a quote in this article:</p>\n\n<p><a href=\"http://igoro.com/archive/volatile-keyword-in-c-memory-model-explained/\" rel=\"nofollow\">http://igoro.com/archive/volatile-keyword-in-c-memory-model-explained/</a></p>\n\n<p>\"One interesting point is that all writes in C# are volatile according to the memory model as documented here and here, and are also presumably implemented as such. The ECMA specification of the C# language actually defines a weaker model where writes are not volatile by default.\"</p>\n\n<p>Is this true? If so, is there a purpose of Interlocked.Exchange if one doesn't care about the previous value of 'a'? (pertaining to my first example). I don't see any other articles or comments on StackOverflow around every write being volatile. I understand, however, that writes are atomic.</p>\n\n<p>Edit: If the answer to my first question is that 'b' is not treated as volatile, and the answer to my second question is that writes are indeed volatile, then a follow up is, when is interlocked.exhange useful if we don't care about the previous value of 'a'?</p>\n"},{"tags":["multithreading","gcc","ubuntu"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13007565,"title":"Thread local storage GCC Compiler","body":"<p>I declare a variable <code>__thread int my_id</code>;\nInfo of my platform and compiler:</p>\n\n<pre><code>Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.6.1-9ubuntu3' --with-bugurl=file:///usr/share/doc/gcc-4.6/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++,go --prefix=/usr --program-suffix=-4.6 --enable-shared --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.6 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-objc-gc --enable-targets=all --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=i686-linux-gnu --host=i686-linux-gnu --target=i686-linux-gnu\nThread model: posix\ngcc version 4.6.1 (Ubuntu/Linaro 4.6.1-9ubuntu3) \n</code></pre>\n\n<p>I use flag -lpthread to compile.\nBut Compiler complains: <code>error: storage class specified for 'my_id'</code>.</p>\n"},{"tags":["c++","multithreading","sockets","tcp"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":13009791,"title":"C++ Multithreaded TCP Server Issue","body":"<p>I'm writing a simple TCP server. The model that I though of is the server accepting client connections in the main thread and handing them over to another thread so that server can listen for connections again. The relevant parts of the code that I used are posted below:</p>\n\n<p>Accepting connections:</p>\n\n<pre><code>void startServer () {\n\n    int serverSideSocket = 0;\n    int clientSideSocket = 0;\n\n    serverSideSocket = socket(AF_INET, SOCK_STREAM, 0);\n    if (serverSideSocket &lt; 0) {\n        error(\"ERROR opening socket\");\n        exit(1);\n    }\n\n    clientAddressLength = sizeof(clientAddress);\n    memset((char *) &amp;serverAddress, 0, sizeof(serverAddress));\n    memset((char *) &amp;clientAddress, 0, clientAddressLength);\n\n    serverAddress.sin_family = AF_INET;\n    serverAddress.sin_addr.s_addr = INADDR_ANY;\n    serverAddress.sin_port = htons(32000);\n\n    if (bind(serverSideSocket, (struct sockaddr *) &amp;serverAddress, sizeof(serverAddress)) &lt; 0) {\n        error(\"ERROR on binding\");\n        exit(1);\n    }      \n\n    listen(serverSideSocket, SOMAXCONN);\n\n    while(true) {\n        clientSideSocket = accept(serverSideSocket, (struct sockaddr *) &amp;clientAddress, &amp;clientAddressLength);\n\n    if (clientSideSocket &lt; 0)\n            error(\"ERROR on accept\");\n\n        processingThreadGroup-&gt;create_thread(boost::bind(process, clientSideSocket, this));\n    }\n\n}\n</code></pre>\n\n<p>Here, the processingThreadGroup is a boost::thread_group instance. In the process method:</p>\n\n<pre><code>void process (int clientSideSocket, DataCollector* collector) {\n\nint numberOfCharactersRead = 0;\nstring buffer;\n\ndo {\n      char msgBuffer[1000];\n      numberOfCharactersRead = recv(clientSideSocket, msgBuffer, (1000 - 1), 0);\n      if (numberOfCharactersRead &lt; 0) {\n          //display error\n          close(clientSideSocket);\n      }\n      else if (numberOfCharactersRead == 0)\n          close(clientSideSocket);\n      else {\n          printf(\"%s\", msgBuffer);\n          memset(msgBuffer, 0, 1000);\n      }\n   } while (numberOfCharactersRead &gt; 0); \n}\n</code></pre>\n\n<p>However, when I debug the code, I saw that when the processing thread is invoked, the main thread is not accepting connections anymore. The data is read inside the process() method only. The main thread seem to be not running anymore. What is the issue with the approach I took and any suggestions to correct it?</p>\n\n<p>Thank you!</p>\n\n<p>EDIT: I think I found the issue here, and have updated it as an answer. Will not accept it since I answered my own question. Thank you for the help everyone!</p>\n"},{"tags":["java","multithreading","design","timertask"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":13014115,"title":"Java TimerTask should wait on a Blocking Queue","body":"<p>I have the following design: </p>\n\n<p>There is a Task which extends <code>TimerTask</code> and it is scheduled to run every minute.\nThis Task will try to take items from a central queue (as a single consumer) and write their representation into a file.</p>\n\n<p>Additionally, there are multiple producers which put items into the central queue from time to time.</p>\n\n<p>I am interested that each time the Task is executed (<code>run() method executed</code>) it will extract <strong>all</strong> the items from the queue if there are items, if there are no items do nothing.</p>\n\n<p>Producers should sleep on the Queue if it is full.</p>\n\n<p>My Solution for this problem is:</p>\n\n<p>Create ExtractTask which extends TimerTask.\nExtractTask will contain a BlockingQueue. \nEach producer will receive a reference to the queue instance by executing method getQueue().\nProducers will execute BlockingQueue.put() method.\nThe consumer will execute BlockingQueue.poll() method inside run().</p>\n\n<p>Can you suggest a better design? does my design contain any problematic scenario cases? any synchronization problems this design may encounter?</p>\n"},{"tags":["c#","multithreading",".net-3.5"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":92,"score":1,"question_id":13015794,"title":"How to get number of CPU's logical cores/threads in C#?","body":"<p>How i can get number of logical cores in CPU?</p>\n\n<p>I need this to determine how many threads i should run in my application.</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":13015210,"title":"How to limit no of threads read from config file C# framework 3.5","body":"<p>I have an application similar to sample C# code this <a href=\"http://msdn.microsoft.com/en-us/library/3dasc8as.aspx\" rel=\"nofollow\">link</a>.\nIn this example, there is no limit to the no of threads generated.</p>\n\n<p>Could someone provide me sample code to limit the no of thread (read from config file) generated.\nI am using framework 3.5. i don't have a provision to upgrade to 4.0.</p>\n\n<p>Thanks in advance --Joxin </p>\n"},{"tags":["linux","multithreading","signals"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":5783285,"title":"What happens when SIGCANCEL is sent to a thread?","body":"<p>In a multi threaded environment what happens when SIGCANCEL is sent to a thread?   </p>\n\n<p>What will be the difference in behavior if SIGKILL is sent to a thread?</p>\n"},{"tags":["multithreading","visual-studio-2010","debugging"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12714593,"title":"vs2010 Debug.WriteLine stops working","body":"<p>I have this problem that has been giving me grief for most of the day and then some.<br>\nBasically my Debug.WriteLine works for a bit, and then magically stops giving output.  The debugger is still working because I can put a breakpoint on the line, and it will break, and I can step over the Debug.WriteLine and watch it not output.</p>\n\n<p>Now I have checked everything I can think of.  I have tried things from various posts such as </p>\n\n<p><a href=\"http://stackoverflow.com/questions/7477309/debug-writeline-is-not-printing-anything\">Debug.Writeline is Not printing anything</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/5992094/debug-writeline-stops-working\">Debug.Writeline stops working</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/10128179/visual-studio-2010-suddenly-stops-displaying-debug-output\">Visual Studio 2010 suddenly stops displaying Debug output</a></p>\n\n<p>but nothing has worked. To clarify</p>\n\n<ul>\n<li>I am using vs2010 pro sp1.</li>\n<li>The projects are using the .net4 framework.</li>\n<li>I have the Debug Constants Set.</li>\n<li>The Debugger is still attached as I can set breakpoints and they are hit.</li>\n<li>Both projects are set to build under \"Any CPU\" (I tried with both as X86 and it didnt help)</li>\n<li>I am running on Windows 7 x64</li>\n</ul>\n\n<p>And after following all the suggestions, I dont have a fix.  None of those Posts above were actually answered.</p>\n\n<p>So just how does one fix this ?</p>\n\n<p>I thought I would create a seperate solution to reproduce this problem.</p>\n\n<p>You can download my solution that reproduces the bug here <a href=\"https://drive.google.com/uc?export=download&amp;confirm=&amp;id=0B0SLafLeQj5GOGxORThMWWhYV28\" rel=\"nofollow\">https://drive.google.com/uc?export=download&amp;confirm=&amp;id=0B0SLafLeQj5GOGxORThMWWhYV28</a></p>\n\n<p>So I made 2 windows apps, and set them to both start at the same time.  In each app I start a thread, and in the Thread I do a Debug.WriteLine</p>\n\n<p>It seems to get some sort of deadlock and stop writing the output.  This appears to be a bug in Visual Studio, which I am highly surprised at.  Must I believe that it is impossible to have 2 projects with threads doing Debug.WriteLine at the same time ?</p>\n\n<p>Once again, I am in deperate need of a way to fix this and still get Debug Output.\nOh, and I have also tried the option of redirecting output to the immediate window with no success either.</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":81,"score":5,"question_id":13012578,"title":"Object deep locking in multithreading environment","body":"<p>I have below class structures in my project for <strong>class A</strong> and <strong>class B</strong>:</p>\n\n<pre><code>class A {\n    private String id;\n    private List&lt;B&gt; bs = new ArrayList&lt;B&gt;();\n\n    A(String id){\n        this.id = id;\n    }\n\n    public List&lt;B&gt; getBs(){\n        return bs;\n    }\n\n    public void setBs(List&lt;B&gt; bs){\n        this.bs=bs;\n    }\n\n    public void addBs(List&lt;B&gt; bs){\n        this.bs.addAll(bs);\n    }\n\n    public void addB(B b){\n        this.bs.add(b);\n    }\n}\n\nclass B {\n    private String id;\n    private List&lt;String&gt; tags;\n\n    B(String id){\n        this.id = id;\n    }\n\n    public List&lt;String&gt; getTags(){\n        return tags;\n    }\n\n    public void setTags(List&lt;String&gt; tags){\n        this.tags = tags;\n    }\n\n    public void addTags(List&lt;String&gt; tags){\n        this.tags.addAll(tags);\n    }\n\n    public void addTag(String tag){\n        this.tags.add(tag);\n    }\n}\n</code></pre>\n\n<p>Also we have a cache class:</p>\n\n<pre><code>class CacheService {\n    private static final ConcurrentHashMap&lt;String, Object&gt; CACHE = new ConcurrentHashMap&lt;String, Object&gt;();\n\n    public static Object get(String id){\n        return CACHE.get(id);\n    }\n\n    public static void put(String id, Object obj){\n        return CACHE.put(id, obj);\n    }\n}\n</code></pre>\n\n<p>Now objects for class A and B are created using unique IDs and put in this cache by &lt;id, object&gt; combination. For example:</p>\n\n<pre><code>A a1 = new A(\"10\");\nCacheService.put(\"10\", a1);\n\nA a2 = new A(\"11\");\nCacheService.put(\"11\", a2);\n\nB b1 = new B(\"1\");\nCacheService.put(\"1\", b1);\n\nB b2 = new B(\"2\");\nCacheService.put(\"2\", b2);\n\nB b3 = new B(\"3\");\nCacheService.put(\"3\", b3);\n\nB b4 = new B(\"4\");\nCacheService.put(\"4\", b4);\n</code></pre>\n\n<p>Also I am putting class B objects in the <code>List&lt;B&gt;</code> inside objects <code>a1</code> and <code>a2</code>. <strong>It is important to note that a unique B object is only put once in any A object</strong>:</p>\n\n<pre><code>a1.add(b1);\na1.add(b2);\n\na2.add(b3);\na2.add(b4);\n</code></pre>\n\n<p>This way we can have multiple objects for class A and B in the CACHE.</p>\n\n<p><strong>Scenario:</strong> Now multiple threads access this CACHE but some of them end up to get class A objects and others class B objects depending upon ID specified by user. These threads actually want to <strong>read</strong> or <strong>update</strong> information on these objects.</p>\n\n<p><strong>Question:</strong> My requirement is when a thread has accessed an object of class A (for example <code>a1</code>) to update it then no other thread should be able to <strong>read</strong> or <strong>update</strong> <code>a1</code> as well as all class B objects (<code>b1</code> and <code>b2</code> in this case) which are added to the <code>List&lt;B&gt;</code> inside object <code>a1</code> until I am finished with all updates on <code>a1</code>. Please tell me how can I acquire a lock in this scenario? </p>\n"},{"tags":["objective-c","cocoa","multithreading"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":7,"view_count":9963,"score":-3,"question_id":925468,"title":"Threading in Objective-C","body":"<p>is there Thread in Objective c.\nif there how it is declare and use.</p>\n\n<p>if anybody know using multithreading in Objective -c ..pls share with me ..</p>\n\n<p>thanks and regards .. by raju..</p>\n"},{"tags":["c#",".net","wpf","winforms","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":303,"score":2,"question_id":5509374,"title":"Background work with UI","body":"<p>Is it any easier to do background work with the UI in WPF?</p>\n\n<p>It's such a pain with WinForms, and would like an easier way. I want to do database work, and as it's doing database work, I want to populate a control with results returned from the database as it happens, and after it's done.</p>\n"},{"tags":["python","multithreading","serial-port","multiprocessing"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":66,"score":3,"question_id":13014007,"title":"threads vs. processes in Python","body":"<p>I'm about to start a program using Python which is mostly doing polling, it will constantly read from the serial port (via <code>PySerial</code>) and read from a file descriptor which will be changing from time to time. I started looking into the <code>threading</code> module but then I kept finding <a href=\"http://stackoverflow.com/questions/5058768/threads-in-python-again\">more</a> and <a href=\"http://stackoverflow.com/questions/4319943/how-to-use-threads-in-python\">more</a> suggestions of using the <code>multiprocessing</code> module instead.</p>\n\n<p>I'm not well versed in Python, coming from a mostly C background. What are the technical advantages of a threaded approach in Python? </p>\n\n<p>In C, threads share data vs. having to set up some IPC to communicate, that seems to be the same for Python? </p>\n\n<p>My usecase:</p>\n\n<pre><code>Main process (or thread?) -\n   start &amp; initialize\n       |\n       V\n    spaw child----------------------&gt; start &amp; initialize\n       |                                   |\n       V                                   V\n      while (1) &lt;------------+          wait for data&lt;------+\n       |                     |             |                |\n       V                     |             V                |\n   read file descriptors     |         read from            |\n       |                     |         serial port&lt;-----+   |\n       V                     |             |            |   |\n   value changed?  ------No--+             V            |   |\n       |                     ^        message done?--No-+   |\n       V                     |             |                |\n    Report change------------+             V                |\n     over serial                       alert parent---------+\n</code></pre>\n\n<p>So I was thinking threads, since it will make sharing data got over serial easier, and they can have a shared handle to the serial port. Does this make sense, or am I thinking about this incorrectly from a Pythonic point of view?</p>\n"},{"tags":["c#","wpf","multithreading","textbox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":72,"score":-3,"question_id":12711138,"title":"Unable to control Textboxes","body":"<p>While I'm launching a process I can't controls my textboxes. </p>\n\n<p>My question is: How can I modify a textbox while it's launching a process? </p>\n\n<p>Even when I try to modify the textbox before the process is launched it still doesn't work.</p>\n\n<p>I found some answers on this forum but the explanation is a bit to difficult for me to implement it for my problem.</p>\n\n<p>I created a small program that will run a batch file to make a backup. While the backup is running I can't modify my textboxes, disabling buttons etc.</p>\n\n<p>I already saw that this is normal but I don't know how to implement the solutions. My last attempt was with <code>Dispatcher.invoke</code> as you can see below.</p>\n\n<pre><code>public partial class MainWindow : Window\n{\n    public MainWindow()\n    {\n        InitializeComponent();\n        tb_Status.Text = \"Ready\";\n\n    }\n\n    public void status()\n    {\n       Dispatcher.Invoke(DispatcherPriority.Send, new Action( () =&gt; { tb_Status.Text = \"The backup is running!\"; } ) );\n\n    }\n\n    public void process()\n    {\n        try\n        {            \n            Process p = new Process();\n            p.StartInfo.WindowStyle = ProcessWindowStyle.Minimized;\n            p.StartInfo.CreateNoWindow = true;\n            p.StartInfo.UseShellExecute = false;\n            p.StartInfo.RedirectStandardOutput = true;\n            p.StartInfo.FileName = \"Robocopy.bat\";\n            p.Start();\n\n            string output = p.StandardOutput.ReadToEnd();\n            p.WaitForExit();\n            tb_Output.Text = File.ReadAllText(\"Backup\\\\log.txt\");\n        }\n        catch (Exception ex)\n        {\n            tb_Status.Text = ex.Message.ToString();\n        }\n    }\n\n    private void Bt_Start_Click(object sender, EventArgs e)\n    {\n        status();\n        Directory.CreateDirectory(\"Backup\");\n\n        process();\n        tb_Status.Text = \"The backup finished\";\n        File.Delete(\"Backup\\\\log.txt\");\n\n    }\n\n\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13000679,"title":"Multithreading Deadlock in Java","body":"<p>Please, can somebody explain me why this code is a deadlock. It seems that it should work properly. Please explain it in details. Thanks.</p>\n\n<pre><code>public class H extends Thread {\n    String info = \"\";\n    public H (String info) {\n        this.info = info;\n    }\n\n    public synchronized void run() {\n        try {\n            while (true) {\n                System.out.println(info);\n                notify();\n                wait();\n            }\n        } catch (Exception e) {}\n\n    }\n    public static void main(String[] args) {\n          new H(\"0\").start();\n          new H(\"1\").start();\n    }\n</code></pre>\n\n<p>}</p>\n"},{"tags":["multithreading","java-me","midp","lcdui"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":13006300,"title":"J2ME thread programming","body":"<p>I am creating a j2me application which is interacting with a database on a server. Therefore I launch a thread to connect to the server. I handle all my command actions in a separate class which implements <code>CommandListener</code>.</p>\n\n<p>When I try to get the response the server returned I get an empty String. I have tried waiting for the thread that connects to the server to return but this makes the application unresponsive.</p>\n\n<p>Below is the code I am using.</p>\n\n<pre><code>//my network worker class.\npublic class NetworkConnector implements Runnable {\n    //constructor\n    public NetworkConnector(String url){\n       //url =&gt;server url to connect to.\n       Thread thread = new Thread(this);\n       thread.start();\n    }\n\n    private String serverReply=\"\";\n    private String url=\"\n\n    //method to connect to the server and return the \n    //response from the server.\n    public String sendData(String serverUrl) {\n\n      //open streams to connect to the Server.\n      httpConn = (HttpConnection)  \n      Connector.open(serverUrl,Connector.READ_WRITE, true);\n      httpConn.setRequestMethod(HttpConnection.GET);\n\n      inStream = httpConn.openInputStream();\n      int read;\n      while ((read = inStream.read()) != -1) {\n        sb.append((char) read);\n      }\n\n      return sb.toString();\n   }\n\n\n   public String getServerReply() {\n     //serverReply is a class variable.\n     return serverReply;\n   }\n\n   public void run(){\n      //call the send method that connects to the server.\n       serverResponse = sendData(Url);\n   }\n\n} //end of connector class.\n\n// this class is where all my Command Actions are\n//implemented. \npublic class CommandActionController implements\nCommandListener, DataReceiver {\n\npublic void commandAction(Command cmd, Displayable d) {\n   //networkMgr =&gt; is the worker class that makes\n   //connection to the server.\n   networkMgr = new NetworkConnector(\"http://localhost\n   /JsonPhp/login.php?uname=\" + loginUserInfo.userName +\n   \"&amp;passwd=\" + loginUserInfo.password);\n\n   //here am getting the response from the server.\n   String serverResponse = networkMgr.getServerReply();\n\n   //at this point the ServerReponse String is Empty =&gt;\n   //yet the server is supposed to return some String.\n   System.out.println(\"xxxxxxxxxxxxxxxxxx\n   ServerResponse =\" + serverResponse);\n   }\n\n   }//end of CommandListener class.\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":104,"score":-1,"question_id":12973318,"title":"Diagnosing why two Java Threads hanging","body":"<p>Trying to make sense of my application hanging, it was all running fine then hung.\nI then attached Yourkit Profiler which highlighted two threads that had not changed for some time and appeared to have hang. </p>\n\n<p>The interesting thing is both threads were performing the same task but on different data, however the method is simply a cpu intensive task which isn't sharing data, performing I/O or connecting to anything else.</p>\n\n<pre><code>public int[][] computeAssignments(float[][] matrix)\n</code></pre>\n\n<p>So with this in mind I cannot understand what could be causing them to just stop</p>\n\n<p>Both threads are run as part of an an ExecutorService</p>\n\n<p>What approach should I take to resolve this.</p>\n\n<p><strong>Update</strong></p>\n\n<p>As Glen guessed the problem turned out to be completely unrelated to threads. It is just that they both happened to hit the same problem, the code they were calling could go into a recursive loop if a particular set of data was provided. A good hint another poster gave was to check in profiler whether the threads were in Runnable or Waiting state, only if they were in waiting state would they actually be deadlocked.</p>\n"},{"tags":["c#","multithreading","generics","dictionary","locking"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1729,"score":3,"question_id":410270,"title":"can you lock on a generic dictionary?","body":"<p>or should you always create some other lock object . .</p>\n"},{"tags":["java","multithreading","concurrency","constructor"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":118,"score":4,"question_id":12611366,"title":"Constructor synchronization in Java","body":"<p>Someone somewhere told me that Java constructors are synchronized so that it can't be accessed concurrently during construction, and I was wondering: if I have a constructor that stores the object in a map, and another thread retrieves it from that map before its construction is finished, will that thread block until the constructor completes?</p>\n\n<p>Let me demonstrate with some code:</p>\n\n<pre><code>public class Test {\n    private static final Map&lt;Integer, Test&gt; testsById =\n            Collections.synchronizedMap(new HashMap&lt;&gt;());\n    private static final AtomicInteger atomicIdGenerator = new AtomicInteger();\n    private final int id;\n\n    public Test() {\n        this.id = atomicIdGenerator.getAndIncrement();\n        testsById.put(this.id, this);\n        // Some lengthy operation to fully initialize this object\n    }\n\n    public static Test getTestById(int id) {\n        return testsById.get(id);\n    }\n}\n</code></pre>\n\n<p>Assume that put/get are the only operations on the map, so I won't get CME's via something like iteration, and try to ignore other obvious flaws here.</p>\n\n<p>What I want to know is if another thread (that's not the one constructing the object, obviously) tries to access the object using <code>getTestById</code> and calling something on it, will it block? In other words:</p>\n\n<pre><code>Test test = getTestById(someId);\ntest.doSomething(); // Does this line block until the constructor is done?\n</code></pre>\n\n<p>I'm just trying to clarify how far the constructor synchronization goes in Java and if code like this would be problematic. I've seen code like this recently that did this instead of using a static factory method, and I was wondering just how dangerous (or safe) this is in a multi-threaded system.</p>\n"},{"tags":["c#","multithreading","synchronization","async-await"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":71,"score":3,"question_id":13010563,"title":"using ThreadStatic variables with async/await","body":"<p>With the new async/await keywords in C#, there are now impacts to the way (and when) you use ThreadStatic data, because the callback delegate is executed on a different thread to one the <code>async</code> operation started on. For instance, the following simple Console app:</p>\n\n<pre><code>[ThreadStatic]\nprivate static string Secret;\n\nstatic void Main(string[] args)\n{\n    Start().Wait();\n    Console.ReadKey();\n}\n\nprivate static async Task Start()\n{\n    Secret = \"moo moo\";\n    Console.WriteLine(\"Started on thread [{0}]\", Thread.CurrentThread.ManagedThreadId);\n    Console.WriteLine(\"Secret is [{0}]\", Secret);\n\n    await Sleepy();\n\n    Console.WriteLine(\"Finished on thread [{0}]\", Thread.CurrentThread.ManagedThreadId);\n    Console.WriteLine(\"Secret is [{0}]\", Secret);\n}\n\nprivate static async Task Sleepy()\n{\n    Console.WriteLine(\"Was on thread [{0}]\", Thread.CurrentThread.ManagedThreadId);\n    await Task.Delay(1000);\n    Console.WriteLine(\"Now on thread [{0}]\", Thread.CurrentThread.ManagedThreadId);\n}\n</code></pre>\n\n<p>will output something along the line of:</p>\n\n<pre><code>Started on thread [9]\nSecret is [moo moo]\nWas on thread [9]\nNow on thread [11]\nFinished on thread [11]\nSecret is []\n</code></pre>\n\n<p>I've also experimented with using <code>CallContext.SetData</code> and <code>CallContext.GetData</code> and got the same behaviour.</p>\n\n<p>After reading some related questions and threads:</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/273301/callcontext-vs-threadstatic\">CallContext vs ThreadStatic</a></li>\n<li><a href=\"http://forum.springframework.net/showthread.php?572-CallContext-vs-ThreadStatic-vs-HttpContext&amp;highlight=LogicalThreadContext\" rel=\"nofollow\">http://forum.springframework.net/showthread.php?572-CallContext-vs-ThreadStatic-vs-HttpContext&amp;highlight=LogicalThreadContext</a></li>\n<li><a href=\"http://piers7.blogspot.co.uk/2005/11/threadstatic-callcontext-and_02.html\" rel=\"nofollow\">http://piers7.blogspot.co.uk/2005/11/threadstatic-callcontext-and_02.html</a></li>\n</ul>\n\n<p>it seems that frameworks like ASP.Net explicitly migrates the HttpContext across threads, but not the <code>CallContext</code>, so perhaps the same thing is happening here with the use of <code>async</code> and <code>await</code> keywords?</p>\n\n<p>With the use of the async/await keywords in mind, what's the best way to store data associated with a particular thread of execution that can be (automatically!) restored on the callback thread?</p>\n\n<p>Thanks,</p>\n"},{"tags":["java","multithreading","swing","gui","client"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":13003280,"title":"Update JTextField from another thread in Java","body":"<p>I'm making a game client/server and I'm having a new thread update some info on the client GUI (which is using Swing). I'm trying to use SwingUtilities but it's not working. Also, I heard SwingUtilities creates a new thread everytime you use it so I'm looking for a new way as well (I have 10 or so JTextFields to be updated). Is there a way to do it without using SwingUtilities? Here is what I have right now.</p>\n\n<pre><code>SwingUtilities.invokeLater(    \n        new Runnable() {    \n           public void run()    \n           {    \n              Client.status.setText(\"status = \"+status); \n           }    \n        });\n</code></pre>\n"},{"tags":["c#",".net","multithreading","parallel-processing","observablecollection"],"answer_count":4,"favorite_count":7,"up_vote_count":8,"down_vote_count":0,"view_count":3418,"score":8,"question_id":5480372,"title":"What's the best way to update an ObservableCollection from another thread?","body":"<p>I am using the <code>BackgroundWorker</code> to update an <code>ObservableCollection</code> but it gives this error:</p>\n\n<blockquote>\n  <p>\"This type of <code>CollectionView</code> does\n  not support changes to its\n  <code>SourceCollection</code> from a thread\n  different from the Dispatcher thread.\"</p>\n</blockquote>\n\n<p>What's the best and most elegant way to solve this, with the least amount of work. I don't want to write low level lock-based multi-threading code.</p>\n\n<p>I have seen some solutions online but they are several years old, so not sure what the latest consensus is for the solution of this problem.</p>\n"},{"tags":["c","linux","multithreading","pthreads"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":13010257,"title":"How to find whether a pthread has pending cancellation request","body":"<p>I want to find whether for a thread, <code>pthread_cancel</code> has been called or not.</p>\n\n<p>I don't want to use some tables and to maintain that. Is there any library function available for this? I don't want to cancel the thread using some cancellation point functions which cancel the thread if there is any pending cancellation request, I just want to know whether there is any pending cancellation request or not.</p>\n"},{"tags":["c","linux","multithreading","arm","embedded-linux"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":13007105,"title":"test program for processor load generate only 3 threads but we need more","body":"<p>I write a simple test program to produce some processor load. It will throw 6 threads and calculates in every thread pi. But the processor generates only 3 threads on the target platform (arm), the same program on a normal Linux-PC generates all 6 threads.</p>\n\n<p>What is the Problem?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;unistd.h&gt;\n\n#define ITERATIONS 10000000000000\n#define NUM_THREADS 6\n\nvoid *calculate_pi(void *threadID) {\n        double i;\n        double pi;\n        int add = 0;\n\n        pi = 4;\n        for (i = 0; i &lt; ITERATIONS; i++) {\n                if (add == 1) {\n                        pi = pi + (4/(3+i*2));\n                        add = 0;\n                } else {\n                        pi = pi - (4/(3+i*2));\n                        add = 1;\n                }\n        }\n\n        printf(\"pi from thread %d = %20lf in %20lf iterations\\n\", (int)threadID, pi, i);\n\n        pthread_exit(NULL);\n}\n\nint main(int argc, char *argv[])\n{\n        pthread_t threads[NUM_THREADS];\n        int rc;\n        int i;\n\n        for ( i = 0 ; i &lt; NUM_THREADS; i++) {\n                rc = pthread_create(&amp;threads[i], NULL, calculate_pi, (void *)i);\n                if (rc) {\n                        printf(\"ERROR; return code from pthread_create() is %d\\n\", rc);\n                        exit(EXIT_FAILURE);\n                }\n        }\n\n        for ( i = 0 ; i &lt; NUM_THREADS; i++) {\n                pthread_join(threads[i], NULL);\n        }\n\n        return(EXIT_SUCCESS);\n}\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13010090,"title":"Determine that thread is running or not if using runnable in android","body":"<p>I have created a program in android for multithreading.</p>\n\n<p>When I hit one of the button its thread starts and print value to EditText now I want to determine that thread is running or not so that I can stop the thread on click if it is running and start a new thread if it is not running here is mu code:</p>\n\n<pre><code>public void startProgress(View view) {\n        final String v;\n        if(view == b1)\n        {\n            v = \"b1\";\n        }\n        else\n        {\n            v = \"b2\";\n        }\n        // Do something long\n        Runnable runnable = new Runnable() {\n            @Override\n            public void run() {\n                //for (int i = 0; i &lt;= 10; i++) {\n                while(true){\n                    if(v.equals(\"b1\"))\n                    {\n                        i++;\n                    }\n                    else if(v.equals(\"b2\"))\n                    {\n                        j++;\n                    }\n\n\n                    try {\n                        if(v.equals(\"b1\"))\n                        {\n                            Thread.sleep(3000);\n                        }\n                        else if(v.equals(\"b2\"))\n                        {\n                            Thread.sleep(1000);\n                        }\n\n\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                    handler.post(new Runnable() {\n                        @Override\n                        public void run() {\n                            //  progress.setProgress(value);\n                            if(v.equals(\"b1\"))\n                            {\n                                String strValue = \"\"+i;\n                                t1.setText(strValue);\n                            }\n                            else\n                            {\n                                String strValue = \"\"+j;\n                                t2.setText(strValue);\n                            }\n\n                            //t1.setText(value);\n                        }\n                    });\n                }\n            }\n        };\n        new Thread(runnable).start();\n    }\n\n@Override\n    public void onClick(View v) {\n        if(v == b1)\n        {\n            startProgress(b1);\n        }\n        else if(v == b2)\n        {\n            startProgress(b2);\n        }\n\n    }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13009500,"title":"Thread which runs every 3 seconds","body":"<p>I am working on multithreading in java and created 1 thread here is the code:</p>\n\n<pre><code>class SampleThread extends Thread\n    {\n        int time;\n        String name;\n        boolean autocall;\n        public SampleThread(int time, String name)\n        {\n            this.time = time;\n            this.name = name;\n        }\n\n          public void run()\n          { \n              try{\n                  time = time +1;\n                  updateView(time, name);\n                  //sleep(3000);\n              }catch(Exception e)\n              {\n                  e.printStackTrace();\n              }\n            //this.stop();\n          }     \n    }\n</code></pre>\n\n<p>Now I want to run this thread every 3 seconds how to achieve this??</p>\n"},{"tags":["ios","multithreading","core-data","magicalrecord"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":150,"score":3,"question_id":12569528,"title":"How to create multiple objects in background?","body":"<p>I'm using MagicalRecord 2.0.3 and I can't really figure out how to save data in the background. </p>\n\n<p>According to the documentation, something like this should work:</p>\n\n<pre><code>[MagicalRecord saveInBackgroundWithBlock:^(NSManagedObjectContext *localContext) {\n    // Do this hundreds of times\n    [MyObject createInContext:localContext];\n}];\n</code></pre>\n\n<p>However, nothing is saved to the database. I've seen multiple people posting solutions similar to this:</p>\n\n<pre><code>[MagicalRecord saveInBackgroundWithBlock:^(NSManagedObjectContext *localContext) {\n    // Do this hundreds of times\n    [MyObject createInContext:localContext];\n} completion:^{\n    [[NSOperationQueue mainQueue] addOperationWithBlock:^{\n        [[NSManagedObjectContext defaultContext] saveNestedContexts];\n    }];\n}];\n</code></pre>\n\n<p>This does save my data in the database, however since the save happens on the main thread, my application is unresponsive for a while (with my dataset, about 3 seconds which is way too long).</p>\n\n<p>I've also tried this, but it also blocks up while saving:</p>\n\n<pre><code>self.queue = [[NSOperationQueue alloc] init];\n\n[self.queue addOperationWithBlock:^{\n    NSManagedObjectContext *localContext = [NSManagedObjectContext contextForCurrentThread];\n\n    // Do this hundreds of times\n    [MyObject createInContext:localContext];\n\n    [localContext saveNestedContexts];\n}];\n</code></pre>\n\n<p>And lastly, same blocking effect with this code:</p>\n\n<pre><code>dispatch_queue_t syncQueue = dispatch_queue_create(\"Sync queue\", NULL);\ndispatch_async(syncQueue, ^{\n    NSManagedObjectContext *localContext = [NSManagedObjectContext contextForCurrentThread];\n\n    // Do this hundreds of times\n    [MyObject createInContext:localContext];\n\n    [[NSManagedObjectContext contextForCurrentThread] saveNestedContexts];\n});\n</code></pre>\n\n<p>So, what is the best way to solve this? I need to create hundreds of objects in the background and the app needs to remain responsive.</p>\n"},{"tags":["android","multithreading","android-animation","android-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12995963,"title":"Thread in View for animation... how?","body":"<p>In R&amp;D for <a href=\"http://stackoverflow.com/questions/12979507/animating-in-ondraw-without-surfaceview\">a related view I'm attempting to build</a>, I started a simple project to grasp how to do more of the basic drawing \"stuff\" before getting ahead of myself.</p>\n\n<p>Like my other question states, there's a lot of information out for SurfaceView threading and animation, but I feel for this application, that may be overkill.  I'll be showing somewhere between 10 and perhaps hundreds of the final View on screen at once, and from what I gather about SurfaceView it's usually used as the main view of an Activity (game screen, etc).</p>\n\n<p>This R&amp;D app draws a few circles, and calculates the distance between the target (red lines) and the previous position (white lines):</p>\n\n<p><img src=\"http://i.stack.imgur.com/Scsv9.jpg\" alt=\"Screenshot of the current implementation\"></p>\n\n<p>My <code>onDraw</code> is pretty straightforward, but I'm having quite a hard time figuring out how to implement a Thread or Handler, or any sort of non-UI loop to calculate the values between the target and the main circle.</p>\n\n<p>I have a private static inner Thread that I thought would be easy, but no dice.  The latest Frankencode:</p>\n\n<pre><code>private static class DragThread extends Thread {\n    private DragTest view;\n    private boolean animate;\n\n    private float currentY, targetY, delta, inc;\n\n    public DragThread(View v){\n        view = (DragTest)v;\n        targetY = view.mTargetData.getY();\n        currentY = view.mMainData.getY();\n    }\n    public void run(){\n        while(Math.abs(currentY - targetY) &gt;= 0){\n            view.mMainData.setY(currentY + 10f);\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n\n            }finally{\n                view.postInvalidate();    \n            }\n        }\n        Log.e(TAG, \"Loop finished\");\n    }\n}\n</code></pre>\n\n<p><code>mMainData</code> and <code>mTargetData</code> are just POJOs holding the positional values of each circle, which my onDraw uses to update the position:</p>\n\n<pre><code>mMainData = new CircleData(startXposition, startYposition, radius);\n</code></pre>\n\n<p>...and retrieved using standard getters.</p>\n\n<p>Essentially, I know I'll need to start the loop logic when I lift my finger, but I've gotten a few errors ranging from \"Thread Already Started\", to freezes and crashes.  Handlers give me leak warnings... man. I'm spent.  </p>\n\n<p>Here's the <code>onTouchEvent</code> for my view, with explanation of each event:</p>\n\n<pre><code>@Override\npublic boolean onTouchEvent(MotionEvent event) {\n    int action = event.getAction();\n\n    if(action == MotionEvent.ACTION_DOWN){\n\n        // set some flags for drawing, update \"hero\" circle Y position\n        // based off event data\n    }else if(action == MotionEvent.ACTION_UP){\n\n        // reset flags that dictate ghost circle drawing, etc. and invalidate\n        // I think I need to start the loop here, but how?! \n        // new Thread().start()? Some sort of Handler? GAH!\n\n    }else if(action == MotionEvent.ACTION_MOVE){\n        // update mMainData Y position which is passed into onDraw, invalidate to reflect movement changes\n    }        \n    return false;\n}\n</code></pre>\n"},{"tags":["c#",".net","winforms","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":7798566,"title":"setting new value to an label in thread execution","body":"<p>it's possible? I need for example,set new value to an label in thread execution.<br>\nI tried this: </p>\n\n<pre><code>private void button1_Click_1(object sender, EventArgs e)\n{\n  Thread th = new Thread(new ThreadStart(DoWork));\n  th.Start();\n}\n\npublic void DoWork()\n{\n    while (true)\n    {\n        StartSearch(path, ref httpRequest);\n    }\n}\n\n   public void StartSearch(string path, ref HttpWebRequest httpRequest) {\n                  foo.GetTopic(path, delegate(string post, string name, string uid)\n                  {\n                      {\n                          if (post.Contains(\"&lt;font color=\\\"#0000FF\\\"&gt;\"))\n                          {\n                              string msg = string.Format(\"Post:{0}\\r\\nby {1}({2})\", post, name, uid);\n                              //MessageBox.Show(msg);\n                              labelX.text = msg;\n                          }\n                      }\n                  }\n              );\n      }\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<blockquote>\n  <p>Cross-thread operation not valid: Control 'labelX' accessed from a thread other than the thread it was created on.</p>\n</blockquote>\n\n<p>How I do this? Thanks in advance!</p>\n"},{"tags":["c","linux","multithreading","pthreads","hello-world"],"answer_count":6,"favorite_count":8,"up_vote_count":12,"down_vote_count":0,"view_count":36084,"score":12,"question_id":1662909,"title":"undefined reference to pthread_create in linux (c programming)","body":"<p>I'm interested in learning to write C programs which use threads. I picked up the following demo off the web from <a href=\"https://computing.llnl.gov/tutorials/pthreads/\">https://computing.llnl.gov/tutorials/pthreads/</a></p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#define NUM_THREADS     5\n\nvoid *PrintHello(void *threadid)\n{\n   long tid;\n   tid = (long)threadid;\n   printf(\"Hello World! It's me, thread #%ld!\\n\", tid);\n   pthread_exit(NULL);\n}\n\nint main (int argc, char *argv[])\n{\n   pthread_t threads[NUM_THREADS];\n   int rc;\n   long t;\n   for(t=0; t&lt;NUM_THREADS; t++){\n      printf(\"In main: creating thread %ld\\n\", t);\n      rc = pthread_create(&amp;threads[t], NULL, PrintHello, (void *)t);\n      if (rc){\n         printf(\"ERROR; return code from pthread_create() is %d\\n\", rc);\n         exit(-1);\n      }\n   }\n   pthread_exit(NULL);\n}\n</code></pre>\n\n<p>But when I compile it on my machine (running Ubuntu Linux 9.04) I get the following error:</p>\n\n<pre><code>corey@ubuntu:~/demo$ gcc -o term term.c\nterm.c: In function ‘main’:\nterm.c:23: warning: incompatible implicit declaration of built-in function ‘exit’\n/tmp/cc8BMzwx.o: In function `main':\nterm.c:(.text+0x82): undefined reference to `pthread_create'\ncollect2: ld returned 1 exit status\n</code></pre>\n\n<p>This doesn't make any sense to me, because the header includes pthread.h, which should have the pthread_create function. Any ideas what's going wrong?</p>\n"},{"tags":["php","multithreading","nginx","fork","forking"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2154,"score":1,"question_id":2396145,"title":"php process forking and get the child process id","body":"<p>Objective:\nMy script will download a remote file upon form submission, since the file might be big, I would like to fork off a process and let the user go on with his/her life.</p>\n\n<p>Example of a command:</p>\n\n<p>wget -q --limit-rate=1k --tries=10 \"http://helios.gsfc.nasa.gov/image_euv_press.jpg\" -O /web/assets/content/image/image_euv_press.jpg </p>\n\n<p>Method tried:</p>\n\n<ol>\n<li><p>pcntl forking, </p>\n\n<pre><code>    $pid = pcntl_fork();\n\n\n<pre><code>if ( $pid == -1 ) {\n    exit;\n} else if ( $pid ) {\n    //We are the parent process, the pid is child pid right?\n\n\n    return $pid;\n} else {\n    // We are the child process\n\n\n    exec($command.' &amp;gt; /dev/null');\n    // &amp;gt; /dev/null &amp;amp;\n\n\n    posix_kill(getmypid(),9);\n    return;\n}\n</code></pre>\n\n</code></pre></li>\n</ol>\n\n<p>I do get the PID but then there is a risk that the forked process becomes a zombie and since I am using nginx -> php-fpm (tested and confirmed, upon running several times alot of defunct php-fpm processes), I would have to restart the server just to eliminate the zombies, this would leave me to PID exhaustion attack? ( I am guessing)</p>\n\n<ol>\n<li><p>Background process:</p>\n\n<pre><code>        exec($command . ' &gt; /dev/null &amp;');//background process\n    $proc = passthru (\"ps aux | grep '$command'\");//search for the command\n    echo var_dump($proc);\n    $pid = (int)(next(explode(' ',$proc)));//parse the pid (not implemented)\n</code></pre></li>\n</ol>\n\n<p>Question:\nthe background process method works but it's not clean, is there a better way to fork off a process to download and get that wget command PID so I can kill it later?. </p>\n\n<p>I have tried echoing $! after doing the exec just to get the PID but exec('echo $!') doesnt return anything, i think it's because every exec is a different \"space\"</p>\n\n<p>I added '> /dev/null 2>/dev/null &amp;' to the end of the command on my terminal it would return something like: [3] 30751, but through php exec, there is no way to capture that returned PID.</p>\n\n<p>Thank you.</p>\n"}]}
{"total":30059,"page":10,"pagesize":100,"questions":[{"tags":["java","multithreading","wait","runnable","notify"],"answer_count":4,"favorite_count":0,"up_vote_count":8,"down_vote_count":1,"view_count":125,"score":7,"question_id":12995568,"title":"How do I use wait/notifyAll","body":"<p>I am wondering if it is possible in java to have a class that implements Runnable and if an object of the class goes to wait() (so thread stops running until it receives a signal), can another object of the same class notify it to continue running ?</p>\n\n<p>Ideally what i want to be able to do is:</p>\n\n<pre><code>public class ThreadClass implements Runnable{\n\n public void run(){\n //.. Does some arbitrary work\n\n  if( aCondition){  //have it wait until something signals it to contine exection.\n this.wait();\n }\n\n //Continues to do more work.\n\n //finished whatever it needed to do. Signal all other threads of this object type to continue their work.\n this.notifyAll();\n\n }\n}\n</code></pre>\n\n<p>Is this possible and if so how would I go about doing it? I am trying to make it so that the object itself can manage itself and all other objects of the same type. So that no one using this class has to worry about managing it.</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":13005029,"title":"Implementing semaphores in java","body":"<p>I have some code that generates threads (lizards)\nit also makes a cat thread.</p>\n\n<p>the cat checks on the lizards (once it wakes up) and if there are to many crossing a path at one time it eats them. the idea is to have the lizards cross and eat  while the world has not 'ended' with out interruption from the cat thread.</p>\n\n<p>I need to use semaphores to control this.</p>\n\n<p>I have the idea down just need that extra push so I can start taking a crack of it.</p>\n\n<p>Ive edited to code to show where my issues are.</p>\n\n<pre><code>import java.util.ArrayList;\nimport java.util.concurrent.Semaphore;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\n\npublic class LizardsSync \n{\n    /*\n     * Set this to the number of seconds you want the lizard world to\n     * be simulated.  \n     * Try 30 for development and 120 for more thorough testing.\n     */\n    private static int WORLDEND = 30;\n\n    /*\n     * Number of lizard threads to create\n     */\n    private static int NUM_LIZARDS =20;\n\n    /*  \n     * Maximum lizards crossing at once before alerting cats\n     */\n    private static int MAX_LIZARD_CROSSING = 4;\n\n    /*\n     * Maximum seconds for a lizard to sleep\n     */\n    private static int MAX_LIZARD_SLEEP_TIME = 3;\n\n    /*\n     * Maximum seconds for a lizard to eat\n     */\n    private static int MAX_LIZARD_EAT_TIME = 5;\n\n    /*\n     * Number of seconds it takes to cross the driveway\n     */\n    private static int CROSS_TIME = 2;\n\n    /*\n     * Number of seconds for the cat to sleep.\n     */\n    private static int MAX_CAT_SLEEP;\n\n    /*\n     * A counter that counts the number of lizzards crossing sago to monkey grass\n     */\n    int numCrossingSago2MonkeyGrass = 0;\n\n    /*\n     * A counter that counts the number of lizzards crossing monkey grass to sago\n     */\n    int numCrossingMonkeyGrass2Sago = 0;\n\n    /**\n     * A semaphore to protect the crossway. \n     * only the max amount of lizards can cross so the cat wont 'play'\n    */\n    Semaphore semaphoreCrossway = new Semaphore(MAX_LIZARD_CROSSING,true);\n\n    /**\n     * A semaphore for mutual exclusion.\n     */\n    Semaphore mutex = new Semaphore(4);\n\n    // on both semaphores, you can call acquire() or release()\n    /*\n     * Indicates if the world is still running.\n     */\n    private static boolean running = true;\n\n    /*\n     * Indicates if you want to see debug information or not.\n     */\n    private static boolean debug = true;\n\n\n    public void go()\n    {\n        ArrayList&lt;Thread&gt; allThreads = new ArrayList&lt;Thread&gt;();\n\n        // create all the lizzard threads\n        for (int i=0; i &lt; NUM_LIZARDS; i++) \n        {       allThreads.add(new LizardThread(i) );\n            allThreads.get(i).start();\n}\n        // create the cat thread\n        Thread CatThread = new CatThread();\n         CatThread.start();\n\n        // let the world run for a while\n        sleep (WORLDEND);\n\n        // terminate all threads\n        running = false;\n        // wait until all threads terminate by joining all of them\n        for (int i=0; i &lt; NUM_LIZARDS; i++) {\n            try {\n               allThreads.get(i).join();\n            } catch (InterruptedException ex) {\n                System.err.println (\"unable to join thread, \" + ex.getMessage());\n            }\n        }\n    }\n       /**\n     * @param args the command line arguments\n     */\n    public static void main(String[] args) {\n        // starts the program\n        new LizardsSync().go();\n    }\n\n     /**\n     * Models a cat thread.\n     */\n    public class CatThread extends Thread {\n\n\n        /**\n         * @see java.lang.Runnable.\n         */\n        @Override\n        public void run() \n        {   \n            // you must finish this method\n\n            while (running) {\n               // sleep for a while\n               catSleep();\n\n               // check on lizzards\n               checkCrossway();\n            }\n        }\n\n        /**\n         * Puts cat thread to sleep for a random time.\n         */\n        public void catSleep()\n        {\n            int sleepSeconds  = 1 + (int)(Math.random()*MAX_CAT_SLEEP);\n\n            if (debug) {\n                System.out.println (\"Cat is sleeping for \" + sleepSeconds + \" seconds.\");\n                System.out.flush();\n            }\n            try {\n                sleep(sleepSeconds*1000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n            }\n            if (debug) {\n                System.out.println (\"Cat awakes.\");\n                System.out.flush();\n            }\n        }\n\n        /**\n         * Simulates cat checking the crossway.\n         */\n        public void checkCrossway()\n        {\n            if (numCrossingMonkeyGrass2Sago + numCrossingSago2MonkeyGrass &gt; MAX_LIZARD_CROSSING) {\n                System.out.println (\"The cat says yum!\");\n                System.out.flush();\n                     System.exit(-1);\n            }\n       }\n    }\n\n    /**\n     * Models a lizard thread.\n     */\n    public class LizardThread extends Thread {\n\n        private int _id;\n\n        /**\n         * Creates a new lizard thread.\n         * \n         * @param id the id assigned to the lizard thread\n         */\n        public LizardThread(int id)\n        {\n            _id = id;\n        }\n\n        /**\n         * @see java.lang.Runnable.\n         */\n        @Override\n        public void run() \n        {    \n            while (running) {\n               // sleep for a while in sago\n               lizardSleep();\n               // wait until safe to cross from sago to monkey grass\n               sagoToMonkeyIsSafe();\n               // cross path to monkey grass\n               crossedOverToMonkey();\n               // eat in the monkey grass\n               lizardEat();\n               // wait untill its safe to cross back to sago\n               monkeyToSagoIsSafe();\n               // cross from cross monkey grass to sage\n               crossMonkeyToSago();\n            }\n        }\n\n        /**\n         * This tests if it is safe to travel from sago to monkey.\n         * Finish this.\n         */\n        public void sagoToMonkeyIsSafe()\n        {\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] checks sago -&gt; monkey grass.\");\n                System.out.flush();\n            }\n\n            // you must add code here\n            // use a semaphore \n\n\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] thinks sago -&gt; monkey grass is safe.\");\n                System.out.flush();\n            }\n        }\n\n        /**\n         * Indicates that lizard crossed over to monkey grass.\n         * Finish this.\n         */\n        public void crossedOverToMonkey()\n        {\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] made it to monkey grass.\");\n                System.out.flush();\n            }\n\n            // add code here\n        }\n\n\n        /**\n         * This tests if it is safe to travel from monkey to sago.\n         * Finish this.\n         */\n        public void monkeyToSagoIsSafe()\n        {\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] checks monkey grass -&gt; sago.\");\n                System.out.flush();\n            }\n\n            // you must add code here\n            // use a semaphore \n\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] thinks monkey grass -&gt; sago is safe.\");\n                System.out.flush();\n            }\n        }\n\n        /**\n         * Indicates that lizard crossed over to sago.\n         * Finish this.\n         */\n        public void crossedOverToSago()\n        {\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] made it to sago.\");\n                System.out.flush();\n            }\n\n            // add code here\n        }\n\n        /**\n         * Indicates that lizard is crossing over from monkey to sago.\n         * Finish this\n         */\n        void crossMonkeyToSago()\n        {\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] is crossing monkey grass to sago.\");\n                System.out.flush();\n            }\n\n            numCrossingMonkeyGrass2Sago++;\n\n            // simulate walk\n            try {\n                sleep(CROSS_TIME*1000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n            }\n\n            numCrossingMonkeyGrass2Sago--;\n        }\n\n        /**\n         * Indicates that lizard is crossing over from sago to monkey. \n         */\n        void crossSagoToMonkey()\n        {\n\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] is crossing sago to monkey grass.\");\n                System.out.flush();\n            }\n\n            numCrossingSago2MonkeyGrass++;\n\n            // simulate walk\n            try {\n                sleep(CROSS_TIME*1000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n            }\n\n            numCrossingSago2MonkeyGrass--;\n        }\n\n\n        /**\n         * Puts lizard thread to sleep for a random amount of time.\n         */\n        public void lizardSleep()\n        {\n            int sleepSeconds  = 1 + (int)(Math.random()*MAX_LIZARD_SLEEP_TIME);\n\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] is sleeping for \" + sleepSeconds + \" seconds.\");\n                System.out.flush();\n            }\n            try {\n                sleep(sleepSeconds*1000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n            }\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] awakes.\");\n                System.out.flush();\n            }\n        }\n\n        /**\n         * Simulates lizard eating for a random amount of time.\n         */\n        public void lizardEat()\n        {\n            int eatSeconds  = 1 + (int)(Math.random()*MAX_LIZARD_EAT_TIME);\n\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] is eating for \" + eatSeconds + \" seconds.\");\n                System.out.flush();\n            }\n            try {\n                sleep(eatSeconds*1000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n            }\n            if (debug) {\n                System.out.println (\"Lizard [\" + _id + \"] finished eating.\");\n                System.out.flush();\n            }\n        }\n    }\n\n\n    /**\n     * Puts current thread to sleep for a specified amount of time.\n     * \n     * @param seconds the number of seconds to put the thread to sleep\n     */\n    private static void sleep(int seconds)\n    {\n        try {\n            Thread.sleep(seconds*1000);\n        } catch (InterruptedException ex) {\n            Logger.getLogger(LizardsSync.class.getName()).log(Level.SEVERE, null, ex);\n        }\n    }\n\n}\n</code></pre>\n\n<p>this code as of now writes something like this</p>\n\n<pre><code>Cat awakes.\nThe cat says yum!\nLizard [8] finished eating.\nLizard [0] is sleeping for 1 seconds.\nLizard [8] checks monkey grass -&gt; sago.\nLizard [1] finished eating.\nLizard [8] thinks monkey grass -&gt; sago is safe.\nLizard [1] checks monkey grass -&gt; sago.\nLizard [8] is crossing monkey grass to sago.\nLizard [1] thinks monkey grass -&gt; sago is safe.Java Result: -1\nBUILD SUCCESSFUL (total time: 5 seconds)\n</code></pre>\n"},{"tags":["javascript","multithreading","html5","web-worker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12999891,"title":"Limiting Web Worker CPU Utilization?","body":"<p>I'm looking at writing a long running CPU intensive operation using Web Workers and it does seem to be possible to push a client's CPU to 100% with these. (See <a href=\"http://stackoverflow.com/questions/11871452/can-web-workers-utilize-100-of-a-multi-core-cpu\">Can Web Workers utilize 100% of a multi-core CPU?</a>)</p>\n\n<p>Does anyone know of any effective ways to limit the CPU utilization of web workers?</p>\n"},{"tags":["objective-c","multithreading","osx","cocoa","nsthread"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13004605,"title":"Threading and Object Lifetimes with ARC","body":"<p>As I understand ARC, without a strong reference to an object, it is fair game to be collected (since its reference count is 0).</p>\n\n<p>If, in a method in class A, I do this:</p>\n\n<pre><code>ClassB* b = [[ClassB alloc] init];\n[b doStuff];\n</code></pre>\n\n<p>And in doStuff, I do this:</p>\n\n<pre><code>NSThread* t = [[NSThread alloc] initWithTarget:self selector:@selector(theThread) object:nil];\n[t start];\n</code></pre>\n\n<p>The reference count of <code>b</code> appears to be 0 since it went out of scope after the method in class A finishes.  However, a thread is currently 'running' in ClassB and will need local resources.</p>\n\n<p>What is the behavior here?  Or perhaps, what should the behavior here be to make sure that <code>b</code> stays around until the thread is all finished?</p>\n\n<p>Thanks!</p>\n"},{"tags":["vb.net","multithreading","synclock"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13004643,"title":"SyncLock and very many threads VB .Net","body":"<p>My case is I have the following method that uses SyncLock to ensure the writing of file by one thread at a time.</p>\n\n<pre><code>Private Shared lockThis As New Object \n\nPublic Sub Process()\n  SyncLock lockThis\n    File.AppendAllText(\"c:\\jamo\\foo.txt\",\"foo\")\n  End SyncLock \nEnd Sub \n</code></pre>\n\n<p>I'm using many threads running at time:</p>\n\n<pre><code>Public Sub CreateThreads()\n  Dim trd as Thread\n  Dim X as Integer = 10\n  For i as integer = 1 to X\n    trd = New Thread(AddressOf Process)\n    trd.Start()\n  Next Sub\nEnd Sub\n</code></pre>\n\n<p>My problem is when X is big (like 500), one o more threads write to file at same time. Why is happening this?</p>\n"},{"tags":["c++","multithreading","c++11","queue"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":70,"score":1,"question_id":13004497,"title":"Low Contention Queue","body":"<p>I was experimenting with C++11 threading capabilities, low contention queue seemed like a good choice for application. I have written some code. Can anyone suggest how good or bad is it. Of course there are chances of improvement. Can anyone suggest how to improve it.</p>\n\n<p>Here is the code, please have a look at it.</p>\n\n<pre><code>template&lt;typename T,int N = 1024&gt;\nclass threadsafe_queue{\n    class node;\n    std::shared_ptr&lt;node&gt; head, tail;\n    std::mutex pu,po;\n\npublic:\n    class exception:public std::exception{\n    };\n\n    threadsafe_queue(){\n        head.reset(new node);\n        tail=head;\n    }\n    threadsafe_queue(const threadsafe_queue &amp;)=delete;\n    void push(const T&amp; _val){\n        std::lock_guard&lt;std::mutex&gt; lk(pu);\n        std::shared_ptr&lt;node&gt; t = tail-&gt;push(_val);\n        if(t==nullptr){\n            return;\n        }else{\n            tail = t;\n        }           \n    }\n\n    void pop(T&amp; _val){\n        std::lock_guard&lt;std::mutex&gt; lk(po);\n        std::shared_ptr&lt;node&gt; t = head-&gt;pop(_val);\n        if(t==nullptr){\n            return;\n        }else{\n            head = t;\n        }   \n    }\n\n};\n\ntemplate&lt;typename T, int N=1024&gt;\nclass threadsafe_queue&lt;T,N&gt;::node{\n    std::array&lt;T,N&gt; data;\n    int l,r;\n    std::mutex m;\n    std::shared_ptr&lt;node&gt; next;\npublic:\n    node(){\n            l=r=0;\n            next.reset();\n    }\n    node(const node &amp;) = delete;\n    std::shared_ptr&lt;node&gt; pop(T&amp;_val){\n        std::lock_guard&lt;std::mutex&gt; lk(m); \n        if(l==N-1){\n                _val=data[l];\n                if(next==nullptr){\n                        l=r=0;\n                        return nullptr;\n                }\n                else{\n                        return next;\n                }\n        }\n        if(l==r){\n            throw threadsafe_queue::exception();\n    }else{\n                _val = data[l];\n                l++;\n                return nullptr; \n        }\n    }\n    std::shared_ptr&lt;node&gt; push(const T&amp; _val){\n        std::lock_guard&lt;std::mutex&gt;lk(m);\n        data[r]=_val;\n        if(r==N-1){\n                if(next==nullptr){\n                        next.reset(new node);\n                }\n                return next;\n        }else{\n                r++;\n                return nullptr;\n        }\n    }   \n    ~node(){\n    }\n};\n\nvoid push(threadsafe_queue&lt;int&gt;&amp;q, int start, int end){\n    for(int i=start;i&lt;end;++i){\n        q.push(i);\n    }\n}\n\nvoid pop(threadsafe_queue&lt;int&gt; &amp;q){\n    try{\n    while(1){\n            int v;\n            q.pop(v);\n            std::cout&lt;&lt;v&lt;&lt;std::endl;\n        }\n    }\n        catch(threadsafe_queue&lt;int&gt;::exception e){\n    }\n}\n</code></pre>\n"},{"tags":["objective-c","multithreading","background-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13004253,"title":"Running expensive grid calculations in the background - Objective-C","body":"<p>I have an <code>NSMutableArray</code> that's accessed primarily by the main thread in my iOS game. Every 2-3 seconds I need to perform an expensive operation on this grid. I don't need to modify the grid. I just need to do some calculations and return a result. <strong>How can I efficiently and safely use the grid in a background thread?</strong></p>\n\n<p>So far I've considered just copying the grid and passing it as the object in <code>performSelectorInBackground</code>. However this seems potentially wasteful. I've also considered just accessing the grid's reference from the background thread and making sure the main thread doesn't write to the grid until the background thread has finished processing. However this feels risky and I'm not sure if it's a common practice.</p>\n"},{"tags":["c#","multithreading","webbrowser"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12998745,"title":"Web Browser MultiThreded Casting Exception","body":"<p>Up till now I had a single threaded app that crawled web sites.<br>\nBecause I want to make it faster, I tried rebuilding to a multihreaded  app.\nthis is what i do:<br>\nI have a Crawl Class, that hold a WebBrowser object.\nThis is how I start the thread: </p>\n\n<pre><code> Crawler c1 = new Crawler();  \n Thread t1 = new Thread(new ThreadStart(c1.Crawl));  \n t1.SetApartmentState(ApartmentState.STA);\n t1.start()\n</code></pre>\n\n<p>The threads arrive to this functions:</p>\n\n<pre><code> LogIn(bool isInit)  \n {  \n   browser = new WebBrowser();\n   NavigateAndWaitForLoad(browser, \"http://www.someurl.com\", 1000);\n   HtmlElement elemEmail = (HtmlElement)browser.Document.GetElementById(\"email\");  \n  }\n\n\n\n void NavigateAndWaitForLoad(WebBrowser wb, string link, int waitTime)  \n  {  \n   wb.Navigate(link);\n   int count = 0;\n   while (wb.ReadyState != WebBrowserReadyState.Complete)  \n   {  \n    Thread.Sleep(sleepTimeMiliseconds);\n    Application.DoEvents();\n    count++;\n    if (count &gt; waitTime / sleepTimeMiliseconds)\n        break;  \n    } \n</code></pre>\n\n<p>Now in the single threaded it works great,\nHowever in the mutlithreded app it crashes on this line:\n HtmlElement elemEmail = (HtmlElement)browser.Document.GetElementById(\"email\");<br>\nwith the exception of illegal casting???!!!<br>\nhave no idea why?<br>\nplease help...</p>\n"},{"tags":["c++","multithreading","pointers","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12995553,"title":"Why won't my counting thread work properly when using pthreads?","body":"<p>In my <code>main()</code> function, I call <code>pthread_create</code> to create a new thread. I pass into it the name of a text file, and the thread opens the text file, counts the number of lines and then returns that number to <code>main()</code> where I set an integer <code>totalCount +=</code> to the number that was returned. </p>\n\n<p>I know that the thread function works properly since I counted the number of lines in the text file with another piece of code. The problem arises when I use a loop to call <code>pthread_create</code> more than once. The <code>totalCount</code> I get from counting one file is accurate, but when I open two or more files, the <code>totalCount</code> in <code>main()</code> is wrong. </p>\n\n<p>What might be going wrong in my program that's causing this? Is it a problem in my thread function? my <code>pthread_join</code>? I know this question might be pretty ambiguous without code but any thoughts at all given this description?</p>\n"},{"tags":["php","multithreading","web","sleep"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13002972,"title":"php sleep function, no other calls to webserver work until that original sleep finishes? how to bypass","body":"<p>I have an api which a remote server calls, to execute set series of functions on our local server, ie adding new users / accounts.</p>\n\n<p>Within this script, there is a 'sleep(180)' set to wait 3mins before emailing out a response to the remote server. </p>\n\n<p>The delay is required, however we have found any requests after the 1st one to the server, do not seem to be getting processed, it is as if that 'sleep(180)' is halting other calls to the server.</p>\n\n<p>Does it not work based on a connection basis? so every connection should only be affected not <em>every</em> remote call to that one api.php?</p>\n\n<p>I have researched but not found an answer to the above behaviour, I'm guessing if that is the case, the only solution would be to record the incoming new account requests and put them into mysql in a 'scheduler' database table.. and perhaps have a cron that will run every 1-2mins and check for new records and then send out the response. This way there is no halting other calls.</p>\n\n<p>I'd really appreciate any input on this matter as I can't seem to find anything proving/disproving whats happening.</p>\n"},{"tags":["c#","multithreading","events"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":0,"question_id":12997658,"title":"c# how to make periodic events in a class?","body":"<p>I want to make a class change one of its properties every second. The change is supposed to happen on class-level and not in the main thread, how would I do this?  </p>\n"},{"tags":["c#","multithreading",".net-3.5"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13003145,"title":"Multiple threads updating array","body":"<p>Im trying to implement multi-threading in my application that makes a lot of float number calculations (neural network).</p>\n\n<p>I wrote function that makes necessary calculations and updates array outside that function.\nMy actual, single-thread code looks like this (simplified for better understanding):</p>\n\n<pre><code>class MyClass\n{\n    // this array after all calculations should contain \n    // result of only one calculation, \n    // that returned smallest value in one of array fields \n    // (smallest neural network error)\n    float[] bestResult;\n\n    // runs calculations on all \"sets of data\"\n    public void findBestResult(void)\n    {\n        foreach (something...) // data rows from database cached in one array\n        {\n            calculate(x[]);\n        }\n    }\n\n    // calculates one \"set of data\"\n    public void calculateAndUpdateResultIfBetter(float[] inputData)\n    {\n\n        if (bestResult[0] &gt; calculatedData[0])\n             bestResult = calculatedData; // update only if condition is true\n    }\n\n}\n</code></pre>\n\n<p>Im low level programmer, i don't know how to use advanced (?) .NET threading techniques, that use Synchronize etc. I know how to create one additional thread for something and update some controls on form by using delegates. </p>\n\n<p>I have no idea how to work with 2-8 threads doing exactly same thing and competing with each other.</p>\n\n<p>The question 1 is - can you help me with this? I don't know how to start. SOLVED BY Niko Drašković</p>\n\n<p>EDIT: \nThe question 2 is - will lock() method lock my array for read and write?</p>\n"},{"tags":["c++","multithreading","pointers","pthreads","segmentation-fault"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13003058,"title":"Why do I get a segmentation fault when using pthread_join?","body":"<p>Here is the code I have, it compiles and runs using g++ but I get a segmentation fault. I know it happens around the pthread_join statement but I cant figure out why.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\n#include &lt;fstream&gt;\n#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;sstream&gt;\n\nusing namespace std;\n\nstruct data{\n    string filename;\n    int x;\n    int y;\n};\n\nvoid *threadFunction(void *input){\n    data *file = (data *) input;\n    string filename = file-&gt;filename;\n    ifstream myFile;\n    int xCount = 0;\n    int yCount = 0;\n    myFile.open(filename.c_str());\n    string line;\n    while(myFile &gt;&gt; line){\n        if(line == \"X\"){\n            xCount++;\n        }else if(line == \"Y\"){\n            yCount++;\n        }\n    }\n    file-&gt;x = xCount;\n    file-&gt;y = yCount;\n    return (void *) file;\n}\n\nint main(){\n    pthread_t myThreads[20];\n    data *myData = new data[20];\n\n    for(int i = 0; i &lt; 20; i++){\n        ostringstream names;\n        names &lt;&lt; \"/filepath/input\" &lt;&lt; i+1 &lt;&lt; \".txt\";\n        myData[i].filename = names.str();\n        myData[i].x = 0;\n        myData[i].y = 0;\n    }\n    for(int i = 0; i &lt; 20; i++){\n        int check = pthread_create(&amp;myThreads[i], NULL, threadFunction, (void *) &amp;myData[i]);\n        if(check != 0){\n            cout &lt;&lt; \"Error Creating Thread\\n\";\n            exit(-1);\n        }\n    }\n\n\n\n    int xCount = 0;\n    int yCount = 0;\n\n    for(int i = 0; i &lt; 20; i++){\n        data* returnedItem;\n        pthread_join(myThreads[i], (void**) returnedItem);\n        xCount += returnedItem-&gt;x;\n        yCount += returnedItem-&gt;y;\n    }\n\n    cout &lt;&lt; \"Total X: \" &lt;&lt; xCount &lt;&lt; \"\\n\";\n    cout &lt;&lt; \"Total Y: \" &lt;&lt; yCount &lt;&lt; \"\\n\";\n\n}\n</code></pre>\n\n<p>Am I not calling return properly from my threadFunction? I've been trying a bunch of different things and I still don't know what's going on...any help would be greatly appreciated! (the text file I open contain either an X or Y per line. My goal is to count the total number of Xs and Ys in 20 text files)</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":563,"score":1,"question_id":4138996,"title":"Frequent calls to setText() in multithreaded Swing program","body":"<p>I have a Swing program where work is continuously being done in a non-Swing thread. It often needs to update a JTextPane -- frequently many times per second. I realize that setText() needs to be called from back inside the event-dispatching thread, but I cant figure out how to make this happen smoothly.</p>\n\n<p>The following minimal complete example is as close as I've been able to get it, using a PipedInputStream/PipedOutputStream pair, but this only seems to update the screen once every second or so. I'm not sure what's taking so long.</p>\n\n<pre><code>import java.awt.event.*;\nimport javax.swing.*;\nimport java.io.*;\n\npublic class TextTest extends JFrame {\n    private JTextPane out = new JTextPane();\n    private PipedInputStream pIn = new PipedInputStream();\n    private PrintWriter pOut;\n\n    public TextTest() {\n        try {\n            pOut = new PrintWriter(new PipedOutputStream(pIn));\n        }\n        catch (IOException e) {System.err.println(\"can't init stream\");}\n\n        add(new JScrollPane(out));\n        setSize(500, 300);\n        setDefaultCloseOperation(EXIT_ON_CLOSE);\n        setVisible(true);\n\n        // Start a loop to print to the stream continuously\n        new Thread() {\n            public void run() {\n                for (int i = 0; true; i++) {\n                    pOut.println(i);\n                }\n            }\n        }.start();\n\n        // Start a timer to display the text in the stream every 10 ms\n        new Timer(10, new ActionListener() {\n            public void actionPerformed (ActionEvent evt) {\n                try {\n                    if (pIn.available() &gt; 0) {\n                        byte[] buffer = new byte[pIn.available()];\n                        pIn.read(buffer);\n                        out.setText(out.getText() + new String(buffer));\n                    }\n                }\n                catch (IOException e) {System.err.println(\"can't read stream\");}\n            }\n        }).start();\n    }\n\n    public static void main(String[] args) {\n        new TextTest();\n    }\n}\n</code></pre>\n\n<p>Am I implementing this wrong? Do I just have totally the wrong idea about how to continuously update a JTextPane from outside the EDT?</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12982927,"title":"Fast Audio File Output","body":"<p>I've recently finished a small game and have been trying to add audio to it. Currently the sound system I have is working (basically the same code as the top answer <a href=\"http://stackoverflow.com/questions/2416935/how-to-play-wav-files-with-java\">here</a>\n), but there is a significant stall during every output (~200-300 ms). Since it's a quick game I'm looking for something significant quicker. I'm not experienced with Threads, but would those be applicable here?</p>\n"},{"tags":["c++","multithreading","c++11","atomic"],"answer_count":4,"favorite_count":11,"up_vote_count":31,"down_vote_count":1,"view_count":2645,"score":30,"question_id":6086912,"title":"Double-Checked Lock Singleton in C++11","body":"<p>Is the following singleton implementation data-race free?</p>\n\n<pre><code>static std::atomic&lt;Tp *&gt; m_instance;\n...\n\nstatic Tp &amp;\ninstance()\n{\n    if (!m_instance.load(std::memory_order_relaxed))\n    {\n        std::lock_guard&lt;std::mutex&gt; lock(m_mutex);\n        if (!m_instance.load(std::memory_order_acquire))\n        {\n            Tp * i = new Tp;\n            m_instance.store(i, std::memory_order_release);    \n        }    \n    }\n\n    return * m_instance.load(std::memory_order_relaxed);\n}\n</code></pre>\n\n<p>Is the <code>std::memory_model_acquire</code> of the load operation superfluous? Is it possible to further relax both load and store operations by switching them to <code>std::memory_order_relaxed</code>? In that case, is the acquire/release semantic of <code>std::mutex</code> enough to guarantee its correctness, or a further <code>std::atomic_thread_fence(std::memory_order_release)</code> is also required to ensure that the writes to memory of the constructor happen before the relaxed store? Yet, is the use of fence equivalent to have the store with <code>memory_order_release</code>?</p>\n\n<p><strong>EDIT</strong>: Thanks to the answer of John, I came up with the following implementation that should be data-race free. Even though the inner load could be non-atomic at all, I decided to leave a relaxed load in that it does not affect the performance. In comparison to always have an outer load with the acquire memory order, the thread_local machinery improves the performance of accessing the instance of about an order of magnitude.</p>\n\n<pre><code>static Tp &amp;\ninstance()\n{\n    static thread_local Tp *instance;\n\n    if (!instance &amp;&amp; \n        !(instance = m_instance.load(std::memory_order_acquire)))\n    {\n        std::lock_guard&lt;std::mutex&gt; lock(m_mutex);\n        if (!(instance = m_instance.load(std::memory_order_relaxed)))\n        {\n            instance = new Tp; \n            m_instance.store(instance, std::memory_order_release);    \n        }    \n    }\n    return *instance;\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13001052,"title":"Syncronizing a multithreaded server","body":"<p>Hello everyone i have created a multi threaded chat server that looks like this:</p>\n\n<pre><code>    public class Main {\n\n    public static ServerSocket server;\n    public static Socket connection;\n    public static int backLog = 100;\n    public static int numberOfConnected;\n    public static boolean connected = false;\n    public final static int potNumber = 6080;\n    public static PrintWriter pw;\n    public static Scanner input;\n    public static int i = 0;\n\n    public static void main(String[] args) {\n        startServer();\n\n    }\n    public static void startServer(){\n        try {\n            server = new ServerSocket(potNumber, backLog);\n            waitingForConnection();\n\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    }\n    private static void waitingForConnection() {\n        connected = false;\n        i++;\n        while (!connected) {\n            try {\n                if (connected) {\n\n                }\n                connection = server.accept();\n                Server s = new Server(connection, pw = new PrintWriter(connection.getOutputStream()), input = new Scanner(connection.getInputStream()));\n                s.start();\n                numberOfConnected++;\n                waitingForConnection();\n            } catch (IOException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n\n    }\n\n}\n</code></pre>\n\n<p>The idea is that this is suppose to be a chat server so when one connects to the server it starts the following thread:</p>\n\n<p><strong>threads</strong></p>\n\n<pre><code>    public void run(){\n    while (connection.isConnected()) {\n        if (input.hasNext()) {\n            String fullMessage = input.nextLine();\n            if (fullMessage.equalsIgnoreCase(\"Connect\")) {\n                connectHim();\n            }else {\n                chatMessage(fullMessage);\n            }\n        }\n\n        }\n    }\n\nprivate void chatMessage(String fullMessage) {\n    String name = fullMessage.substring(0, fullMessage.indexOf(\" \"));\n    String message = fullMessage.substring(fullMessage.indexOf(\" \"), fullMessage.length());\n    pw.println(name+\": \"+message);\n    pw.flush();\n\n}\nprivate void connectHim() {\n    String name = input.nextLine();\n    pw.println(0);\n    pw.flush();\n    pw.println(1);\n    pw.flush();\n    pw.println();\n    pw.flush();\n    pw.println(name);\n    pw.flush();\n\n}\n</code></pre>\n\n<p>So my problem is the following:</p>\n\n<p>if the user that is bound to thread 1 (this is an example) and the user bound to thread 2 sends a message to the server how will i send that message to the user bound on thread 1? </p>\n"},{"tags":["java","multithreading","thread-safety","htmlunit","safe"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13001163,"title":"HtmlUnit: one WebClient per thread - is it thread safe?","body":"<p>I have many threads. Each thread creates and uses it's own WebClient (HtmlUnit framework). No one thread uses WebClient's instance from other thread. Is it thread safe? </p>\n"},{"tags":["java","multithreading","tcp","thread-safety","connection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12935364,"title":"After starting a thread how could we keep the run function running? I have bunch of ideas but I'm not sure which is more professional?","body":"<p>In a <code>Thread</code> After calling the <code>start()</code> as you know it will call the <code>run()</code> function in the <code>Runnable</code> class. In the <code>run()</code> function I want the thread stays as long as it receive the \"Bye\" message from the client. If i put them in the while loop it takes heaps of memory i think and I'm not using the power of thread. By the way i don't want my thread sleep in the run function by calling <code>Thread.sleep(6000);</code> Is there any other way to stay there in the run function? </p>\n\n<ol>\n<li><p>If the answer is join where and how and use it? Should I pop it at the beginning of the run function and it stays there until I send the \"Bye\" from client?</p></li>\n<li><p>Should I say <code>while((request=in.readLine())!=null){</code>? It did not work because I think it will lose the connection with the client or better say client losing the connection?</p></li>\n<li><p>Should I say <code>while(Thread.isAlive)</code> and then kill the threat when I receive the \"Bye\" by calling <code>Thread.stop</code> which is little bit dangerous? </p></li>\n</ol>\n\n<p>Here is my simplified code: </p>\n\n<pre><code>while(true)\n        {   \n            ClientWorker w;\n            try\n            {                   \n                w = new ClientWorker(serverSocket.accept());\n                    Thread t = new Thread(w);\n                    t.start();\n                }\n......  }\n\n    class ClientWorker implements Runnable {\n        public ClientWorker(Socket incoming)\n        {\n            myList = my;\n            this.incoming = incoming;\n        }\n    public synchronized  void run()\n    {\n         in = new BufferedReader(new InputStreamReader(incoming.getInputStream()));\n.\n.\n..\n...\n}\n</code></pre>\n"},{"tags":["android","multithreading","audiotrack"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12901612,"title":"Not able to pause on Audiotrack Object : android","body":"<p>In my application i have successfully recorded the audio and now I am playing it using following function:</p>\n\n<pre><code>    public void playfile()\n{\n    System.out.println(\"Play Pressed\");     \n     speechLength = (int)(file.length()/2);\n     speech2 = new short[speechLength];\n     try\n     {\n        // Create a DataInputStream to read the audio data back from the saved file.\n        InputStream is = new FileInputStream(file);\n        BufferedInputStream bis = new BufferedInputStream(is);\n        DataInputStream dis = new DataInputStream(bis);\n\n        int i = 0;              \n        while(i &lt;  speechLength)\n        {\n            speech2[i] = dis.readShort();\n            i++;\n        }\n\n        // Close the input streams.\n        is.close();\n        bis.close();\n        dis.close();  \n\n        // Create a new AudioTrack object using the same parameters as the AudioRecord\n        // object used to create the file.\n        audioTrack = new AudioTrack(AudioManager.STREAM_MUSIC,\n                16000, \n                AudioFormat.CHANNEL_OUT_MONO,\n                AudioFormat.ENCODING_PCM_16BIT, \n                bufferSizeAT, \n                AudioTrack.MODE_STREAM);   \n\n        //Start playback\n\n\n        runner.start();\n        //Updating Progress Bar on UI Thread\n        //updateProgressBar();\n     } //main try\n    catch (Throwable t){} \n}\n Thread runner= new Thread (){\n        public void run()\n        {\n\n              // Do stuff.\n            audioTrack.play();\n            audioTrack.setStereoVolume(50, 50);\n            audioTrack.write(speech2, 0, speech2.length);\n\n        }\n    };\n</code></pre>\n\n<p>But when On the button click I want to pause the recording that has been playing it pauses , but while on resume nothing happens. Following is the code for same:</p>\n\n<pre><code>       final Button p3_button=(Button)myView.findViewById(R.id.btn_play);\n    p3_button.setOnClickListener(new View.OnClickListener()\n    {\n        @Override\n        public void onClick(View view)\n        {       \n            if(p3_button.getText().equals(\"Pause\"))\n            {\n\n                p3_button.setText(\"Resume\");\n                audioTrack.pause();\n\n\n            }\n            else if(p3_button.getText().equals(\"Resume\"))\n            {\n                p3_button.setText(\"Pause\");\n\n                audioTrack.play();\n\n\n            }\n            else\n            {\n                p3_button.setText(\"Pause\");\n                count = 0;\n                isPlayPressed = true;\n                playing = true;\n                playfile();\n            }\n        }});\n</code></pre>\n\n<p>Any help would be great. There is not much help on this one on Google. I am almost done with my app but now at the last moment I am suffering with this issue..Please help me!!</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13000446,"title":"Java checking the status of threads by using another thread","body":"<p>I have a program where a bunch of threads carry out some task. I want to know when all these threads are finished so that I can do some other stuff with their results. I don't want to use things like <code>Thread.join</code>. What I prefer is another thread checking on all these threads and when it sees that they are finished, it carries out some special task. Any ideas about how this can be done ?</p>\n"},{"tags":["android","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13000406,"title":"running an activity, timely manner in background in android","body":"<p>I am building an app using google maps api. I need to run a Activity/class/method in my activity in timely manner, say for every 1min in background without affecting main activity. How can I implement this? and where should I implement this in my activity. I am new to android programming and Java. So, I have no great idea about doing this. Can some one please help me in doing this and if possible provide me some good coding examples?\nThanks</p>\n"},{"tags":["vb.net","multithreading","stream","webclient"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12993110,"title":"VB.NET Application Freezed and not running","body":"<p>I have an application that uses a loop to call a new thread with some parameters, the application is great but when it comes to 100,000 records or so the application is not running (in the CPU and memory taskmgr not change, therefore assume that the program is not working)</p>\n\n<p>The action is:\nIt runs a function that first collects a number (X) and then create a loop from 0 to X, within this loop we create a new Thread and options as indicated IsBackground (True), Priority (Normal), and initialize the thread.\nIn the same function Thread.Join have a Do While (true) and if you can cross it refreshed interface, abort thread, memory clean and DoEvents!</p>\n\n<p>Within the thread use a WebClient to OpenRead and keep all this in a Stream.\nWith WebClient.IsBusy = False Do While we ensure that the information is downloaded and proceed to make a MatchCollection with Regex.Match.\nUsing a For Each the match and print results, and ended Exit Do.</p>\n\n<p>Then returns to the function that tells a while back ...</p>\n\n<p>At first I thought it was because of the number of results that were printed in the listbox but I got it and still fails, not when it reaches the 100,000 records if not the 100,800 or so.</p>\n\n<p>I need help, I don't know very well programming in vb.net and not understand why.</p>\n\n<p>EDIT:\nI tried remove the For Each of thread, check whether it was.\nIt has emerged completely, but I do not understand why it happens not even give me an error when \"For Each\" in the thread ¿solutions?</p>\n\n<hr>\n\n<p>EDIT:\nI found the bug, but i don't understand i explain:</p>\n\n<p>A) --> Initialize function with For 0 to 4500, i call a thread with parameters and receive 50 results, ( 225000 registers &lt;- 4500 * 50 ) when the principal For arrive to ~ 4000, in MatchCollection in Thread ¿fails? i don't receive the info of Regex.Matches and then freezed.</p>\n\n<p>B) --> Initialize function with For 4000 to 4500, i call a thread with parameters and receive 50 results, ( 225000 registers &lt;- 4500 * 50 ), nothing more begin the first thread (  remember now begin with 4000 to 4500 and i have receive a 25000 registers ) the program is freezed and i check with break points and fails the variable containing the results of Regex.Matches and attempting looping the that array the program are freezed!</p>\n\n<p>¿Why? ¿Solutions?</p>\n\n<p>Thanks!!</p>\n\n<hr>\n\n<p>Function 1 (Inicialize Thread)</p>\n\n<p>Function 1 -></p>\n\n<pre><code>For Me.d = 0 To Pages(0) ' &lt;-- 4500\nDim param(1) As Object\nparam(0) = \"name\"\nparam(1) = \"url/\" &amp; d\nDim thread As New Thread(AddressOf Thread_)\nthread.IsBackground = True\nthread.Name = \"name\"\nthread.Priority = ThreadPriority.Normal 'ThreadPriority.Lowest\nthread.Start(param)\nDo While thread.Join(True)\nthread = Nothing\nClearMemory()\nApplication.DoEvents()\nExit Do\nLoop\nNext d\n</code></pre>\n\n<p>The Thread function:</p>\n\n<pre><code>Public Sub Thread_(ByVal param As Object)\nTry\nIf param(0) = \"name\" Then\nUsing Client As New WebClient\nClient.Headers(\"User-Agent\") = \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.13 (KHTML, like Gecko) Chrome/24.0.1290.1 Safari/537.13\"\nDim html As Stream = Client.OpenRead(param(1))\nUsing reader As New StreamReader(html)\nDo While wc.IsBusy = False\nDim ReadStr = reader.ReadToEnd\nlinks = Regex.Matches(ReadStr, \"coderegex\", RegexOptions.Compiled + RegexOptions.RightToLeft + RegexOptions.Multiline + RegexOptions.Singleline)\nFor Each match In links \nRegistres(0) = Registres(0) + 1\nDebug.Print(\"Registro: \" &amp; Registres(0) &amp; \" pág:\" &amp; PagesComplete(0))\nNext\nPagesComplete(0) = PagesComplete(0) + 1\nlinks = Nothing\nClient.Dispose()\nExit Do\nLoop\nEnd Using\nEnd Using\nEnd If\nCatch ex As Exception\nDebug.Print(\"Error \" &amp; ex.Message)\nEnd Try\nEnd Sub\n</code></pre>\n"},{"tags":["multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":38,"score":-4,"question_id":13000214,"title":"Multithreading speedup","body":"<p>The latter 40% of a program supports multiple threads. You noted the time the entire program took to complete with one thread. In the ideal case, what is the overall speedup you'd expect, running the latter portion with</p>\n\n<pre><code>a. four threads rather than one?\nb. eight threads rather than one?\nc. as many as you want?\n</code></pre>\n\n<p>d. Why might the actual speedups be less than the ideal ones you calculated?</p>\n"},{"tags":["c#","multithreading","mono","monodroid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12994862,"title":"Why can't I change thread priority?","body":"<p>I write my code in MonoDevelop and I want to try namespace of System.Threading. I wrote this simple code:</p>\n\n<pre><code>class MainClass {\n  public static void Main (string[] args) {\n    System.Threading.Thread thread=new System.Threading.Thread(new System.Threading.ThreadStart(ThreadProc));\n    Console.WriteLine(thread.Priority);//output current thread priority\n    thread.Priority=System.Threading.ThreadPriority.Highest;//change thread priority\n    Console.WriteLine(thread.Priority);//output current thread priority again\n  }\n  public static void ThreadProc() {\n    //make some operations\n  }\n}\n</code></pre>\n\n<p>But I see this:\n<img src=\"http://i.stack.imgur.com/XtQYZ.jpg\" alt=\"enter image description here\"></p>\n\n<p>That is, the thread priority has not changed (OS: Ubuntu 12.10). How can I change the thread priority?</p>\n"},{"tags":["java","multithreading","tomcat","concurrency","locks"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12997006,"title":"Tomcat thread waiting on and locking the same resource","body":"<p>Consider the following Java\\Tomcat thread dump:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>\"http-0.0.0.0-4080-4\" daemon prio=10 tid=0x0000000019a2b000 nid=0x360e in Object.wait() [0x0000000040b71000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on &lt;0x00002ab5565fe358&gt; (a org.apache.tomcat.util.net.JIoEndpoint$Worker)\n    at java.lang.Object.wait(Object.java:485)\n    at org.apache.tomcat.util.net.JIoEndpoint$Worker.await(JIoEndpoint.java:458)\n    - locked &lt;0x00002ab5565fe358&gt; (a org.apache.tomcat.util.net.JIoEndpoint$Worker)\n    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:484)\n    at java.lang.Thread.run(Thread.java:662)\n</code></pre>\n\n<p>Is this a deadlock? It seems that the same resource (<code>0x00002ab5565fe358</code>) is both <code>locked</code> and <code>waited on</code> - what does it mean?</p>\n"},{"tags":["java","multithreading","concurrency","atomic","volatile"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12998570,"title":"Atomic statement ignored without volatile keyword","body":"<p>The java concurrency tutorial states that:</p>\n\n<pre><code>Reads and writes are atomic for reference variables and for most primitive variables (all types except long and double).\nReads and writes are atomic for all variables declared volatile (including long and double variables).\n</code></pre>\n\n<p>I created a simple experiment to test this</p>\n\n<pre><code>package experiment0;\n\npublic class Experiment0 {\n\n    public static int i=9;\n\n    public static void main(String[] args) {\n        i=9;\n        (new Thread(){\n            public void run(){\n                while(i==9){\n                    //System.out.println(\"i==9\");\n                }\n                System.out.println(\"\\ni!=9\");\n            }\n        }).start();\n        (new Thread(){\n            public void run(){\n                try{\n                    Thread.sleep(3000);\n                    i=8;\n                }catch(Exception e){\n\n                }\n            }\n        }).start();\n    }\n}\n</code></pre>\n\n<p>When I run this code the program never gets terminated! In order for it to work I either have to uncomment the line inside the while loop of the first thread or declare i as volatile.\nAm I missing something? Is the documentation wrong and should it say that all primitives should be declared as volatiles in these kind of cases? Why does a write to System.out \"solve\" the problem? Does it give enough time to the second thread to change i?</p>\n"},{"tags":["java","multithreading","javafx-2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12986916,"title":"Javafx multiple tasks inside another task","body":"<p>I'm writing a multi-threaded fractal drawing program with JavaFX 2.2 and now I need some guidance.</p>\n\n<p>What I'm trying to achieve is to create a Task or Service (haven't decided yet) which then fires up some other tasks that actually do the calculation and return sections of the whole image when ready. When all the pieces are returned to the initiating task it puts together the pieces and returns it to the main thread so it can be visualised.</p>\n\n<p>Obviously, all this must happen without ever blocking the UI.</p>\n\n<p>Problem is I can't figure out how these tasks could communicate with each other. For example I need to update the progress property of the initiating task based on the average progress of the tasks inside it (or something like this), so their progress properties should be bound to the progress property of the initiating task somehow. The image pieces should be put in a list or some container and redrawn on a separate image when all of them are available.</p>\n\n<p>I have already written a simpler (though still experimental) version of this program that creates only one task that calculates the whole fractal. The progress is bound to the progressBar of the GUI. The return value is handled by an EventHandler on success of the task.</p>\n\n<p>I'm not asking for a complete solution but some ideas with maybe a little bit of example code would really help me.</p>\n\n<p>This is the class that should be modified:</p>\n\n<pre><code>package fractal;\n\nimport fractalUtil.DefaultPalette;\nimport fractalUtil.PaletteInterface;\nimport javafx.concurrent.Task;\nimport javafx.scene.image.WritableImage;\nimport javafx.scene.paint.Color;\nimport org.apache.commons.math3.complex.Complex;\n\n/**\n *\n * @author athelionas\n */\npublic abstract class AbstractFractal extends Task implements FractalInterface {\n\n    private PaletteInterface palette;\n    protected final int width, height, order, iterations;\n    protected final double scale, xReal, xIm, xCenter, yCenter, zoom;\n    protected final boolean julia;\n\n    protected AbstractFractal(final int width, final int height, final double xReal, final double xIm, final double xCenter, final double yCenter, final int order, final boolean julia, final int iterations, final double zoom) {\n        this.width = width;\n        this.height = height;\n        this.xReal = xReal;\n        this.xIm = xIm;\n        this.xCenter = xCenter;\n        this.yCenter = yCenter;\n        this.order = order;\n        this.julia = julia;\n        this.iterations = iterations;\n        this.zoom = zoom;\n        this.scale = (double) width / (double) height;\n        palette = new DefaultPalette();\n    }\n\n    @Override\n    public final void setPalette(final PaletteInterface palette) {\n        this.palette = palette;\n    }\n\n    @Override\n    public abstract Complex formula(final Complex z, final Complex c, final int order, final Complex center);\n\n    @Override\n    public final Color calculatePoint(final Complex z, final Complex c, final int order, final Complex center, final int iterations) {\n        Complex zTemp = z;\n        int iter = iterations;\n        while (zTemp.abs() &lt;= 2.0 &amp;&amp; iter &gt; 0) {\n            zTemp = formula(zTemp, c, order, center);\n            iter--;\n        }\n        if (iter == 0) {\n            return Color.rgb(0, 0, 0);\n        } else {\n            return palette.pickColor((double) (iterations - iter) / (double) iterations);\n        }\n    }\n\n    @Override\n    public final WritableImage call() {\n        Complex z;\n        Complex c;\n        Complex center = new Complex(xCenter, yCenter);\n        final WritableImage image = new WritableImage(width, height);\n\n        if (julia) {\n            c = new Complex(xReal, xIm);\n            for (int y = 0; y &lt; height; y++) {\n                for (int x = 0; x &lt; width; x++) {\n\n                    z = new Complex(((double) x) / (double) (width - 1) * 2.0 * scale * (1.0 / zoom) - scale * (1.0 / zoom), ((double) y) / (double) (height - 1) * 2.0 * (1.0 / zoom) - 1.0 * (1.0 / zoom));\n\n                    image.getPixelWriter().setColor(x, y, calculatePoint(z, c, order, center, iterations));\n                }\n\n            }\n        } else {\n            z = new Complex(xReal, xIm);\n            for (int y = 0; y &lt; height; y++) {\n                for (int x = 0; x &lt; width; x++) {\n\n                    c = new Complex(((double) x) / (double) (width - 1) * 2.0 * scale * (1.0 / zoom) - scale * (1.0 / zoom), ((double) y) / (double) (height - 1) * 2.0 * (1.0 / zoom) - 1.0 * (1.0 / zoom));\n\n                    image.getPixelWriter().setColor(x, y, calculatePoint(z, c, order, center, iterations));\n                }\n                updateProgress(y, height);\n            }\n        }\n        return image;\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12986779,"title":"java concurrency with scheduledexecutor and infinite loop","body":"<p>I need to create two threads , one invoking a scheduler executor service and the other which runs in an infinite loop to fetch and process files.</p>\n\n<p>I use the following code:</p>\n\n<pre><code>ScheduledExecutorService executor = new ScheduledThreadPoolExecutor(1);\nexecutor.scheduleAtFixedRate(new Runnable() {\n        public void run()\n        {\n            obj.checkFileExist();\n            obj.enqueue();\n\n         }\n    }, 0, 1, TimeUnit.MINUTES);\n</code></pre>\n\n<p>And in an infinite loop I process files one by one:</p>\n\n<pre><code>public class processModel extends Thread{\n\n    public static void getQueueSize(int size)\n    {\n        System.out.println(\"getting queue size\");\n\n    }\n    public void dequeue()\n    {\n\n        // dequeue the queue\n        System.out.println(\"dequeue\");\n\n    }\n\n    public void processFile()\n    {\n        // process the file\n        System.out.println(\"process file\");\n    }\n\n    public static void main(String[] args) {\n        final boolean flag = true;\n        final int size = 9;\n        final processModel obj = new processModel();\n        Thread t1 = new Thread(){\n            public void run()\n            {\n                while(flag)\n                {\n                obj.dequeue();\n                obj.processFile();\n                getQueueSize(size);\n\n                }\n\n            }\n\n        };\n\n        t1.start();\n\n    }\n\n}\n</code></pre>\n\n<p>How can I achieve both concurrently?</p>\n\n<ul>\n<li>Thread 1 - check if file exists in a folder. if yes enqueue it else sleep for a min.. - scheduler can perform this</li>\n<li>Thread 2 - if queue is non empty , process one by one. else sleep for a minute</li>\n</ul>\n\n<p>How can I run these 2 threads concurrently. It would help me a lot if you show up some code.</p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12989698,"title":"Raising events in a BackgroundWorker.RunCompleted handler","body":"<p>I have an instance of class <code>Foobar</code> that was constructed on thread X. I have a function <code>StartWork()</code> that should only be called from thread X. To avoid creating bugs I enforce this constraint by checking <code>Debug.Assert(CreatorID == Environment.CurrentManagedThreadId)</code>. The function starts the asynchronous operation of a <code>BackgroundWorker</code>. I've ensured that <code>WorkCompleted()</code> is called when the worker finishes its operations by hooking into <code>RunWorkerCompleted</code>.</p>\n\n<p>For thread safety reasons <code>WorkCompleted()</code> should be executed on thread X, since it sends out event notifications. If these notifications are broadcast from the wrong thread, the program might run into unforeseen thread safety issues, I presume.</p>\n\n<p>However, in my tests I noticed that <code>WorkCompleted()</code> isn't called from thread X as I expected. How can I fix my program to prevent any thread safety issues that may arise from these events being raised? Am I approaching the problem incorrectly? I'm already aware of the fact that I'll still need to make my <code>BackgroundWorker.DoWork</code> handler thread-safe.</p>\n"},{"tags":["java","multithreading"],"answer_count":7,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":139,"score":5,"question_id":12995817,"title":"How to stop a Java thread?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/671049/how-do-you-kill-a-thread-in-java\">How do you kill a thread in Java?</a><br>\n  <a href=\"http://stackoverflow.com/questions/1881714/how-to-start-stop-restart-a-thread-in-java\">How to start/stop/restart a thread in Java?</a>  </p>\n</blockquote>\n\n\n\n<p><a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/Thread.html\" rel=\"nofollow\"><code>Thread</code></a> has the following functions:</p>\n\n<ul>\n<li><code>destroy()</code></li>\n<li><code>stop()</code></li>\n<li><code>suspend()</code></li>\n</ul>\n\n<p>but they are all deprecated.<br>\nWhat do you use to stop a thread?</p>\n"},{"tags":["c","windows","multithreading","pthreads","multicore"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12997628,"title":"Creating threads on a single-core processor","body":"<p>I am making an application in C that depends on asynchronous method calls. In my best efforts thus far to make it cross platform I am currently implementing code that looks like this:</p>\n\n<pre><code>#ifdef TARGET_WINDOWS\n//Windows threading API\n#else\n//pthreads API\n#endif\n</code></pre>\n\n<p>I appreciate there is probably a better way to do that but that is not the point of my question. My question is, what will happen to the program on a single-core processor? Will the threads still execute asynchronously (interleaved instructions perhaps), or am I stuck with single-thread execution only on single-core CPUs?</p>\n"},{"tags":["objective-c","multithreading","cocoa","memory-management","grand-central-dispatch"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1595,"score":4,"question_id":4983729,"title":"Multithreading and autorelease pool","body":"<p>As I'm mastering my skills with multithreading with GCD, I've come across some question. Suppose you have the following method:</p>\n\n<pre><code>    - (void)method {\n    NSString *string= [NSString string]; //will be autoreleased\n\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n\n    //very very lengthy operation...\n\n    NSLog(@\"%@\", string); //is it safe?\n    });\n}\n</code></pre>\n\n<p>I'm wondering if this is correct, because I think I should have retained string before the block execution: in fact I fear that the event loop finishes and sends <code>string</code> an autorelease message before using <code>string</code> in the block. That would crash the program.</p>\n\n<p>Am I right? Should I send a retain and a release message to <code>string</code> or this is the correct implementation?\nThanks in advance!</p>\n"},{"tags":["multithreading","algorithm","complexity","binomial-coefficients","binomial-cdf"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":763,"score":2,"question_id":4256188,"title":"Binomial coefficient","body":"<p>'Simple' question, what is the fastest way to calculate the binomial coefficient? - Some threaded algorithm?</p>\n\n<p>I'm looking for hints :) - not implementations :)</p>\n"},{"tags":["c","multithreading","posix","free","glibc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12996098,"title":"glibc detected free() while using posix threads in C","body":"<p>I keep getting this \"glibc detected free(): invalid next size (fast)\" error but dont know exactly why.  I read it is because of an out of bounds error but dont see anywhere in my code where this could be happening, does anyone see anything I missed?</p>\n\n<p>Here is my code:</p>\n\n<pre><code>typedef struct\n{\nint* inputData;\nint* histogramData;\nint numElements;\npthread_t* tid;\n} threadInput;\n\n\nvoid* threadRoutine(void* argv)\n{\n\n// initializers\nint i, avgInputSize, lastInputSize, threadStart, threadEnd, threadNum, numThreadsUsed;\n\n// stores input data into tempData\nthreadInput* tempData = (threadInput*) argv;\n\n// calculates the required number of threads\nnumThreadsUsed = NUM_THREADS; \nif(NUM_THREADS &gt; tempData-&gt;numElements) \n{\n    numThreadsUsed = tempData-&gt;numElements;\n}\n\n\n// create histogram\nfor(threadNum = 0; threadNum &lt; numThreadsUsed; threadNum++)\n{\n    if(tempData-&gt;tid[i] == pthread_self())\n    {\n\n        // finds start and end of data set for thread\n        if(tempData-&gt;numElements &gt; numThreadsUsed)\n        {\n            avgInputSize = (int)((tempData-&gt;numElements)/NUM_THREADS);\n            threadStart = threadNum*avgInputSize;\n            if(i &lt; (NUM_THREADS-1)) \n            {\n                threadEnd = ((threadNum+1)*avgInputSize);\n            }\n            else if(i == (NUM_THREADS-1)) \n            {\n                threadEnd = (tempData-&gt;numElements);        \n            }\n        }\n        else\n        {\n            threadStart = i;\n            threadEnd = i + 1;\n        }\n\n\n        // creates histogram\n        pthread_mutex_lock(&amp;lock);\n\n        for(i = threadStart; i &lt; threadEnd; i++)\n        {\n            tempData-&gt;histogramData[tempData-&gt;inputData[i]]++;\n        }\n\n        pthread_mutex_unlock(&amp;lock);\n    }\n}\n\n\npthread_exit(0);\n}\n\n\nvoid compute_using_pthreads(int *input_data, int *histogram, int num_elements, int histogram_size)\n    {\n    // initializers\n    int i, j;\n    threadInput* input = malloc(sizeof(threadInput*));\n    input-&gt;inputData = malloc(sizeof(input_data));\n    input-&gt;histogramData = malloc(sizeof(histogram));\ninput-&gt;tid = malloc(NUM_THREADS*sizeof(pthread_t));\n\n// enters data into struct\n    input-&gt;inputData = input_data;\ninput-&gt;histogramData = histogram;\n\n// Create threads\n    for(i = 0; i &lt;  NUM_THREADS; i++)\n            pthread_create(&amp;input-&gt;tid[i], NULL, threadRoutine, (void*) &amp;input);\n\n// reaps threads\n    for(i = 0; i &lt;  NUM_THREADS; i++)\n            pthread_join(input-&gt;tid[i], NULL);\n\n    pthread_mutex_destroy(&amp;lock);\n\n    // frees space\n    free(input-&gt;inputData);\n    free(input-&gt;histogramData);\n    free(input-&gt;tid);\n    free(input);\n\n\n}\n</code></pre>\n"},{"tags":["c","linux","multithreading","concurrency","locks"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":24,"score":3,"question_id":12996241,"title":"File segment/section/record locks in Linux threads","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12993120/file-segment-section-record-locks-in-linux-threads\">File segment/section/record locks in Linux threads</a>  </p>\n</blockquote>\n\n\n\n<p>I have a multi-threaded process where a file is shared (read and written) by multiple threads. Is there any way a thread can lock one file segment so that other threads cannot access it?\nI have tried <code>fcntl(fd, F_SETLKW, &amp;flock)</code>, but this lock only works for processes, not threads (a lock is shared between all threads in an process).</p>\n"},{"tags":["objective-c","ios","multithreading","ios6","uiactivityindicatorview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":12996039,"title":"UIActivityIndicator not showing in the Navigation bar with this code","body":"<p>Im trying to show the UIActivityIndicator on my NavigationBar in this MapView with the following code. However, no matter which way I try I cannot show it. Whats the trick here? Also, I am trying to do the map annotations fetching from server and showing on the map in the background, is this the way to do it?</p>\n\n<pre><code> - (void)viewDidLoad\n {\n  [super viewDidLoad];\n\n  self.activityIndicatorView = [[UIActivityIndicatorView alloc]                            \n              initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhite];\n  self.activityIndicatorView.hidesWhenStopped = YES;\n  self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc]\n                                    initWithCustomView:self.activityIndicatorView];\n\n [self.activityIndicatorView startAnimating];\n [self performSelectorInBackground:@selector(loadMapAnnotations) withObject: nil];\n [self.activityIndicatorView stopAnimating];\n }\n\n //=========================================================================\n -(void)loadMapAnnotations\n {\n   self.mapView.showsUserLocation = YES;\n   if(self.vManager = [VendorManager getVendorManager])\n   {\n     NSLog(@\"VendorManager = %@\",[self.vManager description] );\n\n     [self.vManager vendorsNearLocation:userLocation block:^(NSArray *vendors, \n      NSError *error)\n      {\n          if(vendors &amp;&amp; [vendors count])\n          {\n             for (id v in vendors)\n             {\n                 Vendor *aVendor = [[Vendor alloc] initWithAttributes:v];\n                 NSLog(@\"Vendor from Vendors = %@\",[aVendor name]);\n                 [self.mapView addAnnotation:aVendor];\n              }\n         }\n         else\n         {\n             NSLog(@\"Failed to get vendors: %@\", [error description] );\n         }\n\n\n      }];\n     }\n    }\n</code></pre>\n"},{"tags":["objective-c","multithreading","cocoa","concurrency","grand-central-dispatch"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":266,"score":3,"question_id":8454137,"title":"NSInvocationOperation and NSOperationQueue concurrency","body":"<p>I am using <code>NSInvocationOperation</code> with <code>NSOperationQueue</code> developing in iOS5.\nAccording to apple documentation on <strong>invocation objects</strong>:</p>\n\n<blockquote>\n  <p>The NSInvocationOperation class is a concrete subclass of\n  NSOperation... This class implements a <strong>non-concurrent</strong> operation.</p>\n</blockquote>\n\n<p>Ok, so my <code>NSInvocationOperation</code> object executes synchronously? (correct me here) Apple's docs also says on operation queue objects:</p>\n\n<blockquote>\n  <p>In iOS, operation queues do not use Grand Central Dispatch to execute\n  operations. They create separate threads for non-concurrent operations\n  and launch concurrent operations from the current thread.</p>\n</blockquote>\n\n<p>I am using the <code>NSInvocationObject</code>, which is a non-concurrent object, and adding it to to the operation queue like so:</p>\n\n<pre><code>[operationQueue addOperation:operation];\n</code></pre>\n\n<p>so my question is: 1) Since the operation queue will be spawning a separate thread to execute the NSInvocationObject as it says in the docs, will it be run asynchronously instead of synchronously?</p>\n\n<p><strong>[UPDATE - in response to Dani's answer below. Taken from an <a href=\"https://developer.apple.com/cocoa/managingconcurrency.html\" rel=\"nofollow\">Apple link</a>.</strong></p>\n\n<blockquote>\n  <p>NSOperation and NSOperationQueue</p>\n  \n  <p>There are a number of different ways that you can use NSOperation, but\n  the most common is to write a custom subclass and override one method:\n  main. The main method gets called to perform the operation when the\n  NSOperationQueue schedules it to run. NSOperation classes written in\n  this way are known as non-concurrent operations, because the developer\n  is not responsible for spawning threads—multi-threading is all handled\n  by the super class. <strong>(Don’t be confused by the terminology: just\n  because an operation is non-concurrent, does not mean it cannot be\n  executed concurrently, it simply means that you don't have to handle\n  the concurrency yourself.)</strong></p>\n  \n  <p>If you need more control over threading and the run-time environment\n  of your operations, you can make use of concurrent operations. To do\n  this, you subclass NSOperation and override the start method. In the\n  start method, you can spawn threads and setup the environment before\n  calling the main method. You are also required to maintain the state\n  of the NSOperation by setting properties like isExecuting and\n  isFinished. In short, concurrent operations give you a lot more\n  control, but also demand more effort—for most tasks non-concurrent\n  operations suffice.</p>\n</blockquote>\n"},{"tags":["android","multithreading","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12993098,"title":"Multiple downloads using asynctask","body":"<p>For my app (supporting Android 2.2+) I have to check HTML-code of a lot (approx 700) of different web-pages and retrieve a single name from each web-page. I have all the URL's stored in an array.</p>\n\n<p>I now use a single Asynctask and iterate over the array with URLs like this:</p>\n\n<p>(snippet from Asynctask's doinbackground)</p>\n\n<pre><code>publishProgress(urls.size());\nint a = 0;\nfor(String code : urls) {\n    if(!running) return null;\n    try {\n    URL url = new URL(code);\n    HttpURLConnection con = (HttpURLConnection) url.openConnection();\n    naam_codes.put(readStream(con.getInputStream(), true).get(0), code);\n      } catch (Exception e) {\n        running = false;\n      }\n    publishProgress(++a);\n</code></pre>\n\n<p>and readstream being:</p>\n\n<pre><code>BufferedReader reader = null;\n      ArrayList&lt;String&gt; html = new ArrayList&lt;String&gt;();\n      try {\n          reader = new BufferedReader(new InputStreamReader(in, Charset.forName(\"ISO-8859-1\")));\n          if (snel){\n              //reading, matching and stuff\n          }\n          else {\n              //other reading, matching and stuff\n            }\n          }       \n      } catch (IOException e) {\n        //pass\n      } finally {\n         if (reader != null) {\n             try {\n                 reader.close();\n             } catch (IOException e) {\n                 return null;\n             }\n         }\n      }\n      return html;\n</code></pre>\n\n<p>Now my problem is that it has to wait for one download+matching to finish before starting with a new one. It should be possible to speed this up, right? After monitoring for a bit the process doesn't seem to fully use the CPU nor internet-bandwidth(?). Should I instead of iterating inside one Asynctask, iterate on the UI-thread and execute multiple Asynctasks? If so, how?</p>\n"},{"tags":["java","database","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12980513,"title":"Is making a method synchronized will ensure that it is thread safe?","body":"<p>I have a method in which some database insert operations are happening using hibernate and i want them to be thread safe.  The method is getting some data in parametres and its a possiblity that sometimes two calls are made with same data at same point of time.</p>\n\n<p>I can't lock those tables because of performance degradation. Can anyone suggest making the method as synchronized will solve issue?</p>\n"},{"tags":["java","android","multithreading","service","android-intent"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12993839,"title":"How can I pass data from service/thread class to the main activity?","body":"<p>I have created variable in the main activity called <code>\"sum\"</code> and in the Thread of the service I created loop that increase variable by 1 like this: </p>\n\n<pre><code>public void run() {\n    for(int i=0;i&lt;50000000;i++) {\n        num++;\n    }\n</code></pre>\n\n<p>Now I want that every time that the variable <code>\"num\"</code> is increased by 1 , it will update the value of <code>\"sum\"</code> to the value of <code>\"num\"</code>.</p>\n\n<p>but I don't really know how to do it .</p>\n\n<p><strong>I want that it will be a live update and not after the thread will be end or the service  will be destroyed.</strong></p>\n"},{"tags":["multithreading","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12995276,"title":"Resource pool deadlock","body":"<p>This pseudocode run concurrently in multiple threads causes deadlock:</p>\n\n<pre><code>Resource res1 = pool.get();\n...\nResource res2 = pool.get();\n...\npool.release(res2);\npool.release(res1);\n</code></pre>\n\n<p>Is that an expected behavior? (I guess it is)</p>\n\n<p>Deadlock doesn't seem to happen if the size of pool is twice of the number of threads - is this statement correct?</p>\n\n<p>Is there a \"scientific\" name for this kind of deadlock in computer science? Would appreciate some links.</p>\n\n<p>Thanks</p>\n"},{"tags":["python","multithreading","parallel-processing"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12995256,"title":"Run a python program on multiple cores","body":"<p>I am new to multi-core programming. The following program using only one core. How can I make it to run on multiple cores (I have 4 cores).</p>\n\n<pre><code>simDict={}\n\ndef sim(outer,inner, ...):\n    val= /*do some math*/\n    simDict[...]=val\n\ndef foo():\n   for outer in xrange(0, limit):\n      for inner in xrange(outer, limit):\n          sim(outer,inner, ...)\nfoo()\n</code></pre>\n"},{"tags":["java","android","multithreading","service","kill"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12987987,"title":"Do threads started from android service run as long as the service?","body":"<p>I am starting a thread from an android service that constantly uploads a file using a tcp connection to a server at constant intervals. The thread has a while(true) loop that performs this. The operations get performed for sometime but then it stops. I tried using the adb logcat to debug and saw certain messages I printed inside the thread for sometime only. After that they also stopped. Further when I stopped the service I got a NullPointerException since in the onDestroy() method of the service I had used the thread object.</p>\n\n<p>Does the thread get killed and not run as long as the service runs? Do I need to do this while(true) operation in onStart() of service class itself and not spawn a new thread?</p>\n\n<p>Any solution provided will be of great help.</p>\n\n<p>Code is as follows:</p>\n\n<pre><code>    public void run() \n    {           \n        Log.d(\"TAG\",\"Starting Thread\");         \n        String data = \"\";   \n        updateServer();\n        while(flag)\n        {                   \n            String path = extStorageDirectory + \"/\" + appFolder + \"/\" + \"SAT_pingLog_\" + Long.toString(System.currentTimeMillis()) + \".txt\";\n            createFile(path);\n            int count = 0;\n            while(flag &amp;&amp; count &lt; 32768)\n            {                               \n                data = \"\";          \n                String result = Long.toString(getLatency(url));                                     \n                data = Long.toString(System.currentTimeMillis()) + \" \" + gps[0] + \" \" + gps[1] + \" \" + strength + \" \" + result;\n                Log.d(\"DEBUGGING\",data);\n                writeToLog(path,data);\n                try \n                {\n                    Thread.sleep(sleepTime);\n                } \n                catch (InterruptedException e) \n                {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n                count++;\n            }\n            updateServer();\n        }           \n    }public long getLatency(String Url)\n    {\n        long startTime = 0, endTime = 0, latency = 0;                   \n        try \n        {\n            HttpParams httpParameters = new BasicHttpParams();\n            // Set the timeout in milliseconds until a connection is established.\n            // The default value is zero, that means the timeout is not used. \n            int timeoutConnection = 10000;\n            HttpConnectionParams.setConnectionTimeout(httpParameters, timeoutConnection);\n            // Set the default socket timeout (SO_TIMEOUT) \n            // in milliseconds which is the timeout for waiting for data.\n            int timeoutSocket = 10000;\n            HttpConnectionParams.setSoTimeout(httpParameters, timeoutSocket);\n            DefaultHttpClient httpclient = new DefaultHttpClient(httpParameters);\n            HttpHead httphead = new HttpHead(Url);\n            //HttpParams httpParameters = new BasicHttpParams();                \n            //HttpConnectionParams.setConnectionTimeout(httpParameters, 5000);\n            //HttpConnectionParams.setSoTimeout(httpParameters, 5000);\n            //HttpClient httpClient = new DefaultHttpClient(httpParameters);\n            //request.setURI(new URI(\"http://www.google.com\"));\n            System.out.println(\"Executing request \" + httphead.getURI());\n            Log.d(\"DEBUGGING\",\"STARTING EXECUTE\");\n            startTime = System.currentTimeMillis();             \n            HttpResponse response = httpclient.execute(httphead);\n            endTime = System.currentTimeMillis();\n            Log.d(\"DEBUGGING\",\"ENDING EXECUTE\");\n            int status = response.getStatusLine().getStatusCode();\n            if (status == HttpStatus.SC_OK)                                \n                latency = endTime - startTime;                                      \n            else\n                latency = 0;\n        } \n        catch(Exception e)\n        {\n            Log.d(\"DEBUGGING\",\"EXCEPTION CAUGHT\");\n            e.printStackTrace();\n        }   \n        Log.d(\"DEBUGGING\",\"LATENCY:\"+Long.toString(latency));\n        return latency;\n    }       \n}\n</code></pre>\n"},{"tags":["multithreading","haskell","stm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12945690,"title":"Selective send on TChan?","body":"<p>AFAIK TChan acts as a hub, every message sent is seen by others right ?!<br>\ni want a TChan that acts as a switch to send a message to specific thread, and also support broadcasting.<br>\nis there such thing ?</p>\n"},{"tags":["c++","multithreading","pointers","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12993594,"title":"How do I return a value from thread function?","body":"<p>I have a struct like this:</p>\n\n<pre><code>struct data{\n    int x;\n    int y;\n}\n</code></pre>\n\n<p>and I have a thread function that looks like this:</p>\n\n<pre><code>void *threadFunction(void *item){\n    data *myData = (data*) item;\n    int first = 50;\n    int second = 10;\n    myData-&gt;x = first;\n    myData-&gt;y = second;\n    return(void*) myData;\n}\n</code></pre>\n\n<p>I call the thread function like this in main():</p>\n\n<pre><code>pthread_create(threadID, NULL, threadFunction, &amp;item);\n</code></pre>\n\n<p>but when I want to get the values from my thread function back into main() using this:</p>\n\n<pre><code>struct data* returnedItem;\npthread_join(threadID, (void**) returnedItem;\ncout &lt;&lt; returnedItem-&gt;x &lt;&lt; returnedItem-&gt;y;\n</code></pre>\n\n<p>I'm not sure what happens as my program seems to just do nothing. It compiles and runs, but it loops infinitely somewhere or just waits on something. I'm not sure what happens at all, I just don't get any sort of response. What am I doing wrong? Is there something I'm missing in main() to retrieve the value from the pthread_join statement? Maybe I screwed up the arguments in the statement?  </p>\n"},{"tags":["java","multithreading","jboss","log4j","synchronized"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":910,"score":4,"question_id":9343951,"title":"Log4j: is it synchronized for multithreaded calls?","body":"<p>We are running into an interesting issue that we noticed while doing stress testing of our system. We are using log4j (in JBOSS) very heavily for our logging. Here is a naive example of some logging we ave</p>\n\n<pre><code>void someFunction()\n{\nLog.info(\"entered some function\");\n...\n\nLog.info(\"existed some function\");\n}\n</code></pre>\n\n<p>Now the interesting thing we noticed is that if we launch 100 threads against this function; the Log.info() calls is blocking per thread.. meaning thread 2 is waiting for thread1 to finish the \"Log.info\" call. In case of Thread 100; it ends up waiting quite a long time.. We are using a native file logger.</p>\n\n<p>Is this a known issue?</p>\n"},{"tags":["linux","c","locking","concurrency","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12993120,"title":"File segment/section/record locks in Linux threads","body":"<p>I have a multi-threaded process where a file is shared (read and written) by multiple threads. Is there any way a thread can lock one file segment so that other threads cannot access it?\nI have tried <code>fcntl(fd, F_SETLKW, &amp;flock)</code>, but this lock only works for processes, not threads (a lock is shared between all threads in an process).</p>\n"},{"tags":["c#",".net","multithreading","thread-safety","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12993114,"title":"Backgroundworker is canceled and locked? How its possible?","body":"<p>I have strange issue reported by users and once reproduced by me. </p>\n\n<p>I have form with various buttons and each button performs long operation.</p>\n\n<p>When new buttons are clicked old operation will stops and new will be started.</p>\n\n<p>And i noticed strange behaviour:</p>\n\n<p>When i am clicking button sometimes operation doesnot started. \nOperation cannot be started because next code:</p>\n\n<pre><code>if (!Worker.IsBusy)\n        {\n            RunReload();\n        }\n        else\n        {\n            isWorkerPendingForNewJob = true;\n            Worker.CancelAsync();\n        }\n</code></pre>\n\n<p>Cancel is called few times but my worker is always busy!</p>\n\n<p><img src=\"http://i.stack.imgur.com/MUIwN.png\" alt=\"enter image description here\"></p>\n\n<p>When i brake my project execution i noticed that it stops on <strong>lock</strong> section.</p>\n\n<p>Inside this lock i am just creating some objects that are used for all processes. </p>\n\n<p>Brackpoints on image never hits. \nWhy backgroundworked is always busy and locked on this line?</p>\n\n<p><img src=\"http://i.stack.imgur.com/hW4J5.png\" alt=\"enter image description here\"></p>\n"},{"tags":["python","multithreading","lambda"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12993466,"title":"Python - while a long-running loop is going, how to have a thread periodically \"do something\" in the same scope?","body":"<p>Let's say I have a loop that'll take a while to finish, like reading a long file. How do I make it so every period of time, <code>x</code> (milliseconds?), I execute \"some code\"?</p>\n\n<pre><code>while inFile.readable():\n    line = inFile.readline()\n    print(line)   # I want to do this every few seconds\n</code></pre>\n\n<p>I'd like to do this via threading and lambdas, as an exercise.</p>\n"},{"tags":["ruby","multithreading","system","system-calls","sidekiq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12993105,"title":"Multithreaded system calls in Ruby","body":"<p>I have a system that send some processing to queues using sidekiq. These processes consist on doing system calls to programs that manipulate images. I'm having a very bad performance for this program. When I 'top' my system, almost all cpu is consumed by ruby, and just a few CPU by the image software. </p>\n\n<p>I've tried to test with 5, 10, 20, 30 workers. Adding more workers does not improve the processing performance (with high values it is even worse).</p>\n\n<p>My worker is something like this:</p>\n\n<pre><code>def perform(file)\n    command = \"convert -strip -resize 580x580 -quality 90 -sampling-factor 4:2:0 -interlace Plane #{file} #{file}.main\"\n    `#{command}`\nend\n</code></pre>\n\n<p>Is there any way to improve multithreaded system calls in Ruby?</p>\n"},{"tags":["iphone","ios","multithreading","nsoperation"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12992257,"title":"How to implement asynchronous network calls in an NSOperation","body":"<p>I have an <code>NSOperation</code> derived class which performs asynchronous download.<br>\nBecause the download operation has to be initiated from the main thread, the response is also completed on the main thread.</p>\n\n<p>Once the download has completed, I want to perform more heavy operations on the downloaded data within the <code>NSOperation</code>. </p>\n\n<p>How do I get the operations after the download has completed to be performed in a background thread again within the existing <code>NSOperation</code>?</p>\n"},{"tags":["android","multithreading","listview","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":231,"score":0,"question_id":12074985,"title":"java.util.concurrent.RejectedExecutionException in Async Task Android","body":"<pre><code>public View getView(final int position, View convertView, ViewGroup parent) {\n    SectionHolder sectionHolder = null;\n    ViewHolder holder = null;\n    convertView = listAdapter.getView(getIndexForPosition(position),\n                convertView, parent);\n    convertView.setTag(contactsIds[getIndexForPosition(position)]);\n    holder = new ViewHolder();\n    holder.txtTitle = (TextView) convertView\n                .findViewById(R.id.list_item_title);\n    holder.id = contactsIds[getIndexForPosition(position)];\n    new ThumbnailTask(holder,contactsIds[getIndexForPosition(position)]).execute();\n    return convertView;\n}\n\nprivate class ThumbnailTask extends AsyncTask&lt;Void, Void, Integer&gt; {\n    private String mId;\n    private ViewHolder mHolder;\n    public ThumbnailTask(ViewHolder holder, String id) {\n        mId = id;\n        mHolder = holder;\n    }\n\n    @Override\n    protected Integer doInBackground(Void... params) {\n        // TODO Auto-generated method stub\n        int drawableId = getContactStatus(mHolder.id);\n        // Log.i(\"DRAWABLE\",drawableId+\"\");\n        return drawableId;\n    }\n\n    protected void onPostExecute(Integer drawableId) {\n        if (mHolder.id.equals(mId)) {\n            if (drawableId != 0) {\n                if (UpdateStatusService.user == 1) {\n                    mHolder.txtTitle.setCompoundDrawablesWithIntrinsicBounds(0, 0,drawableId, 0);\n                } else {\n                    mHolder.txtTitle.setCompoundDrawablesWithIntrinsicBounds(0, 0,R.drawable.ic_action_quetion, 0);\n                }\n            } else {\n                    mHolder.txtTitle.setCompoundDrawablesWithIntrinsicBounds(0,0, android.R.color.transparent, 0);\n            }\n        }\n    }\n}\nstatic class ViewHolder {\n    public TextView txtTitle;\n    public String id;\n}\n</code></pre>\n\n<p>This is my code of adapter to getView of the listview.</p>\n\n<p>ListView Contains the list of contacts from the android.</p>\n\n<p>but i am getting the <strong>java.util.concurrent.RejectedExecutionException</strong>\nAsync task basically get the image from the server and if any number matches to the server data that will contain one image to set otherwise not.</p>\n\n<p>So what should i do to avoid this exception?</p>\n"},{"tags":["java","performance","multithreading"],"answer_count":7,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":221,"score":2,"question_id":878035,"title":"Why don't multiple threads seem to speed up my web application?","body":"<pre><code>class ApplicationContext{\n    private final NetworkObject networkObject = new networkObject();\n\n    public ApplicationContext(){\n      networkObject.setHost(\"host\");\n      networkObject.setParams(\"param\");\n    }\n\n    public searchObjects(ObjectType objType){\n        networkObject.doSearch(buildQuery(objType));\n    }\n}\n\nclass NetworkObject{\n    private final SearchObject searchObject = new SearchObject();\n\n    public doSearch(SearchQuery searchQuery){\n        searchObject.search(searchQuery); //threadsafe, takes 15(s) to return\n    }\n}\n</code></pre>\n\n<p>Consider a webserver running a web application which creates only one ApplicationContext instance (singleton) and uses the same applicationInstance to call searchObjects e.g.</p>\n\n<pre><code> ApplicationContext appInstance = \n                  ApplicationContextFactory.Instance(); //singleton\n</code></pre>\n\n<p>Every new request to a webpage say 'search.jsp' makes a call </p>\n\n<pre><code> appInstance.searchObjects(objectType);\n</code></pre>\n\n<p>I am making 1000 requests to 'search.jsp' page. All the threads are using the same ApplicationContext instance, and searchObject.search() method takes 15 seconds to return. My Question is Do all other threads wait for their turn (15 sec) to execute when one is already executing the searchObject.search() function or All threads will execute searchObject.search() concurrently, Why??</p>\n\n<p>I hope I have made my question very clear??</p>\n\n<p><strong>Update:</strong>\nThanks all for clarifying my doubt. Here is my second Question, what difference in performance should be observe when I do:</p>\n\n<pre><code>public synchronized doSearch(SearchQuery searchQuery){\n    searchObject.search(searchQuery); //threadsafe, takes 15(s) to return\n}\n</code></pre>\n\n<p><strong>OR</strong></p>\n\n<pre><code>public doSearch(SearchQuery searchQuery){\n    searchObject.search(searchQuery); //threadsafe, takes 15(s) to return\n}\n</code></pre>\n\n<p>I believe using the function 'doSearch' without synchronized keyword should be giving more performance. But, when I tested it today, the results came out the other way. The performance was similar or sometimes better when I use synchronized keyword.</p>\n\n<p>Can anyone explain the behavior. How should I debug such cases.</p>\n\n<p>Regards,</p>\n\n<p>Perry</p>\n"},{"tags":["c++","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":103,"score":0,"question_id":12990885,"title":"Why are linked lists not thread safe?","body":"<p>Ok, recently I've been thinking about thread safety a lot and I was wondering why linked lists or deques are not thread safe.</p>\n\n<p>Let's assume we have a simple linked list class like this:</p>\n\n<pre><code>class myLinkedList {\nprivate:\n    myLinkedList* next;\n    int m_value;\n\npublic:\n    myLinkedList() { next = NULL; m_value = 0; }\n    void setValue(int value) { m_value = value; }\n    int getValue() { return m_value; }\n    void addNext(int value) { next = new myLinkedList; next-&gt;setValue(value); }\n    myLinkedList* getNext() { return next; }\n};\n</code></pre>\n\n<p>Now I just want to add new elements at the end and delete elements (read them first and then delete them) at the beginning. I basically just get the address of the first <code>next</code>, delete the first element and remember the <code>next</code> as my new first element. For adding new elements I only remember the last element and when I add a new element I just set a new <code>next</code> and remember my new <code>next</code> as the last element.</p>\n\n<p>Where is the problem with threads in this scenario? Writers and readers shouldn't have any problems with this since they never interact with each other. It's not like using arrays or vectors (there I very well get why it causes problems).</p>\n"},{"tags":["ruby","multithreading","web-scraping"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":12990844,"title":"Determine ruby thread state","body":"<p>I have a Ruby script fetching HTML pages over HTTP using threads:</p>\n\n<pre><code>require \"thread\"\nrequire \"net/http\"\n\nq = Queue.new\nq &lt;&lt; \"http://google.com/\"\nq &lt;&lt; \"http://rubygems.org/\"\nq &lt;&lt; \"http://twitter.com/\"\nt = Thread.new do\n  loop do\n    html = Net::HTTP.get(URI(q.pop))\n    p html.length\n  end\nend\n\n10.times do\n  puts t.status\n  sleep 0.3\nend\n</code></pre>\n\n<p>I'm trying to determine the state of the thread while it is fetching the content from given sources. Here is the output I got:</p>\n\n<pre><code>run\n219\nsleep\nsleep\n7255\nsleep\nsleep\nsleep\nsleep\nsleep\nsleep\n65446\nsleep\n</code></pre>\n\n<p>The thread is in \"sleep\" state almost all the time though it's actually working. I understand it's waiting for the HTTP class to retrieve the content. The last \"sleep\" is different: the thread tried to pop the value from the queue which is empty and switched to \"sleep\" state until there is something new in the queue.</p>\n\n<p>I want to be able to check what's going on in the thread: Is it working on HTTP or simply waiting for new job to appear?</p>\n\n<p>What is the right way to do it?</p>\n"},{"tags":["c#","wpf","multithreading","prism","sta"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":84,"score":3,"question_id":12905486,"title":"Cannot use a DependencyObject that belongs to a different thread than its parent Freezable - prism","body":"<p>I have came across a problem while developing a WPF application.\nThe  application is based on Prism.\nThe application boots using the prism bootstraper and\nbefore loading any Window, the app opens a modal dialog on a different thread (STA),\nand then a bunch of stuff are loaded (services and etc.)\nThe dialog is open during that time and allows to notify the user on the progress of the application start-up process (using event aggregator to pass the updates).\nWhen loading is done, bootstraper closes the dialog and opens the main application window.\n<em>So far so good...</em>\nThen when closing the application, same thing is going on.\nthe Main window is closed, a dialog box is opened (again on a new  STA thread), to allow notifications.\nBut now, when hitting the ShowDialog call (which occurs inside the new STA thread),\nan exception is raised:\n\"Cannot use a DependencyObject that belongs to a different thread than its parent Freezable\".\nAfter long long hours of debugging I have figured out the cause for the exception was the background of the window which is a brush/image taken from a merged dictionary at the application level (instantiated on the wpf UI thread).\nIf loading the image without a ResouceDictionary - everything goes well.</p>\n\n<hr>\n\n<p><em><strong>To summaries:</em></strong>\nThe exception is observed only when using a resourceDictionary and only on the second call to a new STA thread which in turn loads up a DialogBox and raise an exception exactly when calling ShowDialog\nIf you have only one dialog (for example no dialog at boot time and only dialog at the shutdown process), then the exception will not occur.</p>\n\n<hr>\n\n<p><em><strong>My question is then:</em></strong> what is the reason for that? what exactly this exception mean in this case?\n(I understand that in general there is some kind of UI thread updates form other threads, but then I do not understand why this happens only on the second instance of the dialgo+thread).</p>\n\n<p>Thanks :)</p>\n"},{"tags":["c#",".net","wpf","multithreading","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12991794,"title":"Background Worker is not stopping","body":"<p>I have an application with a background worker. In the doWork method i do a html web request. If this request failed (e.g error 404), i want to exit from the thread before it finishes. So in my catch i added this code</p>\n\n<pre><code> worker.CancelAsync();\n    if (worker.CancellationPending)\n    {\n     e.Cancel = true;\n    }\n</code></pre>\n\n<p>The problem is that the thread does not stop, but it creates a new html web request.</p>\n\n<p>Some code:</p>\n\n<pre><code>try\n{\nvar request = (HttpWebRequest)WebRequest.Create(url1);\nrequest.Timeout = 5000;\nrequest.UserAgent = @\"Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5\";\nvar document = new HtmlAgilityPack.HtmlDocument();\ntry\n{\nusing (var responseStream = request.GetResponse().GetResponseStream())\n{\ndocument.Load(responseStream, Encoding.UTF8);\n//some lines of code to parse html\n}\ncatch (WebException we){\nworker.CancelAsync();\nif (worker.CancellationPending)\n{\ne.Cancel = true;\nreturn;\n}\n}\ncatch (Exception) { }\n</code></pre>\n\n<p>This is my do work method...</p>\n"},{"tags":["ios","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12991923,"title":"Are fibers available in iOS (aka user mode threads, cooperative multitasking)?","body":"<p>Are fibers available in iOS (aka user mode threads, cooperative multitasking)?</p>\n\n<p>I'm not too interested in a debate as to whether or not they're a good idea (IMO user mode threads are often a good alternative to state machines, or nodejs-like callback models). I'm just trying to figure out if this is something I will have available in my toolbox.</p>\n\n<p>See <a href=\"http://en.wikipedia.org/wiki/Fiber_%28computer_science%29\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Fiber_%28computer_science%29</a></p>\n\n<p>(Clarifying the question)</p>\n"},{"tags":["c","linux","multithreading","concurrency","locking"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12991363,"title":"File segment/section/record locks in Linux threads","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12993120/file-segment-section-record-locks-in-linux-threads\">File segment/section/record locks in Linux threads</a>  </p>\n</blockquote>\n\n\n\n<p>I have a multi-threaded process where a file is shared (read and written) by multiple threads. Is there any way a thread can lock one file segment so that other threads cannot access it?\nI have tried <code>fcntl(fd, F_SETLKW, &amp;flock)</code>, but this lock only works for processes, not threads (a lock is shared between all threads in an process).</p>\n"},{"tags":["c++","c","multithreading","thread-safety","pthreads"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":122,"score":2,"question_id":12984766,"title":"Reporting a thread progress to main thread in C++","body":"<p>In C/C++ How can I make the threads(POSIX pthreads/Windows threads) to give me a safe method to pass progress back to the main thread on the progress of the execution or my work that I’ve decided to perform with the thread.</p>\n\n<p>Is it possible to report the progress in terms of percentage ? </p>\n"},{"tags":["android","multithreading","mediaplayer","seekbar"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":416,"score":1,"question_id":5361624,"title":"How to cancel a thread","body":"<p>I am trying to make a media player which has a <code>seekbar</code>.\nAs the <code>seekbar</code> should stop progress when pause is pressed or stop is pressed. I want to stop the thread accordingly. Moreover when back is pressed I want to cancel the thread again.</p>\n"},{"tags":["c#","multithreading","silverlight","windows-phone-7"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":85,"score":5,"question_id":12991502,"title":"WP 7 multithreading, invalid cross-thread access","body":"<p>I want warn my page that the transmitted data is completed. I create object, add event handler and call new Thread for async transmitted data to server. When data transmitted, and recive from server answer i callback my event, but throw exception 'invalid cross-thread access'.\nWhy don't run my event handler?</p>\n\n<pre><code>// My page (PhoneApplicationPage)\npublic partial class PageStart\n{\n     private void btn_Send_Click(object sender, RoutedEventArgs e)\n     {\n          TransmitHolder holder = new TransmitHolder();\n          holder.onCompleted += new TransmitHolder.CompleteHandler(onCompleted);\n          // transmit async\n          new Thread(delegate() { Transmitter(holder).Start(); }).Start();\n     }\n\n     private void onCompleted(object sender, byte[] answer)\n     {\n          //some code\n     }\n}\n\npublic class TransmitHolder\n{\n     public delegate void CompleteHandler(object sender, byte[] answer);\n     public event CompleteHandler onCompleted;\n\n     public void Complete(byte[] answer)\n     {\n         if (onCompleted != null)\n         {\n             onCompleted(null, answer); // here throw exception `invalid cross-thread access`\n         }\n     }\n}\n\npublic class Transmitter\n{\n    private TransmitHolder holder;\n\n    public Transmitter(TransmitHolder holder)\n    {\n         this.holder = holder;\n    }\n\n    // send data from server\n    public void Start()\n    {\n         // send data using soket\n         NetworkManager nm = new NetworkManager();\n         // method Send execute Connect, Send and Recive data from server\n         byte[] answer = nm.Send(Encoding.UTF8.GetBytes(\"hello_word\"));\n         holder.Complette(answer); // notify, send data completed\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading","context","mediaplayer","runnable"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3246,"score":0,"question_id":3875391,"title":"Context inside a Runnable","body":"<p>I try to play a sound from R.raw. inside a Thread/Runnable\nBut I can't get this to work.</p>\n\n<pre>\nnew Runnable(){ \n  public void run() {  \n\n    //this is giving me a NullPointerException, because getBaseContext is null  \n    MediaPlayer mp = MediaPlayer.create( getBaseContext(), R.raw.soundfile);  \n\n    while (true) {  \n      if (something)  \n          play something  \n    }  \n  }\n\n</pre>\n\n<p>How can I get the real Context inside the run method? It is null no matter what I try. Or is there a better way to do this?</p>\n"},{"tags":["java","android","multithreading","networking","resttemplate"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12415554,"title":"Cancel / abort / interrupt a spring-android resttemplate request","body":"<p>I use spring android in a thread dedicated to execute spring android requests.</p>\n\n<p>I can't achieve to abort a request launched from spring android (a getForObject for instance).</p>\n\n<p>I tried to :</p>\n\n<ul>\n<li>reach the underlying input stream to close but it is completely wrapped in springandroid restemplate and can't be accessed from outside</li>\n<li>interrupt the thread</li>\n<li>get the request factory of the rest template and call destroy</li>\n<li>get the connection manager of the factory and call shutdown</li>\n<li>change the rest template factory's http client</li>\n<li>change the rest template factory's request factory</li>\n</ul>\n\n<p>but I can't abort a request and send a new one quickly. The first one has to reach its timeout.</p>\n\n<p>How could I \"kill\" a spring android request a get a stable rest template to send a new request ?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c","multithreading","posix"],"answer_count":5,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1295,"score":6,"question_id":3125645,"title":"Why use select() instead of sleep()?","body":"<p>I'm working through a chapter about iPhone audio and have come across a section of code that I can't make sense of:</p>\n\n<pre><code>while (aqc.playPtr &lt; aqc.sampleLen) \n{\n    select(NULL, NULL, NULL, NULL, 1.0);\n}\n</code></pre>\n\n<p>(<a href=\"http://oreilly.com/catalog/9780596523190/preview\">Full code sample is on pages 163-166</a>). From what I understand of the code the audio is being processed on another thread and the while loop is just there to prevent the main thread from terminating while audio is still being processed.</p>\n\n<p>What I don't understand is why <code>select()</code> is being used instead of <code>sleep()</code>.</p>\n\n<p>From what I've read <code>select()</code> is used to monitor changes in I/O and passing it NULLs doesn't do anything meaningful. I've ran the code using <code>sleep()</code> and it works as expected. (My knowledge of low level POSIX is almost non-existant.)</p>\n"},{"tags":["c","linux","multithreading","concurrency","multicore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":92,"score":0,"question_id":12988946,"title":"Are both calls to `fprintf(stdout, ...)` and `fprintf(stderr, ...)` guaranteed to non-interleave with multiple threads?","body":"<p>Say I have two threads that print something (relatively long) either to <code>stderr</code> or <code>stdout</code>, is the function to both these streams thread-safe in the sense that they will never \"interleave\" characters? So, for example, if I have \"Hello, World\", I will never get \"HHellllo,, WorldWorld\" Or whatever other interleaving? This is for x86, GCC, Linux > 3.0.</p>\n"},{"tags":["c++","multithreading","glib","gtkmm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":283,"score":1,"question_id":10336192,"title":"C++ Gtk threading. Am I doing it right?","body":"<p>I have a gtkmm application and I'm trying to put some long running tasks into separate threads so they don't lock the GUI. Here's a tutorial I've based my design on:</p>\n\n<p><a href=\"http://www.velvetcache.org/2008/09/30/gtkmmglibmm-thread-example\" rel=\"nofollow\">http://www.velvetcache.org/2008/09/30/gtkmmglibmm-thread-example</a></p>\n\n<p>I use Glib::Dispatcher signals to notify the GUI thread when the work is done or something needs to be updated, however I'm not sure how to pass the data between the worker thread and GUI thread. So far I've been passing a pointer to the class which creates the worker to the worker and then modifying public members of the class, but something tells me it's not the most correct to do it. Here's an example:</p>\n\n<pre><code>class Some_GUI_class\n{\npublic:\n    std::string thread_message;\n\nprivate:\n    Worker_class* worker;\n\n    void start_worker()\n    {\n        if (worker != NULL) return;\n\n        worker = new Worker_class(this);\n        worker-&gt;sig_message.connect(sigc::mem_fun(*this, &amp;Some_GUI_class::display_message_from_thread);\n        worker.start();\n    }        \n\n    void display_message_from_thread()\n    {\n        some_label-&gt;set_text(thread_message);\n    }\n}\n\nclass Worker_class\n{\npublic:\n    Worker_class(Some_GUI_class* gui_class) : gui_class(gui_class)\n    {}\n\n    void start()\n    {\n        thread = Glib::Thread::create(sigc::mem_fun(*this, &amp;Worker_class::run), true);\n    }\n\n    Glib::Dispather sig_message;\n\nprotected:\n    Glib::Thread* thread;\n    Glib::Mutex mutex;\n\n    Some_GUI_class* gui_class;\n\n    void run()\n    {\n        // ...\n        gui_class-&gt;thread_message = \"Message from a thread!\";\n        sig_message();                \n    }\n\n}\n</code></pre>\n\n<p>This essentialy works, but I guess if the GUI thread wanted to modify thread_message at the same time there would be a problem? Is it safe to do it like this then as long as I'm sure the variables are only modified by a single thread or is there a better way?</p>\n"},{"tags":["c#",".net","winforms","multithreading","invoke"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12956288,"title":"Avoiding `ObjectDisposedException` while calling `Invoke`","body":"<p>I have 2 forms, one is <code>MainForm</code> and second is <code>DebugForm</code>. The MainForm has a button that sets up and shows the DebugForm like this, And passes a reference to an already opened SerialPort:</p>\n\n<pre><code>private DebugForm DebugForm; //Field\nprivate void menuToolsDebugger_Click(object sender, EventArgs e)\n{\n    if (DebugForm != null)\n    {\n        DebugForm.BringToFront();\n        return;\n    }\n\n    DebugForm = new DebugForm(Connection);\n\n    DebugForm.Closed += delegate\n    {\n        WindowState = FormWindowState.Normal;\n        DebugForm = null;\n    };\n\n    DebugForm.Show();\n}\n</code></pre>\n\n<p>In the DebugForm, I append a method to handle the <code>DataReceived</code> event of the serialport connection (in DebugForm's constructor):</p>\n\n<pre><code>public DebugForm(SerialPort connection)\n{\n    InitializeComponent();\n    Connection = connection;\n    Connection.DataReceived += Connection_DataReceived;\n}\n</code></pre>\n\n<p>Then  in the <code>Connection_DataReceived</code> method, I update a TextBox in the DebugForm, that is using Invoke to do the update:</p>\n\n<pre><code>private void Connection_DataReceived(object sender, SerialDataReceivedEventArgs e)\n{           \n    _buffer = Connection.ReadExisting();\n    Invoke(new EventHandler(AddReceivedPacketToTextBox));\n}\n</code></pre>\n\n<p>But I have a problem. As soon as I close the DebugForm, it throws an <code>ObjectDisposedException</code> on the <code>Invoke(new EventHandler(AddReceivedPacketToTextBox));</code> Line.</p>\n\n<p>How can I fix this? Any tips/helps are welcome!</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I found out if I remove the event in a button event click , and close the form in that button click, everything is fine and my debugform gets closed without any exception...how odd!</p>\n\n<pre><code>private void button1_Click(object sender, EventArgs e)\n{\n    Connection.DataReceived -= Connection_DebugDataReceived;\n    this.Close();\n}\n</code></pre>\n"},{"tags":["java","multithreading","notify"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12989397,"title":"running 3 threads in sequence java","body":"<p>I have 3 threads \n1st printing A\n2nd printing B\n3rd printing C</p>\n\n<p>I want to print in sequence A B C A B C A B C and so on.....</p>\n\n<p>So I wrote the program below, but I am not able to achieve the same.\nI am aware of the problem that when status=1 at that time say for example B1 and C1 thread are waiting and when I do notifyAll() both waiting thread wake up and depending on CPU allocation it might print B or C.</p>\n\n<p>in this case I want only B to be printed after A.</p>\n\n<p>what modification I need to do.</p>\n\n<pre><code>public class NotifyAllExample {\n\n    int status=1;\n    public static void main(String[] args) {\n\n        NotifyAllExample notifyAllExample = new NotifyAllExample();\n\n        A1 a=new A1(notifyAllExample);\n        B1 b=new B1(notifyAllExample);\n        C1 c=new C1(notifyAllExample);\n\n        a.start();\n        b.start();\n        c.start();\n    }\n}\n\nclass A1 extends Thread{\n    NotifyAllExample notifyAllExample;\n\n    A1(NotifyAllExample notifyAllExample){\n        this.notifyAllExample = notifyAllExample;\n    }\n\n    @Override\n    public void run() {\n\n        try{\n            synchronized (notifyAllExample) {\n\n                for (int i = 0; i &lt; 100; i++) {\n\n                    if(notifyAllExample.status!=1){\n                        notifyAllExample.wait();\n                    }\n\n                    System.out.print(\"A \");\n                    notifyAllExample.status = 2;\n                    notifyAllExample.notifyAll();\n                }\n\n            }\n        }catch (Exception e) {\n            System.out.println(\"Exception 1 :\"+e.getMessage());\n        }\n\n    }\n\n}\n\nclass B1 extends Thread{\n\n    NotifyAllExample notifyAllExample;\n\n    B1(NotifyAllExample notifyAllExample){\n        this.notifyAllExample = notifyAllExample;\n    }\n\n    @Override\n    public void run() {\n\n        try{\n            synchronized (notifyAllExample) {\n\n                for (int i = 0; i &lt; 100; i++) {\n\n                    if(notifyAllExample.status!=2){\n                        notifyAllExample.wait();\n                    }\n\n                    System.out.print(\"B \");\n                    notifyAllExample.status = 3;\n                    notifyAllExample.notifyAll();\n                }\n\n            }\n        }catch (Exception e) {\n            System.out.println(\"Exception 2 :\"+e.getMessage());\n        }\n\n    }\n}\n\n\nclass C1 extends Thread{\n\n    NotifyAllExample notifyAllExample;\n\n    C1(NotifyAllExample notifyAllExample){\n        this.notifyAllExample = notifyAllExample;\n    }\n\n    @Override\n    public void run() {\n\n        try{\n            synchronized (notifyAllExample) {\n\n                for (int i = 0; i &lt; 100; i++) {\n\n                    if(notifyAllExample.status!=3){\n                        notifyAllExample.wait();\n                    }\n\n                    System.out.print(\"C \");\n                    notifyAllExample.status = 1;\n                    notifyAllExample.notifyAll();\n                }\n\n            }\n        }catch (Exception e) {\n            System.out.println(\"Exception 3 :\"+e.getMessage());\n        }\n\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","static","interlocked"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12988636,"title":"Should I use static fields and interlocked together?","body":"<p>Should I use static fields and interlocked together, in cases when i need to provide thread safety and atomic operations with static fields, Is static fields are atomic by default? For example:</p>\n\n<pre><code>Interlocked.Increment(ref Factory.DefectivePartsCount);\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["c++","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":77,"score":-2,"question_id":12988426,"title":"Running eight threads in a particular order until termination","body":"<p>I've a core 2 duo processor.</p>\n\n<p>I want to create and run eight threads(that have no shared data in between them) such that in any given time all eight will run once where thread 1 and thread 2  will run at the same time and if thread 1 and thread 2 can't run simultaneously by the processor I want priority be given to thread 1 so that thread 1 will run before thread 2. </p>\n\n<p>Similarly thread 3 and 4  can run concurrently but if thread 3 and thread 4 can't run at the same time I want thread 3 to execute before thread 4 and not before thread 1 and 2 and not after thread 5 and 6 and thread 7 and thread 8. </p>\n\n<p>Same for thread 5 and thread 6, thread 7 and thread 8. </p>\n\n<p>After all 8 threads have finish their tasks the 8 threads will run again and again in the above given order until termination. </p>\n\n<p>How can achieve this using c++ and visual studio 2008 on Windows 7? </p>\n\n<p>Is it possible to implement this with c++?</p>\n"},{"tags":["c++","multithreading","qt","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12988010,"title":"right way to write to file from different threads (using Qt c++ )","body":"<p>i have thread pool that create threads each thread worker calculate some work and when it done\nit writes the result to file , there is only 1 result file , that each worker thread needs to write to .<br>\nnow my question is how i guarantee that there wouldn't be any locks or missing write data to the file where allot of threads trying to write to single file ? what is the right strategy for such scenario?<br>\nmybe keep all result in memory ? or chanks of results  </p>\n\n<p>im using already the QThreadPool framework , and i need to find solution with it.<br>\nalso i wander , does writing to single file from worker threads , i will have to use<br>\nsingleton file manager or static class , is it good idea? for multithreaded app ?  </p>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":86,"score":1,"question_id":12970299,"title":"Recursive synchronization","body":"<p>In my app two threads invoke the same recursive function, that should output data to some file. I don't know how I can synchonized this threads to output correct data. I try a few variants with mutex (commented in code using /<strong>** n **</strong>/), but it doesn't work (output data are mixed from different threads). How can I organize synchronizathion(i should use only WinAPI and std). Pseudocode below:</p>\n\n<pre><code>HANDLE hMutex = CreateMutex(NULL,FALSE, 0);\nwchar_t** HelpFunction(wchar_t const* p, int *t)\n{\n    do\n    {\n        /**** 1 ****/ //WaitForSingleObject(hMutex, INFINITE);\n        wchar_t* otherP= someFunction();\n        if(...)\n        {\n            /**** 2 ****/ //WaitForSingleObject(hMutex, INFINITE);\n            //File's output should be here\n            //Outputing p\n            /**** 2 ****/ //ReleaseMutex(hMutex);\n        }\n        if(...)\n        {\n            HelpFunction(otherP, t);\n        }\n        /**** 1 ****/ //ReleaseMutex(hMutex);\n    }while(...);\n}\nunsigned int WINAPI ThreadFunction( void* p)\n{\n    int t = 0;\n    /**** 3 ****/ //WaitForSingleObject(hMutex, INFINITE);\n    wchar_t** res = HelpFunction((wchar_t *)p, &amp;t);\n    /**** 3 ****/ //ReleaseMutex(hMutex);\n    return 0;\n}\nvoid _tmain()\n{\n    HANDLE hThreads[2];\n    hThreads[0] = (HANDLE)_beginthreadex(NULL, 0, ThreadFunction, L\"param1\", 0, NULL);\n    hThreads[1] = (HANDLE)_beginthreadex(NULL, 0, ThreadFunction, L\"param2\", 0, NULL);\n    WaitForMultipleObjects(2, hThreads, TRUE, INFINITE);\n}\n</code></pre>\n"},{"tags":["wpf","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12817808,"title":"using Dispatcher.Invoke() and still get the \"The calling thread cannot access this object because a different thread owns it\" exception","body":"<p>I have this snippet of code:</p>\n\n<pre><code>        plane.Dispatcher.Invoke((Action)delegate\n        {\n            plane.Geometry = mesh;\n        }, System.Windows.Threading.DispatcherPriority.Render);\n</code></pre>\n\n<p>which i put inside of an event handler method i have in my window class. the caller of this handler is a thread that handles TCP data.\nplane is a GeometryModel3D object that is initialized in the XAML.\nthat should run smoothly from a non UI thread, right?\nbut still i get this annoying exception that this is not the UI thread.\nAlso, tried - this.Dispatcher.Invoke - by \"this.Dispatcher\" i mean Window.Dispatcher.</p>\n\n<p>any ideas this doesn't work?</p>\n"},{"tags":["java","multithreading","freeze"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":988,"score":0,"question_id":1530088,"title":"Java thread: 'join' froze my program","body":"<p>My program looked like this:</p>\n\n<pre><code>class Prog\n {\n BufferedImage offscreen;\n KindOfDatabase db;\n MyThread thread;\n\n class MyThread extends Thread\n    {\n    volatile boolean abort=false;\n    long lastUpdated;\n    public void run()\n        {\n        try\n          {\n          KindOfCursor c = db.iterator();\n          while(c.getNext())\n            {\n            if(abort) break;\n            //fill a histogram with the data,\n            // calls SwingUtilities.invokeAndWait every 500ms to\n            //do something with offscreen and update a JPanel\n            }\n          catch(Exception err)\n            {\n            err.printStackTrace();\n            }\n          finally\n            {\n            c.close();\n            }\n        }\n    }\n\n  void stopThread()\n       {\n       if(thread!=null)\n          {\n          thread.abort=true;\n          thread.join();\n          thread=null;\n          }\n       }\n  void startThread()\n      {\n      stopThread();\n      thread=new MyThread();\n      thread.start();\n      }\n(....)\n }\n</code></pre>\n\n<p>1) The program worked well on my computer. But when I ran it threw a <em>'ssh -X remote.host.org '</em> connection, all was very slow and the program was frozen when thread.join() was invoked. I replaced 'join' by 'interrupt()' and the program was not anymore frozen. Why ? Should I fear that, when  interrupt() is called, the 'finally' statement closing the iterator was not invoked ?</p>\n\n<p>2) should I use 'Thread.isInterrupted()' instead of my boolean 'abort' ?</p>\n\n<p>Thanks</p>\n\n<p><strong>UPDATE</strong>: my abort flag was labelled with volatile. Doesn't change the frozen state.</p>\n"},{"tags":["android","multithreading","class","closing"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":12987644,"title":"Thread class closing from other Class (Activity) with protected void onStop() Android","body":"<p>I have a Problem with Closing the Thread. I will Closing the Thread with onStop,onPause and onDestroy. This is my Source in the Activity Class:</p>\n\n<pre><code>   @Override\nprotected void onStop(){\n   super.onStop();\n   finish();\n} \n\n@Override\nprotected void onPause()  { \n     super.onPause(); \n     finish();\n    } \n\n@Override\npublic void onDestroy() {\n        this.mWakeLock.release();\n        super.onDestroy();\n}\n</code></pre>\n\n<p>And the Thread Class:</p>\n\n<pre><code>public class GameThread extends Thread {\n\nprivate SurfaceHolder mSurfaceHolder;\nprivate Handler mHandler;\nprivate Context mContext;\nprivate Paint mLinePaint;\nprivate Paint blackPaint;\n\n//for consistent rendering\nprivate long sleepTime;\n//amount of time to sleep for (in milliseconds)\nprivate long delay=1000/30;\n//state of game (Running or Paused).\nint state = 1;\npublic final static int RUNNING = 1;\npublic final static int PAUSED = 2;\npublic final static int STOPED = 3;\n\nGameSurface gEngine;\n\npublic GameThread(SurfaceHolder surfaceHolder, Context context, Handler handler,GameSurface gEngineS){\n\n    //data about the screen\n    mSurfaceHolder = surfaceHolder;\n    mHandler = handler;\n    mContext = context;\n    gEngine=gEngineS;\n}\n\n//This is the most important part of the code. It is invoked when the call to start() is\n//made from the SurfaceView class. It loops continuously until the game is finished or\n//the application is suspended.\nprivate long beforeTime;\n@Override\npublic void run() {\n\n    //UPDATE\n    while (state==RUNNING) {\n        Log.d(\"State\",\"Thread is runnig\");\n        //time before update\n        beforeTime = System.nanoTime();\n        //This is where we update the game engine\n        gEngine.Update();\n\n        //DRAW\n        Canvas c = null;\n        try {\n            //lock canvas so nothing else can use it\n            c = mSurfaceHolder.lockCanvas(null);\n            synchronized (mSurfaceHolder) {\n                //clear the screen with the black painter.\n                //reset the canvas\n                c.drawColor(Color.BLACK);\n                //This is where we draw the game engine.\n                gEngine.doDraw(c);\n            }\n        } finally {\n            // do this in a finally so that if an exception is thrown\n            // during the above, we don't leave the Surface in an\n            // inconsistent state\n            if (c != null) {\n                mSurfaceHolder.unlockCanvasAndPost(c);\n            }\n        }\n\n\n\n        this.sleepTime = delay-((System.nanoTime()-beforeTime)/1000000L);\n\n        try {\n            //actual sleep code\n            if(sleepTime&gt;0){\n                this.sleep(sleepTime);\n\n            }\n        } catch (InterruptedException ex) {\n            Logger.getLogger(GameThread.class.getName()).log(Level.SEVERE, null, ex);\n        }\n\n        while (state==PAUSED){\n            Log.d(\"State\",\"Thread is pausing\");\n            try {\n                this.sleep(1000);\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n    }\n}}\n</code></pre>\n\n<p>How i can close the Thread from Activity Class??</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":10217,"score":9,"question_id":659796,"title":"Run external program from Java, read output, allow interruption","body":"<p>I want to launch a process from Java, read its output, and get its return code. But while it's executing, I want to be able to cancel it. I start out by launching the process:</p>\n\n<pre><code>ProcessBuilder pb = new ProcessBuilder(args);\npb.redirectErrorStream(true);\nProcess proc = pb.start();\n</code></pre>\n\n<p>If I call proc.waitFor(), I can't do anything until the process exits. So I'm assuming I need to something like this:</p>\n\n<pre><code>while (true) {\n  see if process has exited\n  capture some output from the process\n  decide if I want to cancel it, and if so, cancel it\n  sleep for a while\n}\n</code></pre>\n\n<p>Is this right? Can someone give me an example of how to do this in Java?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12987233,"title":"Playing sound on a Thread by a button click but not able to stop it from main thread by another button","body":"<p>I am just trying to play a .wav sound by a button click, by using .Net 4.0 - Task.Factory for selected number of times, it is playing fine, but a moment I want to stop this sound quickly through other button, I can say Stop button, but it is not stopping the sound quickly, it stop only after complete play... below is my code...</p>\n\n<pre><code>CancellationTokenSource tokenSource = new CancellationTokenSource();\n\nprivate void btnStartPlaying_Click(object sender, EventArgs e)\n{\n            tokenSource = new CancellationTokenSource();                       \n            List&lt;Task&gt; tasks = new List&lt;Task&gt;();\n            var ui = TaskScheduler.FromCurrentSynchronizationContext();\n            int playTimes = 3;\n\n            var compute = Task.Factory.StartNew(() =&gt;\n            {\n                Playing(playTimes);\n\n            }, tokenSource.Token);\n            tasks.Add(compute);\n\n            var displayResults = compute.ContinueWith(resultTask =&gt;                                     \n                                                        Environment.NewLine,\n                                                        CancellationToken.None,\n                                                        TaskContinuationOptions.OnlyOnRanToCompletion,\n                                                    ui);\n            var displayCancelledTasks = compute.ContinueWith(resultTask =&gt;                                               \n                                                                Environment.NewLine,\n                                                                CancellationToken.None,\n                                                                TaskContinuationOptions.OnlyOnCanceled, ui);            \n            Task.Factory.ContinueWhenAll(tasks.ToArray(),\n                result =&gt;\n                {\n\n                }, CancellationToken.None, TaskContinuationOptions.None, ui);\n}\n\n\nprivate void btnStopPlaying_Click(object sender, EventArgs e)\n{\n      tokenSource.Cancel();            \n}\n\npublic void Playing(int times)\n{\n     try\n     {\n      using (SoundPlayer player = new SoundPlayer(\"mySoundFile.wav\"))\n                {\n                    for (int i = 0; i &lt; times; i++)\n                    {\n                        tokenSource.Token.ThrowIfCancellationRequested();\n                        player.PlaySync();\n                    }\n                }\n            }\n            catch (Exception ex)\n            {\n                MessageBox.Show(\"Stopped!!!!!\");\n            }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12984921,"title":"Can not using join() in multi thread in Java","body":"<p>I have some problem about multithread. My program is below:</p>\n\n<pre><code>...\nfor(int i=0; i&lt; 10; i++)\n{\n   new Thread(){\n       @Overried\n       public void run(){\n           &lt;do something level 1&gt;\n\n           &lt;do something level 2&gt;\n       }\n   }.start;\n}\n&lt;do something level 3&gt;\n...\n</code></pre>\n\n<p>I hope main thread only executes [do something level 3] after all 10 thread finished [do something level 2]. And do not have any thread execute [do something level 2] before the event which all child-thread finished [do something level 1] occurs.</p>\n"},{"tags":["android","multithreading","user-interface","activity","static"],"answer_count":4,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":4404,"score":1,"question_id":7539491,"title":"Android's Activity.runOnUiThread is not static, so how can i use it?","body":"<p>For example, if I have a thread doing expensive stuff, and from that thread I want to fire runOnUiThread in the Main (activity) class. Obviously I shouldn't make an instance of my activity class (Main). So if I try    </p>\n\n<pre><code> Main.runOnUiThread(mRunnable);\n</code></pre>\n\n<p>from my thread it gives me an error saying it's not a static method, and therefor it can't be accessed in my way. Now my understanding would be that the activity class is nearly almost accessed in a static way.<br>\nHow would I do this?</p>\n\n<p>(Btw: I'm doing this because I was getting <em>CalledFromWrongThreadException, Only the original thread that created a view hierarchy can touch it's views</em>)</p>\n"},{"tags":["c#","multithreading","delegates","webbrowser","apartments"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":5514,"score":0,"question_id":369594,"title":"WebBrowser.Navigated Only Fires when I MessageBox.Show();","body":"<p>I have a WebBrowser control which is being instantiated dynamically from a background STA thread because the parent thread is a BackgroundWorker and has lots of other things to do.</p>\n\n<p>The problem is that the Navigated event never fires, unless I pop a MessageBox.Show() in the method that told it to .Navigate().   I shall explain:</p>\n\n<pre><code>ThreadStart ts = new ThreadStart(GetLandingPageContent_ChildThread);\nThread t = new Thread(ts);\nt.SetApartmentState(ApartmentState.STA);\nt.Name = \"Mailbox Processor\";\nt.Start();\n\nprotected void GetLandingPageContent_ChildThread()\n{\n WebBrowser wb = new WebBrowser();\n wb.Navigated += new WebBrowserNavigatedEventHandler(wb_Navigated);\n wb.Navigate(_url);\n MessageBox.Show(\"W00t\");\n}\n\nprotected void wb_Navigated(object sender, WebBrowserNavigatedEventArgs e)\n{\n WebBrowser wb = (WebBrowser)sender; // Breakpoint\n HtmlDocument hDoc = wb.Document;\n}\n</code></pre>\n\n<p>This works fine; but the messagebox will get in the way since this is an automation app. When I remove the MessageBox.Show(), the WebBrowser.Navigated event never fires.  I've tried supplanting this line with a Thread.Sleep(), and by suspending the parent thread.</p>\n\n<p>Once I get this out of the way, I intend to Suspend the parent thread while the WebBrowser is doing its job and find some way of passing the resulting HTML back to the parent thread so it can continue with further logic.</p>\n\n<p><em>Why does it do this? How can I fix it?</em></p>\n\n<p>If someone can provide me with a way to fetch the content of a web page, fill out some data, and return the content of the page on the other side of the submit button, all against a webserver that doesn't support POST verbs nor passing data via QueryString, I'll also accept that answer as this whole exercise will have been unneccessary.</p>\n\n<hr>\n\n<p><strong>Solution:</strong> I ended up just not using the BackgroundWorker and slave thread at all at the suggestion of the team architect... Though at the expense of responsiveness :(</p>\n"},{"tags":[".net","multithreading"],"answer_count":8,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":390,"score":1,"question_id":278858,"title":".NET threading in this code","body":"<p>Here is my code: </p>\n\n<pre><code>ThreadStart threadStart = controller.OpenFile;\nThread thread = new Thread(threadStart);\nthread.Start();\n</code></pre>\n\n<p>In the OpenFile function, my code looks like:</p>\n\n<pre><code>System.Console.Error.WriteLine(\"Launching\");\n</code></pre>\n\n<p>The code in OpenFile doesn't get executed for 30 seconds exactly. It starts immediately on my machine, but in our production environment it takes 30 seconds before that print statement will execute.</p>\n\n<p>Is there a setting or something that might be doing this? Where would I start looking?</p>\n"},{"tags":["c++","multithreading","books","boost-thread"],"answer_count":6,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":3018,"score":6,"question_id":301000,"title":"Book for C++ threading?","body":"<p>Is there any good book for C++ threading which uses <a href=\"http://en.wikipedia.org/wiki/Boost_C++_Libraries\" rel=\"nofollow\">Boost</a> threads?</p>\n\n<p>Please post one book per answer.</p>\n"},{"tags":[".net","multithreading","books"],"answer_count":5,"favorite_count":6,"up_vote_count":8,"down_vote_count":0,"view_count":1303,"score":8,"question_id":1526520,"title":"Good book about threading in .NET","body":"<p>What good book about threading in .NET can be recommended?</p>\n\n<p>I'm using the <a href=\"http://en.wikipedia.org/wiki/.NET_Framework\" rel=\"nofollow\">.NET</a> 3.5 framework and working with Visual Basic.</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12983271,"title":"Java thread stops working and no Exception or Throwable is thrown","body":"<p>I usually run my program with about 4 threads and anywhere between 1 hour to 10 hours after the program is running some threads just stop and do nothing, I have my program around Exception and Throwable block and I also have a uncaughtException for the thread and nothing gets added to my log files about any errors. How can I find what is causing the threads to stop?</p>\n\n<p>EDIT</p>\n\n<p>Here is the basic structure of my code</p>\n\n<p>Below is the code for setting the uncaughtException block</p>\n\n<pre><code>                newThread.setName(\"Thread\" + totalNumberOfThreads);\n                newThread.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler()\n                {\n                    @Override\n                    public void uncaughtException(Thread t, Throwable e)\n                    {\n                        Main.logger.info(\"ERROR! An exception occurred in \" + t.getName() + \". Cause: \" + e.getMessage());\n                    }\n                });\n                newThread.start();\n</code></pre>\n\n<p>And this is the basic structure of the thread</p>\n\n<pre><code>@Override\npublic void run()\n{               \n  while (true)\n  {\n    try\n    {               \n      //a long section of code\n    }\n    catch (Exception e)\n    {\n      e.printStackTrace();\n      Main.logger.info(threadName + \": \" + e);\n    }\n    catch (Throwable t)\n    {\n      Main.logger.info(threadName + \": \" + \"Throwable: \" + t);\n    }\n    finally\n    {      \n      //some code to close connections.. ect..\n    }\n  } // end while\n}\n</code></pre>\n"},{"tags":["multithreading","perl","sleep"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":328,"score":1,"question_id":3721483,"title":"Perl ithreads: Do some math instead of sleeping","body":"<p>I am using perl ithreads and things work fine, unless I decide to have threads sleep. </p>\n\n<p>Lets say my routine thread_job is passed as an entry for several threads to start running concurrently. </p>\n\n<pre><code>thread_job()\n{\n...\nsleep 2;\n\n#do other stuff here\n\n}\n</code></pre>\n\n<p>If I dont have a sleep I have no issues with the threads running and they do their tasks fine. If I add a sleep, my script hangs. I am running this off a windows command prompt, if that helps. </p>\n\n<p>Since I do need to sleep and Im guessing there's an issue with using this sleep on my current setup, I intend to have the thread do something, for a while, instead of sleeping. Is there any such mathematical operation which I could perform?</p>\n"},{"tags":["multithreading","weblogic","jython","wlst"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":9448936,"title":"Jython WLST using python threading module (Weblogic 10)","body":"<h1>Environment</h1>\n\n<ul>\n<li>Weblogic 10</li>\n<li>Sun Java</li>\n<li>HP UX</li>\n</ul>\n\n<h1>Goal</h1>\n\n<p>Restart all managed instances with all clusters in a rolling restart fashion. Would like the different clusters to restart concurrently</p>\n\n<h1>Question</h1>\n\n<p>Is there a way to use Jython's threading module to do multiple WLST actions at the same time?</p>\n\n<h1>Attempted Approach</h1>\n\n<p>In one script I have classes for both cluster and server instance. A cluster has a list of server instances. There is a method on the cluster object to loop through its list of servers and restart them one by one if the cluster is healthy. I have tried passing this method into a thread like so:</p>\n\n<pre><code>Thread(target=lambda: cluster.managedRestart()).start()\n</code></pre>\n\n<p>But I receive an error\n<code>TypeError: can't set arbitrary attribute in java instance: target</code></p>\n\n<h1>Ideas</h1>\n\n<p>Break out the managed restart code into a seperate file and use <code>execfile()</code> to call it from within a thread</p>\n\n<h2>Does anyone else have any ideas / suggestions / experience?</h2>\n"},{"tags":["multithreading","qt","crash","mutex","qthread"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12976907,"title":"QThread crashes the program?","body":"<p>I implement QThread like this, but get program crashed when it runs.<br>\nI've searched and seen posts saying <strong>it is not the correct way to use QThread.</strong><br>\nBut I cannot find any reason for the crashes of my program, what I do is only \ntriggering 'on_Create_triggered()' and I guarantee the mutex is locked and unlocked properly.<br>\nI have tested the program for two days(testing only by 'std::cerr &lt;&lt; ...;' prints results), but still cannot find reason. <code>What I guess is that the thread may wait for the lock too long and cause program to crash.</code>  <em>(not sounds reasonable...)</em> :)  </p>\n\n<p><strong>My codes:</strong></p>\n\n<p>Background.h</p>\n\n<pre><code>class Background : public QThread\n{\n    Q_OBJECT\n\npublic:\n    Background(int&amp; val,DEVMAP&amp; map, QQueue&lt;LogInfoItem*&gt;&amp; queue, QList&lt;DEV*&gt;&amp; devlist, QList&lt;IconLabel*&gt;&amp; icllist,QMutex&amp; m)\n        :val_i(val),DevMap(map), LogInfoQueue(queue), DevInfoList(devlist), IconLabelList(icllist),mutex(m)\n    {}\n\n     ~Background();\n\nprotected:\n    void run(void);\n\n\nprivate:\n    DEVMAP&amp; DevMap;\n    QQueue&lt;LogInfoItem*&gt;&amp;LogInfoQueue;\n    QList&lt;DEV*&gt;&amp; DevInfoList;\n    QList&lt;IconLabel*&gt;&amp; IconLabelList;\n    int&amp; val_i;\n    QMutex&amp; mutex;\n\n\n\n    void rcv();\n\n\n\n};\n</code></pre>\n\n<p>Background.cpp</p>\n\n<pre><code>#include \"background.h\"\n\n\nBackground::~Background()\n{\n    LogFile-&gt;close();\n}\n\nvoid Background::run(void)\n{\n    initFile();\n\n    while(1)\n    {\n        msleep(5);\n        rcv();\n    }\n\n}\n\n\nvoid Background::rcv()\n{\n    mutex.lock();\n    ...\n    ...//access DevMap, LogInfoQueue, DevInfoList, IconLabelList and val_i;\n    ...\n    mutex.unlock();\n}\n</code></pre>\n\n<p>MainWindow:(MainWindow has Background* back as property)</p>\n\n<pre><code>void MainWindow::initThread()\n{\n    back = new Background(val_i, dev_map, logDisplayQueue, devInfoList, iconLabelList, mutex);\n    back-&gt;start();\n}\n\nvoid MainWindow::on_Create_triggered()\n{\n    mutex.lock();\n    ...\n    ...//access DevMap, LogInfoQueue, DevInfoList, IconLabelList and val_i;\n    ...\n    mutex.unlock();\n}\n</code></pre>\n"},{"tags":[".net","multithreading","variable-scope","transactionscope","named-scope"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":91,"score":2,"question_id":4488140,"title":"Is there a build in functionality in .NET to create thread bound variables?","body":"<p>Is there a way to do this (psedo code):</p>\n\n<pre><code>GetCurrentThread().Items.Add(new RefObject);\n</code></pre>\n\n<p>then later on retrive it </p>\n\n<pre><code>RefObject[] refObjs = GetCurrentThread().Items;\n</code></pre>\n\n<p>and enumerate the objects. Obviously both calls will occur on the same thread during the life span of it.</p>\n\n<p>The basic idea is that I can easisly identify the items for the current thread were and that they are in fact created in this thread. It's same as using the <code>Page.Request</code> object for an ASP.NET request - you know it's very unique in the worker process, so it doesn't get mixed up with other requests being served at the same time. I want to treat a thread like <code>Page.Request</code> - it comes and then goes, but while it's alive, I can query it at will without caring about other threats that exist in the process. </p>\n\n<p>Once I did something similar, but it was more of a simulation by marshaling objects by reference. And I can think of a couple of more ways to do it, but I really don't want to manually store the mapping between the thread and the object myself. Isn't there something similar to TransactionScope for threads in <a href=\"http://en.wikipedia.org/wiki/.NET_Framework\" rel=\"nofollow\">.NET</a>? I am not too intersted in dealing with the hardship of syncronization and avoiding the race conditions.</p>\n\n<p>PS: If that's not available, can I do it at least for an <a href=\"http://en.wikipedia.org/wiki/Application_Domain\" rel=\"nofollow\">application domain</a> without static variables?</p>\n"},{"tags":["java","multithreading","java-me","nullpointerexception","lcdui"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":2226,"score":5,"question_id":4769959,"title":"J2ME (Java) - Null Pointer Exception caught in Display Class","body":"<p>I'm currently working with MIDlets (I am using a Visual MIDlet) in Netbeans, and a NullPointerException is being thrown but I do not know why. </p>\n\n<p><strong>Note:</strong> The exception is not thrown when the program runs on the emulator, only when the OK Command button is pressed.</p>\n\n<p>Here is the error I get</p>\n\n<pre><code>TRACE: &lt;at java.lang.NullPointerException:   0&gt;, Exception caught in Display class\njava.lang.NullPointerException:   0\n        at javax.microedition.lcdui.Display$ChameleonTunnel.callScreenListener(), bci=46\n        at com.sun.midp.chameleon.layers.SoftButtonLayer.processCommand(), bci=74\n        at com.sun.midp.chameleon.layers.SoftButtonLayer.soft1(), bci=37\n        at com.sun.midp.chameleon.layers.SoftButtonLayer.keyInput(), bci=36\n        at com.sun.midp.chameleon.CWindow.keyInput(), bci=38\n        at javax.microedition.lcdui.Display$DisplayEventConsumerImpl.handleKeyEvent(), bci=17\n        at com.sun.midp.lcdui.DisplayEventListener.process(), bci=277\n        at com.sun.midp.events.EventQueue.run(), bci=179\n        at java.lang.Thread.run(Thread.java:619)\n</code></pre>\n\n<p>I have stripped out all of the code unrelated to the exception, so that you can read it easier.\nBelow is a simplified version if the code I have, which throws the above exception.</p>\n\n<pre><code>package stMidlet;\n\nimport javax.microedition.midlet.*;\nimport javax.microedition.lcdui.*;\n\npublic class StoryMidlet extends MIDlet implements CommandListener {\n\n    private boolean midletPaused = false;\n    private Command commandOk1;\n    private Form form1;\n    private TextField textField1;\n\n    public StoryMidlet() {\n        commandOk1 = new Command(\"Ok\", Command.OK, 1);\n        textField1 = new TextField(\"Enter value: \", null, 120, TextField.ANY);\n        form1 = new Form(null, new Item[]{textField1});\n        form1.addCommand(commandOk1);\nDisplay.getDisplay(this).setCurrent(form1);\n    }\n\n/* There were some methods here pre-inserted by netbeans. */\n\n/* I have not changed these, but I can post them if you need me too */\n\n/* initialize() */\n\n/* startMIDlet() */\n\n/* resumeMidlet() */\n\n/* switchDisplayable */\n\n\n/* getDisplay() */\n\n/* exitMidlet() */\n\n/* startApp() */\n\n/* pauseApp() */\n\n/* destroyApp() */\n\n\n    public void commandAction(Command c, Displayable d) {\n        if (c == commandOk1)\n        {\n            System.out.println(\"Test\");\n        }\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>I have been trying to solve this for at least an hour, with no prevail.\nThe only thing I can think of worth mentioning is:</p>\n\n<ul>\n<li>Netbeans showed a warning with the line <strong>Display.getDisplay(this).....</strong> saying there was a leak in the constructor. I moved it into the initialize() method which sedated the warning, but the exception still occurs.</li>\n</ul>\n\n<p>Any help will be greatly appreciated.</p>\n\n<p>Thanks, Tom.</p>\n"},{"tags":["c#","multithreading","time-measurement"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":273,"score":4,"question_id":8475471,"title":"Measuring the execution time in multithreading environment","body":"<p>I have an application that uses <code>Task</code> (TPL) objects for asynchronous execution.</p>\n\n<p>The main thread waits for a trigger (some TCP packet) and then executes several tasks. What I want to do is to measure the time spent in the tasks. </p>\n\n<p>Take a look at the code. I have some lengthy operation (<code>Generator</code>), enclosed in <code>Stopwatch's</code> start/stop. </p>\n\n<pre><code>Task.Factory.StartNew((t) =&gt; {\n\n    Stopwatch sw = new Stopwatch();\n    sw.Start();\n\n    Generator g = new Generator();\n    g.GenerateIntervals(); // lengthy operation\n\n    sw.Stop();\n    GlobalStopwatch.Add(sw.Elapsed);\n});\n</code></pre>\n\n<p>Here is the problem. Stopwatch uses <code>DateTime.UtcNow.Ticks</code> at the moment of <code>Start()</code> and then again at the moment of <code>Stop()</code>. Then it subtracts those two to get the elapsed time.</p>\n\n<p>The thing is, some other thread (in a single-threaded system) can get some processor time while the <code>Generator</code> (from the code) is doing its <code>GenerateIntervals()</code> lengthy operation. That means that the elapsed time recorded by the stopwatch would contain not only the <code>Generaor.GenerateIntervals()</code> time, but also the time that the other threads did their job inbetween.</p>\n\n<p>Is there any simple way to know exactly how much of processor time did some method take, not including execution time from other threads as a result of timesharing mechanisms?</p>\n"},{"tags":["c++","multithreading","c++11"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12983546,"title":"std::thread, class constructor and destructor","body":"<p>When testing threads in C++11 I have created the following example:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n\nclass Foo {\npublic:\n    Foo(void) {\n        std::cout &lt;&lt; \"Constructor called: \" &lt;&lt; this &lt;&lt; std::endl;\n    }\n    ~Foo(void) {\n        std::cout &lt;&lt; \"Destructor called: \" &lt;&lt; this &lt;&lt; std::endl;\n    }\n    void operator()() const {\n        std::cout &lt;&lt; \"Operatior called: \" &lt;&lt; this &lt;&lt; std::endl;\n    }\n};\n\nvoid test_normal(void) {\n    std::cout &lt;&lt; \"====&gt; Standard example:\" &lt;&lt; std::endl;\n    Foo f;\n}\n\nvoid test_thread(void) {\n    std::cout &lt;&lt; \"====&gt; Thread example:\" &lt;&lt; std::endl;\n    Foo f;\n    std::thread t(f);\n    t.detach();\n}\n\n\nint main(int argc, char **argv) \n{\n    test_normal();\n    test_thread();\n\n    for(;;);\n}\n</code></pre>\n\n<p>Which prints the following:</p>\n\n<p><img src=\"http://i.stack.imgur.com/M3Am6.png\" alt=\"enter image description here\"></p>\n\n<p>Why is the destructor called 6 times for the thread? And why does the thread report different memory locations?</p>\n\n<p><strong>EDIT</strong>\nWhen adding move and copy constructor output:</p>\n\n<p><img src=\"http://i.stack.imgur.com/FkmSv.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":12949333,"title":"Message box from another thread","body":"<p>edit:\nerror I got is unrelated to my question. :/ \n-1</p>\n\n<p>I starting a service on a new thread, then I want to catch an error and display a message box.  because its not in the UI thread I get an error. How can I get arround this problem?</p>\n\n<p>(WPF window)</p>\n\n<p>Code:</p>\n\n<pre><code>xmlServiceHost = XcelsiusServiceHost.CreateXmlServiceHost(Properties.Settings.Default.XmlDataService);\n\nserviceThread = new Thread(_ =&gt; \n{\n  try { xmlServiceHost.Open(); }\n  catch (AddressAccessDeniedException)\n  {\n    CreateRegisterDashboardServiceFile();\n\n    //Error not in UI thread.\n    //this.ShowUserInfoMessage(\"The dashboard service needs to be registered. Please contact support.\");\n  }\n});\n\nserviceThread.Start();\n</code></pre>\n"},{"tags":["java","android","multithreading","timer","location"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12983431,"title":"Not receiving location data from thread","body":"<p>I'm trying to send text messages containing the users location every so often using the timer. Initially, I ran into a nullpointerexception which was due to a simple mistake I made. Once this was fixed everything seemed to be running fine. However, it never gets my location, so, the text that keeps sending is saying \"Could Not receive location\". </p>\n\n<p>What I am asking is why is it not getting my location? And what can I do to fix the problem?</p>\n\n<p>There are no logcat errors and I am using two emulators to test this app (send text from one to the other). If you could provide any help or resolution it would be greatly appreciated! And if I'm overlooking something that may seem to be very simple please alert me that I am doing so. Thanks!</p>\n\n<p>Here's the code:</p>\n\n<pre><code>    public class MessageService extends Service{\nint counter = 0;\nprivate Timer timer = new Timer();\npublic String textTime, phoneNumber;\npublic int updateInterval;\nint lat, lng;\nString coordinates, latitude, longitude;\nLocationManager locationManager;\n\n@Override\npublic IBinder onBind(Intent arg0) {\n    return null;\n}\n\n@Override\npublic int onStartCommand(Intent intent, int flags, int startId){\n    //receives the intent extras from the calling intent\n    textTime = intent.getStringExtra(\"textTime\");\n    phoneNumber = intent.getStringExtra(\"phone\");\n\n    phoneNumber = \"5556\";\n\n    //the following if statement has to do with transferring the string textTime into a number that can be used\n    if (textTime.equals(\"15 Minutes\")) {\n        updateInterval = (15 * (60000));\n    }else if (textTime.equals(\"30 Minutes\")) {\n        updateInterval = (30 * (60000));\n    }else if (textTime.equals(\"1 Hour\")){\n        updateInterval = (60 * (60000));\n    }else {\n        updateInterval = (15 * (60000));\n    }\n\n    locationManager = (LocationManager) this.getSystemService(Context.LOCATION_SERVICE);\n\n    new Thread(){\n        public void run(){\n            Looper.prepare();\n            // Define a listener that responds to location updates\n            LocationListener locationListener = new LocationListener() {\n                public void onLocationChanged(Location location) {\n                  // Called when a new location is found by the network location provider.\n                  //makeUseOfNewLocation(location);\n                    lat = (int) (location.getLatitude() * 1E6);\n                    lng = (int) (location.getLongitude() * 1E6);\n\n                    latitude = Integer.toString(lat);\n                    longitude = Integer.toString(lng);\n\n                    coordinates = \"Coordinates: \" + latitude + \", \" + longitude + \". Latitude: \" + latitude + \" Longitude: \" + longitude + \". Respond 'END' to stop texts.\"; \n                }\n\n                public void onStatusChanged(String provider, int status, Bundle extras) {}\n\n                public void onProviderEnabled(String provider) {}\n\n                public void onProviderDisabled(String provider) {}\n              };\n\n              Looper.loop();\n\n              if (locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER)){\n                    locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, locationListener);\n              }else{\n                    locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, 0, 0, locationListener);\n              }\n\n        }\n    }.start();\n\n\n    //the following method should use a timer to send a sms message in a timed interval. It also should implement using a different thread\n    doSomethingRepeatedly();\n\n    return START_STICKY;\n\n}\n\npublic void doSomethingRepeatedly(){\n    timer.scheduleAtFixedRate(new TimerTask() {\n        public void run() {\n            //the following code should be what is done repeatedly\n            //Log.d(\"MessageService\", String.valueOf(++counter));\n\n            sendSmsMessage();\n        }\n    }, 0, updateInterval);\n}\n\n//the following code handles sending the text message\npublic void sendSmsMessage(){\n    SmsManager sms = SmsManager.getDefault();\n    if (coordinates == null || coordinates.equals(\"\")){\n        coordinates = \"Could Not Receive Location\";\n    }\n\n    sms.sendTextMessage(phoneNumber, null, coordinates , null, null);\n\n}\n\npublic void onDestroy() {\n    super.onDestroy();\n\n    if (timer != null) {\n        timer.cancel();\n    }\n}\n\n\n\n\n}//end of service\n</code></pre>\n"},{"tags":["c#","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12982841,"title":"TPL Parallel For Loop error","body":"<p>I'm getting a \"one or more errors occurred\" exception in my parallel.for loop:</p>\n\n<pre><code>at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\nat System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken            cancellationToken)\nat System.Threading.Tasks.Task.Wait()\nat System.Threading.Tasks.Parallel.ForWorker[TLocal](Int32 fromInclusive, Int32 toExclusive, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Func`4 bodyWithLocal, Func`1 localInit, Action`1 localFinally)\nat System.Threading.Tasks.Parallel.For(Int32 fromInclusive, Int32 toExclusive, ParallelOptions parallelOptions, Action`1 body)\nat StaticClassLibrary.BLL.StaticClass.StatiMethod(String strExt, Object wTable, Object job, String BSPConnectionString) in c:\\Users\\FredWAD\\Documents\\Visual Studio 2010\\Projects\\PayrollCenterLibrary\\BLL\\ContributionFileManager.cs:line 218\n   at myapp.staticlibrary.staticmethod(String str1, String str2) \n</code></pre>\n\n<p>The app takes a collection of structs, each object containing metadata, and inserts them into a database.</p>\n\n<p>The offending code is as follows:</p>\n\n<pre><code>Parallel.For(0, recordCnt, pOptions, d =&gt;\n               {\n                   //flds = wTable.records[d].fields;\n                   ssn = wTable.records[d].fields[fieldIndex].Value;\n                   //rowId = wTable.records[d].fields[fieldIndex].rowId;\n                   currentPerson = PersontManager.GetPerson(string1, string2);\n                   hasContributions = WorkTableManager.RowHasContributionsNEW(List&lt;string&gt; lst, wTable.records[d]);\n                   LoadRecordParallel(hasLoan, hasScratchpad, fieldIndex, wTable.records[d], object, string, string);\n               }\n           );\n</code></pre>\n\n<p>wTable = the collection object. </p>\n\n<p>records = a List of structs containing metadata</p>\n\n<p>fields = a struct within each record. each record contains a list of these.</p>\n\n<p>This is essentially a table, with a struct for a row (which also contains some metadata about each row), and structs for cells. This error appears to be occurring at random. What am I doing wrong here?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12982533,"title":"Check that Files Execute Concurrently","body":"<p>I need to perform 2 tasks independently. </p>\n\n<p><strong>First Task</strong></p>\n\n<p>Once per minute it should check whether there is any file in a specific folder. If there is, it should add the names of the files to a queue.</p>\n\n<p>This can be done as follows:</p>\n\n<pre><code>import java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.ScheduledThreadPoolExecutor;\nimport java.util.concurrent.TimeUnit;\n\n\npublic class schedulerExample extends Thread{\n\n    public void checkFile()\n    {\n        System.out.println(\"checking whether file exist in folder\");\n\n    }\n\n    public void getFiles()\n    {\n        System.out.println(\"getting the file names\");\n    }\n\n    public void enqueueFiles()\n    {\n        System.out.println(\"add files to queue\");\n    }\n    public static void main(String[] args) {\n\n    final schedulerExample obj = new schedulerExample();\n    ScheduledExecutorService executor = new ScheduledThreadPoolExecutor(1);\n    executor.scheduleAtFixedRate(new Runnable() {\n\n        @Override\n        public void run() {\n\n            obj.checkFile();\n            obj.getFiles();\n            obj.enqueueFiles();\n\n        }\n    }, 0, 1, TimeUnit.MINUTES);\n\n\n    }\n\n}\n</code></pre>\n\n<p><strong>Second Task</strong></p>\n\n<p>If the queue is empty , sleep for one minute or else process the file from the queue one-by-one.</p>\n\n<pre><code>public class processModel extends Thread{\n\n    public static void getQueueSize(int size)\n    {\n        System.out.println(\"getting queue size\");\n\n    }\n    public void dequeue()\n    {\n\n        // dequeue the queue\n        System.out.println(\"dequeue\");\n\n    }\n\n    public void processFile()\n    {\n        // process the file\n        System.out.println(\"process file\");\n    }\n\n    public static void main(String[] args) {\n        final boolean flag = true;\n        final int size = 9;\n        final processModel obj = new processModel();\n        Thread t1 = new Thread(){\n            public void run()\n            {\n                while(flag)\n                {\n                obj.dequeue();\n                obj.processFile();\n                getQueueSize(size);\n                    if(size == 0)\n                    {\n                        try\n                        {\n                        Thread.sleep(60000);\n                        }\n                        catch(InterruptedException e)\n                        {\n\n                        }\n                    }\n                }\n\n            }\n\n        };\n\n        t1.start();\n\n    }\n\n}\n</code></pre>\n\n<p>Now I need to do both in a single class concurrently. Is that possible?</p>\n\n<p>One thread should be fetching the files once per minute. Another thread should execute files one-by-one.. if no files are there it waits for a minute and checks again. In the second method I have used an infinite loop -- instead of that, is there a way that I can perform things one-by-one?</p>\n"},{"tags":["java","android","multithreading","drawable","surfaceview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12965286,"title":"Drawable won't draw on SurfaceView, Thread implementation, without overriding onDraw","body":"<p>I'm honestly stumped as to why this isn't working.  Trying to draw a simple PNG to the screen using a SurfaceView in the layout and a thread to draw rather than overriding the onDraw function.  It's essentially the exact same implementation as the LunarLander sample project (and I've practically ripped the entire codeset in frustration).</p>\n\n<p>I've tested it via logs and I know that the sprite is being \"drawn\" to the canvas but nothing is showing up in the window.</p>\n\n<p>Here's the code, hope it's not too lengthy (unimportant bits stripped out):</p>\n\n<p>activity_pannenkoekenhuis.xml (layout/)</p>\n\n<pre><code>&lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\" &gt;\n\n&lt;com.example.pannenkoekenhuis.MainView\n    android:id=\"@+id/pannenkoekenhuis_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" /&gt;\n\n&lt;RelativeLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".Pannenkoekenhuis\" &gt;\n&lt;/RelativeLayout&gt;\n\n&lt;/FrameLayout&gt;\n</code></pre>\n\n<p>MainView (SurfaceView):</p>\n\n<pre><code>public class MainView extends SurfaceView implements SurfaceHolder.Callback {\n\nclass MainThread extends Thread {\n    SurfaceHolder surfaceHolder;\n    Context context;\n    Handler handler;\n\n    HandleResources hResources;\n    HandleGame hGame;\n\n    public MainThread(SurfaceHolder surfaceHolder, Context context,\n            Handler handler) {\n        this.surfaceHolder = surfaceHolder;\n        this.context = context;\n        this.handler = handler;\n        hResources = new HandleResources(context);\n        hGame = new HandleGame();\n\n        init();\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            Canvas canvas = null;\n            try {\n                canvas = surfaceHolder.lockCanvas(null);\n                synchronized (surfaceHolder) {\n                                            Drawable d = context.getResources().getDrawable(R.drawable.s_char);\n                    d.draw(canvas);\n                }\n            } finally {\n                if (canvas != null) {\n                    surfaceHolder.unlockCanvasAndPost(canvas);\n                }\n            }\n        }\n    }\n}\n\nMainThread thread;\n\npublic MainView(Context context, AttributeSet attrs) {\n    super(context, attrs);\n\n    SurfaceHolder surfaceHolder = getHolder();\n    getHolder().addCallback(this);\n\n    thread = new MainThread(surfaceHolder, context, new Handler());\n\n    setFocusable(true);\n}\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["java","android","multithreading","timer"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12982166,"title":"Null Pointer Exception causing force close while trying to run multiple threads","body":"<p>I'm trying to run a service in the background that sends texts messages of the location of the phone. In the service I use a Timer. The code that sends the messages runs correctly but when I try to put the code in to find the users location I always run into errors.</p>\n\n<p>I tried to call a new thread and used a looper but now I'm getting a nullpointerexception which points to these two lines of code:</p>\n\n<pre><code>sendSmsMessage();\n</code></pre>\n\n<p>and within this method:</p>\n\n<pre><code>if (coordinates.equals(null) || coordinates.equals(\"\") || coordinates == null || coordinates == \"\"){\n        coordinates = \"Could Not Receive Location\";\n    }\n</code></pre>\n\n<p>So, the question I'm asking is why is this error occurring? If you could help me out it would be greatly appreciated. And if I'm just overlooking something very simple please point it out. Thanks!</p>\n\n<p>Here's the code:</p>\n\n<pre><code>    public class MessageService extends Service{\nint counter = 0;\nprivate Timer timer = new Timer();\npublic String textTime, phoneNumber;\npublic int updateInterval;\nint lat, lng;\nString coordinates, latitude, longitude;\nLocationManager locationManager;\n\n@Override\npublic IBinder onBind(Intent arg0) {\n    return null;\n}\n\n@Override\npublic int onStartCommand(Intent intent, int flags, int startId){\n    //receives the intent extras from the calling intent\n    textTime = intent.getStringExtra(\"textTime\");\n    phoneNumber = intent.getStringExtra(\"phone\");\n\n    phoneNumber = \"5556\";\n\n    //the following if statement has to do with transferring the string textTime into a number that can be used\n    if (textTime.equals(\"15 Minutes\")) {\n        updateInterval = (15 * (60000));\n    }else if (textTime.equals(\"30 Minutes\")) {\n        updateInterval = (30 * (60000));\n    }else if (textTime.equals(\"1 Hour\")){\n        updateInterval = (60 * (60000));\n    }else {\n        updateInterval = (15 * (60000));\n    }\n\n    locationManager = (LocationManager) this.getSystemService(Context.LOCATION_SERVICE);\n\n    new Thread(){\n        public void run(){\n            Looper.prepare();\n            // Define a listener that responds to location updates\n            LocationListener locationListener = new LocationListener() {\n                public void onLocationChanged(Location location) {\n                  // Called when a new location is found by the network location provider.\n                  //makeUseOfNewLocation(location);\n                    lat = (int) (location.getLatitude() * 1E6);\n                    lng = (int) (location.getLongitude() * 1E6);\n\n                    latitude = Integer.toString(lat);\n                    longitude = Integer.toString(lng);\n\n                    coordinates = \"Coordinates: \" + latitude + \", \" + longitude + \". Latitude: \" + latitude + \" Longitude: \" + longitude + \". Respond 'END' to stop texts.\"; \n                }\n\n                public void onStatusChanged(String provider, int status, Bundle extras) {}\n\n                public void onProviderEnabled(String provider) {}\n\n                public void onProviderDisabled(String provider) {}\n              };\n\n              Looper.loop();\n\n              if (locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER)){\n                    locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, locationListener);\n              }else{\n                    locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, 0, 0, locationListener);\n              }\n\n        }\n    }.start();\n\n\n    //the following method should use a timer to send a sms message in a timed interval. It also should implement using a different thread\n    doSomethingRepeatedly();\n\n    return START_STICKY;\n\n}\n\npublic void doSomethingRepeatedly(){\n    timer.scheduleAtFixedRate(new TimerTask() {\n        public void run() {\n            //the following code should be what is done repeatedly\n            //Log.d(\"MessageService\", String.valueOf(++counter));\n\n            sendSmsMessage();\n        }\n    }, 0, updateInterval);\n}\n\n//the following code handles sending the text message\npublic void sendSmsMessage(){\n    SmsManager sms = SmsManager.getDefault();\n    if (coordinates.equals(null) || coordinates.equals(\"\") || coordinates == null || coordinates == \"\"){\n        coordinates = \"Could Not Receive Location\";\n    }\n\n    sms.sendTextMessage(phoneNumber, null, \"test\" , null, null);\n\n}\n\npublic void onDestroy() {\n    super.onDestroy();\n\n    if (timer != null) {\n        timer.cancel();\n    }\n}\n\n\n\n\n}//end of service\n</code></pre>\n\n<p>And here is the logcat output:</p>\n\n<pre><code>    10-19 20:23:28.096: E/AndroidRuntime(944): FATAL EXCEPTION: Timer-0\n10-19 20:23:28.096: E/AndroidRuntime(944): java.lang.NullPointerException\n10-19 20:23:28.096: E/AndroidRuntime(944):  at com.app.MessageService.sendSmsMessage(MessageService.java:113)\n10-19 20:23:28.096: E/AndroidRuntime(944):  at com.app.MessageService$2.run(MessageService.java:105)\n10-19 20:23:28.096: E/AndroidRuntime(944):  at      java.util.Timer$TimerImpl.run(Timer.java:284)\n</code></pre>\n"},{"tags":["c#","wcf","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2124,"score":4,"question_id":2603135,"title":"WCF Service with callbacks coming from background thread?","body":"<p>Here is my situation. I have written a WCF service which calls into one of our vendor's code bases to perform operations, such as Login, Logout, etc. A requirement of this operation is that we have a background thread to receive events as a result of that action. For example, the Login action is sent on the main thread. Then, several events are received back from the vendor service as a result of the login. There can be 1, 2, or several events received. The background thread, which runs on a timer, receives these events and fires an event in the wcf service to notify that a new event has arrived.</p>\n\n<p>I have implemented the WCF service in Duplex mode, and planned to use callbacks to notify the UI that events have arrived. Here is my question: How do I send new events from the background thread to the thread which is executing the service? </p>\n\n<p>Right now, when I call <code>OperationContext.Current.GetCallbackChannel&lt;IMyCallback&gt;()</code>, the OperationContext is null. Is there a standard pattern to get around this?</p>\n\n<p>I am using PerSession as my SessionMode on the ServiceContract.</p>\n\n<p>UPDATE:\nI thought I'd make my exact scenario clearer by demonstrating how I'm receiving events from the vendor code. My library receives each event, determines what the event is, and fires off an event for that particular occurrence. </p>\n\n<p>I have another project which is a class library specifically for connecting to the vendor service. I'll post the entire implementation of the service to give a clearer picture:</p>\n\n<pre><code>    [ServiceBehavior(\n        InstanceContextMode = InstanceContextMode.PerSession\n        )]\n    public class VendorServer:IVendorServer\n    {\nprivate IVendorService _vendorService;  // This is the reference to my class library\n\n        public VendorServer()\n        {\n_vendorServer = new VendorServer();\n_vendorServer.AgentManager.AgentLoggedIn += AgentManager_AgentLoggedIn; // This is the eventhandler for the event which arrives from a background thread\n\n}\n\n        public void Login(string userName, string password, string stationId)\n        {\n            _vendorService.Login(userName, password, stationId); // This is a direct call from the main thread to the vendor service to log in\n        }\n\n    private void AgentManager_AgentLoggedIn(object sender, EventArgs e)\n    {\n\n        var agentEvent = new AgentEvent\n                             {\n                                 AgentEventType = AgentEventType.Login,\n                                 EventArgs = e\n                             };\n    }\n}\n</code></pre>\n\n<p>The AgentEvent object contains the callback as one of its properties, and I was thinking I'd perform the callback like this:</p>\n\n<pre><code>agentEvent.Callback = OperationContext.Current.GetCallbackChannel&lt;ICallback&gt;();\n</code></pre>\n\n<p>The AgentEvent is an object defined in the service:</p>\n\n<pre><code>[DataContract]\npublic class AgentEvent\n{\n    [DataMember]\n    public EventArgs EventArgs { get; set; }\n    [DataMember]\n    public AgentEventType AgentEventType { get; set; }\n    [DataMember]\n    public DateTime TimeStamp{ get; set; }\n    [DataMember]\n    public IVendorCallback Callback { get; set; }\n}\n</code></pre>\n\n<p>IVendorCallback looks like this:</p>\n\n<pre><code>    public interface IVendorCallback\n    {\n        [OperationContract(IsOneWay = true)]\n        void SendEvent(AgentEvent agentEvent);\n    }\n</code></pre>\n\n<p>The callback is implemented on the client and uses the EventArgs porperty of the AgentEvent to populate data on the UI.\nHow would I pass the OperationContext.Current instance from the main thread into the background thread?</p>\n"}]}
{"total":30059,"page":11,"pagesize":100,"questions":[{"tags":["multithreading","solaris"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12936107,"title":"context system call in truss","body":"<p>While taking the truss of a process in Solaris 10,\nI found the below statement</p>\n\n<pre><code>&lt;pid&gt;/2:    70.7602 context(1, 0xFC47ABF8)\n</code></pre>\n\n<p>Please explain what this system call <code>context</code> means\nAlso after this call I saw thread 2 behaving like another thread 4.</p>\n"},{"tags":["c#","multithreading","sockets","amazon-ec2"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":142,"score":2,"question_id":12183845,"title":"C# TCP Asychronous connection actively refused with low CPU utilization","body":"<p>I have a C# TCP Asynchronous socket server.</p>\n\n<p>Testing locally, I can accept 5K connections over 35 seconds. I am running a quad core hyper threaded PC (8 threads) and the utilization is ~20-40% on each core. As the connections are accepted, the server asks the client for a bunch of data and then performas a bunch of database entries.</p>\n\n<p>I moved the server application and SQL database to a small database and  medium server instance on Amazon AWS.</p>\n\n<p>The Amazon Medium server(EC2) is 1 virtual core and 2 ECU's. From what I can tell it only has 1 thread.(from performance monitor)</p>\n\n<p>If I try to connect 1000 clients over 35 seconds to the medium server. After ~650 connections i start to receive <em>Connect failed(b) No connection could be made because the target machine actively refused it</em>. </p>\n\n<p>Looking at performance monitor, I noticed that the CPU utilization is only ~10-15%. </p>\n\n<p>I am guessing that the core is not getting loaded because it is trying to handle a huge queue of connections, of small operations and does not provide enough load to increase CPU usage, since the server only has 1 virtual core.</p>\n\n<p>Does anyone have any experience with this, does my theory make sense? I am stuck at a hardware limitation? (need to bump up the server size?)</p>\n\n<p>If not, any ideas how to get more utilization and support more/quicker connections?</p>\n\n<p>Does anyone have experience with this?</p>\n\n<p>EDIT: </p>\n\n<p>I upgraded my instance on Amazon EC2 to the High CPU Extra Large instance.</p>\n\n<p>The Instance now has 8 cores and 20 ECU's. </p>\n\n<p>I am experiencing the same problem, I get No connection could be made because the target machine actively refused it after ~600 connections.</p>\n"},{"tags":["c#","multithreading"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":116,"score":1,"question_id":12981190,"title":"How to make a static variable thread-safe","body":"<p>I have this static class which contains a static variable (a simple int). I've implemented a <code>lock()</code> in the <code>Run()</code> method of the threads, so no other threads can access to this class concurrently, but the variable still goes crazy, displaying duplicates, insanely high values, etc.</p>\n\n<p>This is the class:</p>\n\n<pre><code>public static class ExplorationManager\n{\n    public static int Counter = 0;\n\n    public static void ExplorerMaker(List&lt;int[]&gt; validPaths, List&lt;string&gt; myParents, string[,] myExplorationMap, List&lt;int[]&gt; myPositions)\n    {\n        foreach (var thread in validPaths.Select\n        (path =&gt; new Explorer(myParents, path, myExplorationMap, myPositions)).\n        Select(explorer =&gt; new Thread(explorer.Explore)))\n            {\n                thread.Name = \"Thread of \" + Counter + \" generation\";\n                Counter++; \n                thread.Start();\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Is there a way to make this variable \"more\" thread-safe?</p>\n"},{"tags":["ruby","multithreading","jruby"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12981052,"title":"jruby multithreading const_missing","body":"<p>I'm trying to parallelize processing in a JRuby loop (using peach), but crash with the const_missing errors after about 30 seconds of running smoothly:</p>\n\n<pre><code>lib/ruby/gems/1.8/gems/activesupport-2.3.9/lib/active_support/dependencies.rb:452:in `load_missing_constant'\nlib/ruby/gems/1.8/gems/activesupport-2.3.9/lib/active_support/dependencies.rb:106:in `const_missing_with_dependencies'\nlib/ruby/gems/1.8/gems/activesupport-2.3.9/lib/active_support/dependencies.rb:118:in `const_missing'\nlib/ruby/gems/1.8/gems/activesupport-2.3.9/lib/active_support/dependencies.rb:463:in `load_missing_constant'\nlib/ruby/gems/1.8/gems/activesupport-2.3.9/lib/active_support/dependencies.rb:122:in `const_missing'\n</code></pre>\n\n<p>I'm using jrub 1.5.2:</p>\n\n<pre><code>C:\\projects\\sami\\build&gt;jruby -v\njruby 1.5.2 (ruby 1.8.7 patchlevel 249) (2010-08-20 1c5e29d) (Java HotSpot(TM) 64-Bit Server VM 1.6.0_11) [amd64-java]\n</code></pre>\n\n<p>And I've set up my environment to enable multithreading:</p>\n\n<pre><code>config.cache_classes = true\nconfig.threadsafe!\nconfig.dependency_loading = true if $rails_rake_task\n</code></pre>\n\n<p>What else can I do!?</p>\n\n<p>TIA</p>\n"},{"tags":["java","multithreading","apache","jboss","ajp"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":6114,"score":4,"question_id":1846034,"title":"Apache with JBOSS using AJP (mod_jk) giving spikes in thread count","body":"<p>We used Apache with JBOSS for hosting our Application, but we found some issues related to thread handling of mod_jk. </p>\n\n<p>Our website comes under low traffic websites and has maximum 200-300 concurrent users during our website's peak activity time. As the traffic grows (not in terms of concurrent users, but in terms of cumulative requests which came to our server), the server stopped serving requests for long, although it didn't crash but could not serve the request till 20 mins. The JBOSS server console showed that 350 thread were busy on both servers although there was enough free memory say, more than 1-1.5 GB (2 servers for JBOSS were used which were 64 bits, 4 GB RAM allocated for JBOSS)</p>\n\n<p>In order to check the problem we were using JBOSS and Apache Web Consoles, and we were seeing that the thread were showing in S state for as long as minutes although our pages take around 4-5 seconds to be served. </p>\n\n<p>We took the thread dump and found that the threads were mostly in WAITING state which means that they were waiting indefinitely. These threads were not of our Application Classes but of AJP 8009 port. </p>\n\n<p>Could somebody help me in this, as somebody else might also got this issue and solved it somehow. In case any more information is required then let me know.</p>\n\n<p>Also is mod_proxy better than using mod_jk, or there are some other problems with mod_proxy which can be fatal for me if I switch to mod__proxy?</p>\n\n<p>The versions I used are as follows:</p>\n\n<pre><code>Apache 2.0.52\nJBOSS: 4.2.2\nMOD_JK: 1.2.20\nJDK: 1.6\nOperating System: RHEL 4\n</code></pre>\n\n<p>Thanks for the help.</p>\n\n<p>Guys!!!! We finally found the workaround with the configuration mentioned above. It is use of APR and is mentioned here: <a href=\"http://community.jboss.org/thread/153737\" rel=\"nofollow\">http://community.jboss.org/thread/153737</a>. Its issue as correctly mentioned by many people in answers below i.e. connector issue. Earlier we made temporary workaround by configuring hibernate and increasing response time. The full fix is APR.</p>\n"},{"tags":["c#","multithreading","delegates"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":46,"score":3,"question_id":12977838,"title":"QueueUserWorkItem with delegate does not work, but WaitCallBack does work","body":"<p>In the question below, I found this neat trick for calling QueueUserWorkItem in a type safe way, where you pass a delegate instead of WaitCallBack and an object.  However, it doesn't work the way one would expect.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/532791/whats-the-difference-between-queueuserworkitem-and-begininvoke-for-perform\">What&#39;s the difference between QueueUserWorkItem() and BeginInvoke(), for performing an asynchronous activity with no return types needed</a></p>\n\n<p>Here's some sample code and output that demonstrates the issue.</p>\n\n<pre><code>for (int i = 0; i &lt; 10; ++i)\n{\n    // doesn't work - somehow DoWork is invoked with i=10 each time!!!\n    ThreadPool.QueueUserWorkItem(delegate { DoWork(\"closure\", i); });\n\n    // not type safe, but it works\n    ThreadPool.QueueUserWorkItem(new WaitCallback(DoWork), Tuple.Create(\"    WCB\", i));\n}\n\nvoid DoWork(string s, int i)\n{\n    Console.WriteLine(\"{0} - i:{1}\", s, i);\n}\n\nvoid DoWork(object state)\n{\n    var t = (Tuple&lt;string, int&gt;)state;\n    DoWork(t.Item1, t.Item2);\n}\n</code></pre>\n\n<p>and here is the output:</p>\n\n<pre><code>closure - i:10\n    WCB - i:0\nclosure - i:10\n    WCB - i:2\n    WCB - i:3\nclosure - i:10\n    WCB - i:4\nclosure - i:10\n    WCB - i:5\nclosure - i:10\n    WCB - i:6\nclosure - i:10\n    WCB - i:7\nclosure - i:10\n    WCB - i:8\nclosure - i:10\n    WCB - i:9\n    WCB - i:1\nclosure - i:10\n</code></pre>\n\n<p>Note that when using the closure to call QueueUserWorkitem, i=10 for ever call, but when using the WaitCallBack you get the correct values, 0-9.  </p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>Why isn't the correct value of i passed when using the closure/delegate way of doing it?  </li>\n<li>How on earth does i ever get to be 10?  In the loop, it only ever had values 0-9 right?</li>\n</ol>\n"},{"tags":["java","multithreading","hibernate","unique-constraint"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12980217,"title":"Unique constraint violation error in while SaveOrUpdate","body":"<p>I have a hibernate entity called customer which contains the information about customer.In my method i m getting customer details as parametres which i need to insert in database. So to remove duplicate entries i m checking whether that customer already exists in db or not. But the problem is that if two calls are made to same method at one instant with same customer information then i m getting constraint violation error. I thought saveOrupdate() will solve the problem but it hasnt. Can someone suggest a solution for this scenario.</p>\n"},{"tags":["java","android","multithreading","context"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":9972347,"title":"Issue between thread and context - Android","body":"<p>I'm trying to implement a thread so that I can send GPS coordinates in the background. I think I have a good start but I'm having a little trouble. Where it says <code>locManager = (LocationManager) context.getSystemService(Context.LOCATION_SERVICE);</code> I'm getting an error on context (before getSystemService) which says \"context cannot be resolved.\" I call this class from my main activity with the following statement <code>new FindLocation(getBaseContext()).start(usr_id1);</code> maybe that has something to do with the problem. If you have any suggestions please let me know! Thanks.</p>\n\n<pre><code>public class FindLocation extends Thread {\n\nprivate LocationManager locManager;\nprivate LocationListener locListener;\n\nContext ctx;\npublic String userId;\n\npublic FindLocation(Context ctx) {\n     this.ctx = ctx;\n}\n\n public void start(String userId) {\n        this.userId = userId;\n        super.start();\n      }\n\n @Override\npublic void run() {\n    final String usr = userId;\n\n    //get a reference to the LocationManager\n    locManager = (LocationManager) context.getSystemService(Context.LOCATION_SERVICE);\n\n    //checked to receive updates from the position\n    locListener = new LocationListener() {\n        public void onLocationChanged(Location loc) {\n\n            String lat = String.valueOf(loc.getLatitude()); \n            String lon = String.valueOf(loc.getLongitude());\n\n            JSONArray jArray;\n            String result = null;\n            InputStream is = null;\n            StringBuilder sb = null;\n\n             ArrayList&lt;NameValuePair&gt; nameValuePairs = new ArrayList&lt;NameValuePair&gt;();\n             nameValuePairs.add(new BasicNameValuePair(\"id\", usr));\n\n            //http post\n            try{\n\n                 HttpClient httpclient = new DefaultHttpClient();\n                 HttpPost httppost = new HttpPost(\"http://www.example.com/test/example.php\");     \n                 httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));\n                 HttpResponse response = httpclient.execute(httppost);\n                 HttpEntity entity = response.getEntity();\n                 is = entity.getContent();\n                 }catch(Exception e){\n                     Log.e(\"log_tag\", \"Error in http connection\"+e.toString());\n                }\n\n            //convert response to string\n            try{\n                  BufferedReader reader = new BufferedReader(new InputStreamReader(is,\"iso-8859-1\"),8);\n                   sb = new StringBuilder();\n                   sb.append(reader.readLine() + \"\\n\");\n\n                   String line=\"0\";\n                   while ((line = reader.readLine()) != null) {\n                                  sb.append(line + \"\\n\");\n                    }\n                    is.close();\n                    result=sb.toString();\n                    }\n\n                    catch(Exception e){\n                          Log.e(\"log_tag\", \"Error converting result \"+e.toString());\n\n\n                    }\n\n            try{\n                  jArray = new JSONArray(result);\n                  JSONObject json_data=null;\n                  for(int i=0;i&lt;jArray.length();i++){\n                         json_data = jArray.getJSONObject(i);\n                         String ct_name = json_data.getString(\"phoneID\");\n                         //stop = true;\n                         Log.i(\"User ID\", ct_name);\n                         if(ct_name == usr) {\n                             locManager.removeUpdates(locListener);\n                         }\n                         else{\n                             Log.i(\"User ID\", \"NONE\");\n                         }\n                     } \n                  }\n\n                  catch(Exception e){\n                        //Log.e(\"log_tag\", \"Error converting result \"+e.toString());\n\n                        HttpClient httpclient = new DefaultHttpClient();\n                        HttpPost httppost = new HttpPost(\"http://example.com/test/example.php\");\n\n                        try {\n                               List&lt;NameValuePair&gt; nameValuePairs1 = new ArrayList&lt;NameValuePair&gt;(2);\n                               nameValuePairs1.add(new BasicNameValuePair(\"lat\", lat)); \n                               nameValuePairs1.add(new BasicNameValuePair(\"lon\", lon));\n                               nameValuePairs1.add(new BasicNameValuePair(\"id\", usr));\n                               httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs1));\n                               httpclient.execute(httppost);\n                               Log.i(\"SendLocation\", \"Yes\"); \n                         } \n                         catch (ClientProtocolException g) {\n                             // TODO Auto-generated catch block\n                         } catch (IOException f) {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        } \n            } \n        }       \n\n\n        public void onProviderDisabled(String provider){\n        }\n        public void onProviderEnabled(String provider){ \n        }\n        public void onStatusChanged(String provider, int status, Bundle extras){\n        }\n    };\n    locManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 6000, 0, locListener);\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["java","android","multithreading","handler","alertdialog"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1164,"score":0,"question_id":9990242,"title":"Alert Dialog from Thread - Android","body":"<p>I have a thread that sends GPS coordinates to a database every six seconds and I have a check that verifies that the user is within a defined area. If the user is not within the location, I want an alert dialog that notifies them that they are out of range, and if they are within the area I want a dialog that tells them they are within range. I have the checks working properly, but I have tried and I'm pretty sure that I can't add the dialog on the background thread. I have read a bit about using handlers but I'm not sure how to implement one. If you have any suggestions I would appreciate it! Thanks.</p>\n\n<p>This is how I call <code>FindLocation.java</code> from my main activity (<code>MainActivity.java</code>):</p>\n\n<pre><code>new FindLocation(getBaseContext()).start(usr_id1); //sends a user id with it\n</code></pre>\n\n<p>Below is <code>FindLocation.java</code></p>\n\n<pre><code>public class FindLocation extends Thread {\n\npublic boolean inJurisdiction;\npublic boolean AlertNotice = false;\nprivate LocationManager locManager;\nprivate LocationListener locListener;\n\nContext ctx;\npublic String userId;\n\npublic FindLocation(Context ctx) {\n     this.ctx = ctx;\n}\n\n public void start(String userId) {\n        this.userId = userId;\n        super.start();\n      }\n\n @Override\npublic void run() {\n     Looper.prepare();\n    final String usr = userId;      \n\n    //get a reference to the LocationManager\n    locManager = (LocationManager) ctx.getSystemService(Context.LOCATION_SERVICE);\n\n    //checked to receive updates from the position\n    locListener = new LocationListener() {\n        public void onLocationChanged(Location loc) {\n\n            String lat = String.valueOf(loc.getLatitude()); \n            String lon = String.valueOf(loc.getLongitude());\n\n            Double latitude = loc.getLatitude();\n            Double longitude = loc.getLongitude();\n\n            if (latitude &gt;= 39.15296 &amp;&amp; longitude &gt;= -86.547546 &amp;&amp; latitude &lt;= 39.184901 &amp;&amp; longitude &lt;= -86.504288 || inArea != false) {\n                Log.i(\"Test\", \"Yes\");  \n\n                inArea = true;\n\n                JSONArray jArray;\n                String result = null;\n                InputStream is = null;\n                StringBuilder sb = null;\n\n                 ArrayList&lt;NameValuePair&gt; nameValuePairs = new ArrayList&lt;NameValuePair&gt;();\n                 nameValuePairs.add(new BasicNameValuePair(\"id\", usr));\n\n                //http post\n                try{\n\n                     HttpClient httpclient = new DefaultHttpClient();\n                     HttpPost httppost = new HttpPost(\"http://www.example.com/test/example.php\");     \n                     httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));\n                     HttpResponse response = httpclient.execute(httppost);\n                     HttpEntity entity = response.getEntity();\n                     is = entity.getContent();\n                     }catch(Exception e){\n                         Log.e(\"log_tag\", \"Error in http connection\"+e.toString());\n                    }\n\n                //convert response to string\n                try{\n                      BufferedReader reader = new BufferedReader(new InputStreamReader(is,\"iso-8859-1\"),8);\n                       sb = new StringBuilder();\n                       sb.append(reader.readLine() + \"\\n\");\n\n                       String line=\"0\";\n                       while ((line = reader.readLine()) != null) {\n                                      sb.append(line + \"\\n\");\n                        }\n                        is.close();\n                        result=sb.toString();\n                        }\n\n                        catch(Exception e){\n                              Log.e(\"log_tag\", \"Error converting result \"+e.toString());\n\n\n                        }\n\n                try{\n                      jArray = new JSONArray(result);\n                      JSONObject json_data=null;\n                      for(int i=0;i&lt;jArray.length();i++){\n                             json_data = jArray.getJSONObject(i);\n                             String ct_name = json_data.getString(\"phoneID\");\n                             Log.i(\"User ID\", ct_name);\n                             if(ct_name == usr) {\n                                 locManager.removeUpdates(locListener);\n                             }\n                             else{\n                                 locManager.removeUpdates(locListener);\n                                 Log.i(\"User ID\", \"NONE\");\n                             }\n                         } \n                      }\n\n                      catch(Exception e){\n                            //Log.e(\"log_tag\", \"Error converting result \"+e.toString());\n\n                            HttpClient httpclient = new DefaultHttpClient();\n                            HttpPost httppost = new HttpPost(\"http://example.com/test/example.php\");\n\n                            try {\n                                   List&lt;NameValuePair&gt; nameValuePairs1 = new ArrayList&lt;NameValuePair&gt;(2);\n                                   nameValuePairs1.add(new BasicNameValuePair(\"lat\", lat)); \n                                   nameValuePairs1.add(new BasicNameValuePair(\"lon\", lon));\n                                   nameValuePairs1.add(new BasicNameValuePair(\"id\", usr));\n                                   httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs1));\n                                   httpclient.execute(httppost);\n                                   Log.i(\"SendLocation\", \"Yes\"); \n                             } \n                             catch (ClientProtocolException g) {\n                                 // TODO Auto-generated catch block\n                             } catch (IOException f) {\n                                // TODO Auto-generated catch block\n                                e.printStackTrace();\n                            } \n                } \n            } \n\n            else {\n                Log.i(\"Test\", \"No\");\n                inArea = false;\n            }\n        }\n        public void onProviderDisabled(String provider){\n        }\n        public void onProviderEnabled(String provider){ \n        }\n        public void onStatusChanged(String provider, int status, Bundle extras){\n        }\n    };\n    locManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 6000, 0, locListener);\n    Looper.loop();\n }\n}\n</code></pre>\n"},{"tags":["c++","multithreading","boost"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12980133,"title":"Reading a flag in a boost thread","body":"<p>I am kind of a newbie in Boost programming. What I want to do is create a thread from main() which will run continuously until the main() exits. Now, I am doing some operations on that thread and when it is done it will set a boolean flag. The main() will wait for this flag to be set, and when it is 'true' the main() will do its work, reset the flag, and wait for it to be set again. The other thread will run continuously.</p>\n\n<p>Can anyone please provide a simple set of boost thread instructions to achieve this?</p>\n\n<p>I am trying to do this in pseudocode</p>\n\n<pre><code>class Call {\npublic:\n    bool flag, do_it;\n    keyboard_callback() {\n        if('s' pressed) do_it = true;\n    }\n    f() { // some callback function\n        if(do_it == true) flag=true;\n    }\n    void func() {\n        ...register callback f()\n        ...register keyboard_callback()\n        ...\n        while(some condition) { keep running , exit when 'q'}\n        ...\n    }\n};\nmain()\n{\n    Call obj;\n    boost::thread th (boost::bind(&amp;Call::func, &amp;obj));\n    th.detach();\n    while(true) {\n        while (obj.flag == false);\n        ...do something\n    }\n }\n</code></pre>\n"},{"tags":["android","database","multithreading","android-sqlite"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12974219,"title":"Android SQlite multithread access","body":"<p>I am using SQLiteOpenHelper to write and read from SQlite database on Android. When user clicks on UI I read from SQLite database using AsyncTask but at the exact samo moment I am updating and writing to the database in the background using other AsyncTask. </p>\n\n<p>Every x times I get database locked exception. How can I fix this? Can SQlite be accessed somehow from multiple thread at the same time?</p>\n\n<p>I am using it like that: I have a Database class which extends from SQLiteOpenHelper. I implemented onCreate and onUpgrade methods and everytime I am reading from database or writing to database I use SQLiteDatabase like that:</p>\n\n<pre><code>SQLiteDatabase database = null;\ntry {\n\n    database = new Database(context).getWritableDatabase();\n\n    ....\n    writing and reading from database...\n    ....\n\n} catch (Exception e) {\n    e.printStackTrace();\n} finally {\n    if (database != null) {\n        database.close();\n    }\n}\n</code></pre>\n\n<p>At the end I also close SQLiteStatements and Cursors if I use them. Should I use @Justin answer and have a singleton of database class in Application?</p>\n\n<p>This is the error I get:</p>\n\n<pre><code>E/SqliteDatabaseCpp(17377): sqlite3_open_v2(\"/data/data/com.skulptur/databases/LGM.s3db\", &amp;handle, 6, NULL) failed\nE/SQLiteDatabase(17377): Failed to open the database. closing it.\nE/SQLiteDatabase(17377):     android.database.sqlite.SQLiteDatabaseLockedException: database is locked\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteDatabase.dbopen(Native Method)\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:983)\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:956)\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteDatabase.openOrCreateDatabase(SQLiteDatabase.java:1021)\nE/SQLiteDatabase(17377):    at   android.app.ContextImpl.openOrCreateDatabase(ContextImpl.java:750)\nE/SQLiteDatabase(17377):    at android.content.ContextWrapper.openOrCreateDatabase(ContextWrapper.java:221)\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteOpenHelper.getWritableDatabase(SQLiteOpenHelper.java:149)\nE/SQLiteDatabase(17377):    at android.database.sqlite.SQLiteOpenHelper.getReadableDatabase(SQLiteOpenHelper.java:223)\n</code></pre>\n"},{"tags":["c#","multithreading",".net-4.0","lockless"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12979416,"title":"Overuse of Interlocked.exchange?","body":"<p>I am trying to understand correct usage of Interlocked.Exchange, so I am implementing a simple sorted LinkedList with add and remove functionality.</p>\n\n<p>If this was not a threadsafe list, obviously to find the insertion point, you'd have something like the below to find the correct point to insert then new node.</p>\n\n<pre><code>    public void Insert(int newValue)\n    {\n        var prev = _header;\n        Node curr = _header.Next;\n\n        while(curr != null &amp;&amp; curr.value &gt; newValue )\n        {\n            prev = curr;\n            curr = curr.Next;\n        }\n        var newNode = new Node(newValue, curr);\n        prev.Next = newNode;\n    }\n</code></pre>\n\n<p>Below is my take on how you'd have to do this for a concurrent list. Is there too much Interlocked.Exchange's going on? Without this, would the insert still be threadsafe? Would hundreds or thousands of Interlocked operations cause bad performance?</p>\n\n<pre><code>    public void InsertAsync(int newValue)\n    {\n        var prev = _header;\n        Node curr = new Node(0, null);\n        Interlocked.Exchange(ref curr, _header.Next);\n\n        while (curr != null &amp;&amp; curr.value &gt; newValue)\n        {\n            prev = Interlocked.Exchange(ref curr, curr.Next);\n        }\n        //need some locking around prev.next first, ensure not modified/deleted, etc..\n        //not in the scope of this question.\n        var newNode = new Node(newValue, prev.Next);\n        prev.Next = newNode;\n    }\n</code></pre>\n\n<p>I understand that, for example, curr = curr.next is an atomic read, but can I be sure that a specific thread will read the most up to date value of curr.next, without the Interlocked?</p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12977334,"title":"Multithreading and passing data to new threads","body":"<p>I have some issues with an application I'm coding. It's job is to solve a maze using threads. One thread begins, and for each bifurcation it calls a static method in another class, passing parameters that the other thread needs, and then starts threads for each path. My outputs are all messed up, and I'm not sure if it's a Multithreading problem or maybe a problem with the references. Here's some of the code (Each thread is given a new instance of an <code>Explorer</code> class):</p>\n\n<p>This is the <code>Run()</code> method for each thread:</p>\n\n<pre><code>public void Explore()\n{\n    while (ImDone == false)\n    {\n        Move();\n        if (ActualPosition[0] != Labyrinth.ExitPoint[0] || \n            ActualPosition[1] !=   Labyrinth.ExitPoint[1]) //I'm not at the end..\n        continue;\n\n        PrintMyStatus(); //Print in the console my parents and my complete route..\n        break;\n    }\n</code></pre>\n\n<p>This is the <code>Move()</code> method:</p>\n\n<pre><code>List&lt;int[]&gt; validPaths = CheckSurroundings(); //returns a list of paths\n\nswitch (validPaths.Count)\n{\n    case 0:\n        ImDone = true; //No more routes available\n        break;\n    case 1:\n        MarkMyPosition(validPaths); //Change internal variables to the only new path\n        break;\n    default:\n        lock(this) //As this involves thread creating I locked it..\n        {\n            //Creating deep copies of my \"History\" so my childs can have them..\n            List&lt;int[]&gt; DCValidPaths = DeepCopy(validPaths);\n            List&lt;string&gt; DCMyParents = DeepCopy(MyParents);\n            string[,] DCMyExplorationMap = DeepCopy(MyExplorationMap);\n            List&lt;int[]&gt; DCMyPositions = DeepCopy(MyPositions); \n\n            foreach (var path in validPaths)\n            {\n                DCMyParents.Add(Thread.CurrentThread.Name); //Adding myself as a parent\n\n                ExplorationManager.ExplorerMaker(\n                    DCValidPaths, \n                    DCMyParents, \n                    DCMyExplorationMap, \n                    DCMyPositions,\n                    ID);  //Threads are created in the static class\n            }\n         }\n    break;\n}\n</code></pre>\n\n<p>My <code>DeepCopy()</code> method is using is the one in the accepted answer of <a href=\"http://stackoverflow.com/questions/129389/how-do-you-do-a-deep-copy-an-object-in-net-c-specifically\">this</a> question. Any other info needed I'll be more than happy to provide in order to solve the problem. Thanks in advance for your help.</p>\n\n<p>EDITS: My problem consists basically in: I'm having an <code>OutOfMemoryException</code> in the <code>Thread.Start()</code> clause and the Path displayed by the threads contain corrupted data (incorrect positions). I tested the <code>CheckSurroundings()</code> method and by far only returns correct positions (The labyrinth is contained in a two-dimensional string array).</p>\n\n<p>This is the constructor of the <code>Explorer</code> class:</p>\n\n<pre><code>public Explorer(List&lt;string&gt; myParents, int[] actualPosition, string[,]   myExplorationMap, \n        List&lt;int[]&gt; myPositions, int ID)\n    {\n        //Here I pass the data specified in Move(); \n        MyParents = myParents;\n        ActualPosition = actualPosition;\n        MyExplorationMap = myExplorationMap;\n        MyPositions = myPositions;\n        this.ID = ID + 1; //An ID for reference\n\n        //Marking position in my map with \"1\" so I know I've been here already,\n        //and adding the position given to my list of positions\n        MyExplorationMap[ActualPosition[0], ActualPosition[1]] = \"1\";\n        MyPositions.Add(DeepCopy(ActualPosition));\n    }\n</code></pre>\n\n<p>And this is the class creating the threads:</p>\n\n<pre><code>public static class ExplorationManager\n{\n    public static void ExplorerMaker(List&lt;int[]&gt; validPaths, List&lt;string&gt; myParents, string[,] myExplorationMap, List&lt;int[]&gt; myPositions, int ID)\n    {\n        foreach (var thread in validPaths.Select\n            (path =&gt; new Explorer(myParents, path, myExplorationMap, myPositions,ID)).\n            Select(explorer =&gt; new Thread(explorer.Explore)))\n        {\n            thread.Name = \"Thread of \" + ID + \" generation\"; \n            thread.Start(); //For each Path in Valid paths, create a new instance of Explorer and assign a thread to it.\n        }\n    }\n}\n</code></pre>\n\n<p>And the method returning the ValidPaths</p>\n\n<pre><code>    private List&lt;int[]&gt; CheckSurroundings()\n    {\n\n        var validPaths = new List&lt;int[]&gt;();\n        var posX = ActualPosition[0];\n        var posY = ActualPosition[1];\n\n        for (var dx = -1; dx &lt;= 1; dx++)\n        {\n            if (dx == 0 || (posX + dx) &lt; 0 || (posX + dx) &gt;= Labyrinth.Size ||\n                MyExplorationMap[posX + dx, posY] == \"1\") continue;\n            var tempPos = new int[2];\n            tempPos[0] = posX + dx;\n            tempPos[1] = posY;\n            validPaths.Add(tempPos);\n        }\n\n        for (var dy = -1; dy &lt;= 1; dy++)\n        {\n            if (dy == 0 || (posY + dy) &lt; 0 || (posY + dy) &gt;= Labyrinth.Size ||\n                MyExplorationMap[posX, posY + dy] == \"1\") continue;\n            var tempPos = new int[2];\n            tempPos[0] = posX;\n            tempPos[1] = posY + dy;\n            validPaths.Add(tempPos);\n        }\n        //This method checks up, down, left, right and returns the posible routes as `int[]` for each one\n        return validPaths;\n    }\n</code></pre>\n\n<p>CheckSurroundings uses the deep copy passed to the child (via the constructor) to validate the routes he can take. It is NOT intended to alterate the parent's copy, because he is now in ANOTHER path of the labyrinth. The child only needs the information updated (passed via the constructor) UNTIL the point they \"separate\". And also EACH child must be independent from the other childs. That's what I'm trying to do. But I'm not sure what's wrong, maybe concurrency problem? Please help. If you need anything else let me know. –</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12977844,"title":"Is there a C# / Windows Forms equivalent to Android's runOnUiThread?","body":"<p>Is there a C# / Windows Forms equivalent to Android's <a href=\"http://developer.android.com/reference/android/app/Activity.html#runOnUiThread%28java.lang.Runnable%29\" rel=\"nofollow\">runOnUiThread</a>?</p>\n\n<p>For example, say I am running a (long-running) task on a worker thread and at the end I want to post the result to a GUI control (which of course I can't do from the worker thread). Is there a function as simple as <a href=\"http://developer.android.com/reference/android/app/Activity.html#runOnUiThread%28java.lang.Runnable%29\" rel=\"nofollow\">runOnUiThread</a> that would allow me to post that refresh-display for processing by the UI thread?</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12965213,"title":"What is the correct way to close a second Application loop?","body":"<pre><code>    public static void Main()\n    {\n        Form formOnThisMessageLoop = new Form();\n        formOnThisMessageLoop.Show();\n\n        Form formOnOtherMessageLoop = new Form();\n\n        Task.Factory.StartNew(\n            () =&gt;\n            {                                        \n                Application.Run(formOnOtherMessageLoop);                    \n            }\n         );\n        //Thread.Sleep(50);\n        formOnOtherMessageLoop.HandleCreated += (obj, args) =&gt;\n        formOnOtherMessageLoop.Invoke(new Action(() =&gt; { formOnOtherMessageLoop.Close(); })); //Value Close() cannot be called while doing CreateHandle().\n        Application.Run();                         \n\n        Console.Read();\n    }\n</code></pre>\n\n<p>I'm experimenting with various ways to close a form on a second message loop.  How can I synchronize my threads correctly in such a case?  Also, do I need to call <code>Application.Exit()</code> twice or is Form.Close() the best I can do?  I see Application.Run() keeping my dead thread alive.  That's my concern with it.  Assume the Main thread could live a long time.</p>\n"},{"tags":["android","multithreading","serial-port"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12906831,"title":"Access serial port (/dev/tty*) incoming data without polling","body":"<p>I use Gingerbread. I already talk to a native serial port (RS-232 native UART, not USB dungle). This is done through java.io and a small piece of native code written in C to open and close the stream and configure the baudrate.  It works but my first thought was that it is not efficient because I need to setup a thread that constantly poll the inputstream to check if there are bytes coming from the serial port. What a wasteful way to use CPU and batteries.</p>\n\n<pre><code>    private InputStream mInputStream;\nprivate ReadThread mReadThread;\n\nprivate class ReadThread extends Thread {\n\n    @Override\n    public void run() {\n        super.run();\n        while(!isInterrupted()) {\n            int size;\n            try {\n                byte[] buffer = new byte[64];\n                if (mInputStream == null) return;\n                size = mInputStream.read(buffer);\n                if (size &gt; 0) {\n                    onDataReceived(buffer, size);\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n                return;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>What I Thought I needed to do is to have the same kind of signal as for other events in android where I can setup  some kind of listener that would allow me to be informed of some bytes coming and wake up my thread that will take care of the incoming data. I did not find anything like that in the APIs. </p>\n\n<p>But, after looking and researching more, finally, I think this is not wasteful but I'd like an opinion from someone who knows about how threads work in Android.  Let's look at codes lines. </p>\n\n<pre><code>size = mInputStream.read(buffer);\n</code></pre>\n\n<p>is actually a blocking read. I looked how the device was opened and it is done in C through a NDK/JNI interface and it is open without the flag \"NOBLOCK/NODELAY\". Therefor, it should not spin constantly in the while loop but just get blocked on the mInputStream.read and the Kernel should just switch to another thread until there is some data available to read. In such case, this code would be totally fine. Is this assumption true?</p>\n\n<p>I'd like to know that because my embedded system main purpose is to display videos most of the time and I don't want what I manage behind the scene to suck-up to much resources and give some hiccups in the video playback.   </p>\n"},{"tags":["multithreading","cuda","cpu","shared-memory","reduction"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":108,"score":3,"question_id":12977250,"title":"Call a CUDA kernel from multiple CPU threads (using shared memory)","body":"<p>I wrote a cuda kernel that use shared memory to perform a reduction in order to find the minimum value in an array. This is very similar to the well known example that can be found here : </p>\n\n<p><a href=\"https://www.sharcnet.ca/help/index.php/CUDA_tips_and_tricks#Reduction\" rel=\"nofollow\">https://www.sharcnet.ca/help/index.php/CUDA_tips_and_tricks#Reduction</a></p>\n\n<p>When I'm running it from a single CPU thread, it works fine with any number of CUDA threads per block (up to the max of my device : 1024).</p>\n\n<p>When I'm running it from some (20) CPU threads with a small enough number of CUDA threads per block (256) it works fine.</p>\n\n<p>But as soon as I increase the number of CUDA thread with multiple CPU thread, everything crash!</p>\n\n<p>I tried to delete the lines of my kernel where I performe the reduction (so there only remains some operations on an array but without any communication between CUDA threads) and it work fine with any number of CUDA threads per block from any number of CPU threads.</p>\n\n<p>Any ideas of where my problem come from? Any ideas how to fix it? Thanks in advance for your help!</p>\n\n<p>PS: I'm using a single GTX650.</p>\n\n<p>PS2: Sorry if my english skills are a bit poor, it's not my mother language....</p>\n"},{"tags":["java","multithreading","event-dispatch-thread","swingutilities"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12975197,"title":"Updating a textfield using SwingUtilities.invokeLater()","body":"<p>My program consists of a simple gui and a class that extends thread!</p>\n\n<p>i am trying to learn how to use SwingUtilities.invokeLater() in order to use it to update a textfield in my GUI but how do i reach the textfield in my gui without making static? and am i on the right track or have i done something wrong so far:)?</p>\n\n<p><strong>Code</strong></p>\n\n<p><strong>This has been taken from the Class called Client that extends thread this is where i want to update my GUI from using SwingUtilities.invokeLater(Runnable)</strong></p>\n\n<pre><code>public void run(){\n    while (socket.isConnected()) {\n\n    if (input.hasNext()) {\n\n        updateTextField();\n    }\n\n}\n}\n\nprivate void updateTextField() {\n    SwingUtilities.invokeLater(new Runnable() {\n\n        @Override\n        public void run() {\n  // here i want to update my textfield using txt.setText(input.nextLine());\n\n        }\n    });\n\n}\n</code></pre>\n\n<p><strong>UPDATE (This is my code so far) getting a nullpointer execption</strong></p>\n\n<pre><code>public void run(){\n    while (socket.isConnected()) {\n            String x = input.next();\n            System.out.println(x);\n    mg.updateChat(x); // this is the line that gives me the nullexeption\n\n    }\n}\n</code></pre>\n\n<p><strong>in my GUI</strong></p>\n\n<pre><code>public void updateChat(final String input){\nSwingUtilities.invokeLater(new Runnable() {\n\n    @Override\n    public void run() {\n        // TODO Auto-generated method stub\n    txtChat.setText(input); \n    }\n}); \n}\n</code></pre>\n"},{"tags":["python","multithreading","task-queue"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12976103,"title":"Queue does not finish after tasks are done","body":"<p>This is a script I'm using to test the <code>Queue</code> module:</p>\n\n<pre><code>from Queue import Queue\nfrom threading import Thread\n\ndef worker(fruit_queue):\n\n    while True:\n        fruit = fruit_queue.get()\n        print 'A fruit: ' + fruit\n        fruit_queue.task_done()\n\n\ndef main():\n\n    fruits = ['apple', 'orange', 'kiwi', 'banana', 'plum',\n              'grape', 'mango', 'cherry', 'lime', 'lemon']\n\n    fruit_queue = Queue()\n\n    print 'Printing fruits...'\n\n    for fruit in fruits:\n        fruit_queue.put(fruit)\n\n    for i in range(2):\n        t = Thread(target=worker(fruit_queue))\n        t.daemon = True\n        t.start()\n\n    fruit_queue.join()\n    print 'Finished!'\n\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n\n<p>It works and creates two threads, printing each <code>fruits</code> item once, however <code>fruit_queue.join()</code> never seems to be continued as the end message <code>Finished!</code> is never printed:</p>\n\n<pre><code>$ python fruit.py\nPrinting fruits...\nA fruit: apple\nA fruit: orange\nA fruit: kiwi\nA fruit: banana\nA fruit: plum\nA fruit: grape\nA fruit: mango\nA fruit: cherry\nA fruit: lime\nA fruit: lemon\n</code></pre>\n\n<p>At first I wasn't sure and added <code>global fruit_queue</code> in to the <code>worker()</code> function, but it gave me <code>SyntaxError: name 'fruit_queue' is local and global</code> when I ran it.</p>\n\n<p>Does anyone see anything that I'm doing wrong here?</p>\n"},{"tags":["c#","multithreading",".net-4.0","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12975935,"title":"When is more granular locking better for performance?","body":"<p>I recently took a stab at implementing a concurrent priority queue using a skip-list data structure - for the sake of this question, if you don't know what a skip-list is, I believe just picturing a linked list would be sufficient enough to answer. I attempted minimal locking (i.e. allowing multiple enqueues and dequeues simultaneously, only locking nodes or their forward pointers if necessary, releasing locks as soon as possible, traversing the list using Interlocked's, etc).</p>\n\n<p>I was pleased with the results. However, writing a regular skiplist with the add and remove surrounded by a syncroot lock (i.e. only allowing one operation at any given time), was actually twice as fast. </p>\n\n<p>I assumed that I must have bug in my implementation. However, even a 'Concurrent Priority Queue' listed on the Microsoft website, only actually allows for one operation at a time (i.e. a syncroot lock around enqueue and dequeue)</p>\n\n<p><a href=\"http://code.msdn.microsoft.com/Samples-for-Parallel-b4b76364/sourcecode?fileId=44488&amp;pathId=1696822056\" rel=\"nofollow\">http://code.msdn.microsoft.com/Samples-for-Parallel-b4b76364/sourcecode?fileId=44488&amp;pathId=1696822056</a></p>\n\n<p>As a general rule, (and forgive me if this question is too general), at what point does more granular locking actually lead to a performance improvement? I imagine that in my case, since I actually have to traverse large lists with Interlocked.Exchange (is there a better way?) as well as multiple test and test and set's, etc, that this slows down the enqueues and dequeues. </p>\n\n<p>Additionally, is there a tool that could help me determine where the majority of the time is being spent? Thanks.</p>\n"},{"tags":["javascript","multithreading","google-gears","web-worker"],"answer_count":3,"favorite_count":6,"up_vote_count":11,"down_vote_count":1,"view_count":1038,"score":10,"question_id":7639224,"title":"JavaScript multithreading","body":"<p>I'm working on comparison for several different methods of implementing (real or fake) multithreading in JavaScript. As far as I know only webworkers and Google Gears WorkerPool can give you real threads (ie. spread across multiple processors with real parallel execution). I've found the following methods:</p>\n\n<ul>\n<li><p>switch between tasks using <code>yield()</code></p></li>\n<li><p>use <code>setInterval()</code> (or other non-blocking function) with threads waiting one for another</p></li>\n<li><p>use Google Gears WorkerPool threads (with plugin)</p></li>\n<li><p>use html5 web workers</p></li>\n</ul>\n\n<p>I read related questions and found several variations of the above methods, but most of those questions are old, so there might be a few new ideas.</p>\n\n<p>I'm wondering - how else can you achieve multithreading in JavaScript? Any other important methods?</p>\n\n<p><strong>UPDATE:</strong> As pointed out in comments what I really meant was concurrency. </p>\n\n<p><strong>UPDATE 2:</strong> I found information that Silverlight + JScript supports multithreading, but I'm unable to verify this.</p>\n\n<p><strong>UPDATE 3:</strong> Google deprecated Gears: <a href=\"http://code.google.com/apis/gears/api_workerpool.html\" rel=\"nofollow\">http://code.google.com/apis/gears/api_workerpool.html</a></p>\n"},{"tags":["multithreading","qt","qthread"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":5123,"score":4,"question_id":2339736,"title":"Do I need to call QThread.exec() in my thread?","body":"<p>I am not calling exec() yet my timer and QUdpSocket work just fine.  Is exec used to wait for an event to continue?<br>   </p>\n\n<p>UPDATE: the timer was working because I had not called moveToThread(this) on the QThread which meant the QThread was actually still part of the main thread.  As for QUdpSocket well I was using the polling functions so it did not need to work with signals.</p>\n\n<p>TIP: if you need to do init stuff that requires an event loop in your QThread you can delay calling moveToThread until you dont need signals anymore, that is practical when the program is loading.  You also dont need to call it in the constructor  (you could call it inside run() for example), just copy the this QThread this pointer to a variable and make the call later/elsewhere using the pointer</p>\n"},{"tags":["c#",".net","winforms","multithreading","task-parallel-library"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12975036,"title":"Executing Tasks at regular intervals using while(true)","body":"<p>I need to constantly poll a data store for possible updates.  I am achieving this using the following code.  This is a windows forms application by the way.</p>\n\n<pre><code>var uiContext = TaskScheduler.FromCurrentSynchronizationContext();\n\nvar updateTask = Task.Factory.StartNew(() =&gt;\n{\n    while (true)\n    {\n        Thread.Sleep(5000);\n\n        Task.Factory.StartNew(() =&gt;\n        {\n            someData = dataStore.GetData();\n        }).ContinueWith(t =&gt;\n        {\n            someGrid.DataSource = someData;\n        }, uiContext);\n    }\n});\n</code></pre>\n\n<p><code>someData</code> is a private class field and <code>someGrid</code> is a datagrid control.</p>\n\n<p>This seems to work perfectly, but I was wondering if there is a better way of achieving it.  Also, should my outer Task be LongRunning?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Ok, at the suggestion of Jon and Henk, I am using a Timer instead:</p>\n\n<pre><code>uiContext = TaskScheduler.FromCurrentSynchronizationContext();\n\nupdateTimer = new System.Timers.Timer(5000);\nupdateTimer.Elapsed += updateTimer_Elapsed;\nupdateTimer.Enabled = true;\n</code></pre>\n\n<p>The elapsed event:</p>\n\n<pre><code>void updateTimer_Elapsed(object sender, ElapsedEventArgs e)\n{\n    someData = dataStore.GetData();\n\n    Task.Factory.StartNew(() =&gt;\n    {\n        someGrid.DataSource = someData;\n    }, uiContext);\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12974726,"title":"How to correctly let two threads to update same Collection?","body":"<p>I have a program which expects commands from 2 sources.\nThe other is a socket interface and the other is an event listener.</p>\n\n<p>After setting up the listeners, the program waits for commands by calling:</p>\n\n<pre><code>wait();\n</code></pre>\n\n<p>The commands, when they arrive are added to (appended to the end of) a Vector using a synchronized method, which after adding the command calls </p>\n\n<pre><code>notify();\n</code></pre>\n\n<p>When that happens, the execution continues from the wait()-call and handles the contents of the command Vector, starting from the first element. To test the functionality, I added a Thread.sleep(5000) in the handling method so the handling would take at least 5 seconds.</p>\n\n<p>Then I generated commands from both sources.</p>\n\n<p>It turns out that the commands are not handled in the order which they arrived! The ones that arrive as events end up being handled first, even if a command from socket arrived first.</p>\n\n<p>What could cause this? Is my design broken?</p>\n"},{"tags":["windows","linux","multithreading","ubuntu","windows-7"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":91,"score":-3,"question_id":12967327,"title":"Multithreading Linux vs Windows One-One Many-Many One-One","body":"<p>What multithreading methods do different OS use and why are they important:</p>\n\n<pre><code>Multithreading Models\n\n    Many-to-One - many user threads to one kernel thread\n    One-to-One - each user thread is mapped to a kernel thread\n    Many-to-Many - Many user threads to smaller or equal # of kernel threads\n</code></pre>\n\n<p>This is what I know about multithreading models.</p>\n\n<ul>\n<li>Solaris uses Many-to-One</li>\n<li>Linux &amp; Windows family (at least to XP, not sure about Win7) uses One-to-One</li>\n<li>IRIX, HP-UX,andTru64 UNIX (Solaris prior to v9) uses Many-to-Many</li>\n</ul>\n\n<p>Why they are important?</p>\n\n<ol>\n<li>Responsiveness - web browsing in one thread, loading images in\nanother </li>\n<li>Resource sharing - allow several thread of activity in same\naddress space </li>\n<li>Economy - memory &amp; resources for process creation is\ncostly while threads share resources of a process (Solaris is 30x\nslower creating process than a thread) </li>\n<li>Scalability - In multiprocessor, threads can run parallel on diff processors,\nsingle-thread process can only run on one processor regardless of\nhow many processors exist</li>\n</ol>\n"},{"tags":["multithreading","linux-kernel","kernel-module"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12974110,"title":"Simple kernel multithreading","body":"<p>I am new to kernel module programming and for my work I need to write a multithreaded kernel module. So I tried some primary uses of kernel threads. I wrote the following. It is supposed to  print 1 in one thread and 2 in another thread, both 10 times.</p>\n\n<pre><code>#include &lt;linux/module.h&gt;\n#include &lt;linux/moduleparam.h&gt;\n#include &lt;linux/kernel.h&gt;\n#include &lt;linux/udp.h&gt;\n#include &lt;linux/mm.h&gt;\n#include &lt;linux/init.h&gt;\n#include &lt;linux/kthread.h&gt;\n\nstruct task_struct *task1;\nstruct task_struct *task2;\n\n\nstatic void thread_func(void* data)\n{   \n    int *n;\n    n = (int *)data;\n    int i = 0;\n    while(i &lt; 10){\n        printk(\"%d\\n\", *n);\n        i++;\n    }\n    //do_exit();\n}\n\nstatic int t_start(void)\n{\n    printk(\"Module starting ... ... ..\\n\");\n    int *p1, *p2;\n    int one = 1, two = 2;\n    p1 = &amp;one;\n    p2 = &amp;two;\n    task1 = kthread_run(&amp;thread_func, (void*)p1, \"thread_func_1\");\n    task2 = kthread_run(&amp;thread_func, (void*)p2, \"thread_func_2\");\n    return 0;\n}\n\nstatic void t_end (void)\n{\n    printk(\"Module terminating ... ... ...\\n\");\n    kthread_stop(task1);\n    kthread_stop(task2);\n}\n\nmodule_init(t_start);\nmodule_exit(t_end);\n\nMODULE_AUTHOR(\"Md. Taufique Hussain\");\nMODULE_DESCRIPTION(\"Testing kernel threads\");\nMODULE_LICENSE(\"GPL\");\n</code></pre>\n\n<p>But I am facing following problems. - </p>\n\n<ol>\n<li>First thread is printing all ten 1s and then second thread is\nexecuting. I wanted to run these two in interleaved manner.</li>\n<li>First thread is printing all 1s OK but second is not printing 2s. It\nis printing 0s. Probably parameter is not passing to second thread\nproperly.</li>\n<li>When I am inserting module it is running but when I am removing\n    module the machine hangs</li>\n</ol>\n\n<p>What are the problems? How can I solve them.</p>\n"},{"tags":["java","multithreading","sockets","tcp-ip"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":12970554,"title":"Handling multiple requests on a TCP/IP Socket","body":"<p>Is it quite easy to handle multiple requests on a Java TCP / IP socket. Simply accept a message and spawn a thread. Accept another message and spawn another thread.  The thing is once you start spawning threads things get more non deterministic.  Say you have 10 clients and one client keeps firing requests and the other 9 nine who send requests at 10% percent of the hyperactive client, find it harder to get a look in. </p>\n\n<p>One way you could handle this is have a hashmap of semaphores in your server where every client has a corresponding semaphore. Before you handle a request for any client, you could make it go thru its semaphore and configure the semaphores so that each client could only have a certain number of requests at any one time.</p>\n\n<p>At this stage,I'm thinking yeah that works but is there a better way or a library that does this?</p>\n"},{"tags":["c++","multithreading","valgrind","memcheck"],"answer_count":2,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":77,"score":6,"question_id":12960485,"title":"How can I prevent Valgrind from starting embedded gdbservers for every new thread?","body":"<p>I'm running valgrind memcheck on a program that spawns thousands of other threads.</p>\n\n<p>The other threads do not generate errors, and I don't care what happens to them.</p>\n\n<p>However, Valgrind insists on opening a named pipe in /tmp every time a new thread spawns. Not only is this wasteful, it actually breaks valgrind. Sometimes valgrind doesn't clean up after itself, and then future children with the same pid (active at a later time) fail to spawn because valgrind can't make a pipe with the right name (it already exists).</p>\n\n<p>How can I prevent Valgrind from making all these pipes!?!</p>\n\n<p>EDIT:\nFlags I have already tried:</p>\n\n<p>--child-silent-after-fork=yes</p>\n\n<p>and things I have already ruled out:</p>\n\n<p>--track-children=no  (default value is no).  </p>\n"},{"tags":["java","multithreading","thread-safety","listener"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12973678,"title":"Using Listener with Threads","body":"<p>Say I have an Object Foo that wants to get informed by several running instances of a Thread using a listener interface. E.g.</p>\n\n<p>The interface:</p>\n\n<pre><code>public interface ThreadListener {\n   public void onNewData(String blabla);\n}\n</code></pre>\n\n<p>The class Foo:</p>\n\n<pre><code>public class Foo implements ThreadListener {\n   public Foo() {\n      FooThread th1 = new FooThread();\n      FooThread th2 = new FooThread();\n      ...\n\n      th1.addListener(this);\n      th2.addListener(this);\n      ...\n\n      th1.start();\n      th2.start();\n      ...\n   }\n\n   @Override\n   public void onNewData(String blabla) {\n     ...\n   }\n}\n</code></pre>\n\n<p>The Thread:</p>\n\n<pre><code>public FooThread extends Thread {\n   private ThreadListener listener = null;\n\n   public void addListener(ThreadListener listener) {\n      this.listener = listener;\n   }\n\n   private void informListener() {\n      if (listener != null) {\n         listener.onNewData(\"Hello from \" + this.getName());\n      }\n   }\n\n   @Override\n   public void run() {\n     super.run();\n\n     while(true) {\n        informListener();\n     }\n   }\n}\n</code></pre>\n\n<p>In the worst case onNewData(..) is invoked by several threads at the same time. What will happen with Foo? Is it going to crash or not?</p>\n"},{"tags":["java","android","multithreading","garbage-collection"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":12956549,"title":"Why do threads leak on Android?","body":"<p>I've been noticing in our Android app that every time we exit to the home screen we increase the heap size (leak) by the amount of the ByteArrayOutputStream. The best I have been able to manage is by adding</p>\n\n<pre><code>this.mByteArrayOutputStream = null;\n</code></pre>\n\n<p>at the end of <em>run()</em> to prevent the heap size increasing constantly. If anyone could enlighten me I would be very appreciative. I wrote out the following example that   illustrates the problem.</p>\n\n<h2>MainActivity.java</h2>\n\n<pre><code>public class MainActivity extends Activity {\n    private Controller mController;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);        \n    }\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.activity_main, menu);\n        return true;\n    }\n\n    @Override\n    protected void onStart() {\n        super.onStart();\n\n        this.mController = new Controller();\n        mController.connect();\n    }\n\n    @Override\n    protected void onStop() {\n        super.onStop();\n\n        mController.quit();\n    }\n}\n</code></pre>\n\n<h2>Controller.java</h2>\n\n<pre><code>public class Controller {\n    public volatile ReaderThread mThread;\n\n    public Controller() {\n        super();\n    }\n\n    public void connect() {\n        mThread = new ReaderThread(\"ReaderThread\");\n        mThread.start();\n    }\n\n    public void quit() {\n        mThread.quit();\n    }\n\n    public static class ReaderThread extends Thread {\n        private volatile boolean isProcessing;\n        private ByteArrayOutputStream mByteArrayOutputStream;\n\n        public ReaderThread(String threadName) {\n            super(threadName);  \n        }\n\n        @Override\n        public void run() {\n            this.isProcessing = true;\n\n            Log.d(getClass().getCanonicalName(), \"START\");\n            this.mByteArrayOutputStream = new ByteArrayOutputStream(2048000);\n\n            int i = 0;\n            while (isProcessing) {\n                Log.d(getClass().getCanonicalName(), \"Iteration: \" + i++);\n                mByteArrayOutputStream.write(1);\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                }\n            }\n\n            try {\n                mByteArrayOutputStream.reset();\n                mByteArrayOutputStream.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n\n            Log.d(getClass().getCanonicalName(), \"STOP\");\n        }\n\n        public void quit() {\n            this.isProcessing = false;\n        }\n    }\n}\n</code></pre>\n"},{"tags":["android","multithreading","handler"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12973483,"title":"CalledFromWrongThreadException when adding TextView","body":"<p>I have implemeted a custom camera and I want it to go, after a period of time into a standby state. The standby concsists from a stopPreview, a camera release and a view that tells the user to tap in order to exit the standby. Because I set the text within the new thread, I get the CalledFromWrongThreadException, but I don't know what the solution could be. I found other posts around, but none of them really worked.</p>\n\n<p>Code:</p>\n\n<pre><code>    private void initCamera()\n        {//more code\n\n\n                threadModifiedText = (TextView) findViewById(R.id.textView1);\n                Thread standbyThread = new Thread()\n                {\n                    @Override\n                    public void run()\n                    {\n                        try\n                        {\n\n                            while (timeCounter &gt; 0)\n                            {\n                                if (!activeThread)\n                                {\n                                    sleep(100);\n                                    if (timeCounter % 10 == 0)\n                                    {\n                                        threadHandler.sendEmptyMessage((int) timeCounter / 10);\n                                    }\n                                    timeCounter--;\n                                }\n                            }\n                        }\n                        catch (InterruptedException e)\n                        {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n\n                        mCamera.stopPreview();\n                        mCamera.release();\n                        TextView standbytext = new TextView(SlicesActivity.this);\n                        standbytext.setText(\"Tap to exit standby mode\");\n                        FrameLayout preview = (FrameLayout) findViewById(id.FrameLayout_camera_preview);\n                        preview.addView(standbytext);\n\n                    }\n                };\n                standbyThread.start();\n\n//more code}\n</code></pre>\n\n<p>And</p>\n\n<pre><code>    @Override\n    public void onUserInteraction()\n    {\n        Log.d(\"~~~~~~~~~\", \"apasat\");\n        activeThread = true;\n            timerCounter = 300;\n\n\n    }\n\n    private Handler threadHandler = new Handler()\n    {\n        public void handleMessage(android.os.Message msg)\n        {\n            // whenever the Thread notifies this handler we have\n            // only this behavior\n            threadModifiedText.setText(\"\\ncounter is \" + Integer.toString(msg.what));\n        }\n    };\n</code></pre>\n\n<p>Please guys, give me some suggestions. 10x</p>\n"},{"tags":["c#","asp.net",".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12971988,"title":"How to access Application State in a thread?","body":"<p>I am using a threading architecture in my ASP.NET web application. In this application, I have maintained  a global application variable that i want to access in a Thread.</p>\n\n<p>How can i get Application state in a Thread?</p>\n"},{"tags":["java","multithreading","parent-child"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12972157,"title":"Safely killing the child thread (infinte loop) before leaving the main thread","body":"<p>I have a main function which has generated two threads for updation of JDBC SQL results. The child threads exclusively work are in infinite loop and update the results after five minutes. I want before exiting the main thread, child tread should be killed.</p>\n\n<p>What is the best procedure for that?</p>\n"},{"tags":["android","multithreading","handler"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12972973,"title":"I am not able to solve this - Thread, handler and listview issue in Android","body":"<p>I just wanna pull data with httpconnection and take the values with ResponseHandler and some manipulation operations. Then I just want to put them into listview. But I couldn't. </p>\n\n<p>First I am taking values in a thread. Then I am doing manipulation on main thread and add values to adapter but, i am either taking an exception or blank listview.</p>\n\n<p>My sample code is as below;</p>\n\n<pre><code> public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_x);\n\n        m_results = new ArrayList&lt;Type&gt;();\n\n\n        /*\n        rs.setDate(\"22.09.2012\");\n        rs.setOne(\"5\");\n        rs.setTwo(\"12\");\n        rs.setThree(\"18\");\n        rs.setFour(\"21\");\n        rs.setFive(\"44\");\n        rs.setSix(\"48\");\n        */\n\n\n        this.m_adapter = new Adapter(this, R.layout.resultrow, m_results);\n        setListAdapter(this.m_adapter);\n\n\n\n\n        sendNumbers = new Runnable() {\n\n            @Override\n            public void run() {\n\n\n                httpclnt = new DefaultHttpClient();\n\n                httppst = new HttpPost(\"url\");\n\n                try {           \n\n\n            ResponseHandler&lt;String&gt; responseHandler = new BasicResponseHandler();\n\n                    response = httpclnt.execute(httppst, responseHandler);\n\n                    message = response;\n\n\n\n\n\n                    handler.sendEmptyMessage(0);\n\n\n                }catch (ClientProtocolException e) {\n                    Toast.makeText(getApplicationContext(), \"Client protocol exception \", Toast.LENGTH_LONG).show();\n                } catch (IOException e) {\n                    Toast.makeText(getApplicationContext(), \"IO exception \"+e.getMessage(), Toast.LENGTH_LONG).show();\n                } \n\n            }\n        };\n            Thread thread = new Thread(sendNumbers,\"sendNumbers\");\n            thread.start();\n\n\n\n        handler = new Handler() {\n\n                public void handleMessage(Message msg) {\n\n                    firstResult = message.substring(0,message.indexOf(\")\"));\n\n firstDate = firstResult.substring(firstResult.indexOf(\"&gt;\")+2,firstResult.indexOf(\"&gt;\")+12);\n                         firstNumbers=firstResult.substring(firstResult.lastIndexOf(\"&gt;\")+2,firstResult.lastIndexOf(\"&gt;\")+19);\n\n                    rs.setDate(firstDate.substring(firstDate.lastIndexOf(\"-\")+1,firstDate.lastIndexOf(\"-\")+3)+\".\"\n                            +firstDate.substring(firstDate.indexOf(\"-\")+1,firstDate.indexOf(\"-\")+3)+\".\"+firstDate.substring(0,4));\n\n                    m_results.add(rs);\n\n\n                    m_adapter.notifyDataSetChanged();\n\n\n                        }\n                    };   \n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":50,"score":0,"question_id":12969694,"title":"How do you stop a thread in a Java command prompt that is stopped when the user commands it to stop?","body":"<p>Basically, I have a Java thread that is running in a console that will go infinitely, unless the user enters \"halt\", the program should stop the thread and stop the console.  </p>\n\n<p>Here's what the set_interval part of the thread kind of looks like (the user can give an input of how long of an interval they want in between threads):</p>\n\n<pre><code>public void set_interval(int mins, int secs) {\n    time = (mins * 60000) + (1000 * secs);\n    Timer timer = new Timer();\n    timer.schedule(new TimerTask() {\n        public void run() {\n            try {\n                count += counter;\n                String name = getName();\n                Date date = new Date();\n                System.out.print(\"\\n\" + \"Thread:\" + name + \" \" + date + \" - counter: \" + count);\n                Thread.sleep(time);\n            } catch(InterruptedException e){\n                System.out.print(e);\n            }\n    }, 0, time);    \n}\n</code></pre>\n\n<p>and here's kind of what main looks like:\n<code>}else if (checkLine.equals(\"halt\")){\n                          Thread test = new Thread(\"name\");\n                test.interrupt();\n                break;\n            }</code></p>\n\n<p>Every where I look says to use interrupt, but this interrupt doesn't seem to work.  Anyone got any ideas? Or am I just overlooking some small details? There's a chance that I need to use sockets to solve this problem.</p>\n"},{"tags":["c","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":11752583,"title":"how can I use multithreading on a server program to connect and send data to browser when I'm requesting from the browser?","body":"<p>I am trying to use Multithreading in my server program in such a way that when i get request from browser my server should open a txt file and send it to browser to display.\n   what I need to do is to have a separate function which does the send/receive inside my main every time there is a request from the browser(client) such as: 127.0.0.1:3490/index.txt\nI managed to do it for one request only with my main function but I have trouble with putting every thing in my thread function and send it to browser.</p>\n\n<p>I will appreciate any help\nthe following is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include &lt;winsock.h&gt;\n#include &lt;stddef.h&gt;\n#define NUM_THREADS 10\n#define MYPORT 3490\nvoid *PrintData(void *thread);  \nint main() {\n    WSADATA wsaData;\n    SOCKET s;\n    unsigned fd;\n    struct sockaddr_in my_addr;\n  WSAStartup(MAKEWORD(1, 1), &amp;wsaData);\n  my_addr.sin_family = AF_INET;\n  my_addr.sin_port = htons(MYPORT);\n  my_addr.sin_addr.s_addr = INADDR_ANY;\n  memset(my_addr.sin_zero, '\\0', sizeof(my_addr.sin_zero) );\n\n  s=socket(PF_INET,SOCK_STREAM, 0);\n  if(s&lt;0) printf(\"socket failed\\n\");\n  if ( (bind(s, (struct sockaddr *)&amp;my_addr, sizeof(my_addr)) ) !=0){ printf(\"Bind failed!\\n\");}\n  listen(s,10);\n\n    while(1) {\n        fd=accept(s,NULL,NULL);\n         printf(\"Client connected\\r\\n\");\n        CreateThread(NULL,(DWORD)NULL,(LPTHREAD_START_ROUTINE)PrintData,(void*)fd,(DWORD)NULL,NULL);  // creating threads\n    }\n    closesocket(fd);    \n    WSACleanup();\n}\n\nvoid *PrintData(void *thread){\n   char *header=\"HTTP/1.1 200 OK\\r\\nContent-Type: text/html\\r\\n\\r\\n\";\n    char data[512];\n    char filename[256];\n    FILE *f; \n    printf(\"It's me, thread!\\n\");\n    SOCKET curr_client = (SOCKET)thread;\n    int res;\n    while(1){\n        res=recv(curr_client,data,512,0);              \n        ///data[res]=0;                         \n        Sleep(10);\n        if(res == 0) printf(\"error: res == 0\");\n\n        sscanf(data,\"GET /%s \",filename);  \n        printf(\"Get: %s %d\\n\", filename, res);\n        send(curr_client,header,strlen(header),0);  \n        f=fopen(filename,\"rb\");            \n        if(f == NULL){ fputs(\"Can not find the file!\", stderr); }\n        while(!feof(f)){\n            printf(\"heloooo\");\n            int retVal = fread(data, 1, sizeof(data), f);\n            ///printf(\"data is : %s\\n\", data);\n            send(curr_client, data, sizeof(data), 0); \n        }\n    }\n    fclose(f);\n    ExitThread((DWORD)NULL);\n}\n</code></pre>\n"},{"tags":["java","android","multithreading","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12969568,"title":"Stop AsyncTask which is waiting for a synchronous method","body":"<p>I want to stop/cancel the pendning AsyncTasks which is waiting for a synchronous method.</p>\n\n<p>Below is my code:(Its starting all the 21 AsyncTasks. I want to stop in the middle, for example after 10 asynctasks completed. Can any one suggest a way for it?</p>\n\n<pre><code> for(int i=0;i&lt;21;i++){\n\n   SafeAsyncTask&lt;String, Void, LinkInfo[]&gt; mGetLinkInfo = new SafeAsyncTask&lt;String,Void,LinkInfo []&gt;() {\n\n                protected LinkInfo[] doInBackground(String... v) {\n                    return downloadLinks(v[0]);\n                }\n\n                protected void onPostExecute(LinkInfo[] links) {\n\n\n                }\n            };\n\n            mGetLinkInfo.safeExecute(i);\n }\n   synchronized void downloadLinks(){\n         //Lengthy process\n     }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12968698,"title":"How do you stop a thread in Java that is stopped at an unsuspected time?","body":"<p>Basically I have a Java thread in a command prompt that runs in a set interval like this:</p>\n\n<pre><code>Thread: Thu Oct 18 23:33:17 PDT 2012 - counter: 1\nThread: Thu Oct 18 23:33:22 PDT 2012 - counter: 2\nThread: Thu Oct 18 23:33:27 PDT 2012 - counter: 3\nThread: Thu Oct 18 23:33:32 PDT 2012 - counter: 4\nThread: Thu Oct 18 23:33:37 PDT 2012 - counter: 5\nThread: Thu Oct 18 23:33:42 PDT 2012 - counter: 6\n</code></pre>\n\n<p>This should go on infinitely unless the user tells the command prompt to stop in which case it should close the command prompt AND stop the threads.  I can easily end the command prompt but I can't seem to figure out how to stop the threads.  I've attempted to use the <code>interrupt()</code> command but I can't get it to work.  I think it might have to do with sockets.  </p>\n\n<p>A really good website I found useful:\n<a href=\"http://www.techrepublic.com/article/interrupting-java-threads/5144546\" rel=\"nofollow\">http://www.techrepublic.com/article/interrupting-java-threads/5144546</a></p>\n\n<p>But I still can't seem to figure it out.  All I need is to be able to stop the threads when the user inputs the stop command.</p>\n"},{"tags":["java","multithreading","jsp","servlets","httpclient"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12967825,"title":"Sending Push Notification to Desktop application in java","body":"<p>Here is my application scenario...  </p>\n\n<ol>\n<li><p>User requests for login and sends credentials to the web server(From Desktop application using httpClient API).  </p></li>\n<li><p>Servlet(tomcat) authenticates user and send valid or invalid user information. If user is registered user, servlet will save IP address on the server.  </p></li>\n<li><p>Now I have to send some text to the user without getting another request(i.e server push sort of technology). How can I accomplish this functionality and using what technology?</p></li>\n</ol>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12966288,"title":"how to do multithreading when using outside referenced code","body":"<p>Well i managed to get a webcam running using Aforge\nThe code can be found in my own answer here.\n <a href=\"http://stackoverflow.com/a/12966093/613326\">http://stackoverflow.com/a/12966093/613326</a> </p>\n\n<p>Now i want to do some computer vision related stuf and return back some results to the main form. The threading problem i have is in this part from that code :</p>\n\n<pre><code>void FinalVideo_NewFrame(object sender, NewFrameEventArgs eventArgs)\n{ Bitmap video = (Bitmap)eventArgs.Frame.Clone();\n  pictureBox1.Image = video;\n  // count red colors  \n  // not yet written\n  TextBox1.text = \"demo error\";  // &gt;&gt; i like to return a value to the main form\n }\n</code></pre>\n\n<p>The problem however is its doing the video frames in another thread\nAnd now i cant return answers from that threat to the main form back.\nI didnt wrote the Aforge, i only linked it and made it work on my form.\nI cannt change the way how aforge video works.\nI mean it was never made to result something back thats something i like to do </p>\n\n<p><strong>Are there ways to get a result back, like a string text in a textbox. \nOn the main form where this code runs from ?.</strong></p>\n\n<p>I am able to follow a sample code of threading but this is a bit over my head since i got not much influence on how video acquisition in Aforge was designed.</p>\n\n<ul>\n<li>i have been wondering if raising another thread just to update a textbox might work but i am not that sure and wonder that in the end one would create to many threads. causing to much kernel switching load</li>\n</ul>\n\n<p>Some additional info the code thread above is started with this button function below.</p>\n\n<pre><code>private void button1_Click(object sender, EventArgs e)\n{ FinalVideo = new VideoCaptureDevice(VideoCaptureDevices[comboBox1.SelectedIndex].MonikerString);\n  FinalVideo.NewFrame += new  NewFrameEventHandler(FinalVideo_NewFrame);\n  FinalVideo.Start();\n}\n</code></pre>\n"},{"tags":["java","multithreading","spring","deadlock","apache-commons-dbcp"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1991,"score":2,"question_id":5714511,"title":"Deadlock issue in DBCP deployed on Tomcat","body":"<p>I'm using DBCP data source (with default configuration) in Spring configuration to manage my connections to the database, and I'm running into a deadlock condition when the number of clients increase.</p>\n\n<p>I found that there is a deadlock issue in DBCP 1.2.1 which I was using, which was supposed to be resolved in 1.4. So I upgraded to 1.4, but the issue still persists.</p>\n\n<p>In the thread dump, there are many threads blocked with the following stack trace on top:</p>\n\n<pre><code>   java.lang.Thread.State: WAITING on org.apache.commons.pool.impl.GenericObjectPool$Latch@b6b09e\nat java.lang.Object.wait(Native Method)\nat java.lang.Object.wait(Object.java:485)\nat org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1104)\nat org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:106)\nat org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:1044)\nat org.springframework.jdbc.datasource.DataSourceTransactionManager.doBegin(DataSourceTransactionManager.java:200)\nat org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:350)\nat org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:261)\nat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:101)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:160)\nat org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)\nat org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:631)\n</code></pre>\n\n<p>Any suggestions are welcome!</p>\n"},{"tags":["multithreading","performance","qt","timer","signals"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12924960,"title":"Timer makes UI unresponsive?","body":"<p>I use a timer to emit a signal and call a slot function which updates the UI according to new data.</p>\n\n<p>I've calculated the time to run that function as being quite short. When the timer is set to 1000ms, the UI responds quite slow. </p>\n\n<p>I tried to move that functionality to a thread but I'm finding it difficult since a lot of the functionality needs to access the UI class's protected values.</p>\n\n<p>I'm going to try moving the timer to another thread and leave the update functionality in the UI class (main window) but I don't know if it will help.</p>\n\n<p>Why is the timer causing the UI to be slow and unresponsive? Will a thread be lighter and consume less CPU time? How can I fix this?</p>\n\n<pre><code>    initTimer()\n    {\n        refreshTimer = new QTimer(this);\n        connect(refreshTimer, SIGNAL(timeout()), this, SLOT(refreshDisplay));\n        refreshTimer-&gt;start(1000);\n    }\n</code></pre>\n\n<p>refresh slot function called every 1000ms:</p>\n\n<pre><code>    void refreshDisplay()\n    {\n        ui-&gt;tableWidget-&gt;setUpdatesEnabled(false);\n\n        for(int queue_i = size_1, index = 0; queue_i &gt;= 0; queue_i--, index++)\n        {\n            LogInfoItem* logItem = (LogInfoItem*)logDisplayQueue.at(queue_i);\n\n            QString BITS_str = bits2Hexs(logItem-&gt;BITS);\n\n\n            ui-&gt;tableWidget-&gt;item(index, 0)-&gt;setText(logItem-&gt;time);//time\n            ui-&gt;tableWidget-&gt;item(index, 1)-&gt;setText(logItem-&gt;name);//name\n            ui-&gt;tableWidget-&gt;item(index, 2)-&gt;setText(BITS_str);//BITS\n\n            if(queue_i == oldRowItemNo)ui-&gt;tableWidget-&gt;selectRow(index);\n        }\n\n        ui-&gt;tableWidget-&gt;setUpdatesEnabled(true);\n\n        Q_FOREACH(Page* p, PageInfoList)\n        {\n            p-&gt;refresh();\n        }\n\n        Q_FOREACH(IconLabel* icl, iconLabelList)\n        {\n            icl-&gt;refresh();\n        }\n    }\n</code></pre>\n\n<p>What 'refresh()' does is just changing icons and texts in the ui according to the data inside.   Besides, i've made the data static, but still cannot fix it.\n    (I've tested the function, almost no time consuming...)</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12966044,"title":"Java Threading: How does implementing runnable work for threading","body":"<p>I understand that if you want to thread you can either extend thread or implement runnable to multithread in java. But why do you have to implement an interface for java to thread? Whats the importances of the runnable interface that makes java threading work? Does Java's interface extend from something?</p>\n"},{"tags":["php","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12950782,"title":"How can we do multiple process in php without using pcntl_fork()?","body":"<p>How can we do multiple process in php without using <strong>pcntl_fork()</strong>?</p>\n\n<p>I google many times but found nothing usefull. My server doesn't support <strong>pcntl_fork()</strong>.</p>\n"},{"tags":["ruby","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":70,"score":3,"question_id":12927724,"title":"Green thread in Ruby 1.9?","body":"<p>Ruby 1.9 uses native threads unlike Ruby 1.8 (MRI).</p>\n\n<p>But is it possible to kindly ask Ruby 1.9.3 to create a green thread instead of a native one?</p>\n\n<p>--</p>\n\n<p><strong>Why do I want that?</strong></p>\n\n<p>For testing purposes.</p>\n\n<p>I'm trying to create a simple TCP server that would accept thousands concurrent connections that would sleep for a couple of seconds before returning some result.</p>\n\n<p>In Ruby 1.8 I can easily create thousands of threads so the only limit for the number of concurrent connections is OS.</p>\n\n<p>In Ruby 1.9 that seems to be impossible.</p>\n\n<p>This code demonstrates what I mean:</p>\n\n<pre><code>require 'thread'\n\nm = Mutex.new\nc = 0\nta = Array.new 10000\n\nta.fill do\n  Thread.new do\n    m.synchronize { c += 1; p \"created #{c}th\" if c%100 == 0; }\n    sleep 15\n    m.synchronize { c -= 1; p \"destroyed #{c+1}th\" if c%100 == 0; }\n  end\nend\n\nta.each {|t| t.join}\n</code></pre>\n\n<p>It runs great in Ruby 1.8, but in 1.9 it's so miserable.</p>\n\n<p>--</p>\n\n<p>Unfortunately after some experimenting with eventmachine and its <code>add_timer</code> the best I could come up with was Node.js server:</p>\n\n<pre><code>var http = require('http');\nhttp.createServer(function (req, res) {\n  res.writeHead(200, {'Content-Type': 'text/plain'});\n  setTimeout(function() {res.end('Hello World\\n');}, 10000 );\n}).listen(8081, '127.0.0.1');\nconsole.log('Server running at http://127.0.0.1:8081/');\n</code></pre>\n\n<p>If anyone could demonstrate the same with EventMachine I would be glad to accept that answer.</p>\n"},{"tags":["java","android","multithreading","android-asynctask","http-post"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12964997,"title":"need to run tasks only after Async task has finished","body":"<p>How do i make sure that the async tasks finishes before i run certain tasks.  I need to use a variable AFTER the async tasks changes the value of that variable.  If i run the code before async is done running then im screwed. any help? im obviously new to async tasks.  If you look at my code im probably not using onPostExecute() as it was intended so advice would be helpful. My initial thought was to keep adding things to the async task but im thinking that this is just bad practice since i have tons of things that must be run in series.  Basically, what i think it boils down to is: how do i make sure that the tasks in the UI thread dont start to run before my async task has finished.</p>\n\n<pre><code>public class MainActivity extends MapActivity {\nmyJSONmap;\n\npublic void onCreate(Bundle savedInstanceState) {\nnew AsyncStuff().execute();\nlocatePlace(myJSONmap);\n\n class AsyncStuff extends AsyncTask&lt;Void, Integer, JSONObject&gt; {\n            @Override\n            protected JSONObject doInBackground(Void... params) {\n                jObject = GooglePlacesStuff.getTheJSON(formatedURL);\n                return null;\n            }\n            @Override\n            protected void onPostExecute(JSONObject result) {\n                // TODO Auto-generated method stub\n                super.onPostExecute(result);\n                myJSONmap = JSONextractor.getJSONHMArrayL(jObject);  // getting the parsed data from the JSON object.\n                //the arraylist contains a hashmap of all the relevant data from the google website.\n            }\n        }\n</code></pre>\n"},{"tags":["c","windows","multithreading","mingw","posix"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12962666,"title":"Multithreading libraries not detected","body":"<p>This is a simple code which I have written to learn multi threaded programming on a Windows 7 OS in eclipse.</p>\n\n<pre><code>pthread_mutex_t double_release_001_glb_mutex_;\npthread_mutex_t * double_release_001_glb_mutex = &amp; double_release_001_glb_mutex_;\n\nvoid double_release_001_glb_mutex_lock () {}\nvoid double_release_001_glb_mutex_unlock () {}\n\nint double_release_001_glb_data = 0;\n\nvoid * double_release_001_tsk_001 (void * pram)\n{\n\n    pthread_mutex_lock (double_release_001_glb_mutex);\n    double_release_001_glb_data = (double_release_001_glb_data% 100) + 1;\n\n    pthread_mutex_unlock (double_release_001_glb_mutex);\n    return NULL;\n}\n\nvoid double_release_001 ()\n{\n    pthread_t tid1;\n    pthread_mutex_init (double_release_001_glb_mutex, NULL);\n    pthread_create (&amp; tid1, NULL, double_release_001_tsk_001, NULL);\n    pthread_join (tid1, NULL);\n    pthread_mutex_destroy (double_release_001_glb_mutex);\n}\n\nvoid double_release_001_tskentry_001 ()\n{\n    while (1)\n    {\n        if (rand ())\n        {\n            double_release_001_tsk_001 (NULL);\n        }\n    }\n}\n</code></pre>\n\n<p>But when I build it I get an error saying</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Description Resource    Path    Location    Type\nundefined reference to `_imp__pthread_create'   \nundefined reference to `_imp__pthread_create'       \nundefined reference to `_imp__pthread_create'   \nundefined reference to `_imp__pthread_create'\n</code></pre>\n\n<p>I have included <code>pthread.h</code>. Can someone help me out here.</p>\n"},{"tags":["c++","c","multithreading","winapi"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":37006,"score":61,"question_id":331536,"title":"Windows threading: _beginthread vs _beginthreadex vs CreateThread C++","body":"<p>What's a better way to start a thread?</p>\n\n<p>I'm trying to determine what are the advantages/disadvantages of _beginthread, _beginthreadex and CreateThread.  All of these functions return a thread handle to a newly created thread, I already know that CreateThread provides a little extra information when an error occurs (it can be checked by calling GetLastError)... but what are some things I should consider when I'm using these functions?</p>\n\n<p>I'm working with a windows application, so cross-platform computability is already out of the question.</p>\n\n<p>I have gone through the msdn documentation and I just can't understand, for example, why anybody would decide to use _beginthread instead of CreateThread or vice versa.</p>\n\n<p>Cheers!</p>\n\n<p>Update:\nOK, thanks for all the info, I've also read in a couple of places that I can't call WaitForSingleObject() if I used _beginthread(), but if I call _endthread() in the thread shouldn't that work? What's the deal there?</p>\n"},{"tags":["c#",".net","wpf","multithreading","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12965372,"title":"BindingOperations.EnableCollectionSynchronization() equivalent for .net 4.0","body":"<p>Moved some ops into a background thread and promptly ran into the UI exception where a UI control is bound to a ObservableCollection</p>\n\n<p>.net 4.5 has this solved via the new BindingOperations.EnableCollectionSynchronization()</p>\n\n<p>however can't migrate to 4.5 yet so hoping there's something  for the .net 4.0 world to make ObservableCollection thread-safe ?</p>\n"},{"tags":["c++","multithreading","opencv","parallel-processing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":66,"score":-4,"question_id":12964481,"title":"class that could have 2 object running simultaneously","body":"<p>i have a image processing program written in c++ with opencv.\nI created a class and ran the program with one object of the class and it ran quite efficiently. So i created 2 objects of the class thinking both would run simultaneously as they have their own space and own variables within the object.\nThe problem is when i run the program only one object seems to be running at a time and not both simultaneously.\ni dont really know much about threading so how to tackle the problem?</p>\n\n<pre><code>   class Tracker{\n\npublic:\n    //all remaining functions used in track function\n    void setres(int,int);\n    Mat thresholding(Mat);\n    void track(Mat,Rect);//this is the function that i want to use for running\n    void setScalar(Scalar,Scalar);\n    Rect retrect(Rect,Rect);\n    Point retcentroid(Rect);\n    Rect resetroi(Rect,Point);\n    int check();\n    Rect getrect();\n    Point getcentroid();\n    void setname(String);\n };\n</code></pre>\n"},{"tags":["java","multithreading","swing","synchronization","event-dispatch-thread"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":70,"score":4,"question_id":12957427,"title":"JFrame calling multiple concurrent Threads that updates a JProgressBar in the caller JFrame","body":"<p>This is how the thing goes: I have a JFrame for the main window of a Java application, that contains a panel with multiple JProgressBar. I want to start a Thread for each JProgressBar that will start another Threads on their own. When any of this \"secondary\" threads finishes, I want to update the JProgressBar in my JFrame. Moreover, before arranging all this, as I don't want the user to be able to click anything on the JFrame, I also want to setEnabled(false) some buttons in the JFrame. Easy?</p>\n\n<pre><code>ActivarBotones abFalse = new ActivarBotones(false);\nabFalse.start();\ntry {\n    abFalse.join();\n} catch (InterruptedException e1) {\n    // TODO Auto-generated catch block\n    e1.printStackTrace();\n}\n\nEstablecerConexiones ec = new EstablecerConexiones();\nec.start();\ntry {\n    ec.join();\n} catch (InterruptedException e) {\n    // TODO Auto-generated catch block\n    e.printStackTrace();\n}\n\nActivarBotones abTrue = new ActivarBotones(true);\nabTrue.start();\n</code></pre>\n\n<p>Two problems.</p>\n\n<ol>\n<li><p>If I run the code from above, nothing got updated. If I only start the ec thread, everything works almost right.</p></li>\n<li><p>I don't know much about synchronization and don't know what should I do to start concurrently all the \"primary\" threads.</p></li>\n</ol>\n\n<p>Any clues?</p>\n"},{"tags":["java","multithreading","gui","task"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12860896,"title":"Updating the JavaFx Gui with threads and or Tasks","body":"<p>Hello guys, I want to warn you first that this is going to be a long post.</p>\n\n<p>I am creating a chat program that contains a GUI that i have created in the new version of the JavaFx Scene builder. I have a main method that extends application and i have a simpleController ( that controls all the buttons, labels, anchorPanes, etc) in my GUI.</p>\n\n<p>Other than that, I have a server application that can receive and send messages. For this purpose, I have created the following simple protocol:</p>\n\n<p><em><strong>Commands / Description:</em></strong></p>\n\n<ul>\n<li><p>1 - Ask for permission to connect and at the same time, ask for a user\nID (server finds out how many users are online and adds the id+1)</p></li>\n<li><p>2 - Chat, the client sends an ID and a String message (Example: 21<br>\nHello (note all of these are on a separate line))</p></li>\n<li><p>3 - Disconnects the client.</p></li>\n<li><p>4 - Shows a list of all the clients online.</p></li>\n<li><p>5 - Ask who else is online (this is only used when a user is\nconnecting and he needs to know how many users are online in order to\nupdate the GUI).</p></li>\n<li><p>10 - Error of all sorts if the server returns the 10 message it means\nthat the call the client just did was an error or that it could not<br>\nbe completed!  </p></li>\n</ul>\n\n<p>Using this simple logic, it should be fairly easy for me to make users connect, chat and disconnect. However, it turned out that what  should have been a simple task has turned out to be my worst nightmare. </p>\n\n<p>So far my users has no problem connecting to the program and more users can connect at the same time. </p>\n\n<p>Where things start to get tricky is when I want to send and receive messages between server and client.</p>\n\n<p>I do not know how I can update my GUI while using a thread. I have tried to read up on the Task class, but I am unable to see <strong>whether this should be used instead of a thread or the thread should have this as a parameter</strong>. </p>\n\n<p>Should i create a new class that listens for input and make that class extend thread?   <strong>OR</strong><br>\nShould the thread be running in my simpleController class?</p>\n\n<p>I hope someone is able to help me. I have added the code of my client classes to this project.</p>\n\n<p><strong>Main</strong></p>\n\n<pre><code>public class Main extends Application{\npublic static void main(String[] args) throws IOException{\n\n    Application.launch(Main.class, (java.lang.String[]) null);\n\n}\n\n@Override\npublic void start(Stage primaryStage) throws Exception {\n    try {\n        AnchorPane page = (AnchorPane) FXMLLoader.load(Main.class.getResource(\"testingBackground.fxml\"));\n        Scene scene = new Scene(page);\n        primaryStage.setScene(scene);\n        primaryStage.setTitle(\"Chatten\");\n        primaryStage.show();\n\n    } catch (Exception ex) {\n        java.util.logging.Logger.getLogger(Main.class.getName()).log(\n                java.util.logging.Level.SEVERE, null, ex);\n\n    }\n\n}\n</code></pre>\n\n<p>}</p>\n\n<p><strong>simpleController</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.InetAddress;\nimport java.net.Socket;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.Scanner;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.ResourceBundle;\n\nimport com.sun.glass.ui.Platform;\n\nimport javafx.beans.value.ChangeListener;\nimport javafx.beans.value.ObservableValue;\nimport javafx.concurrent.Task;\nimport javafx.event.ActionEvent;\nimport javafx.event.EventHandler;\nimport javafx.fxml.Initializable;\nimport javafx.scene.control.Button;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.TextArea;\nimport javafx.scene.control.TextField;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.layout.AnchorPane;\nimport javafx.scene.text.Text;\n\n/*\n * evt ret array listen med commands da jeg selv kan styre hvilke commands der kommer ind og ud! og brugeren faktisk\n * aldrig selv kan vælge!\n */\npublic class SimpleController extends Thread implements Initializable{\n    public Button btn_Connect;\n    public AnchorPane pictureFrame;\n    public Socket socket = new Socket();\n    public PrintWriter pw;\n    public Scanner input;\n    public int clientId = 1;\n    public Client client = new Client(socket, pw, input, clientId);\n    // options!\n    public TextField txt_userName;\n    public TextField textField_chat;\n    // send button\n    public Button Send;\n    /*\n     * current client that the user i connected with, this client is used to send commands and tell other clients who is connected on\n     * what \"ingame chat persons\"\n     */\n    public static int currentClientId;\n    // chatperson username\n    public Label lbl_userName2;\n    public Label lbl_userName3;\n    public Label lbl_chatPerson2;\n    public Label lbl_Chatperson1_userName;\n    //Pictures of chat person\n    public Label chatPerson3;\n    public Label chatPerson1;\n    // chat persons textfield\n    public TextArea txt_ChatPerson1;\n    //public TextField txt_ChatPerson1;\n    public TextField txt_ChatPerson2;\n    public TextField txt_ChatPerson3;\n\n\n    @Override\n    public void initialize(URL location, ResourceBundle resources) throws NullPointerException {\n        try {\n            client.connect();\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n        pictureFrame.setMaxSize(409, 373);\n        txt_ChatPerson1.setMinWidth(50);\n        txt_ChatPerson1.setPrefWidth(50);\n        txt_ChatPerson1.setMaxWidth(300);\n        txt_ChatPerson1.setText(\"         \");\n\n\n\n        btn_Connect.setOnAction(new EventHandler&lt;ActionEvent&gt;() {   \n            @Override\n\n            public void handle(ActionEvent event) throws NullPointerException {\n                connectMeWithOthers(1);\n            }\n        });\n\n\n        Send.setOnAction(new EventHandler&lt;ActionEvent&gt;() {\n\n            // WORK IN PROGReSS!!\n            @Override\n            public void handle(ActionEvent event) {\n\n                /*\n                 * new line code:\n                 */\n                String x = textField_chat.getText();\n                txt_ChatPerson1.setText(x);\n                txt_ChatPerson1.setVisible(true);\n                System.out.println(\"x\" +x);\n\n                txt_ChatPerson1.textProperty().addListener(new ChangeListener&lt;String&gt;() {\n\n                    @Override\n                    public void changed(\n                            ObservableValue&lt;? extends String&gt; observable,\n                            String oldValue, String newValue) {\n\n\n                        //  txt_ChatPerson1.setPrefRowCount(5);\n                        txt_ChatPerson1.setPrefWidth(txt_ChatPerson1.getText().length()*7);\n                        //txt_ChatPerson1.setPrefHeight(txt_ChatPerson1.getText().length()*3);\n                        // TODO Auto-generated method stub\n\n                    }\n                });\n\n                txt_ChatPerson1.autosize();\n                client.SendChat(x);\n            }\n        });\n\n\n    }\n    /**\n     * this method connect the client to the other clients who are online on the server!\n     * the method calls it self after the user has established connection in order to load the other chat persons online\n     * if the client is the online user online then it will only load the user\n     * @param id\n     */\n    protected void connectMeWithOthers(int id) {\n        try {\n            int responseId = client.sendCommando(id);\n            System.out.println(\" response id \"+responseId);\n            // finds whom is connected and tries to connect to a spot that is avalibul!\n            //Response is the ID of the chat persons\n            switch (responseId) {\n            case 1:\n                currentClientId = client.reciveCommando();\n                client.setClientId(currentClientId);\n                client.sendString(txt_userName.getText());\n                connectMeWithOthers(5);\n                break;  \n            case 5:\n                int times = client.reciveCommando();\n                int o = 0;\n                System.out.println(\"times: \"+times);\n\n                while (o != times) {\n                    int j = client.reciveCommando();\n                    System.out.println(\"j\"+ j);\n                    String name = client.reciveString();\n                    System.out.println(\"Name \" +name);\n                    createUser(j, name);    \n                    o++;\n                }\n                start();\n                break;\n\n            case 10:\n                System.out.println(\"Connection fail chat room is full! Please try again later!\");\n\n            case 8:\n                start();\n                break;\n            default:\n                break;\n            }\n\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n\n    }\n    private void createUser(int j, String reciveChat) {\n        if (j == 1) {\n            chatPerson1.setVisible(true);\n            lbl_Chatperson1_userName.setVisible(true);\n            lbl_Chatperson1_userName.setText(reciveChat);\n\n        }else if (j == 2) {\n            lbl_chatPerson2.setVisible(true);\n            lbl_userName2.setVisible(true);\n            lbl_userName2.setText(reciveChat);\n        }else if (j == 3){\n            chatPerson3.setVisible(true);\n            lbl_userName3.setVisible(true);\n            lbl_userName3.setText(reciveChat);\n        }else {\n            Image img = new Image(getClass().getResourceAsStream(\"Figur.png\"));\n            Label test2 = new Label(\"\", new ImageView(img));\n            test2.setLayoutX(50);\n            test2.setLayoutY(30);\n            test2.setPrefSize(1000, 1000);\n            pictureFrame.getChildren().addAll(test2);\n            test2.setVisible(true);\n        }\n\n    }\n    /*\n     * denne metode er en rewrite af run metoden.\n     */\n    public void StartClient(){\n        ClientListner cl = new ClientListner(client);\n\n        Task task = new Task&lt;String&gt;() {\n\n            @Override\n            protected String call() throws Exception {\n                // TODO Auto-generated method stub\n\n                return null;\n            }\n        };\n        Thread t = new Thread(task);\n        cl.start();\n        while (true) {\n            if (cl.recived) {\n\n            }\n        }\n    }\n\n    /*\n     * Run metoden er brugt til at recive data fra andre users og update GUI'en skal muligvis rewrites!?\n     * \n     */\n\n\n    public void run(){ \n        System.out.println(\"Thread started\");\n        System.out.println(client.getSocket().isConnected());\n        ClientListner cl = new ClientListner(client);\n        while (client.getSocket().isConnected()) {\n            int key = 10;\n            if (cl.recived) {\n\n                try {\n                    key = client.reciveCommando();\n                    System.out.println(\"jeg er her\");\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n\n\n            System.out.println(\"Key \"+key);\n            switch (key) {\n            // case 2 er recive chat:\n            case 2:\n                // først find ud af hvilket ID der har sendt chatten:\n                int y = 0;\n                try {\n                    y = client.reciveCommando();\n                    System.out.println(\"y\" + y); \n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n                // derefter få beskeden og send den så ud til resten.\n                String says = client.reciveChat().toString();\n                if (y == 1) {\n                    txt_ChatPerson1.setText(client.reciveChat());\n                }else if (y == 2) {\n\n                }else {\n                    chatPerson3.setVisible(true);\n                    txt_ChatPerson3.setVisible(true);\n                    txt_ChatPerson3.setText(client.reciveChat());\n                }\n\n                break;\n\n            default:\n                break;\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p><strong>Client</strong></p>\n\n<pre><code>*\n\nimport java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.InetAddress;\nimport java.net.Socket;\nimport java.util.Scanner;\npublic class Client {\n// disse var static\n    public final static int portNumber = 6040;\n    public Socket socket;\n    private PrintWriter pw;\n    private Scanner input;\n    private int clientId;\n    /**\n     * @param args\n     * @throws IOException \n     */\n\n    public Client(Socket socket, PrintWriter pw, Scanner input, int clientId){\n        this.socket = socket;\n        this.pw = pw;\n        this.input = input;\n        this.clientId = clientId;\n    }\n    public void connect() throws IOException{\n        // du kan vælge at bruge inetadressen til at connecte i socketet.\n        InetAddress adr = InetAddress.getByName(\"localhost\");\n        socket = new Socket(\"localhost\", portNumber);\n        input=new Scanner(socket.getInputStream());\n        pw = new PrintWriter(socket.getOutputStream());\n    }\n    /**\n     * This method sends the message (that the client(chat person) writes to the user)\n     * @param x\n     * @throws NullPointerException\n     * @throws IOException \n     */\n    public void SendChat(String x) throws NullPointerException{\n            pw.println(2);\n            pw.flush();\n            pw.println(SimpleController.currentClientId);\n            pw.flush();\n            pw.println(x);\n            pw.flush(); \n\n    }\n    public int sendCommando(int id) throws IOException{\n        System.out.println(\"Jeg sender\"+ id);\n        pw.println(id);\n        pw.flush();\n        /*\n         * this part of the program sends a command to the server if the command is 1 then 1 is = Connect.\n         * the program then ask the server is the server is full or is it ok to connect? \n         * if the response is not 10 then the program will allow a connection to happen the return type will be the Id of which \n         * the chat person becomes!\n         */\n        // should the method return 0 the Application will do NOTHING!\n        switch (id) {\n        case 1:\n    int k = reciveCommando();\n            if (k== 10) {\n                return 10;\n            }else if (k &lt; 3) {\n                System.out.println(\"returned k\" + k);\n                return k;\n            }else {\n\n            return 10;\n            }\n            /*\n             * Closes the connection with the server!\n             */\n        case 3:\n\n            socket.close();\n            return 0;\n\n        case 5:\n            int y  = reciveCommando();\n            return y;\n        default:\n            return 0;\n        }\n\n    }\n    /*\n     * this method recives a command from the server! the comands can be found in the ChatCommands.txt\n     * returns the command as an integer!\n     */\n    public int reciveCommando() throws IOException{\n        Integer i = input.nextInt();\n        return i;\n    }\n    /**\n     * Gets a String response from the server. This method i used to create other users and give them the correct username.\n     * \n     * @param i\n     * @return\n     * @throws IOException\n     */\n    public String getStringResponse(int i) throws IOException {\n        pw.print(i);\n        pw.flush();\n        String x = input.nextLine();\n        return x;\n\n    }\n    /*\n     * Work in progress - client getter og setter methoder!\n     */\n\n    public Socket getSocket(){\n        return socket;\n    }\n    public Scanner getInput(){\n        return input;\n    }\n    public PrintWriter getPw(){\n        return pw;\n    }\n    public int getClientId(){\n        return clientId;\n    }\n\n    public void setClientId(int i ){\n        clientId = i;\n    }\n    public String reciveChat(){\n        String x = getInput().next();\n        return x;\n    }\n    public String reciveString(){\n        String x =input.next();\n        return x;\n    }\n    public void sendString(String x){\n        pw.println(x);\n        pw.flush();\n    }\n\n}*\n</code></pre>\n\n<p>I am really sorry about the code being kind of messy. The run() method in the simple controller was an attempt to make a thread of the simpleController. However, this did not work as I expected. :(</p>\n\n<p>The main goal of this is basically to make sure that the two people in the chat room can chat together. So, all it has to do is update 1 or 2 textareas.</p>\n"},{"tags":["ios","multithreading","nsthread","nstask","nsrunloop"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12964473,"title":"understanding Multithreading in iOS","body":"<p>I am trying to understand Multitrading in more detail on iOS. I went through some of the cleass references like NSThread, NSRunLoop, NSTask..</p>\n\n<p>first of all as indicated on the following link:\n<a href=\"http://stackoverflow.com/questions/9304253/use-of-nsrunloop-for-avoiding-event-driven-code\">use of runloop</a></p>\n\n<p>Runloop runs with in a Thread. </p>\n\n<p>So why we need to define our own Runloop in our app? in the case of NSThread it is useful because some of time consuming processes can run in a separate thread so that the app will still be responsive in the main Thread.</p>\n"},{"tags":["multithreading","shell","unix","scripting","bash4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12878293,"title":"Multithread Variable Creation in BASH","body":"<p>How can variable creation be multithreaded in BASH scripts? For example, if a script contains the two lines below, then how can they be executed at the same time?</p>\n\n<pre><code> export BOTSUBSTITUTIONS=$(less --buffers=-1 ./conf/substitutions.xml)\n export BOTPROPERTIES=$(less --buffers=-1 ./conf/startup.xml)\n</code></pre>\n\n<p>This example below does not work.</p>\n\n<pre><code>export BOTSUBSTITUTIONS=$(less --buffers=-1 ./conf/substitutions.xml) &amp;\nexport BOTPROPERTIES=$(less --buffers=-1 ./conf/startup.xml) &amp;\nwait\n</code></pre>\n"},{"tags":["android","multithreading","sqlite","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12963572,"title":"Android Sqlite handler in separate thread?","body":"<p>My app requires high data throughput.  It receives an incoming data stream over bluetooth and has to parse it, scale it, display it, and store the data.</p>\n\n<p>After reading up on different storage methods, I've decided to try to use Sqlite for data storage.  I've read up and it seems to get the best write performance, I should use transactions.  </p>\n\n<p>But before I even go there, I'm wondering if the DB handler should just be in it's own thread. The BT data processing is already in a separate thread and works well. I see a lot of discussions about accessing sqlite from multiple threads, but I'm thinking I want one thread handling the DB connection and just use intents to get/store data..mostly just to disconnect the display from the data storage.  </p>\n\n<p>Will this increase my performance, or is it not worth it?</p>\n\n<p>I'm guessing I'll be writing 20-50 rows a second with up to 19 fields.</p>\n"},{"tags":["objective-c","ios","multithreading","nsoperation","nsoperationqueue"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12961858,"title":"Adding NSOperation dependencies to operations already in an NSOperationQueue","body":"<p>I want to implement some background network requests using an <code>NSOperationQueue</code>. I have a couple of different requests that would be added to the queue by different parts of the code, and one of these will run more regularly than the other. </p>\n\n<p>I already implement this using GCD so I have blocks of code, therefore I was planning to simply use the <code>NSBlockOperation</code> method <code>blockOperationWithBlock:^{...}</code> and not create sub classes of <code>NSOperation</code>.  </p>\n\n<p>This problem is that I would like to create a dependency between the requests. If the queue already has an <code>NSBlockOperation</code> for requestA then I want to add a dependency to it when I create <code>NSBlockOperation</code> for requestB. This is trivial when creating the operations at the same time, but I can't find an easy way to determine what operations already exist in the queue.</p>\n\n<p><code>NSOperationQueue</code> has an <code>operations</code> property, so I can retrieve a list of the operations themselves, but how do I determine which operation is which? I don't see a name/description property that I can use.</p>\n\n<p>The options I can think of are:</p>\n\n<ol>\n<li>Subclass <code>NSOperation</code> to create custom objects for each request type, then use introspection on the objects retrieved from the <code>operations</code> property</li>\n<li>Subclass <code>NSBlockOperation</code> and add a description property</li>\n</ol>\n\n<p>Am I missing some other obvious way to do this?</p>\n"},{"tags":["java","multithreading","swing","concurrency","event-dispatch-thread"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12960818,"title":"4 threads adds to one jlist","body":"<p>In my program there are 4 threads that addElemets to a model of a jlist at the same time. This causes jlist to blink, throw excpetions or even crash, because of the too many updates or repaints.</p>\n\n<p>I tried to put some delay that fixed my problem but I was losing to much precious time.</p>\n\n<p>What can I do?</p>\n\n<p>this code simulates my problem:</p>\n\n<pre><code>new Thread(new Runnable() {\n    @Override\n    public void run() {\n        for(int i=0; i&lt;4; i++){\n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    for(int o=0; o&lt;2000; o++){\n                        model.addElement(\"add\");\n                        try {\n                            Thread.sleep(100);\n                        } catch (InterruptedException ex) {\n                            Logger.getLogger(NewJFrame.class.getName()).log(Level.SEVERE, null, ex);\n                        }\n                    }\n                }\n            }).start();\n        }\n   }\n}).start();\n</code></pre>\n"},{"tags":["java","multithreading","performance","parallel-processing","fork-join"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":122,"score":2,"question_id":11809652,"title":"Performance problems using new fork join framework of jdk 7","body":"<p>I'm using the new forkjoin framework of jdk 7.\nI got a task, which has to be performed multiple times with different parameters.</p>\n\n<p>This task extends <code>RecursiveTask</code>. there are more than 100 tasks to perform, which can performed concurrently. the tasks are independent, so there should be no need for any synchronisation. \nTherefore I created at first the needed tasks and passed them to forkjoin thread pool.\nbut the application becomes slower, than running it without any parallelism.</p>\n\n<p>My first thought was, that i create to much threads..  Thats why i tried to recycle the threads to reduce object creation overhead, but this has no effect on the performance. for recycling im using the reinitialize() method. Also with recycling the performance is slower than running it without any parallelism.</p>\n\n<p>The operations performed in the tasks are not trivial, the duration of running threads are from 5 to 150 ms.   The application runs on a dualcore machine and im using ubuntu and oracle jdk 7.</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12954379,"title":"Synchronization output streams from different threads","body":"<p>I'm writing an app that writes to xml file some data from different threads. I try to synchronized it using Event core object, but in file I get wrong data. I get next result </p>\n\n<pre><code>&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" &lt;file path=\"somePath\" /&gt; /&gt;....\n</code></pre>\n\n<p>but I expect to get </p>\n\n<pre><code>&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" /&gt;\n&lt;file path=\"somePath\" /&gt;\n</code></pre>\n\n<p>See below my pseudo code. What wrong in it?</p>\n\n<pre><code>unsigned int WINAPI MyThread(void *p)\n{\n    std::wofstream outstr;\n    outstr.open(\"indexingtest.xml\", std::ios::app);\n    do\n    {\n        if(somePredicat1)\n        {\n            WaitForSingleObject(hEvent, INFINITE);\n            outstr &lt;&lt;\"&lt;file path=\\\"\"&lt;&lt; sFileName &lt;&lt; \"\\\"\\n\";\n            outstr &lt;&lt;\"\\tsize=\\\"\"&lt;&lt; fileSize &lt;&lt; \"\\\" /&gt;\\n\";           \n            ReleaseMutex(hMutex);\n        }\n         if(somePredicat3)\n         {\n             MyThread(sFileName);\n         }\n    }while(somePredicat2);\n    outstr.close();\n    FindClose( hSearch );\n    return 0;\n}\n\nint _tmain(int argc, TCHAR *argv[])\n{\n    hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n    //hMutex = CreateMutex(NULL, FALSE, 0);\n    unsigned int ThreadID;\n    HANDLE hThread1 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"D:\\\\*\", 0, &amp;ThreadID);\n    HANDLE hThread2 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"C:\\\\*\", 0, &amp;ThreadID);\n    SetEvent(hEvent);\n    std::wcout &lt;&lt; \"\\a\" &lt;&lt; std::endl;\n    WaitForSingleObject( hThread1, INFINITE );\n    return 0;\n}\n</code></pre>\n\n<p>More concrete code</p>\n\n<pre><code>HANDLE hMutex = CreateMutex(NULL,FALSE, 0);\nwchar_t** GetAllFilesImpl( wchar_t const* folder, wchar_t** res, size_t* pAllocated, size_t* pUsed )\n{\n    HANDLE hSearch;\n    WIN32_FIND_DATAW fileinfo;\n    size_t allocatedMemory = 0;\n\n\n    hSearch = FindFirstFileW( folder, &amp;fileinfo );\n    if( hSearch != INVALID_HANDLE_VALUE ) {\n        do {\n\n            wchar_t* sFileName, ** tmp, sTmp[ 1024 ];\n            long fileSize = 0;\n            long creationDate;\n            /* ignore ., .. */\n            if( !wcscmp(fileinfo.cFileName, L\".\") ||\n                !wcscmp(fileinfo.cFileName, L\"..\") )\n                continue;\n            sFileName = PathCreator( folder, fileinfo.cFileName );\n            fileSize = fileinfo.nFileSizeLow;\n            creationDate = fileinfo.ftCreationTime.dwHighDateTime;\n\n\n            if(fileSize)\n            {\n                WaitForSingleObject(hMutex, INFINITE);\n                std::wofstream outstr;\n                            outstr.open(\"indexingtest.xml\", std::ios::app);\n                outstr.seekp(std::ios_base::end);\n                outstr &lt;&lt;\"&lt;file path=\\\"\"&lt;&lt; sFileName &lt;&lt; \"\\\"\\n\";\n                outstr &lt;&lt;\"\\tsize=\\\"\"&lt;&lt; fileSize &lt;&lt; \"\\\" /&gt;\\n\";\n                outstr.seekp(std::ios_base::end);\n                outstr.close();\n                wprintf( L\"%s\\n\", sFileName);\n                ReleaseMutex(hMutex);\n            }\n\n            tmp = AddToArray( res, pAllocated, pUsed, sFileName );\n            if( !tmp ) return FreeAllFilesMemory(res), NULL;\n            res = tmp;\n\n            if( fileinfo.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY ) {\n                wcscpy_s( sTmp, sFileName );\n                wcscat_s( sTmp, L\"\\\\*\" );\n                tmp = GetAllFilesImpl( sTmp, res, pAllocated, pUsed );\n                if( !tmp ) return NULL;\n                res = tmp;\n            }\n        } while( FindNextFileW(hSearch, &amp;fileinfo) );\n\n        FindClose( hSearch );\n    }\n    return res;\n}\n\nunsigned int WINAPI GetAllFiles( void* folder )\n{\n    size_t nAllocated = 0, nUsed = 0;\n    wchar_t** res = GetAllFilesImpl( (wchar_t *)folder, NULL, &amp;nAllocated, &amp;nUsed );\n    if( res ) {\n        /* to indicate end of result add a NULL string */\n        wchar_t** tmp = AddToArray( res, &amp;nAllocated, &amp;nUsed, NULL );\n        if( !tmp ) return FreeAllFilesMemory(res), -1;\n        res = tmp;\n    }\n    std::wcout &lt;&lt; \"\\a\" &lt;&lt; std::endl;\n    return 0;\n}\nint _tmain(int argc, TCHAR *argv[])\n{\n\n    Sleep(1000);\n    unsigned int ThreadID;\n    HANDLE hThreads[3];\n    hThreads[0] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"D:\\\\*\", 0, &amp;ThreadID);\n    hThreads[1] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"C:\\\\Users\\\\Andrew\\\\Desktop\\\\*\", 0, &amp;ThreadID);\n    hThreads[2] = (HANDLE)_beginthreadex(NULL, 0, GetAllFiles, L\"E:\\\\*\", 0, &amp;ThreadID);\n    unsigned int dw = WaitForMultipleObjects(3, hThreads, TRUE, INFINITE);\n    CloseHandle(hFile);\n    printf(\"finished\\n\");\n    return 0;\n}\n</code></pre>\n"},{"tags":["ruby-on-rails","ruby","multithreading","performance"],"answer_count":2,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":602,"score":7,"question_id":5426540,"title":"How to speed up the processing of a large CSV using ruby","body":"<p>For a project I need to parse some pretty large CSV files. The contents of some of the entries is stored in a MySQL database. I am trying to speed this up using multithreading, but up to now this only slows things down.</p>\n\n<p>I parse a CSV file (up to 10GB), and some of these records (aprox. 5M out of a 20M+ record CSV) need to be inserted into a MySQL database. To determine which record needs to be inserted we use a Redis server with sets that contain the correct id's / references.</p>\n\n<p>Since we process around 30 of these files at any given time, and there are some dependencies, we store each file on a Resque queue and have multiple servers handling these (prioritized) queues.</p>\n\n<p>In a nutshell:</p>\n\n<pre><code>class Worker\n  def self.perform(file)\n    CsvParser.each(file) do |line|\n      next unless check_line_with_redis(line)\n      a = ObjectA.find_or_initialize_by_reference(line[:reference])\n      a.object_bs.destroy_all\n      a.update_attributes(line)\n    end\n  end\n</code></pre>\n\n<p>This works, scales nice horizontally (more CSV files = more servers), but larger CSV files pose a problem. We currently have files that take over 75 hours to parse this way. There are a number of optimizations I thought of already:</p>\n\n<p>One is cutting down on the MySQL queries; we instantiate AR objects while an insert with plain SQL, if we know the objects Id, is much faster. This way we can probably get rid of most of AR and maybe even Rails to remove overhead this way. We can't use a plain MySQL load data since we have to map the CSVs records to other entities that might have different Ids by now (we combine a dozen legacy databases into a new database).</p>\n\n<p>The other is trying to do more in the same time. There is some IO wait time, network wait time for both Redis and MySQL, and even while MRI uses green threads this might allow us to schedule our MySQL queries at the same time as the IO reads etc. But using the following code:</p>\n\n<pre><code>class Worker\n  def self.perform(file)\n    CsvParser.each(file) do |line|\n      next unless check_line_with_redis(line)\n      create_or_join_thread(line) do |myLine|\n        a = ObjectA.find_or_initialize_by_reference(myLine[:reference])\n        a.object_bs.destroy_all\n        a.update_attributes(myLine)\n      end\n    end\n\n    def self.create_or_join_thread(line)\n      @thread.join if @thread.present?\n      @thread = Thread.new(line) do |myLine|\n        yield myLine\n      end\n    end\n  end\n</code></pre>\n\n<p>This slowly slows down the process. When I <code>ps au</code> it starts off at 100% CPU, but as time progresses it goes down to just 2-3%. At that moment it does not insert new records at all, it just appears to hang.</p>\n\n<p>I have <code>strace</code>d the process, and at first I see MySQL queries pass by, after a while it appears it is not executing my ruby code at all. Could be a deadlock (it hung after parsing the <em>last</em> line of the CSV, but the process kept on running at 5% CPU and did not quit), or something I read here: <a href=\"http://timetobleed.com/ruby-threading-bugfix-small-fix-goes-a-long-way/\" rel=\"nofollow\">http://timetobleed.com/ruby-threading-bugfix-small-fix-goes-a-long-way/</a></p>\n\n<p>I am using Rails 2.3.8, REE, 1.8.7-2010.02 on Ubuntu 10.10. Any insights on how to handle large numbers of threads (or maybe why not to use threads here at all) is greatly appreciated!</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12962538,"title":"check and process once in n sec using java","body":"<p>I have a requirement in which I have to check whether any file exists in the folder. If yes, then I need to process it one by one. With my basic knowledge I have arrived to a code structure which I have posted below. </p>\n\n<p>I'm creating an infinite loop and checking whether the file exists in that folder. If yes, then I'm creating a thread and processing it, else it waits for a min and checks again.</p>\n\n<pre><code>class sample {    \n    synchronized int getNoOfFiles() {\n        // get number of files in the folder\n    }    \n    synchronized void openFile() {\n        // open one file\n    }\n    synchronized void getFileContents() {\n        // get the file content\n    }\n    synchronized void processFileContent() {\n        //performing some operation on file contents\n    }    \n    synchronized void closeFile() {\n        //closing the file\n    }    \n    synchronized void deleteFile() {\n        //delete the file\n    }\n\n}    \nclass Test {    \n    public static void main(String args[]) {\n        int flag=0;\n        Sample obj = new Sample();\n        while(1) {\n            flag = obj.getNoOfFiles();    \n            if(flag) {\n                for(i=0;i&lt;flag;i++) {\n                    MyThread1 t1 = new MyThread1() {\n                        public void run() {\n                            obj.openFile();\n                            obj.getFileContents();\n                            obj.processFileContent();\n                            obj.closeFile();\n                            obj.deleteFile();\n                        }\n                    };    \n                    t1.start();\n                }\n            }\n            else {\n                try {\n                    Thread.sleep(60000);\n                }\n            }    \n        }\n    }    \n}\n</code></pre>\n"},{"tags":["c#","multithreading","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1156,"score":4,"question_id":1696096,"title":"Replacing ReaderWriterLock with ReaderWriterLockSLim - troubles","body":"<p>due to performance problems I have replaced RWL with RWLSlim but I am experiencing troubles caused by previously (with RWL) accepted statements.</p>\n\n<p>As you can see, sometimes methodA calls another one which have inside ReadLock. The second method is also called from different places, so not always there is lock collision. Previously, AcquiringRead lock doesn't cause that problem. Is there any solution except from placing \"if IsRWheld\"?\nThanks</p>\n\n<p>The problem is something like that:</p>\n\n<pre><code>       class a\n        {\n    methodA()\n    {\n        RWLSlimObject.TryEnterWriteLock(-1);\n        LockedList.Add(someItem)\n        methodX();\n        RWLSlimObject.ExitWriteLock();\n    }\n\n        methodX()\n        {\n        RWLSlimObject.TryEnterReadLock(-1);\n        //some stuff with LockedList      //if called from method A, it will throw an exc.    \nRWLSlimObject.ExitReadLock();\n        }\n\n    }\n</code></pre>\n"},{"tags":["android","multithreading","android-service","android-notifications","android-notification-bar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12927600,"title":"Android Service Multiple Threads and startForeground()","body":"<p>I have a <code>Service</code> that facilitates the downloading of files from a server. Everytime an <code>Intent</code> is received in <code>onStartCommand</code>, I start a new <code>Thread</code>, put the <code>Thread</code> into a map with the url being downloaded as the key, and create a notification to show the progress of the download. If there are no <code>Thread</code>s in the map, a flag is set in the <code>Thread</code> that signifies that it should use <code>startForeground</code> when the <code>Notification</code>is being created or updated. Subsequent <code>Thread</code>s/<code>Notification</code>s are show using <code>NotificationManager.notify</code> with the <code>FLAG_AUTO_CANCEL</code> off and the <code>FLAG_ONGOING_EVENT</code> on. Each <code>Thread</code> has its own unique id that is sent to <code>startForeground</code> or <code>notify</code>. When the file is finished downloading, or the user cancels the download (by pressing a button in the <code>Notification</code>'s <code>RemoteView</code>, if it is the \"foreground thread/notification,\" <code>stopForeground(true)</code> is called, the <code>Notification</code> is populated with a new <code>RemoteView</code> that shows whether the download completed or not, and the next running <code>Thread</code> has its \"foreground\" flag set to <code>true</code>.</p>\n\n<p>The problem is, if I have, let's say, two files downloading, there will be one <code>Notification</code>/<code>Thread</code> that is connected to <code>startForeground</code> and one that is not. If I cancel the \"foreground\" one, everything is fine. However, if I press the cancel button on the non-foreground one, the foreground one is dismissed (and pressing the cancel button again will then dismiss the proper one). If I don't cancel any, and I start a 3rd download that completes before the others, the completed <code>Notification</code> shows, but the other two that are still going start to blink and rapidly move up and down in the status bar.</p>\n\n<p>How do I make sure that the <code>Service</code> will always be in the foreground as long as there are downloads going on, without the notifications jumping around in the situation noted above, and with the cancelling working properly?</p>\n"},{"tags":["multithreading","blackberry","java-me","illegalstateexception"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12960414,"title":"Setting a label in a thread causes IllegalStateException","body":"<p>I have a thread like:</p>\n\n<pre><code>    startButton.setChangeListener(new FieldChangeListener() {\n        public void fieldChanged(Field arg0, int arg1) {\n\n                    Thread thread = new Thread(){\n                        public void run() {\n                            uploadFile();\n                        }\n                    };\n                    thread.start();\n                }\n            //});\n\n    });\n</code></pre>\n\n<p>The <code>uploadFile</code> method contains the line <code>label_up_result.setText(result);</code> which causes an <code>IllegalStateException</code>.</p>\n\n<p><code>label_up_result</code> is defined like: <code>final LabelField label_up_result=new LabelField(\"\", LabelField.FIELD_LEFT);</code></p>\n\n<p>What can be the problem ? How can I fix it ?</p>\n"},{"tags":["python","multithreading","tornado","suds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12961106,"title":"Passing data between threads in Python","body":"<p>I have a Tornado web server running several web services. I need one of the operations in Service A to call an operation on Service B. I'm using Suds to make this call to Service B. At the moment everything hangs unless I put the Suds call into a separate thread, but now I need to get data from that call (in Thread 1) back into the main thread so I can send it back to the original requesting web service (Service A). Some code:</p>\n\n<pre><code>if input.payment_info.issuer == 'Amex':\n    def t1():\n        url = 'http://localhost:8080/PaymentService?wsdl'\n        client = Client(url)\n        result = client.service.process_amex(payment_info.issuer, payment_info.number, payment_info.sort_code)\n\n    t = Thread(target=t1)\n    t.start()\n    if result == \"Success\":\n        return result #How can I access it to return it to the main service\n</code></pre>\n\n<p>Apologies if this is unclear, I know threading is a complex issue but I don't see any other options here as the code hangs without it.</p>\n\n<p>Edit: To be clear, I'm not using suds to call Service A. The only instance of suds is being used to call Service B.</p>\n\n<p>I've also tried using a Queue as per Alex Martelli's post here (http://stackoverflow.com/a/2846697/559504) but it hangs again.</p>\n\n<pre><code>if input.payment_info.issuer == 'Amex':\n        def t1(q):\n            url = 'http://localhost:8080/PaymentService?wsdl'\n            client = Client(url)\n            result = client.service.process_amex(payment_info.issuer, payment_info.number, payment_info.sort_code)\n            q.put(result)\n        q = Queue.Queue()\n        t = Thread(target=t1, args=(q))\n        t.daemon = True\n        t.start()\n        result = q.get()\n        if result == \"Success\":\n            return \"Success\"\n</code></pre>\n"},{"tags":["java","multithreading","methods","concurrency","executorservice"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12961028,"title":"How to return two different types of values from a method?","body":"<p>I need to return two different types of variables (Future , ExecutorService) from a method. How can I move along?? here is the piece of code..\nI have a class A and I m trying to call the run() method in 'B' class. 'startExecutorService' is the method which starts the threadExecutor and \n'stopExecutorService' is the method which stops the threadExecutor</p>\n\n<pre><code> public class A{\n    public static void main(String[] args){\n\n        A AObj= new A();\n\n        Future&lt;?&gt; task = null;\n        ExecutorService threadexec = null;\n\n        task = AObj.startExecutorService(task, threadexec);\n\n        AObj.stopExecutorService(task, threadexec);\n\n    }\n\n    public Future&lt;?&gt; startExecutorService(Future&lt;?&gt; control, ExecutorService threadExecutor){\n\n        //'noOfThreads' determines the total no of threads to be created in threadpool\n        int noOfThreads = 1;  \n\n        // Creating an object for class 'B' which has the run() method\n        B ThreadTaskOne   = new ExecutorServiceThreadClass();\n\n        // Calling the ExecutorService to create Threadpool with specified number of threads\n        threadExecutor = Executors.newFixedThreadPool(noOfThreads);\n\n        // Creating a Future object 'control' and thereby starting the thread 'ThreadTaskOne' \n         control = threadExecutor.submit(ThreadTaskOne);    \n\n         return control;\n    }\n\n    public void stopExecutorService(Future&lt;?&gt; task, ExecutorService threadExecutor){\n\n        // Interrupting the thread created by threadExecutor\n        task.cancel(true);\n\n        if(task.isCancelled()){\n            System.out.println(\"Task has been cancelled !!\");\n        }\n\n        // Closing the threadExecutor\n        threadExecutor.shutdownNow();\n\n    }\n\n}\n</code></pre>\n\n<p>I m getting ' NullPointerException' at 'stopExecutorService' method in line 'threadExecutor.shutdownNow();'The reason for this error is because,\nthe threadExecutor value is unchanged in main method.. it has changed only in 'startExecutorService' method. So I want to return the changed value\nof threadExecutor back to main method, along with the Future.. </p>\n\n<p>Kindly help me out</p>\n"},{"tags":["android","multithreading","caching","animation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12726660,"title":"Android animation reduce stutter/choppy/lag","body":"<p>So I've been having animation issues especially when two animations happen at once or right when an activity loads. I understand it's probably a resource problem and a lot of things are going on in the main thread causing the animations to stutter.</p>\n\n<p>I've found a couple interesting suggestions:<br>\n1. Threads (ThreadPoolExecutor)<br>\n<strong>Here:</strong> <a href=\"http://stackoverflow.com/questions/8976039/how-do-i-make-my-animation-smoother-android\">How do I make my animation smoother Android</a><br>\n2. setDrawingCacheEnabled(true)<bR>\n<strong>Here:</strong> <a href=\"http://stackoverflow.com/questions/7763532/how-does-androids-setdrawingcacheenabled-work\">How does Android&#39;s setDrawingCacheEnabled() work?</a><br>\n3. ViewGroup: animationCache = true<br>\n<strong>Here</strong>: <a href=\"http://www.curious-creature.org/2010/12/02/android-graphics-animations-and-tips-tricks/\" rel=\"nofollow\">http://www.curious-creature.org/2010/12/02/android-graphics-animations-and-tips-tricks/</a></p>\n\n<p>However I haven't been able to find any sort of examples to implement these things. Any ideas?</p>\n"},{"tags":[".net","multithreading","clr","threadpool"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":298,"score":3,"question_id":5626803,"title":"Why is creating a new thread expensive?","body":"<p>I read lots of .Net resources telling me that I should be using a thread pool thread rather than instantiating a new thread myself.  They say you should do this because instantiating a new thread is an expensive operation.  What happens during thread creation that makes it an expensive operation?</p>\n"},{"tags":["c++","multithreading","c++11","mutex","boost-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12953984,"title":"How to make a shared_lock or upgrade_lock in standard C++11?","body":"<p>I am missing very much from the new standard the <code>std::shared_lock</code> template class.\nIn Boost.Thread there is <code>boost::shared_lock</code>, even <code>boost::upgrade_lock</code> exists.</p>\n\n<p>Why is that, there is no std::shared_lock and <code>std::unique_lock</code> in C++11? <br/>\nHow is it possible to acquire a similar behavior as <code>boost::shared_lock</code> has, but in pure C++11?</p>\n\n<p>I was thinking to use <code>boost::shared_lock&lt;std::mutex&gt;</code>, but this doesn't have so much sense, since <code>std::mutex</code> does not have a <code>lock_shared()</code> member. And also, there is no such as <code>std::shared_mutex</code>.</p>\n"},{"tags":["c#","wpf","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12946905,"title":"Windows Media Player not working correctly on a new thread","body":"<p>I have made a Music class as follows : </p>\n\n<pre><code>public class Music\n{\n    public void StartMusic()\n    {                        \n        WMPLib.WindowsMediaPlayer wplayer = new WMPLib.WindowsMediaPlayer();\n        wplayer.URL = \"Resources/music3.MID\";\n        wplayer.controls.play();                            \n    }\n}\n</code></pre>\n\n<p>On the Main Screen, I start a new thread as follows :</p>\n\n<pre><code>Music music = new Music();\nthread = new Thread( new ThreadStart(music.StartMusic));            \nthread.Start();\n</code></pre>\n\n<p>Now, the music plays as desired on starting the screen but the problem is that as soon as I interact on the UI, click a button or an expander, the music thread stops. Interestingly, if I use SoundPlayer instead of MusicPlayer, everything works OK. Here is the code for SoundPlayer :</p>\n\n<pre><code>public void StartMusic()\n{\n    SoundPlayer sound = new SoundPlayer(\"Resources/music1.wav\");\n    sound.PlayLooping();\n}\n</code></pre>\n"},{"tags":["java","multithreading","blackberry"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12959296,"title":"Thread inside invokeLater in Blackberry","body":"<p>I have a thread inside an invokeLater method in Blackberry like:</p>\n\n<pre><code>startButton.setChangeListener(new FieldChangeListener() {\npublic void fieldChanged(Field arg0, int arg1) {\n    UiApplication.getUiApplication().invokeLater(new Runnable() {\n        public void run() {\n            Thread thread = new Thread(){\n                public void run() {\n                    uploadFile();\n                }\n            };\n            thread.start();\n        }\n    });\n}\n</code></pre>\n\n<p>I have a thread because I want to run that function in the background and want to be able to do other stuff while its doing its job. What I am wondering is if this is a good approach. Do I really need the invokeLater in this case ?</p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12959714,"title":"Adding thread interruption to implementation of run()","body":"<p>This question is the culmination of a few questions leading up to it.   I just want to make sure I have everything right before I commit any changes that I've made.</p>\n\n<p>So here's what I'm working with for data structure:</p>\n\n<p>In an abstract class:</p>\n\n<pre><code>public abstract void doRun();\n\npublic void run(){\n    try{\n    while(!Thread.currentThread().isInterrupted() || hasRunBefore){\n        doRun();\n    }\n    }catch (InterruptedException e){Thread.sleep(1); System.out.println(\"Thread Interrupted: \"); e.printStackTrace(); }\n\n}\n</code></pre>\n\n<p>Then in the child classes that are implementing my abstract class:</p>\n\n<pre><code>public void doRun(){\n    doChildClassStuff();\n}\n</code></pre>\n\n<p>Then when calling these in my main class I simply do</p>\n\n<pre><code> ClassName myClass = new ClassName(constructor.list);\n ExecutorService threadPool = Executors.newFixedThreadPool(12);\n    List&lt;Future&lt;?&gt;&gt; taskList = new ArrayList&lt;Future&lt;?&gt;&gt;();\n    taskList.add(myClass);\n    for(Future future : taskList){\n        try{\n            future.get(1, TimeUnit.SECONDS);\n        }catch(CancellationException cx){ System.err.println(\"Cancellation Exception: \"); cx.printStackTrace();\n        }catch(ExecutionException ex){ System.err.println(\"Execution Exception: \");ex.printStackTrace();\n        }catch(InterruptedException ix){ System.err.println(\"Interrupted Exception: \");ix.printStackTrace();\n        }catch(TimeoutException ex) {future.cancel(true);}\n    }\n    threadPool.shutdown();\n    threadPool.awaitTermination(60, TimeUnit.SECONDS);\n    threadPool.shutdownNow();\n</code></pre>\n\n<p>and if thread.sleep() fails, that means that the thread has been interrupted and should exit.   If all the threads take over 60 seconds then they will all be sent thread.interrupt() commands from the awaitTermination, right?</p>\n\n<p>Am I completely off-base here?</p>\n"},{"tags":["c#","multithreading","threadpool","filesystemwatcher"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1982,"score":4,"question_id":2308195,"title":"After FileSystemWatcher fires - Thread Pool or Dedicated thread?","body":"<p>I am about to implement the archetypal FileSystemWatcher solution.  I have a directory to monitor for file creations, and the task of sucking up created files and inserting the into a DB.  Roughly this will involve reading and processing 6 or 7, 80 char text files that appear at a rate of 150mS in bursts that occur every couple of seconds, and rarely a 2MB binary file will also have to be processed.  This will most likely be a 24/7 process.</p>\n\n<p>From what I have read about the FileSystemWatcher object it is better to enqueue its events in one thread and then dequeue/process them in another thread.  The quandary I have right now is what would be the better creation mechanism of the thread that does the processing.  The choices I can see are:</p>\n\n<ol>\n<li><p>Each time I get a FSW event I manually create a new thread (yeah I know .. stupid architecture, but I had to say it).</p></li>\n<li><p>Throw the processing at the CLR thread pool whenever I get an FSW event</p></li>\n<li><p>On start up, create a dedicated second thread for the processing and use a producer/consumer model to handle the work. The main thread enqueues the request and the second thread dequeues it and performs the work.</p></li>\n</ol>\n\n<p>I am tending towards the third method as the preferred one as I know the work thread will always be required - and also probably more so because I have no feel for the thread pool.</p>\n"},{"tags":["java","multithreading","swing","swingworker"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":210,"score":2,"question_id":7204896,"title":"How to implement a count down timer in swing","body":"<p>I would like to know how should I implement a count down timer in swing.<br>\nI'm currently developing a net game with count down timer, and I need the Timer to be shown all the time in the corner.<br>\nThe problem is I don't know how to implement it in away that the game screen will be responsive all the time for the user in the same time the timer is on..</p>\n\n<p>1.I'm asking it because I know every update to the view is being held through the event dispatch thread but it can also freeze my game if there is something which run there consistently (like timer).</p>\n\n<p>2.Design aspect :Do you know some nice ways of how to show the timer in an attractive and maybe animated way?  </p>\n\n<p>Thank you very much in advance</p>\n"},{"tags":["java","multithreading","class","methods","main"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12958885,"title":"Java, can access external class method perfectly from Main but 'partially' from internal method?","body":"<p>I am try to access a method from a separate class from a method inside my current/main class.\nI can access the method from my main class no problem, it's when I try to access the external method from my internal method, it only partially works.</p>\n\n<p>The JFrame that's meant to be initialized, is correct in size, but is transparent, and doesn't contain the text it should (and does when called from the main of any class in the same project)</p>\n\n<p>Note: Every class here is in the same project.</p>\n\n<p>This is my class which displays a little timer in a HH:MM:SS format.</p>\n\n<pre><code>import javax.swing.JFrame;\nimport javax.swing.JLabel;\n\npublic class Timer extends Thread\n{\nTimer(){}\n\nfinal Time timeData = new Time();   \nJFrame timeGUI = gymGUI.guiFrame(\"Time\",100,100);   \nJLabel timeLabel = new JLabel();    \n\npublic void run()\n{       \n    timeGUI.add(timeLabel);\n\n    int timey = 0;\n\n    while(timey != 90)\n    {   \n        int h = timeData.hours;\n        int m = timeData.minutes;\n        int s = timeData.seconds;           \n\n        timeLabel.setText(String.format(\"%02d:%02d:%02d%n\",h,m,s));\n        timeData.timeIncrement();\n\n        System.out.format(\"%02d:%02d:%02d%n\",h,m,s);            \n\n        try\n        {\n            sleep(1000);\n        } \n        catch (InterruptedException e)\n        {                       \n            e.printStackTrace();\n            System.out.println(\"Sleep failed\");\n        }\n        timey++;\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>I made a separate class to access it for test purposes..</p>\n\n<pre><code>public class TestingTime\n{   \n     public static void main(String[] args)\n     {\n         timer timer1 = new timer();        \n         timer1.run();\n     }\n }\n</code></pre>\n\n<p>This runs the timer perfectly. </p>\n\n<p>It also runs perfectly when I run it from any location in the main of my main class.\nHowever, when I try to run it from a method in my main class..</p>\n\n<pre><code>public static void startExercise()\n{       \n    timer timer1 = new timer();\n    timer1.run();       \n}\n</code></pre>\n\n<p>The frame opens and I can get the same data printed out on the console, but instead of a solid JFrame with changing text, I get a JFrame which is the right size but conists only of a frame. It is completely transparent.</p>\n\n<p>This startExercise() method that doesn't work properly is called from inside a JList selection listener which I included below for reference.</p>\n\n<pre><code>     // Selection listener\n     eList.setSelectionMode(ListSelectionModel.SINGLE_INTERVAL_SELECTION);\n     eList.addListSelectionListener(new ListSelectionListener()\n     {                       \n         public void valueChanged(ListSelectionEvent choice)\n         {              \n            if (eList.getValueIsAdjusting() == true)  // Prints only if value has changed\n            {   \n                int intChoice = eList.getSelectedIndex();                   \n\n                 currentExercise = currentWorkout.subCompList.get(intChoice);                   \n                 System.out.println(\"Choice: \" + currentExercise.name); \n\n                 selectionMade = true;      \n\n                 // Dispose of exerciseFrame\n                 eFrame.dispose();\n\n                 startExercise();\n            }\n        }       \n     });            \n</code></pre>\n\n<p>I am just struggling to see what's going on as I am new to this GUI caper.</p>\n\n<p>Any help would be so great.</p>\n\n<p>Cheers,</p>\n\n<p>Matthew</p>\n"},{"tags":["c++","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11030817,"title":"Passing pointers to threads without being out of scope","body":"<p>I am given a pre-defined .lib files of pre-defined classes/functions.</p>\n\n<p>I will need to create a:</p>\n\n<pre><code>    Cdefined *p = new Cdefined;\n    p-&gt;Init();\n</code></pre>\n\n<p>in the main() program to init my class object before calling my thread.</p>\n\n<p>However I realised that in each of my threads, I will have to call:</p>\n\n<pre><code>    p-&gt;doProcess(); \n</code></pre>\n\n<p>to run a segment of the code, for each of the threads. </p>\n\n<p>However, this function will not work unless i call <code>p-&gt;Init()</code>.</p>\n\n<p>Since now I have at least 2 scopes of p (one created in <code>main()</code>, and N of them in N threads), how do I go about designing my thread, such that the class can be passed in without scope errors? [My constrain is that <code>p-&gt;Init()</code> has to be called in <code>main()</code>]</p>\n"},{"tags":["c#","multithreading","c#-4.0","timer","threadpool"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":80,"score":0,"question_id":12912104,"title":"Why doesn't this system.threading.timer control fires at specified time?","body":"<p>Okay, I have this <code>timer</code> control, when I start the program it runs fine, but when I maximize or minimize the form, the timer control stops working. It doesn't updates anything?\nHere's the code</p>\n\n<pre><code>public MainForm()\n        {\n            InitializeComponent();\n            var tm =\n                new System.Threading.Timer(state =&gt; statusDateTimeLabel.Text = DateTime.Now.ToLocalTime().ToString(CultureInfo.InvariantCulture), null, TimeSpan.FromMilliseconds(0),\n                TimeSpan.FromMilliseconds(1000));                \n        }\n</code></pre>\n\n<p>At times, the label doesn't even updates, and sometimes it updates. But the main problem is, when I maximize the form, and when restore it again, it stops updating the time. Can anyone please explain what am I doing wrong?  </p>\n\n<p>In case its not clear, I have this label control in status bar, and I want to show the current datetime in that label.</p>\n\n<p>Thinking that it might be because this thread might be busy doing something else, I even tried this</p>\n\n<pre><code>public MainForm()\n    {\n        InitializeComponent();\n        ThreadPool.QueueUserWorkItem(delegate(object state)\n                                         {\n                                             new System.Threading.Timer(\n                                                 stateObj =&gt;\n                                                 statusDateTimeLabel.Text =\n                                                 DateTime.Now.ToLocalTime().ToString(CultureInfo.InvariantCulture),\n                                                 null, TimeSpan.FromMilliseconds(0),\n                                                 TimeSpan.FromMilliseconds(1000));\n                                         });\n    }\n</code></pre>\n\n<p>But again this works same as above, at times it updates, and at times it doesn't, what's puzzling me is that when I maximize the form or even resize it, it stops updating?\nCan any one please help me figure out what the problem is?</p>\n"},{"tags":[".net","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":123,"score":0,"question_id":3925962,"title":"Can I wait for a specific background thread finish, then another background thread starts?","body":"<p>Can I wait for a specific background thread finish, then another background thread starts? </p>\n"},{"tags":["java","multithreading","interrupt","executor"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12955889,"title":"Can I use executorservice to kill a specific thread if it's been running for too long?","body":"<p>So far in my experiments with the executorservice I've had a lot of advice that involves using future.get, and then future.cancel in order to throw a thread interrupt which then needs to be caught in the thread, and handled there.    My question is a little different.</p>\n\n<p>Assuming that I was running a thread that simply kept track of how long things were running and if they passed by some threshold, would this be a good way to kill the executorservice and all running threads?</p>\n\n<p>Example thought process:</p>\n\n<pre><code>ExecutorService threadPool = Executors.newFixedThreadPool(12);\ntimekeeper.start();\nList&lt;Future&lt;?&gt;&gt; taskList = new ArrayList&lt;Future&lt;?&gt;&gt;();\n    for (int i = 0; i &lt; objectArray.length; i++) {\n        Future&lt;?&gt; task = threadPool.submit(new ThreadHandler(objectArray[i], i));\n        taskList.add(task);\n        Thread.sleep(500);\n    }\n\nif(timekeeper.now() &gt; 60)\n    threadpool.shutdownNow();\n}\n</code></pre>\n\n<p>Would this work?   I have no way to check since my threads fail extremely infrequently (about 1/700 runs, and only at certain hours of the day when I'm not working).</p>\n"},{"tags":["multithreading","connection-pooling","apache-commons","infinite-loop","apache-commons-dbcp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12180792,"title":"DBCP Stop Working with no Exception","body":"<p>I have a Problem with Apache Commons DBCP.\nThe pool works, but before a random time (Hours), this stop in a loop.\nI have Threads in Java, and one of them connect to DB with a Sleep of 15 Seconds.\nthis Thread, before de random time stop working, but isn't killed, and is paused waiting for a Connection in a infinite Loop.</p>\n\n<p>This is the Attachment of my DBCP  configuration:</p>\n\n<pre><code>    BasicDataSource basicDataSource = new BasicDataSource();\n    basicDataSource.setDriverClassName(_configuracion.getClassName());\n    basicDataSource.setUsername(_configuracion.getUser());\n    basicDataSource.setPassword(_configuracion.getPassword());\n    basicDataSource.setUrl(\"jdbc:mysql://\" + _configuracion.getSocket() + \"/\" +     \n    _configuracion.getNombreBd());\n\n    basicDataSource.setValidationQuery(\"SELECT 1\");\n    basicDataSource.setTestOnBorrow(true);\n    basicDataSource.setTestWhileIdle(true);\n    basicDataSource.setTestOnReturn(false);\n    basicDataSource.setTimeBetweenEvictionRunsMillis(1000 * 60 * 15);\n    basicDataSource.setMinEvictableIdleTimeMillis(1000 * 60 * 2);\n    basicDataSource.setNumTestsPerEvictionRun(10);\n\n    basicDataSource.setRemoveAbandoned(true);\n    basicDataSource.setRemoveAbandonedTimeout(60 * 60);\n\n\n    _dataSource = basicDataSource;\n</code></pre>\n\n<p>The _dataSource Atributte is a Static atributte of my Database Class and this Class is called for the Threads.</p>\n\n<pre><code>private static DataSource _dataSource;\n</code></pre>\n\n<p>I don't know if i have a problem in the DBCP Configuration.</p>\n\n<p>Please Help Me!</p>\n\n<p>EDIT: This is the code that uses DataSource.</p>\n\n<pre><code>public CachedRowSet query(String sql) {\n\nCachedRowSet datos = null;\nConnection con;\nResultSet rs;\ntry {\n    con = _dataSource.getConnection();\n    Statement sentencia = con.createStatement();\n    rs = sentencia.executeQuery(sql);\n\n    datos = new CachedRowSetImpl();\n    datos.populate(rs);\n    rs.close();\n    sentencia.close();\n    con.close();\n\n\n\n } catch (Exception ex) {\n    System.out.println(\"Error: \" + ex.getMessage());\n }\n\nreturn datos;\n</code></pre>\n\n<p>}</p>\n\n<p>I discover before the DBCP Pool Stop Working , it has a SQL Exception, this Exception was captured, but the Pool Stop Working.</p>\n"},{"tags":["java","android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":12942554,"title":"It is possible to stop a thread when the user press back key?","body":"<p>I have a method that downloads a image from internet and stores it on a bitmap. While it is downloading the image, it shows a loading dialog. The method works fine, but i want to add the functionality into my app to stop the thread (so stop the download) and dismiss the dialog if the user press the back key on the phone.</p>\n\n<pre><code>public static void getRemoteImage(final String url, final Handler handler) {\n        Thread thread = new Thread(){ \n            public void run() {\n                try {\n                    Looper.prepare();\n                    handler.sendEmptyMessage(Util.SHOW_LOADING_DIALOG);\n                    final URL aURL = new URL(url);\n                    final URLConnection conn = aURL.openConnection();\n                    conn.connect();\n                    final BufferedInputStream bis = new BufferedInputStream(conn.getInputStream());\n                    image = BitmapFactory.decodeStream(bis);\n                    bis.close();\n                    handler.sendEmptyMessage(Util.HIDE_LOADING_DIALOG); \n                    Looper.loop();  \n                }catch (Exception e) {e.printStackTrace();}\n            }\n        };\n        thread.start();\n    }\n</code></pre>\n\n<p>How can i add the functionality to stop the thread when the user press the back key on my activity? I can't find the way on google</p>\n\n<p>EDIT: this is my attempt to use Ovidiu answer, but it doesn't works :(</p>\n\n<pre><code>@Override\n    public boolean onKeyDown(int keyCode, KeyEvent event)  {\n         if (keyCode == KeyEvent.KEYCODE_BACK) {\n              dialogHandler.sendEmptyMessage(Util.HIDE_DIALOG);\n              task.cancel(true);\n              return true;            \n          }\n       return super.onKeyDown(keyCode, event);\n    }\n\n    private class DownloadTask extends AsyncTask{       \n        @Override\n        protected void onPreExecute() {\n            super.onPreExecute();\n            //INITIALIZATIONS\n        }\n\n        @Override\n        protected Object doInBackground(Object... params) {\n            try {\n                dialogHandler.sendEmptyMessage(Util.SHOW_DIALOG);\n                final URL aURL = new URL(url);\n                final URLConnection conn = aURL.openConnection();\n                conn.connect();\n                final BufferedInputStream bis = new BufferedInputStream(conn.getInputStream());\n                image = BitmapFactory.decodeStream(bis);\n                bis.close();\n                dialogHandler.sendEmptyMessage(Util.HIDE_DIALOG);   \n            }catch (Exception e) {e.printStackTrace();}\n            return null;\n        }\n\n        @Override\n        protected void onCancelled(){\n            super.onCancelled();\n            System.out.println(\"Task cancelled\");\n        }\n    }\n</code></pre>\n"},{"tags":["java","multithreading","timer"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":231,"score":4,"question_id":9606674,"title":"How to get threads with loops running concurrently to work with Thread.yield()?","body":"<p>I have the following situation. I have an application that runs mostly on one thread. It has grown large, so I would like to run a watchdog thread that gets called whenever the main thread changes into a different block of code / method / class so I can see there is \"movement\" in the code. If the watchdog gets called by the same area for more than a second or a few, it shall set a volatile boolean that the main thread reads at the next checkpoint and terminate / restart.\nNow the problem is getting either of the threads to run somewhat at the same time. As soon as the main thread is running, it will not let the watchdog timer count properly. I was therefore thinking of yielding every time it calls the watchdog (so it could calculate time passed and set the value) but to no avail. Using Thread.sleep(1) instead of Thread.yield() works. But I don't want to have several areas of code just wasting calculation time, I am sure I am not doing it the way it is meant to be used.</p>\n\n<p>Here a very simple example of how I would use Thread.yield(). I do not understand why the Threads here will not switch (they do, after a \"long\" and largely unpredictable time). Please give me an advice on how to make this simple example output ONE and TWO after each other. Like written before, if I switch yield() with sleep(1), it will work just like I'd need it to (in spite of waiting senselessly).</p>\n\n<pre><code>    Runnable run1 = new Runnable(){\n        public void run(){\n            while(true){\n                System.out.println(\"ONE\");\n                Thread.yield();\n            }\n        }\n    };\n\n    Runnable run2 = new Runnable(){\n        public void run(){\n            while(true){\n                System.out.println(\"TWO\");\n                Thread.yield();\n            }\n        }\n    };\n\n    Thread tr1 = new Thread(run1);              \n    Thread tr2 = new Thread(run2);\n\n    tr1.start();\n    tr2.start();\n</code></pre>\n"},{"tags":["android","multithreading","view"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12956519,"title":"Custom View termination of my own work thread","body":"<p>I have my own class called <strong>TimerControl</strong> that extends <strong>android.view.View</strong>. Inside <strong>TimerControl</strong>, I spawn a worker thread that should continue to work so while the Activity that the View is a part of is still alive. (i.e. onStop has not been called on the Parent Activity) I do not want to write the logic to kill the thread inside the Activity class because I want the View to work like other views where you don't have to manage stuff like that from the Activity. <em>How do I determine if the parent Activity of a View has been destroyed?</em> (from the custom view itself)</p>\n"},{"tags":["java","multithreading","synchronization","thread-safety","blockingqueue"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":115,"score":1,"question_id":12022310,"title":"ArrayBlockingQueue with Unique ID","body":"<p>After taking help from StackOverflow, I found the solution that I have implemented below.</p>\n\n<p><strong>Problem Statement:-</strong></p>\n\n<p>Each thread needs to use <code>UNIQUE ID</code> every time and it has to run for <code>60 minutes</code> or more, So in that <code>60 minutes</code> it is possible that all the <code>ID's</code> will get finished so I need to reuse those <code>ID's</code> again. So I am using <code>ArrayBlockingQueue</code> concept here.</p>\n\n<p><strong>Two Scenario:-</strong></p>\n\n<ol>\n<li>If the <code>command.getDataCriteria()</code> contains <code>Previous</code> then each thread\nalways needs to use <code>UNIQUE ID</code> between <code>1 and 1000</code> and release it for reusing\nagain.</li>\n<li>Else if the <code>command.getDataCriteria()</code> contains <code>New</code> then each thread\nalways needs to use <code>UNIQUE ID</code> between <code>2000 and 3000</code> and release it for\nreusing again.</li>\n</ol>\n\n<p><strong>Question:-</strong></p>\n\n<p>One weird thing that I have just noticed is- In the below else if loop if you see my below code in run method if the <code>command.getDataCriteria() is Previous</code> then also it gets entered in the <code>else if block(which is for New)</code> which shouldn't be happening right as I am doing a <code>.equals check</code>? Why this is happening?</p>\n\n<pre><code>else if(command.getDataCriteria().equals(PDSLnPConstants.DATA_CRITERIA_NEW)) {\n</code></pre>\n\n<p>Below is my code:-</p>\n\n<pre><code>class ThreadNewTask implements Runnable {\n      private Command command;\n      private BlockingQueue&lt;Integer&gt; existPool;\n      private BlockingQueue&lt;Integer&gt; newPool;\n      private int existId;\n      private int newId;\n\n\n      public ThreadNewTask(Command command, BlockingQueue&lt;Integer&gt; pool1, BlockingQueue&lt;Integer&gt; pool2) {\n            this.command = command;\n            this.existPool = pool1;\n            this.newPool = pool2;\n      }\n\n      public void run() {\n\n            if(command.getDataCriteria().equals(PDSLnPConstants.DATA_CRITERIA_PREVIOUS)) {\n                  try {\n                        existId = existPool.take();\n                        someMethod(existId);\n                  } catch (Exception e) {\n                        System.out.println(e);\n                  } finally {\n                        existPool.offer(existId);\n                  }\n            } else if(command.getDataCriteria().equals(PDSLnPConstants.DATA_CRITERIA_NEW)) {\n                  try {\n                        newId = newPool.take();\n                        someMethod(newId);\n                  } catch (Exception e) {\n                        System.out.println(e);\n                  } finally {\n                        newPool.offer(newId);\n                  }\n            }\n      }\n\n      // And this method needs to be synchronized or not?\n      private synchronized void someMethod(int i) {\n            System.out.println();\n            System.out.println(\"#####################\");\n            System.out.println(\"Task ID: \" +i);\n            System.out.println(\"#####################\");\n            System.out.println();\n      }\n}\n\npublic class TestingPool {\n      public static void main(String[] args) throws InterruptedException {\n            int size = 10;\n            int durationOfRun = 60;\n            LinkedList&lt;Integer&gt; availableExistingIds = new LinkedList&lt;Integer&gt;();\n            LinkedList&lt;Integer&gt; availableNewIds = new LinkedList&lt;Integer&gt;();\n            for (int i = 1; i &lt;= 1000; i++) {\n                  availableExistingIds.add(i);\n            }\n            for (int i = 2000; i &lt;= 3000; i++) {\n                  availableNewIds.add(i);\n            }\n            BlockingQueue&lt;Integer&gt; existIdPool = new ArrayBlockingQueue&lt;Integer&gt;(1000, false, availableExistingIds);\n            BlockingQueue&lt;Integer&gt; newIdPool = new ArrayBlockingQueue&lt;Integer&gt;(1000, false, availableNewIds);\n\n            // create thread pool with given size\n            ExecutorService service = new ThreadPoolExecutor(size, size, 500L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(10), new ThreadPoolExecutor.CallerRunsPolicy()); \n\n\n            // queue some tasks\n            long startTime = System.currentTimeMillis();\n            long endTime = startTime + (durationOfRun * 60 * 1000L);\n\n            // Running it for 60 minutes\n            while(System.currentTimeMillis() &lt;= endTime) {\n                  Command nextCommand = getNextCommandToExecute();\n                  service.submit(new ThreadNewTask(nextCommand, existIdPool, newIdPool));\n            }\n\n            // wait for termination        \n            service.shutdown();\n            service.awaitTermination(Long.MAX_VALUE, TimeUnit.DAYS); \n      }\n}\n</code></pre>\n\n<p><strong>Update:-</strong></p>\n\n<p>One weird thing that I have just noticed is- In the below <code>else if loop</code> if the <code>command is Previous</code> then also it gets entered in the else if block which shouldn't be happening right? Why this is happening? I have no clue why this thing is happening?</p>\n\n<pre><code>else if(command.getDataCriteria().equals(PDSLnPConstants.DATA_CRITERIA_NEW)) {\n</code></pre>\n"},{"tags":["java","multithreading","threadpool","threadpoolexecutor"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12821849,"title":"How to force terminate all workers in ThreadPoolExecutor immediately","body":"<p>I have a number of tasks inside a <code>TheadPoolExecutor</code>. I have a stop button on my interface that should terminate all the threads inside <code>ThreadPoolExecutor</code> immediately. I am looking for a way to do it. (without <code>shutDown()</code> or <code>shutDownNow()</code>).</p>\n\n<p>Thanks</p>\n"},{"tags":["multithreading","performance","d","thread-local-storage"],"answer_count":6,"favorite_count":7,"up_vote_count":16,"down_vote_count":0,"view_count":5126,"score":16,"question_id":506093,"title":"Why is thread local storage so slow?","body":"<p>I'm working on a custom mark-release style memory allocator for the D programming language that works by allocating from thread-local regions.  It seems that the thread local storage bottleneck is causing a huge (~50%) slowdown in allocating memory from these regions compared to an otherwise identical single threaded version of the code, even after designing my code to have only one TLS lookup per allocation/deallocation.  This is based on allocating/freeing memory a large number of times in a loop, and I'm trying to figure out if it's an artifact of my benchmarking method.  My understanding is that thread local storage should basically just involve accessing something through an extra layer of indirection, similar to accessing a variable via a pointer.  Is this incorrect?  How much overhead does thread-local storage typically have?</p>\n\n<p>Note:  Although I mention D, I'm also interested in general answers that aren't specific to D, since D's implementation of thread-local storage will likely improve if it is slower than the best implementations.</p>\n"},{"tags":["java","multithreading","threadpool"],"answer_count":3,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":1257,"score":5,"question_id":4620061,"title":"How to create LIFO executor?","body":"<p>I would like to create a thread pool which will execute the most recently submitted task.  Any advice on how to accomplish this?</p>\n\n<p>Thank you</p>\n"},{"tags":["c#","multithreading","load-testing"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":12943137,"title":"What strategies are there for writing a load testing tool?","body":"<p>I know about tools for load testing a WCF service, so please don't suggest I use one.</p>\n\n<p>If I wanted to write a tool for calling a service (or invoking any action really) X times a second for Y seconds, what things do I need to consider?</p>\n\n<p>My initial approach would be to have a timer fire at the required interval and create a task when it fires, but I'm concerned that this will simply queue a lot of tasks up waiting for threads from the thread pool to execute on and they will not invoke the service at the required times.</p>\n\n<p>Would creating individual threads to do the work be better?  Then I'd be concerned about creating a large number of threads.</p>\n\n<p>So what strategies can I use?  </p>\n"},{"tags":["java","multithreading","tomcat","tomcat6","threadpool"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":72,"score":4,"question_id":12951137,"title":"Cancel previous request","body":"<p>For every request, there is a lot of computation happens. On an average the reply takes about 10 minutes to process. Now in the mean time, if a user sends a new request; There is absolutely no point for the previous request to continue.</p>\n\n<p>So I have written a code where I basically interrupt the previous thread executing it. Is it a good practice in tomcat environment? Can there be a better solution to deal with it. Is it alright to interrupt tomcat threads.\nOr should I manage my own threadpool and let pool do the computation for me?</p>\n\n<hr>\n\n<p>More Information:\nBasically the whole task is wrapped with a FutureTask. For every request, this task is executed and the reference to the task is stored by a ConcurrentHashMap. For every request, all the future's in the map is \"cancelled\" and then proceeds to execute the latest request. Thus cancelling the previous requests.</p>\n"},{"tags":["linux","multithreading","process","kernel","pid"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":60,"score":-3,"question_id":12943542,"title":"Is pid really unique","body":"<p>Is there a case where PID does not end up being unique? Is it the best way to identify a process (or a thread)? I read that previous versions of Linux had a different approach</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","multithreading","windows-phone-7","ui-thread"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12947630,"title":"Displaying a popup from a different thread (windows phone)","body":"<p>I am having troubles displaying my pop-up from inside a different thread. I have tried reading some of the other questions on here, but I can't see to understand how I can apply them...</p>\n\n<p>I have an app that uses the camera, and I want to pop up a preview of the picture after its available. </p>\n\n<p>The PhotoCamera has the event 'CaptureImageAvailable' and in there I want to pop-up the preview</p>\n\n<pre><code>private void cam_CaptureImageAvailable(object sender, ContentReadyEventArgs e)\n    {\n        BitmapImage img = new BitmapImage();\n        img.SetSource(e.ImageStream);\n        e.ImageStream.Close();\n\n        //creating the new pop-up preview\n        Grid panelPreview = new Grid();\n        panelPreview.Background = new SolidColorBrush(Colors.Black);\n        panelPreview.Width = 300;\n        panelPreview.Height = 400;\n\n        //create an ImageBrush to display the image in the new pop-up\n        ImageBrush imgPreview = new ImageBrush();\n        imgPreview.ImageSource = img;\n\n        //need a rectangle to add the image to, otherwise can't add it\n        Rectangle rect = new Rectangle();\n        rect.Width = 300;\n        rect.Height = 400;\n        rect.Fill = imgPreview;\n\n        //Adding the rectangle to the grid\n        panelPreview.Children.Add(rect);\n\n        imagePreview.IsOpen = true;\n\n        ....\n    }\n</code></pre>\n\n<p>This causes an UnauthorizedAcessException, which makes sense to me, because this event is on a different thread, but what I don't understand is how to fix it... I have tried using this code as well</p>\n\n<pre><code>private void cam_CaptureImageAvailable(object sender, ContentReadyEventArgs e)\n    {\n\n        Deployment.Current.Dispatcher.BeginInvoke(delegate()\n        {\n\n            BitmapImage img = new BitmapImage();\n            img.SetSource(e.ImageStream);\n            e.ImageStream.Close();\n\n            //creating the new pop-up preview\n            Grid panelPreview = new Grid();\n            panelPreview.Background = new SolidColorBrush(Colors.Black);\n            panelPreview.Width = 300;\n            panelPreview.Height = 400;\n\n            //create an ImageBrush to display the image in the new pop-up\n            ImageBrush imgPreview = new ImageBrush();\n            imgPreview.ImageSource = img;\n\n            //need a rectangle to add the image to, otherwise can't add it\n            Rectangle rect = new Rectangle();\n            rect.Width = 300;\n            rect.Height = 400;\n            rect.Fill = imgPreview;\n\n            //Adding the rectangle to the grid\n            panelPreview.Children.Add(rect);\n\n            imagePreview.IsOpen = true;\n        });\n</code></pre>\n\n<p>This method doesn't throw any errors, but also doesn't appear to actually do anything. How do I display this pop-up on the UI thread?</p>\n"},{"tags":["java","multithreading","exception","error-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":12953687,"title":"Can exception/error in one thread halt the whole application?","body":"<p>If an error / exeption is thrown in a thread (not a main one) can this halt the whole application ?</p>\n\n<p>Is there such possibility ? Or will this just stop the thread it was running in ?</p>\n"},{"tags":["c#","multithreading","xaml","windows-8","windows-store-apps"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12951824,"title":"Threading model of Windows Store application","body":"<p>I'm creating Windows Store application, that retrieves data asynchronously from web service and then updates the UI with the data. I've had several problems when accessing Application.Current.Resources in code(RPC_E_WRONG_THREAD).</p>\n\n<p>Where I can find some explanation on how the app in launched, which threads are spawned during the app lifetime, and what I can do and access, and what can't?</p>\n"},{"tags":["c++","c","multithreading","signal-handling"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":12952262,"title":"signal handler function in multithreaded environment","body":"<p>In my multithreaded GUI application I have following signal handling code. I want to improve this code so that it will be correct and threading safe but there are some things I don't fully understand in signal handling:</p>\n\n<ul>\n<li>is signal handled at the process or thread level (can I have thread-specific signal handlers) ?</li>\n<li>in which thread context is signal_handler function executed ?</li>\n<li>is it possible to send many SIGTERM signals in a short time ?</li>\n<li>does it make sens to use a mutex to prevent parallel execution of signal_handler ?</li>\n</ul>\n\n<hr>\n\n<pre><code>void signal_handler(int sig)\n{\n        switch (sig)\n        {\n        case SIGTERM:\n            ::wxLogMessage(wxT(\"SIGTERM signal received ...\"));\n            break;\n        case SIGINT:\n            ::wxLogMessage(wxT(\"SIGINT signal received ...\"));\n            break;\n        case SIGUSR1:\n            ::wxLogMessage(wxT(\"SIGUSR1 signal received ...\"));\n            break;\n        default:\n            ::wxLogMessage(wxT(\"Unknown signal received ...\"));\n        }\n\n        // send wxCloseEvent to main application window\n        ::wxGetApp().GetTopWindow()-&gt;Close(true);\n}\n</code></pre>\n\n<p>I register signal handlers in my init function:</p>\n\n<pre><code>// register signal handlers\nsignal(SIGTERM, signal_handler);\nsignal(SIGINT,  signal_handler);\nsignal(SIGUSR1, signal_handler);\n</code></pre>\n"},{"tags":["c++","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12952261,"title":"Are scoped static variables shared between threads?","body":"<p>E.g., can the following code ever print \"3\" for one of the threads?</p>\n\n<pre><code>int foo()\n{\n   static int a = 1;\n   return ++a;\n}\n\nvoid thread1()\n{\n   cout&lt;&lt;foo()&lt;&lt;endl;\n}\n\nvoid thread2()\n{\n   cout&lt;&lt;foo()&lt;&lt;endl;\n}\n</code></pre>\n\n<p>edit: It's C++ 98</p>\n"},{"tags":["multithreading","timer","mutex"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12945361,"title":"Does timer need mutex","body":"<p>I use timer in my program:<br>\n<code>timer = new Qtimer(); connect(timer, SIGNAL(timeout()), this, SLOT(readData()));</code>      <code>timer.start(1000);</code><br>\nAnd there is also other slots which may be triggered by UI interation:<br>\n<code>/*SLOT FUNCTION*/ on_pushbutton_triggered(){..../*write data*/...}</code>.  </p>\n\n<p>(the code is written in qt, but I think it's a common question)    </p>\n\n<p>So I worry about the potential problem: <strong>may readData() reads wrong data while on_pushbutton_triggereed() is writting data?</strong>   </p>\n\n<p>I am not so familiar with how the timer really work behind the screen: is it in the same thread with my program?<br>\n<strong>Will readData() and on_pushbutton_triggereed() be called, executed, finished serially and have no mutex problem(that is: I have to use lock() and unlock())?</strong>  Thank you for reading! I really hope for your hints!</p>\n"},{"tags":["java","android","multithreading","rss","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12951314,"title":"Getting data with asyncTask and thread","body":"<p>I am trying to get data from RSS feed to display it in fragments (11 fragment), but each time i pass to a new fragment the UI block for a several seconds because it's fetching data so i try to use asyncTask to do this in background but it seems that it does not work.</p>\n\n<pre><code>public class AndroidSaxFeedParser extends AsyncTask&lt;String, Long, ArrayList&lt;Article&gt;&gt;{\n\nString dt;\nString bb;\nString nameCat;\nRootElement root;\nElement item;\n\nstatic final String RSS = \"rss\";\nstatic final String FEED = \"feed\";\nstatic final String ENTRY = \"entry\";\nstatic final String CHANNEL = \"channel\";\nstatic final String PUB_DATE = \"pubDate\";\nstatic final  String DESCRIPTION = \"description\";\nstatic final  String LINK = \"link\";\nstatic final  String TITLE = \"title\";\nstatic final  String ITEM = \"item\";\nstatic final  String CATEGORY = \"category\";\nstatic final  String DURATION = \"itunes:duration\";\n\nArrayList&lt;Article&gt; rssItems = new ArrayList&lt;Article&gt;();\n\npublic URL feedUrl;\n\nContext mContext;\n\npublic AndroidSaxFeedParser(Context context)\n{\n    mContext = context;\n\n}\n\n//  ProgressDialog pd = new ProgressDialog(mContext);\n\n@Override\nprotected void onPostExecute(ArrayList&lt;Article&gt; result) {\n//      pd.dismiss();       \n    super.onPostExecute(result);\n}\n\n@Override\nprotected void onPreExecute() {\n//      ProgressDialog.show(mContext, \"\", \"Chargement...\");\n    super.onPreExecute();\n}\n\n@Override\nprotected ArrayList&lt;Article&gt; doInBackground(String... params) {\n\n    try {\n        feedUrl = new URL(params[0]);\n    } catch (MalformedURLException e1) {\n        e1.printStackTrace();\n    }\n\n    final Article currentRssItem = new Article();\n    root = new RootElement(RSS);\n    Element channel = root.getChild(CHANNEL);\n    item = channel.getChild(ITEM);\n\n    item.getChild(TITLE).setEndTextElementListener(new EndTextElementListener(){\n        public void end(String body) {\n            currentRssItem.setTitle(body); \n            Log.i(\"Title Article\", \" \"+currentRssItem.getTitle());\n        }\n    });\n\n    item.getChild(CATEGORY).setEndTextElementListener(new EndTextElementListener(){\n        public void end(String body) {\n            currentRssItem.setCategorie(body);\n            Log.i(\"Category Article\", \" \"+currentRssItem.getCategorie());\n        }\n    });\n\n    item.getChild(DESCRIPTION).setEndTextElementListener(new EndTextElementListener(){\n        public void end(String body) {\n            String imgUrl, desc;\n            try {imgUrl = body.substring(body.indexOf(\"src=\")+5,body.indexOf(\"\\\"\", body.indexOf(\"src=\")+6));} \n            catch (Exception e) \n            {imgUrl = \"\";}\n            try {desc=body;} \n            catch (Exception e) \n            { desc = \"\";}\n            currentRssItem.setImageUrl(imgUrl);\n            currentRssItem.setDescription(desc);\n\n            Log.i(\"Image URL Article\", \" \"+currentRssItem.getImageUrl());\n            Log.i(\"Description Article\", \" \"+currentRssItem.getDescription());\n        }\n    });\n\n    item.getChild(PUB_DATE).setEndTextElementListener(new EndTextElementListener(){\n        public void end(String body) {\n            currentRssItem.setPubDate(body);\n            Log.i(\"Date Article\", \" \"+currentRssItem.getPubDate());\n        }\n    });\n\n    item.setEndElementListener(new EndElementListener(){\n        public void end() {\n            rssItems.add(currentRssItem.copy());\n        }\n    });\n    try {\n        Xml.parse(feedUrl.openConnection().getInputStream(), Xml.Encoding.UTF_8, root.getContentHandler());\n    } catch (IOException e) {\n        e.printStackTrace();\n    } catch (SAXException e) {\n        e.printStackTrace();\n    }   \n    return rssItems;\n}   \n</code></pre>\n\n<p>I am calling it this way in each fragment</p>\n\n<pre><code>ArrayList&lt;Article&gt; feeds ;\n    try {\n        feeds=AndroidSaxFeedParser.execute(url).get();\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    } catch (ExecutionException e) {\n        e.printStackTrace();\n    }\n</code></pre>\n"},{"tags":["multithreading","gpu","dispatch","directcompute","threadgroup"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12539724,"title":"Threads and Thread Groups on the GPU","body":"<p>I'm wondering about the \"grids\" of threads/thread groups I can dispatch on the GPU. I'm using Direct Compute so I'll give a concrete example using that API. For example, if I call Dispatch(2,2,2), I understand it dispatches 2x2x2 = 8 thread groups in total. However, what's the difference if I call Dispatch(8,1,1), which also dispatches 8x1x1 = 8 thread groups? Is there any performance difference?</p>\n\n<p>P.S. same question with threads on the GPU. What's the difference between numthreads(2,2,2) and numthreads(8,1,1), declared in the compute (.hlsl) file?</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["c","multithreading","osx","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12949028,"title":"Spin Lock Implementations (OSSpinLock)","body":"<p>I am just starting to look into multi-threaded programming and thread safety. I am familiar with busy-waiting and after a bit of research I am now familiar with the theory behind spin locks, so I thought I would have a look at OSSpinLock's implementation on the Mac. It boils down to the following function (defined in objc-os.h):</p>\n\n<pre><code>static inline void ARRSpinLockLock(ARRSpinLock *l)\n{\nagain:\n   /* ... Busy-waiting ... */\n    thread_switch(THREAD_NULL, SWITCH_OPTION_DEPRESS, 1);\n    goto again;\n}\n</code></pre>\n\n<p>(<a href=\"http://www.opensource.apple.com/source/objc4/objc4-532.2/runtime/objc-os.h\" rel=\"nofollow\">Full implementation here</a>)</p>\n\n<p>After doing a bit of digging, I now have an approximate idea of what <code>thread_switch</code>'s parameters do (<a href=\"http://www.gnu.org/software/hurd/gnumach-doc/Hand_002dOff-Scheduling.html\" rel=\"nofollow\">this site</a> is where I found it). My interpretation of what I have read is that this particular call to thread_switch will switch to the next available thread, and decrease the current thread's priority to an absolute minimum for 1 cycle. 'Eventually' (in CPU time) this thread will become active again and immediately execute the <code>goto again;</code> instruction which starts the busy-waiting all over again.</p>\n\n<p>My question though, is why is this call actually necessary? I found another implementation of a spin-lock (for Windows this time) <a href=\"http://www.codeproject.com/Articles/784/User-Level-Spin-Locks\" rel=\"nofollow\">here</a> and it doesn't include a (Windows-equivalent) thread switching call at all. </p>\n"},{"tags":["java","multithreading","concurrency","cyclicbarrier"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12267418,"title":"Barrier break down example","body":"<p>I am reading the book <a href=\"http://rads.stackoverflow.com/amzn/click/0321349601\" rel=\"nofollow\">Java Concurrency in Practice</a> where it says,</p>\n\n<blockquote>\n  <p><code>CyclicBarrier</code> allows a fixed number of parties to rendezvous repeatedly at a barrier point and is useful in parallel iterative algorithms that break down a problem into a fixed number of independent subproblems.</p>\n</blockquote>\n\n<p>Can someone give an example of how it breaks down a problem into multiple independent subproblems?</p>\n"}]}
{"total":30059,"page":12,"pagesize":100,"questions":[{"tags":["c","multithreading","real-time"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12950032,"title":"Unpredictable results with two threads calling a function","body":"<p>I hoping someone can help me solve some unpredictable behaviour in a C program I need to fix:</p>\n\n<p>I have two Xenomai real-time tasks (threads) that wait until they receive an incoming message from one of two CAN buses. <br>\nEach task calls a function  checkMessageNumber()  however I'm getting unpredictable results.</p>\n\n<p>Please note that I am using a priority based, single-threaded system. One thread has priority over the other, however one thread could be part-way through executing when the other thread takes priority. <br>\nIt the future it is possible that the hardware could be upgraded to a multi-threading system, however this part of the program would still be confined to a single thread (one CPU core).</p>\n\n<p>It is my understanding that each thread would invoke it's own instance of this function so I don't know what's happening.</p>\n\n<pre><code>int getMessageIndex(unsigned int msg_number)\n{\n    unsigned int i = 0;\n    while(i &lt; global_number_message_boxes)\n    { \n        if (global_message_box[i].id == msg_number}\n            return i; // matched the msg number, so return the index number\n        i++;\n    }\n    return -1; // no match found\n}\n</code></pre>\n\n<p>Originally this function was highly unpredictable, and as messages streamed in and were processed by the two tasks (depending on which hardware bus the message came from), this function would sometimes return -1 even though the incoming 'msg_number' did match an 'id' in the 'global_message_box' struct.</p>\n\n<p>I was able to make it work better by setting 'global_number_message_boxes' to an integer: <br>\neg.  <code>while(i &lt; 50)</code> <br>\nhowever the function still sometimes returns -1 even though there should be a match.</p>\n\n<p>I am only reading global variables, so why are they getting corrupted?  what do I need to learn about this?</p>\n\n<p>My idea is to simplify things so the incoming 'msg_number' simply just is the 'id' in the 'global_message_box'.  <br>\nEach thread will then write to the struct directly without having to check which 'id' to write too. <br>\nHow important is it to use a mutex?  due to system design, each thread will never write to the same part of the struct, so I am unsure if it's important?</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading","java-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12949604,"title":"Preventing repeated function calls in a multi-threaded Java server","body":"<p>I have a multi-player java server and a flash app where users are simply chatting and interacting with several commands. Everything works fine when people use the flash app, however if they (kids or hackers) generate external socket calls via other software like charles, I need to prevent consecutive calls on some functions. I am not sure where I should start at this point. Is synchronizing method calls the solution or do I need to search other solutions. If synchronization is the solution, can you please give an example on how to do it.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#",".net","multithreading","desktop-application"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12949364,"title":"Structure of desktop application in C#","body":"<p>Please have look at the attached image i have created. I have done this diagram on my own by the information got from the internet. The diagram tells out stucture of multithreaded desktop application in C# .NET. if any one can suggest any changes that would be really gratful. I have to give a presentation on this topic tommorow :) also if you know any related documets about this topic with some diagramatic representation, that would be really helpful for me.</p>\n\n<p>Looking forward to get some reply soon.</p>\n\n<p><img src=\"http://i.stack.imgur.com/kigPL.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["multithreading","events","timer","synchronize"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12782139,"title":"C# SynchronizingObject and Timer.Timer thread","body":"<p>Hi i am trying to make the Elapsed event of the Timer.Timer class fire on my main thread.\nI am restricted to VS 2008, .net 3.5...\nIn this post: \n<a href=\"http://stackoverflow.com/questions/1435876/do-c-sharp-timers-elapse-on-a-separate-thread\">Do C# Timers elapse on a separate thread?</a> \nit is stated that using a SynchronizingObject will make the handler execute on the thread that owns the object.</p>\n\n<p>So I tried this:</p>\n\n<pre><code>class MyTimer\n{\n  private readonly Timer timer;\n\n  public MyTimer(ISynchronizeInvoke synchronizingObject)\n  {\n    Console.Out.WriteLine(Thread.CurrentThread.ManagedThreadId);\n    timer = new Timer(1000);\n    timer.SynchronizingObject = synchronizingObject;\n    timer.Elapsed +=\n      delegate\n        {\n          timer.Stop();\n          Thread.Sleep(2000);\n          Console.Out.WriteLine(Thread.CurrentThread.ManagedThreadId);\n          timer.Start();\n\n        };\n    timer.Start();\n  }\n}\n\nclass Program\n{\n  static void Main(string[] args)\n  {\n    ISynchronizeInvoke syncObject = new Control();\n    var mytimer = new MyTimer(syncObject);\n\n    Console.ReadKey();\n  }\n}\n</code></pre>\n\n<p>But the output is: 1,4,4,4,4...</p>\n\n<p>Why is that? How do i make the Elapsed handler execute on the mainthread.</p>\n\n<p>I tried using <a href=\"http://stackoverflow.com/questions/1841345/synchronizingobject-for-an-event\">SynchronizingObject for an event</a>\nbut that didn't help either:</p>\n\n<pre><code>  public static ElapsedEventHandler Wrap(ElapsedEventHandler original, ISynchronizeInvoke synchronizingObject) \n  {\n    return (sender, args) =&gt;\n    {\n      if (synchronizingObject.InvokeRequired)\n      {\n        synchronizingObject.Invoke(original, new object[] { sender, args });\n      }\n      else\n      {\n        original(sender, args);\n      }\n    };\n  }\n</code></pre>\n\n<p>and: </p>\n\n<pre><code>timer.Elapsed += Wrap(\n      delegate\n        {\n          timer.Stop();\n          Thread.Sleep(200);\n          Console.Out.WriteLine(Thread.CurrentThread.ManagedThreadId);\n          timer.Start();\n        }, \n        synchronizingObject);\n</code></pre>\n\n<p>But still no success... everytime InvokeRequired is false...</p>\n\n<p>forcing debug into the invoke causes a invalidoperation: \"Invoke or BeginInvoke cannot be called on a control until the window handle has been created.\" </p>\n\n<p>last resort would be to look into:\n<a href=\"http://www.codeproject.com/Articles/12082/A-DelegateQueue-Class?msg=3655119#xx3655119xx\" rel=\"nofollow\">http://www.codeproject.com/Articles/12082/A-DelegateQueue-Class?msg=3655119#xx3655119xx</a>\nbut is that really necessary? or is there some simpler solution?</p>\n"},{"tags":["android","multithreading","unit-testing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12945376,"title":"Android Unit testing - Have a test wait on a response","body":"<p>So I've got an Android library that I need to do unit testing on. You pass the library some handlers, and I need to unit test based on the messages sent to those handlers from the library.</p>\n\n<p>The problem is, I don't know how to tell a test to wait until I get a response back. I have a timer checking the response every 10 seconds in my test method and if it sees a response is does an assert, but the test method schedules the timer task and then finishes as successful instead of waiting for an assert in the timer task.</p>\n\n<p>Is there a way to have the test explicitly wait until it runs into an assert before finishing? Or some other way of accomplishing this?</p>\n\n<p>Thanks!</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12943489,"title":"C# wait for all threads to finish in Main()","body":"<p>I've been coding a Multithreading Application to solve mazes. I start a new thread from my <code>Program Class</code>, <code>Main()</code> method, to begin solving the maze. He will then call a static method to create a new thread if he finds a bifurcation. How can I wait for all the threads running in the background to finish, in order to, for example display a message of completion?</p>\n\n<p>This is an eskeleton of what I'm trying to do:</p>\n\n<pre><code>var explorer = new Explorer(/*Some arguments*/);\nvar thread = new Thread(explorer.Explore) {Name = \"Thread 0\"};\nthread.Start();\n\n//Thread_0_and_Threads_he_generates_through_static_class.Join()    \n\nConsole.WriteLine(\"I'm done bro.\");\nConsole.ReadKey();\n</code></pre>\n\n<p>Is there a way to do this? Honestly, first time working with Multithreading in this way, so I apologize for the poor code. Any other information I'll be more than happy to provide. Thanks in advance.</p>\n"},{"tags":["android","multithreading","broadcastreceiver","looper"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12760180,"title":"Thread Inside Broadcast Receiver Android","body":"<p>I am getting a DownloadManager.ACTION_DOWNLOAD_COMPLETE broadcast upon getting I am required to extract the zip file and fill the the data base I have written the code to do my work .But I have to start the Thread here to handle the file extraction and insertion to database.</p>\n\n<p>I know that a thread cannot be started inside broadcast receiver . If any body has encounter the problem please suggest the solution .. as my work will take time in insertion so i dont want to wait and stick with it.</p>\n\n<p>I am getting exception while running thread inside broadcast receiver and </p>\n\n<p>Writing this code also not working inside broadcast receiver </p>\n\n<pre><code>BroadcastReceiver onComplete = new BroadcastReceiver() {\n    public void onReceive(Context ctxt, Intent intent) {\n\n        /*\n         * check status message whether the last queue is successful and\n         * completed and then stop self\n         */\n        if (DownloadManager.ACTION_DOWNLOAD_COMPLETE.equals(intent.getAction())) {\n            Intent mIntent = new Intent(downloadmanager1.this, DBService.class);\n            mIntent.putExtra(\"messenger\", new Messenger(mHandler));\n            mIntent.putExtra(\"enqueue\", enqueue);\n            ctxt.startService(mIntent);\n          //  ctxt.startService(mIntent);\n        }\n    }\n</code></pre>\n\n<p>Note - no exception or error is through and neither any Intentservice is started in DDMS while debugging<br>\n    };</p>\n"},{"tags":["c","multithreading","unix"],"answer_count":9,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":412,"score":1,"question_id":875437,"title":"Does this multithreaded program perform better than the non-multithreaded one?","body":"<p>A colleague of mine asked me to write a homework for him. Although this wasn’t too ethical I did it, I plead guilty.\nThis is how the problem goes:\nWrite a program in C where the sequence 1<sup>2</sup> + 2<sup>2</sup> + ... + n<sup>2</sup> is calculated. \nAssume that n is multiple of p and p is the number of threads.\nThis is what I wrote:</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define SQR(X) ((X) * (X))\n\nint n, p = 10, total_sum = 0;\n\npthread_mutex_t mtx = PTHREAD_MUTEX_INITIALIZER;\n/* Function prototype */\nvoid *do_calc(void *arg);\n\nint main(int argc, char** argv)\n{\n    int i;\n    pthread_t *thread_array;\n    printf(\"Type number n: \");\n    fscanf(stdin, \"%d\", &amp;n);\n\n    if (n % p != 0 ) {\n        fprintf(stderr, \"Number must be multiple of 10 (number of threads)\\n\");\n        exit(-1);\n    }\n\n\n    thread_array = (pthread_t *) malloc(p * sizeof(pthread_t));\n    for (i = 0; i &lt; p; i++)\n        pthread_create(&amp;thread_array[i], NULL, do_calc, (void *) i);\n    for (i = 0; i &lt; p; i++)\n        pthread_join(thread_array[i], NULL);\n\n    printf(\"Total sum: %d\\n\", total_sum);\n    pthread_exit(NULL);\n}\n\nvoid *do_calc(void *arg)\n{\n    int i, local_sum = 0;\n    int thr = (int) arg;\n    pthread_mutex_lock(&amp;mtx);\n    for (i = thr * (n / p); i &lt; ((thr + 1) * (n / p)); i++)\n    local_sum += SQR(i + 1);\n    total_sum += local_sum;\n    pthread_mutex_unlock(&amp;mtx);\n    pthread_exit(NULL);\n}\n</code></pre>\n\n<p>Aside from the logical/syntactic point of view, I was wondering:</p>\n\n\n\n<ol>\n<li>how the respective non-multithreaded program would perform</li>\n<li>how could I test/see their performance</li>\n<li>what would be the program without using threads</li>\n</ol>\n\n<p>Thanks in advance and I’m looking forward to reading your thoughts</p>\n"},{"tags":["java","multithreading","spring","spring-integration"],"answer_count":2,"favorite_count":0,"up_vote_count":9,"down_vote_count":0,"view_count":470,"score":9,"question_id":8924694,"title":"Waiting for all threads to finish in Spring Integration","body":"<p>I have a self-executable jar program that relies heavily on Spring Integration. The problem I am having is that the <strong>program is terminating before the other Spring beans have completely finished</strong>.</p>\n\n<p>Below is a cut-down version of the code I'm using, I can supply more code/configuration if needed. The entry point is a main() method, which bootstraps Spring and starts the import process:</p>\n\n<pre><code>public static void main(String[] args) {\n    ctx = new ClassPathXmlApplicationContext(\"flow.xml\");\n    DataImporter importer = (DataImporter)ctx.getBean(\"MyImporterBean\");\n    try {\n        importer.startImport();\n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        ctx.close();\n    }\n}\n</code></pre>\n\n<p>The DataImporter contains a simple loop that fires messages to a Spring Integration gateway. This delivers an active \"push\" approach to the flow, rather than the common approach of polling for data. This is where my problem comes in:</p>\n\n<pre><code>public void startImport() throws Exception {\n    for (Item item : items) {\n        gatewayBean.publish(item);\n        Thread.sleep(200); // Yield period\n    }\n}\n</code></pre>\n\n<p>For completeness, the flow XML looks something like this:</p>\n\n<pre><code>&lt;gateway default-request-channel=\"inChannel\" service-interface=\"GatewayBean\" /&gt;\n\n&lt;splitter input-channel=\"inChannel\" output-channel=\"splitChannel\" /&gt;\n\n&lt;payload-type-router input-channel=\"splitChannel\"&gt;\n    &lt;mapping type=\"Item\" channel=\"itemChannel\" /&gt;\n    &lt;mapping type=\"SomeOtherItem\" channel=\"anotherChannel\" /&gt;\n&lt;/payload-type-router&gt;\n\n&lt;outbound-channel-adapter channel=\"itemChannel\" ref=\"DAOBean\" method=\"persist\" /&gt;\n</code></pre>\n\n<p>The flow starts and processes items effectively, but once the startImport() loop finishes the main thread terminates and tears down all the Spring Integration threads immediately. This results in a race condition, the last (n) items are not completely processed when the program terminates.</p>\n\n<p>I have an idea of maintaining a reference count of the items I am processing, but this is proving to be quite complicated, since the flow often splits/routes the messages to multiple service activators - meaning it is difficult to determine if each item has \"finished\". </p>\n\n<p>What I think I need is some way to either check that no Spring beans are still executing, or to flag that all items sent to the gateway have been completely processed before terminating. </p>\n\n<p><strong>My question is, how might I go about doing either of these, or is there a better approach to my problem I haven't thought of?</strong></p>\n"},{"tags":["java","multithreading","java-ee"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12948016,"title":"How to read single file with mutiple instances in java and j2ee","body":"<p>I am having a file sub.srt and am reading that using multiple instances simultaneously . It works fine.Is this possible to work same in webapplication with servlets and jsp?</p>\n\n<p>This is the main file</p>\n\n<pre><code>public class SingleTest \n{\npublic static void main(String args[]) throws Exception\n{\n    String s[]= new String[10];\n\n    for(int i = 1;i&lt;=10;i++)\n\n        {\n         SingleFileThread sft1 = new SingleFileThread(i); \n         sft1.start();\n        }\n}\n\n}\n</code></pre>\n\n<p>This is the Thread to create multiple instances to read a single file</p>\n\n<pre><code>public class SingleFileThread extends Thread \n {\npublic int t =0;\npublic SingleFileThread(int i)\n{\n    t = i;\n}\n  public void run()\n   {\n   try{\n      File f = new File(\"E:\\\\Leo-Softwares\\\\workspace\\\\SingleFileThread     \\\\src\\\\test\\\\sub.srt\");\n      System.out.println(\"f.setReadOnly() :\"+f.setReadOnly());\n      FileInputStream fstream = new FileInputStream(f);\n      DataInputStream in = new DataInputStream(fstream);\n      BufferedReader br = new BufferedReader(new InputStreamReader(in));\n      String strLine;\n      while ((strLine = br.readLine()) != null)   {\n          System.out.println (\"Thread :\"+t+\"_____\"+strLine);\n      Thread.sleep(2000);\n      }\n\n      in.close();\n        }catch (Exception e){\n      System.err.println(\"Error: \" + e.getMessage());\n      }\n  }\n  }\n</code></pre>\n"},{"tags":["java","multithreading","swing","tabs","jtabbedpane"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12946819,"title":"The tab added in JTabbedPane doesn't show up","body":"<p>I have <strong>VTreePanel</strong> class that extends from CPanel which extends from JPanel. The class has a <strong>JSplitPane</strong> object that is divided into two area: left &amp; right. The left side contains tree menu selection object. At right side, it contains <strong>JTabbedPane</strong> object. The VTreePanel class is like this:</p>\n\n<pre><code>public final class VTreePanel extends CPanel\n    implements ActionListener\n{\n    private JSplitPane centerSplitPane = new JSplitPane();\n\n    private JTabbedPane tabbedPane;\n\n    ...\n\n    // GET method for the tabbedPane    \n    public JTabbedPane getTabbedPane() {\n        return tabbedPane;\n    }\n\n    // Constructor\n    public VTreePanel(int WindowNo, boolean hasBar, boolean editable)\n    {\n\n        ...\n\n        tabbedPane = new JTabbedPane();\n        centerSplitPane.add(treePart, JSplitPane.LEFT);\n        centerSplitPane.add(tabbedPane, JSplitPane.RIGHT);  // Look at this\n\n        ...\n    }\n\n}\n</code></pre>\n\n<p>In constructor, I added the tree selection (treePart) and JTabbedPane object (<strong>tabbedPane</strong>) into the JSplitPane object (centerSplitPane). I don't add any Tab into the tabbedPane yet. Look at the screenshot below:</p>\n\n<p><a href=\"http://i45.tinypic.com/2v3j0nl.jpg\" rel=\"nofollow\">http://i45.tinypic.com/2v3j0nl.jpg</a></p>\n\n<p>Then how do I add the tab when user click one of the menu?</p>\n\n<p>I have <strong>AMenu</strong> class where it has implemented PropertyChangeListener that fired propertyChange method when user clicked a menu:</p>\n\n<pre><code>public final class AMenu extends CFrame\n    implements ActionListener, PropertyChangeListener, ChangeListener\n{\n\n    private VTreePanel treePanel = null;    // this is the VTreePanel object\n\n    ...\n\n    public void propertyChange(PropertyChangeEvent e)\n    {\n        ...\n\n        // Here I pass the VTreePanel object as parameter to AMenuStartItem thread object\n        (new AMenuStartItem(cmd, true, sta, this, treePanel)).start();\n    }\n\n}\n</code></pre>\n\n<p>You can see that I have VTreePanel object (<strong>treePanel</strong>) and I pass the VTreePanel object as parameter to <strong>AMenuStartItem</strong> thread. The AMenuStartItem contains logic that perform adding Tab in JTabbedPane (remember, JTabbedPane object (tabbedPane) is in the VTreePanel).</p>\n\n<p>Here is the <strong>AMenuStartItem</strong> thread class:</p>\n\n<pre><code>public class AMenuStartItem extends Thread implements ActionListener\n{\n    private VTreePanel m_vtreePanel;\n\n    public AMenuStartItem (int ID, boolean isMenu, String name, AMenu menu, VTreePanel vtreepanel)\n    {\n        ...\n\n        m_vtreePanel = vtreepanel;  // save the VTreePanel object\n    }\n\n    // The thread method that executed when thread is started\n    public void run()\n    {\n        ...\n\n        startWindow(0, cmd);\n\n        ...\n    }\n\n    private void startWindow(int AD_Workbench_ID, int AD_Window_ID)\n    {\n        ...\n\n        // Here I perform adding new tab\n        m_vtreePanel.getTabbedPane().addTab(frame.getTitle(), frame.getAPanel());\n\n        ...\n    }\n\n}\n</code></pre>\n\n<p>So, the <strong>getTabbedPane()</strong> returned the JTabbedPane object and the addTab() method is executed but no tab showed up at all.</p>\n\n<p>Anyone know how to fix this problem?</p>\n"},{"tags":["c++","multithreading","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12947161,"title":"can you specify the next thread to execute?","body":"<p>I'm using c++ and was just curious if I could specify which thread I want to execute next. I'm overwriting a couple of the pthread_mutex functions in order to set the order of execution in a multithreaded program.</p>\n"},{"tags":["multithreading","qt4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12946209,"title":"QThread::finished() is never emitted?","body":"<p>I don't have a forever loop <a href=\"http://stackoverflow.com/questions/12942461/qthread-finished-signal-is-never-emited?rq=1\">like this question</a>, but it still doesn't emit the finished() signal,</p>\n\n<p>In the constructor of a class:</p>\n\n<pre><code>connect (&amp;thread, SIGNAL(started()), SLOT(threadFunc()));\nconnect (&amp;thread, SIGNAL(finished()), SLOT(finished()));\n</code></pre>\n\n<p>In the finished() function, </p>\n\n<pre><code>void XX::finished()\n{\n  qDebug() &lt;&lt; \"Completed\";\n}\n\nvoid XX::threadFunc()\n{\n  qDebug() &lt;&lt; \"Thread finished\"; // only single line, finishes immediately\n}\n</code></pre>\n\n<p>But I never see the <code>finished()</code> get called, everytime before I start the thread with <code>thread.start()</code>, I must call <code>thread.terminate()</code> manually, did I misunderstood the usage of QThread?</p>\n"},{"tags":["ios","multithreading","synchronized","locks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12946805,"title":"ios allow a specific number of threads on using a method at the same time","body":"<p>I understand that </p>\n\n<pre><code> @synchronized(self) { /* lock is effective inside here only */ } \n</code></pre>\n\n<p>can keep multiple threads from accessing your method at the same time. So no one will be able to access what's inside the @synchronized{} while it is being used.</p>\n\n<p>I there someway that I will allow only a limited number of threads, for example allow only 2 threads or 3 threads to access the method at the same time.</p>\n\n<p>PS: I have a method which send synchronous Request, and I want to limit sending synchronous request at maximum of 3 at a time</p>\n\n<pre><code>   @synchronized(self) { \n  webData  = [NSURLConnection sendSynchronousRequest: request returningResponse: &amp;response  error: &amp;error]; \n   }\n</code></pre>\n"},{"tags":["c","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":81,"score":3,"question_id":12945401,"title":"Compute primes with multiple threads","body":"<p>I am trying to understand threading. I am trying to have multiple threads compute primes. I want one thread to compute the first number then have the next thread compute the next number and so forth then whichever thread finds the prime print it.</p>\n\n<p>So, start with 1 to 50. pass a new number toa new thread. I think thats what we want.</p>\n\n<p>Heres what i have so far. </p>\n\n<pre><code>void* compute_prime (void* arg)\n{\n//pthread_mutex_lock(&amp;lock);\nint candidate = 2;\nint n = *((int*) arg);\n\nwhile (1) {\nint factor;\nint is_prime = 1;\n\n/* Test primality by successive division.  */\nfor (factor = 2; factor &lt; candidate; ++factor)\n  if (candidate % factor == 0) {\n    is_prime = 0;\n    break;\n  }\n/* Is this the prime number we're looking for?  */\nif (is_prime) {\n  if (--n == 0)\n    /* Return the desired prime number as the thread return value.  */\n\n    return (void*) candidate;\n}\n++candidate;\n}\n\nreturn NULL;\n}\n\n\n\n\nint main ()\n{\nint which_prime = 50;\nint isPrime1, isPrime2, isPrime3, isPrime4;\nfprintf (stderr, \"main thread pid is %d\\n\", (int) getpid ());\nfor(master_list; master_list &lt; which_prime; master_list++)\n{\n//do{\n\n// pthread_mutex_lock(&amp;lock); \n\npthread_create (&amp;thread1, NULL, &amp;compute_prime, &amp;master_list);\n//master_list++;\n//pthread_mutex_unlock(&amp;lock);\n\n//}while(master_list &lt; which_prime);\n\n}\n\nreturn 0;\n}\n</code></pre>\n\n<p>my output. </p>\n\n<pre><code>main thread pid is 508\nThread1 Found the prime number:  3.\nThread2 Found the prime number:  3.\nThread3 Found the prime number:  3.\nThread4 Found the prime number:  3.\nThread1 Found the prime number:  7.\nThread2 Found the prime number:  7.\nThread3 Found the prime number:  7.\nThread4 Found the prime number:  7.\nThread1 Found the prime number:  13.\nThread2 Found the prime number:  13.\nThread3 Found the prime number:  13.\nThread4 Found the prime number:  13.\n</code></pre>\n\n<p>etc....</p>\n\n<p>Which is somewhat what i want. But not every thread should find the same prime. They should be finding different primes. Even if i increment the variable before the thread it still wont work. I commented out the code that i tried to get it to work. what do i need to do? I hope i was clear. </p>\n"},{"tags":["ios","multithreading","uiscrollview","objective-c-blocks","blocks"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12946434,"title":"UIScrollView animation problems","body":"<p>I'm using a horizontal UIScrollView that displays photos on the first half of the screen. (Imagine a CGRect (0,0,320,120). The first scrollView is embedded in a second scrollview, which takes all the screen. When I scroll down the page (thus the second scrollView), the first scrollview stop being animated. I programmed a NSTimer to change photo every 3 seconds in the first UIScrollView, but while I'm scrolling the second scrollView, it seems like the animations are being queued. When I release my finger of the screen, there are few photo transitions (i.e: 2 changes if I scrolled without stoping for 6 seconds). <strong>In short:</strong> how can I make use of blocks (or something else) to continue my animations while I'm scrolling the second scrollView?</p>\n\n<p>My NSTimer (in viewDidLoad):</p>\n\n<pre><code>timer = [NSTimer scheduledTimerWithTimeInterval:3.0 target:self selector:@selector(changePage:) userInfo:nil repeats:YES];\n</code></pre>\n"},{"tags":["c#","multithreading","concurrency","concurrentdictionary"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12946377,"title":"How should I implement the Func in AddOrUpdate() in this object: ConcurrentDictionary<int, List<MyObject>>","body":"<p>How do I implement <code>AddorUpdate</code> in ConcurrentDictionary so that I can correctly update the value, if that value is a collection?</p>\n\n<p>My concern is that since TValue is a reference type I might run into the situation where I call TValue multiple times in a race condition.  I would test this myself, but my syntax is wrong so I can't proceed further.</p>\n\n<p>What must I change to make this work?</p>\n\n<pre><code>   public class TrustList :  ConcurrentDictionary&lt;int, List&lt;TrustRelationshipDetail&gt;&gt;\n    {\n        public void AddOrUpdateTrustDetail(TrustRelationshipDetail detail)\n        {\n            List&lt;TrustRelationshipDetail&gt; detailList = new List&lt;TrustRelationshipDetail&gt;();\n            detailList.Add(detail);\n\n            this.AddOrUpdate(detail.HierarchyDepth, detailList, (key, oldValue) =&gt;   \n            oldValue.Add(detail)  // &lt;--- Compiler doesn't like this, and I think this may cause duplicates if this were to be called...\n           );\n        }\n    }\n</code></pre>\n"},{"tags":["c++","multithreading","stl","c++11"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":203,"score":3,"question_id":12931787,"title":"C++11 STL containers and thread safety","body":"<p>I have trouble finding any up-to-date information on this.</p>\n\n<p>Do C++11 versions of STL containers have some level of thread safety guaranteed?</p>\n\n<p>I do expect that they don't, due to performance reasons. But than again, that's why we have both <code>vector::operator []</code> and <code>vector::at</code>.</p>\n"},{"tags":["xcode","multithreading","performance","instruments","xnu"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12709995,"title":"XNU Thread States color-coded in Xcode/Instruments","body":"<p>I am doing some analysis of a multi-threaded application using the Apple Instruments tools, which give a lot of information I'm trying to make sense out of. I am trying to find a good resource to describe the thread states which are color-coded in the tool. I've been looking into XNU Kernel documentation and books but without much luck.</p>\n\n<p>There is a lot of yellow and purple which correspond to the \"preempted\" and \"supervisor\" modes (the full color chart is described in the upper right pop up in the attached image). Given I'm spending so much time in these states as opposed to the \"running\" state (in blue), I would be particularly interested in knowing what they refer to and whether it is possible/desirable to minimise the time spent in these states.</p>\n\n<p><img src=\"http://i.stack.imgur.com/I1auN.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","winforms","multithreading","enterprise-library"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12938709,"title":"Performance tuning delimited file read and writes to the database","body":"<p>I am in need of help speeding up my app please. The application reads about 53,000 lines of delimited records, parses each row, and then proceeds to send each row to the database to be written. So far, I have identified the Database end as the major bottleneck,and I would appreciate help tuning this up please. Currently, it takes about 20 minutes to process all the records(53,000) with 190 fields each, I would like to significantly reduce that number starting with the code that sends the data to the database.</p>\n\n<p>I use Enterprise Library 5, taking advantage of connection pooling there) to connect to the db like so </p>\n\n<pre><code>   internal void SaveItem(String connString)\n    {\n        try\n        {\n            ImportDataAccessor dbacess = new ImportDataAccessor(connString);\n\n            foreach (ItemDetail item in itemEZdetails)\n            {\n                if (dbacess.SaveProduct(RecordID, item))\n                {\n                    updatecounter++;\n                }\n            }\n            successfulsaves = dbacess.RowsProcessed;\n            updatecounter = dbacess.TotalRows;\n        }\n        catch (Exception ex)\n        {\n            throw ex;\n        }\n    }\n\n\npublic bool SaveProduct(String RecordUID, ItemDetail item)\n{\n //. . . . start function here\n DbCommand insertCommand = db.GetStoredProcCommand(\"IDW_spEZViewRecordImport\");\n db.AddInParameter(insertCommand, \"SessionUID\", DbType.String, recordUID);\n  // the other 189 Parameters go here \n        int rowsAffected = db.ExecuteNonQuery(insertCommand);\n                   // Object sreturnval = (String)db.GetParameterValue(insertCommand, \"ReturnVal\");\n                    String returnval = String.Empty;\n                    if ( ! (db.GetParameterValue(insertCommand, \"ReturnVal\") == DBNull.Value))\n                        returnval = (String)db.GetParameterValue(insertCommand, \"ReturnVal\");\n                    if (returnval == \"60\")\n                        RowsProcessed++;\n                    result = rowsAffected &gt; 0;\n}\n//end of line add\n</code></pre>\n\n<p>How do I achieve this with the code I have now. Thanks in advance. </p>\n"},{"tags":["java","multithreading","task","javafx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12945018,"title":"Chat message not recived while in Thread (JavaFx)","body":"<p>So i have created this clientListner that listens to the chat that comes in. but it seems that my program can only run the method once because it stops after the first. i have created a small loop it has to do before doing the actual code this way i could see if the thread actually repeated and it seems to work but it cannot recive new information from the server.</p>\n\n<p>Also am i doing the 2nd part of my program right to use Task in my controller class or should this be done in a different way if i want to update the GUI every time a new message is recived from the server?</p>\n\n<p><strong>Inside my GUI (JavaFx) this is my controller class</strong></p>\n\n<pre><code>public void run(){\n        while (c.getSocket().isConnected()) {\n            chat.clear();\n            System.out.println(chat.toString());\n            for (int i = 0; i &lt; 10; i++) {\n                System.out.println(i);\n            }\n            if (c.getInput().hasNext()) {\n\n                System.out.println(\"jeg er her\");\n                chat.add(c.getInput().next());\n                System.out.println(chat.toString());\n                setRecived();\n                try {\n                    Thread.sleep(4000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(\"Thread woke up\");\n        }\n    }\n</code></pre>\n\n<p>*<strong><em>My Clientlistner *</em></strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.util.ArrayList;\n\nimport com.sun.javafx.tk.quantum.UploadingPainter;\n\nimport javafx.application.Platform;\nimport javafx.beans.value.ChangeListener;\nimport javafx.beans.value.ObservableValue;\nimport javafx.concurrent.Task;\nimport javafx.concurrent.Worker;\nimport javafx.scene.control.TextArea;\nimport javafx.scene.control.TextField;\n\n\npublic class ClientListner extends Thread {\n    public Client c;\n    public boolean recived = false;\n    public ArrayList&lt;String&gt;chat = new ArrayList&lt;&gt;();\n    public ClientListner(Client c){\n        this.c = c;\n\n    }\n    public void run(){\n        while (c.getSocket().isConnected()) {\n            chat.clear();\n            System.out.println(chat.toString());\n            for (int i = 0; i &lt; 10; i++) {\n                System.out.println(i);\n            }\n            if (c.getInput().hasNext()) {\n\n                System.out.println(\"jeg er her\");\n                chat.add(c.getInput().next());\n                System.out.println(chat.toString());\n                setRecived();\n                try {\n                    Thread.sleep(4000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n            System.out.println(\"Thread woke up\");\n        }\n    }\n    private void checkCommand(int i) {\n        switch (i) {\n        // case 2 er recive chat:\n        case 2:\n            c.getInput().nextInt();\n            chat.add(c.reciveChat().toString());\n            setRecived();\n            break;\n\n        default:\n            break;\n        }\n\n    }\n    public ArrayList&lt;String&gt; getChatMessage(){\n        recived = false;\n        return chat;\n    }\n    public boolean getRecived(){\n        return recived;\n    }\n    public void setRecived(){\n        if (recived) {\n            recived = false;\n        }else {\n            recived = true;\n        }\n    }\n\n\n}\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":155,"score":0,"question_id":10302466,"title":"How to kill a thread running in a new activity","body":"<p>So activity starts and I create a Thread which checks when to go to the next activity. But sometimes I need this activity to kill itself. onPause does this, but after that Thread is still alive and after time runs out it start a new activity. Is it possible to kill this Thread and stop goToFinals intent?</p>\n\n<pre><code> public class Questions extends Activity {\n\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        String in = getIntent().getStringExtra(\"time\");         \n        long tmp = Long.parseLong(in);\n        endTime = (long) System.currentTimeMillis() + tmp;\n\n        Thread progress = new Thread(new Runnable() {\n\n            public void run() {\n                while(endTime &gt; System.currentTimeMillis()) {\n                    try {\n                        Thread.sleep(200);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                Intent goToFinals = new Intent(Questions.this,End.class);\n                        startActivity(goToFinals);\n            }\n\n        });\n        progress.start();\n\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        finish();\n    }\n}\n</code></pre>\n"},{"tags":["python","multithreading","gtk","pygtk","multiprocessing"],"answer_count":0,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":105,"score":5,"question_id":12933970,"title":"PyGTK Multiprocessing and Updating GUI","body":"<p>I am trying to enable and disable a stop button for audio playback in a GUI created using Glade PyGTK 2.0. </p>\n\n<p>The program basically works by running and external process to play the audio. </p>\n\n<p>I am using multiprocessing(as threading is too slow) and I can't get the stop button to disable. I understand this is due to processes not being able to access the memory shared by the gtk widget thread.</p>\n\n<p>Am I doing something wrong, or is there any way to enable the button once the process exits?</p>\n\n<pre><code>#!/usr/bin/python\nimport pygtk\nimport multiprocessing\nimport gobject\nfrom subprocess import Popen, PIPE\npygtk.require(\"2.0\")\nimport gtk\nimport threading\n\ngtk.threads_init()\n\nclass Foo:\n    def __init__(self): \n        #Load Glade file and initialize stuff\n\n    def FooBar(self,widget):\n        self.stopButton.set_sensitive(True)#make the Stop button visible in the user section\n        def startProgram():\n            #run program\n            gtk.threads_enter()\n            try:\n                self.stopButton.set_sensitive(False) \n            finally:\n                gtk.threads_leave()\n            print \"Should be done now\"\n\n        thread = multiprocessing.Process(target=startProgram)\n        thread.start()\n\nif __name__ == \"__main__\":\nprog = Foo()\ngtk.threads_enter()\ngtk.main()\ngtk.threads_leave()\n</code></pre>\n\n<p><strong>EDIT:</strong> Never mind, I figured it out. I had not implemented threading properly and that caused the lag. It works fine now. Just have to change the FooBar method to:</p>\n\n<pre><code>    def FooBar(self,widget):\n        self.stopButton.set_sensitive(True)#make the Stop button visible in the user section\n        def startProgram():\n            #run program\n            Popen.wait() #wait until process has terminated\n            gtk.threads_enter()\n            try:\n                self.stopButton.set_sensitive(False) \n            finally:\n                gtk.threads_leave()\n            print \"Should be done now\"\n\n        thread = threading.Thread(target=startProgram)\n        thread.start()\n</code></pre>\n"},{"tags":["c#","multithreading","windows-services","weak-references"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":200,"score":2,"question_id":7982219,"title":"Is static List<WeakReference> needed?","body":"<p>I'm reverse engineering a old windows service that was written in vb.net using ILSpy. I want to rewrite the legacy service in C#. The original service leaks memory. </p>\n\n<p>When I have a look at the source there is the following declaration in the service class:</p>\n\n<pre><code>private static List&lt;WeakReference&gt; __ENCList = new List&lt;WeakReference&gt;();\n</code></pre>\n\n<p>This list is used only used in the constructor as follows(imineRun is the service class):</p>\n\n<pre><code>List&lt;WeakReference&gt; _ENCList = imineRun.__ENCList;\n            Monitor.Enter(_ENCList);\n            try\n            {\n                imineRun.__ENCList.Add(new WeakReference(this));\n            }\n            finally\n            {\n                Monitor.Exit(_ENCList);\n            }\n</code></pre>\n\n<p>Could this list be causing the memory leaks? Is this list needed and what is its purpose?</p>\n"},{"tags":["multithreading","block","winsock","send","blocking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12943219,"title":"Winsock send() blocks server?","body":"<p>I have read that the send() function on Winsock blocks until the ACK from the last packet is recieved. Now I am playing with a server for a turn based role playing game. Everything is handled by one thread (for 64 sockets). A request is recieved, handled and a response written to the socket(s). This process cannot be interrupted.</p>\n\n<p>Is it possible to handle, say 1000 clients (one thread for every 64 sockets) with this method?</p>\n\n<p>Wouldn't it block the whole server if a send() takes too long to complete or the client maliciously does not send the ACK or the connection gets interrupted?</p>\n\n<p>Shall I split the logic of networking and request handling into 2 threads? If so the thread handling the network transfers could still be blocked by a send() or recv().</p>\n\n<p>Or would it be best to use overlapped I/O?</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12942998,"title":"C# is it possible to change priority of acquiring a lock?","body":"<p>If there are multiple threads all waiting on the same lock is it possible to have the Main thread have higher priority in acquiring the lock. Meaning that if worker threads go to the <code>lock</code> statement before the main thread, the main thread would acquire the lock before the other threads that were already waiting on it. </p>\n"},{"tags":["c++","multithreading","c++11"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":111,"score":5,"question_id":12935888,"title":"C++ kill method without constantly checking flags","body":"<p>I have several work functions, that call accessory functions that might have something bad happen. I want to be able to stop the work functions if an accessory function determines something bad happened, without putting numerous flag checks in the work functions. For example,</p>\n\n<pre><code>struct Worker {\n    bool badhappened = false;\n    Worker() {\n        std::thread([&amp;]() {\n            while ( not badhappened );\n            // kill the work\n        }).detach();\n    }\n    int WorkComponent {\n        if ( badhappening() )\n            badhappened = true;\n        return someint;\n    }\n    void DoWork {\n        // WorkComponents called several times\n    }\n}\n</code></pre>\n\n<p>But I don't know what to call at <code>kill the work</code>. It's not a problem for <code>DoWork</code> to happen in a separate thread, but there doesn't appear to be an equivalent <code>pthread_kill</code> in C++'s threads. Is there a solution that doesn't involve putting several <code>if(badhappened) return;</code> calls into <code>DoWork</code>?</p>\n"},{"tags":["memory","tomcat","multithreading","limit","sandbox"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":497,"score":2,"question_id":1632430,"title":"Does Tomcat sandbox web apps?","body":"<p>Does Tomcat sandbox apps, like running them on a separate JVM or of some sort?</p>\n"},{"tags":[".net","multithreading","concurrency","synchronization"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12941880,"title":"AbandonedMutexException and ThreadPool.RegisterWaitForSingleObject","body":"<p>The <code>WaitOne</code> method of the <code>Mutex</code> object can throw the <code>AbandonedMutexException</code>. Thus by waiting for the mutex I'm able to distinguish between <em>normal</em> and <em>abandoned</em> state.</p>\n\n<p>Another way to waiting is to register a callback using the <code>ThreadPool.RegisterWaitForSingleObject</code> method. Within the callback (which is executing in another thread) I know that the mutex has been signaled (the callback is being invoked), I even know whether the waiting has been timed out, but there is no way to know whether the mutex has been <em>abandoned</em>.</p>\n\n<p>Is it correct?</p>\n"},{"tags":["c++","multithreading","corba","orbacus"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12933790,"title":"Is it possible to have several ORB objects in the same process?","body":"<p>I use <a href=\"http://www.progress.com/en/orbacus/index.html\" rel=\"nofollow\">ORBacus</a>. I have a multithreading application and I want to have <strong>several ORB objects in the same process</strong>. The idea is: <strong>each thread to have its own ORB and to be connected to <em>different</em> server</strong>.</p>\n\n<p>Is this even possible? If so - how?</p>\n\n<hr>\n\n<p>\"<em>What have you tried?</em>\" : I have </p>\n\n<pre><code>CORBA::ORB_var m_varOrb;\n</code></pre>\n\n<p>in each thread. Each thread calls. Each thread has <code>Reconnect</code> method, which executes:</p>\n\n<pre><code>// ...\nm_varOrb = CORBA::ORB_init( argc, argv );\n</code></pre>\n\n<p>The issues, I have:</p>\n\n<ul>\n<li><p>when several threads are trying to reconnect at the same time, the application crashes in <code>m_varOrb-&gt;destroy();</code> or in <code>CORBA::ORB_init</code>.</p></li>\n<li><p>I tried to sync the threads, so that all threads try to reconnect to the configured server one by one (using a <code>static mutex</code>) - still not working - when one thread tries to destroy \"its\" ORB object - crash again in <code>destroy</code> (some assert fails, because some reference count is > 1; looks like a reference counting pointer to the real ORB object)</p></li>\n<li><p>I added a <em>conditional wait</em>, so the threads start calling <code>ORB_init</code> only when all threads has executed <code>destroy</code>; made a <strong>singleton</strong> wrapper class around the ORB, sync-ed the threads to connect one after the other and everything started working perfectly fine. <strong>BUT this means - only one ORB, so <em>only one server.</em> Bad.</strong></p></li>\n</ul>\n\n<p>So, all of these things made me thing, that I'm allowed to have <strong>only one ORB object per process</strong>. Am I missing something?</p>\n"},{"tags":["c++","multithreading","winapi"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12941056,"title":"Simple thread with wait function","body":"<p>I cannot understand why next code doesn't work. It compile correct, but doesn't output anything. Can you help me?</p>\n\n<pre><code>HANDLE hEvent;\nunsigned int WINAPI MyThread(void *p)\n{\n    WaitForSingleObject(hEvent, INFINITE);\n    _tprintf(TEXT(\"%s\\n\"),p);\n    return 0;\n}\n\nint _tmain(int argc, TCHAR *argv[])\n{\n    hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n    unsigned int ThreadID;\n    HANDLE hThread1 = (HANDLE)_beginthreadex(NULL, 0, MyThread, L\"hello world\", 0, &amp;ThreadID);\n    SetEvent(hEvent);\n    return 0;\n}\n</code></pre>\n"},{"tags":["java","multithreading","swing","listeners","event-dispatch-thread"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12940530,"title":"Should my custom events fire on GUI EDT or a \"home-grown\" EDT","body":"<p>I'm working on a project that does some intense math calculations (arrays of matrices, vectors, etc.), so naturally I'm splitting the work into jobs, and submitting them to a CompletionService to perform the work in parallel.</p>\n\n<p>Each of the job objects can fire events to notify applications when the job starts, ends, progresses, and/or fails.</p>\n\n<p>Currently, each of the jobs receive a handle to the entire list of event listeners, and simply iterate through, passing an event object to each one (in the same thread). This doesn't sit well with me, so I'd like to get other peoples' experience with doing this sort of thing with custom events/listeners.</p>\n\n<p>Should I send my events to the GUI thread? Some of the listeners may or may not be GUI-related, and I'd like to not force users of my code to have to manually send their events onto the GUI thread, something like the following:</p>\n\n<pre><code>public class MyFooEventListener implements FooEventListener {\n    public void notifyJobStarted(FooEvent evt) {\n        // I want to avoid having users of my library write the following, right?\n        SwingUtilities.invokeLater(new Runnable(){\n            // update GUI here.\n        });\n    }\n}\n</code></pre>\n\n<p>I wouldn't mind writing my own EventQueue, as this is for a research project in school, and I suppose it would be a good exercise in concurrency. Just trying to figure out what the \"proper\" way of implementing an event-driven system is, how to properly fire events, etc. Links to articles/tutorials and howtos are also greatly appreciated.</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>My event model has multiple event types, such as <code>JobStartedEvent</code>, <code>JobEndedEvent</code>, <code>JobProgressEvent</code>, etc. Is this a bad approach? Should I have a single event type, and if so, how do I pass information to the listeners that is not common to all events? Example: I want to pass a double in the range [0-1] for the progress event, but that is not applicable for an event like JobFailureEvent. What's the best approach to handling this?</p>\n\n<p>I could put the extra information in the \"source\" object itself, but my source objects are the Job objects themselves, and it doesn't sit well with me to \"leak\" references to the job object, especially while it is running:</p>\n\n<pre><code>FooJob jobObject = (FooJob)event.getSource();\nint progressPercent = jobObject.getCurrentProgress() * 100;\nprogressLabel.setText(progressPercent + \"%\");\n</code></pre>\n"},{"tags":["multithreading","perl","testing","selenium2","alien"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12937784,"title":"Simple perl multithreading for Alien::SeleniumRC","body":"<p><a href=\"https://metacpan.org/module/Alien%3a%3aSeleniumRC\" rel=\"nofollow\">Alien::SeleniumRC</a> says about its <code>start</code> method that \"This call will block until the server is killed.\"</p>\n\n<p>I'd like to use it to start the Selenium server, run some Selenium tests, then shut down the Selenium server--all from a single <code>perl</code> script.  What's the simplest clean way of achieving this?  (By clean I mean that if something goes wrong, it will shut down the Selenium server on the way out so it doesn't need to be shut down manually.)</p>\n"},{"tags":["arrays","multithreading","cuda","gpgpu"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12931900,"title":"cuda number of threads","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6490572/cuda-how-many-concurrent-threads-in-total\">CUDA: How many concurrent threads in total?</a>  </p>\n</blockquote>\n\n\n\n<p>I'm pretty new at cuda and I'd like to ask what's the max number of threads I can use on a GeForce GTX 285, and how do I calculate that number?\nAlso, can I use an array at my kernel -stored at global memory- that has unsigned chars and over 2 M elements? Is this possible?\nthank you very much.</p>\n"},{"tags":["c++","windows","multithreading","winapi","beginthread"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12939077,"title":"The stack size argument in beginthread","body":"<p>I thought I knew what the stack size argument in beginthread means. So my question is: why does this work?</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;iostream&gt;\n#include &lt;process.h&gt;\n\nusing namespace std;\n\nvoid huge_stack(int a, int b, int c, int d)\n{\n    int i[100000] = {0};\n    cout &lt;&lt; a &lt;&lt; b &lt;&lt; c &lt;&lt; d &lt;&lt; i[12333] &lt;&lt; endl;\n}\n\nbool done = false;\n\nvoid thread(void* p)\n{\n    huge_stack(1,2,3,4);\n    done = true;\n}\n\nint main()\n{\n    _beginthread(thread, 10, nullptr);\n\n    while(!done) {}\n\n    return 0;\n}\n</code></pre>\n\n<p>I made sure I'm building in Debug mode, so the calls and arrays won't be optimized.</p>\n"},{"tags":["java","android","multithreading","blocking"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12940142,"title":"Why is my Service's AsyncTask blocking AsyncTasks from the main Activity?","body":"<p>I'm trying to write a simple Service that will do something every few seconds. But when I run the Service while trying to run other AsyncTasks in the main Activity, I noticed that the other AsyncTasks get stuck at onPreExecute. When I disabled the service, everything worked as expected. Is there a reason why the Service's AsynTask is blocking the other AsyncTasks?</p>\n\n<p><strong>Service</strong></p>\n\n<pre><code>public class SVC_SyncData extends Service {\n\n    private final String TAG = \"SVC_SyncData\";\n\n    private AT_SyncData m_SyncPoll = null;\n\n    public static boolean isRunning = false;\n\n    public SVC_SyncData() {\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        Log.i(TAG, \"onCreate\");\n        m_SyncPoll = new AT_SyncData(this);\n    }\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Log.i(TAG, \"onStartCommand\");\n        m_SyncPoll.execute();\n        isRunning = true;\n        return START_STICKY;\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n        Log.i(TAG, \"onDestroy\");\n        m_SyncPoll.cancel(false);\n        isRunning = false;\n    }\n}\n</code></pre>\n\n<p><strong>AT_SyncData's doInBackground</strong></p>\n\n<pre><code>@Override\nprotected Void doInBackground(Void... params) {\n    Log.i(TAG, \"doInBackground\");\n\n    try {\n        while (!isCancelled()) {\n            Log.i(TAG, \"syncData\");\n\n            // Sleep until next cycle\n            Thread.sleep(5000);\n        }\n    }\n    catch (Exception ex) {\n        ex.printStackTrace();\n    }\n\n    return null;\n}\n</code></pre>\n"},{"tags":["java","multithreading","singleton"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12939671,"title":"Singleton class accessed from another class","body":"<p>I have a scenario where I have to connect to virtual center and get data. I have implemented a singleton class so that two threads cannot access the VC at the same time, as it has give concurrent access issue. My code is as follows:</p>\n\n<pre><code>public class Connector {    \nprivate static Connector instance ;    \nprivate Connector(String urlStr, String username, String password) {\n    connect(urlStr, username, password);\n}    \npublic static synchronized Connector getInstance(String urlStr, String username, String password) {\n    if (instance == null){\n        instance = new Connector(urlStr,username,password);\n        System.out.println(\"creating instance\");\n    }\n    return instance ;\n}   \npublic void connect(String urlStr, String username, String password) {\n    ClassLoader cl = Thread.currentThread().getContextClassLoader();\n    try {\n        //code to connect to VC\n        }\n\n    } catch (RuntimeException e) {\n        connectException = e;\n    } finally {\n        Thread.currentThread().setContextClassLoader(cl);\n    }\n}\n\n\npublic void disconnect() throws RuntimeFault, RemoteException {\n    //code for disconnect\n    }\n}\n</code></pre>\n\n<p>} </p>\n\n<p>I called this from another class in the following way:</p>\n\n<pre><code>Connector c = Connector.getInstance(dburl, dbuser, dbpass);\nc.connect(dburl, dbuser, dbpass);\n//code for getting data\nc.disconnect();\n</code></pre>\n\n<p>Now if I have 2 simultaneous requests to get data from viruatal center, one of them fails saying \"session is not authenticated\". \nCan you help we with a better way to deal with the issue. \nAnd as the same instance is used always, how can we differentiate if its a different Virtual Center. </p>\n"},{"tags":["java","multithreading","spring","hibernate","repository"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12936928,"title":"Problems with threads and hibernate sessions","body":"<p>Im using hibernate 3 and spring.\nWhen I start a thread an exception occurred:</p>\n\n<pre><code>org.hibernate.HibernateException: Illegal attempt to associate a collection with two open sessions\n</code></pre>\n\n<p>I dont know how to detach entities or close session with this architecture.\nI appreciate some help.</p>\n\n<p><code>CommunicationService.sendCommunications()</code> code:</p>\n\n<pre><code>public void sendCommunications(HibernateMessageToSendRepository messageToSendRepository)  {\n    Long messageId = new Long(41); //this is only for test. the idea is get a list of id and generate a thread group.\n    MessageSender sender = SmsSender(messageId, messageToSendRepository);\n    sender.start();\n}\n</code></pre>\n\n<p>Invoking <code>sendCommunications</code> code:</p>\n\n<pre><code>ApplicationContext appCont = new ClassPathXmlApplicationContext(\"appContext.xml\");      \nServiceLocator serviceLocator = ServiceLocator.getInstance();\nHibernateMessageToSendRepository messageToSendRepository = (HibernateMessageToSendRepository) appCont.getBean(\"messageToSendRepository\");\n\nCommunicationService communication = serviceLocator.getCommunicationService();\ncommunication.sendCommunications(messageToSendRepository);\n</code></pre>\n\n<p>SmsSender (extends from MessageSender (thread)) code:</p>\n\n<pre><code>public class SmsSender extends MessageSender {\n\n    public SmsSender(Long messageToSendId, HibernateMessageToSendRepository messageToSendRepository) {\n        super(messageToSendRepository);\n        MessageToSend messageToSendNew = this.messageToSendRepository.getById(messageToSendId);     \n        this.messageToSend = messageToSendNew;\n    }\n\n    public void run() {\n        try {\n            MessageToSendSms messageToSendSms = (MessageToSendSms) this.messageToSend;\n            Iterator&lt;CustomerByMessage&gt; itCbmsgs = messageToSendSms.getCustomerByMessage().iterator();          \n            while (itCbmsgs.hasNext()) {                \n                CustomerByMessage cbm = (CustomerByMessage) itCbmsgs.next();                        \n\n                //sms sending\n                this.getGateway().sendSMS(cbm.getBody(), cbm.getCellphone());                       \n                cbm.setStatus(CustomerByMessageStatus.SENT_OK);\n                cbm.setSendingDate(Calendar.getInstance().getTime());               \n            }           \n\n            messageToSendSms.getMessage().setStatus(messageToSendStatus.ALL_MESSAGES_SENT);\n            this.messageToSendRepository.update(messageToSendSms);      \n        } catch (Exception e) {         \n            this.log.error(\"Error en sms sender \" + e.getMessage());\n        }\n\n    }\n}\n</code></pre>\n\n<p><code>MessageToSendRepository</code> code:</p>\n\n<pre><code>public void update(MessageToSend messageToSend) {\n    try {\n        this.getSession().update(messageToSend);\n    } catch (HibernateException e) {\n        this.log.error(e.getMessage(), e);\n        throw e;\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","azure","background-process","compute"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12920782,"title":"Windows Azure Worker Role, what to do with the main thread?","body":"<p>So we're setting up a worker role with windows azure and it's running at a very high cpu utilization.  I think it has something to do with this section, but I'm not sure what to do about it.  Each individual thread that gets started has its own sleep, but the main thread just runs in a while loop. Shouldn't there be a sleep in there or something? </p>\n\n<pre><code>public class WorkerRole : RoleEntryPoint\n    {\n        private List&lt;ProcessBase&gt; backgroundProcesses = new List&lt;ProcessBase&gt;();\n\n        public override void Run()\n        {\n            // This is a sample worker implementation. Replace with your logic.\n            Trace.WriteLine(\"BackgroundProcesses entry point called\", \"Information\");\n\n            foreach (ProcessBase process in backgroundProcesses)\n            {\n                if (process.Active)\n                {\n                    Task.Factory.StartNew(process.Run, TaskCreationOptions.LongRunning);\n                }\n            }\n\n            while (true) { }\n        }\n</code></pre>\n\n<p>How about something like this, would this be appropriate?</p>\n\n<pre><code>  public override void Run()\n        {\n            // This is a sample worker implementation. Replace with your logic.\n            Trace.WriteLine(\"BackgroundProcesses entry point called\", \"Information\");\n\n            List&lt;Task&gt; TaskList = new List&lt;Task&gt;();\n\n            foreach (ProcessBase process in backgroundProcesses)\n            {\n                if (process.Active)\n                {\n                    TaskList.Add(Task.Factory.StartNew(process.Run, TaskCreationOptions.LongRunning));\n                }\n            }\n\n            Task.WaitAll(TaskList.ToArray());\n            //while (true) {  }\n        }\n</code></pre>\n"},{"tags":["c#",".net","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":7,"view_count":204,"score":-6,"question_id":11392357,"title":"c# multithread - very slow","body":"<p>I have created multi-threaded application following:</p>\n\n<p><a href=\"http://blog.milrr.com/2010/03/code-c-simple-multithreading-example.html\" rel=\"nofollow\">http://blog.milrr.com/2010/03/code-c-simple-multithreading-example.html</a></p>\n\n<p>It has a lot of performance issue. It looks, every thread execute one by one. </p>\n\n<p>1 thread completion time is 1-2 second and 30 threads has completion time 35-40 seconds.</p>\n\n<p>Please advise me what can be issue.</p>\n\n<p>I am using .net framework 3.5.</p>\n\n<p>Thanks</p>\n"},{"tags":["multithreading","operating-system"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12846053,"title":"Multithreads on kernel","body":"<p>In Galvin, I came across</p>\n\n<blockquote>\n  <p>Finally, many operating system kernels are now multithreaded; several threads operate in the kernel, and each thread performs a specific task.</p>\n</blockquote>\n\n<h3>Question 1</h3>\n\n<p>It does not imply that all of them will run at the same time, since at a given time only 1 process/thread can acquire control over the processor right? Though they could be doing various work, like one on CPU, other working on I/O like getting key strokes in the buffer etc., right?</p>\n\n<h3>Question 2</h3>\n\n<p>Multithreading will show better performance on multiprocessor systems only right?</p>\n"},{"tags":["java","eclipse","multithreading","sockets"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12938668,"title":"How to find out if all the resources(Threads, PrintWriters ect.) of a client/server socket connection are closed propely?","body":"<p>I am coding a client/socket connection and I am using ThreadPools to handle several clients.</p>\n\n<p>After my Server has started I have several Resouces used. I want to close all of them if f.ex.: the server says to the client it should shutdown, I want to close everything.</p>\n\n<p>I still coded a basic shutdown function:</p>\n\n<pre><code>public static void killClient() {\n    try {\n        threadpool.shutdown();\n        in.close();//client input\n        out.close();//client output\n        socket.close();\n    } catch(Exception e) {\n        System.out.println(\"Client has been shutdown! \" + e);\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>My question is:</p>\n\n<p>How to be sure that everything has closed propely and nothing still runs anymore?</p>\n"},{"tags":["java","multithreading","sockets","tcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12938178,"title":"How to find out number of connected client to the server with their IP (detail) over TCP using a ServerSocket?","body":"<p>I have a server program is running on my PC. The server program using socket to connect to many clients. Is there anyway to find out which client with witch IP is connected to the server at any time? Or how many clients are connected to the server?</p>\n"},{"tags":["c++","multithreading","qt","tcpserver"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":52,"score":-1,"question_id":12937930,"title":"QObject: Cannot create children for a parent that is in a different thread","body":"<p>I'm trying to implement a qtcpserver in a separate thread:</p>\n\n<pre><code>void Server::run()\n{\n    tcpserver = new QTcpServer(this);\n    connect(tcpserver, SIGNAL(newConnection()),SLOT(connection()));\n    tcpserver-&gt;listen(QHostAddress::Any, 1);\n}\n</code></pre>\n\n<p>But I'm getting this error when the application runs: </p>\n\n<pre><code>QObject: Cannot create children for a parent that is in a different thread.\n</code></pre>\n\n<p>What does this error mean and what do you do to fix it?</p>\n"},{"tags":["java","multithreading","swing","loops","event-dispatch-thread"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12937759,"title":"Displaying a loading JFrame while a loop is running in main thread","body":"<p>this is my first post so please inform me if I'm doing anything wrong.\nI've been working on a mini-applet to get the status of several nodes. This works by having a thread of each node which checks its uptime in a network class. Once it gets the status of the node it'll put it into a hashmap. I then check the status of that hashmap and wait till its content amount is equal to the total amount of nodes that we're checking. Once done it proceeds to display them on a screen. The problem is despite making this a heavily threaded application fetching the status for all nodes still takes a few seconds. During this time I want to display a separate JFrame with a loading bar (or even use the same JFrame if it would work.</p>\n\n<p>I'm not going to lie I'm a Java newbie and the code is horrible, I'm wondering if you guys could give me advice as to what I should do. Here is the code.</p>\n\n<p>--main node status window--</p>\n\n<pre><code>public NodeStatusWindow() {\n    super(Managment.getTitle() + \" - Nodes\");\n    setLayout(new FlowLayout());\n\n    Thread threada = new Thread(new ShowLoading());\n    threada.start();\n\n    System.out.println(\"Checking node status...\");\n\n    Nodes.nodeOnlineCurrent.clear();\n\n    for (int i = 0; i &lt; Nodes.getNodes().size(); i++) {\n        Object currentNode = Nodes.getNodes().keySet().toArray()[i];//\n\n        Thread thread = new Thread(new CheckUptime((int) currentNode));\n        thread.start();\n    }\n\n    while (Nodes.nodeOnlineCurrent.size() &lt; Nodes.getNodes().size()) {\n        System.out.println(Nodes.nodeOnlineCurrent.size() + \" &lt; \" + Nodes.getNodes().size());\n    }\n\n\n    for (int i = 0; i &lt; Nodes.nodeOnlineCurrent.size(); i++) {\n        JLabel[] nodeList = new JLabel[Nodes.getNodes().size()];\n        Object currentNode = Nodes.getNodes().keySet().toArray()[i];\n        nodeList[i] = new JLabel(\"Node: \" + currentNode.toString());\n\n        nodeList[i].setOpaque(true);\n\n        if (Nodes.nodeOnlineCurrent.get(currentNode)[0] == false) {\n            nodeList[i].setForeground(new Color(255, 0, 0)); //Red\n        } else if (Nodes.nodeOnlineCurrent.get(currentNode)[1] == false) {\n            nodeList[i].setForeground(new Color(230, 222, 0)); //Yellow\n        } else {\n            nodeList[i].setForeground(new Color(0, 230, 0)); //Green\n        }\n\n        add(nodeList[i]);\n    }\n</code></pre>\n\n<p>--Loading window. This class is created in the threada object in the class above--</p>\n\n<pre><code>public class NodeStatusLoadingWindow extends JFrame {\n    private static final long serialVersionUID = 1369511477485416862L;\n\n    private JLabel status;\n\n    public NodeStatusLoadingWindow() {\n        super(Managment.getTitle() + \" - Nodes\");\n        setLayout(new FlowLayout());\n\n        status = new JLabel(\"Loading...\");\n        add(status);\n    }\n\n    public void closeWindow() {\n        this.setVisible(false);\n        this.dispose();\n    }\n}\n</code></pre>\n\n<p>Here is the showLoading thread</p>\n\n<pre><code>public class ShowLoading implements Runnable {\n    public void run() {\n        try {\n            GUIHandler.drawNodeStatusLoadingWindow();\n        } catch (Exception e) {\n            System.out.println(\"Exception! \" + e.toString());\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net",".net","multithreading","iis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12923616,"title":"Potential pitfalls when launching long-running threads on Application_Start","body":"<p>I'm hoping to mold this post into a legitimate StackOverflow question, as I'd really like a solid understanding of this scenario, but I could definitely see if it's too localized or considered an \"opinion\".</p>\n\n<p>Here's my scenario: When I load my web app, I load a whole bunch of data from the database and cache it.  The problem is, this process takes about 10-15 seconds and creates a lag when the web server first starts up.  This is kinda annoying while developing, and also causes a few issues when I bounce the web server in production (since this is a new site, I'm often hot fixing small bugs as I find them, or mucking with IIS settings).</p>\n\n<p>I got to wondering - Can I offload this work into a new thread when the application starts, and have this going on in the background as other users are using the site?  Obviously, certain features wouldn't work for about 10-15 seconds when the site loaded, but I can handle that condition or block until the data becomes available.  At first, I was thinking no.  The web server was going to either terminate these threads if the request ended, or block until these threads finished.  I decided to write a little test app to test this theory:</p>\n\n<pre><code>public class Global : System.Web.HttpApplication\n{\n   void Application_Start(object sender, EventArgs e)\n   {\n      Thread thread = new Thread(LoadData);\n      thread.Start();\n   }\n\n   private void LoadData()\n   {\n      for (int i = 0; i &lt; 100; i++)\n      {\n         Trace.WriteLine(\"Counter: \" + i.ToString());\n         Thread.Sleep(1000);\n      }\n   }\n}\n</code></pre>\n\n<p>When the app starts, I launch a new thread, and just have it count to 100.  Much to my surprise, I immediately got to the home page and in my Visual Studio debug output window, I could see the incrementing numbers count up.  I was actually surprised this works.</p>\n\n<p><strong>My Questions:</strong></p>\n\n<p>First off, are there any gotchas with doing this?  Is it asking for trouble and is anything going to blow up?  Will this behavior change between web servers, or versions of IIS as perhaps they use different threading models?  I'm looking for overall feedback on this design.</p>\n"},{"tags":["iphone","objective-c","ios","xcode","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12933397,"title":"Sending messages from background thread to main thread on iOS","body":"<p>I have an iOS app where I am completing tasks on the background thread. As each task is completed I want to send a message to the main thread so I can move along my custom progress bar to the appropriate stage. </p>\n\n<p>What is the simplest, yet most secure way to achieve this?</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>This is the method I am using:</p>\n\n<pre><code>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, \n                                         (unsigned long)NULL), ^(void) {\n\n     // get background tasks done. \n     [self.background backgroundMethod];\n\n});\n</code></pre>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>Here is an example of what I would attempt using @Madboy's answer. Within the class where I perform methods in the background I have a pointer to my progress bar.  Do we think this would work? <strong>(Please note the change also to EDIT 1).</strong></p>\n\n<pre><code>@implementation BackgroundClass\n@synthesize delegate;\n@synthesize customProgressBar\n\n- (void)backgroundMethod\n{\n    // Run tasks\n}\n\n- (void)delegateSaysBackgroundMethodIsFinished\n{\n    [self performSelectorOnMainThread:@selector(tasksDone:) withObject:self.customProgressBar waitUntilDone:NO];\n\n}\n\n@implementation CustomProgressBar\n\n- (void)tasksDone\n{\n    // change UI to reflect progress done. \n}\n</code></pre>\n"},{"tags":["c++","windows","multithreading","parameters","beginthreadex"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12935602,"title":"pass more than one parameter to _beginThreadEx","body":"<p>Is it possible to pass more than one parameter to beginthreadex?</p>\n\n<p>I know I can create a class or structure, but what if I have unrelated pieces of data that I don't want to combine into a class or structure?</p>\n\n<p>Boost libraries seem to allow for multiple parameters, but how would I do multiple parameters for standard c++ _beginThreadEx?</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;process.h&gt;\n\nunsigned __stdcall myThread(void *data)\n{\n    //C:\\dev\\default threads\\_threads.cpp|6|error: invalid conversion from 'int*' to 'int' [-fpermissive]|\n    int *x = static_cast&lt;int*&gt;(data);\n\n    //int *x = (int*)data;\n\n    std::cout &lt;&lt; \"Hello World! \" &lt;&lt; x;\n}\n\nint main()\n{\n\n    int x = 10;\n    _beginthreadex(NULL, 0, myThread, &amp;x, 0, NULL);\n    while(true);\n}\n</code></pre>\n"},{"tags":["c#","asp.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12935508,"title":"ASP.NET show and hide image at runtime","body":"<p>I want to show loading picture when I'll click the button. And after finish my some calculation, make this picture is invisible. How to do it without AJAX and not using [WebMethod]? I know some tricks how to do it with AJAX or PageLoad, but I'm interesting, how to do it in the <strong>different threads</strong>, is it possible?</p>\n\n<p>For example my code:</p>\n\n<pre><code>protected void btnDelete_Click(object sender, EventArgs e)\n    {       \n            imgLoading.Visible = true;\n            lblCount.Visible = false;\n\n            //doing some work\n            bool isDone = TProfile.Delete(userId, someData);\n\n            if (isDone)\n            {\n                imgLoading.Visible = false;\n                lblCount.Visible = true;\n            }\n\n        BindList(true);\n    }\n</code></pre>\n"},{"tags":["c","multithreading","memory-management"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12934855,"title":"Is memory, that is allocated in a thread, alife after the thread terminates?","body":"<p>I experience some memory allocation problems and try to detect possible reasons for these problems.</p>\n\n<p>There are many possible reasons, and lots of hours must be spent to check each of them.</p>\n\n<p>One of the possible reasons is that there is a memory buffer, that is allocated within a thread, and this buffer is used after the thread terminates.</p>\n\n<p>So, if there is a chance that thread termination causes memory deallocation, then many hours of debugging may be avoided.</p>\n\n<p>Thank you very much in advance.</p>\n"},{"tags":["java","multithreading","chat","javafx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12935545,"title":"JavaFx chat program updating GUI","body":"<p>Okay i have asked this question alot of times and has yet to find a solution to my problem mainly because i have no idea on how Task works and i may be stupid but i can't find an example that comes close to my problem.</p>\n\n<p>So now i will ask again but this time i will be as specefic as i can!</p>\n\n<p><strong>Background!</strong></p>\n\n<p>I want to create a chat program that contains a certain element of Grafics not high quality stuff but a few labels with pictures of a small man and a background image. As stated each label has a picture of a man (Png) and is in a group that contains the following elements:</p>\n\n<ul>\n<li>A label - A label that is actually a picture</li>\n<li>A textArea that is above the label - this will be used to show chat messages</li>\n<li>a label under the actual chat person to show his name</li>\n</ul>\n\n<p>all of these elements are wraped into a group. There are three of such groups (1 for each chat person). the labels and textareas are called something as simple as txt_chatperson1,2 and 3 while the labels with the pictures are called chatperson1,2 and 3</p>\n\n<p>The main idea is that when the client connects he or she will be assigned to one of these chatpersonens and use their \"group\" when they chat.</p>\n\n<p>ive created a protrocol so when a client connects he will be assinged a chatId  the connected client will then be assigned to the respected group depending on the chatID.</p>\n\n<p>The ChatID is also used when ever a client does something. For instance should chatperson 1 with the clientID 1 send a chat message the following output will sent to the server for process:</p>\n\n<p>2\n1\n(message) </p>\n\n<p>2 means that the next message is a chatmessage\n1 is the user who sends the message in this example it is clientID 1 who sends the mssage\nMessage - is the actual message that the client sends an example of this would be: \"Hello\".</p>\n\n<p><strong>The actual problem</strong></p>\n\n<p>so far my program can do the following without problems:</p>\n\n<ol>\n<li>Connect a client to my server</li>\n<li>Show the GUI and add the user name</li>\n<li>give the client a ClientID and assign him to the right group</li>\n</ol>\n\n<p>The real problem starts when my client wants to chat!</p>\n\n<p>for some odd reason i am unable to send new messages to the server even though the client and the server has already exchanged alot of information doing connection phase!</p>\n\n<p>After all of my questions i narrowed this problem down to be because of the thread i had going in my simpleController class(this is the class that controls my GUI).</p>\n\n<p>Apprently i have to make some sort of adjustment to my client and the past answers showed me that i have to use the Task object and the Platform.runlater in order to update my Gui and send the right information.</p>\n\n<p>However i have yet to find out where i write the Task method and how to use the platform.runlater. i simply do not know where to fill it into my code and wether or not i need to write new classes that extends a thread and use that to listen for new input?</p>\n\n<p>what i really need is someone to tell me / show me where and how i can use Task in  my program i feel really lost and i am unable to continue with my chat program before my client actually works! i pray that someone is able to show an example from my code pieces and tell me exactly how this would work with my program as an example!</p>\n\n<p>The following is my code i know it is abit messy but i have been trying for a long time to make this work:</p>\n\n<p><strong>Main</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.net.Socket;\nimport java.util.ArrayList;\n\nimport javafx.application.Application;\nimport javafx.fxml.FXMLLoader;\nimport javafx.scene.Scene;\nimport javafx.scene.layout.AnchorPane;\nimport javafx.stage.Stage;\n\n\npublic class Main extends Application{\n\n\n    public static void main(String[] args) throws IOException{\n\n        Application.launch(Main.class, (java.lang.String[]) null);\n\n    }\n\n    @Override\n    public void start(Stage primaryStage) throws Exception {\n        try {\n            AnchorPane page = (AnchorPane) FXMLLoader.load(Main.class.getResource(\"testingBackground.fxml\"));\n            Scene scene = new Scene(page);\n            primaryStage.setScene(scene);\n            primaryStage.setTitle(\"Chatten\");\n            primaryStage.show();\n\n        } catch (Exception ex) {\n            java.util.logging.Logger.getLogger(Main.class.getName()).log(\n                    java.util.logging.Level.SEVERE, null, ex);\n\n        }\n\n    }\n\n}\n</code></pre>\n\n<p><strong>SimpleController</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.InetAddress;\nimport java.net.Socket;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.Scanner;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.util.ResourceBundle;\n\nimport com.sun.glass.ui.Platform;\n\nimport javafx.beans.value.ChangeListener;\nimport javafx.beans.value.ObservableValue;\nimport javafx.concurrent.Task;\nimport javafx.event.ActionEvent;\nimport javafx.event.EventHandler;\nimport javafx.fxml.Initializable;\nimport javafx.scene.control.Button;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.TextArea;\nimport javafx.scene.control.TextField;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.layout.AnchorPane;\nimport javafx.scene.text.Text;\n\n/*\n * evt ret array listen med commands da jeg selv kan styre hvilke commands der kommer ind og ud! og brugeren faktisk\n * aldrig selv kan vælge!\n */\npublic class SimpleController extends Thread implements Initializable{\n    public Button btn_Connect;\n    public AnchorPane pictureFrame;\n    public Socket socket = new Socket();\n    public PrintWriter pw;\n    public Scanner input;\n    public int clientId = 1;\n    public Client client = new Client(socket, pw, input, clientId);\n    // options!\n    public TextField txt_userName;\n    public TextField textField_chat;\n    // send button\n    public Button Send;\n    /*\n     * current client that the user i connected with, this client is used to send commands and tell other clients who is connected on\n     * what \"ingame chat persons\"\n     */\n    public static int currentClientId;\n    // chatperson username\n    public Label lbl_userName2;\n    public Label lbl_userName3;\n    public Label lbl_chatPerson2;\n    public Label lbl_Chatperson1_userName;\n    //Pictures of chat person\n    public Label chatPerson3;\n    public Label chatPerson1;\n    // chat persons textfield\n    public TextArea txt_ChatPerson1;\n    //public TextField txt_ChatPerson1;\n    public TextField txt_ChatPerson2;\n    public TextField txt_ChatPerson3;\n\n\n    @Override\n    public void initialize(URL location, ResourceBundle resources) throws NullPointerException {\n        try {\n            client.connect();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        pictureFrame.setMaxSize(409, 373);\n        txt_ChatPerson1.setMinWidth(50);\n        txt_ChatPerson1.setPrefWidth(50);\n        txt_ChatPerson1.setMaxWidth(300);\n        txt_ChatPerson1.setText(\"         \");\n\n\n\n        btn_Connect.setOnAction(new EventHandler&lt;ActionEvent&gt;() {   \n            @Override\n\n            public void handle(ActionEvent event) throws NullPointerException {\n                connectMeWithOthers(1);\n            }\n        });\n\n\n        Send.setOnAction(new EventHandler&lt;ActionEvent&gt;() {\n\n            // WORK IN PROGReSS!!\n            @Override\n            public void handle(ActionEvent event) {\n\n                /*\n                 * new line code:\n                 */\n                String x = textField_chat.getText();\n                txt_ChatPerson1.setText(x);\n                txt_ChatPerson1.setVisible(true);\n                System.out.println(\"x\" +x);\n\n                txt_ChatPerson1.textProperty().addListener(new ChangeListener&lt;String&gt;() {\n\n                    @Override\n                    public void changed(\n                            ObservableValue&lt;? extends String&gt; observable,\n                            String oldValue, String newValue) {\n\n\n                        //  txt_ChatPerson1.setPrefRowCount(5);\n                        txt_ChatPerson1.setPrefWidth(txt_ChatPerson1.getText().length()*7);\n                        //txt_ChatPerson1.setPrefHeight(txt_ChatPerson1.getText().length()*3);\n                        // TODO Auto-generated method stub\n\n                    }\n                });\n\n                txt_ChatPerson1.autosize();\n                client.SendChat(x);\n            }\n        });\n\n\n    }\n    /**\n     * this method connect the client to the other clients who are online on the server!\n     * the method calls it self after the user has established connection in order to load the other chat persons online\n     * if the client is the online user online then it will only load the user\n     * @param id\n     */\n    protected void connectMeWithOthers(int id) {\n        try {\n            int responseId = client.sendCommando(id);\n            System.out.println(\" response id \"+responseId);\n            // finds whom is connected and tries to connect to a spot that is avalibul!\n            //Response is the ID of the chat persons\n            switch (responseId) {\n            case 1:\n                currentClientId = client.reciveCommando();\n                client.setClientId(currentClientId);\n                client.sendString(txt_userName.getText());\n                connectMeWithOthers(5);\n                break;  \n            case 5:\n                int times = client.reciveCommando();\n                int o = 0;\n                System.out.println(\"times: \"+times);\n\n                while (o != times) {\n                    int j = client.reciveCommando();\n                    System.out.println(\"j\"+ j);\n                    String name = client.reciveString();\n                    System.out.println(\"Name \" +name);\n                    createUser(j, name);    \n                    o++;\n                }\n                connectMeWithOthers(8);\n                break;\n\n            case 10:\n                System.out.println(\"Connection fail chat room is full! Please try again later!\");\n\n            case 8:\n                start();\n                break;\n            default:\n                break;\n            }\n\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n\n    }\n    private void createUser(int j, String reciveChat) {\n        if (j == 1) {\n            chatPerson1.setVisible(true);\n            lbl_Chatperson1_userName.setVisible(true);\n            lbl_Chatperson1_userName.setText(reciveChat);\n\n        }else if (j == 2) {\n            lbl_chatPerson2.setVisible(true);\n            lbl_userName2.setVisible(true);\n            lbl_userName2.setText(reciveChat);\n        }else if (j == 3){\n            chatPerson3.setVisible(true);\n            lbl_userName3.setVisible(true);\n            lbl_userName3.setText(reciveChat);\n        }else {\n            Image img = new Image(getClass().getResourceAsStream(\"Figur.png\"));\n            Label test2 = new Label(\"\", new ImageView(img));\n            test2.setLayoutX(50);\n            test2.setLayoutY(30);\n            test2.setPrefSize(1000, 1000);\n            pictureFrame.getChildren().addAll(test2);\n            test2.setVisible(true);\n        }\n\n    }\n    /*\n     * Denne metode kan evt. omskrives til at benytte Task klassen kig på stackoverflow for hjælp\n     */\n    public void StartClient(){\n\n        ClientListner cl = new ClientListner(client);\n        System.out.println(\"client started\");\n        cl.start();\n        while (true) {\n            if (cl.recived) {\n                txt_ChatPerson2.setText(cl.getChatMessage().get(0));\n\n            }\n        }\n    }\n\n    /*\n     * Run metoden er brugt til at recive data fra andre users og update GUI'en skal muligvis rewrites!?\n     * \n     */\n\n\n    public void run(){ \n        System.out.println(\"Thread started\");\n        System.out.println(client.getSocket().isConnected());\n        ClientListner cl = new ClientListner(client);\n        while (client.getSocket().isConnected()) {\n            int key = 10;\n\n                if (client.getInput().hasNext()) {\n                    txt_ChatPerson2.setText(client.reciveString());\n                    txt_ChatPerson2.setVisible(true);\n                }\n                try {\n                    key = client.reciveCommando();\n                    System.out.println(\"jeg er her\");\n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n\n\n\n            System.out.println(\"Key \"+key);\n            switch (key) {\n            // case 2 er recive chat:\n            case 2:\n                // først find ud af hvilket ID der har sendt chatten:\n                int y = 0;\n                try {\n                    y = client.reciveCommando();\n                    System.out.println(\"y\" + y); \n                } catch (IOException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n                // derefter få beskeden og send den så ud til resten.\n                String says = client.reciveChat().toString();\n                System.out.println(\"Says :\"+says);\n                if (y == 1) {\n                    txt_ChatPerson1.setText(says);\n                    txt_ChatPerson1.setVisible(true);\n                }else if (y == 2) {\n                    txt_ChatPerson2.setText(says);\n                    txt_ChatPerson2.setVisible(true);\n                }else {\n                    chatPerson3.setVisible(true);\n                    txt_ChatPerson3.setVisible(true);\n                    txt_ChatPerson3.setText(says);\n                }\n\n                break;\n\n            default:\n                break;\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p><strong>Client</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.InetAddress;\nimport java.net.Socket;\nimport java.util.Scanner;\n\n\npublic class Client {\n// disse var static\n    public final static int portNumber = 6040;\n    public Socket socket;\n    private PrintWriter pw;\n    private Scanner input;\n    private int clientId;\n    /**\n     * @param args\n     * @throws IOException \n     */\n\n    public Client(Socket socket, PrintWriter pw, Scanner input, int clientId){\n        this.socket = socket;\n        this.pw = pw;\n        this.input = input;\n        this.clientId = clientId;\n    }\n    public void connect() throws IOException{\n        // du kan vælge at bruge inetadressen til at connecte i socketet.\n        InetAddress adr = InetAddress.getByName(\"localhost\");\n        socket = new Socket(\"localhost\", portNumber);\n        input=new Scanner(socket.getInputStream());\n        pw = new PrintWriter(socket.getOutputStream());\n\n    }\n    /**\n     * This method sends the message (that the client(chat person) writes to the user)\n     * @param x\n     * @throws NullPointerException\n     * @throws IOException \n     */\n    public void SendChat(String x) throws NullPointerException{\n            pw.print(\"CHAT:\"+x);\n            pw.flush();\n        /*  pw.println(2);\n            pw.flush();\n            pw.println(SimpleController.currentClientId);\n            pw.flush();\n            pw.println(x);\n            pw.flush(); \n        */\n\n    }\n    public int sendCommando(int id) throws IOException{\n        System.out.println(\"Jeg sender\"+ id);\n        pw.println(id);\n        pw.flush();\n        /*\n         * this part of the program sends a command to the server if the command is 1 then 1 is = Connect.\n         * the program then ask the server is the server is full or is it ok to connect? \n         * if the response is not 10 then the program will allow a connection to happen the return type will be the Id of which \n         * the chat person becomes!\n         */\n        // should the method return 0 the Application will do NOTHING!\n        switch (id) {\n        case 1:\n    int k = reciveCommando();\n            if (k== 10) {\n                return 10;\n            }else if (k &lt; 3) {\n                System.out.println(\"returned k\" + k);\n                return k;\n            }else {\n\n            return 10;\n            }\n            /*\n             * Closes the connection with the server!\n             */\n        case 3:\n\n            socket.close();\n            return 0;\n\n        case 5:\n            int y  = reciveCommando();\n            return y;\n\n        case 8:\n            return 8;\n        default:\n            return 0;\n        }\n\n    }\n    /*\n     * this method recives a command from the server! the comands can be found in the ChatCommands.txt\n     * returns the command as an integer!\n     */\n    public int reciveCommando() throws IOException{\n        Integer i = input.nextInt();\n        return i;\n    }\n    /**\n     * Gets a String response from the server. This method i used to create other users and give them the correct username.\n     * \n     * @param i\n     * @return\n     * @throws IOException\n     */\n    public String getStringResponse(int i) throws IOException {\n        pw.print(i);\n        pw.flush();\n        String x = input.nextLine();\n        return x;\n\n    }\n    /*\n     * Work in progress - client getter og setter methoder!\n     */\n\n    public Socket getSocket(){\n        return socket;\n    }\n    public Scanner getInput(){\n        return input;\n    }\n    public PrintWriter getPw(){\n        return pw;\n    }\n    public int getClientId(){\n        return clientId;\n    }\n\n    public void setClientId(int i ){\n        clientId = i;\n    }\n    public String reciveChat(){\n            return getInput().nextLine();\n\n    }\n    public String reciveString(){\n        String x =input.next();\n        return x;\n    }\n    public void sendString(String x){\n        pw.println(x);\n        pw.flush();\n    }\n\n\n}\n</code></pre>\n\n<p><strong>Clientlistner - was a test to make a new thread in another class</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.util.ArrayList;\n\nimport javafx.application.Platform;\n\n\npublic class ClientListner extends Thread {\n    public Client c;\n    public boolean recived = false;\n    public ArrayList&lt;String&gt;chat = new ArrayList&lt;&gt;();\n\n    public ClientListner(Client c){\n        this.c = c;\n\n    }\n    public void run(){\n\n        while (c.getSocket().isConnected()) {\n            int i = c.getInput().nextInt();\n            System.out.println(i);\n            checkCommand(i);\n        }\n    }\n    private void checkCommand(int i) {\n        switch (i) {\n        // case 2 er recive chat:\n        case 2:\n            c.getInput().nextInt();\n            chat.add(c.reciveChat().toString());\n            recived = true;\n            break;\n\n        default:\n            break;\n        }\n\n    }\n    public ArrayList&lt;String&gt; getChatMessage(){\n        recived = false;\n        return chat;\n    }\n\n\n}\n</code></pre>\n\n<p>Thank you for reading and i hope that someone is able to help me!</p>\n"},{"tags":["multithreading","timer","signals","mutex"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":48,"score":-2,"question_id":12930520,"title":"Program still crashes after using mutex(can i use mutex in the same thread?)","body":"<p>I created two threads, and use mutex to synchronize them.<br>\nIn the mainwindow program(which i regard as the main thread) in which the other thread is created, I have to <strong>use mutex in at least two functions</strong>, because one is a slot to accept signals from UI when user selects a menu and <strong>configure the data</strong>, and there is also a timer which runs out 1 time per sec and triggers a slot function which <strong>reads the data.</strong></p>\n\n<p>My program often <strong>crashes even i use mutex</strong>. In 'main thread' there are different functions which have mutex's lock and unlock operations, one of the functions is a slot linked to the timer. Also <strong>the other thread continuously writes the data</strong>.    </p>\n\n<p>I am so confused, why ?<br>\n     (:) I really need a better phone to edit my question before this time :) )</p>\n\n<p>My code:<br>\nIn thread:</p>\n\n<pre><code>class Background : public QThread\n{\n    Q_OBJECT\n\npublic:\n    void Background::run(void)\n    {\n        initFile();\n\n        while(1)\n        {\n\n            Mutex-&gt;lock();\n            msleep(40);\n            rcv();          //writes map here\n            Mutex-&gt;unlock();\n\n        }\n\n    }\n...\n}\n</code></pre>\n\n<p>In thread's rcv():</p>\n\n<pre><code>void Background::rcv()\n{\n    DEVMAP::iterator dev_r;\n\n    for(dev_r= DevMap.begin(); dev_r!= DevMap.end(); dev_r++)//DevMap is a refrence to the dev_map in mainwindow.\n    {\n       ...  ....//writes the map\n\n    }\n}\n</code></pre>\n\n<p>In mainwindow:</p>\n\n<pre><code>void MainWindow::initTimer()\n{\n    refreshTimer = new QTimer(this);\n    connect(refreshTimer, SIGNAL(timeout()), this, SLOT(refreshLogDisplay()));\n    refreshTimer-&gt;start(1000);\n}\n\nvoid MainWindow::refreshLogDisplay()\n{\n\n//MUTEX\n    mutex-&gt;lock();\n\n    ......//read the map\n\n//MUTEX\n    mutex-&gt;unlock();\n\n}\n</code></pre>\n\n<p>In the thread's construction:</p>\n\n<pre><code>Background(DEVMap&amp; map,...,QMutex* mutex):DevMap(map)...,Mutex(mutex){}\n</code></pre>\n\n<p>In mainwindow which creates the thread:</p>\n\n<pre><code>void MainWindow::initThread()\n{\n\n\n    mutex = new QMutex;\n    back = new Background(dev_map,..., mutex);\n    back-&gt;start();\n\n}\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>void MainWindow::on_Create_triggered()//this function is a slot triggered by a menu item in the MainWindow UI\n{\n\n    ......//get information from a dialog \n\n\n//MUTEX\n\n    mutex-&gt;lock();\n\n    BitState* bitState = new BitState(string((const char *)dlg-&gt;getName().toLocal8Bit()),\n                                        string((const char *)dlg-&gt;getNO().toLocal8Bit()),\n                                      dlg-&gt;getRevPortNo().toInt(), dlg-&gt;getSndPortNo().toInt());\n\n\n    dev_map.insert(DEVMAP::value_type (string((const char *)dlg-&gt;getPIN().toLocal8Bit()), *bitState)); \n     //writes map here\n\n\n\n//MUTEX\n     mutex-&gt;unlock();\n\n\n}\n</code></pre>\n"},{"tags":["multithreading","blackberry"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12909316,"title":"how to detect when a thread has completed execution in blackberry?","body":"<p>How can I detect when the below code/thread has completed execution in Blackberry:</p>\n\n<pre><code>UiApplication.getUiApplication().invokeAndWait(new Runnable() {\n        public void run() {              \n            EventInjector.KeyEvent inject = new EventInjector.KeyEvent  \n                    (EventInjector.KeyEvent.KEY_DOWN,Characters.ENTER, 0);\n                      inject.post();\n                      inject.post();\n        }\n    }); \n</code></pre>\n\n<p>Can I get a notification when this thread has executed so that I can start another thread? \nThanks in advance.</p>\n"},{"tags":["multithreading","delegates","invoke"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12934103,"title":"Invoking Delegates from a dispatcher","body":"<p>I've been stuck on this all morning, even though it seems like it should be very easy (wondering if I'm missing something fundamental).  I have the following code in a class-</p>\n\n<pre><code> public class myClass\n {\n      private Dispatcher m_Dispatcher;\n\n      private void myMethod() { ... }\n\n      private void invokeTheMethod(object sender, PropertyChangedEventArgs e)\n      {\n           m_Dispatcher.Invoke(myMethod); //XYZ\n      }\n\n }\n</code></pre>\n\n<p>The dispatcher is attached to the thread that instance of myClass is running on.  The invokeTheMethod method is called from another thread, and I'd like to run myMethod on the thread of m_Dispatcher.  However, if I try to run this code, I get an exception at XYZ saying \"Object reference not an instance of an object\".  Is this because I haven't declared myMethod in the form of a delegate? - I have tried different ways to declare myMethod as a delegate, but I can't get any of them to compile.  Any suggestions are very much appreciated.</p>\n\n<p>Thanks,\nChris</p>\n"},{"tags":["java","multithreading","asynchronous"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":84,"score":4,"question_id":12926425,"title":"Understanding Threads + Asynchronous","body":"<p>So I have a program that I made that needs to send a lot (like 10,000+) of GET requests to a URL and I need it to be as fast as possible. When I first created the program I just put the connections into a for loop but it was really slow because it would have to wait for each connection to complete before continuing. I wanted to make it faster so I tried using threads and it made it somewhat faster but I am still not satisfied.</p>\n\n<p>I'm guessing the correct way to go about this and making it really fast is using an asynchronous connection and connecting to all of the URLs. Is this the right approach?</p>\n\n<p>Also, I have been trying to understand threads and how they work but I can't seem to get it. The computer I am on has an Intel Core i7-3610QM quad-core processor. According to Intel's website for the specifications for this processor, it has 8 threads. Does this mean I can create 8 threads in a Java application and they will all run concurrently? Any more than 8 and there will be no speed increase?</p>\n\n<p>What exactly does the number represent next to \"Threads\" in the task manager under the \"Performance\" tab? Currently, my task manager is showing \"Threads\" as over 1,000. Why is it this number and how can it even go past 8 if that's all my processor supports?\nI also noticed that when I tried my program with 500 threads as a test, the number in the task manager increased by 500 but it had the same speed as if I set it to use 8 threads instead. So if the number is increasing according to the number of threads I am using in my Java application, then why is the speed the same?</p>\n\n<p>Also, I have tried doing a small test with threads in Java but the output doesn't make sense to me.\nHere is my Test class:</p>\n\n<pre><code>import java.text.SimpleDateFormat;\nimport java.util.Date;\n\npublic class Test {\n\n    private static int numThreads = 3;\n    private static int numLoops = 100000;\n    private static SimpleDateFormat dateFormat = new SimpleDateFormat(\"[hh:mm:ss] \");\n\n    public static void main(String[] args) throws Exception {\n\n        for (int i=1; i&lt;=numThreads; i++) {\n            final int threadNum = i;\n            new Thread(new Runnable() {\n                public void run() {\n                    System.out.println(dateFormat.format(new Date()) + \"Start of thread: \" + threadNum);\n                    for (int i=0; i&lt;numLoops; i++)\n                        for (int j=0; j&lt;numLoops; j++);\n                    System.out.println(dateFormat.format(new Date()) + \"End of thread: \" + threadNum);\n            }\n            }).start();\n            Thread.sleep(2000);\n        }\n\n    }\n}\n</code></pre>\n\n<p>This produces an output such as:</p>\n\n<pre><code>[09:48:51] Start of thread: 1\n[09:48:53] Start of thread: 2\n[09:48:55] Start of thread: 3\n[09:48:55] End of thread: 3\n[09:48:56] End of thread: 1\n[09:48:58] End of thread: 2\n</code></pre>\n\n<p>Why does the third thread start and end right away while the first and second take 5 seconds each? If I add more that 3 threads, the same thing happens for all threads above 2.</p>\n\n<p>Sorry if this was a long read, I had a lot of questions.\nThanks in advance.</p>\n"},{"tags":["objective-c","multithreading","properties","atomic"],"answer_count":9,"favorite_count":205,"up_vote_count":405,"down_vote_count":0,"view_count":135911,"score":405,"question_id":588866,"title":"Atomic vs nonatomic properties","body":"<p>What do <code>atomic</code> and <code>nonatomic</code> mean in property declarations?</p>\n\n<pre><code>@property(nonatomic, retain) UITextField *userName;\n\n@property(atomic, retain) UITextField *userName;\n\n@property(retain) UITextField *userName;\n</code></pre>\n\n<p>What is the functional difference between these 3?</p>\n"},{"tags":["java","windows","multithreading","jvm"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":3336,"score":7,"question_id":258901,"title":"How does the Sun JVM map Java threads to Windows threads?","body":"<p>My application uses loads of Java threads. I am looking for a reliable understanding how the JVM (version 5 and 6) maps the Java threads to underlying Windows threads. I know there is a document for mapping to Solaris threads, but not Windows.</p>\n\n<p>Why doesn't Sun publish this information?</p>\n\n<p>I want to know if there's a 1:1 mapping, or if it varies by JVM, by -server option, by workload, etc, etc.</p>\n\n<p>I know I am not \"supposed\" to care, I should write properly synchronisd code, but I am inheriting a large body of code...</p>\n\n<p>Also, does anyone know how to give names to Windows threads?</p>\n"},{"tags":["java","multithreading","servlets","multiuser"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12932300,"title":"Servlet that starts a thread only once for every visitor","body":"<p>Hey I want to implement a Java Servlet that starts a thread only once for every single user. Even on refresh it should not start again. My last approach brought me some trouble so no code^^. Any Suggestions for the layout of the servlet?</p>\n\n<pre><code> public class LoaderServlet extends HttpServlet {\n// The thread to load the needed information\nprivate LoaderThread loader;\n// The last.fm account\nprivate String lfmaccount;\n\npublic LoaderServlet() {\n    super();\n    lfmaccount = \"\";\n}\n\n@Override\nprotected void doPost(HttpServletRequest request,\n        HttpServletResponse response) throws ServletException, IOException {\n    if (loader != null) {\n        response.setContentType(\"text/plain\");\n        response.setHeader(\"Cache-Control\", \"no-cache\");\n        PrintWriter out = response.getWriter();\n        out.write(loader.getStatus());\n        out.flush();\n        out.close();\n    } else {\n        loader = new LoaderThread(lfmaccount);\n        loader.start();\n        request.getRequestDispatcher(\"WEB-INF/pages/loader.jsp\").forward(\n                request, response);\n    }\n}\n\n@Override\nprotected void doGet(HttpServletRequest request,\n        HttpServletResponse response) throws ServletException, IOException {\n    if (lfmaccount.isEmpty()) {\n        lfmaccount = request.getSession().getAttribute(\"lfmUser\")\n                .toString();\n    }\n    request.getRequestDispatcher(\"WEB-INF/pages/loader.jsp\").forward(\n            request, response);\n}\n}\n</code></pre>\n\n<p>The jsp uses ajax to regularly post to the servlet and get the status. The thread just runs like 3 minutes, crawling some last.fm data.</p>\n"},{"tags":["java","multithreading","java-ee","scheduled-tasks"],"answer_count":14,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":151,"score":1,"question_id":12866614,"title":"Run Java code once every hour","body":"<p>I'm tryng to write a simple Java program that runs some code every hour when the minute hand is at 20. The issue is that that the way I'm doing it is incredibly CPU intensive. I'm familiar with Quartz but I'm looking for a much simpler solution, any ideas?</p>\n\n<pre><code>    boolean run = true;\n    while(run){\n        Calendar calendar = new GregorianCalendar();\n        int minute = calendar.get(Calendar.MINUTE);\n        if(minute == 20){\n            //Do some Stuff             \n        }\n    }\n</code></pre>\n"},{"tags":["java","multithreading","thread-safety","priority-queue"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12931377,"title":"Java / PriorityQueue and Threads","body":"<p>In my application I have 4 threads adding elements to a <code>PriorityBlockingQueue</code> and one thread polling elements out of it. For the polling thread the queue seems to be not accessible. I assume I have to take measures to make it thread safe.</p>\n\n<p>After I take the first element I clear the queue, it should be filled up again by the other 4 filling threads.</p>\n\n<p>The polling and filling threads are inside the same class which holds the <code>PriorityBlockingQueue</code>.</p>\n\n<p>That's the code for the polling one:</p>\n\n<pre><code>private class UPPainter implements Runnable {\n    @Override\n    public void run() {\n        while(queue.size() &gt; 0) {\n            ReceivedMsg msg = queue.poll();\n            queue.clear();\n            for(final IPacketListener c : listeners) {\n                new Thread(new ListenerUp(c, msg)).start();\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#",".net","multithreading","events","blocking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12928435,"title":"C# blocking wait for response","body":"<p>I have stumbled upon this problem many times, mostly solved it with hacks, but would like to see a \"proprer\" way to do it.</p>\n\n<p>I'm writing a communication protocol, very similar to RPC in a way that my endpoints ask \"queries\", to which they receive \"replies\".</p>\n\n<p>Now... I would like to implement a function, called SendCommand, that would send out a query, and wait for the reply to that question, and return it.</p>\n\n<p>So I could do something like</p>\n\n<pre><code>int outside_temp = SendCommand(What is the temperature outside).ToInt();\n</code></pre>\n\n<p>The problem with this is that the messages are send and received asynchronously, and I am notified by events that a new message has arrived, and what it was. I would need to block the thread until the reply to the mentioned query has arrived, extract its data content, and return it to the caller.</p>\n\n<p>My problem is with blocking the thread. Blocking the thread is not a problem, we are talking about a multi-threaded app, so the UI would not freeze, etc., but the question is what is the correct way to achieve this?</p>\n\n<p>I'm thinking something along the line of initializing a semaphore inside the SendCommand function, waiting for it, and release the semaphore in the message received event handler (after checking it was the correct message)?</p>\n\n<p>Regards,\n  axos88</p>\n"},{"tags":["android","multithreading","android-mediaplayer","surface","jelly-bean"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12931348,"title":"Android MediaCodec API video plays too fast","body":"<p>I'm currently working with Android Jelly Bean MediaCodec API. I'm developing a simple video player. I extract tracks, play audio and video in separate threads. The problem is that video track always is played too fast. \nWhere can be the problem hidden? \nBoth audio and video are treated almost the same way, except audio is played via AudioTrack and video is rendered to the surface.\nThank you.</p>\n"},{"tags":["android","multithreading","service","kill"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12930617,"title":"Killing a thread running an audio file in a service","body":"<p>In Android,\nI am running a service that spawns a thread. The thread plays a wave audio file.\nOnce the completion of the audio file, I want to kill (destroy) the service.\nSo I wrote the following snippet for that</p>\n\n<pre><code>Thread  tr = new Thread() {\n@Override\n public void run() {\n\n    File path = android.os.Environment.getExternalStorageDirectory();\n    try{\n    mp.setDataSource(path + \"/AudioRecorder/123.wav\");\n    mp.prepare();\n    }\n    catch (Exception e){}\n    mp.start();\n    mp.setOnCompletionListener(new OnCompletionListener() {\n\n        @Override\n        public void onCompletion(MediaPlayer mp) {\n            // TODO Auto-generated method stub\n        stopSelf();\n        }\n    });\n}\n}   ;\ntr.start();\n        }\n</code></pre>\n\n<p>Note that I wrote <em>stopself()</em> to kill the service once the audio file is completed.\nMy question is do I need to kill the thread as well? or it will be automatically terminated once I call stopself()? If not, is it necessary to kill this thread and how can I do that and where should I add it?</p>\n"},{"tags":["java","multithreading","singleton","thread-safety"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":917,"score":0,"question_id":5785897,"title":"Thread safe singleton","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2912281/thread-safety-in-singleton\">Thread safety in Singleton</a>  </p>\n</blockquote>\n\n\n\n<p>hi,</p>\n\n<p>I am using wordnet dictionary to find the synonyms for words. As I have lots documents I have used multiple threads to do the document pre-processing which involves stemming, stop word removal and synonym replacement. </p>\n\n<p>I am using the following code to access the dictionary and get the wordset for each document.</p>\n\n<pre><code>IndexWordSet set = Dictionary.getInstance().lookupAllIndexWords(newWord);\n</code></pre>\n\n<p>This works fine in a single threaded environment. But in a multi threaded environment this didn't work as expected. The program gets stuck after some time.</p>\n\n<p>Is this because the <code>Dictionary.getInstance()</code> is a singleton class and it is not thread safe? If so how can I modify the access to the dictionary so that it is thread safe? ( I cannot modify the dictionary class since I have used a dictionary library) </p>\n"},{"tags":["android","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12930088,"title":"should I use setDaemon() in android?","body":"<p>I'm creating a service Thread for my application, this thread will perform background tasks, and therefore it'll be usage only if my Main thread is running. </p>\n\n<p>So should I declare it as a Daemon ? </p>\n"},{"tags":["c#","database","multithreading","nhibernate","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":9191181,"title":"wait for item to be marked as paid by a different thread, using nhibernate","body":"<p>I have a relatively simple problem, which I cannot tackle without a lot of ugly workarounds. Basically, I am developing a payment gateway client, whereby the process is that the website informs the payment server of the payment to be done, client is transferred to payment server, and once payment is done, payment server informs the website on a seperate thread that the payment was done, and redirects the client.  Now, the client can be 'received' on the website before the notification of the payment was received. Thus, I need to program the system to wait until the notification is received or 30 seconds at most.</p>\n\n<p>Once the notification is received, an <code>Order</code> entity is marked as 'Paid'.  The problem is this:</p>\n\n<ul>\n<li>Client is redirected to website before, <code>Order.Paid</code> is still <code>false</code></li>\n<li>After 1 - 5 seconds, notification is received and <code>Order</code> is marked as <code>true</code></li>\n<li>Due to Nhibernate session management, Client still sees the <code>Order.Paid</code> as <code>false</code> on the other thread. </li>\n<li>To make matters worse, sometimes the client's <code>Order</code> is then flushed on <code>End_Request</code>, and the <code>Order.Paid</code> is again reset to <code>false</code>.</li>\n</ul>\n\n<p>The only way I tried that seems to work is that I dispose of the Nhibernate session explicitly before waiting, and then constantly create a new session until it is found as paid.  However the problem is since the original session was removed, lazy loading for any entities already loaded before hand will stop working and generate errors.</p>\n\n<p>It looks simple in my mind but yet seems to be quite complicated due to session management, any ideas how to go about it?</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","multithreading","interrupt","interrupts"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12928970,"title":"How exactly does Thread.interrupt() and Thread.interrupted() work?","body":"<p>I am not clear regarding these two methods from the perspective of setting the status of the thread.</p>\n\n<p>Java Docs say that Thread.interrupt() sets the threads interrupt status flag and calling the Thread.interrupted() method gives the status of the thread and clears the flag.</p>\n\n<p>When this comes to use in real scenarios..??</p>\n"},{"tags":["java","multithreading","concurrency","semaphore"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1850,"score":0,"question_id":847384,"title":"when we use Semaphore in consumer and producer buffer","body":"<p>I am working on BoundedBuffer class in consumer and producer we want to use the Semaphore in that class\nwe did that but there are an error in every use of <strong>acquire()</strong>\nthe rerror is:</p>\n\n<p><strong>unreported exception java.lang.InterruptedException; must be caught or declared to be thrown</strong></p>\n\n<p>Here is the code:</p>\n\n<pre><code>import java.util.concurrent.Semaphore;\n\npublic class BoundedBuffer implements Buffer { \n    private static final int   BUFFER_SIZE = 4;\n\n    /**\n     * volatile does not appear in the printed text. A discussion of\n     * volatile is in chapter 7.\n     */\n    private volatile int count;\n    private Object[] buffer;\n    private int in;   // points to the next free position in the buffer\n    private int out;  // points to the next full position in the buffer\n\n    private Semaphore  mutex;\n    private Semaphore  empty;\n    private Semaphore full;\n\n    public BoundedBuffer() { //constractur\n        // buffer is initially empty\n        //count = 0;\n        in = 0;\n        out = 0;\n\n        buffer = new Object[BUFFER_SIZE];\n\n        mutex = new Semaphore(1);\n        empty = new Semaphore(BUFFER_SIZE);\n        full = new Semaphore(0);\n    }\n\n    // producer calls this method\n    public void insert(Object item) {\n        //while (count == BUFFER_SIZE) \n        // ; // do nothing the brach full\n\n        // add an item to the buffer\n        // ++count;\n\n        empty.acquire();\n        mutex.acquire();\n        buffer[in] = item;\n        in = (in + 1) % BUFFER_SIZE;//that to do cyrcle or to go to the begining againe\n/*\n        if (count == BUFFER_SIZE)\n            System.out.println(\"Baker put \" + item + \" Shelf FULL\");\n        else\n            System.out.println(\"Baker put \" + item + \" Shelf Size = \" +  count);\n*/\n\n\n        mutex.release();\n        full.release();\n\n    }\n\n    // consumer calls this method\n    public Object remove() {\n        //Object item;\n        full.acquire();\n        mutex.acquire();\n\n        //while (count == 0) \n            ; // do nothing the buffer is empty\n\n        // remove an item from the buffer\n        //--count;\n\n        Object item = buffer[out];\n        out = (out + 1) % BUFFER_SIZE;\n        mutex.release();\n        empty.release();\n        return item;\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","gcc","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12928699,"title":"What is the difference between Thread Local Area (TLA) and Thread Stack Size (Xss)?","body":"<p>As i read from:</p>\n\n<p><a href=\"http://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/tune_app_thruput.html#wp998772\" rel=\"nofollow\">http://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/tune_app_thruput.html#wp998772</a></p>\n\n<p>the TLA is: <em>Thread Local Areas (TLAs) are chunks of free memory used for object allocation. The TLAs are reserved from the heap and given to the Java threads on demand, so that the Java threads can allocate objects without having to synchronize with the other Java threads for each object allocation.</em> </p>\n\n<p>I supposed that the Thread Stack area is used for this purpose (and also keep the stuck calls).</p>\n\n<p>What exactly is the difference?</p>\n"},{"tags":["java","synchronization","singleton","multithreading","double-checked"],"answer_count":6,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":4073,"score":8,"question_id":1625118,"title":"Java Double Checked Locking","body":"<p>I happened upon an article recently discussing the double checked locking pattern in Java and it's pitfalls and now I'm wondering if a variant of that pattern that I've been using for years now is subject to any issues.  </p>\n\n<p>I've looked at many posts and articles on the subject and understand the potential issues with getting a reference to a partially constructed object, and as far as I can tell, I dont <em>think</em> my implementation is subject to these issues.  Does anyone see any issues with the following pattern?  </p>\n\n<p>And, if not, why dont people use it?  I've never seen it recommended in any of the disucssion I've seen around this issue.</p>\n\n<pre><code>public class Test {\n    private static Test instance;\n    private static boolean initialized = false;\n\n    public static Test getInstance() {\n        if (!initialized) {\n            synchronized (Test.class) {\n                if (!initialized) {\n                    instance = new Test();\n                    initialized = true;\n                }\n            }\n        }\n        return instance;\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2498,"score":0,"question_id":1418033,"title":"Java Executors: how can I stop submitted tasks?","body":"<p>I have submitted a task using executors and I need it to stop after some time (e.g. 5 minutes). I have tried doing like this:</p>\n\n<pre><code>   for (Future&lt;?&gt; fut : e.invokeAll(tasks, 300, TimeUnit.SECONDS)) {\n         try {\n             fut.get(); \n         } catch (CancellationException ex) {\n             fut.cancel(true);   \n             tasks.clear();\n         } catch(ExecutionException ex){\n             ex.printStackTrace(); //FIXME: gestita con printstack       \n         }\n   }\n</code></pre>\n\n<p>But I always get an error: I have a shared Vector that needs to be modified by the tasks and then read by a thread, and even if I stop all the task, if the timeout occurs I get: </p>\n\n<pre><code>Exception in thread \"Thread-1\" java.util.ConcurrentModificationException\n</code></pre>\n\n<p>Is there something wrong? How can I stop the tasks submitted that are still working after 5 minutes? </p>\n"},{"tags":["java","multithreading","date-difference"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12916413,"title":"java threading issue, right approach?","body":"<p>I am creating a java service which will continuously run in the background and the job of the service is to create a copy of the table at a particular date. To be exact, i read data from some table and if record_date in table matches the current date, i need to create the table copy. Then the service should sleep until the next date to run. Next date to run is also determined by looking at the record in the table.</p>\n\n<p>Currently, how i do this, is to create a thread which runs in while(true) loop. and when thread is finished performing the task i.e. creating a table copy, I put it to sleep using Thread.sleep() until next time it needs to run. The number of milliseconds for thread to sleep, i calculate by taking the difference between the current date (date on which the task is performed by thread) and the next run date.</p>\n\n<p>Is this the right approach, is using thread.sleep() for this particular scenario the right thing? I say this because next run date for a thread could be after three months or even a year. Also please let me know if i am not very clear here.</p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":118,"score":1,"question_id":12925267,"title":"Thread Executor - beginner","body":"<p>I have two classes. In class <code>A</code>, I have the <code>run()</code> method looped forever, while in the class <code>B</code>, i have the threadpool.  </p>\n\n<p>My question is, From Class <code>B</code>, how can I control and stop the thread executing <code>run()</code> method in class <code>A</code> , I have tried forceshutdown, <code>threadExecutor.shutdownNow()</code>, But it isnt working.\nThe loop seems to go on forever.</p>\n\n<p>Here is example piece of code:</p>\n\n<hr>\n\n<pre><code>public class A implements Runnable {\n    public void run() {\n        while (true) {\n            System.out.println(\"Hi\");\n        }\n    }\n}\n</code></pre>\n\n<hr>\n\n<pre><code>public class B {\n    public static void main(String[] args) {\n        int noOfThreads = 1;\n        A ThreadTaskOne = new A();\n        System.out.println(\"Threads are being started from Class B\");\n        ExecutorService threadExecutor = Executors.newFixedThreadPool(noOfThreads);\n        threadExecutor.execute(ThreadTaskOne);\n        threadExecutor.shutdownNow();\n        System.out.println(\"B Ends, no of threads that are alive : \" + Thread.activeCount());\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","singleton","singleton-methods"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":12878012,"title":"concurrent calls of singleton class methods","body":"<p>I have a singleton class:</p>\n\n<pre><code>public class Singleton {\n    private static Singleton istance = null;\n\n    private Singleton() {}\n\n    public synchronized static Singleton getSingleton() {\n        if (istance == null)\n            istance = new Singleton();\n        return istance;\n    }\n\n    public void work(){\n            for(int i=0; i&lt;10000; i++){\n                Log.d(\"-----------\", \"\"+i);\n            }\n    }\n}\n</code></pre>\n\n<p>And multiple Threads are calling the work() function:</p>\n\n<pre><code>public class Main {\n\npublic static void main(String[] args) {\n\n    new Thread (new Runnable(){\n        public void run(){\n            Singleton s = Singleton.getSingleton();\n            s.work();}\n    }).start();\n\n    System.out.println(\"main thread\");\n\n    new Thread(new Runnable() { \n         public void run() {\n             Singleton s = Singleton.getSingleton();\n                s.work();\n         }\n    }).start();\n}\n}\n</code></pre>\n\n<p>I noticed the two Threads are running concurrently, as if two work functions were instantiated at the same time.</p>\n\n<p>I want the last thread to be run in place of the previous thread, rather then concurrently. Is it possible in java to make the second call override the memory space of the first call?</p>\n"},{"tags":["c#","multithreading","locking","concurrentdictionary"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":12925864,"title":"Lock On Value of ConcurrentDictionary","body":"<p>Partition is a small class I created.  I have thousands of partitions that reside in a ConcurrentDictionary named Partitions.  Before serialization, I want to lock a specific partition, do some work and then unlock the partition.</p>\n\n<p>During this time no other threads should be able to access that Partition.  Since my class Partition is a reference type, I am wondering if I can lock on a single Partition object as I have in the code below?  </p>\n\n<p>Will this block other threads from a single Partition in the ConcurrentDictionary Partitions during the lock below?       </p>\n\n<p>I don't want to lock using a class level locker object. My thought process is that multiple threads should be able to run the code below at the same time.  They just should not be able to access a specific partition, if it is locked... </p>\n\n<pre><code>private void serializePartition(int partNo)\n    {\n        Partition p;\n\n        //Get a reference to the partition, lock, and save it to disk.\n        lock (p = Partitions[partNo])\n        {\n            using (var file = File.Create(dataPath + tableName + partNo + \".ppmi\"))\n            {\n                Serializer.Serialize(file, p);\n            }\n\n            //decrement _CurrentRecordsInMemory by the size of the partition.\n            Interlocked.Add(ref _CurrentRecordsInMemory, p.Data.Count * -1);\n\n            //Clear the partitions data to free up memory and reset partition variables\n            p.Data = null;\n            p.OnDisk = true;\n            p.StartCount = 0;\n        }\n    }\n</code></pre>\n"},{"tags":["c#",".net","multithreading","locking"],"answer_count":2,"favorite_count":3,"up_vote_count":11,"down_vote_count":0,"view_count":110,"score":11,"question_id":12925942,"title":"Lock that will allow multiple readers in C#","body":"<p>I have the following code:</p>\n\n<pre><code>private static object _dbLock = new object();\n\npublic static void LoadData()\n{\n   lock (_dbLock)\n   {\n      //Load data from the database\n   }\n}\n\npublic static string ReadData(Guid key)\n{\n   lock (_dbLock)\n   {\n      //Lookup key in data and return value\n   }\n}\n</code></pre>\n\n<p>I don't want to allow people to read the data while it's being loaded from the database, thus I put a <code>lock</code> in <code>ReadData</code>.  However, right now if multiple people call <code>ReadData</code> at the same time, only one call can run at once.</p>\n\n<p>Is there a way I can allow simultaneous calls to <code>ReadData</code> but block readers when <code>LoadData</code> is being run?</p>\n"},{"tags":["multithreading","parameters"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12925539,"title":"trying to learn _beginthreadex and passing parameters","body":"<p>copying some data I had for working boost threads, I implemented the following code below.\nI get the error C:\\dev\\default threads_threads.cpp|18|error: invalid conversion from 'void (<em>)(void</em>)' to 'unsigned int (<strong>attribute</strong>((<strong>stdcall</strong>)) <em>)(void</em>)' [-fpermissive]|</p>\n\n<p>but... the commented lines are what was recommended, and a comment explains the error I got.</p>\n\n<p>it turns out _beginThreadEx is highly recommended, but poorly documented (as in tutorials) on the web</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;process.h&gt;\n\nvoid myThread(void *data)\n{\n    //C:\\dev\\default threads\\_threads.cpp|6|error: invalid conversion from 'int*' to 'int' [-fpermissive]|\n    //int x = static_cast&lt;int*&gt;(data);\n\n    int *x = (int*)data;\n\n    std::cout &lt;&lt; \"Hellow World! \" &lt;&lt; x;\n}\n\nint main()\n{\n\n    int x = 10;\n    _beginthreadex(NULL, 0, myThread, &amp;x, 0, NULL);\n    while(true);\n}\n</code></pre>\n"},{"tags":["arrays","multithreading","boost","2d"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12925260,"title":"trying to send 2d array by reference to boost thread function","body":"<p>line 146 errors out (function definition)</p>\n\n<p>how can I pass (line 126) a 2d array using a pointer to my workerFunc function?</p>\n\n<p>I've tried a few things that are commented out in the workerFunc function...</p>\n\n<p>I keep getting this error:\nC:\\dev\\libraries\\boost\\include\\boost-1_51\\boost\\bind\\bind.hpp|596|error: cannot convert 'int (<em>)[10][10000]' to 'int</em>' in argument passing|</p>\n\n<pre><code>#define BOOST_THREAD_USE_LIB\n#include &lt;process.h&gt;\n//#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;time.h&gt;\n#include &lt;random&gt;\n#include &lt;boost/thread.hpp&gt;\n#include &lt;boost/random.hpp&gt;\n\n//for srand48_r(time(NULL), &amp;randBuffer); which doesn't work\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n//#include &lt;thread&gt;\n\nusing namespace std;\nusing namespace boost;\nusing namespace boost::random;\n\n//for random seeds\nvoid initialize();\n\n//used for seeds\n\n\nvoid workerFunc(void *dummy , int *, int *, int, int, int);\n\n    //from http://stackoverflow.com/questions/7114043/random-number-generation-in-c11-how-to-generate-how-do-they-work\n    boost::random::uniform_int_distribution&lt;&gt; two(1,2);\n\n    typedef std::mt19937 MyRNG;  // the Mersenne Twister with a popular choice of parameters\n\n    uint32_t seed_val;           // populate somehow\n\n    //only needed for shared variables\n    //CRITICAL_SECTION cs1,cs2,cs3,cs4; // global\n\n    //number of threads\n    const int numThreads = 10;\n    MyRNG rng[numThreads];\n\n\nint main()\n{\n\n    ofstream myfile;\n    myfile.open (\"coinToss.csv\");\n\n    int rNum;\n\n    int numRuns;\n    int count = 0;\n    int divisor = 1;\n    float fHolder = 0;\n    int counter = 0;\n    float percent = 0.0;\n    int sumTotal = 0;\n    int loopTotal = 0;\n    int oldCount = 0;\n\n    //size of all arrays together\n    const int _size = 100000;\n\n    int threadSum[numThreads] = {0};\n    int size[numThreads];\n\n    //create a pointer to an array of threads\n    thread*workerThreads[numThreads];\n\n    //?\n    //unsigned threadID;\n\n    //HANDLE hThread;\n\n    initialize();\n\n    //HANDLE hThread[4];\n\n    //http://stackoverflow.com/questions/8744279/create-threads-in-a-loop\n    //list&lt;thread*&gt; workerThread;\n\n    //http://stackoverflow.com/questions/8744279/create-threads-in-a-loop\n    //http://www.boost.org/doc/libs/1_39_0/doc/html/thread/thread_management.html#thread.thread_management.threadgroup\n\n    const int arraySize = _size/numThreads;\n\n    //not needed w 2 dimensional array\n    for (int i = 0; i &lt; numThreads; i++)\n    {\n        size[i] = i * arraySize;\n\n    }\n\n    const int outerLoop = 100;\n    const long loopSize = _size * outerLoop;\n\n\n    //creates #numThreads arrays of _size\n    int array[numThreads][arraySize];\n\n    //doesn't work in for loop below\n    //thread workerThread[numThreads];\n\n    cout &lt;&lt; \"Runs (uses multiple of \" &lt;&lt; _size * outerLoop &lt;&lt; \"? \";\n    cin &gt;&gt; numRuns;\n\n    for (int a = 0; a &lt; numRuns; a++)\n     {\n         //resets sumTotal\n         sumTotal = 0;\n\n             for (int loop = 0; loop &lt; outerLoop; loop++)\n                {\n\n                    for (int i = 0; i &lt; numThreads; i++) workerThreads[i] = new boost::thread(&amp;workerFunc, (void*)(array), &amp;array, &amp;threadSum[i], 0, arraySize, i);\n\n                    //waits for threads to finish before continuing\n                    for (int i = 0; i &lt; numThreads; i++) workerThreads[i]-&gt;join();\n\n                    //adds the thread sums\n                    //for (int d = 0; d &lt; numThreads; d++) {cout &lt;&lt; threadSum[d] &lt;&lt; endl;};\n                    for (int d = 0; d &lt; numThreads; d++) sumTotal += threadSum[d];\n                }\n\n                //backup old count before reset\n                //cout &lt;&lt; sumTotal &lt;&lt; endl;\n                oldCount = sumTotal + oldCount;\n                myfile &lt;&lt; oldCount &lt;&lt; \",\" &lt;&lt; sumTotal &lt;&lt; endl;\n\n    }\n}\n\n    void initialize()\n    {\n\n      //seed value needs to be supplied\n      //rng1.seed(seed_val*1);\n\n      for (int x = 0; x &lt; numThreads; x++)\n      {\n          rng[x].seed(((unsigned int)time(NULL))*x);\n      }\n    };\n\n\n//recieves array, adds to a sum value\nvoid workerFunc(void *param, int * array[], int * sum, int lBound, int uBound, int rngNumber)\n{\n    //int *sumHolder = &amp;sum;\n\n\n\n    //int *i = (int *)param;\n\n    //int **i = (int **)array[][];\n\n    for (int x = lBound; x &lt; uBound; x++)\n    {\n        //gets a random 1 or 2 value\n        array[rngNumber][x] = two(rng[rngNumber]);\n        //cout &lt;&lt; i &lt;&lt; endl;\n\n        //converts to -1 or +1, then adds it to sum (I would love to combine these two)\n        *sum += array[rngNumber][x] == 2 ? 1 : -1;\n        //cout &lt;&lt; *sum &lt;&lt; endl;\n\n    }\n}\n</code></pre>\n"},{"tags":["c++","multithreading","caching"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12909215,"title":"Is getting the thread ID expensive in terms of performance?","body":"<p>I need to access the thread ID from threads that I don't control (it's in an asynchronous  callback function, and it get called from a set of different threads).</p>\n\n<p>I'd like to know if accessing the thread ID is expensive in terms of performance ?</p>\n\n<p>I'm planning to use either <code>boost::this_thread::get_id()</code> or <code>GetCurrentThreadId()</code> from windows.</p>\n\n<p>To clarify, I need to have some local cache array ready for when the data arrives from my callback, and I'm planning, to avoid errors and locking to use a local cache for each thread, and access the right cache using the thread id.\nAlso because the data that comes is always of a different size, I can not put it in the stack, and I want to avoid creating and deleting heap data all the time.</p>\n"},{"tags":["java","multithreading","multiprocessing"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12923245,"title":"Poor Multi-threading performance compared to Multi-processing in Java","body":"<p>Assume that we have several million long lines of text that must be parsed.<br>\nOn my i7 2600 CPU it takes about 13 milliseconds to parse every 1000 lines.<br>\nTherefore, parsing 1,000,000 lines takes around 13 seconds.<br>\nTo decrease execution time, I have managed using multiple threads.<br>\nUsing a blocking queue, I push 1,000,000 lines as a set of 1000 chunk each containing 1000 lines and consume the chunks using 8 threads. The code is simple and seems to be working however, the performance is not encouraging and takes around 11 seconds.<br>\nHere is the main fraction of multi-threaded code:</p>\n\n<pre><code>    for(int i=0;i&lt;threadCount;i++)\n    {\n        Runnable r=new Runnable() {\n            public void run() {\n                try{\n                    while (true){\n                        InputType chunk=inputQ.poll(10, TimeUnit.MILLISECONDS);\n                        if(chunk==null){\n                            if(inputRemains.get())\n                                continue;\n                            else\n                                return;\n                        }\n                        processItem(chunk);\n                    }\n                }catch (Exception e) {\n                    e.printStackTrace();  \n                }\n            }\n        };\n        Thread t=new Thread(r);\n        threadList.add(t);\n        for(Thread t: threads)\n            t.join();\n</code></pre>\n\n<p>I have used ExecutorService too but the performance is worse!<br>\nChanging the chunk size does not help too and the perfomance does not improve.<br>\nIt means that the blocking queue is not a bottleneck.<br>\nOn the other hand, when I run 4 instances of the serial program concurrently, it just takes 15 seconds to all 4 instances finish. This means that I can process 4,000,0000 lines using 4 process in 15 seconds and hence, the speed up is around 3.4 that is very promising compared to 1.2 speed up of multi-threading.<br></p>\n\n<p>I am wondering that anyone has any idea about this?<br>\nThe problem is very straight forward: a set of lines in a blocking queue and several threads that pol items from the queue and process them in parallel. The queue is filled initially so the threads are fully busy.<br>\nI had similar experiences before too but I can not figure out why multi-processing is better.<br>\nI should also mention that I run the test on Windows 7 and using a 1.7 JRE.<br> \nAny idea is welcomed and thanks before hand.</p>\n"},{"tags":["multithreading","asynchronous","webserver","multiprocessing"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12924124,"title":"Why would I choose a threaded/process-based approach vs. asynchronous web server","body":"<p>As I've done some more research into web server software, I've begun to question if Apache's thread/process based method is the way to go vs. the the asynchronous request handling provided by servers like Nginx a Lighttpd, which tend to scale better with heavier loads.</p>\n\n<p>I understand there are many other differences between these latter two and Apache. My question is under what circumstances would I pick a thread/process based method over the asynchronous handling.</p>\n\n<ol>\n<li><p>Are there any features/technologies that I can't use with an asynchronous method (or would function poorly/not as well)?</p></li>\n<li><p>What situations would cause the performance of an asynchronous method to perform worse than a thread/process based approach? Are these common or rare cases, and how big is the difference?</p></li>\n<li><p>Are there any other factors I should take into consideration when comparing the two? Keep in mind I'm focusing mainly on the thread/process based method vs. asynchronous, not any particular server software which happens to utilize one of these methods. These concerns might be difficulty of managing/debugging, security issues, etc.</p></li>\n</ol>\n"},{"tags":["java","multithreading","user-interface","refresh","freeze"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12923625,"title":"Java: How to start some asyncronous operations and update the ui from other thread?","body":"<p>I have a little problem, now I have to work on a small Java project. I'm trying to run a few threads from Button event handler; then the last one of the threads must update TextArea on the UI. The threads are doing computational stuff work. The most important part is to make the UI woks fine - I don't want to freeze the UI and of course I want to update the UI's TextArea from one of the other threads at regular intervals (not the ui's one). So here is a part of my code:</p>\n\n<p>Inside Button's the event handler I'm starting these 4 threads:</p>\n\n<pre><code>Thread generate = new CombinaMaker();\ngenerate.run();\n\nThread forward = new TranslateForward();\nforward.run();\n\nThread backward = new TranslateBackward();\nbackward.run();\n\nThread refresh = new Refresher();\nrefresh.run();\n</code></pre>\n\n<p>I want the threads to work simultaneously. The Refresher thread must update the UI TextArea component at regular intervals. </p>\n\n<p>So, here is how I update the UI from Refresher thread:</p>\n\n<pre><code>public static void updateProgress() \n{\n    SwingUtilities.invokeLater(new Runnable() \n    {   \n         public void run() \n         {\n             //HERE\n             //I have a loop that have to be looping at every 500 ms\n         }\n     }\n}\n</code></pre>\n\n<p>My qustion is: am I supposed to do that link this? I need to be simple and effective. This loop is making me sad because it must be looping as long as the application works. May be this is the reason of freezing the UI? I know that I am making big error somewhere, but at this moment I can't find it alone. May be you can suggest me some simple solution. And the last think - the first 4 threads: I want to start them 'simultaneously', without freezing my UI. Is that way (starting them like this from the event handler...) the correct one or may be there is better? Thanks a lot friends!</p>\n\n<p>PS. If the refreshing the UI through my 'refresher' thread is hard work I am ready for a compromise variant - Update the UI through his owns thread (UI thread). But in this case may be I must use some 'time shooting mechanism' - avoiding the freezing of the UI. What are you thinking?</p>\n"},{"tags":["c#","multithreading","locking","mutex"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":344,"score":1,"question_id":7841390,"title":"How to use a mutex","body":"<p>I have one thread, that is sending data stored in a buffer of type List&lt; string> via tcp. Another thread is writing into the buffer. As I am not very familiar with c# I'd like to know how I should use lock or Mutex correctly.  </p>\n\n<p>This is the code I'd like to use eventually:</p>\n\n<pre><code> while(buffer.isLocked()) \n { \n    buffer.wait();\n }\n\n  buffer.lockBuffer();\n  buffer.add(tcpPacket);\n  buffer.unlockBuffer();\n  buffer.notify();\n</code></pre>\n\n<p>This is my current code. I hope someone can help me complete it. </p>\n\n<pre><code>public class Buffer\n{\n    private Mutex mutex; \n    private List&lt;string&gt; buffer; \n    private bool locked = false; \n\n    public Buffer()\n    {\n        mutex = new Mutex(false);\n        buffer = new List&lt;string&gt;(); \n    }\n\n    public bool isLocked()\n    {\n        return locked; \n    }\n\n    public void lockBuffer()\n    {\n        if (!locked)\n        {\n            //...\n           locked = true; \n        }\n    }\n\n    public void unlockBuffer()\n    {\n        if(locked)\n        {\n            mutex.ReleaseMutex();\n            locked = false; \n        }\n    }\n\n    public void wait()\n    {\n        mutex.WaitOne();\n    }\n\n    public void notify()\n    {\n        //...\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","qt","threadpool","qthread"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12918718,"title":"Thread, QThread, how many per process is \"reasonable\"?","body":"<p><strong>QUESTION:  How many \"QThread\" instances per process is \"reasonable\"?</strong></p>\n\n<p><em>(This specifically references Qt's <code>QThread</code> instance, but logically the question should relate to any thread-based design using any library.)</em></p>\n\n<p>For example, I understand that platform-specific resource limits may default to supporting up to thirty (30) \"<code>QTcpSocket</code>\" instances, so in theory, if you have thirty active-sockets, that would be thirty <code>QThread</code> instances when the system is under max-load.  However, that may not be a big deal, as most of those threads should be \"sleeping/waiting\" for network traffic.</p>\n\n<p>Similarly, I would assume that one would instantiate UP TO the number of \"cores\" or \"native-threads-can-execute\" for <code>QThread</code> instances charged with \"heavy-continuous-work\".  So, if you had eight (8) cores, that might be another eight <code>QThread</code> instances (and these may be working all-the-time when the system is under max-load).</p>\n\n<p>Then, of course, we have the \"main-thread\".</p>\n\n<p>Does this then imply one would instantiate:</p>\n\n<p>(30 socket-threads) + (8 worker-for-each-core) + (1 main thread)</p>\n\n<p>...for 39 threads (on an 8-core system)?</p>\n\n<p>Specifically, if application-specific needs had other thread-pool-needs, and you add a dozen-<code>QThread</code>-here and a dozen-<code>QThread</code>-instances-there, it seems like 100 <code>QThread</code> instances is kinda stupid, even if most of them are \"idle/sleeping/waiting\", right?</p>\n\n<p>So, is there a cut-off?  \"39-threads\" is \"reasonable\", but \"300-threads\" is \"unreasonable\"?</p>\n\n<p>(Yes, I understand there is a \"default-stack-size-per-thread\", such as \"10MB-per-thread\", so I am limited by virtual memory.  But, really, is it stupid to instantiate 30K threads -- it's a bad design that would ever want such a thing?)</p>\n"},{"tags":["ios","multithreading","uikit","uiimage"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12922349,"title":"Creating a UIImage outside the main thread","body":"<p>I am creating a UIImage in a background thread using the code below, and then setting this image as the image of my view on the main thread. Once in a while, I get a bad access error. I am wondering if I should not be creating a UIImage in a background thread. Any thoughts?</p>\n\n<pre><code>CGImageRef imageRef =\n    CGImageCreate(serverInit.rfbWidth,serverInit.rfbHeight,bitsPerComponent,bitsPerPixel,bytesPerRow,colorSpaceRef,bitmapInfo,provider,NULL,NO,renderingIntent);\n\n    screenImage = [UIImage imageWithCGImage:imageRef];\n\n    CFRelease(imageRef);\n\n    [view performSelector:@selector(replaceImage:) onThread:[NSThread mainThread] withObject:screenImage waitUntilDone:NO];\n</code></pre>\n"},{"tags":["c#","multithreading","task-parallel-library"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":101,"score":3,"question_id":12922552,"title":"Differences between multithreading and multitasking in C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4130194/what-is-the-difference-between-task-and-thread\">What is the difference between task and thread?</a>  </p>\n</blockquote>\n\n\n\n<p>I understand the title itself may appear to be a duplicate question but I've really read all the previous posts related to this topic and still don't quite understand the program behavior.</p>\n\n<p>I'm currently writing a small program that checks around 1,000 E-mail accounts. Undoubtedly I feel multithreading or multitasking is the right approach since each thread / task is not computationally expensive but the duration of each thread relies heavily on network I/O.</p>\n\n<p>I think that under such a scenario, it would also be reasonable to set the number of threads / tasks at a number that is much larger than the number of cores. (four for i5-750). Therefore I've set the number of threads or tasks at 100.</p>\n\n<p>The code snippet written using Tasks:</p>\n\n<pre><code>        const int taskCount = 100;\n        var tasks = new Task[taskCount];\n        var loopVal = (int) Math.Ceiling(1.0*EmailAddress.Count/taskCount);\n\n        for (int i = 0; i &lt; taskCount; i++)\n        {\n            var objContainer = new AutoCheck(i*loopVal, i*loopVal + loopVal);\n            tasks[i] = new Task(objContainer.CheckMail);\n            tasks[i].Start();\n        }\n        Task.WaitAll(tasks);\n</code></pre>\n\n<p>The same code snippet written using Threads:</p>\n\n<pre><code>        const int threadCount = 100;\n        var threads = new Thread[threadCount];\n        var loopVal = (int)Math.Ceiling(1.0 * EmailAddress.Count / threadCount);\n\n        for (int i = 0; i &lt; threadCount; i++)\n        {\n            var objContainer = new AutoCheck(i * loopVal, i * loopVal + loopVal);\n            threads[i] = new Thread(objContainer.CheckMail);\n            threads[i].Start();\n        }\n        foreach (Thread t in threads)\n            t.Join();\n        runningTime.Stop();\n        Console.WriteLine(runningTime.Elapsed);\n</code></pre>\n\n<p>So what are the essential differences between these two?</p>\n"},{"tags":["multithreading","delphi"],"answer_count":5,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":472,"score":5,"question_id":4136530,"title":"How to manage the return value of a thread?","body":"<p>I created a class derived from <code>TThread</code> that executes in background a query.</p>\n\n<p>I want that this class is decoupled from the client.</p>\n\n<p>This kind of thread has the purpose of executing a simple check (like how many users are currently connected to the application, without blocking the UI), so a simple idea is to use the Synchronize Method.</p>\n\n<p>Anyway since i want it to be decoupled i pass in the constructor a parameter of type</p>\n\n<pre><code>TSyncMethod: procedure of object;\n</code></pre>\n\n<p>Where <code>TSyncMethod</code> is a method on the client (a form in my case).</p>\n\n<p>Anyway how can I pass the value to TSyncMethod? I should write the result on some \"global place\" and then inside my TSyncMethod I check for it?</p>\n\n<p>I also tried to think of </p>\n\n<pre><code>TSyncMethod: procedure(ReturnValue: integer) of object;\n</code></pre>\n\n<p>but of course when I call <code>Synchronize(MySyncMethod)</code> I cannot pass parameters to it.</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":82,"score":1,"question_id":12921046,"title":"In this simple multithreading example, why does the last method in Main() always execute last?","body":"<pre><code>static int i = 0;\n\nstatic void Main()\n{\n    ThreadTest tt = new ThreadTest();\n    new Thread(tt.Incr).Start();\n    tt.I();\n    tt.I2();\n}\n\nvoid Incr()\n{\n    for(int x = 0; x &lt; 3; x++)\n    {\n        Console.WriteLine(i);\n        i++;\n    }\n}\n\nvoid I()\n{\n    while(i &lt;= 3)\n    {\n        if(i==3)\n            break;\n        Console.WriteLine(\"Value of i in I:{0}\",i);\n    }\n}\n\nvoid I2()\n{\n    Console.WriteLine(\"\\t\\tFinally i is:{0}\\n\\n\",i);\n}\n</code></pre>\n\n<p>I have run this piece of code about a few hundred times now  and find that I2 always executes last. Why does this happen? May be a few hundred times is not enough to see the true unpredictability of threads?</p>\n\n<p><a href=\"http://pastebin.com/qmQ7f2zL\" rel=\"nofollow\">Output of 11 runs</a></p>\n"},{"tags":["java","multithreading","jython","init"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12921700,"title":"Cannot call Thread's init() method for Jython class","body":"<p>Here is a sample of class that I am actually writing in Jython:</p>\n\n<pre><code>from threading import Thread\n\nclass MyClass(Thread)\n\n    def __init__(self, mylist):\n        Thread.__init__(self)\n        self.mylist = mylist\n</code></pre>\n\n<p>And I get the error:</p>\n\n<pre><code>File 'myfile.py', line 4, in __init__   at java.lang.Class.isAssignableFrom(Native Method)\n\njava.lang.NullPointerException: java.lang.NullPointerException\n</code></pre>\n"},{"tags":["multithreading","haskell"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":127,"score":2,"question_id":12907212,"title":"Is having an Integer in a STM TVar a good idea?","body":"<p>I have function a <code>f</code> which returns a large Integer. Nearing end the program has to add up all the returned values of <code>f</code>. The physical memory of this computer is too limited to store all the returned values of <code>f</code>. So I would need to put this into a file buffer. Would TVars be able to handle Integers? Is there a solution in which I can throw all the returned values of <code>f</code>? Also, could the separate threads be able to read it and buffer it at the the same time?</p>\n"},{"tags":["c#","multithreading","timer","progress-bar","backgroundworker"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":12917306,"title":"Backgroundworker ReportProgress event does not fire","body":"<p>I've a backgroundworker which take care of a timer in my application. This is the code:</p>\n\n<pre><code>    protected override void OnLoad(EventArgs e)\n    {\n        // Inizializzo il backgroundworker \n        bgwTimer.WorkerReportsProgress = true;\n        bgwTimer.WorkerSupportsCancellation = true;\n        bgwTimer.DoWork += (bgwTimer_DoWork);\n        bgwTimer.RunWorkerCompleted +=(bgwTimer_RunWorkerCompleted);\n        bgwTimer.ProgressChanged += (bgwTimer_ProgressChanged);\n    }\n\n    void bgwTimer_ProgressChanged(object sender, ProgressChangedEventArgs e)\n    {\n        throw new NotImplementedException();\n    }\n\n    void bgwTimer_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n    {\n        throw new NotImplementedException();\n    }\n</code></pre>\n\n<p>Basically the event \"ProgressChanged\" is never fired and so I cannot update the status of a progressbar.\nThe event DoWork is linked to this method:</p>\n\n<pre><code>    void bgwTimer_DoWork(object sender, DoWorkEventArgs e)\n    {\n        int i = 0;\n        if (bgwTimer.CancellationPending)\n        {\n            e.Cancel = true;\n        }\n        else\n        {\n            while (bgwTimer.IsBusy)\n            {                \n                Thread.Sleep(1000);\n                bgwTimer.ReportProgress(i);\n                refreshTimer();\n            }\n        }\n    }\n</code></pre>\n\n<p>By my side the code looks good and it runs fine. As you can see the ReportProgress method is called but the event is not fired. Any hints?</p>\n\n<p>UPDATE:\nWhops! I found that the event \"bgwTimer_ProgressChanged\" is fired only if I run the RunWorkerAsync right after the declaration of event. Basically:</p>\n\n<p>bgwTimer.ProgressChanged += (bgwTimer_ProgressChanged);\nbgwTimer.RunWorkerAsync(); //this works!</p>\n\n<p>Since I run the worker when the user press a button, the event is not triggered.</p>\n\n<hr>\n\n<p>Here's the code of click event button:</p>\n\n<pre><code>    private void btnNext_Click(object sender, EventArgs e)\n    {            \n        this.TopMost = true;\n        btnNext.Enabled = false;\n        progressBar1.Step = 0;\n\n        if (_bgwTimer.IsBusy)\n            _bgwTimer.CancelAsync();\n        else\n            _bgwTimer.RunWorkerAsync();\n    }\n</code></pre>\n"},{"tags":["java","multithreading","timeout","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":12916580,"title":"Why aren't my threads timing out when they fail?","body":"<p>So I asked a question a little while ago: <a href=\"http://stackoverflow.com/questions/12302984/implementing-thread-timeout-in-executor-service\">Over here</a> that asked the question \"How can I make my threads get killed if they take too long\"</p>\n\n<p>I have implemented the solution mentioned there but under certain rare circumstances where a thread times out, the program can still fail / lock up (see: Keep the main() method open, and prevent further cron runs of the program).</p>\n\n<p>Here's the source I'm using:</p>\n\n<pre><code> //Iterate through the array to submit them into individual running threads.\n    ExecutorService threadPool = Executors.newFixedThreadPool(12);\n    List&lt;Future&lt;?&gt;&gt; taskList = new ArrayList&lt;Future&lt;?&gt;&gt;();\n    for (int i = 0; i &lt; objectArray.length; i++) {\n        Future&lt;?&gt; task = threadPool.submit(new ThreadHandler(objectArray[i], i));\n        taskList.add(task);\n        Thread.sleep(500);\n    }\n\n    //Event handler to kill any threads that are running for more than 30 seconds (most threads should only need .25 - 1 second to complete.\n    for(Future future : taskList){\n        try{\n            future.get(30, TimeUnit.SECONDS);\n        }catch(CancellationException cx){ System.err.println(\"Cancellation Exception: \"); cx.printStackTrace();\n        }catch(ExecutionException ex){ System.err.println(\"Execution Exception: \");ex.printStackTrace();\n        }catch(InterruptedException ix){ System.err.println(\"Interrupted Exception: \");ix.printStackTrace();\n        }catch(TimeoutException ex) {future.cancel(true);}\n    }\n    threadPool.shutdown();\n    threadPool.awaitTermination(60, TimeUnit.SECONDS);\n</code></pre>\n\n<p>So my question is:  with this code implemented, why is the executor service not cutting things off at 30 seconds.</p>\n"},{"tags":["java","arrays","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12920444,"title":"Create array in main and fill it with data from seperate threads","body":"<p>Okay so I am having trouble with this maybe i have just been thinking too long or am dumb but here is what i have and what i am trying to do:</p>\n\n<p><strong>Update- code all fixed no more run problems.</strong></p>\n\n<pre><code>public class myClass program {\n   int [] w = null;\n   int [] x = null;\n   Thread T = null;\n   public static void main(String [] args){\n    x = new int[5];\n    w = new int[5];\n\n // here i am trying to invoke a new thread passing the index\n // of my array, then incrementing the index each time i create a new thread\n // the purpose is to fill each index each time the new thread runs.\n\n    for(int i = 0; i &lt; w.length; i ++){\n      // T = new Thread(new myThreadClass(w[i])); // only passes 0 take this out and \n      T = new Thread( new myThreadClass(i));      // pass i so the position changes\n      T.start();\n      try{\n        Thread.sleep(100);\n        }catch(Exception e){}\n\n   }\n}\n</code></pre>\n\n<p>in my separate class myThreadClass.java i have the following:</p>\n\n<pre><code>public class myThreadClass extends Thread{\n int [] w = null;\n int position = 0;\n int value = 1;\n\n  public myThreadClass(int p){\n    this.position = p\n    w = myClass.w;\n  }\n\n  @Override\n  public void run(){\n   // synchronize the thread so there is no memory cache problems\n   //\n   synchronized(w){\n      w[position] = value;\n   }\n  }\n\n}\n</code></pre>\n\n<p>when i print out the output of w from myClass:</p>\n\n<p>i get <code>w = 1 0 0 0 0</code> </p>\n\n<p>but i want <code>w = 1 1 1 1 1</code></p>\n\n<p><strong>EDITED- i am now getting the right output - check the code for changes</strong></p>\n"},{"tags":["linux","multithreading","qt","opengl","xcb"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":123,"score":6,"question_id":12919093,"title":"Qt Threading Issues in Linux","body":"<p>I have been developing with Qt for some time now on my project, and we are starting to move to a more thread-oriented design. Upon moving some GL rendering widgets to other threads I have discovered some very weird behavior. It appears that if a GL Widget begins updating from another thread (boost thread or QThread) before a widget that accepts user input (such as a QTextEdit) grabs focus, I get XCB crashes that look like:</p>\n\n<pre><code>[xcb] Too much data requested from _XRead\n[xcb] This is most likely caused by a broken X extension library\n[xcb] Aborting, sorry about that.\nhypnotizer: ../../src/xcb_io.c:735: _XRead: Assertion ‘!xcb_xlib_too_much_data_requested’ failed.\n</code></pre>\n\n<p>To test this out, I actually can make a simple modification to the GLHypnotizer demo to reproduce the crash. That demo can be found here: <a href=\"http://qt-project.org/doc/qt-4.8/demos-glhypnotizer.html\" rel=\"nofollow\">http://qt-project.org/doc/qt-4.8/demos-glhypnotizer.html</a> [qt-project.org]</p>\n\n<p>If I add the line ‘mdiArea.addSubWindow(new QTextEdit(this));’ at around line 313 (before the call to newThread()), then when the demo starts there will be a QTextEdit and a GL Hypnotizer Widget. If I then click on the QTextEdit to grab focus I will get the above crash every time.</p>\n\n<p>Can anyone reproduce the error on there Linux install using the above instructions? Has anyone encountered these types of issues on Linux using Qt and threading before?</p>\n\n<p>Note: I am using Ubuntu 12 and this crash happens in VirtualBox and non VirtualBox Ubuntu installations</p>\n"},{"tags":["c#","multithreading","thread-safety","locking"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12919889,"title":"Fastest and still safe way to exchange reference variables values","body":"<p>Basically what i need is to be able to add items to List (or another collection) constantly, around 3000 times per second in one thread. And to get and remove all items from that list once per 2 seconds. </p>\n\n<p>I don't like classic ways to do this like using concurrent collections or lock on something every time i need to access collection because it would be slower than i need.</p>\n\n<p>What i'm trying to do is to have 2 collections, one for each thread, and to find a way to make a thread safe switch from one collection to another.</p>\n\n<p><strong>Simplified</strong> and not thread-safe example:</p>\n\n<pre><code>var listA = new List&lt;int&gt;();\nvar listB = new List&lt;int&gt;();\n\n// method is called externally 3000 times per second\nvoid ProducerThread(int a)\n{      \n    listA.Add(a)      \n}\nvoid ConsumerThread()\n{\n  while(true)\n  {\n    Thread.Sleep(2000);\n    listB = Interlocked.Exchange(ref listA,listB);\n    //... processing listB data\n    // at this point when i'm done reading data\n    // producer stil may add an item because ListA.Add is not atomic\n    // correct me if i'm wrong\n    listB.Clear();\n  }\n}\n</code></pre>\n\n<p>Is there any way to make above code work as intended (to be thread safe) while having producer thread blocked as little as possible? Or maybe another solution?</p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":162,"score":0,"question_id":5001784,"title":"Separate Worker Thread in Forms","body":"<p>I've got a Windows Forms Application that does some data fetching from various places. Because of this I've made a thread that fetches and updates the graphical stuff (progressbar, textfields++).</p>\n\n<p>But I'm having some problems quitting it, the thread that is. It goes something like this:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>Thread t = new Thread(new ThreadStart(this.Loop))\nt.Start();\n</code></pre>\n\n<p>and the Loop function</p>\n\n<pre><code>void Loop\n{\n    while(true)\n    {\n        if( parent window isDisposed )\n        break;\n\n        /*\n        fetch and update stuff goes in here...\n        */\n\n        Thread.Sleep(5000);    \n    }\n}\n</code></pre>\n\n<p>Closing the window will make the while break, but it is now disposed??</p>\n"},{"tags":["java","multithreading","http","quartz-scheduler","jvisualvm"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12903761,"title":"Threads running amuck with AsyncHttpClient and Quartz Job","body":"<p>Here is a simple Quartz scheduler which should run a job <strong>once every minute</strong>; the job in itself makes an HTTP request using the Sonatype <a href=\"https://github.com/sonatype/async-http-client\" rel=\"nofollow\">Async Http Client</a>. Using <code>jvisualvm</code>, I was able to detect threads spawning and never closing, e.g. they are stuck in <strong>wait</strong>. This leads me to believe that either A) I'm misunderstanding how Quartz works with this particular setup, or B) Something else is wrong. Probably A :) The scheduler:</p>\n\n<pre><code>public class QuartzAsyncHttpThreadTest {\n\n    /* TEST */\n    @SuppressWarnings(\"rawtypes\")\n    private static Class jobToRun = AsyncHttpRequestJob.class;\n    private static String cron = \"0 0/1 * * * ?\";\n    /* TEST */\n\n\n    public static void main(String[] args) throws SchedulerException {\n\n        Scheduler scheduler = new StdSchedulerFactory().getScheduler();\n        scheduler.start();\n\n        start(scheduler, jobToRun.getName(), jobToRun);\n\n    }\n\n    @SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n    public static void start(Scheduler scheduler, String name, Class job)\n            throws SchedulerException {\n\n        JobKey monitorKey = new JobKey(name + \"_job\", \"jobs\");\n        JobDetail detail = JobBuilder.newJob(job).withIdentity(monitorKey)\n                .build();\n\n        Trigger cronDef = TriggerBuilder.newTrigger()\n                .withIdentity(name + \"_trigger\", \"triggers\")\n                .withSchedule(CronScheduleBuilder.cronSchedule(cron)).build();\n\n        scheduler.scheduleJob(detail, cronDef);\n\n    }\n\n}\n</code></pre>\n\n<p>The job:</p>\n\n<pre><code>public class AsyncHttpRequestJob implements Job {\n\n    public AsyncHttpRequestJob() {\n\n    }\n\n    public void execute(JobExecutionContext context)\n            throws JobExecutionException {\n\n        System.out.println(\"Go..\");\n\n        makeRequest();\n\n    }\n\n    public static void makeRequest() {\n\n        try {\n\n            Future&lt;Response&gt; r = new AsyncHttpClient().prepareGet(\n                    \"http://google.com\").execute();\n\n            Response response = r.get();\n\n            System.out.println(\"Request status: \" + response.getStatusCode()); // 301\n\n        } catch (Exception e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    }\n\n}\n</code></pre>\n\n<p>There's really not much to it. If I profile live threads, the encroachment is noticeable after 2 minutes. First 24, than 27, 30...and so on. <img src=\"http://i.stack.imgur.com/Hha7R.png\" alt=\"enter image description here\"></p>\n\n<p><strong>EDIT</strong>: </p>\n\n<p>I was able to verify that it's a combination of the AsyncHttpClient and Quartz, as when I swap out the <code>makeRequest</code> method with a standard request:</p>\n\n<pre><code>    URL conn = new URL(\"http://google.com\");\n    URLConnection httpR = conn.openConnection();\n    BufferedReader in = new BufferedReader(new InputStreamReader(\n            httpR.getInputStream()));\n    String inputLine;\n\n    while ((inputLine = in.readLine()) != null)\n        System.out.println(inputLine);\n    in.close();\n</code></pre>\n\n<p>All works as expected.</p>\n"},{"tags":["c++","multithreading","qt","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12920336,"title":"I'm trying to figure out how to use threads in a simple Qt gui application","body":"<p>In the simple example code I have, there is a start and stop button and a counter.  When you press start, a thread is created and it increments the counter until you press stop.  The click events are all working, but the thread itself does not start when it is called from dialog.cpp and the counter never increments.  Any ideas why??</p>\n\n<p>The code is from this guy's tutorial exactly as he did it here, and his worked: <a href=\"http://www.voidrealms.com/viewtutorial.aspx?id=79\" rel=\"nofollow\">http://www.voidrealms.com/viewtutorial.aspx?id=79</a></p>\n\n<p>dialog.h</p>\n\n<pre><code>#ifndef DIALOG_H\n#define DIALOG_H\n\n#include \"mythread.h\"\n#include &lt;QDialog&gt;\n\nnamespace Ui {\nclass Dialog;\n}\n\nclass Dialog : public QDialog\n{\n    Q_OBJECT\n\npublic:\n    explicit Dialog(QWidget *parent = 0);\n    ~Dialog();\n    MyThread *mThread;\n\nprivate:\n    Ui::Dialog *ui;\n\npublic slots:\n    void onNumberChanged(int);\n\nprivate slots:\n    void on_pushButton_clicked();\n    void on_pushButton_2_clicked();\n};\n\n#endif // DIALOG_H\n</code></pre>\n\n<p>dialog.cpp</p>\n\n<pre><code>#include \"dialog.h\"\n#include \"ui_dialog.h\"\n\nDialog::Dialog(QWidget *parent) :\n    QDialog(parent),\n    ui(new Ui::Dialog)\n{\n    ui-&gt;setupUi(this);\n\n    mThread = new MyThread(this);\n    connect(mThread,SIGNAL(NumberChanged(int)), this, SLOT(onNumberChanged(int)));\n}\n\nDialog::~Dialog()\n{\n    delete ui;\n}\n\nvoid Dialog::onNumberChanged(int Number){\n    ui-&gt;label-&gt;setText(QString::number(Number));\n}\n\nvoid Dialog::on_pushButton_clicked()\n{\n    mThread-&gt;start();\n}\n\nvoid Dialog::on_pushButton_2_clicked()\n{\n    mThread-&gt;Stop = true;\n}\n</code></pre>\n\n<p>mythread.h</p>\n\n<pre><code>#ifndef MYTHREAD_H\n#define MYTHREAD_H\n\n#include &lt;QThread&gt;\n\nclass MyThread : public QThread\n{\n    Q_OBJECT\npublic:\n    explicit MyThread(QObject *parent = 0);\n    void run();\n    bool Stop;\n\nsignals:\n    void NumberChanged(int);\n\npublic slots:\n\n};\n\n#endif // MYTHREAD_H\n</code></pre>\n\n<p>mythread.cpp</p>\n\n<pre><code>#include \"mythread.h\"\n#include &lt;QtCore&gt;\n\nMyThread::MyThread(QObject *parent) :\n    QThread(parent)\n{\n}\n\n\nvoid MyThread::run() {\n\n    for (int i = 0; i &lt; 100000; i++) {\n        QMutex mutex;\n        mutex.lock();\n        if (this-&gt;Stop) break;\n        mutex.unlock();\n\n        emit NumberChanged(i);\n    }\n}\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["android","multithreading","android-activity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12919946,"title":"Android Activity lifecycle causing View refresh problems","body":"<p>I've got a problem in a big project. I'll try to boil it down to what (I hope) are the important points.  I have an app that consists of several <code>Activity</code>s, one of which is the main navigation point that the others are launched from.  </p>\n\n<p>Once the main <code>Activity</code> gets destroyed and recreated (by navigating to another <code>Activity</code> and back), view updates don't seem to work.  Specifically, I have a <code>Button</code> and several <code>TextView</code>s.  After the <code>Activity</code> is recreated, I can't change their text.  I've tried changing the <code>Activity</code> background color, and that doesn't work, either.</p>\n\n<p>My first thought was that I missed an important data member during the save/restore process.  However, I've looked at that quite a bit, and I think that's not the problem.  Also, I've tried not loading the saved data and starting fresh and it still doesn't update the views.</p>\n\n<p>Next, I considered that I might not be updating on the UI thread.  I'm certain that causes an exception, but to be sure, I posted refreshes to <code>Handler</code>.  Still no dice.</p>\n\n<p>I can, however, get limited UI changes visible if I wire them to an <code>onClick()</code>.  What works and what doesn't in that case raises other questions (some of the data is corrupted), so right now that's where I'm concentrating my investigation.  I'll provide an update once I get more of that mapped out. </p>\n\n<p>What else should I be looking at?</p>\n\n<p>UPDATE: Adding some snippets:</p>\n\n<p>From <code>onCreate()</code>:</p>\n\n<pre><code>if (savedInstanceState != null) {\n  Log.v(Calculations.log, \"Restarting with saved instance state\");\n  Serializable ser = savedInstanceState.getSerializable(\"infusion\");\n  if ((ser != null) &amp;&amp; (ser instanceof Infusion)) {\n    mInfusion = (Infusion) ser;\n  }\n  mBeganEditing = savedInstanceState.getBoolean(\"editing\",\n    mInfusion != null);\n  Log.v(Calculations.log, this.toString());\n}\n</code></pre>\n\n<p>and its matching <code>onSaveInstanceState()</code>:</p>\n\n<pre><code>@Override\nprotected void onSaveInstanceState(Bundle outState) {\n    Log.v(Calculations.log, \"StageInfusion::onSaveInstanceState()\");\n    Log.v(Calculations.log, this.toString());\n    outState.putSerializable(\"infusion\", mInfusion);\n    outState.putBoolean(\"editing\", mBeganEditing);\n    outState.putBoolean(\"resume\", true);\n    ServerManager.stopListening();\n\n    super.onSaveInstanceState(outState);\n}\n</code></pre>\n\n<p>I expect that there are other members that should be saved, but they're of minor consequence.</p>\n"},{"tags":["java","multithreading","jboss"],"answer_count":4,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":3298,"score":9,"question_id":2623453,"title":"Why reduce the size of the Java JVM thread stack?","body":"<p>I was reading an <a href=\"http://community.jboss.org/wiki/OutOfMemoryExceptions\" rel=\"nofollow\">article</a> on handling Out Of Memory error conditions in Java (and on JBoss platform)  and I saw this suggestion to reduce the size of the threadstack.  </p>\n\n<p>How would reducing the size of the threadstack help with a max memory error condition?</p>\n"}]}
{"total":30059,"page":13,"pagesize":100,"questions":[{"tags":["c","multithreading","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":11160763,"title":"Create a dynamic number of threads","body":"<p>I want to create a number of threads specified by the user. The code I have written for this is:</p>\n\n<pre><code>int nhijos = atoi(argv[1]);\n\nthread = malloc(sizeof(pthread_t)*nhijos);\n\nfor (i = 0; i &lt; nhijos; i++){\n  if (pthread_create ( &amp;thread[i], NULL, &amp;hilos_hijos, (void*) &amp;info ) != 0){\n  perror(\"Error al crear el hilo. \\n\");\n  exit(EXIT_FAILURE);\n}   \n</code></pre>\n\n<p>Is this correct? </p>\n"},{"tags":["c#","multithreading","events"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12919685,"title":"Event Callbacks with Threading in C#","body":"<p>I have a class B (implementation of INotifyPropertyChanged) that monitors for events.  It sits inside a class A that receives the event notifications.  The events class B generates can often be very frequent, so I'd like to:</p>\n\n<ol>\n<li><p>Run the code for class A on a thread ThA (not interacting with containing class, B)</p></li>\n<li><p>Run the code for class B on a thread ThB, and when an event occurs, before notifying the containing class A of the event (by doing an invoke on the dispatcher for ThA?), it checks that ThA is not in use by class A.  This way, I would keep it so that only ThA runs inside A, and also avoid overwhelming ThA with notifications from class B (info from class B will create events for class A \"only when ThA has time\").  </p></li>\n</ol>\n\n<p>So it might look something like this -</p>\n\n<pre><code>public class A\n{\n     private B b\n     private Thread ThA\n\n     public A\n     {\n         b= new B(ThA);\n         b.PropertyChanged+=..\n     }\n\n     Event1 callback running on ThA\n     Event2 callback running on ThA\n     Callback for b (invoked in ThA)\n}\n\npublic class B : INotifyPropertyChanged\n{\n       private Thread ThA\n       private Thread ThB\n\n       public B(ThA_)\n       {\n            ThA=ThA_;\n       }\n\n       private void EventInClassB_Updated(object sender, Args e)\n       {\n            if (ThA is not being used for anything)\n            {\n                DispatcherForThreadA.invoke( notifyPropertyChanged() ); //send the callback to class A\n            }\n       }\n\n}\n</code></pre>\n\n<p>Does anyone know if there is a smarter way to do this, and if not, how I might encode \"ThA is not being used for anything\"?</p>\n\n<p>Thanks!\nChris</p>\n"},{"tags":["iphone","objective-c","ios","multithreading","oop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12919147,"title":"How to block program from executing before getting a response from a window layer on top","body":"<p>In my iPhone Application I have scenarios where there are multiple <code>windows</code> on the screen (note: not <code>UIViews</code> but <code>UIWindows</code>). These have some information and <code>UIButtons</code>. In a simple way think of these as <code>UIAlertViews</code> but with special functionalities which is why alerts were not sufficient. I have block of code to show this window inside a <code>for</code> loop like this: </p>\n\n<pre><code> for (ObjectA *object in self.array) {\n        if ([object.someValue isEqualToString:@\"SomeString\"]) {\n            [self showResetMessageForObject:object];\n        }\n    }\n // SIGMA - further code here\n</code></pre>\n\n<p>and the method:</p>\n\n<pre><code>    - (void) showResetMessageForTender:(ObjectA*)object {\n// some code here\n    [resetMessageWindow performSelector:@selector(show) withObject:nil afterDelay:0.3f];\n    }\n</code></pre>\n\n<p>So when I call <code>showResetMessageForObject:</code> I want the execution of <code>SIGMA</code> to stop until I receive a button-click on the Window layer that is brought up by</p>\n\n<pre><code>[resetMessageWindow performSelector:@selector(show) withObject:nil afterDelay:0.3f];\n</code></pre>\n\n<p>How can I achieve this? (note: 'SIGMA' is just place-holder for the readers)</p>\n"},{"tags":["multithreading","powershell","parallel-processing"],"answer_count":4,"favorite_count":5,"up_vote_count":13,"down_vote_count":0,"view_count":11478,"score":13,"question_id":4016451,"title":"Can Powershell Run Commands in Parallel?","body":"<p>I have a powershell script to do some batch processing on a bunch of images and I'd like to do some parallel processing.  Powershell seems to have some background processing options such as start-job, wait-job, etc, but the only good resource I found for doing parallel work was writing the text of a script out and running those (<a href=\"http://blog.isaacblum.com/2010/01/22/powershell-multithreading-omg/\" rel=\"nofollow\">PowerShell Multithreading</a>)</p>\n\n<p>Ideally, I'd like something akin to parallel foreach in .net 4.</p>\n\n<p>Something pretty seemless like:</p>\n\n<pre><code>foreach-parallel -threads 4 ($file in (Get-ChildItem $dir))\n{\n   .. Do Work\n}\n</code></pre>\n\n<p>Maybe I'd be better off just dropping down to c#...</p>\n"},{"tags":["multithreading","concurrency","functional-programming","actor","actor-model"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":728,"score":6,"question_id":1813794,"title":"When should one use the Actor model?","body":"<p>When should the <a href=\"http://en.wikipedia.org/wiki/Actor_model\" rel=\"nofollow\">Actor Model</a> be used?</p>\n\n<p>It certainly doesn't guarantee deadlock-free environment. Actor A can wait for a message from B while B waits for A. Also, if an actor has to make sure its message was processed before moving on to its next task, it will have to send a message and wait for a \"your message was processed\" message instead of the straightforward blocking. What's the power of the model?</p>\n"},{"tags":["multithreading","perl"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":72,"score":3,"question_id":12913902,"title":"Multithreading in perl program giving unexpected result on windows","body":"<p>I am new to perl and trying out multithreading. I was expecting following program to create all the threads and print \"created all the threads\" at least after 5 seconds, once executed and all the threads waiting for the input value.</p>\n\n<pre><code>use threads;\n\nmy @arr = (1,2,3,4);\nforeach (@arr) {\n    sleep(1);\n    print \"\\ncreating...\\n\";\n    threads-&gt;new(\\&amp;echo, $_);\n    print \"\\ncreated\\n\";\n}\nprint \"\\ncreated all the threads\\n\";\nsleep(200); #wait for the threads to finish\n\nsub echo {\n    my ($thread) = @_;\n    print \"\\nthread($thread) Enter the value:\\n\";\n    my $value = &lt;&gt;;\n    print \"\\nthread($thread) Got value= $value\\n\";\n}\n</code></pre>\n\n<p>But I am getting following outout:</p>\n\n<pre><code>creating...\n\ncreated\n\nthread(1) Enter the value:\n\ncreating...\n</code></pre>\n\n<p>It seems the other 3 threads are not yet created, if I remove the sleep(1) I get sometimes expected result, but with the sleep(1) involved, even waiting for few minutes, I get the above result. What I may be missing? I think it is something basic, but I am not able to figure out.</p>\n\n<p>UPDATE:</p>\n\n<p>The same program works on Linux flawless, what could be the platform specific problem for windows?</p>\n\n<p>UPDATE2:</p>\n\n<p>Following java program on the same lines works just fine on the same box:</p>\n\n<pre><code>import java.io.IOException;\n\n\npublic class MT {\n\n    public static void main(String[] args)throws Exception {\n        for(int i=0;i&lt;4;i++){\n            Thread.sleep(2000);\n            new Thread(new Task(i)).start();\n        }\n        System.out.println(\"created all the threads\");\n        Thread.sleep(20000);\n\n    }\n\n    static class Task implements Runnable{\n\n        int i;\n        public Task(int i) {\n            super();\n            this.i = i;\n        }\n        @Override\n        public void run() {\n            try {\n                System.out.println(\"Thread:\"+i+\" Enter value\");\n                int x= System.in.read();\n                System.out.println(x);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I am not sure how perl supports multithreading on windows!</p>\n"},{"tags":["android","multithreading","activity","dialog"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12916195,"title":"Dialog error after killing activity in Android application","body":"<p>I'm in Activity example.activity.SetupManage. After some operations I call a dialog that shows a notification message. But even if I don't click OK button, all the subsequent code is executed, so when I kill all Activity the dialog creates problems. What can I do for solving my problem?</p>\n\n<pre><code>    AlertDialog myAlertDialog;\n    public void onDestroy(Bundle savedInstanceState){\n\n    if(myAlertDialog.isShowing())\n        myAlertDialog.dismiss();\n}\n  // *** some operations *** //\n  try{\n        myAlertDialog = new AlertDialog.Builder(this)\n        .setTitle(\"Notification\")\n        .setMessage(\"Operation Failed\")\n        .setPositiveButton(\"OK\", new DialogInterface.OnClickListener() {\n            public void onClick(DialogInterface dialog, int which) {\n\n        }\n    })\n    .show();\n\n    }\n    catch(Exception ex){\n\n    }\n\n    try{\n    Intent myIntent = new Intent();\n    myIntent.setClassName(\"example.activity\", \"example.activity.MainActivity\");\n    myIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP|\n            Intent.FLAG_ACTIVITY_NEW_TASK);\n    startActivity(myIntent);\n    }catch(Exception ex){\n\n    }\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>   10-16 15:33:11.120: E/WindowManager(4360): Activity example.activity.SetupManage has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@415ca638 that was originally added here\n   10-16 15:33:11.120: E/WindowManager(4360):   at example.activity.SetupManage.CleanDatabase(SetupManage.java:61)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.view.ViewRoot.&lt;init&gt;(ViewRoot.java:288)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:249)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:193)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.view.WindowManagerImpl$CompatModeWrapper.addView(WindowManagerImpl.java:118)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.view.Window$LocalWindowManager.addView(Window.java:532)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.app.Dialog.show(Dialog.java:269)\n   10-16 15:33:11.120: E/WindowManager(4360):   at android.app.AlertDialog$Builder.show(AlertDialog.java:907)\n   10-16 15:33:11.120: E/WindowManager(4360):   at example.activity.SetupManage.CleanDatabase(SetupManage.java:61)\n</code></pre>\n"},{"tags":["multithreading","bash","restart","sysadmin"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12877607,"title":"Write a bash script to restart a daemon","body":"<p>I thought I could just use this related question: <a href=\"http://stackoverflow.com/questions/696839/how-do-i-write-a-bash-script-to-restart-a-process-if-it-dies\">How Do I write a bash script to restart a process if it dies</a>.  @lhunath had a great answer and told me everything I might do about it was wrong, but I'm restarting a daemon process and if I'm hoping there's something I can do in a single script that works. </p>\n\n<p>my process starts with a kick off script that shows the startup log, but then quits and leaves the process running off the shell: </p>\n\n<pre><code>&gt;sudo ./start\nR CMD Rserve --RS-conf /var/FastRWeb/code/rserve.conf --vanilla --no-save\n...\nLoading required package: FastRWeb\nFastRWeb: TRUE\nLoading data...\nRserv started in daemon mode.\n&gt;\n</code></pre>\n\n<p>The process is up and running,</p>\n\n<blockquote>\n  <p>ps -ale | grep Rserve\n      1 S    33 16534     1  0  80   0 - 60022 poll_s ?        00:00:00 Rserve</p>\n</blockquote>\n\n<p>Is there a simple way to wrap or call the 'start' script from bash and restart when the process dies or is this a case where PID files are actually called for? </p>\n\n<p>Dang - question got closed even after pointing to a very similar question that was not closed on stackoverflow. you guys suck</p>\n"},{"tags":["android","multithreading","service","timer"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12915114,"title":"How to use thread / timer in android service and update UI?","body":"<p>I am developing an android application which will start a service.The service will execute some code after every fixed interval of time and end the result to the activity.The activity should display the result to the user.</p>\n\n<p>First I tried it with a thread.\nFor the service to execute after a fixed interval I create a thread - execute the code, get the result - send this result to activity for display - put the thread to sleep for a some fixed time interval.\nBut it is not working as expected.The code is executed by the thread. The thread goes to sleep and then the result is sent to the activity at the end after the sleep time interval. The requirement is the UI must be immediately updated after the result is obtained by the thread code execution. </p>\n\n<p>I have also tried using Timer and TimerTask. But it gives the same result as above.\nPlease help me on this.</p>\n\n<p><strong>Service class</strong> </p>\n\n<pre><code>@Override\npublic int onStartCommand(Intent intent, int flags, int startId)\n{\n    td = new ThreadDemo();\n    td.start();\n}\nprivate class ThreadDemo extends Thread  \n{\n    @Override\n        public void run()\n        {\n            super.run();\n            String result = //code executes here and returns a result\n            sendMessageToUI(result);  //method that will send result to Activity\n            ThreadDemo.sleep(5000);\n        }\n}\n\nprivate void sendMessageToUI(String strMessage)\n{\n    Bundle b = new Bundle();\n    b.putString(“msg”, strMessage);\n    Message msg = Message.obtain(null, 13);\n    msg.setData(b);\n}\n</code></pre>\n\n<p><strong>Activity class</strong></p>\n\n<pre><code>public class MyActivity extends Activity\n{\n    @Override\n    public void onCreate(Bundle savedInstanceState)\n    {\n        super.onCreate(savedInstanceState);\n    }\n    class IncomingHandler extends Handler \n    {\n        @Override\n        public void handleMessage(Message msg)\n        {\n            System.out.println(\"in ui got a msg................\");\n            switch (msg.what)\n            {\n                case 13:\n                    System.out.println(\"setting status msg..............\");\n                    String str1 = msg.getData().getString(\"msg\");\n                    textview.setText(str1);\n                    break;      \n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","recursion"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":137,"score":4,"question_id":12894046,"title":"How to track the completion of all the threads. C#","body":"<p>I need to freeze the main thread until the end recursion.\nRecursion depth = count of threads.</p>\n\n<p>sample code:</p>\n\n<pre><code>    BackgroundWorker backgroundWorker1;\n    Random ran;\n\n    private void Form1_Load(object sender, EventArgs e)\n    {\n        method();\n        label1.Text = \"Threads is finished\";\n    }\n\n\n    private void method() // recursive method\n    {\n\n            Thread.Sleep(100);\n\n            backgroundWorker1 = new BackgroundWorker();\n\n            backgroundWorker1.DoWork +=\n                new DoWorkEventHandler(backgroundWorker1_DoWork);\n            backgroundWorker1.RunWorkerAsync();               //Beginning new thread\n    }\n\n    private void backgroundWorker1_DoWork(object sender,\n       DoWorkEventArgs e)\n    {\n            ran = new Random();\n            Thread.Sleep(ran.Next(500, 1000));\n            if (ran.Next(1, 5) != 1) // if = 1 then to stop recursion\n            {\n                method();\n            }\n    }\n</code></pre>\n\n<p>When the threads are completed, <code>label1.Text</code> must have the value <code>\"Threads is finished\"</code>. How is this done? </p>\n"},{"tags":["android","multithreading","sms","android-gcm"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":86,"score":4,"question_id":12914521,"title":"Android - send sms in separate thread","body":"<p>I am writing an android application (with a service), where I need to send a message when I receive a GCM notification.</p>\n\n<p>Main problem: When I send 3 SMS in same time, any other operation are stopped for a long time (10-20 seconds) and the phone is blocked, too. I tried to send SMS in thread, but there are no differences. </p>\n\n<p><strong>SmsSender.java</strong></p>\n\n<pre><code>public class SmsSender implements Runnable{ \n    private Context context;\n    private String phoneNumber;\n    private String message;\n    private int id; \n\npublic SmsSender(Context paramContext, String phoneNumber, String message, int id) {\n        super();\n        this.context = paramContext;\n        this.phoneNumber = phoneNumber;\n        this.message = message;\n        this.id = id;\n    }\n\n    public void run() {\n        try {    \n\n        Intent sentIntent = new Intent(\"sent\");\n        Intent deliveredIntent = new Intent(\"delivered\");\n        sentIntent.putExtra(\"id\", id);\n        deliveredIntent.putExtra(\"id\", id);\n        PendingIntent sentPI = PendingIntent.getBroadcast(this.context, id,sentIntent, 0);\n        PendingIntent deliveredPI = PendingIntent.getBroadcast(this.context, id, deliveredIntent, 0);           \n\n        SmsManager smsManager = SmsManager.getDefault();                    \n        ArrayList&lt;String&gt; parts = smsManager.divideMessage(message);\n        ArrayList&lt;PendingIntent&gt; sentList = new ArrayList&lt;PendingIntent&gt;();\n        sentList.add(sentPI);\n        ArrayList&lt;PendingIntent&gt; deliveredList = new ArrayList&lt;PendingIntent&gt;();\n        deliveredList.add(deliveredPI);\n        smsManager.sendMultipartTextMessage(phoneNumber, null, parts, sentList, deliveredList);             \n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n</code></pre>\n\n<p><strong>Run thread</strong></p>\n\n<blockquote>\n  <p>new Thread(new SmsSender(getApplicationContext(), phoneNumber,\n  message, id)).start();</p>\n</blockquote>\n\n<p>Where is the problem? Why is the SMS sent in main thread, instead of my thread? </p>\n"},{"tags":["c#",".net","multithreading","queue"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12912289,"title":"Best practice with a schedule/queue service?","body":"<p>I am currently working on a project, this project is basically a web site which as its main function, runs a long calculation task (this task is made up of between 1-10 sub tasks) - (takes about 30-40 seconds to complete on average) and returns a result to the user, as it stands the code uses multiple threading in the site itself (which i don't really like the idea of), so the site continues to run after a button click, whilst this thread in the background continues the calculation.</p>\n\n<p>I'd ideally like to move this calculation into a separate service, to stop the issues related to running threading in a web app. My idea is that it should be a separate service that runs every X seconds to see if any jobs are present in the database, if there are, run them, but i have little experience in writing a reoccurring windows service, and was wondering if anyone has any ideas on the matter, is this the right way to go about such a task, does anyone have any experience of doing something similar, and can anybody recommend any particular ways I should proceed?</p>\n"},{"tags":["java","multithreading","udp"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":12878421,"title":"How to become aware when DatagramSocket is in a receive state","body":"<p>I am running a UDP Java implementation using DatagramSocket where the receive is running on one thread and the sending operations are run on a separate thread.  When my program starts up, I need to make a call out to a server and receive information back.  The problem is, due to the threading, even though I start my receiving thread first, sometimes the send will go out first and when the server replies, the socket has not called receive() yet in the other thread.  Since this thread blocks on the receive() line, I can't use a flag to verify that receive() has been called. Is there any way to check if the socket is currently blocking on receive() so that I can wait to send until I verify that condition?</p>\n"},{"tags":["java","multithreading","spring","session","web-applications"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12911401,"title":"After passing RequestAttributes to new thread the session is lost","body":"<p>I have a web application(using spring and vaadin) were i need to create a secondary thread to do some work(I cannot do this another way because of the existing code which i cannot change). In this thread i need access to the session. I found this useful answer:<br>\n<a href=\"http://stackoverflow.com/questions/1528444/accessing-scoped-proxy-beans-within-threads-of\">Accessing scoped proxy beans within Threads of</a><br>\nEverything is ok but after the thread has started when i try to get the session i get null. I still get the session id though...  </p>\n\n<pre><code>public RequestAwareRunnable() {\n    this.requestAttributes = RequestContextHolder.getRequestAttributes();\n    this.thread = Thread.currentThread();\n    String sessionID = requestAttributes.getSessionId();\n    HttpSession session = ((ServletRequestAttributes) requestAttributes).getRequest().getSession(false);//the session is OK\n}\n\npublic void run() {\n    try {\n        String sessionID = requestAttributes.getSessionId();\n        HttpSession session = ((ServletRequestAttributes) requestAttributes).getRequest().getSession(false); // i get null\n        RequestContextHolder.setRequestAttributes(requestAttributes);\n        onRun();\n    } finally {\n        if (Thread.currentThread() != thread) {\n            RequestContextHolder.resetRequestAttributes();\n        }\n        thread = null;\n    }\n}\n</code></pre>\n\n<p>Any ideas? </p>\n"},{"tags":["java","multithreading","concurrency","runnable"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12909288,"title":"I can't finish thread (runnable), how it is?","body":"<pre><code>Thread thread;     \n\npublic void onCreate(Bundle savedInstanceState) {\nsuper.onCreate(savedInstanceState);\nsetContentView(R.layout.activity_yippi);  \nfinal Handler hn=new Handler();\nfinal TextView text=(TextView)findViewById(R.id.TextView01);\nfinal Runnable r = new Runnable()\n{\n    public void run() \n    {\n        text.settext(\"hi\");\n    }\n};\nthread = new Thread()\n{\n\n    @Override\n    public void run() {\n        try {\n            while(true) {\n                sleep(1750);\n                hn.post(r);\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n};\n    thread.start();\nthread.stop();}\n</code></pre>\n\n<p>The code here. I can not stop the runnable thread. Also, <code>thread.stop()</code> and <code>thread.destroy()</code> are deprecated. Can somebody help me? And also I don't understand how to stop the thread with the <code>thread.interrupt()</code> method. What's wrong?</p>\n"},{"tags":["python","multithreading","gui"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12911136,"title":"python UI freezing","body":"<p>I'm trying to make basic functionality\nafter pressing \"start\" button start counter , after pressing stop button stop counter,\nbut after I start process, it looks like only counting thread is working and it's not possible to press stop button</p>\n\n<pre><code>#!/usr/bin/python\n# -*- coding: utf-8 -*-\n\nimport sys\nfrom PyQt4 import QtGui, QtCore\nfrom test.test_sax import start\nimport time\nfrom threading import Thread\nimport threading\nclass Example(QtGui.QWidget):\n    x = 1\n    bol = True\n    def __init__(self):\n        super(Example, self).__init__()\n\n\n        self.qbtn = QtGui.QPushButton('Quit', self)\n\n        self.qbtn.resize(self.qbtn.sizeHint())\n        self.qbtn.move(50, 50)\n        self.qbtn2 = QtGui.QPushButton('Start', self)\n\n        self.qbtn2.resize(self.qbtn2.sizeHint())\n        self.qbtn2.move(150, 50)\n\n        self.qbtn.clicked.connect(self.stopCounter)\n        self.qbtn2.clicked.connect(self.startUI)\n\n        self.setGeometry(300, 300, 250, 150)\n        self.setWindowTitle('Quit button')\n        self.show()\n    def stopCounter(self):\n        Example.bol = False\n\n    def startUI(self):\n        Example.bol = True\n        thread = Thread(self.counterr())\n\n    def counterr(self):\n        x = 0\n        while Example.bol:\n            print x\n            x += 1\n\n\n\nif __name__ == '__main__':\n    app = QtGui.QApplication(sys.argv)\n    a = Example()\n    sys.exit(app.exec_())\n</code></pre>\n\n<p>thx</p>\n"},{"tags":["multithreading","delphi","ping","indy","tthread"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":246,"score":5,"question_id":12858551,"title":"Delphi (XE2) Indy (10) Multithread Ping","body":"<p>I have a room with 60 computers/devices (40 computers and 20 oscilloscopes Windows CE based) and I would like to know which and every one is alive using ping. First I wrote a standard ping (see here <a href=\"http://stackoverflow.com/questions/12723081/delphi-indy-ping-error-10040\">Delphi Indy Ping Error 10040</a>), which is working fine now but takes ages when most computers are offline.</p>\n\n<p>So what I am trying to do is to write a MultiThread Ping but I am quite struggling with it. I have seen only very few examples over the internet and no one was matching my needs, that's why I try to write it myself.</p>\n\n<p>I use XE2 and Indy 10 and the form is only constitued of a memo and a button.</p>\n\n<pre><code>unit Main;\n\ninterface\n\nuses\n  Winapi.Windows, System.SysUtils, System.Classes, Vcl.Forms,\n  IdIcmpClient, IdGlobal, Vcl.StdCtrls, Vcl.Controls;\n\ntype\n  TMainForm = class(TForm)\n    Memo1: TMemo;\n    ButtonStartPing: TButton;\n    procedure ButtonStartPingClick(Sender: TObject);\n  private\n    { Private declarations }\n  public\n    { Public declarations }\n  end;\n\ntype\n  TMyPingThread = class(TThread)\n  private\n    fIndex : integer;\n    fIdIcmpClient: TIdIcmpClient;\n    procedure doOnPingReply;\n  protected\n    procedure Execute; override;\n  public\n    constructor Create(index: integer);\n  end;\n\nvar\n  MainForm: TMainForm;\n  ThreadCOunt : integer;\n\nimplementation\n\n{$R *.dfm}\n\nconstructor TMyPingThread.Create(index: integer);\nbegin\n  inherited Create(false);\n\n  fIndex := index;\n  fIdIcmpClient := TIdIcmpClient.Create(nil);\n  fIdIcmpClient.ReceiveTimeout := 200;\n  fIdIcmpClient.PacketSize := 24;\n  fIdIcmpClient.Protocol := 1;\n  fIdIcmpClient.IPVersion := Id_IPv4;\n\n  //first computer is at adresse 211\n  fIdIcmpClient.Host := '128.178.26.'+inttostr(211+index-1);\n\n  self.FreeOnTerminate := true;\nend;\n\nprocedure TMyPingThread.doOnPingReply;\nbegin\n  MainForm.Memo1.lines.add(inttostr(findex)+' '+fIdIcmpClient.ReplyStatus.Msg);\n  dec(ThreadCount);\n\n  if ThreadCount = 0 then\n    MainForm.Memo1.lines.add('--- End ---');\nend;\n\nprocedure TMyPingThread.Execute;\nbegin\n  inherited;\n\n  try\n    fIdIcmpClient.Ping('',findex);\n  except\n  end;\n\n  while not Terminated do\n  begin\n    if fIdIcmpClient.ReplyStatus.SequenceId = findex then Terminate;\n  end;\n\n  Synchronize(doOnPingReply);\n  fIdIcmpClient.Free;\nend;\n\nprocedure TMainForm.ButtonStartPingClick(Sender: TObject);\nvar\n  i: integer;\n  myPing : TMyPingThread;\nbegin\n  Memo1.Lines.Clear;\n\n  ThreadCount := 0;\n  for i := 1 to 40 do\n  begin\n    inc(ThreadCount);\n    myPing := TMyPingThread.Create(i);\n    //sleep(10);\n  end;\nend;\n\nend.\n</code></pre>\n\n<p>My problem is that it \"seems\" to work when I uncomment the \"sleep(10)\", and \"seems\" not to be working without it. This for sure means I am missing a point in the threading I have written.</p>\n\n<p>In other words. When Sleep(10) is in the code. Every time I clicked the button to get to check the connections the result was correct.</p>\n\n<p>Without the sleep(10), it is working \"most\" of the time but some times the result is wrong giving me a ping echo on offline computers and no ping echo on online computer, as is the ping reply was not assigned to the correct thread.</p>\n\n<p>Any comment or help is welcome.</p>\n\n<p><strong>----- EDIT / IMPORTANT -----</strong></p>\n\n<p>As a general follow up of this question, @Darian Miller started a <a href=\"https://code.google.com/p/delphi-stackoverflow/\" rel=\"nofollow\" title=\"Google Code Project\">Google Code project here</a>  <a href=\"https://code.google.com/p/delphi-stackoverflow/\" rel=\"nofollow\">https://code.google.com/p/delphi-stackoverflow/</a> which is a working basis. I mark his answer as the \"accepted answer\" but users should refer to this open source project (all the credit belongs to him) as it will surely be extended and updated in the future.</p>\n"},{"tags":["multithreading","exception","runtimeexception","uncaughtexceptionhandler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12909937,"title":"dalvikvm: thread exiting with uncaught exception","body":"<p>I have referred to the <a href=\"http://stackoverflow.com/a/6662631/1702774\">accepted answer</a> of the post \"<a href=\"http://stackoverflow.com/questions/6662539/java-thread-exceptions\">java thread exceptions</a>\".\nMy question is how can I avoid the following warning message in the log cat:</p>\n\n<blockquote>\n  <p>10-16 15:29:47.009: W/dalvikvm(3813): threadid=9: thread exiting with uncaught exception (group=0x40015560)</p>\n</blockquote>\n\n<p>When I run the program in debug mode, debugger always force to stop at the line:</p>\n\n<blockquote>\n  <p>throw new RuntimeException();</p>\n</blockquote>\n\n<p>and show me the above warning message after stepping over.</p>\n\n<p>How can I modify the code to avoid it? Thank you!</p>\n"},{"tags":["java","multithreading","java-ee","thread-safety"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12908025,"title":"How do threads actually work?","body":"<p>Here is a scenario </p>\n\n<p>We have two threads both access same piece of code and that code has a variable, for instance</p>\n\n<p>int a=200;</p>\n\n<p>thread A enters and changes it's value to a=300;</p>\n\n<p>then thread B access this variable , what would thread B get 200 or 300?</p>\n"},{"tags":["android","multithreading","geocoding"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12889375,"title":"why my thread is stopped inside handler after getting Geocode response?","body":"<p>i create a new thread in my Activity. Inside it's run(..) i write a code to get Geo-code from Google. When i got JSON response and after processing i send it to handler. Inside handler i found new thread is died .</p>\n\n<p>Here is my run()</p>\n\n<pre><code>@Override\n    public void run() {\n        try {\n\n            Thread.sleep(4000);\n            Log.d(\"Thread\", \"---Is Running---\");\n            getCityName = getIntent().getStringExtra(\"city\");\n            Log.d(\"----getCityName----\", getCityName);\n\n            HttpRetriever httpObj = new HttpRetriever();\n            String geocodeUrl = \"http://maps.googleapis.com/maps/api/geocode/json?address=\"\n                    + getCityName + \"&amp;sensor=true\";\n            String url = geocodeUrl.replace(\" \", \"%20\");\n\n            Log.d(\"----geocodeUrl----\", url);\n\n            geocodeResponse = httpObj.retrieve(url);\n            Log.d(\"----Json Response----\", geocodeResponse);\n\n            JSONObject jsonObject = new JSONObject(geocodeResponse);\n\n            JSONArray jsonArray = (JSONArray) jsonObject.get(\"results\");\n\n            if (jsonArray.length() &gt; 0) {\n\n                jsonObject = (JSONObject) jsonArray.get(0);\n                jsonObject = (JSONObject) jsonObject.get(\"geometry\");\n                JSONObject location = (JSONObject) jsonObject\n                        .get(\"location\");\n                Double lat = (Double) location.get(\"lat\");\n                Double lng = (Double) location.get(\"lng\");\n\n                mypoint = new GeoPoint((int) (lat * 1000000),\n                        (int) (lng * 1000000));\n\n                Log.d(\"-----Lat LOng-----\", \"\" + lat + \" \" + lng);\n\n                addOverlayOnMap(mypoint, getCityName);\n\n                myMap.getController().animateTo(mypoint);\n                myMap.getController().setZoom(6);\n\n            }\n\n        } catch (JSONException e) {\n\n            e.printStackTrace();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        handler.sendEmptyMessage(0);\n\n    }\n</code></pre>\n\n<p>Here is my Handler.</p>\n\n<pre><code>Handler handler = new Handler() {\n    public void handleMessage(android.os.Message msg) {\n        pdDialog.dismiss();\n        if (geocodeResponse != null) {\n\n            if (t.isAlive() == true) {\n                Log.v(\"------Thread-----\",\n                        \"---Inside Handler----Thread is Alive!!!!----\");\n\n            } else {\n                Log.v(\"------Thread-----\",\n                        \"---Inside Handler---Thread is Died!!!!----\");\n\n            }\n\n            Toast.makeText(getApplicationContext(), \" Ya got the json\",\n                    Toast.LENGTH_LONG).show();\n\n        }\n\n        else\n            Toast.makeText(getApplicationContext(), \"Not Success\",\n                    Toast.LENGTH_LONG).show();\n    }\n\n};\n</code></pre>\n\n<p><strong>I just wondering why my thread is stopped inside handler? Though i don't stop it any where.I test codes in emulator</strong> </p>\n\n<p><strong>If u have the issue, can share.</strong></p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["java","android","multithreading","android-asynctask"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12904622,"title":"Is there something similar to onPreExecute and onPostExecute for traditional Threads?","body":"<p>I was using <code>AsyncTask</code> and just switched over to using a traditional <code>Thread</code> for reasons not worth going into for the sake of this question.</p>\n\n<p>What can I do to make something execute before and after the thread starts, similar to the functionality of onPre/PostExecute?</p>\n\n<p>For example, let's say I want to display a loading circle before the thread starts, and dismiss it when it finishes. How would I do that?</p>\n\n<p>For the post-execution bit, I'm using thread.join() and it seems to do the trick. I'm not sure if that's the way to go about it though, or how to do something pre-execution.</p>\n"},{"tags":["java","multithreading","multiple","hashtable"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12906697,"title":"Multiple threads HashTable in java","body":"<p>MainThread has a HashTable, which save a mapping from customId to SubThread Object, and put task to map. SubThread remove task from map.\nhow to avoiding this problem?</p>\n\n<p>thread 1:</p>\n\n<pre><code>public void start()\n{\n        subThreadMap = new Hashtable&lt;Integer, SubThread&gt;();\n        while(true)\n        {\n            List&lt;CloudPusherTaskInfo&gt; taskInfos = TestDao.getTasks();\n\n        for (CloudPusherTaskInfo task : taskInfos)\n        {\n            distribute(task);\n        }\n    }\n}\n\nprivate void distribute(CloudPusherTaskInfo task)\n{\n    SubThread subThread = null;\n\n    if(subThreadMap.containsKey(task.getCustomerId()))\n    {\n        /*\n         * if subThread exist, add a task to it\n         */\n        subThread = subThreadMap.get(task.getCustomerId());\n\n/* -----at this point, the other subThread maybe end, and return null--------*/\n\n        subThread.add(task);\n    }\n    else\n    {\n        /*\n         * if subThread is not exist, create a new subthread, then add a task and run it \n         */\n        SubThread newThread = createNewSubThread(task.getCustomerId());\n        subThread = subThreadMap.put(task.getCustomerId(), newThread);\n        newThread.add(task);\n        new Thread(newThread).start();\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","deadlock"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":11167325,"title":"Hard time with Concurrency in Java","body":"<p>So, I'm having a hard time trying to resolve a college problem...\nWhat I need to do is :</p>\n\n<p>I need to create an app that simulates money transfer between accounts using concurrency.\nI need to create a method which does this transference in a Bank class like this:</p>\n\n<pre><code>transfer(int from, int to, int value)\n</code></pre>\n\n<p>Then I need to create a TransferThread class which manages this transferences.</p>\n\n<p>Problem is I'm getting deadlocks all the time...\nWhat I've done so far:</p>\n\n<p>TransferThread:</p>\n\n<pre><code>public void run() {\n        int para,de,valor;\n        try\n        {\n            while(!interrupted())\n            {\n                para = new Random().nextInt(banco.getNUMCONTAS());\n                de = new Random().nextInt(banco.getNUMCONTAS());\n                valor = (int) (10000 * Math.random());\n                if(de == para)\n                    continue;\n                banco.transfer(de, para, valor);\n                sleep(1);\n            }\n        }catch(InterruptedException e)\n        {\n            System.out.println(e.getMessage());\n        }\n    }\n</code></pre>\n\n<p>Banco:</p>\n\n<pre><code>  public synchronized void transfer(int de, int para, int valor) {\n        while(contas[de].getSaldo() - valor &lt;= 0)\n        {\n            try\n            {\n                wait();\n            }catch(InterruptedException e)\n            {\n\n            }\n        }\n        notifyAll();\n        contas[de].setSaldo(-valor);\n        contas[para].setSaldo(valor);\n        System.out.println(\"Conta num: \" + contas[de].getNum() + \". Saldo: \" + contas[de].getSaldo());\n        System.out.println(\"Conta num: \" + contas[para].getNum() + \". Saldo: \" + contas[para].getSaldo());\n    }\n</code></pre>\n\n<p>And main:</p>\n\n<pre><code>Banco b = new Banco();\n        TransferThread[] threads = new TransferThread[2];\n        for(int i = 0; i &lt; 2; i++){\n            threads[i] = new TransferThread(b);\n            threads[i].start();\n        }\n</code></pre>\n\n<p>How can I make this work?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12894924,"title":"having thread object lock vs class lock","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1536064/what-is-the-difference-between-synchronized-and-static-synchronized\">What is the difference between synchronized and static synchronized?</a>  </p>\n</blockquote>\n\n\n\n<p>What is the advantage having object lock over class lock?</p>\n\n<p>For example, </p>\n\n<pre><code> public static void log2(String msg1, String msg2){\n       synchronized(MyClass.class){\n          log.writeln(msg1);\n          log.writeln(msg2);  \n       }\n    }\n</code></pre>\n\n<p>and,</p>\n\n<pre><code>public void log2(String msg1, String msg2){\n       synchronized(this){\n          log.writeln(msg1);\n          log.writeln(msg2);\n       }\n    }\n</code></pre>\n"},{"tags":["c++","multithreading","qt","gui"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12903260,"title":"What is the structure of a simple threaded gui application using Qt?","body":"<p>I'm trying to wrap my head around threading and gui applications so I can start to build them.  I downloaded the Qt SDK but am a bit lost.  </p>\n\n<p>Just so I can understand how this works, I want to create a gui application that consists of a text box and two buttons.  Each button would start a new thread (so 3 could be running at the same time: the main gui thread, and the 2 initiated from the buttons), and each would have access to the information in the text box.  How would I set this application up?</p>\n"},{"tags":["multithreading","synchronization","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12757707,"title":"Is it possible to open a serial port multiple times?","body":"<p>I'm designing a control system which should handle too many actuators (or sets of actuators) over a serial port. The new design (not implemented yet) is supposed to control actuators over multiple POSIX threads. </p>\n\n<p>Is this possible to open a serial port multiple times (by multiple threads)?\nIf yes, I'm gonna write a synchronous write / asynchronous read mechanism. There will be <code>n</code> threads <code>M[0]</code> to <code>M[n-1]</code> which can write data directly to serial port. They're not supposed to read from serial port directly. Instead, a thread <code>R</code> is supposed to read data from port in a <code>while(true)</code> loop and serve data to corresponding threads waiting for it. (Wake up <code>M[i]</code> which is waiting for response, when data is ready and it belongs to <code>i</code>th thread)</p>\n\n<p>It's all depended on the question if it's possible to write to serial port by multiple threads or not.</p>\n\n<p><strong>notes</strong>: I can't test the behavior of serial port, because currently I have no access to devices in mechatronics lab of my university, </p>\n\n<p>I'm using kernel 2.6.38-8 patched with Xenomai real-time subsystem (if important)</p>\n\n<p>I'm porting code to traditional Linux way of communicating with serial port. (Open <code>/dev/ttyS0</code>, set baudrate, <code>read()</code>, <code>write()</code>, etc.) Currently a third party library is used to talk with serial port. </p>\n"},{"tags":["multithreading",".net-4.0","timer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12900230,"title":"function return not wait for timer stop","body":"<p>I create function in which I create System.Timers.Timer and in new thread new function is invoke. But my first function not wait for timer.Stop execution and return value after invoke timer.Start()</p>\n\n<p>When I add this code before function return:</p>\n\n<pre><code>while(timer.Enabled)\n{\nThread.Sleep(2000);\n}\n</code></pre>\n\n<p>timer function is never invoked :/</p>\n\n<p>Wwhat I do wrong ?</p>\n"},{"tags":["c++","multithreading","c++11","std"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12905631,"title":"Using threads and this_thread::yield to determine printing order","body":"<p>This pulls in a text file properly but it does not output it in the correct order, I need one thread to yield but when i try to implement it, it has not worked. Every time the program runs it displays the vows and cons in a random order, even with the yield function in place.    </p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;iomanip&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;thread&gt;\n#include &lt;vector&gt;\nusing namespace std;\n\nvoid cons(string c){\n//Prints consanants\ncout &lt;&lt;\"CONS:   \" &lt;&lt; c &lt;&lt; endl;\nthis_thread::yield();\n\n}\n\nvoid vow(string v){\n//Prints vowels\n// allowing other ready threads to run\n    this_thread::yield(); \n   cout &lt;&lt;\"VOW:    \" &lt;&lt; v &lt;&lt; endl;\n\n}\n\nint main() {\n//Creates an array of 100\nstring words[100];\n//Creates a starting point for i\nint i = 0;\n//string called x\nstring s;\n//Takes in a file\nifstream inFile;\n//Creates a vector of threads to print\nvector &lt;thread&gt; PrintingThreads;\n//Opens up the text file \"phrase.txt\"\ninFile.open(\"phrase.txt\");\n//If It is not able to open the file\nif (!inFile) {\n//Display error message\n   cout &lt;&lt; \"Unable to open specified file\";\n   //Exit with an error(1)\n   exit(1); \n}\nwhile (inFile &gt;&gt; s) {\nwords[i]=s;\ni++;\n}\n//cycle \nfor (int l=0; l&lt;i; l++)\n   {\n   char first (words[l][0]);\n\n   if ((first == 'a') || (first  == 'e') || (first  == 'i') || (first  == 'o') || (first  == 'u')||(first == 'A') || (first  == 'E') || (first  == 'I') || (first  == 'O') || (first  == 'U'))\n       {\n        /\n       PrintingThreads.push_back(thread(vow,words[l]));\n\n       }   \n\n\n       else\n       {\n\n\n       PrintingThreads.push_back(thread(cons,words[l]));\n\n       }\n   }// loop with a range variable\n   for (thread&amp; t: PrintingThreads) \n       t.join();\n\n   inFile.close();\n}\n</code></pre>\n"},{"tags":["multithreading","azure","load-balancing"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":340,"score":1,"question_id":12891678,"title":"Orchestrating a Windows Azure web role to cope with occasional high workload","body":"<p>I'm running a Windows Azure web role which, on most days, receives very low traffic, but there are some (foreseeable) events which can lead to a high amount of background work which has to be done. The background work consists of many database calls (Azure SQL) and HTTP calls to external web services, so it is not really CPU-intensive, but it requires a lot of threads which are waiting for the database or the web service to answer. The background work is triggered by a normal HTTP request to the web role.</p>\n\n<p><strong>I see two options to orchestrate this, and I'm not sure which one is better.</strong></p>\n\n<ul>\n<li><strong>Option 1, Threads:</strong> When the request for the background work comes in, the web role starts as many threads as necessary (or queues the individual work items to the thread pool). In this option, I would configure a larger instance during the heavy workload, because these threads could require a lot of memory.</li>\n<li><strong>Option 2, Self-Invoking:</strong> When the request for the background work comes in, the web role which receives it generates a HTTP request to itself for every item of background work. In this option, I could configure several web role instances, because the load balancer of Windows Azure balances the HTTP requests across the instances.</li>\n</ul>\n\n<p>Option 1 is somewhat more straightforward, but it has the disadvantage that only one instance can process the background work. If I want more than one Azure instance to participate in the background work, I don't see any other option than sending HTTP requests from the role to itself, so that the load balancer can delegate some of the work to the other instances.</p>\n\n<p>Maybe there are other options?</p>\n\n<p><strong>EDIT:</strong> Some more thoughts about option 2: When the request for the background work comes in, the instance that receives it would save the work to be done in some kind of queue (either Windows Azure Queues or some SQL table which works as a task queue). Then, it would generate a lot of HTTP requests to itself, so that the load balancer 'activates' all of the role instances. Each instance then dequeues a task from the queue and performs the task, then fetches the next task etc. until all tasks are done. It's like <em>occasionally using the web role as a worker role</em>.</p>\n\n<p>I'm aware this approach has a smelly air (abusing web roles as worker roles, HTTP requests to the same web role), but I don't see the real disadvantages.</p>\n\n<p><strong>EDIT 2:</strong> I see that I should have elaborated a little bit more about the exact circumstances of the app:</p>\n\n<p>The app needs to do some small tasks all the time. These tasks usually don't take more than 1-10 seconds, and they don't require a lot of CPU work. On normal days, we have only 50-100 tasks to be done, but on 'special days' (New Year is one of them), they could go into several 10'000 tasks which have to be done inside of a 1-2 hour window. The tasks are done in a web role, and we have a <strong>Cron Job</strong> which initiates the tasks <strong>every minute</strong>. So, every minute the web role receives a request to process new tasks, so it checks which tasks have to be processed, adds them to some sort of queue (currently it's an SQL table with an UPDATE with OUTPUT INSERTED, but we intend to switch to Azure Queues sometime). Currently, the same instance processes the tasks <strong>immediately after queueing them</strong>, but this won't scale, since the serial processing of several 10'000 tasks takes too long. That's the reason why we're looking for a <strong>mechanism to broadcast the event \"tasks are available\" from the initial instance to the others.</strong></p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12897112,"title":"Can nested threads throw exceptions for parent thread?","body":"<p>I have a <code>Controller</code> class and a <code>Monitor</code> worker thread.\nThe controller thread looks something like this</p>\n\n<pre><code>public class ControllerA {\n    public void ControllerA(){\n        try{\n            doWork();\n        }\n        catch(OhNoException e){\n        //catch exception\n        }\n\n    public void doWork() throws OhNoException{\n\n      new Thread(new Runnable(){\n        public void run(){\n        //Needs to monitor resources of ControllerA, \n        //if things go wrong, it needs to throw OhNoException for its parent\n        }\n        }).start();\n\n      //do work here\n\n    }\n}\n</code></pre>\n\n<p>Is such setup feasible? How do I throw exception to the outside of the thread?</p>\n"},{"tags":["multithreading","memory-leaks","textbox","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12831706,"title":"WPF Window constantly updating the GUI","body":"<p>I have an application in WPF which constantly changes the value(Updates!) in the GUI screen. This causes the memory usuage to go up. Especially #of Bytes in all heaps. The private bytes also increase. To simulate a similar scenario updating the GUI all the time, I created a simple application with following code.</p>\n\n<pre><code>namespace TextFieldUpdateTest \n{\n    /// &lt;summary&gt;\n    /// Interaction logic for Window1.xaml\n    /// &lt;/summary&gt;\n    public partial class Window1 : Window\n    {\n        Int32 Counter = 0;\n        Thread NewThread;\n        private delegate void ForLoop();\n        public delegate void LoopHandler(object sender,EventArgs args);\n        public event LoopHandler LoopChange;\n        public Window1()\n        {\n            InitializeComponent();\n            NewThread = new Thread(new ThreadStart(ForLoop1));\n            LoopChange +=new LoopHandler(Window1_LoopChange);\n        }\n\n      private void button1_Click(object sender, RoutedEventArgs e)\n    {\n        if (!NewThread.IsAlive)\n        {\n            NewThread.Start();\n        }\n    }\n\n    public void ForLoop1()\n    {\n        for (; ; )\n        {\n            LoopChange(0, EventArgs.Empty);\n            Thread.Sleep(10);\n        }\n    }\n\n    public void Window1_LoopChange(object sender,EventArgs args)\n    {\n        LoopChange -= this.Window1_LoopChange;\n        this.Dispatcher.Invoke(new ForLoop(ForLoop2));\n        LoopChange +=new LoopHandler(Window1_LoopChange);\n    }\n\n    public void ForLoop2()\n    {\n        Counter++;\n        if (Counter % 2 == 0)\n        {\n            textBox1.Text = \"11111\";\n            textBox2.Text = \"22222\";\n            textBox3.Text = \"33333\";\n            textBox4.Text = \"44444\";\n            textBox5.Text = \"55555\";\n            textBox6.Text = \"66666\";\n\n        }\n        else\n        {\n            textBox1.Text = \"00000\";\n            textBox2.Text = \"77777\";\n            textBox3.Text = \"88888\";\n            textBox4.Text = \"99999\";\n            textBox5.Text = \"10101\";\n            textBox6.Text = \"45454\";\n\n        }\n\n    }\n\n    private void button2_Click(object sender, RoutedEventArgs e)\n    {\n        if (NewThread.IsAlive) NewThread.Abort();\n    }\n}\n}\n</code></pre>\n\n<p>The XAML is </p>\n\n<pre><code>   &lt;Window x:Class=\"TextFieldUpdateTest.Window1\"\nxmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\nxmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\nTitle=\"Window1\" Height=\"300\" Width=\"427\"&gt;\n&lt;Grid&gt;\n    &lt;Label Height=\"30\" HorizontalAlignment=\"Left\" Margin=\"42,41,0,0\" Name=\"label1\" VerticalAlignment=\"Top\" Width=\"79\"&gt;1&lt;/Label&gt;\n    &lt;Label Height=\"30\" HorizontalAlignment=\"Left\" Margin=\"42,72,0,0\" Name=\"label2\" VerticalAlignment=\"Top\" Width=\"79\"&gt;2&lt;/Label&gt;\n    &lt;Label HorizontalAlignment=\"Left\" Margin=\"42,101,0,131\" Name=\"label3\" Width=\"79\"&gt;3&lt;/Label&gt;\n    &lt;Label HorizontalAlignment=\"Left\" Margin=\"42,131,0,101\" Name=\"label4\" Width=\"79\"&gt;4&lt;/Label&gt;\n    &lt;Label Height=\"30\" HorizontalAlignment=\"Left\" Margin=\"42,0,0,71\" Name=\"label5\" VerticalAlignment=\"Bottom\" Width=\"79\"&gt;5&lt;/Label&gt;\n    &lt;Label Height=\"30\" HorizontalAlignment=\"Left\" Margin=\"42,0,0,40\" Name=\"label6\" VerticalAlignment=\"Bottom\" Width=\"79\"&gt;6&lt;/Label&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,43,155,0\" Name=\"textBox1\" VerticalAlignment=\"Top\" FontSize=\"16\" /&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,74,155,0\" Name=\"textBox2\" VerticalAlignment=\"Top\" FontSize=\"16\" /&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,103,155,0\" Name=\"textBox3\" VerticalAlignment=\"Top\"  FontSize=\"16\"/&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,0,155,106\" Name=\"textBox4\" VerticalAlignment=\"Bottom\" FontSize=\"16\" /&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,0,155,78\" Name=\"textBox5\" VerticalAlignment=\"Bottom\" FontSize=\"16\" /&gt;\n    &lt;TextBox Height=\"23\" Margin=\"131,0,155,47\" Name=\"textBox6\" VerticalAlignment=\"Bottom\" FontSize=\"16\" /&gt;\n    &lt;Button Height=\"23\" HorizontalAlignment=\"Right\" Margin=\"0,41,22,0\" Name=\"button1\" VerticalAlignment=\"Top\" Width=\"75\" Click=\"button1_Click\"&gt;Button1&lt;/Button&gt;\n    &lt;Button Height=\"23\" HorizontalAlignment=\"Right\" Margin=\"0,101,22,0\" Name=\"button2\" VerticalAlignment=\"Top\" Width=\"75\" Click=\"button2_Click\"&gt;Button2&lt;/Button&gt;\n&lt;/Grid&gt;\n</code></pre>\n\n<p></p>\n\n<p>Now, I am unable to run this code(Edit: Code changed such that it compiles and runs fine, but memory problem is still there, I reduced the sleep time such that it is more visible) . What could be the reason.</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading","exception","wait","notify"],"answer_count":6,"favorite_count":9,"up_vote_count":25,"down_vote_count":0,"view_count":56162,"score":25,"question_id":886722,"title":"How to use wait and notify in Java?","body":"<p>I have 2 matrices and I need to multiply them and then print the results of each cell. As soon as one cell is ready I need to print it, but for example I need to print the [0][0] cell before cell [2][0] even if the result of [2][0] is ready first. So I need to print it by order.\nSo my idea is to make the printer thread wait until the <code>multiplyThread</code> notifies it that the correct cell is ready to be printed and then the <code>printerThread</code> will print the cell and go back to waiting and so on..</p>\n\n<p>So I have this thread that does the multiplication:</p>\n\n<pre><code>public void run() \n{\n    int countNumOfActions = 0; // How many multiplications have we done\n    int maxActions = randomize(); // Maximum number of actions allowed\n\n    for (int i = 0; i &lt; size; i++)\n    {       \n        result[rowNum][colNum] = result[rowNum][colNum] + row[i] * col[i];\n        countNumOfActions++;\n        // Reached the number of allowed actions\n        if (countNumOfActions &gt;= maxActions)\n        {\n            countNumOfActions = 0;\n            maxActions = randomize();\n            yield();\n        }   \n    }\n    isFinished[rowNum][colNum] = true;\n    notify();\n}\n</code></pre>\n\n<p>Thread that prints the result of each cell:</p>\n\n<pre><code>public void run()\n{\n    int j = 0; // Columns counter\n    int i = 0; // Rows counter\n    System.out.println(\"The result matrix of the multiplication is:\");\n\n    while (i &lt; creator.getmThreads().length)\n    {\n        synchronized (this)\n        {\n            try \n            {\n                this.wait();\n            } \n            catch (InterruptedException e1) \n            {\n            }\n        }\n        if (creator.getmThreads()[i][j].getIsFinished()[i][j] == true)\n        {\n            if (j &lt; creator.getmThreads()[i].length)\n            {\n                System.out.print(creator.getResult()[i][j] + \" \");\n                j++;\n            }\n            else\n            {\n                System.out.println();\n                j = 0;\n                i++;\n                System.out.print(creator.getResult()[i][j] + \" \");\n            }\n        }\n    }\n</code></pre>\n\n<p>Now it throws me these exceptions:</p>\n\n<pre><code>Exception in thread \"Thread-9\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-6\" Exception in thread \"Thread-4\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\njava.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-5\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-8\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-7\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-11\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-10\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\nException in thread \"Thread-12\" java.lang.IllegalMonitorStateException\n    at java.lang.Object.notify(Native Method)\n    at multiplyThread.run(multiplyThread.java:49)\n</code></pre>\n\n<p>line 49 in <code>multiplyThread</code> is the \"notify()\"..I think I need to use the synchronized differently but I am not sure how.</p>\n\n<p>If anyone can help this code to work I will really appreciate it.</p>\n\n<p>Thanks in advance,</p>\n\n<p>Greg</p>\n"},{"tags":["java","multithreading","redundancy"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12904433,"title":"thread and creating object","body":"<p>I am trying to learn about thread and find some examples in the internet. This is a java class that output \"hello, world\" every 3 seconds. But I have a feeling that the part about creating a Runable object is redundant.</p>\n\n<p>Instead of writing </p>\n\n<pre><code>Runnable r = new Runnable(){ public void run(){...some actions...}}; \n</code></pre>\n\n<p>Can I put the method <code>run()</code> somewhere else for easy reading?</p>\n\n<p>This is what I have:</p>\n\n<pre><code>public class TickTock extends Thread {\n    public static void main (String[] arg){\n        Runnable r = new Runnable(){\n            public void run(){\n                try{\n                    while (true) {\n                        Thread.sleep(3000);\n                        System.out.println(\"Hello, world!\");\n                    }\n                } catch (InterruptedException iex) {\n                    System.err.println(\"Message printer interrupted\");\n                }\n            }\n        };\n      Thread thr = new Thread(r);\n      thr.start();\n}\n</code></pre>\n\n<p>And this is what I want to accomplish</p>\n\n<pre><code>public static void main (String[] arg){ \n          Runnable r = new Runnable() //so no run() method here, \n                                  //but where should I put run()\n          Thread thr = new Thread(r);\n          thr.start();\n    }\n</code></pre>\n"},{"tags":["c","multithreading","operating-system"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":59,"score":-1,"question_id":12904169,"title":"Critical Section Detection Technique","body":"<p>How do I detect critical sections in a C program by analyzing it programmatically?</p>\n"},{"tags":["c++","multithreading","templates","c++11","lambda-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12903985,"title":"send function pointer as function template in a threadpool class","body":"<p>I'm trying to use a ThreadPool implementation from this fellow: <a href=\"https://github.com/progschj/ThreadPool\" rel=\"nofollow\">https://github.com/progschj/ThreadPool</a></p>\n\n<p>I'm having trouble adding 'functions' to the <code>enqueue</code> method...here is the implementation for the <code>enqueue</code> method below:</p>\n\n<pre><code>// add new work item to the pool\ntemplate&lt;class T, class F&gt;\nResult&lt;T&gt; ThreadPool::enqueue(F f)\n{\n    Result&lt;T&gt; res;\n    {\n        std::unique_lock&lt;std::mutex&gt; lock(queue_mutex);\n        tasks.push_back(std::function&lt;void()&gt;(\n        [f,res]()\n        {\n            CallAndSet&lt;T,F&gt;()(res, f);\n        }));\n    }\n    condition.notify_one();\n    return res;\n}\n</code></pre>\n\n<p>Here's what I'm using:</p>\n\n<pre><code>#include \"ThreadPool.h\"\n#include &lt;stdio.h&gt;\n#include &lt;iostream&gt;\n\nint main() {\n    // create a thread pool of 4 worker threads\n    ThreadPool pool(4);\n\n    // queue a bunch of \"work items\"\n    for(int i = 0; i &lt; 8; ++i) {\n        pool.enqueue([i] {\n            std::cout &lt;&lt; \"hello \" &lt;&lt; i &lt;&lt; std::endl;\n\n            std::cout &lt;&lt; \"world \" &lt;&lt; i &lt;&lt; std::endl;\n        });\n    }\n}\n</code></pre>\n\n<p>It is part of the sample code that is trying to show how to use the library...</p>\n\n<p>output from compilation is:</p>\n\n<pre><code>scons: Reading SConscript files ...\nscons: done reading SConscript files.\nscons: Building targets ...\nscons: building associated VariantDir targets: build\ng++ -o build/main.o -c -std=c++11 -pthread -Wall -g main.cpp\nmain.cpp: In function 'int main()':\nmain.cpp:15:7: error: no matching function for call to 'ThreadPool::enqueue(main()::&lt;lambda()&gt;)'\nmain.cpp:15:7: note: candidate is:\nIn file included from main.cpp:1:0:\nThreadPool.h:117:15: note: template&lt;class T, class F&gt; Result&lt;T&gt; ThreadPool::enqueue(F)\nThreadPool.h:117:15: note:   template argument deduction/substitution failed:\nmain.cpp:15:7: note:   couldn't deduce template parameter 'T'\nscons: *** [build/main.o] Error 1\nscons: building terminated because of errors.\n</code></pre>\n\n<p>I'm pretty clueless when it comes to templating stuff..I have no idea why the above won't work...anyone have any ideas?</p>\n\n<p>cheers</p>\n\n<p>jarrett</p>\n"},{"tags":["c#","multithreading"],"answer_count":10,"favorite_count":6,"up_vote_count":27,"down_vote_count":0,"view_count":33307,"score":27,"question_id":263116,"title":"C#: Waiting for all threads to complete","body":"<p>I'm running into a common pattern in the code that I'm writing, where I need to wait for all threads in a group to complete, with a timeout. The timeout is supposed to be the time required for <em>all</em> threads to complete, so simply doing thread.Join(timeout) for each thread won't work, since the possible timeout is then timeout * numThreads.</p>\n\n<p>Right now I do something like the following:</p>\n\n<pre><code>var threadFinishEvents = new List&lt;EventWaitHandle&gt;();\n\nforeach (DataObject data in dataList)\n{\n    // Create local variables for the thread delegate\n    var threadFinish = new EventWaitHandle(false, EventResetMode.ManualReset);\n    threadFinishEvents.Add(threadFinish);\n\n    var localData = (DataObject) data.Clone();\n    var thread = new Thread(\n        delegate()\n        {\n            DoThreadStuff(localData);\n            threadFinish.Set();\n        }\n    );\n    thread.Start();\n}\n\nMutex.WaitAll(threadFinishEvents.ToArray(), timeout);\n</code></pre>\n\n<p>However, it seems like there should be a simpler idiom for this sort of thing.</p>\n"},{"tags":["java","c","multithreading","jni"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":12900695,"title":"How to obtain JNI interface pointer (JNIEnv *) for asynchronous calls","body":"<p>I have learned that the JNI interface pointer (JNIEnv *) is only valid in the current thread. Suppose I started a new thread inside a native method; how it can asynchronously send events to a Java method? As this new thread can't have a reference of (JNIEnv *). Storing a global variable for (JNIEnv *) apparently will not work?</p>\n"},{"tags":["c#","wpf","multithreading","noop"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12903564,"title":"Why invoke ThreadStart with empty Delegate?","body":"<p>While doing some forensics archeological survey in an old apps I have to maintain I came across this :</p>\n\n<p>It is a WPF application that was recently converted to .NET 4.0 and this code runs inside a background worker </p>\n\n<pre><code>           if(bgWorker1.IsBusy || bgWorker2.IsBusy)\n           {\n                Thread.Sleep(100); \n                Application.Current.Dispatcher.Invoke(\n                    System.Windows.Threading.DispatcherPriority.Background, \n                    new System.Threading.ThreadStart(delegate { })\n                );\n           }\n</code></pre>\n\n<p>1 - What possible side-effect would be acheived by invoking a thread (main gui) with a no-op delegate.  The other two threads also perform invokes on the main gui thread but only this one sets the priority to something else than Normal (they use Action rather than TreadStart though).</p>\n\n<p>2 - I have cases that strangely resembles deadlock with this application and something tells me that this could be the cause. (mucking around the priority and main gui thread for no appearant reason).</p>\n\n<p>Thanks</p>\n"},{"tags":["ios","multithreading","grand-central-dispatch"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":144,"score":1,"question_id":12851466,"title":"iOS GCD: main thread dequeue blocks from queues other than main queue?","body":"<p>I know queue is NOT thread. Queue is a higher level concept than thread in GCD. Programmers only deal with queues, and let system decides which threads to execute blocks for maximum efficiency. </p>\n\n<p>And I know main queue binds to main thread, which means if I put a block on main queue, only main thread will dequeue and run it. My question is: is it possible that main thread dequeue blocks from queues (serial or concurrent) OTHER THAN main queue?</p>\n"},{"tags":["android","multithreading","download"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1638,"score":2,"question_id":5209382,"title":"Download in android large files","body":"<p>When I try this code, it starts download but then stuck with alert \"force close\"\nwhat should I do? Use some kind of background thread?</p>\n\n<pre><code>try {\n    long startTime = System.currentTimeMillis();\n\n    URL u = new URL(\"http://file.podfm.ru/3/33/332/3322/mp3/24785.mp3\");\n    HttpURLConnection c = (HttpURLConnection) u.openConnection();\n\n    c.setRequestMethod(\"GET\");\n    c.setDoOutput(true);\n    c.connect();\n    FileOutputStream f = new FileOutputStream(new File(\"/sdcard/\",\"logo.mp3\"));\n\n    InputStream in = c.getInputStream();\n\n    byte[] buffer = new byte[1024];\n    int len1 = 0;\n    while ( (len1 = in.read(buffer)) != -1 ) {\n        f.write(buffer,0, len1);\n    }\n    f.close();\n\n    Log.d(\"ImageManager\", \"download ready in\" +\n        ((System.currentTimeMillis() - startTime) / 1000) + \" sec\");\n}\ncatch (IOException e)\n{\n    Log.d(\"ImageManager\", \"Error\" +\n        ((System.currentTimeMillis()) / 1000) + e + \" sec\");\n}\n</code></pre>\n"},{"tags":["multithreading","perl"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12845498,"title":"How can I create a thread wthout it running right away?","body":"<p>Consider the following code:</p>\n\n<pre><code>for (my $i = 0; $i &lt; $threadCount; $i++) {\n\n    if($isResumed) {\n\n        # TODO: load stats from DB      \n    }\n    else {\n\n        $stats-&gt;{workers}-&gt;{$i}        = &amp;share({});            \n        $stats-&gt;{workers}-&gt;{$i}-&gt;{tid} = undef; \n        $stats-&gt;{workers}-&gt;{$i}-&gt;{foo} = \"bar\";\n        $stats-&gt;{workers}-&gt;{$i}-&gt;{abc} = 123;                               \n    }\n\n    # create the worker thread\n    my $thr = threads-&gt;create(\\&amp;worker);    \n    # TODO: find a way to store the TID in the $i slot. why have two differetn IDs? \n    $stats-&gt;{workers}-&gt;{$i}-&gt;{tid} = $thr-&gt;tid();\n}\n</code></pre>\n\n<p>I am using the $stats hash to hold data that should be shared between threads, as well as data about what each thread is doing. The problem I have is that I would like to reference the thread data in this hash based on the TID, not an arbitrary value assigned by $i in the loop. </p>\n\n<p>When I create the thread, the work starts immediately, but it cannot start its work until the hash values are set. So, if I do:</p>\n\n<pre><code>$thr = threads-&gt;create(\\&amp;worker);\n$stats-&gt;{workers}-&gt;{$thr-&gt;tid()} = &amp;share({});\n</code></pre>\n\n<p>It will not work because not all the data it needs is set yet.</p>\n\n<p>So basically, is there a way for me to create a thread, but defer it from running its code until I specifically tell it to? Something like:</p>\n\n<pre><code>$thr = threads-&gt;create(\\&amp;worker);\n$stats-&gt;{workers}-&gt;{$thr-&gt;tid()} = &amp;share({});\n$thr-&gt;start();\n</code></pre>\n"},{"tags":["multithreading","celery"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12902673,"title":"Implementing a caching thread with celery","body":"<p>I am using celery to prepare a page for my web application. What I am trying to do is the following:</p>\n\n<ul>\n<li>The client (browser) requests a page</li>\n<li>The server (web2py) proxies this request to the celery server.</li>\n<li>The celery server performs the accesses to the database (couchdb) and prepares the page to be displayed. This takes some time (around 1s), since I need to correlate different pieces of data in order to prepare this page.</li>\n</ul>\n\n<p>What I want is to speed up the serving of pages, by caching the pages which are likely to be requested by the client. This means that, for every client, I want to cache at least the current page, and the previous and next page. I do not want to use memcached.</p>\n\n<p>The way I am doing this is by having a caching thread: I want to have a thread which caches the pages already processed, so that they can be served immediately when the client requests them. This thread will keep in memory the information, and will return the data when there is a cache hit. Otherwise, the database will be accessed, the page prepared, and it will be cached for the next request.</p>\n\n<p>My question is:</p>\n\n<ul>\n<li>How can I implement this thread structure in celery?</li>\n<li>Am I in control of the threads, or is celery going to stop them without my knowledge?</li>\n<li>How can I access the already running threads whenever a celery task is triggered?</li>\n</ul>\n"},{"tags":["performance","multithreading","file","file-io","parallel-processing"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":438,"score":1,"question_id":993038,"title":"Directory walker on modern operating systems slower when it's multi-threaded?","body":"<p>Once I had the theory that on modern operating systems multithreaded \nread access on the HDD should perform better.</p>\n\n<p>I thought that:<br />\n<em>the operating system queues all read requests,\nand rearranges them in such a way, that it could read from the HDD more\nsequentially. The more requests it would get, the better it could rearrange them\nto optimize the read sequence.</em><br />\nI was very sure that I read it somewhere few times.</p>\n\n<p>But I did some benchmarking, and had to find out, that multithreaded\nread access mostly perform much worst, and never performs better.</p>\n\n<p>I had the experience under Windows and Linux. I benchmarked pure\nsearching of files using the operating system's tools, and also\nhad written own little benchmarks.</p>\n\n<p>Am I missing something?<br />\nCan someone explain to me the secrets of this topic?<br />\nThank you!</p>\n"},{"tags":["ios","multithreading","c#-4.0","monotouch"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12888469,"title":"MonoTouch Load image in background","body":"<p>I am having a problem trying to load an image and display it using System.Threading.Task</p>\n\n<p>My Code is as follows</p>\n\n<pre><code>    Task DownloadTask { get; set; }\n\n    public string Instrument { get; set; }\n\n    public PriceChartViewController(string Instrument) {\n        this.Instrument = Instrument;\n        DownloadTask = Task.Factory.StartNew(() =&gt; { });\n    }\n\n\n    private void LoadChart(ChartType chartType) {\n        NSData data = new NSData();\n\n        DownloadTask = DownloadTask.ContinueWith(prevTask =&gt; {\n            try {\n                UIApplication.SharedApplication.NetworkActivityIndicatorVisible = true;\n\n                NSUrl nsUrl = new NSUrl(chartType.Uri(Instrument));\n                data = NSData.FromUrl(nsUrl);\n            }\n            finally {\n                UIApplication.SharedApplication.NetworkActivityIndicatorVisible = false;\n            }\n        });\n\n        DownloadTask = DownloadTask.ContinueWith(t =&gt; {\n            UIImage image = new UIImage(data);\n\n            chartImageView = new UIImageView(image);\n            chartImageView.ContentScaleFactor = 2f;\n\n            View.AddSubview(chartImageView);\n\n            this.Title = chartType.Title;\n        }, CancellationToken.None, TaskContinuationOptions.OnlyOnRanToCompletion, TaskScheduler.FromCurrentSynchronizationContext());\n    }\n</code></pre>\n\n<p>The second Continue with does not seem to be being called?</p>\n\n<p>Initially my code looked like the following without the background processing and it worked perfectly.</p>\n\n<pre><code>    private void oldLoadChart(ChartType chartType) {\n\n        UIApplication.SharedApplication.NetworkActivityIndicatorVisible = true;\n\n        NSUrl nsUrl = new NSUrl(chartType.Uri(Instrument));\n        NSData data = NSData.FromUrl(nsUrl);\n        UIImage image = new UIImage(data);\n\n        chartImageView = new UIImageView(image);\n        chartImageView.ContentScaleFactor = 2f;\n\n        View.AddSubview(chartImageView);\n\n        this.Title = chartType.Title;\n\n        UIApplication.SharedApplication.NetworkActivityIndicatorVisible = false;\n    }\n</code></pre>\n\n<p>Does anyone know what I am doing wrong?</p>\n"},{"tags":["python","multithreading","wxpython"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12867138,"title":"wxpython - Running threads sequentially without blocking GUI","body":"<p>I've got a GUI script with all my wxPython code in it, and a separate testSequences module that has a bunch of tasks that I run based on input from the GUI. The tasks take a long time to complete (from 20 seconds to 3 minutes), so I want to thread them, otherwise the GUI locks up while they're running. I also need them to run one after another, since they all use the same hardware. (My rationale behind threading is simply to prevent the GUI from locking up.) I'd like to have a \"Running\" message (with varying number of periods after it, i.e. \"Running\", \"Running.\", \"Running..\", etc.) so the user knows that progress is occurring, even though it isn't visible. I'd like this script to run the test sequences in separate threads, but sequentially, so that the second thread won't be created and run until the first is complete. Since this is kind of the opposite of the purpose of threads, I can't really find any information on how to do this... Any help would be greatly appreciated.</p>\n\n<p>Thanks in advance!</p>\n\n<p>gui.py</p>\n\n<pre><code>import testSequences\nfrom threading import Thread\n\n#wxPython code for setting everything up here...\nfor j in range(5):\n    testThread = Thread(target=testSequences.test1)\n    testThread.start()\n    while testThread.isAlive():\n        #wait until the previous thread is complete\n        time.sleep(0.5)\n        i = (i+1) % 4\n        self.status.SetStatusText(\"Running\"+'.'*i)\n</code></pre>\n\n<p>testSequences.py</p>\n\n<pre><code>import time\ndef test1():\n    for i in range(10):\n        print i\n        time.sleep(1)\n</code></pre>\n\n<p>(Obviously this isn't the actual test code, but the idea is the same.)</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12899712,"title":"Best approach to execute method asynchronous from the gui","body":"<p>Im building an desktop application that is retrieving data from database every x seconds interval for displaying that data to a winform, i dont want to block my gui, i dont care if the method that retrieves the data takes a time while that time is less than the checking interval, i want that method asynchronous from the gui, what is the best approach and why? thanks im new to threading!</p>\n\n<p>Background worker?\nThread.sleep?\nManualResetEvent?</p>\n"},{"tags":["c++","multithreading","blocking"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":474,"score":1,"question_id":657141,"title":"How to avoid blocking (C++, Win32)","body":"<p>I'm making a dll that has to respond to an application's requests. One of the application's requirements is that a call should not take long to complete.</p>\n\n<p>Say, I have a function foo(), which is called by the host application:</p>\n\n<pre><code>int foo(arg){\n    // some code i need to execute, say,\n    LengthyRoutine();\n    return 0;\n}\n</code></pre>\n\n<p>Lets say, foo has to perform a task (or call a function) that is certain to take a long time. The application allows me to set a wait variable; if this variable is non-zero when foo returns, it calls foo again and again (resetting the wait variable before each call) until wait is returned 0.</p>\n\n<p>What's the best approach to this?</p>\n\n<p>Do I go:</p>\n\n<pre><code>int foo(arg){\n\n    if (inRoutine == TRUE) {\n        wait = 1;\n        return 0;\n    } else {\n        if (doRoutine == TRUE) {\n             LengthyRoutine();\n             return 0;\n        }\n    }\n\n    return 0;\n}\n</code></pre>\n\n<p>This doesn't really solve the problem that LengthyRoutine is gonna take a long time to complete. Should I spawn a thread of some sort that updates inRoutine depending on whether or not it has finished its task?</p>\n\n<p>Thanks..</p>\n"},{"tags":["c#","multithreading","books"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":224,"score":1,"question_id":3223836,"title":"Websites/Books that have homework assignments for C#","body":"<p>Are there any websites or good books out there that have assignments like:</p>\n\n<ul>\n<li>Create a BackgroundWorker thread... blah blah blah</li>\n</ul>\n\n<p>I would like to get more sharp with advanced concepts such as Threading, Generics, LINQ, DLINQ, etc.</p>\n"},{"tags":["ios","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12897731,"title":"Synchronization of concurrent processes execution","body":"<p>I have some concurrent operation for the data processing. During the processing I need to retrieve the reverse geocoding for the location. It is known that <code>- (void)reverseGeocodeLocation:(CLLocation *)location completionHandler:(CLGeocodeCompletionHandler)completionHandler</code> also performs geocoding request in background thread and returns immediately after the call. When geocoded finishes request it executes the completion handler on the main thread. How can I block my concurrent operation until the geocoder retrieves the result?</p>\n\n<pre><code>__block CLPlacemark *_placemark\n\n- (NSDictionary *)performDataProcessingInCustomThread\n{\n    NSMutableDictionary *dict = [NSMutableDictionary alloc] initWithCapacity:1];\n    // some operations\n\n    CLLocation *location = [[CLLocation alloc] initWithLatitude:40.7 longitude:-74.0];\n    [self proceedReverseGeocoding:location];\n\n    // wait until the geocoder request completes\n\n    if (_placemark) {\n        [dict setValue:_placemark.addressDictionary forKey:@\"AddressDictionary\"];\n\n    return dict;\n}\n\n- (void)proceedReverseGeocoding:(CLLocation *)location\n{\n    CLGeocoder *geocoder = [[CLGeocoder alloc] init];\n    [geocoder reverseGeocodeLocation:location completionHandler:^(NSArray *placemarks, NSError *error) {\n        if ([error code] == noErr) {\n            _placemark = placemarks.lastObject;\n        }\n    }];\n}\n</code></pre>\n"},{"tags":["java","android","multithreading","andengine","thread-synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12898856,"title":"Android Game development - Use of Threads for BOT players and AndEngine configuration","body":"<p>I'm writing my first ever Android game. <br />\nIt's a simple card game where player will have 3 BOT players. <br /></p>\n\n<p>Right now i'm writing a core logic for it in pure java. (Not thinking much about AndEngine and graphics yet)</p>\n\n<p>The game has two phase:</p>\n\n<ol>\n<li>Initially all players would draw a match of card <strong>asynchronously</strong>  </li>\n<li>After a first phase control moves serially (<strong>Synchronously</strong>) from one player to next one to draw a card.</li>\n</ol>\n\n<p>So, i'm confused about how many threads would i need?</p>\n\n<p>shall i put each player into a separate thread? (as phase 1 may need it)<br />\n<strong>OR</strong> <br />\nOr should i carry out this in one single thread? (as in Phase 2 synchronous behavior is needed)</p>\n\n<p>If i put each player into different  thread how can i serialize those threads to do sequential tasks (Phase 2- control move to player one after other)????</p>\n\n<p><strong>ALso</strong><br />\nRight now the logic I'm writing is in pure java. Will it give me any trouble while configuring it with AndEngine??  I mean is there any specific format of handling inputs and using this logic in ANdEngine?? Its all about just calling methods of those classes to start game and to perform any operation on game.</p>\n"},{"tags":["java","android","multithreading","user-interface","listener"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12896696,"title":"App crashes on closing a Fragment due to running Thread","body":"<p>My Fragmant contains a SensorEventListener which should evaluate some Inputs by the LightSensor.</p>\n\n<p>LightDisp is my View. I think it crashes because the Fragment is already closing but the LightSensor triggered the Fragment to execute this method that's still in work:</p>\n\n<pre><code>private void setBackground(int Backgroundcolor) {\n    Resources r = getResources();\n    Drawable[] layers = new Drawable[2];\n    layers[0] = new ColorDrawable(Color.rgb(Backgroundcolor,\n            Backgroundcolor, Backgroundcolor));\n    layers[1] = r.getDrawable(R.drawable.screen);\n    LayerDrawable layerDrawable = new LayerDrawable(layers);\n    LightDisp.setBackgroundDrawable(layerDrawable);\n    LightDisp.invalidate();\n}\n</code></pre>\n\n<p>How to avoid this?\nUsing the LightDisp.post() method didn't solved the problem either.\nPS: The slower I set the delay to the sensorListener the less is crashes. With SENSOR_DELAY_FASTEST it crashes almost every time.</p>\n\n<p><strong>LogCat:</strong></p>\n\n<pre><code>10-15 15:36:46.361: D/SensorManager(10304): registerListener :: handle = 3  name= GP2A Light Sensor delay= 10000 Listener= ch.steff_94.morseapp_beta.Input_lightsensor$1@418d52d8\n10-15 15:36:46.366: E/SensorManager(10304): thread start\n10-15 15:36:46.366: E/SensorManager(10304): =======&gt;&gt;&gt; Sensor Thread Running &lt;&lt;&lt;========\n10-15 15:36:52.436: D/dalvikvm(10304): GC_CONCURRENT freed 390K, 4% free 14754K/15367K, paused 1ms+4ms\n10-15 15:36:58.971: D/SensorManager(10304): unregisterListener:: handle = 3 Listener= ch.steff_94.morseapp_beta.Input_lightsensor$1@418d52d8 name = GP2A Light Sensor\n10-15 15:37:06.711: D/AndroidRuntime(10304): Shutting down VM\n10-15 15:37:06.711: W/dalvikvm(10304): threadid=1: thread exiting with uncaught exception (group=0x40c5d1f8)\n10-15 15:37:06.756: E/AndroidRuntime(10304): FATAL EXCEPTION: main\n10-15 15:37:06.756: E/AndroidRuntime(10304): java.lang.IllegalStateException: Fragment Input_lightsensor{418d4c00} not attached to Activity\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at android.app.Fragment.getResources(Fragment.java:741)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at ch.steff_94.morseapp_beta.Input_lightsensor.setBackground(Input_lightsensor.java:133)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at ch.steff_94.morseapp_beta.Input_lightsensor.access$2(Input_lightsensor.java:132)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at ch.steff_94.morseapp_beta.Input_lightsensor$1.onSensorChanged(Input_lightsensor.java:281)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at android.hardware.SensorManager$ListenerDelegate$1.handleMessage(SensorManager.java:635)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at android.os.Handler.dispatchMessage(Handler.java:99)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at android.os.Looper.loop(Looper.java:137)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at android.app.ActivityThread.main(ActivityThread.java:4511)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at java.lang.reflect.Method.invokeNative(Native Method)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at java.lang.reflect.Method.invoke(Method.java:511)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:980)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:747)\n10-15 15:37:06.756: E/AndroidRuntime(10304):    at dalvik.system.NativeStart.main(Native Method)\n</code></pre>\n"},{"tags":["asp.net","multithreading","c#-4.0","iis","file-io"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12898964,"title":"unable to Read file from network path in threads","body":"<p>I am unable to Read file from network path when i surround my code in threads. code work fine without threads. \nif i use threads and use local drive path (same system) then it work fine in threads as well but thats not an option for me. i have to access network file. </p>\n\n<p>while accessing network file File.exsists return false. This dll is used in a webapplication developed using C#, ASP.NET v4.xxx</p>\n\n<p>I am using IIS webserver. </p>\n"},{"tags":["java","multithreading","swing","sockets","thread-priority"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":12892668,"title":"Java / Prioritization of threads","body":"<p>I have an application that starts four threads to listen on incoming packets. Every thread opens a socket on a different port. Normally packets are received only on one port at the time, but in some cases messages can be received on two ports for some seconds. Every of these threads processes the messages and updates a bunch of listeners (all of them are doing some Swing painting stuff). As the messages are sent with a frequency of 10 Hz and the painting actions on the Swing components take some time, my first approach was to process only one messages out of 20 (2 seconds time to finish the paint on the components). Works well...</p>\n\n<p>But when receiving two messages at the time, I need to tell my application just to process one of them (the one received only for short time). In summary 10 messages are received on the 2nd port, also with a frequency of 10 Hz. Means, using the first approach sometimes I miss all 10 of them, because only one out of 20 is processed.</p>\n\n<p>Whenever a messages on the 2nd port is received I want my application to process that one, doesn't matter what is received on the 1st port or if something is painted at that time.</p>\n\n<p>The following code shows the implementation of my threads, four of these are started at the same time depending on the ports given through the constructor.</p>\n\n<pre><code>private class IncomingRunner implements Runnable {\n\n    private int listenPort;\n    private DatagramSocket localSocket;\n    private DatagramPacket packet;\n    private int counter = 0;\n\n    public IncomingRunner(int port) {\n        this.listenPort = port;\n    }\n\n    @Override\n    public void run() {\n        try {\n            localSocket = new DatagramSocket(listenPort);\n\n            byte[] buffer = new byte[1024];\n            packet = new DatagramPacket(buffer, buffer.length);\n\n            while(isRunning)\n                recvIncomingMsg();\n\n        } catch (SocketException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private void recvIncomingMsg() {\n        try {\n            localSocket.receive(packet);\n            port = localSocket.getLocalPort();\n\n            ReceivedMsg eventMsg;\n\n            if(port == Config.PORT_1) {\n                eventMsg = new ReceivedMsg(Config.PORT_1, Config.SOMETHING_1);\n                System.out.println(HexWriter.getHex(packet.getData()));\n            } else if (port == Config.PORT_2) {\n                eventMsg = new ReceivedMsg(Config.PORT_2, Config.SOMETHING_2);\n                System.out.println(HexWriter.getHex(packet.getData()));\n            } else if (port == Config.PORT_3) {\n                eventMsg = new ReceivedMsg(Config.PORT_3, Config.SOMETHING_3);\n                System.out.println(HexWriter.getHex(packet.getData()));\n            } else {\n                eventMsg = new ReceivedMsg(Config.PORT_4, Config.SOMETHING_4);\n                System.out.println(HexWriter.getHex(packet.getData()));\n            }\n\n            counter++;\n\n            if(counter%20 == 0) {\n                forward2PacketPanel(eventMsg);\n                counter = 0;\n            }\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private void forward2PacketPanel(final ReceivedMsg t) {\n        for(final IPacketListener c : listeners) {\n            if(c instanceof IPacketListener) {\n                new Thread(new Runnable() {\n                    @Override\n                    public void run() {\n                        ((IPacketListener)c).update(t);\n                    }\n                }).start();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>UPDATE:</strong>\nThe reason why I am starting new Threads to update the listeners is, because all of them should update the GUI at the same time. Every <code>updated</code> calls a <code>paintComponent()</code> method on a different <code>JPanel</code>. So all of them should run together.</p>\n\n<p><strong>UPDATE2:</strong>\nI cannot use the first approach as this causes messages loss of maybe important messages (received on 2nd port). What I need is, when a normal Msg is received just process it and do the painting, doesn't matter how many new normal messages (on 1st port) come in. But even if only one Msg on 2nd port is received, the application needs to process that one, regardless what is going on in the normal receiver thread.</p>\n\n<p>I guess I am facing two problems here:</p>\n\n<ol>\n<li><p>I need to make each thread waiting until the painting is finished, as that is UDP I can process a normal packet, and forget about all following normal packets, during the painting actions. When done, process the next normal packet.</p></li>\n<li><p>If a packet on 2nd port is received, break all normal packet processing actions and do the things needed to process the special packet.</p></li>\n</ol>\n\n<p>Problem (1) is solved using a BitSet in the MainIncomingClass. Every Listener uses some kind of callback function to indicate that its done with painting and sets a specific Bit in the BitSet. If not all are true, I do not process any new Packet, just let them go.</p>\n"},{"tags":["perl","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":725,"score":3,"question_id":2644238,"title":"Why am I getting a segmentation fault when I use binmode with threads in Perl?","body":"<p>this call</p>\n\n<pre><code>my $th = threads-&gt;create(\\&amp;print, \"Hello thread World!\\n\");\n$th-&gt;join();\n</code></pre>\n\n<p>works fine. But as soon as I add</p>\n\n<pre><code>binmode(STDOUT, \":encoding(ISO-8859-1)\");\n</code></pre>\n\n<p>to my script file, I get an error like \"segmentation fault\", \"access denied\".</p>\n\n<p>What is wrong to define an encoding type when trying to call a perl thread?</p>\n\n<p>Example:</p>\n\n<pre><code>use strict; use warnings;\nuse threads;\n\nbinmode(STDOUT, \":encoding(ISO-8859-1)\");\n\nmy $th = threads-&gt;create(\\&amp;print, \"Hello thread World!\\n\");\n$th-&gt;join();\n\nsub print {\n    print @_;\n}\n</code></pre>\n\n<p>This code does not work for me.</p>\n\n<p>Kind Regards</p>\n\n<p>--Andy </p>\n"},{"tags":["c#","multithreading","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1765,"score":1,"question_id":3900352,"title":"C# HTTPWebRequest Multi-threading","body":"<p>I am new to threading. I am trying to send HTTP Web Request using multi threading, I am not able to acheive what I need. \nMy requirement is to send request to thousands of same or different websites and parse the response i get it from httpwebrequest. \nIn the below code, i am sending 2 simulteaneous threads, I am looking for ten simultaneously threads.</p>\n\n<pre><code>namespace threading\n{\npublic partial class Form1 : Form\n{\n    delegate string UrlFetcher(string url);\n\n    private void button1_Click(object sender, EventArgs e)\n    {\n        int i = 1;\n        UrlFetcher u = new UrlFetcher(Fetch);\n        UrlFetcher u = new UrlFetcher(Fetch1);\n        string pageURL = \"http://www.google.com\";\n\n        while (i &lt;= 1000)\n        {\n            u.BeginInvoke(pageURL, new AsyncCallback(AfterFetch), \"this is state\");\n            i++;\n            u.BeginInvoke(pageURL, new AsyncCallback(AfterFetch1), \"this is state\");\n            i++;\n            Thread.Sleep(5);\n        }\n    }\n\n    static string Fetch(string pageURL)\n    {\n        HttpWebRequest WebReq = (HttpWebRequest)WebRequest.Create(pageURL);\n        WebReq.Method = \"GET\";\n        HttpWebResponse WebResp = (HttpWebResponse)WebReq.GetResponse();\n        Stream Answer = WebResp.GetResponseStream();\n        StreamReader _Answer = new StreamReader(Answer);\n        string myString = _Answer.ReadToEnd();\n        return myString;\n    }\n\n    void AfterFetch(IAsyncResult result)\n    {\n        string a;\n\n        AsyncResult async = (AsyncResult)result;\n        UrlFetcher fetcher = (UrlFetcher)async.AsyncDelegate;\n        a = fetcher.EndInvoke(result).ToString();\n\n        Regex regx = new Regex(@\"&lt;td&gt;([A-Za-z0-9\\-]+)\\.(com|net)&lt;/td&gt;\", RegexOptions.IgnoreCase);\n        MatchCollection mactches = regx.Matches(a);\n        foreach (Match match in mactches)\n        {\n            string pattern = @\"&lt;(.|\\n)*?&gt;\";\n            string r = Regex.Replace(match.Value, pattern, string.Empty);\n            textBox3.AppendText(r);\n        }\n    }\n\n    static string Fetch1(string pageURL)\n    {\n        HttpWebRequest WebReq = (HttpWebRequest)WebRequest.Create(pageURL);\n        WebReq.Method = \"GET\";\n        HttpWebResponse WebResp = (HttpWebResponse)WebReq.GetResponse();\n        Stream Answer = WebResp.GetResponseStream();\n        StreamReader _Answer = new StreamReader(Answer);\n        string myString = _Answer.ReadToEnd();\n        return myString;\n    }\n\n    void AfterFetch1(IAsyncResult result)\n    {\n        string a;\n\n        AsyncResult async = (AsyncResult)result;\n        UrlFetcher fetcher = (UrlFetcher)async.AsyncDelegate;\n        a = fetcher.EndInvoke(result).ToString();\n\n        Regex regx = new Regex(@\"&lt;td&gt;([A-Za-z0-9\\-]+)\\.(com|net)&lt;/td&gt;\", RegexOptions.IgnoreCase);\n        MatchCollection mactches = regx.Matches(a);\n        foreach (Match match in mactches)\n        {\n            string pattern = @\"&lt;(.|\\n)*?&gt;\";\n            string r = Regex.Replace(match.Value, pattern, string.Empty);\n            textBox3.AppendText(r);\n        }\n    }\n}\n}\n</code></pre>\n\n<p>If anyone would correct the above code, it is really appreciated.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","wpf","multithreading","dispatcher"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12898343,"title":"Dispatcher and collection bound to the UI","body":"<p>Annoyance of the Dispatcher and hopefully some know the ways around it.</p>\n\n<p>Issue:\nAny UI element or anything binding to them are <strong>FORCED/Required</strong> onto the Dispatcher thread.\nWhich then results in hang time depending on the operation.\nI for one have a collection bound to an UI element and the operations onto cannot be on a different thread so hang time is imminent. </p>\n\n<p>Any solution to this problem ?</p>\n\n<p>Please, do not reply with <code>Dispatcher.Invoke</code> or any related type as they do not work. Because they are synchronous. Right now, all I can really do is optimize the operation to go as fast as possible but really limited.</p>\n"},{"tags":["java","multithreading","netbeans"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":12897210,"title":"How to instance more than one JFrame with an animation using threads in java?","body":"<p>I have this code here that instance a JFrame with a simple animation, where you click the button and keeps running by using thread. I made an UI with a button that instances the JFrame, the problem is, when I click the button again and it instances another JFrame, the animation of the second one doesn't work properly. Even if I instance, like, 5 JFrames, all of the buttons to start the animation works only with the first JFrame. What I want to do is instance as much as I want to and all of them work separately. Here is the code of the class with the animation:</p>\n\n<pre><code>public class duduleo extends JFrame implements ActionListener, Runnable{\nJButton imagens;\nint x=1;\nstatic ImageIcon icon[] = new ImageIcon[11];\nstatic JLabel l;\nboolean anima=false;\n\n\npublic static void main(String args[]){\n    JFrame janela = new duduleo();\n    janela.show();\n}\n\nduduleo(){\n    icon[0]= new ImageIcon(\"duken1.jpg\");\n    icon[1]= new ImageIcon(\"duken2.jpg\");\n    icon[2]= new ImageIcon(\"duken3.jpg\");\n    icon[3]= new ImageIcon(\"duken4.jpg\");\n    icon[4]= new ImageIcon(\"duken5.jpg\");\n    icon[5]= new ImageIcon(\"duken6.jpg\");\n    icon[6]= new ImageIcon(\"duken7.jpg\");\n    icon[7]= new ImageIcon(\"duken8.jpg\");\n    icon[8]= new ImageIcon(\"duken9.jpg\");\n    icon[9]= new ImageIcon(\"duken10.jpg\");\n    icon[10]= new ImageIcon(\"duken11.jpg\");\n    setSize(100,200);\n    setLocation(200,150);\n    getContentPane().setLayout(new GridLayout(2,1));\n    imagens =  new JButton(icon[0]);\n    l= new JLabel(icon[0]); \n    imagens.addActionListener(this);\n    getContentPane().add(l);\n    getContentPane().add(imagens);\n\n}\n\npublic void run(){\n\n    while(anima){\n        for(int i=0;i&lt;icon.length;i++){\n            l.setIcon(icon[i]);\n            try{\n                Thread.sleep(100);\n            }catch(Exception e){}\n\n        }}}\n\npublic void actionPerformed(ActionEvent e){\n    anima=!anima;\n    Thread t;\n    t = new Thread(this);\n    t.start();\n}}\n</code></pre>\n\n<p>Thanks for any help.</p>\n"},{"tags":["android","multithreading","toast"],"answer_count":3,"favorite_count":10,"up_vote_count":17,"down_vote_count":0,"view_count":12104,"score":17,"question_id":3134683,"title":"Android: Toast in a thread","body":"<p>How can I display <a href=\"http://code.google.com/p/android-for-gods/wiki/Toast\">Toast</a> messages from a thread? </p>\n"},{"tags":["java","multithreading"],"answer_count":7,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12896529,"title":"How can I pass parameter to a Java thread?","body":"<p>I have a code in abstract class:</p>\n\n<pre><code>public abstract class Job implements Runnable{  \n    public void start(Integer jobId) {                      \n        try {\n            new Thread(this).start();\n        } catch (Exception e) {\n            e.getMessage();\n        }       \n    }\n}\n</code></pre>\n\n<p>class code:</p>\n\n<pre><code>public class Test extends Job {\n\n    @Override\n    public void run() {\n        for(int i = 0; i &lt; 5; i++) {\n            try {\n                Thread.currentThread();\n                Thread.sleep(2000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(\"TEST\");\n        }       \n    }\n}\n</code></pre>\n\n<p>And in main I have:</p>\n\n<pre><code>public static void main (String[] args) throws MessagingException  \n  {\n      Test test = new Test();\n      test.start(74); \n  }\n</code></pre>\n\n<p>So how can I pass parameter (jobId) from start method to run()?</p>\n"},{"tags":["android","multithreading","surfaceview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":12895945,"title":"Android SurfaceView canvas drawing with a thread","body":"<p>I am experimenting with drawing on a canvas using a thread to create a simple game engine but I'm having some weird issues I cannot explain.\nThe purpose of this \"game\" is to draw a circle every second on the canvas.\nThis works, but not the way I want it to work, it seems the app is switching between two canvasses and adding a circle to each canvas so you get a switch between two canvasses every second with the same number of circles but in a different place on the canvas.</p>\n\n<p>I don't know what I'm doing wrong, but I'm not that familiar with Treadding, has it something to do with how many cores my android device has or something like that?</p>\n\n<p>My code is shown below, so I just use a launchthread which uses a layoutfile that links to the animationthread which starts a thread and draws a circle on the canvas every second.\n(You can ignore the touchevent, it isn't uses yet).</p>\n\n<p>The project exists out of a main launchthread:</p>\n\n<pre><code>public class MainActivity extends Activity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n    }\n}\n</code></pre>\n\n<p>which uses this layout file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;FrameLayout\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"fill_parent\"\n    android:layout_height=\"fill_parent\"&gt;     \n        &lt;com.androidtesting.AnimationView\n            android:id=\"@+id/aview\"\n            android:layout_width=\"fill_parent\"\n            android:layout_height=\"fill_parent\"/&gt;\n&lt;/FrameLayout&gt;\n</code></pre>\n\n<p>And my Surfaceview class with an inner Thread class:</p>\n\n<pre><code>class AnimationView extends SurfaceView implements SurfaceHolder.Callback {\n    private boolean touched = false;\n    private float touched_x, touched_y = 0;\n    private Paint paint;\n    private Canvas c;\n    private Random random;\n    private AnimationThread thread;\n\n    public AnimationView2(Context context, AttributeSet attrs) {\n        super(context, attrs);\n\n        SurfaceHolder holder = getHolder();\n        holder.addCallback(this);\n\n        thread = new AnimationThread(holder);\n    }\n\n    class AnimationThread extends Thread {\n        private boolean mRun;       \n        private SurfaceHolder mSurfaceHolder;        \n\n        public AnimationThread(SurfaceHolder surfaceHolder) {\n            mSurfaceHolder = surfaceHolder;\n            paint = new Paint();\n            paint.setARGB(255,255,255,255);\n            paint.setTextSize(32);\n        }\n\n        @Override\n        public void run() {\n            while (mRun) {\n                c = null;\n                try {\n                    c = mSurfaceHolder.lockCanvas(null);\n                    synchronized (mSurfaceHolder) {                 \n                        doDraw(c);\n                        sleep(1000);\n                    }\n                } catch (Exception e) {                 \n                    e.printStackTrace();\n                }finally {\n                    if (c != null) {\n                        mSurfaceHolder.unlockCanvasAndPost(c);\n                    }\n                }\n            }\n        }\n\n        private void doDraw(Canvas canvas) {\n            //clear the canvas\n            //canvas.drawColor(Color.BLACK);                        \n\n            random = new Random();\n            int w = canvas.getWidth();\n            int h = canvas.getHeight();\n            int x = random.nextInt(w-50); \n            int y = random.nextInt(h-50);\n            int r = random.nextInt(255);\n            int g = random.nextInt(255);\n            int b = random.nextInt(255);\n            int size = 20;\n            canvas.drawCircle(x,y,size,paint);            \n            canvas.restore();\n        }\n        public void setRunning(boolean b) {\n            mRun = b;\n        }\n    }\n\n    public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {\n\n    }\n\n    @Override\n    public boolean onTouchEvent(MotionEvent event) {\n           touched_x = event.getX();\n           touched_y = event.getY();\n\n           int action = event.getAction();\n\n           switch(action){\n                case MotionEvent.ACTION_DOWN:           \n                    touched = true;\n                    break;\n                case MotionEvent.ACTION_MOVE:\n                    touched = true;\n                    break;        \n                default:\n                    touched = false;\n                    break;\n           }\n\n           return true;\n    }\n\n    public void surfaceCreated(SurfaceHolder holder) {\n        thread.setRunning(true);\n        thread.start();\n    }\n\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        boolean retry = true;\n        thread.setRunning(false);\n        while (retry) {\n            try {\n                thread.join();\n                retry = false;\n            } catch (InterruptedException e) {\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["vb.net","multithreading"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12896475,"title":"Could not save; currently locked by another user. OledbException was unhandled","body":"<p>I have a background worker thats doing some database work for me. The reason why I resorted to using using the background worker is because the database work is taking up a lot of time. So the code works the first time but as you continue to update the database then then you get \"Could not save; currently locked by another user. OledbException was unhandled\". Is the a way to go around this issue. This is my code</p>\n\n<pre><code>    Private Sub DoSaveUsersAuditForUpdate_Click()\n    Dim myConn As OleDbConnection = frmLogIn.Conn\n    SyncLock myConn\n        'Insert Previous data before the Update\n        'myConn = frmLogIn.Conn\n        Dim cmdInsert As OleDbCommand = New OleDbCommand(\"Insert INTO UsersAudit (Reference,Comment) VALUES (?,?)\", myConn)\n        cmdInsert.Parameters.Add(\"@Reference\", OleDbType.WChar).Value = txtReference.Text\n        cmdInsert.Parameters.Add(\"@Comment\", OleDbType.WChar).Value = \"Update Existing Users Details\"\n        myConn.Open()\n        cmdInsert.ExecuteNonQuery()\n        myConn.Close()\n\n    End SyncLock\n\n    Dim myKonn As OleDbConnection = frmLogIn.Conn\n    SyncLock myKonn\n        'Insert Current data after the Update\n        'myKonn = frmLogIn.Conn\n        Dim cmdInsertOriginal As OleDbCommand = New OleDbCommand(\"Insert INTO UsersAudit (Reference,Comment) VALUES (?,?)\", myKonn)\n        cmdInsertOriginal.Parameters.Add(\"@Reference\", OleDbType.WChar).Value = txtReference.Text\n        cmdInsertOriginal.Parameters.Add(\"@Comment\", OleDbType.WChar).Value = \"New User\"\n        myKonn.Open()\n        cmdInsertOriginal.ExecuteNonQuery()\n        myKonn.Close()\n    End SyncLock\nEnd Sub\n</code></pre>\n\n<p>Here's How I am calling it</p>\n\n<pre><code>    Private Sub BackgroundWorker1_DoWork(sender As System.Object, e As        System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork\n    DoSaveUsersAuditForUpdate_Click()\nEnd Sub\n</code></pre>\n\n<p>this where it all comes together</p>\n\n<pre><code>    Private Sub btnUpdate_Click(sender As System.Object, e As System.EventArgs)Handles  btnUpdate.Click\n</code></pre>\n\n<p>BackgroundWorker1.RunWorkerAsync()\n        'Dim workerThread As New Thread(AddressOf DoSaveUsersAuditForUpdate_Click)\n        'workerThread.Start()\n        DoUpdateUsers_Click(sender, e)\n        UsersGridViewGridFormating()\nEnd Sub</p>\n\n<pre><code>    Private Sub UsersGridViewGridFormating()\n    Dim myConn As OleDbConnection = frmLogIn.Conn\n\n    SyncLock myConn\n        Dim iSql As String = \"SELECT *   FROM  Users WHERE UserDeleted =@UserDeleted\"\n\n        Dim da As New OleDbDataAdapter(iSql, myConn)\n        da.SelectCommand.Parameters.AddWithValue(\"@UserDeleted\", False)\n        dTable.Clear()\n        da.Fill(dTable)\n        myConn.Close()\n        Dim dv As DataView = New DataView(dTable)\n        dv.Sort = \"UserName asc\"\n        dTable = dv.ToTable\n\n        UsersMasterGridview.DataSource = dTable                                  \n\n        UsersMasterGridview.Visible = True\n\n        UsersMasterGridview.Focus()\n\n        lblNumberofRecords.Text = dTable.Rows.Count &amp; \" Records\"\n\n    End SyncLock\n\nEnd Sub\n</code></pre>\n\n<p>Any Help this all the code I am using </p>\n"},{"tags":["java","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12895534,"title":"Thread interruptions are not caught by InterruptedException","body":"<p>I have a controller and a thread that does some work, the controller has an interrupt function that shuts off the threads in emergency situation. </p>\n\n<p>the skeleton of my code looks something like this:</p>\n\n<pre><code>public class SomeController{\n\nprivate Thread th;\npublic SomeController(){\n    th = null;\n}\npublic void Input(int state){\n    switch(state){\n    case 0: //emergency shut off\n        if(th != null){\n            th.sleep(1000); //make thread sleep first, still no effect\n            th.interrupt();\n         }\n        break;\n    case 1: //thread creation\n        th = new Thread(new Runnable(){\n            public void run(){\n                try{\n                    DoSomeWork();\n                    }\n                catch(InterruptedException e)\n                {\n                    EmergencyProcedures();\n                }\n            }\n            });\n        th.start();\n        break;\n    }\n}\n</code></pre>\n\n<p>However, when interrupt is called, the InterruptedException is never caught. What am I doing wrong here?</p>\n"},{"tags":["c++","multithreading","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12895529,"title":"Call an object's member function from a different thread: how to use mutex correctly?","body":"<p>In my class I create a thread, using the <code>CreateThread(NULL,0,Execute1,this...)</code> method.</p>\n\n<pre><code>DWORD WINAPI Execute1(LPVOID lpParam) {\nCoInitialize(NULL);\nCVC1Dlg *pdlg=(CVC1Dlg *) lpParam;\n</code></pre>\n\n<p>Then I call the pdlg method from this thread:</p>\n\n<pre><code>pdlg-&gt;someMethod();\n</code></pre>\n\n<p>What happens, when I call this method from this thread, if this method was called from the main thread at the same time? Should I use some synch method like mutex? And where exactly do I need to call mutex?</p>\n\n<p>Is this correct that I have to use it in the CVC1Dlg method? Something like this:</p>\n\n<pre><code>CVC1Dlg ::CVC1Dlg () {\n  g_hMutex=CreateMutex(...)\n}\n\nvoid CVC1Dlg ::setStatus(int aStatus) {\n  ::WaitForSingleObject(g_hMutex, INFINITE);\n  iStatus=aStatus;\n  ::ReleaseMutex(g_hMutex);\n}\n</code></pre>\n"},{"tags":["c#","multithreading","entity-framework","iis","objectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11117397,"title":"Will Entity Framework fail when running on a high volumn IIS web site","body":"<p>We have been trying to analyse this exception:</p>\n\n<blockquote>\n  <p>Message: Error: Object reference not set to an instance of an object..\n  Stacktrace:    at System.RuntimeTypeHandle.CreateInstance(RuntimeType\n  type, Boolean publicOnly, Boolean noCheck, Boolean&amp; canBeCached,\n  RuntimeMethodHandleInternal&amp; ctor, Boolean&amp; bNeedSecurityCheck)    at\n  System.RuntimeType.CreateInstanceSlow(Boolean publicOnly, Boolean\n  skipCheckThis, Boolean fillCache)    at\n  System.RuntimeType.CreateInstanceDefaultCtor(Boolean publicOnly,\n  Boolean skipVisibilityChecks, Boolean skipCheckThis, Boolean\n  fillCache)    at System.Activator.CreateInstanceT    at\n  Z.Services.ObjectContextManagement.ScopedObjectContextManager<code>1.get_ObjectContext()\n  at Z.Services.DatabaseAccess.DatabaseAccess</code>2.Manage()    at\n  Z.Services.DatabaseAccess.DatabaseAccess`2.get_ObjectContext()</p>\n</blockquote>\n\n<p>Basically we get an error when getting the ObjectContext.</p>\n\n<p>From this question: <a href=\"http://stackoverflow.com/questions/2575990/entity-framework-lazy-loading-doesnt-work-from-other-thread\">Entity Framework lazy loading doesn&#39;t work from other thread</a> we see that EF is dependent upon staying on the same thread.</p>\n\n<p>From this Jon Skeet's answer to this question: <a href=\"http://stackoverflow.com/questions/1643987/will-a-request-in-iis-run-on-a-single-thread\">Will a request in IIS run on a single thread?</a> we see that IIS has thread agility.</p>\n\n<p>When there is a lower traffic volumn we do not see this error, but when the load increases we see the error.</p>\n\n<p>So the question: If EF is dependent upon staying on a single thread, and IIS does not keep the request on a single thread, can EF be used on an application that is deployed on IIS?</p>\n\n<p><strong>Edit</strong></p>\n\n<pre><code>var frameworkAssembly = Assembly.GetAssembly(typeof(ObjectContextManager&lt;&gt;));\nvar managerType = frameworkAssembly.GetType(managerTypeName + \"`1\", true, true);\nmanagerType = managerType.MakeGenericType(typeof(TObjectContext));\nObjectContextManager = Activator.CreateInstance(managerType) as ObjectContextManager&lt;TObjectContext&gt;;\n</code></pre>\n\n<p>It appears that the error occurs on the last line of the above code. The error only occurs in production under heavy load.</p>\n\n<p><strong>Edit 2</strong></p>\n\n<p>The ObjectContextManager inherits from ObjectContext which is an EF class.</p>\n\n<pre><code> public abstract class ObjectContextManager&lt;T&gt; where T : ObjectContext\n</code></pre>\n"},{"tags":["c++","multithreading","qt","gui"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":584,"score":2,"question_id":9777911,"title":"How do I create a Window in different QT threads?","body":"<p>I have an application in which each thread (except the main thread) needs to create its own window. I tried creating a thread and then calling <code>this-&gt;exec()</code> in the <code>run</code> function. However, I get an error before I even get to that call: <code>ASSERT failure in QWidget: \"Widgets must be created in the GUI thread.\"</code></p>\n\n<p>I want to popup a message window. The problem is that the source has multiple threads each of which may need to popup its own message.</p>\n"},{"tags":["java","android","multithreading","service"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12837196,"title":"Can't create handler inside thread. How do I use Looper.prepare()?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3614663/cant-create-handler-inside-thread-that-has-not-called-looper-prepare-inside-a\">Can’t create handler inside thread that has not called Looper.prepare() inside AsyncTask for ProgressDialog</a>  </p>\n</blockquote>\n\n\n\n<p>I'm developing an Android service that try to obtain the device IP address every x time and comunicate it to a server.\nI'm using:</p>\n\n<blockquote>\n  <p>Netbeans 7.2<br/>Android SDK<br/>Android Google-Api 8<br/>SQLite</p>\n</blockquote>\n\n<p>I know there are a few questions related to this same issue, but none of them gave me a solution to my problem. As you can see in my code below,  I'm not trying to access to the UI of the service main thread (well, I tried, but after I commented the line, the error remains the same). On the other hand, I'm using <em>AsyncTask</em>, which I think is the appropriate way to do it.</p>\n\n<p>This is the main part of my service:</p>\n\n<pre><code>public class ArsosService extends Service {\n\n    private NotificationManager mNM;\n        private final Messenger mMessenger = new Messenger(new IncomingHandler());\n        protected DatabaseUtil dbu = null;\n        @Override\n        public void onCreate() {\n            mNM = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n            try {\n                dbu = DatabaseUtility.getInstance(this);\n            } catch (IOException ex) {\n                Log.e(\"Service\", ex);\n            }\n            Timer timer = new Timer();\n            timer.schedule(new Checks(), 0, 15000);\n        }\n\n        private class Checks extends TimerTask {\n            @Override\n            public void run() {\n                CheckIpAddress_Task checkIp = new CheckIpAddress_Task();         \n                checkIp.execute();\n            }\n        }\n\n        // Other methods\n\n        private class CheckIpAddress_Task extends AsyncTask&lt;Void, Void, Integer&gt; {\n        @Override\n        protected Integer doInBackground(Void... arg0) {\n            String ipLocal = getLocalIpAddress();\n            String text = null;\n\n            // ipLocal==null means there is no available connection, so we do nothing. \n            if (ipLocal != null) {\n                String ipDb = dbu.getLastIP(); // we get the IP saved in the DB.\n                if (ipDb == null) {\n                    dbu.addProperty(\"IP\", ipLocal); // we save the IP in the DB.\n                } else if (!ipLocal.equals(ipDb)) {\n                    dbu.setProperty(\"IP\", ipLocal); // we update the IP in the DB.\n                }\n            }\n            if (text != null) {\n                //showNotification(1, text, ipLocal);\n            }\n            return 0;\n        }\n\n        private String getLocalIpAddress() {\n            String result = null;\n            // Irrelevant code\n            return result;\n        }\n    }\n}\n</code></pre>\n\n<p>I think the problem may be related to the threads, but I can't see where. Any help will be appreciated.</p>\n\n<p>EDITED: Although I have accepted one of the answers as correct, or maybe because of it, I've been searching for some more information regard to it. I've run into <a href=\"http://techtej.blogspot.com.es/2011/02/android-passing-data-between-main.html\" rel=\"nofollow\">this page</a> I want to share with all of you who someday need to know more about this issue. Its author,Tejas Lagvankar, explains everything about threads, loopers and handler in a very clear and understandable way.</p>\n"},{"tags":["c#","winforms","multithreading","abort"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":12894503,"title":"Windows Form Application, Thread won't stop","body":"<p>I am using Windows Form application for my thread demo. When I click on button1 ,It will start the thread and recursively doing a work.</p>\n\n<p>Here the Form will not hang as I expected. I want to Stop the currently running thread when I click on Button2. However this won't work.</p>\n\n<pre><code>        private void button1_Click(object sender, EventArgs e)\n        {\n            t = new Thread(doWork);          // Kick off a new thread\n            t.Start();               \n        }\n\n        private  void button2_Click(object sender, EventArgs e)\n        {                \n            t.Abort();\n        }    \n\n        static void doWork()\n        {    \n            while (true)\n            {\n              //My work    \n            }\n        }\n      }\n</code></pre>\n\n<p>.When Im debugging, the button2_Click method won't hit the pointer. I think because Thread is keep busy.</p>\n\n<p>Please correct me if I going wrong somewhere. </p>\n"},{"tags":["java","multithreading","com"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12894257,"title":"How to use COM servers in multiple Java threads","body":"<p>The company I work for wanted some functionality for some software, as it could apply to multiple products and these products are written in different languages, although all only run on Windows, it seemed a good choice to implement it in a COM server. I wrote the COM server using python and the pywin32 extensions, so access to it is late binding and I believe IDispatch.</p>\n\n<p>I am now trying to create Java bindings for the COM server, as it requires use of the dispatch interface, I decided to use JACOB to access COM (it seems to be one of the most recently updated projects and fitted with our needs). Being fairly new to COM and not really seeing any issues with multithreading in the library the COM server wraps, I paid little attention to COM threading at first, so it the Java bindings for the COM objects I did not use any of the threading stuff provided by JACOB, simple tests of it worked fine in Oracle's JVM.</p>\n\n<p>However it has become clear that I cannot ignore COM threading. One issue being that the Java product is compiled using Excelsior Jet, which for some reason was not releasing the COM objects in Java and so the COM server (which is a separate .exe) continued to run after exiting the application. The other issue being that we do actually need to use the COM objects from multiple threads, my original approach was hitting the issue that the COM object could not be used in multiple threads.</p>\n\n<p>I have read the document in the JACOB distribution about how it handles COM objects (both the one about reference counting VS GC and the document on multiple threads). I believe I understand these and how to use the COM object now in multiple threads and get them properly released (using JACOB's ComThread.Release() for each thread does lead to Excelsior Jet releasing the COM objects as well).</p>\n\n<p>My thought is that a multithreaded apartment should be fine with the COM server, so according to the JACOB documentation this simply requires each thread to call com.jacob.com.ComThread.InitMTA() before using the COM objects and then call com.jacob.com.ComThread.Release() at the end of each thread using the COM objects. Also the document suggests that I probably will want JACOB to create a main STA, so this would also mean a call to quit the main STA at the shutdown of the application.</p>\n\n<p>My question is, this calling things at the beginning of a thread does not really seem to fit well with Java way of doing things, is there any way I can try and isolate the rest of the application from these peculiarities of COM, particularly in the threading area?</p>\n\n<p>I have considered, as the application is using my bindings rather than the COM objects directly, could this stuff be handled within those wrapper classes? However I only seem to come up with calling ComThread.InitMTA() and ComThread.Release() in every method of the wrapper object which accesses the COM object. This feels inefficient, however I don't know how much calls to ComThread.InitMTA() and ComThread.Release() actually do so it may not be as bad as it might initially seem.</p>\n\n<p>My other thought is, its very early days of using this library, I don't think we have actually released anything using the COM server, so might there be a better technology to use (eg. RPC, may be XMLRPC)? Such a change probably would not be too painful to make at the moment.</p>\n\n<p>To provide a little context as to what the library is doing, its mainly wrapping various speech output APIs into one (eg. giving a common interface for accessing both SAPI4, SAPI5 and some others). So most calls are just telling the system to say something, to silence speech or to change a setting. In general the communication with the library is very simple (I think returning an array of strings is about as complicated as it gets).</p>\n"},{"tags":["winforms","multithreading","stream","httpwebrequest","file-download"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":62,"score":1,"question_id":12893852,"title":"Download File (using Thread class)","body":"<p>Ok, I understand that maybe very stupid question, but i never did it before, so i ask this question. How can i download file (let's say, from the internet) using Thread class?</p>\n"},{"tags":["objective-c","multithreading","ios","core-data","nsmanagedobjectcontext"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":540,"score":0,"question_id":5889212,"title":"NSManagedObjectContext saving/merging over multiple threads through notifcation center issue","body":"<p>This is more a why does this work and that doesn't kind of question...</p>\n\n<p>I am using CoreData over multiple threads. I have two threads being spawned off of the main threads and they both perform a similar call:</p>\n\n<pre><code>    id observerObject = [notificationCenter addObserverForName:NSManagedObjectContextDidSaveNotification \n                                                        object:secondManagedObjectContext \n                                                         queue:nil \n                                                    usingBlock:^(NSNotification *saveNotification) {\n                                                        dispatch_async(dispatch_get_main_queue(), ^{\n                                                            [mainThreadManagedObjectContext mergeChangesFromContextDidSaveNotification:saveNotification];\n                                                        });\n                                                    }];\n    [secondManagedObjectContext save:nil];\n\n\n    [notificationCenter removeObserver:observerObject\n                                  name:NSManagedObjectContextDidSaveNotification \n                                object:syncManagedObjectContext];\n</code></pre>\n\n<p>This seems to work fine, but previously I was doing this with the notification center and having some problems:</p>\n\n<pre><code>    id observerObject = [notificationCenter addObserverForName:NSManagedObjectContextDidSaveNotification \n                                                        object:secondManagedObjectContext \n                                                         queue:[NSOperationQueue mainQueue]\n                                                    usingBlock:^(NSNotification *saveNotification) {\n                                                        [mainThreadManagedObjectContext mergeChangesFromContextDidSaveNotification:saveNotification];\n                                                    }];\n</code></pre>\n\n<p>This sometimes would work, but other times XCode would pause on start up and drop a green breakpoint on the call and just list the Thread and its number, but no error. (Note: this problem only occurs if I spawned two or more threads).</p>\n\n<p>The culprit appears to be: [NSOperationQueue mainQueue], but I cannot seem to figure out why it would make the thread pause. I was able to press continue in the debugger and just move on...but I don't understand why it was functioning this way.</p>\n\n<p>I assume that I am doing something wrong and I worry that my new way might just be a hack.</p>\n\n<p>Thanks for the help!</p>\n"},{"tags":["php","multithreading","webserver","redis","connection-pooling"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12893745,"title":"phpredis + pconnect","body":"<p>I am using phpredis on my php based website. The webserver I am using is a the simplest apache apt-get installation, no configuration involved, as this is only a development environment.</p>\n\n<p>The issue I am facing is that basically, while using phpredis, there is no difference between \"connect\" and \"pconnect\" commands: they both create a new connection everytime, as I can see from the \"info\" command on redis-cli.</p>\n\n<p>Now, I am pretty sure it is because of the apache configuration and the fact that it probably (most likely) is a multi-threaded env, therefore can't enstablish a single connection.</p>\n\n<p>My question is basically for when I will turn into production: what would the best choice of a webserver be to avoid this problem? I remember using lighttpd with thousands of users and still get only a very few (like 2 or 3) connections on mongoDB.</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c++","multithreading","c++11","mutex"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":107,"score":3,"question_id":12857418,"title":"Implementing BasicLockable concept on STL container","body":"<p>I'm interested in encapsulating both a mutex and the data it protects together and so have being looking at how I can provide BasicLockable semantics to a container. As per <a href=\"http://en.cppreference.com/w/cpp/concept/BasicLockable\" rel=\"nofollow\">http://en.cppreference.com/w/cpp/concept/BasicLockable</a> I've made available <code>lock()</code> and <code>unlock()</code> in this manner:</p>\n\n<pre><code>template &lt;typename TContainer, typename TMutex&gt;\nstruct basic_lockable_container : public TContainer\n                                , private TMutex\n{\n    using TMutex::lock;\n    using TMutex::unlock;\n};\n\ntypedef basic_lockable_container&lt;std::queue&lt;Request&gt;, boost::detail::spinlock&gt; RequestQueue;  \n\n\n// example usage\nRequestQueue queue;\n{\nstd::lock_guard&lt;RequestQueue&gt; lock(queue);\nqueue.push(Request(\"More Coffe Please!\"));\n}\n</code></pre>\n\n<p>I understand that STL containers do not have virtual destructors hence the dangers of deleting via a pointer to base, however this aside, does anyone see any other issues with this simplistic approach?</p>\n"},{"tags":["c#",".net","multithreading","scalability","task-parallel-library"],"answer_count":5,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":187,"score":5,"question_id":12846106,"title":"Parallel code bad scalability","body":"<p>Recently I've been analyzing how my parallel computations actually speed up on 16-core processor. And the general formula that I concluded - the more threads you have the less speed per core you get - is embarassing me. Here are the diagrams of my cpu load and processing speed:</p>\n\n<p><img src=\"http://i.stack.imgur.com/ybn9w.png\" alt=\"picture1\"></p>\n\n<p>So, you can see that  processor load increases, but speed increases much slower. I want to know why such an effect takes place and how to get the reason of unscalable behaviour.\nI've made sure to use <strong>Server GC mode</strong>.\nI've made sure that I'm parallelizing appropriate code as soon as code does nothing more than</p>\n\n<ul>\n<li>Loads data from RAM (server has 96 GB of RAM, swap file shouldn't be hit)</li>\n<li>Performs not complex calculations</li>\n<li>Stores data in RAM</li>\n</ul>\n\n<p>I've <strong>profiled</strong> my application carefully and found no bottlenecks - looks like each operation becomes slower as thread number grows. </p>\n\n<p>I'm stuck, what's wrong with my scenario?</p>\n\n<p>I use .Net 4 Task Parallel Library.</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":49,"score":-2,"question_id":12893939,"title":"java main and child threads","body":"<p>I've been doing a bit of research into threads and it seems im lost. I am wondering what are main and child threads. How are they made? and what is the difference between them.</p>\n"},{"tags":["java","linux","crash","multithreading","processbuilder"],"answer_count":6,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":4720,"score":7,"question_id":3285408,"title":"Java ProcessBuilder: Resultant Process Hangs","body":"<p>I've been trying to use Java's ProcessBuilder to launch an application in Linux that should run \"long-term\".  The way this program runs is to launch a command (in this case, I am launching a media playback application), allow it to run, and check to ensure that it hasn't crashed.  For instance, check to see if the PID is still active, and then relaunch the process, if it has died.</p>\n\n<p>The problem I'm getting right now is that the PID remains alive in the system, but the GUI for the application hangs.  I tried shifting the ProcessBuilder(cmd).start() into a separate thread, but that doesn't seem to be solving anything, as I hoped it would have.</p>\n\n<p>Basically the result is that, to the user, the program APPEARS to have crashed, but killing the Java process that drives the ProcessBuilder.start() Process actually allows the created Process to resume its normal behavior.  This means that something in the Java application is interfering with the spawned Process, but I have absolutely no idea what, at this point.  (Hence why I tried separating it into another thread, which didn't seem to resolve anything)</p>\n\n<p>If anyone has any input/thoughts, please let me know, as I can't for the life of me think of how to solve this problem.</p>\n\n<p>Edit: I have no concern over the I/O stream created from the Process, and have thus taken no steps to deal with that--could this cause a hang in the Process itself?</p>\n"},{"tags":["java","multithreading","swing","swingworker","event-dispatch-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":45,"score":3,"question_id":12893797,"title":"SwingWorker extended class not showing overided methods","body":"<p>Here is my sample code...i am facing problem that my swingWorker extended class is only showing doInBackground() to me as overided method. I want to use done() and process() mehtods also but my class is not showing it @overided nor calling done/process method where it is required to call leave the while loop stuff etc. because i know it is infinite loop but why not the process method is called upon publish()?..Thankyou</p>\n\n<pre><code> public class getChatSwingWorkerThread extends SwingWorker&lt;String , String&gt; {\n private final JTextArea chat_text_area;\n private PostDataConnection post = null;\n private BasicUserInterface chatWindow = null;\n\npublic getChatSwingWorkerThread(JTextArea text_area){\n    chatWindow = new BasicUserInterface();\n    this.chat_text_area = text_area;\n    post = new PostDataConnection();\n}\n@Override\nprotected String doInBackground() throws Exception {\n    String returnData = \"\";\n    while(true){\n        returnData = post.getAvailableChat();\n        if(!returnData.equals(\"\")){\n            publish(returnData);\n            }\n       } \n\n}\nprotected void process(String returnData) {\n\n    chat_text_area.append(returnData);\n}\n\n public void done(String returnData) throws InterruptedException, ExecutionException{\n    chat_text_area.append(get());\n}\n</code></pre>\n"},{"tags":["multithreading","performance","optimization"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12892941,"title":"CPU usage vs Number of threads","body":"<p>In general what is the relation between CPU usage and number of threads in a program.\nAssumptions:</p>\n\n<ul>\n<li>Multi-core CPU</li>\n<li>Threads do the exact same job (assume they fetch identical work items from a queue and process them)</li>\n</ul>\n"},{"tags":["c#","wpf","winforms","multithreading","modal-dialog"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":645,"score":0,"question_id":5694946,"title":"Showing a wait dialog while doing interface operations in C#","body":"<p>So I need to do heavy interface operations in my program... More specifically, populating a <strong>Windows Forms</strong> list view and generating images on the fly. This cannot be done on another thread.<br>\nSo how do I show a modal, working (responding) dialog over my main <strong>WPF</strong> window?<br>\nThe dialog can be either WPF or winforms, I don't care, I'll adapt...  </p>\n\n<p>It must be usable and always stay above and modally block it's owner form.  </p>\n"},{"tags":["c++","multithreading","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12892405,"title":"Multiple reads and single write - threadsafe?","body":"<p>I have a data structure that has two methods to access it : query() and modify(). Multiple threads can use query() at the same time but only a single thread can enter modify() and at the same time all threads using query() has to exit before access occurs on modify(). </p>\n\n<p>What is the best way to make this data structure threadsafe in C++? </p>\n\n<p>(I read up on boost read/write locking but I was told that it could be 3-40x slower than using mutexes)</p>\n"},{"tags":["java","multithreading","client","nio"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12889916,"title":"why client can not receive message from server (java)","body":"<p>I have just started learning java. I modified the client side code for a server/client communication program, by creating two threads for the client side, main thread for receiving user's input, and inputThread for receiving server's response. I am sure that server has sent the response to client, however, no response message is obtain at client.</p>\n\n<p>Here is my code. Can anyone help me to figure it out? Thanks</p>\n\n<pre><code>package clientnio;\n\nimport java.net.*; \nimport java.nio.*; \nimport java.io.*;\nimport java.nio.channels.*; \nimport java.util.Scanner; \n\npublic class ClientNIO {\npublic static int bufferLen = 50;\npublic static SocketChannel client;\npublic static ByteBuffer writeBuffer;\npublic static ByteBuffer readBuffer;\n\npublic static void main(String[] args) { \n    writeBuffer = ByteBuffer.allocate(bufferLen);\n    readBuffer = ByteBuffer.allocate(bufferLen);\n\n    try { \n        SocketAddress address = new InetSocketAddress(\"localhost\",5505); \n        System.out.println(\"Local address: \"+ address);\n        client=SocketChannel.open(address);\n        client.configureBlocking(false); \n\n        //readBuffer.flip();\n        new inputThread(readBuffer);\n\n        /*\n        String a=\"asdasdasdasddffasfas\"; \n        writeBuffer.put(a.getBytes()); \n        writeBuffer.clear();  \n        int d=client.write(writeBuffer);\n        writeBuffer.flip();\n        */\n\n        while (true) {\n            InputStream inStream = System.in;\n            Scanner scan = new Scanner(inStream);\n            if (scan.hasNext()==true) {\n                String inputLine = scan.nextLine();\n                writeBuffer.put(inputLine.getBytes()); \n                //writeBuffer.clear();\n                System.out.println(writeBuffer.remaining());\n                client.write(writeBuffer);\n                System.out.println(\"Sending data: \"+new String(writeBuffer.array()));\n                writeBuffer.flip(); \n                Thread.sleep(300);\n            }\n        }                 \n    } \n    catch(Exception e) { \n        System.out.println(e);\n    } \n\n}\n}\n\nclass inputThread extends Thread {\nprivate ByteBuffer readBuffer;\npublic inputThread(ByteBuffer readBuffer1) {  \n    System.out.println(\"Receiving thread starts.\");\n    this.readBuffer = readBuffer1;\n    start();\n}\n\n@Override\npublic void run() {\n    try {\n        while (true) {\n            readBuffer.flip();\n            int i=ClientNIO.client.read(readBuffer); \n            if(i&gt;0) { \n                byte[] b=readBuffer.array(); \n                System.out.println(\"Receiving data: \"+new String(b)); \n                    //client.close(); \n                    //System.out.println(\"Connection closed.\"); \n                    //break; \n            }\n            Thread.sleep(100); \n        }\n    }\n    catch (Exception e) {\n       System.out.println(e);\n    }\n  }\n}\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12891310,"title":"Communicate between UI and background thread","body":"<p>Its for the first time I'm making a fairly large app and there are lots of sections in it. </p>\n\n<p>I want to keep UI and background processes in different classes to avoid confusion. However, how do i communicate  among them in best possible way. I've come across few approaches till now:</p>\n\n<ol>\n<li><p>Declaring background thread in different class and defined its onPostExecute() method in UI thread.</p>\n\n<pre><code>    new SetupDefaultFeeds(context) {\n    @Override\n    protected void onPostExecute(List&lt;Feed&gt; result) {\n        default_feeds = result;\n\n        for (Feed t : result) {\n            String log = t.toString();\n            Log.d(\"DEFAULT feed\", log);\n        }\n        menu_btn[0].performClick();\n    }\n}.execute();\n</code></pre></li>\n<li><p>Signalling using a flag variable between background and UI thread.</p></li>\n<li><p>Thread and handler.</p></li>\n</ol>\n\n<p>Are there any other ways and what is the best possible way. Thanks !</p>\n"},{"tags":["c++","multithreading","function","openmp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12884133,"title":"(OpenMP) How to start each function 1 time in 1 thread","body":"<p>I have 4 threads and I want to start in one time 3 functions. Each function takes one thread.<br>\nBut this code is starting every function 4 times</p>\n\n<pre><code>#pragma omp parallel\n    {\n        Func1();\n        Func2();\n        Func3();\n    }\n</code></pre>\n\n<p>and I have this result:</p>\n\n<p>Func*<em>1</em>* started</p>\n\n<p>Func*<em>1</em>* started</p>\n\n<p>Func*<em>1</em>* started</p>\n\n<p>Func*<em>1</em>* started</p>\n\n<p>Func*<em>1</em>* finished</p>\n\n<p>Func*<em>1</em>* finished</p>\n\n<p>Func*<em>1</em>* finished</p>\n\n<p>Func*<em>1</em>* finished</p>\n\n<p>Func*<em>2</em>* started</p>\n\n<p>Func*<em>2</em>* started</p>\n\n<p>Func*<em>2</em>* started</p>\n\n<p>Func*<em>2</em>* started</p>\n\n<p>Func*<em>2</em>* finished</p>\n\n<p>Func*<em>2</em>* finished</p>\n\n<p>Func*<em>2</em>* finished</p>\n\n<p>Func*<em>2</em>* finished</p>\n\n<p>...</p>\n\n<p>How should I change the code to display some like this:</p>\n\n<p>Func*<em>1</em>* started</p>\n\n<p>Func*<em>2</em>* started</p>\n\n<p>Func*<em>3</em>* started</p>\n\n<p>Func*<em>2</em>* finished</p>\n\n<p>Func*<em>1</em>* finished</p>\n\n<p>Func*<em>3</em>* finished</p>\n"},{"tags":["java","multithreading","hashmap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12891290,"title":"Hashmap comparison issue on runtime in Thread","body":"<p>I'm having two hashmap on one hashmap. I'm looping through the data and in the loop comparing the other hashmap data. I'm facing the problem of data consistency if i use other hashmap to compare. Please check the example below :</p>\n\n<pre><code>Hashmap1 =&gt;\nwriteAndClientId = {AC001=java.io.PrintWriter@1a16869, VV001=java.io.PrintWriter@1f33675}\n\nHashmap2 =&gt;\nbidaskMapMulti =  {VV001-22=22, AC001-11536=11536,PR001-2564=2564, SP001-1541=1541}\n\nHashmap3 =&gt;\nsecMapMulti =   {AC001-76091=76091, PR001-1838=1838, VV001-51430=51430}\n</code></pre>\n\n<p>example1 => comparison of two Hashmaps on the basis of condition and skip the rest of the statement in the for loop using continue keyword im missing lot of data in this example which is problematic</p>\n\n<pre><code>for(Map.Entry&lt;String,PrintWriter&gt; entry : writeAndClientId.entrySet())\n{\n    pw_eq1 = entry.getValue();\n    eq_client_id1 = entry.getKey();\n\n    //System.out.println(\"bidaskMapMulti in nse eq :: \"+bidaskMapMulti);\n\n    if(!bidaskMapMulti.containsKey(eq_client_id1+\"-\"+split_str_data_nse_eq[0]))\n    {\n        pw_eq1.println(data1);\n        continue;\n    }\n    if(secMapMulti.containsKey(eq_client_id1+\"-\"+split_str_data_nse_eq[0]))\n    {\n        pw_eq1.println(data);\n        continue;                   \n    }\n}\n</code></pre>\n\n<p>example2 => comparison of one Hashmap on the basis of condition and printing the data works fine without any continue keyword and data is proper as per the requirement.</p>\n\n<pre><code>for(Map.Entry&lt;String,PrintWriter&gt; entry : writeAndClientId.entrySet())\n{\n    pw_eq1 = entry.getValue();\n    eq_client_id1 = entry.getKey();\n\n    if(secMapMulti.containsKey(eq_client_id1+\"-\"+split_str_data_bse_eq[0]))\n    {\n        pw_eq1.println(data);\n    }\n}       \n</code></pre>\n\n<p>Please check and suggest what is wrong with the first example. Am I missing something?</p>\n\n<p>Thanks &amp; Regards\nPraveen T</p>\n"},{"tags":["c++","linux","multithreading","asynchronous","c++11"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":117,"score":3,"question_id":12886246,"title":"Puzzling behaviour of async","body":"<p>This might be some weird Linux quirk, but I'm observing very strange behavior.</p>\n\n<p>The following code should compare a synchronized version of summing numbers with an async version. The thing is that I'm seeing a performance increase (it's not caching, it happens even when I split the code into two separate programs), while still observing the program as single-threaded (only one core is used).</p>\n\n<p><code>strace</code> does show some thread activity, but monitoring tools like <code>top</code> clones still show only one used core.</p>\n\n<p>Second problem I'm observing is that if I increase the spawn ratio, the memory usage just explodes. What is the memory overhead of a thread? With 5000 threads I get ~10GB memory usage.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;random&gt;\n#include &lt;chrono&gt;\n#include &lt;future&gt;\nusing namespace std;\n\n\nlong long sum2(const vector&lt;int&gt;&amp; v, size_t from, size_t to)\n{\n    const size_t boundary = 5*1000*1000;\n\n    if (to-from &lt;= boundary)\n    {\n        long long rsum = 0;\n        for (;from &lt; to; from++)\n        {\n            rsum += v[from];\n        }\n        return rsum;\n    }\n    else\n    {\n        size_t mid = from + (to-from)/2;\n        auto s2 = async(launch::async,sum2,cref(v),mid,to);\n\n        long long rsum = sum2(v,from,mid);\n        rsum += s2.get();\n        return rsum;\n    }\n}\n\nlong long sum2(const vector&lt;int&gt;&amp; v)\n{\n    return sum2(v,0,v.size());\n}\n\nlong long sum(const vector&lt;int&gt;&amp; v)\n{\n    long long rsum = 0;\n    for (auto i : v)\n    {\n        rsum += i;\n    }\n\n    return rsum;\n}\n\nint main()\n{\n    const size_t vsize = 100*1000*1000;\n\n    vector&lt;int&gt; x;\n    x.reserve(vsize);\n\n    mt19937 rng;\n    rng.seed(chrono::system_clock::to_time_t(chrono::system_clock::now()));\n\n    uniform_int_distribution&lt;uint32_t&gt; dist(0,10);\n\n    for (auto i = 0; i &lt; vsize; i++)\n    {\n        x.push_back(dist(rng));\n    }\n\n    auto start = chrono::high_resolution_clock::now();\n    long long suma = sum(x);\n    auto end = chrono::high_resolution_clock::now();\n\n    cout &lt;&lt; \"Sum is \" &lt;&lt; suma &lt;&lt; endl;\n    cout &lt;&lt; \"Duration \" &lt;&lt; chrono::duration_cast&lt;chrono::nanoseconds&gt;(end - start).count() &lt;&lt; \" nanoseconds.\" &lt;&lt; endl;\n\n    start = chrono::high_resolution_clock::now();\n    suma = sum2(x);\n    end = chrono::high_resolution_clock::now();\n\n    cout &lt;&lt; \"Async sum is \" &lt;&lt; suma &lt;&lt; endl;\n    cout &lt;&lt; \"Async duration \" &lt;&lt; chrono::duration_cast&lt;chrono::nanoseconds&gt;(end - start).count() &lt;&lt; \" nanoseconds.\" &lt;&lt; endl;\n\n    return 0;\n}\n</code></pre>\n"},{"tags":["c#",".net","multithreading","synchronization","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12890079,"title":"How to implement synchronisization when log write by 100 applications at a time in c#","body":"<pre><code>public class Logwriter {\n    public Void WriteXml()\n    {\n        XmlDocument xmlDoc = new XmlDocument();\n        xmlDoc.Load(@\"C:\\Log_Data.xml\");\n\n        XmlElement newelement = xmlDoc.CreateElement(\"entry\");\n        XmlElement xmldata = xmlDoc.CreateElement(\"data\");\n                    XmlElement xmlcontent = xmlDoc.CreateElement(\"content\");\n\n                    xmldata.InnerText =\"1234\" ;\n        xmlcontent.InnerText =\"Stackoverflow\";\n\n                    newelement.AppendChild(xmldata);\n        newelement.AppendChild(xmlcontent);\n\n                    xmlDoc.DocumentElement.AppendChild(newelement);\n        xmlDoc.Save(@\"C:\\Log_Data.xml\");\n}}\n</code></pre>\n\n<p>Above WriteXml() function can be called by 100 applications at a time so i have to prevent IOException Error.\nI can avod these exception using lock so how can i do it.\nplease explain which object i have to lock during writing xml</p>\n"},{"tags":["android","multithreading","service","timer","db4o"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12890400,"title":"Exception in Timer - java.lang.RuntimeException: Can't create handler inside thread that has not called Looper.prepare() - Android","body":"<p>I'm using a Service for update a db4o file each 3 hours:</p>\n\n<pre><code>    @Override\npublic IBinder onBind(Intent intent) {\n    // TODO Auto-generated method stub\n    return null;\n}\n\n@Override\npublic void onCreate() {\n    super.onCreate();\n    Log.d(\"Service\", \"Service started\");\n    pref = new MyPreferences(getApplicationContext());\n    addNotificacion();//update notifications\n\n    timer.scheduleAtFixedRate(new TimerTask() {\n        @Override\n        public void run() {\n            Looper.prepare();\n                            Log.d(TAG, \"updating...\");\n            updateInService();\n            addNotificacion();\n            Log.d(TAG, \"End of update\");\n        }\n    }, 40000, 60000);\n\n}\n</code></pre>\n\n<p>I don't have problem with addNotificacion() method but updateInService throws the Exception of the subject. In this method, I access to db4o, use a http client, update the alarms of AlarmManager... but i don't modify the UI. I start the service in OnBootReceiver.</p>\n\n<p>How can I solve my problem?</p>\n\n<p>Thanks in advance.</p>\n\n<p>After edited:</p>\n\n<p>After added <code>Looper.prepare();</code> The system does Ok the firs iteration, but in the second, I've an Exception in the instance Looper.prepare();: java.lang.RuntimeException: Only one Looper may be created per thread</p>\n\n<p>Thanks!</p>\n"},{"tags":["ios","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12890462,"title":"using dispatch_queue while fetching Tweets from Twiiter in iOS application","body":"<p>in my iOS application i m fetching tweets from twitter in Utility class and then update the main class UITableView (with cell showing individual tweets). Below is my code \n         NSMutableArray *tweetsArray = [[NSMutableArray alloc]init];</p>\n\n<pre><code>+ (NSMutableArray *)getTweetStatus:(NSString *)myData{\nACAccountStore *store = [[ACAccountStore alloc] init];\nACAccountType *twitterAccountType = \n[store accountTypeWithAccountTypeIdentifier:ACAccountTypeIdentifierTwitter];\ndispatch_queue_t myCustomQueue;\nmyCustomQueue = dispatch_queue_create(\"com.example.MyCustomQueue\", NULL);\n[store requestAccessToAccountsWithType:twitterAccountType \n                 withCompletionHandler:^(BOOL granted, NSError *error) {\n                      dispatch_sync(myCustomQueue, ^{\n                     if (!granted) {\n                         // The user rejected your request \n                         NSLog(@\"User rejected access to the account.\");\n                     } \n                     else {\n                         // Grab the available accounts\n                         NSArray *twitterAccounts = \n                         [store accountsWithAccountType:twitterAccountType];\n\n                         if ([twitterAccounts count] &gt; 0) {\n                             // Use the first account for simplicity \n                             ACAccount *account = [twitterAccounts objectAtIndex:0];\n\n                             // Now make an authenticated request to our endpoint\n                             NSMutableDictionary *params = [[NSMutableDictionary alloc] init];\n                             [params setObject:@\"1\" forKey:@\"include_entities\"];\n\n                             //  The endpoint that we wish to call\n                             NSURL *url =  [NSURL URLWithString:@\"http://api.twitter.com/1/statuses/home_timeline.json\"];\n\n                             //  Build the request with our parameter \n                             TWRequest *request = \n                             [[TWRequest alloc] initWithURL:url \n                                                 parameters:params \n                                              requestMethod:TWRequestMethodGET];\n\n                             // Attach the account object to this request\n                             [request setAccount:account];\n\n                             [request performRequestWithHandler:^(NSData *responseData, NSHTTPURLResponse *urlResponse, NSError *error) {\n                                 dispatch_sync(myCustomQueue, ^{\n                                 if (!responseData) {\n                                      // inspect the contents of error \n                                      NSLog(@\"%@\", error);\n                                  } \n                                  else {\n                                      NSError *jsonError;\n                                      NSMutableArray *tweets =[NSJSONSerialization JSONObjectWithData:responseData options:NSJSONReadingMutableLeaves error:&amp;jsonError];            \n                                      if (tweets) {                          \n                                          // at this point, we have an object that we can parse\n                                          NSLog(@\"%@\", tweets);\n                                      }\n                                      else { \n                                          // inspect the contents of jsonError\n                                          NSLog(@\"%@\", jsonError);\n                                      }\n                                      [tweetsArray addObjectsFromArray:tweets];\n\n                                  }\n                                 });\n                              }];\n\n                         }\n                     }\n    });\n    }];\n     return tweetsArray; \n    }\n</code></pre>\n\n<p>The problem is that i dont want to \"return tweetsArray\" until i get the response(i.e. get response from TWRequest performRequestWithHandler method which add tweets response into \"tweetsArray\") and for this i placed \"dispatch_sync\" at two places- \n<br/>1: In requestAccessToAccountsWithType:twitterAccountType\n<br/>2: In [request performRequestWithHandler:^(NSData *responseData, NSHTTPURLResponse *urlResponse, NSError *error) .\n<br/> But i m not able to do so by this. Any help is greatly appreciated. Thanks</p>\n"},{"tags":["c#",".net","multithreading","powershell","cmdlet"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12852494,"title":"Best way to update cmdlet progress from a separate thread","body":"<p>I have a powershell cmdlet <strong>written in C#</strong> (deriving from <code>PSCmdlet</code>) which will start a long-running task which should update its progress using <code>WriteProgress()</code> while it is running. Since powershell will not allow a separate thread to use <code>WriteObject</code> or <code>WriteProgress</code> I had to create a <code>Queue&lt;object&gt;</code> in the main thread and I add items to the queue from the task that I want to be written to the Pipeline/Progress. A while loop will dequeue objects as they come in and write to the pipline / progress bar.</p>\n\n<p>This is working, but I wanted to see if there were any better practices for multi-threading with a powershell cmdlet that is written in C#/VB. For example with WPF I can always step onto the UI thread with <code>UIComponent.Dispatcher.Invoke()</code> if I need to update a progress bar or UI Component. Is there anything equivalent that I can use to 'step onto' the powershell thread to update the UI or write to the pipeline?</p>\n"},{"tags":["c++","multithreading","file","logging"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":12889620,"title":"Writing (logging) into same file from different threads , different functions?","body":"<p>In C++ is there any way to make the writing into file thread safe in the following scenario ?</p>\n\n<pre><code>void foo_one(){\nlock(mutex1);\n//open file abc.txt\n//write into file\n//close file\nunlock(mutex1);\n}\n\nvoid foo_two(){\nlock(mutex2);\n//open file abc.txt\n//write into file\n//close file\nunlock(mutex2);\n}\n</code></pre>\n\n<p>In my application (multi-threaded) , it is likely that foo_one()  and foo_two() are executed by two different threads at the same time .\nIs there any way to make the above thread safe ?</p>\n\n<p>I have considered using the file-lock ( fcntl and/or lockf ) but not sure how to use them because fopen() has been used in the application ( performance reasons ) , and it was stated somewhere that those file locks should not be used with fopen ( because it is buffered ) </p>\n\n<p>PS :  The functions foo_one() and foo_two() are in two different classes , and there is no way to have a shared data between them :( , and sadly the design is such that one function cannot call other function .</p>\n"},{"tags":["android","multithreading","web-services","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12889671,"title":"Progress Dialog does not display due to use of thread.get() method","body":"<p>I want to display a Progress Dialog while I have two threads running one after the other, but my data structure that I use gets populated via the threads, becomes null. Thus I used thread.get() method to wait for the thread to be finished....not sure how I can get around this here is an example of one of my Async Threads:</p>\n\n<pre><code>private void performDetailSearch(String reference) \n{\n\n      String addplus = searchterm.replace(\" \", \"+\");  \n      RestClientDS restpSd = new RestClientDS();\n      String url = PLACES_DETAILS_URL +\"reference=\"+ reference + \"&amp;sensor=false&amp;key=\" + API_KEY;\n      Log.d(\"url\",url);\n      String[] URL = {url};\n      restpSd.execute(URL);\n\n\n    try \n       {\n        restpSd.get();\n    } \n    catch (InterruptedException e1) \n    {\n        // TODO Auto-generated catch block\n        e1.printStackTrace();\n    }\n    catch (ExecutionException e1) \n    {\n        // TODO Auto-generated catch block\n        e1.printStackTrace();\n    }\n }\n</code></pre>\n"},{"tags":["java","multithreading","garbage-collection"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12889429,"title":"Is it that the threads started using 'new Thread(r).start()' garbage collected the same way as other objects?","body":"<p>For doing several tasks like reading and parsing a long file I always a new thread. For example when a user clicks <em>show scenario 1</em> which is a long text file that first needs to be parsed,I start a new thread from the main thread that is running the GUI as :</p>\n\n<pre><code>Runnable r = new Runnable() {\n   @Override\n   public void run() {\n      // do the work here\n   }\n};\nnew Thread(r,\"new thread\").start();\n</code></pre>\n\n<p>Like ways I start many threads while the application is on a run.When do these threads die ? I guess they don't die as soon as they finish their work. Is it that they are garbage collected the same way as other objects are ?</p>\n"},{"tags":["c","multithreading","interlocked"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":12888779,"title":"How can i implement a InterlockedIncrement without a memory barrier","body":"<p>I implement a reference counting schema and for this i need interlock facilities but no memory  fences (as far as i understand).</p>\n\n<p>Unfortunately only Windows has a InterlockedDecrementNoFence compiler intrinsic.\nHow can i do this with asm inlining? I would need this for gcc/clang too.</p>\n"},{"tags":["multithreading","qt","user-interface","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12888138,"title":"Should I use CRITICAL_SECTION or not?","body":"<p>I have a program which has a Ui with which users choose the way to display and do small configurations. It also has a background procedure, which continuously reads data from the network and update the data to display.</p>\n\n<p>Now I put them in one process:\nbackground procedure:  </p>\n\n<pre><code>    STATE MainWindow::Rcv()\n    {\n\n    DeviceMAP::iterator dev;\n\n    for(dev= dev_map.begin(); dev!= dev_map.end(); dev++)\n    {\n\n\n        dev-&gt;second.rcvData();//receive data from the network, the time can be ignored.\n\n        BitLog* log = new BitLog();\n        dev-&gt;second.parseData(log);\n\n\n        LogItem* logItem = new LogItem();\n        logItem-&gt;time = QString::fromLocal8Bit(log-&gt;rcvTime.c_str());\n        logItem-&gt;name = QString::fromLocal8Bit(log-&gt;basicInfo.getName().c_str());\n        logItem-&gt;PIN = QString::fromLocal8Bit(log-&gt;basicInfo.getPIN().c_str()).toShort();\n\n        delete log;\n        add_logItem(logItem);\n\n    }\n    return SUCCESS;\n}\n</code></pre>\n\n<p>add_logItem:</p>\n\n<pre><code>void MainWindow::add_logItem(LogItem* logItem)\n{\n\n\n    writeToFile(logItem);\n\n    Device* r = getDevbyPIN(QString::number(logItem-&gt;PIN));\n\n    if(r == NULL)return;\n\n    devInfo_inside_widget::States state = logItem-&gt;state;\n\n    bool bool_list[portsNum_X];\n    for(int i =0; i &lt; portsNum_X; i++)\n    {\n        bool_list[i] = 0;\n    }\n\n    for(int i = 0; i &lt; portsNum; i++)\n    {\n        bool_list[i] = (logItem-&gt;BITS[i/8] &gt;&gt; (7 - i%8)) &amp; 0x1;\n    }\n\n    r-&gt;refresh(state, logItem-&gt;time, bool_list);//update data inside...state, time , BITS...\n\n    IconLabel* icl = getIConLabelByDev(r);//update data\n    icl-&gt;refresh(state);\n\n\n    logDisplayQueue.enqueue(logItem);//write queue here\n\n    int size = logDisplayQueue.size();\n\n    if(size &gt; 100)\n    {\n        logDisplayQueue.dequeue();//write queue here\n    }\n\n}\n</code></pre>\n\n<p>The section above has not dealt with any ui operations yet, but when user push a radio button in the ui, the program has to filter the data in the queue and display it in the table widget:   </p>\n\n<p>ui operations:     </p>\n\n<pre><code>void MainWindow::filter_log_display(bool bol)\n{\n\n    row_selectable = false;\n    ui-&gt;tableWidget-&gt;setRowCount(0);//delete table items all\n    row_selectable = true;\n\n    int size_1 = logDisplayQueue.size() - 1;\n\n    ui-&gt;tableWidget-&gt;verticalScrollBar()-&gt;setSliderPosition(0);\n\n    if(size_1+1 &lt; 100)\n    {\n        ui-&gt;tableWidget-&gt;setRowCount(size_1 + 1);\n    }\n    else\n    {\n        ui-&gt;tableWidget-&gt;setRowCount(100);//display 100 rows at most\n    }\n\n\n    if(bol)//filter from logDisplayQueue and display unworking-state-log rows\n    {\n\n        int  index = 0;\n        for(int queue_i = size_1; queue_i &gt;= 0; queue_i--)\n        {\n\n            LogItem* logItem = (LogItem*)logDisplayQueue.at(queue_i); // read queue here\n\n            if(logItem-&gt;state == STATE_WORK || logItem-&gt;state == STATE_UN)continue;\n\n\n            QString BITS_str = bits2Hexs(logItem-&gt;BITS);\n\n            ui-&gt;tableWidget-&gt;setItem(index, 0, new QTableWidgetItem(logItem-&gt;time));//time\n            ui-&gt;tableWidget-&gt;setItem(index, 1, new QTableWidgetItem(logItem-&gt;name));//name\n            ui-&gt;tableWidget-&gt;setItem(index, 2, new QTableWidgetItem(BITS_str));//BITS\n\n            if(queue_i == oldRowItemNo)ui-&gt;tableWidget-&gt;selectRow(index);\n            index++;\n        }\n\n        ui-&gt;tableWidget-&gt;setRowCount(index);\n\n    }\n    else//display all rows\n    {\n\n        for(int queue_i = size_1, index = 0; queue_i &gt;= 0; queue_i--, index++)\n        {\n\n            LogItem* logItem = (LogItem*)logDisplayQueue.at(queue_i);                      //read queue here\n\n            QString BITS_str = bits2Hexs(logItem-&gt;BITS);//\n            finish = clock();\n\n            ui-&gt;tableWidget-&gt;setItem(index, 0, new QTableWidgetItem(logItem-&gt;time));//time\n            ui-&gt;tableWidget-&gt;setItem(index, 1, new QTableWidgetItem(logItem-&gt;name));//name\n            ui-&gt;tableWidget-&gt;setItem(index, 2, new QTableWidgetItem(BITS_str));//BITS\n\n            if(queue_i == oldRowItemNo)ui-&gt;tableWidget-&gt;selectRow(index);\n\n        }\n\n\n\n    }\n\n}\n</code></pre>\n\n<p>So the queue is quite samll and the background procedure is quite frequent(nearly 500 times per sec). That is, the queue will be written 500 times in 1 sec, but displayed time from time by the user.<br>\nI want to split the functions into two threads and run them together, one rev and update data, one display.<br>\nIf i do not use any lock or mutex, the user may get the wrong data, but if i force the write-data procedure enter critical section and leave critical section everytime, it will be a heavy overload. :)<br>\nShould I use CRITICAL_SECTION or something else, any suggestions related?(my words could be verbose for you :) , i only hope for some hints :) </p>\n"},{"tags":["java","multithreading","client"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":64,"score":-5,"question_id":12888934,"title":"why client can not receive message from server (java)","body":"<p>I have just started learning java. I modified the client side code for a server/client communication program, by creating two threads for the client side, main thread for receiving user's input, and inputThread for receiving server's response.  I am sure that server has sent the response to client, however, no response message is obtain at client.</p>\n\n<p>Here is my code. Can anyone help me to figure it out? Thanks</p>\n\n<pre><code>package clientnio;\n\nimport java.net.*; \nimport java.nio.*; \nimport java.io.*;\nimport java.nio.channels.*; \nimport java.util.Scanner; \n\npublic class ClientNIO {\npublic static int bufferLen = 50;\npublic static SocketChannel client;\npublic static ByteBuffer writeBuffer;\npublic static ByteBuffer readBuffer;\n\npublic static void main(String[] args) { \n    writeBuffer = ByteBuffer.allocate(bufferLen);\n    readBuffer = ByteBuffer.allocate(bufferLen);\n\n\n        try { \n            SocketAddress address = new InetSocketAddress(\"localhost\",5505); \n            System.out.println(\"Local address: \"+ address);\n            client=SocketChannel.open(address);\n            client.configureBlocking(false); \n\n            //readBuffer.flip();\n            new inputThread(readBuffer);\n\n            /*\n            String a=\"asdasdasdasddffasfas\"; \n            writeBuffer.put(a.getBytes()); \n            writeBuffer.clear();  \n            int d=client.write(writeBuffer);\n            writeBuffer.flip();\n            */\n\n            while (true) {\n                InputStream inStream = System.in;\n                Scanner scan = new Scanner(inStream);\n                if (scan.hasNext()==true) {\n                    String inputLine = scan.nextLine();\n                    writeBuffer.put(inputLine.getBytes()); \n                    //writeBuffer.clear();\n                    System.out.println(writeBuffer.remaining());\n                    client.write(writeBuffer);\n                    System.out.println(\"Sending data: \"+new String(writeBuffer.array()));\n                    writeBuffer.flip(); \n                    Thread.sleep(300);\n                }\n            }                 \n        } \n        catch(Exception e) { \n            System.out.println(e);\n        } \n\n    }\n}\n\nclass inputThread extends Thread {\nprivate ByteBuffer readBuffer;\npublic inputThread(ByteBuffer readBuffer1) {  \n    System.out.println(\"Receiving thread starts.\");\n    this.readBuffer = readBuffer1;\n    start();\n}\n\n@Override\npublic void run() {\n    try {\n        while (true) {\n            readBuffer.flip();\n            int i=ClientNIO.client.read(readBuffer); \n            if(i&gt;0) { \n                byte[] b=readBuffer.array(); \n                System.out.println(\"Receiving data: \"+new String(b)); \n                    //client.close(); \n                    //System.out.println(\"Connection closed.\"); \n                    //break; \n            }\n            Thread.sleep(100); \n        }\n    }\n    catch (Exception e) {\n       System.out.println(e);\n    }\n  }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","stack"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":90,"score":2,"question_id":12879897,"title":"Concurrent Threads using same method","body":"<p>If I spawn various Threads, and tell them all to use the same method:</p>\n\n<pre><code>internal class Program {\n\n    private static DoSomething() {\n\n        int result = 0;\n        Thread.Sleep(1000);\n        result++;\n        int ID = Thread.CurrentThread.ManagedThreadId;\n        Console.WriteLine(\"Thread {0} return {1}\", ID, result);\n    }\n\n    private static Main() {\n\n        Thread[] threads = new Thread[50];\n\n        for (int i = 0; i &lt; 50; i++)\n            threads[i] = new Thread(DoSomething);\n\n        foreach (Thread t in threads)\n            t.Start();\n    }\n}   \n</code></pre>\n\n<p>Will all the Threads share the same stack? When I run the program all Threads return 1, so I guess the answer is no, but then does that mean that the CLR makes different copies of the method in memory?</p>\n"},{"tags":["python","multithreading","signals"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12888386,"title":"How are signals handled in main thread sent by other thread?","body":"<p>The code is from <a href=\"http://www.doughellmann.com/PyMOTW/signal/index.html#signals-and-threads\" rel=\"nofollow\">PyMOTW signal chapter</a>. Why is the alarm signal not handled immediately by the main thread when it is signaled by the alarm_thread. The output from the author show the alarm signal is handled when the alarm thread finishes(<code>alarm_thread.join()</code> returns).</p>\n\n<pre><code>import signal\nimport time\nimport threading\n\ndef signal_handler(num, stack):\n    print time.ctime(), 'Alarm in', threading.currentThread()\n\nsignal.signal(signal.SIGALRM, signal_handler)\n\ndef use_alarm():\n    print time.ctime(), 'Setting alarm in', threading.currentThread()\n    signal.alarm(1)\n    print time.ctime(), 'Sleeping in', threading.currentThread()\n    time.sleep(3)\n    print time.ctime(), 'Done with sleep'\n\n# Start a thread that will not receive the signal\nalarm_thread = threading.Thread(target=use_alarm, name='alarm_thread')\nalarm_thread.start()\ntime.sleep(0.1)\n\n# Wait for the thread to see the signal (not going to happen!)\nprint time.ctime(), 'Waiting for', alarm_thread\nalarm_thread.join()\n\nprint time.ctime(), 'Exiting normally'\n</code></pre>\n\n<p>output by the author:</p>\n\n<pre><code>$ python signal_threads_alarm.py\nSun Aug 17 12:06:00 2008 Setting alarm in &lt;Thread(alarm_thread, started)&gt;\nSun Aug 17 12:06:00 2008 Sleeping in &lt;Thread(alarm_thread, started)&gt;\nSun Aug 17 12:06:00 2008 Waiting for &lt;Thread(alarm_thread, started)&gt;;\nSun Aug 17 12:06:03 2008 Done with sleep\nSun Aug 17 12:06:03 2008 Alarm in &lt;_MainThread(MainThread, started)&gt;\nSun Aug 17 12:06:03 2008 Exiting normally\n</code></pre>\n\n<p>In my opinion, the output should like below. Alarm signal should handled by the main thread <code>before</code> alarm thread sleep finishes, and <code>alarm_thread.join()</code> returns.</p>\n\n<pre><code>$ python signal_threads_alarm.py\nSun Aug 17 12:06:00 2008 Setting alarm in &lt;Thread(alarm_thread, started)&gt;\nSun Aug 17 12:06:00 2008 Sleeping in &lt;Thread(alarm_thread, started)&gt;\nSun Aug 17 12:06:00 2008 Waiting for &lt;Thread(alarm_thread, started)&gt;;\nSun Aug 17 12:06:03 2008 Alarm in &lt;_MainThread(MainThread, started)&gt;\nSun Aug 17 12:06:03 2008 Done with sleep\nSun Aug 17 12:06:03 2008 Exiting normally\n</code></pre>\n"},{"tags":["java","multithreading","swing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12886500,"title":"Thread Result shown in text area","body":"<p>I want to execute a thread, and it should get some result after specific interval of time. Now I want to show that result in <code>JTextArea</code>. How to make an event from thread for <code>JTextArea</code>? </p>\n"},{"tags":["c++","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12888014,"title":"Confusion using threads and thread techniques","body":"<p>There's a construction zone. 100m long for cars going East/West....10m across for pedestrians crossing N/S. Here are the rules that must be followed:</p>\n\n<p>neither car nor pedestrians should wait if the intersection is empty;\ncars cannot go in the opposite directions simultaneously on the one-lane section;\na pedestrian cannot cross the street while there is a car in the one-lane section, but\nmultiple pedestrians can cross the street at the same time;\na car may enter the one lane section if there is a car there going in the same direction, however, a car is not allowed to pass another car;\na car does not wait for  more than two cars going in the opposite direction;\na pedestrian has to yield to cars BUT a pedestrian should not wait for more than two cars (in either direction).</p>\n\n<p>The example file being used is as follows: (Each row is a separate entity. E means \"car going east\" and W is west. P is for pedestrians. The first column is the number of seconds after the previous entity arrived at which now the new entity is arriving. The third column is the speed (meters per second):\nExample being used:</p>\n\n<pre><code>0 E1 10\n1 P1 1\n4 E2 15\n5 W1 10\n</code></pre>\n\n<p>Currently my code is printing out E1 enters.... (next line) E1 exits.... This is repeated on and on. I'm pretty confused on using threads and the techniques included so at this moment I'm stuck. What do I need to change to get this to print out the correct order at which the entities should be arriving and leaving the construction zone? All help is appreciated.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;fstream&gt;\n#include &lt;chrono&gt;\n#include &lt;thread&gt;\n#include &lt;random&gt;\n#include &lt;ctime&gt;\n#include &lt;mutex&gt;\n#include &lt;string&gt;\n#include &lt;condition_variable&gt;\n\nusing namespace std;\n\nclass Traffic{\n    public:\n        void set_time(int a) {prevArrival = a;}\n        void set_name(string a) {name = a;}\n        void set_speed(int a) {carSpeed = a;}\n        int get_time() {return prevArrival;}\n        string get_name() {return name;}\n        int get_speed() {return carSpeed;}\n    private:\n        int prevArrival;\n        string name;\n        int carSpeed;\n};\n\ncondition_variable_any cE, cW, ped;\nmutex mtx;\n\nint east=0; //number of cars traveling East currently in the zone\nint west=0; //...traveling West...\nint peds=0; //# of pedestrians crossing the street\n\nvoid sleep(int secs);\nvoid carWest(int time, string name, int speed);\nvoid carEast(int time, string name, int speed);\nvoid pedestrian(int time, string name, int speed);\n\nint main(void){\n  srand(time(NULL));\n  ifstream ifs;\n  ofstream ofs;\n  string info, title, temp;\n  int i=0, e=0, w=0, p=0, time, speed;\n  Traffic crossers[50];\n  vector &lt;thread&gt; eastCars, westCars, pedestrians; \n\n    ifs.open(\"traffic.txt\");\n    while (!ifs.eof()){\n        ifs &gt;&gt; time; crossers[i].set_time(time);\n        ifs &gt;&gt; title; crossers[i].set_name(title);\n        temp = crossers[i].get_name();\n        if(temp[0] == 'E' || temp[0] == 'e') {e++;}\n        else if(temp[0] == 'W' || temp[0] == 'w') {w++;}\n        else {p++;}\n        ifs &gt;&gt; speed; crossers[i].set_speed(speed);\n        i++;\n    }\n    ifs.close();\n\n    for (int i=0; i &lt; e; i++) eastCars.push_back(thread(carEast, crossers[i].get_time(), crossers[i].get_name(), crossers[i].get_speed())); //creating threads\n    for (int i=0; i &lt; p; i++) pedestrians.push_back(thread(pedestrian, crossers[i].get_time(), crossers[i].get_name(), crossers[i].get_speed()));\n    for (int i=0; i &lt; w; i++) westCars.push_back(thread(carWest, crossers[i].get_time(), crossers[i].get_name(), crossers[i].get_speed()));\n\n    for (thread&amp; t: eastCars) t.join();     // waiting for eastCars, westCars, and pedestrians to finish\n    for (thread&amp; t: pedestrians) t.join();\n    for (thread&amp; t: westCars) t.join();\n\n\n}\n\n\nvoid pedestrian(int time, string name, int speed) {\n    while(true){\n        if(name[0] == 'P' || name[0] == 'p'){\n            if(time == 0 || (east == 0 &amp;&amp; west == 0 &amp;&amp; peds == 0))\n                mtx.lock();\n                cout &lt;&lt; name &lt;&lt; \" entering construction\" &lt;&lt; endl;\n\n            while(peds&gt;0 || west&gt;0 || east&gt;0) \n                ped.wait(mtx);\n\n            peds++;\n            mtx.unlock();\n\n            sleep(10/speed);\n\n            cout &lt;&lt; name &lt;&lt; \" exiting construction\" &lt;&lt; endl;\n            mtx.lock();\n            peds--;\n            ped.notify_one();\n            cE.notify_all();\n            cW.notify_all();\n            mtx.unlock();\n        }\n    }\n}\n\nvoid carWest(int time, string name, int speed) {\n    while(true){\n        if(name[0] == 'W' || name[0] == 'w'){\n            if(time == 0 || (east == 0 &amp;&amp; west == 0 &amp;&amp; peds == 0))\n                mtx.lock();\n                cout &lt;&lt; name &lt;&lt; \" entering construction\" &lt;&lt; endl;\n\n            while(peds&gt;0 || west&gt;0 || east&gt;0) \n                cW.wait(mtx);\n\n            west++;\n            mtx.unlock();\n\n            sleep(100/speed);\n\n            cout &lt;&lt; name &lt;&lt; \" exiting construction\" &lt;&lt; endl;\n            mtx.lock();\n            west--;\n            cW.notify_one();\n            ped.notify_all();\n            cE.notify_all();\n            mtx.unlock();\n        }\n    }\n}\n\nvoid carEast(int time, string name, int speed) {\n    while(true){\n        if(name[0] == 'E' || name[0] == 'e'){\n            if(time == 0 || (east == 0 &amp;&amp; west == 0 &amp;&amp; peds == 0))\n                mtx.lock();\n                cout &lt;&lt; name &lt;&lt; \" entering construction\" &lt;&lt; endl;\n\n            while(peds&gt;0 || west&gt;0 || east&gt;0) \n                cE.wait(mtx);\n\n            east++;\n            mtx.unlock();\n\n            sleep(100/speed);\n\n            cout &lt;&lt; name &lt;&lt; \" exiting construction\" &lt;&lt; endl;\n            mtx.lock();\n            east--;\n            cE.notify_one();\n            cW.notify_all();\n            ped.notify_all();\n            mtx.unlock();\n        }\n    }\n}\n\nvoid sleep(int secs){\n  this_thread::sleep_for(chrono::milliseconds(rand()%secs*1000));\n}\n</code></pre>\n"},{"tags":["java","multithreading","process","executable-jar"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12883174,"title":"Accessing Threads of Another Java Application from main()","body":"<p>I want to run a JAR file from my own main(). Let's say I have an A class which has a <code>main()</code> method. The <code>main()</code> method of A will run a new <code>main()</code> method in another file B.jar.\nThis is how I run the B.jar file from <code>main()</code> method of A.jar: <a href=\"http://stackoverflow.com/questions/1320476/execute-another-jar-in-a-java-program\">here</a>.</p>\n\n<p>The problem is that I do not have access to the B.jar Java source code. What I need to know is how many threads are running in the B.jar <code>main()</code> method.</p>\n\n<p>There was another discussion here about getting the list of all Threads running in a Java application <a href=\"http://stackoverflow.com/questions/1323408/get-a-list-of-all-threads-currently-running-in-java\">here</a>.</p>\n\n<p>Now what I need is a list of the threads which are spawned by B.jar. Or at least an array of the Thread IDs.</p>\n"},{"tags":["java","multithreading","tomcat","stop"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":385,"score":4,"question_id":8680465,"title":"Should threads have special design to be shutdown gracefully by Tomcat?","body":"<p>I have developed a multithreaded web application that runs in Tomcat.\nBut I cannot use </p>\n\n<pre><code>shutdown.bat\n</code></pre>\n\n<p>Tomcat didn't stop gracefully. In the debugger I saw that threads continue to run after shutdown command. Do I have to fix my application code to meet special requirements ?\nThanks.</p>\n"}]}
{"total":30059,"page":14,"pagesize":100,"questions":[{"tags":["c","multithreading","pthreads","pthread-join"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12887214,"title":"pthread_exit issues returning struct","body":"<p>I have a struct</p>\n\n<pre><code>typedef struct something_t {\n    int a;\n    int b;\n} VALUES;\n</code></pre>\n\n<p>In my thread function I do</p>\n\n<pre><code>VALUES values;\nvalues.a = 10;\nvalues.b = 11;\n\npthread_exit((void*)&amp;values);\n</code></pre>\n\n<p>And I try to receive by doing</p>\n\n<pre><code>VALUES values;\npthread_join(thread, (void*)&amp;values);\nprintf(\"A: %d\\B: %d\\n\", values.a, values.b);\n</code></pre>\n\n<p>The values I receive are weird every time.\nI am confused about how to receive the values that I end up creating in the thread. I am trying to learn threads in C and seems like I have grasped it, but I can't return values. Is there a way? Thanks to anyone for their help.</p>\n"},{"tags":["c","multithreading","operating-system","critical-section"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":105,"score":-1,"question_id":12886767,"title":"How do I detect critical sections in a C program by analyzing it programmatically?","body":"<p>I want to create a tool which analyzes a C program for critical sections during the compilation phase. I am looking for the right algorithm which would let me do this. It can be at any phase of the compiler. </p>\n"},{"tags":["python","multithreading","for-loop","queue","python-2.6"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":120,"score":3,"question_id":12868956,"title":"Python - Using threads or a queue to iterate over a for loop that calls a function","body":"<p>I'm fairly new to python and am making a script that allows one to bring point cloud data from other programs into Autodesk Maya. I have my script functioning fine but what i'm trying to do is make it faster. I have a for loop that iterates through a list of numbered files. I.e. datafile001.txt, datafile002.txt and so on. Is what i'm wondering is if there is a way to have it to do more then one at a time, possibly using threads or a queue? Below I have the code i have been working on:</p>\n\n<pre><code>     def threadedFuntion(args):\n         if len(sourceFiles) &gt; 3:\n             for count, item in enumerate(sourceFiles):\n                     t1=Thread(target=convertPcToPdc,args=(sourceFiles[filenumber1], particlesName, startframe, endframe, pdcIncrements, outputDirectory, variableFolder, acceptableArrayforms, dataType))\n                     t1.start()\n                     t2=Thread(target=convertPcToPdc,args=(sourceFiles[filenumber2], particlesName, startframe, endframe, pdcIncrements, outputDirectory, variableFolder, acceptableArrayforms, dataType))\n                     t2.start()\n                     t3=Thread(target=convertPcToPdc,args=(sourceFiles[filenumber3], particlesName, startframe, endframe, pdcIncrements, outputDirectory, variableFolder, acceptableArrayforms, dataType))\n                     t3.start()\n                     t4=Thread(target=convertPcToPdc,args=(sourceFiles[filenumber4], particlesName, startframe, endframe, pdcIncrements, outputDirectory, variableFolder, acceptableArrayforms, dataType))\n                     t4.start()\n</code></pre>\n\n<p>This obviously doesn't work for a number of reasons, first it only will create 4 threads, I would like to be able to give an option for more or less. Second it errors because it's trying to reuse a thread? Like I said i'm quite new to python and am a little over my head, I've been reading several posts on here but can't get one to work quite right. I think a queue might be something I need but couldn't quite figure it out, I experimented with the condition statement and with the join statement, but once again couldn't get what I want.</p>\n\n<p>I guess to be more specific what I want to achieve is that the function is reading through a text file, retrieving coords and then exporting them as a binary file for maya to read. It's common for one of these text files to have 5-10 million x,y,z coords which takes quite some time. It takes around 30mins-1hour to do 1 file on a pretty beastly computer, task manager says python is only using 12% processor and around 1% ram, so if I could do multiple of these at once, it would make doing those 100 or more files go by a lot faster. I wouldn't think it would be to hard to multithread/queue up a for loop, but I've been lost and trying failing solutions for about a week.</p>\n\n<p>Thank you all for any help, I really appreciate it and think this website is amazing. This is my first post, but I feel like I have completely learned python just from reading on here.</p>\n"},{"tags":["java","android","multithreading","web-services","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12886408,"title":"Exception in AsyncTask due to enormous number of data","body":"<p>I am connecting from my Android app to a RESTful Web Service in Java. I am using AsyncTask to fetch the data. It works perfectly for normal amount of data. but when I have a huge amount of data, an Exception happens in the Android app. I tried to catch this exception, but I couldn't:</p>\n\n<pre><code>private class LoadingDataFromServer extends AsyncTask&lt;Void, Void, Void&gt; {\n\n        private boolean outOfMemory = false;\n\n        @Override\n        public void onPreExecute() {\n            progress = ProgressDialog.show(main_activity, null,\"Loading ...\", true);\n        }\n\n        @Override\n        protected void onPostExecute(Void result) {\n            if(outOfMemory) {\n                Toast.makeText(StatisticActivity.this, \"Out of memory, select smaller criteria\", Toast.LENGTH_SHORT).show();\n                finish();\n            }\n            else\n                setListView();\n            try {\n                progress.dismiss();\n            } catch (Exception e) { }\n        }\n\n        @Override\n        protected Void doInBackground(Void... params) {\n            TextView txtProject = (TextView) main_activity.findViewById(R.id.project);\n            txtProject.setBackgroundColor(Color.DKGRAY);\n            txtProject.setText(project);\n\n            TextView label = (TextView) main_activity.findViewById(R.id.label);\n            label.setText(R.string.deliverable);\n            try {\n            loadStatistic();\n            } catch (OutOfMemoryError e) {\n                outOfMemory = true;\n                progress.dismiss();\n            } catch (RuntimeException e) {\n                outOfMemory = true;\n                progress.dismiss();\n            } catch (Exception e) {\n                outOfMemory = true;\n                progress.dismiss();\n            }\n            return null;\n        }\n    }\n</code></pre>\n\n<p>This is the error I got:</p>\n\n<pre><code>10-14 22:24:10.952: ERROR/AndroidRuntime(4179): Uncaught handler: thread AsyncTask #3 exiting due to uncaught exception\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179): java.lang.RuntimeException: An error occured while executing doInBackground()\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at android.os.AsyncTask$3.done(AsyncTask.java:200)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.FutureTask$Sync.innerSetException(FutureTask.java:273)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.FutureTask.setException(FutureTask.java:124)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:307)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.FutureTask.run(FutureTask.java:137)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1068)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:561)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.lang.Thread.run(Thread.java:1102)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179): Caused by: java.lang.RuntimeException: Can't create handler inside thread that has not called Looper.prepare()\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at android.os.Handler.&lt;init&gt;(Handler.java:121)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at android.widget.Toast.&lt;init&gt;(Toast.java:68)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at android.widget.Toast.makeText(Toast.java:231)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at se.softwerk.timelog.statistic.StatisticActivity$LoadingDataFromServer.doInBackground(StatisticActivity.java:301)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at se.softwerk.timelog.statistic.StatisticActivity$LoadingDataFromServer.doInBackground(StatisticActivity.java:1)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at android.os.AsyncTask$2.call(AsyncTask.java:185)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)\n10-14 22:24:10.962: ERROR/AndroidRuntime(4179):     ... 4 more\n</code></pre>\n\n<p>The exception is happening in <code>doInBackground</code>, but my exception handeling did not work. Can you help me?</p>\n"},{"tags":["python","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":146,"score":0,"question_id":12886361,"title":"error: [Errno 9] Bad file descriptor in Python","body":"<p>I am doing a server snippet with an error:</p>\n\n<pre><code>Exception in thread Thread-1:  \nTraceback (most recent call last):\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/threading.py\", line 551, in __bootstrap_inner\n    self.run()\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/threading.py\", line 504, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/Users/Sean/Downloads/Project/Project/wbs.py\", line 45, in JTServer\n    Client_socket.send(\"HTTP/1.1 404 Not Found\\r\\n\\r\\n\")\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/socket.py\", line 170, in _dummy\n    raise error(EBADF, 'Bad file descriptor')\nerror: [Errno 9] Bad file descriptor\n</code></pre>\n\n<p>Here's the code: -</p>\n\n<pre><code># Import modules\nimport socket\nimport threading\nencoding = \"utf-8\"\ndef JTServer(Client_socket, addr):\n    # Server should be up and running and listening to the incoming connections\n    while True:\n        print 'Sever is open![by Jing Tao]'\n        print 'Got connected from',addr,'[by Jing Tao]'\n        print Client_socket\n        print addr\n        # If an exception occurs during the execution of try clause\n        # the rest of the clause is skipped\n        # If the exception type matches the word after except\n        # the except clause is executed\n        try:\n            # Receives the request message from the client using the recv method\n            Request=Client_socket.recv(1024)\n            print Request\n            print 'This is a GET method'\n            print 'Receives the request message succeed![by Jing Tao]'\n            # Extract the path of the requested object from the message. The path is the second part of HTTP header\n            data=Request.split()[1]\n            path=data.lstrip(\"//\")\n            print 'Extract the path succeed![by Jing Tao]'\n            # Open and read the corresponding file\n            f=file(path,'rb')\n\n            # Store the entire contenet of the requested file in a temporary buffer\n            list_lines=f.readlines()\n            f.close()\n            lines=\"\\n\".join(str(x) for x in list_lines)\n            # Send the HTTP response header line to the connection socket\n            Client_socket.send(\"HTTP/1.1 200 OK\\r\\n\\r\\n\")\n            # Send the content of the requested file to the  connection socket\n            Client_socket.send(lines)\n            print 'This is a POST method'\n            # Close the client connection socket\n            Client_socket.close()\n            print 'close'\n        except IOError:\n            # Send HTTP response message for file not found\n            Client_socket.send(\"HTTP/1.1 404 Not Found\\r\\n\\r\\n\")\n            # Close the client connection socket\n            Client_socket.close()\n# Create a TCP server socket\n#(AF_INET is used for IPv4 protocols)\n#(SOCK_STREAM is used for TCP)\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n# Assign a port number\nhost = '127.0.0.1'\nport = 8084\n# Bind the socket to server address and server port\ns.bind((host, port))\n# Listen to connections\ns.listen(1)\nwhile True:\n    # Set up a new connection from the client\n    client , addr = s.accept()    \n    # Start a new thread and communicate with a new client\n    thread = threading.Thread(target = JTServer, args = (client, addr))\n    thread.start()\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","executorservice"],"answer_count":3,"favorite_count":6,"up_vote_count":12,"down_vote_count":0,"view_count":7472,"score":12,"question_id":2758612,"title":"ExecutorService that interrupts tasks after a timeout","body":"<p>I'm looking for an <a href=\"http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ExecutorService.html\" rel=\"nofollow\">ExecutorService</a> implementation that can be provided with a timeout. Tasks that are submitted to the ExecutorService are interrupted if they take longer than the timeout to run. Implementing such a beast isn't such a difficult task, but I'm wondering if anybody knows of an existing implementation.</p>\n\n<p>Here's what I came up with based on some of the discussion below. Any comments?</p>\n\n<pre><code>import java.util.List;\nimport java.util.concurrent.*;\n\npublic class TimeoutThreadPoolExecutor extends ThreadPoolExecutor {\n    private final long timeout;\n    private final TimeUnit timeoutUnit;\n\n    private final ScheduledExecutorService timeoutExecutor = Executors.newSingleThreadScheduledExecutor();\n    private final ConcurrentMap&lt;Runnable, ScheduledFuture&gt; runningTasks = new ConcurrentHashMap&lt;Runnable, ScheduledFuture&gt;();\n\n    public TimeoutThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, long timeout, TimeUnit timeoutUnit) {\n        super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);\n        this.timeout = timeout;\n        this.timeoutUnit = timeoutUnit;\n    }\n\n    public TimeoutThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, long timeout, TimeUnit timeoutUnit) {\n        super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory);\n        this.timeout = timeout;\n        this.timeoutUnit = timeoutUnit;\n    }\n\n    public TimeoutThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler, long timeout, TimeUnit timeoutUnit) {\n        super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, handler);\n        this.timeout = timeout;\n        this.timeoutUnit = timeoutUnit;\n    }\n\n    public TimeoutThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler, long timeout, TimeUnit timeoutUnit) {\n        super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler);\n        this.timeout = timeout;\n        this.timeoutUnit = timeoutUnit;\n    }\n\n    @Override\n    public void shutdown() {\n        timeoutExecutor.shutdown();\n        super.shutdown();\n    }\n\n    @Override\n    public List&lt;Runnable&gt; shutdownNow() {\n        timeoutExecutor.shutdownNow();\n        return super.shutdownNow();\n    }\n\n    @Override\n    protected void beforeExecute(Thread t, Runnable r) {\n        if(timeout &gt; 0) {\n            final ScheduledFuture&lt;?&gt; scheduled = timeoutExecutor.schedule(new TimeoutTask(t), timeout, timeoutUnit);\n            runningTasks.put(r, scheduled);\n        }\n    }\n\n    @Override\n    protected void afterExecute(Runnable r, Throwable t) {\n        ScheduledFuture timeoutTask = runningTasks.remove(r);\n        if(timeoutTask != null) {\n            timeoutTask.cancel(false);\n        }\n    }\n\n    class TimeoutTask implements Runnable {\n        private final Thread thread;\n\n        public TimeoutTask(Thread thread) {\n            this.thread = thread;\n        }\n\n        @Override\n        public void run() {\n            thread.interrupt();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c++","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12885635,"title":"Multithreaded Server in c++ : Memory leakage","body":"<p>I am writing a multithreaded server in c++(linux). My problem is that my code runs fine for initial few requests but after that it shows \"free:Invalid pointer\". I know this error can come from any part of my code but for the below snippet I want to know suggestions if I am going on right track.</p>\n\n<p>// This is helper function used in pthread_create</p>\n\n<pre><code>void *Parse::serveRequest_helper(void *c)\n{\n\n  Parse *P1 =(Parse *)c;\n  P1-&gt;serveRequest();\n}\n</code></pre>\n\n<p>// On this function 10 threads are continously working</p>\n\n<pre><code>void Parse::serveRequest()\n{\n  pthread_detach(pthread_self());\n  while(1)\n   {\n       pthread_mutex_lock(&amp;print_lock);\n       if(requestqueue.empty())\n          pthread_cond_wait(&amp;print_cond, &amp;print_lock);\n       SendData *S = new SendData;\n       clientInfo c;\n       cout&lt;&lt;\"Inside Serving thread\"&lt;&lt;endl;\n       c = requestqueue.front(); //assuming this queue has data coming from   some other scheduler thread function \n       requestqueue.pop();\n       S-&gt;requestPrint(c);\n       delete S;\n       pthread_mutex_unlock(&amp;print_lock);\n           cout&lt;&lt;\" Inside Thread is out\"&lt;&lt;endl;\n   }\n }\n</code></pre>\n\n<p>// Below function I am using to write data of the file to socket.</p>\n\n<p>// When a thread will handle this function, the file pointer will be local to the thread or for all 10 threads it will be global .. ?</p>\n\n<pre><code>void SendData::requestPrint(clientInfo c)\n{\n\nif (write(c.accept,\"Requested File Data :\", 21) == -1)\n            perror(\"send\");\nifstream file;\nfile.open(c.filename.c_str());\nif (file.is_open())\n{\n      string read;\n      while (!file.eof() )\n      {\n          getline(file,read);\n          if (write(c.accept, read.c_str(), (size_t)read.size()) == -1)\n              perror(\"send\");\n\n      }\n\n}\nfile.close();\nclose(c.accept);\n}\n</code></pre>\n"},{"tags":["multithreading","gcc","compiler"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":29,"score":-1,"question_id":12885460,"title":"Critical section Detection","body":"<p>For example in a multi-threaded program, Global, volatile, extern variables, can come under critical section as they can be accessed by multiple threads at once. Also shmget() allocates shared memory. I'd like to know what all other memory types can be critical sections in both user space and kernel space.</p>\n"},{"tags":["android","multithreading","animation","view"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12885128,"title":"Android Custom View with Handler","body":"<p>I am looking for an easy way to animate custom views in Android. I am trying to avoid using the animator object but want to work with raw threads. What I have done is created a custom view by creating a class that <strong>extends</strong> android.view.View. I then override the <strong>onDraw</strong> method and use the canvas to draw a rect. What I would like is the rect to shrink, so I keep a variable that represents the x value of the right hand side of the rectangle. I would then like the the rectangle's right edge shrink in over time. What I would have liked to do is create a new thread, start it and have it change the value of the rectangle. That all works except the view doesn't get updated until you call <strong>View.invalidate</strong>. The problem is that I can't call that from the thread that I spawned because it is not the UI thread. I read solutions on using Handlers... but I am still unsure if that is the correct solution and then how to use them.</p>\n\n<pre><code>package com.example.practicum;\n\nimport android.content.Context;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Paint;\nimport android.graphics.Rect;\nimport android.os.Handler;\nimport android.os.Message;\nimport android.util.AttributeSet;\nimport android.view.View;\n\npublic class TimerControl extends View implements Runnable, Handler.Callback\n{\n    private Paint paint;\n    private Rect rect;\n    private Thread t;\n    private Handler h;\n\n    public TimerControl(Context context, AttributeSet attrs)\n    {\n        super(context, attrs);\n        // TODO Auto-generated constructor stub\n\n\n\n        paint = new Paint();\n        paint.setColor(Color.BLUE);\n        rect = new Rect(0,0,60,60);\n        t = new Thread(this);\n        t.start();\n\n\n        h = new Handler(this);\n        //h.post(this);\n    }\n\n    @Override\n    public void onDraw(Canvas canvas)\n    {\n        canvas.drawRect(rect, paint);\n    }\n\n    @Override\n    public void run()\n    {\n        rect.right = rect.right-1;\n        while(true)\n        {\n            rect.right = rect.right-1;\n            this.invalidate();\n            try\n            {\n                Thread.sleep(5000);\n                h.sendEmptyMessage(0);\n            } \n            catch (InterruptedException e)\n            {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }\n    }\n\n    @Override\n    public boolean handleMessage(Message msg)\n    {\n\n        return false;\n    }\n\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":99,"score":1,"question_id":12884488,"title":"How to create a thread that waits for a boolean variable to become true?","body":"<p>I have a function that needs to be called once a boolean variable is true. I tried using a while loop in a thread but it doesn't work. Here is what I've tried:</p>\n\n<pre><code>public class MyRunnable implements Runnable {\n\npublic void run() {\n    while (true) {\n         if (conditions == true) { \n             System.out.println(\"second\");\n             break;\n         }\n    }\n}\n\npublic static void main(String args[]) {\n    boolean condition = false;\n    (new Thread(new MyRunnable())).start();\n    System.out.println(\"first\\n\");\n    // set conndition to true\n    condition = true;\n\n    }\n\n}\n</code></pre>\n\n<p>The result shoud be:</p>\n\n<pre><code>first\nsecond\n</code></pre>\n"},{"tags":["c","multithreading","operating-system"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":75,"score":-1,"question_id":12883722,"title":"What are the different types of memories which can come under shared memory?","body":"<p>For example in a multi-threaded program, Global, volatile, extern variables, can come under critical section as they can be accessed by multiple threads at once. \nAlso shmget() allocates shared memory.\nI'd like to know what all other memory types can be critical sections in both user space and kernel space.</p>\n"},{"tags":["java","android","multithreading","http","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12884800,"title":"Asynctask with network operation and another Asynctask task issue","body":"<p>The problem I have is concerning two separate Asynctask classes. The first asynctask uses a network operation in doInBackground method</p>\n\n<p>HttpResponse httpResponse = httpClient.execute(httpPost);</p>\n\n<p>while the other is a thread for loading images with a progressDialog.</p>\n\n<p>so what happens is if I am using a slow internet connection (so that means the first asynctask hasn't finished yet) and then go directly to the second asynctask, the second class will wait until the first one is finished.</p>\n\n<p>btw, right after I call the first asynctask I directly finish the activity and call another one does this have to do with anything?</p>\n\n<p>tl;dr version:</p>\n\n<p>second asynctask won't do the doinbackground process until the first asynctask is done</p>\n\n<p>I know this because the progress dialog is shown for a long time (which I show it in preExecute and dismiss it in postexecute)</p>\n\n<p>EDIT:</p>\n\n<p>the first asynctask involves waiting for a response from the net. so while there isn't a response the second asynctask won't do its doinbackground process.</p>\n\n<p>EDIT 2:</p>\n\n<p>Is there a way for me to properly use these 2 asynctask so the second one won't have to wait for the first to finish? </p>\n"},{"tags":["android","json","multithreading","widget"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12885066,"title":"Update two separated widgets from AsyncTask","body":"<p>What i want:\nWhen the user add a widget an alarmmanger starts to update the added widget.\nThe widget takes the data from internet (json resource).\nThe widget uses a dedicated json page (each widget has a page where take the data: eg. test.json?page=5)</p>\n\n<p>I already have a class that extends AppWidgetProvider.\nIn this class there is a function: <code>private void updateAppWidget(Context context,  AppWidgetManager appWidgetManager,   int appWidgetId)</code>\ninside this function there is:</p>\n\n<pre><code>remoteViews = new RemoteViews(context.getPackageName(),  R.layout.widget);\nnew HttpRequestTask(SELECTED_PAGE).execute(remoteViews);\n</code></pre>\n\n<p>This is HttpRequestTask class:</p>\n\n<pre><code> class HttpRequestTask extends AsyncTask&lt;RemoteViews, Void, String&gt; {\n\n        private RemoteViews rv;\n        private String url;\n\n        public HttpRequestTask(String string) {\n            url = string;\n        }\n\n        protected String doInBackground(RemoteViews... contextParam) {\n            String html = \"\";\n            try {\n                rv = contextParam[0];\n                HttpClient client = new DefaultHttpClient();\n                HttpGet request \n\n= new HttpGet(\"http://www.hwlogos.com/\"+url+\".txt\");\n            HttpResponse response;      \n            response = client.execute(request);     \n\n            InputStream in = response.getEntity().getContent();\n            BufferedReader reader = new BufferedReader(new InputStreamReader(in));\n            StringBuilder str = new StringBuilder();\n            String line = null;\n            while((line = reader.readLine()) != null)\n            {\n                str.append(line);\n            }\n            in.close();\n            html = str.toString();\n\n        } catch (ClientProtocolException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n\n        return html;\n     }\n\n     protected void onPostExecute(String html) {\n         rv.setTextViewText(R.id.ip, html);\n     }\n}\n</code></pre>\n\n<p>The problem is that the text doesn't update!</p>\n"},{"tags":["android","json","multithreading","httprequest","jelly-bean"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12874099,"title":"Unable to start receiver: android.os.NetworkOnMainThreadException with android JellyBean","body":"<p>I'm trying to develop a widget that updates itself every minute by a json resource, my problem is that when i try to launch it on jellybean it crashes, while with gingerbread works.</p>\n\n<p>I saw <a href=\"http://stackoverflow.com/questions/11347754/how-to-avoid-networkonmainthread-exception-without-using-asynctask\">here</a> that i must move all internet connection to the main thread, right?\nAt the moment i've a class called HttpRequest:</p>\n\n<pre><code>public class HttpRequest {    \n    private String url;\n\n    public HttpRequest(String url)\n    {       \n        this.url = url;\n    }\n\n    public String GetContent() throws ClientProtocolException, IOException\n    {\n        HttpClient client = new DefaultHttpClient();\n        HttpGet request = new HttpGet(url);\n        HttpResponse response = client.execute(request);\n\n        String html = \"\";\n        InputStream in = response.getEntity().getContent();\n        BufferedReader reader = new BufferedReader(new InputStreamReader(in));\n        StringBuilder str = new StringBuilder();\n        String line = null;\n        while((line = reader.readLine()) != null)\n        {\n            str.append(line);\n        }\n        in.close();\n        html = str.toString();\n        return html;\n    }\n}\n</code></pre>\n\n<p>Every minute is called updateAppWidget() that is a method of WidgetProvider class.\nInside updateAppWidget() there is:</p>\n\n<pre><code>HttpRequest r = new HttpRequest(\"http://www.hwlogos.com/test.json\");\nremoteViews.setTextViewText(R.id.ip, r.GetContent());\n</code></pre>\n\n<p>Can you tell me how solve it steep by steep? \nthanks</p>\n"},{"tags":["c","multithreading","tcp","client-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12883836,"title":"String with thread in tcp client / server in C","body":"<p>I'm trying to develop an application in C to receive a message and send it in TCP. For that, I'm using a 2 threads : the server thread to listen and a client thread to send it.</p>\n\n<p>Here the server and the main function :</p>\n\n<pre><code>void dostuff(int sock)\n{\n  int n;\n  char buffer[256];\n\n  bzero(buffer,256);\n  n = read(sock,buffer,255);\n\n  if (n &lt; 0) error(\"ERROR reading from socket\");\n  else {\n    pthread_t t_tcp_client;\n    pthread_create(&amp;t_tcp_client, NULL, tcp_client, buffer);\n  }\n\n  n = write(sock,\"Message received\",18);\n\n  if (n &lt; 0) error(\"ERROR writing to socket\");\n}\n\nstatic void *tcp_server(void *p_data)\n{\n  int sockfd, newsockfd, pid;\n  socklen_t clilen;\n  struct sockaddr_in serv_addr, cli_addr;\n\n  sockfd = socket(AF_INET, SOCK_STREAM, 0);\n\n  if (sockfd &lt; 0) error(\"ERROR opening socket\");\n\n  bzero((char *) &amp;serv_addr, sizeof(serv_addr));\n  serv_addr.sin_family = AF_INET;\n  serv_addr.sin_addr.s_addr = INADDR_ANY;\n  serv_addr.sin_port = htons(TCP_PORT);\n\n  if (bind(sockfd, (struct sockaddr *) &amp;serv_addr, sizeof(serv_addr)) &lt; 0) error(\"ERROR on binding\");\n\n  listen(sockfd,5);\n  clilen = sizeof(cli_addr);\n\n  while (1) {\n    newsockfd = accept(sockfd, (struct sockaddr *) &amp;cli_addr, &amp;clilen);\n\n    if (newsockfd &lt; 0) error(\"ERROR on accept\");\n\n    pid = fork();\n\n    if (pid &lt; 0) error(\"ERROR on fork\");\n\n    if (pid == 0) {\n      close(sockfd);\n      dostuff(newsockfd);\n      exit(0);\n    } else {\n      close(newsockfd);\n    }\n  }\n  close(sockfd);\n  return 0;\n}\n\n\nint main (void)\n{\n  pthread_t t_tcp_server;\n  pthread_create(&amp;t_tcp_server, NULL, tcp_server, NULL);\n\n  pthread_join(t_tcp_server, NULL);\n\n  return 0;\n}\n</code></pre>\n\n<p>And the client thread :</p>\n\n<pre><code>static void *tcp_client(void *p_data)\n{\n  if (p_data != NULL)\n  {\n    char const *message = p_data;\n\n    printf(\"Message transmitted : %s\\n\", message);\n  }\n\n  return 0;\n}\n</code></pre>\n\n<p>The problem is that the client thread doesn't receive the good char, the result is :</p>\n\n<p>Message transmitted : ???~?</p>\n\n<p>I think the problem comes from the line : n = read(sock,buffer,255); but I don't really understand why.</p>\n\n<p>Thank you for your help</p>\n"},{"tags":["c","multithreading","stack","solaris","call"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3059,"score":2,"question_id":1310669,"title":"Get call stack from any thread within C","body":"<p>In C on Solaris 10, I'd like to get the call stack from an arbitrary thread within a process.</p>\n\n<p>I have many worker threads and one thread which monitors them all to detect tight loops and deadlocks.  The function I'd like to implement is for the monitoring thread to print the call stack from the \"hung\" thread several times before it kills it.</p>\n\n<p>I know how to implement this by having the monitoring thread execute pstack (with system() or by forking).  But I would like to be able to implement this function in C.  Is there any way to do this?</p>\n\n<p>I know how to make a thread print its OWN call stack, by walking the stack, which is useful if it hits an assert, but not how to do this for another thread within the same process.</p>\n\n<p>Thanks for any help.\nNickB</p>\n"},{"tags":["iphone","cocoa-touch","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3165,"score":0,"question_id":490902,"title":"How to put only one thread to sleep?","body":"<p>I want to create two threads in my game. One thread is for timer and other for touch events. Because when I am running my game on iPhone, timer conflicts with touch events and touch events are not reported. It works smooth in simulator but on iPhone or on iPod Touch it's becomes very slow. So I'm using separate threads for touch events and timer.</p>\n\n<p>When I use <code>[NSThread sleepForTimeInterval:0.01]</code> it makes all threads sleep. I mean touch events are also stop to come through. I want to stop the timer thread only.</p>\n\n<p>This is my code:</p>\n\n<pre><code>-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event\n{\n    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n\n    BOOL Done = NO;\n    while (!Done)\n    {\n        NSAutoreleasePool *loopPool = [[NSAutoreleasePool alloc] init];\n        [NSThread sleepForTimeInterval:0.01];\n        [self performSelectorOnMainThread:@selector(callTapCode) withObject:tapView waitUntilDone:YES];\n\n        //performSelectorOnMainThread:@selector(callTapCode) withObject:nil waitUntilDone:YES];\n\n        [loopPool release];\n        Done=YES;\n    }\n\n    [pool drain];\n}\n</code></pre>\n"},{"tags":["multithreading","unix","coredump"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":310,"score":2,"question_id":2499815,"title":"Core dump of a multithreaded program","body":"<p>i have regularly worked with single threaded programs.\ni never saw a multithreded program crashing since i havent worked on any.</p>\n\n<p>is there any difference between both the core dumps?\nis there any additional information provided in the core dump of a multithreaded program when compared to a single threaded program?</p>\n"},{"tags":["java","multithreading","javafx-2","scenebuilder"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12878208,"title":"JavaFx Answer to EDT?","body":"<p>I asked  a question  about using threads in GUI and got the following response: </p>\n\n<blockquote>\n  <p>You have to rework your program.</p>\n  \n  <ol>\n  <li>GUI elements should be updated from within the GUI thread (EDT)\n  only, not from a standalone thread.</li>\n  <li>Client connection should be divided in 2 weakly connected parts:\n  sending messages and receiving them. Receiving should be a separate\n  thread, and sending can be a thread or a class.</li>\n  <li>When the receiving thread have read a message, it sends it to EDT\n  using SwingUtilities.invokeLater(Runnable). Examples can be found\n  elsewhere.</li>\n  <li>When user have entered text, the text is send to the socket\n  directly, or enqueued in a queue and later processed by the sending\n  thread, if any.</li>\n  </ol>\n</blockquote>\n\n<p>What i want to know is what is the JavaFx response to EDT and could anyone give an example of how to use it?</p>\n\n<p>My first post can be found at this link <a href=\"http://stackoverflow.com/questions/12872918/server-client-program-stops-working-after-thread-starts\">Server / client program stops working after Thread starts</a></p>\n\n<ul>\n<li>Note if it matters I've build my GUI in javaFx Scene builder.</li>\n</ul>\n"},{"tags":["iphone","cocoa-touch","multithreading"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1668,"score":1,"question_id":345772,"title":"Is there any sample code to do iPhone mulitithreading tasks?","body":"<p>I have some slow internet task to save and load file, I'd like to do those slow tasks in some background thread. I am wondering whether that's doable, and if it is, any sample code?</p>\n\n<p>Then after it is finished, I'd like it to notice back to the main thread, so that I could update the UI.</p>\n"},{"tags":["java","multithreading","netty","apache-camel"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12866403,"title":"Logic behind camel ServicePool when used with Netty","body":"<p>I have a camel instance with a Netty endpoint that consolidates many incoming requests to send to a single receiver.  More specifically, this is a web service whereby each incoming SOAP request results in a <code>Producer.sendBody()</code> into the camel subsystem.  The processing of each request involves different routes, but they will all end up in the single Netty endpoint to send on to the next-level server.  All is fine, as long as I only have a handful of incoming requests at any one time.  If I start having more than 100 simultaneous requests, though, I get this exception:</p>\n\n<pre><code>java.lang.IllegalStateException: Queue full\n    at java.util.AbstractQueue.add(AbstractQueue.java:71) ~[na:1.6.0_24]\n    at java.util.concurrent.ArrayBlockingQueue.add(ArrayBlockingQueue.java:209) [na:1.6.0_24]\n    at org.apache.camel.impl.DefaultServicePool.release(DefaultServicePool.java:95) [camel-core-2.9.2.jar:2.9.2]\n    at org.apache.camel.impl.ProducerCache$1.done(ProducerCache.java:297) ~[camel-core-2.9.2.jar:2.9.2]\n    at org.apache.camel.processor.SendProcessor$2$1.done(SendProcessor.java:120) ~[camel-core-2.9.2.jar:2.9.2]\n    at org.apache.camel.component.netty.handlers.ClientChannelHandler.messageReceived(ClientChannelHandler.java:162) ~[camel-netty-2.9.2.jar:2.9.2]\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) ~[netty-3.3.1.Final.jar:na]\n</code></pre>\n\n<p>This is coming from the <code>DefaultServicePool</code> that's used by the Netty component.  The <code>DefaultServicePool</code> uses an <code>ArrayBlockingQueue</code> as the backend to the queue and it sets it to a default capacity of 100 Producers.  It uses a service pool for performance reasons, to avoid having to keep creating and destroying often-reused producers.  Fair enough.  Unfortunately, I'm not getting the logic on how it is implemented.</p>\n\n<p>This all starts in <code>ProducerCache::doInAsyncProducer</code>, which starts off by calling <code>doGetProducer</code>.  Said method attempts to <code>acquire</code> a Producer from the pool and, if that fails, it creates a new Producer using <code>endpoint.getProducer()</code>.  It then makes sure that the service pool exists using <code>pool.addAndAcquire</code>.  That done, it returns to the calling function.  The <code>doInAsyncProducer</code> does its thing until it's finished, in which case it calls the <code>done</code> processor.  At this point, we're completely done processing the exchange, so it releases the Producer back to the pool using <code>pool.release</code></p>\n\n<p>Here is where the rubber hits the road.  The <code>DefaultServicePool::release</code> method inserts the Producer into the <code>ArrayBlockingQueue</code> backend using an <code>add</code>.  This is where my <code>java.lan.IllegalStateException</code> is coming from.</p>\n\n<p>Why?  Well, let's look through a use case.  I have 101 simultaneous incoming requests.  Each of them hits the Netty endpoint at roughly the same time.  The very first creates the service pool with the capacity of 100 but it's empty to start.  In fact, each of the 101 requests will create a new Producer from the <code>endpoint.getProducer</code>; each will verify that they don't exceed the capacity of the service pool (which is empty); and each will continue on to send to the server.  After each finishes, it tries to do a <code>pool.release</code>.  The first 100 will succeed, since the pool capacity hasn't been reached.  The 101st request will attempt to add to the queue and will fail, since the queue is full!</p>\n\n<p>Is that right?  If I'm reading that correctly, then this code will always fail whenever there are more than 100 simultaneous requests.  My service needs to support upwards of 10,000 simultaneous requests, so that's just not going to fly.</p>\n\n<p>It seems like a more stable solution might be to:</p>\n\n<ol>\n<li>Pre-allocate all 100 Producers on initialization</li>\n<li>Block during <code>acquire</code> until a Producer is available</li>\n<li>Absolutely do not create your own non-pool Producers if using a ServicePool</li>\n</ol>\n\n<p>In the meantime, I'm thinking of throttling incoming requests.</p>\n\n<p>What I'm hoping for with this question is to learn if I'm reading that logic correctly and to see if it can get changed.  Or, am I using it wrong?  Is there a better way to handle this type of thing?</p>\n"},{"tags":["c#","multithreading","object","com","call"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":61,"score":-2,"question_id":12842312,"title":"Refer to COM object in the worker thread in C#","body":"<p>I have a COM object SerInterface objCANinterface; which is created in VC++ 6.0 ATL\nwhich i was able to successfully call the methods from my C# GUI.(ThreadingModel is Both when checked in registry)</p>\n\n<p>But i have created a thread which has to use this object opened inside this thread to continues the process.</p>\n\n<p>so i have added the following statements in my constructor class as</p>\n\n<pre><code>public MyClass()\n        {\n // Start the thread with a ParameterizedThreadStart.\n            ParameterizedThreadStart start = new ParameterizedThreadStart(callBackLoad);\n            threadFlash = new Thread(start);\n            threadFlash.SetApartmentState(ApartmentState.STA);\n...\n}\n\nvoid myFun()\n{\n    threadFlash.Start(objCANinterface);\n   threadFlash.Join(); //Wai\n}\n\n[STAThread]\npublic void callBackLoad(object refinterface)\n{\n//I am not able to access objCANinterface inside my thread so i have passed the object as a parameter and trying to cast \n SerInterface objSrinterface = (SerInterface)refinterface;\n}\n</code></pre>\n\n<p>This is not successful Could you please let us know how do i solve this issue. I am getting the following error</p>\n\n<p>An unhandled exception of type 'System.InvalidCastException' occurred in MyClass.exe</p>\n\n<p>Additional information: Unable to cast COM object of type 'System.__ComObject' to interface type 'MYINTERFACELib.SerInterface'. This operation failed because the QueryInterface call on the COM component for the interface with IID '{37C34F3C-0082-46F5-9974-37CEB2E1C2EE}' failed due to the following error: Error loading type library/DLL. (Exception from HRESULT: 0x80029C4A (TYPE_E_CANTLOADLIBRARY)).</p>\n\n<p>Please let me know how to solve this issue. Thanks in advance.</p>\n\n<p>@ oberfreak.........\nhave you tried it by using \"as\" as well? Wen you step down with a debugger, which type is it, is it the expected type? Are your interops included in the assembly or in a seperate file? </p>\n\n<p>@ oberfreak, how do i use \"As\", could you please let me know how to use that. My interops are included along with my exe. I was able to perfectly work out of the thread.</p>\n\n<p>@ Hans Passant:\nYou forgot to register the type library in your .rgs script and you also didn't create the proxy/stub project. A threading model of Both still requires an object to be marshaled when it was created on an STA thread and used on another STA thread. Which tends to make it pointless to create a new thread. Get ahead by creating the object on the worker thread instead. </p>\n\n<p>@ Hans Passant : I have registered my type library and interop also created in the C# which is making me to use inside my C# code.I cannot create a new object as I need to use the same object to continue the CAN sequence commands. Could you please provide any sample for better marshalling inside a thread. </p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":9,"view_count":74,"score":-9,"question_id":12330488,"title":"What happens when calling start() on a thread several times","body":"<p>If I call <code>start()</code> on thread A, causing it to run, and then call <code>start()</code> again while it's still running, what happens?</p>\n\n<p>Example:</p>\n\n<pre><code>myThread.start();\n\n// myThread is running...  \n\nmyThread.start(); \n</code></pre>\n"},{"tags":["java","multithreading","exception","netty"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":12874283,"title":"Netty 3.5.8.Final Exception in thread","body":"<p>Several times a minute there is an error</p>\n\n<pre><code>channelConnected\nException in thread \"pool-632-thread-1\" java.lang.NoClassDefFoundError: Could not initialize class org.jboss.netty.util.internal.DetectionUtil\n    at org.jboss.netty.util.HashedWheelTimer$Worker.waitForNextTick(HashedWheelTimer.java:456)\n    at org.jboss.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:373)\n    at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:102)\n    at java.lang.Thread.run(Unknown Source)\n</code></pre>\n\n<p>Netty 3.5.8.Final. How to fix it? I'm using Netty 3.5.3 and the error disappears, but there is a memory leak.\nHere is the code that I use. The error occurs when channelConnected:</p>\n\n<pre><code>public class Netty {\n    private ClientBootstrap Cbootstrap = new ClientBootstrap(new NioClientSocketChannelFactory( Executors.newCachedThreadPool(), Executors.newCachedThreadPool()));\n    private ServerBootstrap Sbootstrap = new ServerBootstrap(new NioServerSocketChannelFactory( Executors.newCachedThreadPool(), Executors.newCachedThreadPool()));    \n    public Netty(int port) {\n        final Handler Handler = new Handler();\n        ChannelPipelineFactory CPF = new ChannelPipelineFactory() {\n            public ChannelPipeline getPipeline() {\n                return Channels.pipeline(new ReadTimeoutHandler(new HashedWheelTimer(), 30), Handler);\n            }\n    };\n    Cbootstrap.setPipelineFactory(CPF);\n        Sbootstrap.setPipelineFactory(CPF);\n        Cbootstrap.setOption(\"connectTimeoutMillis\", 5000);\n        Sbootstrap.setOption(\"connectTimeoutMillis\", 5000);\n    Cbootstrap.setOption(\"tcpNoDelay\", true);\n    Cbootstrap.setOption(\"keepAlive\", true);\n        Sbootstrap.setOption(\"child.tcpNoDelay\", true);\n        Sbootstrap.setOption(\"child.keepAlive\", true);\n        Sbootstrap.bind(new InetSocketAddress(port));   \n    }\n    public void connect(InetAddress addr, int port) {\n        Cbootstrap.connect(new InetSocketAddress(addr, port));\n    }\n}\n</code></pre>\n\n<hr>\n\n<pre><code>public class Handler extends SimpleChannelHandler {\n    @Override\n    public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) {\n        ChannelBuffer buf = (ChannelBuffer) e.getMessage();\n        System.out.println(buf.toString(\"windows-1251\"));\n        Channel ch = e.getChannel();\n        ChannelBuffer buff = ChannelBuffers.dynamicBuffer();\n    buff.writeBytes((\"TEST1\").getBytes());\n        ch.write(buff);\n    }\n    @Override\n    public void channelConnected(ChannelHandlerContext ctx, ChannelStateEvent e) {\n        ChannelBuffer buf = (ChannelBuffer) e.getMessage();\n        System.out.println(buf.toString(\"windows-1251\"));\n        Channel ch = e.getChannel();\n        ChannelBuffer buff = ChannelBuffers.dynamicBuffer();\n    buff.writeBytes((\"TEST2\").getBytes());\n        ch.write(buff);\n    }\n}\n</code></pre>\n"},{"tags":["c++","multithreading","udp","multicore"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12880606,"title":"how to run each thread on other core?","body":"<p>I have a udp server that receive data and computing it.</p>\n\n<p>I have two thread for each role.</p>\n\n<p>In my cpu is a 8 multi-core and I send data in varius speed.</p>\n\n<p>but at maximun I use ony %14 percent of my cpu two core 50%. if I send more data valume my buffer will fulled and don't use more cpu.</p>\n\n<p>why each core arise only 50% and not more?</p>\n\n<p>I think to divide this two role to multi-core.</p>\n\n<p>I want to be sure that each one on other core.</p>\n\n<p>how I can Explicitly to choose each thread run on other core?</p>\n\n<p>my program worte on c++ visaul studio 9 and run on windows7 and I use boost::thread.</p>\n"},{"tags":["c++","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12879236,"title":"Using threads to print out words depending on the starting character","body":"<p>I've had a hard time finding information online on using threads in C++. What I need my program to do is create two threads in the main(). These two threads take words from a sentence specified in a text file and print out the the words depending on the starting character of each word. One thread should print the words starting with a vowel and the other thread should print the words starting with consonants. The main() shouldn't print anything itself and the order of the words should remain the same from the sentence. The two threads are required to yield to each other to accomplish this. No synchronization techniques can be used.</p>\n\n<p>I have the text file being read into a vector and that is working fine currently. My code can accomplish getting the correct output, but not in the manner specified. If you can help me out I'd greatly appreciate it. Thank you.</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n#include &lt;iterator&gt;\n#include &lt;vector&gt;\n#include &lt;sstream&gt;\n\nusing namespace std;\n\nvoid cons(string temp){\n    if (temp[0] != 'A' &amp;&amp; temp[0] != 'a' &amp;&amp; temp[0] != 'E'&amp;&amp; temp[0] != 'e'&amp;&amp; temp[0] != 'I'&amp;&amp; temp[0] != 'i'&amp;&amp; temp[0] != 'O'&amp;&amp; temp[0] != 'o'&amp;&amp; temp[0] != 'U'&amp;&amp; temp[0] != 'u') {\n        cout &lt;&lt; \"cons:  \" &lt;&lt; temp &lt;&lt; endl;\n    }\n    this_thread::yield();\n}\n\nvoid vow(string temp){\n    if (temp[0] == 'A'|| temp[0] == 'a'|| temp[0] == 'E'|| temp[0] == 'e'|| temp[0] == 'I'|| temp[0] == 'i'|| temp[0] == 'O'|| temp[0] == 'o'|| temp[0] == 'U'|| temp[0] == 'u') { \n        cout &lt;&lt; \"vow:   \" &lt;&lt; temp &lt;&lt; endl;\n    }\n    this_thread::yield();\n}\n\n\nint main(){\n    string sentence, temp;\n    ifstream ifs;\n    ofstream ofs;\n    vector &lt;thread&gt; wordThreads;\n\n    ifs.open(\"phrase.txt\");\n    getline(ifs, sentence);\n    istringstream s(sentence);\n    istream_iterator&lt;string&gt; begin(s), end;\n    vector&lt;string&gt; words(begin, end); \n\n    ifs.close();\n\n    for (int i=0; i &lt; 5; i++) {\n        wordThreads.push_back(thread(cons, words[i]));\n        wordThreads.push_back(thread(vow, words[i]));\n    }\n\n    for (thread&amp; t: wordThreads) // loop with a range variable\n    t.join(); \n}\n</code></pre>\n"},{"tags":["java","multithreading","permissions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12880408,"title":"change thread user in java","body":"<p>I run my java program as USER_1 under Windows. I need my program to make a thread with USER_2's permission.</p>\n\n<p>I have no idea how to do it. Searching the web for hours didn't yield me any answers.</p>\n\n<p>How about Thread.setDaemon(true/false)? Would it help anyway?</p>\n"},{"tags":["java","multithreading","polling","java.util.concurrent"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":12870606,"title":"Directory Scanner in Java","body":"<p>Scan a set of directories continuously for a set of file name filters. \nFor each file name filter arrived, process the file and repeat the steps for all</p>\n\n<p>What can be the recommended design for this in jdk 1.5 , possibly using java.concurrent.Executor and Future</p>\n"},{"tags":["arrays","multithreading","boost"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12879071,"title":"Cumulative +1/-1 Cointoss crashes on 1000 iterations. Please advise; c++ boost random libraries","body":"<p>following some former advice\n<a href=\"http://stackoverflow.com/questions/12811594/multithreaded-application-am-i-doing-it-right\">Multithreaded application, am I doing it right?</a></p>\n\n<p>I think I have a threadsafe number generator using boost, but my program crashes when I input 1000 iterations.  The output .csv file when graphed looks right, but I'm not sure why it's crashing. </p>\n\n<p>It's using _beginthread, and everyone is telling me I should use the more (convoluted) _beingthreadex, which I'm not familiar with.  If someone could recommend an example, I would greatly appreciate it.</p>\n\n<p>Also... someone pointed out I should be applying a second parameter to my _beginthread for the array counting start positions, but I have no idea how to pass more than one parameter, other than attempting to use a structure, and I've read structure's and _beginthread don't get along (although, I could just use the boost threads...)</p>\n\n<pre><code>#include &lt;process.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;time.h&gt;\n#include &lt;random&gt;\n#include &lt;boost/random.hpp&gt;\n\n//for srand48_r(time(NULL), &amp;randBuffer); which doesn't work\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n//#include &lt;thread&gt;\n\nusing namespace std;\nusing namespace boost;\nusing namespace boost::random;\n\nvoid myThread0 (void *dummy );\nvoid myThread1 (void *dummy );\nvoid myThread2 (void *dummy );\nvoid myThread3 (void *dummy );\n\n//for random seeds\nvoid initialize();\n\n    //from http://stackoverflow.com/questions/7114043/random-number-generation-in-c11-how-to-generate-how-do-they-work\n    uniform_int_distribution&lt;&gt; two(1,2);\n\n    typedef std::mt19937 MyRNG;  // the Mersenne Twister with a popular choice of parameters\n\n    uint32_t seed_val;           // populate somehow\n\n    MyRNG rng1;                   // e.g. keep one global instance (per thread)\n    MyRNG rng2;                   // e.g. keep one global instance (per thread)\n    MyRNG rng3;                   // e.g. keep one global instance (per thread)\n    MyRNG rng4;                   // e.g. keep one global instance (per thread)\n\n//only needed for shared variables\n//CRITICAL_SECTION cs1,cs2,cs3,cs4; // global\n\nint main()\n{\n\n    ofstream myfile;\n    myfile.open (\"coinToss.csv\");\n\n    int rNum;\n\n    long numRuns;\n    long count = 0;\n    int divisor = 1;\n    float fHolder = 0;\n    long counter = 0;\n    float percent = 0.0;\n\n    //?\n    //unsigned threadID;\n\n    //HANDLE hThread;\n\n    initialize();\n\n    HANDLE hThread[4];\n\n    const int size = 100000;\n\n    int array[size];\n\n    printf (\"Runs (uses multiple of 100,000) \");\n    cin &gt;&gt; numRuns;\n\n    for (int a = 0; a &lt; numRuns; a++)\n     {\n\n            hThread[0] = (HANDLE)_beginthread( myThread0, 0, (void*)(array) );\n            hThread[1] = (HANDLE)_beginthread( myThread1, 0, (void*)(array) );\n            hThread[2] = (HANDLE)_beginthread( myThread2, 0, (void*)(array) );\n            hThread[3] = (HANDLE)_beginthread( myThread3, 0, (void*)(array) );\n\n            //waits for threads to finish before continuing\n            WaitForMultipleObjects(4, hThread, TRUE, INFINITE);\n\n            //closes handles I guess?\n            CloseHandle( hThread[0] );\n            CloseHandle( hThread[1] );\n            CloseHandle( hThread[2] );\n            CloseHandle( hThread[3] );\n\n        //dump array into calculations\n        //average array into fHolder\n\n            //this could be split into threads as well\n            for (int p = 0; p &lt; size; p++)\n             {\n                counter += array[p] == 2 ? 1 : -1;\n                //cout &lt;&lt; array[p] &lt;&lt; endl;\n                //cout &lt;&lt; counter &lt;&lt; endl;\n            }\n\n            //this fHolder calculation didn't work\n            //fHolder = counter / size;\n\n            //so I had to use this\n            cout &lt;&lt; counter &lt;&lt; endl;\n            fHolder = counter;\n            fHolder = fHolder / size;\n\n            myfile &lt;&lt; fHolder &lt;&lt; endl;\n\n    }\n}\n\n    void initialize()\n    {\n\n      //seed value needs to be supplied\n      //rng1.seed(seed_val*1);\n\n      rng1.seed((unsigned int)time(NULL));\n      rng2.seed(((unsigned int)time(NULL))*2);\n      rng3.seed(((unsigned int)time(NULL))*3);\n      rng4.seed(((unsigned int)time(NULL))*4);\n    };\n\n\nvoid myThread0 (void *param)\n{\n    //EnterCriticalSection(&amp;cs1); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 0; x &lt; 25000; x++)\n    {\n        //doesn't work, part of merssene twister\n        //i[x] = next();\n        i[x] = two(rng1);\n\n        //original srand\n        //i[x] = rand() % 2 + 1;\n\n        //doesn't work for some reason.\n        //uint_dist2(rng);\n\n        //i[x] = qrand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs1); // release the critical section object\n\n}\n\nvoid myThread1 (void *param)\n{\n    //EnterCriticalSection(&amp;cs2); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 25000; x &lt; 50000; x++)\n    {\n        //param[x] = rand() % 2 + 1;\n        i[x] = two(rng2);\n        //i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs2); // release the critical section object\n\n}\n\nvoid myThread2 (void *param)\n{\n    //EnterCriticalSection(&amp;cs3); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 50000; x &lt; 75000; x++)\n    {\n        i[x] = two(rng3);\n        //i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs3); // release the critical section object\n\n}\n\nvoid myThread3 (void *param)\n{\n    //EnterCriticalSection(&amp;cs4); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 75000; x &lt; 100000; x++)\n    {\n        i[x] = two(rng4);\n        //i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs4); // release the critical section object\n\n}\n</code></pre>\n"},{"tags":["java","multithreading","networking","connection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12879211,"title":"Simple connection between Server and Client. Client send message and server get it properly. But when the server tries to reply back nothing works?","body":"<p>if separately</p>\n\n<blockquote>\n  <p>Client ---send message to---> Server : works fine!</p>\n</blockquote>\n\n<p>if separately</p>\n\n<blockquote>\n  <p>Server ---send message to---> Client : works fine!</p>\n</blockquote>\n\n<p>But when both together:</p>\n\n<blockquote>\n  <p>Client ---send message to---> Server<br>\n  Server ---send message to--->\n  Client</p>\n</blockquote>\n\n<p>Nothing work!</p>\n\n<p>Here is the ServerSide:</p>\n\n<pre><code>import java.io.*;\nimport java.net.*;\nimport java.text.DateFormat;\nimport java.text.SimpleDateFormat;\nimport java.util.Calendar;\n\npublic class MyServer\n{  \n    private final static int port = 8000; \n    private static String hostname = \"\";\n    private static String hostIP =\"\";\n    public static void main(String[] args )\n    {  \n        ServerSocket serverSocket=null;\n        try {\n            // get host information\n            hostname = InetAddress.getLocalHost().getHostName();\n            hostIP = InetAddress.getLocalHost().getHostAddress();\n            // display server information\n            System.out.println(\"MyServer started on \"+hostname+\" with IP: \"+hostIP + \" on the port number: \" + port);\n            serverSocket = new ServerSocket(port);\n        }\n        catch(IOException e)\n        {\n            e.printStackTrace();\n        }\n        while(true)\n        {   \n            ClientWorker w;\n            try\n            {   \n                w = new ClientWorker(serverSocket.accept());\n                Thread t = new Thread(w);\n                t.start();\n            }\n            catch(IOException e)\n            {\n                e.printStackTrace();\n                break;\n            }   \n        }\n    }\n}   \nclass ClientWorker implements Runnable\n{\n    Socket incoming;\n    public ClientWorker(Socket incoming)\n    {\n        this.incoming = incoming;\n    }\n    public void run()\n    {\n        String request = null;\n        BufferedReader in = null;\n        try {\n            in = new BufferedReader(new InputStreamReader(incoming.getInputStream()));\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            request = in.readLine();\n            System.out.println(\"request =\" + request);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        PrintWriter out = null;\n        try {\n            out = new PrintWriter(incoming.getOutputStream(),true);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        out.println(\"The command is not readable\");\n\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>Here is ClientSide:</p>\n\n<pre><code>import java.io.*;\nimport java.net.*;\npublic class MyClient2\n{\n    public static void main(String[] args)\n    {\n        String answer = null;\n        if (args.length != 1){\n            System.out.println(\"Usage: MyClient serverHostname\");\n            System.exit(0);\n        }\n        try\n        {\n            Socket socket = new Socket (args[0], 8000);\n            PrintWriter out = new PrintWriter(socket.getOutputStream(),true);\n            out.print(\"TIME\");\n            System.out.println(\"Request has been send\");\n            BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream())); \n            answer = in.readLine();         \n            System.out.println(\"The answer is:  \"+answer);\n            in.close();\n            out.close();\n            socket.close();\n        }\n        catch (Exception e)\n        {\n            System.out.println(\"Make sure the server is running and try again\");\n        }\n    }\n}\n</code></pre>\n\n<p>Please have a look and I appreciate your comments.\nCheers</p>\n"},{"tags":["c#","javascript","ajax","multithreading","proxy"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12878496,"title":"Multithreaded http post from ajax control","body":"<p>I'm currently writing a program that is attempting to send multithreaded HTTP POST packages. Each thread has its unique proxy server. Originally I've used the .net HTTPWebRequest function to accomplish this task.</p>\n\n<p>However, I've found that the data submitted by the browser actually comes from an ajax control inside a javascript file, which HTTPWebRequest will certainly be unable to analyze. I've tried to use Selenium but it is too heavyweight.</p>\n\n<p>(Update: Let me briefly explain why HTTPWebRequest will be difficult to analyze the data since the posted data actually is an encrypted key, encrypted by two algorithms: CryptoJS.HmacSHA256 and OpenPGP (PGencode.js). If I want to submit the data package by HTTPWebRequest I have to re-implement these two algorithms in C# to mimic the behavior and get the exact encrypted key, which is a bit cumbersome.)</p>\n\n<p>Are there any alternative approaches that can support multi-threaded HTTP message posts together with ajax and js support?</p>\n"},{"tags":["multithreading","process"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12834282,"title":"does a process and its thread share the same kernel stack?","body":"<p>or does the spawned thread get its own separate kernel and user stack?</p>\n"},{"tags":["multithreading","clojure","jvm","rabbitmq"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12876892,"title":"Clojure + RabbitMQ / multithreaded message consumption","body":"<p><strong>Context</strong>: Clojure + RabbitMQ (via Langohr), a follow up to <a href=\"http://stackoverflow.com/questions/12718573/clojure-message-handling-async-multithreaded\">this question</a>.</p>\n\n<p>I'm getting weird results in consuming messages from a RabbitMQ mq (getting the messages from a direct exchange and publishing to a fanout exchange after processing the message). I don't understand why messages end up in <strong>separate threads</strong> during consumption (every few messages a thread switch happens).</p>\n\n<p>The consumer starts in a separate thread (to prevent it from crashing the main thread if any IO exceptions happen), but that doesn't explain the switching.</p>\n\n<pre><code>; Message handler\n(defn message-handler\n  [pub-name ch metadata ^bytes payload]\n  (let [msg (json/parse-string (String. payload \"UTF-8\"))\n        content (string/join \" \" (map msg '(\"title\" \"link\" \"body\")))\n        tags (pluck-tags content)]\n    (println (format \"HANDLER %s: Message: %s | found tags: %s\"\n                     (Thread/currentThread)\n                     (msg \"title\")\n                     (tags-to-csv tags)))\n  (nil)))\n  ; (lb/publish ch pub-name \"\" (json/generate-string (assoc msg \"tags\" (tags-to-csv tags))))))\n\n\n(defn -main\n  [&amp; args]\n  (let [conn          (rmq/connect {:uri (System/getenv \"MSGQ\")})\n        ch            (lch/open conn)\n        q-name        \"q.events.tagger\"\n        e-sub-name    \"e.events.preproc\"\n        e-pub-name    \"e.events\"\n        routing-key   \"tasks.taggify\"]\n    (lq/declare ch q-name :exclusive false :auto-delete false)\n    (le/declare ch e-pub-name \"fanout\" :durable false)\n    (lq/bind ch q-name e-sub-name :routing-key routing-key)\n    (.start (Thread. (fn []\n       (lcm/subscribe ch q-name (partial message-handler e-pub-name) :auto-ack true))))))\n</code></pre>\n\n<p>The message-handler just prints out the current thread and the payload received. This is what I get:</p>\n\n<pre><code>HANDLER in Thread[pool-1-thread-2,5,main]: Message: ...\nHANDLER in Thread[pool-1-thread-2,5,main]: Message: ...\nHANDLER in Thread[pool-1-thread-3,5,main]: Message: ... \nHANDLER in Thread[pool-1-thread-3,5,main]: Message: ...\nHANDLER in Thread[pool-1-thread-3,5,main]: Message: ...\nHANDLER in Thread[pool-1-thread-4,5,main]: Message: ...\nHANDLER in Thread[pool-1-thread-4,5,main]: Message: ...\n</code></pre>\n\n<p><strong>NOTE</strong></p>\n\n<p>I noticed this during playing with agents. I wanted to process each message in its own CPU bound thread-pool, and publish it in a unbounded (IO) thread-pool. But, after printing out the current thread I noticed that even without using agents (or futures), messages get processed by different threads.</p>\n"},{"tags":["c#","multithreading"],"answer_count":4,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":266,"score":20,"question_id":12877246,"title":"Free multiple threads?","body":"<p>So I have a simple enough console app:</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        Console.ReadKey();\n    }\n}\n</code></pre>\n\n<p>I've built it with release configuration. When I run it and open task manager, I see it\nhas 4 threads. Why is this happening even though I'm not creating any threads?</p>\n\n<p>This can't possibly be each application. I tried opening notepad and it has just 1 thread. Although it is a native app and my console app is managed. </p>\n\n<p>Any ideas?</p>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12868755,"title":"Windows .net thread - can it starve for a long time?","body":"<p>Is it possible in .net for a thread to be blocked for a long time like over 10 seconds?\nOr does .net or Windows switch between threads to make sure they get executed?</p>\n"},{"tags":["c++","multithreading","vowel"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":101,"score":2,"question_id":12877229,"title":"Using threads to alternate between words starting with a vowel or consonant","body":"<p>What I'm trying to do is have the main() create two threads which will run two functions. One function is <em>vow</em> which prints words which start with a vowel and the other is <em>cons</em> which prints words which start with a consonant. These words come from a text file and are read into a vector. The current code you see here prints out the words in correct order, but is labeling every word as one which starts with a vowel which is wrong given my text file contains one sentence which has two words starting with a vowel and three starting with consonants. The test sentence I've been using is \"Operating Systems class at college.\" The odd thing is if I have the if statement currently checking for all vowels changed to only check for an O (uppercase o) it labels \"Operating\" as a vowel, which is correct, and the rest as consonants. (I know \"at\" also begins with a vowel, but my point is it's suddenly at least distinguishing between vowels and consonants and not labeling everything as vowels.) I cannot seem to figure out what I need to change for this to work. Any help is appreciated. Also, I am not allowed to use synchronization techniques. (C++)</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n#include &lt;iterator&gt;\n#include &lt;vector&gt;\n#include &lt;sstream&gt;\n\nusing namespace std;\n\nint cons(string temp){\n    cout &lt;&lt; \"cons:  \" &lt;&lt; temp &lt;&lt; endl;\n    //this_thread::yield();\n    return 0;\n}\n\nint vow(string temp){\n    cout &lt;&lt; \"vow:   \" &lt;&lt; temp &lt;&lt; endl;\n    //this_thread::yield();\n    return 0;\n}\n\n\nint main(){\n    string sentence, temp;\n    ifstream ifs;\n    ofstream ofs;\n    vector &lt;thread&gt; wordThreads;\n\n    ifs.open(\"phrase.txt\");\n    getline(ifs, sentence);\n    istringstream s(sentence);\n    istream_iterator&lt;string&gt; begin(s), end;\n    vector&lt;string&gt; words(begin, end); \n\n    ifs.close();\n\n    for(int i=0; i&lt;(int)words.size(); i++) {\n        temp = words[i];\n        if(temp[0] == 'A'||'a'||'E'||'e'||'I'||'i'||'O'||'o'||'U'||'u') {\n            thread threadOne(vow, temp);\n            threadOne.join();\n        }\n        else {\n            thread threadTwo(cons, temp);\n            threadTwo.join();\n        }\n    }\n\n\n}\n</code></pre>\n"},{"tags":["android","multithreading","android-service","android-tabhost","android-progressbar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":423,"score":0,"question_id":9246657,"title":"ServiceConnection.onServiceConnected() never called after binding to started service","body":"<p>In a game application I have the following scenario:</p>\n\n<ul>\n<li>From the main game <code>Activity</code>, the player starts several game tasks that run in the background with varying duration.</li>\n<li>The player should be able to view the progress of the running game tasks in a separate <code>View</code>.</li>\n</ul>\n\n<hr>\n\n<p>To do this, I created two <code>Activity</code>s and a <code>Service</code>, defined as follows:</p>\n\n<ul>\n<li><p><code>Service ProgressService</code> handles several <code>ProgressBar</code>s running simultaneously on parallel threads.</p></li>\n<li><p><code>Activity WorkScreen2</code> creates a game task, starts the <code>Service</code> with <code>startService()</code> with task parameters passed in a <code>Bundle</code>.</p></li>\n<li><p><code>Activity ProgressScreen</code> binds to the <code>Service</code> to get and display the <code>ProgressBar</code>s of the running tasks.</p></li>\n<li><p>Both activities run under separate <code>TabHost</code>s of one <code>TabActivity</code>.</p></li>\n</ul>\n\n<hr>\n\n<p>The problem I'm having is that the <code>ServiceConnection.onServiceConnected()</code> method is never called.  I get a <code>Java.lang.NullPointerException</code> because I try to call a method of the <code>Service</code> object that should be assigned in this method.  See code below.</p>\n\n<p>I use <code>getApplicationContext().bindService()</code> to bind the <code>Activity</code> to the <code>Service</code> because <a href=\"http://code.google.com/p/android/issues/detail?id=2483#c2\" rel=\"nofollow\"><code>TabSpec</code> cannot bind to <code>Services</code></a>.  This method returns <code>true</code>.  Therefore, binding is successful.</p>\n\n<hr>\n\n<p>Here is the <code>Service</code>:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class ProgressService extends Service implements GameConstants {\n    public static final String BROADCAST_PROGRESS = \"com.mycompany.android.mygame.progressbroadcast\";\n    private static final long UPDATE_INTERVAL = 500;\n    private IBinder mBinder;\n    private List&lt;ProgressBar&gt; mProgressBarList;\n    private List&lt;String&gt; mStaffNameList;\n\n    private final class ServiceHandler extends Handler {\n\n        public ServiceHandler(Looper looper) {\n            super(looper);\n        }\n\n        @Override\n        public void handleMessage(Message msg) {\n            ProgressBar progressBar = new ProgressBar(ProgressService.this);\n            mProgressBarList.add(progressBar);\n\n            Bundle bundle = msg.getData();\n            String staffName = bundle.getString(WorkScreen2.STAFF_NAME);\n            mStaffNameList.add(staffName);\n\n            int taskDurationMillis = bundle.getInt(WorkScreen2.TASK_DURATION) * 1000;\n            progressBar.setMax(taskDurationMillis / 1000);\n\n            long startTimeMillis = SystemClock.uptimeMillis();\n            long elapsedTimeMillis = SystemClock.uptimeMillis()\n                    - startTimeMillis;\n\n            Intent intent = new Intent();\n            intent.setAction(BROADCAST_PROGRESS);\n\n            while (elapsedTimeMillis &lt; taskDurationMillis) {\n                try {\n                    Thread.sleep(UPDATE_INTERVAL);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                elapsedTimeMillis = SystemClock.uptimeMillis()\n                        - startTimeMillis;\n                int elapsedTimeSeconds = (int) elapsedTimeMillis / 1000;\n                progressBar.setProgress(elapsedTimeSeconds);\n                sendBroadcast(intent);\n            }\n\n            progressBar.setVisibility(View.GONE);\n            mProgressBarList.remove(progressBar);\n            mStaffNameList.remove(staffName);\n            sendBroadcast(intent);\n\n            if (mProgressBarList.isEmpty()) {\n                stopSelf(msg.arg1);\n            }\n        }\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        mBinder = new ProgressServiceBinder();\n        mProgressBarList = Collections\n                .synchronizedList(new ArrayList&lt;ProgressBar&gt;());\n        mStaffNameList = Collections.synchronizedList(new ArrayList&lt;String&gt;());\n    }\n\n    /*\n     * Creates a thread for each game task with parameters passed in\n     * &lt;code&gt;intent&lt;/code&gt;\n     */\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Toast.makeText(this, \"starting service\", Toast.LENGTH_LONG).show();\n\n        HandlerThread thread = new HandlerThread(\"ServiceStartArguments\",\n                Process.THREAD_PRIORITY_BACKGROUND);\n        thread.start();\n\n        Handler serviceHandler = new ServiceHandler(thread.getLooper());\n\n        Message msg = serviceHandler.obtainMessage();\n        msg.arg1 = startId;\n        msg.setData(intent.getExtras());\n        serviceHandler.sendMessage(msg);\n\n        return START_STICKY;\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return mBinder;\n    }\n\n    public class ProgressServiceBinder extends Binder {\n        ProgressService getService() {\n            return ProgressService.this;\n        }\n    }\n\n    public List&lt;ProgressBar&gt; getProgressBarList() {\n        return mProgressBarList;\n    }\n\n    public List&lt;String&gt; getStaffNameList() {\n        return mStaffNameList;\n    }\n\n    @Override\n    public void onDestroy() {\n        Toast.makeText(this, \"Service done\", Toast.LENGTH_SHORT).show();\n    }\n}\n</code></pre>\n\n<p>And this is the <code>Activity</code> that binds to it:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class ProgressScreen extends ListActivity {\n    private final String TAG = \"ProgressScreen\";\n\n    private ProgressScreenAdapter mAdapter;\n    private ProgressService mProgressService;\n    private List&lt;ProgressBar&gt; mProgressBarList;\n    private List&lt;String&gt; mStaffNameList;\n\n    @Override\n    public void onCreate(Bundle bundle) {\n        Log.i(TAG, \"ProgressScreen oncreate\");\n\n        super.onCreate(bundle);\n        setContentView(R.layout.progress_screen_layout);\n        IntentFilter filter = new IntentFilter();\n        filter.addAction(ProgressService.BROADCAST_PROGRESS);\n        registerReceiver(receiver, filter);\n        doBindService();\n\n        mAdapter = new ProgressScreenAdapter(this, mStaffNameList, mProgressBarList);\n        setListAdapter(mAdapter); // Returns true\n\n        /*\n         * This is where I get the NullPointerException\n         * mProgressService is null here\n         */\n        mProgressBarList = mProgressService.getProgressBarList();\n        mStaffNameList = mProgressService.getStaffNameList();\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        IntentFilter filter = new IntentFilter();\n        filter.addAction(ProgressService.BROADCAST_PROGRESS);\n        registerReceiver(receiver, filter);\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        unregisterReceiver(receiver);\n    }\n\n    boolean doBindService() {\n        return getApplicationContext().bindService(new Intent(this, ProgressService.class), mConnection, Context.BIND_AUTO_CREATE);\n    }\n\n    void doUnbindService() {\n        getApplicationContext().unbindService(mConnection);\n    }\n\n    ServiceConnection mConnection = new ServiceConnection() {\n\n        public void onServiceConnected(ComponentName className, IBinder binder) {\n            mProgressService = ((ProgressService.ProgressServiceBinder) binder).getService();\n            Toast.makeText(ProgressScreen.this, \"Connected to ProgressService\", Toast.LENGTH_SHORT).show();\n        }\n\n        public void onServiceDisconnected(ComponentName name) {\n            mProgressService = null;\n        }\n    };\n\n    private BroadcastReceiver receiver = new BroadcastReceiver () {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            mAdapter.notifyDataSetChanged();\n        }\n    };\n}\n</code></pre>\n\n<p>And the <code>Service</code> is started from the main <code>Activity</code> as follows:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>Intent intent = new Intent(WorkScreen2.this, ProgressService.class);\nintent.putExtra(TASK_DURATION, task.getDuration());\nintent.putExtra(STAFF_NAME, staff.getName());\nstartService(intent);\n</code></pre>\n\n<p>The <code>AndroidManifest.xml</code> contains</p>\n\n<pre><code>&lt;service\n    android:name=\".ProgressService\"\n    android:label=\"@string/progress_service\"&gt;\n&lt;/service&gt;\n</code></pre>\n"},{"tags":["iphone","multithreading","xml-parsing","main"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":193,"score":1,"question_id":5596336,"title":"XMLParser error with NSThread","body":"<p>I have an application in which I load my XML data via the NSXMLParser into an UITableView. This all worked perfectly. Because I wanted to add a ActivityIndicator I have to place my loading data on a different thread then the main. After I did this the XML get loaded as well as my application but I see nothing in my table. When I click on a different tab of my tabbarcontroller and then click back to the table the data in the table becomes visible. What is going wrong?</p>\n\n<p>My file:</p>\n\n<pre><code>#import \"DAFAppDelegate.h\"\n#import \"RootViewController.h\"\n#import \"XMLParser.h\"\n\n\n@implementation DAFAppDelegate\n\n@synthesize window;\n@synthesize navigationController;\n@synthesize rootViewController;\n@synthesize rootTabController;\n@synthesize stages;\n\n+ (void) showAlert\n{\n    UIAlertView *av = [[[UIAlertView alloc] initWithTitle:@\"No Connection\" message:@\"Could not retrieve data\" delegate:nil cancelButtonTitle:@\"OK\" otherButtonTitles:nil] autorelease];\n    [av show];\n}\n\n- (void)applicationDidFinishLaunching:(UIApplication *)application\n{\n    [window addSubview:[rootTabController view]];\n    [window makeKeyAndVisible];\n\n    [NSThread detachNewThreadSelector:@selector(parseXML) toTarget:self withObject:nil];\n}\n\n- (void) parseXML\n{\n    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n\n    [[UIApplication sharedApplication] setNetworkActivityIndicatorVisible:YES];\n    NSURL *url = [[NSURL alloc] initWithString:@\"http://web.me.com/ijar/Stages.xml\"];\n    NSXMLParser *xmlParser = [[NSXMLParser alloc] initWithContentsOfURL:url];\n\n    //Initialize the delegate.\n    XMLParser *parser = [[XMLParser alloc] initXMLParser];\n\n    //Set delegate\n    [xmlParser setDelegate:parser];\n\n    //Start parsing the XML file.\n    BOOL success = [xmlParser parse];\n\n    if(success)\n    {\n        NSLog(@\"No Errors\");\n    }\n    else\n    {\n        [DAFAppDelegate showAlert];\n        NSLog(@\"Error Error Error!!!\");\n    }  \n\n    [pool release];\n\n}\n\n- (void)dealloc\n{\n    [navigationController release];\n    [rootViewController release];\n    [rootTabController release];\n    [window release];\n    [stages release];\n    [super dealloc];\n}\n\n@end\n</code></pre>\n"},{"tags":["mysql","multithreading","stack"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12876281,"title":"How do i resolve thread overrun issue","body":"<pre><code>Error: Thread stack overrun: 6072 bytes used of a 131072 byte stack, and 128000 bytes needed.\n</code></pre>\n\n<p>Use <code>mysqld -O thread_stack=#</code> to specify a bigger stack.</p>\n\n<p>I'm using Mac OS X.</p>\n"},{"tags":["multithreading","language-agnostic","concurrency","locking","mutex"],"answer_count":2,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1512,"score":6,"question_id":5667793,"title":"How does a read-write mutex/lock work?","body":"<p>Let's say I'm programming in a threading framework that does not have <a href=\"https://secure.wikimedia.org/wikipedia/en/wiki/Readers-writer_lock\">multiple-reader/single-writer mutexes</a>. Can I implement their functionality with the following:</p>\n\n<p>Create two mutexes: a recursive (lock counting) one for readers and a binary one for the writer.</p>\n\n<p>Write:</p>\n\n<ul>\n<li>acquire lock on binary mutex</li>\n<li>wait until recursive mutex has lock count zero</li>\n<li>actual write</li>\n<li>release lock on binary mutex</li>\n</ul>\n\n<p>Read:</p>\n\n<ul>\n<li>acquire lock on binary mutex (so I know the writer is not active)</li>\n<li>increment count of recursive mutex</li>\n<li>release lock on binary mutex</li>\n<li>actual read</li>\n<li>decrement count of recursive mutex</li>\n</ul>\n\n<p>This is not homework. I have no formal training in concurrent programming, and am trying to grasp the issues. If someone can point out a flaw, spell out the invariants or provide a better algorithm, I'd be very pleased. A good reference, either online or on dead trees, would also be appreciated.</p>\n"},{"tags":["multithreading","deadlock","concurrency","concurrent-programming"],"answer_count":13,"favorite_count":6,"up_vote_count":9,"down_vote_count":0,"view_count":976,"score":9,"question_id":2143873,"title":"How to explain the \"deadlock\" better?","body":"<p>I am struggling to explain \"deadlock\" in threads in easy words, so please help. What could be the best example of \"deadlock\" (say, in Java), and how it does happen in steps and how to prevent it? But without getting into details too deep. I know that's like asking two opposite things, but still. If you have any previous concurrent programming training experience -- it would be superb!</p>\n"},{"tags":["java","multithreading","concurrency","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12874914,"title":"a simple multithreaded alarm clock","body":"<p>I am currently studying the multithreaded programming and I am having a hard time mastering shared resources between threads. </p>\n\n<p>I have two shared resources, <code>time</code> and <code>alarm</code></p>\n\n<p>I have three threads, one keeps updating <code>time</code> every second, one monitors <code>time</code> against <code>alarm</code> and finally one changes <code>time</code> and <code>alarm</code> at user request. </p>\n\n<p>this is to be done using mutual exclusion semaphore, I have a simple setup described below: </p>\n\n<ol>\n<li><code>Main</code> thread, program begins here, hosts <code>time</code> and <code>alarm</code> common variables and instantiates sub threads. </li>\n<li><code>Tick</code> sub-thread, sleeps every 1000ms, then modifies <code>Mother</code> thread's <code>time</code> variable</li>\n<li><code>UserInput</code> sub-thread, is blocked until a user input is caught, and modifies either <code>time</code> or <code>alarm</code> in <code>Main</code> thread.</li>\n<li><code>Alarm</code> sub-thread, sleeps every 1000ms, goes off when <code>alarm</code> == <code>time</code></li>\n</ol>\n\n<p>The <code>Main</code> thread keeps a mutex for each resource so only one thread can access it at a time.</p>\n\n<p>Is such design reasonable or am I just over complicating things?</p>\n"},{"tags":["objective-c","multithreading","malloc","zlib"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12863088,"title":"zlib: thread safe zalloc and zfree in C?","body":"<p>I am using the zlib C library to decompress data received from a network stream, and I have two streams running in two separate NSThreads. As per zlib documentation, decompressing two different zlib streams in two threads requires zalloc and zfree to be thread safe. I am currently passing Z_NULL (my inflateinit code below)</p>\n\n<pre><code>zStream.zalloc = Z_NULL;\nzStream.zfree = Z_NULL;\nzStream.opaque = Z_NULL;\nzStream.avail_in = 0;\nzStream.next_in = Z_NULL;\nint status = inflateInit(&amp;zStream);\nif (status != Z_OK)\n    DLog(@\"zlib setup error\");\nelse\n    DLog(@\"zlib setup ok\");\n});\n</code></pre>\n\n<p>Does anyone have experience with using zlib for compressing multiple streams in separate threads? Has anyone seen a thread safe implementation of zalloc and zfree?</p>\n"},{"tags":["python","multithreading","initialization","locale","strptime"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":485,"score":3,"question_id":4625149,"title":"Fixed strptime exception with thread lock, but slows down the program","body":"<p>I have the following code, which when is running inside of a thread (the full code is here - <a href=\"https://github.com/eWizardII/homobabel/blob/master/lovebird.py\" rel=\"nofollow\">https://github.com/eWizardII/homobabel/blob/master/lovebird.py</a>)</p>\n\n<pre><code> for null in range(0,1):\n            while True:\n                try:\n                    with open('C:/Twitter/tweets/user_0_' + str(self.id) + '.json', mode='w') as f:\n                        f.write('[')\n                        threadLock.acquire()\n                        for i, seed in enumerate(Cursor(api.user_timeline,screen_name=self.ip).items(200)):\n                            if i&gt;0:\n                                f.write(\", \")\n                            f.write(\"%s\" % (json.dumps(dict(sc=seed.author.statuses_count))))\n                            j = j + 1\n                        threadLock.release()\n                        f.write(\"]\")\n                except tweepy.TweepError, e:\n                    with open('C:/Twitter/tweets/user_0_' + str(self.id) + '.json', mode='a') as f:\n                        f.write(\"]\")\n                    print \"ERROR on \" + str(self.ip) + \" Reason: \", e\n                    with open('C:/Twitter/errors_0.txt', mode='a') as a_file:\n                        new_ii = \"ERROR on \" + str(self.ip) + \" Reason: \" + str(e) + \"\\n\"\n                        a_file.write(new_ii)\n                break\n</code></pre>\n\n<p>Now without the thread lock I generate the following error:</p>\n\n<pre><code>Exception in thread Thread-117: Traceback (most recent call last):   File \"C:\\Python27\\lib\\threading.py\", line 530, in __bootstrap_inner\n    self.run()   File \"C:/Twitter/homobabel/lovebird.py\", line 62, in run\n    for i, seed in enumerate(Cursor(api.user_timeline,screen_name=self.ip).items(200)): File \"build\\bdist.win-amd64\\egg\\tweepy\\cursor.py\", line 110, in next\n    self.current_page = self.page_iterator.next()   File \"build\\bdist.win-amd64\\egg\\tweepy\\cursor.py\", line 85, in next\n    items = self.method(page=self.current_page,\n*self.args, **self.kargs)   File \"build\\bdist.win-amd64\\egg\\tweepy\\binder.py\", line 196, in _call\n    return method.execute()   File \"build\\bdist.win-amd64\\egg\\tweepy\\binder.py\", line 182, in execute\n    result = self.api.parser.parse(self, resp.read())   File \"build\\bdist.win-amd64\\egg\\tweepy\\parsers.py\", line 75, in parse\n    result = model.parse_list(method.api, json)   File \"build\\bdist.win-amd64\\egg\\tweepy\\models.py\", line 38, in parse_list\n    results.append(cls.parse(api, obj))   File \"build\\bdist.win-amd64\\egg\\tweepy\\models.py\", line 49, in parse\n    user = User.parse(api, v)   File \"build\\bdist.win-amd64\\egg\\tweepy\\models.py\", line 86, in parse\n    setattr(user, k, parse_datetime(v))   File \"build\\bdist.win-amd64\\egg\\tweepy\\utils.py\", line 17, in parse_datetime\n    date = datetime(*(time.strptime(string, '%a %b %d %H:%M:%S +0000 %Y')[0:6]))   File \"C:\\Python27\\lib\\_strptime.py\", line 454, in _strptime_time\n    return _strptime(data_string, format)[0]   File \"C:\\Python27\\lib\\_strptime.py\", line 300, in _strptime\n    _TimeRE_cache = TimeRE()   File \"C:\\Python27\\lib\\_strptime.py\", line 188, in __init__\n    self.locale_time = LocaleTime()   File \"C:\\Python27\\lib\\_strptime.py\", line 77, in __init__\n    raise ValueError(\"locale changed during initialization\") ValueError: locale changed during initialization\n</code></pre>\n\n<p>The problem is with thread lock on, each thread runs itself serially basically, and it takes way to long for each loop to run for there to be any advantage to having a thread anymore. So if there isn't a way to get rid of the thread lock, is there a way to have it run the for loop inside of the try statement faster?</p>\n"},{"tags":["c++","multithreading","thread-safety","compiler-optimization"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":390,"score":3,"question_id":4564713,"title":"How can I avoid threading + optimizer == infinite loop?","body":"<p>In a <a href=\"https://code.asterisk.org/code/cru/CR-ASTSCF-34#c384\" rel=\"nofollow\">code review</a> today, I stumbled across the following bit of code (slightly modified for posting):</p>\n\n<pre><code>while (!initialized)\n{\n  // The thread can start before the constructor has finished initializing the object.\n  // Can lead to strange behavior. \n  continue;\n}\n</code></pre>\n\n<p>This is the first few lines of code that runs in a new thread.  In another thread, once initialization is complete, it sets <code>initialized</code> to <code>true</code>.</p>\n\n<p>I know that the optimizer could turn this into an infinite loop, but what's the best way to avoid that?</p>\n\n<ul>\n<li><code>volatile</code> - <a href=\"http://www.mjmwired.net/kernel/Documentation/volatile-considered-harmful.txt\" rel=\"nofollow\">considered harmful</a></li>\n<li>calling an <code>isInitialized()</code> function instead of using the variable directly - would this guarantee a memory barrier?  What if the function was declared <code>inline</code>?</li>\n</ul>\n\n<p>Are there other options?</p>\n\n<p><em>Edit:</em></p>\n\n<p>Should have mentioned this sooner, but this is portable code that needs to run on Windows, Linux, Solaris, etc.  We use mostly use <a href=\"http://www.boost.org/doc/libs/1_45_0/doc/html/thread.html\" rel=\"nofollow\">Boost.Thread</a> for our portable threading library.</p>\n"},{"tags":["multithreading","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":5863079,"title":"Functional static typed languages and parallel computation","body":"<p>It seems to me that statically typed, and functional languages are perfect for parallel computation. Since asserting strong type constraints such as the functional purity of functions should be easy. And additionally, these programming languages are already well suited for the types of computation-heavy programs that would trivially benefit from data parallelism.</p>\n\n<p>However, it seems that beyond Haskell, none of the other strongly typed functional languages support OS-level threads to back their parallelism. Is it actually the case that Haskell is the only language that supports this sort of thing in the modern day, and that any of the ML series languages, don't provide good threading support among other statically typed language?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12867113,"title":"Mutex and Semaphore in JAVA?","body":"<p>Is the Synchronized keyword in java depend on a Mutex or a Semaphore ? I read that both these terms are used interchangeably, but there is a difference ? Are there any built in Semaphore classes in java ?</p>\n\n<p>Kind Regards </p>\n"},{"tags":["c#","winforms","multithreading","delegates","invoke"],"answer_count":5,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":588,"score":4,"question_id":4283689,"title":"Winforms multithreading: Is creating a new delegate each time when invoking a method on the UI thread needed?","body":"<p>I want to invoke a method that manipulates a control on the UI thread. My code works and I want to optimize. I am referring to this <a href=\"http://msdn.microsoft.com/en-us/library/757y83z4%28VS.71%29.aspx\" rel=\"nofollow\">resource on MSDN</a>.\n<br>\nAccording to there, we should do</p>\n\n<pre><code>public delegate void myDelegate(int anInteger, string aString);\n//...\nLabel1.Invoke(new myDelegate(myMethod), new Object[] {1, \"This is the string\"});\n</code></pre>\n\n<p><strong>Would this introduce an orphaned delegate object (a memory leak), at each call?</strong></p>\n\n<p>When I would do it with a static instance of the delegate like below and then use this instance at each call to invoke:</p>\n\n<pre><code>private static _delegateInstance = new myDelegate(myMethod);\n//...\nLabel1.Invoke(_delegateInstance , new Object[] {1, \"This is the string\"});\n</code></pre>\n\n<p><strong>Would this be Thread-Safe? I would it be true that this has a slightly better performance, since the delegate instance is only created once?</strong></p>\n"},{"tags":["java","multithreading","sockets","gui"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12872918,"title":"Server / client program stops working after Thread starts","body":"<p>I have over the past 5 days tried to find out why my program does not work i have been asking countless questions in here with good responses and it seems that i have now found the problem. </p>\n\n<p>Background story:</p>\n\n<p>I have a chat program that is devided into two seperate applications a Client and Server. The idea is to make a chat program so ever client has a GUI that contains a picture and some labels and a few textAreas. </p>\n\n<p>Whenever the client starts up the Gui show and the user is able to hit the button connect to try and connect with the server the follwing this is directly what happens in my program and this part of the program works fine:</p>\n\n<p>** The connect button is being pushed**\nClient sends to server: 1\nServer sends to client: 1\nServer sends to client: 1\nClient sends to server: Marc (The chat persons username)</p>\n\n<p>Client sends to server: 5\nServer sends to client: 1\nserver sends to client: 1\nServer sends to client: Marc</p>\n\n<p>Client sends to server: 8\nServer sends to client: 8</p>\n\n<p>And now all hell breaks loose because now the Thread in my Gui Starts. and from here on the program is apprently unable to recive messages from the server from here on. even though the server recives the messages. How can this be?</p>\n\n<p>in order to not post loads of code i am going to post the important parts of my program if you need more code il be glad to update the post</p>\n\n<p><strong>the Thread (in the simpleController (the one that controls the GUI))</strong></p>\n\n<pre><code>public void run(){ \n    System.out.println(\"Thread started\");\n    System.out.println(client.getSocket().isConnected());\n    ClientListner cl = new ClientListner(client);\n    while (client.getSocket().isConnected()) {\n        int key = 10;\n\n            if (client.getInput().hasNext()) {\n                txt_ChatPerson2.setText(client.reciveString());\n                txt_ChatPerson2.setVisible(true);\n            }\n            try {\n                key = client.reciveCommando();\n                System.out.println(\"jeg er her\");\n            } catch (IOException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n\n\n\n        System.out.println(\"Key \"+key);\n        switch (key) {\n        // case 2 er recive chat:\n        case 2:\n            // først find ud af hvilket ID der har sendt chatten:\n            int y = 0;\n            try {\n                y = client.reciveCommando();\n                System.out.println(\"y\" + y); \n            } catch (IOException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n            // derefter få beskeden og send den så ud til resten.\n            String says = client.reciveChat().toString();\n            System.out.println(\"Says :\"+says);\n            if (y == 1) {\n                txt_ChatPerson1.setText(says);\n                txt_ChatPerson1.setVisible(true);\n            }else if (y == 2) {\n                txt_ChatPerson2.setText(says);\n                txt_ChatPerson2.setVisible(true);\n            }else {\n                chatPerson3.setVisible(true);\n                txt_ChatPerson3.setVisible(true);\n                txt_ChatPerson3.setText(says);\n            }\n\n            break;\n\n        default:\n            break;\n        }\n    }\n}\n</code></pre>\n\n<p><strong>The client class</strong></p>\n\n<pre><code> import java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.InetAddress;\nimport java.net.Socket;\nimport java.util.Scanner;\n\n\npublic class Client {\n// disse var static\n    public final static int portNumber = 6040;\n    public Socket socket;\n    private PrintWriter pw;\n    private Scanner input;\n    private int clientId;\n    /**\n     * @param args\n     * @throws IOException \n     */\n\n    public Client(Socket socket, PrintWriter pw, Scanner input, int clientId){\n        this.socket = socket;\n        this.pw = pw;\n        this.input = input;\n        this.clientId = clientId;\n    }\n    public void connect() throws IOException{\n        // du kan vælge at bruge inetadressen til at connecte i socketet.\n        InetAddress adr = InetAddress.getByName(\"localhost\");\n        socket = new Socket(\"localhost\", portNumber);\n        input=new Scanner(socket.getInputStream());\n        pw = new PrintWriter(socket.getOutputStream());\n\n    }\n    /**\n     * This method sends the message (that the client(chat person) writes to the user)\n     * @param x\n     * @throws NullPointerException\n     * @throws IOException \n     */\n    public void SendChat(String x) throws NullPointerException{\n            pw.print(\"CHAT:\"+x);\n            pw.flush();\n        /*  pw.println(2);\n            pw.flush();\n            pw.println(SimpleController.currentClientId);\n            pw.flush();\n            pw.println(x);\n            pw.flush(); \n        */\n    }\n    public int sendCommando(int id) throws IOException{\n        System.out.println(\"Jeg sender\"+ id);\n        pw.println(id);\n        pw.flush();\n        /*\n         * this part of the program sends a command to the server if the command is 1 then 1 is = Connect.\n         * the program then ask the server is the server is full or is it ok to connect? \n         * if the response is not 10 then the program will allow a connection to happen the return type will be the Id of which \n         * the chat person becomes!\n         */\n        // should the method return 0 the Application will do NOTHING!\n        switch (id) {\n        case 1:\n    int k = reciveCommando();\n            if (k== 10) {\n                return 10;\n            }else if (k &lt; 3) {\n                System.out.println(\"returned k\" + k);\n                return k;\n            }else {\n\n            return 10;\n            }\n            /*\n             * Closes the connection with the server!\n             */\n        case 3:\n\n            socket.close();\n            return 0;\n\n        case 5:\n            int y  = reciveCommando();\n            return y;\n\n        case 8:\n            return 8;\n        default:\n            return 0;\n        }\n\n    }\n    /*\n     * this method recives a command from the server! the comands can be found in the ChatCommands.txt\n     * returns the command as an integer!\n     */\n    public int reciveCommando() throws IOException{\n        Integer i = input.nextInt();\n        return i;\n    }\n    /**\n     * Gets a String response from the server. This method i used to create other users and give them the correct username.\n     * \n     * @param i\n     * @return\n     * @throws IOException\n     */\n    public String getStringResponse(int i) throws IOException {\n        pw.print(i);\n        pw.flush();\n        String x = input.nextLine();\n        return x;\n\n    }\n/*\n * Work in progress - client getter og setter methoder!\n */\n\npublic Socket getSocket(){\n    return socket;\n}\npublic Scanner getInput(){\n    return input;\n}\npublic PrintWriter getPw(){\n    return pw;\n}\npublic int getClientId(){\n    return clientId;\n}\n\npublic void setClientId(int i ){\n    clientId = i;\n}\npublic String reciveChat(){\n        return getInput().nextLine();\n\n}\npublic String reciveString(){\n    String x =input.next();\n    return x;\n}\npublic void sendString(String x){\n    pw.println(x);\n    pw.flush();\n}\n\n\n\n}\n</code></pre>\n\n<p><strong>The server code</strong></p>\n\n<pre><code>    import java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.ServerSocket;\nimport java.net.Socket;\nimport java.util.Scanner;\n\n\npublic class Server extends Thread {\n\n    private Socket connection;\n    private PrintWriter pw;\n    private Scanner input;\n    private ServerInformation info = new ServerInformation();\n    private ChatPerson p;\n\n    public Server(Socket connection, PrintWriter pw, Scanner input){\n        this.connection = connection;\n        this.pw = pw;\n        this.input = input;\n    }\n\n    @Override\n    public void run() {\n        while (connection.isConnected()) {\n            if (input.hasNextInt()) {\n                System.out.println(\"Det var sgu da en int\");\n                int i = getInput().nextInt();\n                System.out.println(i);\n                checkCommand(i);    \n            }else if (input.hasNext()) {\n                System.out.println(\"det var ikke en int\");\n                String inString = input.nextLine();\n                System.out.println(inString);\n                chatCase(inString);\n            } \n        }\n\n\n    }\n    private void chatCase(String x) {\n        String k =x.substring(6 , x.length());\n        System.out.println(\"k \"+k);\n        pw.print(x);\n\n        pw.flush();\n    }\n\n    private void checkCommand(int i) {\n        System.out.println(\"i \"+i);\n        switch (i) {\n        // this case accepts the connection and creates a new user;\n        case 1:\n\n\nint id = info.getNextID();\n        pw.println(1);\n        pw.flush();\n        pw.println(id);\n        pw.flush();\n        p = new ChatPerson(id, input.next());\n        info.addToList(p);\n        break;\n\n        // this is the chat case virker ikke endnu\n    case 2:\n        int clientID = input.nextInt();\n        String x = reciveString();\n        System.out.println(x);\n        pw.println(clientID);\n        pw.flush();\n        pw.print(x);\n        pw.flush();\n        break;\n    // this case sends information about other chat users to the client\n    case 5:\n        pw.println(5);\n        pw.flush();\n        pw.println(info.getList().size());\n        pw.flush();\n        for (int j = 0; j &lt; info.getList().size(); j++) {\n            pw.println(info.getList().get(j).getId());\n            System.out.println(\"info.get \"+info.getList().get(j).getId());\n            pw.flush();\n            pw.println(info.getList().get(j).getName());\n            pw.flush();\n        }\n        break;\n\n    case 8:\n        pw.println(8);\n        pw.flush();\n        break;\n    default:\n        break;\n    }\n\n}\n\nprivate String reciveString() {\n    if (input.next().contains(\" \")) {\n        String x = input.nextLine();\n        return x;\n    }\n    return input.next();\n}\n\npublic Socket getConnection(){\n    return connection;\n}\npublic PrintWriter getPw(){\n    return pw;\n}\npublic Scanner getInput(){\n    return input;\n}\n\n\n\n\n}\n</code></pre>\n\n<p>i hope someone is able to help me since this is a huge problem for me if you need more info please just comment and il provide as much as possible</p>\n"},{"tags":["c++","arrays","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":87,"score":-1,"question_id":12811594,"title":"Multithreaded application, am I doing it right?","body":"<p>Is this doing 4 threads on an array, and then assigning that array to a cumulative count?  I believe it is.  I know rand() is not thread safe, I'm going to change that once I know the logic is right.</p>\n\n<p>It's a conglomoration of a few bits of advice on\n<a href=\"http://stackoverflow.com/questions/12801862/problems-passing-array-by-reference-to-threads\">Problems passing array by reference to threads</a>\nand then\n<a href=\"http://stackoverflow.com/questions/12810472/c-multithread-array\">c++ multithread array</a></p>\n\n<p>I know it's not practicing best practice methods, but I'm just trying to get it up and running.</p>\n\n<p>I think I got it running correctly, had to change a for counter variable from x to p, not sure why...  also moved the fHolder out of for loop.</p>\n\n<p>my fholder always results in 0, I don't know why.  I checked the value of counter...</p>\n\n<pre><code>#include &lt;process.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;time.h&gt;\n//#include &lt;thread&gt;\n\nusing namespace std;\n\nvoid myThread0 (void *dummy );\nvoid myThread1 (void *dummy );\nvoid myThread2 (void *dummy );\nvoid myThread3 (void *dummy );\n\n//only needed for shared variables\n//CRITICAL_SECTION cs1,cs2,cs3,cs4; // global\n\nint main()\n{\n\n    //InitializeCriticalSection(&amp;cs1);\n    //InitializeCriticalSection(&amp;cs2);\n    //InitializeCriticalSection(&amp;cs3);\n    //InitializeCriticalSection(&amp;cs4);\n\n    ofstream myfile;\n    myfile.open (\"coinToss.csv\");\n\n    int rNum;\n\n    long numRuns;\n    long count = 0;\n    int divisor = 1;\n    float fHolder = 0;\n    long counter = 0;\n    float percent = 0.0;\n\n\n    //?\n    unsigned threadID;\n\n    //HANDLE hThread;\n    HANDLE hThread[4];\n\n    const int size = 100000;\n\n    int array[size];\n\n    srand ( time(NULL) );\n\n    printf (\"Runs (uses multiple of 100,000) \");\n    cin &gt;&gt; numRuns;\n\n    for (int a = 0; a &lt; numRuns; a++)\n     {\n\n            hThread[0] = (HANDLE)_beginthread( myThread0, 0, (void*)(array) );\n            hThread[1] = (HANDLE)_beginthread( myThread1, 0, (void*)(array) );\n            hThread[2] = (HANDLE)_beginthread( myThread2, 0, (void*)(array) );\n            hThread[3] = (HANDLE)_beginthread( myThread3, 0, (void*)(array) );\n\n            //waits for threads to finish before continuing\n            WaitForMultipleObjects(4, hThread, TRUE, INFINITE);\n\n            //closes handles I guess?\n            CloseHandle( hThread[0] );\n            CloseHandle( hThread[1] );\n            CloseHandle( hThread[2] );\n            CloseHandle( hThread[3] );\n\n        //dump array into calculations\n        //average array into fHolder\n\n            for (int p = 0; p &lt; size; p++)\n             {\n                counter += array[p] == 2 ? 1 : -1;\n                //cout &lt;&lt; counter &lt;&lt; endl;\n                //cout &lt;&lt; count &lt;&lt; endl;\n                //cout &lt;&lt; p &lt;&lt; endl;\n                counter = count + counter;\n\n                //divide into an exportable value\n                //divides by 1,000,000, because each thread handles 250,000\n                //cout &lt;&lt; \"Value \" &lt;&lt; x &lt;&lt; \": \" &lt;&lt; array[x] &lt;&lt; endl;\n            }\n            fHolder = counter / size;\n\n\n        cout &lt;&lt; \"Final Count: \" &lt;&lt; counter &lt;&lt; endl;\n        cout &lt;&lt; \"fHolder: \" &lt;&lt; fHolder &lt;&lt; endl;\n        myfile &lt;&lt; fHolder &lt;&lt; endl;\n\n\n    }\n\n\n\n}\nvoid myThread0 (void *param)\n{\n    //EnterCriticalSection(&amp;cs1); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 0; x &lt; 25000; x++)\n    {\n        i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs1); // release the critical section object\n\n}\n\nvoid myThread1 (void *param)\n{\n    //EnterCriticalSection(&amp;cs2); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 25000; x &lt; 50000; x++)\n    {\n        //param[x] = rand() % 2 + 1;\n        i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs2); // release the critical section object\n\n}\n\nvoid myThread2 (void *param)\n{\n    //EnterCriticalSection(&amp;cs3); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 50000; x &lt; 75000; x++)\n    {\n        i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs3); // release the critical section object\n\n}\n\nvoid myThread3 (void *param)\n{\n    //EnterCriticalSection(&amp;cs4); //aquire the critical section object\n\n    int *i = (int *)param;\n\n    for (int x = 75000; x &lt; 100000; x++)\n    {\n        i[x] = rand() % 2 + 1;\n        //cout &lt;&lt; i[x] &lt;&lt; endl;\n    }\n    //LeaveCriticalSection(&amp;cs4); // release the critical section object\n\n}\n</code></pre>\n"},{"tags":["c#","multithreading","timer","directx","game-engine"],"answer_count":1,"favorite_count":0,"up_vote_count":9,"down_vote_count":1,"view_count":145,"score":8,"question_id":12868080,"title":"Game programming and quantity of timers","body":"<p>I've made a simple 2D game engine using C# and DirectX and it's fully functional for the demo I made to test it. I have a <code>Timer</code> object that uses <code>QueryPerformanceCounter</code> and I don't know what's the better choice: use only one timer in the game loop to update everything in the game, or an independent timer in every object that needs one.</p>\n\n<p>My worry is that when I try to implement threads, what will happen with timers? What happens with the sync?</p>\n"},{"tags":["android","multithreading","button","view","timer"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":12658,"score":2,"question_id":3392147,"title":"android set visibility of a button on timer","body":"<p>I have an app that shows a disclaimer at the beginning of the program. I want a button to remain invisible for a set amount of time, and then become visible.\nI set up a thread that sleeps for 5 seconds, and then tries to make the button visible. However ,I get this error when I execute my code:</p>\n\n<p>08-02 21:34:07.868: ERROR/AndroidRuntime(1401): android.view.ViewRoot$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.</p>\n\n<p>How can I count 5 seconds, and then make the button visible?\nTHanks.</p>\n\n<pre><code>Thread splashTread = new Thread() {\n           @Override\n           public void run() {\n            try {\n                   int waited = 0;\n                   while(_active &amp;&amp; (!_ok2)) {\n                       sleep(100);\n                       if(_active) {\n                           waited += 100;\n                           if(waited &gt;= _splashTime)\n                           {\n                            turnButtonOn();\n                           }\n\n                       }\n                   }\n               } catch(InterruptedException e) {\n                   // do nothing\n               } finally {\n                   finish();\n                   startActivity(new Intent(\"com.lba.mixer.Choose\"));\n\n               }\n    };\n    splashTread.start();\n\n\n      public static void turnButtonOn() {\n</code></pre>\n\n<p>okButton.setVisibility(View.VISIBLE);\n }</p>\n"},{"tags":["arrays","multithreading","semaphore","progress","percentage"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12871384,"title":"Reading array from threads, c, cygwin","body":"<p>I'm pretty new to threads and would like some insight. I'm trying to get the percentage each thread has completed for its calculation. Each thread will report its percentage to a different element of the same array. I have this working with <code>pthread_join</code> immediately after <code>pthread_create</code> and a separate thread for reading all the values of the array and printing the percentage but when I have all threads running after each other without waiting for the previous one to finish I get some weird behavior. This is how I'm accessing the shared (global) array.</p>\n\n<pre><code>//global\nint *currentProgress;\n//main\n    currentProgress = malloc(sizeof(int)*threads);\n    for(i=0; i&lt;threads; i++)\n        currentProgress[i] = 0;\n//child threads\ncurrentProgress[myId] = (int)percent; //myId is unique\n\n//progress thread\nfor(i=0; i&lt;threads; i++)\n    progressTotal += currentProgress[i];\nprogressTotal /= threads;\nprintf(\"Percent: %d\", progressTotal);\n</code></pre>\n\n<p>This is essentially the code I think is not being used correctly for multi-threads. When I print out the state of the shared array, I notice that as soon as another thread starts accessing the array (different element though), the previous element immediately goes to some random number... <code>-2147483648</code> and when the latter element finishes the prior element continues like normal. Should I be using semaphores for this? I thought I could access different elements of an array at the same time and I thought reading them wasn't an issue.</p>\n\n<p>This is the entire code:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;string.h&gt;\n\n#define STDIN 0\n\n\nint counter = 0;\nuint64_t *factors;\nvoid *getFactors(void *arg);\nvoid *deleteThreads(void *arg);\nvoid *displayProgressThread(void *arg);\nint *currentProgress;\n\nstruct data\n{\n    uint64_t num;\n    uint64_t incrS;\n    uint64_t incrF;\n    int threads;\n    int member;\n} *args;\n\nint main(int argc, char *argv[])\n{\n\n    if(argc &lt; 3) {printf(\"not enough arguments\"); exit(1);}\n\n    int i;\n    int threads = atoi(argv[2]);\n    pthread_t thread_id[threads];\n    pthread_t dThread;\n\n    currentProgress = malloc(sizeof(int)*threads);\n    for(i=0; i&lt;threads; i++)\n        currentProgress[i] = 0;\n\n    args = (struct data*)malloc(sizeof(struct data));\n    args-&gt;num = atoll(argv[1]);\n    args-&gt;threads = threads;\n\n    uint64_t increment = (uint64_t)sqrt((uint64_t)args-&gt;num)/threads;\n    factors = (uint64_t*)malloc(sizeof(uint64_t)*increment*threads);\n\n    pthread_create(&amp;dThread, NULL, displayProgressThread, (void*)args);\n\n    //for the id of each thread\n    args-&gt;member = 0;\n    for(i=0; i&lt;threads; i++)\n    {\n            args-&gt;incrS = (i)*increment +1;\n            args-&gt;incrF = (i+1)*increment +1;\n            pthread_create(&amp;thread_id[i], NULL, getFactors, (void*)args);\n            usleep(5);\n    }\n\n    for(i=0; i&lt;threads; i++)\n    {\n        pthread_join(thread_id[i], NULL);\n    }\n    sleep(1);\n    printf(\"done\\n\");\n    for (i=0; i&lt;counter; i++)\n        printf(\"\\n%llu : %llu\", factors[++i], factors[i]);\n    return 0;\n}\n\nvoid *getFactors(void *arg)\n{\n    uint64_t  count;\n    int myId;\n    int tempCounter = 0, i;\n    struct data *temp = (struct data *) arg;\n    uint64_t number = temp-&gt;num;\n    float total = temp-&gt;incrF - temp-&gt;incrS, percent;\n\n    myId = temp-&gt;member++;\n\n    pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);\n    pthread_setcanceltype(PTHREAD_CANCEL_ASYNCHRONOUS, NULL);\n\n    for(count=temp-&gt;incrS; count&lt;=temp-&gt;incrF; count++)\n    {\n\n        percent = (float)(count-temp-&gt;incrS)/total*100;\n        currentProgress[myId] = (int)percent;\n\n        if (number%count == 0)\n         {\n                factors[counter++] = count;\n                factors[counter++] = number/count;\n         }   \n        usleep(1);\n    }\n    usleep(1);\n    pthread_exit(NULL);\n}\n\nvoid *displayProgressThread(void *arg)\n{\n    struct data *temp = (struct data *) arg;\n    int toDelete = 0;\n    while(1)\n    {\n        int i;\n        int progressTotal = 0;\n        char *percent = malloc(sizeof(char)*20);\n        for(i=0; i&lt;toDelete; i++)\n            printf(\"\\b \\b\");\n\n        for(i=0; i&lt;temp-&gt;threads; i++){\n            progressTotal += currentProgress[i];\n        }\n\n        progressTotal /= temp-&gt;threads;\n        printf(\"|\");\n        for(i=0; i&lt;50; i++)\n            if(i&lt;progressTotal/2)\n                printf(\"#\");\n            else\n                printf(\"_\");\n        printf(\"| \");\n        sprintf(percent, \"Percent: %d\", progressTotal);\n        printf(\"%s\", percent);\n        toDelete = 53 + strlen(percent);\n\n\nusleep(1000);\n    fflush(stdout);\n    if(progressTotal &gt;= 100)\n        pthread_exit(NULL);\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["c#","asp.net","multithreading","windows-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12872773,"title":"How can execute a function in every minute in windows service?","body":"<p>I want to best practise for this job.What is the best solution for run a function in every x minutes.</p>\n\n<p>using a timer or thread ?</p>\n\n<p>thx for your helps.</p>\n"},{"tags":["python","multithreading","qtwebkit"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12863412,"title":"How to use qtwebkit in python threads?","body":"<p>I'm trying to parse webpages generated by js with qtwebkit, I found an example of how to get page source:</p>\n\n<pre><code>import sys\nfrom PySide.QtGui import *\nfrom PySide.QtCore import *\nfrom PySide.QtWebKit import *\nclass Render(QWebPage):\n  def __init__(self, url):\n       self.app = QApplication(sys.argv)\n       QWebPage.__init__(self)\n       self.loadFinished.connect(self._loadFinished)\n       self.mainFrame().load(QUrl(url))\n       self.app.exec_()\n\n  def _loadFinished(self, result):\n       self.frame = self.mainFrame()\n       self.app.quit()\nurl = 'http://www.thesite.gov/search'\nr = Render(url)\nhtml = r.frame.toHtml()\n</code></pre>\n\n<p>But i don't know how to make it work in threads.\nSo, how to do this and if it's not possible - is there another fast way to get wepages generated by js?</p>\n"},{"tags":["c++","multithreading","return-value","function-pointers","tbb"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12871836,"title":"How to get return value from a function called which executes in another thread?","body":"<p>In the code:</p>\n\n<pre><code>    #include &lt;tbb/tbb.h&gt;\n\n    int GetSomething()\n    {\n        int something;\n        // do something\n        return something;\n    }\n\n    // ...\n    tbb::tbb_thread(GetSomething, NULL);\n    // ...\n</code></pre>\n\n<p>Here <code>GetSomething()</code> was called in another thread via its pointer. But can we get return value from <code>GetSomething()</code>? How?</p>\n"},{"tags":["c","multithreading","posix"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12871856,"title":"Runtime error- POSIX threads","body":"<p>I am trying to create threads with the pthread library. Compilation is fine with \n    gcc -o -pthread file file.c</p>\n\n<p>but when I run the code, I get a segmentation fault. I am not sure what the problem is. I tried to execute the code that was given in the textbook to try and learn but I am lost right now. Can anyone help? The code is below... very basic, yes but please hlep me out.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;pthread.h&gt;\n\nint sum;\nvoid *runner(void *param);\n\nint main (int argc, char *argv[])\n{\n    pthread_t tid;\n    pthread_attr_t attr;\n    //printf(\"Am I here..?\\n\");\n    if (argc!=2)\n    {\n        fprintf(stderr, \"usage: a.out ...\\n\");\n        return -1;\n    }\n\n    if (atoi(argv[1] &lt; 0))\n    {\n        fprintf(stderr, \"%d must be &gt;= 0\\n\", atoi(argv[1]));\n        return -1;\n    }\n\n\n\n    pthread_attr_init(&amp;attr);\n    pthread_create(&amp;tid, &amp;attr, runner, argv[1]);\n    pthread_join(tid, NULL);\n\n    printf(\"sum = %d\\n\", sum);\n}\n\nvoid *runner(void *param)\n{\n    extern int sum;\n    int i, upper=atoi(param);\n    sum=0;\n\n    for(i=1; i&lt;= upper; i++)\n        sum+=i;\n\n    pthread_exit(0);\n}\n</code></pre>\n"},{"tags":["ios","multithreading","gcd"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12871737,"title":"CFRunLoopPerformBlock vs dispatch_async","body":"<p>I have some calculation work on background thread, after that I need to update the transform of some calayer, I try use</p>\n\n<pre><code>dispatch_async(dispatch_get_main_queue(), ^{calayer.transform = newTransform});\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CFRunLoopPerformBlock(CFRunLoopGetMain(), kCFRunLoopCommonModes, ^(void) {calayer.transform = newTransform});\n</code></pre>\n\n<p>I just thought they are the same, \nbut I found the calayer worked much smooth(maybe?) when using dispatch_async.\nwhat is the different about these two functions?</p>\n"},{"tags":["c","multithreading","winapi","permissions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":12870916,"title":"how to change thread user in c?","body":"<p>I have a program with 2 threads. I want the first thread to be run under user permissions of USER_1, and the second under USER_2 of Windows. When I log in as USER_1, both threads have USER_1 permissions. How can I change the user of the thread!?</p>\n"},{"tags":["android","multithreading","android-layout","android-intent","android-widget"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12870496,"title":"Running ProgressDialog in Thread in Android","body":"<p>I want to run a ProgressDialog(Spinner) when I send and receive some packets in a bluetooth device when a button is pressed. Here is the code </p>\n\n<pre><code> button.setOnClickListener(new OnClickListener() {\n\n          public void onClick(View v) {\n\n\n          Handler handler = new Handler();\n          Runnable r=new Runnable()\n          {\n              public void run()\n              {\n                    dialog1 = ProgressDialog.show(Test.this, \"\",\n                           \"Receiving. Please wait...\", true);\n\n\n\n              }\n          };\n          handler.post(r);\n\n          blueToothServer.getDevicebyMac();\n          blueToothServer.rfSocket();\n          blueToothServer.cancelDiscovery();\n          blueToothServer.connectSocket();\n          //toastMessage(\"Socket connected\");\n          blueToothServer.ipstream();\n          blueToothServer.opStream();\n          blueToothServer.SendnRXDataToBTServer(2, \"some String\");\n          String Result1 = blueToothServer.response(1);\n          tv1.setText(\"Temperatue : \" + Result1);\n          dialog1.dismiss();\n }\n</code></pre>\n\n<p>But I'm not getting the ProgressDialog. But I can able to send and receive the packets. But when I comment the blueToothServer operations, I'm getting the progress dialog. Please explain me the situation where I can get both. Thank You.</p>\n"},{"tags":["java","multithreading","sftp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12866838,"title":"Multiple Threads downloading same file from sftp server","body":"<p>I have a system that, when files of a certain type are found, I download, encode, and upload them in a separate thread.</p>\n\n<pre><code>while(true) {\n    for(SftpClient c : clients) {\n        try {\n            filenames = c.list(\"*.wav\", \"_rdy_\");\n        } catch (SftpException e) {\n            e.printStackTrace();\n        }\n        if(filenames.size() &gt; 0) {\n            //AudioThread run() method handles the download, encode, and upload\n            AudioThread at = new AudioThread(filenames);\n            at.setNode(c.getNode());\n            Thread t = new Thread(at);\n            t.start();\n        }\n    }\n    try {\n        Thread.sleep(3000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>The run method from AudioThread</p>\n\n<pre><code>public void run() {\n    System.out.println(\"Running...\");\n    this.buildAsteriskMapping();\n    this.connectToSFTP();\n    ac = new AudioConvert();\n    this.connectToS3();\n\n    String downloadDir = \"_rough/\" + getNode() + \"/\" + Time.getYYYYMMDDDate() + \"/\";\n    String encodeDir = \"_completed\" + getNode() + \"/\" + Time.getYYYYMMDDDate() + \"/\";\n    String uploadDir = getNode() + \"/\" + Time.getYYYYMMDDDate() + \"/\";\n\n    System.out.println(\"Downloading...\");\n    try {\n        sftp.get(filenames, downloadDir);\n    } catch (SftpException e) {\n        //download failed\n        System.out.println(\"DL Failed...\");\n        e.printStackTrace();\n    }\n\n    System.out.println(\"Encoding...\");\n    try {\n        ac.encodeWavToMP3(filenames, downloadDir, encodeDir);\n    } catch (IllegalArgumentException | EncoderException e) {\n        System.out.println(\"En Failed...\");\n        e.printStackTrace();\n    }\n\n    System.out.println(\"Uploading...\");\n    try {\n        s3.upload(filenames, encodeDir, uploadDir);\n    } catch (AmazonClientException e) {\n        System.out.println(\"Up Failed...\");\n        e.printStackTrace();\n    }\n\n}\n</code></pre>\n\n<p>The download method:</p>\n\n<pre><code>public void get(ArrayList&lt;String&gt; src, String dest) throws SftpException {\n    for(String file : src) {\n        System.out.println(dest + file);\n        channel.get(file, dest + file);\n    }\n}\n</code></pre>\n\n<p>The encode method:</p>\n\n<pre><code>public void encodeWavToMP3(ArrayList&lt;String&gt; filenames, String downloadDir, String encodeDir) throws IllegalArgumentException, EncoderException {\n    for(String f : filenames) {\n        File wav = new File(downloadDir + f);\n        File mp3 = new File(encodeDir + wav.getName().replace(\".wav\", \".mp3\"));\n        encoder.encode(wav, mp3, attrs);\n    }\n}\n</code></pre>\n\n<p>The upload method:</p>\n\n<pre><code>public void upload(ArrayList&lt;String&gt; filenames, String encodeDir, String uploadDir)  throws AmazonClientException, AmazonServiceException {\n    for(String f : filenames) {\n        s3.putObject(new PutObjectRequest(bucketName, uploadDir, new File(encodeDir + f)));\n    }\n}\n</code></pre>\n\n<p>The issue is I keep downloading the same files (or about the same files) for every thread.  I want to add a variable for each client that holds the files that are being downloaded but I don't know how to remove the lists/filenames from this variable.  What would be a solution?  My boss would also like to only allow x amount of threads to run.</p>\n"},{"tags":["linux","multithreading","gdb","core","rhel5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":944,"score":0,"question_id":2311647,"title":"Not to Able analayze the Core dump issue for Multithreaded application.........(Help Required)","body":"<p>I am working on multhithreading application when ever the process dump it always generates core as shown below i am not able to understand where it is actually dumping.</p>\n\n<pre><code>GNU gdb Red Hat Linux (6.5-25.el5rh)\nCopyright (C) 2006 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"x86_64-redhat-linux-gnu\"...(no debugging symbols found)\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\n\n\nwarning: exec file is newer than core file.\nCore was generated by `multithreadprocess                                                                       '.\nProgram terminated with signal 11, Segmentation fault.\n#0  0x0000000000448f7a in std::ostream::operator&lt;&lt; ()\n(gdb) where\n0x000000000044bd32 in std::ostream::operator&lt;&lt; ()\n#1  0x0000000000450b21 in std::ostream::operator&lt;&lt; ()\n#2  0x000000000042eda9 in std::string::operator= ()\n#3  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#4  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\n(gdb)thread apply all bt \nThread 6 (process 11674):\n#0  0x000000305820a687 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\n#1  0x0000000000431140 in std::string::operator= ()\n#2  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#3  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\nThread 5 (process 11683):\n#0  0x000000305820cbfb in write () from /lib64/libpthread.so.0\n#1  0x0000000000449151 in std::ostream::operator&lt;&lt; ()\n#2  0x000000000043b74a in std::string::operator= ()\n#3  0x000000000046c3f4 in std::string::substr ()\n#4  0x000000000046e3c1 in std::string::substr ()\n#5  0x00000000004305a4 in std::string::operator= ()\n#6  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#7  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\nThread 4 (process 11744):\n#0  0x00000030576c5896 in poll () from /lib64/libc.so.6\n#1  0x0000000000474f1c in std::string::substr ()\n#2  0x000000000043b889 in std::string::operator= ()\n#3  0x0000000000474dbc in std::string::substr ()\n#4  0x00000000004306a5 in std::string::operator= ()\n#5  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#6  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\nThread 3 (process 11864):\n#0  0x000000305820a687 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\n#1  0x0000000000431140 in std::string::operator= ()\n#2  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#3  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\nThread 2 (process 11866):\n#0  0x000000305820a687 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\n#1  0x0000000000431140 in std::string::operator= ()\n#2  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#3  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n\nThread 1 (process 11865):\n#0  0x000000000044bd32 in std::ostream::operator&lt;&lt; ()\n#1  0x0000000000450b21 in std::ostream::operator&lt;&lt; ()\n#2  0x000000000042eda9 in std::string::operator= ()\n#3  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\n#4  0x00000030576ce3bd in clone () from /lib64/libc.so.6\n</code></pre>\n\n<p>If i give bt full it is showing like this</p>\n\n<pre><code>(gdb) bt full\n#0  0x000000000044bd32 in std::ostream::operator&lt;&lt; ()\nNo symbol table info available.\n#1  0x0000000000450b21 in std::ostream::operator&lt;&lt; ()\nNo symbol table info available.\n#2  0x000000000042eda9 in std::string::operator= ()\nNo symbol table info available.\n#3  0x00000030582062e7 in start_thread () from /lib64/libpthread.so.0\nNo symbol table info available.\n#4  0x00000030576ce3bd in clone () from /lib64/libc.so.6\nNo symbol table info available.\n</code></pre>\n"},{"tags":["c++","multithreading","openssl"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12835508,"title":"Create safe multi-threaded applications with OpenSSL","body":"<p>We have a c++ library that works with OpenSSL. \nThe OpenSSL is used to establish TLS connections.\nNow we want our library to support multi-threaded applications and acording OpenSSL documents we sae that we have to implement <a href=\"http://www.openssl.org/docs/crypto/threads.html\" rel=\"nofollow\">these callbacks</a>.<br>\nThis guideline is not enough clear, and I cannot understand how exactly I have to implement the callbacks functions.<br>\nI am looking for a a guideline that will explain me step by step what I have to do, does anyone can suggest me a good article or show me a snippet code demonstrates the code I have to write?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["python","multithreading","error-handling","automation"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":81,"score":1,"question_id":12868795,"title":"Is there a good way to split a python program into independent modules?","body":"<p>I'm trying to do some machinery automation with python, but I've run into a problem.</p>\n\n<p>I have code that does the actual control, code that logs, code the provides a GUI, and some other modules all being called from a single script.</p>\n\n<p>The issue is that an error in one module halts all the others. So, for instance a bug in the GUI will kill the control systems.</p>\n\n<p>I want to be able to have the modules run independently, so one can crash, be restarted, be patched, etc without halting the others.</p>\n\n<p>The only way I can find to make that work is to store the variables in an SQL database, or files or something.</p>\n\n<p>Is there a way for one python script to sort of ..debug another? so that one script can read or change the variables in the other? I can't find a way to do that that also allows to scripts to be started and stopped independently.</p>\n\n<p>Does anyone have any ideas or advice?</p>\n"},{"tags":["java","multithreading","swing","swingworker","event-dispatch-thread"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":84,"score":3,"question_id":12868514,"title":"Worker thread blocking GUI repaint","body":"<p>I'm trying to make a login screen for an application. During the login, many SQL calls will be made to a MySQL database, and it may take a few seconds to set everything up. I'd like to display a status screen via Card Layout and update a JLabel while the background thread is running.</p>\n\n<p>Here's the gist of what I have for my Worker Thread:</p>\n\n<pre><code>public class LoginPrepThread extends Thread {\n\n    private final UIMain parent;\n\n    public LoginPrepThread(UIMain w){\n        parent = w;\n    }\n\n    public void exec(){\n        EventQueue.invokeLater(this);\n    }\n\n    public void run(){\n        try{\n            //SqlHelper sql = SqlHelper.instance;\n            sleep(500);\n            parent.getLoadingLable().setText(\"Fetching preferences...\");\n            parent.getMainFrame().revalidate();\n            sleep(500);\n            parent.getLoadingLable().setText(\"Scanning workbench...\");\n            parent.getMainFrame().revalidate();\n            sleep(500);\n            parent.getLoadingLable().setText(\"Updating permissions...\");\n            parent.getMainFrame().revalidate();\n            sleep(500);\n            parent.getLoadingLable().setText(\"Finished...Please wait\");\n            parent.getMainFrame().revalidate();\n            sleep(1000);\n            parent.getLayout().show(parent.getMainFrame().getContentPane(), \"view.main\");\n        }catch(Exception e){\n\n        }\n    }\n\n}\n</code></pre>\n\n<p>Here is how I am calling it (Inside the event of a JButton, after authenticating):</p>\n\n<pre><code>setActiveProfile(user);\nlayout.show(frame.getContentPane(), \"view.loading\");\nframe.repaint();\nLoginPrepThread pt = new LoginPrepThread(thisTrick);\npt.exec();\n</code></pre>\n\n<p>I put some dummy events in for now, but the status label doesn't change...any suggestions?</p>\n"},{"tags":["ios","xcode","json","multithreading","asynchronous"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":12867246,"title":"Asynchronous JSON request","body":"<p>I have a table view that works fluidly until I add a URL request to the code.</p>\n\n<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{\n\n...\n   //Get Total Comments\n    NSString *strURL = [NSString stringWithFormat:@\"http://XX.XX.XX.XX/php/commentsTotal.php?CID=%@\", [dict objectForKey:@\"id\"]];\n    NSData *dataURL = [NSData dataWithContentsOfURL:[NSURL URLWithString:strURL]];\n\n\n// to receive the returend value\nNSString *strResultCI = [[NSString alloc] initWithData:dataURL encoding:NSUTF8StringEncoding];\ncell.commentCount.text = strResultCI;\n\n\nreturn cell;\n</code></pre>\n\n<p>}</p>\n\n<p>The issue is that as you scroll through the table cells, the phone has to communicate back to my server, wait for the response and then display it to the cell.<br>\nNeedless to say it has crippled my table performance.  My question is: Does anyone have a good example or tutorial on how to simply add a JSON data request to a background thread?  I am using SDWebImage to asynchronously handle the images, but don't know where to begin with the data portion. </p>\n"},{"tags":["c++","c","linux","multithreading","fork"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":108,"score":4,"question_id":12868724,"title":"Threads and fork(). How can I deal with that?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1235516/fork-in-multi-threaded-program\">fork in multi-threaded program</a>  </p>\n</blockquote>\n\n\n\n<p>If I have an application which employs fork() and might be developed as multithreaded, what are the thumb rules/guidelines to consider to safely program this kind of applications?</p>\n"},{"tags":["multithreading","delphi","event-handling","delphi-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":133,"score":0,"question_id":12861198,"title":"Delphi event handling without threads","body":"<p>I'm not a Delphi expert, and I have only a basic understanding of the flow of messages and the handling of events and callbacks. I'm trying to debug an application in D7 that need to combine the foreground procedure (initiated by a button click) with message reception and processing that occurs in the background (handled by a component). They both work properly independently, but when I combine them in one procedure, the message reception doesn't work. </p>\n\n<p>The existing application already has functioning procedures to send a message on a button click, and it can receive a message while running and not processing any buttons. </p>\n\n<p>The normal message reception is handled by a component, which calls my handler (OnInput) as an event. My handler puts the message in a ListBox.</p>\n\n<p>I am trying to write a procedure that sends a message, and waits for a response, in a loop. (pseudocode):</p>\n\n<pre><code>   for N := 0 to nsequence do begin\n       prevcount := ListBox1.items.count; \n       SendMessage(mymessage);  // request the response\n       sleep(500); // allow time for response to arrive\n       for 0 to timeout do begin\n           sleep(100); \n           application.processmessages;  {allow processing to handle incoming message}\n           if ListBox1.items.count &gt; prevcount then break;  {has the message arrived?}\n           end;\n       if ListBox1.items.count = prevcount then exit: {timeout -- fail}\n       end;\n</code></pre>\n\n<p>I think this should be able to be accomplished without threads, but the messages are never received. It always times out. </p>\n\n<p>Are component event handlers able to be called from application.processmessages? The input message works correctly when the application is running and idle, but does not when it is executing a procedure.  What else is required beyond a call to application.processmessages to cause the application to process messages and call the related procedures to handle them?</p>\n\n<p>To trace the incoming message, the path starts with a callback from Windows MMSystem. When the MIDI Input port is opened, the callback is set to point to a handler: procedure midiHandler</p>\n\n<p>In midiHandler, the event is put into a circular buffer: CircbufPutEvent( thisBuffer, @thisEvent). </p>\n\n<p>Then a message is posted back to the application: PostMessage(thisCtlInfo^.hWindow, mim_Data, 0, 0)</p>\n\n<p>That message is handled by: procedure TMidiInput.MidiInput( var Message: TMessage );\nWithin that procedure there is a call to: FOnMIDIInput(Self);</p>\n\n<p>These events are defined in the component's interface as:</p>\n\n<pre><code>{ Events }\nFOnMIDIInput: TNotifyEvent; { MIDI Input arrived }\n</code></pre>\n\n<p>under Published, we have:</p>\n\n<pre><code>{ Events }\nproperty OnMidiInput: TNotifyEvent read FOnMidiInput write FOnMidiInput;\nproperty OnOverflow: TNotifyEvent read FOnOverflow write FOnOverflow;\n</code></pre>\n\n<p>In the Object Inspector, the OnMidiInput event is linked to the procedure MIDIInput1MidiInput;</p>\n\n<p>The procedure MIDIInput1MidiInput first calls GetMidiEvent:</p>\n\n<pre><code>with (Sender As TMidiInput) do\n    begin\n    while (MessageCount &gt; 0) do\n        begin\n\n        { Get the event as an object }\n        thisEvent := GetMidiEvent;\n</code></pre>\n\n<p>GetMidiEvent reads the message out of the circular buffer. The MIDIInput1MidiInput procedure does some checking and validating, and ultimately stores the message in ListBox1.</p>\n\n<p>PS - the input component has a property that returns the count of queued messages in the circular buffer. I check it when the waiting loop times out, and it reports 0 messages. So the callback is apparently not getting to the midiHandler procedure.</p>\n"},{"tags":["android","multithreading","asynchronous","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12849231,"title":"AsyncTask stops after onPreExecute, after several runs","body":"<p>I have an <code>AsyncTask</code> in my program that seems to stop after <code>onPreExecute()</code>, after the app is run several times. What I mean is, I can use the app and everything works about 10-20 runs, but then it halts. Here is what's going on:</p>\n\n<pre><code>private class MyTask extends AsyncTask&lt;String, Void, Data&gt; {\n\n    protected void onPreExecute() {\n        // show loading dialog\n        Log.d(TAG, \"end onPreExecute\");\n    }\n\n    protected Data doInBackground(String... params) {\n        Log.d(TAG, \"start doInBackground\");\n        // do stuff\n    }\n\n    protected void onPostExecute(Data myData) {\n        // do stuff\n    }\n\n}\n</code></pre>\n\n<p>When it stops working, what happens is that the loading dialog just keeps loading forever, and <code>\"end onPreExecute\"</code> prints but <code>\"start doInBackground\"</code> does not.</p>\n\n<p>Why might that be?</p>\n"},{"tags":[".net","multithreading","exception","process","terminate"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":12868197,"title":"Process not terminated when exception occured in thread c#","body":"<p>I have a System.Timers.Timer and I found out that in the ElapsedEventHandler an exception sometimes occured but the process did <em>not</em> die but the thread executing the ElapsedEventHandler died quitly where exception occured. Not good since I then wasn't aware about the exception. Why isn't the process terminated? How could I get the process terminated in best way in case an exception occurs in the ElapsedEventHandler?</p>\n\n<p>I tried similar using a System.Threading.Timer and then the process terminated.\nCan you explain the difference?</p>\n\n<p>Complete code below:</p>\n\n<pre><code>class Program\n{\n    static public void DoBad()\n    {\n        Console.WriteLine(\"DoBad enter\");\n        string s = \"hello\";\n        object o = s;\n        int i = (int)o; // Ops! Something unexpected happend here... Exception\n        Console.WriteLine(\"DoBad exit\");\n    }\n\n    static void DoIt1(object sender, System.Timers.ElapsedEventArgs e)\n    {\n        Console.WriteLine(\"\\nDoIt1 enter\");\n        DoBad(); // Process is NOT terminated when excpetion occurs in DoBad, thread just dies quietly but process continues. Why is process not terminated?\n        Console.WriteLine(\"DoIt1 exit\");\n    }\n\n    static void Test1()\n    {\n        System.Timers.Timer t = new System.Timers.Timer(2000);\n        t.Elapsed += new System.Timers.ElapsedEventHandler(DoIt1);\n        t.Enabled = true;\n    }\n\n    static public void DoIt2(Object o)\n    {\n        Console.WriteLine(\"\\nDoIt2 enter\");\n        DoBad(); // Process terminated when exception occurs in DoBad.\n        Console.WriteLine(\"DoIt2 exit\");\n    }\n\n    static void Test2()           \n    {\n        System.Threading.Timer timer = new System.Threading.Timer(DoIt2, null, 0, 2000);\n    }\n\n    static void Main(string[] args)\n    {\n        Test1(); // Process NOT terminated when exception occurs in DoBad\n        // Test2(); // Process terminated when exception occurs in DoBad\n\n        // Why is process NOT terminated when running Test1 (but terminated when running Test2)?\n        // Want process to die. How to do it in best way?\n\n        Console.WriteLine(\"Main Sleep\");\n        System.Threading.Thread.Sleep(11000);\n        Console.WriteLine(\"Main Slept\");\n    }\n}\n</code></pre>\n\n<p>/ Thanks!</p>\n"},{"tags":["c#","multithreading","locking","mutex"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12867582,"title":"lock (objectReference) { } isn't locking critical section","body":"<p>I have a multidimensional array with mutexes, and I use them so some critical sections. At the end is sketch of my class.</p>\n\n<p>Now, I tried to add and delete characters in different threads without stopping, and at the same time getting characters from another thread to test if my server will work properly, but I get an exception when I try to get a character that says something like this: \"Collection was modified during foreach..\"</p>\n\n<p>Anyone knows why? I have read the documentation of the lock statement in MSDN and it should work, I don't know what I am doing wrong. Maybe <code>new object[]</code> can't be used as a mutex?</p>\n\n<p>If <code>lock(objectReference)</code> shouldn't be used in this case, what should I use instead?</p>\n\n<p>Sketch of my class:</p>\n\n<pre><code>partial class MapCharacter\n{\n    public MapCharacter()\n    {\n        mutexes = new object[5, 5];\n        for (int x = 0; x &lt; 5; x++)\n        {\n            for (int y = 0; y &lt; 5; y++)\n            {\n                mutexes[x, y] = new object();\n            }\n        }\n    }\n\n    object[,] mutexes;\n\n    public object RequestMutex(int x, int y)\n    {\n        return mutexes[x, y];\n    }\n\n    public void RemoveCharacter(Character characterToRemove)\n    {\n        lock (RequestMutex(characterToRemove.X, characterToRemove.Y))\n        {\n            loggedCharacters.Remove(characterToRemove);\n        }\n    }\n\n    public void AddCharacter(Character characterToAdd)\n    {\n        lock (RequestMutex(characterToRemove.X, characterToRemove.Y))\n        {\n            loggedCharacters.Add(characterToAdd);\n        }\n    }\n\n    public Character[] GetCharacters(int x, int y)\n    {\n        lock (RequestMutex(characterToRemove.X, characterToRemove.Y))\n        {\n            foreach (var charact in loggedCharacters)\n            {\n                // exception here\n            }\n        }\n    }\n\n    // more methods that use the mutex when trying to remove/add/modify characters\n}\n</code></pre>\n"},{"tags":["c#","multithreading",".net-4.0"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12866512,"title":"passing lists to threads","body":"<p>I have a method that accepts a <code>List&lt;int&gt;</code> called <code>DoWork</code>.  I have a <em>huge</em> <code>List&lt;int&gt; Ids</code>.  I split the huge list into 4 sub lists:</p>\n\n<pre><code>List&lt;List&lt;int&gt;&gt; t = (List&lt;List&lt;int&gt;&gt;)SplitColumn&lt;int&gt;(Ids);\n</code></pre>\n\n<p>(<code>SplitColumn</code> is slightly modified from the answer to <a href=\"http://stackoverflow.com/questions/11670325/how-to-split-into-sublists-using-linq\">splitting a list into sub lists</a>).</p>\n\n<p>I paused the program and inspected <code>t</code> with the debugger and it is four lists divided exactly as I would expect.</p>\n\n<p>Then, what I'm trying to do is spawn four threads (one for each sublist).  The part I'm having trouble with is passing the four lists.  I am getting out of bounds problems, I'm not sure what's going on here:</p>\n\n<pre><code>        List&lt;Thread&gt; threads = new List&lt;Thread&gt;();\n\n        for(int i = 0; i &lt; t.Count; i++) \n        {\n            threads.Add(new Thread(() =&gt; DoWork(t[i])));\n        }\n\n        foreach (Thread thread in threads)\n        {\n            thread.Start();\n        }\n\n\n        foreach (Thread thread in threads)\n        {\n            thread.Join();\n        }\n</code></pre>\n"},{"tags":["multithreading","webserver","threadpool"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":4941971,"title":"Improving performance of web server","body":"<p>I was recently asked this question in an interview. It was open-ended question on web-server design. Herez the gist of the question. </p>\n\n<p>\"Queues quite often become a bottle neck for applications like web servers. What changes will you make to your thread handling classes, thread pool and queues to improve any bottle neck?\"</p>\n\n<p>I pointed out measures like\n1. Thread pool management\n2. Using buffers and packets in queues.</p>\n\n<p>But the interviewer was not quite satisfied. What all design measures should I have mentioned? Obviously its an open-ended question, so answer doesn't have to depend on the underlying technology like Spring, J2EE etc. </p>\n\n<p>In case there is good tutorial on server design, please share it.</p>\n"},{"tags":[".net","multithreading","exception","timeout","serial-port"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12865784,"title":"System.IO.Ports.SerialPort using Thread and TimeOutException","body":"<p>I am using Delphi Prism (.NET) to write my program with. Now that I am testing my application, it is not running as expected. I am using .net system.io.port.serialport to communicate with an external devices that sends serial data back to the computer for a request from a computer. It is supposed to continuously talk back and forth on the serialport. The problem is not being able to read data on the computer at about the right time. My program keeps either timing out or it is capturing wrong sets of messages or data in the input buffer. Thus, I am never getting good data or communication but timeouts and checksum errors. I also implemented the SerialErrorRecieved event. For some odd reason, it is always being triggered for each and every transmission and receive. It keeps returning with RXPartiy fault.</p>\n\n<p>I really want to use DataRecieved serialport event for this. So, that it will only be called whenever there is data to read at about the right time. However, I won't be able to\ntrigger on timeouts in that case and take an appropriate actions for it. I am loosing my mind as to how to solve my problem. </p>\n\n<p>I am using Thread for the serial communication as follows.</p>\n\n<pre><code>method DXcomm.mythread;\nbegin\n    while true do\n    begin\n        Thread.Sleep(ScanTime);\n        SerialPort1.DiscardOutBuffer;\n        SerialPort1.DiscardInBuffer;\n        SerialPort1.RtsEnable:=true;\n        SendMessage;\n        while SerialPort1.BytesToWrite&gt;0 do;\n        thread.Sleep(10);\n        SerialPort1.RtsEnable:=false;\n        thread.Sleep(5);\n\n        try\n            SerialPort1.Read(RxMsg,0,5);\n            thread.Sleep(5);\n            if changeFlag then\n            begin\n                changeList.IncRxCnt;\n                FixUpChangeList;\n            end\n            else\n                ActiveUnit.Retreive;\n        except on ex: TimeOutException do\n            ActiveUnit.Timeout;\n        end;\n    end;\nend;\n</code></pre>\n\n<p>if anyone can give me sample code or hints or clues, I would appreciated. Thank you.</p>\n"},{"tags":["c#","multithreading","visual-studio-2010","gui","listbox"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":1,"view_count":67,"score":2,"question_id":12865512,"title":"multithread with access to \"shared\" listbox","body":"<p>the problem is simple I have GUI c#/xaml app and I want to run GUI in one thread and some method ( infinite loop ) in another thread.\nAnd I need to modify element in GUI ( listbox ) from second thread. \nI tried create global variable and some other tips from web, but nothing run well.</p>\n\n<p>now I have something like:</p>\n\n<pre><code>public delegate void InvokeDelegate(listdata Mujlist);\n//in global scope\n// and in Window class\npublic void UpdateList(listdata Mujlist)\n{\n    mujlistbox.DataContext = Mujlist;\n}\n// and in the second thread this\nobject[] obj = new object[1];\nobj[0] = Mujlist;\nmujlistbox.BeginInvoke(new InvokeDelegate(UpdateList), obj);\n</code></pre>\n\n<p>this maybe do a job well, BUT I can't try this, because VS 2010 find error</p>\n\n<pre><code>Error 1 'System.Windows.Controls.ListBox' does not contain a definition for 'BeginInvoke' and no extension method 'BeginInvoke' accepting a first argument of type 'System.Windows.Controls.ListBox' could be found (are you missing a using directive or an assembly reference?)   D:\\..\\MainWindows.xaml.cs 85 28 WPFChat\n</code></pre>\n\n<p>BUT System.Windows.Forms <strong>have</strong> this <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.aspx\" rel=\"nofollow\">method</a>, so I am confused with <a href=\"http://msdn.microsoft.com/en-us/library/system.windows.controls.listbox.aspx\" rel=\"nofollow\">this</a>.</p>\n\n<p>So, question is How can I simply update a listbox in \"GUI thread\" from child thread?</p>\n\n<p>Where do I mistakes? Is there better way how do this? How?</p>\n"},{"tags":["c#","multithreading","list","exception","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":93,"score":0,"question_id":12865321,"title":"How do I use a List<T> in multiple threads?","body":"<p>It seems like I am getting threading errors as a result of an inconsistent state of my <code>IEnumerable</code>.  Specifically, <code>List&lt;T&gt;</code>.</p>\n\n<p>Here's my workflow:</p>\n\n<pre><code>List&lt;string&gt; IDs = getIDs();\nRunTask(IDs);\nRunTask(IDs);\n\npublic void RunTask(List&lt;string&gt; IDs)\n{\n    TaskScheduler scheduler = new TaskScheduler();\n    TaskFactory factory = new TaskFactory(scheduler);\n    var tasks = IDs.Select(name =&gt; factory.StartNew(() =&gt; action(name))).ToArray();\n    Task.WaitAll(tasks);\n}\n</code></pre>\n\n<p>I am getting a generic error on my <code>WaitAll()</code> call.</p>\n\n<p>My thinking is that I am getting some sort of unsynchronized IEnumerator, and that I need to make a copy of my <code>List</code> via <code>Array.CopyTo()</code>, then pass it into my multiple threads.</p>\n\n<p>This is my exception:</p>\n\n<pre><code>Error: One or more errors occurred.\nOne or more errors occurred.\nat System.Threading.Tasks.Task.WaitAll(Task[] tasks, Int32 millisecondsTimeout, CancellationToken cancellationToken)\nat System.Threading.Tasks.Task.WaitAll(Task[] tasks, Int32 millisecondsTimeout)\nat System.Threading.Tasks.Task.WaitAll(Task[] tasks)\n</code></pre>\n\n<p>Any thoughts on this matter?</p>\n"},{"tags":["c#","multithreading","backgroundworker"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":12863739,"title":"How do i call a list from another class into background worker in C#","body":"<p>How can I call a list from another class into my <code>backgroundWorker1</code> object?  I can't call my list Begin to <code>backgroundWorker1_RunWorkerCompleted</code>?  It works for <code>backgroundWorker1_ProgressChanged</code>, so why not both?</p>\n\n<p>The error is \nObject reference not set to an instance of the object pointing at Begins[1]</p>\n\n<pre><code>   public class Words\n{\n    // Object to store the current state, for passing to the caller. \n    public class CurrentState\n    {\n        public int LinesCounted;\n        public int WordsMatched;\n        public int CurrentPosition;\n        public List&lt;long&gt; Begin = new List&lt;long&gt;();\n    }\n\n    public string SourceFile;\n    public string CompareString;\n    private int WordCount;\n    private int LinesCounted;\n\n\n    public void CountWords(\n        System.ComponentModel.BackgroundWorker worker,\n        System.ComponentModel.DoWorkEventArgs e)\n    {\n        // Initialize the variables.\n        CurrentState state = new CurrentState();\n        string line = \"\";\n        int elapsedTime = 20;\n        DateTime lastReportDateTime = DateTime.Now;\n\n        if (CompareString == null ||\n            CompareString == System.String.Empty)\n        {\n            throw new Exception(\"CompareString not specified.\");\n        }\n\n        // Open a new stream. \n        //using (System.IO.StreamReader myStream = new System.IO.StreamReader(SourceFile))\n        using (myStreamReader myStream = new myStreamReader(SourceFile))\n        {\n            // Process lines while there are lines remaining in the file. \n            while ((line = myStream.ReadLine()) != null)//!myStream.EndOfStream)\n            {\n                //worker.RunWorkerCompleted(state);\n                if (worker.CancellationPending)\n                {\n                    e.Cancel = true;\n                    break;\n                }\n                else\n                {\n                    //line = myStream.ReadLine();\n                    WordCount += CountInString(line, CompareString);\n                    LinesCounted += 1;\n\n                    //state.CurrentPosition = myStream.BytesRead;\n                    state.fixBegin.Add(myStream.BytesRead);\n                    // Raise an event so the form can monitor progress. \n                    int compare = DateTime.Compare(\n                        DateTime.Now, lastReportDateTime.AddMilliseconds(elapsedTime));\n                    if (compare &gt; 0)\n                    {\n                        state.LinesCounted = LinesCounted;\n                        state.WordsMatched = WordCount;\n                        worker.ReportProgress(0, state);\n                        lastReportDateTime = DateTime.Now;\n                    }\n                }\n                // Uncomment for testing. \n                //System.Threading.Thread.Sleep(5);\n            }\n\n            // Report the final count values.\n            state.LinesCounted = LinesCounted;\n            state.WordsMatched = WordCount;\n            worker.ReportProgress(0, state);\n        }\n    }\n\n\n    private void backgroundWorker1_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n    {\n        // This event handler is called when the background thread finishes. \n        // This method runs on the main thread. \n        if (e.Error != null)\n            MessageBox.Show(\"Error: \" + e.Error.Message);\n        else if (e.Cancelled)\n            MessageBox.Show(\"Word counting canceled.\");\n        else\n            MessageBox.Show(\"Finished counting words.\" );\n    }\n\n    private void backgroundWorker1_ProgressChanged(object sender, ProgressChangedEventArgs e)\n    {\n        // This method runs on the main thread.\n\n        Words.CurrentState state =\n            (Words.CurrentState)e.UserState;\n\n        this.LinesCounted.Text = state.LinesCounted.ToString();\n        this.WordsCounted.Text = state.WordsMatched.ToString();\n    }\n\n    private void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)\n    {\n        // This event handler is where the actual work is done. \n        // This method runs on the background thread. \n\n        // Get the BackgroundWorker object that raised this event.\n        System.ComponentModel.BackgroundWorker worker;\n        worker = (System.ComponentModel.BackgroundWorker)sender;\n\n        // Get the Words object and call the main method.\n        Words WC = (Words)e.Argument;\n        WC.CountWords(worker, e);\n    }\n\n    private void StartThread()\n    {\n        // This method runs on the main thread. \n        this.WordsCounted.Text = \"0\";\n\n        // Initialize the object that the background worker calls.\n        Words WC = new Words();\n        WC.CompareString = this.CompareString.Text;\n        //WC.SourceFile = this.SourceFile.Text;\n        WC.SourceFile = \"test.log\";\n\n        // Start the asynchronous operation.\n        backgroundWorker1.RunWorkerAsync(WC);\n    }\n\n    private void Start_Click(object sender, EventArgs e)\n    {\n        StartThread();\n    }\n\n    private void Cancel_Click(object sender, EventArgs e)\n    {\n        // Cancel the asynchronous operation. \n        this.backgroundWorker1.CancelAsync();\n    }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12864846,"title":"Working with multiple threads in Java","body":"<p>I'm trying to make a multithread program that acts as a furniture factory... For example, it needs to have 3 nails, 2 pieces of wood and 1 piece of glue to make 1 table. I made the glue, wood and nail classes (as extensions of Thread class)</p>\n\n<p>Now, the way I made it, it has no compiling errors, but when it runs, I get an IlegalThreadState exception at the thread.start(). Here's my Main()</p>\n\n<pre><code>public class Main \n{\npublic static int mueble = 0; \npublic static void main(String[] args) throws InterruptedException \n{\n    Semaphore smain = new Semaphore(1);\n    Madera m = new Madera();\n    Formica f = new Formica();\n    Clavo c = new Clavo();\n    boolean b = true;\n    while(b)\n    {\n        Random rand = new Random();\n        int r = (int)(rand.nextDouble()*6+0);\n        if(r &lt; 1)\n        {\n            smain.acquire();\n            f.start();\n        }\n        else if ((r&gt;1)&amp;&amp;(r&lt;3))\n        {\n            smain.acquire();\n            m.start();\n        }\n        else \n        {\n            smain.acquire();\n            c.start();\n        }\n        if (mueble == 30)\n        {\n            b = false;\n        }\n        smain.release();\n    }\n\n}\n}\n</code></pre>\n\n<p>Don't mind the spanish.\nI think the problem might be in the run() section of each thread, here it is (it's pretty much the same for the three classes)</p>\n\n<pre><code>@Override\npublic void run()\n{\n    try {\n        sclavo.acquire();\n        System.out.println(\"Llega 1 clavo\");\n        System.out.println(\"Hay \" + (3-sclavo.availablePermits()) + \" clavo(s)\");\n        if((sclavo.availablePermits()==0)&amp;&amp;(Madera.smadera.availablePermits()==0)&amp;&amp;(Formica.sformica.availablePermits()==0))\n                {\n                    System.out.println(\"Se ha creado 1 mueble\");\n                    Main.mueble++;\n                    System.out.println(\"Hay\" + Main.mueble + \"mueble(s)\");\n                    Formica.sformica.release(1);\n                    sclavo.release(3);\n                    Madera.smadera.release(2);\n                }\n    } catch (InterruptedException ex) {\n        Logger.getLogger(Clavo.class.getName()).log(Level.SEVERE, null, ex);\n    }\n}\n</code></pre>\n\n<p>Any help would be great!</p>\n"},{"tags":["asp.net","multithreading","exception","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12848848,"title":"Throwing an Exception In a ASP.NET Thread To Bring Down IIS","body":"<p>I am doing a code review and found this piece of code.  Does throwing an exception inside a thread bring down IIS?  Read the comments.</p>\n\n<pre><code>         Thread unhandledExceptionThread = new System.Threading.Thread(new System.Threading.ThreadStart(delegate()\n         {\n              System.Threading.Thread.Sleep(90 * 1000);\n              throw new ApplicationException(\"Thread 1\");\n         }));\n         unhandledExceptionThread.Name = \"IntentionalCrasher\";\n         Thread environmentExitThread = new System.Threading.Thread(new System.Threading.ThreadStart(delegate()\n         {\n              System.Threading.Thread.Sleep(100 * 1000);\n              Environment.Exit(-500);\n         }));\n         environmentExitThread.Name = \"Thread 2\";\n         unhandledExceptionThread.Start();\n         environmentExitThread.Start();\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":400,"score":1,"question_id":1091655,"title":"MultiThreading and Deadlock","body":"<p>suggest me any real time situations in which i'm supposed to create multiple threads,and then introduce a deadlock situation.this is kind of a project!!! can u ppl help to make the application more interestin with some real time situation</p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12845881,"title":"Java - splitting work to multiple threads","body":"<p>I am posed with the following problem: I need to split work across multiple threads for perfomance reasons, but I am not sure what approach to take.</p>\n\n<p>Firstly, the task I would be supplying should return a value and take a parameter. Additionally, the main method (doing the main bit of work, not <code>static main()</code> ) is already running on separate thread and is invoked periodically. Also, this method must at some point WAIT for all threads to finish and then proceed.</p>\n\n<p>One approach (most obvious to me) is to schedule each job on a separate thread and store results in class vars:</p>\n\n<pre><code>public Object result1, result2;\n\npublic void mainMethod() throws InterruptedException {\n    final Thread thread = new Thread(new Runnable() {\n        @Override\n        public void run() {\n            result1 = expensiveMethod(\"param1\");\n        }\n    });\n\n    final Thread thread1 = new Thread(new Runnable() {\n        @Override\n        public void run() {\n            result2 = expensiveMethod(\"param2\");\n        }\n    });\n\n    thread1.join();\n    thread.join();\n\n    //Do rest of work\n}\n\nprivate Object expensiveMethod(Object param){\n    // Do work and return result\n}\n</code></pre>\n\n<p>This is a bit ugly and not ideal, since as I said, mainMethod is invoked many times, and I do not want any race conditions on setting the result variables. Ideally, I would like to make them local variables, but I cannot make them accessible from within the run method, unless they are final, and then I cannot assign values to them...</p>\n\n<p>ANother approach i though about doing was this:</p>\n\n<pre><code>public void mainMethod() throws InterruptedException, ExecutionException {\n    String obj1, obj2;\n\n    final ExecutorService executorService = Executors.newFixedThreadPool(16);\n    final Future&lt;String&gt; res1 = executorService.submit(new Callable&lt;String&gt;() {\n        @Override\n        public String call() throws Exception {\n            return expensiveMethod(\"param1\");\n        }\n    });\n    final Future&lt;String&gt; res2 = executorService.submit(new Callable&lt;String&gt;() {\n        @Override\n        public String call() throws Exception {\n            return expensiveMethod(\"param2\");\n        }\n    });\n\n    obj1 = res1.get();\n    obj2 = res2.get();\n\n}\n\nprivate String expensiveMethod(String param) {\n    // Do work and return result\n}\n</code></pre>\n\n<p>This automatically waits on these two computations from main method and allows me to store the results locally. What to you guys think? Any other approaches?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1674,"score":1,"question_id":862637,"title":"busy wait threads in java","body":"<p>I have an assignment with threads and I cant have the threads go into busy wait state.\nHow do I know if a thread is in blocking state or in busy wait? Is there a command that checks it?</p>\n\n<p>In the program I have 2 matrices and I need to transform them. So I have a transform thread and the code is as follows:</p>\n\n<pre><code>transformThread transformThreadFirst = new transformThread(firstMat, n);\ntransformThread transformThreadSecond = new transformThread(secondMat, n);\n\ntransformThreadFirst.start();\ntransformThreadSecond.start();\n\ntry\n{\n    transformThreadFirst.join();\n    transformThreadSecond.join();\n}\ncatch(InterruptedException e)\n{\n}\n</code></pre>\n\n<p>Any of the threads will be in busy wait or is it ok? Or you have a better solution?\nAlso in the run of the transformThread I do not use any yield, just 2 for loops and thats it, just the transform action..</p>\n"},{"tags":["c#","multithreading","exception-handling"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2345,"score":4,"question_id":5983779,"title":"catch exception that is thrown in different thread","body":"<p>One of my method (<code>Method1</code>) spawns a new thread. \nThat thread execute a method (<code>Method2</code>) and during exectution an exception is thrown.\nI need to get that exception information on the calling method (<code>Method1</code>)</p>\n\n<p>Is there someway I can catch this exception in <code>Method1</code> that is thrown in <code>Method2</code>?</p>\n"},{"tags":["java","multithreading","unit-testing"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12861330,"title":"Unit testing blocking processes","body":"<p>I have a worker processes working on a data queue. A <code>training worker</code> reads and processes data from the <code>training queue</code>. It continues to poll and on the look out for new data written to the queue.</p>\n\n<p>I have implemented the worker as follows:</p>\n\n<pre><code>public static void main(String[] args) {\n  startTraining()\n}\n\npublic static boolean startTraining() {\n  trainingWorker = new WorkerImpl(config);\n  final Thread workerThread = new Thread(trainingWorker);\n\n  WorkerListener listener = new WorkerListener() {\n    public void onEvent(WorkerEvent event, Worker worker, String queue, Job job, \n                        Object runner, Object result, Exception ex) {\n      if(event.equals(WorkerEvnet.JOB_SUCCESS) {\n        //get data\n        //process data\n        //send data\n      }\n    }\n  }\n\n  trainingWorker.addListener(listener, WorkerEvent.JOB_SUCCESS, WorkerEvent.JOB_FAILURE,\n                     WorkerEvent.WORKER_ERROR, WorkerEvent.WORKER_POLL);\n  workerThread.start();\n  workerThread.join();\n}\n</code></pre>\n\n<p>I want unit tests to see if the worker read the data properly, processed it correctly and successfully sent it. The problem is because of <code>Thread.join()</code>; the call to the main function never returns (as the worker is suppose to run continuously). In this case should I not write unit tests for it? If yes, how can I write some other form of test that will ensure the worker is working  as desired?</p>\n"},{"tags":["android","multithreading","runonuithread"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12860894,"title":"runOnUiThread and lags","body":"<p>I have a fragment that incorporates a ViewPager with custom views and a spinner in a top bar. Every time a change the page in the viewpager, I have to update strings in the spinner from a db. To do this, in the onPageSelected of the viewPager listener I launch a thread that retrieve data from the db and updates via runOnUiThread the spinner's adapter. The problem is that the notifyDataSetChanged() called for the spinner's adapter lags the viewpager: it has to rebuild few views, but it lags it a bit.</p>\n\n<pre><code>            @Override\n        public void onPageSelected(final int pos) {\n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n</code></pre>\n\n<p>...</p>\n\n<pre><code>                    getActivity().runOnUiThread(new Runnable() {\n                        @Override\n                        public void run() {\n                            mSpinnerAdapter.notifyDataSetChanged();\n                        }\n                    });\n                }\n            }).start();\n        }\n</code></pre>\n\n<p>How to resolve this? It is possible to run code on the main thread with lowest priority?</p>\n"},{"tags":["c#","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":850,"score":2,"question_id":8176390,"title":"ThreadAbortException on a console app on multiple database inserts","body":"<p>If I try to execute >100 database inserts one at a time using a thread in a console app, I get following error. As per the current architecture I need to insert records one at a time. For lesser number of records(10-30),the error doesn't happen. Is inserting so many records one at a time creating this issue?</p>\n\n<p>The code is something like:</p>\n\n<pre><code>foreach (MyObject myObject in myObjectCollection)\n{\n   var database = new SqlDatabase(connectionString);\n   using (DbCommand command = database.GetStoredProcCommand(storedProcedureName))\n   { \n         // Create parameters from myObject\n         // Add parameters to the command object         \n         database.ExecuteNonQuery (command);\n   }    \n\n}\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>System.Threading.ThreadAbortException: Thread was being aborted.    \n at SNIReadSync(SNI_Conn* , SNI_Packet** , Int32 )    \n at SNINativeMethodWrapper.SNIReadSync(SafeHandle pConn, IntPtr&amp; packet, Int32 timeout)    \n at System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult asyncResult, TdsParserStateObject stateObj)    \n at System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()    \n at System.Data.SqlClient.TdsParserStateObject.ReadBuffer()    \n at System.Data.SqlClient.TdsParserStateObject.ReadByte()    \n at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)    \n at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)    \n at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)    \n at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)    \n at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(DbAsyncResult result, String methodName, Boolean sendToPipe)    \n at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()    \n at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoExecuteNonQuery(DbCommand command)    \n at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteNonQuery(DbCommand command)\n</code></pre>\n"},{"tags":["multithreading","qt"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1171,"score":1,"question_id":2182252,"title":"How to wait in the main thread until all worker threads have completed in Qt?","body":"<p>I have designed an application which is running 20 instance of a thread. </p>\n\n<pre><code>for(int i = 0;i&lt;20;i++)\n{\n    threadObj[i].start();\n}\n</code></pre>\n\n<p>How can I wait in the main thread until those 20 threads finish?</p>\n"},{"tags":["ios","multithreading","synchronization","atomicity"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12860280,"title":"Is it better to force actions in the main thread or to use synchronization?","body":"<p>Say I have a method that starts a download for an object, which may be called from any thread, but I want to make sure that the download is unique, that is, I won't start another download for the same object if there is already one.</p>\n\n<p>Is it better to force the method to perform on the main thread to ensure data consistency (knowing the download will be asynchronous anyway)?</p>\n\n<pre><code>- (void)download\n{\n    dispatch_async(dispatch_get_main_queue(), ^{\n        if (isDownloading == NO) {\n            // Some preparation\n            isDownloading = YES;\n            // Launch asynchronous download\n        }\n    });\n}\n</code></pre>\n\n<p>or to use a blocking synchronization mechanism?</p>\n\n<pre><code>- (void)download\n{\n    @synchronize(self) {\n        if (isDownloading == NO) {\n            // Some preparation\n            isDownloading = YES;\n            // Launch asynchronous download\n        }\n    });\n}\n</code></pre>\n\n<p>or to use an operation like <code>OSAtomicCompareAndSwap</code> on the <code>isDownloading</code> ivar?</p>\n\n<p>Are there differences in term of performances? What would be the best strategy?</p>\n"},{"tags":["c#","multithreading","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":12859699,"title":"C# Background Worker RunWorkerCompleted Never Fires - Why?","body":"<p><strong>Update</strong></p>\n\n<p>I'm now wondering if the fact that the IEnumerable that the foreach loop iterates over here is from a loop that uses yield return. I'm not sure if this has any effect on threading... ?</p>\n\n<hr>\n\n<p>Can anyone point out why I never see the BackgroundWorker RunWorkerCompleted event fire in this code (this is a .NET 4, MVC 3 application)?</p>\n\n<p>Regardless of what I set for, <strong>WorkerSupportsCancellation</strong> and <strong>WorkerReportsProgress</strong> the completed events never seem to fire.</p>\n\n<p>Even when I try throwing an exception in the DoWork block, I never see the completed event. As I understand it, I should.</p>\n\n<p>Anything obvious here?</p>\n\n<p>By the way, I'm unable to upgrade the project to .NET 4.5 to use newer async features due to project restrictions.</p>\n\n<pre><code>var autoResetEvent = new AutoResetEvent(false);\n\nUploadsExpected = pagesFound;\n\nforeach (var rasterisedPageFilePath in rasterisedPageFilePathList)\n{\n    // Track uploads\n\n    UploadsStarted += 1;\n\n    int uploadCount = UploadsStarted;\n\n    // Track concurrent uploads in main thread and while we are at our \n    // maximum, pause and wait before starting the next upload thread\n\n    while (ConcurrentUploadsRunning &gt;= maxConcurrentUploads) \n    {\n        Debug.WriteLine(string.Format(\"Waiting to start upload: {0}\", \n            uploadCount));\n\n        Thread.Sleep(3000);\n    }\n\n    ConcurrentUploadsRunning += 1; \n\n    Debug.WriteLine(string.Format(\"Initiating new upload: {0}\", uploadCount));\n\n    // Create a background worker so we can run the upload asynchronously.\n\n    var backgroundWorker = new BackgroundWorker();\n\n    // Set up anonymous method that runs asynchronously\n\n    backgroundWorker.DoWork += (sender, e) =&gt; \n    {\n        try\n        {\n            var storageManager = new storageManager(awsS3BucketName);\n\n            string imgFilePath = (string) e.Argument;\n\n            using (var fileStream = new FileStream(imgFilePath, FileMode.Open))\n            {\n                storageManager.Save(Path.GetFileName(imgFilePath), \n                    MimeTypes.JPEG, fileStream);\n            }\n        }\n        catch (Exception ex)\n        {\n            UploadHasFailed = true;\n\n            m_logManager.Fatal(\"Upload of file to AWS S3 has failed\", ex);\n        }\n        // Run check for AutoResetEvent following Save complete,\n        // and if the completed uploads count indicates that all uploads\n        // have finished, set AutoResetEvent so main thread can exit\n\n        if ((UploadsCompleted += 1) == UploadsExpected)\n        {\n            autoResetEvent.Set();\n        }\n\n        Debug.WriteLine(string.Format(\"Upload complete: {0}\", uploadCount));\n\n        ConcurrentUploadsRunning -= 1;\n    };\n\n    backgroundWorker.RunWorkerCompleted += (sender, args) =&gt;\n    {\n         // Never fires\n    };\n\n    backgroundWorker.ProgressChanged += (sender, args) =&gt;\n    {\n        // Never fires\n    };\n\n    backgroundWorker.RunWorkerAsync(rasterisedPageFilePath);\n\n}\n\nautoResetEvent.WaitOne();\n\ntry\n{\n    inputStream.Close();\n\n} catch { }\n</code></pre>\n"},{"tags":["java","multithreading","gwt","selenium","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12840103,"title":"How to run multiple threads concurrently for Automated Selenium testing?","body":"<p>I have one web application from which I can start respective testing process which is in another Java app. I am using Socket Programming for communication between Web app and Java app.</p>\n\n<p>When I request for specific process from web app then SocketServer from Java app hears request and start one thread for Testing process.\n Testing process will initialize FirefoxDriver and start browser and do further test process.</p>\n\n<p>My problem is, when I request for another process with different process name then It again creates second thread and start firefox browser but this time it is not considering my second process, it started to do same process which is first thread have.</p>\n\n<p>I do not understand what to do...For every process I created a new thread but further it will doing same process.\nMy inputs are correctly received at Java app.\nPlease help me How can I do the concurrent thread safe processing?\nI am using GWT,Java, Seleniun FirefoxDriver.</p>\n\n<p>here is the Server code which is running in background and listen client request:</p>\n\n<pre><code>static final int PORT = 6789;\n\n    public static void main(String args[]) {\n        ServerSocket serverSocket = null;\n        Socket socket = null;\n            try {\n            InitializeApplication application = new InitializeApplication();\n            application.initialize();\n\n            serverSocket = new ServerSocket(PORT);\n        } catch (Exception e) {\n            log(\"Exception in SocketServerExecutor !!!\",e);\n        }\n        while (true) {\n            try {\n                socket = serverSocket.accept();\n            } catch (Exception e) {\n                log(\"Exception in SocketServerExecutor !!!\",e);\n            }\n            Thread thread = new Thread(new SocketServerThread(socket));\n            thread.start();\n        }\n    }\n</code></pre>\n\n<p>and this is the Thread which start process:</p>\n\n<pre><code> private Socket client;\n\n        public SocketServerThread(Socket serverSocket) {\n            this.client = serverSocket;\n        }\n\n        /**\n         * Starts appropriate process depending on process name from input.\n         * Input string contains:\n         * process name\n         */\n        public void run() {\n            DataOutputStream outputStream = null;\n            String param = null; \n\n            try{\n                log(\"Just connected to \"+ client.getRemoteSocketAddress());\n                    try {\n                        while ((param = in.readUTF()) != null){\n                            log(\"got parameteres from client (i.e. from web app): \"+param);\n                            break;\n                        }\n                    } catch (Exception e) { }\n                    if(param!=null &amp;&amp; !param.isEmpty()){\n                        String process = params[0];\n\n                        ProcessManager manager = new ProcessManager();\n                        if(process.equals(\"testUser\"))\n                            manager.startUserProcess(process);\n                        else if(process.equals(\"testCustomer\"))\n                            manager.startCustomerProcess(process);\n\n                    }\n            }catch(Exception exc){\n                if(exc instanceof SocketTimeoutException)\n                    log(\"Socket timed out! [SocketServerThread]\",exc);\n                else if(exc instanceof BindException)\n                    log(\"BindException in SocketServerThread !!!\",exc);\n                log(Level.SEVERE, \"Exception in SocketServerThread !!!\",exc);\n            }\n        }\n</code></pre>\n\n<p>and this is ProcessManager:</p>\n\n<pre><code>public void starUserProcess(String siteName) {\n        ExecutorService executerService = null;\n        try{\n            Callable&lt;Object&gt; callable = new ProcessThread(siteName);\n            executerService = Executors.newCachedThreadPool();\n            Future&lt;Object&gt; future = executerService.submit(callable);\n            future.get();\n\n            log(\"[ProcessManager] Process completed for \"+process);  \n            System.exit(0);\n        }catch (Exception e) {\n            log(\"[ProcessManager]::Exception\");\n            log(ex);\n        }\n    }\n</code></pre>\n\n<p>ProcessThread will initialize all required things and Firefox browser and start process.\nClient is new every time which contains input.</p>\n"},{"tags":["java","multithreading","deadlock"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12856574,"title":"Is \"Thread starvation deadlock\" happening here","body":"<p>I'm trying to concurrently process some transactions via a web service(through it's Java API), using Callables and a ThreadPool</p>\n\n<pre><code>public class CallableTxSender implements Callable&lt;Transaction&gt; {\n\n    private Transaction transaction;\n    private Engine engine;\n\n    public CallableTxSender(Transaction transaction, Engine engine) {\n        this.transaction = transaction;\n        this.engine= engine;\n    }\n\n    @Override\n    public Transaction call() throws Exception {\n        return engine.processTx(transaction);\n    }\n\n}\n</code></pre>\n\n<p>Where <code>Engine</code> - is the Api that does the web service call.</p>\n\n<p>I'm creating a pool of say 50 threads;</p>\n\n<pre><code>ExecutorService executorService = Executors.newFixedThreadPool(50);\nList&lt;Transaction&gt; transactions = transactionDao.getPaidTxs();\n\nEngine engine= new Engine();\nfor (Transaction transaction : transactions) {\n    CallableTxSender txSender = new CallableTxSender(transaction, engine);\n    executorService.submit(txSender);\n}\n</code></pre>\n\n<p>When I try to process 100 transactions, it starts fine with first 20-30 transactions, then somewhere it just hangs. I'm not sure if the API supports simultaneous requests but it should. </p>\n\n<p>What I want to make sure is that my client part is fine. What do you think?</p>\n\n<p><strong>Edit</strong>: I reduced pool size to 10, and it processes fine. Thanks <em>Marko</em> from the comments.\nThe question still is though, what makes a pool hang with 50 concurrent tasks while not with 10?</p>\n\n<p>Thanks a lot</p>\n"},{"tags":["c++","multithreading","c++11"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":12859548,"title":"How to std::thread sleep","body":"<p>I new to use std::thread, i wan't to be able to put a thread to sleep from another thread, is that possible. In examples all i see is code like:</p>\n\n<pre><code>std::this_thread::sleep_for(std::chrono::seconds(1));\n</code></pre>\n\n<p>But what i want to do is something like:</p>\n\n<pre><code>std::thread t([]{...});\nt.sleep(std::chrono::seconds(1));\n</code></pre>\n\n<p>or \n    sleep(t, std::chrono::seconds(1));</p>\n\n<p>Any ideas?</p>\n"},{"tags":["iphone","ios","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12858887,"title":"iOS: How to do hard work with data in background thread?","body":"<p>I have a method like:</p>\n\n<pre><code>- (BOOL)shouldDoSomeWork {\n   BOOL result = // here I need do hard work with data in background thread and return result, so main thread should wait until the data is calculated and then return result;\n   return result;\n}\n</code></pre>\n\n<p>How to implement that?</p>\n"},{"tags":["c#","multithreading","delegates"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12857508,"title":"storing/passing delegates as variables","body":"<p>I am fairly new to C# and was working on a a way to implement a dynamic GUI wich uses the serial communication. I originally come from C, so the concept of function pointer is familiar.</p>\n\n<p>Basicly I want to invoke a answerFunction() function when the serial command has been processed.\nIn Theory:\nI have a Class lbl_txtBox_Pair which is dynamicly created on runtime.\nI have a Class comObject which communicates with the serial Port.\nI have a third class comPacket which holds all information regarding one serial command.</p>\n\n<ol>\n<li>in an Object of Class lbl_txtBox_Pair I instanciate a Packet and tell it which function should be called when the serial command is finished.</li>\n<li>I give the packet Object to the comObject Instance. </li>\n<li>after beeing processed the comObject wants to signal the original sender of the packet by calling the delegate which is stored in the Packet Object.</li>\n</ol>\n\n<p>For some reason I can't get it to work. It tells me that the Attribute of Packet is not callable. Am I doing something teribly wrong?</p>\n\n<p>Here is the Code: \nfirst the code in Class \"lbl_txtBox_Pair\". I create the comPacket here and give it to the comObject.</p>\n\n<pre><code>public delegate void answerHandler( comPacket packet);\npublic void txb_value_KeyPress(object sender, KeyPressEventArgs e)\n{\n   if (e.KeyChar == (char)Keys.Return)\n   {\n      answerHandler answerMethod = new answerHandler(this.processAnswer);\n      comPacket question = new comPacket(this.command, answerMethod, 1);\n      comObject.addPacket(question);\n    }\n }\n</code></pre>\n\n<p>The constructor of comPacket. Here the delegate gets stored to be called later.</p>\n\n<pre><code>public Delegate answerFunction;\npublic comPacket(string cmd, Delegate func, int prio)\n{\n    this.cmd = cmd;\n    answerFunction = func;\n    this.prio = prio;\n}\n</code></pre>\n\n<p>In the comObject the Packets get processed. When finished I want to call the function stored in the Packet. The comObject runs in a different Thread by the way.</p>\n\n<pre><code>if (this.isEndtocken(inputline))\n {\n    listen = false;\n    packet.answerFunction(packet);\n }\n</code></pre>\n\n<p>And here it is were it breaks. packet.answerFunction(packet); wont execute and says it cant be called as Method.</p>\n\n<p>Can anybody see where it goes wrong? I think it seems like the delegate looses the information that it is a delegate or something. ;)\nOr do I have to completly restructure the code to use other types of callback / Event Methods?</p>\n"},{"tags":["c","multithreading","cygwin"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12858784,"title":"c cygwin- abored(core dumped)","body":"<p>I have tried for a long time and cannot figure out where this <code>'core dumped'</code> is coming from. I am using <code>c</code> on <code>cygwin</code>. Commenting out the threads gets rid of the problem but commenting out the entire code in the thread does nothing. Could this have something to do with the calling of the thread?? It appeared to be working then this suddenly happened. I have deleted most of the code and this is what is left-</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;string.h&gt;\n\n\ntypedef enum {true=1, false=0} bool;\n\nvoid *piThread(void *arg);\nint finished;\n\nint main(int argc, char *argv[])\n{\n    int i;\n    int threads;\n    bool display = false;\n    long double pI = 0.0;\n    void *status = malloc(sizeof(int));\n    pthread_t thread_id[threads];\n\n    if(argc &lt; 2) {printf(\"not enough arguments\"); exit(1);\n    }else threads = atoi(argv[1]);\n\n    if(argc == 3)\n        if (strcmp(argv[2], \"b\") == 0)\n            display = true;\n\n    for(i=0; i&lt;threads; i++)\n    {\n            pthread_create(&amp;thread_id[i], NULL, piThread, NULL);    \n            pthread_join(thread_id[i], &amp;status);\n            printf(\"pi: %Lf\\n\", pI);\n    }\n    return 0;\n}\n\nvoid *piThread(void *arg)\n{\n    int number = 0;\n    number = 74;\n    pthread_exit((void*)number);\n}\n</code></pre>\n\n<p>This is causing an aborted error. </p>\n\n<pre><code>Stack trace:\nFrame     Function  Args\n0028A6A4  76821184  (000000D0, 0000EA60, 00000000, 0028A7D8)\n0028A6B8  76821138  (000000D0, 0000EA60, 000000A4, 0028A7B4)\n0028A7D8  610DBE29  (00000000, FFFFFFFE, 77403B23, 77403B4E)\n0028A8C8  610D915E  (00000000, 0028A918, 00000001, 00000000)\n0028A928  610D962E  (76D709CD, 7427AED9, 00000003, 00000006)\n0028A9D8  610D9780  (000011E8, 00000006, 002B002B, 800483D8)\n0028A9F8  610D97AC  (00000006, 0028CE80, FFFDE000, 00000000)\n0028AA28  610D9A85  (000000D0, 0028ABF0, 0028AA58, 610FA223)\nEnd of stack trace\n</code></pre>\n\n<p>I have no idea what is wrong!! \ncommand line is-\ngcc pi.exe 100\nany combination ABOVE 26 causes this fault. \nThank you for any insight</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12856298,"title":"Multithreading: Using BeginInvoke inside lock statement ok?","body":"<p>Is it a good programming practice to use asynchronous operations inside a lock construct. For eg,</p>\n\n<pre><code>lock(objLocker)\n{\n\n    myDispatchder.BeginInvoke(\n        System.Windows.Threading.DispatcherPriority.Render,\n        new Action(() =&gt;\n                    {\n                      // ..code..\n\n                    }\n}\n</code></pre>\n"},{"tags":["python","multithreading","directory"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":49,"score":0,"question_id":12857063,"title":"Checking a directory continuously for new files","body":"<p>I need to write a program which continuously checks a directory for new files and does some processing whenever there a new file is added. Obviously I will probably need to use some threads but is there any convenient way or pointers that anyone can suggest for achieving this in python ? (FOr both linux and windows)</p>\n"},{"tags":["objective-c","ios","multithreading","ipad","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12856561,"title":"UITableview throwing an \"invalid number of rows\" error on reloadData call, but only for iPad 1 not iPad 2","body":"<p>I have a iOS app that, in a nutshell, uses a UITableView and a few buttons to change out the contents of the table. I was getting an error earlier in the development regarding the number of rows being inconsistent before and after a reloadData call but then found out what I was doing incorrectly.</p>\n\n<p>Now however I'm getting a report from a tester that his iPad 1 is crashing, and looking at the stack trace I can see that the same error, as described above, is happeing. But all other iPad 2 testers seem to work correctly and they are all using the same data sets to populate the tables.</p>\n\n<p>Here is how I am populating the tableview:</p>\n\n<pre><code>[tableviewController.data removeAllObjects] //Delete the old data. Tableviewcontroller is the delegate for self.tableview\n[self.tableview performSelectorOnMainThread:@selector(reloadData) withObject:nil waitUntilDone:NO];\n[tableviewController setData:[newDataSetArray mutableCopy]]; //Copy over a new dataset array\n[self.tableview performSelectorOnMainThread:@selector(reloadData) withObject:nil waitUntilDone:NO];\n</code></pre>\n\n<p>If anybody has any idea why this might be happening and could point it out I would really appreciate it. </p>\n\n<p><strong>EDIT</strong>:\nA few more details. After hearing about this problem we had the tester delete the local copy of the app, and fetch the newest version.\nFurther more, he and the other testers are all running iOS 5.1.1 so as far as I can see the only inconsistency is the hardware version. But this doesn't make sense :/</p>\n"},{"tags":["c++","multithreading","boost-thread","interlocked-increment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12838748,"title":"Manually writing a multithreaded loop - suboptimal scalability","body":"<p>I have written this test application: it goes through iterations from 0 to 9999, for each integer in the range it calculates some useless but calculation-intensive function. As a result the program outputs the sum of function values. To make it run on several threads I'm using InterlockedIncrement - if after increment the iteration number is &lt;10000 then a thread processes this iteration, otherwise it terminates.</p>\n\n<p>I am wondering why it is not scaling as well as I would like it to. With 5 threads it runs 8s versus 36s with a single thread. This gives ~4.5 scalability. During my experiments with OpenMP (on slightly different problems) I was getting much better scalability.</p>\n\n<p>The source code is shown below.</p>\n\n<p>I am running Windows7 OS on a Phenom II X6 desktop. Don't know what other parameters might be relevant.</p>\n\n<p>Could you please help me explain this sub-optimal scalability?\nMany thanks.</p>\n\n<pre><code>#include &lt;boost/thread.hpp&gt;\n#include &lt;boost/shared_ptr.hpp&gt;\n#include &lt;boost/make_shared.hpp&gt;\n#include &lt;vector&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;cmath&gt;\n\nusing namespace std;\nusing namespace boost;\n\nstruct sThreadData\n{\n  sThreadData() : iterCount(0), value( 0.0 ) {}\n  unsigned iterCount;\n  double value;\n};\n\nvolatile LONG g_globalCounter;\nconst LONG g_maxIter = 10000;\n\nvoid ThreadProc( shared_ptr&lt;sThreadData&gt; data )\n{\n  double threadValue = 0.0;\n  unsigned threadCount = 0;\n\n  while( true )\n  {\n    LONG iterIndex = InterlockedIncrement( &amp;g_globalCounter );\n    if( iterIndex &gt;= g_maxIter )\n      break;\n\n    ++threadCount;\n\n    double value = iterIndex * 0.12345777;\n    for( unsigned i = 0; i &lt; 100000; ++i )\n      value = sqrt( value * log(1.0 + value) );\n\n    threadValue += value;\n  }\n\n  data-&gt;value = threadValue;\n  data-&gt;iterCount = threadCount;\n}\n\nint main()\n{\n  const unsigned threadCount = 1;\n\n  vector&lt; shared_ptr&lt;sThreadData&gt; &gt; threadData;\n  for( unsigned i = 0; i &lt; threadCount; ++i )\n    threadData.push_back( make_shared&lt;sThreadData&gt;() );\n\n  g_globalCounter = 0;\n\n  DWORD t1 = GetTickCount();\n  vector&lt; shared_ptr&lt;thread&gt; &gt; threads;\n  for( unsigned i = 0; i &lt; threadCount; ++i )\n    threads.push_back( make_shared&lt;thread&gt;( &amp;ThreadProc, threadData[i] ) );\n\n  double sum = 0.0;\n  for( unsigned i = 0; i &lt; threadData.size(); ++i )\n  {\n    threads[i]-&gt;join();\n    sum += threadData[i]-&gt;value;\n  }\n\n  DWORD t2 = GetTickCount();\n  cout &lt;&lt; \"T=\" &lt;&lt; static_cast&lt;double&gt;(t2 - t1) / 1000.0 &lt;&lt; \"s\\n\";\n\n  cout &lt;&lt; \"Sum= \" &lt;&lt; sum &lt;&lt; \"\\n\";\n  for( unsigned i = 0; i &lt; threadData.size(); ++i )\n    cout &lt;&lt; threadData[i]-&gt;iterCount &lt;&lt; \"\\n\";\n\n  return 0;\n}\n</code></pre>\n\n<p>Edit:\nAttaching sample output of this test program (1 and 5 threads):\n<img src=\"http://i.stack.imgur.com/xtDgm.png\" alt=\"enter image description here\"></p>\n"},{"tags":["java","multithreading","unit-testing","powermock"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12853828,"title":"how to test a thread using powermock?","body":"<p>There's a piece of code im trying to test,</p>\n\n<p>which goes something like this:</p>\n\n<pre><code>class Foo {\n    //do some operations\n    SwingUtilities.invokeLater(new Runnable() {\n        public void run() {\n            //some piece of code\n        }\n    }\n}\n</code></pre>\n\n<p>So how do i test the code within the run function.\nI am using powermock, </p>\n\n<p>The thread is started in another class so i should not invoke it there right??</p>\n\n<p>im still a beginner.</p>\n"}]}
{"total":30059,"page":15,"pagesize":100,"questions":[{"tags":["java","multithreading","synchronization","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12854338,"title":"Synchronize a persistence loader in java","body":"<p>I have a class for loading from persistence items with the following method at <code>PersistenceController</code> class:</p>\n\n<pre><code>Item loadItem(int id);\n</code></pre>\n\n<p>So now I want to implement the following method in other controller:</p>\n\n<pre><code>synchronized Item getItem(int id){\n    Item result= getItemFromMemory(id);\n    if (result==null){\n        result=PersistenceController.loadItem(id);\n    } \n    return result;\n}\n</code></pre>\n\n<p>The goal is to ensure only one (or zero) instances of a item with the same id in memory at the same time. This method works but have one problem: Every load Item must wait for each other. I'd like to change the synchronization scheme in order to a call wait for other only if both have the same id.</p>\n\n<p>Whats the best way to do this?</p>\n"},{"tags":["c#",".net","multithreading","dispose","task-parallel-library"],"answer_count":3,"favorite_count":13,"up_vote_count":37,"down_vote_count":0,"view_count":2854,"score":37,"question_id":3734280,"title":"Is it considered acceptable to not call Dispose() on a TPL Task object?","body":"<p>I want to trigger a task to run on a background thread. I don't want to wait on the tasks completion.</p>\n\n<p>In .net 3.5 I would have done this:</p>\n\n<pre><code>ThreadPool.QueueUserWorkItem(d =&gt; { DoSomething(); });\n</code></pre>\n\n<p>In .net 4 the TPL is the suggested way. The common pattern I have seen recommended is:</p>\n\n<pre><code>Task.Factory.StartNew(() =&gt; { DoSomething(); });\n</code></pre>\n\n<p>However, the <a href=\"http://msdn.microsoft.com/en-us/library/dd321439.aspx\" rel=\"nofollow\"><code>StartNew()</code></a> method returns a <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.aspx\" rel=\"nofollow\"><code>Task</code></a> object which implements <code>IDisposable</code>. This \nseems to be overlooked by people who recommend this pattern. The MSDN documentation on the <a href=\"http://msdn.microsoft.com/en-us/library/dd270681.aspx\" rel=\"nofollow\"><code>Task.Dispose()</code></a> method says:</p>\n\n<blockquote>\n  <p>\"Always call Dispose before you release your last reference to the Task.\"</p>\n</blockquote>\n\n<p>You can't call dispose on a task until it is completed, so having the main thread wait and call dispose would defeat the point of doing on a background thread in the first place. There also doesn't seem to be any completed/finished event that could be used for cleanup.</p>\n\n<p>The MSDN page on the Task class doesn't comment on this, and the book \"Pro C#2010...\" recommends the same pattern and makes no comment on task disposal.</p>\n\n<p>I know if I just leave it the finalizer will catch it in the end, but is this going to come back and bite me when I'm doing lots of fire &amp; forget tasks like this and the finalizer thread gets overwhelmed?</p>\n\n<p>So my questions are: </p>\n\n<ul>\n<li>Is it acceptable to not call <code>Dispose()</code> on the <code>Task</code> class in this case? And if so, why and are there risks/consequences?</li>\n<li>Is there any documentation that discusses this? </li>\n<li>Or is there an appropriate way of disposing of the <code>Task</code> object that I've missed?</li>\n<li>Or is there another way of doing fire &amp; forget tasks with the TPL?</li>\n</ul>\n"},{"tags":["c#","multithreading","iis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11830956,"title":"Linq2Sql results availability timeout","body":"<p>I use Linq2Sql to retrieve a list of ID's that I use to launch a SSRS report export wia SSRS web service.\nThe query retrieves about 200 items and I use a foreach loop to loop through them.</p>\n\n<p>I pass the List object containing the ID's to a method executed <em>in a new thread</em>. </p>\n\n<p>The SSRS report generation is quite long, so sometimes when the server goes slower due to work load, the overall execution execeedes the <em>20 minutes</em> and my threads ends, with no exception.</p>\n\n<p>Is there a timeout setting in Linq2Sql DataContext that matches this use case, after which my results become unavailable and the foreach loop ends?</p>\n\n<p><strong>Update 1 (the code):</strong></p>\n\n<pre><code>List&lt;String&gt; list = dc.ListaIDs().ToList&lt;String&gt;();\nint count = 0;\nforeach (var item in list)\n{\n    string FileName = \"report_\" + (++count).ToString() + \".pdf\";\n    LoggerUtility.Instance.log.Debug(String.Format(\"export =&gt; \" + FileName));\n    try\n    {\n        switch (ReportFormat)\n        {\n            case \"PDF\":\n                risultato = ReportServiceImpl.WSReport(\"PDF\", item);\n                System.IO.File.WriteAllBytes(FileName, risultato.PDFResult);\n                break;\n            default:\n                LoggerUtility.Instance.log.Warn(\"no format\");\n                break;\n        }\n    }\n    catch (Exception ex)\n    {\n        LoggerUtility.Instance.log.Warn(\"error exporting =&gt; \" + FileName, ex);\n    }\n}\n</code></pre>\n\n<p><strong>Update 2:</strong></p>\n\n<p>The rs object (of a custom ReportService class I made to separate report WS calls) is not in the same scope of the thread; it's declared and instantiated outside the method launched as a thread and the class containing the method and the rs declaration is an MVC 3 controller.</p>\n\n<p>In the ReportService class every call instantiates a new ReportExecutionService (previously obtained by a web reference to ReportExecution2005.asmx).</p>\n\n<p><strong>Update 3 (the WS call code and a little update in the first part of code):</strong></p>\n\n<p>I refactored the code to have a static call to my <code>ReportServiceImpl</code>'s method and applying what's told in @JamieSee's response that may exclude timeout in Linq2Sql.\nThis is the ReportServiceImpl.WSReport actual implementation; after 20 minutes it stops without exceptions at <code>result = service.Render(...)</code>:</p>\n\n<pre><code>public static ReportResult WSReport(String format, string id)\n{\n    ReportResult _return = new ReportResult();\n    ReportExecution.ReportExecutionService service = null;\n    try\n    {\n        byte[] result;\n        service = new ReportExecution.ReportExecutionService();\n\n        String reportPath = @\"/myReport\";\n        string historyID = null;\n\n        service.UseDefaultCredentials = true;\n\n        //load report\n        ExecutionInfo execInfo = new ExecutionInfo();\n        ExecutionHeader execHeader = new ExecutionHeader();\n\n        service.ExecutionHeaderValue = execHeader;\n        execInfo = service.LoadReport(reportPath, historyID);\n\n        //set execution parameter\n        ParameterValue[] parameters = new ParameterValue[1];\n        parameters[0] = new ParameterValue() { Name = \"id\", Value = id };\n        service.SetExecutionParameters(parameters, \"it-IT\");\n\n        String SessionId = service.ExecutionHeaderValue.ExecutionID;\n\n        //render report actually\n        String deviceInfo = \"\";\n        String extension;\n        String mimetype;\n        String encoding;\n        GestioneVIP_Services.ReportExecution.Warning[] warnings;\n        string[] streams;\n        result = service.Render(format, deviceInfo, out extension, out mimetype, out encoding, out warnings, out streams);\n        switch (format)\n        {\n            case Constants.EXCEL_FORMAT:\n                _return.XLSResult = result;\n                break;\n            case Constants.PDF_FORMAT:\n                _return.PDFResult = result;\n                break;\n            case Constants.HTML_FORMAT:\n                _return.HTMLResult = result;\n                break;\n        }\n    }\n    catch (SoapException ex)\n    {\n        LoggerUtility.Instance.log.Error(String.Format(\"{0}/n{1}\", ex.Message, ex.StackTrace));\n    }\n    catch (Exception ex)\n    {\n        LoggerUtility.Instance.log.Error(String.Format(\"{0}/n{1}\", ex.Message, ex.StackTrace));\n    }\n    finally\n    {\n        if (service != null)\n        {\n            service.Dispose();\n        }\n    }\n    return _return;\n}\n</code></pre>\n"},{"tags":["c#","multithreading","forms","textbox"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12855191,"title":"Change text on a form from within a thread in C#","body":"<p>I'm trying to change the text on my Form1's textbox to \"hello there\" from within a thread.\nBut when I execute it, I get the error \"Object reference not set to an instance of an object.\"\nWhen I check I see that txtboxCheckedFiels has a Null value.</p>\n\n<p>How would I create an Object of that txtbox? (I have multiple threads running of which all should be able to change that text.</p>\n\n<p>Code I've tried:</p>\n\n<pre><code>txtboxCheckedFiles.Invoke(new Action(() =&gt;\n                {\n                    txtboxCheckedFiles.Text = \"Hello there\";\n                }));\n</code></pre>\n\n<p>And another way i tried</p>\n\n<pre><code>var t = new Thread(\no =&gt; \n{\n     txtboxCheckedFiles.BeginInvoke(\n         ((Action)(() =&gt; txtboxCheckedFiles.Text = \"Hello there\")));\n});\n</code></pre>\n"},{"tags":["c","windows","multithreading","winapi","memory"],"answer_count":1,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":142,"score":6,"question_id":12852940,"title":"Can memset be parallelized on 4 cores?","body":"<p>I am not sure to that. Can I write a large memset (for example 10 MB), on four cores to gain speedup with this? </p>\n\n<p>Is such ram-chip parallelization possible at all, and also how big are time costs of firing other threads - is it more than a millisecond or less?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12851248,"title":"Specify a particular thread to execute","body":"<p>I have an array of threads. For each thread, it would wrap class that implements Runnable interface. Here's my code :</p>\n\n<pre><code>class RunnableA  implements Runnable {\n    ...\n}    \n\nint nThreads = 6;\nRunnableA[] runnables = new RunnableA[nThreads];\nThread[] threads = new Thread[nThreads];\n\n// inputQueue is a blocking queue\nwhile (!inputQueue.isEmpty()) {\n    ...\n    Object input = inputQueue.poll();\n    for (int i = 0; i &lt; nThreads; i++) {\n        runnables[i] = new RunnableA(..., input);     \n    }\n\n    ...\n\n    for (int i = 0; i &lt; nThreads; i++) {\n        threads[i] = new Thread(runnables[i]);\n        threads[i].start();\n    }\n\n}\n</code></pre>\n\n<p>Because each element of array <strong>runnables</strong> would change. For example, if <strong>threads[i]</strong> has id <strong>13</strong> so I wanna to specify this thread to wrap a new object <strong>RunnableA</strong>. </p>\n"},{"tags":["multithreading","perl"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12848862,"title":"How to end a thread in perl","body":"<p>I am new to perl and i have a question about perl thread.</p>\n\n<p>I am trying to create a new thread to check if the running function is timed out, and my way of doing it is as below.</p>\n\n<p>Logic is \n1.create a new thread\n2.run the main function and see if it is timed out, if ture, kill it</p>\n\n<p>Sample code:</p>\n\n<pre><code>$exit_tread = false;      # a flag to make sure timeout thread will run\nmy $thr_timeout = threads-&gt;new( \\&amp;timeout );  \nexecute main function here;                \n\n$exit_thread = true       # set the flag to true to force thread ends\n$thr_timeout-&gt;join();      #wait for the timeout thread ends\n</code></pre>\n\n<p>Code of timeout function</p>\n\n<pre><code>sub timeout\n{\n\n$timeout = false;\nmy $start_time = time();\nwhile (!$exit_thread)\n{\n\n    sleep(1);                 \n    last if (main function is executed);\n\n    if (time() - $start_time &gt;= configured time )\n    {\n        logmsg \"process is killed as request timed out\";\n        _kill_remote_process();\n        $timeout = true;   \n        last;         \n    }\n}    \n}\n</code></pre>\n\n<p>now the code is running as i expected, but i am just not very clear if the code $exit_thread = true works because there is a \"last\" at the end of while loop.</p>\n\n<p>Can anybody give me a answer?</p>\n\n<p>Thanks</p>\n"},{"tags":["c++","multithreading","c++11","thread-safety"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":107,"score":2,"question_id":12843274,"title":"Is C++'s system() synchronized?","body":"<p>I'm writing a small utility which is supposed to launch several commands in parallel using <code>system()</code> and wait for their results for logging purposes. However, even though I'm calling <code>system()</code> on different threads, by looking at my Activity Monitor I only see one instance of each command at a time. It looks like system is internally synchronized on a mutex, and only one execution is allowed at each time, however this looks like a huge limitation, can someone confirm this behavior? Do you have any ideas on how to solve it?</p>\n\n<p><strong>Update</strong> by looking at the threads execution flow, it looks like they're effectively synchronizing on a mutex. Is there an alternative <code>system()</code> which doesn't do that?</p>\n\n<p><img src=\"http://i.stack.imgur.com/LZoJH.png\" alt=\"threads\"></p>\n\n<p>I should mention I'm using C++11 (w/ clang and libc++) on Mac OS 10.7.5.</p>\n\n<p><strong>Update</strong> code is:</p>\n\n<pre><code>void Batch::run()\n{\n    done.clear();\n    generator-&gt;resetGeneration();\n\n    while(generator-&gt;hasMoreParameters())\n    {\n        // Lock for accessing active\n        unique_lock&lt;mutex&gt; lock(q_mutex, adopt_lock);\n\n        // If we've less experiments than threads\n        if (active.size() &lt; threads)\n        {\n            Configuration conf = generator-&gt;generateParameters();\n            Experiment e(executable, conf);\n\n            thread t(&amp;Experiment::run, e, reference_wrapper&lt;Batch&gt;(*this));\n            thread::id id = t.get_id();\n            active.insert(id);\n            t.detach();\n        }\n\n        // Condition variable\n        q_control.wait(lock, [this] { return active.size() &lt; threads; } );\n\n    }\n}\n\nvoid Batch::experimentFinished(std::thread::id pos)\n{\n    unique_lock&lt;mutex&gt; lock(q_mutex, adopt_lock);\n    active.erase(pos);\n    lock.unlock();\n    q_control.notify_all();\n}\n\nvoid Experiment::run(Batch&amp; caller)\n{    \n    // Generate run command\n    stringstream run_command;\n    run_command &lt;&lt; executable + \" \";\n    ParameterExpression::printCommandLine(run_command, config);\n\n    if (system(run_command.str().c_str()))\n        stats[\"success\"] = \"true\";\n    else\n        stats[\"success\"] = \"false\";\n\n    caller.experimentFinished(this_thread::get_id());\n}\n</code></pre>\n\n<p>Just to be clear: the spawning and handling of threads works fine and does what it needs to do, but it looks like you can have just one instance of <code>system()</code> running at a time.</p>\n\n<p>Thanks</p>\n"},{"tags":["java","multithreading","loops","httpclient","callable"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12853797,"title":"Callable interface Loop stoping main method to execute further","body":"<p>I am trying to send request to server in every 2 seconds in a thread and check if there is something for me give it back to me....For getting value i have to use callable. I am not able to figure out how to run callable thread in every 2 seconds and get value back from it...here is my sample code of callable implementation...</p>\n\n<pre><code>public String call(){\n    boolean done = true;\n    String returnData = \"\";\n    while(done){\n        try {\n            returnData = post.getAvailableChat();\n            if(!returnData.equals(\"\")){\n                System.out.println(\"Value return by server is \"+returnData);\n                return returnData;\n            }\n            return null;\n        } catch (IOException ex) {\n            done = false;\n            Logger.getLogger(GetChatThread.class.getName()).log(Level.SEVERE, null, ex);\n        }\n</code></pre>\n\n<p>Now here is my main class code i know i did it wrong here in main class because my code will not go to next line after while loop....but please tell me how to do it</p>\n\n<pre><code>Callable&lt;String&gt; callable = new CallableImpl(2);                  \n\n    ExecutorService executor = new ScheduledThreadPoolExecutor(1);   \n    System.err.println(\"before future executor\");                    \n    Future&lt;String&gt; future;                                           \n\n    try {                                                           \n        while(chatLoop_veriable){                                    \n            future = executor.submit(callable);                         \n            String serverReply = future.get();                      \n            if( serverReply != null){                               \n                System.out.println(\"value returned by the server is \"+serverReply);\n                Thread.sleep(2*1000);                               \n            }//End of if                                            \n        }//End of loop                                              \n    } catch (Exception e) {                                         \n</code></pre>\n"},{"tags":["objective-c","multithreading","pointers","reference"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12848115,"title":"Confusion with Passing Obj-C objects into methods and retaining the changes to that object","body":"<p>I'm writing a program and trying to learn more about threads, multiprocessing, and such.</p>\n\n<p>My architecture is a Model/View/Controller type.</p>\n\n<p>I have my own subclass of <code>NSImageView</code> (ThumbnailView) and I wanted to be clever and have it listen for a message to clear itself (so all the thumbnails just clear themselves without me having to loop through them).</p>\n\n<p>The problem is my <code>ThumbnailView</code> is controlled by a <code>ThumbnailViewController</code> which is really the one listening for the message.  When it gets the message it spins off a new thread with a class object that is the command (<code>ClearThumbnailViewCommand</code>).  It passes as an argument a dictionary item containing the associated <code>ThumbnailView</code> object and a key.  Within the <code>ClearThumbnailViewCommand</code> I set the image of the <code>ThumbnailView</code> object to be some neutral image (like gray.jpg).</p>\n\n<p>All this works fine, however, the Thumbnail object that changed is not the same Thumbnail object that went in.  So I figure I need to pass a pointer rather than the object.  I remember something about using <code>MyObject**</code> as opposed to <code>MyObject*</code> and passing via <code>&amp;MyObject</code> but I can't seem to untangle the various combinations.  Not being able to reason it out I fell back to my, normally, foolproof system of trying random combinations of things but this time it's not helping.  </p>\n\n<p>It seems that even if I'm able to construct a class that passes a pointer (Not sure if I'm using these terms correctly), I'm not able to assign it correctly to the <code>NSDictionary</code>, which doesn't want an <code>id**</code> .  </p>\n\n<p>I'll try and include the basics below, if that helps at all.</p>\n\n<hr>\n\n<pre><code>ThumbnailVew : NSImageView {\n    ThumbnailVewController  * _controller;\n}\n\ninit  {\n    _controller = [[ControllerClass alloc] initWithControlObject: &amp;self];\n}\n</code></pre>\n\n<hr>\n\n<pre><code>ThumbnailVewController : ControllerClass {\n    id  ** _controlObject;\n}\n\ninitWithControlObject: (id**)object {\n    _controlObject = object;\n}\n</code></pre>\n\n<hr>\n\n<p>Then when messages are posted a <code>ThumbnailVewController</code> method is called which ultimately does this…\nWhich, of course will not let me pass in <code>&amp;_controlObject</code></p>\n\n<p>when it is all re-written so that I can pass <code>_controlObject</code>, I don't get an error, however the <code>ThumbnailView</code> I change is only local to the method.</p>\n\n<pre><code>if([command isEqualToString:@\"CLEAR_THUMBNAILS\"]) {\n    NSDictionary * dict;\n    dict = [[NSDictionary alloc] initWithObjectsAndKeys: &amp;_controlObject, @\"thumbnail\", nil];\n\n    [self newThreadWithCommand:[[[ClearThumbnailViewCommand alloc] initWithArgument:dict] autorelease]];\n}\n</code></pre>\n\n<p>Is this even possible? </p>\n"},{"tags":["multithreading","gui","qt4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12852121,"title":"Qt 4 GUI application GUI thread slows with QNetworkRequests","body":"<p>I'm developing an application to track online Xbox Live, PSN, and Steam friends. The application performs a series of QNetworkRequests using a QNetworkAccessManager. The Xbox Live and PSN code use a QWebView to simulate a browser environment. The requests are performed correctly, but it slows down the main GUI thread until each request is finished. </p>\n\n<p>Here's some example code:</p>\n\n<pre><code>void Steam::fetchFriends(QString username)\n{\n    QNetworkRequest userXml(\"http://steamcommunity.com/id/\" + username + \"/friends/?xml=1\");\n    m_nam-&gt;get(userXml);\n}\n</code></pre>\n\n<p>I've created a signal to tell the GUI that friends have been downloaded and processed. Then the friends list is updated in the GUI. Some of my other code is more complex and it's possible that I need to move the processing code to another thread.</p>\n\n<p>Can someone confirm that QNetworkAccessManager and QNetworkRequest are multithreaded or if they should be moved into separate threads?</p>\n"},{"tags":["ios","multithreading","concurrency","blocks","gcd"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12852493,"title":"Multithreading IOS concepts to explore","body":"<p>i am working in a very complex application in which,i need to improve the performance.\ni have keen interest in Multithreading and have studied docs of GCD and Blocks.\nAlthough, i have improved the performance quite a bit.\ni am searching for few answers :-</p>\n\n<ol>\n<li>We have global queue in iOS -> how to check what other tasks they execute or these are vacant queue made for us to use.</li>\n<li>If we make our custom queue \nwhat priority it has wrt already existing global concurrent queues. \n    How we can set priority of our custom queue, if we make >2.</li>\n<li>If we make custom serial/concurrent queues -> how to set priority statically or dynamically if possible.</li>\n</ol>\n\n<p>Thanks, if anybody has answers...</p>\n"},{"tags":["python","multithreading","nxt-python"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12851374,"title":"Ultrasonic thread that runs in the background in python","body":"<p>How do I create a thread that continuously checks for obstacles using the ultrasonic class in nxt-python 2.2.2? I want to implement it in a way that while my robot is moving it also detects obstacles in a background process and once it detects an object it will brake and do something else</p>\n"},{"tags":["python","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12852210,"title":"Why is this threaded code not running concurrently?","body":"<p>I'm attempting to thread some gui code to get rid of the lag in a combo box. The option the user selects does a bit of web scraping in the background, and depending on which option they select, the lag can sometimes be substantial as the program seeks the data it needs. </p>\n\n<p>For the <a href=\"http://docs.python.org/library/threading.html#thread-objects\" rel=\"nofollow\">docs</a>, it seems that to start a thread, I only need call <code>threading.Thread</code> with the appropriate arguments. So, my attempt of this in code is as follows: </p>\n\n<pre><code>def EvtComboBox(self, event):\n    self.statusBox.AppendText('Fetching ' + event.GetString() + ' data.\\n')\n    loadingThread = threading.Thread(target=self.doStuff(event), name='i_am_a_thread')\n    loadingThread.start()\n    threading.Thread(target=self.checker(loadingThread)).start()\n\ndef doStuff(self, event):\n    self.statusBox.AppendText(event.GetString() + ':\\n')        \n    self.assets = self.scraper.loadConferencePage(event.GetString())\n    self.statusBox.AppendText(str(self.scraper.getNumOfNewHandouts(self.assets)) + ' new handout(s) in Asset Manager\\n' + \n                                '-------------------------\\n\\n')\n\ndef checker(self, loadingThread):\n    while threading.Thread.isAlive(loadingThread):\n        print True\n</code></pre>\n\n<p>The behavior I'm expecting is that the <code>loadingthread</code> starts, and begins fetching the data it needs from the web. While it is doing that, I thought the second thread I create, would monitor that first thread, and my final assumption was that since those two threads are running \"concurrently\", the EvtComboBox method would finish, and the combobox in the gui would close. </p>\n\n<p>However, none of that happens. The <code>EvtComboBox</code> method fires, and then the code seems to run completely sequentially. If I stick a print statement below the two threads (just to see when it gets executed, </p>\n\n<pre><code>def EvtComboBox(self, event):\n    self.statusBox.AppendText('Fetching ' + event.GetString() + ' data.\\n')\n    loadingThread = threading.Thread(target=self.doStuff(event), name='i_am_a_thread')\n    loadingThread.start()\n    threading.Thread(target=self.checker(loadingThread)).start()\n    print 'EvtComboBox method finished'\n</code></pre>\n\n<p>It only gets executed <em>after</em> the code the threads call gets run... so.. I'm unsure why it is behaving in this manner. </p>\n\n<p>Why isn't it executing concurrently? </p>\n"},{"tags":["java","android","multithreading","service"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12454478,"title":"Resource sharing or file lock among concurrent Android services","body":"<p>I have three services in my Android app that are fired by two broadcast receivers. The first two write onto a file and are fired by one broadcast receiver so I can make sure that they are executed one after the other (via <code>Context.sendOrderedBroadcast()</code>). The third one is on its own and is fired by a separate broadcast receiver, but reads from the same file that the first two write on.</p>\n\n<p>Because the broadcast receivers may be fired at the same time or nearly the same time as each other, the file might also be accessed concurrently. How can I prevent that from happening? I want to be able to either read first then write or write then read. I'm just not sure if this problem is similar to Java concurrency in general because android services, if I'm not mistaken, are an entirely different beast.</p>\n"},{"tags":["linux","multithreading","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":788776,"title":"Pthreads as a standard solution for simultaneous console input in UNIX?","body":"<p>I got an assessment to write a simple chat client for Linux using ncurses. The chat has two windows: one displays what the other client says, the other handles user input.</p>\n\n<p>What confuses me here is how to handle data that constantly comes from the socket and waits for the user's input at the same time. The only one solution that comes into my mind is to use pthreads, but I have a feeling that I'm missing something more appropriate.</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["iphone","multithreading","uiwebview","grand-central-dispatch","uiwebviewdelegate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12836087,"title":"Loading images in webview blocking MAIN THREAD despite using multithreading","body":"<p>I have a html string which contains <code>&lt;img&gt;</code> tag with a image URL. I have loaded the html string as follows using grand central dispatch.. But my app stuck till the images fully loaded..help me please\n`</p>\n\n<pre><code>background=dispatch_queue_create(\"background_queues\", NULL);\n\ndispatch_async(background, ^{    \n\n    [webView loadHTMLString:myDescriptionHTML baseURL:NULL]; });\n\ndispatch_release(background);\n</code></pre>\n\n<p>Thanks in advance..</p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":75,"score":2,"question_id":12850318,"title":"Thread Safety with less locking","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12810549/c-sharp-threading-blocking\">C# Threading &amp; Blocking</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to effectively determine which approach is better: </p>\n\n<p>Currently, I have a singleton instance that exposes entities that are loaded in lazy load fashion. I have listed three approaches which each of which has some advantages. The first approach relies solely on double lock pattern to ensure thread safety. The second approach doesn't use locking but it has the potential of double Load in case of a race. The third approach really uses a solution that I am becoming very fond of. (System.Lazy). </p>\n\n<p>For some reason, I feel there is something wrong with the second approach (System.Thread.InterLocked), yet i can't pin point it. Is there a reason to favor one approach over the other? I did cover this in a previous post where I felt the third option is the way to go from now on.</p>\n\n<p>I stripped the code to the barebones to be able explain the design. </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\n\nnamespace TPLDemo\n{\n  public class SomeEntity\n  {\n  }\n\n  public class MultiThreadedManager\n  {\n    private static readonly System.Lazy&lt;MultiThreadedManager&gt; instance = new Lazy&lt;MultiThreadedManager&gt;(() =&gt; { return new MultiThreadedManager(); });\n    private readonly object _syncRoot = new object();\n    private List&lt;SomeEntity&gt; _inMemoryEntities = null;\n    private List&lt;SomeEntity&gt; _inMemoryEntitiesUsingLockFreeApproach = null;\n    private System.Lazy&lt;List&lt;SomeEntity&gt;&gt; _inMemoryUsingLazy = new Lazy&lt;List&lt;SomeEntity&gt;&gt;(() =&gt; { return MultiThreadedManager.Instance.LoadFromSomewhere(); });\n\n    public static MultiThreadedManager Instance\n    {\n      get { return instance.Value; }\n    }\n\n\n    public IEnumerable&lt;SomeEntity&gt; LazyEntities\n    {\n      get\n      {\n        return _inMemoryUsingLazy.Value;\n      }\n    }\n\n    public IEnumerable&lt;SomeEntity&gt; LocklessEntities\n    {\n      get\n      {\n        if (_inMemoryEntitiesUsingLockFreeApproach == null)\n        {\n          do\n          {\n          // Is it possible multiple threads hit this at the same time?\n          } while (System.Threading.Interlocked.CompareExchange&lt;List&lt;SomeEntity&gt;&gt;(ref                _inMemoryEntitiesUsingLockFreeApproach, this.LoadFromSomewhere(), null) != null);\n        }\n\n        return _inMemoryEntitiesUsingLockFreeApproach;\n      }\n    }\n\n\n    /// &lt;summary&gt;\n    /// This is thread safe but it involved some locking. \n    /// &lt;/summary&gt;\n    public IEnumerable&lt;SomeEntity&gt; Entities\n    {\n      get\n      {\n        if (_inMemoryEntities == null)\n        {\n          lock (_syncRoot)\n          {\n            if (_inMemoryEntities == null)\n            {\n              List&lt;SomeEntity&gt; list = this.LoadFromSomewhere();\n              _inMemoryEntities = list;\n            }\n          }\n        }\n\n        return _inMemoryEntities;\n      }\n    }\n\n    private List&lt;SomeEntity&gt; LoadFromSomewhere()\n    {\n      return new List&lt;SomeEntity&gt;();\n    }\n\n    public void ReloadEntities()\n    {\n      // This is sufficient becasue any subsequent call will reload them safely. \n      _inMemoryEntities = null;\n\n      // This is sufficient becasue any subsequent call will reload them safely. \n      _inMemoryEntitiesUsingLockFreeApproach = null;\n\n      // This is necessary becasue _inMemoryUsingLazy.Value is readonly.\n      _inMemoryUsingLazy = new Lazy&lt;List&lt;SomeEntity&gt;&gt;(() =&gt; { return MultiThreadedManager.Instance.LoadFromSomewhere(); });\n    }\n  }\n}\n</code></pre>\n"},{"tags":["java","multithreading","synchronization","wait","notify"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":85,"score":-6,"question_id":12747704,"title":"How can I get my threaded program to print specific output","body":"<p>I am having problem dealing with synchronization java threads, applying wait and notify..</p>\n\n<p>I want to figure out how could I implement these in a program where I can print out the answer alternately.. for example person1 will count numbers 1-5 as well as person2, the output should be like this.</p>\n\n<pre><code>person1 count 1\nperson2 count 1\nperson1 count 2\nperson2 count 2\nperson1 count 3\nperson2 count 3\nperson1 count 4\nperson2 count 4\nperson1 count 5\nperson2 count 5\n</code></pre>\n\n<p>Thanks guys.</p>\n"},{"tags":["c#","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12799662,"title":"Using multiple threads in C#","body":"<p>I want to do independent tasks of parsing multiple files in a system and get the version of each as follows:</p>\n\n<pre><code>public void obtainVersionList()\n{\n\n    for(int iterator = 1; iterator &lt; list.length; iterator++) //list stores all the file names\n    {\n        Thread t = new Thread( () =&gt; GetVersion(ref list[iterator]) \n        //list will again store the fileVersions using GetVersion()\n    }\n}\n</code></pre>\n\n<p>Here, </p>\n\n<ol>\n<li>I get Index out of bounds exception.  How's that possible as I've checked a condition iterator &lt; list.length. Is this due to multiple threads running?</li>\n<li>How to minimize the operation time when we parse multiple files in the disk?</li>\n</ol>\n"},{"tags":["c#",".net","multithreading","memory-leaks","tcpclient"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12643794,"title":".NET Threading issue, TcpClient","body":"<p>My service's thread count is going bonkers.</p>\n\n<p>I create new tcpclient every time a connection is needed. that is handled by taskfactory, with longrunning task flag.</p>\n\n<p>I use 2 concurrent bags and manualresetevents, the code disposes of objects properly and nothing is left hanging (to my knowledge).</p>\n\n<p>The problem only occurs on windows xp machine, windows 7 is ok. So I guess it is not the code.</p>\n\n<p>Is there any way to check how busy is the threadpool on a PC?</p>\n\n<p>I have already posted about it <a href=\"http://stackoverflow.com/questions/12622114/taskfactory-tcpclient#comment17019767_12622114\">here</a></p>\n\n<p>Any advice greatly appreciated.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SB2I4.png\" alt=\"Attached screenshot shows the problem\"></p>\n\n<p>Thanks Luke</p>\n"},{"tags":["c#","multithreading","usercontrols","delegates","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":12766219,"title":"C# thread-safe calls on dynamically created controls","body":"<p>I know how to perform thread-safe calls on user controls, but when they are dynamically generated I don't have a clue. I tried to make an array list of them (rich text boxes) and I had problems with the 'parameter start thread' delegate after that. You input is much appreciated.</p>\n\n<pre><code>    private void SetText(string text)\n    {\n        // InvokeRequired required compares the thread ID of the \n        // calling thread to the thread ID of the creating thread. \n        // If these threads are different, it returns true. \n        if (this.currentBox.InvokeRequired)\n        {\n            SetTextCallback d = new SetTextCallback(SetText);\n            this.Invoke( d, new object[] { text } );\n        }\n        else\n        {\n            this.currentBox.Text += text;\n        }\n    }\n\n  // This method is executed on the worker thread and makes \n    // a thread-safe call on the TextBox control. On a specific text box.....\n    private void ThreadProcSafe()\n    {\n        int i = 0;\n        while(_stop_threads == false) {\n            this.SetText(String.Format(\"{0}\\n\", i));\n\n            ++i;\n            Thread.Sleep(100);\n        }\n\n        this.SetText(String.Format(\"Thread Time: {0}:{1}:{2}\\n\", DateTime.Now.TimeOfDay.Hours, DateTime.Now.TimeOfDay.Minutes, DateTime.Now.TimeOfDay.Seconds)); \n\n    }\n</code></pre>\n"},{"tags":["c","linux","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":12843890,"title":"98th call to pthread_create() fails","body":"<p>I'm running the following program. It simply creates threads that die straight away.</p>\n\n<p>What I have found is that after 93 to 98 (it varies slightly) successful calls, every next call to pthread_create() fails with error 11: Resource temporarily unavailable. I think I'm closing the thread correctly so it should give up on any resources it has but some resources become unavailable.</p>\n\n<p>The first parameter of the program allows me to set the interval between calls to pthread_create() but testing with different values, I've learned that the interval does not matter (well, I'll get the error earlier): the number of successful calls will be the same.</p>\n\n<p>The second parameter of the program allows me to set a sleep interval after a failed call but the length of the interval does not seem to make any difference.</p>\n\n<p>Which ceiling am I hitting here?</p>\n\n<p>EDIT: found the error in doSomething(): change lock to unlock and the program runs fine. The question remains: what resource is depleted with the error uncorrected?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n#include &lt;math.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;errno.h&gt;\n\npthread_mutex_t doSomethingLock;\n\nvoid milliSleep(unsigned int milliSeconds)\n{\n    struct timespec ts;\n\n    ts.tv_sec = floorf(((float)milliSeconds / 1000));\n    ts.tv_nsec = ((((float)milliSeconds / 1000) - ts.tv_sec)) * 1000000000;\n    nanosleep(&amp;ts, NULL);\n}\n\nvoid *doSomething(void *args)\n{\n    pthread_detach(pthread_self());\n    pthread_mutex_lock(&amp;doSomethingLock);\n    pthread_exit(NULL);\n}\n\n\nint main(int argc, char **argv)\n{\n    pthread_t doSomethingThread;\n    pthread_mutexattr_t attr;\n    int threadsCreated = 0;\n\n\n    if (argc != 3)\n    {\n        fprintf(stderr, \"usage: demo &lt;interval between pthread_create() in ms&gt; &lt;time to wait after fail in ms&gt;\\n\");\n        exit(1);\n    }\n\n    pthread_mutexattr_init(&amp;attr);\n    pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_RECURSIVE_NP);\n    pthread_mutex_init(&amp;doSomethingLock, &amp;attr);\n\n    while (1)\n    {\n        pthread_mutex_lock(&amp;doSomethingLock);\n        if (pthread_create(&amp;doSomethingThread, NULL, doSomething, NULL) != 0)\n        {\n            fprintf(stderr, \"%d pthread_create(): error %d, %m\\n\", threadsCreated, errno);\n            milliSleep(atoi(argv[2]));\n        }\n        else threadsCreated++;\n        milliSleep(atoi(argv[1]));\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","parallel-foreach"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":159,"score":1,"question_id":12847145,"title":"C# Parallel foreach - System.AggregateException: One or more errors occurred. ---> System.IndexOutOfRangeException","body":"<p>Found the answer, ... The mistake in the code was that I was adding data to the wrong list </p>\n\n<hr>\n\n<p>I know this has been asked a few times but I am simply unable to figure out why this will give an exception, am I missing a lock somewhere ?</p>\n\n<pre><code>var sendsToday = new List&lt;TSend&gt;();\n\nvar threads = _maxNumberOfThreads;\nif (threads &lt;= 0)\n    threads = 1;\n\nParallel.ForEach(_subscribers,\n    new ParallelOptions { MaxDegreeOfParallelism = threads },\n    () =&gt; new ContentSendLocalStorage&lt;TSend, TMedium&gt;(_contentServices, _logService),\n    (subscriber, loopState, localStorage) =&gt;\n    {\n        localStorage.LogService.Warning(string.Format(\"Choosing content for subscriber {0}\", subscriber.SubscriberId));\n        foreach (var newsletterId in subscriber.SubscribedNewsletterIds)\n        {\n            localStorage.LogService.Warning(string.Format(\"Choosing content for newsletter {0}\", newsletterId));\n            var clicks = StateBag.Get&lt;LookupList&gt;(StateKeys.LookupList).Clicks.Where(c =&gt; c.Subscriber.SubscriberId == subscriber.SubscriberId).Select(c =&gt; c.Content.ContentId).ToArray();\n\n            foreach (var contentService in _contentServices.Where(contentService =&gt; contentService.Contents.Count != 0))\n            {\n                subscriber.UrlsClicked = contentService.Contents\n        .Where(c =&gt; clicks.Contains(c.ContentId))\n        .GroupBy(g =&gt; g.Page.Url)\n        .ToDictionary(k =&gt; k.Key, v =&gt; 1);\n\n                var best = contentService.GetBestForSubscriber(subscriber, new TMedium { MediumId = int.Parse(newsletterId) });\n                if (best != null)\n        sendsToday.Add(best);\n            }\n        }\n\n        localStorage.LogService.Warning(string.Format(\"Done choosing content for subscriber {0}\", subscriber.SubscriberId));\n        return localStorage;\n    },\n    finalStorage =&gt;\n    {\n        lock (ContentSendLock)\n        {\n            sendsToday.AddRange(finalStorage.SubscriberSends);\n        }\n    });\n</code></pre>\n\n<p>I keep getting the exception below :</p>\n\n<pre><code>System.AggregateException: One or more errors occurred. ---&gt; System.IndexOutOfRangeException: Index was outside the bounds of the array.\n   at System.Collections.Generic.List`1.Add(T item)\n   at WFM.Newsletter.Business.CORE.OptimizationEngine`2.&lt;&gt;c__DisplayClassd.&lt;Start&gt;b__4(Subscriber subscriber, ParallelLoopState loopState, ContentSendLocalStorage`2 localStorage)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClass21`2.&lt;ForEachWorker&gt;b__1a(Int32 i, ParallelLoopState state, TLocal local)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClassf`1.&lt;ForWorker&gt;b__c()\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.InnerInvokeWithArg(Task childTask)\n   at System.Threading.Tasks.Task.&lt;&gt;c__DisplayClass7.&lt;ExecuteSelfReplicating&gt;b__6(Object )\n   --- End of inner exception stack trace ---\n   at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\n   at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)\n   at System.Threading.Tasks.Parallel.ForWorker[TLocal](Int32 fromInclusive, Int32 toExclusive, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Func`4 bodyWithLocal, Func`1 localInit, Action`1 localFinally)\n   at System.Threading.Tasks.Parallel.ForEachWorker[TSource,TLocal](TSource[] array, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Action`3 bodyWithStateAndIndex, Func`4 bodyWithStateAndLocal, Func`5 bodyWithEverything, Func`1 localInit, Action`1 localFinally)\n   at System.Threading.Tasks.Parallel.ForEachWorker[TSource,TLocal](IEnumerable`1 source, ParallelOptions parallelOptions, Action`1 body, Action`2 bodyWithState, Action`3 bodyWithStateAndIndex, Func`4 bodyWithStateAndLocal, Func`5 bodyWithEverything, Func`1 localInit, Action`1 localFinally)\n   at System.Threading.Tasks.Parallel.ForEach[TSource,TLocal](IEnumerable`1 source, ParallelOptions parallelOptions, Func`1 localInit, Func`4 body, Action`1 localFinally)\n   at WFM.Newsletter.Business.CORE.OptimizationEngine`2.Start()\n   at WFM.Newsletter.Business.CORE.OptimizationService.Start(IEnumerable`1 subscribers, IEnumerable`1 newsletters, LookupList lookupList, LocalConfig config, ILogging logService, Int32 maxNumberOfThreads, String subscriberClicksSourceTableName)\n---&gt; (Inner Exception #0) System.IndexOutOfRangeException: Index was outside the bounds of the array.\n   at System.Collections.Generic.List`1.Add(T item)\n   at WFM.Newsletter.Business.CORE.OptimizationEngine`2.&lt;&gt;c__DisplayClassd.&lt;Start&gt;b__4(Subscriber subscriber, ParallelLoopState loopState, ContentSendLocalStorage`2 localStorage)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClass21`2.&lt;ForEachWorker&gt;b__1a(Int32 i, ParallelLoopState state, TLocal local)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClassf`1.&lt;ForWorker&gt;b__c()\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.InnerInvokeWithArg(Task childTask)\n   at System.Threading.Tasks.Task.&lt;&gt;c__DisplayClass7.&lt;ExecuteSelfReplicating&gt;b__6(Object )&lt;---\n\n---&gt; (Inner Exception #1) System.IndexOutOfRangeException: Index was outside the bounds of the array.\n   at System.Collections.Generic.List`1.Add(T item)\n   at WFM.Newsletter.Business.CORE.OptimizationEngine`2.&lt;&gt;c__DisplayClassd.&lt;Start&gt;b__4(Subscriber subscriber, ParallelLoopState loopState, ContentSendLocalStorage`2 localStorage)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClass21`2.&lt;ForEachWorker&gt;b__1a(Int32 i, ParallelLoopState state, TLocal local)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClassf`1.&lt;ForWorker&gt;b__c()\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.InnerInvokeWithArg(Task childTask)\n   at System.Threading.Tasks.Task.&lt;&gt;c__DisplayClass7.&lt;ExecuteSelfReplicating&gt;b__6(Object )&lt;---\n\n---&gt; (Inner Exception #2) System.IndexOutOfRangeException: Index was outside the bounds of the array.\n   at System.Collections.Generic.List`1.Add(T item)\n   at WFM.Newsletter.Business.CORE.OptimizationEngine`2.&lt;&gt;c__DisplayClassd.&lt;Start&gt;b__4(Subscriber subscriber, ParallelLoopState loopState, ContentSendLocalStorage`2 localStorage)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClass21`2.&lt;ForEachWorker&gt;b__1a(Int32 i, ParallelLoopState state, TLocal local)\n   at System.Threading.Tasks.Parallel.&lt;&gt;c__DisplayClassf`1.&lt;ForWorker&gt;b__c()\n   at System.Threading.Tasks.Task.InnerInvoke()\n   at System.Threading.Tasks.Task.InnerInvokeWithArg(Task childTask)\n   at System.Threading.Tasks.Task.&lt;&gt;c__DisplayClass7.&lt;ExecuteSelfReplicating&gt;b__6(Object )&lt;---\n</code></pre>\n"},{"tags":["multithreading","perl","hash","share"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12848312,"title":"How to share hash of hash in multithread perl","body":"<p>One way to share a hash of hash is to declare every level of hashes like:</p>\n\n<pre><code>my %hash : shared;\n$hash{test} = &amp;share({});\n</code></pre>\n\n<p>but what if the first level keys' amount cannot be predicted or too much that you cannot declare every one.</p>\n\n<p>like the code below:</p>\n\n<pre><code>#!/usr/bin/perl -w\nuse strict;\nuse threads;\nuse threads::shared;\n\nmy %counts :shared;\nmy $infile = $ARGV[0];\nopen my $inf, \"$infile\";\n\nwhile(my $inline = &lt;$inf&gt;){\n    chomp($inline);\n    my @entry = split(/\\t/,$inline);\n    my $t = threads-&gt;create('WORK',@entry)-&gt;join;\n}\n\nforeach my $i(sort {$a cmp $b} keys %counts){\n    foreach my $j(sort {$a cmp $b} keys %{$counts{$i}}){\n        print \"$i\\t$j\\t$counts{$i}{$j}\\n\";\n    }\n}\n\nsub WORK{\n    my @work = @_;\n    $counts{$work[0]}{$work[1]}++;\n}\n</code></pre>\n\n<p>And the test set:</p>\n\n<pre><code>apple   pie\nbanana  icecream\norange  juice\nmango   juice\nmango   pie\nmango   pie\n......\n</code></pre>\n\n<p>The script will be stopped by warning you that \"Invalid value for shared scalar at SOME line\". So is there a way I can share both %counts and %{$counts{KEY1}}? Suppose I don't know how many and what kinds of fruit I will observe of test set column one and the output should be like:</p>\n\n<pre><code>apple    pie      1\nbanana   icecream 1\nmango    juice    1\nmango    pie      2\norange   juice    1\n</code></pre>\n"},{"tags":["multithreading","qt"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":11412757,"title":"Ensuring QProcess termination on termination of its parent QThread","body":"<p>I am writing a code within Qt where I am using multiple threads (Qthreads) to launch command-line processes in a manner shown in the code snippet below:</p>\n\n<pre><code>void test_streamer_thread::run()\n{\n    QProcess    start_process;\n    ...\n\n    ret_status = start_process.execute(\"some_cmd.exe\",some_args);\n    start_process.close();\n}\n</code></pre>\n\n<p>Once launched, the process goes on infinitely (shows up as a separate process in the windows task manager). However, when the application terminates, the process still continues to exist. How do I ensure that this process terminates on termination of the application launching it.</p>\n\n<p>Regards,</p>\n\n<p>Saurabh Gandhi</p>\n"},{"tags":["android","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12848004,"title":"Threading issue when want to have a looping update to the UI from a background thread in Android","body":"<p>I am trying to update the UI in a loop in Android but I am getting an error that says that I am on the wrong thread.  I don't see why since I am using a handler.  Does anyone have any suggestions?</p>\n\n<pre><code>TextView textView;\nprotected Handler handler=new Handler(){\n    @Override\n    public void handleMessage(Message msg) {\n        super.handleMessage(msg);\n        textView.setText((String)msg.obj);  \n    }\n};\n\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_thread_sleep);\n    textView=(TextView) findViewById(R.id.TextView1);\n    init();\n}\n\npublic void init()\n{\n    CounterThread counterThread=new CounterThread();\n    counterThread.start();\n\n}\n\n@Override\npublic boolean onCreateOptionsMenu(Menu menu) {\n    getMenuInflater().inflate(R.menu.activity_thread_sleep, menu);\n    return true;\n}\n\nclass CounterThread extends Thread {\n\n    @Override\n    public void run() {\n        super.run();\n        int counter=0;\n\n        handleString(\"in Thread handler\");\n        try{Thread.sleep(2000); }catch(Exception e){Log.d(\"Exception\", e.toString());}\n\n        while(counter&lt;10)\n        {\n            counter++;\n            String counterString=String.valueOf(counter);\n            handleString(counterString);\n\n            try{Thread.sleep(2000); }catch(Exception e){Log.d(\"Exception\", e.toString());}\n        }//while\n    }//run \n\n    public void handleString(String string)\n    {\n        Message msg=handler.obtainMessage();\n        msg.obj=\"counter\"+\" \"+string;\n        handler.handleMessage(msg);\n    }\n\n}//thread\n</code></pre>\n"},{"tags":["multithreading","gui","chat","javafx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12840159,"title":"GUI and Threads in a chat program","body":"<p>Hello guys ive been searching for an answer to this question and was unable to find a suiting solution to my problem.</p>\n\n<p>i have a chat program that has a somewhat advanced gui. The chat program in total consists of two programs a server and a client. ive created a protocol that my clients listens to and reacts depending on what type information it gets. </p>\n\n<p>i have created a class called clientReciver which extends Thread. but i am now confused on how i will get the informaiton that the thread recives and use it in my gui. </p>\n\n<p>and example of this could be how will i get the text that one of my clients sends and add it to my GUI?</p>\n\n<p>It may be worth mentioning that i am using JavaFx Scenebuilder to build my GUI.</p>\n\n<p>Hope someone is able to help be</p>\n\n<p>Best Regards Marc Rasmussen</p>\n"},{"tags":[".net","multithreading","concurrency","immutable"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":313,"score":5,"question_id":5433579,"title":"How thread safe are immutable objects?","body":"<p><strong>Everybody says that immutable objects are thread safe, but why is this?</strong></p>\n\n<p>Take the following scenario running on a multi core CPU:</p>\n\n<ul>\n<li>Core 1 reads an object at memory location <code>0x100</code> and it is cached in the L1/L2 cache of Core 1;</li>\n<li>The GC collects this object at that memory location because it has become eligible and <code>0x100</code> becomes available for new objects;</li>\n<li>Core 2 allocates an (immutable) object which is located at address <code>0x100</code>;</li>\n<li>Core 1 gets a reference to this new object and reads it at memory location <code>0x100</code>.</li>\n</ul>\n\n<p>In this situation, when Core 1 asks for the value at location <code>0x100</code> is it possible that it reads the stale data from its L1/L2 cache? My intuition says that a memory gate is still needed here to ensure that Core 1 reads the correct data.</p>\n\n<p>Is the above analysis correct and is a memory gate required, or am I missing something?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>The situation I describe here is a more complex version of what happens every time the GC does a collect. When the GC collects, memory is reordered. This means that the physical location the object was located at changes and that L1/L2 must be invalidated. Roughly the same applies to the example above.</p>\n\n<p>Since it is reasonable to expect that .NET ensures that after reordering memory, different cores see the correct memory state, the above situation will not be a problem too.</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1782,"score":0,"question_id":761485,"title":"Multiple animated JPanels - only last one added to JFrame is displaying","body":"<p>I am making a multithreaded pacman game. </p>\n\n<p>There is a PacmanController class which extends JFrame, a Maze class which extends JPanel, a Pacman class which runs in its own thread and extends JPanel, and a Ghost class which runs in its own thread and extends JPanel. Each thread (pacman and each Ghost) continuously repaints itself and calls maze.repaint() as well.</p>\n\n<p>When I add the maze to the frame, it displays fine, if I then add pacman, it still displays and animates fine. </p>\n\n<p>However, when I add the Ghost to the frame after pacman, the ghost appears and pacman disappears. If I switch the order in which pacman and the ghost are added, the opposite is true i.e. only one of pacman or each instance of ghost is ever displayed - the one which is added last.</p>\n\n<p>Eg:</p>\n\n<pre><code>add(maze);\nadd(pacman);\nadd(ghostA);\n</code></pre>\n\n<p>Only the maze and ghostA appear?</p>\n\n<p>I realize this has something to do with JFrames BorderLayout, i.e. only one component can be added to the center region, but don't know how to fix it. I have tried adding pacman and ghosts to EAST WEST etc but this didn't work.</p>\n\n<p>I have also tried</p>\n\n<pre><code>maze.add(pacman);\nadd(pacman); //etc\n</code></pre>\n\n<p>but this didn't work either.</p>\n\n<p>Sorry for the long post, any help is much appreciated. I can't post any code as the code is too long and spread over many classes.</p>\n\n<p>Many thanks!</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":2,"view_count":56,"score":1,"question_id":12846517,"title":"Java Synchronization and Re-Entrant locking","body":"<p>when we Synchronize on an object, is this a Re-Entrant lock? Is there a real difference between between a Synchronization lock and a Re-Entrant lock ? </p>\n\n<p>Kind Regards,</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12845484,"title":"Multithreading while call-back to a function","body":"<p>Ok this could be a very big question.</p>\n\n<p>I have one service(say notifier) and one of method [say notifyTransaction(Transaction trans) ] of this service  is remotely available for callbacks.</p>\n\n<p>Now there is other service say (transactionsReader) which keeps reading incoming transactions and calls up the remote method of notifier that is <code>notifyTransaction(Transaction trans).</code></p>\n\n<p>Now to explain you the problem, I would like to add that my transaction contains more than one Operations. And for treating operations i have one function say <code>processOperation(Operation op).</code> </p>\n\n<p>This <code>processOperation(Operation op)</code> actually do some updates on a database.</p>\n\n<p>Whats the problem ?\n  The service transactionsReader is reading incoming transactions at very fast speed and calling up the <code>notifyTransactions()</code> at the speed much greater than the speed of processing operations by <code>processOperation(Operation op)</code> method.</p>\n\n<p>What I want to do ?\n I want to use multithreadint in <code>notifyTransactions()</code> so that I have multiple threads to treat every transaction.</p>\n\n<p>For starting I used \n<code>ExecutorService executor = Executors.newFixedThreadPool(2);</code>\nin the method <code>notifyTransactions()</code> and created task of my method processOperation(Operation op). But this creates a different pool for every call to <code>notifyTransactions()</code> so I had somewhere around 3000 pools in few seconds. And finally it went Out of Memory.</p>\n\n<p>What could be other possible solutions ?</p>\n\n<p>Thanks in advance :)</p>\n"},{"tags":["c++","multithreading","visual-studio-2008","tbb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12836729,"title":"Creating a thread in via TBB library","body":"<p>I have a code like this:</p>\n\n<pre><code>    #include &lt;iostream&gt;\n    #include &lt;tbb/tbb.h&gt;\n    #include &lt;Windows.h&gt;\n\n\n\n    bool MyThread(int something)\n    {\n        std::cout &lt;&lt; \"This is a thread function\\n\" &lt;&lt; std::endl;\n\n        for (int i = 0; i &lt; 10000; i++)\n        {\n            something++;\n            Sleep(1);\n        }\n\n        return true;\n    }\n\n    int main ()\n    {\n        tbb::tbb_thread pMyThread = tbb::tbb_thread(MyThread, 3);\n\n        pMyThread.join();\n\n        return 0;\n    }\n</code></pre>\n\n<p>But if I compile it in VS 2008 it shows:\n        error C2248: 'tbb::internal::tbb_thread_v3::tbb_thread_v3' : cannot access private                member declared in class 'tbb::internal::tbb_thread_v3'</p>\n\n<p>for the first string of main() function. Where am I wrong?</p>\n"},{"tags":["c#","multithreading","windowservice"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":52,"score":1,"question_id":12844296,"title":"windows service application installation","body":"<p>I am beginner to .NET. </p>\n\n<p>I have a question regarding windows service application running multi-thread. My question is when I tried to register my application into windows service, I see my service status in \"starting\" in the service windows. I have included few lines code to show what I am trying to do. </p>\n\n<pre><code>protected override void OnStart(string [] args) {\n    timer = Timer(5000);\n    timer.Elapsed += new ElapsedEventHandler(OnElapsedTime); \n    timer.Start();\n\n    // when I commented out Application.Run() it runs perfect.\n    Application.Run(); // run until all the threads finished working\n    //todo\n}\n\nprivate void OnElapsedTime(object s, ElapsedEventArgs e) {\n    SmartThreadPool smartThreadPool = new SmartThreadPool();\n\n    while( i &lt; numOfRecords){\n         smartThreadPool.QueueWorkItem(DoWork);\n         //.....\n    }\n}\n</code></pre>\n\n<p>If you need further information please let me know.</p>\n"},{"tags":["android","multithreading","http","android-asynctask","thread-exceptions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12841533,"title":"Android:how to start activity from async task in android","body":"<p>In my android application , I want to start activity class from async-task.this a login pahe class. It gives error in <code>else</code> part in <code>onPostExecute(String result)</code>(when start in new activity). error :<code>Android - android.os.NetworkOnMainThreadException</code> I used several method to fix this but I'm unable to fix this one. please some one gives me a help</p>\n\n<pre><code>public class Login extends Activity {\n\nprivate Button btnLogin;\nprivate EditText txtusername;\nprivate EditText txtPassword;\npublic String username;\npublic String password;\npublic boolean doLogin = false;\n\n\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n\n    requestWindowFeature(Window.FEATURE_NO_TITLE);\n    setContentView(R.layout.login);\n\n\n    btnLogin = (Button) findViewById(R.id.btnLogin);\n    txtusername = (EditText) findViewById(R.id.txtuserName);\n    txtPassword = (EditText) findViewById(R.id.txtPassword);\n    btnLogin.setOnClickListener(new OnClickListener() {\n\n        public void onClick(View arg0) {\n\n            username = txtusername.getText().toString();\n            password = txtPassword.getText().toString();\n\n            if (username.equals(\"\") || password.equals(\"\")) {\n\n                AlertDialog alert = new AlertDialog.Builder(Login.this)\n                        .create();\n                alert.setMessage(\"Username or Password can not be Empty\");\n                alert.setButton(\"OK\",\n                        new DialogInterface.OnClickListener() {\n                            public void onClick(DialogInterface dialog,\n                                    int which) {\n                            }\n                        });\n\n                alert.setIcon(R.drawable.loginlogo);\n                alert.show();\n\n            }\n\n            else {\n\n                HttpAsync httpasync = new HttpAsync();\n\n                httpasync.execute(new String[] { \"http://www.diskonbanget.com/bni/login/login.php\" });\n\n            }\n\n        }\n\n    });\n\n}\n\nprivate class HttpAsync extends AsyncTask&lt;String, Void, String&gt; {\n\n    @Override\n    protected String doInBackground(String... params) {\n        String str = null;\n        try {\n\n            // Create a new HttpClient and Post Header\n            HttpClient httpclient = new DefaultHttpClient();\n            HttpPost httppost = new HttpPost(\n                    \"http://www.diskonbanget.com/bni/login/login.php\");\n            List&lt;NameValuePair&gt; nameValuePairs = new ArrayList&lt;NameValuePair&gt;(\n                    2);\n            nameValuePairs\n                    .add(new BasicNameValuePair(\"username\", username));\n            nameValuePairs\n                    .add(new BasicNameValuePair(\"password\", password));\n            httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));\n\n            // Execute HTTP Post Request\n\n            HttpResponse response = httpclient.execute(httppost);\n\n            str = inputStreamToString(response.getEntity().getContent())\n                    .toString();\n\n        } catch (Exception e) {\n            return str;\n        }\n        return str;\n    }\n\n    @Override\n    protected void onPostExecute(String result) {\n        String str = result;\n\n        if (str.toString().equalsIgnoreCase(\"false\")) {\n\n            AlertDialog alert = new AlertDialog.Builder(Login.this)\n                    .create();\n            alert.setMessage(\"Please enter valid username &amp; Password\");\n            alert.setButton(\"OK\", new DialogInterface.OnClickListener() {\n                public void onClick(DialogInterface dialog, int which) {\n                }\n            });\n\n            alert.setIcon(R.drawable.loginlogo);\n            alert.show();\n\n        }\n\n        else if (str.toString().equalsIgnoreCase(\"null\")) {\n            AlertDialog alert = new AlertDialog.Builder(Login.this)\n                    .create();\n            alert.setMessage(\"Can not Connect to the server.please make sure your internet is Switch on  \");\n            alert.setButton(\"OK\", new DialogInterface.OnClickListener() {\n                public void onClick(DialogInterface dialog, int which) {\n                }\n            });\n            alert.setIcon(R.drawable.loginlogo);\n            alert.show();\n        }\n\n        else {\n\n            Intent intent = new Intent(Login.this, MainMenu.class);\n            intent.putExtra(\"photo\", str);\n            intent.putExtra(\"username\", username);  \n            startActivity(intent);\n\n        }\n\n    }\n\n}\n\nprivate StringBuilder inputStreamToString(InputStream is) {\n    String line = \"\";\n    StringBuilder total = new StringBuilder();\n    // Wrap a BufferedReader around the InputStream\n    BufferedReader rd = new BufferedReader(new InputStreamReader(is));\n    // Read response until the end\n    try {\n        while ((line = rd.readLine()) != null) {\n            total.append(line);\n        }\n        return total;\n\n    } catch (Exception e) {\n\n        return null;\n    }\n\n}\n</code></pre>\n\n<p>this is my LogCat   </p>\n\n<pre><code>10-11 18:37:52.540: E/AndroidRuntime(2858): java.lang.RuntimeException: Unable to start activity ComponentInfo{com.bni.www/com.bni.www.MainMenu}: android.os.NetworkOnMainThreadException\n\n\n\n10-11 19:00:45.498: E/AndroidRuntime(2925):     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1026)\n10-11 19:00:45.498: E/AndroidRuntime(2925):     at android.os.Handler.dispatchMessage(Handler.java:99)\n10-11 19:00:45.498: E/AndroidRuntime(2925):     at android.os.Looper.loop(Looper.java:132)\n\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.lang.reflect.Method.invokeNative(Native Method)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.lang.reflect.Method.invoke(Method.java:491)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:841)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:599)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at dalvik.system.NativeStart.main(Native Method)\n 10-11 19:00:45.498: E/AndroidRuntime(2925): Caused by: android.os.NetworkOnMainThreadException\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at android.os.StrictMode$AndroidBlockGuardPolicy.onNetwork(StrictMode.java:1077)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.net.InetAddress.lookupHostByName(InetAddress.java:477)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.net.InetAddress.getAllByNameImpl(InetAddress.java:277)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.net.InetAddress.getAllByName(InetAddress.java:249)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpConnection.&lt;init&gt;(HttpConnection.java:69)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpConnection.&lt;init&gt;(HttpConnection.java:48)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpConnection$Address.connect(HttpConnection.java:304)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpConnectionPool.get(HttpConnectionPool.java:89)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnectionImpl.getHttpConnection(HttpURLConnectionImpl.java:292)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnectionImpl.makeConnection(HttpURLConnectionImpl.java:274)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at org.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnectionImpl.connect(HttpURLConnectionImpl.java:217)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.net.URLConnection.getContent(URLConnection.java:197)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at java.net.URL.getContent(URL.java:613)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at com.bni.www.MainMenu.onCreate(MainMenu.java:48)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at android.app.Activity.performCreate(Activity.java:4411)\n  10-11 19:00:45.498: E/AndroidRuntime(2925):   at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1048)\n 10-11 19:00:45.498: E/AndroidRuntime(2925):    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1781)\n  10-11 19:00:45.498: E/AndroidRuntime(2925):   ... 11 more \n  10-11 19:01:22.538: I/Process(2925): Sending signal. PID: 2925 SIG: 9\n  10-11 19:12:24.357: D/dalvikvm(2998): GC_FOR_ALLOC freed 43K, 3% free 6404K/6595K, paused 111ms\n  10-11 19:12:24.377: I/dalvikvm-heap(2998): Grow heap (frag case) to 7.295MB for 1031504-byte allocation\n  10-11 19:12:24.489: D/dalvikvm(2998): GC_FOR_ALLOC freed &lt;1K, 3% free 7411K/7623K, paused 86ms\n</code></pre>\n"},{"tags":["c#","multithreading",".net-4.0","volatile"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12842912,"title":"Volatile vs Interlocked for reads and writes in C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/154551/volatile-vs-interlocked-vs-lock\">Volatile vs. Interlocked vs. lock</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to understand situations when I would want to use the volatile keyword, vs Interlocked.</p>\n\n<p>If I have a variable where every read from, and write to, that object is via Interlocked.Exchange, is that essentially the same thing as marking that variable as volatile?</p>\n\n<pre><code>private object _threadSafe;\nprivate void Test()\n{\n    var tmp = new object();\n    Interlocked.Exchange(ref tmp, _threadSafe); //read\n    Interlocked.Exchange(ref _threadSafe, \"hi\"); //write\n\n}\n</code></pre>\n\n<p>If, instead of this, the _threadSafe object was marked as volatile and I removed the Interlocked's, would that be functionally equivalent? (Assume I am not dependent on atomic read/increment/writes, like incrementing a value).</p>\n"},{"tags":["c#","multithreading","threadabortexception"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12841099,"title":"Thread executing remote connection won't abort","body":"<p>I'm designing a small program whose objective is to make sure one of our server is up and running. In some cases, the server won't answer and a script must be launched to restart the server. </p>\n\n<p>First I'm starting a new thread responsible of fetching the information, which is then joined by the main thread for a certain time span. I then abort the thread to disconnect and finally join it to leave enough time to execute the catch and finally blocks.</p>\n\n<p>In theory it should work great : if the time span is short enough, it indeed indicates that the server is down (because no connection could be made in the short allocated timespan). But in certain cases, when the server is really down, the program will just keep executing, as if the ThreadAbortException had no effect. Problem is, these downtimes are quite sporadic so I couldn't debug it myself to see what was not working properly.</p>\n\n<p>Here's how it goes : </p>\n\n<p>This here is the main thread, calling the worker thread. Very straightforward.</p>\n\n<pre><code>public void LaunchCommand()\n{\n    Thread pingThread = new Thread(new ThreadStart(Ping));\n    pingThread.Start();\n    while (!pingThread.IsAlive);\n    pingThread.Join(new TimeSpan(0, 0, _maxTime)); \n    pingThread.Abort(); //  Time's up.\n    pingThread.Join();  //  Make sure we complete everything before moving on\n}\n</code></pre>\n\n<p>And here's the called thread :</p>\n\n<pre><code>private void Ping()\n{\n    try\n    {\n        Stopwatch stopwatch = new Stopwatch();\n        stopwatch.Start();\n\n        serviceType = Type.GetTypeFromProgID(serviceProgID, _server, true);\n        service = Activator.CreateInstance(serviceType);\n        _xmlResult = ApxServiceType.InvokeMember(\"ExecuteXML\", BindingFlags.InvokeMethod, null, service, new string[] { _dataset, Command, string.Empty }) as string;\n\n        stopwatch.Stop();\n        _latency = stopwatch.Elapsed;\n\n        // Trivial validations to make sure _status is true, such as _xmlResult.Contains(certainSubString); and such\n\n        _status = true;     //  Everything seems to work fine if we could make up to here.\n    }\n    catch (ThreadAbortException)\n    {\n        Console.WriteLine(\"Server timeout :(\");\n        return;\n    }\n    catch (Exception e)\n    {\n        Console.WriteLine(\"Server exception: \" + e.Message);\n        return;\n    }\n    finally\n    {\n        if (!_status)\n        {\n            _latency = new TimeSpan(0, 0, _maxTime);\n        }\n    }\n}\n</code></pre>\n\n<p>Variables such as Commands, serviceProgID, etc. have been declared elsewhere and are known to work well. I guess my problem spans from the three lines following the stopwatch declaration/initialization. First, I must say I copy pasted these lines from a similar application, but basically it should only fetch a result from the given Command. Unfortunately, because I couldn't debug under the critical situation, I don't which line is problematic, but anyway, it seems the ThreadAbortException has no effect. Is it because code has been switched off to unmanaged? </p>\n\n<p>I'm lost here so any idea would be welcomed! Thanks!</p>\n"},{"tags":["php","multithreading","thread-safety"],"answer_count":3,"favorite_count":2,"up_vote_count":19,"down_vote_count":0,"view_count":10739,"score":19,"question_id":681081,"title":"Is PHP thread-safe","body":"<ul>\n<li><strong>Is PHP (as of 5.2) thread-safe on Linux/UNIX?</strong> </li>\n<li><strong>Would it be possible to use it with Apache Worker-MPM or Event-MPM?</strong> </li>\n</ul>\n\n<p>The facts I gathered so far are inconclusive:</p>\n\n<ul>\n<li>default binaries included in most distributions have ZTS disabled, so I'm aware, that I'd have to recompile them. </li>\n<li>in theory Zend Engine (core PHP) with ZTS enabled is thread-safe.</li>\n<li>it's said that some modules might not be thread-safe, but haven't found any list of modules that are or that are not.</li>\n<li><a href=\"http://www.php.net/manual/en/faq.installation.php#faq.installation.apache2\">PHP FAQ</a> states pretty much same as above. </li>\n</ul>\n\n<p>What's your experience?</p>\n\n<p>EDIT: It's not only about segfaults (\"access violations\" in windows nomenclature). There is a lot more to <a href=\"http://en.wikipedia.org/wiki/Thread_safe\">thread safety</a>.</p>\n"},{"tags":["android","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1338,"score":1,"question_id":4884957,"title":"how to run one thread after complete another thread","body":"<p>I want to run two threads <code>r1</code>, and <code>r2</code>. First start the <code>r1</code> and after completion of <code>r1</code>, start <code>r2</code> (only after the completion <code>r1</code>). How can this be done, two threads, one after another?</p>\n"},{"tags":["java","multithreading","heap","dump"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":89,"score":1,"question_id":12842344,"title":"Generate a Java thread dump without restarting.","body":"<p>I'd like to create a thread that keeps track of the memory usage and cpu usage.</p>\n\n<p>If the application reaches a high level, I want to generate an heap dump or a thread dump.</p>\n\n<p>Is there a way to generate a Thread dump runtime without restarting?</p>\n"},{"tags":["multithreading","delphi","ole"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":150,"score":0,"question_id":12840724,"title":"Delphi accessing OleObject from 2 different threads","body":"<p>I have some inherited code for opening IE and I have some troubles, here is what I have:</p>\n\n<p>IEUnit.pas (no form) has routines for LoadIE and OpenIE</p>\n\n<p>OpenIE is called from separate thread and it looks like this</p>\n\n<pre><code>procedure OpenIE(URL: OleVariant; FieldValues: string = '');\nvar ie : IWebBrowser2; // &lt;-- This should become \"global\" variable for the IEUnit\nbegin\n  ie := CreateOleObject('InternetExplorer.Application') as IWebBrowser2;\n  ie.Navigate2(URL, Flags, TargetFrameName, PostData, Headers);\n  ShowWindow(ie.HWND, SW_SHOWMAXIMIZED);\n  ie.Visible := true;\n  ...\nend;\n</code></pre>\n\n<p>I would like to have \"global\" ie variable in the unit and to write LoadIE routine like this :</p>\n\n<p>LoadIE should be called from FormCreate (main thread)</p>\n\n<p>It should just create \"global\" ie object</p>\n\n<pre><code>  ie := CreateOleObject('InternetExplorer.Application') as IWebBrowser2;\n</code></pre>\n\n<p>so the OpenIE function doesn't need to create it, just to use it (purpose is to speed things up)</p>\n\n<p>So problem is how to access same OLE object from 2 different threads, one creates the object, the other one uses it.</p>\n\n<hr>\n\n<p>When I write code that doesn't take care of threads I get an error</p>\n\n<p>exception class EOleSysError with message 'The application called an interface that was marshalled for a different thread'</p>\n\n<p>How should I do it, to take care of threads (I'm not experienced with threads, some reading and video links are welcome).</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["java","android","multithreading","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12841566,"title":"Android updating Button background in separate Thread","body":"<p>I have a bunch of Buttons (custom, with a few extra methods to apply other backgrounds, and revert to original), which can be assigned a background. But since I don't know how large these backgrounds will or can be, I decided to set the background in a separate Thread. First, I had this code:</p>\n\n<pre><code>public void updateButton(final Button b, final String d, final String s) {\n    b.nullify(); //Recycles previous background, else OOM error\n    b.setText(s);\n    if (d != null) {\n        new Thread() {\n            @Override\n            public void run() {\n                b.setBackgroundFromBase64(d);\n            }\n        }.run();\n    }\n    else b.setBackgroundToDefault(); //Sets standard android background\n}\n</code></pre>\n\n<p>but I soon found out that this wasn't the way to go. Slowly, the memory got flooded when I called this method a few thousand times. When I removed the <code>new Thread()</code> part, the memory wasn't flooded, so the Thread was the cause of this (Memory Analyzer Tool told me the same).</p>\n\n<p>Then I tried the <code>AsyncTask</code>:</p>\n\n<pre><code>private class UpdateButtonTask extends AsyncTask&lt;Object, Void, Void&gt; {\n    @Override \n    protected Void doInBackground(Object... objs) {\n        String s = (String)objs[0];\n        Button b = (Button)objs[1];\n        String d = (String) objs[2];\n        b.nullify(); //Recycles previous background, else OOM error\n        b.setText(s);\n        if (d != null) b.setBackgroundFromBase64(d);\n        else b.setBackgroundToDefault();\n        return null;\n     }\n     @Override\n     protected void onProgressUpdate(Void v) {\n         //As far as I know, I don't need this method\n     }\n     @Override\n     protected void onPostExecute(Void v) {\n         //Neither this one\n     }\n }\n</code></pre>\n\n<p>and call</p>\n\n<pre><code>new UpdateButtonTask().execute(\"Button\", myButton, base64String);\n</code></pre>\n\n<p>in the button update method. But that didn't work either (the button wasn't updated at all. No text, no custom background). I read some articles and questions about Threading (<a href=\"http://androidresearch.wordpress.com/2012/03/17/understanding-asynctask-once-and-forever/\" rel=\"nofollow\">this</a>, <a href=\"http://developer.android.com/reference/android/os/AsyncTask.html\" rel=\"nofollow\">this</a>, and  <a href=\"http://www.vogella.com/articles/AndroidPerformance/article.html\" rel=\"nofollow\">this</a> amongst others), but I can't seem to get it working. For now, <em>no</em> Thread and hoping the phones are fast enough to not cause trouble on the UI thread seems to be the best option, but I'd rather have something more reliable, like a Thread.\n<strong>What am I doing wrong?</strong> or maybe just the full question <strong>How can I update a Button background on a background Thread</strong> (so the UI doesn't stop working when applying larger backgrounds)<strong>?</strong></p>\n"},{"tags":["c++","multithreading","visual-studio-2010","visual-c++"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":96,"score":0,"question_id":12840881,"title":"Can't we use threads inside the member function of class?","body":"<p>This is mine base class</p>\n\n<pre><code>class IDialysisConnector\n    {\n    public:\n    HANDLE threadHandle_;   \n    virtual int ConnectToMachine();  //This will make socket connection with the machine.\n    virtual void WINAPI ServerConnectThread(LPVOID lpdwThreadParam)=0;\n    };\n</code></pre>\n\n<p>Another class</p>\n\n<pre><code>class A:public IDialysisConnector\n{\n\nint ConnectToMachine()\n{\n\n    int conResult,iResult;;\n    struct addrinfo           *result = NULL,*ptr = NULL;\n\n    u_long iMode = 0;\n    DWORD nTimeout = 5000; // 5 seconds\n    int port=22;\n    WSADATA wsaData;\n\n    // Initialize Winsock\n\n    iResult = WSAStartup(MAKEWORD(2,2), &amp;wsaData);\n    if (iResult != 0) \n    {\n        printf(\"WSAStartup failed with error: %d\\n\", iResult);\n\n    }\n\n    ZeroMemory( &amp;addr_, sizeof(addr_) );\n    addr_.ai_family = AF_UNSPEC;\n    addr_.ai_socktype = SOCK_STREAM;\n    addr_.ai_protocol = IPPROTO_TCP;\n\n    // Resolve the server address and port\n    conResult = getaddrinfo(\"192.168.15.168\", (PCSTR)22, &amp;addr_, &amp;result);\n    if ( conResult != 0 ) {\n        printf(\"getaddrinfo failed with error: %d\\n\", conResult);\n        WSACleanup();\n        return 1;\n    }\n\n    // Attempt to connect to an address until one succeeds\n    for(ptr=result; ptr != NULL ;ptr=ptr-&gt;ai_next) {\n\n        // Create a SOCKET for connecting to server\n        sock_ = socket(ptr-&gt;ai_family, ptr-&gt;ai_socktype, \n            ptr-&gt;ai_protocol);\n        if (sock_ == INVALID_SOCKET) {\n            printf(\"socket failed with error: %ld\\n\", WSAGetLastError());\n            WSACleanup();\n            return 1;\n        }\n            conResult = ioctlsocket(sock_, FIONBIO, &amp;iMode);\n        if (conResult != NO_ERROR)\n            printf(\"ioctlsocket failed with error: %ld\\n\", conResult);\n\n\n        conResult = setsockopt(sock_, SOL_SOCKET, SO_RCVTIMEO, (const char*)&amp;nTimeout, sizeof(DWORD));\n        if (conResult != NO_ERROR)\n        {\n            printf(\"\\nSetsocopt fail with error :%d\\n\",WSAGetLastError());\n\n            return 0;\n        }\n\n\n        // Connect to server.\n        conResult = connect(sock_, ptr-&gt;ai_addr, (int)ptr-&gt;ai_addrlen);\n        if (conResult == SOCKET_ERROR) {\n            closesocket(sock_);\n            sock_ = INVALID_SOCKET;\n            continue;\n        }\n        break;\n    }\n\n    freeaddrinfo(result);\n\n    if (sock_ == INVALID_SOCKET) {\n        printf(\"Unable to connect to server!\\n\");\n        WSACleanup();\n        return 1;\n    }\n    DWORD dwThreadId;\n    //threadHandle_=CreateThread(NULL,0,(LPTHREAD_START_ROUTINE)ServerConnectThread,this,0,&amp;dwThreadId);\n        threadHandle_=CreateThread(NULL,0,(LPTHREAD_START_ROUTINE)ThreadFunc,this,0,&amp;dwThreadId);\n   void WINAPI IDialysisConnector::ServerConnectThread(LPVOID lpdwThreadParam)\n    {\nSOCKET ThreadSocket = INVALID_SOCKET;\n    ThreadSocket=(SOCKET)lpdwThreadParam;\n    while(1)\n    {\n        SendRequest(ThreadSocket);\n        ReceiveResponse(ThreadSocket);\n        Sleep(10000);\n    }\n        }\n</code></pre>\n\n<p>static UINT ThreadFunc(LPVOID param) {<br>\n         IDialysisConnector* obj = (IDialysisConnector*)param;<br>\n     obj->ServerConnectThread(); // call the member function<br>\n     // to do the work in our new thread\n     } </p>\n\n<pre><code>}\n\n}\n</code></pre>\n\n<p>I did like this too but same error</p>\n\n<pre><code>threadHandle_=CreateThread(NULL,0, (LPTHREAD_START_ROUTINE)IDialysisConnector::ServerConnectThread,(LPVOID)sock_,0,&amp;dwThreadId);\n</code></pre>\n\n<p>I am getting an error that is</p>\n\n<pre><code>\" error C2440: 'type cast' : cannot convert from 'overloaded-function' to 'LPTHREAD_START_ROUTINE'\"\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":291,"score":3,"question_id":10175993,"title":"Does Yield/Join release monitor lock?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10679676/does-thread-yield-lose-the-lock-on-object-if-called-inside-a-synchronized-meth\">Does thread.yield() lose the lock on object if called inside a synchronized method?</a>  </p>\n</blockquote>\n\n\n\n<p>I know <code>Thread.sleep()</code> holds the lock, but <code>Object.wait()</code> releases the lock. Some say <code>yield</code> actually implements <code>sleep(0)</code>. Does this mean yield will not release the lock?</p>\n\n<p>Another question. Say the current thread has acquired a lock, and then called <code>anotherThread.join()</code>. Does the current thread release the lock?</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12838502,"title":"Java Thread.sleep","body":"<p>When ever we try Threads.sleep in our code, we have to catch an InterruptedException. This means that the thread was not able to sleep for the time we specified, right? So how can a thread that we put to sleep be interrupted ? Can anyone explain this concept?</p>\n"},{"tags":["android","multithreading","android-layout","android-tabhost"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12840771,"title":"Handle multiple HttpClient instances","body":"<p>I use connection for server connections as show bleow.</p>\n\n<pre><code>    HttpParams params = new BasicHttpParams();\n    ConnManagerParams.setMaxTotalConnections(params, 10);\n    HttpProtocolParams.setVersion(params, HttpVersion.HTTP_1_1);\n    HttpProtocolParams.setContentCharset(params, HTTP.UTF_8);\n\n    params.setIntParameter(CoreConnectionPNames.SO_TIMEOUT, Integer.valueOf(60000));\n    params.setIntParameter(CoreConnectionPNames.CONNECTION_TIMEOUT, Integer.valueOf(60000));\n    params.setBooleanParameter(CoreConnectionPNames.TCP_NODELAY, true);\n\n    //eate and initialize scheme registry \n    SchemeRegistry schemeRegistry = new SchemeRegistry();\n    schemeRegistry.register(new Scheme(\"http\", PlainSocketFactory.getSocketFactory(), 80));\n\n    // Create an HttpClient with the ThreadSafeClientConnManager.\n    // This connection manager must be used if more than one thread will\n    // be using the HttpClient.\n    cm = new ThreadSafeClientConnManager(params, schemeRegistry);\n    httpClient = new DefaultHttpClient(cm, params);\n</code></pre>\n\n<p>ThreadSafeClientConnManager API says: </p>\n\n<pre><code>ThreadSafeClientConnManager maintains a maximum limit of connection on a per route \nbasis and in total. Per default this implementation will create no more than than \n2 concurrent connections per given route and no more 20 connections in total. For many \nreal-world applications these limits may prove too constraining, especially if they use      \nHTTP as a transport protocol for their services. Connection limits, however, can be     \nadjusted using HTTP parameters.\n</code></pre>\n\n<p>How can I change the maximum connections per host to more than 2?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#",".net","windows","multithreading","forms"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12840555,"title":"Wait to start next method or thread until a background thread ends in windows form application with C# .Net","body":"<p>I am creating a background thread in a windows form application to do some process that takes time while handling huge data. However, I still want some other methods or processes to wait until this thread finishes its work.</p>\n\n<p>To create a background thread, I used below inline code.</p>\n\n<pre><code>Task.Factory.StartNew(() =&gt; GenerateXml2Resx(account, features, codes, outputDir));\n</code></pre>\n\n<p>So once, this process of generating all *.resx files from xml data is done, I want my application to proceed further.</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12823056,"title":"Java Resource Pool Threading issue","body":"<p>I have a problem in a high performance environment which can be described in prose as follows:</p>\n\n<p>I have an external Java API which makes a call to an FPGA card with 64 resources on it. I need a mechanism to safely share a subset of those resources between hundreds of threads in an application. Each resource should be considered not thread safe.</p>\n\n<p>So I need a ResourcePool with a method update() which then calls resource.update(). </p>\n\n<p>I think this is a fairly common idiom but I am having difficulty fitting my head into the Java concepts. I want to say have 4 of the resources in one ResourcePool. Each should i guess live in their own Thread (so a threadpool would be needed). </p>\n\n<p>How would i implement this so that i could log an error and carry on when all 4 of the resources are in use?</p>\n\n<p>Hope this makes sense!</p>\n"},{"tags":["c#","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12742662,"title":"How to capture the Right variable in a Thread","body":"<p>Why would this happen?</p>\n\n<p>You start up a thread, and it runs a class.</p>\n\n<p>Inside that class there is a for loop, inside the for loop there is a \"write to messagebox\" and another class.</p>\n\n<p>Why does the order in witch I put the write and the class (which one happens first) effect the accuracy of my data?</p>\n\n<p>(This is inside the class that the thread is running)</p>\n\n<pre><code>int atPDFNumber= 0\nforeach (var z in q)\n        {\n                atPDFNumber++;\n\n                convertToImage(z.FullName);\n\n                txtboxtest.BeginInvoke(\n            ((Action)(() =&gt; txtboxtest.Text += atPDFNumber.ToString())));\n}\n</code></pre>\n\n<p>That output gives me some overlapping values. the output is</p>\n\n<p>Run 1 : 1 2 3 4 5 6 7 8 9 10 11 12 13 14</p>\n\n<p>Run 2 : 1 <strong>3 3</strong> 4 5 6 7 8 9 10 11 12 13 14</p>\n\n<p>Run 2 : 1 2 3 4 5 6 7 8 9 <strong>11 11</strong> 12 13 14</p>\n\n<p>Where this Runs them all in the correct order</p>\n\n<pre><code>foreach (var z in q)\n            {\n                    atPDFNumber++;\n\n                txtboxtest.BeginInvoke(\n                ((Action)(() =&gt; txtboxtest.Text += atPDFNumber.ToString())));\n\n               convertToImage(z.FullName);\n</code></pre>\n\n<p>Why does that happen? It might be that the external method i use in the class ConvertToImage is also running a thread.. in that case, how would i \"pause\" my thread to wait for the ConvertToImage to finish... </p>\n\n<p>Other wise i have no idea why this thread acts the way it does?</p>\n"},{"tags":["c++","multithreading","thread-safety","wxwidgets","mutex"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12830206,"title":"How should I lock a wxMutex in one function and unlock it in another?","body":"<p>I'm supposed to implement my own logging class for use in a program with two threads, the main one and a joinable processing thread. I don't want either thread to use the logger while the other is using it, so I figured I'd use a wxMutex. The logger has to act like a C++ ostream with operator&lt;&lt;, except that a stream manipulator function (std::endl, for example) will indicate the end of the logger's output. I think I need a recursive mutex so that the same thread can continue outputting when the mutex is locked.</p>\n\n<p>The problem (I think) is that the mutex doesn't get fully unlocked, so when the other thread tries to output to the logger, it deadlocks.</p>\n\n<p>Is there something in my code that I'm missing?</p>\n\n<pre><code>class Logger{\n  private:\n    std::ostream* out;\n    wxMutex* mut;\n  ....\n  public:\n    template&lt;class T&gt;\n    Logger&amp; operator&lt;&lt;(T str){ // accept any type of input and lock outputting until finished\n      if(out){\n        if(mut-&gt;TryLock() == wxMUTEX_BUSY){ // if we didn't get lock\n          mut-&gt;Lock(); // we block\n        }\n        if(out){\n          (*out) &lt;&lt; str;\n          out-&gt;flush();\n        }\n        //mut-&gt;Unlock(); // leave locked until done outputting (use std::endl or similar)\n      }\n      return *this;\n    }\n\n    // accept stream manipulators and unlock stream output\n    Logger&amp; operator&lt;&lt;(std::ostream&amp; (*pf) (std::ostream&amp;)){\n      if(out){\n        if(mut-&gt;TryLock() == wxMUTEX_BUSY){\n          mut-&gt;Lock();\n        }\n        (*out) &lt;&lt; pf;\n        out-&gt;flush();\n        while(mut-&gt;Unlock()!= wxMUTEX_UNLOCKED);\n      }\n      return *this;\n    }\n};\n</code></pre>\n"},{"tags":["c#","multithreading","task-parallel-library"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12838728,"title":"Parallel.For Properties","body":"<pre><code>public static void Main (string[] args)\n        {\n            int k = 0;\n            int i = 3;\n            var loopRes = Parallel.For (0, 20, (J) =&gt;\n            {\n                k = i / J;\n                Console.WriteLine (\"Result After division \" + J + \" = \" + k);\n            }\n            );\n\n            if (loopRes.IsCompleted) {\n                Console.WriteLine (\"Loop was successful\");\n            }\n            if (loopRes.LowestBreakIteration.HasValue) {\n                Console.WriteLine (\"loopRes.LowestBreakIteration.Value = \" + loopRes.LowestBreakIteration.Value);\n            }\n        } \n</code></pre>\n\n<p>As of i read on the internet i can find 2 properties for Parallel.For &amp; Parallel.Foreach</p>\n\n<ol>\n<li>IsCompleted</li>\n<li>LowestBreakIteration</li>\n</ol>\n\n<p>For me first property is working fine. but when it comes to the situation where 3/0 then it will give the divided by zero error. so the second if loop should give me the number of LowestBreakIteration but it is throwing an error. please let me know if any body has come accross the same problem and solved it!!. </p>\n\n<p>Also please explain what is the main purpose of those two properties. On what situations it wil be helpful.</p>\n\n<p>Hope to hear from some one soon.</p>\n"},{"tags":["java","android","multithreading","handler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12838434,"title":"How to send a broadcast from within running thread","body":"<p>I've written a filecache that allows to load files from the web. Activities send requests to this filecache and give the name and action of a BroadcastReceiver that get's notified when the requested file has been downloaded.</p>\n\n<p>This cache is working but it has a small drawback.</p>\n\n<p>If there are lots of files in the download queue the activities are notified at once after processing all downloads. I would like to send the broadcast for each downloaded file.</p>\n\n<p>Here's the stripped down code. Currently a Handler gets fired after processing all the files in the Thread.run(). I would like to send the Broadcast from within the run. What would be the prefered way to do something (send a Broadcast) during Thread.run()?</p>\n\n<p>Many thanks in advance.</p>\n\n<pre><code>public abstract class MyFileCache {\n\n    private static class CacheElement {\n        private File file;\n    }\n\n    private static class QueueElement {\n        private long action;\n        private String filename = \"\";\n        private long id;\n        private String receiver = \"\";\n    }\n\n    private static class ProcessedElement {\n        private long action;\n        private File file;\n        private long id;\n        private String receiver = \"\";\n    }\n\n    private Map&lt;String, CacheElement&gt; cache = new ConcurrentHashMap&lt;String, CacheElement&gt;();\n    private Context context;\n    private Map&lt;String, ProcessedElement&gt; processed = new ConcurrentHashMap&lt;String, ProcessedElement&gt;();\n    private Map&lt;String, QueueElement&gt; queue = new ConcurrentHashMap&lt;String, QueueElement&gt;();\n\n    public MyFileCache(Context context) {\n        this.context = context;\n    }\n\n    private void doThread() {\n        final Handler handler = new Handler() {\n\n            @Override\n            public void handleMessage(Message message) {\n\n                try {\n                    for (Map.Entry&lt;String, ProcessedElement&gt; entry : processed.entrySet()) {\n                        // Currently: Processing all fetched files at once\n                        // Send for all entries a broadcast to the requesting activities\n                        ProcessedElement processedElement = entry.getValue();\n                        if (processedElement != null &amp;&amp; processedElement.receiver != null) {\n                            processSendBroadcast(processedElement.receiver,\n                                    processedElement.action, processedElement.id);\n                        }\n\n                        deleteFromProcessed(entry.getKey());\n                    }\n                } catch (NullPointerException exception) {\n                }\n            }\n        };\n\n        new Thread() {\n\n            @Override\n            public void run() {\n                for (Map.Entry&lt;String, QueueElement&gt; entry : queue.entrySet()) {\n                    QueueElement queueElement = entry.getValue();\n                    if (queueElement != null) {\n                        File file = fetch(entry.getKey(), queueElement.id, queueElement.filename,\n                                queueElement.receiver, queueElement.action);\n                        if (file != null) {\n                            // Wish: Sending a broadcast to the requesting activity for each fetched file\n                        }\n                    }\n                }\n\n                handler.sendEmptyMessage(0);\n            }\n        }.start();\n    }\n\n    private void deleteFromProcessed(String url) {\n        if (processed.containsKey(url)) {\n            ProcessedElement processedElement = processed.get(url);\n            if (processedElement != null) {\n                processed.remove(url);\n            }\n        }\n    }\n\n    // Send broadcast\n    private void processSendBroadcast(String receiver, long action, long id) {\n        Intent intent = new Intent();\n        intent.putExtra(\"ACTION\", action);\n        intent.putExtra(\"ID\", id);\n        intent.setAction(receiver);\n        context.sendBroadcast(intent);\n    }\n}\n</code></pre>\n"},{"tags":["java","mysql","database","multithreading","in-memory"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12837706,"title":"Can I access In-memory tables with more than one thread (MySQL & Java)?","body":"<p>I have an time-critical JAVA application which uses an in-memory database (in my case MySQL) to answer queries. </p>\n\n<p>In order to speed the process up, I thought about using multiple threads (so that multiple processors can work simultaniously). So my first question would be if in-memory tables can be run faster with a multi-threaded environment.</p>\n\n<p>If the answer to this first question is yes, then I need some advice how to do this. I experimented with 2 approaches:</p>\n\n<ol>\n<li><p>I gave all threads the same jdbc instance. There were no performance increases with this tactic.</p></li>\n<li><p>I tried to create new instances for each thread and tried to connect it to my previously created database:</p>\n\n<p><code>Class.forName(\"com.mysql.jdbc.Driver\").newInstance();\nconn = DriverManager.getConnection(url, username, password);\nthis.executeQuery(\"USE myDatabase\");</code></p></li>\n</ol>\n\n<p>With this second version I get an error saying: </p>\n\n<blockquote>\n  <p>com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown database 'rockit'</p>\n</blockquote>\n\n<p>In an one thread environment there is no error at this point.</p>\n"},{"tags":["java","multithreading","interrupt"],"answer_count":6,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":1675,"score":11,"question_id":2020992,"title":"Is Thread.interrupt() evil?","body":"<p>A teammate made the following claim:</p>\n\n<blockquote>\n  <p>\"<code>Thread.interrupt()</code> is inherently broken, and should (almost) never be used\".</p>\n</blockquote>\n\n<p>I am trying to understand why this is the case.</p>\n\n<p>Is it a known best practice never to use <code>Thread.interrupt()</code>? Can you provide evidence why it is broken / buggie, and should not be used for writing robust multithreaded code?</p>\n\n<p><strong>Note</strong> - I am not interested in this question if it's \"pretty\" from a design preservative. My question is - is it buggy?</p>\n"},{"tags":["c++","windows","multithreading","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12837095,"title":"Interprocess synchronization using mutex in windows(win32 or C++)","body":"<p>I want to build thread synchronization between 2 processes. basically one thread is running in a App1.exe and a second process is running in App2.exe. How do i synchronize these 2 threads in windows. can someone please share some examples or links.</p>\n"},{"tags":["c#","multithreading","tcp","proxy","asyncsocket"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12837021,"title":"Implementing threading for a TCP proxy server using Async sockets","body":"<p>I have a custom TCP proxy Server listening on port 5888(dummy port). The proxy server listens for incoming connections. When the proxy receives HTTP request for certain pages, it should relay it to the main server on port 80.For other page requests the proxy is required to send data to the main Server on port 8081.</p>\n\n<p>The port 80 is used to service the HTML Pages where as the port 8081 is used for streaming data to the clients.</p>\n\n<pre><code>Client --&gt; Proxy(TCP Proxy Server) --&gt; MainServer\nClient &lt;-- Proxy(TCP Proxy Server) &lt;-- MainServer\n</code></pre>\n\n<p>I have implemented the proxy using the Async programming model (BeginXX and EndXX). The proxy is working fine. I have no problem connecting about 10 clients to this proxy.</p>\n\n<p>Now I want to implement threading in the proxy so that I can have more than 300 simultaneous client connections to the Proxy. What is the Best approach to implement this threading considering the Async programming model (Async sockets).</p>\n"},{"tags":["c","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":12827181,"title":"thread at exit cleanup","body":"<p>I have an application in which I have 1 main thread which creates 10 different threads for doing some job. At the end of application, when I try to exit, the application is not able to cleanly exit. The stack trace is not that useful, but its showing the crash in function \"cancel_deliver()\" My first guess is this is some underlying call made while doing the freeing up of resources used by each thread, but not entirely sure. </p>\n\n<p>fyi: The callback function for each thread has a while (1) loop:</p>\n\n<p>Here is the snippet</p>\n\n<pre><code>void main (...)\n{\n    pthread_t tid;\n    for (int i=0; i&lt;10; i++)\n        pthread_create(&amp;tid, NULL, xyzCallback,  NULL);\n}\n\nvoid xyzCallback(void* data)\n{\n    while (1)\n    {\n       ////\n    } \n}\n\nvoid atExit()\n{\n    exit(1);\n}\n</code></pre>\n\n<p>Is there any thing that I can do to free up resrouces used by my thread and cleanly exit?</p>\n"},{"tags":["c#",".net","multithreading","locking","critical-section"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":180,"score":5,"question_id":12804879,"title":"Is it OK to use a string as a lock object?","body":"<p>I need to make a critical section in an area on the basis of a finite set of strings. I want the lock to be shared for the same string instance, (somewhat similar to <a href=\"http://stackoverflow.com/questions/4192969/using-string-as-a-lock-to-do-thread-synchronization\">String.Intern</a> approach).</p>\n\n<p>I am considering the following implementation:</p>\n\n<pre><code>public class Foo\n{\n    private readonly string _s;\n    private static readonly HashSet&lt;string&gt; _locks = new HashSet&lt;string&gt;();\n\n    public Foo(string s)\n    {\n        _s = s;\n        _locks.Add(s);\n    }\n\n    public void LockMethod()\n    {\n        lock(_locks.Single(l =&gt; l == _s))\n        {\n            ...\n        }\n    }\n}\n</code></pre>\n\n<p>Are there any problems with this approach? Is it OK to lock on a string object in this way, and are there any thread safety issues in using the <code>HashSet&lt;string&gt;</code>?</p>\n\n<p>Is it better to, for example, create a <code>Dictionary&lt;string, object&gt;</code> that creates a new lock object for each string instance?</p>\n\n<hr>\n\n<p><strong>Final Implementation</strong></p>\n\n<p>Based on the suggestions I went with the following implementation:</p>\n\n<pre><code>public class Foo\n{\n    private readonly string _s;\n    private static readonly ConcurrentDictionary&lt;string, object&gt; _locks = new ConcurrentDictionary&lt;string, object&gt;();\n\n    public Foo(string s)\n    {\n        _s = s;\n    }\n\n    public void LockMethod()\n    {\n        lock(_locks.GetOrAdd(_s, new object()))\n        {\n            ...\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c++","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":56,"score":-1,"question_id":12829782,"title":"OpenGL multiple threads, variable handling","body":"<p>I have written an OpenGL program which runs in the following way:</p>\n\n<pre><code>Main:\n- Initialize SDL\n- Create thread which has the OpenGL context:\n    - Renderloop\n        - Set camera (view) matrix with glUniform.\n        - glDrawElements() .... etc.\n        - Swapbuffers();\n- Main SDL loop handling input events and such.\n    - Update camera matrix of type glm::mat4. \n</code></pre>\n\n<p>This is how I pass my camera object to the class that handles opengl.</p>\n\n<pre><code>Camera *cam = new Camera();\ngl.setCam(cam);\n</code></pre>\n\n<p>where</p>\n\n<pre><code>void setCam(Camera *camera) {\n    this-&gt;camera = camera;\n}\n</code></pre>\n\n<p>For rendering in the opengl context thread, this happens:</p>\n\n<pre><code>glm::mat4 modelView = camera-&gt;view * model;\nglUniformMatrix4fv(shader-&gt;bindUniform(\"modelView\"), 1, GL_FALSE, glm::value_ptr(modelView));\n</code></pre>\n\n<p>In the main program where my SDL and other things are handles I then recompute the view matrix. This his working fine without me using any mutex locks. Is this correct?</p>\n\n<p>On the other hand, I add objects to my scene by an \"upload queue\" and in this case I have to mutex lock my upload queue vector (vector class type) when adding items to it or else the program crashes.</p>\n\n<p>In summary: I recompute my matrix in a different thread and then use it in the opengl thread without any mutex lock. Why is this working?</p>\n\n<p><strong>Edit:</strong>\nI think my question is similar to what was asked here:</p>\n\n<p>1) <a href=\"http://stackoverflow.com/questions/6935208/should-i-lock-a-variable-in-one-thread-if-i-only-need-its-value-in-other-thread?rq=1\">Should I lock a variable in one thread if I only need it&#39;s value in other threads, and why does it work if I don&#39;t?</a>, only in my case it is even more simple with only one matrix being changed.</p>\n\n<p>2) <a href=\"http://stackoverflow.com/questions/859690/do-i-need-a-lock-when-only-a-single-thread-writes-to-a-shared-variable\">Do I need a lock when only a single thread writes to a shared variable?</a></p>\n"},{"tags":["java","multithreading","concurrency","http-post"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12835077,"title":"Java Multithread Multiple Requests Approach","body":"<p>I want to send to \"test.com\" a request from 0 to 100, the code i have will send a request every one second... In this way the program will take 100 seconds in order to complete.</p>\n\n<p>What i would like to do is set 10 threads running all at the same time, making the thread 1 going from (0,10); thread 2 going from (10,20) ... and so on, in this way the program should take only 10 seconds or so in order to complete, is that possible ? how can acomplish it ?</p>\n\n<pre><code>import java.io.InputStreamReader;\nimport org.apache.commons.httpclient.HttpClient;\nimport org.apache.commons.httpclient.methods.PostMethod;\n\npublic class Palomo implements Runnable {\n    String url = \"http://test.com\";\n    HttpClient client = null;\n    PostMethod method = null;\n    BufferedReader br = null;\n    String contents = null;\n\n    public void run() {\n        for (int i = 0; i &lt;= 100; i++) {\n            synchronized (this) {\n                doPost(i);\n            }\n                      try {\n        Thread.sleep(1000);\n        } catch (InterruptedException e) {\n        e.printStackTrace();\n        }\n        }\n    }\n\n    public void doPost(int i) {\n        try {\n            client = new HttpClient();\n            method = new PostMethod(url);\n\n            this.method.addParameter(\"myPostRequest\", Integer.toString(i));\n\n            client.executeMethod(method);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            method.releaseConnection();\n        }\n    }\n\n    public static void main(String[] args) {\n        new Thread(new Palomo()).start();\n    }\n}\n</code></pre>\n\n<p>Thanks a lot !</p>\n\n<p><em><strong>EDIT</em></strong></p>\n\n<p>Reading the indications you gave me, i created this horrible monster...</p>\n\n<pre><code>import java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class SimpExec {\n    public static void main(String args[]) {\n\n        ExecutorService es = Executors.newFixedThreadPool(4);\n\n        es.execute(new MyThread(\"A\"));\n        es.execute(new MyThread(\"B\"));\n        es.execute(new MyThread(\"C\"));\n        es.execute(new MyThread(\"D\"));\n\n        es.shutdown();\n    }\n}\n\nclass MyThread implements Runnable {\n    String name;\n\n    MyThread(String n) {\n        name = n;\n        new Thread(this);\n    }\n\n    public void run() {\n        if (name==\"A\"){\n            for (int i=1;i&lt;=10;i++){\n                System.out.println(i);\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n        }\n        if (name==\"B\"){\n            for (int i=10;i&lt;=20;i++){\n                System.out.println(i);\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n        }\n        if (name==\"C\"){\n            for (int i=20;i&lt;=30;i++){\n                System.out.println(i);\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n        }\n        if (name==\"D\"){\n            for (int i=30;i&lt;=40;i++){\n                System.out.println(i);\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I know this is probably the most awful piece of code you ever watched, but is making exactly what i want, if you can give me some directions on how i should accomplish this in the right way that would be great.</p>\n\n<p>THANKS A LOT FOR ALL YOUR GREAT ADVICES</p>\n"},{"tags":["android","multithreading","android-layout","android-tabhost","android-service"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12836187,"title":"Manage a pool of connections","body":"<p>I have a server call to fetch JSON response. Here is the code snippet.</p>\n\n<pre><code>HttpPost httpPost = new HttpPost(url);\nHttpResponse response = null;\nint j = 0;\ntry {\n        httpPost.setHeader(\"content-type\", \"application/json\");\n        JSONObject json=new JSONObject();\n        json.put(\"method\", method); \n        JSONArray arr = new JSONArray();\n\n\n        for(int i = 0; i &lt; parameters.length; i++) {\n            Log.i(\"N/w handler\" + i, parameters[i]);\n            arr.put(parameters[i]);\n        }\n        json.put(\"params\", arr);\n\n        String params=json.toString();\n        httpPost.setEntity(new StringEntity(params, \"UTF-8\"));\n        response = httpClient.execute(httpPost);\n        HttpEntity entity = response.getEntity();\n        if(null != entity) {\n            InputStream instream = entity.getContent();\n            String result=  Utilities.getUtilities().convertStreamToString(instream);\n            Log.i(\"JSON response\",result);\n            return result;\n        }\n</code></pre>\n\n<p>convertStreamToString(InputStream) read json text from the stream and returns a string text. For holding the state of the user session, same httpClient reference is being used. </p>\n\n<pre><code>if(null == httpClient)\nhttpClient = new DefaultHttpClient();\n</code></pre>\n\n<p>The problem arises when a service starts working. It accesses the httpclient object and in turn InputStream instance. By the time, the user moves to other screen, putting service to run background. Exception is thrown when InputStream already in use is called for.</p>\n\n<pre><code>10-10 16:52:20.167: W/SingleClientConnManager(29884): Invalid use of SingleClientConnManager: connection still allocated.\n10-10 16:52:20.167: W/SingleClientConnManager(29884): Make sure to release the connection before allocating another one.\n10-10 16:52:20.204: W/System.err(29884): java.net.SocketException: Socket closed\n</code></pre>\n\n<p>The reason being, the socket is still used by the Service class. I have heard of ThreadSafeClientConnManager class. However, not really sure if it suits in here.</p>\n\n<p>Any thoughts?</p>\n\n<p>Let me know in case you need more details.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["php","multithreading","mutex"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12791394,"title":"How to use PHP // Thread // Mutex // Cond","body":"<p>PHP apparently supports now a <a href=\"http://www.php.net/manual/en/class.thread.php\" rel=\"nofollow\">Thread</a> class. There is also a <a href=\"http://www.php.net/manual/en/class.mutex.php\" rel=\"nofollow\">Mutex</a> and <a href=\"http://www.php.net/manual/en/class.cond.php\" rel=\"nofollow\">Cond</a> class. One need nevertheless to compile it with the good options and add a PECL extension to have it.</p>\n\n<p>Is there a good tutorial where to start ? Something that shows clearly the fair use of each Class / Method.</p>\n\n<p>I just don't know how to deal with these classes. I would need some concrete examples of doing very simple things that exhibits as many methods as possible.</p>\n\n<p>Thank you.</p>\n"},{"tags":["multithreading","theory","circular-buffer"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":3,"view_count":405,"score":0,"question_id":662658,"title":"How would YOU do/write this homework assignment? (theoretical)","body":"<p>I'm not asking for anyone to do this homework for me, but I bring it up because it's a very good practical introduction to C# and threading, but at the same time I feel it's perhaps a little too simple.  </p>\n\n<p><strong>Is this really the best way to teach threading? what key threading concepts are \"lost\" in this exercize, what would new programmers using threads for the first time likely fail to observe?</strong> </p>\n\n<p>I have alot of theoretical knowledge about threading but haven't had to do alot of it myself in the past, does anyone have any caveats for me when writing it?</p>\n\n<p><a href=\"http://www2.cs.uidaho.edu/~sgotshall/cs204/CS_204_Assignment_5.pdf\" rel=\"nofollow\">Here's the link to the original assignment</a></p>\n\n<p>and here is the goals text:</p>\n\n<blockquote>\n  <p>1) Create a thread-safe generic\n  circular queue class and create a GUI\n  to use it (See next section). In this\n  context, thread safe means that each\n  operation (method) that changes the\n  contents of the queue should be\n  executed by only one thread at a time\n  in order to avoid data corruption. A\n  circular queue is implemented as a\n  fixed size array where the beginning\n  and end of the queue are indices in\n  the array. As the queue fills up, the\n  beginning and end of the queue will\n  shift to higher values as elements are\n  added and eventually wrap around to\n  the first index in the array to reuse\n  the memory. This class should also\n  throw an exception (specified below)\n  to the caller if the operation is\n  invalid. </p>\n  \n  <p>2) Create a GUI to control\n  two threads in a producer-consumer\n  fashion. The GUI will be able to begin\n  and start and stop both the producer\n  and consumer threads and control the\n  rate at which they modify the\n  GenericCircularQueue.</p>\n</blockquote>\n"},{"tags":["vb.net","multithreading","dll"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":525,"score":1,"question_id":607950,"title":"Best way of Multithreading","body":"<p>I have a college assignment due quite soon, and I need to be able to call a C++ dll that takes a long time (possibly infinte, it relies on user input)to execute. Im calling this through VB. My VB GUI freezes up when this happens, and I would like to keep the GUI responsive, so that the user can stop this possibly infinte loop. </p>\n\n<p>Can anyone suggest the best/fastest way of doing this? </p>\n\n<p>A bit of background, the C++ is trying to keep score on a snooker table using a webcam, and while the VB scoreboard updates easily, I would like to script it so that the analysis is almost continuous, while still allowing the user to interact. Currently the project requires the user to press a button to start the shot analysis, but it would be preferable if the program scripted itself. I have only realised this problem now and the deadline is very soon.</p>\n\n<p>Update: Our lecturer suggested an option to solve the problem, but it would appear that most options here and the one he suggested will not work for us as the processing time required for the webcam image capture is too great to handle due to hardware constraints. Thanks for taking the time to help, it was much appreciated!</p>\n"},{"tags":["c++","multithreading","pthreads","multicore"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":327,"score":0,"question_id":7269839,"title":"Can not find `pthread_setaffinity_np'?","body":"<p>I used -pthread for gcc compiler, but still can not find this API. any suggestion?</p>\n"},{"tags":["c#","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":313,"score":3,"question_id":717643,"title":".net application multi-threading","body":"<p>I have a multi core cpu but the .net app i wrote only uses one of the cores. how can i make it use more than one core when that option is available.</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12834242,"title":"Am I doing multi threading the right way in c#?","body":"<p>I have a program that runs multiple threads to convert pdf files to images in a folder and its subdirectories. It iterates through that folder, putting all pdf file names in a list, and then use that list to divide up the work between 4 threads that i created. Now it all works perfectly. Multiple threads are running and converting pdf files at the same time to different locations i specify.</p>\n\n<p>I would just like to know if im doing it in the right way. Almost every website i visit do multi threading in a different way, and i don't know which one would be the most effective and ultimately the right one. </p>\n\n<p>No good doing some thing that works, if its done wrong i guess... Just going to get me in the future.</p>\n\n<p>I would love if you could just look at the code here and see if there is anything Drastically wrong that i need to change regarding multiple threads running   </p>\n\n<pre><code>static object LockInteger = new object();\nstatic object LockIfCheck = new object();\nstatic object LockInteger = new object();\nstatic object LockIfCheck = new object();\n\nprivate void button1_Click(object sender, EventArgs e)\n{\n    IterateThrough(txtboxdirectory.Text);\n}\n\npublic void IterateThrough(string sourceDir)\n{\n    MulThread = new Thread(delegate()\n    {\n        Stopwatch stopWatch = new Stopwatch();\n        stopWatch.Start();\n        int lowerbound = 0;\n        int upperbound = (fileList.Count / 4);\n        for (int i = lowerbound; i &lt; upperbound; i++)\n        {\n            forFunction(exceptionFileList, fileList[i], compltetedFileList,sourceDir, dir1);\n            stopWatch.Stop();\n            lblFileExecutionTime.BeginInvoke(((Action)(() =&gt; lblFileExecutionTime.Text = \"Execution Per File \" + stopWatch.Elapsed.ToString())));\n            stopWatch.Reset();\n            stopWatch.Start();\n        }\n    });\n    MulThread.Start();\n\n    MulThread1 = new Thread(delegate()\n    {\n        Stopwatch stopWatch = new Stopwatch();\n        stopWatch.Start();\n        int lowerbound = fileList.Count / 4;\n        int upperbound = (fileList.Count / 4) * 2;\n        for (int i = lowerbound; i &lt; upperbound; i++)\n        {\n            forFunction(exceptionFileList, fileList[i], compltetedFileList, sourceDir, dir2);\n            stopWatch.Stop();\n            lblFileExecutionTime.BeginInvoke(((Action)(() =&gt; lblFileExecutionTime.Text = \"Execution Per File \" + stopWatch.Elapsed.ToString())));\n            stopWatch.Reset();\n            stopWatch.Start();\n        }\n    });\n    MulThread1.Start();\n\n    MulThread2 = new Thread(delegate()\n    {\n        Stopwatch stopWatch = new Stopwatch();\n        stopWatch.Start();\n        int lowerbound = (fileList.Count / 4) * 2;\n        int upperbound = (fileList.Count / 4) * 3;\n        for (int i = lowerbound; i &lt; upperbound; i++)\n        {\n            forFunction(exceptionFileList, fileList[i], compltetedFileList, sourceDir, dir3);\n            stopWatch.Stop();\n            lblFileExecutionTime.BeginInvoke(((Action)(() =&gt; lblFileExecutionTime.Text = \"Execution Per File \" + stopWatch.Elapsed.ToString())));\n            stopWatch.Reset();\n            stopWatch.Start();\n        }\n    });\n    MulThread2.Start();\n\n    MulThread3 = new Thread(delegate()\n    {\n        Stopwatch stopWatch = new Stopwatch();\n        stopWatch.Start();\n        int lowerbound = (fileList.Count / 4) * 3;\n        int upperbound;\n\n        if (fileList.Count % 4 != 0)\n        {\n            upperbound = ((fileList.Count / 4) * 4) + (fileList.Count % 4) + 1;\n        }\n        else\n        {\n            upperbound = ((fileList.Count / 4) * 4) + (fileList.Count % 4);\n        }\n\n        for (int i = lowerbound; i &lt; upperbound; i++)\n        {\n            forFunction(exceptionFileList, fileList[i], compltetedFileList, sourceDir, dir4);\n            stopWatch.Stop();\n            lblFileExecutionTime.BeginInvoke(((Action)(() =&gt; lblFileExecutionTime.Text = \"Execution Per File \" + stopWatch.Elapsed.ToString())));\n\n            stopWatch.Reset();\n            stopWatch.Start();\n        }\n    });\n    MulThread3.Start();\n}\n</code></pre>\n\n<p>Then i lock some of the methods in \"forFunction\".</p>\n\n<pre><code>private int forFunction(String exceptionFileList, FileInfo z, String compltetedFileList, String sourceDir, String imagedirectory)\n{\n    //heres where it locked up because of this global variable\n    lock (LockInteger)\n    {\n        atPDFNumber++;\n    }\n\n    int blankImage = 1;\n    int pagesMissing = 0;\n\n    //delete the images currently in the folder\n    deleteCreatedImages(imagedirectory);\n\n    //Get the amount of pages in the pdf\n    int numberPDFPage = numberOfPagesPDF(z.FullName);\n\n    //Convert the pdf to images on the users pc\n    convertToImage(z.FullName, imagedirectory);\n\n    //Check the images for blank pages\n    blankImage = testPixels(imagedirectory, z.FullName);\n\n    //Check if the conversion couldnt convert a page because of an error\n    pagesMissing = numberPDFPage - numberOfFiles;\n\n    //int pagesMissing = 0;\n\n    //Cancel button is pressed\n    if (toContinue == 0)\n    {\n        return 0;\n    }\n\n    lock (LockIfCheck)\n    {\n        //If there is a blank page, or if there is a missing page\n        if (blankImage == 0 || pagesMissing &gt; 0)\n        {\n            myholder = 1;\n            exceptionFileList += \"File Name: \" + z.Name + \"\\r\\n\"\n           + \"File Path: \" + z.FullName + \"\\r\\n \\r\\n\";\n\n            String currentValue = exceptionFileList;\n            txtboxProblemFiles.BeginInvoke(((Action)(() =&gt; txtboxProblemFiles.Text += currentValue.ToString())));\n\n            String currentValue3 = z.FullName;\n            txtboxProblemFiles.BeginInvoke(((Action)(() =&gt; listboxProblemFiles.Items.Add(currentValue3))));\n        }\n        else\n        {\n            compltetedFileList += \"Scanning Completed of file: \" + \"\\r\\n\"\n            + \"File Name: \" + z.Name + \"\\r\\n\"\n           + \"File Path: \" + sourceDir + \"\\r\\n \\r\\n\";\n        }\n\n        String currentValue1 = \"File Name: \" + z.Name + \"\\r\\n\";\n        txtboxCheckedFiles.BeginInvoke(((Action)(() =&gt; txtboxCheckedFiles.Text += currentValue1)));\n    }\n\n\n    myWorkerClass();        \n\n    return 1;\n}\n</code></pre>\n\n<p>I'll accept any up building criticism from this code.</p>\n"},{"tags":["java","multithreading","file-io","ftp"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1946,"score":3,"question_id":510270,"title":"How to handle incomplete files? Getting exception","body":"<p>I need to create a java program which will create thread to search for a file in particular folder(source folder) and pick the file immediately for process work(convert it into csv file format) once it found the file in the source folder. Problem i am facing now is file which comes to source folder is big size(FTP tool is used to copy file from server to source folder), thread is picking that file immediately before it copies fully to source folder and throwing exception. How do i stop thread until the file copy into source folder completely?. It has to pick the file for processing only after the file is copied completely into source folder.</p>\n"},{"tags":["java","multithreading","synchronization","producer-consumer","blockingqueue"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12833243,"title":"Does increasing the amount of threads make the producer consumer prob faster?","body":"<p>I've implemented something similar to consumer-producer problem using a unbounded linked blocking queue. I have the producer putting objects to the queue and consumers taking it. When I tested the program, doubling the amound of thread each trial while still processing the same amount of objects, the time for all trials seems to be constant. Is it suppose to be constant? Or more thread means faster processing? Not sure if it is my code that is causing the slowness or the synchonization for the shared resource. Any ideas?</p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12832460,"title":"How to run the thread in different processor using c#?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/32343/how-do-i-spawn-threads-on-different-cpu-cores\">How do I spawn threads on different CPU cores?</a>  </p>\n</blockquote>\n\n\n\n<p>I am using C#. I want to write the program using the threading concept. I just want to know how to run the threads in different processors. Here I attach my partial code:</p>\n\n<pre><code>Thread t1 = new Thread(threadJobA);\nThread t2 = new Thread(threadJobB);\nt1.Start();\nt2.Start();\n</code></pre>\n"},{"tags":["c++","multithreading","synchronization"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":87,"score":-1,"question_id":12832596,"title":"Difference between Critical section and Mutex in windows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/800383/what-is-the-difference-between-mutex-and-critical-section\">What is the difference between mutex and critical section?</a>  </p>\n</blockquote>\n\n\n\n<p>I was asked this question in a interview.</p>\n\n<p>I answered saying Mutex is the kernel object and it makes a system call where as Critical section does not. The interview was not happy with this. He was almost questioning for the word kernel object. So what is the ideal answer?</p>\n\n<p>Also if there are 2 different applications(2 exes) running and if i want to thread synchronize between them, what synchronization concept should be used? Can you give me some link to read more on this ?</p>\n"},{"tags":["c","multithreading","memory-management","valgrind","massif"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12320533,"title":"Does massif tool work correctly with multithreaded applications?","body":"<p>I am developping a multithreaded application which seems to allocate huge amounts of memory during its runtiime. All the memory gets freed in the end of execution, so valgrind shows no memory leaks. I tried to use massif tool to find out what was happening, but ms_print seems to show information only about the main thread. However, I believe that the great majority of memory is allocated in child threads. Is it possible to make massif show information about them? </p>\n"},{"tags":["java","multithreading","nio"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12822298,"title":"NIO Selector: How to properly register new channel while selecting","body":"<p>I have a subclassed <code>Thread</code> with a private <code>Selector</code> and a public <code>register(SelectableChannel channel, ...)</code> method that allows other threads to register channels to the selector.</p>\n\n<p>As answered <a href=\"http://stackoverflow.com/a/3191377/589008\">here</a>, the channel's <code>register()</code> blocks during selector's <code>select()</code> / <code>select(long timeout)</code> so we need to <code>wakeup()</code> the selector.</p>\n\n<p>My thread selects indefinitely (unless it gets interrupted) and it actually manages to get into the next select before channel's <code>register()</code> is called. So I thought I use a simple lock with <code>synchronized</code> blocks  to ensure the <code>register()</code> happens first.</p>\n\n<p>The code: (irrelevant code removed for readability)</p>\n\n<pre><code>public class SelectorThread extends Thread {\n  ...\n\n  public void register(SelectableChannel channel, Attachment attachment) throws IOException {\n    channel.configureBlocking(false);\n    synchronized (this) { // LOCKING OCCURS HERE\n      selector.wakeup();\n      channel.register(selector,\n                       SelectionKey.OP_READ,\n                       attachment);\n    }\n  }\n\n  @Override\n  public void run() {\n    int ready;\n    Set&lt;SelectionKey&gt; readyKeys;\n    while (!isInterrupted()) {\n      synchronized (this) {} // LOCKING OCCURS HERE\n\n      try {\n        ready = selector.select(5000);\n      } catch (IOException e) {\n        e.printStackTrace();\n        continue;\n      }\n\n      if (ready == 0) {\n        continue;\n      }\n\n      readyKeys = selector.selectedKeys();\n\n      for (SelectionKey key : readyKeys) {\n        readyKeys.remove(key);\n\n        if (!key.isValid()) {\n          continue;\n        }\n\n        if (key.isReadable()) {\n          ...\n        }\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>This simple lock allows <code>register()</code> to happen before the thread continues with the next select loop. As far as I tested, this works as supposed.</p>\n\n<p><strong>Questions:</strong>\nIs that a \"good\" way to do it or are there any serious downsides to that? Would it be better to use a List or Queue (as suggested <a href=\"http://stackoverflow.com/a/2179612/589008\">here</a>) to store channels for registration, or a more sophisticated lock like <a href=\"http://stackoverflow.com/a/1112809/589008\">this</a> instead? What would the Pros/Cons of that be? Or are there any \"even better\" ways?</p>\n"},{"tags":["java","multithreading","performance","swing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12733297,"title":"Running two expensive database calls in parallel","body":"<p>I have (say) 2 functions which does a db-hit to fetch a lot of data. Since the two functions are executed one after the other (by the same thread), the time taken is T(f(1)) + T(f(2)). How can I execute the two functions in parallel (by means of creating 2 threads) so that the total time taken is: T(max(T(f1), T(f2)) </p>\n\n<p>I am done writing my complete java swing application and want to optimize it for performance now. Appreciate any insight, and excuse if the question is too naive.</p>\n\n<p>Thank you!</p>\n"},{"tags":["c++","multithreading","dll"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12832275,"title":"A DLL function must be called on a different thread","body":"<p>I have a dll function <code>Copy(const char** srcFiles, const char* dst)</code> which copies <code>srcFiles</code> to the folder <code>dst</code>. And it must, for example, every 0.01 sec. send copy progress information (in per cent) to my own function <code>CopyProgress</code>. The problem is that I can't change <code>Copy</code> function code, so I think execution of this function on a different thread would be a good idea. But I am a beginner in multithreading and can't imagine how this can be done. </p>\n\n<p>Any ideas, hints? Thank You.</p>\n"},{"tags":["c#","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12825968,"title":"Smartthreadpool how to know when all threads are done?","body":"<p>Im trying to figure out how to find out when all my <code>threads</code> in the queue are done.. when they are done i want to display a <code>MessageBox</code> saying something like \"Operation completed\".</p>\n\n<p>This is the code i am using to queue my threads:</p>\n\n<pre><code>Smart.STPStartInfo stpStartInfo = new Smart.STPStartInfo();\nstpStartInfo.MaxWorkerThreads = Convert.ToInt32(numericUpDown5.Value);\nstpStartInfo.MinWorkerThreads = 2;\n_smartThreadPool = new Smart.SmartThreadPool(stpStartInfo);\n\nforeach (string item in urlQueue)\n{\n    _smartThreadPool.QueueWorkItem(\n        new Amib.Threading.Func&lt;string, int, int, string, int&gt;(checkURLSmart),\n                                item, iia, 5000, kryptonTextBox1.Text);\n\n    iia++;\n}\n</code></pre>\n\n<p>Any ideas how to know when all threads have completed their work?</p>\n"},{"tags":["java","android","multithreading","handler"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12703970,"title":"postDelayed sometime doesn't run in Android","body":"<p>I am running multiple thread and Handler in my code.</p>\n\n<p>And this is my Handler</p>\n\n<pre><code>PrizeRunnable mTempPotionRunnable = new PrizeRunnable(aaa);\nhandler.postDelayed(mTempPotionRunnable, 4000);\n</code></pre>\n\n<p>and </p>\n\n<pre><code>        class PrizeRunnable implements Runnable {\n        String type;\n\n        PrizeRunnable(String type) { \n            this.type = type; \n        }\n\n        public void run() {\n            synchronized (this) {\n                  if(!mIsHandlerStarted){\n                      if(type.equals(aaa))\n                          // Do something\n                      else if(type.equals(bbb))\n                          // Do something\n\n                    mIsHandlerStarted = true;\n                    handler.removeCallbacks(this);\n                  }\n              }\n        }\n    }\n</code></pre>\n\n<p>But sometime it run simultaneously. </p>\n\n<p>i don not know the reason.</p>\n\n<p><strong>UPDATED</strong></p>\n\n<p>I try to change it to:</p>\n\n<pre><code>handler.postDelayed(mTempPotionRunnable, 4000);\n</code></pre>\n\n<p>and </p>\n\n<pre><code>Runnable mTempPotionRunnable = new Runnable() {\n@Override\npublic void run() {\n      synchronized (this) {\n          if(!mIsHandlerStarted){\n                // Do something\n                mIsHandlerStarted = true;\n                handler.removeCallbacks(mMetalRunnable);\n          }\n      }\n}\n};\n</code></pre>\n\n<p>May be it resolve my problems. I am testing this method.</p>\n\n<p>But i can't pass parameter to my <code>Runnable</code> . How can i do it?</p>\n"},{"tags":["multithreading","operating-system","pthreads","spinlock"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12828632,"title":"Seconds overflow in pthread_cond_timedwait","body":"<p>I have a usecase in which I want to acquire a condition variable and release it after some time interval( Eg: I have a queue of time ordered events and I want to block for a specified duration .)</p>\n\n<pre><code>Duration = Earliest Time in Q - Current Time()\n</code></pre>\n\n<p>I came across the following which would exactly serve my purpose. </p>\n\n<pre><code> pthread_cond_timedwait(pthread_cond_t *restrict cond,\n pthread_mutex_t *restrict mutex,\n const struct timespec *restrict abstime);\n</code></pre>\n\n<p>But the problem is timespec.sec is of time_t ( which is a 32 signed type ) and it overflows. Is there a workaround for this ? Is there any other construct available which we will be to block for a longer time ? I am using a Linux platform.</p>\n"},{"tags":["multithreading","synchronization","rendering","game-engine"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11403359,"title":"Thoughts about rendering loop strategies","body":"<p>I know that hundreds of variations of these considerations have been posted all over the net. However, I haven't found anything that adresses my exact problem, so I hope you can help me see the light.</p>\n\n<p>I'm currently toying with 2D game development in Java using OpenGL. The language and graphics library used is not that relevant to my question though as it has a more general character.</p>\n\n<p>I'm attempting to design a general purpose game loop which can be used more or less as is for any game that has moderately heavy graphics (mostly bitmap textures) and possibly even heavier game logic (AI, collision detection, etc).</p>\n\n<p>Basically I'm expecting to maintain a list/array/buffer of objects that can be updated (positions, velocities, and other game related updates) and rendered (textures/frames at updated positions) non stop as smooth and efficiently as possible.</p>\n\n<p><strong>1) One thread for update + rendering</strong></p>\n\n<p>I have tried and discarded a sequential solution using only one thread (well, two when counting user input).</p>\n\n<ul>\n<li>Calculate changes and update buffer objects</li>\n<li>Render textures at updated positions to backbuffer</li>\n<li>Swap backbuffer to front</li>\n</ul>\n\n<p>Apparently a lot of good computing time is wasted while swap-buffers is blocking on the hardware, which calls for a more efficient solution </p>\n\n<p><strong>2) One thread for update, one for rendering</strong></p>\n\n<p>By splitting the program into an update thread and a rendering thread and synchronizing access to the shared buffer I should be able to ensure a pretty steady framerate. Synchronizing access to the shared buffer can be accomplished in many ways, but they all have one thing in common. They all prohibit thread concurrency. While this may be a fair tradeoff, I'm wondering what makes synchronization necessary.</p>\n\n<p><strong>3) Same as 2, but without synchronization</strong></p>\n\n<p>I do understand many of the problems that can be caused by careless implementation of concurrent threads. The producer/consumer, the readers/writers and similar situations causing potential deadlocks. However, I do not understand why I need to ensure synchronization of the shared data if the following criteria are met (and they should be):</p>\n\n<ul>\n<li>The render thread can only read from the shared buffer</li>\n<li>The update thread can both read from, and write to the shared buffer (so it is the only 'writer')</li>\n<li>The shared buffer will never be empty nor full while the game is running</li>\n<li>The threads will never sleep</li>\n<li>The rendering does not have to be 100% accurate. If some shared objects have not yet been updated causing them to be one update-step (ie. some 10-20 millisecs) behind other objects no one should ever notice.</li>\n</ul>\n\n<p>-</p>\n\n<p>So... what obvious thing am I missing here? Why do I need the synchronization for this setup? </p>\n\n<ul>\n<li>Can threads cache data causing problems when not properly synchronized?</li>\n<li>Or can data somehow be garbled if the writing thread is interrupted at an unfortunate time?</li>\n<li>Or are there any general problems with my proposed stategy making it useless?</li>\n</ul>\n\n<p>Any thoughts, comments, or suggestions are most welcome. Or if this particular question has already been addressed elsewhere I would appreciate a reference.</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12829956,"title":"Multithreading observer, update function doesn't work","body":"<p>I implement the observer, runnable to a class. But it seems the update function doesn't execute. I don't know what's wrong with this? Anyone can help?</p>\n\n<p>I've already put the setChanged() and notifyObservers() in the MyCollectionDB;</p>\n\n<p>Here is my code:</p>\n\n<pre><code>public class ClientHandler implements Runnable, Observer {\n\n    Socket clientSocket;\n    CollectionDB myDB;\n    private final static String[] COMMANDS = {\"GetAllAlbumTitles\", \"GetAlbumDetail\", \"AddAlbum\", \"DeleteAlbum\", \"Bye\"};\n    public ClientHandler(Socket cSocket) {\n        this.clientSocket = cSocket;\n        this.myDB = new MyCollectionDB();\n    }\n\n    public void run() {\n        try {\n            String remoteHost = this.clientSocket.getInetAddress().getHostName();\n\n            System.out.println(remoteHost + \" is connected.\");\n            ObjectInputStream inputObjectFromClient = new ObjectInputStream(this.clientSocket.getInputStream());\n\n            boolean done = false;\n\n            while (!done) {\n                String clientCommand = (String) inputObjectFromClient.readObject();\n                System.out.println(clientCommand);\n                if (clientCommand.equals(COMMANDS[4])) {\n                   done = true; \n                } else if (clientCommand.equals(COMMANDS[0])) {\n                    ObjectOutputStream toClientObject = new ObjectOutputStream(this.clientSocket.getOutputStream());\n                    Vector&lt;String&gt; albumTitles = new Vector&lt;String&gt;();\n                    List&lt;String&gt; titles = this.myDB.getTitles();\n                    for(String title : titles) {\n                        albumTitles.addElement(title);\n                    }\n\n                    toClientObject.writeObject(albumTitles);\n                } else if (clientCommand.equals(COMMANDS[1])) {\n                    String title = (String) inputObjectFromClient.readObject();\n                    String details = null;\n                    Album al = this.myDB.getAlbum(title);\n                    if (al instanceof CDAlbum) {\n                        CDAlbum cd = (CDAlbum) al;\n                        details = cd.getDetails();\n                    } else {\n                        DVDAlbum dvd = (DVDAlbum) al;\n                        details = dvd.getDetails();\n                    }\n                    ObjectOutputStream toClientObject = new ObjectOutputStream(this.clientSocket.getOutputStream());\n                    toClientObject.writeObject(details);\n                } else if (clientCommand.equals(COMMANDS[2])) {\n\n                    Album al = (Album) inputObjectFromClient.readObject();\n                    this.myDB.addAlbum(al);\n\n                } else if (clientCommand.equals(COMMANDS[3])) {\n                    String title = (String) inputObjectFromClient.readObject();\n                    this.myDB.deleteAlbum(title);\n                }\n            }\n            this.clientSocket.close();\n            System.out.println(remoteHost + \" is disconnected.\");\n        } catch (IOException e) {\n            e.printStackTrace();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public void update(Observable obs, Object obj) {\n        System.out.println(\"Updating........................\");\n        try {\n            ObjectOutputStream toClientObject = new ObjectOutputStream(this.clientSocket.getOutputStream());\n            Vector&lt;String&gt; albumTitles = new Vector&lt;String&gt;();\n            List&lt;String&gt; titles = this.myDB.getTitles();\n            for(String title : titles) {\n                albumTitles.addElement(title);\n            }\n            System.out.println(titles);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\npublic class CollectionServer {\n    private final static int PORT = 8001;\n    private final static int WAITING_TIME = 300000;\n\n    public void start() {\n        MyCollectionDB myDB = new MyCollectionDB();\n        try {\n            ServerSocket serverSocket = new ServerSocket(PORT);\n            try {\n                serverSocket.setSoTimeout(WAITING_TIME);\n                String hostname = InetAddress.getLocalHost().getHostName();\n                String hostIP = InetAddress.getLocalHost().getHostAddress();\n                System.out.println(\"MyCollection server started on \" + hostname\n                        + \" width IP: \" + hostIP + \" on the port: \" + PORT);\n\n                while (true) {\n                    Socket cSocket = serverSocket.accept();\n                    ClientHandler cHandler = new ClientHandler(cSocket);\n                    myDB.addObserver(cHandler);\n\n                    Thread thread = new Thread(cHandler);\n\n                    thread.start();\n\n                }\n            } catch (SocketTimeoutException e) {\n                serverSocket.close();\n\n                myDB.cleanup();\n                System.out.println(\"Timeout, the server has stopped.\");\n            }\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n</code></pre>\n"},{"tags":["python","multithreading","nxt","lego"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12831245,"title":"Thread not working with turn method","body":"<p>The collisionDetection() thread is not working. I couldn't find where the bug is. I want to create a thread that uses ultrasonic to detect collison and once it does it will brake it's motors i am using nxt-python 2.2.2 and using synchronized motors to run the wheels.</p>\n\n<pre><code>import nxt.locator\n\nfrom nxt.motor import *\nfrom nxt.sensor import *\nfrom threading import Thread\n\nbrick = nxt.locator.find_one_brick()\nleft = Motor(brick, PORT_B)\nright = Motor(brick, PORT_A)\nboth = nxt.SynchronizedMotors(left, right, 0)\nultrasonic = Ultrasonic(brick, PORT_4)\n\ndef echolocate():\n    ultrasonic.get_sample()\n\ndef collisionDetection():\n\n    while echolocate &lt; 20:\n        both.brake()\n\n\ndef test():\n    collisionDetection()\n    both.turn(70,2000,brake=False)\n\n\nThread(target = collisionDetection).start()\ncollisionDetection()\n\nwhile True:\n    collisionDetection()\n    test()\n</code></pre>\n"},{"tags":["c++","multithreading","boost"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12810127,"title":"Is there a facility in boost to allow for write-biased locking?","body":"<p>If I have the following code:</p>\n\n<pre><code>#include &lt;boost/date_time.hpp&gt;\n#include &lt;boost/thread.hpp&gt;\n\nboost::shared_mutex g_sharedMutex;\n\nvoid reader()\n{\n    boost::shared_lock&lt;boost::shared_mutex&gt; lock(g_sharedMutex);\n    boost::this_thread::sleep(boost::posix_time::seconds(10));\n}\n\nvoid makeReaders()\n{\n    while (1)\n    {\n        boost::thread ar(reader);\n        boost::this_thread::sleep(boost::posix_time::seconds(3));\n    }\n}\n\nboost::thread mr(makeReaders);\nboost::this_thread::sleep(boost::posix_time::seconds(5));\nboost::unique_lock&lt;boost::shared_mutex&gt; lock(g_sharedMutex);\n\n...\n</code></pre>\n\n<p>the unique lock will never be acquired, because there are always going to be readers. I want a unique_lock that, when it starts waiting, prevents any new read locks from gaining access to the mutex (called a write-biased or write-preferred lock, based on my wiki searching).  Is there a simple way to do this with boost? Or would I need to write my own?</p>\n"},{"tags":["python","multithreading","breakpoints","pdb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12828956,"title":"pdb cannot break in another thread?","body":"<p>Consider this multi-threaded program:</p>\n\n<pre><code>import threading\n\nclass SomeThread(threading.Thread):\n  def run(self):\n    a = 1\n    print a\n\ndef main():\n  print 'hola'\n  someThread = SomeThread()\n  someThread.start()\n\nif __name__ == '__main__':\n  main()\n</code></pre>\n\n<p>When I debug this program with pdb, at the prompt I first set a break point at each of the two print statements.  Then I continue.  pdb breaks at <code>print 'hola'</code>.  I continue again and see the effect of the print in the other thread, but pdb doesn't break.</p>\n\n<p>The help commands don't list anything to switch thread contexts like gdb... so... is it just not possible in one thread context to set a breakpoint that will trip in another context?</p>\n"},{"tags":["multithreading","cocoa","grand-central-dispatch","key-value-observing"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":106,"score":8,"question_id":12403229,"title":"What is the Cocoa-way of observing progress of a background task?","body":"<p>Imagine the following situation: you have a background task (the term \"task\" here means a random computational unit, not an NSTask!), that is implemented using any of the modern technology such as Grand Central Dispatch or Operation Queues. Some controller object on main thread wants to monitor the progress of this background task and report it to a user.</p>\n\n<p>Task progress can have following characteristics:</p>\n\n<ul>\n<li><strong>Be indeterminate or determinate</strong><br>\n<em>Because controller object must know when to switch NSProgressIndicator to the appropriate style. We can use a convention that progress is treated as indeterminate until the actual progress value raises from zero.</em></li>\n<li><strong>Progress value itself</strong><br>\n<em>A simple float value</em></li>\n<li><strong>Localized description of a current phase</strong><br>\n<em>NSString, because communication with user is good</em></li>\n</ul>\n\n<p>What design suits these requirements at best while being the most Cocoa-ish?</p>\n\n<h1>There can be variants.</h1>\n\n<h2>Delegation</h2>\n\n<p>Before firing up the task set your controller object as delegate.</p>\n\n<pre><code>@protocol MyBackgroundTaskDelegate\n@required\n- (void) progress: (float) value; // 0.0…1.0\n@optional\n- (void) workingOn: (NSString*) msg; // @\"Doing this, doing that…\"\n@end\n</code></pre>\n\n<p>Actually, i successfully used this template many times, but it feels a little too verbose.</p>\n\n<h2>Block callback</h2>\n\n<p>Very similar to delegation, but keeps code in one place.</p>\n\n<pre><code>// Starting our background task...\n[MyTask startComputationWithProgressHandler: ^(float progress, NSString* msg)\n{\n    // Switching to the main thread because all UI stuff should go there...\n    dispatch_async(dispatch_get_main_queue(), ^()\n    {\n        self.progressIndicator.progress = progress;\n        self.informationalMessage = msg;\n    });\n}];\n</code></pre>\n\n<h2>KVO or polling of a progress properties</h2>\n\n<p>In this case background task object must have two properties similar to these:</p>\n\n<pre><code>@property(readonly, atomic) float progress;\n@property(readonly, atomic) NSString* message;\n</code></pre>\n\n<p>And a client (our controller object) should set itself as an observer of these properties. The major flaw i see in this solution is that KVO-notifications always arrive on the same thread that caused the change. While you can force your observer (callback) method to run on a particular GCD queue it may not be always appropriate.</p>\n\n<h2>NSNotificationCenter</h2>\n\n<p>Background task sends notifications and client listens to them.</p>\n\n<p><strong>Is there any other patterns applicable to this situation?</strong> What solution can be treated as a most modern and Cocoa-ish?</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":321,"score":0,"question_id":9327354,"title":"ThreadLocal with Singletons","body":"<p>I am working on the following piece of code. Two threads requiring their own instance of a singleton. Thread Local is an obvious solution to this. However I am still facing issues running the threads with their own local copy. I have an example of the scenario in a couple of java classes.</p>\n\n<pre><code>public class Singleton1 {\n\nprivate int i = 0;\n\nprivate static Singleton1 instance;\n\nprivate Singleton1() {\n}\n\npublic static final Singleton1 getInstance() {\n    if (instance == null) {\n        instance = new Singleton1();\n    }\n    return instance;\n}\n\npublic int increment() {\n    return i++;\n}\n\n}\n\npublic class Holder1 {\n\nprivate final Singleton1 instance;\n\npublic Holder1() {\n    ThreadLocalSingleton1 singleton1 = new ThreadLocalSingleton1();\n    instance = singleton1.get();\n}\n\npublic int increment() {\n    return instance.increment();\n}\n\nprivate class ThreadLocalSingleton1 extends ThreadLocal&lt;Singleton1&gt; {\n\n    @Override\n    protected Singleton1 initialValue() {\n        return Singleton1.getInstance();\n    }\n\n}\n\n}\n\npublic class HolderTest {\n\n/**\n * @param args\n */\npublic static void main(String[] args) {\n    HolderTest test = new HolderTest();\n    HolderThread thread1 = test.getHolderThread(\"thread1\");\n    HolderThread thread2 = test.getHolderThread(\"thread2\");\n    thread1.run();\n    thread2.run();\n\n}\n\npublic HolderThread getHolderThread(String name) {\n    return new HolderThread(name);\n}\n\nprivate class HolderThread implements Runnable {\n    String name;\n\n    Holder1 holder1 = new Holder1();\n\n    public HolderThread(String name) {\n        this.name = name;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            System.out.println(name + \" \" + holder1.increment());\n        }\n    }\n}\n</code></pre>\n\n<p>When the ThreadLocal wrappers call getInstance on the Singleton classes I do not get a new instance each time? How do I make this work for my purposes?</p>\n\n<p>The code above is a simple version of the actual code I am working with. I have Singleton classes which I cannot change from being singletons. I am creating a test client which needs to run as a single process but with many threads. Each of these threads needs to have its own instance of these singletons.</p>\n"},{"tags":["android","multithreading","service","aidl"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2581,"score":0,"question_id":2769297,"title":"Callback from another thread causes an exception","body":"<p>I'm trying to create a simple multiplayer game. There's a <code>WorkerService</code> which is supposed to handle all network communication and all interaction between this service and my Activities is done with AIDL. I think this is a standard approach - to enable two way interaction I use also an <code>IWorkerCallback</code> interface (also AIDL).</p>\n\n<p>The problem is that callbacks have to change things in UI which may be done only in UI thread. I've created a <code>Handler</code> (in UI thread) and believed that this is an obvious solution. But, surprisingly, it's not working.</p>\n\n<p>My <code>LoungeActivity</code> calls <code>startServer()</code> method of <code>IWorker</code> interface. Corresponding method of my <code>WorkerService</code> does some job and makes a callback - this works fine. Then <code>WorkerService</code> spawns a new thread and callback from this thread results in a bad Exception being thrown:</p>\n\n<p><code>Can't create handler inside thread that has not called Looper.prepare()</code></p>\n\n<p>Here's some code to make it clear:</p>\n\n<p><code>startServer()</code> implementation:</p>\n\n<pre><code>private void startServerImpl(String name, float latStart, float latEnd,\nfloat lonStart, float lonEnd)\n{\n    // some instructions here\n\n    // this works fine:\n    callback.notifySocketCreated();\n\n    // my naughty thread:\n    new ServerThread().start();\n\n    // some instructions here\n}\n</code></pre>\n\n<p><code>ServerThread</code> code:</p>\n\n<pre><code>private class ServerThread extends Thread {\n    @Override\n    public void run()\n    {\n        //some instructions here\n\n        // this call will cause an error\n        callback.notifyGameRegistered();\n\n    }\n}\n</code></pre>\n\n<p>Every method from <code>callback</code> looks like that:</p>\n\n<pre><code>public void notifyGameRegistered() throws RemoteException\n{\n    handler.dispatchMessage(handler.obtainMessage(CALLBACK_GAME_REGISTERED));\n}\n</code></pre>\n\n<p>In Handler's <code>handleMessage()</code> method I'm doing a simple <code>switch(msg.what)</code> and in every case there's a simple UI modification (showing a Toast, changing Text, etc.).</p>\n\n<p>I have no idea why is this Exception thrown.. I've managed to fix it by packing code into a <code>Runnable</code> and calling <code>runOnUiThread()</code> but it still makes me curious - shouldn't a Handler always run in thread that created it? Or maybe I'm doing something wrong?</p>\n"},{"tags":["java","multithreading","matrix-multiplication"],"answer_count":4,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":1877,"score":4,"question_id":2074299,"title":"java matrix-multiplication (FAST)","body":"<p>I have to multiply 2 (most of the times) sparse matrix.\nThose matrix are pretty bit (about 10k*10k) and i've a two Xeon Quad core and just one thread for this job?</p>\n\n<p>is there any fast library for multi-thread moltiplication? any other advice?</p>\n"},{"tags":["android","multithreading","handler","looper"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12829536,"title":"android:Can't create handler inside thread that has not called Looper.prepare()","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3614663/cant-create-handler-inside-thread-that-has-not-called-looper-prepare-inside-a\">Can’t create handler inside thread that has not called Looper.prepare() inside AsyncTask for ProgressDialog</a>  </p>\n</blockquote>\n\n\n\n<p>In my program I want show progress-dialog, for that I have created thread, but it gives me<code>Can't create handler inside thread that has not called Looper.prepare()</code> I look previous posted question also but I can handle this . this is my code</p>\n\n<pre><code>        dialog=ProgressDialog.show(Login.this, \"Connecting to the Server\", \"Please wait\");\n\n        Thread thred=new Thread(new Runnable() {\n\n            public void run() {\n                  try {\n\n\n                      // Create a new HttpClient and Post Header\n                        HttpClient httpclient = new DefaultHttpClient();           \n                        HttpPost httppost = new HttpPost(\"http://www.diskonbanget.com/bni/login/login.php\");\n                        List&lt;NameValuePair&gt; nameValuePairs = new ArrayList&lt;NameValuePair&gt;(2);\n                        nameValuePairs.add(new BasicNameValuePair(\"username\", username));\n                        nameValuePairs.add(new BasicNameValuePair(\"password\", password));\n                        httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));\n\n                        // Execute HTTP Post Request\n\n                        HttpResponse response = httpclient.execute(httppost);\n\n                        String str = inputStreamToString(response.getEntity().getContent()).toString();\n\n\n                        if(str.toString().equalsIgnoreCase(\"false\"))\n                        {\n                            dialog.dismiss();\n                            AlertDialog alert = new AlertDialog.Builder(Login.this).create();                       \n                            alert.setMessage(\"Please enter valid username &amp; Password\");\n                            alert.setButton(\"OK\",new DialogInterface.OnClickListener() {\n                                        public void onClick(DialogInterface dialog,int which) {\n                                        }\n                                    });\n\n                          alert.setIcon(R.drawable.loginlogo); \n                          alert.show();\n\n\n                        }\n                        else{   \n\n                             Intent intent=new Intent(Login.this,MainMenu.class);\n                             intent.putExtra(\"photo\", str);\n                             intent.putExtra(\"username\", username);\n                             txtusername.setText(\"\");\n                             txtPassword.setText(\"\");\n                             dialog.dismiss();\n                             startActivity(intent);\n\n\n                        }\n\n                    } catch (Exception e) {\n                        dialog.dismiss();\n                        AlertDialog alert = new AlertDialog.Builder(Login.this).create();                       \n                        alert.setMessage(\"Can not Connect to the server.please make sure your internet is Switch on\");\n                        alert.setButton(\"OK\",new DialogInterface.OnClickListener() {\n                                    public void onClick(DialogInterface dialog,int which) {\n                                    }\n                                });\n                        alert.setIcon(R.drawable.loginlogo); \n\n                        alert.show();\n                    } \n\n\n            }\n        });\n        thred.start();\n</code></pre>\n\n<p>please someone help me to fix this problem.</p>\n"},{"tags":["asp.net","multithreading","threadpool","pageasynctask"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12828898,"title":"Aspnet PageAsyncTask with asp.net controls","body":"<p>In my asp.net web application I am using PageAsyncTask to send thousands of emails.When every successful mail sent i get a result in end event handler and i add a successful message in gridview.But when i do some postback in my page while async operations are processing i could not use gridview.In debug mode i can see the gridview but not only this one ı could not be able to use Response.Write method.I need a suggestion that is possible what i am doing (trying to use context elements after postback) , if possible what is your suggesiton for that.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c#",".net","winforms","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1395,"score":3,"question_id":5119263,"title":"Control.Invoke() hangs application","body":"<p>I'm showing an animation while my control is loading the data. When the thread finishes, I hide the animation and show the control. So I'm executing this code from a thread:</p>\n\n<pre><code>protected void InvokeEnableBackControl()\n{\n    if (this.InvokeRequired)\n    {                \n        this.Invoke(new OpHandler(EnableBackControl));\n    }\n    else\n    {\n        EnableBackControl();\n    }\n}\n</code></pre>\n\n<p>Sometimes, when I execute this code, the main thread gets hanged in the following code:</p>\n\n<pre><code>protected virtual void EnableBackControl()\n{\n    if (overlayAnimation.TargetControl != null)\n    {\n        overlayAnimation.TargetControl.BringToFront();\n    }\n\n    overlayAnimation.SendToBack();\n    overlayAnimation.Enabled = false;\n    overlayAnimation.Visible = false;                      \n</code></pre>\n\n<p>}</p>\n\n<p>I'm not sure if it's hanged setting the <code>Enable</code> or <code>Visible</code> property. Do you know any circumstance that may hand the application calling these properties from a <code>Control.Invoke</code>?</p>\n"},{"tags":["c#",".net","multithreading","entity-framework","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12827599,"title":"Parallel doesnt work with Entity Framework","body":"<p>I have a list of IDs, and I need to run several stored procedures on each ID.</p>\n\n<p>When I am using a standard foreach loop, it works OK, but when I have many records, it works pretty slow.</p>\n\n<p>I wanted to convert the code to work with EF, but I am getting an exception: \"The underlying provider failed on Open\".</p>\n\n<p>I am using this code, inside the Parallel.ForEach:</p>\n\n<pre><code>using (XmlEntities osContext = new XmlEntities())\n{\n    //The code\n}\n</code></pre>\n\n<p>But it still throws the exception.</p>\n\n<p>Any idea how can I use Parallel with EF? do I need to create a new context for every procedure I am running? I have around 10 procedures, so I think its very bad to create 10 contexts, one for each.</p>\n"},{"tags":["android","multithreading","opengl-es","pthreads","android-ndk"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":701,"score":0,"question_id":7422070,"title":"Android NDK: OpenGL draw calls in thread outside of android_main","body":"<p>I have a purely native Android NDK app. The main loop is in </p>\n\n<pre><code> android_main\n</code></pre>\n\n<p>as provided by the android_native_app_glue.h.</p>\n\n<p>I need to render something in a separate thread, so via android_main I tried:</p>\n\n<pre><code> pthread_t thread1;\n pthread_create(&amp;thread1, NULL, renderstuff, NULL);\n\nvoid *renderstuff( void *ptr )\n{\n  // some opnegl es draw calls\n}\n</code></pre>\n\n<p>However this does not render anything. If I perform the same draw calls from within android_main (but without creating a new thread), it renders fine :S</p>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12822718,"title":"Multithreading address space","body":"<p>Threads have their own call stack, then what kind of memory do different threads share. Do they have their own stack memory within the address space of a process? Is that memory sufficient for spawning 100s of threads? If a process has an object B, in case of Java it will be created on the heap. So, how are threads spawned by that process able to have access to that object on the heap ? </p>\n"},{"tags":["java","multithreading","swing","event-dispatch-thread","jstack"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":154,"score":4,"question_id":12728589,"title":"Java Swing : GUI frozen - jstack interpretation","body":"<p>I have a Gui application in swing that prints a ticket on a serial thermal printer. When i hit the button that launch this action, my GUI is frozen. I think that's because the code is executed on the EDT. I used jstack to be sure but i don't understand the results below : </p>\n\n<pre><code>Full thread dump Java HotSpot(TM) Client VM (23.3-b01 mixed mode, sharing):\n\n\"Thread-12\" prio=6 tid=0x03012000 nid=0xd04 runnable [0x038ef000]\njava.lang.Thread.State: RUNNABLE\n    at gnu.io.RXTXPort.eventLoop(Native Method)\n    at gnu.io.RXTXPort$MonitorThread.run(RXTXPort.java:1575)\n\n\"Thread-6\" prio=6 tid=0x0302c400 nid=0x1b0 waiting on condition [0x039ef000]\njava.lang.Thread.State: TIMED_WAITING (sleeping)\n    at java.lang.Thread.sleep(Native Method)\n    at posO2.Threads.ThreadHorloge.run(ThreadHorloge.java:46)\n\n\"Thread-5\" prio=6 tid=0x03511c00 nid=0x9e4 waiting on condition [0x0399f000]\njava.lang.Thread.State: TIMED_WAITING (sleeping)\n    at java.lang.Thread.sleep(Native Method)\n    at posO2.Threads.ThreadIgor.run(ThreadIgor.java:29)\n\n\"Thread-7\" prio=6 tid=0x034b9800 nid=0xb40 waiting on condition [0x0394f000]\njava.lang.Thread.State: TIMED_WAITING (sleeping)\n    at java.lang.Thread.sleep(Native Method)\n    at posO2.Threads.ThreadHorloge.run(ThreadHorloge.java:46)\n    at java.lang.Thread.run(Unknown Source)\n\n\"Thread-4\" prio=6 tid=0x0318ec00 nid=0xa08 waiting on condition [0x0323f000]\njava.lang.Thread.State: TIMED_WAITING (sleeping)\n    at java.lang.Thread.sleep(Native Method)\n    at posO2.Threads.ThreadMajProduits.run(ThreadMajProduits.java:49)\n\n\"TimerQueue\" daemon prio=6 tid=0x03036400 nid=0x9b8 waiting on condition [0x0344\nf000]\njava.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  &lt;0x27e76778&gt; (a java.util.concurrent.locks.Abstra\nctQueuedSynchronizer$ConditionObject)\n    at java.util.concurrent.locks.LockSupport.park(Unknown Source)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject\n.await(Unknown Source)\n    at java.util.concurrent.DelayQueue.take(Unknown Source)\n    at javax.swing.TimerQueue.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n\n\"DestroyJavaVM\" prio=6 tid=0x003c8400 nid=0xfe4 waiting on condition [0x00000000\n]\njava.lang.Thread.State: RUNNABLE\n\n\"AWT-EventQueue-0\" prio=6 tid=0x02b6e000 nid=0xcbc runnable [0x033fe000]\njava.lang.Thread.State: RUNNABLE\n    at java.net.SocketInputStream.socketRead0(Native Method)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.net.SocketInputStream.read(Unknown Source)\n    at java.io.BufferedInputStream.fill(Unknown Source)\n    at java.io.BufferedInputStream.read(Unknown Source)\n    - locked &lt;0x22f33f30&gt; (a java.io.BufferedInputStream)\n    at java.io.DataInputStream.readByte(Unknown Source)\n    at org.hsqldb.result.Result.newResult(Unknown Source)\n    at org.hsqldb.ClientConnection.read(Unknown Source)\n    at org.hsqldb.ClientConnection.execute(Unknown Source)\n    - locked &lt;0x22f32700&gt; (a org.hsqldb.ClientConnection)\n    at org.hsqldb.jdbc.JDBCStatement.fetchResult(Unknown Source)\n    at org.hsqldb.jdbc.JDBCStatement.executeQuery(Unknown Source)\n    - locked &lt;0x22be23b0&gt; (a org.hsqldb.jdbc.JDBCStatement)\n    at posO2.Printer.flash(Printer.java:1058)\n    at posO2.Printer.bigFlash(Printer.java:1111)\n    at posO2.Panels.Accueil$5.actionPerformed(Accueil.java:314)\n    at javax.swing.AbstractButton.fireActionPerformed(Unknown Source)\n    at javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)\n    at javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)\n    at javax.swing.DefaultButtonModel.setPressed(Unknown Source)\n    at javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Source)\n    at java.awt.Component.processMouseEvent(Unknown Source)\n    at javax.swing.JComponent.processMouseEvent(Unknown Source)\n    at java.awt.Component.processEvent(Unknown Source)\n    at java.awt.Container.processEvent(Unknown Source)\n    at java.awt.Component.dispatchEventImpl(Unknown Source)\n    at java.awt.Container.dispatchEventImpl(Unknown Source)\n    at java.awt.Component.dispatchEvent(Unknown Source)\n    at java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)\n    at java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)\n    at java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)\n    at java.awt.Container.dispatchEventImpl(Unknown Source)\n    at java.awt.Window.dispatchEventImpl(Unknown Source)\n    at java.awt.Component.dispatchEvent(Unknown Source)\n    at java.awt.EventQueue.dispatchEventImpl(Unknown Source)\n    at java.awt.EventQueue.access$200(Unknown Source)\n    at java.awt.EventQueue$3.run(Unknown Source)\n    at java.awt.EventQueue$3.run(Unknown Source)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)\n    at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)\n    at java.awt.EventQueue$4.run(Unknown Source)\n    at java.awt.EventQueue$4.run(Unknown Source)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)\n    at java.awt.EventQueue.dispatchEvent(Unknown Source)\n    at java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)\n    at java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)\n    at java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)\n    at java.awt.EventDispatchThread.pumpEvents(Unknown Source)\n    at java.awt.EventDispatchThread.pumpEvents(Unknown Source)\n    at java.awt.EventDispatchThread.run(Unknown Source)\n\n\"AWT-Shutdown\" prio=6 tid=0x02b81800 nid=0xefc in Object.wait() [0x033af000]\njava.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on &lt;0x27c707c0&gt; (a java.lang.Object)\n    at java.lang.Object.wait(Object.java:503)\n    at sun.awt.AWTAutoShutdown.run(Unknown Source)\n    - locked &lt;0x27c707c0&gt; (a java.lang.Object)\n    at java.lang.Thread.run(Unknown Source)\n\n\"AWT-Windows\" daemon prio=6 tid=0x03002800 nid=0xe58 runnable [0x0328f000]\njava.lang.Thread.State: RUNNABLE\n    at sun.awt.windows.WToolkit.eventLoop(Native Method)\n    at sun.awt.windows.WToolkit.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n\n \"Java2D Disposer\" daemon prio=10 tid=0x03000400 nid=0x4d0 in Object.wait() [0x03\n1ef000]\njava.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on &lt;0x27c2bf18&gt; (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    - locked &lt;0x27c2bf18&gt; (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    at sun.java2d.Disposer.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n\n\"Service Thread\" daemon prio=6 tid=0x02b63000 nid=0xb94 runnable [0x00000000]\njava.lang.Thread.State: RUNNABLE\n\n\"C1 CompilerThread0\" daemon prio=10 tid=0x02b54c00 nid=0x3f0 waiting on conditio\nn [0x00000000]\njava.lang.Thread.State: RUNNABLE\n\n\"Attach Listener\" daemon prio=10 tid=0x02b53400 nid=0x924 waiting on condition [\n0x00000000]\njava.lang.Thread.State: RUNNABLE\n\n\"Signal Dispatcher\" daemon prio=10 tid=0x02b52000 nid=0xb88 runnable [0x00000000\n]\njava.lang.Thread.State: RUNNABLE\n\n\"Finalizer\" daemon prio=8 tid=0x02b43c00 nid=0xfc8 in Object.wait() [0x02dff000]\n\njava.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on &lt;0x27c2c148&gt; (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    - locked &lt;0x27c2c148&gt; (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(Unknown Source)\n    at java.lang.ref.Finalizer$FinalizerThread.run(Unknown Source)\n\n\"Reference Handler\" daemon prio=10 tid=0x02b3f000 nid=0x488 in Object.wait() [0x\n02daf000]\njava.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on &lt;0x27c2bdd8&gt; (a java.lang.ref.Reference$Lock)\n    at java.lang.Object.wait(Object.java:503)\n    at java.lang.ref.Reference$ReferenceHandler.run(Unknown Source)\n    - locked &lt;0x27c2bdd8&gt; (a java.lang.ref.Reference$Lock)\n\n\"VM Thread\" prio=10 tid=0x02b3d400 nid=0xa6c runnable\n\n\"VM Periodic Task Thread\" prio=10 tid=0x02b76800 nid=0xf30 waiting on condition\n\n\nJNI global references: 426\n</code></pre>\n\n<p>Can someone explain to me where i can see that my GUI is frozen because of the first thread \"Thread-12\".</p>\n\n<p>And secondly what's the difference between \"Thread-6\" and \"Thread-7\" as long as I'm sure i only ran this thread once.</p>\n"},{"tags":["python","multithreading","tornado"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":464,"score":0,"question_id":6209624,"title":"Can't get Tornado webserver to thread code","body":"<p>Just getting started with Tornado, have no idea what I'm getting wrong but I can't get it to thread at all, here's the code I'm testing with.</p>\n\n<pre><code>    import tornado.ioloop\n    import tornado.web\n    import time\n    from threading import Timer\n\n    class MainHandler(tornado.web.RequestHandler):\n        @tornado.web.asynchronous\n        def get(self):\n            t = Timer(5.0, self.on_response)\n            t.start()\n            print 'thread started'\n\n        def on_response(self):\n            self.write(str(time.time()))\n            self.finish()\n\n    application = tornado.web.Application([\n        (r\"/\", MainHandler),\n    ])\n\n    if __name__ == \"__main__\":\n        application.listen(8888)\n        tornado.ioloop.IOLoop.instance().start()\n</code></pre>\n\n<p>If I run this, it works, but it blocks the entire webserver for 5 seconds, so if I try to load this page twice in quick succession, it will print 'thread started', wait 5 seconds, the first browser will load, then it will print 'thread started' again, wait another 5 seconds, and then send the second browser the page, thus taking a total of 10 seconds.</p>\n\n<p>Even running the non-blocking example from the tornado website, I run into this issue. Any ideas?</p>\n\n<p>Tried with python 2.6 and 2.7, Tornado 1.2.1 from easy_install.</p>\n"},{"tags":["java","android","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":394,"score":0,"question_id":8132207,"title":"Get Thread already Start Error on this class?","body":"<p>This is My Class where i am implement the thread to draw on canvas.</p>\n\n<pre><code>    package com.example.drawing;\n\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.graphics.BitmapFactory;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Matrix;\nimport android.graphics.Paint;\nimport android.graphics.PorterDuff;\nimport android.util.AttributeSet;\nimport android.util.Log;\nimport android.view.GestureDetector.OnDoubleTapListener;\nimport android.view.SurfaceHolder;\nimport android.view.SurfaceView;\nimport com.example.drawing.DrawingActivity;\n\npublic class DrawingSurface extends SurfaceView implements SurfaceHolder.Callback {\n    public static Boolean _run;\n    public static DrawThread thread;\n    public Canvas canvas = null;\n    private CommandManager commandManager;\n    //private Bitmap myBitmap;\n    private Bitmap mBitmap;\n\n    public DrawingSurface(Context context, AttributeSet attrs) {\n        super(context, attrs);\n\n        getHolder().addCallback(this);\n\n        commandManager = new CommandManager();\n        thread = new DrawThread(getHolder());\n    }\n\n    class DrawThread extends Thread{\n        private SurfaceHolder mSurfaceHolder;\n\n        public DrawThread(SurfaceHolder surfaceHolder){\n            mSurfaceHolder = surfaceHolder;\n\n        }\n\n        public void setRunning(boolean run) {\n            _run = run;\n        }\n\n        @Override\n        public void run() {\n            //Canvas canvas = null;\n            while (_run){\n\n                try{\n\n                    canvas = mSurfaceHolder.lockCanvas(null);\n                    if(mBitmap == null){\n                        mBitmap =  Bitmap.createBitmap (1, 1, Bitmap.Config.ARGB_8888);\n                    }\n\n                    final Canvas c = new Canvas (mBitmap);\n                    //canvas.drawColor(0, PorterDuff.Mode.CLEAR);\n                    c.drawColor(0, PorterDuff.Mode.CLEAR);\n                    canvas.drawColor(Color.WHITE); \n\n//                    Bitmap kangoo = BitmapFactory.decodeResource(getResources(),R.drawable.icon);\n//                      canvas.drawBitmap (kangoo, 0,  200,null);\n\n//                  works for logo                  \n//                  Bitmap kangoo = BitmapFactory.decodeResource(getResources(),R.drawable.icon);\n//                  c.drawBitmap (kangoo, 0,  200,null);\n\n                    if(!(DrawingActivity.imagePath==null)){\n                        c.drawBitmap(DrawingActivity.mBitmap, 0, 0, null);\n                    }\n                    commandManager.executeAll(c);\n                    canvas.drawBitmap (mBitmap, 0,  0,null);\n\n                } finally {\n                    mSurfaceHolder.unlockCanvasAndPost(canvas);\n                }\n            }\n        }\n    }\n\n    public void addDrawingPath (DrawingPath drawingPath){\n        commandManager.addCommand(drawingPath);\n    }\n\n    public boolean hasMoreRedo(){\n        return commandManager.hasMoreRedo();\n    }\n\n    public void redo(){\n        commandManager.redo();\n    }\n\n    public void undo(){\n        commandManager.undo();\n    }\n\n    public boolean hasMoreUndo(){\n        return commandManager.hasMoreRedo();\n    }\n\n    public Bitmap getBitmap(){\n        Bitmap kangoo = BitmapFactory.decodeResource(getResources(),R.drawable.resize_drawing_logo);\n        Bitmap myBitmap = addLogo(mBitmap, kangoo);\n        return myBitmap;\n    }\n\n    public void surfaceChanged(SurfaceHolder holder, int format, int width,  int height) {\n        // TODO Auto-generated method stub\n        mBitmap =  Bitmap.createBitmap (width, height, Bitmap.Config.ARGB_8888);;\n    }\n\n    public void surfaceCreated(SurfaceHolder holder) {\n        // TODO Auto-generated method stub\n            //thread.setRunning(true); // Edited By Shreyash\n            _run=true; //\n            thread.start();\n             // error at this line \n//          if(!thread.isAlive())            \n//               thread.start(); \n    }\n\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        // TODO Auto-generated method stub\n        boolean retry = true;\n        //thread.setRunning(false); //Edited By Shreyash\n        _run = false;\n        while (retry) {\n            try {\n                thread.join();\n                retry = false;\n            } catch (InterruptedException e) {\n                // we will try it again and again...\n            }\n        }\n    }\n    public static Bitmap addLogo(Bitmap mainImage, Bitmap logoImage) { // can add a 3rd parameter 'String loc' if you want to save the new image - left some code to do that at the bottom \n\n        Bitmap finalImage = null; \n        int width, height = 0; \n        width = mainImage.getWidth(); \n        height = mainImage.getHeight(); \n        finalImage = Bitmap.createBitmap(width, height, mainImage.getConfig()); \n        Canvas canvas = new Canvas(finalImage); \n        canvas.drawBitmap(mainImage, 0,0,null);\n        canvas.drawBitmap(logoImage, canvas.getWidth()-logoImage.getWidth() ,canvas.getHeight()-logoImage.getHeight() ,null);\n\n        return finalImage; \n    }\n\n\n}\n</code></pre>\n\n<p>I am creating the Object of this class in to another activity and do drawing.\nNow while i am going to another activity and then come back to this activity, then the error is occurs.</p>\n\n<p>Error log:</p>\n\n<pre><code>11-15 11:26:40.738: ERROR/AndroidRuntime(668): FATAL EXCEPTION: main\n11-15 11:26:40.738: ERROR/AndroidRuntime(668): java.lang.IllegalThreadStateException: Thread already started.\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at java.lang.Thread.start(Thread.java:1322)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at com.example.drawing.DrawingSurface.surfaceCreated(DrawingSurface.java:119)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.SurfaceView.updateWindow(SurfaceView.java:532)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.SurfaceView.onWindowVisibilityChanged(SurfaceView.java:206)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.View.dispatchWindowVisibilityChanged(View.java:3891)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:719)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:719)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:719)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:719)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:719)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewRoot.performTraversals(ViewRoot.java:744)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.view.ViewRoot.handleMessage(ViewRoot.java:1727)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.os.Handler.dispatchMessage(Handler.java:99)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.os.Looper.loop(Looper.java:123)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at android.app.ActivityThread.main(ActivityThread.java:4627)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at java.lang.reflect.Method.invokeNative(Native Method)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at java.lang.reflect.Method.invoke(Method.java:521)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)\n11-15 11:26:40.738: ERROR/AndroidRuntime(668):     at dalvik.system.NativeStart.main(Native Method)\n11-15 11:26:40.768: WARN/ActivityManager(60):   Force finishing activity com.example.drawing/.DrawingActivity\n11-15 11:26:41.338: WARN/ActivityManager(60): Activity pause timeout for HistoryRecord{450073d0 com.example.drawing/.DrawingActivity}\n</code></pre>\n\n<p>I donr know why i am getting this error.\nSo please help me to handle this thread.\nThanks.</p>\n"},{"tags":["wpf","multithreading","dispatcher","bitmapimage"],"answer_count":1,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":3903,"score":9,"question_id":4705726,"title":"XAML bind BitmapImage ViewModel property","body":"<p>I have problem with update listbox from view model class. I use Caliburn Micro framework. My scenario is here:</p>\n\n<p>I bind property of type bindableCollection on listbox:</p>\n\n<p><strong>Code from view model:</strong></p>\n\n<pre><code>private BindableCollection&lt;UserInfo&gt; _friends;\n\npublic BindableCollection&lt;UserInfo&gt; Friends\n{\n    get { return _friends; }\n    set\n    {\n        _friends= value;\n        NotifyOfPropertyChange(()=&gt;Friends);\n    }\n}\n</code></pre>\n\n<p>In view model I create fake service method wich return new fresh data as List and with this data I update property Friends which is bind on listbox.</p>\n\n<p>I call fake service method in dispatcher timer tick event every 3 seconds.</p>\n\n<pre><code> private static UserInfo FakeUser()\n        {\n            var user = new UserInfo\n            {\n                Age = \"16\",\n                Emphasis = true,\n                IdUser = \"11542\",\n                IsBlocked = false,\n                IsFriend = true,\n                LocationInfo = new Location\n                {\n                    CityName = \"TN\",\n                    IdCity = 123456,\n                    IdRegion = 1246,\n                    RegionName = \"TN\",\n                },\n                StatusInfo = new Status\n                {\n                    IdChat = 12,\n                    IsLogged = true,\n                    LastLogin = \"153151\",\n                    IsChating = true,\n                    RoomName = \"Car\",\n                },\n                ProjectStatusInfo = new ProjectStatus(),\n                IsIamFriend = true,\n                PlusInfo = new Plus(),\n                ProfilePhoto = new BitmapImage(new Uri(\"http://pokec.azet.sk/vanes90?i9=1f104a294997\", UriKind.RelativeOrAbsolute))\n\n            };\n\n            return user;\n        }\n\n        private static IEnumerable&lt;UserInfo&gt; GetFakeFriends()\n        {\n            var list = new List&lt;UserInfo&gt;();\n\n            for (int i = 0; i &lt; 20; i++)\n            {\n                list.Add(FakeUser());\n            }\n\n            return list;\n        }\n\n        private void DispatcherTimer_Tick(object sender, EventArgs eventArgs)\n        {\n            if (_isExecuting)\n                return;\n            _isExecuting = true;\n            new System.Threading.Tasks.Task(() =&gt;\n            {\n                var freshFriends = GetFakeFriends();\n\n                Execute.OnUIThread((System.Action)(() =&gt;\n                {\n                    Friends.Clear();\n                    foreach (var freshFriend in freshFriends)\n                    {\n                        Friends.Add(freshFriend);\n\n                    }\n                }));\n            }).Start();\n\n            _isExecuting = false;\n        }\n\n    }\n</code></pre>\n\n<p>If I don’t apply any style on listbox, it works good.</p>\n\n<p><strong>View:</strong></p>\n\n<pre><code>&lt;Grid&gt;\n    &lt;ListBox Name=\"Friends\"\n             Grid.Row=\"2\" \n             Margin=\"4,4,4,4\"&gt;\n    &lt;/ListBox&gt;\n&lt;/Grid&gt;\n</code></pre>\n\n<p>If I apply some style in which I bind property ProfilePhoto (typeof BitmapeImage) from UserInfo on listbox.</p>\n\n<p>Style is here:</p>\n\n<pre><code>        &lt;Style x:Key=\"friendsListStyle\" TargetType=\"{x:Type ListBox}\"&gt;\n            &lt;Setter Property=\"ItemTemplate\"&gt;\n                &lt;Setter.Value&gt;\n                    &lt;DataTemplate&gt;\n                        &lt;Grid Name=\"RootLayout\"&gt;\n                            &lt;Grid.ColumnDefinitions&gt;\n                                &lt;ColumnDefinition Width=\"0.3*\"&gt;&lt;/ColumnDefinition&gt;\n                                &lt;ColumnDefinition Width=\"*\"&gt;&lt;/ColumnDefinition&gt;\n                            &lt;/Grid.ColumnDefinitions&gt;\n                            &lt;Grid.RowDefinitions&gt;\n                                &lt;RowDefinition Height=\"60\"&gt;&lt;/RowDefinition&gt;\n                            &lt;/Grid.RowDefinitions&gt;\n                            &lt;Image Margin=\"4,4,4,2\" Source=\"{Binding Path=ProfilePhoto}\" Grid.Column=\"0\"/&gt;\n                        &lt;/Grid&gt;\n                    &lt;/DataTemplate&gt;\n                &lt;/Setter.Value&gt;\n            &lt;/Setter&gt;\n        &lt;/Style&gt;\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>Must create DependencySource on same Thread as the DependencyObject.\n\n   at System.Windows.Markup.XamlReader.RewrapException(Exception e, Uri baseUri)\n   at System.Windows.FrameworkTemplate.LoadTemplateXaml(XamlReader templateReader, XamlObjectWriter currentWriter)\n   at System.Windows.FrameworkTemplate.LoadTemplateXaml(XamlObjectWriter objectWriter)\n   at System.Windows.FrameworkTemplate.LoadOptimizedTemplateContent(DependencyObject container, IComponentConnector componentConnector, IStyleConnector styleConnector, List`1 affectedChildren, UncommonField`1 templatedNonFeChildrenField)\n   at System.Windows.FrameworkTemplate.LoadContent(DependencyObject container, List`1 affectedChildren)\n   at System.Windows.StyleHelper.ApplyTemplateContent(UncommonField`1 dataField, DependencyObject container, FrameworkElementFactory templateRoot, Int32 lastChildIndex, HybridDictionary childIndexFromChildID, FrameworkTemplate frameworkTemplate)\n   at System.Windows.FrameworkTemplate.ApplyTemplateContent(UncommonField`1 templateDataField, FrameworkElement container)\n   at System.Windows.FrameworkElement.ApplyTemplate()\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\n   at System.Windows.UIElement.Measure(Size availableSize)\n   at System.Windows.Controls.Border.MeasureOverride(Size constraint)\n</code></pre>\n\n<p>If I make another style on listbox / listbox item, in wich I bind only string or bool properties it works good.</p>\n\n<p>I have problem only if bind bitmapImage property.</p>\n\n<p>BitmapImage property is init as:</p>\n\n<pre><code>ProfilePhoto = new BitmapImage(new Uri(\"http://pokec.azet.sk/vanes90?i9=1f104a294997\", UriKind.RelativeOrAbsolute))\n</code></pre>\n\n<p>URI is url of picture or path to the file.</p>\n\n<p>What is wrong? Thank for help and advice.</p>\n\n<p>Style is good, it work only if I don’t refresh data with method call in another thread.</p>\n"},{"tags":["c#",".net","multithreading","c#-4.0","task-parallel-library"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12824609,"title":"WebClient Timing out when Scheduled in Task","body":"<p>Hey guys this is my first attempt at using the Task libraries in 4.0 so if you see anything else I'm besides my problem that is not correct please do let me know.</p>\n\n<p>My problem is that when I schedule a bunch of task which inside use a webclient to make a request, the first few make it through just fine, but after a certain time my webclient starts throwing an exception. It as if it creates the webclient then sticks in the Task and waits for a thread to pick it up but by that time the timeout time is reached .. that's just my assumption.</p>\n\n<p>Here is the code :</p>\n\n<blockquote>\n  <p>var TmsThread = Task.Factory.StartNew(() => UpdateTmsNullPackages(), TaskCreationOptions.LongRunning);</p>\n</blockquote>\n\n<p>that runs in the Form1_Load of the windows app. This is what it calls</p>\n\n<pre><code>public void UpdateTmsNullPackages()\n    {\n        Parallel.ForEach(TmsNullPackages, Package =&gt;\n        {\n            try\n            {\n                Task&lt;string&gt; task = Task.Factory.StartNew(() =&gt; Package.GetPackageTmsId(), TaskCreationOptions.AttachedToParent);\n                task.ContinueWith(t =&gt;\n                    {\n                        if (!String.IsNullOrEmpty(t.Result))\n                        {\n                            Package.TMSID = t.Result;\n                            NowTmsIdFoundPackages.Add(Package);\n                        }\n                    });\n            }\n            catch(Exception ex){}\n        });\n    }\n</code></pre>\n\n<p>which in turn, runs this</p>\n\n<pre><code> public static string GetPackageTmsId(this TwcPackage Package)\n    {\n        string TMSID = null;\n        if (!(String.IsNullOrEmpty(Package.movie_Provider)) &amp;&amp; !(String.IsNullOrEmpty(Package.movie_Product)) &amp;&amp; !(String.IsNullOrEmpty(Package.movie_Provider_ID)) &amp;&amp; !(String.IsNullOrEmpty(Package.movie_Asset_ID)))\n        {\n            try\n            {\n                using (WebClient client = new WebClient())\n                {\n                    client.Credentials = new NetworkCredential(TMSID_Recheck.Properties.Settings.Default.WebRequestUser, TMSID_Recheck.Properties.Settings.Default.WebRequestProdUserPassWord);\n                    XmlDocument xmlDoc = new XmlDocument();\n                    string URLToBeRequested = TMSID_Recheck.Properties.Settings.Default.RequestProdBaseURL + TMSID_Recheck.Properties.Settings.Default.RequestAPIVersion + \"/\" + TMSID_Recheck.Properties.Settings.Default.RequestAPIProgramServiceCall + TMSID_Recheck.Properties.Settings.Default.RequestAPIProgramAssociationServiceCall + Package.movie_Provider + ':' + Package.movie_Product + ':' + Package.movie_Provider_ID + \"::\" + Package.movie_Asset_ID;\n                    try\n                    {\n                        xmlDoc.LoadXml(client.DownloadString(URLToBeRequested));\n                        XmlNodeList Program = xmlDoc.DocumentElement.SelectNodes(\"program\");\n                        if (Program.Count &gt; 0) TMSID = Program[0].Attributes[\"TMSId\"].Value.ToString();\n                    }\n                    catch (WebException ex)\n                    {\n                        if (ex.Status != WebExceptionStatus.Timeout)\n                        {\n                            if (((HttpWebResponse)ex.Response).StatusCode != HttpStatusCode.NotFound) {  }\n                        }\n                        else {  }\n                    }\n                }\n            }\n            catch (Exception ix) {  }\n        }\n        return TMSID;\n    }\n</code></pre>\n\n<p>the issue happens when downloadstring is called after a couple hundred tasks it throws a timeout exception.</p>\n"},{"tags":["c#","performance","concurrency","multithreading","threadpool"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1217,"score":4,"question_id":1958524,"title":"Limiting concurrent threads equal to number of processors?","body":"<p>Are there any benefits to limiting the number of concurrent threads doing a given task to equal the number of processors on the host system?  Or better to simply trust libraries such as .NET's ThreadPool to do the right thing ... even if there are 25 different concurrent threads happening at any one given moment?</p>\n"},{"tags":["c++","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":115,"score":3,"question_id":12579538,"title":"Do I need to add a lock on a function that returns a copy of a container?","body":"<pre><code>class Manager {\npublic:\n\n    list&lt;Employee&gt; getEmployees() {\n        // Do I need to lock here?\n        return emps_;\n    }\n    void addEmp(Employee emp); //Here I have lock\nprivate:\n    list&lt;Employee&gt; emps_;\n};\n</code></pre>\n\n<p>Instance <code>Manager</code> is shared between multiple threads.\nDo I need to add lock to the <code>getEmployees</code> member function?</p>\n\n<p>I am pretty sure that i need a lock since the complete list is copied , so any modification that will be done in the meantime (until copy will finished )  can break the copy operation.</p>\n\n<p>I am just asking this because i got few opinion that there is no need to lock.</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>Since its clear now that need to lock , my question is how to do this with minimum overhead. \nBy doing below solution you copy the list twice.:</p>\n\n<pre><code>list&lt;Employee&gt; getEmployees() {\n    pthread_mutex_lock( &amp;mutex1 );\n    list&lt;Emp&gt; tmp  = emps_; //Copy 1 \n    pthread_mutex_unlock( &amp;mutex1 );\n    return tmp;//Copy 2\n}\n</code></pre>\n"}]}
{"total":30059,"page":16,"pagesize":100,"questions":[{"tags":["ruby","multithreading","watir"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12820891,"title":"Multithreading using watir","body":"<p>I have created multiple threads, each thread will test using <a href=\"http://watir.com/\" rel=\"nofollow\">watir</a>-browser, I can see that once a thread creates a browser using:\nWatir::Browser.new\nRest threads gets blocked at this statement. Any clue?</p>\n"},{"tags":["multithreading","memory","garbage-collection","jvm","solaris"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":8002007,"title":"Why an application would create 31 \"GC task thread\" in one Solaris box while only 2 in another box","body":"<p>I saw in one application (java) which has irregular memory usage in a Solaris box. When I took a thread dump, I saw there were 31 \"GC task thread\"...</p>\n\n<p>This is very strange as in other Solaris box, same application only had 2 \"GC task thread\".</p>\n\n<p>Wondered if anybody know, under which circumstance, the jvm will create so many GC task threads and could this cause memory issue?</p>\n\n<p>Any ideas is appreciated. </p>\n\n<p>Some more background on my case:\nEach time I will have two similar Java applications running at the same time in same box. I will keep sending requests to application A , and no request to application B. So, app B should be in-active. And it is alway \"sleep\" when using prstat.</p>\n\n<p>Strange thing is, in one Solaris box, app B keeps consuming memory while app A is processing request. And in app B's thread dump, I can see 31 GC task threads.\nAnd in another Solaris box, app B is normal, the memory is normal and only 2 GC task threads.</p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["multithreading","mongodb","memory-leaks","jruby"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12819735,"title":"Memory Leaks in Jruby 1.7.0.preview1","body":"<p>i have a jruby application which starts 200 Threads (Jruby 1.7.0.preview1). Each thread parsed a xml document and save the complex data in several mongodb collections. I'm using the Java Mongo Driver (version 2.7.3) to store data in mongodb. \nMy JVM options for the applications are as followed:</p>\n\n<pre><code>-J-Djruby.thread.pooling=true -J-Xmn512m -J-Xms4096m -J-Xmx4096m -J-XX:+UseConcMarkSweepGC -J-XX:CMSInitiatingOccupancyFraction=45 -J-XX:ParallelGCThreads=1 -J-XX:+DisableExplicitGC -J-XX:+PrintGCDetails -J-XX:+PrintGCTimeStamps -J-Xloggc:/LOGPATH/gc.log -J-Dsun.rmi.dgc.client.gcInterval=60000 -J-Dsun.rmi.dgc.server.gcInterval=60000\n</code></pre>\n\n<p>So everytime the threads are working and saving data in the specific collections my heapsize is on the limit of 4GB very fast. I've made a test with the jmap command and found out that many objects of java.util.LinkedHashMap were created (something about 1.300.000). \nI don't know if i can reduce the amount of this kind of objecttype.</p>\n\n<p>Is there maybe a known issue with LinkedHashMaps and Memory Leaks in Jruby ?</p>\n\n<p>Can anyone help me with this problem? </p>\n\n<p>Thx\nChris</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12632996,"title":"Thread pool with ServletContextListener","body":"<p>I want to run some simple background process calculations but I can't seem to figure it out. No matter what I do, it blocks.</p>\n\n<pre><code>public class WorkThreadManagerContextLoaderListener implements ServletContextListener {\n    private Runnable runnable;\n    private WorkManager workManager;\n\n    @Override\n    public void contextInitialized(ServletContextEvent event) {\n        final WebApplicationContext springContext = WebApplicationContextUtils.getWebApplicationContext(event.getServletContext());\n        workManager = (WorkManager) springContext.getBean(\"workThreadManager\");\n\n        runnable = new WorkThreadManagerStartUp(WorkManager);\n\n        runnable.run();\n    }\n\n    @Override\n    public void contextDestroyed(ServletContextEvent event) {\n        workManager.shutDown();\n    }\n}\n</code></pre>\n\n<p>The reason why WorkThreadManagerStartUp exist is because I don't want it to block so I made it a Runnable type and when run() is called, it starts up an ExecutorService:</p>\n\n<pre><code>public class UnitOfWorkThreadManagerStartUp implements Runnable {\n    private WorkManager workManager;\n\n    public UnitOfWorkThreadManagerStartUp(WorkManager workManager) {\n        this.workManager = workManager;\n    }\n\n    @Override\n    public void run() {\n        workManager.startUp();\n    }\n}\n\npublic class WorkThreadManager implements WorkManager {\n    @Autowired\n    private WorkService workService;\n\n    private final int availableProcessors = Runtime.getRuntime().availableProcessors();\n    private final ExecutorService executorService = Executors.newFixedThreadPool(4 * availableProcessors);\n\n    @Override\n    public void startUp() {\n        // this method always blocks...\n    }\n}\n</code></pre>\n\n<p>But my solution doesn't work as expected. I'm running on Tomcat 7.0.30.</p>\n\n<p>What I'm trying to figure out is how I can start a thread pool in the background without stopping the web app from deploying because currently it can never fully come online due to startUp() always blocking. I'd like to simplify this solution and possibly removing WorkThreadManagerStartUp class if it's not really needed.</p>\n\n<p>EDIT:</p>\n\n<p>I modified the start up class</p>\n\n<pre><code>public class WorkThreadManagerStartUp implements Runnable {\n    private WorkManager workManager;\n\n    public WorkThreadManagerStartUp(WorkManager workManager) {\n        this.workManager = workManager;\n    }\n\n    @Override\n    public void run() {\n    try {\n        while (true) {\n                System.out.println(\"Hello World!\");\n                Thread.sleep(1000 * 10);\n            }\n        } catch(InterruptedException e) {\n            System.out.println(e.getMessage());\n        }\n    }\n}\n</code></pre>\n\n<p>Although this is suppose to run on it's own thread, Hello World! displays multiple times as expected but does not allow the web app to come online.</p>\n"},{"tags":["java","multithreading","concurrency","scheduling"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":11605555,"title":"First-come-first-served policy for shared resource","body":"<p>An exam question:</p>\n\n<blockquote>\n  <p>A resource is shared between N threads such that access is on a first-come-first-served basis. Explain how you would implement a policy of first-come-first-served.</p>\n</blockquote>\n\n<p>My answer would be along the lines of (Note: the course is Java-based):</p>\n\n<blockquote>\n  <p>Use a semaphore (binary) to control access to the shared resource. Then create a feeder class/thread to access the semaphore. The feeder thread uses a FIFO queue to implement first-come-first-served. When the semaphore is free it allows the thread a the head of the queue to access the shared resource.</p>\n</blockquote>\n\n<p>I have just jotted out on paper the above approach and it seems to work.</p>\n\n<p>The question is worth 8 marks in a 20 mark question so I doubt using <code>new ReentrantLock(true)</code> would suffice for full marks.</p>\n\n<p>What do you guys think?</p>\n"},{"tags":["c#","multithreading","httpwebrequest"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12820034,"title":"Httpwebrequest + threading = Time out?","body":"<p>Im threading the following function and when i run more than 10ish threads i start getting a bunch of time outed connections.. </p>\n\n<p>Ive added <code>_wReq.ServicePoint.ConnectionLimit = 100;</code> to the method and also added\nthe following to my app.config</p>\n\n<pre><code>  &lt;system.net&gt;\n&lt;connectionManagement&gt;\n  &lt;add address = \"*\" maxconnection = \"200\" /&gt;\n&lt;/connectionManagement&gt;\n</code></pre>\n\n<p></p>\n\n<p>Here is the method:</p>\n\n<pre><code>        public string websocket(string proxy, string URL)\n    {\n        string _html = \"\";\n        HttpWebResponse _wResp = null;\n\n        try\n        {\n            HttpWebRequest _wReq;\n            System.Text.ASCIIEncoding _enc = new System.Text.ASCIIEncoding();\n            _wReq = (HttpWebRequest)HttpWebRequest.Create(URL);\n            _wReq.UserAgent = \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\";\n            _wReq.Accept = \"*/*\";\n            _wReq.Method = \"GET\";\n            _wReq.CookieContainer = cookieJarf;\n            _wReq.ServicePoint.ConnectionLimit = 100;\n            _wReq.KeepAlive = false;\n            _wReq.Timeout = 5000;\n            _wReq.ReadWriteTimeout = 5000;\n            _wReq.Pipelined = true;\n\n            if (proxy != \"\")\n            {\n                WebProxy myproxy = new WebProxy(proxy);\n                _wReq.Proxy = myproxy;\n            }\n\n            _wResp = (HttpWebResponse)_wReq.GetResponse();\n            Encoding responseEncoding = Encoding.GetEncoding(_wResp.CharacterSet);\n            using (StreamReader sr = new StreamReader(_wResp.GetResponseStream(), responseEncoding))\n            {\n                _html = sr.ReadToEnd();\n            }\n\n            cookieJarf = _wReq.CookieContainer;\n            _wResp.Close();\n        }\n        catch (WebException wexc1)\n        {\n            MessageBox.Show(wexc1.Message); // Time out exception when running more than 10 threads\n\n            if (wexc1.Status == WebExceptionStatus.ProtocolError)\n            {\n                return \"\";\n            }\n\n        }\n        finally\n        {\n            if (_wResp != null)\n                _wResp.Close();\n        }\n\n        return _html;\n    }\n</code></pre>\n\n<p>Im not out of ideas of what i should try :/ Surely it has to be possible to run for example 50 httpwebrequests at the same time?</p>\n\n<p>Edit: It should be said that some of these threaded connections are to the same server and some other to different ones.. Im basically using this method for my threaded crawler.</p>\n\n<p>Edit 1:</p>\n\n<p>Am adding my threads like this after a button click:</p>\n\n<pre><code>                foreach (string item in urlQueue)\n                {\n                    _smartThreadPool.QueueWorkItem(\n                        new Amib.Threading.Func&lt;string, int, int, string, int&gt;(checkURL),\n                        item, iia, 5000, kryptonTextBox1.Text);\n\n                    iia++;\n                }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":93,"score":0,"question_id":12819676,"title":"Problems related to mutexes in Java","body":"<p>I'm trying to understand the concept of multithread programming. I know the concept of deadlock and mutexes but i cannot find an answer to the following question. How the problem of deadlock can arise when mutexes are used? </p>\n"},{"tags":["python","multithreading","multiprocessing","openerp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12820248,"title":"What happens to running threads after forking?","body":"<p>I'm using OpenERP, a Python based ERP, which uses different threads (one-thread per client, etc). I would like to use multiprocessing.Process() to fork() and call a long-running method.</p>\n\n<p>My question is: what will happen to the parent's threads? Will they be copied and continue to run? Will the child process call accept() on the server socket?</p>\n\n<p>Thanks for your answers,</p>\n"},{"tags":["c#","multithreading","methods","progress-bar"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12812725,"title":"Method accessed by more than one thread in C# Using Progressbar","body":"<p>I have multiple threads accessing a method. </p>\n\n<p>That method updates the progress bar on the form as the threads execute.</p>\n\n<p>That method updates the progress bar on my windows form showing the progress of the processed files as the threads are completing them. </p>\n\n<p>How would you go about managing that method to avoid deadlocks. Im having trouble locking it, dont know if im doing it wrong, or if i should lock it in this case.</p>\n\n<pre><code>public void myWorkerClass()\n        {\n            int amountToScan = 4;\n\n            lblcount.BeginInvoke(\n               ((Action)(() =&gt; lblcount.Text = \"Files Checked \" + atPDFNumber.ToString() + \" of \" + amountToScan.ToString())));\n\n            decimal percentageComplete = ((decimal)atPDFNumber / (decimal)amountToScan) * 100;\n\n            backgroundWorker1.ReportProgress((int)percentageComplete);\n\n        }\n</code></pre>\n\n<p>What happens is, that at the last line, it breaks telling me that \"This operation has already had OperationCompleted called on it and further calls are illegal.\"</p>\n\n<p>I take it that im opening something that has already been disposed by the first thread or something like that.</p>\n\n<p>Is this a good way to go about using the progress bar with multiple threads (do i have the right idea or principle), or is there just a small error in my code?</p>\n\n<p>How I want to make this question valuable for other people is to answer with this question how global variables can be accessed inside a method that's being accessed by multiple threads. \nsince i take it thats the direction this question is going in.</p>\n"},{"tags":["java","android","multithreading","live-wallpaper"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12758703,"title":"IllegalArgumentException in unlockCanvasAndPost (android live wallpaper)","body":"<p>I've created my first live wallpaper implementing drawing in a separate thread. So now I have a WallpaperService and my WallpaperPainter who does the job. The problem is that I getting a <code>IllegalArgumentException</code> in <code>unlockCanvasAndPost</code> method on some of devices (Samsung Note is the one). I've read all recomendations I could find but couldn't fix that bug. Seems like the <code>unlockCanvasAndPost</code> is called when surface is destroyed so canvas is invalid. Here is the essential parts of code:</p>\n\n<p>In wallpaper service:\n</p>\n\n<pre><code>    @Override\n    public void onSurfaceChanged(SurfaceHolder holder, int format, int width,\n            int height) {\n        super.onSurfaceChanged(holder, format, width, height);\n        painting.setSurfaceSize(width, height);\n    }\n\n    @Override\n    public void onSurfaceCreated(SurfaceHolder holder) {\n        super.onSurfaceCreated(holder);\n        painting.start();\n    }\n\n    @Override\n    public void onSurfaceDestroyed(SurfaceHolder holder) {\n        boolean retry = true;\n        painting.stopPainting();\n        while (retry) {\n            try {\n                painting.join();\n                retry = false;\n            } catch (InterruptedException e) { }\n        }\n        super.onSurfaceDestroyed(holder);\n    }\n</code></pre>\n\n<p>In the painting thread:</p>\n\n<pre><code>public void stopPainting() {\n    this.run = false;\n    synchronized(this) {\n        this.notify();\n    }\n}\n\npublic void run() {\n    this.run = true;\n    Canvas c = null;\n    while (run) {\n        try {\n            synchronized (this) {\n                Thread.sleep(50);\n                c = this.surfaceHolder.lockCanvas();\n                doDraw(c);\n            }\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            if (c != null) {\n                this.surfaceHolder.unlockCanvasAndPost(c); // &lt;&lt; -- HERE IS THE PROBLEM\n            }\n        }\n        // if pause...\n        synchronized (this) {\n            if (wait) {\n                try {\n                    wait();\n                } catch (Exception e) { }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Can anyone give me any clue what I'm doing wrong? I'm new both for Java and Android.</p>\n"},{"tags":["java","multithreading","swing"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":616,"score":2,"question_id":4242853,"title":"updating label text dynamically in Java Swing","body":"<p>I am creating a simple download manager in Java swing...!\nI have used different threads for different tasks in the download manager.</p>\n\n<p>Thread1-> main\nThread2-> downloadSpeedTracker\nThread3-> SwingUIRendrer</p>\n\n<p>In this application I am calculating the download speed by creating a thread in class downloadSpeedTracker and I am recalculating this speed after every second. I have created Thread3 in SwingUIRendrer class. Now I want to send this calculated speed to my SwingUIRendrer class.</p>\n\n<p>I want to continuously update this calculated speed on the SwingUI.\n How do I achieve this...?</p>\n\n<hr>\n\n<p>@Mohamed:</p>\n\n<pre><code>public void setUI(int speed)\n{\n    JLabel l1= new JLabel(\"Speed :\"+speed);\n    wind.add(l1); \n    wind.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); \n    wind.setSize(200, 60);\n}\n</code></pre>\n\n<p>I am calling the <code>SetUI</code> method in a while loop. Everytime the method is called, a new value for speed is sent to it; but when I run the program, the speed is getting overwritten on the earlier displyed speed. I want to clear the earlier value of speed from the UI and then write the new one.</p>\n"},{"tags":["c++","c","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":194,"score":0,"question_id":12802812,"title":"Threading in C/C++, any standard?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3402916/basic-multi-threading-in-c-c-hints-advice-tutorial-some-direction\">Basic multi-threading in C / C++ &mdash; hints, advice, tutorial, some direction?</a>  </p>\n</blockquote>\n\n\n\n<p>I would like to start using threads and learn about threading in C/C++.</p>\n\n<p>Is there any standard library? else which are the most used or which would you recommend for a beginner in threading?</p>\n"},{"tags":["java","multithreading","concurrency","thread-safety"],"answer_count":5,"favorite_count":11,"up_vote_count":23,"down_vote_count":0,"view_count":7182,"score":23,"question_id":5173399,"title":"Are non-synchronised static methods thread safe if they don't modify static class variables?","body":"<p>I was wondering if you have a static method that is 'not' synchronised, but does 'not' modify any static variables is it thread-safe? What about if the method creates local variables inside it? For example, is the following code thread-safe?</p>\n\n<pre><code>public static String[] makeStringArray( String a, String b ){\n    return new String[]{ a, b };\n}\n</code></pre>\n\n<p>So if I have two threads calling ths method continously and concurrently, one with dogs (say \"great dane\" and \"bull dog\") and the other with cats (say \"persian\" and \"siamese\") will I ever get cats and dogs in the same array? Or will the cats and dogs never be inside the same invocation of the method at the same time?</p>\n"},{"tags":["multithreading","delphi","critical-section","static-array"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":131,"score":1,"question_id":12818411,"title":"Delphi static array thread safety only with critical section","body":"<p>I have a Win32 Thread (no TThread) that runs alle the time and iterates over a static array. The mainthread can modify fields of the array. What is the best way to make this thread-safe <strong>without components like TThreadList</strong> (for a no-vcl application), only with Windows Critical Sections (TRTLCriticalSection)?</p>\n\n<p>Code:</p>\n\n<pre><code>type\n  T = record\n    Idx: Integer;\n    Str: string;\n    Num: Real;\n    Enabled: Boolean;\n  end;\n\nvar\n  A: Array[0..9] of T;\n  Cnt: Integer;\n  CS: TRTLCriticalSection;\n\nprocedure thread;\nvar\n  I: Integer;\nbegin\n  while True do\n  begin\n    for I := Low(A) to High(A) do\n    begin\n      if A[I].Enabled then\n      begin\n        //modify some fields from A[I]\n\n        Inc(A[I].Idx);\n        if A[I].Idx &gt;= 10 then\n        begin\n          A[I].Enabled := False;\n          InterlockedDecrement(Cnt);\n        end;\n      end;\n    end;\n    if Cnt = 0 then Sleep(1);\n  end;\nend;\n\nprocedure Add(...); //called only from mainthread\n\n  function GetFreeField: Integer;\n  begin\n    for Result := Low(A) to High(A) do\n      if not A[Result].Enabled then Exit;\n    Result := -1;\n  end;\n\nvar\n  I: Integer;\nbegin\n  I := GetFreeField;\n  if I = -1 then Exit;\n\n  //set fields A[I]\n\n  A[I].Enabled := True;\n  InterlockedIncrement(Cnt);\nend;\n</code></pre>\n\n<p>At the beginning the array is initialized with enabled = false and cnt = 0.</p>\n\n<p>Is the following modification sufficient?</p>\n\n<pre><code>procedure thread;\nvar\n  I: Integer;\nbegin\n  while True do\n  begin\n    for I := Low(A) to High(A) do\n    begin\n      EnterCriticalSection(CS);\n      if A[I].Enabled then\n      begin\n        LeaveCriticalSection(CS);\n        //modify some fields from A[I]\n\n        Inc(A[I].Idx);\n        if A[I].Idx &gt;= 10 then\n        begin\n          EnterCriticalSection(CS);\n          A[I].Enabled := False;\n          LeaveCriticalSection(CS);\n\n          InterlockedDecrement(Cnt);\n        end;\n      end\n      else\n        LeaveCriticalSection(CS);\n    end;\n    if Cnt = 0 then Sleep(1);\n  end;\nend;\n\nprocedure Add(...); //called only from mainthread\nvar\n  I: Integer;\nbegin\n  I := GetFreeField;\n  if I = -1 then Exit;\n\n  //set fields A[I]\n\n  EnterCriticalSection(CS);\n  A[I].Enabled := True;\n  LeaveCriticalSection(CS);\n\n  InterlockedIncrement(Cnt);\nend;\n</code></pre>\n"},{"tags":[".net","wpf","multithreading","c#-4.0","culture"],"answer_count":4,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":900,"score":12,"question_id":5144314,"title":"In .Net: best way for keeping CurrentCulture on new Thread?","body":"<p>In a .Net 4.0 <strong>WPF</strong> project, we need to keep the same CurrentCulture on each thread then we have on the main thread.</p>\n\n<p>Given, we can initialize a new thread's culture with code like the following:</p>\n\n<ol>\n<li><p>Keep the information in a variable (context)</p>\n\n<pre><code>context.CurrentCulture = Thread.CurrentThread.CurrentCulture;\ncontext.CurrentUICulture = Thread.CurrentThread.CurrentUICulture;\n</code></pre></li>\n<li><p>On the new thread, initialize from the saved context</p>\n\n<pre><code>Thread.CurrentThread.CurrentCulture = context.CurrentCulture;\nThread.CurrentThread.CurrentUICulture = context.CurrentUICulture;\n</code></pre></li>\n</ol>\n\n<p>But in this age of TPL, async programming and lambda delegates, it does not feel right.</p>\n\n<p>And yes, we actually can change the culture while the application is running, but that is another story.</p>\n\n<p>Do you know of any setting, property or config we should initialize to keep track?</p>\n"},{"tags":["java","multithreading","concurrency","readline"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":12818341,"title":"BufferedReader readline when reading in a thread","body":"<p>I'm new to concurrent programming in java.</p>\n\n<p>I need to read, analyze and process an extremely fast growing logfile, so I got to be\nfast.\nMy idea was to read the file (line by line) and upon matching a relevant line I want to\npass those lines to separate threads that can do further processing on the line.\nI called these threads \"IOThread\" in the following example code.</p>\n\n<p>My problem is that the BufferedReader readline in IOthread.run() apparently never returns.\nWhat is a working way to read the Stream inside the thread?\nAre there any better approaches than the one below?</p>\n\n<pre><code>import java.io.BufferedReader;\nimport java.io.FileReader;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.PipedInputStream;\nimport java.io.PipedOutputStream;\n\nclass IOThread extends Thread {\n    private InputStream is;\n    private int t;\n\n    public IOThread(InputStream is, int t)  {\n        this.is = is;\n        this.t = t;\n        System.out.println(\"iothread&lt;\" + t + \"&gt;.init\");\n    }\n\n    public void run() {\n        try {\n            System.out.println(\"iothread&lt;\" + t + \"&gt;.run\");\n            String line;\n\n            BufferedReader streamReader = new BufferedReader(new InputStreamReader(is));\n            while ((line = streamReader.readLine()) != null) {\n                System.out.println(\"iothread&lt;\" + t + \"&gt; got line \" + line);\n            }\n            System.out.println(\"iothread \" + t + \" end run\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\npublic class Stm {\n    public Stm(String filePath) {\n        System.out.println(\"start\");\n\n        try {\n            BufferedReader reader = new BufferedReader(new FileReader(filePath));\n\n            PipedOutputStream po1 = new PipedOutputStream();\n            PipedOutputStream po2 = new PipedOutputStream();\n            PipedInputStream pi1 = new PipedInputStream(po1);\n            PipedInputStream pi2 = new PipedInputStream(po2);\n            IOThread it1 = new IOThread(pi1,1);\n            IOThread it2 = new IOThread(pi2,2);\n\n            it1.start();\n            it2.start();\n//          it1.join();\n//          it2.join();\n\n            String line;\n            while ((line = reader.readLine()) != null) {\n                System.out.println(\"got line \" + line);\n\n                if (line.contains(\"aaa\")) {\n                    System.out.println(\"passing to thread 1: \" + line);  \n                    po1.write(line.getBytes());\n                } else if (line.contains(\"bbb\")) {\n                    System.out.println(\"passing to thread 2: \" + line);  \n                    po2.write(line.getBytes());\n                }\n            }\n            reader.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void main(String[] args) {\n        new Stm(args[0]);\n    }\n\n}\n</code></pre>\n\n<p>An example input file would be:</p>\n\n<pre><code>line 1\nline 2\nline 3 aaa ...\nline 4\nline 5 bbb ...\nline 6 aaa ...\nline 7\nline 8 bbb ...\nline 9 bbb ...\nline 10\n</code></pre>\n\n<p>Call the above code with the filename of the input file as argument.</p>\n"},{"tags":["c++","multithreading","tbb"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12818493,"title":"Calling and executing function on a different thread","body":"<p>Let's say, that I have a program code like this:</p>\n\n<pre><code>    #include &lt;iostream&gt;  \n    #include &lt;Windows.h&gt;\n\n    #include &lt;tbb/tbb.h&gt;\n\n\n    void SomeFunction()\n    {\n            // do something\n    }        \n\n    void MyThread(int arg)\n    {\n        std::cout &lt;&lt; \"This is a thread function\\n\" &lt;&lt; std::endl;\n\n        for (int i = 0; i &lt; 10000; i++)\n        {\n            arg++;\n            Sleep(1);\n        }\n\n            SomeFunction();\n    }\n\n    int main ()\n    {\n        tbb::tbb_thread pMyThread = tbb::tbb_thread(MyThread, 3);\n\n        pMyThread.join();\n\n        return 0;\n    }\n</code></pre>\n\n<p>From the above  we can see that main() is calling MyThread() on a different thread pMyThread. And MyThread() is calling SomeFunction(). Now, will SomeFunction() (or any other function which is called by MyThread()) be executed on pMyThread too? Thanks.</p>\n"},{"tags":["c++","c","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12817549,"title":"C++: How to run a system command N times (async) and get N execution times back?","body":"<p>I'm new to C++ and have not used any threading in C++ yet. I'm on windows 7 using visual studio 2010.</p>\n\n<p>What I'm trying to do is write a main method that triggers N executions of a given system command and for each execution it is able to acquire the time taken for that particular execution on completion. It would also be nice to know if the command succeeded or failed through getting the return code for that command and as a bonus getting the output back would be nice although not essential initially.</p>\n\n<p>Now I know how to do most of this but given that I need to spawn N executions at the same time and given that each execution is likely to be long running I'm guessing it will need a thread per execution and this is what I'm not sure how to do.</p>\n\n<p>For someone new to C++ threading would you please choose a threading implementation and library that you'd like to recommend and give me an example main method of how to do the above? I will be reading on C++ threading too subsequently (if you have any pointers on resources please let me know). Many thanks.</p>\n"},{"tags":[".net","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":1527,"score":8,"question_id":2223656,"title":"What does MethodImplOptions.Synchronized do?","body":"<p>What does MethodImplOptions.Synchronized do? </p>\n\n<p>Is the code below</p>\n\n<pre><code>[MethodImpl(MethodImplOptions.Synchronized)]\npublic void Method()\n{\n   MethodImpl();\n}\n</code></pre>\n\n<p><strong>equivalent</strong> to </p>\n\n<pre><code>public void Method()\n{\n   lock(this)\n    {\n       MethodImpl();\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","sockets","mfc","casyncsocket"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12817369,"title":"CAsyncSocket and thread / process safety","body":"<p>I have some legacy code using a <a href=\"http://msdn.microsoft.com/en-us/library/3d46645f%28v=vs.80%29.aspx\" rel=\"nofollow\">CAsyncSocket</a> derived class. This class overrides <code>OnReceive</code> and it also has a wrapper around SendTo. The code is in a dll which multiple applications will be using on the same PC, all ports are hard coded. </p>\n\n<p>I'm guessing that I need to provide synchronization in the form of a named mutex (CMutex in MFC) class bit I'm not sure. </p>\n\n<p>Should I lock a named mutex in the OnReceive and a different named mutex in the Send methods of CMyAsyncSocket? </p>\n\n<p>Do I need synchronization at all or will the MFC CAsyncSocket do that for me? Worried about accessing a socket on multiple processes.</p>\n"},{"tags":["c#","multithreading","class","methods"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":83,"score":3,"question_id":12776344,"title":"How to use multiple threads of the same class in C#","body":"<p>I have a class with a bunch of methods in. For example</p>\n\n<pre><code>     private int forFunction(String exceptionFileList, FileInfo z, String compltetedFileList, String sourceDir)\n        {\n            atPDFNumber++;\n            exceptionFileList = \"\";\n            int blankImage = 1;\n            int pagesMissing = 0;\n\n            //delete the images currently in the folder\n            deleteCreatedImages();\n            //Get the amount of pages in the pdf\n            int numberPDFPage = numberOfPagesPDF(z.FullName);\n\n            //Convert the pdf to images on the users pc\n            convertToImage(z.FullName);\n\n            //Check the images for blank pages\n            blankImage = testPixels(@\"C:\\temp\", z.FullName);\n\n            //Check if the conversion couldnt convert a page because of an error\n            pagesMissing = numberPDFPage - numberOfFiles;\n}\n</code></pre>\n\n<p>Now what im trying now is to access that class in a thread.. but not just one thread, maybe about 5 threads to speed up processing, since one is a bit slow.</p>\n\n<p>Now in my mind, thats going to be chaos... i mean one thread changing variables while the other thread is busy with them etc etc, and locking each and every variable in all of those methods... not going to have a good time...</p>\n\n<p>So what im proposing, and dont know if its the right way.. is this</p>\n\n<pre><code>  public void MyProc()\n    {\n      if (this method is open, 4 other threads must wait)\n    {\n      mymethod(var,var);\n    }\n     if (this method is open, 4 other threads must wait and done with first method)\n    {\n      mymethod2();\n    }\n  if (this method is open, 4 other threads must wait and done with first and second method)\n       {\n          mymethod3();\n    }\n         if (this method is open, 4 other threads must wait and done with first and second and third method)\n        {\n          mymethod4();\n        }\n    }\n</code></pre>\n\n<p>Would this be the right way to approach the problem of multiple threads accessing multiple methods at the same time?</p>\n\n<p>Those threads will only access the Class 5 times, and no more,  since the work load will be equally divided.</p>\n"},{"tags":["c#",".net","multithreading","timer"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":612,"score":3,"question_id":10170448,"title":"How to invoke an UI method from another thread","body":"<p>Playing round with Timers. \nContext: a winforms with two labels. </p>\n\n<p>I would like to see how <code>System.Timers.Timer</code> works so I've not used the Forms timer. \nI understand that the form and myTimer will now be running in different threads.\nIs there an easy way to represent the elapsed time on <code>lblValue</code> in the following form?</p>\n\n<p>I've looked here on <a href=\"http://msdn.microsoft.com/en-us/library/ms171728%28v=vs.80%29.aspx\" rel=\"nofollow\">MSDN</a> but is there an easier way !</p>\n\n<p>Here's the winforms code:</p>\n\n<pre><code>using System.Timers;\n\nnamespace Ariport_Parking\n{\n  public partial class AirportParking : Form\n  {\n    //instance variables of the form\n    System.Timers.Timer myTimer;\n    int ElapsedCounter = 0;\n\n    int MaxTime = 5000;\n    int elapsedTime = 0;\n    static int tickLength = 100;\n\n    public AirportParking()\n    {\n        InitializeComponent();\n        keepingTime();\n        lblValue.Text = \"hello\";\n    }\n\n    //method for keeping time\n    public void keepingTime() {\n\n        myTimer = new System.Timers.Timer(tickLength); \n        myTimer.Elapsed += new ElapsedEventHandler(myTimer_Elapsed);\n\n        myTimer.AutoReset = true;\n        myTimer.Enabled = true;\n\n        myTimer.Start();\n    }\n\n\n    void myTimer_Elapsed(Object myObject,EventArgs myEventArgs){\n\n        myTimer.Stop();\n        ElapsedCounter += 1;\n        elapsedTime += tickLength; \n\n        if (elapsedTime &lt; MaxTime)\n        {\n            this.lblElapsedTime.Text = elapsedTime.ToString();\n\n            if (ElapsedCounter % 2 == 0)\n                this.lblValue.Text = \"hello world\";\n            else\n                this.lblValue.Text = \"hello\";\n\n            myTimer.Start(); \n\n        }\n        else\n        { myTimer.Start(); }\n\n    }\n  }\n}\n</code></pre>\n"},{"tags":["iphone","ios","multithreading","cocos2d-iphone","cocos2d-x"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12816854,"title":"where can i find good tutorial/examples for multithreading on mobile game development?","body":"<p>I am a beginner in game development in cocos2Dx and couldnt find the techniques for multithreading in game development.What are the possible ways or areas to apply multithreading and what are the common ways of applying it.And are there any good tutorials examples about applying effectively applying multithreading to games in mobile app development.\nAnd What are the common techniques of multithreading in cocos2dx?.</p>\n"},{"tags":["java","multithreading","design-patterns","data-mining","hpc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12815073,"title":"Huge data processing/ HPC in Java - suggest me how to begin","body":"<p>I am thinking to work on a programming problem for which, I suppose, I will need to know a lot of advanced programming concepts. For some reasons I have decided to code it in Java - even though I am not proficient in it.\nSo I want you to help me with suggestions, guidance, pointers to resources, books, tutorials or any generic advises that you think is pertinent.</p>\n\n<p>Here is the basic <strong>nature of my problem:</strong></p>\n\n<ol>\n<li><p>I need to create a <strong>client-server architecture</strong>. Server supports multiple concurrent clients. Clients send it simple instructions (may be server exposes some kind of API/ runs listener on specific port), server executes the instructions and send result back to client.</p></li>\n<li><p>The main job of the server is to do huge volume of data processing based on the instructions given to it. It takes data from backend database/ file systems. Data volume can easily surge up to ~ <strong>200GB - 700GB</strong>. Data will be usually streamed to it, but it may require to hold huge volume of data in memory cache during processing (and if RAM is not enough, then page it to disk). Computations are generally <strong>numerically intensive</strong> in nature (let's say taking the inverse of a matrix)</p></li>\n<li><p>The server should be able to do <strong>multithreading</strong> (I don't know what this term mean in Java, what I wish is, the server should be able to distribute the job in multiple parallel sub-processes.)</p></li>\n<li><p>The server itself should be very lightweight. I <strong>Do NOT need any GUI</strong> Interface.</p></li>\n<li><p>It will be great if I design it in a way so that I can integrate it later with HPC frameworks like <strong>Hadoop</strong>.</p></li>\n</ol>\n\n<p>Now if I got to do this, what kind of programming do I need to learn? By the way, I have good understanding on OOP, I am somewhat familiar with Data Structures and algorithms, I know basic Java (never done any network or multithreaded programming in Java before, but have used <em>typical oop concepts, generics, comparable interfaces etc.</em>). I basically work in <em>database programming</em>, but have also done lot of C, C++, C#, Python in the past.</p>\n\n<p>Given the requirement and my background, please suggest,</p>\n\n<ol>\n<li>How should I begin to work on this project? What is the way to architect the project?</li>\n<li>Should I create some basic API definitions first and then start working on the details? </li>\n<li>Should I follow any particular design pattern? Where to learn them from?</li>\n<li>What are the things I need to learn in Java and where to learn them from?</li>\n<li>What is the best way to read huge data in memory? Is Java nio good solution? </li>\n<li>If I instantiate a class with huge amount of data, would it work? (example, let's say I have a Vector class to represent a matrix with millions of elements and the constructor of the class reads huge data set in the memory). What's the best way to handle that?</li>\n</ol>\n"},{"tags":["c++","c","arrays","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":136,"score":4,"question_id":12801862,"title":"Problems passing array by reference to threads","body":"<p>I'm learning threading and I've found some simple examples.</p>\n\n<p>What I'm hoping to do is create 5 threads, that each assign a random number to an array of 20 int's.  Then finally have another 5 threads that reconstruct this array to a larger 100 sized int.</p>\n\n<p>Here's some prior code I was trying.  I was hoping to be able to pass an array by reference, with no luck.</p>\n\n<p>Any ideas would be appreciated, please keep in mind, I'm completely new to threads</p>\n\n<pre><code>#include &lt;process.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;time.h&gt;\n//#include &lt;thread&gt;\n\nusing namespace std;\n\nvoid myThread (void *dummy );\nvoid myThread2 (void *dummy );\n\nint main()\n{\n\n    ofstream myfile;\n    myfile.open (\"coinToss.csv\");\n\n    int rNum;\n\n    long numRuns;\n    long count = 0;\n    int divisor = 1;\n    float holder = 0;\n    int counter = 0;\n    float percent = 0.0;\n\n    int array1[1000000];\n    int array2[1000000];\n\n\n    srand ( time(NULL) );\n\n    printf (\"Runs (use multiple of 10)? \");\n    cin &gt;&gt; numRuns;\n\n    for (int i = 0; i &lt; numRuns; i++)\n    {\n        _beginthread( myThread, 0, (void *) (array1) );\n        _beginthread( myThread2, 0, (void *) (array2) );\n\n    }\n\n}\n\nvoid myThread (void *param )\n{\n    int i = *(int *)param;\n\n    for (int x = 0; x &lt; 1000000; x++)\n    {\n        //param[x] = rand() % 2 + 1;\n        i[x] = rand() % 2 + 1;\n    }\n\n}\n\nvoid myThread2 (void *param )\n{\n    int i[1000000] = *(int *)param;\n\n    for (int = 0; x &lt; 1000000; x++)\n    {\n        i[x] = rand() % 2 + 1;\n    }\n\n}\n</code></pre>\n"},{"tags":["java","mysql","multithreading","loops"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":74,"score":4,"question_id":12816750,"title":"create multiple java threads in a while loop depending on the number of inputs","body":"<p>i am trying to write a java programm that is reading informations out of a database and creates for every row of the table a new thread. So i dont know how much threads i will need. so far i have this:</p>\n\n<pre><code>        con = DriverManager.getConnection(url, user, passwd);\n        pst = con.prepareStatement(\"select hostname, ipadress, vncpassword from infoscreens\");\n        rs = pst.executeQuery();\n        int i=0;\n        while (rs.next()) {\n            i++;\n            Thread tread[i]  = new Savescreenshots(rs.getString(1),rs.getString(3),rs.getString(2));\n            tread[i].start();\n        }\n</code></pre>\n\n<p>but the problem is that this isnt working. i need a possibility to create for each row in the table a new thread. dose anyone have an idea how to do that</p>\n\n<p>thanks and greetings</p>\n"},{"tags":["java","multithreading","connection-pooling","sftp","jsch"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12780036,"title":"Using connection pool with JSCH","body":"<p>I'm using JSCH for file upload ever sftp. In it's current state each thread opens and closes connection when needed. </p>\n\n<p>If it possible to use connection pooling with JSCH in order to avoid overhead caused by large number of connection opening and closing?</p>\n\n<p>Here is a example of function called from inside of thread</p>\n\n<pre><code> public static void file_upload(String filename) throws IOException {\n    JSch jsch = new JSch();\n    Session session = null;\n    try {\n        session = jsch.getSession(\"user\", \"server_name\", 22);\n        session.setConfig(\"StrictHostKeyChecking\", \"no\");\n        session.setPassword(\"super_secre_password\");\n        session.connect();\n\n        Channel channel = session.openChannel(\"sftp\");\n        channel.connect();\n        ChannelSftp sftpChannel = (ChannelSftp) channel;\n\n        FileInputStream inputSrr = new FileInputStream(filename);  \n        try {  \n            sftpChannel.put(inputSrr, \"/var/temp/\"+filename);  \n        } catch (SftpException e) {  \n            e.printStackTrace();  \n\n        } finally {  \n            if (inputSrr != null) {  \n                inputSrr.close();  \n            }  \n        }  \n\n        sftpChannel.exit();\n        session.disconnect();\n    } catch (JSchException e) {\n        e.printStackTrace();\n    } catch (SftpException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre>\n"},{"tags":["java","linux","multithreading","shell","java-ee"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":112,"score":3,"question_id":12773108,"title":"Java multithread vs Shell script","body":"<p>If i have 3 tasks that i want to run all of them simultaneously, there are two ways i'm thinking of right now.</p>\n\n<p>Since i'm running the program in linux, i could do it in shell script.</p>\n\n<blockquote>\n<pre><code>  java Task1 &amp;\n  java Task2 &amp;\n  java Task3 &amp;\n</code></pre>\n</blockquote>\n\n<p>or, i could use one java program to spawn three child threads to do the tasks.</p>\n\n<p>I want to know which way is more efficient. I doubt the shell way will create multiple JVM instance?</p>\n"},{"tags":["java","multithreading","tomcat6","executorservice"],"answer_count":2,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":127,"score":8,"question_id":12815614,"title":"Shutdown ExecutorService gracefully in webapp?","body":"<p>In my webapp, I created a service that is using an <code>ExecutorService</code> with fixed size ThreadPool. I reuse the same <code>ExecutorService</code> during the whole application lifetime. </p>\n\n<pre><code>private static ExecutorService pool = Executors.newFixedThreadPool(8);\n</code></pre>\n\n<p>All is running in Tomcat which gives me the following error while shuting down: </p>\n\n<pre><code>appears to have started a thread named [pool-1-thread-1] but has failed to stop it. This is very likely to create a memory leak.\n</code></pre>\n\n<p>I do realize I need to shutdown the ExecutorService before shuting tomcat down. Soms SO thread already speak about this but I could not find a clean way to handle this.</p>\n\n<p>Should I use a <code>ShutdownHook</code> as suggested @Tim-bender in <a href=\"http://stackoverflow.com/questions/3332832/graceful-shutdown-of-threads-and-executor\">Graceful shutdown of threads and executor</a> ? Or should I use a CachedThreadPool instead?</p>\n"},{"tags":["c++","multithreading","stdasync"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12811426,"title":"std::async doesn't seem to spawn thread with std::launch::async","body":"<p>I am writing a DCPU-16 emulator and I am calculating the real time clock speed of the CPU by launching a thread that calls the function getRealTimeCPUClock() in a separate thread.  The problem is it seems that the future object's \"valid\" attribute is true even when it has not returned a value.  As a result, when calling futureObj.get(), it then waits for getRealTimeCPUClock() to return.  </p>\n\n<p>With a launch policy of async (as opposed to deferred) isn't it supposed to launch the function into the background and then when it returns set the valid attribute to true?  </p>\n\n<p>Is this the wrong usage?</p>\n\n<pre><code>int getRealTimeCPUClock() {\n    int cyclesBeforeTimer = totalCycles;\n    sleep(1);\n\n    return totalCycles - cyclesBeforeTimer;\n}\n\nvoid startExecutionOfProgram(char *programFileName)\n{\n    size_t lengthOfProgramInWords = loadProgramIntoRAM(programFileName);\n    auto futureRealTimeClockSpeed = std::async(std::launch::async, getRealTimeCPUClock);\n\n    while(programCounter &lt; lengthOfProgramInWords) {\n\n        if(futureRealTimeClockSpeed.valid()) {\n            realTimeClockSpeed = futureRealTimeClockSpeed.get();\n            futureRealTimeClockSpeed = std::async(std::launch::async, getRealTimeCPUClock);\n        }\n        step(); \n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","interrupt"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12797670,"title":"Efficient threading scheme","body":"<p>I'm writing a java GUI that performs certain operations through the serial port. Since I don't want it to block while waiting for a response I figured having a thread do it was a better way, but now I'm faced with two options and I don't know which would be more efficient:</p>\n\n<ul>\n<li>Case 1: Create a single thread for each asynchronous task.</li>\n<li>Case 2: Keep a single thread sleeping and have it perform different tasks by changing an atomic integer's value and then interrupting it.</li>\n</ul>\n\n<p>None of these operations will be processor intensive, but I still wonder if it's wise to keep a thread in memory permanently.</p>\n"},{"tags":["python","multithreading","variables","thread-sleep"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12808721,"title":"Threading parameters","body":"<p>Again a question from me.. having some issues again. Hope to find someone who's a lot smarter and knows this.. :D</p>\n\n<p>I'm now having the issue with threading that when opening threading urls in a range of (1,1000), I would love to see actually all the different urls. Only when i run the code i get a lot of double variables (probably because the crawls go that fast). Anyway this is my code: I try to see at which Thread it is, but I get doubles.</p>\n\n<pre><code>import threading\nimport urllib2\nimport time\nimport collections\n\nresults2 = []\ndef crawl():\n    var_Number = thread.getName().split(\"-\")[1]\n    try:\n        data = urllib2.urlopen(\"http://www.waarmaarraar.nl\").read()\n        results2.append(var_Number)\n    except:\n        crawl()\n\nthreads = []\n\nfor n in xrange(1, 1000):\n    thread = threading.Thread(target=crawl)\n    thread.start()  \n    threads.append(thread)\n\n# to wait until all three functions are finished\nprint \"Waiting...\"\n\nfor thread in threads:\n    thread.join()\n\nprint \"Complete.\"\n\n# print results (All numbers, should be 1/1000)\nresults2.sort()\nprint results2    \n# print doubles (should be [])\nprint [x for x, y in collections.Counter(results2).items() if y &gt; 1]\n</code></pre>\n\n<p>However, if I add time.sleep(0.1) directly under the xrange line, those doubles will not occur. Although this does slow my programm down a lot. Anyone knows a better way to fix this?</p>\n"},{"tags":["java","multithreading"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12815299,"title":"How to give delay in java progrramming?","body":"<p>I want to draw number of rectangles one after another using a specific time .\nI use thread.sleep() method but it is directly stop working of thread and not resume.</p>\n"},{"tags":["multithreading","operating-system","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":12797741,"title":"Can a thread be created from another thread?","body":"<p>I want to know whether one thread can invoke another thread, like how one process can start another process.</p>\n"},{"tags":["c","multithreading","unix"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":59,"score":-5,"question_id":12813070,"title":"How to compile C program with threads in gcc?","body":"<p>What option do I need to use with gcc in order to get rid of errors ?</p>\n"},{"tags":["android","multithreading","bluetooth","uuid","android-logcat"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":132,"score":0,"question_id":12714101,"title":"android-Application crash when thread.start() called. App using AndroidPlot API","body":"<p>I am building an app to plot dynamic values which are recieved via bluetooth. Since im new to android, I used the tutorial <a href=\"http://developer.android.com/guide/topics/connectivity/bluetooth.html\" rel=\"nofollow\">on the android developers guide</a> but the application crashes when it tries accessing the Thread.start() method. Here is the code and I could not post the LogCat since my emulator does not support Bluetooth. Here is the code.\n<strong>MainActivity.java</strong></p>\n\n<pre><code>package com.example.enose.sensor;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.util.LinkedList;\nimport java.util.Set;\nimport java.util.UUID;\n\nimport android.app.Activity;\nimport android.bluetooth.BluetoothAdapter;\nimport android.bluetooth.BluetoothDevice;\nimport android.bluetooth.BluetoothSocket;\nimport android.content.Context;\nimport android.graphics.Color;\nimport android.os.Bundle;\nimport android.os.Handler;\nimport android.os.Message;\nimport android.os.MessageQueue;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport com.androidplot.xy.BoundaryMode;\nimport com.androidplot.xy.LineAndPointFormatter;\nimport com.androidplot.xy.LineAndPointRenderer;\nimport com.androidplot.xy.SimpleXYSeries;\nimport com.androidplot.xy.XYPlot;\npublic class MainActivity extends Activity {\n    @Override\n    protected void onStop() {\n        // TODO Auto-generated method stub\n        super.onStop();\n        }\n\n    private static final int HISTORY_SIZE = 30;\n    public static final int MESSAGE_READ = 0;\n    private XYPlot aprHistoryPlot = null;\n    private SimpleXYSeries alcohol=null;\n    private SimpleXYSeries lpg=null;\n    private SimpleXYSeries methane=null;\n    private SimpleXYSeries quality=null;\n    private LinkedList&lt;Number&gt; alcoholHistory;\n    private LinkedList&lt;Number&gt; lpgHistory;\n    private BluetoothAdapter mBluetoothAdapter;\n    //private UUID uid;\n    //Thread to initiate connection\n    private class ConnectThread extends Thread {\n        private final BluetoothSocket mmSocket;\n        private final BluetoothDevice mmDevice;\n        public ConnectThread(BluetoothDevice device) {\n            // Use a temporary object that is later assigned to mmSocket,\n            // because mmSocket is final\n            BluetoothSocket tmp = null;\n            mmDevice = device;\n\n            // Get a BluetoothSocket to connect with the given BluetoothDevice\n            try {\n\n                tmp = device.createRfcommSocketToServiceRecord(UUID.fromString(\"0000110100001000800000805F9B34FB\"));\n            } catch (IOException e) { }\n            mmSocket = tmp;\n        }\n\n        public void run() {\n            // Cancel discovery because it will slow down the connection\n            mBluetoothAdapter.cancelDiscovery();\n\n            try {\n                // Connect the device through the socket. This will block\n                // until it succeeds or throws an exception\n                mmSocket.connect();\n            } catch (IOException connectException) {\n                // Unable to connect; close the socket and get out\n                try {\n                    mmSocket.close();\n                } catch (IOException closeException) { }\n                return;\n            }\n\n            // Do work to manage the connection (in a separate thread)\n            //manageConnectedSocket(mmSocket);\n        }\n        public void manageConnectedSocket(BluetoothSocket socket)\n        {\n            ConnectedThread data=new ConnectedThread(socket);\n            data.start();\n        }\n        /** Will cancel an in-progress connection, and close the socket */\n        public void cancel() {\n            try {\n                mmSocket.close();\n            } catch (IOException e) { }\n        }\n    }\n    public class ConnectedThread extends Thread {\n        private final BluetoothSocket mmSocket;\n        private final InputStream mmInStream;\n        private final OutputStream mmOutStream;\n\n        public ConnectedThread(BluetoothSocket socket) {\n            mmSocket = socket;\n            InputStream tmpIn = null;\n            OutputStream tmpOut = null;\n\n            // Get the input and output streams, using temp objects because\n            // member streams are final\n            try {\n                tmpIn = socket.getInputStream();\n                tmpOut = socket.getOutputStream();\n            } catch (IOException e) { }\n\n            mmInStream = tmpIn;\n            mmOutStream = tmpOut;\n        }\n\n        public void run() {\n            byte[] buffer = new byte[1024];  // buffer store for the stream\n            int bytes; // bytes returned from read()\n            // Keep listening to the InputStream until an exception occurs\n            while (true) {\n                try {\n                    // Read from the InputStream\n                    bytes = mmInStream.read(buffer);\n                    // Send the obtained bytes to the UI activity\n                //    h.obtainMessage(MESSAGE_READ,bytes,-1,buffer)\n                  //          .sendToTarget();\n\n                } catch (IOException e) {\n                    break;\n                }\n            }\n        }\n\n        /* Call this from the main activity to send data to the remote device */\n        public void write(byte[] bytes) {\n            try {\n                mmOutStream.write(bytes);\n            } catch (IOException e) { }\n        }\n\n        /* Call this from the main activity to shutdown the connection */\n        public void cancel() {\n            try {\n                mmSocket.close();\n            } catch (IOException e) { }\n        }\n    }\n    private LinkedList&lt;Number&gt; methaneHistory;\n    {\n        alcoholHistory = new LinkedList&lt;Number&gt;();\n        lpgHistory = new LinkedList&lt;Number&gt;();\n        methaneHistory = new LinkedList&lt;Number&gt;();\n\n        alcohol = new SimpleXYSeries(\"Alcohol\");\n        lpg = new SimpleXYSeries(\"LPG\");\n        methane = new SimpleXYSeries(\"Methane\");\n        quality = new SimpleXYSeries(\"Air Quality\");\n    }\n    private class MyHandler extends Handler\n    {\n\n        @Override\n        public void handleMessage(Message msg) {\n            // TODO Auto-generated method stub\n            super.handleMessage(msg);\n            int val=msg.arg1;\n            byte[] d=(byte[]) msg.obj;\n            Double s1;\n            s1=Double.longBitsToDouble(val);\n            alcoholHistory.addLast(s1);\n            if(alcoholHistory.size()&gt;30)\n                alcoholHistory.removeFirst();\n            alcohol.setModel(alcoholHistory,SimpleXYSeries.ArrayFormat.Y_VALS_ONLY);\n            aprHistoryPlot.redraw();\n        }\n\n    }\n    //MyHandler h;\n    private BluetoothDevice selDevice;\n    private Context context;\n    private BluetoothSocket tmp;\n    private ConnectThread connect;\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Handler h=new Handler();\n        context=this;\n        setContentView(R.layout.activity_main);\n        aprHistoryPlot = (XYPlot) findViewById(R.id.aprHistoryPlot);\n        alcoholHistory.addFirst(2);\n        lpgHistory.addFirst(3);\n        methaneHistory.addFirst(4);\n        alcoholHistory.addFirst(3);\n        lpgHistory.addFirst(2);\n        methaneHistory.addFirst(1);\n\n        alcohol.setModel(alcoholHistory, SimpleXYSeries.ArrayFormat.Y_VALS_ONLY);\n        lpg.setModel(lpgHistory, SimpleXYSeries.ArrayFormat.Y_VALS_ONLY);\n        methane.setModel(methaneHistory, SimpleXYSeries.ArrayFormat.Y_VALS_ONLY);\n        aprHistoryPlot.setRangeBoundaries(0, 5,BoundaryMode.FIXED);\n        aprHistoryPlot.setDomainBoundaries(0, 30, BoundaryMode.FIXED);\n        aprHistoryPlot.addSeries(alcohol, LineAndPointRenderer.class, new LineAndPointFormatter(Color.rgb(0, 100, 200), Color.BLACK,null));\n        aprHistoryPlot.addSeries(lpg, LineAndPointRenderer.class, new LineAndPointFormatter(Color.rgb(100, 200, 100), Color.BLACK,null));\n        aprHistoryPlot.addSeries(methane, LineAndPointRenderer.class, new LineAndPointFormatter(Color.rgb(200, 100, 100), Color.BLACK,null));\n        aprHistoryPlot.setDomainStepValue(1);\n        aprHistoryPlot.setTicksPerRangeLabel(3);\n        aprHistoryPlot.setDomainLabel(\"time\");\n        aprHistoryPlot.getDomainLabelWidget().pack();\n        aprHistoryPlot.setRangeLabel(\"level\");\n        aprHistoryPlot.getRangeLabelWidget().pack();\n        aprHistoryPlot.disableAllMarkup();\n        mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();\n        if (mBluetoothAdapter == null) {\n            // Device does not support Bluetooth\n            Toast.makeText(context, \"Not supported\", Toast.LENGTH_LONG).show();\n        }\n        else{\n            //Toast.makeText(context, \"test1\", Toast.LENGTH_SHORT).show();\n        if (!mBluetoothAdapter.isEnabled()) {\n            mBluetoothAdapter.enable();\n         // Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);\n         //   startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);\n        }\n        Toast.makeText(context, \"test2\", Toast.LENGTH_SHORT).show();\n        Set&lt;BluetoothDevice&gt; devices=mBluetoothAdapter.getBondedDevices();\n        boolean isDeviceSet=false;\n        if(devices==null)\n        {\n            Toast.makeText(context, \"No paired devices\", Toast.LENGTH_LONG).show();\n\n        }\n        else\n        {\n            //Toast.makeText(context, \"test3\", Toast.LENGTH_SHORT).show();\n            //BluetoothDevice dev=mBluetoothAdapter.getRemoteDevice(\"006645ffly477\");\n            for (BluetoothDevice device : devices) {\n                // Add the name and address to an array adapter to show in a ListView\n                //mArrayAdapter.add(device.getName() + \"\\n\" + device.getAddress());\n                selDevice=device;\n                isDeviceSet=true;\n                //TextView tv=(TextView) findViewById(R.id.txtlist);\n                //tv.setText(\"Bluetooth device \"+selDevice.getName()+\" selected\");\n                break;\n                }\n        Message msg=h.obtainMessage();\n        //uid=new UUID(7659464,976328762);\n        //Toast.makeText(context, \"test4\", Toast.LENGTH_SHORT   ).show();\n            //connect=new ConnectThread(dev);\n            //connect.run();\n            //dev=mBluetoothAdapter.getRemoteDevice(\"006645ffly477\");\n            //if(dev!=null)\n                //Toast.makeText(context, \"device null\", Toast.LENGTH_SHORT).show();\n            //else\n\n        //connect=new ConnectThread(selDevice);\n          //    connect.run();\n            }\n        }\n        }\n    }\n</code></pre>\n\n<p><strong>AndroidManifest.xml</strong></p>\n\n<pre><code>&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.example.enose.sensor\"\n    android:versionCode=\"1\"\n    android:versionName=\"1.0\" &gt;\n\n    &lt;uses-sdk\n        android:minSdkVersion=\"5\"\n        android:targetSdkVersion=\"10\" /&gt;\n    &lt;uses-permission android:name=\"android.permission.BLUETOOTH\" /&gt;\n\n    &lt;application\n        android:icon=\"@drawable/ic_launcher\"\n        android:label=\"@string/app_name\" &gt;\n        &lt;activity\n            android:name=\".MainActivity\"\n            android:label=\"@string/title_activity_main\" &gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n                &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n    &lt;/application&gt;\n\n&lt;/manifest&gt;  \n</code></pre>\n\n<p><strong>activity_main.xml</strong></p>\n\n<pre><code>&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" &gt;\n\n    &lt;com.androidplot.xy.XYPlot\n    android:id=\"@+id/aprHistoryPlot\"\n    android:layout_width=\"fill_parent\"\n    android:layout_height=\"200dp\"\n    android:layout_marginTop=\"10px\"\n    android:layout_marginLeft=\"10px\"\n    android:layout_marginRight=\"10px\"\n    title=\"eNose Readings\"/&gt;\n    &lt;TextView \n        android:id=\"@+id/txtlist\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentBottom=\"true\"/&gt;\n&lt;/RelativeLayout&gt; \n</code></pre>\n\n<p><strong>Logcat</strong></p>\n\n<pre><code>10-04 16:09:01.508: E/InputDispatcher(62): channel '4074d648 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Consumer closed input channel or an error occurred.  events=0x8\n10-04 16:09:01.508: E/InputDispatcher(62): channel '4074d648 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Channel is unrecoverably broken and will be disposed!\n10-04 16:12:09.808: E/InputDispatcher(62): channel '405ecbb8 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Consumer closed input channel or an error occurred.  events=0x8\n10-04 16:12:09.808: E/InputDispatcher(62): channel '405ecbb8 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Channel is unrecoverably broken and will be disposed!\n10-04 21:11:42.588: E/InputDispatcher(62): channel '405a9a88 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Consumer closed input channel or an error occurred.  events=0x8\n10-04 21:11:42.588: E/InputDispatcher(62): channel '405a9a88 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Channel is unrecoverably broken and will be disposed!\n10-04 21:11:57.488: E/InputDispatcher(62): channel '40746548 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Consumer closed input channel or an error occurred.  events=0x8\n10-04 21:11:57.488: E/InputDispatcher(62): channel '40746548 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Channel is unrecoverably broken and will be disposed!\n10-04 21:39:31.018: E/InputDispatcher(62): channel '4061f108 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Consumer closed input channel or an error occurred.  events=0x8\n10-04 21:39:31.018: E/InputDispatcher(62): channel '4061f108 com.example.enose.sensor/com.example.enose.sensor.MainActivity (server)' ~ Channel is unrecoverably broken and will be disposed!\n</code></pre>\n\n<p>If this cannot work. Can someone post an easy tutorial on connecting via bluetooth to a device with a known MAC address?\nAnd also can someone explain the process of getting a UUID and its use?</p>\n"},{"tags":["c++","arrays","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12810472,"title":"c++ multithread array","body":"<p>i'm doing something for fun, trying to learn multithreading\n<a href=\"http://stackoverflow.com/questions/12801862/problems-passing-array-by-reference-to-threads\">Problems passing array by reference to threads</a></p>\n\n<p>but Arno pointed out that my threading via process.h wasn't going to be multi-threaded.</p>\n\n<p>What I'm hoping to do is something where I have an array of 100 (or 10,000, doesn't really matter I don't think), and split up the assignment of values to each thread.  Example, 4 threads = 250 values per thread to be assigned.</p>\n\n<p>Then I can use this filled array for further calculations.</p>\n\n<p>Here's some code I was working on (which doesn't work)</p>\n\n<pre><code>#include &lt;process.h&gt;\n#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;fstream&gt;\n#include &lt;time.h&gt;\n//#include &lt;thread&gt;\n\nusing namespace std;\n\nvoid myThread (void *dummy );\n\nCRITICAL_SECTION cs1,cs2; // global\n\nint main()\n{\n\n    ofstream myfile;\n    myfile.open (\"coinToss.csv\");\n\n    int rNum;\n\n    long numRuns;\n    long count = 0;\n    int divisor = 1;\n    float holder = 0;\n    int counter = 0;\n    float percent = 0.0;\n\n    HANDLE hThread[1000];\n\n\n    int array[10000];\n\n    srand ( time(NULL) );\n\n    printf (\"Runs (use multiple of 10)? \");\n    cin &gt;&gt; numRuns;\n\n    for (int i = 0; i &lt; numRuns; i++)\n    {\n        //_beginthread( myThread, 0, (void *) (array1) );\n        //???\n        //hThread[i * 2] = _beginthread( myThread, 0, (void *) (array1) );\n        hThread[i*2] = _beginthread( myThread, 0, (void *) (array) );\n\n    }\n     //WaitForMultipleObjects(numRuns * 2, hThread, TRUE, INFINITE);\n     WaitForMultipleObjects(numRuns, hThread, TRUE, INFINITE);\n\n}\n\nvoid myThread (void *param )\n{\n    //thanks goes to stockoverflow\n    //http://stackoverflow.com/questions/12801862/problems-passing-array-by-reference-to-threads\n    int *i = (int *)param;\n\n    for (int x = 0; x &lt; 1000000; x++)\n    {\n        //param[x] = rand() % 2 + 1;\n        i[x] = rand() % 2 + 1;\n    }\n\n}\n</code></pre>\n\n<p>Can anyone explain why it isn't working?</p>\n"},{"tags":["python","multithreading","gil"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":219,"score":6,"question_id":8994438,"title":"When are Python threads fast?","body":"<p>We're all aware of the horrors of the <a href=\"http://en.wikipedia.org/wiki/Global_Interpreter_Lock\">GIL</a>, and I've seen a lot of discussion about the right time to use the <code>multiprocessing</code> module, but I still don't feel that I have a good intuition about when threading in Python (focusing mainly on CPython) is the right answer.</p>\n\n<p>What are instances in which the GIL is not a significant bottleneck?  What are the types of use cases where threading is the most appropriate answer?</p>\n"},{"tags":["android","multithreading","nullpointerexception","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12810846,"title":"android Websocket socket.io nullpointer","body":"<pre><code>theButton = (Button) findViewById(R.id.button5);\n\nclient = new SocketIOClient(URI.create(\"http://192.168.0.157:8080\"), new SocketIOClient.Handler() {\n        @Override\n        public void onConnect() {\n            Log.e(\"WS\", \"Connected!\");\n        }\n\n        @Override\n        public void on(String event, JSONArray arguments) {\n\n        theButton.setBackgroundColor(Color.BLACK);\n            Log.e(\"WS\", \"Got event \"+event+\":\"+arguments.toString());\n        }\n\n        @Override\n        public void onDisconnect(int code, String reason) {\n\n            Log.e(\"WS\", \"Disconnected! Code: \"+code+\" Reason:\"+reason);\n        }\n\n        @Override\n        public void onError(Exception error) {\n            Log.e(\"WS\", \"+++ Error +++\"+error);\n        }\n    });\n\n    client.connect();\n</code></pre>\n\n<p>The Problem is, if I Change the BackgroundColor in the Event Funktion I get a NullPointer exeption: </p>\n\n<p><code>E/AndroidRuntime(16409): FATAL EXCEPTION: Thread-11864\nE/AndroidRuntime(16409): java.lang.NullPointerException\nE/AndroidRuntime(16409):    at com.fritsch.cpu.SocketIOClient.cleanup(SocketIOClient.java:183)\nE/AndroidRuntime(16409):    at com.fritsch.cpu.SocketIOClient.access$0(SocketIOClient.java:181)\nE/AndroidRuntime(16409):    at com.fritsch.cpu.SocketIOClient$2.onError(SocketIOClient.java:152)\nE/AndroidRuntime(16409):    at com.fritsch.cpu.WebSocketClient$1.run(WebSocketClient.java:125)\nE/AndroidRuntime(16409):    at java.lang.Thread.run(Thread.java:856)\n</code></p>\n\n<p>If I change the BG Color after initial it works fine. I think the Problem is the Thread of the Websocket. But I have no idea how to fix it. </p>\n\n<p>Pls help :) thx</p>\n"},{"tags":["java","multithreading","resources"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":67,"score":-1,"question_id":12808795,"title":"Making my resource manager be \"deadlock-free\"","body":"<p>My program has a condition to be deadlock-free. \nThe ResourceManager give clients in \n<code>(Set&lt;ResourceNames, long ID&gt;)</code>\n to write/read (boolean true/false). \nthat is a method  <code>static long getLock(Set&lt;String&gt; resources, boolean operation)</code> \nand  <code>static void releaseLock(long ID)</code>.</p>\n\n<p>All of the resource is 1-1. IfF the resource is engage for write, that resource is not applicable for another target. If for read, other clients can get for only read, write not.\nThe resource names is Strings.While the ResourceManager can not gice the resource for the client it has to block in the getlock() method and return when the resources are avaliable for the client.</p>\n\n<p>The getlock() method is engage a resource, and create an ID, and the relaselock() method is emancipate the resources from ID. My task is to write the ResourceManager, and it will be Deadlock-free.</p>\n\n<p>The Client class create k client for random operation and resources, and start this. That class is written, but i can't see it.\nMy task is to write a class, and these two methods.</p>\n\n<p>-And the problem is to block the client and return!\n-DeadLock - free</p>\n\n<pre><code>package itself.probafeladat14;\n\nimport java.util.HashMap;\nimport java.util.LinkedList;\nimport java.util.Random;\nimport java.util.Set;\n\npublic class ResourceManager {\n\n    protected static HashMap&lt;String, Boolean&gt; reservedResources = \n            new HashMap&lt;String, Boolean&gt;();\n    protected static HashMap&lt;Long, Set&lt;String&gt;&gt; resourcesByID = \n            new HashMap&lt;Long, Set&lt;String&gt;&gt;();\n    protected static LinkedList&lt;Long&gt; sequenceOfID =\n            new LinkedList&lt;Long&gt;();\n\n\n\n    public static void releaseLock(long ID) {\n        boolean read = false;\n        Set&lt;String&gt; resources = resourcesByID.remove(ID);\n        sequenceOfID.remove(ID);\n\n        for (String str : resources)\n            if (reservedResources.containsKey(str)) {\n                if (reservedResources.get(str) == true)\n                    reservedResources.remove(str);\n                else if (reservedResources.get(str) == false) {\n                    for (long i : sequenceOfID)\n                        if (resourcesByID.get(i).contains(str))\n                            read = true;\n                    if (!read)\n                        reservedResources.remove(str);\n                    read = false;\n                }\n            }\n    }\n\n\n    public static long getLock(Set&lt;String&gt; resources, boolean operation) throws ResourceNotAvaliableException {\n\n        boolean isFree = true;\n        boolean uniqueID = false;\n        long ID = 0;\n\n        for (String str : resources) {\n            if (reservedResources.containsKey(str)) {\n                if (reservedResources.get(str) ) {\n                    isFree = false;\n                }\n                if (reservedResources.get(str) == false &amp;&amp; \n                        operation == true) {\n                    isFree = false;\n                }\n            }\n        }\n\n        if ( !isFree )\n            throw new ResourceNotAvaliableException();\n        else {\n            for (String s : resources)\n                if (!reservedResources.containsKey(s))\n                    reservedResources.put(s, operation);\n            while (!uniqueID) {\n                ID = new Random().nextLong();\n                if (!sequenceOfID.contains(ID))\n                    uniqueID = true;\n            }\n            sequenceOfID.addLast(ID);\n            resourcesByID.put(ID, resources);\n            return ID;\n        }\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","java-7","volatile","java-6","incompatibility"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":35,"score":3,"question_id":12810627,"title":"Incompatibility with Java 7","body":"<p>For the life of me, I cannot figure out why this program does not work in Java 7. I've run it with no problems in using Java 6, but as soon as I run it with Java 7, it doesn't work.</p>\n\n<pre><code>import java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\nimport javax.swing.*;\n\npublic class HelloWorld implements ActionListener {\n\nJButton button;\nboolean state;\n\npublic HelloWorld(){\n    init();\n    state = false;\n    System.out.println(\"state - \"+state);\n\n    while (true){\n        if (state == true){\n            System.out.println(\"Success\");\n        }\n    }\n}\n\nprivate void init(){\n    JFrame frame = new JFrame();\n    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n    button = new JButton(\"Button\");\n    button.addActionListener(this);\n    frame.add(button);\n    frame.pack();\n    frame.setVisible(true);\n}\n\n@Override\npublic void actionPerformed(ActionEvent e) {\n    JButton source = (JButton)e.getSource();\n\n    if (source == button){\n        state = !state;\n        System.out.println(\"state - \"+state);\n    }\n}\n\n/**\n * @param args the command line arguments\n */\npublic static void main(String[] args) {\n    new HelloWorld();\n}\n\n}\n</code></pre>\n\n<p>Using Java 6, if I press the button, it will print out the phrase \"Success\" until I hit the button again. Using Java 7 registers that the button was pressed and the value of state was changed to true, but the phrase \"Success\" is never printed. What's going on?</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":93,"score":7,"question_id":12810549,"title":"C# Threading & Blocking","body":"<p>I am wondering which one is better approach to load data in a thread safe fashion. Traditionally, I have used the double lock pattern and that served the purpose quite well. Now, with the addition of System.Lazy type, I am wondering if relying on the internals of Lazy and Loading is better and do the job in a much better way. It does look cleaner and easier to read but is it better?</p>\n\n<p>Any thoughts? </p>\n\n<pre><code>namespace SomeNameSpace\n{\n  public class DataStoreContext\n  {\n    private readonly static Lazy&lt;DataStoreContext&gt; context = new Lazy&lt;DataStoreContext&gt;(() =&gt; new DataStoreContext());\n    private Lazy&lt;Dictionary&lt;string, Entity&gt;&gt; _entities = new Lazy&lt;Dictionary&lt;string, Entity&gt;&gt;(() =&gt; { return DataStoreContext.Instance.Load(); });\n    private readonly object _syncRoot = new object();\n    private DataStoreContext()\n    {\n    }\n\n    public Dictionary&lt;string, Entity&gt; Data\n    {\n      get { return _entities.Value; }\n    }\n\n    public static DataStoreContext Instance\n    {\n      get { return context.Value; }\n    }\n\n    private Dictionary&lt;string, Entity&gt; Load()\n    {\n      // Load Data from some data store. \n      return null;\n    }\n\n    private Dictionary&lt;string, Entity&gt; LoadWithLock()\n    {\n      if (_entities == null)\n      {\n        lock (_syncRoot)\n        {\n          if (_entities == null)\n          {\n            Dictionary&lt;string, Entity&gt; entities = this.Load();\n            _entities = entities;\n            return _entities;\n          }\n        }\n      }\n\n      return _entities ;\n    }\n\n    public void Clear()\n    {\n\n     _entities = new Lazy&lt;Dictionary&lt;string, Entity&gt;&gt;(() =&gt; { return DataStoreContext.Instance.Load(); });\n\n    }\n  }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":9,"favorite_count":27,"up_vote_count":44,"down_vote_count":0,"view_count":79147,"score":44,"question_id":289434,"title":"How to make a Java thread wait for another thread's output?","body":"<p>I'm making a Java application with an application-logic-thread and a database-access-thread.\nBoth of them persist for the entire lifetime of the application. However, I need to make sure that the app thread waits until the db thread is ready (currently determined by calling <code>dbthread.isReady()</code>).\nI wouldn't mind if app thread blocked until the db thread was ready.</p>\n\n<p><code>Thread.join()</code> doesn't look like a solution - the db thread only exits at app shutdown.</p>\n\n<p><code>while (!dbthread.isReady()) {}</code> kind of works, but the empty loop consumes a lot of processor cycles.</p>\n\n<p>Any other ideas? Thanks.</p>\n"},{"tags":[".net","multithreading","tracing","tracelistener"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12799158,"title":"Does TraceSource.Trace methods block the calling thread until it is proccessed by all listeners?","body":"<p>I am new to .net tracing.</p>\n\n<p>I have nearly more than 10 to 15 trace sources in my application and a text file listener and sql server listener in shared listeners list. My question is if I call</p>\n\n<pre><code> traceSource.TraceInformation(\"Sample information\")\n</code></pre>\n\n<p>then the calling thread will be blocked till it is processed/traced by text file listener and sql server listener. Or TraceSource internally contains any queue for logging, so that the calling thread will be released immediately and logging will be done in the background thread.</p>\n\n<p>Basically I dont want the calling thread to be blocked until it is logged by all the trace listeners. If I want to implement like that, then should I go for custom listeners?</p>\n"},{"tags":["java","multithreading","homework","swing","initialization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":186,"score":-3,"question_id":9657294,"title":"multithreading and GUI. how to change properties of object initialized in a loop","body":"<p>I am given the following problem description:</p>\n\n<p>The GUI is 500-pixel wide and 550-pixel high. Top level layout is BorderLayout. \nAdd three text fields at North and three buttons at South. Captions of these \nButtons are: “Red”, “Green”, and “Blue”, from left to right. </p>\n\n<p>Buttons are initially enabled whereas text fields are not user editable during \nthe entire period of execution. Buttons are used to start new threads of a \ncolor. \nCorresponding text fields show the thread count of that color. The center area \nof the GUI is filled with an 8 by 8 grid of buttons all having its background \ncolor initially set to white. </p>\n\n<p>Refer to the screenshot to get an idea of how the GUI should look like. The \nbehavior of the GUI is elaborated in the following paragraphs. </p>\n\n<p>If user clicks on a color button at South, a thread of that color will start. \nIn each cycle of its execution, the thread will randomly pick up a square from \nthe grid which is currently not occupied by any other thread. Then it will \ncolor that square according to the thread’s representative color. The initial \ncolor will </p>\n\n<p><i>\nSpring 2012 – CS 302 Object Oriented Design Lab 7 Date: February 27, 2012\n<br>Page 3 of 3\n</i></p>\n\n<p>be saturated (e.g., pure red for a red thread) but will gradually fade over a \nperiod of approximately 8 seconds to turn into white again. </p>\n\n<p>The execution cycle of the thread will resume by randomly choosing an \nunoccupied square again. Once started, a thread will continue to run forever. \nHowever, the user will be allowed start at most ten threads of each color. Then \nthe corresponding color button will be disabled. </p>\n\n<p>Behavior of array of text fields is simple. They show the number of running \nthreads of that color. As noted above, these text fields are not user editable. \nIn order to develop a robust multi-threaded GUI application in Java, programmer \nhas to ensure that all GUI parameters (i.e., properties of GUI Swing \ncomponents) are actually updated from only one thread: usually the Event \nDispatcher thread. </p>\n\n<p>In order to get some concrete ideas about it, read <a href=\"http://java.sun.com/products/jfc/tsc/articles/threads/threads1.html\" rel=\"nofollow\">Threads and Swing</a></p>\n\n<p>As a result, threads that you create should not have access to any Swing \ncomponents. Rather maintain a data structure that is exposed to and update by \nthreads according to their cycle of execution. On the other hand, periodically \ninvoke repaint() methods from main thread to invite Swing Event Dispatcher \nthread to eventually visit the content of the data structure and display the \nGUI components accordingly.</p>\n\n<hr>\n\n<p>So far I have an empty shell of a GUI that does everything mentioned above \nexcept for the actual changing of the button colors. Because I have initialized \nall 64 buttons in a loop, I do not know how to reference them to change their \ncolor. Even if I knew this, I do not know how to make the color gradually fade, \nor how to make sure each thread picks up a random empty button to color. Help \nplease!! What I have so far is below:</p>\n\n<pre><code>import java.awt.*;\nimport java.awt.event.*;\nimport javax.swing.*;\n\npublic class ColorThread extends JFrame implements ActionListener, Runnable {\n\n    static Thread nt    =null;\n    static Runnable rn  = new ColorThread();\n    static public int rcount = 0;\n    static public int bcount = 0;\n    static public int gcount = 0;\n    JTextField r    = new JTextField(\"0\");\n    JTextField g    = new JTextField(\"0\");\n    JTextField b    = new JTextField(\"0\");\n    JButton red     = new JButton(\"Red\");\n    JButton green   = new JButton(\"Green\");\n    JButton blue    = new JButton(\"Blue\");\n\n    public ColorThread(){\n        super(\"CS 302 Lab7 HW\");\n        setSize(500,550);\n        setLayout(new BorderLayout());\n\n        JPanel top = new JPanel(); top.setLayout(new GridLayout( 1,0));\n        JPanel bot = new JPanel(); bot.setLayout(new GridLayout( 1,0));\n        JPanel mid = new JPanel(); mid.setLayout(new GridLayout( 8,8));\n\n        for (int x=0; x&lt;64; x++){\n            JButton w = new JButton(\"\"+x);\n            w.setBackground(Color.WHITE);\n            mid.add(w);\n            w.addActionListener(this);\n            w.setName(\"b\"+x);\n        }\n\n        top.add(r);     r.setEnabled(false);\n        top.add(g);     g.setEnabled(false);\n        top.add(b);     b.setEnabled(false);\n\n        bot.add(red);   red.addActionListener(this);\n        bot.add(green); blue.addActionListener(this);\n        bot.add(blue);  green.addActionListener(this);\n\n        add(BorderLayout.NORTH,     top );\n        add(BorderLayout.CENTER,    mid );\n        add(BorderLayout.SOUTH,     bot );\n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        setVisible(true);\n    }\n    public static void main(String[] args) {\n    }\n\n    @Override public void run() { System.out.println(this.getName()); }\n    @Override public void actionPerformed(ActionEvent e) {\n        if (e.getActionCommand().equals(\"Red\")) {\n            nt = new Thread(rn);\n            nt.start();\n            rcount++;\n\n            r.setText(  Integer.toString(\n                        Integer.parseInt(r.getText())+1)    );\n\n            if (rcount &gt;= 10) { red.setEnabled(false); }\n\n        } else if (e.getActionCommand().equals(\"Green\")) {\n            nt = new Thread(rn);\n            nt.start();\n            gcount++;\n\n            g.setText(  Integer.toString(\n                        Integer.parseInt(g.getText())+1)    );\n\n            if (gcount &gt;= 10) { green.setEnabled(false); }\n\n        } else if (e.getActionCommand().equals(\"Blue\")) {\n            nt = new Thread(rn);\n            nt.start();\n            bcount++;\n            b.setText(  Integer.toString(\n                        Integer.parseInt(b.getText())+1)    );\n\n            if (bcount&gt;=10) { blue.setEnabled(false); }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","synchronization","thread-safety"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12809957,"title":"Thread Synchronization Primitives","body":"<p>I am looking for a good material on different thread synchronization primitives that are generic (not tied to any language or implementation. I only want the concepts). </p>\n\n<p>Searches in the internet point to specific language or implementation. </p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":110,"score":4,"question_id":12809185,"title":"Executors vs threads","body":"<p>I am trying to run the following piece of code:</p>\n\n<pre><code>public static void main(String[] args){\n    ScheduledExecutorService service = new ScheduledThreadPoolExecutor(2);\n\n    Runnable r = new Runnable() {\n        @Override\n        public void run() {\n            throw new RuntimeException();\n        }\n    };\n    service.execute(r );\n    ScheduledFuture&lt;?&gt; schedule = service.schedule(r, 0, TimeUnit.SECONDS);\n    new Thread(r).run();\n}\n</code></pre>\n\n<p>Regarding the above I have the following questions:</p>\n\n<ol>\n<li>Is there any way to catch and respond to exceptions happening on the executor's thread?</li>\n<li>Why is the exception from the thread created explicitly propagated to the main thread, but both executions using the executor service does not propagate that error? How can this error ever be discovered?</li>\n</ol>\n\n<p>EDIT: One further question came to mind:</p>\n\n<ol>\n<li>How can i stop a given periodic task that I schedule, let's say after N repeats or N minutes?</li>\n</ol>\n"},{"tags":["windows","multithreading","qt","pthreads","openssl"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":734,"score":2,"question_id":3417706,"title":"OpenSSL and multi-threads","body":"<p>I've been <a href=\"http://www.openssl.org/docs/crypto/threads.html\" rel=\"nofollow\">reading</a> about the requirement that if OpenSSL is used in a multi-threaded application, you have to register a thread identification function (and also a mutex creation function) with OpenSSL.</p>\n\n<p>On Linux, according to the example provided by OpenSSL, a thread is normally identified by registering a function like this:</p>\n\n<pre><code>static unsigned long id_function(void){\n    return (unsigned long)pthread_self();\n}\n</code></pre>\n\n<p>pthread_self() returns a pthread_t, and this works on Linux since pthread_t is just a typedef of unsigned long.</p>\n\n<p>On Windows pthreads, FreeBSD, and other operating systems, pthread_t is a struct, with the following structure:</p>\n\n<pre><code>struct {\n    void * p;                   /* Pointer to actual object */\n    unsigned int x;             /* Extra information - reuse count etc */ \n}\n</code></pre>\n\n<p>This can't be simply cast to an unsigned long, and when I try to do so, it throws a compile error. I tried taking the void *p and casting that to an unsigned long, on the theory that the memory pointer should be consistent and unique across threads, but this just causes my program to crash a lot.</p>\n\n<p><b>What can I register with OpenSSL as the thread identification function when using Windows pthreads or FreeBSD or any of the other operating systems like this?</b></p>\n\n<p>Also, as an additional question:<br>\n<b>Does anyone know if this also needs to be done if OpenSSL is compiled into and used with QT, and if so how to register QThreads with OpenSSL?</b> Surprisingly, I can't seem to find the answer in QT's documentation.</p>\n"},{"tags":["java","multithreading","prolog","jpl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12803898,"title":"Fatal error when doing Multithreading with JPL (Interfacing Java and Prolog)","body":"<p>I have been experimenting with the multithreading features of JPL. As far as I understand from the comments in the source code one different Prolog engine is assigned per Java thread.\nApparently there is a problem when a query is started in thread A, another query is executed in thread B (spawned by thread A), and a third query is executed again in thread A.</p>\n\n<p>The following snippet of code illustrates the problem:</p>\n\n<pre><code>public static void main(String[] args) {\n    try {\n        ...\n        Query query;\n        query = new Query(\"true\");\n        System.out.println(query.hasSolution()); //succeeds\n\n        Thread t = new Thread() {\n            @Override\n            public void run() {\n                Query query2 = new Query(\"true\");\n                System.out.println(query2.hasSolution()); //succeeds\n            }\n        };\n        t.start();\n        t.join();\n\n        query = new Query(\"true\");\n        System.out.println(query.hasSolution()); //fatal error\n    } catch (Exception e) {\n        throw new RuntimeException(e);\n    }\n}\n</code></pre>\n\n<p>Since the JPL documentation mentions that no two queries can be active at the same time, the code waits until completion of the thread before continuing to the last query (it is not yet clear to me if that constraint is about queries in the same thread only).</p>\n\n<p>In the previous example, only the first two queries succeed. When the third query is executed I obtain this fatal error:</p>\n\n<pre><code>#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x000000010db65bd5, pid=79191, tid=7171\n#\n# JRE version: 7.0_06-b24\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (23.2-b09 mixed mode bsd-amd64 compressed oops)\n# Problematic frame:\n# C  [libYap.dylib+0x125bd5]  PL_open_foreign_frame+0x45\n#\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\n#\n...\n</code></pre>\n\n<p>Is this a bug in JPL ? in that case does someone know a workaround for using JPL with multithreading ?</p>\n\n<p>I am testing with YAP Prolog version 6.2.2.</p>\n"},{"tags":["c++","multithreading","visual-studio","opencv","image-stitching"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":157,"score":-3,"question_id":12809014,"title":"Image Stitching from a live Video Stream in OpenCv","body":"<p>I am trying to Stitch an image from a live video camera (more like a panorama) using OpenCv. The stitching is working fine. My problem is, i want the stitching to be done in real time say around 30 mph but the processing of the stitching is slow. </p>\n\n<p>I want to use Threads to improve the speed but in order to use them do i need to store my live video stream or is there any way to directly use threads for the live stream.</p>\n\n<p>Here is a sample code:</p>\n\n<pre><code>  SapAcqDevice *pAcq=new SapAcqDevice(\"Genie_HM1400_1\", false);\n  SapBuffer *pBuffer = new SapBuffer(20,pAcq);\n  SapView *pView=new SapView(pBuffer,(HWND)-1);\n  SapAcqDeviceToBuf *pTransfer= new SapAcqDeviceToB(pAcq,pBuffer,XferCallback,pView);\n\n\n\n  pAcq-&gt;Create();\n  pBuffer-&gt;Create();\n  pView-&gt;Create();\n\n  pTransfer-&gt;Create();  \n  pTransfer-&gt;Grab();\n\n  printf(\"Press any key to stop grab\\n\");\n  getch();\n\n  pTransfer-&gt;Freeze();  \n  pTransfer-&gt;Wait(5000);\n\n  printf(\"Press any key to terminate\\n\");\n  getch();\n</code></pre>\n\n<p>This above code is used to capture the live stream. The XferCallback function is used to do the processing of the frames. In this funtion i call my stitch engine. Since the processing of the engine is slow i want to use threads. </p>\n\n<p>Here is a sample code of the callback function:</p>\n\n<pre><code>SapView *pView = (SapView *) pInfo-&gt;GetContext();\nSapBuffer *pBuffer;\npBuffer = pView-&gt;GetBuffer();\n\nvoid *pData=NULL;\npBuffer-&gt;GetAddress(&amp;pData);\n\nint width=pBuffer-&gt;GetWidth();\nint height=pBuffer-&gt;GetHeight();\nint depth=pBuffer-&gt;GetPixelDepth();\n\nIplImage *fram;\nfram = cvCreateImage(cvSize(width,height),depth,1);\ncvSetImageData(fram,pData,width);\n\nstitching(frame_num , fram);\n\ncvWaitKey(1);\n\nframe_num++;\n</code></pre>\n\n<p>I want many threads working on the stitch engine.</p>\n"},{"tags":["python","multithreading","exception-handling","exception"],"answer_count":6,"favorite_count":7,"up_vote_count":21,"down_vote_count":0,"view_count":6714,"score":21,"question_id":2829329,"title":"Catch a thread's exception in the caller thread in Python","body":"<p>I'm very new to Python and multithreaded programming in general.  Basically, I have a script that will copy files to another location.  I would like this to be placed in another thread so I can output <code>....</code> to indicate that the script is still running.</p>\n\n<p>The problem that I am having is that if the files cannot be copied it will throw an exception.  This is ok if running in the main thread; however, having the following code does not work:</p>\n\n<pre><code>try:\n    threadClass = TheThread(param1, param2, etc.)\n    threadClass.start()   ##### **Exception takes place here**\nexcept:\n    print \"Caught an exception\"\n</code></pre>\n\n<p>In the thread class itself, I tried to re-throw the exception, but it does not work.  I have seen people on here ask similar questions, but they all seem to be doing something more specific than what I am trying to do (and I don't quite understand the solutions offered). I have seen people mention the usage of <code>sys.exc_info()</code>, however I do not know where or how to use it.</p>\n\n<p>All help is greatly appreciated!</p>\n\n<p><strong>EDIT:</strong> The code for the thread class is below:</p>\n\n<pre><code>class TheThread(threading.Thread):\n    def __init__(self, sourceFolder, destFolder):\n        threading.Thread.__init__(self)\n        self.sourceFolder = sourceFolder\n        self.destFolder = destFolder\n\n    def run(self):\n        try:\n           shul.copytree(self.sourceFolder, self.destFolder)\n        except:\n           raise\n</code></pre>\n"},{"tags":["c++","multithreading","c++11","pthreads"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":112,"score":0,"question_id":12808188,"title":"C++11 thread implementation backend","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/11784153/in-g-is-c-11-thread-model-using-pthreads-in-the-background\">In g++ is C++ 11 thread model using pthreads in the background?</a>  </p>\n</blockquote>\n\n\n\n<p>I have read from somewhere that <code>OpenMP</code> is implemented using <code>PThreads</code> in Linux systems although they seem quite different to me. Considering the (relative) similarities between <code>C++11</code> threads and <code>PThreads</code> I was wondering,</p>\n\n<p><strong>Does anyone know if <code>C++11</code> threads implemented using <code>PThreads</code> or any other multithreading library in <code>gcc</code> or <code>clang</code>?</strong></p>\n"},{"tags":["java","multithreading","powershell","script","vmware"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":150,"score":2,"question_id":12806651,"title":"Java Process.waitFor() and Readline hangs","body":"<p>First, this is my code : </p>\n\n<pre><code>import java.io.*;\nimport java.util.Date;\n\nimport com.banctecmtl.ca.vlp.shared.exceptions.*;\n\npublic class PowershellTest implements Runnable {\n\npublic static final String PATH_TO_SCRIPT = \"C:\\\\Scripts\\\\ScriptTest.ps1\";\npublic static final String SERVER_IP = \"XX.XX.XX.XXX\";\npublic static final String MACHINE_TO_MOD = \"MachineTest\";\n\n/**\n * @param args\n * @throws OperationException \n */\npublic static void main(String[] args) throws OperationException {\n\n    new PowershellTest().run();\n\n}\n\npublic PowershellTest(){}\n\n@Override\npublic synchronized void run() {\n    String input = \"\";\n    String error = \"\";\n\n    boolean isHanging = false;\n\n    try {\n\n        Runtime runtime = Runtime.getRuntime();\n        Process proc = runtime.exec(\"powershell -file \" + PATH_TO_SCRIPT +\" \"+ SERVER_IP +\" \"+ MACHINE_TO_MOD);\n        proc.getOutputStream().close();\n        InputStream inputstream = proc.getInputStream();\n        InputStreamReader inputstreamreader = new InputStreamReader(inputstream);\n        BufferedReader bufferedreader = new BufferedReader(inputstreamreader);\n\n        proc.waitFor();\n\n        String line;\n        while (!isHanging &amp;&amp; (line = bufferedreader.readLine()) != null) {\n            input += (line + \"\\n\");\n            Date date = new Date();\n            while(!bufferedreader.ready()){\n\n                this.wait(1000);\n                //if its been more then 1 minute since a line has been read, its hanging. \n                if(new Date().getTime() - date.getTime() &gt;= 60000){\n\n                    isHanging = true;\n                    break;\n\n                }\n            }\n        }\n\n        inputstream.close();\n        inputstream = proc.getErrorStream();\n        inputstreamreader = new InputStreamReader(inputstream);\n        bufferedreader = new BufferedReader(inputstreamreader);\n        isHanging = false;\n\n        while (!isHanging &amp;&amp; (line = bufferedreader.readLine()) != null) {\n            error += (line + \"\\n\");\n            Date date = new Date();\n            while(!bufferedreader.ready()){\n\n                this.wait(1000);\n                //if its been more then 1 minute since a line has been read, its hanging. \n                if(new Date().getTime() - date.getTime() &gt;= 60000){\n\n                    isHanging = true;\n                    break;\n\n                }\n            }\n        }\n        inputstream.close();\n\n        proc.destroy();\n\n    } catch (IOException e) {\n        //throw new OperationException(\"File IO problem.\", e);\n    } catch (InterruptedException e) {\n        //throw new OperationException(\"Script thread problem.\",e);\n    }\n    System.out.println(\"Error : \" + error + \"\\nInput : \" + input);\n}\n</code></pre>\n\n<p>}</p>\n\n<p>I'm currently trying to run a powershell script that will start/stop a vm (VMWARE) on a remote server. <strong>The script work from command line and so does this code</strong>. The thing is, I hate how I have to use a thread (and make it wait for the script to respond, as explained further) for such a job. I had to do it because both BufferedReader.readline() and proc.waitFor() hang forever. </p>\n\n<p>The script, when ran from cmd, is long to execute. it stall for 30 sec to 1 min from validating authentification with the server and executing the actual script. From what I saw from debugging, the readline hang when it start receiving those delays from the script. </p>\n\n<p>I'm also pretty sure it's not a memory problem since I never had any OOM error in any debugging session.</p>\n\n<p>Now I understand that Process.waitFor() requires me to flush the buffer from both the error stream and the regular stream to work and so that's mainly why I don't use it (I need the output to manage VM specific errors, certificates issues, etc.).</p>\n\n<p>I would like to know if someone could explain to me why it hangs and if there is a way to just use the typical readline() without having it to hang so hard. Even if the script should have ended since a while, it still hang (I tried to run both the java application and a cmd command using the exact same thing I use in the java application at the same time, left it runingfor 1h, nothing worked). It is not just stuck <strong>in</strong> the while loop, the readline() is where the hanging is. </p>\n\n<p>Also this is a test version, nowhere close to the final code, so please spare me the : this should be a constant, this is useless, etc. I will clean the code later. Also the IP is not XX.XX.XX.XXX in my code, obviously.</p>\n\n<p>Either explanation or suggestion on how to fix would be greatly appreciated. </p>\n\n<p>Ho btw here is the script I currently use : </p>\n\n<pre><code>Add-PSSnapin vmware.vimautomation.core\n\nConnect-VIServer -server $args[0]\n\nStart-VM -VM \"MachineTest\"\n</code></pre>\n\n<p>If you need more details I will try to give as much as I can.</p>\n\n<p>Thanks in advance for your help!</p>\n\n<p>EDIT : I also previously tested the code with a less demanding script, which job was to get the content of a file and print it. Since no waiting was needed to get the information, the readline() worked well. I'm thus fairly certain that the problem reside on the wait time coming from the script execution. </p>\n\n<p>Also, forgive my errors, English is not my main language. </p>\n\n<p>Thanks in advance for your help!</p>\n\n<p>EDIT2 : Since I cannot answer to my own Question : </p>\n\n<p>Here is my \"final\" code, after using threads : </p>\n\n<pre><code>import java.io.*;\n\npublic class PowershellTest implements Runnable {\n\npublic InputStream is;\n\npublic PowershellTest(InputStream newIs){\n\n    this.is = newIs;\n}\n\n@Override\npublic synchronized void run() {\n    String input = \"\";\n    String error = \"\";\n\n    try {\n\n\n        InputStreamReader inputstreamreader = new InputStreamReader(is);\n        BufferedReader bufferedreader = new BufferedReader(inputstreamreader);\n\n        String line;\n        while ((line = bufferedreader.readLine()) != null) {\n            input += (line + \"\\n\");\n\n        }\n\n        is.close();\n\n    } catch (IOException e) {\n        //throw new OperationException(\"File IO problem.\", e);\n    }\n    System.out.println(\"Error : \" + error + \"\\nInput : \" + input);\n}\n\n}\n</code></pre>\n\n<p>And the main simply create and start 2 thread (PowerShellTest instances), 1 with the errorStream and 1 with the inputStream. </p>\n\n<p>I believe I made a dumb error when I first coded the app and fixed it somehow as I reworked the code over and over. It still take a good 5-6 mins to run, which is somehow similar if not longer than my previous code (which is logical since the errorStream and inputStream get their information sequentially in my case).</p>\n\n<p>Anyway, thanks to all your answer and especially Miserable Variable for his hint on threading.</p>\n"},{"tags":["c++","multithreading","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":197,"score":4,"question_id":9490405,"title":"std::async won't spawn a new thread when return value is not stored","body":"<p>Consider I have lamba <code>foo</code> which just does some stuff and doesn't need to return anything.\nWhen I do this:   </p>\n\n<pre><code>std::future&lt;T&gt; handle = std::async(std::launch::async, foo, arg1, arg2);\n</code></pre>\n\n<p>Everything runs fine and the lamba will be spawned in a new thread.\nHowever, when I don't store the <code>std::future</code> which the <code>std::async</code> returns, the foo will be run in the main thread and block it.</p>\n\n<pre><code>std::async(std::launch::async, foo, arg1, arg2);\n</code></pre>\n\n<p>What am I missing here?</p>\n"},{"tags":["c#","multithreading","sockets","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":70,"score":0,"question_id":12807683,"title":"How can I use lock in a multi Threaded app?","body":"<p>Please check my multi Threaded proxy checker codes. it is always checking the same proxies. I think I need to use lock for this? But when I use a lock it is working with just one thread. But normally it is multi threaded. Whats the problem of this?</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.IO;\nusing System.Net;\nusing System.Threading;\n\nnamespace ProxyChecker\n{\n    public partial class Main : Form\n    {\n\n\n        public Main()\n        {\n            InitializeComponent();\n\n        }\n\n        private void clearButton_Click(object sender, EventArgs e)\n        {\n            proxyList.Items.Clear();\n        }\n\n        private void clearButton2_Click(object sender, EventArgs e)\n        {\n            checkedList.Items.Clear();\n\n        }\n\n         Thread[] checkerThread;\n        int checking;\n        int beenChecked;\n        private bool isRunning;\n        private delegate void filterProxyHandler(int Index, bool Valid);\n        static readonly object _locker = new object();\n\n\n        private void startButton_Click(object sender, EventArgs e)\n        {\n            checkerThread = new Thread[Convert.ToInt32(threadBox.Text)];\n            checking = proxyList.Items.Count;\n            isRunning = true;\n            beenChecked = 1;\n\n            for (int i = 0; i &lt;= Convert.ToInt32(threadBox.Text) - 1; i++)\n            {\n\n                checkerThread[i] = new Thread(new ParameterizedThreadStart(checkProxys));\n                checkerThread[i].Start(i);\n            }\n        }\n\n\n\n        public void checkProxys(object Index)\n        {\n\n\n\n                int index = (int)Index;\n\n                while (isRunning)\n                {\n\n                    if (beenChecked &gt;= checking)\n                        isRunning = false;\n                    if (index &gt;= proxyList.Items.Count)\n                    {\n                        checkerThread[index].Abort();\n                    }\n\n                    string occoultProxy = proxyList.Items[index].ToString();\n                    object[] validArgs = { index, true };\n                    object[] invalidArgs = { index, false };\n\n                    try\n                    {\n                        WebProxy proxy;\n\n\n                            proxy = new WebProxy(occoultProxy.Split(':')[0], Convert.ToInt32(occoultProxy.Split(':')[1]));\n\n                        WebRequest web = WebRequest.Create(serverBox.Text.ToString());\n                        web.Proxy = proxy;\n                        web.Timeout = Convert.ToInt32(timeoutbox.Text);\n                        web.GetResponse();\n                        if (proxyList.InvokeRequired)\n                        {\n                            proxyList.Invoke(new filterProxyHandler(filterProxy), validArgs);\n                        }\n                        else\n                        {\n                            filterProxy(index, true);\n                        }\n\n\n                            beenChecked++;\n\n\n                    }\n\n\n\n                    catch (Exception ex)\n                    {\n                        Console.WriteLine(ex.Message);\n                        if (proxyList.InvokeRequired)\n                            proxyList.Invoke(new filterProxyHandler(filterProxy), invalidArgs);\n                        else\n                            filterProxy(index, false);\n\n\n                        beenChecked++;\n\n                    }\n\n                }\n\n        }\n        void filterProxy(int index, bool Valid)\n        {\n            try\n            {\n                if (Valid)\n                {\n                    checkedList.Items.Add(proxyList.Items[index]);\n                    //proxyList.Items.RemoveAt(index);\n                }\n                else\n                {\n                    //proxyList.Items.RemoveAt(index);\n                }\n            }\n            catch\n            {\n            }\n        }\n\n\n\n\n        private void stopButton_Click(object sender, EventArgs e)\n        {\n            isRunning = false;\n\n            for (int i = 0; i &lt;= Convert.ToInt32(threadBox.Text) - 1; i++) {\n                checkerThread[i].Abort();\n            }\n        }\n\n        private void Main_Load(object sender, EventArgs e)\n        {\n            CheckForIllegalCrossThreadCalls = false;\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","sockets"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":106,"score":4,"question_id":12807808,"title":"Socket read and write simultaneously","body":"<p>i am trying to write a very simple socket program, what i basically want is that the client keeps listening for communication from the server, in a while(true) loop. now i also want client to be able to send some data back to the server in the middle of it listening.</p>\n\n<p>The only solution i can think of is making a thread for the read and write, and interrupting the read thread everytime i have to do a write. </p>\n\n<p>is there a better solution or is this the only way i can do this</p>\n"},{"tags":["python","multithreading","load","cpu"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12799678,"title":"Python process at 100% CPU but only after couple of hours","body":"<p>When I execute my python script, the load average on the processor is negligible at around 0.01, \nhowever, when I leave the script running after a couple of hours (the script is waiting for a serial input from the serial port) the load on the processor becomes almost 1, and the script show a ~97%cpu usage. bear in mind that there are no serial commands coming, and the process is only waiting..</p>\n\n<p>can anyone explain this please? </p>\n\n<pre><code>#!/usr/bin/env python\nimport socket\nimport threading\nimport Queue\nimport serial\nimport mysql.connector\nfrom datetime import datetime, date, time\nimport ConfigParser\nimport prowlpy\nimport time\n\nconfig = ConfigParser.RawConfigParser()\nconfig.read('settings.ini')\n\n# getfloat() raises an exception if the value is not a float\n# getint() and getboolean() also do this for their respective types\ntemp_min = config.getfloat('temperature', 'temp_min')\ntemp_max = config.getint('temperature', 'temp_max')\nph_min = config.getfloat('ph', 'ph_min')\nph_max = config.getint('ph', 'ph_max')\nmysql_localhost = config.get('mysql','server')\nport = config.getint('mysql','port')\nuser = config.get('mysql','user')\npassword = config.get('mysql','password')\ndatabase = config.get('mysql','database')\ntemperature_table = config.get('mysql','temperature_table')\nph_table = config.get('mysql','ph_table')\nserial_port = config.get('serial','serial_port')\nbaud = config.get('serial','baud')\ntimeout = config.get('serial','timeout')\napikey = config.get('prowl','apikey')\n\n\nhost = '0.0.0.0'\nbuffer = 1024\nmy_queue = Queue.Queue()\nmy_queue_alert = Queue.Queue()\n\n\n#Socket######################################################################\nclass readFromUDPSocket(threading.Thread):\n    def __init__(self, my_queue): \n        threading.Thread.__init__(self)\n        self.setDaemon(True)\n        self.my_queue = my_queue\n        # Create socket (IPv4 protocol, datagram (UDP)) and bind to address\n        self.socketUDP = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n        self.socketUDP.bind((host, port))\n\n    def run(self):\n        while True:\n            buffer1,addr = self.socketUDP.recvfrom(buffer)\n            self.my_queue.put(buffer1)\n            print 'UDP received from', addr\n\n\n#Serial######################################################################\nclass readFromSerial(threading.Thread):\n    def __init__(self, my_queue): \n        threading.Thread.__init__(self)\n        self.setDaemon(True)\n        self.my_queue = my_queue\n        self.ser = serial.Serial()\n        self.ser.baudrate = baud\n        self.ser.port = serial_port\n        self.ser.timeout=None\n        # Open Serial \n        try:\n            self.ser.open()\n        except:\n            if not self.ser.isOpen():\n                print 'serial port not available'\n        #self.ser = serial.Serial(port=serial_port, baudrate=baud, timeout=None)\n        #self.ser.close()\n#need to insert exception\n#need to reopen if found to be opren already\n        #self.ser = serial.Serial(port=serial_port, baudrate=baud, timeout=None)\n\n    def run(self):\n        while True:\n            try:\n                buffer2 =  self.ser.readline(eol=';').rstrip(';')\n                if buffer2:\n                    self.my_queue.put(buffer2)\n                    print 'Serial received', buffer2\n            except:\n                print 'serial port not available, please ensure it is plugged in'\n                time.sleep(10)\n                try:\n                    self.ser.open()\n                    time.sleep(5)\n                except:\n                    print 'Will keep waiting'\n\n\n#process######################################################################\nclass process(threading.Thread):\n    def __init__(self, my_queue, my_queue_alert):\n        threading.Thread.__init__(self)\n        self.setDaemon(True)\n        self.my_queue = my_queue\n        self.my_queue_alert = my_queue_alert\n        self.alive = threading.Event()\n        self.alive.set()\n\n    def run(self):\n        while True: \n            buffer3 = self.my_queue.get()\n            today = datetime.now()\n            #timestamp = today.strftime(\"%A, %B %d, %Y %H:%M:%S\")\n            print 'Data pushed at:', today\n            print buffer3\n\n            if buffer3.startswith('temp:'):\n                temp = buffer3.replace('temp:','')\n                if float(temp) &gt; temp_max or float(temp) &lt; temp_min :\n                    buffer5 = float(temp)\n                    self.my_queue_alert.put(buffer5)\n\n#check if table and database available, if not create them              \n                cnx = mysql.connector.connect(host=mysql_localhost, user=user, password=password, database=database)\n                cursor = cnx.cursor()\n                cursor.execute(\"INSERT INTO \" + database +\".\" + temperature_table + \" (time,temperature)\" + \" VALUES ('\" + str(today)+ \"', '\" + str(temp) +\"')\" )\n                print 'Data inserted into Database'\n                cnx.commit()\n                cursor.close()\n                cnx.close()\n\n            if buffer3.startswith('Ph:'):\n                ph = buffer3.replace('Ph:','')\n                if float(ph) &gt; ph_max or float(ph) &lt; ph_min :\n                    buffer6 = float(ph)\n                    self.my_queue_alert.put(buffer6)\n                cnx = mysql.connector.connect(host=mysql_localhost, user=user, password=password, database=database)\n                cursor = cnx.cursor()\n                cursor.execute(\"INSERT INTO \" + database +\".\" + ph_table + \" (time,Ph)\" + \" VALUES ('\" + str(today)+ \"', '\" + str(ph) +\"')\" )\n                print 'Data inserted into Database'\n                cnx.commit()\n                cursor.close()\n                cnx.close()\n\n\n#prowl_alert################################################################\nclass prowl_alert(threading.Thread):\n    def __init__(self, my_queue_alert): \n        threading.Thread.__init__(self)\n        self.setDaemon(True)\n        self.my_queue_alert = my_queue_alert\n        # Create prowl instance\n        self.p = prowlpy.Prowl(apikey)\n\n    def run(self):\n        while True: \n            buffer4 = self.my_queue_alert.get()\n            print 'alert received'\n            mesg = \"Temperature of Tank is %s \" % buffer4\n            print mesg\n            try:\n                self.p.add('Home Control','Alert',mesg, 1, None, \"http://www.prowlapp.com/\")\n                print 'Success'\n            except Exception,msg:\n                print msg\n\n\n#Main######################################################################\nif __name__ == '__main__':\n\n    # Instantiate &amp; start threads\n    myServer = readFromUDPSocket(my_queue)\n    mySerial = readFromSerial(my_queue)\n    myDisplay = process(my_queue, my_queue_alert)\n    myAlert = prowl_alert(my_queue_alert)\n\n    myServer.start()\n    myDisplay.start()\n    mySerial.start()\n    myAlert.start()\n\nwhile 1:\n    time.sleep(10)\n#check serial connection is available if not notify me\n    pass\n\n\n#tidying up at close time,!!#################################################\nUDPSock.close()\nser.close()\n</code></pre>\n"},{"tags":["iphone","multithreading","animation","uiview","blocks"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12664255,"title":"Execute two UIView at the same time (Not sequentially)","body":"<p>I was surfing the net but I could not have an answer for the problem that I have. \nI `m developing an iPhone app. \nHere the problem: I have tree UIView A, B and C.\nA and B are into C.\nWhen C have a result to show, I want to execute A and B at the same time. A and B are a counter animation each one takes 5 sec. to finish. but I can not find a way to show counter animation of A and B at the same time. Always B is executed when A animation has finished.\nI tried  with blocks ( dispatch_queue_t)but I have the same result.\nIs possible do what I trying to do?</p>\n\n<p>Edited:\nThe problem in the <a href=\"http://dl.dropbox.com/u/1348024/Counters.zip\" rel=\"nofollow\">code</a> is that the counters (A and B) are not executed at the same time.</p>\n"},{"tags":["python","multithreading","pyqt4"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":378,"score":6,"question_id":11550435,"title":"Why does my GUI go unresponsive even though I'm outsourcing to a worker thread?","body":"<p>I have a PyQt4 GUI in which I need to save a stack of Numpy arrays as *.tif images. This seems to take a significant amount of time and causes my GUI to go unresponsive for up to several minutes, depending on the number of images in the stack.</p>\n\n<p>The bulk of the processing happens in this loop over the images:</p>\n\n<pre><code>for i in range(0, np.shape(dataStack)[2]):\n\n        print('Saving slice ' + str(i + 1))\n\n        #Save tumor stack\n        im1 = Image.fromarray(tumorStack[:,:,i]*255)\n        im1.save(saveLocationStr + 'Slice' + str(i+1) + '.tif')\n\n        #Set up correct number of subplots for review plot.\n        if T0 is not None:\n            plt.subplot(141)\n        else:\n            plt.subplot(131)\n\n        #Plot current brain slice in 1st position\n        plt.imshow(dataStack[:,:,i], cmap=mpl.cm.bone)\n        plt.axis('off')\n\n        plt.title(patient + '\\n' + date + '\\n' + 'Slice ' + str(i+1) + ' of ' + str(int(np.shape(dataStack)[2])))\n\n        #Select correct next subplot\n        if T0 is not None:\n            plt.subplot(142)\n        else:\n            plt.subplot(132)\n\n        #Get a masked copy of the tumorStack \n        tempTumorStack = copy.deepcopy(tumorStack[:,:,i])\n        tempTumorStack = np.ma.masked_where(tempTumorStack == 0, tempTumorStack)\n\n        #Plot masked tumor stack over brain data\n        plt.imshow(dataStack[:,:,i], cmap=mpl.cm.bone)\n        plt.imshow(tempTumorStack, cmap=mpl.cm.jet_r, interpolation='nearest')\n        plt.axis('off')\n\n        plt.title(modality + ' Region')\n\n        #Get the auto-zoomed region and plot it\n        (x, y) = tumorStack[:,:,i].nonzero()\n        if( int(np.shape(x)[0]) == 0 or int(np.shape(y)[0]) == 0):\n            if T0 is not None:\n                plt.subplot(143)\n                plt.imshow(T0[:,:,i], cmap=mpl.cm.bone)\n                plt.axis('off')\n\n                plt.title('T0')\n\n                #Plot autozoomed with perimiter over brain data\n                plt.subplot(144)\n                plt.imshow(np.zeros(np.shape(dataStack[:,:,i])), cmap=mpl.cm.bone)\n\n                plt.title('Perimiter of \\n' + modality + ' + T0 for SA')\n\n                plt.axis('off')\n\n            else:\n                plt.subplot(133)\n                plt.imshow(np.zeros(np.shape(dataStack[:,:,i])), cmap=mpl.cm.bone)\n\n                plt.title('Perimiter of \\n' + modality + ' for SA')\n\n                plt.axis('off')\n\n        else:\n            minX = np.min(x)\n            minY = np.min(y)\n            maxX = np.max(x)\n            maxY = np.max(y)\n\n            zoomedXmin =  minX - (minX * .10)\n            zoomedXmax = (maxX * .10) + maxX\n            zoomedYmin =  minY - (minY * .10)\n            zoomedYmax =  (maxY * .10) + maxY\n\n            widthOf = zoomedXmax - zoomedXmin\n            heigthOf = zoomedYmax - zoomedYmin\n\n            #Get perimiter of tumor for autozoomed region\n            #Can do n=8 if we want\n            #tempTumorStack = bwperim(tempTumorStack,n=8)\n            tempTumorStack = mahotas.labeled.borders(tempTumorStack)\n            tempTumorStack = np.where(tempTumorStack == np.max(tempTumorStack), 1, np.nan)\n\n            #Plot T0 then auto-zoomed if user wanted T0\n            if T0 is not None:\n                plt.subplot(143)\n                plt.imshow(T0[:,:,i], cmap=mpl.cm.bone)\n                plt.axis('off')\n\n                plt.title('T0')\n\n                #Plot autozoomed with perimiter over brain data\n                plt.subplot(144)\n                plt.imshow(dataStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax), i ], cmap=mpl.cm.bone)\n                plt.imshow(tempTumorStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax) ], cmap=mpl.cm.jet_r)\n                #plt.xlim(minX, maxX-minX)\n                #plt.ylim(minY, maxY-minY)\n\n                plt.title('Perimiter of \\n' + modality + ' + T0 for SA')\n\n                plt.axis('off')\n\n            #Just plot autozoomed\n            else:\n                plt.subplot(133)\n                plt.imshow(dataStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax), i ], cmap=mpl.cm.bone)\n                plt.imshow(tempTumorStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax) ], cmap=mpl.cm.jet_r)\n\n                plt.title('Perimiter of \\n' + modality + ' for SA')\n\n                plt.axis('off')\n\n        #Finish setting up plot to specs, render, and save it\n        plt.subplots_adjust(wspace=.5)\n        plt.axis('off')\n        plt.tick_params(bottom='off', top='off', left='off', right='off')\n        plt.draw()\n        plt.savefig(saveLocationStr + 'MRI_Comparison\\\\Slice' + str(i+1) + '.png', dpi=200)\n</code></pre>\n\n<p>I figured I would outsource the expensive work to a PyQt4 worker QThread, so following the example at <a href=\"http://diotavelli.net/PyQtWiki/Threading,_Signals_and_Slots\" rel=\"nofollow\">http://diotavelli.net/PyQtWiki/Threading,_Signals_and_Slots</a> I created a worker class that inherits from QtCore.QThread, called all the above code inside the run method of this class, and created and start()ed an instance of this class where the *.tif stack saving needs to occur in the main window.</p>\n\n<p>The GUI still goes unresponsive as it did previously, but the thread seems to be successfully executing the code. I am concerned that perhaps some package used in the code above is not properly releasing the GIL (as referenced here <a href=\"http://www.riverbankcomputing.com/pipermail/pyqt/2011-August/030470.html\" rel=\"nofollow\">http://www.riverbankcomputing.com/pipermail/pyqt/2011-August/030470.html</a>). Is there a way to manually ensure this is working?</p>\n\n<p>I have commented out and replaced the *.tif stack saving code with a time.sleep delay, and the GUI still goes unresponsive, so perhaps I am implementing QThread wrong?</p>\n\n<p>Am I missing something else? Have I provided enough information?</p>\n\n<p>edit:</p>\n\n<p>I create the thread in the main window here:</p>\n\n<pre><code># create instance of saveImageStackWorker(QThread) thread class\nself.saveThread = brain_io.saveImageStackWorker()\nself.saveThread.populate(self.tumorBrain.pixData, self.tumorBrain.tumor, saveLocationStr, self.measurer, self.tumorBrain.patient, dateForPlots, imageModality, T0pass)\n</code></pre>\n\n<p>And here is the entire worker thread class I defined, where the function saveImageStack(args) is the same *.tif saving code I provided above:</p>\n\n<pre><code>class saveImageStackWorker(QThread):\n\"\"\"\n\n\"\"\"\n\ndef __init__(self, parent=None):\n\n    QThread.__init__(self, parent)\n\ndef __del__(self):\n\n    self.wait()\n\ndef populate(self, dataStack, tumorStack, saveLocationStr, measurer, patient, date, modality, T0):\n    self.dataStack = dataStack\n    self.tumorStack = tumorStack\n    self.saveLocationStr = saveLocationStr\n    self.measurer = measurer\n    self.patient = patient\n    self.date = date\n    self.modality = modality\n    self.T0 = T0\n\n    self.start()\n\ndef run(self):\n    self.saveImageStack(self.dataStack, self.tumorStack, self.saveLocationStr, self.measurer, self.patient, self.date, self.modality, self.T0)\n\ndef saveImageStack(self, dataStack, tumorStack, saveLocationStr, measurer, patient, date, modality, T0): #, dateStr, measurer,, saveLocationStr):\n    \"\"\"\n    Input:\n        dataStack:\n            numpy array of the brain image data.\n        tumorStack:\n            numpy binary array of tumor data.\n        modality:\n            the modality of the image.\n        T0:\n            numpy binary array of T0, if you do not\n            wish to show T0 (i.e. for flair or something) \n            leave as default None.\n    Output:\n        None\n    Description:\n        Saves the image stack of tumor and the review plots \n        to the output directory.\n    \"\"\"\n\n    print('Saving image stack from within worker thread...')\n\n    font = {'size' : 10} \n\n    matplotlib.rc('font', **font)\n\n    np.seterr(all='ignore')\n    warnings.simplefilter('ignore')\n\n    for i in range(0, np.shape(dataStack)[2]):\n\n        print('Saving slice ' + str(i + 1))\n\n        #Save tumor stack\n        im1 = Image.fromarray(tumorStack[:,:,i]*255)\n        im1.save(saveLocationStr + 'Slice' + str(i+1) + '.tif')\n\n        #Set up correct number of subplots for review plot.\n        if T0 is not None:\n            plt.subplot(141)\n        else:\n            plt.subplot(131)\n\n        #Plot current brain slice in 1st position\n        plt.imshow(dataStack[:,:,i], cmap=mpl.cm.bone)\n        plt.axis('off')\n\n        plt.title(patient + '\\n' + date + '\\n' + 'Slice ' + str(i+1) + ' of ' + str(int(np.shape(dataStack)[2])))\n\n        #Select correct next subplot\n        if T0 is not None:\n            plt.subplot(142)\n        else:\n            plt.subplot(132)\n\n        #Get a masked copy of the tumorStack \n        tempTumorStack = copy.deepcopy(tumorStack[:,:,i])\n        tempTumorStack = np.ma.masked_where(tempTumorStack == 0, tempTumorStack)\n\n        #Plot masked tumor stack over brain data\n        plt.imshow(dataStack[:,:,i], cmap=mpl.cm.bone)\n        plt.imshow(tempTumorStack, cmap=mpl.cm.jet_r, interpolation='nearest')\n        plt.axis('off')\n\n        plt.title(modality + ' Region')\n\n        #Get the auto-zoomed region and plot it\n        (x, y) = tumorStack[:,:,i].nonzero()\n        if( int(np.shape(x)[0]) == 0 or int(np.shape(y)[0]) == 0):\n            if T0 is not None:\n                plt.subplot(143)\n                plt.imshow(T0[:,:,i], cmap=mpl.cm.bone)\n                plt.axis('off')\n\n                plt.title('T0')\n\n                #Plot autozoomed with perimiter over brain data\n                plt.subplot(144)\n                plt.imshow(np.zeros(np.shape(dataStack[:,:,i])), cmap=mpl.cm.bone)\n\n                plt.title('Perimiter of \\n' + modality + ' + T0 for SA')\n\n                plt.axis('off')\n\n            else:\n                plt.subplot(133)\n                plt.imshow(np.zeros(np.shape(dataStack[:,:,i])), cmap=mpl.cm.bone)\n\n                plt.title('Perimiter of \\n' + modality + ' for SA')\n\n                plt.axis('off')\n\n        else:\n            minX = np.min(x)\n            minY = np.min(y)\n            maxX = np.max(x)\n            maxY = np.max(y)\n\n            zoomedXmin =  minX - (minX * .10)\n            zoomedXmax = (maxX * .10) + maxX\n            zoomedYmin =  minY - (minY * .10)\n            zoomedYmax =  (maxY * .10) + maxY\n\n            widthOf = zoomedXmax - zoomedXmin\n            heigthOf = zoomedYmax - zoomedYmin\n\n            #Get perimiter of tumor for autozoomed region\n            #Can do n=8 if we want\n            #tempTumorStack = bwperim(tempTumorStack,n=8)\n            tempTumorStack = mahotas.labeled.borders(tempTumorStack)\n            tempTumorStack = np.where(tempTumorStack == np.max(tempTumorStack), 1, np.nan)\n\n            #Plot T0 then auto-zoomed if user wanted T0\n            if T0 is not None:\n                plt.subplot(143)\n                plt.imshow(T0[:,:,i], cmap=mpl.cm.bone)\n                plt.axis('off')\n\n                plt.title('T0')\n\n                #Plot autozoomed with perimiter over brain data\n                plt.subplot(144)\n                plt.imshow(dataStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax), i ], cmap=mpl.cm.bone)\n                plt.imshow(tempTumorStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax) ], cmap=mpl.cm.jet_r)\n                #plt.xlim(minX, maxX-minX)\n                #plt.ylim(minY, maxY-minY)\n\n                plt.title('Perimiter of \\n' + modality + ' + T0 for SA')\n\n                plt.axis('off')\n\n            #Just plot autozoomed\n            else:\n                plt.subplot(133)\n                plt.imshow(dataStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax), i ], cmap=mpl.cm.bone)\n                plt.imshow(tempTumorStack[int(zoomedXmin):int(zoomedXmax), int(zoomedYmin):int(zoomedYmax) ], cmap=mpl.cm.jet_r)\n\n                plt.title('Perimiter of \\n' + modality + ' for SA')\n\n                plt.axis('off')\n\n        #Finish setting up plot to specs, render, and save it\n        plt.subplots_adjust(wspace=.5)\n        plt.axis('off')\n        plt.tick_params(bottom='off', top='off', left='off', right='off')\n        plt.draw()\n        plt.savefig(saveLocationStr + 'MRI_Comparison\\\\Slice' + str(i+1) + '.png', dpi=200)\n</code></pre>\n\n<p>edit #2:\nAdding the code for the method in the main window that starts the thread -</p>\n\n<pre><code>def uploadAndSave(self):\n    [db, unused] = initGUI.getDbDataBetter()\n    self.db = db\n\n    subtypeID = str(self.dbImage.image_subtype_id.toString())\n    query = QtSql.QSqlQuery(\"SELECT subtype_name FROM image_subtypes where \"\n                        + \"id = \" + subtypeID, self.db)\n    query.next()\n    imageModality = str(query.value(0).toString())\n\n    dateForPlots = str(self.dbImage.date_of_image.toString()).replace('T',' ')\n    date = dateForPlots.replace('-','').replace(':','.')\n\n    basePath = 'S:\\Lab_KSwanson\\MRI Project\\Test measurements\\\\' + self.tumorBrain.patient + '\\\\' + self.measurer + '\\\\' + date + '\\\\'\n    print('Saving images...')\n    seriesDescription = str(self.dbImage.series_description.toString())\n    saveLocationStr = brain_io.createOutputFilepath(basePath, seriesDescription, imageModality)\n    if imageModality.upper().find('T1') &lt; 0:\n        T0pass = None\n    else:\n        T0pass = self.tumorBrain.T0\n\n\n    operation_time = datetime.datetime.now().isoformat().replace('T',' ')[0:19]\n\n    # create instance of saveImageStackWorker(QThread) thread class\n    self.saveThread = brain_io.saveImageStackWorker()\n    self.saveThread.populate(self.tumorBrain.pixData, self.tumorBrain.tumor, saveLocationStr, self.measurer, self.tumorBrain.patient, dateForPlots, imageModality, T0pass)\n\n    # brain_io.saveImageStack(self.tumorBrain.pixData, self.tumorBrain.tumor, saveLocationStr, self.measurer, self.tumorBrain.patient, dateForPlots, imageModality, T0pass)\n    self.tumorBrain.save(saveLocationStr + date + '.dat')\n\n    [db, unused] = initGUI.getDbDataBetter()\n    query = QtSql.QSqlQuery('SELECT file_path FROM measurements m WHERE m.user_id = ' + self.userIDStr + ' AND m.image_id = ' \n                    + str(self.dbImage.id.toString()) + ' AND m.status = \"R\"', db)\n\n    #If there was a rejected measurement, this will return True\n    remeasure = query.next()    \n\n    print('Computing volume, surface area, etc...')\n    T1 = algorithms.vtk_stats(self.tumorBrain.tumor, \n                                spacing=(self.tumorBrain.xSpacing, \n                                         self.tumorBrain.ySpacing, \n                                         np.mean(self.tumorBrain.SliceThickness)))\n\n    T0 = algorithms.vtk_stats(self.tumorBrain.T0, \n                                      spacing=(self.tumorBrain.xSpacing, \n                                               self.tumorBrain.ySpacing, \n                                               np.mean(self.tumorBrain.SliceThickness)))\n\n\n    mass = tvtk.MassProperties(input=T1.output)\n    T0mass = tvtk.MassProperties(input=T0.output)\n    #mySA = algorithms.calculateSurfaceArea(self.tumorBrain.tumor, \n    #                                       self.tumorBrain.xSpacing, \n    #                                       self.tumorBrain.ySpacing, \n    #                                       self.tumorBrain.SliceThickness)\n\n    #mySAT0 = algorithms.calculateSurfaceArea(self.tumorBrain.T0, \n    #                                       self.tumorBrain.xSpacing, \n    #                                       self.tumorBrain.ySpacing, \n    #                                       self.tumorBrain.SliceThickness)\n    #print('mysa = ' + str(mySA))\n\n    #area = 0 \n    #for i in range(0, int(self.tumorBrain.tumor.shape[2])):\n    #    tumor_filt = self.tumorBrain.tumor[:,:,i]\n    #    currThreshold = self.thresholdList[i]\n    #    tumor_filt = np.where(tumor_filt &gt; currThreshold, 1, 0)\n    #    area = area + np.sum(np.sum(tumor_filt))\n\n    #myVolumeT1 = np.sum(self.tumorBrain.xSpacing**2 * area * self.tumorBrain.SliceThickness)\n    myVolumeT1 = mass.volume\n\n    #T0sum = np.sum(np.sum(np.sum(self.tumorBrain.T0)))\n    #myVolumeT0 = np.sum(self.tumorBrain.xSpacing**2 * T0sum * self.tumorBrain.SliceThickness)\n    myVolumeT0 = T0mass.volume\n\n    myVolume_T0_T1 = myVolumeT1 + myVolumeT0\n\n    T0_radius = ((3.0*(myVolumeT0))/(4.0*math.pi))**(1.0/3.0)\n    T0_T1_radius = ((3.0*(myVolume_T0_T1))/(4.0*math.pi))**(1.0/3.0)\n\n    #print('volume vtk = ' + str(mass.volume))\n    #print('my volume = ' + str(myVolume_T0_T1))\n    #print('my radius = ' + str(T0_T1_radius))\n\n    if mass.volume + T0mass.volume == 0 or mass.surface_area == 0:\n        circularity = 0\n    else:\n        circularity = ((math.pi)**(1.0/3.0))*((6.0*(myVolume_T0_T1))**(2.0/3.0) / mass.surface_area)\n\n    print('SA = ' + str(mass.surface_area))\n    print('T0 SA = ' + str(T0mass.surface_area))\n    print('Volume = ' + str(myVolume_T0_T1))\n    print('T0 Volume = ' + str(myVolumeT0))\n    print('Radius = ' + str(T0_T1_radius))\n    print('T0 Radius = ' + str(T0_radius))\n    print('Circularity = ' + str(circularity))\n\n    # Ask to see rendering\n    msgBox = QtGui.QMessageBox(QtGui.QMessageBox.Question, QtCore.QString('Render'), QtCore.QString('Show Tumor Rendering?'), QtGui.QMessageBox.Yes | QtGui.QMessageBox.No)\n    ret = msgBox.exec_()\n    if ret == QtGui.QMessageBox.Yes:\n        algorithms.render_surface(T1, T0)\n\n    query = QtSql.QSqlQuery('select max(group_id) from ' + \n                            'measurement_audit_log where measurement_type_id = ' \n                            + \"'1'\", db)      \n\n    query.next()\n    group_id = str(query.value(0).toInt()[0] + 1)\n\n    # Check for a measurement assignment.\n    osUserName = os.environ.get(\"USERNAME\").lower()\n    query = QtSql.QSqlQuery('SELECT id from users where pathology_user_name = \"' + osUserName + '\"')\n    query.next()\n    user_id = str(query.value(0).toInt()[0])\n\n    query = QtSql.QSqlQuery('select id from ' +\n                            'measurement_assignments_audit ' +\n                            'where image_id = ' + str(self.dbImage.id.toString()) + ' ' +\n                            'and measurer_id = ' + user_id + ' ' +\n                            'and status = \"P\"')\n    assignment = query.next()\n    date_of_completion = operation_time[0:10]\n    if not assignment:\n        # Create a new assignment\n        newAssignmentQuery = ('insert into measurement_assignments_audit ' + \n            '(measurement_assignment_id, assigner_id, measurer_id, image_id, patient_id, date_of_assignment, ' +\n            'comments, date_of_completion, priority, measurement_group_id, operation_user_id, operation_code, ' +\n            'operation_time, status) values (0, ' + user_id + ', ' + user_id + ', ' + str(self.dbImage.id.toString()) + ', ' + \n            str(self.dbImage.patient_id.toString()) + ', \"' + date_of_completion + '\", ' + '\"Self-assigned through brainsegment\", \"' + \n            date_of_completion + '\", 2, ' + group_id + ', ' + user_id + ', \"I\", \"' + operation_time + '\", \"P\")')\n        query = QtSql.QSqlQuery(newAssignmentQuery) \n    else:\n        # Update the assignment\n        updateAssignmentQuery = ('update measurement_assignments_audit set date_of_completion = \"' + date_of_completion + '\", ' + \n            'measurement_group_id = ' + group_id + ' where id = ' + str(query.value(0).toInt()[0]))\n        query = QtSql.QSqlQuery(updateAssignmentQuery)\n\n    brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 1, 1, T0_T1_radius, saveLocationStr + 'MRI_Comparison', operation_time, str(self.dbImage.id.toString()), group_id)\n    brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 2, 2, myVolume_T0_T1, saveLocationStr + 'MRI_Comparison', operation_time, str(self.dbImage.id.toString()), group_id)\n    brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 7, 3, mass.surface_area, saveLocationStr + 'MRI_Comparison', operation_time, str(self.dbImage.id.toString()),group_id)\n    brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 11, 11, circularity, saveLocationStr + 'MRI_Comparison', operation_time, str(self.dbImage.id.toString()),group_id)\n\n    if T0pass is not None:\n        query = QtSql.QSqlQuery('SELECT image_file_path from images i where i.id = ' + str(self.dbImage.id.toString()), db)\n        query.next()\n        #print('SELECT i.image_file_path from images i where i.id = ' + str(self.dbImage.id.toString()))\n        image_file_path = str(query.value(0).toString()).replace('\\\\','\\\\\\\\')\n\n        query = QtSql.QSqlQuery('SELECT id from images i where i.image_file_path = \"' + image_file_path + '\" and i.image_subtype_id in (14, 15, 20, 21) ', db)\n        #print('SELECT id from images i where i.image_file_path = \"' + image_file_path + '\" and i.image_subtype_id in (14, 15, 20, 21) ')\n        query.next()\n        T0idStr = str(query.value(0).toString())\n\n        T0radius = ((3.0*T0mass.volume)/(4.0*math.pi))**(1.0/3.0)\n\n        brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 1, 1, T0_radius, saveLocationStr + 'MRI_Comparison', operation_time, T0idStr, group_id)\n        brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 2, 2, myVolumeT0, saveLocationStr + 'MRI_Comparison', operation_time, T0idStr, group_id)\n        brain_io.uploadMeasurement(self.dbImage, self.db, self.version, self.tumorBrain.patient, remeasure, 7, 3, T0mass.surface_area, saveLocationStr + 'MRI_Comparison', operation_time, T0idStr, group_id)\n</code></pre>\n"},{"tags":["android","multithreading","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":12792376,"title":"Async task wont stop","body":"<pre><code>package com.example.asynctask;\n\nimport android.app.Activity;\nimport android.os.AsyncTask;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.Menu;\nimport android.view.View;\nimport android.widget.ProgressBar;\n\npublic class MainActivity extends Activity {\n    ProgressBar progressbar;\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n        progressbar = (ProgressBar) findViewById(R.id.progressBar);\n    }\n\n    class ProgressTask extends AsyncTask&lt;Integer, Integer, Void&gt; {\n\n        private boolean flag = true;\n\n        @Override\n        protected void onPreExecute() {\n            progressbar.setMax(100);\n        }\n\n        @Override\n        protected void onCancelled() {\n            //progressbar.setMax(0);\n            flag = false;\n            Log.v(\"onCancelled:flag\", String.valueOf(flag));\n        }\n\n        @Override\n        protected Void doInBackground(Integer... params) {\n            // TODO Auto-generated method stub\n            int start = params[0];\n            for (int i = start; i &lt;= 100; i=i+10) {\n\n                if (!flag) {\n                    break;\n                } else {\n                    publishProgress(i);\n                    try {\n                        Thread.sleep(3000);\n                    } catch (InterruptedException e) {\n                        // TODO Auto-generated catch block\n                        Log.e(\"ThreadError\", e.toString());\n                    }\n                }\n            }\n            return null;\n        }\n\n        @Override\n        protected void onProgressUpdate(Integer... values) {\n            progressbar.setProgress(values[0]); \n        }\n\n        @Override\n        protected void onPostExecute(Void result) {\n            Log.v(\"Progress\", \"Finish\");\n        }\n\n    }\n\n    public void onClick(View v) {\n        ProgressTask task = new ProgressTask();\n\n        switch (v.getId()) {\n        case R.id.start:\n            task.execute(10);\n            break;\n\n        case R.id.stop:\n            task.cancel(true);\n            break;\n        }\n    }\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.main, menu);\n        return true;\n    }\n}\n</code></pre>\n\n<p>Here is a symple AsyncTask app which starts to update the progress bar when you hit Start. But when you will hit stop, it wont stop. Thing is when you call <strong><em>task.cancel(true)</em></strong>, <strong><em>onCancelled()</em></strong> methods does gets invoked and changes the value of flag to <strong>false</strong> but in <strong><em>onCancelled()</em></strong> value of flag remains true. I have also tried <strong><em>isCancelled()</em></strong> in place of flag varaible with no success. For a moment my problem is similar to <a href=\"http://stackoverflow.com/questions/4959628/android-asynctask-wont-stop-when-cancelled-why\">Ollie C</a>, but no exceptions are thrown in my case. </p>\n"},{"tags":["c","multithreading","embedded","keil"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":105,"score":4,"question_id":12776420,"title":"Is multithreading supported in embedded Keil C?","body":"<p>I am developing an embedded application in <a href=\"http://www.ti.com/product/lm3s6965\" rel=\"nofollow\">LM3S6965</a> evaluation board using Keil C compiler. Is there any option for creating multithreaded embedded application?</p>\n"},{"tags":["java","multithreading","future","callable"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12805391,"title":"Proper way to handle Thread.interrupted() in a Callable?","body":"<p>What is the proper way to handle Thread.interrupted() in a Callable? I'm guessing that the callable should throw an InterruptedException; for example:</p>\n\n<pre><code>public class MyCallable implements Callable&lt;Object&gt; {\n    public Object call() {\n        Object result = null;\n\n        // Simulate long-running operation that calculates result\n        while (true) {\n            ...\n            if (Thread.interrupted()) {\n                throw new InterruptedException();\n            }\n        }\n\n        result = ... // something produced by the long-running operation    \n\n        return result;\n    }\n}\n</code></pre>\n\n<p>Is this correct, or is there a more appropriate way to handle it? Thanks.</p>\n"},{"tags":["java","multithreading","application","web","main"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":86,"score":2,"question_id":12805929,"title":"Main method in Java Web Application?","body":"<p>I'm creating a web application with servlets and I need a thread changing a number constantly and when a client do a request it gets the current number.</p>\n\n<p>I tried creating a class with the main method and from there start the thread, then from the servlet get the instance where the thread is running (can this be possible?), but the application never enters to the main method.</p>\n\n<p>Any suggestions?\nThanks</p>\n"},{"tags":["c++","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12805041,"title":"C++ Equivalent to Java's BlockingQueue","body":"<p>I'm in the process of porting some Java code over to C++, and one particular section makes use of a BlockingQueue to pass messages from many producers to a single consumer.</p>\n\n<p>If you are not familiar with what a Java BlockingQueue is, it is just a queue that has a hard capacity, which exposes thread safe methods to put() and take() from the queue. put() blocks if the queue is full, and take() blocks if the queue is empty. Also, timeout-sensitive versions of these methods are supplied.</p>\n\n<p>Timeouts are relevant to my use-case, so a recommendation that supplies those is ideal. If not, I can code up some myself.</p>\n\n<p>I've googled around and quickly browsed the Boost libraries and I'm not finding anything like this. Maybe I'm blind here...but does anyone know of a good recommendation?</p>\n\n<p>Thanks!</p>\n"},{"tags":["multithreading","lua"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":1,"view_count":58,"score":3,"question_id":12803115,"title":"Lua operations, that works in mutitheaded environment","body":"<p>My application uses <strong>Lua</strong> in <strong>multithreaded</strong> environment with <em>global mutex</em>. It implemented like this:</p>\n\n<ol>\n<li>Thread locks mutex,  </li>\n<li>Call <code>lua_newthread</code>  </li>\n<li>Perform some initialization on <code>coroutine</code>  </li>\n<li>Run <code>lua_resume</code> on <code>coroutine</code>  </li>\n<li>Unlocks mutex  </li>\n</ol>\n\n<p><code>lua_lock/unlock</code> is not implemented, GC is stopped, when lua works with <code>coroutine</code>.</p>\n\n<p>My question is, can I perform steps 2 and 3 without locking, if initialisation process does not requires any global Lua structs? Can i perform all this process without locking at all, if <code>coroutine</code> does not requires globals too?</p>\n\n<p>In what case I generally can use Lua functions without locking?</p>\n"},{"tags":["java","multithreading","spring","spring-mvc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12804915,"title":"Long running HTTP request and threads synchronization","body":"<p>I need to code a web service that solves a complex problem by the use of a heuristic algorithm. The algorithm will run as long as the amount of time specified in the POST request has lapsed (i.e. passing timeAllowance=60 will make sure that the heuristic algorithm stops after 60 seconds and returns the best solution found). </p>\n\n<p>The heuristic algorithm has to run on several threads to take advantage of all the server cores. During the execution of the algorithm, these methods have to \"communicate\" between each other. Each thread will run the heuristic algorithm and after certain amount of time, the threads will communicate the solutions they found and, if the allowed time has not expired, a new cycle is run with a different initial population. Summarizing:</p>\n\n<ol>\n<li>Generate initial populations (pretty much randomly)</li>\n<li>Launch heuristic algorithms threads, each one taking a population as input</li>\n<li>After a certain amount of time, terminate the threads and communicate to a \"controller entity\" the new populations found by the threads</li>\n<li>Do some logical reasoning and generate the new populations based on the result of the threads launched at point 2</li>\n<li>If the allowed time has not expired, go back to point 2 with the new populations. Otherwise quit</li>\n</ol>\n\n<p>My question is: how would you structure the code using Spring MVC?</p>\n\n<p>Just as a test, I tried to launch 10 threads in a service method and to call that method from a controller (autowiring the service). Everything the threads are doing is to sleep for 60 seconds. I was expecting the HTTP request to wait for all the threads to terminate (i.e. about 60 seconds), but it actually responds straight away.</p>\n\n<p>Any help very much appreciated.</p>\n\n<p>Thank you!</p>\n"},{"tags":["c","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":135,"score":4,"question_id":12792839,"title":"thread safe queue implementation","body":"<p>In my application I have 2 threads plus the main thread. </p>\n\n<p>One thread is to obtain data (4096 bytes to a buffer) from the I/O module when an interrupt occurs. And the other thread is to consume this data (process and format and write the data to a file).</p>\n\n<p>What would be the best method to achieve this? </p>\n\n<p>I can't lose data from the producer thread which happens at a fast rate. </p>\n\n<p>Any examples i can study on this will be greatly appreciated. </p>\n\n<p>I am trying to implement thread safe queues and having a hard time.</p>\n\n<p>i am sorry i forgot to include the platform and other infomation.\ni am using windows xp(32bit) and Microsoft visual studio 5.0 compiler. </p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":12785238,"title":"Java Thread Ping Pong example","body":"<p>I'm trying to understand thread basics, and as a first example I create two thread that write a  String on the stdout. As I know the scheduler allows to execute the threads using a round robin schedule. Thats why I got:</p>\n\n<blockquote>\n  <p>PING\n  PING\n  pong\n  pong\n  pong\n  PING\n  PING\n  PING\n  pong\n  pong</p>\n</blockquote>\n\n<p>Now I want to use a shared variable, so every thread will know if its your turn:</p>\n\n<pre><code>public class PingPongThread extends Thread {\nprivate String msg;\nprivate static String turn;\n\npublic PingPongThread(String msg){\n    this.msg = msg;\n}\n@Override\npublic void run() {\n    while(true) {\n        playTurn();\n    }\n\n}\npublic synchronized void playTurn(){\n    if (!msg.equals(turn)){\n        turn=msg;\n        System.out.println(msg);\n    }\n}\n}\n</code></pre>\n\n<p>Main class:</p>\n\n<pre><code>public class ThreadTest {\n    public static void main(String[] args) {\n        PingPongThread thread1 = new PingPongThread(\"PING\");\n        PingPongThread thread2 = new PingPongThread(\"pong\");\n        thread1.start();\n        thread2.start();\n    }\n}\n</code></pre>\n\n<p>I synchronized the \"turn manager\" but I still get something like:</p>\n\n<blockquote>\n  <p>PING\n  PING\n  pong\n  pong\n  pong\n  PING\n  PING\n  PING\n  pong\n  pong</p>\n</blockquote>\n\n<p><strong>Can someone explains what I am missing, and Why I'm not getting Ping pong... ping pong</strong>.\nThanks!</p>\n"},{"tags":["java","ajax","multithreading","wicket"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12800550,"title":"update wicket page with thread progress","body":"<p>I have a case where I need to update a gui component based on operations performed in another thread. For this I have the following:</p>\n\n<p>A class that extends WebPage and creates an input field, a form and a label. When the form is submitted a thread that processes data from the input file is started and an AbstractAjaxTimerBehavior is attached to the page which updates the label with the progress/status of the thread.</p>\n\n<p>Because I cannot access the thread object in the onTimer () method of the ajax timer, I pass on a reference of the class to the thread upon it's creation. The thread then updates a variable (status) of the class with it's progress. What the ajax timer does is it updates the label's value with the status value.</p>\n\n<pre><code>public int status;\n\n@Override\npublic void onSubmit ()\n{\n    final Task task = new Task (ViewPage.this);\n    Thread thread = new Thread (task);\n    thread.start ();\n\n    AbstractAjaxTimerBehavior timer = new AbstractAjaxTimerBehavior (Duration.milliseconds (1000))\n    {\n        private static final long serialVersionUID = 1L;\n\n        @Override\n        protected void onTimer (AjaxRequestTarget target)\n        {\n            System.out.println (\"&gt; Progress [\" + status + \"]\");\n\n            if (status == x)\n            {\n               // refresh page\n               setResponsePage (getPage().getClass ());\n            }\n        }\n    };\n\n    getPage().add (timer);\n}\n</code></pre>\n\n<p>Is there a way that I can update the label's value by accessing the thread object directly from the ajax timer or in a clean way?</p>\n"},{"tags":["c#","multithreading","compact-framework","serial-port"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12801475,"title":"serialPort.DataReceived running in thread not working","body":"<p>I'm working in a thread to check the GPRS connection in <code>CompactFramework</code>. </p>\n\n<p>The idea of the thread is simple: If the program isn't connected then I run the code to connect (this code is giving me errors), but if the connection is OK then I recheck again in 60 seconds and so on.</p>\n\n<p>Now, focusing in connection code. The following code check if it's connected or not, if it isn't then I subscribe to <code>DataReceive</code> event.</p>\n\n<pre><code>void initFormText()\n{\n    if (isThereConnect()) //true if it is connected\n    {\n       //enable timer to recheck if it's connected\n    }\n    else //it isn't connected\n    {  \n\n        serialPort1.DataReceived += new System.IO.Ports.SerialDataReceivedEventHandler(serialPort1_DataReceived);\n        if (serialPort1.IsOpen)\n        {\n            serialPort1.Close();\n        }\n        serialPort1.Open();   \n\n        timerStep.Enabled = true;\n    }    \n}  \n</code></pre>\n\n<p>Now comes the issue, in the serialPort1_DataReceived I check the data and set a variable which is tested by the timerStep and it make some steps. </p>\n\n<p><strong>The problem occurs</strong> in the DataReceived event, the thing is that when I run the following code outside of a thread it works fine, it does all the job and make the connection, <strong>but</strong> in the thread it doesn't work. I test this adding some <code>MessageBox</code>and I realize that the ones inside the DataReceive never appear. </p>\n\n<pre><code>void serialPort1_DataReceived(object sender, System.IO.Ports.SerialDataReceivedEventArgs e)\n{\n    byte[] data = new byte[1024];\n    int n = serialPort1.Read(data, 0, data.Length);\n    string rec = Encoding.GetEncoding(\"windows-1252\").GetString(data, 0, n);\n\n    if (string.IsNullOrEmpty(rec))\n    {\n        return;\n    }\n\n    if (rec.Contains(\"AT+CIMI\") &amp;&amp; rec.Contains(\"OK\"))\n    {\n        MessageBox.Show(\"serialPort 1\");\n        currState = 1;\n    }\n    else if (rec.Contains(\"READY\"))\n    {\n        MessageBox.Show(\"serialPort 11\");\n        currState = 1;\n    }\n    else if (rec.Contains(\"0,1\") || rec.Contains(\"0,5\"))\n    {\n        MessageBox.Show(\"serialPort 2\");\n        currState = 2;\n    }\n}\n</code></pre>\n\n<p>So by some reason the serialPort isn't receiving anything and I can't figure it out why. The fact that it works outside the thread but not in the thread is frustrating me.</p>\n\n<p>I appreciate any help. Thanks in advanced!</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":11623093,"title":"Java Proxy Connections through multiple thread","body":"<p>I have few questions as below:</p>\n\n<p>1) I have a Java program which tryning to connect through different Proxy Servers by using multiple thread (about 100 threads). May I know that what factors determine the maximum number of such connections? What actually is the maximum number of proxy connection (or non-proxy) that our OS allowed to have in one process?</p>\n\n<p>2) According to my experience, when I want to set the proxy server in my pc, I will to IE's \"options settings\" to change it. When I am using Google Chrome, the proxy settings will go through the IE's \"options settings\" as well (I don't know why chrome uses IE's function). So, can I assume that our OS only allow one proxy server connection at one time?</p>\n\n<pre><code>Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(ipAdd, portNum));\nHttpURLConnection uc = (HttpURLConnection)Main.targetMachine.openConnection(proxy);\nuc.setConnectTimeout(Main.timeOut);\nuc.setReadTimeout(Main.timeOut);\n</code></pre>\n\n<p>I create multiple thread to handle the connections as above. They gave me all the \"timeout\" error. What could be the reasons?</p>\n"},{"tags":["multithreading","jlist","jnetpcap"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":12802707,"title":"JList updating with live captured packets info (using jNetPcap) is causing list blanking","body":"<p>I am coding app which is capturing packet from 2 NI Cards at the same time in specific thread for them. </p>\n\n<p>I am using jnetPcap and I am getting captured packet in jpackethanler's method nextPacket i need to show info from the current packet in JList but when I use simply defaultListModel and i write model1.addElement(packetinfo) then JList randomly goes in blank.</p>\n\n<p>My code :</p>\n\n<pre><code>new Thread(){\n\n    @Override\n    public void run(){\n\n    StringBuilder errbuf = new StringBuilder(); // For any error msgs\n\n    int snaplen = 64 * 1024;           // Capture all packets, no trucation  \n    int flags = Pcap.MODE_PROMISCUOUS; // capture all packets  \n    int timeout = 10 * 1000;           // 10 seconds in millis\n\n    Pcap pcap1 =  \n        Pcap.openLive(Variables.getDevice1().getName(), snaplen, flags, timeout, errbuf);  \n\n    if (pcap1 == null) {  \n        System.err.printf(\"Error while opening device for capture: \"  \n            + errbuf.toString());  \n        return;  \n    }\n\n    PcapPacketHandler&lt;String&gt; jpacketHandler1 = new PcapPacketHandler&lt;String&gt;() {  \n\n        int count = 1;\n\n        @Override\n        public void nextPacket(PcapPacket packet, String user) {  \n\n            // ALL PACKETS FROM DEVICE 1 HERE\n            int packetSize = packet.size();\n            int packetCount = count++;\n\n            String desc = String.format(\"No.: %15d | HDRSize : %-4d\", packetCount,packetSize);\n\n            device1Model.addElement(desc); // this adds desc to JLIST\n\n        }\n    };  \n\n    pcap1.loop(Pcap.LOOP_INFINITE, jpacketHandler1, \"\");\n    pcap1.close();\n\n    }\n}.start();\n</code></pre>\n\n<p>What do change to be more smooth and at the same time there will be no packet looses. Because i need to catch every packet for right function of app. </p>\n\n<p>Thank You.</p>\n"},{"tags":["java","multithreading","jvm","hung"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12801417,"title":"Strange JVM thread hangs - suggestions to troubleshoot?","body":"<p>While troubleshooting one of the jvm hung issues in our production environment, we encountered that one of threads which executes the following logger statement</p>\n\n<pre><code>logger.debug(\"Loaded ids as \" + ids + \".\");\n</code></pre>\n\n<p>is hung at this step with the thread status as runnable. Here ids is a Set. There is another thread which waits on the above thread through a count down latch to complete its task. The software takes thread dumps every 15 mins and the stacktraces of the two threads look as below</p>\n\n<pre><code>Stack trace for [THREAD GROUP: Job_Executor] [THREAD NAME:main-Runner Thread][THREAD STATE: WAITING]\n    ...sun.misc.Unsafe.park(Native Method)\n    ...java.util.concurrent.locks.LockSupport.park(Unknown Source)\n    ...java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(Unknown Source)\n    ...java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(Unknown Source)\n    ...java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(Unknown Source)\n    ...java.util.concurrent.CountDownLatch.await(Unknown Source)\n    ...com.runner.MainRunner.stopThread(MainRunnerRunner.java:1334)\n\n\nStack trace for [THREAD GROUP: Job_Executor] [THREAD NAME:task executor][THREAD STATE: RUNNABLE]    \n    ...java.util.AbstractCollection.toString(Unknown Source)           \n    ...java.lang.String.valueOf(Unknown Source)      \n    ...java.lang.StringBuilder.append(Unknown Source)    \n    ...com.runner.CriticalTaskExecutor.loadByIds(CriticalTaskExecutor.java:143)\n</code></pre>\n\n<p>This jvm got hung for almost 24 hrs and finally we had to kill it to move ahead. The thread dumps indicates that there are 43 threads in RUNNABLE state including the above one. </p>\n\n<p>What could be the reasons for the above thread to be in RUNNABLE state for 24 hrs just executing collection.toString()? </p>\n\n<p>Any suggestions on how to proceed?</p>\n"},{"tags":["java","multithreading","spring","hashset"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":357,"score":0,"question_id":5287996,"title":"looping over static Set- java","body":"<p>I have in my code:</p>\n\n<pre><code>public static Set&lt;Long&gt; workItemsForTasks = new HashSet&lt;Long&gt;();\n</code></pre>\n\n<p>It's a web application, and during the code the users can add new items to the map - and I add in the code like this:</p>\n\n<pre><code>WorkflowOperations.workItemsForTasks.add(workItem.getId());\n</code></pre>\n\n<p>Once the workflow reaches a specific code, I loop over the map like this:</p>\n\n<pre><code> Iterator workItemsIter = service.workItemsForTasksToBMS.iterator();\n   while (workItemsIter.hasNext()) {\nworkItemsIter.remove();\n\n    ...\n    }\n</code></pre>\n\n<p>My question is:</p>\n\n<p>Once I get the iterator - if another user added a new item to the map (since it's not in the same internet page) - will it influence the map while I loop over it? Or retrieving the iterator ensures me that it holds the map size up to the time that the looping started? </p>\n\n<p><strong>EDITED</strong></p>\n\n<p>It's a web application that accepts different web service calls.</p>\n\n<p>In Call A the users might add data that in Call B I need to handle.</p>\n\n<p>So I defined a singleton class (via spring bean) which holds the Set of data that I need to handle (the data is numbers) and I modify the Set each time that I have web service Call A. once the user asks for web service Call B - I have to collect the data so far and execute something with it.</p>\n"},{"tags":["ruby","multithreading","functional-programming","side-effects"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12790815,"title":"Is creating threads in YARV Ruby generally regarded as a side-effect from a FP perspective?","body":"<p>If a Ruby method creates threads, but joins them within the method, is that still considered a side-effect from a functional programming perspective? The implementation I'm using is YARV Ruby, in which threads are created by the operating system, albeit with a GVL (Global VM Lock).</p>\n\n<p>The reason the threads are being created is to do <code>system</code> calls, which is a side effect anyway, but I've never come across anyone saying whether threads are or aren't a side effect.</p>\n\n<p>Simplified pseudo-code for this would look somewhat like the following:</p>\n\n<pre><code>  def run_tasks\n    input_files = (1..4).map {|i| \"input_#{i}\"}\n    output_files = (1..4).map {|i| \"output_#{i}\"}\n    threads = [input_files, output_files].transpose.map |input_file, output_file|\n      # system itself is a side effect\n      Thread.new { system([\"sub_program.rb\", input_file, output_file]) }\n    end\n    threads.map(&amp;:join)\n  end\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":87,"score":4,"question_id":12801674,"title":"How can I pass a just object instance to a thread in java, so that even if the instance value gets updated should not effect the thread using it","body":"<p>I am developing an application in which I continuously receive messages. I am storing these messages in an in-memory data structure (say List). I want to write those messages to a file but only after list size reaches some threshold value say 100 messages (perform batch processing on the messages).\nOne way is I can simply check the list size after every message is received and call a function to write messages to a file if Threshold value is reached. But the problem with this approach is: </p>\n\n<ol>\n<li>Calling function may need to wait indefinitely until all the messages are written to the file</li>\n<li>The incoming messages may be lost in the process or might need to wait for getting stored in the List.   </li>\n</ol>\n\n<p>Other way could be to spawn a new thread, which will write messages to a file independently. But when I pass the list (containing messages) to the thread for performing write operation, it gets updated with new messages which are continuously coming in. As a result newly arrived messages also gets written to the file which is not expected.</p>\n\n<p>This should not happen as I am intending the new messages to be written in the next batch.</p>\n\n<p>Can someone suggest me a solution for this requirement, or any improvements in the above approach that can solve my issues. </p>\n"},{"tags":["java","android","multithreading","runnable"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":1386,"score":2,"question_id":9029795,"title":"new Runnable() but no new thread?","body":"<p>I'm trying to understand the code <a href=\"http://developer.android.com/resources/articles/timed-ui-updates.html\" rel=\"nofollow\">here</a> , specifically the anonymous class</p>\n\n<pre><code>private Runnable mUpdateTimeTask = new Runnable() {\npublic void run() {\n   final long start = mStartTime;\n   long millis = SystemClock.uptimeMillis() - start;\n   int seconds = (int) (millis / 1000);\n   int minutes = seconds / 60;\n   seconds     = seconds % 60;\n\n   if (seconds &lt; 10) {\n       mTimeLabel.setText(\"\" + minutes + \":0\" + seconds);\n   } else {\n       mTimeLabel.setText(\"\" + minutes + \":\" + seconds);            \n   }\n\n   mHandler.postAtTime(this,\n           start + (((minutes * 60) + seconds + 1) * 1000));\n   }\n};\n</code></pre>\n\n<p>The article says </p>\n\n<blockquote>\n  <p>The Handler runs the update code as a part of your main thread, avoiding the overhead of a second thread..</p>\n</blockquote>\n\n<p>Shouldn't creating a new Runnable class make a new second thread? What is the purpose of the Runnable class here apart from being able to pass a Runnable class to postAtTime?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","multithreading","sql-server-2008-r2","database-migration","database-performance"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12801241,"title":"SQL schema migration runs single-threaded","body":"<p>I have a 12-core setup, and a 50 Gig database that needs to be migrated.  I can see in process explorer that it's running on a single core.  Is there a benefit from running this process multi-core, and if so, how would I enable that?</p>\n"},{"tags":["java","multithreading","file"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12796750,"title":"Which thread is using file","body":"<p>I am writing file and closing stream after writing. In finally I am deleting file.\nBut I am still  able to find file after program execution is complete. Its Multi threaded environment. </p>\n\n<p>So is it possible to check it is being used by which function or which thread?</p>\n\n<p>Updated with code : <br></p>\n\n<pre><code> File p_file = new File(\"C:\\\\\", \"GUID\");\n p_file.createNewFile();\n\n FileOutputStream fos = null;\ntry {\n  fos = new FileOutputStream(p_file);\n  fos.write(\"This is test msg.\".getBytes());\n} finally {\n  try {\n         fos.close();\n      } catch (IOException e) {\n                e.printStackTrace();\n      }\n      if(p_file.exists())\n   System.out.println(p_file.delete());\n}\n}\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["java","multithreading","concurrency","synchronization","semaphore"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":642,"score":1,"question_id":7359005,"title":"Simple Java code allow single thread access and other threads to skip/move on","body":"<p>In others words I don't want a thread to wait if it cannot access the lock (as in synchonization), I want to thread execution to simply return immediately at that point if it cannot obtain the lock.</p>\n\n<p>As simple boolean lock like this would potentially allow more than one thread to access.</p>\n\n<pre><code>private static boolean lockAvailable = true;\n\nprivate boolean acquireLock() {\n  if(lockAvailable) {\n    lockAvailable = false;\n    return true;\n  }\n  return false;\n}\n</code></pre>\n\n<p>Am I missing something? What is the best/simplest way to achieve this?</p>\n\n<p>Edit:</p>\n\n<p>Thanks for pointing out Semaphore (!)</p>\n\n<p>So looking at it again this code is bullet proof?</p>\n\n<pre><code>private final static Semaphore lock = new Semaphore(1, true);   \n\npublic void tryAndDoSomething() {\n  if(lock.tryAcquire()) {\n    try {\n      // only single thread can access here at one time\n    } finally {\n      lock.release();\n    }\n  }\n}\n</code></pre>\n\n<p>Update:</p>\n\n<p>I realised I needed reentrant capability so I created a simple non blocking reentrant. Posting the code for anyone that is interested in how you might do this. Anyone who wants this type of functionality should of course use the <em>existing</em> Java Class java.util.concurrent.locks.ReentrantLock :|</p>\n\n<pre><code>import java.util.concurrent.atomic.AtomicBoolean;\nimport java.util.concurrent.atomic.AtomicInteger;\n\n/**\n * SimpleNonBlockingLock ensures that only a single thread can call protected code at any one time,\n * while allowing other threads to by pass the protected code if the lock is unavailable.\n * The thread owning the lock can access any code protected by the lock (the lock is 'reentrant').\n * To function correctly the protected code must be executed in a try/finally blocks. The\n * finally block must call the tryRelease. Example code:\n * \n *  private final SimpleNonBlockingLock lock = new SimpleNonBlockingLock();\n * \n *  if(lock.tryAcquire()) {\n *      try {\n *              // access protected code\n *      } finally {\n *          lock.tryRelease();\n *      }\n *  }\n *\n * This code is for demonstration only and should not be used. I have tested it and it 'seems to' work.\n * However it may contain horrific bugs!\n * \n * The Java class java.util.concurrent.locks.ReentrantLock has been around since Java 5.0 and contains all (and more) \n * of this functionality. Its also been thoroughly tested!\n */\npublic class SimpleNonBlockingLock {\n\n    // Atomic locking mechanism\n    private final AtomicBoolean locked = new AtomicBoolean();\n\n    // Atomic integer containing the next thread ID to be assigned\n    private static final AtomicInteger nextId = new AtomicInteger(0);\n\n    // Unique ID of thread which currently has lock\n    private int threadUniqueId = -1;\n\n    // Tracks number of tryAcquire calls made by thread with lock\n    private int lockCount = 0;\n\n    // Thread local variable containing each thread's ID\n    private static final ThreadLocal&lt;Integer&gt; threadId = new ThreadLocal&lt;Integer&gt;() {\n            @Override protected Integer initialValue() {\n                return nextId.getAndIncrement();\n        }\n    };\n\n    public synchronized boolean tryAcquire() {      \n        // Allow owning thread to acquire\n        if(threadUniqueId == getCurrentThreadUniqueId()) {\n            lockCount++;\n            return true;\n        }       \n        // If locked then do not allow\n        if (locked.get()) {return false;}           \n        // Attempt to acquire lock      \n        boolean attemptAcquire = locked.compareAndSet(false, true);     \n        // If successful then set threadUniqueId for the thread, and increment lock count\n        if(attemptAcquire) {\n            threadUniqueId = getCurrentThreadUniqueId();\n            lockCount++;\n        }       \n        // Return result of attempt to acquire lock\n        return attemptAcquire;\n    }\n\n    public synchronized boolean tryRelease() {\n        if (!locked.get()) {\n            // Lock is currently available - no need to try and release\n            return true;\n        } else {\n            // Decrement the lock count\n            lockCount--;\n            // If lock count is zero we release lock, and reset the threadUniqueId\n            if(lockCount == 0) {\n                threadUniqueId = -1;\n                return locked.compareAndSet(true, false);\n            } \n            return false;\n        }   \n    }\n\n    // Returns the current thread's unique ID, assigning it if necessary\n    public static int getCurrentThreadUniqueId() {      \n        return threadId.get();\n    }   \n}\n</code></pre>\n"},{"tags":["java","multithreading","mutex","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":382,"score":0,"question_id":10020024,"title":"Producer/Consumer using Semaphore; getting deadlock","body":"<p>According to <a href=\"http://en.wikipedia.org/wiki/Producer-consumer_problem\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Producer-consumer_problem</a> I want to simulate P/C problem using semaphore. I am getting deadlock and I don't know what is problem.</p>\n\n<pre><code>public static void main(String[] args) {\n        CustomBlockingQueue blockingQueue = new CustomBlockingQueue();\n        new Thread(new Producer(blockingQueue)).start();\n        new Thread(new Consumer(blockingQueue)).start();\n    }\n}\n\n@SuppressWarnings(\"serial\")\nclass CustomBlockingQueue extends LinkedList&lt;Object&gt; {\n    private static final int MAX_SIZE = 10;\n\n    private Semaphore mutex = new Semaphore(1);\n    private Semaphore fillCount = new Semaphore(0);\n    private Semaphore emptyCount = new Semaphore(MAX_SIZE);\n\n    @Override\n    public boolean offer(Object e) {\n        try {\n            mutex.acquire();\n        } catch (InterruptedException e2) {\n            e2.printStackTrace();\n        }\n        boolean result = super.offer(e);\n        System.out.println(\"offer \" + size());\n        try {\n            fillCount.release();\n            emptyCount.acquire();\n            mutex.release();\n        } catch (InterruptedException e1) {\n            e1.printStackTrace();\n        }\n        return result;\n    }\n\n    @Override\n    public Object poll() {\n        try {\n            mutex.acquire();\n        } catch (InterruptedException e2) {\n            e2.printStackTrace();\n        }\n        Object result = super.poll();\n        System.out.println(\"poll  \" + size());\n        try {\n            emptyCount.release();\n            fillCount.acquire();\n            mutex.release();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        return result;\n    }\n}\n\nclass Producer implements Runnable {\n    private CustomBlockingQueue blockingQueue;\n    private Random random = new Random();\n\n    public Producer(CustomBlockingQueue blockingQueue) {\n        this.blockingQueue = blockingQueue;\n    }\n\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            try {\n                TimeUnit.SECONDS.sleep(random.nextInt(2));\n                blockingQueue.offer(new Object());\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nclass Consumer implements Runnable {\n    private CustomBlockingQueue blockingQueue;\n    private Random random = new Random();\n\n    public Consumer(CustomBlockingQueue blockingQueue) {\n        this.blockingQueue = blockingQueue;\n    }\n\n    @Override\n    public void run() {\n        while (!Thread.currentThread().isInterrupted()) {\n            try {\n                TimeUnit.SECONDS.sleep(random.nextInt(4));\n                blockingQueue.poll();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n</code></pre>\n\n<p>Using semaphores</p>\n\n<p>Semaphores solve the problem of lost wakeup calls. In the solution below we use two semaphores, fillCount and emptyCount, to solve the problem. fillCount is the number of items to be read in the buffer, and emptyCount is the number of available spaces in the buffer where items could be written. fillCount is incremented and emptyCount decremented when a new item has been put into the buffer. If the producer tries to decrement emptyCount while its value is zero, the producer is put to sleep. The next time an item is consumed, emptyCount is incremented and the producer wakes up. The consumer works analogously.</p>\n"},{"tags":["java","multithreading","producer-consumer","blockingqueue"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":86,"score":2,"question_id":12795234,"title":"Issues with Implementing Multiple Consumer Multiple Producer in Java","body":"<p>I wrote a simple consumer-producer problem with a blocking queue that has multiple producers and multiple consumers take and putting integers on  the queue. However, when I tried to testing it, the results aren't as desired such as the size of the queue is not correct. I don't think the consumer and producer size are syncing together. Moreover, I put a 2 second sleep on both producer and consumer but when testing, every two seconds it prints out the results of 2 producers and 2 consumers. Does anyone know what I am doing wrong? Maybe I am starting the threads wrong? I commented out another way I did it but the results were still wrong. </p>\n\n<p>Results:</p>\n\n<pre><code>run:\nProducing 425     Thread-0 size left 0\nConsuming 890     Thread-3 size left 0\nConsuming 425     Thread-2 size left 0\nProducing 890     Thread-1 size left 0\nConsuming 192     Thread-2 size left 0\nConsuming 155     Thread-3 size left 0\nProducing 155     Thread-1 size left 0\nProducing 192     Thread-0 size left 0\nConsuming 141     Thread-2 size left 1\nProducing 141     Thread-0 size left 0\nProducing 919     Thread-1 size left 0\nConsuming 919     Thread-3 size left 0\nProducing 361     Thread-1 size left 0\nProducing 518     Thread-0 size left 0\nConsuming 518     Thread-3 size left 0\nConsuming 361     Thread-2 size left 0\nProducing 350     Thread-0 size left 1\nConsuming 350     Thread-3 size left 0\nConsuming 767     Thread-2 size left 0\nProducing 767     Thread-1 size left 0\n</code></pre>\n\n<p>Producer</p>\n\n<pre><code>import java.util.Random;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\npublic class Producer implements Runnable {\n\n    BlockingQueue&lt;Integer&gt; items = new LinkedBlockingQueue&lt;&gt;();\n\n    public Producer(BlockingQueue&lt;Integer&gt; q) {\n        this.items = q;\n    }\n\n    private int generateRandomNumber(int start, int end) {\n        Random rand = new Random();\n        int number = start + rand.nextInt(end - start + 1);\n        return number;\n    }\n\n    public void run() {\n        for (int i = 0; i &lt; 5; i++) {\n            int rand = generateRandomNumber(100, 1000);\n            try {\n                items.put(rand);\n                System.out.println(\"Producing \" + rand + \"     \" + Thread.currentThread().getName() + \" size left \" + items.size());\n                Thread.sleep(3000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(ProducerConsumer.class.getName()).log(Level.SEVERE, null, ex);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Consumer</p>\n\n<pre><code>import java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\npublic class Consumer implements Runnable {\n\n    BlockingQueue&lt;Integer&gt; items = new LinkedBlockingQueue&lt;&gt;();\n\n    public Consumer(BlockingQueue&lt;Integer&gt; q) {\n        this.items = q;\n    }\n\n    public void run() {\n        while (true) {\n            try {\n                System.out.println(\"Consuming \" + items.take() + \"     \" + Thread.currentThread().getName() + \" size left \" + items.size());\n                Thread.sleep(3000);\n            } catch (InterruptedException ex) {\n                Logger.getLogger(ProducerConsumer.class.getName()).log(Level.SEVERE, null, ex);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Test</p>\n\n<pre><code>import java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\n\npublic class ProducerConsumer {\n    public static void main(String args[]) {\n        BlockingQueue&lt;Integer&gt; items = new LinkedBlockingQueue&lt;&gt;();\n\n        Producer producer = new Producer(items);\n        Consumer consumer = new Consumer(items);\n        Thread t1 = new Thread(producer);\n        Thread t2 = new Thread(producer);\n        Thread t3 = new Thread(consumer);\n        Thread t4 = new Thread(consumer);\n        /*\n        Thread t1 = new Thread(new Producer());\n        Thread t2 = new Thread(new Producer());\n        Thread t3 = new Thread(new Consumer());\n        Thread t4 = new Thread(new Consumer());\n        */\n        t1.start();\n        t2.start();\n        t3.start();\n        t4.start();\n    }\n}\n</code></pre>\n\n<p><strong>UPDATE: I tried to implement the reentrant lock but my program stops at the lock line. Any help?</strong>\nConsumer</p>\n\n<pre><code>import java.util.concurrent.locks.ReentrantReadWriteLock;\n\npublic class Consumer implements Runnable { \n\n    //private BlockingQueue&lt;Integer&gt; items = new LinkedBlockingQueue&lt;&gt;(); \n    private MyBlockingQ items;\n\n    public Consumer(MyBlockingQ q) { \n        this.items = q; \n    } \n\n    public void run() { \n        while (true) { \n            items.remove();\n            //Thread.sleep(1000);\n        }\n    }\n} \n</code></pre>\n\n<p>Producer</p>\n\n<pre><code>import java.util.Random;\n\npublic class Producer implements Runnable {\n    private MyBlockingQ items;\n    public Producer(MyBlockingQ q) {\n        this.items = q;\n    }\n\n    private int generateRandomNumber(int start, int end) {\n        Random rand = new Random();\n        int number = start + rand.nextInt(end - start + 1);\n        return number;\n    }\n\n    public void run() {\n        for (int i = 0; i &lt; 5; i++) {\n            int rand = generateRandomNumber(100, 1000);\n            items.add(rand);\n        }\n    }\n}\n</code></pre>\n\n<p>MyBlockingQ (shared resouce)</p>\n\n<pre><code>import java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\npublic class MyBlockingQ {\n\n    private BlockingQueue&lt;Integer&gt; items = new LinkedBlockingQueue&lt;&gt;();\n    private final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();\n\n    public MyBlockingQ() {\n    }\n\n    public void add(Integer i) {\n        lock.writeLock().lock();\n        try {\n            items.put(i);\n            System.out.println(\"Producing \" + i + \"     \" + Thread.currentThread().getName() + \" size left \" + items.size());\n        } catch (InterruptedException ex) {\n            Logger.getLogger(ProducerConsumer.class.getName()).log(Level.SEVERE, null, ex);\n        } finally {\n            lock.writeLock().unlock();\n        }\n    }\n\n    public void remove() {\n        lock.writeLock().lock();\n        try {\n            int taken = items.take();\n            System.out.println(\"Consuming \" + taken + \"     \" + Thread.currentThread().getName() + \" size left \" + items.size());\n        } catch (InterruptedException ex) {\n            Logger.getLogger(ProducerConsumer.class.getName()).log(Level.SEVERE, null, ex);\n        } finally {\n            lock.writeLock().unlock();\n        }\n    }\n}\n</code></pre>\n\n<p>Test</p>\n\n<pre><code>import java.util.concurrent.BlockingQueue; \nimport java.util.concurrent.LinkedBlockingQueue; \n\npublic class ProducerConsumer { \n    public static void main(String args[]) { \n        MyBlockingQ items = new MyBlockingQ(); \n\n        System.out.println(\"starting\");\n        Thread t1 = new Thread(new Producer(items)); \n        Thread t2 = new Thread(new Producer(items)); \n        Thread t3 = new Thread(new Consumer(items)); \n        Thread t4 = new Thread(new Consumer(items)); \n        t1.start(); \n        t2.start(); \n        t3.start(); \n        t4.start(); \n    } \n} \n</code></pre>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12795439,"title":"SmartThreadPool Blocking UI Thread","body":"<p>I am running the following code when i click on a button:</p>\n\n<pre><code>                foreach (string item in urlQueue)\n                {\n\n                    log(\"creating job \" + iia.ToString());\n                    _smartThreadPool.QueueWorkItem(\n                        new Amib.Threading.Func&lt;string, int, int, string, int&gt;(checkURLSmart),\n                        item, iia, 5000, kryptonTextBox1.Text);\n\n                    iia++;\n                }\n\n                Application.DoEvents();\n\n                _smartThreadPool.Start();\n\n                _smartThreadPool.WaitForIdle();\n                _smartThreadPool.Shutdown();\n</code></pre>\n\n<p>For some reason this is blocking the UI thread, any ideas how to fix this? I want the UI to be responsive while the queue is working</p>\n"},{"tags":["c#","multithreading","thread-safety","rabbitmq"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12024241,"title":"C# RabbitMQ Client thread safety","body":"<pre><code>        ConnectionFactory factory = new ConnectionFactory {HostName = \"localhost\"};\n\n        using (IConnection connection = factory.CreateConnection())\n        using (IModel channel = connection.CreateModel())\n        {\n            channel.QueueDeclare(\"hello\", false, false, false, null);\n            for (int i = 0; i &lt; 100000; i++)\n            {\n                MemoryStream stream = new MemoryStream();\n\n                var user = new User \n                               {\n                                   Id = i\n                               };\n\n                Serializer.Serialize(stream, user);\n\n\n                channel.BasicPublish(\"\", \"hello\", null, stream.ToArray());\n\n            }\n\n        }\n</code></pre>\n\n<p>I have the following code above, and i m curious about thread safety.</p>\n\n<p>I am not sure, but i would imagine ConnectionFactory is thread safe. Then not sure if IConnection is thread safe? should i create connection per request? or single persistent connection? and how about channel? </p>\n\n<p>Also, should i put store the connection at ThreadLocal ? or should i create a connection per request? </p>\n"},{"tags":["java","android","multithreading","urlconnection","httpconnection"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":112,"score":0,"question_id":12755290,"title":"It is possible to stop a thread that is connecting to URL with httpConnection.connect()?","body":"<p>i have a thread that is connecting to a url to obtaining some data.</p>\n\n<p>Sometimes the method <code>httpConnection.connect();</code> taked too munch time to get the response, and i want to limit the loading dialog of this connection thread to 5 seg.</p>\n\n<p>I tryed adding timeouts into the code, <strong>but it doesn't work</strong>!!</p>\n\n<pre><code>URL formattedUrl = new URL(url); \n            URLConnection connection = formattedUrl.openConnection(); \n            connection.setConnectTimeout(5000);\n            connection.setReadTimeout(5000);\n            HttpURLConnection httpConnection = (HttpURLConnection) connection;\n            httpConnection.setAllowUserInteraction(false);\n            httpConnection.setInstanceFollowRedirects(true);\n            httpConnection.setRequestMethod(\"GET\");\n            httpConnection.setConnectTimeout(5000);\n            httpConnection.setReadTimeout(5000);\n            httpConnection.connect();\n</code></pre>\n\n<p>So, i must stop the connect method and the thread when 5000 seconds have passed or when the used has pressed the back key on the phone.</p>\n\n<p>How can this be achieved? i can't find info about doing this work in android with a url connection thread.</p>\n\n<p>thanks</p>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":12796723,"title":"Android purpose of Handler Thread","body":"<p>I was just wondering why the Handler has to take an instance of a Runnable ? After all a Handler purpose is place work from one thread into another Thread. What is the purpose of using a Third thread, a Runnable to accomplish this ?</p>\n\n<p>Kind Regards,</p>\n"},{"tags":["java","multithreading","swing","modal","jdialog"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":772,"score":3,"question_id":3954120,"title":"Swing modal dialog refuses to close - sometimes!","body":"<pre><code>// This is supposed to show a modal dialog and then hide it again. In practice,\n// this works about 75% of the time, and the other 25% of the time, the dialog\n// stays visible.\n// This is on Ubuntu 10.10, running:\n// OpenJDK Runtime Environment (IcedTea6 1.9) (6b20-1.9-0ubuntu1)\n\n// This always prints\n// setVisible(true) about to happen\n// setVisible(false) about to happen\n// setVisible(false) has just happened\n// even when the dialog stays visible.\n\npackage modalproblemdemo;\n\nimport java.awt.Frame;\nimport javax.swing.JDialog;\nimport javax.swing.SwingUtilities;\n\npublic class Main {\n    public static void main(String[] args) {\n        final Dialogs d = new Dialogs();\n        new Thread() {\n            @Override\n            public void run() {\n                d.show();\n                d.hide();\n            }\n        }.start();\n    }\n\n    static class Dialogs {\n        final JDialog dialog;\n\n        public Dialogs() {\n            dialog = new JDialog((Frame) null, \"Hello World\", /*modal*/ true);\n            dialog.setSize(400, 200);\n        }\n\n        public void show() {\n            SwingUtilities.invokeLater(new Runnable() { public void run() {\n                dialog.setLocationRelativeTo(null);\n                System.out.println(\"setVisible(true) about to happen\");\n                dialog.setVisible(true);\n            }});\n        }\n\n        public void hide() {\n            SwingUtilities.invokeLater(new Runnable() { public void run() {\n                System.out.println(\"setVisible(false) about to happen\");\n                dialog.setVisible(false);\n                System.out.println(\"setVisible(false) has just happened\");\n            }});\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","semaphore","java.util.concurrent"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":164,"score":3,"question_id":3985648,"title":"What happens to a Thread that fails to acquire a Semaphore?","body":"<p>What happens when a thread cannot acquire a Semaphore (due to lack of permit). Will it be moved to the wait state? </p>\n\n<p>EDIT:Will the thread start resume the previous execution sequence, when the semaphore becomes available.</p>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":346,"score":2,"question_id":7880599,"title":"Semaphore with Read/Write Lock","body":"<p>If a thread has lock on any object, can read methods still work ?</p>\n\n<p>If I have object with various 'get' methods than can I use the object to do print outs while some other thread has lock on it ? I am working on project where object has various properties, which I need to print it out periodically. However, there are other threads running which may gain lock to write those properties. I am using Semaphore for synchronization. Also, I will be doing more reading than writing. What is the best approach to tackle these situation ?</p>\n"},{"tags":["c++","multithreading","boost"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12796421,"title":"join() throws thread_resource_error?","body":"<p>I'm in a situation where calling <code>join()</code> on a <code>boost::thread</code> object throws a <code>thread_resource_error</code> exception. Looking at the <a href=\"http://www.boost.org/doc/libs/1_51_0/doc/html/thread/thread_management.html#thread.thread_management.thread.join\" rel=\"nofollow\">documentation</a> there is no mention of that this method could throw such an exception.</p>\n\n<p>I'm not quite sure where to start debugging this. Any suggestions as to what could cause this?</p>\n"},{"tags":["java","multithreading","concurrency","deadlock","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":909,"score":0,"question_id":1205430,"title":"Deadlock on a single java semaphore?","body":"<p>In one of my recent answers, I gave a <em>theoretical</em> semaphore example of limiting access to memory resources:</p>\n\n<pre><code>public static byte[] createArray(int size) throws InterruptedException {\n    semaphore.acquire(size);\n    return new byte[size];\n}\npublic static void releaseArray(byte[] array) {\n    semaphore.release(array.length);\n}\n</code></pre>\n\n<p>I think this can be a source of deadlock if the allocation interleaving is bad:</p>\n\n<pre><code>semaphore = new Sempaphore(30, true);\n// T1                                 T2\n//--------------------------          ----------------------\na1 = createArray(10);                                           // 20\n                                      a3 = createArray(10);     // 10\na2 = createArray(15);                                           // wait\n                                      a4 = createArray(15);     // wait\n// ...                                // ...\nreleaseArray(a1);                     releaseArray(a3);\nreleaseArray(a2);                     releaseArray(a4);\n</code></pre>\n\n<p>Is my observation true? If yes, how can I avoid this situation (e.g timed wait and rollback)?</p>\n"},{"tags":["java","multithreading","concurrency","semaphore"],"answer_count":4,"favorite_count":7,"up_vote_count":19,"down_vote_count":0,"view_count":10180,"score":19,"question_id":184147,"title":"CountDownLatch vs. Semaphore","body":"<p>Is there an advantage to using <a href=\"http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html\" rel=\"nofollow\">java.util.concurrent.CountdownLatch</a> instead of <a href=\"http://java.sun.com/javase/6/docs/api/java/util/concurrent/Semaphore.html\" rel=\"nofollow\">java.util.concurrent.Semaphore</a>?  As far as I can tell the following fragments are almost equivalent:</p>\n\n<p>1:</p>\n\n<pre><code>final Semaphore sem = new Semaphore(0);\nfor (int i = 0; i &lt; num_threads; ++ i)\n{\n  Thread t = new Thread() {\n    public void run()\n    {\n      try\n      {\n        doStuff();\n      }\n      finally\n      {\n        sem.release();\n      }\n    }\n  };\n  t.start();\n}\n\nsem.acquire(num_threads);\n</code></pre>\n\n<p>2: </p>\n\n<pre><code>final CountDownLatch latch = new CountDownLatch(num_threads);\nfor (int i = 0; i &lt; num_threads; ++ i)\n{\n  Thread t = new Thread() {\n    public void run()\n    {\n      try\n      {\n        doStuff();\n      }\n      finally\n      {\n        latch.countDown();\n      }\n    }\n  };\n  t.start();\n}\n\nlatch.await();\n</code></pre>\n\n<p>Except that in case #2 the latch cannot be reused and more importantly you need to know in advance how many threads will be created (or wait until they are all started before creating the latch.)</p>\n\n<p>So in what situation might the latch be preferable?</p>\n"},{"tags":["java","multithreading","concurrency","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":9789073,"title":"Incrementing Semaphore permits, in Java","body":"<p>Can I add more permit to a semaphore in Java?</p>\n\n<pre><code>Semaphore s = new Semaphore(3);\n</code></pre>\n\n<p>After this somewhere in the code i want to change the permits to 4. Is this possible?</p>\n"},{"tags":["java","multithreading","concurrency","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":11467297,"title":"Java - extensive semaphore usage","body":"<p>In a server that i write each client handler object include a semaphore for some usages, as there can be many client handlers - I wanted to know if there is a limitation to the number of semaphores a program can hold?</p>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":62,"score":4,"question_id":10526178,"title":"Java unbounded counted semaphore?","body":"<p>I need to provide a method that blocks until all outstanding work in a BlockingQueue has been processed.</p>\n\n<p>I was thinking I could handle this with a counted semaphore which would start at 0 and decrement as items are added to the queue and increment as they are completed. finish() would just acquire the semaphore, release it again and leave.</p>\n\n<p>I could perhaps call reducePermits(). Does this work if permit count is already &lt; 0? It's protected, so I would need to extend the Semaphore class to make it work.</p>\n\n<p>My second best idea is to check the contents of the queue in a loop and sleep 100ms or so between checks. It works but seems kludgey.</p>\n\n<p>Does this make sense? Anybody have an easier / cleaner way to suggest?</p>\n\n<p>TIA,\n    - Tim.</p>\n\n<pre><code>public MyClass {\n  public class MySemaphore extends Semaphore {\n    public void seize() {\n      reducePermits(1);\n    }\n  }\n  private MySemaphore allDone = new MySemaphore();\n  void startSomething() {\n    allDone.seize();\n  }\n  void finishSomething() {\n    allDone.release();\n  }\n  void finish() {\n    allDone.acquire();\n    allDone.release();\n  }\n}\n</code></pre>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":97,"score":-1,"question_id":8599981,"title":"Semaphore and thread issue","body":"<p>After reading about semaphores I tried this test code in which I create two threads A and B. My aim is, let thread A wait for 10 secs for some operation in Thread B to complete. But as I changed the logic in thread B a little , by introducing an infinite while loop which never comes out , the Thread A is also hanging, and the program runs forever. Can anybody help me how to achieve the goal which I am looking for?   </p>\n\n<p>package pack;</p>\n\n<pre><code>import java.util.concurrent.Semaphore;\n\npublic class Concurrency {\n    public int count = 0;\n\n  public static void main(String args[]) throws Exception {\n    final Semaphore sem = new Semaphore(1, true);\n    Thread thrdA, thrdB;\n    thrdA = new Thread(new Runnable() {\n        @Override\n        public void run() {\n            synchronized (sem) {\n                try {\n                    sem.wait(10000);\n                    System.out.println(\"thread1\");\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n\n        }\n    });\n    thrdB = new Thread(new Runnable() {\n        @Override\n        public void run() {\n            synchronized (sem) {\n                System.out.println(\"thread2\");\n\n                while(true){\n\n                }\n            }\n\n        }\n    });\n\n    thrdA.start();\n    thrdB.start();\n\n    thrdA.join();\n    thrdB.join();\n\n  }\n}\n</code></pre>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1055,"score":0,"question_id":5270433,"title":"Using semaphore to control number of threads","body":"<p>How can I make use of Semaphore class in order to control number of threads that have an access to an object?</p>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":774,"score":5,"question_id":3939093,"title":"Semaphore and synchronization","body":"<p>I could not quite understand the following from the semaphore description in javadocs.</p>\n\n<blockquote>\n  <p>Note that no synchronization lock is\n  held when acquire() is called as that\n  would prevent an item from being\n  returned to the pool. <strong>The semaphore\n  encapsulates the synchronization\n  needed to restrict access to the pool,\n  separately from any synchronization\n  needed to maintain the consistency of\n  the pool itself.</strong></p>\n</blockquote>\n\n<p>Can someone please help me understand this and its implications.</p>\n"},{"tags":["java","multithreading","deadlock","semaphore"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":250,"score":5,"question_id":10166909,"title":"Semaphore deadlock","body":"<p>So I have a problem using semaphore.\nWriting a code where are 4 rooms and some visitors. Each room has a certain cap for the amount  of visitors they can hold. So entering a full room would trigger a wait().\nThe visitors must not leave a room before they can enter another, so they are always in a room.</p>\n\n<pre><code>public class Semaphore {\n\n  private int placesLeft;\n\n  public Semaphore(int placesInRoom) {\n    this.placesLeft = placesInRoom;\n  }\n\n  public synchronized void acquire(Visitor visitor) {\n    Semaphore sem = visitor.getRoom().getSemaphore();\n\n    try {\n      while (placesLeft &lt;= 0) {\n        this.wait();\n    }\n\n  } catch (InterruptedException e) {}\n\n  sem.release();\n  placesLeft--;\n}\n\npublic synchronized void release() {\n  placesLeft++;\n  this.notifyAll();\n}\n</code></pre>\n\n<p>Deadlock appears when 2 people are trying to enter each other's rooms.\nAlso for some reason the <code>placesLeft</code> count is not coming out right.</p>\n\n<p>So what should I do?</p>\n\n<p>EDIT:</p>\n\n<p>Been busy with something else, reviving the question.\nThe problem doesnt occure because of rooms get full, lock occures when person1 from room1 wants to enter room2 and the same time person2 from room2 wants to enter room1. As I understant its something to do with synchrozing maybe? They get stuck before release, so release is not called. As i understand one rooms accuire and release cannot be called same time. So basicly room1 semaphore release cannot be called cuz on same time the accuire is called, same for room2? I'm newbie coder and synchronizing is not so clear yet. \nRemoving synchronizes from one or another doesnt seem to work (is prolly wrong also).</p>\n"},{"tags":[".net","multithreading","locking","monitor","memory-barriers"],"answer_count":1,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":969,"score":6,"question_id":2005211,"title":"When to use lock vs MemoryBarrier in .NET","body":"<p>In .NET the <code>lock</code> keyword is syntactic sugar around <code>Monitor.Enter</code> and <code>Monitor.Exit</code>, so you could say that this code</p>\n\n<pre><code>lock(locker)\n{\n  // Do something\n}\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>Monitor.Enter(locker);\ntry\n{\n  // Do Something\n}\nfinally\n{\n  Monitor.Exit(locker);\n}\n</code></pre>\n\n<p>However the .NET framework also includes the <code>MemoryBarrier</code> class which works in a similar way</p>\n\n<pre><code>Thread.MemoryBarrier();\n//Do something\nThread.MemoryBarrier();\n</code></pre>\n\n<p>I am confused as when I would want to use <code>Thread.MemoryBarrier</code> over the <code>lock</code>/<code>Monitor</code> version? I am made even more confused by <a href=\"http://www.albahari.com/threading/part4.aspx\" rel=\"nofollow\">a Threading Tutorial</a> which states they function tthe same.</p>\n\n<p>As far as I can see the visible difference is not needing a locking object, which I guess that using <code>Monitor</code> you could do something across threads where <code>MemoryBarrier</code> is on a single thread. </p>\n\n<p>My gut is telling me that another key difference is <code>MemoryBarrier</code> is for variables only and not for methods.</p>\n\n<p>Lastly this is not related to the existing question <a href=\"http://stackoverflow.com/questions/1330590/when-to-use-volatile-or-thread-memorybarrier-in-threadsafe-locking-code-c\">When to use ‘volatile’ or ‘Thread.MemoryBarrier()’ in threadsafe locking code? (C#)</a>, as that is focusing on the <code>volatile</code> keyword which I understand its usage of. </p>\n"}]}
{"total":30059,"page":17,"pagesize":100,"questions":[{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":8220569,"title":"Multithreading with semaphore","body":"<p>I need clarification regarding an issue related to multithreading. I have threads which acquires a semaphore, and after a while releases it. As soon as it is done releasing first semaphore, it acquires second one and after while releases it. Both semaphore protects different code in thread's run() method. Something like below:</p>\n\n<pre><code>public void run() {\n     System.out.println(\"Step 1\");\n     semaphoreA.acquire();\n\n     // Run for a while\n\n     semaphoreA.release();\n\n     // Run for a while\n\n     semaphoreB.acquire();\n     System.out.println(\"Step 2\");\n\n     // Run for a while\n\n     semaphoreB.release();\n}\n</code></pre>\n\n<p>So, when there is no permit for semaphoreB, thread waits. However, when the permit made available, shouldn't I see 'Step 2' on console ? Or that is how thread and semaphore works ? </p>\n\n<p>I want to understand what happens if a thread was just notified about an available semaphore permit. Would that thread start from the beginning ? or From the point where it was left of ? </p>\n"},{"tags":["multithreading","blackberry","asynchronous","java-me"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12785245,"title":"Asynchronous image downloader for blackberry","body":"<p>I have a need of creating a image gallery. The images are saved in the remote server. The Blackberry client need to download and render it to the UI (Gallery View). </p>\n\n<p>I have used \"UniversalImageDownloaer\" library for android. But now for I am looking for any such freeware/open source lib that will help me to serve my purpose for BlackBerry. Can Anyone help me guiding me to a resource. </p>\n\n<p>I need to look into the following things</p>\n\n<ol>\n<li>Async image download</li>\n<li>Gallery view</li>\n<li>Image caching </li>\n</ol>\n\n<p><strong>Edit-1</strong>\nFrom my earlier experience, I understand that Blackberry has the restriction for creating maximum of 250 (Many be 5+/-) number of threads at run time. And per application it is restricted to 17 number of threads. So I must look into the thread pool and thread safety for my requirements.  </p>\n"},{"tags":["c#","multithreading","thread-safety","shared-memory","memory-barriers"],"answer_count":1,"favorite_count":5,"up_vote_count":12,"down_vote_count":0,"view_count":1173,"score":12,"question_id":3493931,"title":"Why do I need a memory barrier?","body":"<p>C# 4 in a Nutshell (highly recommended btw) uses the following code to demonstrate the concept of MemoryBarrier (assuming A and B were run on different threads):</p>\n\n<pre><code>class Foo{\n  int _answer;\n  bool complete;\n  void A(){\n    _answer = 123;\n    Thread.MemoryBarrier(); // Barrier 1\n    _complete = true;\n    Thread.MemoryBarrier(); // Barrier 2\n  }\n  void B(){\n    Thread.MemoryBarrier(); // Barrier 3;\n    if(_complete){\n      Thread.MemoryBarrier(); // Barrier 4;\n      Console.WriteLine(_answer);\n    }\n  }\n}\n</code></pre>\n\n<p>they mention that Barriers 1 &amp; 4 prevent this example from writing 0 and Barriers 2 &amp; 3 provide a <em>freshness</em> guarantee: they ensure that if B ran after A, reading <strong>_complete</strong> would evaluate to <strong>true</strong>.</p>\n\n<p>I'm not really getting it.  I think I understand why Barriers 1 &amp; 4 are necessary: we don't want the write to <strong>_answer</strong> to be optimized and placed after the write to <strong>_complete</strong> (Barrier 1) and we need to make sure that <strong>_answer</strong> is not cached (Barrier 4).  I also think I understand why Barrier 3 is necessary: if A ran until just after writing <strong>_complete = true</strong>, B would still need to refresh <strong>_complete</strong> to read the right value.</p>\n\n<p>I don't understand though why we need Barrier 2!  Part of me says that it's because perhaps Thread 2 (running B) already ran until (but not including) <strong>if(_complete)</strong> and so we need to insure that <strong>_complete</strong> is refreshed.  </p>\n\n<p>However, I don't see how this helps.  Isn't it still possible that <strong>_complete</strong> will be set to true in A but yet the B method will see a cached (false) version of <strong>_complete</strong>?  Ie, if Thread 2 ran method B until after the first MemoryBarrier and then Thread 1 ran method A until <strong>_complete = true</strong> but no further, and then Thread 1 resumed and tested <strong>if(_complete)</strong> -- could that <strong>if</strong> not result in <strong>false</strong>?</p>\n"},{"tags":["c++","multithreading","mutex","volatile","memory-barriers"],"answer_count":4,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":700,"score":12,"question_id":6837699,"title":"Are mutex lock functions sufficient without volatile?","body":"<p>A coworker and I write software for a variety of platforms running on x86, x64, Itanium, PowerPC, and other 10 year old server CPUs.</p>\n\n<p>We just had a discussion about whether mutex functions such as pthread_mutex_lock() ... pthread_mutex_unlock() are sufficient by themselves, or whether the protected variable needs to be volatile.</p>\n\n<pre><code>int foo::bar()\n{\n //...\n //code which may or may not access _protected.\n pthread_mutex_lock(m);\n int ret = _protected;\n pthread_mutex_unlock(m);\n return ret;\n}\n</code></pre>\n\n<p>My concern is caching. Could the compiler place a copy of _protected on the stack or in a register, and use that stale value in the assignment? If not, what prevents that from happening? Are variations of this pattern vulnerable?</p>\n\n<p>I presume that the compiler doesn't actually understand that pthread_mutex_lock() is a special function, so are we just protected by sequence points?</p>\n\n<p>Thanks greatly.</p>\n\n<p>Update: Alright, I can see a trend with answers explaining why volatile is bad. I respect those answers, but articles on that subject are easy to find online. What I can't find online, and the reason I'm asking this question, is how I'm protected <em>without</em> volatile. <strong>If the above code is correct, <em>how</em> is it invulnerable to caching issues?</strong></p>\n"},{"tags":["java","multithreading","concurrency","mutex","semaphore"],"answer_count":8,"favorite_count":10,"up_vote_count":22,"down_vote_count":0,"view_count":30994,"score":22,"question_id":771347,"title":"What is mutex and semaphore in Java ? What is the main difference?","body":"<p>What is mutex and semaphore in Java ? What is the main difference ?</p>\n"},{"tags":["java","multithreading","junit","semaphore"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":10872863,"title":"How do you interrupt a Semaphore from a JUnit thread?","body":"<p>I have an implementation of a method that I want to test.</p>\n\n<pre><code>    @Override\npublic void onMessage(final Message message) {\n    try {\n        LOG.fine(\"waiting on semaphore for \" + message);\n        semaphore.acquire();\n        LOG.fine(\"semaphore acquired for \" + message);\n        listener.onMessage(message);\n        LOG.fine(message + \" processed\");\n    } catch (final InterruptedException e) {\n        throw new RuntimeException(e);\n    } finally {\n        semaphore.release();\n    }\n}\n</code></pre>\n\n<p>However, I am not sure how to rigger the InterruptedException from a JUnit test.  In theory I can add hooks to terminate it, but that would pollute the code base with code only used for testing which I would like to avoid.</p>\n"},{"tags":["java","multithreading","swing","jdialog"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12690178,"title":"Automatically close non-modal dialogs after specified time in swing 1.5","body":"<p>In Swing for Java 1.5 I want to create a dialog, which allows the user to do other things in background. I want this dialog to have one button, with which you can close the dialog. If the user doesn't close the dialog within X seconds, it should close itself. In both cases a routine has to be done after the dialog has been closed.</p>\n\n<p>I tried to use Swing Timer with a modal dialog and it works. But, as I noticed above, I need a non-modal dialog. When I set the modal-Property to false, the dialog disappears immediately.</p>\n\n<p>Does someone know, why this happens?</p>\n\n<pre><code>JOptionPane pane =  new JOptionPane (text, JOptionPane.WARNING_MESSAGE);\npane.setOptions(new String[]{\"Close\"});\nfinal JDialog dialog = pane.createDialog(frame, title);\n//dialog.setModal(false);\n\nTimer timer = new Timer(time, new ActionListener() {\n    public void actionPerformed(ActionEvent e) {\n        dialog.setVisible(false);\n    }\n});\ntimer.setRepeats(false);\ntimer.start();\n\ndialog.setVisible(true);\n\n//routine to do after the dialog disappears\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","jvm","semaphore"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":7640901,"title":"Semantic equivalence of synchronized method and Semaphore(1, true)?","body":"<p>Are the following two method definitions semantically equivalent? Why? Why not?</p>\n\n<p>Version A:</p>\n\n<pre><code>private static synchronized void foo() {\n    bar();\n}\n</code></pre>\n\n<p>Version B:</p>\n\n<pre><code>private static Semaphore available = new Semaphore(1, true);\nprivate static void foo() {\n    available.acquire();\n    try {\n        bar();\n    }\n    finally {\n       available.release();\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","actionscript-3","flash","background"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12795649,"title":"Actionscript workers limitation","body":"<p>I have few questions about workers. \nHow can i send to an worker complex objects of my own data types...serialization doesn't work and it is very sad :(\nWhen Adobe is planing to release workers that are able to exchange any data types, starting from primitive and to very complex objects?</p>\n"},{"tags":["c#","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12794402,"title":"Change button color from other thread","body":"<p>In my c# program I create a bunch of buttons in the main (UI) thread. Then I start a timer that runs a method <code>Timeline()</code>. Now I want the appearance of the buttons to change when the <code>Timeline()</code> method runs. But I'm not allowed to access the objects because they are owned by the main thread. How do I solve this?</p>\n\n<p>Error: <code>The calling thread cannot access this object because a different thread owns it.</code></p>\n\n<p>I have found <code>Dispatcher disp = Dispatcher.CurrentDispatcher;</code> which has an <code>Invoke()</code> method but I'm not sure if that is the right way, and I couldn't get it to work.</p>\n\n<p>Here is part of my code:</p>\n\n<pre><code>    private static SurfaceButton[,] buttons = new SurfaceButton[dimensionBeats, dimensionsNotes];\n\n    public SurfaceWindow1()\n    {\n        try\n        {\n            InitializeComponent();\n        }\n        catch (Exception ex)\n        {\n        }\n\n\n        LoadAudioContent();\n        // Add handlers for Application activation events\n        AddActivationHandlers();\n\n\n        InitializeButtons();\n\n        try\n        {\n            t = new Timer(Timeline, null, 1, dimensionBeats*500);\n        }\n        catch (Exception e)\n        {\n\n        } \n    }\n\n    private void InitializeButtons()\n    {\n        for (int i = 0; i &lt; 8; i++)\n        {\n            for (int j = 0; j &lt; 6; j++)\n            {\n                SurfaceButton btn = new SurfaceButton();\n                //btn.Content = files[j].Substring(0,1);\n                btn.Name = \"a\" +i + j;\n                btn.Width = 120;\n                btn.Height = 120;\n                btn.ContactEnter+=StartSound;\n                btn.ContactLeave+=StopSound;\n                btn.Opacity = 0.01;\n                btn.ClickMode = ClickMode.Release;\n\n                buttons[i,j] = btn;\n\n                // add the newly generated button to the correct column (left to right one panel per column)\n                switch (i)\n                {\n                    case 0:\n                        rowPanel0.Children.Add(btn);\n                        break;\n                    case 1:\n                        rowPanel1.Children.Add(btn);\n                        break;\n                    case 2:\n                        rowPanel2.Children.Add(btn);\n                        break;\n                    case 3:\n                        rowPanel3.Children.Add(btn);\n                        break;\n                    case 4:\n                        rowPanel4.Children.Add(btn);\n                        break;\n                    case 5:\n                        rowPanel5.Children.Add(btn);\n                        break;\n                    case 6:\n                        rowPanel6.Children.Add(btn);\n                        break;\n                    case 7:\n                        rowPanel7.Children.Add(btn);\n                        break;\n                }\n            }\n        }\n    }\n\n\n    private void Timeline(Object state)\n    {     \n\n        for (int i = 0; i &lt; pressed.GetLength(0); i++)\n        {\n            sendRequest(url, postMethod, tabelId, buttsToString(butts));\n\n            for (int j = 0; j &lt; pressed.GetLength(1); j++)\n            {\n                if (pressed[i,j])\n                {\n                    buttons[i, j].Background = Brushes.Red;\n                }\n            }\n            Thread.Sleep(500);\n            for (int j = 0; j &lt; pressed.GetLength(1); j++)\n            {\n                buttons[i, j].Background = Brushes.White;\n            }\n        }\n</code></pre>\n"},{"tags":["multithreading","actionscript-3"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":195,"score":1,"question_id":12167182,"title":"Issue with basic AS3 workers classes","body":"<p>I have followed Lee Brimelow's tutorials (<a href=\"http://www.gotoandlearn.com/play.php?id=162\" rel=\"nofollow\">part 1</a>, <a href=\"http://www.gotoandlearn.com/play.php?id=163\" rel=\"nofollow\">part 2</a>), but somehow my project doesn't work as expected.</p>\n\n<p>Currently, publishing \"src/Secondary.as\" to \"www/assets/swf/secondary.swf\" works properly, however when trying to run \"src/Main.as\", an error shows up:</p>\n\n<pre><code>Exception fault: TypeError: Error #1007: Instantiation attempted on a non-constructor.\n    at Main/init()[/Volumes/DOCUMENTS/Tests/AS3/test-workers/src/Main.as:52]\n    at Main()[/Volumes/DOCUMENTS/Tests/AS3/test-workers/src/Main.as:32]\n</code></pre>\n\n<p>If anybody has time, you can look at <a href=\"http://github.com/jansensan/test-as3-workers\" rel=\"nofollow\">my code on Github</a> and maybe see where I screwed up? Thanks a bunch!</p>\n"},{"tags":["java","multithreading","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12794899,"title":"Constantly monitor dynamically updated files in multi-threaded java program","body":"<p>I want to know what will be the efficient (in terms of time and memory) java code to implement the following:</p>\n\n<p>I need a java program to continuously check two files, the first file let us call it A will have a product name continuously added and another file B will be its corresponding prices from different source. both of the files are being dynamically updated. what the program will do is that, whenever a product is added to A it will add that word to a list and as long as no new product is not added it will consider every new price added to file B from that time to be the prices of the corresponding product. It will then create a mapping of product and prices.</p>\n\n<p>So, here is the file</p>\n\n<h2>A</h2>\n\n<p>Macbook Pro</p>\n\n<p>Dell XPS</p>\n\n<p>Lenovo</p>\n\n<h2>B</h2>\n\n<p>(Macbook pro added in file A)</p>\n\n<p>100</p>\n\n<p>200</p>\n\n<p>(Dell XPS is added in file A)</p>\n\n<p>300</p>\n\n<p>400</p>\n\n<p>(Lenovo is added in A)</p>\n\n<p>500</p>\n\n<p>600</p>\n\n<p>700</p>\n\n<p>so it will create a mapping like,</p>\n\n<p>Macbook Pro -> 100,200</p>\n\n<p>Dell XPS -> 300, 400</p>\n\n<p>Lenovo -> 500, 600, 700</p>\n\n<p>The above example is an illustration of what I am trying to achieve.\nMy idea so far is that, keep two thread monitor each file, whenever a product is added to A start counting from B (mark previous position in B), whenever a new product added to A, start from B from the previously marked position.\nIs this a right approach? \nAnd how can I read the dynamic files constantly? </p>\n"},{"tags":["multithreading","actionscript-3","flash","sound-api","worker"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":259,"score":2,"question_id":11902863,"title":"Can ActionScript Workers be used to play / generate Sounds in a separate thread?","body":"<p>I'm very new to <strong>ActionScript Workers</strong>, but I would like to know if this is possible.</p>\n\n<p>From what I have read, <strong>ActionScript Workers</strong> (ASW) are like separate threads that can do more CPU intensive calculations without interrupting the Main thread (which is executing your main SWF file).</p>\n\n<p>The only example I really seen kicking around was the one illustrating animation playing at a consistent rate while an ASW took care of loading or calculating some intensive math formulas.</p>\n\n<p>Is the Sound API available for ActionScriptWorkers?</p>\n"},{"tags":["java","multithreading"],"answer_count":10,"favorite_count":13,"up_vote_count":22,"down_vote_count":0,"view_count":15424,"score":22,"question_id":763579,"title":"How many threads can a Java VM support?","body":"<p>How many threads can a Java VM support? Does this vary by vendor? by operating system? other factors?</p>\n"},{"tags":["c++","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12793999,"title":"Best way to exit thread containing pointer to object after object has been deleted","body":"<p>In my c++ class I make a thread and give the pointer <code>this</code> to the thread. Now somewhere this object is getting deleted. I want the thread to exit after object is deleted. </p>\n\n<p>One method is to use try-catch. Whenever I find an exception I exit the thread. But thats kind of a hack. </p>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12792683,"title":"Removing from ListBox inside of a Timer","body":"<pre><code>ObservableCollection&lt;String&gt; listBoxItems = new ObservableCollection&lt;String&gt;();\nscheduledRecordingListBox.ItemsSource = listBoxItems;\n\npublic void timerElapsed(object sender, ElapsedEventArgs e)\n{\n    listBoxItems.Remove(itemToBeRemoved);\n}\n</code></pre>\n\n<p>Just a snippet of what I'm actually trying to do. I believe the error is caused because the timer is running on a different thread than the GUI main thread that the ObservableCollection I'm trying to remove from is.</p>\n"},{"tags":[".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":654,"score":2,"question_id":1666754,"title":"Is it possible to list all the threads currently running in .NET","body":"<p>I'd like to list as much information about all the threads currently running in .NET1.0 as I can. I don't have the luxury of adding threads to an internal list of my own when they get created; I just want to dump out a list of those that are currently in the system. Does any one know a way of doing this? I've been looking at the System.Threading... namespace and right now nothing is opening up as I hoped it would.</p>\n"},{"tags":["c#",".net","multithreading","asynchronous","cross-threading"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":258,"score":0,"question_id":7439808,"title":"C# Threading/Async with callbacks? Ripping my hair out here","body":"<p>I have had very few good experiences with threading. I have read sources but most full projects that utilize it well so are incredibly dense with threading being such a small part of it making it difficult to determine what is needed and what is not.  </p>\n\n<p>My project will mainly need to make HTTP POST requests for updates for an API, report back (through a callback?) and most likely put on a timer, or be able to be called multiple times on request.  </p>\n\n<p>The tutorials I have read have only covered basic stuff without reporting back and performing more operations on the new/newly calculated date. Even when they do, nearly all have used:</p>\n\n<pre><code>Control.CheckForIllegalCrossThreadCalls = false;\n</code></pre>\n\n<p>Which from what I have read is not a very good idea when you are performing it quote often.  </p>\n\n<p>So I guess my questions are as follows:  </p>\n\n<ul>\n<li>Do I need a dispatcher of sorts?</li>\n<li>Is there a more in depth/reliable source for threading documentation and references on callbacks?</li>\n<li>Should I start off with two threads and store all my shared variables in a second thread that I can regularly check with from main, and update/alter with the secondary/other thread?</li>\n</ul>\n\n<p>In regards to the schooling, this is not a school related project, it is a personal project involving the Eve Online API system. EVEMon's source is so compact, streamlined and developed that it is quite hard to distinguish between threads in its code. If anyone could give pointers on examining this it to would be helpful. </p>\n"},{"tags":["java","multithreading","swing","concurrency","event-dispatch-thread"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12726284,"title":"add 2 objects to JFrame on a specific location","body":"<p>This is my class that creates a circle shape with specific x and y coordinates. Similarly I have another same class but with different x and y coordinate positions. I create 1 object of each class and want to display them on specific positions on JFrame.When I add 2nd object to JFrmae, it overwrites the 1st object. I tried with different layouts of JFrmae but it did not work. </p>\n\n<pre><code>  class Ballbewegung2 extends JPanel implements Runnable {  \n    int x_pos = 10; int y_pos = 100; int radius = 20; \n    public void init() { \n    setBackground (Color.blue); } \n    public void start () { \n    Thread th = new Thread (this); \n    th.start (); } \n    public void run () { \n    Thread.currentThread().setPriority(Thread.MIN_PRIORITY); \n    while (true) { \n       x_pos ++; if(x_pos &gt;= 400) x_pos = 10; \n       repaint();\n       try { Thread.sleep (20); } \n       catch (InterruptedException ex) {}       thread.currentThread().setPriority(Thread.MAX_\nPRIORITY); } } public void paint (Graphics g) { g.setColor (Color.red); g.fillOval (x_pos - radius, y_pos - radius, 2 * radius, 2 * radius); } }\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":254,"score":1,"question_id":8163740,"title":"Same method accessed by multiple threads","body":"<p>I am having a method that is accessed by multiple threads in the java program.This method have:</p>\n\n<ol>\n<li>Global object variables</li>\n<li>Local variable</li>\n<li>Formal Parameters.</li>\n</ol>\n\n<p>Now this method is not synchronized so when the multiple threads changes the value of above three types of variables then will these changes reflected in other threads or each thread will have separate copy of these variables.</p>\n"},{"tags":["c++","multithreading","synchronization"],"answer_count":0,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":70,"score":3,"question_id":12792959,"title":"Readers–writer lock Mutlithreading Senario?","body":"<p>I have read a few links about Readers–writer lock. I had few doubts.</p>\n\n<ol>\n<li>In case the system has to be designed for Multiple reads and single write ,and write should have priority.</li>\n<li>In case the system has to be designed for multiple reads and multiple write </li>\n</ol>\n\n<p>So should we be implementing a semaphore for multiple read and a mutex for multiple write? or when do i use a critical section?\nAlso,Does it depend on the operating system? (does it differ in case of Unix and Windows)?\nplease suggest some links for better understanding.</p>\n\n<p>PS: i know its too general to post as a single question. But we can discuss all the cases here and have a common place.</p>\n"},{"tags":["c#","multithreading","process","timer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12792214,"title":"C# Process and Thread Termination When Time is Up - Waitable Timer","body":"<p>I am trying to create the following effect:</p>\n\n<p>I have x number of threads running at the same time and I want them all to stop when a timer goes off.</p>\n\n<p>The only thing I can think of doing is having a shared boolean value that changes when the time is up. Does anyone know how to do this with a threading timer and the AutoResetEvent?</p>\n\n<p>I am having a hard time finding out how to use the Autoreset event...</p>\n\n<p>Do you know of a better way to achieve this effect?</p>\n\n<p>What about with processes?</p>\n"},{"tags":["python","multithreading","celery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12791196,"title":"Celery and multithreaded tasks","body":"<p>I'm looking at Celery to perform a defined set of tasks spread over multiple machines.  Each machine can process any one of several tasks, but some of the tasks will require more machine resources than others.  Is there a way to manage these resources using Celery?  </p>\n"},{"tags":["multithreading","parallel-processing","functional-programming","lang"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":86,"score":4,"question_id":12788858,"title":"Parallelism in functional languages","body":"<p>One of FP features advertised is that a program is \"parallel by default\" and that naturally fits modern multi-core processors. Indeed, reducing a tree is parallel by its nature. However, I don't understand how it maps to multi-threading. Consider the following fragment (pseudo code):</p>\n\n<pre><code>let y = read-and-parse-a-number-from-console\nlet x = get-integer-from-web-service-call\nlet r = 5 * x - y * 4\nwrite-r-to-file\n</code></pre>\n\n<p>How can a translator determine which of tree branches should be run on a thread? After you obtained <code>x</code> or <code>y</code> it would be stupid to reduce <code>5 * x</code> or <code>y * 4</code> expressions on a separate thread (even if we grab it from a thread pool), wouldn't it? So how different functional languages handle this?</p>\n"},{"tags":["java","multithreading","concurrency","locking","reentrancy"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12791797,"title":"Force unlocking a reentrant lock","body":"<p>I have a reentrant lock which I am wrapping in a customized class for my own needs. However due to the nature of the application a thread holding the lock to the reentrant lock gets stuck (external failures) and fails to release the reentrant lock. </p>\n\n<p>I am wondering if there is a method to explicitly unlock the reentrant lock? I know the API for Reentrant lock does not have such a method - however I was thinking of introducing a timer task which will unlock the Reentrant lock after a set period of time OR kill the thread which holds the reentrant lock. </p>\n\n<p>Any other suggestions in trying to force unlock my reentrant lock? My solutions are pretty thus I ask.</p>\n"},{"tags":["java","multithreading","exception","exception-handling","io"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12791601,"title":"Exception in thread \"Thread-1\" java.lang.NullPointerException that happens when I try to update my graph","body":"<p>I edited a JFreeChart real time graph and now I get this error when I try to run it.  When I run it, the GUI will pop up its just the graph doesn't have the random data stream in.\nAny ideas would be a great help.</p>\n\n<pre><code>public class Therm extends ApplicationFrame implements ActionListener{\n\nprivate static TimeSeries ts;\nJTextArea text = new JTextArea(\"25\");\nJTextArea degreeC = new JTextArea(\"degrees C\");\nJTextArea degreeF = new JTextArea(\"degrees F\");\n\n\npublic Therm(final String title){\nsuper(title);\n\n\nts = new TimeSeries(\"Data\", Millisecond.class);\nTimeSeriesCollection data = new TimeSeriesCollection(ts);\n\nJFreeChart chart = create(data);\nJFrame frame = new JFrame(\"GraphTest\");\nframe.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\nChartPanel label = new ChartPanel(chart);\nframe.getContentPane().add(label);  \n\n\nChartPanel chartPanel = new ChartPanel(chart);\nJButton buttonC = new JButton(\"Celsius\");\nJButton buttonF = new JButton(\"Farenheit\");\nJButton button1 = new JButton(\"Toggle Extension (60 and 300 seconds)\");\nJButton buttonOff = new JButton(\"Turn Box\");\nbuttonC.setActionCommand(\"C\");\nbuttonC.addActionListener(this);\nbuttonF.setActionCommand(\"F\");\nbuttonF.addActionListener(this);\nbutton1.setActionCommand(\"ADD\");\nbutton1.addActionListener(this);\nbuttonOff.setActionCommand(\"off\");\nbuttonOff.addActionListener(this);\n\n\n\nFont font = new Font (\"Verdana\", Font.BOLD, 26);\ntext.setFont(font);\ndegreeC.setFont(font);\ndegreeF.setFont(font);\n\n\nJPanel graph = new JPanel(new BorderLayout());\ngraph.add(chartPanel);\nchartPanel.setPreferredSize(new java.awt.Dimension(700,300));\nsetContentPane(graph);\n\n\nJPanel content = new JPanel(new GridLayout(3,2));\ncontent.setLayout(new GridLayout(3,2));\ncontent.add(text);\ncontent.add(degreeC);\ncontent.add(buttonC);\ncontent.add(buttonF);\ncontent.add(button1);\ncontent.add(buttonOff);\nadd(content,BorderLayout.SOUTH);\nchartPanel.setPreferredSize(new java.awt.Dimension(700,300));\n\n} \n\nprivate JFreeChart create(final XYDataset data){\n    JFreeChart chart = ChartFactory.createTimeSeriesChart(\n        \"Thermometer Reading\",\n        \"Time\",\n        \"Degrees\",\n        data,\n        true,\n        true,\n        false\n    );\n\n    final XYPlot plot = chart.getXYPlot();\n    ValueAxis axisy = plot.getDomainAxis();\n    axisy.setFixedAutoRange(60000.0);\n    axisy = plot.getRangeAxis();\n    axisy.setRange(10.0,50.0);\n    return chart;\n    }\n\n\n\npublic void actionPerformed(final ActionEvent e) {\n    if (e.getActionCommand().equals(\"C\")) {  \n        degreeC.setText(\"degrees C\");\n    }\n    if (e.getActionCommand().equals(\"F\")){\n        degreeC.setText(\"degrees F\");\n    }\n    if (e.getActionCommand().equals(\"off\")){\n\n    }\n}\n\n\npublic static void main(String[] args) throws IOException{\n    gen myGen = new gen();\n    new Thread(myGen).start();\n\n\n\n    final Therm prog = new Therm(\"Thermometer Graph\");\n    prog.pack();\n    prog.setVisible(true);\n}\n\n\n\nstatic class gen implements Runnable{\n    public void run() {\n        while(true) {\n            int num = 25 + (int)(Math.random() * ((40 - 30) + 1));\n            System.out.println(num);\n            ts.addOrUpdate(new Millisecond(), num);\n            System.out.println(\"HI\");\n            try {\n                Thread.sleep(20);\n            }\n            catch (InterruptedException ex) {\n                System.out.println(ex);\n            }\n\n        }\n    }\n}\n}\n</code></pre>\n\n<p>EDIT: here is the new code that receives the error \"\"syntax error, insert \"Classbody\" to complete Class Declaration\"\" at 'gen'</p>\n\n<pre><code>static class gen{\n    while(true) {\n        // don't forget to make num final!\n        final int num = 25 + (int)(Math.random() * ((40 - 30) + 1));\n        System.out.println(num);\n        SwingUtilities.invokeLater(new Runnable(){\n          public void run() {\n            ts.addOrUpdate(new Millisecond(), num);                \n          }\n        });\n        // ts.addOrUpdate(new Millisecond(), num);\n        System.out.println(\"HI\");\n        try {\n            Thread.sleep(20);\n        }\n        catch (InterruptedException ex) {\n            System.out.println(ex);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["ruby","multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12763593,"title":"Difference between Thread#run and Thread#wakeup?","body":"<p>In Ruby, what is the difference between <a href=\"http://www.ruby-doc.org/core-1.9.3/Thread.html#method-i-run\" rel=\"nofollow\">Thread#run</a> and <a href=\"http://www.ruby-doc.org/core-1.9.3/Thread.html#method-i-wakeup\" rel=\"nofollow\">Thread#wakup</a>?</p>\n\n<p>The RDoc specifies that <em>scheduler</em> is not invoked with Thread#wakeup, but what does that mean? An example of when to use <em>wakeup</em> vs <em>run</em>? Thanks.</p>\n\n<p><strong>EDIT:</strong><br>\nI see that <a href=\"http://www.ruby-doc.org/core-1.9.3/Thread.html#method-i-wakeup\" rel=\"nofollow\">Thread#wakup</a> causes the thread to become runnable, but what use is it if the it's not going to execute until <a href=\"http://www.ruby-doc.org/core-1.9.3/Thread.html#method-i-run\" rel=\"nofollow\">Thread#run</a> is executed (which wakes up the thread anyway)?</p>\n\n<p>Could someone please provide an example where <em>wakeup</em> does something meaningful? For curiosity's sake =)</p>\n"},{"tags":["c","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12791410,"title":"Does malloc itself provide some kind of synchronization?","body":"<p>I heard \"malloc is thread-safe because it provide a synchronization primitive so that simultaneous to malloc will not corrupt the heap\".</p>\n\n<p>But when I look at the source code of malloc function in visual studio crt, it turns out that the malloc function just pass the request to syscall HeapAlloc. So I think it is the opearting system itself provide some kind of synchronization to protect application from corrupted heap rather than malloc.</p>\n\n<p>Then what about linux? Does malloc itself provide some kind of synchronization?</p>\n"},{"tags":["multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":25,"score":0,"question_id":12791452,"title":"How to turn a multithreading task to a single-thread task?","body":"<p>For example, if a project need a log system, instead of direct writing log file or wrap the log file in a monitor object, we could start a dedicated log-thread which is the only thread that will log. </p>\n\n<p>If the other threads want to write a log, it send a message to this dedicated thread. Then, the log-thread could sequentially write the log from its message queue to the log file.</p>\n\n<p>I think this is a better design than the multithreaded-one in which each routine writing log should use some kind of synchronization scheme.</p>\n\n<p>So am I right? Could you provide more methods/examples to turn a multithreading problem to a simple single-thread problem?</p>\n"},{"tags":["java","mysql","multithreading","chat"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":938,"score":0,"question_id":2167819,"title":"Java Threads and MySQL","body":"<p>I have a threaded chat server application which requires MySQL authencation. </p>\n\n<p>Is the best way to have 1 class create the MySQL connection, keep that connection open and let every thread use that connection but use own Query handler?</p>\n\n<p>Or is it better to have all threads make a seperate connection to MySQL to authencate?</p>\n\n<p>Or is it better to let 1 class handle the queries AND connections?</p>\n\n<p>We are looking at a chatserver that should be able to handle upto 10.000 connections/users.</p>\n\n<hr>\n\n<p>I am now using c3p0, and I created this:</p>\n\n<pre><code>public static void main(String[] args) throws PropertyVetoException\n{\n    ComboPooledDataSource pool = new ComboPooledDataSource();\n    pool.setDriverClass(\"com.mysql.jdbc.Driver\");\n    pool.setJdbcUrl(\"jdbc:mysql://localhost:3306/db\");\n    pool.setUser(\"root\");\n    pool.setPassword(\"pw\");\n    pool.setMaxPoolSize(100);\n    pool.setMinPoolSize(10);\n\n    Database database = new Database(pool);\n    try\n    {\n\n        ResultSet rs = database.query(\"SELECT * FROM `users`\");\n\n        while (rs.next()) {\n            System.out.println(rs.getString(\"userid\"));\n            System.out.println(rs.getString(\"username\"));\n        }\n    }\n    catch(Exception ex)\n    {\n        System.out.println(ex.getMessage());\n    }\n    finally\n    {\n        database.close();\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>public class Database {</p>\n\n<pre><code>ComboPooledDataSource pool;\nConnection conn;\nResultSet rs = null;\nStatement st = null;\n\npublic Database (ComboPooledDataSource p_pool)\n{\n    pool = p_pool;\n}\n\npublic ResultSet query (String _query)\n{\n    try {\n        conn = pool.getConnection();\n        st = conn.createStatement();\n        rs = st.executeQuery(_query);\n    } catch (SQLException e) {\n        e.printStackTrace();\n    } finally {\n\n    }\n    return rs;\n}\n\npublic void close ()\n{\n    try {\n        st.close();\n        conn.close();\n    } catch (SQLException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Would this be thread safe?</p>\n"},{"tags":["java","multithreading","operating-system"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12790326,"title":"Out of memory: cannot create a new native thread","body":"<p>I'm working on a application where the client (user) has the control to create new thread and kill them. The application is based on Java.</p>\n\n<p>In one of the cases, user creates multiples threads and kills them and creates new one's and goes on. After some time, OutofMemoryException pops up. I thought this is related to thread stack issue. So I reduced the thread stack XSS from 1024KB to 512KB and also reduced the Java heap size from Xms 256mb XmX 1024mb to Xms 256mb Xmx 512mb. </p>\n\n<p>I also memory profiled the application with yourkit, just to see whether it overflows from the heap size. but it seems to be okay..threads are created and kills okay. </p>\n\n<p>This is 8GB RAM Windows 7 machine </p>\n\n<p>I was wondering, what else can be causing this exception?</p>\n"},{"tags":["java","android","multithreading","android-asynctask"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12790319,"title":"Why Android thread gets terminated before it finishes to execute it?","body":"<p>I have a thread which get some data from Internet. It seams that it is executed correctly and data is retrieved. However if I call a method which should return  data it leaves me with null. From that I drew a conclusion that thread is somehow stopped just before finning.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>private class getHash extends AsyncTask&lt;String, Void, String&gt;{\n    @Override\n    protected String doInBackground(String... params) {\n        String str = null;\n        try {\n            // Create a URL for the desired page\n            URL url = new URL(params[0]);\n\n            // Read all the text returned by the server\n            InputStream is =  url.openStream();\n            InputStreamReader isr = new InputStreamReader(is);\n            BufferedReader in = new BufferedReader(isr);\n            str = in.readLine();\n            is.close();\n            isr.close();\n            in.close();\n        } catch (MalformedURLException e) {\n            e.printStackTrace();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        hash = str; //If I set a global variable here it gets passed without a hitch\n        return str;\n    }\n    @Override\n    protected void onPostExecute(String result) {\n        hash = result; // If I comment the line above and live this one I left with a null\n    }\n}\n</code></pre>\n\n<p>EDIT:\nAs requested adding code where the thread was called:</p>\n\n<pre><code>            getHash hashThread =  new getHash();\n            hashThread.execute(new String[] {\"http://www.full.path/to/the/file.hash\"});\n\n\n            if(hash != null &amp;&amp; !hash.equals(localHash)){\n....\n</code></pre>\n"},{"tags":["c++","multithreading","unit-testing","concurrency","boost-test"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":157,"score":3,"question_id":12304927,"title":"Is there a way to run C++ Unit Tests tests in parallel?","body":"<p>I'm using Boost Test for a long time now and I ends up having my tests running too slowly. As each test is highly parallel, I want them to run concurrently with all my cores. </p>\n\n<p>Is there a way to do that using the Boost Test Library ? I didn't found any solution. I tried to look a how to write custom test runner, but I didn't much documentation on that point :(</p>\n\n<p>If there is no way, does someone know a good C++ Test Framework to achieve that goal ? I was thinking that Google Test would do the job but apparently it cannot run test in parallel either. Even if the framework has less features than other more known framework, it is not a problem, I just need simple assertions and multi-threaded execution. </p>\n\n<p>Thanks</p>\n"},{"tags":["c#","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12789773,"title":"C# thread safe text update on dynamically created text boxes","body":"<p>I know how to do a thread safe update on a text box that was already defined <a href=\"http://msdn.microsoft.com/en-us/library/ms171728.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms171728.aspx</a> .... how can i do this on text boxes that were generated later on in the program? You advice  is much appreciated.</p>\n"},{"tags":["c++","multithreading","thread-safety","communication","vc"],"answer_count":5,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":567,"score":8,"question_id":8290768,"title":"is assignment operator '=' atomic?","body":"<p>I'm implementing Inter-Thread Communication using global variable.</p>\n\n<pre><code>//global var\nvolatile bool is_true = true;\n\n//thread 1\nvoid thread_1()\n{\n    while(1){\n        int rint = rand() % 10;\n        if(is_true) {\n            cout &lt;&lt; \"thread_1: \"&lt;&lt; rint &lt;&lt;endl;  //thread_1 prints some stuff\n            if(rint == 3)\n                is_true = false;  //here, tells thread_2 to start printing stuff\n        }\n    }\n}\n\n//thread 2\nvoid thread_2()\n{\n    while(1){\n        int rint = rand() % 10;\n        if(! is_true) {  //if is_true == false\n            cout &lt;&lt; \"thread_1: \"&lt;&lt; rint &lt;&lt;endl;  //thread_2 prints some stuff\n            if(rint == 7)  //7\n                is_true = true;  //here, tells thread_1 to start printing stuff\n        }\n    }\n}\n\nint main()\n{\n    HANDLE t1 = CreateThread(0,0, thread_1, 0,0,0);\n    HANDLE t2 = CreateThread(0,0, thread_2, 0,0,0);\n    Sleep(9999999);\n    return 0;\n}\n</code></pre>\n\n<p><strong>Question</strong></p>\n\n<p>In the code above, I use a global var <code>volatile bool is_true</code> to switch printing between thread_1 and thread_2.</p>\n\n<p>I wonder <strong>whether it is thread-safe to use assignment operation here</strong>?</p>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12788343,"title":"Using semaphores to sort array","body":"<p>So we have a task to sort an array using semaphores in Java. The task is pretty easy and I've solved it in nearly couple of minutes but for the last part- merging.</p>\n\n<p>Our task was to divide the given array into two, sort the parts simultaneously (using semaphores) and then merge again (using semaphores). </p>\n\n<p>My question is, what is the purpose of merging it using more than one Thread as while filling the final array each of them have to constantly wait for each other, since only one can push elements to the array at one time?</p>\n\n<p>Or am I missing something?\nThanks.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12787293,"title":"Java running parallel programs","body":"<p>I have a requirement and i am not sure if that can be fulfilled by using threads. I have two predefined 100*100 matrices and i want to perform their  multiplication. What i want is, not simple multiplication but i want to divide this into three separate programs , first program will do multiplication of first 33 rows, second program will do multiplication of rows from 33 to 64 and third will do multiplication of rows 64 to 100. Now i want to run these programs in parallel and collect their results( i.e. multiplications of rows) and then join these three different results into a single matrix. \nNow, i have developed three such programs or classes but i am not able to find any way to run them parallel. \nIn threads, i read that we can not be sure which thread will execute first and which will execute later.</p>\n\n<p>Can anyone please give me any idea which technique i can use for my problem?</p>\n\n<p>I will be very thankful to you guys.</p>\n"},{"tags":["multithreading","lazarus"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12788733,"title":"How to know if thread is finished in Lazarus","body":"<p>I'm new on threads so this is my question:</p>\n\n<p>How can I check if the thread is over.</p>\n\n<p>Escenario:</p>\n\n<p>My app starts, then when I click on a button, the thread starts, and in the same click event I want to check if the thread is finished so I can call a new window that depends on the info that the thread throws. </p>\n\n<pre><code>MyThread:=TMyThread.Create(True);\n\n        if Assigned(MyThread.FatalException) then begin\n           raise MyThread.FatalException;\n        end;\n\n        MyThread.Start; \n\n        //check if it's done\n        //How can I check if the Thread is finished so I can call the form\n        frmUpdateLog.ShowModal;\n</code></pre>\n\n<p>When I do it as the code below the message window shows but there is no info, cause the thread is still running.</p>\n"},{"tags":["java","multithreading","scala","concurrency","io"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":127,"score":6,"question_id":12788315,"title":"java vs scala - reading in file on a separate thread","body":"<p>I would like to know what the best in terms of industry practice way is to read in a file using multithreaded approach. In Java I would do something of the following sort:</p>\n\n<pre><code>class Reader {  Result readFile(File file, Listener callback) }\nclass Listener { void process(Result r) }\n</code></pre>\n\n<p>Reader would spawn another thread to generate a result and then call back the <code>Listener</code> from withing the working thread. Would this be a good approach? How would this translate into Scala, which probably has other, better mechanisms to achieve this?</p>\n"},{"tags":["c","multithreading","kill","popen"],"answer_count":6,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":5051,"score":3,"question_id":548063,"title":"kill a process started with popen","body":"<p>After opening a pipe to a process with <code>popen</code>, is there a way to kill the thread that is started? Using <code>pclose</code> is not what I want because that will wait for the thread to finish, but I need to kill it.</p>\n"},{"tags":["c#","multithreading","compact-framework","serial-port"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":649,"score":1,"question_id":4536219,"title":"SerialPort ReadLine() after Thread.Sleep() goes crazy","body":"<p>I've been fighting with this issue for a day and I can't find answer for it.\nI am trying to read data from GPS device trough COM port in Compact Framework C#. I am using SerialPort class (actually my own ComPort class boxing SerialPort, but it adds only two fields I need, nothing special). </p>\n\n<p>Anyway, I am running while loop in a separate thread which reads line from the port, analyze NMEA data, print them, catch all exceptions and then I Sleep(200) the thread, because I need CPU for other threads... Without Sleep it works fine, but uses 100% CPU.. When I don't use Sleep after few minutes the output from COM port looks like this:</p>\n\n<blockquote>\n  <p>GPGSA,A,3,09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  GSA,A,3,09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  A,A,3,09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  ,18,12,271,24,24,05,020,24,14,04,326,25,11,03,023,*76<br>\n  A,3,09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  3,09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  09,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F<br>\n  ,12,22,17,15,27,,,,,,,2.6,1.6,2.1*3F  </p>\n</blockquote>\n\n<p>as you can see the same message is read few times but <strong>cut</strong>.\nI wonder what I'm doing wrong...\nMy port configuration:</p>\n\n<pre><code>port.ReadBufferSize = 4096;  \nport.BaudRate = 4800;  \nport.DataBits = 8;  \nport.Parity = Parity.None;  \nport.StopBits = StopBits.One;  \nport.NewLine = \"\\r\\n\";  \nport.ReadTimeout = 1000;  \nport.ReceivedBytesThreshold = 100000; \n</code></pre>\n\n<p>And my reading function:</p>\n\n<pre><code>private void processGps(){  \n    while (!closing)   \n    {  \n        //reconnect if needed\n        try  \n        {  \n            string sentence = port.ReadLine();  \n            //here print the sentence  \n            //analyze the sentence (this takes some time 50-100ms)  \n        }  \n        catch (TimeoutException)  \n        {  \n            Thread.Sleep(0);  \n        }  \n        catch (IOException ioex)  \n        {  \n            //handling IO exception (some info on the screen)  \n        }  \n    Thread.Sleep(200);  \n    }  \n}\n</code></pre>\n\n<p>There is some more stuff in this function like reconnection if the device is lost etc., but it is not called when the GPS is connected properly. I was trying</p>\n\n<pre><code>port.DiscardInBuffer();\n</code></pre>\n\n<p>after some blocks of code (in TimeoutException, after read.)</p>\n\n<p>Did anyone had similar problem? I really dont know what I'm doing wrong.. The only way to get rig of it is removing the last Sleep.</p>\n"},{"tags":["python","multithreading","name-mangling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12787068,"title":"How variables defined in __init__ of Thread module get renamed to _Thread_<variable name>","body":"<p>I am going through the code of <code>threading</code> module(<code>&lt;Python Home&gt;/lib/threading.py</code>) on Active python 2.7.2 32 bit for Windows. In the <code>__init__</code> function of the <code>class Thread</code>, there are many variables defined:</p>\n\n<pre><code>self.__target = target\nself.__name = str(name or _newname())\nself.__args = args\nself.__kwargs = kwargs\nself.__daemonic = self._set_daemon()\nself.__ident = None\nself.__started = Event()\nself.__stopped = False\nself.__block = Condition(Lock())\nself.__initialized = True\n</code></pre>\n\n<p>Here is how I am calling the <code>__init__</code> function of <code>class Thread</code>:-</p>\n\n<pre><code>class ThreadWithReturnValue(Thread):\n    def __init__(self, group=None, target=None, name=None,\n                 args=(), kwargs={}, Verbose=None):\n\n        Thread.__init__(self, group, target, name, args, kwargs, Verbose)\n        self._return = None\n        print 'in init: ', self._Thread__target\n</code></pre>\n\n<p>I fail to understand that the variable <code>self._Thread__target</code> is not initialised anywhere in the <code>__init__</code> function of <code>class Thread</code>. But, if I print this variable in my own <code>__init__</code> function, the actual value for <code>self.__target</code> from <code>class Thread</code>'s <code>__init__</code> function is shown.</p>\n\n<p>Also, I tried to edit the <code>threading</code> module and put this line as the last line of the <code>__init__</code> function of <code>class Thread</code>:-</p>\n\n<p><code>print 'in init of Thread class in threading: ', self._Thread__target</code></p>\n\n<p>Still, I could see the value being printed and the interpreter does not display me any errors. So, I tried to find any function which might be doing the renaming stuff. But, could not find it.</p>\n\n<p>This is happening with all the other variables defined in the <code>__init__</code> function of <code>class Thread</code>. I want to know how the variables like <code>self.__target</code> are getting renamed to <code>self._Thread__target</code>.</p>\n"},{"tags":["c#",".net","multithreading","c#-4.0","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12785043,"title":"Ensure class is thread safe with only properties (any .NET 4.0 techniques specifically meant for this ?)","body":"<p>I have a class with two properties and two methods. Like the one below for example. (please ignore the data types or return types, it's just a typical scenario)</p>\n\n<pre><code>// The methods could be invoked by multiple threads\n    public class Stock\n    { \n\n    private static int FaceValue {get; set;}\n    private static int Percent (get; set;}\n\n    //    method that updates the two properties\n    Public void UpdateStock()\n    {\n      FaceValue += 1;\n      Percent = FaceValue * 100;\n    }\n\n    //   method that reads the two properties\n    public int[] GetStockQuote()\n    {\n        return new int[] { FaceValue, Percent};\n    }\n\n    }\n</code></pre>\n\n<p>I need to ensure this class is thread safe. I could use lock(obj) in both the methods as one technique to make it threadsafe but what would be the best technique to make it thread safe, considering the following: </p>\n\n<ol>\n<li><p>There are only two properties that is read/updated. So, not sure if locking inside the methods is a good technique.</p></li>\n<li><p>Will it be enough if I just make the properties thread safe rather than the methods or the class ? </p></li>\n<li><p>Also, is there a way to make the whole class thread safe rather than individual methods or properties ? Any recommended lock techniques from .Net 4.0 ?</p></li>\n</ol>\n\n<p>Just wondering if I am thinking through this right or may be I am over complicating it considering these. Many thanks in advance to help me get this clear.</p>\n\n<p>Mani</p>\n"},{"tags":["c#","multithreading","asynchronous","dispatcher","await"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":12786758,"title":"My async Task always blocks UI","body":"<p>In a WPF 4.5 application, I don't understand why the UI is blocked when I used await + a task :</p>\n\n<pre><code>    private async void Button_Click(object sender, RoutedEventArgs e)\n    {\n        // Task.Delay works great\n        //await Task.Delay(5000);\n\n        double value = await JobAsync(25.0);\n\n        MessageBox.Show(\"finished : \" + value.ToString());\n    }\n\n    private async Task&lt;double&gt; JobAsync(double value)\n    {\n        for (int i = 0; i &lt; 30000000; i++)\n            value += Math.Log(Math.Sqrt(Math.Pow(value, 0.75)));\n\n        return value;\n    }\n</code></pre>\n\n<p>The await Task.Delay works great, but the await JobAsync blocks the UI. Why ?\nThank you.</p>\n"},{"tags":["multithreading","locking","javamail"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12778374,"title":"Java Mail: Dispatcher thread locking","body":"<p>We are facing a issue with Java Mail. All message dispatchers that work on the internal queue are blocking in sending out emails though a timeout is set. Timeout is set in the source code to 15 seconds (configurable),  There are 6 dispatcher threads and over a period of time all gets locked and never gets timedout.</p>\n\n<pre><code>\"MssgDsptchr-0\" prio=3 tid=0x088e4400 nid=0x28 runnable [0xb1774000]\n   java.lang.Thread.State: RUNNABLE\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\n        at com.sun.mail.util.TraceInputStream.read\n   (TraceInputStream.java:106)\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:237)\n        - locked &lt;0xce56ea30&gt; (a java.io.BufferedInputStream)\n        at com.sun.mail.util.LineInputStream.readLine\n   (LineInputStream.java:84)\n        at com.sun.mail.smtp.SMTPTransport.readServerResponse\n   (SMTPTransport.java:1903)\n        at com.sun.mail.smtp.SMTPTransport.close(SMTPTransport.java:975)\n        - locked &lt;0xce56eb70&gt; (a com.sun.mail.smtp.SMTPTransport)\n        at javax.mail.Transport.send0(Transport.java:193)\n        at javax.mail.Transport.send(Transport.java:120)\n        at net.paybox.gw.msg.email.EMailChannel.send(EMailChannel.java:515)\n        at net.paybox.gw.msg.email.EMailChannel.send(EMailChannel.java:194)\n        at net.paybox.gw.msg.worker.AbstractWorker.sendMessage\n     (AbstractWorker.java:468)\n        - locked &lt;0xca7c0850&gt; (a net.paybox.gw.msg.worker.EmailWorker)\n        at net.paybox.gw.msg.MessageDispatcher.run\n    (MessageDispatcher.java:64)\"\n</code></pre>\n\n<p>I tested this with both 1.4.3 and 1.4.5, both exibit the same beaviour. What is the workaround for this?</p>\n\n<p>Thanks in advance,</p>\n\n<p>Regards,\nNirmala </p>\n"},{"tags":["java","android","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":58,"score":1,"question_id":12785971,"title":"Run terminated thread java android","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5411509/terminated-thread-revival\">Terminated Thread Revival</a>  </p>\n</blockquote>\n\n\n\n<pre><code> Thread threadWait = new Thread()\n    {\n        @Override\n        public void run() {\n            try {\n                sleep(10000);\n                sync = false;\n            } catch (InterruptedException e) {\n                // TODO Auto-generated catch block\n                e.printStackTrace();\n            }\n        }               \n    };\n</code></pre>\n\n<p>I call this thread here:</p>\n\n<pre><code>            threadWait.start();\n        while(sync){\n        //do something\n        }\n</code></pre>\n\n<p>when threadWait finished the state is TERMINATED. How i can start the thread another time? Any idea? THX TO ALL!</p>\n\n<p>SOLUTION:</p>\n\n<pre><code>Runnable runWait = new Runnable(){\n    public void run(){\n        try {\n            Thread.sleep(10000);\n            sync = false;\n        } catch (InterruptedException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n\n    }\n};\n</code></pre>\n\n<p>and..</p>\n\n<pre><code>Thread first = new Thread(runWait);\n            first.start();\n</code></pre>\n"},{"tags":["java","multithreading","swing","hibernate","swingworker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":65,"score":-1,"question_id":12725219,"title":"Cancel SwingWorker clearly with session","body":"<p>I have the following situation:</p>\n\n<p>2 swingworkers with session which collect data from the database. Now I want to cancel the second swingworker. I do swingworker.cancel(true) and in the done() method from the swingworker I close the session with session.close().</p>\n\n<p>After I have done that I think the swingworker has one sql statement which he is executing but he is cancelled and the session is closed so the following execption occures:</p>\n\n<pre><code>java.lang.NullPointerException\n    at org.hibernate.engine.jdbc.internal.proxy.ConnectionProxyHandler.getResourceRegistry(ConnectionProxyHandler.java:104)\n    at org.hibernate.engine.jdbc.internal.proxy.AbstractStatementProxyHandler.getResourceRegistry(AbstractStatementProxyHandler.java:73)\n    at org.hibernate.engine.jdbc.internal.proxy.AbstractStatementProxyHandler.wrapIfNecessary(AbstractStatementProxyHandler.java:150)\n    at org.hibernate.engine.jdbc.internal.proxy.AbstractStatementProxyHandler.continueInvocation(AbstractStatementProxyHandler.java:123)\n    at org.hibernate.engine.jdbc.internal.proxy.AbstractProxyHandler.invoke(AbstractProxyHandler.java:81)\n    at $Proxy9.executeQuery(Unknown Source)\n    at org.hibernate.loader.Loader.getResultSet(Loader.java:1953)\n    at org.hibernate.loader.Loader.scroll(Loader.java:2510)\n    at org.hibernate.loader.custom.CustomLoader.scroll(CustomLoader.java:337)\n    at org.hibernate.internal.SessionImpl.scrollCustomQuery(SessionImpl.java:1760)\n    at org.hibernate.internal.AbstractSessionImpl.scroll(AbstractSessionImpl.java:232)\n    at org.hibernate.internal.SQLQueryImpl.scroll(SQLQueryImpl.java:182)\n    at de.mudisar.dataloader.SecondarySwingWorker.doInBackground(SecondarySwingWorker.java:71)\n    at de.mudisar.dataloader.SecondarySwingWorker.doInBackground(SecondarySwingWorker.java:32)\n    at javax.swing.SwingWorker$1.call(SwingWorker.java:277)\n    at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n    at javax.swing.SwingWorker.run(SwingWorker.java:316)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:619)\n</code></pre>\n\n<p>What can i do to solve the problem. If i cancel the swingworker i want that all sql operations or other things should be cancelled and then close the session.</p>\n\n<p>//EDIT:</p>\n\n<p>Here is my code from my swingworker. This swingworker has its own session:</p>\n\n<pre><code>@Override\nprotected Void doInBackground() throws Exception {\n\ndoMappings();\n\nfetchSQL();\n\n\n}\n\nprivate void fetchSQL(){\n\nfor(String str : map.keySet()){\n\n    //build sql;\n    SQLQuery q = sess.createSQLQuery(query).addEntity(\"ins\", ALL_RSC_DATA.class);\n    q.setFetchSize(Integer.valueOf(1000));\n    q.setReadOnly(true);\n    ScrollableResults results = q.scroll(ScrollMode.FORWARD_ONLY);\n    while (results.next()) {\n\n        //processing\n\n    }\n\n}\n\n}\n</code></pre>\n\n<p>And this is my action (for cancel the swingworker) from my other class which handles the user inputs:</p>\n\n<pre><code>public Action cancelPrimarySwingWorker = new AbstractAction() {\n\n    /**\n     * \n     */\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public void actionPerformed(ActionEvent arg0) {\n        if(psw != null &amp;&amp; !psw.isDone()){\n            closeDBConnection(psw.getSession());\n            psw.cancel(true);\n            psw = null;\n            restoreData();\n        }\n    }\n};\n</code></pre>\n\n<p>For the complete information here my code for closeDBConnection():</p>\n\n<pre><code>@SuppressWarnings(\"deprecation\")\npublic static void closeDBConnection(Session session) {\n    if(session != null){\n        try {\n            //session.connection().createStatement().execute(\"SHUTDOWN\");\n            if(session.isOpen()){\n                session.cancelQuery();\n                session.clear();\n                session.close();\n            }\n            session = null;\n        }\n        catch (Exception sqle) {\n            logging(sqle);\n            System.exit(1);\n        }\n    }\n\n}\n</code></pre>\n"},{"tags":["c++","multithreading","boost"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12785060,"title":"How can I parallelize a for using boost?","body":"<p>To optimize the execution of some libraries I am making, I have to parallelize some calculations. \nUnfortunately, I can not use openmp for that, so I am trying to do some similar alternative using boost::thread.\nAnyone knows of some implementation like this? \nI have special problems with the sharing of variables between threads (to define variables as 'shared' and 'pribate' of openmp). Any sugestions?</p>\n"},{"tags":["javascript","ajax","multithreading","browser","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12785415,"title":"AJAX implementation in single-threaded Javascript","body":"<p>How are AJAX requests made asynchronous if Javascript is not multi-threaded?</p>\n\n<p>Is the implementation browser specific?</p>\n"},{"tags":["java","multithreading","spring"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12785033,"title":"Advice on how to stop task in java","body":"<p>I'm not a multithreading expert, just beginner so please try to understand my poor understanding of the subject.</p>\n\n<p>I have some tasks executing them asynchronously with <a href=\"http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html\" rel=\"nofollow\">ExecutorService</a>, which is created with this bean :</p>\n\n<pre><code>&lt;bean id=\"executorService\" class=\"java.util.concurrent.Executors\"\n    factory-method=\"newFixedThreadPool\"&gt;\n    &lt;constructor-arg value=\"10\" /&gt;\n&lt;/bean&gt;\n</code></pre>\n\n<p>I'm submitting my tasks like this :</p>\n\n<pre><code>Future&lt;String&gt; resultHandler = executorService.submit(new WorkerClass());\n</code></pre>\n\n<p>Let's imagine scenarion where I would have 2 tasks running at the same time, task <code>A</code> and task <code>B</code>.</p>\n\n<p>How would one stop just task <code>B</code> without making an impact to task <code>A</code>?</p>\n\n<p>What would be wise to save to where, meaning should I create some kind of <code>HashMap</code> or something to store my Future objects and retrieve them via some key and doing <code>cancel(true)</code> on them or how would someone more experienced do this?</p>\n"},{"tags":["multithreading","verifyerror"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12784782,"title":"Android: Galaxy Tab VerifyError & Thread","body":"<p>Hi I've got an error when lauching my of my app on Galaxy Tab (using API 8, sdk 2.2). It closes automatically (see the following logs)</p>\n\n<p>But it works fine on GS2, Galaxy Ace, Galaxy Note... i don't understand why</p>\n\n<p>Here is the log:</p>\n\n<pre><code>    10-08 15:20:29.143: E/AndroidRuntime(343): FATAL EXCEPTION: main\n    10-08 15:20:29.143: E/AndroidRuntime(343): java.lang.VerifyError: com.xxxxxx.MainActivity$10\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at com.xxxxxx.MainActivity.init_data(MainActivity.java:197)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at com.xxxxxx.MainActivity.onCreate(MainActivity.java:94)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2627)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2679)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.ActivityThread.access$2300(ActivityThread.java:125)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2033)\n    10-08 15:20:29.143: E/AndroidRuntime(343):  at android.os.Handler.dispatchMessage(Handler.java:99)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at android.os.Looper.loop(Looper.java:123)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at android.app.ActivityThread.main(ActivityThread.java:4627)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at java.lang.reflect.Method.invokeNative(Native Method)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at java.lang.reflect.Method.invoke(Method.java:521)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)\n10-08 15:20:29.143: E/AndroidRuntime(343):  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)\n</code></pre>\n\n<p>Here is what i'm trying to build </p>\n\n<pre><code>new Thread(new Runnable() {\n            public void run() {\n                Bdd bdd = new Bdd(getApplicationContext());\n                bdd.open();\nInsert actions....\n\n}).start();\n</code></pre>\n\n<p>Is it due to some SDK compatibility ? I don't know how to fix this.</p>\n"},{"tags":["java","multithreading","executorservice","future"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12779314,"title":"Time elapsed since last data event","body":"<p>I have a class (shown below) which receives data updates. My aim is to find out if no data updates have been received 5 minutes since the last data update.</p>\n\n<p>This is my code:</p>\n\n<pre><code>public class DataListener {\n\n    private final ScheduledThreadPoolExecutor executor;\n    private ScheduledFuture&lt;Void&gt; future;\n\n    public DataUpdateListener() {\n        executor = new ScheduledThreadPoolExecutor(1);\n    }\n\n    /**\n     * Start listening for data.\n     */\n    public void start() {\n        // do some setup...\n\n        rescheduleTask();\n    }\n\n    /**\n     * Called whenever a data event is received.\n     */\n    public void onEvent(final DataEvent event) {\n        System.out.println(\"Received event: \" + event);\n        rescheduleTask();\n    }\n\n    private synchronized void rescheduleTask() {\n        // cancel the existing task\n        if (future != null) {\n            future.cancel(true);\n            executor.purge();\n        }\n\n        // schedule a new one\n        future = executor.schedule(new Callable&lt;Void&gt;() {\n            @Override\n            public Void call() {\n                System.out.println(\"No data events received in the last 5 minutes!\");\n                // do some stuff...\n                shutdown();\n                return null;\n            }\n        }, 5, TimeUnit.MINUTES);\n    }\n\n    void shutdown() {\n        executor.shutdownNow();\n    }    \n}\n</code></pre>\n\n<p>The class maintains a <code>ScheduledThreadPoolExecutor</code>. Whenever a data update is received, it cancels the existing task and schedules a new one. </p>\n\n<p>I'm wondering if this approach is ok or if there is a better way to do this.</p>\n"},{"tags":["python","multithreading","wxpython"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":12780773,"title":"wxpython closing application with thread","body":"<p>Hi guys i have a little trouble.\nI finished my program which check if exists a new revision on bitbucket.\nAll is fine except when i close my application and the thread is still running, the program can be seen in task manager.\nCode of EVT_CLOSE is the following:</p>\n\n<pre><code>    def on_close(self, event):\n    if self._thread is not None and self._thread.isAlive():\n        self._thread.interrupt.set()\n    self.Destroy()\n    event.Skip()\n</code></pre>\n\n<p>Thread is running like deamon.</p>\n\n<p>What's wrong?</p>\n\n<p>EDIT:\ni understund and i tried to do join() method on the thread.\nBut i doesn't work.</p>\n\n<pre><code>    def on_close(self, event):\nif self._thread is not None and self._thread.isAlive():\n    self._thread.join()\n    self._thread.interrupt.set()\nself.Destroy()\nevent.Skip()\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>        def on_close(self, event):\nif self._thread is not None and self._thread.isAlive():\n    self._thread.join(10)\n    self._thread.interrupt.set()\nself.Destroy()\nevent.Skip()\n</code></pre>\n"},{"tags":["java","multithreading","swing","gui","jtextarea"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":467,"score":2,"question_id":4869027,"title":"JTextArea thread safe?","body":"<p>I have some code that does some initialization (including making a JTextArea object), starts three seperate threads, and then these threads try to update the JTextArea (i.e. append() to it), but its not working at all. Nothing shows up on the JTextArea (however, during the initialzation, I print some test lines onto it, and that works fine). What's going on? How can I fix this? Also, each of those threads sleeps a random amount of time every time it has to update the JTextArea.</p>\n\n<p>Sorry I haven't provided any code, its all spread out over several files.</p>\n"},{"tags":["multithreading","perl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":254,"score":1,"question_id":6001260,"title":"How to wake a thread in Perl","body":"<p>Is there any way for waking a sleeping thread using its thread ID in Perl ? Thanks in advance</p>\n\n<p>Below is the what I have tried using suspend and resume </p>\n\n<pre><code>use warnings;\nuse strict;\nuse threads;\nuse threads::shared;\nuse Thread::Suspend;  \n\nmy $val:shared = 0;\nmy $count = 0; \nwhile ( $count &lt; 4 )\n{\n    my $thr = threads-&gt;create( \\&amp;worker );\n    $count++;\n}\n\nuse Tk;\nmy $mw = MainWindow-&gt;new();\n$mw-&gt;protocol('WM_DELETE_WINDOW' =&gt; sub { &amp;clean_exit }); \nmy $thr;\nmy $button;\n$button = $mw-&gt;Button(\n        -text =&gt; 'Invoke thread',\n        -command =&gt; sub{\n            $val += 1;\n            if( $val &gt; 4)\n            {\n                $val = 1;\n            }   \n            foreach $thr (threads-&gt;list()) \n            {\n                if( $thr-&gt;tid() == $val )\n                {\n                    $thr-&gt;resume();\n                    goto OUTSIDE;\n                }\n            }\n            OUTSIDE:                                                \n        })-&gt;pack();\n\nMainLoop;\n\nsub clean_exit\n{\n    my @running_threads = threads-&gt;list;\n    if (scalar(@running_threads) &lt; 1)\n    {\n        print \"\\nFinished\\n\";\n        exit;\n    }\n    else\n    {\n        foreach my $thr (threads-&gt;list()) \n        {\n            $thr-&gt;kill('KILL')-&gt;detach();\n        }\n        exit;\n    }\n}\n\nsub worker\n{\n    $SIG{'KILL'} = sub { threads-&gt;exit(); };\n    threads-&gt;suspend();\n    print threads-&gt;tid().\"\\n\";  \n}\n</code></pre>\n\n<p>What I am trying to do is when user click on Invoke button it should resume the thread based on the $val. But its not working in that way. First thread with ID 4 is resume that too after 4 clicks instead of 1. Please help in debugging the code. P.S. I am newbie to Perl</p>\n"},{"tags":["multithreading","pthreads","valgrind","race-condition"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12782662,"title":"possible race condition in pthread application (unable to detect)","body":"<p>Here is my problem with a pthread code. When I run the following commands:</p>\n\n<pre><code> ./run 1\n ./run 2\n ./run 4\n</code></pre>\n\n<p>the first two commands (one thread and two threads) generate the same output. However with 4 threads (third command), I see different outputs.</p>\n\n<p>Now when I run the following commands</p>\n\n<pre><code> valgrind --tool=helgrind ./run 1\n valgrind --tool=helgrind ./run 2\n valgrind --tool=helgrind ./run 4\n</code></pre>\n\n<p>They generate the same outputs. The output values are correct though.</p>\n\n<p>How can I investigate further?</p>\n\n<p>The code looks like</p>\n\n<pre><code>int main(int argc,char *argv[])\n{\n  // Barrier initialization\n  if(pthread_barrier_init(&amp;barr, NULL, threads)) {\n    printf(\"Could not create a barrier\\n\");\n    return -1;\n  }\n  int t;\n  for(t = 0; t &lt; threads; ++t) {\n    printf(\"In main: creating thread %ld\\n\", t);\n    if(pthread_create(&amp;td[t], NULL, &amp;foo, (void*)t)) {\n      printf(\"Could not create thread %d\\n\", t);\n      return -1;\n    }\n  }\n  ...\n}\n\n\nvoid * foo(void *threadid)\n{\n  long tid = (long)threadid;\n  for ( i = (tid*n/threads)+1; i &lt;= (tid+1)*n/threads; i++ ) {\n    printf( \"Thread %d, i=%d\\n\", tid, i );\n    for(largest = i, j = i+1; j &lt;= n; j++) {\n      if(abs( a[j][i] ) &gt; abs( a[largest][i] ))\n         largest = j;\n    }\n    for(k = i; k &lt;= n+1; k++)\n      SWAP_DOUBLE( a[largest][k], a[i][k]);\n    for( j = i+1; j &lt;= n; j++) {\n      for( k = n+1; k &gt;= i; k--)\n         a[j][k] = a[j][k]-a[i][k]*a[j][i]/a[i][i];\n    }\n  }\n  int rc = pthread_barrier_wait(&amp;barr);\n  if(rc != 0 &amp;&amp; rc != PTHREAD_BARRIER_SERIAL_THREAD) {\n    printf(\"Could not wait on barrier\\n\");\n    exit(-1);\n  }\n  printf(\"after barrier\\n\");\n  ...\n}\n</code></pre>\n\n<p>The main loop (which iterate over <code>i</code> in <code>foo()</code>) is divided by the number of threads. assume all variables are defined properly since as I said there is no problem with 1 and 2 threads.</p>\n"},{"tags":["c","multithreading","fork"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":63,"score":-2,"question_id":9821062,"title":"Tracing after threads behavior in C","body":"<p>Can someone help me with this following code:</p>\n\n<pre><code>static int x; // x is a global variable\n\nint main() { \n  int i; \n  x = 1; \n  for (i = 0; i &lt; 10; i++) \n    fork(); \n    printf(\"%d\\n\", x); \n    x *= 2; \n  } \n  return 0; \n} \n</code></pre>\n\n<p>What might be the output of this program?\nIt looks like the thread are duplicated infinitely so I can't figure this out</p>\n\n<p>Thanks ahead</p>\n"},{"tags":["c#","multithreading",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12783781,"title":"Interlocked.Increment an integer array","body":"<p>Is this guaranteed to be threadsafe/not produce unexpected results?</p>\n\n<pre><code>Interlocked.Increment(ref _arr[i]);\n</code></pre>\n\n<p>My intuition tells me this is not, i.e. reading the value in _arr[i] is not guaranteed to be 'atomic' with the actual incrementing.</p>\n\n<p>If I am correct in thinking this is wrong, how can I fix this? Thanks.</p>\n"},{"tags":["multithreading","batch","wget","simultaneous-calls"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12176707,"title":"batch script: loop and labels","body":"<p>I am trying to make a script (batch in windows) that download 5 text files using wget, and do some operations to each one, so I am thinking to do this with a loop just like this</p>\n\n<pre><code>set i=0\n:begin\nset /a i=%i%+1\nif %i% equ 5 exit\nwget \".....file1.txt\"\ngoto operations\n\n:operations\nstuff\nstuff\ngoto begin\n</code></pre>\n\n<ul>\n<li>operation consist of getting infromation from the text using grep and sed and saving it to text</li>\n</ul>\n\n<p>well, it should work, but this will take a lot of time, I want the batch to do it in an efficient way, because in this way it will download one (take some time) and will do the opeartions.\nWhat I want to do is to make it a multi threaded, I mean to make it do these 5 files (download+operations) simultaneously.</p>\n\n<p>thanks </p>\n"},{"tags":["c#","winforms","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12782638,"title":"Multi-threading","body":"<p>The application I'm currently working on performs some I/O or CPU intensive actions (file compression, file transfers, communicating with third party APIs, etc.) that occur when a user presses a 'Send' button.</p>\n\n<p>I'm currently trying to persuade my employers that we should push these actions out to separate threads inside the main application (we'd need a maximum of two worker threads active at any given time), but my colleague has claimed that: </p>\n\n<blockquote>\n  <p>Any extra processing executed on a low priority thread could affect the usability of the GUI.</p>\n</blockquote>\n\n<p>My view was that pushing I/O or CPU intensive activity to worker threads, updating the UI with Invoke calls during progress reporting, is pretty standard practise for handling intensive activity.</p>\n\n<p>Am I incorrect? If so, could someone provide an explanation?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Thank you for the answers so far.</p>\n\n<p>I should clarify: the colleague's solution to non-blocking is to spawn a child process containing a timer loop that scans a folder and processes the file compression/transfer activities. (Note that this doesn't cover the calls to third party APIs - I have no idea what his solution there would be.</p>\n\n<p>The main issue with this approach is that the main application loses all scope on the state of whatever activity., leading to, IMHO, further complexity (his solution to progress reporting is to expose the Windows message pump in both processes and send custom messages between the two processes).</p>\n"},{"tags":["wpf","vb.net","multithreading","xaml"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12781922,"title":"thread was created with a ThreadStart delegate that does not accept a parameter","body":"<p>I have a question about ThreadStart delegates in vb.net. I am taking over a senior programmer's project, and he is much more experienced then myself so I'm kind of lost on what he was trying to do. I am trying to do some research on Threading but there is a lot out there on this topic and don't want to waste my time with stuff that doesn't pertain to my error here. I will post the whole exception message and hopefully someone can point me in the direction of an article that I could read to learn more about it.</p>\n\n<pre><code>System.InvalidOperationException was unhandled\n  Message=The thread was created with a ThreadStart delegate that does not accept a parameter.\n  Source=mscorlib\n  StackTrace:\n       at System.Threading.Thread.Start(Object parameter)\n       at LabelLibrary.LabelPrinter.Print(PrintQueue queue) in C:\\Documents and Settings\\bjorandb\\Desktop\\LabelPrintingService\\LabelTemplates\\clsLabelPrinter.vb:line 94\n       at LabelLibrary.LabelPrinter.Print() in C:\\Documents and Settings\\bjorandb\\Desktop\\LabelPrintingService\\LabelTemplates\\clsLabelPrinter.vb:line 53\n       at PrintApplyApplication.HomeController.PrintThread.Print() in C:\\Documents and Settings\\bjorandb\\Desktop\\LabelPrintingService\\PrintApplyApplication\\Controllers\\HomeController.vb:line 85\n       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)\n       at System.Threading.ExecutionContext.runTryCode(Object userData)\n       at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)\n       at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\n       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)\n       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\n       at System.Threading.ThreadHelper.ThreadStart()\n  InnerException: \n</code></pre>\n\n<p>Here is the function that the error is getting thrown in, but I don't know how much help it will be by itself. </p>\n\n<pre><code>Public Function Print(ByVal queue As PrintQueue) As PrintResult\n    Dim result As PrintResult = Nothing\n    Dim job As PrintSystemJobInfo = Nothing\n    Dim thread As Threading.Thread = Nothing\n\n    result = New PrintResult\n    If queue Is Nothing Then\n        result.Status = \"Can not find printer \" &amp; queue.Name &amp; \".\"\n    ElseIf PrintFilePath Is Nothing Then\n        result.Status = \"Print File Path Cannot be nothing.\"\n    Else\n        Try\n            thread = New Threading.Thread(AddressOf AddJob)\n            thread.SetApartmentState(Threading.ApartmentState.STA)\n            thread.Start(queue) &lt;--- (Exception is being thrown here!!)\n            result.Status &amp;= \"Print Sent Successfully\"\n        Catch ex As PrintJobException\n            If ex.InnerException.Message = \"File contains corrupted data.\" Then\n                result.Status &amp;= \"Could not generate a label with given xps file. Check the xps file format and if it is corrupted.\"\n            End If\n            result.Status &amp;= \"There was an error printing.\"\n            result.ErrorMessage = ex.Message\n        End Try\n        If queue.IsOutOfPaper Then\n            result.Status &amp;= \"The printer is out of Paper.\"\n        End If\n        If queue.IsPaperJammed Then\n            result.Status &amp;= \"The Printer is jammed.\"\n        End If\n        If (queue.IsOutOfMemory) Then\n            result.Status &amp;= \"The Printer is out of memory.\"\n        End If\n    End If\n    Return result\nEnd Function\n</code></pre>\n\n<p>And here is the AddJob method</p>\n\n<pre><code>Private Sub AddJob()\n    Dim job As PrintSystemJobInfo = Nothing\n\n    Try\n        job = LocalPrintServer.GetDefaultPrintQueue.AddJob(\"Text\", PrintFilePath, False)\n        job.Refresh()\n        While Not (job.IsCompleted Or job.IsDeleted)\n            job.Refresh()\n        End While\n    Catch ex As PrintJobException\n    End Try\n    If System.IO.File.Exists(PrintFilePath) Then\n        System.IO.File.Delete(PrintFilePath)\n    End If\nEnd Sub\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12769408,"title":"Use threading in a loop, how to finish for loop before reaching to end of the main program?","body":"<p>My expected output is</p>\n\n<pre><code>Count : 1\nCount : 2\nCount : 3\nCount : 4\nCount : 5\n</code></pre>\n\n<p>I have tried synchronized and Lock but neither of them works. I reach to </p>\n\n<blockquote>\n  <p>Ending Main</p>\n</blockquote>\n\n<p>sooner than I finish the loop completely. Current output is:</p>\n\n<pre><code>Starting Main\nCount : 1\nCount : 2\nCount : 3\nCount : 4\nEnding Main\nCount : 5\n</code></pre>\n\n<p>Any Idea why  Count : 5 is after Ending Main? Here is my code:</p>\n\n<pre><code>public class Demo {\n    public static void main( String [] args ) {\n        System.out.println( \"Starting Main\" ) ;\n        for ( int i = 1 ; i &lt;= 5 ; i++ ) {\n            Thread numberThread = new Thread(new NumberTask(i)) ;\n            numberThread.start() ;\n        }\n        System.out.println( \"Ending Main\" ) ; \n    }\n}\n\nclass NumberTask implements Runnable {\n    private Lock bankLock = new ReentrantLock();\n    int count ;\n    public NumberTask( int count ) {\n        this.count = count ;\n    }\n\n    synchronized public void run() {\n        bankLock.lock();\n        try {\n            System.out.println( \"Count : \" + count ) ;\n        } finally {\n            bankLock.unlock();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["multithreading","timer","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12781442,"title":"System.timers.timer - unable to update label with time elapsed","body":"<p>I want to display time elapsed on Label control on  windows form.\nfor that i am using System.Timers.timer but unable to update Label with the elapsed time on button click event.</p>\n\n<p>For example</p>\n\n<pre><code>Private Shared mtimer As System.Timers.Timer\n\nPrivate Sub btnprocess_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnprocess.Click\n\n'Counter to Calculate time as Process Starts\n mDate = Date.Now\n ''Create a timer with  second interval\n mtimer = New System.Timers.Timer()\n ''Hook the Elapsed event\n **AddHandler mtimer.Elapsed, AddressOf Processtick**\n mtimer.Start()\n'set the interval 1 second \n mtimer.Interval = 1000\n mtimer.Enabled = True\n\n ''Some functions \n\n   end sub \n\nPrivate Sub Processtick(ByVal source As Object, ByVal e As ElapsedEventArgs)\n\nDim ts As TimeSpan = DateTime.Now.Subtract(mDate)\nlblelapsed.Text = ts.Hours &amp; \":\" &amp; ts.Minutes &amp; \":\" &amp; ts.Seconds\n\nEnd sub\n</code></pre>\n\n<p>tried above code but  it doesnt work, \ni want to update elapsed time on label control as soon as user click Process button<br>\ntill  all the  functions get executed on button click. </p>\n\n<p>Please help.</p>\n"},{"tags":["android","multithreading","android-asynctask","handler","runonuithread"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":153,"score":6,"question_id":12618038,"title":"Why to use Handlers while runOnUiThread does the same?","body":"<p>I have come across both <a href=\"http://developer.android.com/reference/android/os/Handler.html\" rel=\"nofollow\">Handlers</a> and <a href=\"http://developer.android.com/reference/android/app/Activity.html#runOnUiThread%28java.lang.Runnable%29\" rel=\"nofollow\">runOnUiThread</a> concepts. But to me it still seems to be a doubt as on which facts do they differ exactly. </p>\n\n<p>They both are intended to do UI actions from a background thread. But what are the factors that are to be considered while we choose among the two methods. </p>\n\n<p>For example consider a <code>Runnable</code> <code>Thread</code> which performs a web service in the background and now I want to update the UI. </p>\n\n<p><strong>What would be the best way to update my UI? Should I go for <code>Handler</code> or <code>runOnUiThread</code>?</strong></p>\n\n<p>I still know I could use a <code>AsyncTask</code> and make use of <code>onPostExecute</code>. But I just want to know the difference. </p>\n\n<p>Can anyone help me on this ?</p>\n"},{"tags":["python","multithreading","twisted","timedelay"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1339,"score":4,"question_id":2243266,"title":"Threads in twisted... how to use them properly?","body":"<p>I need to write a simple app that runs two threads:\n- thread 1: runs at timed periods, let's say every 1 minute\n- thread 2: just a 'normal' while True loop that does 'stuff'</p>\n\n<p>if not the requirement to run at timed interval I would have not looked at twisted at all, but simple sleep(60) is not good enough and construction like:</p>\n\n<pre><code>l = task.LoopingCall(timed_thread)\nl.start(60.0)\nreactor.run()\n</code></pre>\n\n<p>Looked really simple to achieve what I wanted there.</p>\n\n<p>Now, how do I 'properly' add another thread?</p>\n\n<p>I see two options here:</p>\n\n<ul>\n<li>Use threading library and run two 'python threads' one executing my while loop, and another running reactor.run(). But Google seems to object this approach and suggests using twisted threading</li>\n<li>Use twisted threading. That's what I've tried, but somehow this looks bit clumsy to me.</li>\n</ul>\n\n<p>Here's what I came up with:</p>\n\n<pre><code>def timed_thread():\n    print 'i will be called every 1 minute'\n    return\n\ndef normal_thread():\n    print 'this is a normal thread'\n    time.sleep(30)\n    return\n\nl = task.LoopingCall(timed_thread)\nl.start(60.0)\nreactor.callInThread(normal_thread)\nreactor.run()\n</code></pre>\n\n<p>That seems to work, but! I can't stop the app. If I press ^C it wouldn't do anything (without 'callInThread' it just stops as you'd expect it to). ^Z bombs out to shell, and if I then do 'kill %1' it seems to kill the process (shell reports that), but the 'normal' thread keeps on running. kill PID wouldn't get rid of it, and the only cure is kill -9. Really strange.</p>\n\n<p>So. What am I doing wrong? Is it a correct approach to implement two threads in twisted? Should I not bother with twisted? What other 'standard' alternatives are to implement timed calls? ('Standard' I mean I can easy_install or yum install them, I don't want to start downloading and using some random scripts from random web pages).</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12780390,"title":"Ordering requests to servlet","body":"<p>Suppose I have a servlet that on <code>doPost</code> method performs some actions. Also I have some pool of <code>Connections</code>(let it be <code>N</code> connections) to some web-service that are taken from the pool on each request to my servlet(1 connection per request). In <code>doPost</code> method of the servlet I retrieve a connection from the pool, use it(this operation may last too long) and put back it to the pool.</p>\n\n<p>Suppose that <code>N</code> connections are made simultaneously to the servlet, so <code>N</code> connections will be retrieved from the pool. And while that requests are being processed, <code>N+1</code> and <code>N+2</code> requests are arrived, so they will wait until releasing of some connection occurs(my pool is backed by <code>BlockingQueue</code>).</p>\n\n<p>I want to guarantee that <code>N+1</code> request will own the available connection earlier than <code>N+2</code> request.</p>\n\n<p>How can I achieve this?</p>\n"},{"tags":["python","multithreading","asynchronous"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":12779808,"title":"What is asynchronous I/O in python?","body":"<p>am sorry for this dumb beginner question, but i have a real problem understanding the concept on asynchronous I/O, i dont speak about callback and other complicated stuff, i just wan to understand the beginning of \"how python execute the code\" </p>\n\n<p>so here is the example i want to understand with</p>\n\n<pre><code>class Foo()\n    take a user input # line 1\n    seek for this input from the database # line 2\n    make some operation using the database output # line 3\n    make an output to the client and show the message to the page # line 4\n</code></pre>\n\n<p>so if a user will use Tornado for example, if he execute the code on the server, then, suppose we have <strong>4 clients</strong> requesting the page where the url matches to the class <code>Foo</code>, then, how Python will execute the code;</p>\n\n<p>ie; in python, since it's a <code>Script</code> language, then every line is executing and returning the value? so does it execute the <strong>line 1</strong> for the <strong>user 1</strong>, and then <strong>stops</strong>, and serves the <strong>line 1</strong> for <strong>the client 2</strong> and so on with the rest of clients, and then skip to the <strong>line 2</strong> and so on?</p>\n"},{"tags":["c","multithreading","function","struct"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12766190,"title":"Struct within a union within a struct changes during function call","body":"<p>I'm working on a multithreaded producer-consumer program in c that implements semaphores. Each buffer struct has two general semaphores - one for empty buffers and one for full buffers. However, when the program enters the readInput function, the value of those two semaphores change to random values. The semaphore within the thread struct is fine, but the semaphores within the buffer struct within the IO union within the thread struct change for some reason. Any idea why this is happening?</p>\n\n<pre><code>#include \"st.h\"\n#include \"semaphore.h\"\n#include \"buffer.h\"\n\n/*Definitions here*/\n//Input location.\n#define DEFAULT_IN stdin\n//Output location.\n#define DEFAULT_OUT stdout\n//Line width\n#define LINE_SIZE 80\n#define SLEEP_TIME 333333\n\n//Shorthand for structure components\n#define INPUT thread-&gt;in\n#define MUTEX thread-&gt;mutex\n#define OUTPUT thread-&gt;out\n\n/*Global variables here*/\n\n//The input/output can be a stream or a buffer.\ntypedef union\n{\n    buffer *bufferIO;   //Buffer to read from/write to.\n    FILE *stream;       //An I/O stream.\n} IO;\n\n//Each thread has an input, a semaphore, and an output.\ntypedef struct\n{\n        IO in;          //Either an input stream or a buffer to read.\n        semaphore *mutex;   //Pointer to a binary semaphore.\n        IO out;         //Either an output stream or a buffer to write.\n} Thread;\n\n\n/*Function prototypes here*/\nvoid *readInput(void *s);\nvoid *processLines(void *s);\nvoid *processAsterisks(void *s);\nvoid *writeOutput(void *s);\n\nint main (int argc, char const *argv[])  //The main function  \n{\n    st_init();\n\n    /*Binary semaphore*/\n    semaphore mutex;        //Binary semaphore for mutual exclusion.\n    createSem(&amp;mutex, 1);\n\n    printf(\"Beginning...\\n\");\n    /*The three buffers between threads*/\n    buffer B1, B2, B3;\n    createBuf(&amp;B1);\n    createBuf(&amp;B2);\n    createBuf(&amp;B3);\n\n    /*The 5 data locations*/\n    IO input, buffer1, buffer2, buffer3, output;    //stdin, 3 buffers, stdout\n\n    /*Set the unions*/\n    input.stream = DEFAULT_IN;  //Input stream\n    buffer1.bufferIO = &amp;B1;     //Contains raw input\n    buffer2.bufferIO = &amp;B2;     //Newlines have become spaces\n    buffer3.bufferIO = &amp;B3;     //** has become ^\n    output.stream = DEFAULT_OUT;    //Output stream, 80 at a time\n\n    /*Initialize the threads*/\n        Thread input_thread = {input, &amp;mutex, buffer1};         //Recieve input\n        Thread proc1_thread = {buffer1, &amp;mutex, buffer2};       //Returns to spaces\n        Thread proc2_thread = {buffer2, &amp;mutex, buffer3};       //** to ^\n        Thread output_thread = {buffer3, &amp;mutex, output};       //Output 80 characters and a newline.\n\n    printf(\"%i\\n\", input_thread.out.bufferIO-&gt;emptyBuffers-&gt;value);\n    /*Create the actual threads*/\n    if(st_thread_create(readInput, &amp;input_thread, 0, 0) == NULL)\n    {\n        perror(\"st_thread_create for input thread failure\");\n        exit(1);\n    }\n    printf(\"%i\\n\", input_thread.out.bufferIO-&gt;emptyBuffers-&gt;value);\n    if(st_thread_create(processLines, &amp;proc1_thread, 0, 0) == NULL)\n    {\n        perror(\"st_thread_create for line thread failure\");\n        exit(1);\n    }\n    if(st_thread_create(processAsterisks, &amp;proc2_thread, 0, 0) == NULL)\n    {\n        perror(\"st_thread_create for asterisk thread failure\");\n        exit(1);\n    }\n    if(st_thread_create(writeOutput, &amp;output_thread, 0, 0) == NULL)\n    {\n        perror(\"st_thread_create for output thread failure\");\n        exit(1);\n    }\n\n    st_thread_exit(NULL);\n    return 0;\n}\n/*Function definitions here*/\nvoid *readInput(void *s)\n{\n    Thread *thread = s;\n    char c;                 //An individual character.\n\n    printf(\"Type some input.\\n\");\n    do\n    {\n        down(MUTEX);\n        c = getc(INPUT.stream);     //Consume a character from input.\n    printf(\"%i\\n\", OUTPUT.bufferIO-&gt;emptyBuffers-&gt;value);\n        deposit(OUTPUT.bufferIO, c);    //Produce a character.\n        up(MUTEX);\n        st_usleep(SLEEP_TIME);      //Wait.\n    }\n    while(c != EOF);            //Do-while in order to pass on the EOF as an exit flag.\n\n    //EOF reached - exit thread.\n    //assert(c == EOF);\n\n    printf(\"\\nDone reading.\");\n    st_thread_exit(NULL);\n}...\n</code></pre>\n\n<p>Upon looking at it with gdb, I found this:</p>\n\n<pre><code>Hardware watchpoint 10: (*(*input_thread.out.bufferIO).emptyBuffers).value\n(gdb) c\nContinuing.\nHardware watchpoint 10: (*(*input_thread.out.bufferIO).emptyBuffers).value\n\nOld value = 80\nNew value = 4216725\n0x000000395221467c in _dl_runtime_resolve () from /lib64/ld-linux-x86-64.so.2\n</code></pre>\n\n<p>Not sure what this _dl_runtime_resolve is.</p>\n"},{"tags":["java","multithreading","sleep","wait"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12777715,"title":"How to sleep() and release monitors temporary?","body":"<p>I need to sleep for a given amount of time and release monitors for that time. How to accomplish that? May be wait for some timer or something?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I am implementing sound processing and need to delay stream read/write if is very advanced in time. I think there are two general approaches: (1) wait when big advance (2) have special monitor and timer to lock it until time come.</p>\n"},{"tags":["java","multithreading","threadpool","executorservice"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":1460,"score":7,"question_id":5740478,"title":"How to name the threads of a thread pool in Java","body":"<p>I have a Java application that uses the Executor framework and I have code that looks like this\n<code>protected ScheduledExecutorService scheduledExecutorService = new ScheduledThreadPoolExecutor(5)</code></p>\n\n<p>My understanding is that internally the JVM would create a pool of 5 threads. Now when I check the execution in a profiler, I get something like thread-pool2,thread-pool3 and so on.</p>\n\n<p>Some of these thread pools are created by the server and some are created by me, I need a way to differentiate which were created by me and which were created by the server.</p>\n\n<p>I am thinking that if I can name the thread pools it should do the trick, however do not see any API which would allow me to do the same.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","winforms","multithreading","timer","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12777039,"title":"Timer Tick Event and Thread in WinForms","body":"<p>I have a timer named <code>SendTimer</code>, the interval is 30 secs.  </p>\n\n<pre><code>protected void SendTimer_Tick(object sender, eventArgs e)\n{\n      SendTimer.Enabled = false;\n\n      TransferMoney();\n\n      System.Threading.Thread.Sleep(15000);\n\n      GenerateTransactions();\n\n      SendTimer.Enabled = true;\n}\n</code></pre>\n\n<p>I expected tick event to be called correctly by one thread at the same time. NOT by 2 threads simultaneously. but as I saw in my LOGS it seems to be called by a thread while another thread was in action. Any Idea? Because I disable and enable it respectively.</p>\n"},{"tags":["java","multithreading","smtp","javamail"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12732584,"title":"Threadsafety in Javamail","body":"<p>I'm researching whether Javamail is threadsafe, in particular in a situation with many sessions corresponding to different users, several SMTP servers and the use of creating MIME messages and use of <code>transport.sendMessage</code> method.  I know Javamail is oriented toward desktop-use which makes me suspect it may not have been built with threading in mind, and am wondering if anyone has such experience.</p>\n"},{"tags":["ruby-on-rails","multithreading","concurrency"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12766456,"title":"In what way is Ruby on Rails NOT multithreaded?","body":"<p><strong>Disclaimer</strong>: I'm a c# ASP.NET developer learning \"RoR\". Sorry if this question doesn't \"get\" RoR, any corrections greatly appreciated!</p>\n\n<h1>What is multithreading</h1>\n\n<p>My understanding of \"multithread\" ability in web apps is twofold:</p>\n\n<ol>\n<li>Every time a web/app server receives a request it can assign a thread to the new request, thus multiple requests can run concurrently.</li>\n<li>The app runtime + language allows for multiple threads to be used WITHIN a single request (in ASP.NET via \"Async\" methods and keywords <strong>for example</strong>).</li>\n</ol>\n\n<p>In this way, IIS7 + ASP.NET can do points 1 AND 2.</p>\n\n<h1>I'm confused about RoR</h1>\n\n<p>I've read these two articles and they have left me confused:</p>\n\n<ul>\n<li><a href=\"http://ikaisays.com/2012/10/04/clearing-up-some-things-about-linkedin-mobiles-move-from-rails-to-node-js/\" rel=\"nofollow\">Clearing up some things about LinkedIn mobile’s move from Rails to\nnode.js</a></li>\n<li><a href=\"http://www.jordanhollinger.com/2011/04/23/how-to-deploy-a-multi-threaded-rails-app\" rel=\"nofollow\">How to deploy a multi-threaded Rails app</a></li>\n</ul>\n\n<h2>question one.</h2>\n\n<p>I think I understand that RoR doesn't lend itself very well to point number 2 above, that is, having multiple threads within the same request, have I got that right?</p>\n\n<h2>question two.</h2>\n\n<p>Just to be crystal clear, RoR app/web servers can also do point number 1 above right (that is, multiple requests can run concurrently)? is that not always the case with RoR?</p>\n"},{"tags":["multithreading","excel-2007","udf","excel-2010","user-defined-functions"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12746722,"title":"Excel 2007/2010 crashes on UDF calls","body":"<p>I am facing a peculiar problem in Excel 2007/2010. I have a COM AddIn and a set of UDFs (User Defined Functions). The COM addin uses a shim dll and all calls are routed to our main .NET assembly. Everything was working fine when one day a tester did the following:  </p>\n\n<ol>\n<li>Added a UDF to cell A1 and B1</li>\n<li>Double-clicked the right-corner of cell A1 to apply the function to all the cell in the column</li>\n<li>While the function are being applied by Excel, he repeated step #2 with cell B1</li>\n</ol>\n\n<p>Excel 2007/2010 crashed. Excel 2003 survived without any problem. Any ideas what could be the problem here? <a href=\"http://msdn.microsoft.com/en-us/library/office/bb687899.aspx\" rel=\"nofollow\">This link</a> says that COM UDFs are not thread safe. Could this be a threading problem. Excel is processing step #2 while allowing user to fiddle with the UI.</p>\n"},{"tags":["c++","c","multithreading","pthreads","shared-memory"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":95,"score":0,"question_id":12772656,"title":"Memory model spec in pthreads","body":"<p>Are there any guarantees on when a memory write in one thread becomes visible in other threads using <code>pthread</code>s? </p>\n\n<p>Comparing to Java, the Java language spec has a <a href=\"http://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4\" rel=\"nofollow\">section that specifies the interaction of locks and memory</a> that makes it possible to write portable multi-threaded Java code. </p>\n\n<p>Is there a corresponding pthreads spec? </p>\n\n<p>Sure, you can always go and make shared data volatile, but that is not what I'm after. </p>\n\n<p>If this is platform dependent, is there a de facto standard? Or should another threading library be used?</p>\n"},{"tags":["java","multithreading","multicore"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":98,"score":3,"question_id":12776497,"title":"what does jvm do to use multicore cpu resource?","body":"<p>Usually a java program is running with a single process called \"javaw\".And when I run a single process I can only get max resource of one core(of multicores).\nBut when I run a multithread program in jvm, the number of cores it used is according to the number of threads which is beyond one process can do. So can anyone give me some information about how jvm deal with multithread program in multicore cpu machine ?</p>\n\n<pre><code>/**\n* I run this program in my machine which has 8 core cpu\n* and the jre is 1.6.0_24\n* How does jvm use one process to use all the cpu resources?        \n*/\n\npublic class MultiCoreUseTest implements Runnable{\n@Override\npublic void run() {\n\n    int i;\n    while(true)\n         i =1;\n}\n\npublic static void main(String[] args) {\n\n    //create 8 threads\n            //8 threads the usage of cpu is 100%\n            // if 4 threads the usage of cpu is 50%\n    for(int i = 0; i&lt;8; i++){\n        new Thread(new MultiCoreUseTest()).start();     \n    }\n}\n\n}\n</code></pre>\n"},{"tags":["c++","linux","multithreading","terminal"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12743988,"title":"Attach a terminal to created thread, in C++ on Linux","body":"<p>I'm developing a chat server in C++. The programme is built and run from a terminal. As running in the terminal, I can write to this terminal normally using '<code>printf</code>'. Some of the information written to this terminal are the alerts of new incoming connections, outgoing connections, etc.</p>\n\n<p>Now I need to get the keyboard input so that admin can type commands to see the values of variables in the chat server. I intend to create a new thread and attach a new terminal to it. A suggestion is to call system(\"gnome-terminal\"), but it requires a little delay with <code>sleep()</code>, doesn't seem to be a good choice because all the contents redirected to this gnome-terminal will be considered as bash commands. And I don't know how to attach the terminal opened by '<code>system</code>'` command to the thread.</p>\n\n<p>Any simple way to attach a terminal to created thread?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":9,"favorite_count":4,"up_vote_count":48,"down_vote_count":0,"view_count":44333,"score":48,"question_id":1679243,"title":"Getting the thread ID from a thread","body":"<p>In C# when debugging threads for example, you can see each thread's ID.</p>\n\n<p>I couldn't find a way to get that same thread, programmatically. I could not even get the ID of the current thread (in the properties of the <code>Thread.currentThread</code>).</p>\n\n<p>So, I wonder how does Visual Studio get the IDs of the threads, and is there a way to get the handle of the thread with id <code>2345</code>, for example?</p>\n"},{"tags":["c#","multithreading","constructor"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":12772269,"title":"how to use Multithreading in C# for constructors","body":"<p>I've an application which basically does 2 jobs: </p>\n\n<blockquote>\n  <p>a) parses an XML (large number of contents) and serialize/de-serialize to\n  a class object and it does some mathematical operations over the data\n  obtained</p>\n  \n  <p>b) populates the UI by parsing a number of files/directories.</p>\n</blockquote>\n\n<p>Both are independent tasks.\nAs execution time is long here, I want to use multithreading here in my form where I call a contructor of another class (that does XML parsing and operations). \nCan you please guide how to do that?</p>\n\n<pre><code>public partial class Form1: Form\n{\npublic Binarylist bList = new Binarylist(); //parses the XML and does multiple operations\n........\n.......\nprivate Form1_Load(object sender, EventArgs e)\n{\n........ //populates UI by parsing files &amp; directories\n}\n</code></pre>\n\n<p>My question here - how do i multithread Binarylist contructor so that I also execute form1_load in parallel on the main thread?</p>\n"},{"tags":["c#","multithreading","locking","using"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12776028,"title":"Is this a good way to code a struct for logged locks via the 'using' construct?","body":"<p>For non-high-performance locking... just robust thread-safe code... I want the simplicity of the <code>lock (obj) { code; }</code> construct, but I want to log before and after it (so that I can easily see deadlocks in the field by getting the log from the user) and I want to support ReaderWriterLocks.  (Yes, I realize that Monitor and SpinLock and such are faster... but this is not high-performance high-number-of-threads... the speed is not an issue here.)</p>\n\n<p>I have seen suggestions of doing this via <code>using (new ReadLock(myLock)) { code; }</code>, but the coding of the class being new'd there was often suspect.</p>\n\n<p>Sooo, here's what I came up with.  My questions for you all:\n(1) Any issues with the following code, when used as I indicate in the comments?\n(2) Any suggestions on how to improve this code to make it more reliable, simpler, or more efficient?</p>\n\n<p>Note that the TccLog is just our own wrapper around log4net... but it could be whatever your chosen log library is.</p>\n\n<pre><code>// Locks.cs == structs intended to be used with using statements for reliable, easy-to-code, logged locks\nusing System;\nusing System.Threading;\nnamespace Tcc.Common\n{\n/// &lt;summary&gt;\n/// A ReadLock allows any number of readers but prevents any writers until the ReadLock is disposed.\n/// ReadLocks do NOT log as they can't cause deadlocks without some other thread having a WriteLock.\n/// Use a ReadLock with the following syntax:\n/// \n/// using (new ReadLock(someReaderWriterLock, timeoutInMS))\n/// { code; }\n/// \n/// which is equivalent to:\n/// \n/// someReaderWriterLock.AcquireReaderLock(timeoutInMS);\n/// try\n/// { code; }\n/// finally\n/// { someReaderWriterLock.ReleaseReaderLock(); }\n/// &lt;/summary&gt;\npublic struct ReadLock : IDisposable\n{\n    ReaderWriterLock TheLock;\n\n    public ReadLock(ReaderWriterLock theLock)\n    {\n        TheLock = theLock;\n        TheLock.AcquireReaderLock(100000);\n    }\n\n    public ReadLock(ReaderWriterLock theLock, int timeoutMS)\n    {\n        TheLock = theLock;\n        TheLock.AcquireReaderLock(timeoutMS);\n    }\n\n    public void Dispose()\n    {\n        TheLock.ReleaseReaderLock();\n    }\n}\n\n\n/// &lt;summary&gt;\n/// A WriteLock allows only that one writer and no readers.\n/// WriteLocks will log when they start waiting for the lock and again when they release the lock.\n/// You may want to log.TraceLock(\"LOCKED\") in the first line of your code that you have acquired the lock.\n/// Use a WriteLock with the following syntax:\n/// \n/// using (new WriteLock(someReaderWriterLock, timeoutInMS))\n/// { code; }\n/// \n/// which is equivalent to:\n/// \n/// LOG.TraceLock(\"LOCKING\");\n/// someReaderWriterLock.AcquireWriterLock(timeoutInMS);\n/// try\n/// { code; }\n/// finally\n/// { someReaderWriterLock.ReleaseWriterLock(); LOG.TraceLock(\"UNLOCKED\"); }\n/// &lt;/summary&gt;\npublic struct WriteLock : IDisposable\n{\n    private static TccLog LOG = new TccLog(2);\n\n    ReaderWriterLock TheLock;\n\n    public WriteLock(ReaderWriterLock theLock)\n    {\n        TheLock = theLock;\n        LOG.TraceLock(\"LOCKING\");\n        TheLock.AcquireWriterLock(100000);\n    }\n\n    public WriteLock(ReaderWriterLock theLock, int timeoutMS)\n    {\n        TheLock = theLock;\n        LOG.TraceLock(\"LOCKING\");\n        TheLock.AcquireWriterLock(timeoutMS);\n    }\n\n    public void Dispose()\n    {\n        TheLock.ReleaseWriterLock();\n        LOG.TraceLock(\"UNLOCKED\");\n    }\n}\n\n\n/// &lt;summary&gt;\n/// A FullLock is like the built-in 'lock' (Monitor on any heap object), except it implements logging.\n/// FullLocks will log when they start waiting for the lock and again when they release the lock.\n/// You may want to log.TraceLock(\"LOCKED\") in the first line of your code that you have acquired the lock.\n/// Use a FullLock with the following syntax:\n/// \n/// using (new FullLock(someHeapObject))\n/// { code; }\n/// \n/// which is equivalent to:\n/// \n/// LOG.TraceLock(\"LOCKING\");\n/// lock (someHeapObject)\n/// { code; }\n/// LOG.TraceLock(\"UNLOCKED\");\n/// &lt;/summary&gt;\npublic struct FullLock : IDisposable\n{\n    private static TccLog LOG = new TccLog(2);\n\n    object TheLock;\n\n    public FullLock(object theLock)\n    {\n        TheLock = theLock;\n        LOG.TraceLock(\"LOCKING\");\n        Monitor.Enter(TheLock);\n    }\n\n    public void Dispose()\n    {\n        Monitor.Exit(TheLock);\n        LOG.TraceLock(\"UNLOCKED\");\n    }\n}\n\n\n/// &lt;summary&gt;\n/// A NamedLock is like the built-in 'lock' (Monitor on any heap object), except it implements logging.\n/// NamedLocks will log when they start waiting for the lock and again when they release the lock.\n/// You may want to log.TraceLock(\"LOCKED\") in the first line of your code that you have acquired the lock.\n/// Use a NamedLock with the following syntax:\n/// \n/// using (new NamedLock(someHeapObject, \"name\"))\n/// { code; }\n/// \n/// which is equivalent to:\n/// \n/// LOG.TraceLock(\"LOCKING name\");\n/// lock (someHeapObject)\n/// { code; }\n/// LOG.TraceLock(\"UNLOCKED name\");\n/// &lt;/summary&gt;\npublic struct NamedLock : IDisposable\n{\n    private static TccLog LOG = new TccLog(2);\n\n    object TheLock;\n    string Name;\n\n    public NamedLock(object theLock, string name)\n    {\n        Name = name;\n        TheLock = theLock;\n        LOG.TraceLock(\"LOCKING \" + name);\n        Monitor.Enter(TheLock);\n    }\n\n    public void Dispose()\n    {\n        Monitor.Exit(TheLock);\n        LOG.TraceLock(\"UNLOCKED \" + Name);\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","windows-8","async-await"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12774925,"title":"SynchronizationLockException after await","body":"<p>I have a method called <code>HandleMessage</code>, a new thread is started to handle the message. If the lock object is fetched successfully, then handle it. Otherwise put the message in the queue. A <code>SynchronizationLockException</code> is always thrown at <code>Monitor.Exit(o)</code> since after <code>await</code> the context isn't in the original thread any more. What's the correct way to implement?</p>\n\n<pre><code>    public void HandleMessage(string message)\n    {\n        Task.Factory.StartNew(async delegate\n        {\n            if (Monitor.TryEnter(o))\n            {\n                try\n                {\n                    do\n                    {\n                        await HandleMessageAsync(message);\n                    }\n                    while (queue.TryDequeue(out message));\n                }\n                finally\n                {\n                    Monitor.Exit(o);\n                }\n            }\n            else\n            {\n                queue.Enqueue(message);\n            }\n        });\n    }\n</code></pre>\n"},{"tags":["multithreading","winapi","deadlock","critical-section"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12774425,"title":"What happen if 2 threads do EnterCriticalSection and thread 1 do DeleteCriticalSection","body":"<p>I am hunting a possible deadlock in my program and im suspecting the following.\nWhat happen if 2 threads at the same time calls EnterCriticalSection and thread #1 calls DeleteCriticalSection right after entering, what happen to thread #2 which is still in EnterCriticalSection call?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c++","c","multithreading","pthreads"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":479,"score":-1,"question_id":1864824,"title":"Pthreads problem and a few questions","body":"<pre><code>#include&lt;pthread.h&gt;\n#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;time.h&gt;\n#define NUM_THREADS 8\n\nchar *messages[NUM_THREADS];\n\nstruct thread_data\n{\n   int thread_id;\n   int  sum;\n   char *message;\n};\n\nstruct thread_data thread_data_array[NUM_THREADS];\n\nvoid *PrintHello(void *threadarg)\n{\n   int taskid, sum;\n   char *hello_msg;\n   struct thread_data *my_data;\n\n   sleep(1);\n   my_data = (struct thread_data *) threadarg;\n   taskid = my_data-&gt;thread_id;\n   sum = my_data-&gt;sum;\n   hello_msg = my_data-&gt;message;\n   printf(\"Thread %d: %s  Sum=%d\\n\", taskid, hello_msg, sum);\n   pthread_exit(NULL);\n}\n\nint main(int argc, char *argv[])\n{\npthread_t threads[NUM_THREADS];\n//int *taskids[NUM_THREADS];\nint rc, t, sum;\n\nsum=0;\nmessages[0] = \"English: Hello World!\";\nmessages[1] = \"French: Bonjour, le monde!\";\nmessages[2] = \"Spanish: Hola al mundo\";\nmessages[3] = \"Klingon: Nuq neH!\";\nmessages[4] = \"German: Guten Tag, Welt!\"; \nmessages[5] = \"Russian: Zdravstvytye, mir!\";\nmessages[6] = \"Japan: Sekai e konnichiwa!\";\nmessages[7] = \"Latin: Orbis, te saluto!\";\n\nfor(t=0;t&lt;NUM_THREADS;t++) {\n  sum = sum + t;\n  thread_data_array[t].thread_id = t;\n  thread_data_array[t].sum = sum;\n  thread_data_array[t].message = messages[t];\n  printf(\"Creating thread %d\\n\", t);\n  rc = pthread_create(&amp;threads[t], NULL, PrintHello, (void *)&amp;thread_data_array[t]);\n  if (rc) {\n    printf(\"ERROR; return code from pthread_create() is %d\\n\", rc);\n    exit(-1);\n    }\n  }\npthread_exit(NULL);\n}\n</code></pre>\n\n<p>The above piece of code gives me a segmentation fault in linux using gcc</p>\n\n<p>As a beginner I have a few questions in mind regarding threads</p>\n\n<ol>\n<li>If 3 threads are created simultaneously and if they have to exit then the thread that is created first is exitted at the end?</li>\n<li>Can the o/p differ every time of a thread creation and termination program and if so why??(I have noticed they do so\");</li>\n</ol>\n"},{"tags":["java","android","multithreading","download","wait"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":146,"score":1,"question_id":11374989,"title":"Android: Waiting for the threads to finish executing the method","body":"<pre><code>ExecutorService exec = Executors.newFixedThreadPool(8);\nList&lt;Future&lt;Object&gt;&gt; results = new ArrayList&lt;Future&lt;Object&gt;&gt;();\n\n// submit tasks\nfor(int i = 0; i &lt; 8; i++) {\n    results.add(exec.submit(new ThreadTask()));\n}\n\n...\n\n// stop the pool from accepting new tasks\nexec.shutdown();\n\n// wait for results\nfor(Future&lt;Object&gt; result: results) {\n    Object obj = result.get();\n}\n\n\nclass ThreadTask implements Callable&lt;Object&gt; {\n\n    public Object call() {\n        // execute download\n        ...\n        return result;\n    }\n}\n</code></pre>\n\n<p>The above code doesn't show me the results I expected. In more detail, I'm doing a download manager for android. These threads are for downloading the file in segments. Since, each segment may take different time duration to download, I think that's where the problem lies.</p>\n\n<p>Then I tried using just a simple number return inside the method. Then the threads started to give the expected results.</p>\n\n<p>So as a solution I thought of implementing a method to wait for all the threads to finish executing. In the above code, How do I wait for all the threads to finish their work?. I think I have to use the <code>wait()</code> method but I have no idea how to do it.Hope you can help to figure out this.</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["java","android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12773790,"title":"How to Correctly Update Android UI from SurfaceView","body":"<p>So I have an activity with a TextView to hold the score like so:</p>\n\n<pre><code>public class PlayGameActivity extends Activity {\n    private GameThread mGameThread;\n    private GameView mGameView;\n\n    private Handler mHandler = new Handler();\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_play_game);\n\n        final TextView scoreView = (TextView) findViewById(R.id.textView2);\n\n        mGameView = (GameView) findViewById(R.id.gameView1);\n        mGameThread = mGameView.getThread();\n\n        mHandler.post(new Runnable() {\n            @Override\n            public void run() {\n                if (mGameView != null) {\n                    scoreView.setText(mGameThread.getScore());\n                }\n            }\n        });\n    }\n}\n</code></pre>\n\n<p>Then in my GameView I have the function declared like so:</p>\n\n<pre><code>class GameView extends SurfaceView implements SurfaceHolder.Callback {\n    class GameThread extends Thread {\n        int score = 0;\n\n        public String getScore(){\n            return Integer.toString(score);\n        }\n\n        @Override\n        public void run() {\n            synchronized (mSurfaceHolder) {\n                if (something){\n                    score++\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The problem is that mGameThread.getScore() always returns 0 as if score is not updated when it certainly is. </p>\n\n<p>If anyone has any incite it is greatly appreciated. Also I have striped lots of unnecessary code out of the snippets above. If you want to see the full text you may do so here:</p>\n\n<ul>\n<li><a href=\"http://snipt.org/vXfg2\" rel=\"nofollow\">PlayGameActivity.java</a></li>\n<li><a href=\"http://snipt.org/vXfh3\" rel=\"nofollow\">GameView.java</a></li>\n</ul>\n"},{"tags":["android","multithreading","android-listview","android-asynctask","android-view"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12761200,"title":"wiring up expandablelistview cascading checkboxes","body":"<p>It's been a great learning experience but i'm finally almost done with my expandablelistview adapter. It has checkboxes on the groups and childviews so, intuitively, you can disable/enable all the checks on the childviews by action of the group view checkbox. all that's left now is to make group view checkbox correspond to the children views. when i try to it crashes.</p>\n\n<pre><code>    for(int i = 0; i &lt; check_states.get(groupPosition).size(); i++) {\n        if (check_states.get(groupPosition).get(i) == false) {\n            Log.d (\"Meat\", \"Child checkboxes are not all checked!!!\");\n        }\n    }\n</code></pre>\n\n<p>I'm very sure now that it is because I call those commands before the arraylist is finished populating --> \"check_states\" is an arraylist of arraylists that i use to keep the checkstates of the checkboxes. </p>\n\n<p>So my question is very simply how to wait for the arraylist to finish populating before I call my commands. I've looked into what i can, but they seem a bit more involved than what this is worth. I'd rather set up a long-click menu than set up a seperate thread or spare 10 lines of code for something so meager as this.   </p>\n\n<p>EDIT: updated with logcat</p>\n\n<pre><code>10-06 19:18:08.204: W/dalvikvm(540): threadid=1: thread exiting with uncaught exception (group=0x40015560)\n10-06 19:18:08.224: E/AndroidRuntime(540): FATAL EXCEPTION: main\n10-06 19:18:08.224: E/AndroidRuntime(540): java.lang.IndexOutOfBoundsException: Invalid index 0, size is 0\n10-06 19:18:08.224: E/AndroidRuntime(540):  at java.util.ArrayList.throwIndexOutOfBoundsException(ArrayList.java:257)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at java.util.ArrayList.get(ArrayList.java:311)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at com.mangodeveloper.mcathomie.McatTopicsExpandableListAdapter.getGroupView(McatTopicsExpandableListAdapter.java:166)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.ExpandableListConnector.getView(ExpandableListConnector.java:445)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.AbsListView.obtainView(AbsListView.java:1430)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.ListView.makeAndAddView(ListView.java:1745)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.ListView.fillDown(ListView.java:670)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.ListView.fillFromTop(ListView.java:727)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.ListView.layoutChildren(ListView.java:1598)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.AbsListView.onLayout(AbsListView.java:1260)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.RelativeLayout.onLayout(RelativeLayout.java:912)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.FrameLayout.onLayout(FrameLayout.java:338)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.RelativeLayout.onLayout(RelativeLayout.java:912)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.FrameLayout.onLayout(FrameLayout.java:338)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.widget.FrameLayout.onLayout(FrameLayout.java:338)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.View.layout(View.java:7175)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.ViewRoot.performTraversals(ViewRoot.java:1140)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.view.ViewRoot.handleMessage(ViewRoot.java:1859)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.os.Handler.dispatchMessage(Handler.java:99)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.os.Looper.loop(Looper.java:123)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at android.app.ActivityThread.main(ActivityThread.java:3683)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at java.lang.reflect.Method.invokeNative(Native Method)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at java.lang.reflect.Method.invoke(Method.java:507)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)\n10-06 19:18:08.224: E/AndroidRuntime(540):  at dalvik.system.NativeStart.main(Native Method)\n</code></pre>\n\n<p>Edit again: Here is just about the relevant parts of the expandable adapter</p>\n\n<pre><code>public class McatTopicsExpandableListAdapter extends BaseExpandableListAdapter {\n\n...\n\npublic View getChildView(final int groupPosition, final int childPosition, boolean isLastChild,\n            View convertView, ViewGroup parent) {\n\n        final ViewHolder holder;\n\n        if (convertView == null) {\n            LayoutInflater viewInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n            convertView = viewInflater.inflate(R.layout.mtopics_childview, parent, false);  \n            holder = new ViewHolder();\n            holder.text = (TextView)convertView.findViewById(R.id.mtopicschildtv);\n            holder.checkbox = (CheckBox)convertView.findViewById(R.id.mtopicchildchkbox);\n\n            convertView.setTag(holder);\n        } else {\n            holder = (ViewHolder) convertView.getTag();\n        }\n\n        holder.text.setText(getChild(groupPosition, childPosition).toString());\n\n        for(int i = 0; i &lt; children.length; i++) {\n            ArrayList&lt;Boolean&gt; tmp = new ArrayList&lt;Boolean&gt;(children[i].length);\n            for(int j = 0; j &lt; children[i].length; j++) {\n                tmp.add(true);\n            }\n            check_states.add(tmp);\n        }\n\n        if (check_states.get(groupPosition).get(childPosition) == true) {\n            holder.checkbox.setChecked(true);\n        }else{ holder.checkbox.setChecked(false);\n        }\n\n        holder.checkbox.setOnClickListener(new OnClickListener() {  \n            public void onClick(View v) {\n                if (holder.checkbox.isChecked()) {\n                    check_states.get(groupPosition).set(childPosition, true);\n                }else{ check_states.get(groupPosition).set(childPosition, false);\n                }\n            }   \n        });\n\n        return convertView;\n    }\n\n    public View getGroupView(final int groupPosition, boolean isExpanded, View convertView,\n            ViewGroup parent) {\n\n        ViewHolder holder;\n\n        if (convertView == null) {\n            LayoutInflater viewInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);\n            convertView = viewInflater.inflate(R.layout.mtopics_groupview, parent, false);\n            holder = new ViewHolder();\n            holder.text = (TextView)convertView.findViewById(R.id.mtopicsgrouptv);\n            holder.checkbox = (CheckBox)convertView.findViewById(R.id.cb_group);\n\n            convertView.setTag(holder);\n        } else {\n            holder = (ViewHolder) convertView.getTag();\n        }\n\n        holder.text.setText(getGroup(groupPosition).toString());\n\n        for(int i = 0; i &lt; check_states.get(groupPosition).size(); i++) {\n            if (check_states.get(groupPosition).get(i) == false) {\n                Log.d (\"Meat\", \"Child checkboxes are not all checked!!!\");\n            }\n        }\n\n        holder.checkbox.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\n\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\n                if (isChecked) {\n                    for(int i = 0; i &lt; check_states.get(groupPosition).size(); i++) {\n                        check_states.get(groupPosition).set(i, true);   \n                    }       \n                } else if (!isChecked)\n                    for(int i = 0; i &lt; check_states.get(groupPosition).size(); i++) {\n                        check_states.get(groupPosition).set(i, false);          \n                    }\n\n                notifyDataSetChanged();\n            }\n        }); \n\n        return convertView;\n    }\n\n    //  additional components\n    ArrayList&lt;ArrayList&lt;Boolean&gt;&gt; check_states = new ArrayList&lt;ArrayList&lt;Boolean&gt;&gt;(children.length);\n\n    static class ViewHolder {\n        TextView text;\n        CheckBox checkbox;\n    }\n\n}\n</code></pre>\n"},{"tags":["android","multithreading","surfaceview","graphic","game"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":12773001,"title":"Create a short Preview before Main Game Started in Surfaceview","body":"<p>I've Trying Develop a simple game.I need show a Preview of a shape on specific places that stored in a ArrayList.after that clear the shapes and let player to redraw thats.\nI'm Using SurfaceView and a separate class that extends thread and have Run function.\nin Run I called onDraw function for drawing graphics.in a deterrent function I set the random shapes on my places and in other function I reset the shape to default\nI thinking about thats so hard but can't find good answer\nPlz if you have a good Answer share to me!</p>\n"},{"tags":["java","multithreading","graph","concurrency","neo4j"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":108,"score":2,"question_id":12701185,"title":"Neo4j graph operations in a multithreaded environment","body":"<p>I'm using Neo4j in a concurrent environment and I have graph that looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/aeeiq.png\" alt=\"Graph\"></p>\n\n<p>Each item can be in none or at most one of 3 states (<code>S1</code>, <code>S2</code> and <code>S3</code>). An item can change its state and the flow goes this way: item is not present in any state, then <code>S1</code>, <code>S2</code> and finally <code>S3</code>.</p>\n\n<p>This means that when adding an item I will have to check whether it's already present in <code>S1</code>, <code>S2</code> or <code>S3</code>. If it is, then I shouldn't add it again. Additionally, if the item is in <code>S1</code> and is requested to go to the next state in the flow then the item must be first removed from <code>S1</code> and then added to <code>S2</code>.</p>\n\n<p>Having an index on each of the states wouldn't solve this issue because all of these operations must happen atomically as it is a concurrent environment. I've checked <a href=\"http://docs.neo4j.org/chunked/stable/transactions-unique-nodes.html\" rel=\"nofollow\">this link</a> and I could only think about going for the <em>Pessimistic locking</em> approach. The pseudocode to add a new item, based on the example, should be something like:</p>\n\n<pre><code>search for node in all states\nif node is present in any state\n    return node\nelse\n    begin transaction\n        get a write lock on #lockNode#\n        create node\n        add node to initial state\n    commit\n    return node\nend\n</code></pre>\n\n<p>The pseudocode to change from a state to another state should be very similar to the previous one.</p>\n\n<p>So the questions are:</p>\n\n<ol>\n<li>What is #lockNode# in my pseudocode? I can't figure it out from the example. Sounds like it similar to a <code>synchronized (lockNode) {}</code> but I need a little exaplanation to go on with this solution</li>\n<li>What would be the impact of using the reference node as #lockNode#?</li>\n<li>Is it possible to atomically and in a sychronized way perform the searches in the three indexes and then add/move the node to a state?</li>\n</ol>\n\n<p>I could easily solve this by using Java synchronization but the documentation clearly states this should not be done. Any help for a Neo4j newbie like me would be appreciated.</p>\n"},{"tags":["c++","windows","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12772227,"title":"Multi threaded global object access","body":"<p>Ok, I've a application which has two additional threads.</p>\n\n<p>Thread one accesses object O and inserts data into a deque which is part of object O and increments a counter variable.</p>\n\n<p>Thread two accesses object O and pulls out and deletes data from the deque and decrements the counter variable.</p>\n\n<p>This turned out to give unexpected results since one thread tells me there are x elements inside of the deque and the other thread tells me there are no elements. I assume I have to use some kind of synchronization. I tried to use semaphore which I must have misunderstood since it didn't work (<a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686946%28v=vs.85%29.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/windows/desktop/ms686946(v=vs.85).aspx</a>). </p>\n\n<p>So I want to know how to access a global object from two threads. Be aware that the access to the global object O happens quite often since the access is within a while loop which results in continues insertions and polls. (Would the possible solution block the other thread from accessing the object and therefore the while loop?) </p>\n\n<p>So far I only know of semaphore and mutex but have never used any of them, please be so kind and enlighten me.</p>\n"},{"tags":["python","multithreading","performance","web","crawl"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":82,"score":-1,"question_id":12772464,"title":"Error with Threading (Python)","body":"<p>I'm getting Threading errors, obviously because I reached the threading limit. (I thought it does well untill 1000 threads). Only whenever I build some kind of xrange (for i in xrange (0, 20000, 900: thread etc..) I get these errors as well. Does anyone know how to fix this? </p>\n\n<p>I love the speed it does right now, 900 in +- 1 sec I believe, only with that xrange thing it gets a lot slower. Anyone has tips?</p>\n\n<pre><code>import urllib\nimport datetime\nimport threading\nimport urllib2\n\nprint \"[SCAN] Started: \"+str(datetime.datetime.now())\n\nvar_WebsiteList = [\"http://nl.wikipedia.org/wiki/Website\", \"http://nl.wikipedia.org/wiki/Website\", \"http://nl.wikipedia.org/wiki/Website\"]\nclass k_Threads(threading.Thread):\n    def run(self):\n        var_HTML = urllib2.urlopen(var_WebsiteList[int(self.getName().split(\"-\")[1]))\n        var_HTML.close()\n\ndef k_Start():\n    for email in var_WebsiteList:\n        k_Thread = k_Threads()\n        k_Thread.start()\nk_Start()\nprint \"[SCAN] Stopped: \"+str(datetime.datetime.now())\n</code></pre>\n\n<p>Only in this example the website list is thousend times bigger... Anyone who could help me?</p>\n\n<p>Error: <strong>error: can't start new thread</strong></p>\n\n<p><strong>Edit: Code with the xrange - catches the error, but speed has decreased a lot!</strong></p>\n\n<pre><code>import urllib\nimport datetime\nimport threading\nimport urllib2\n\nprint \"[SCAN] Started: \"+str(datetime.datetime.now())\n\nvar_WebsiteList = [\"http://nl.wikipedia.org/wiki/Website\", \"http://nl.wikipedia.org/wiki/Website\", \"http://nl.wikipedia.org/wiki/Website\"]\nclass k_Threads(threading.Thread):\n    def run(self):\n        var_HTML = urllib2.urlopen(var_WebsiteList[int(self.getName().split(\"-\")[1]))\n        var_HTML.close()\n\ndef k_Threading():\n    try:\n        k_Thread = k_Threads()\n        k_Thread.start()\n    except:\n        time.sleep(1)\n        k_Threading()\n\ndef k_Start():\n    for Range in xrange(0, len(var_WebsiteList), 500):\n        for email in var_WebsiteList[Range:Range+500]:\n            k_Threading()\nk_Start()\nprint \"[SCAN] Stopped: \"+str(datetime.datetime.now())\n</code></pre>\n"},{"tags":["multithreading","boost","assembly","g++"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":12770122,"title":"Assembly error on compiling with boost/thread","body":"<pre><code>/var/tmp//ccMMIh7R.s: Assembler messages:\n/var/tmp//ccMMIh7R.s:433: Error: suffix or operands invalid for `xadd`\n/var/tmp//ccMMIh7R.s:456: Error: no such instruction: `incl DWORD PTR [%edx]`\n</code></pre>\n\n<p>This appears when i use boost:thread</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12770756,"title":"Is there any way I can execute the immediate statement after sleep when I have interrupted the thread","body":"<p>Have a look at the following snippet with the comments :</p>\n\n<pre><code>try {\n  Thread.sleep(20000); // Foo thread sleeps for 20 seconds\n  System.out.println(\"After the sleep statement\");\n} catch(Exception exc) {\n    exc.printStackTrace();\n  }\n\n// It has been 12 seconds since the thread went to sleep and....I interrupt\n\nFoo.interrupt(); // exception gets thrown and the code in the catch block gets executed\n</code></pre>\n\n<p>Is there any way I can execute the next statement after the sleep statement ? I want to awaken the thread at some time and want it to continue it work . Is there any thought/method for this ?</p>\n"},{"tags":["objective-c","ios","multithreading","locking"],"answer_count":2,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":96,"score":8,"question_id":12765617,"title":"Re-entrant read/write locking construct?","body":"<p>I'm an experienced .NET programmer and stretching my legs with iOS.  One of my favorite multi-threading constructs in .NET is the <a href=\"http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx\">ReaderWriterLock</a>.  It allows for multiple readers or a single writer.  The one feature that I am really missing in iOS is that the locks are re-entrant.  That is, <a href=\"http://msdn.microsoft.com/en-us/library/9209893x.aspx\">reader threads can acquire the read lock multiple times</a> as long as they release it the same number of times.  Likewise, the single writer thread can acquire the lock multiple times as long as it releases the lock by an equivalent number.</p>\n\n<p>I've looked into the iOS Framework and none of the constructs appear to offer the same support including the re-entrancy.  I also looked into the pthread library.  I found rwlock, but it does not allow re-entrancy.</p>\n\n<p>Is there anything on iOS that allows for re-entrant read-write locks?</p>\n"},{"tags":["c#",".net","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":70,"score":-5,"question_id":12590845,"title":"Sending data to a server with a certain number of threads","body":"<p>Let's say I have a 15 <code>Threads</code></p>\n\n<pre><code>Thread[] thread = new Thread[15];\n</code></pre>\n\n<p>and 73 <code>ItemInfo</code></p>\n\n<pre><code>ItemInfo[] itemInfoList = new ItemInfo[73];\n</code></pre>\n\n<p>and there is a method for sending data to a server</p>\n\n<pre><code>public void SendToServer(ItemInfo itemInfo){ ... }\n</code></pre>\n\n<p>How can I send  <strong>all</strong> <code>itemInfoList</code> to a server using <strong>15</strong> <code>threads</code>?</p>\n\n<p>P.S. I need to do it using exactly class <code>Thread</code> and not <code>ThreadPool</code>.</p>\n"},{"tags":["java","multithreading","runnable"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12771500,"title":"Best way of creating and using an anonymous Runnable class","body":"<p>I want to use anonymous class for runnable. There are two way, but I don't know does it same or not :</p>\n\n<p>Method one : using directly Runnable and call run</p>\n\n<pre><code>new Runnable() {\n    @Override\n    public void run() {\n    }\n}.run();\n</code></pre>\n\n<p>Method two : create anonymous runnable, and paste to Thread, using start method instead of run :</p>\n\n<pre><code>new Thread( new Runnable() {\n    @Override\n    public void run() {\n    }\n}).start();\n</code></pre>\n\n<p>I think method two is obvious true. But, I don't know does it same with method one ? Does we can call <code>run</code> method on Runnable directly ?</p>\n\n<p>Thanks :)</p>\n"},{"tags":["java","multithreading","sockets","io","socketchannel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":11890124,"title":"Java nio server client asynchonous","body":"<p>I made a server myself using java nio and a selector. I can receive the data and answer directly from the client if needed.</p>\n\n<p>But now I want a thread that will process data, and anytime it will send data to each client.</p>\n\n<p>So how can I do that? Also how to keep in memory all channels to write the data to each client ?</p>\n\n<p>If you need I can post the part of my code with java nio.</p>\n"},{"tags":["c++","multithreading","openmp","contention"],"answer_count":4,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":387,"score":5,"question_id":8980056,"title":"Splitting up a program into 4 threads is slower than a single thread","body":"<p>I've been writing a raytracer the past week, and have come to a point where it's doing enough that multi-threading would make sense. I have tried using OpenMP to parallelize it, but running it with more threads is actually slower than running it with one.</p>\n\n<p>Reading over other similar questions, especially about OpenMP, one suggestion was that gcc optimizes serial code better. However running the compiled code below with <code>export OMP_NUM_THREADS=1</code> is twice as fast as with <code>export OMP_NUM_THREADS=4</code>. I.e. It's the same compiled code on both runs.</p>\n\n<p>Running the program with <code>time</code>:</p>\n\n<pre><code>&gt; export OMP_NUM_THREADS=1; time ./raytracer\nreal    0m34.344s\nuser    0m34.310s\nsys     0m0.008s\n\n\n&gt; export OMP_NUM_THREADS=4; time ./raytracer\nreal    0m53.189s\nuser    0m20.677s\nsys     0m0.096s\n</code></pre>\n\n<p><strong>User time is a lot smaller than real</strong>, which is unusual when using multiple cores- <em>user</em> should be larger than <em>real</em> as several cores are running at the same time.</p>\n\n<p>Code that I have parallelized using OpenMP</p>\n\n<pre><code>void Raytracer::render( Camera&amp; cam ) {\n\n    // let the camera know to use this raytracer for probing the scene\n    cam.setSamplingFunc(getSamplingFunction());\n\n    int i, j;\n\n    #pragma omp parallel private(i, j)\n    {\n\n        // Construct a ray for each pixel.\n        #pragma omp for schedule(dynamic, 4)\n        for (i = 0; i &lt; cam.height(); ++i) {\n            for (j = 0; j &lt; cam.width(); ++j) {\n                cam.computePixel(i, j);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>When reading <a href=\"http://stackoverflow.com/questions/612860/what-can-make-a-program-run-slower-when-using-more-threads\">this question</a> I thought I had found my answer. It talks about the implementation of gclib rand() synchronizing calls to itself to preserve state for random number generation between threads. I am using rand() quite a lot for monte carlo sampling, so i thought that was the problem. I got rid of calls to rand, replacing them with a single value, but using multiple threads is still slower. <strong>EDIT: oops</strong> turns out I didn't test this correctly, it was the random values!</p>\n\n<p>Now that those are out of the way, I will discuss an overview of what's being done on each call to <code>computePixel</code>, so hopefully a solution can be found.</p>\n\n<p>In my raytracer I essentially have a scene tree, with all objects in it. This tree is traversed a lot during <code>computePixel</code> when objects are tested for intersection, however, no writes are done to this tree or any objects. <code>computePixel</code> essentially reads the scene a bunch of times, calling methods on the objects (all of which are const methods), and at the very end writes a single value to its own pixel array. This is the only part that I am aware of where more than one thread will try to write to to the same member variable. There is no synchronization anywhere since no two threads can write to the same cell in the pixel array.</p>\n\n<p>Can anyone suggest places where there could be some kind of contention? Things to try?</p>\n\n<p>Thank you in advance.</p>\n\n<p><strong>EDIT:</strong>\nSorry, was stupid not to provide more info on my system.</p>\n\n<ul>\n<li>Compiler gcc 4.6 (with -O2 optimization)</li>\n<li>Ubuntu Linux 11.10</li>\n<li>OpenMP 3</li>\n<li>Intel i3-2310M Quad core 2.1Ghz (on my laptop at the moment)</li>\n</ul>\n\n<p>Code for compute pixel:</p>\n\n<pre><code>class Camera {\n\n    // constructors destructors\n    private:\n        // this is the array that is being written to, but not read from.\n        Colour* _sensor; // allocated using new at construction.\n}\n\nvoid Camera::computePixel(int i, int j) const {\n\n    Colour col;\n\n    // simple code to construct appropriate ray for the pixel\n    Ray3D ray(/* params */);\n    col += _sceneSamplingFunc(ray); // calls a const method that traverses scene. \n\n    _sensor[i*_scrWidth+j] += col;\n}\n</code></pre>\n\n<p>From the suggestions, it might be the tree traversal that causes the slow-down. Some other aspects: there is quite a lot of recursion involved once the sampling function is called (recursive bouncing of rays)- could this cause these problems?</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":137,"score":2,"question_id":12770391,"title":"C# Multiple Threads for work then wait until all finished","body":"<p>I'm working on the small SSHClient. I have a list of clients that are connected to different computers. I have a script that I want to run on those computers. I want to run it parallel in different threads.\nI got inspired here:\n<a href=\"http://stackoverflow.com/questions/2528907/c-sharp-spawn-multiple-threads-for-work-then-wait-until-all-finished\">Stackoverflow - threads</a></p>\n\n<p>Here is my piece of code:</p>\n\n<pre><code> int toProcess, count = 0;\n        ManualResetEvent resetEvent = new ManualResetEvent(false);\n        toProcess = count = clients.Count;\n        for (int i = 0; i &lt; count; i++)\n        {\n                new Thread(delegate()\n                {\n                    var cmd = clients[i].RunCommand(\"./script.sh\");\n                    res += cmd.Result;\n                    if (Interlocked.Decrement(ref toProcess) == 0)\n                        resetEvent.Set();\n                }).Start();\n        }\n        resetEvent.WaitOne();\n\n        //do something\n</code></pre>\n\n<p>To me this code looks OK. But sometimes (actually it's in most cases) it happens that after the program goes correctly out of for loop, it gets correctly to the line <code>resetEvent.WaitOne();</code> but after, instead of waiting for all threads to finish and continue to proceed the rest of the code, it goes again to new Thread(delegate()... part of the code and since a variable i is already 2(in case there are two clients in the list of clients) I get an error:</p>\n\n<blockquote>\n  <p>Index was out of range. Must be non-negative and less than the size of\n  the collection.</p>\n</blockquote>\n\n<p>I wanted to ask how it is possible that it creates another thread although the for loop is finished. And how to avoid that?</p>\n\n<p>Thank you</p>\n"},{"tags":["c","multithreading","embedded"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":158,"score":6,"question_id":12738672,"title":"C 'Volatile' keyword in ISR and multithreaded program?","body":"<p>I read about usage of C <code>volatile</code> keyword in memory-mapped hardware register, ISR, and multithreaded program. </p>\n\n<p>1) register </p>\n\n<pre><code>uint8_t volatile * pReg;\nwhile (*pReg == 0) { // do sth } // pReg point to status register \n</code></pre>\n\n<p>2) ISR</p>\n\n<pre><code>int volatile flag = 0;\nint main() \n{\n    while(!flag) { // do sth }\n}\ninterrupt void rx_isr(void)\n{\n    //change flag\n}\n</code></pre>\n\n<p>3) multithread</p>\n\n<pre><code>int volatile var = 0;\nint task1()\n{\n    while (var == 0) { // do sth }\n}\nint task2()\n{\n    var++;\n}\n</code></pre>\n\n<p>I can see why compiler can mistakenly optimize the <code>while</code> in case 1) if <code>volatile</code> is not there, 'cause variable change is made from <em>hardware</em>, compiler may not see any change of the variable made from <em>code</em>.</p>\n\n<p><strong>But for case 2) and 3), why is volatile ever needed?</strong> In both cases variable is declared <em>global</em>, and compiler can see it's used in more than one place. So why would compiler optimize the <code>while</code> loop if the variable is not <code>volatile</code>? </p>\n\n<p>Is it because a compiler by-design has no idea of \"asynchronous call\" (in case of ISR), or multithreading? But this can't be, right?</p>\n\n<p>In addition, case 3) looks like a common program in multithreading without the <code>volatile</code> keyword. Let's say I add some locking to the global variable (no <code>volatile</code> keyword):</p>\n\n<pre><code>int var = 0;\nint task1()\n{\n    lock();   // some mutex\n    while (var == 0) { do sth }\n    release()\n}\nint task2()\n{\n    lock();\n    var++;\n    release();\n}\n</code></pre>\n\n<p>It looks normal enough to me. So do I really need <code>volatile</code> in multithreading? <strong>How come I've never seen <code>volatile</code> qualifier added to variable to avoid optimization in multithread program before</strong>?</p>\n"},{"tags":["java","multithreading","jsoup","runnable","callable"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":131,"score":-1,"question_id":12759676,"title":"Java jsoup using threads not working","body":"<p>I have like pages something like this:</p>\n\n<pre><code>www.foo1.bar\nwww.foo2.bar\nwww.foo3.bar\n.\n.\nwww.foo100.bar\n</code></pre>\n\n<p>I am using library jsoup and connecting to each page in the same time with Thread :</p>\n\n<pre><code>Thread matchThread = new Thread(task);\nmatchThread.start();\n</code></pre>\n\n<p>Each task, connect to page like this, and parses HTML:</p>\n\n<pre><code>Jsoup.connect(\"www.fooX.bar\").timeout(0).get();\n</code></pre>\n\n<p>Getting tons of these exceptions:</p>\n\n<pre><code>java.net.ConnectException: Connection timed out: connect\nat java.net.PlainSocketImpl.socketConnect(Native Method)\nat java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)\nat java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)\nat java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)\nat java.net.Socket.connect(Socket.java:529)\nat sun.net.NetworkClient.doConnect(NetworkClient.java:158)\nat sun.net.www.http.HttpClient.openServer(HttpClient.java:388)\nat sun.net.www.http.HttpClient.openServer(HttpClient.java:523)\nat sun.net.www.http.HttpClient.&lt;init&gt;(HttpClient.java:227)\nat sun.net.www.http.HttpClient.New(HttpClient.java:300)\nat sun.net.www.http.HttpClient.New(HttpClient.java:317)\nat sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:970)\nat sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:911)\nat sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:836)\nat org.jsoup.helper.HttpConnection$Response.execute(HttpConnection.java:404)\nat org.jsoup.helper.HttpConnection$Response.execute(HttpConnection.java:391)\nat org.jsoup.helper.HttpConnection.execute(HttpConnection.java:157)\nat org.jsoup.helper.HttpConnection.get(HttpConnection.java:146)\n</code></pre>\n\n<p>Does jsoup allow only 1 thread simultaneously? Or what am I doing wrong? <strong>Any suggestions, of how to connect to my pages faster, since going one by one takes ages.</strong></p>\n\n<p>EDIT:</p>\n\n<p>All 700 threads using this method, maybe this is the problem or something. Can this method handle this amount of threads or it is singleton?</p>\n\n<pre><code>private static Document connect(String url) {\n    Document doc = null;\n    try {\n        doc = Jsoup.connect(url).timeout(0).get();\n    } catch (IOException e) {\n        System.out.println(url);\n    }\n    return doc; \n}\n</code></pre>\n\n<p>EDIT: whole thread code</p>\n\n<pre><code>public class MatchWorker implements Callable&lt;Match&gt;{\n\nprivate Element element;\n\npublic MatchWorker(Element element) {\n    this.element = element;\n}\n\n@Override\npublic Match call() throws Exception {\n    Match match = null;\n            Util.connectAndDoStuff();\n    return match;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>MY ALL 700 ELEMENTS:</p>\n\n<pre><code>    Collection&lt;Match&gt; matches = new ArrayList&lt;Match&gt;();\n    Collection&lt;Future&lt;Match&gt;&gt; results = new ArrayList&lt;Future&lt;Match&gt;&gt;();\n\n for (Element element : elements) {\n        MatchWorker matchWorker = new MatchWorker(element);\n        FutureTask&lt;Match&gt; task = new FutureTask&lt;Match&gt;(matchWorker);\n        results.add(task);\n\n        Thread matchThread = new Thread(task);\n        matchThread.start();\n    }\n    for(Future&lt;Match&gt; match : results) {\n        try {\n            matches.add(match.get());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n"}]}
{"total":30059,"page":18,"pagesize":100,"questions":[{"tags":["c++","linux","multithreading","boost-asio","boost-thread"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12768382,"title":"Linux: application responsiveness and select()","body":"<p>I have a C++ console app that uses <code>open() [O_RDWR | O_NONBLOCK]</code>, <code>write()</code>, <code>select()</code>, <code>read()</code> and <code>close()</code> to work with device file. Also <code>ioctl()</code> can be called to cancel current operation. At any given time only one user can work with device.</p>\n\n<p>I need to come up with C++ class having libsigc++ signals that get fired when data is available from device.</p>\n\n<p>The problem: when calling <code>select()</code> application becomes unresponsive as it waits for the data. How to make it responsive - by calling <code>select()</code> in worker thread? If so - how will worker thread communicate with main thread? Maybe I should look into <code>boost::asio</code>?</p>\n"},{"tags":["java","multithreading","mkdir"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12768057,"title":"Why sometimes does mkdir() not work?","body":"<p>I wrote this program to test a scenario in which <code>mkdir()</code> fail.\nWhy is it failing?  Sometimes it works fine, and sometimes I get: </p>\n\n<blockquote>\n  <p>Cannot create DIR :: myDir4<br>\n  Cannot create DIR :: myDir4</p>\n</blockquote>\n\n<p>And in the last i found every directory is created...</p>\n\n<p>on every test i delete all created directory...</p>\n\n<p>I tried this b/c in my project there are 100 of threads trying to test and create directories like this... and also failing same way...</p>\n\n<pre><code>public class DFS {\n    static long time1=System.currentTimeMillis();\n    public static void main(String a[]) {\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n        new Thread(new CreteDir()).start();\n    }\n}\n\nclass CreteDir implements Runnable {\n    public void run() {\n        //Object obj=new Object();\n        synchronized (this) {\n        if(System.currentTimeMillis()-DFS.time1&gt;10) {\n            try {\n                this.wait();\n            } catch(InterruptedException ie) {\n                ie.printStackTrace();\n            }\n        }\n        File f1=new File(\"myDir1\");\n        File f2=new File(\"myDir2\");\n        File f3=new File(\"myDir3\");\n        File f4=new File(\"myDir4\");\n        File f5=new File(\"myDir5\");\n\n        if(!f1.exists()&amp;&amp;!f1.mkdir()) {\n            System.out.println(\"Cannot create DIR :: \"+f1.getName());\n        }\n        if(!f2.exists()&amp;&amp;!f2.mkdir()) {\n            System.out.println(\"Cannot create DIR :: \"+f2.getName());\n        }\n        if(!f3.exists()&amp;&amp;!f3.mkdir()) {\n            System.out.println(\"Cannot create DIR :: \"+f3.getName());\n        }\n        if(!f4.exists()&amp;&amp;!f4.mkdir()) {\n            System.out.println(\"Cannot create DIR :: \"+f4.getName());\n        }\n        if(!f5.exists()&amp;&amp;!f5.mkdir()) {\n            System.out.println(\"Cannot create DIR :: \"+f5.getName());\n        }\n        this.notifyAll();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","android","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12765633,"title":"Getting a RuntimeException from within some sample threading code","body":"<p>I'm starting to study threads and I don't understand why the following simple code does not work.  It is throwing:</p>\n\n<pre><code>RuntimeException: can't create handler inside thread that has not called looper.prepare():\n</code></pre>\n\n<p>Here's the code</p>\n\n<pre><code>public void onClick(View v) {\n    switch (v.getId()) {\n    case R.id.id1:\n        Thread th =new Thread(new Runnable() {\n               public void run() {\n                update();\n                delObjects();\n                addObjects();\n\n               }\n              }); \n        th.start();\n        break;\n        }\n    }\n</code></pre>\n\n<p>I have read that sometimes the error occurs when you try to modify the UI, but it's not my case.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":12767298,"title":"Please explain the working of the following code","body":"<p>I have the following code but it's output is not what I expected:</p>\n\n<pre><code>public class ThreadManager {\n    public static void main(String[] args) {\n        Resource sharedResource = new Resource();\n        new Thread(new MyThread(sharedResource)).start();\n        new Thread(new MyThread(sharedResource)).start();\n    }\n}\n\nclass MyThread implements Runnable{\n    Resource rs = null;\n    public MyThread(Resource param) {\n        this.rs = param;\n    }\n    @Override\n    public void run() {\n        this.rs.add(Thread.currentThread().getName());\n        System.out.println(this.rs.str);\n    }\n}\n\nclass Resource{\n    StringBuilder str = new StringBuilder();\n    public void add(String text){\n        str.append(text);\n    }\n}\n</code></pre>\n\n<p>output is :</p>\n\n<pre><code>Thread-0Thread-1\nThread-0Thread-1\n</code></pre>\n\n<p>but how...</p>\n\n<p>here if thread 0 is executed first then output should be</p>\n\n<pre><code>Thread-0\nThread-0Thread-1\n</code></pre>\n\n<p>but here issue is the thread-1 in the first line of output.</p>\n"},{"tags":["java","multithreading","timer","timeout"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12766865,"title":"Time out by which search method returns otherwise it will throw time out message","body":"<p>I want execute a search method by java main and want to implement the \nTime out by which search method returns otherwise it will throw a time out message. \nHow can I achieve this time out functionality using thread or timer class?</p>\n"},{"tags":["c#","wpf","windows","multithreading","performance"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":803,"score":2,"question_id":6296234,"title":"Preload WPF Window (perhaps in other thread) to improve performance","body":"<p>I have a WPF Window which takes a lot of time to create and show. The user should be able to open one ore more of this windows.\nNow, I am searching a way to improve the performance. One Idea is to create two of this Windows at the startup of the Application (when It shows the splash-screen). After I have only to show and hide this windows (and change the attached viewmodel). This should not be a problem. But when the user is working with the application and he uses the two windows which are loaded at startup of the application, I should load a third instance of the window in background. Now, the application should no be blocked when It loads the third one (or the 4. oder 5. etc.). Now, I am searching a way to do this. Would it be possible to load the window in another thread and after transfer it to the main UI thread?\nOr are there other scenarios to reach the goal?</p>\n\n<p>Thanks for any help.</p>\n\n<p>Best Regards, Thomas</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":11362547,"title":"How to Add Java Multithreading","body":"<p>At work training, I'm writing a Java (in which I have 0 experience) program that should meet the following criteria:</p>\n\n<blockquote>\n  <p>Write a program that replicates distributed computing application</p>\n  \n  <p>Create central 'scheduler' object which contains a list of M random numbers</p>\n  \n  <p>Create N processor threads that retrieve a number from the scheduler then loop that many times before requesting another number</p>\n  \n  <p>If no numbers are available from the scheduler, wait to request another number.</p>\n  \n  <p>If no more numbers are left, all the threads should end.</p>\n</blockquote>\n\n<p>So far, I created an object with an array of random numbers, but I really don't know how to proceed with multithreading.  Could someone please guide me through it?  This is what I have so far, along with comments indicating pseudo code.</p>\n\n<pre><code>public class ThreadDemo extends Thread\n{\n    //create new array of arbitrary size 5\n    static int SIZE = 5;\n    static int[] myIntArray = new int[SIZE];\n\n\n    public ThreadDemo()\n    {\n        start();\n    }\n\n    class RunnableThread implements Runnable {\n\n        Thread runner;\n        public RunnableThread() {\n        }\n        public RunnableThread(String threadName) {\n            runner = new Thread(this, threadName); // (1) Create a new thread.\n            System.out.println(runner.getName());\n            runner.start(); // (2) Start the thread.\n        }\n        public void run() {\n            //Display info about this particular thread\n            System.out.println(Thread.currentThread());\n        }\n    }\n\n\n    public static void main(String[] args)\n    {\n        for(int i=0; i&lt;SIZE; i++)\n        {\n            myIntArray[i] = (int)(Math.random() * 10);\n        }\n\n        ThreadDemo scheduler = new ThreadDemo();\n\n        //create M processor threads that retrieve number from scheduler\n            //for(int i=0; i&lt;SIZE; i++)\n                //\n\n        //if no threads available\n            //make the scheduler thread wait() ??\n\n        //if empty\n            //stop() the scheduler thread ??\n\n    }\n\n    }\n</code></pre>\n\n<p>Could anyone steer me in the right direction?</p>\n\n<p>Thank you!</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12768047,"title":"Daemon thread behavior java","body":"<p>What I know about Daemon thread is, JVM will exit if there is no user thread running and all remaining thread are of type Daemon.</p>\n\n<p>When I run the program below, I always see output as \"Main Thread ending\" as 1st line and the prints \"Hello from Worker 0\" and so on until few more lines\".</p>\n\n<p>What my question is if Worker thread is set as Daemon then when the main thread ends, Worker thread should die and not go ahead but still \"Hello from Worker 0\" and son on lines are printed and after some time only JVM end, why it is behaving like this?</p>\n\n<p>I am sorry if my question is not valid but I want to know answer and have doubt in mind.</p>\n\n<pre><code>public class Test {\n\n    public static void main(String[] args) {\n        // TODO Auto-generated method stub\n        new WorkerThread().start() ;\n        System.out.println(\"Main Thread ending\") ;\n    }\n\n}\nclass WorkerThread extends Thread {\n\n    public WorkerThread() {\n        setDaemon(true) ;   \n    }\n\n    public void run() {\n        int count=0 ;\n        while (true) {\n            System.out.println(\"Hello from Worker \"+count++) ;\n            count++;\n        }\n    }\n}\n</code></pre>\n\n<h2>Output</h2>\n\n<pre><code>Main Thread ending\nHello from Worker 0\nHello from Worker 2\nHello from Worker 4\nHello from Worker 6\nHello from Worker 8\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["c++","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12768066,"title":"c++ it seems that variable dosnt \" flush \" with multi thread","body":"<p>is_master_ def:</p>\n\n<pre><code>volatile bool is_master_;\n</code></pre>\n\n<p><strong>is_master_</strong> value is set to true by another thread , but It seems that <strong>is_master_</strong> value dosnt flush (it dosnt cout the FATAL ERROR HAS OCCURRED... ). If i add cout &lt;&lt; \"foo\" &lt;\n\n<pre><code>void MasterSlaveSynchronize::validateSingleMaster(){\n    if(is_master_){\n        cout &lt;&lt; \"FATAL ERROR HAS OCCURRED BOTH MASTER\";\n        if(!is_leader_master_){\n            cout &lt;&lt; \"CHOSE AS VICTIM IN MASTER-MATSER. SET THIS HOST AS SLAVE\";\n            is_master_ = false;\n        }\n    }\n}\n</code></pre>\n\n<p>The caller code:</p>\n\n<pre><code>while(1){\n        int n = recvfrom(sockId, buf, HEARBEAT_SIZE, 0, (struct sockaddr *) &amp;from,\n                &amp;length);\n        if (n &lt; 0) {\n            REGISTER_ERROR(\"Failed to recieved hearbeat\");\n        } else {\n            gettimeofday(&amp;instance_-&gt;last_hearbeat_got_, NULL);\n            instance_-&gt;validateSingleMaster();\n        }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12767869,"title":"How do I interrupt the thread and ask it to complete its work when exit has been pressed by user?","body":"<p>The following snippet is a thread named \"Foo\" that sleeps for 1 minute and then copies the data typed in <em>1 minute</em> to a log file.</p>\n\n<pre><code>         while(isStarted) {\n           try {\n              Thread.sleep(60000); // sleep for 1 minute\n              ArrayList&lt;String&gt; keyStrokeList = nativeMethods.getKeyStrokeList();\n              int result = copy.copyToLogFile(keyStrokeList);\n              System.out.println(result);\n           } catch(Exception exc) {\n               exc.printStackTrace();\n             }\n         }\n</code></pre>\n\n<p>I will describe one situation :</p>\n\n<p><em>Foo</em> thread has  finished copying all the data typed in last one minute and it has been 30 seconds since it is asleep. This thread unaware of the situation that several keys are being tapped when it is asleep,will never be able to copy the key strokes into the log file when one presses <code>System.exit(0)</code>. </p>\n\n<p>Is there any way I can interrupt this thread <em>i.e awake it and ask it to copy the data to the log file</em>.</p>\n\n<p>Please discuss how should I approach this problem.</p>\n\n<p><strong>The situation in the question :</strong></p>\n\n<pre><code>loop started\n\nthread is sleeping and will sleep for 1 minute\n\nafter a minute,it gets the keys tapped in the last 1 minute and copies all that\nto a file\n\nThread sleeps again..and will sleep for 1 minute before it copies the keystrokes\n\nIt has been about 30 seconds and thread will sleep for 30 seconds more before it starts\ncopying the key strokes\n\nsuddenly the user presses exit button in the application\n\nThe user wants that key strokes be recorded till the second he presses exit\n\nI cannot do System.exit(0) before checking the thread is asleep or not\n\nHow do I do this. Should I awake it or make a different call to the list and get the \nkey strokes because they are being recorded ? And how shall I awake it ?\n</code></pre>\n"},{"tags":["java","multithreading","swing"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1183,"score":2,"question_id":4507572,"title":"Swing JTextArea multithreading problem - InterruptedException","body":"<p>I have a simple console application that runs calculations in several threads (10-20 of them). Now I'm trying to create a simple GUI that allows me to select the file to process and prints logs from all threads.</p>\n\n<p>So, I created a swing GUI with JTextArea for my log and a method to log information to the log:</p>\n\n<pre><code>public synchronized void log(String text) {\n    logArea.append(text);\n    logArea.append(\"\\n\");\n\n    if (logArea.getDocument().getLength() &gt; 50000) {\n        try {\n            logArea.getDocument().remove(0,5000);\n        } catch (BadLocationException e) {\n            log.error(\"Can't clean log\", e);\n        }\n    }\n\n    logArea.setCaretPosition(logArea.getDocument().getLength());\n}\n</code></pre>\n\n<p>However, the <code>setCaretPosition</code> method sometimes deadlocks on waiting some lock, and <code>append</code> sometimes throws InterruptedException.</p>\n\n<pre><code>Exception in thread \"Thread-401\" java.lang.Error: Interrupted attempt to aquire write lock\nat javax.swing.text.AbstractDocument.writeLock(AbstractDocument.java:1334)\nat javax.swing.text.AbstractDocument.insertString(AbstractDocument.java:687)\nat javax.swing.text.PlainDocument.insertString(PlainDocument.java:114)\nat javax.swing.JTextArea.append(JTextArea.java:470)\nat lt.quarko.aquila.scripts.ui.ScriptSessionFrame.log(ScriptSessionFrame.java:215)\n</code></pre>\n\n<p>I'm a total newbie in Swing, so I can not understand what am I doing wrong here? </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["java","multithreading","swing","timer","swingworker"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12767367,"title":"How could I add a simple delay in a Java Swing application?","body":"<p>I'd like to know how to add a time delay inside a Swing app in Java, I used <code>Thread.sleep(time)</code>, and also I used SwingWorker but it doesn't work. Here's part of my code:</p>\n\n<pre><code>switch (state) {\n    case 'A':\n        if (charAux == 'A') {\n            state = 'B';                    \n            //Here's where I'd like to add a time delay\n            jLabel13.setForeground(Color.red);\n            break;\n        } else {                            \n            //Here's where I'd like to add a time delay\n            jLabel12.setForeground(Color.red);\n            break;\n        }\n}\n</code></pre>\n\n<p>I hope you could help me or solve my doubts when I'm using SwingWorker.</p>\n"},{"tags":["wpf","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12760483,"title":"IComman/DelegateCommand runs on which thread","body":"<p>I am working on WPF.\nMy application uses ICommands to bind Methods to Buttons.\nI initialized these commands as follows :</p>\n\n<pre><code>AnswerCommand = new DelegateCommand(AnsCommandExecute, AnsCommandCanExecute);\n</code></pre>\n\n<p>I want to know if AnsCommandExecute() method will work on UI thread or Background thread.\nIf it works on UI thread do I have to create another thread for this execute() method as my application performs lot of processing in background.</p>\n\n<p>Also my application uses TCP to communicate with one another application. so, for better performance Do I have to use different threads for Receiving Data, Processing, and Sending Data. \nwhat will be the best Threading approach for such applications?</p>\n"},{"tags":["c#","multithreading","dictionary","parallel.foreach","concurrentdictionary"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":122,"score":3,"question_id":12766011,"title":"A Better Way To Make My Parallel.ForEach Thread Safe?","body":"<p>I would like to make the following code thread-safe. Unfortunately, I have tried locking at various levels within this code with no success. The only instance I can seem to achieve thread-safety is to place a lock around the entire loop which effectively makes the Parallel.ForEach no faster (possibly even slower) than just using foreach. The code is relatively/almost safe with no locking.  It only seems to show slight variations in the summation of the geneTokens.Value[-1] keys and gtCandidates.Value[-1] keys about once out of every 20 or so executions.  </p>\n\n<p>I realize that Dictionary is not thread-safe. However, I cannot change this particular object to a ConcurrentDictionary without taking a major performance hit downstream. I would rather run this part of the code with a regular foreach than change that particular object.  However, I am using ConcurrentDictionary to hold the individual Dictionary objects. I have also tried making this change, and it does not solve my race issue.</p>\n\n<p><strong>Here are my Class level variables:</strong>    </p>\n\n<pre><code>//Holds all tokens derived from each sequence chunk\npublic static ConcurrentBag&lt;sequenceItem&gt; tokenBag = \n  new ConcurrentBag&lt;sequenceItem&gt;();\npublic BlockingCollection&lt;sequenceItem&gt; sequenceTokens = new \n  BlockingCollection&lt;sequenceItem&gt;(tokenBag);\npublic ConcurrentDictionary&lt;string, int&gt; categories = new \n  ConcurrentDictionary&lt;string, int&gt;();\npublic ConcurrentDictionary&lt;int, Dictionary&lt;int, int&gt;&gt; gtStartingFrequencies = new \n  ConcurrentDictionary&lt;int, Dictionary&lt;int, int&gt;&gt;();\npublic ConcurrentDictionary&lt;string, Dictionary&lt;int, int&gt;&gt; gtCandidates = new \n  ConcurrentDictionary&lt;string, Dictionary&lt;int, int&gt;&gt;();\npublic ConcurrentDictionary&lt;string, Dictionary&lt;int, int&gt;&gt; geneTokens = new \n  ConcurrentDictionary&lt;string, Dictionary&lt;int, int&gt;&gt;();\n</code></pre>\n\n<p><strong>Here is the Parallel.ForEach:</strong></p>\n\n<pre><code>Parallel.ForEach(sequenceTokens.GetConsumingEnumerable(), seqToken =&gt;\n{\n  lock (locker)\n  {\n    //Check to see if the Sequence Token is a Gene Token\n    Dictionary&lt;int, int&gt; geneTokenFreqs;\n    if (geneTokens.TryGetValue(seqToken.text, out geneTokenFreqs))\n    { //The Sequence Token is a Gene Token \n\n\n      *****************Race Issue Seems To Occur Here**************************** \n      //Increment or create category frequencies for each category provided\n      int frequency;\n      foreach (int category in seqToken.categories)\n      {\n        if (geneTokenFreqs.TryGetValue(category, out frequency))\n        {   //increment the category frequency, if it already exists\n            frequency++;\n            geneTokenFreqs[category] = frequency;\n        }\n        else\n        {   //Create the category frequency, if it does not exist\n            geneTokenFreqs.Add(category, 1);\n        }\n      }\n\n      //Update the frequencies total [-1] by the total # of categories incremented.\n      geneTokenFreqs[-1] += seqToken.categories.Length;\n      ******************************************************************************\n    }\n    else\n    { //The Sequence Token is NOT yet a Gene Token\n      //Check to see if the Sequence Token is a Gene Token Candidate yet\n      Dictionary&lt;int, int&gt; candidateTokenFreqs;\n      if (gtCandidates.TryGetValue(seqToken.text, out candidateTokenFreqs))\n      {\n        *****************Race Issue Seems To Occur Here****************************\n        //Increment or create category frequencies for each category provided\n        int frequency;\n        foreach (int category in seqToken.categories)\n        {\n          if (candidateTokenFreqs.TryGetValue(category, out frequency))\n          { //increment the category frequency, if it already exists\n            frequency++;\n            candidateTokenFreqs[category] = frequency;\n          }\n          else\n          { //Create the category frequency, if it does not exist\n            candidateTokenFreqs.Add(category, 1);\n          }\n        }\n\n        //Update the frequencies total [-1] by the total # of categories incremented.\n        candidateTokenFreqs[-1] += seqToken.categories.Length;\n        *****************************************************************************\n\n        //Only update the candidate sequence count once per sequence\n        if (candidateTokenFreqs[-3] != seqToken.sequenceId)\n        {\n          candidateTokenFreqs[-3] = seqToken.sequenceId;\n          candidateTokenFreqs[-2]++;\n\n          //Promote the Token Candidate to a Gene Token, if it has been found &gt;=\n          //the user defined candidateThreshold\n          if (candidateTokenFreqs[-2] &gt;= candidateThreshold)\n          {\n            Dictionary&lt;int, int&gt; deletedCandidate;\n            gtCandidates.TryRemove(seqToken.text, out deletedCandidate);\n            geneTokens.TryAdd(seqToken.text, candidateTokenFreqs);\n          }\n        }\n      }\n      else\n      {\n        //create a new token candidate frequencies dictionary by making \n        //a copy of the default dictionary from\n        gtCandidates.TryAdd(seqToken.text, new \n          Dictionary&lt;int, int&gt;(gtStartingFrequencies[seqToken.sequenceId]));\n      }\n    }\n  }\n});\n</code></pre>\n"},{"tags":["c#","multithreading","events","event-handling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12766515,"title":"C# Threads Handling event","body":"<p>I'm trying to have the threads also handle the pricecutEvent but I cannot get the threads to subscribe to the priceCutEvent. So it is not handled by each thread. The reason I'm doing this is when a priceCutEvent occurs the threads are supposed to \"buy\" more chickens. But instead it is just handled by the regular \"chickenStore\" and not by the 5 threads. How do I make it so the threads are actually handling the event?\nI tried: </p>\n\n<pre><code>ChickenFarm.priceCut += new priceCutEvent(reatilers[i].chickenOnSale); \n</code></pre>\n\n<p>but that does not work. Removed a lot for you.</p>\n\n<pre><code>public delegate void priceCutEvent(Int32 pr); //define a delegate\npublic delegate void orderEvent();\n\npublic static void changePrice(Int32 price)\n{\n    if (price &lt; chickenPrice) //a price cut occured\n    {\n        if (priceCut != null) //there is at least one subscriber\n            priceCut(price); //emit event to subscriber\n    }\n    chickenPrice = price;\n}\npublic class myApplication\n{\n    static void Main(string[] args)\n    {\n        ChickenFarm chicken = new ChickenFarm();\n        multiCellBuffer thisBuffer = new multiCellBuffer();\n\n        /*Alternatively we could use this instead of a regular expression:\n        ThreadStart starter = delegate{chicken.farmerFunc(thisBuffer);};\n        Thread farmer = new Thread(starter);\n        farmer.start(); */\n        Thread farmer = new Thread(() =&gt; chicken.farmerFunc(thisBuffer));\n        farmer.Start();     // Start one farmer thread\n\n        Retailer chickenstore = new Retailer();\n        Retailer.orderInNeedOfProcessing += new orderEvent(chicken.processOrder);\n        Thread[] retailers = new Thread[5];\n        ChickenFarm.priceCut += new priceCutEvent(chickenstore.chickenOnSale);\n        for (int i = 0; i &lt; 5; i++) // Start N retailer threads\n        {\n            //Thread thread = new Thread(() =&gt; ReadCentralOutQueue(\"test\"));\n            retailers[i] = new Thread(() =&gt; chickenstore.retailerFunc(thisBuffer, chicken));\n            retailers[i].Name = (i + 1).ToString();         \n            retailers[i].Start();     \n        }\n    }\n}\npublic void chickenOnSale(Int32 p) // Event handler\n{\n    // order chickens from chicken farm - send order into queue\n    OrderObject myOrder = new OrderObject();\n    myOrder.setID(Thread.CurrentThread.Name);\n    Console.WriteLine(\"Order ID: {0}\", Thread.CurrentThread.Name);\n\n    Int64 myRandomCardNo = rng.Next(1000000000);\n    Int32 myRandomAmount = rng.Next(0, 100);\n    myOrder.setCardNo(myRandomCardNo);\n    myOrder.setAmount(myRandomAmount);\n\n    String myOrderString = encoder(myOrder);\n    Console.WriteLine(\"Un-Encrypted Order: {0}\", myOrder.toString()); \n    Console.WriteLine(\"Encrypted Order: {0}\", myOrderString);\n    sendOrder(myBuffer, myOrderString);\n\n    Console.WriteLine(\"Store {0} chickens are on sale: as low as ${1} each\",\n        Thread.CurrentThread.Name, p);\n}\n</code></pre>\n"},{"tags":["c#","multithreading","picturebox"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12766068,"title":"How to move PictureBox with Thread?","body":"<p>I'm learning threads in C# so my first program will be 2 images that will be moving. But the problem is that I get an error when I try to do a new point in a thread: </p>\n\n<p>Here's my code: </p>\n\n<pre><code>namespace TADP___11___EjercicioHilosDatos\n{\n    public partial class Form1 : Form\n    {\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        int x = 0;\n        int y = 0;\n\n        private void Form1_Load(object sender, EventArgs e)\n        {\n            Thread Proceso1 = new Thread(new ThreadStart(Hilo1));\n            Proceso1.Start();\n        }\n\n        public void Hilo1()\n        {   \n            while (true) \n            {\n                x = pictureBox1.Location.X - 1;\n                y = pictureBox1.Location.Y;\n                pictureBox1.Location = new Point(x, y);\n            }   \n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":12761641,"title":"Make Web Application Multitasking (MultiThreading)","body":"<p>ALL</p>\n\n<p>I'M Develop a web application ASP.NET ,C# .. But i want to make multitasking application , to do in processor multithreading , for ex. if processcor I7 Make in all core ! .. how make it to didnt concentrate in one thread ?? and make a high performance ?? </p>\n"},{"tags":["android","multithreading","android-asynctask","android-service","android-lifecycle"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12739925,"title":"Running a Service from ASyncTask or Thread?","body":"<p>I have an Android app which uses a service to continuously update a textview in the view when the app is open. It updates it using a broadcast receiver which it sends intents to. By the nature of the app, the service needs to continue to run even after the app has exited/the view is gone. Obviously it's not wise to run the service on the main thread in this case, as that will hog up too much and eventually force close and crash the app. So what is the best way to keep this service running? An ASyncTask? A separate thread? How would I go about doing this? I tried it with an ASyncTask like this:</p>\n\n<pre><code>private class MyTask extends AsyncTask {\n\n    @Override\n    protected Object doInBackground(Object... objects) {\n        return getActivity().getApplicationContext().startService(intent);\n    }\n\n    @Override\n    protected void onCancelled() {\n        getActivity().getApplicationContext().stopService(intent);\n        super.onCancelled();\n    }\n}\n</code></pre>\n\n<p>Oh yeah, I'm using getActivity().getApplicationContext() because this is inside of a fragment.</p>\n\n<p>So this works fine; I call MyTask.execute() when I want to start it and MyTask.cancel(true) when I want to stop it, but I'm pretty sure I'm not using it how it should be used. I don't even know what I'm supposed to use as the argument for the execute method (??). And it doesn't seem to be the best idea to just start a service in it and nothing else, surely that would work better using just a thread? What's the proper way to go about this, in order for it to work the way it was intended to? By the way, although this does work for much longer than running it on the main thread, it does still crash after several hours. </p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":5229,"score":1,"question_id":1850422,"title":"IllegalMonitorStateException","body":"<p>When running our program we get an exception of type java.lang.IllegalMonitorStateException.  On Java6 API website, it says there is a constructor that gives a details about the exception:  IllegalMonitorStateException(String s)</p>\n\n<p>How can we use this to get a better idea of where the bug is in our code?  Is there anything else we can do (besides lots of debugging which we're currently doing) to pinpoint the function or line that failed?</p>\n"},{"tags":["multithreading","core-data","nsmanagedobjectcontext","moc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12761031,"title":"Nested NSManagedObjectContext for core data, how to share and manage data properly?","body":"<p>This is the first post in stackoverflow for me. Because I encountered the problem that I can't solve even by looking up in google and documents.</p>\n\n<p>I get a small iOS project, which is a weather searching app. Basically it is easy to implement overall, but there are some rules I have to follow:</p>\n\n<p>One parent context on a background thread which is linked to the persistent store (on disk);\none child context on the main thread for the UI;\none child context on a background thread for talking to the web service.</p>\n\n<p>After seeing this, I found an image online:\n<img src=\"http://i.stack.imgur.com/eMVVU.png\" alt=\"enter image description here\"></p>\n\n<p>This image shows what exactly should do for this project. And I get few problems right now.</p>\n\n<ol>\n<li><p>As image shows, I use <code>[[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType]</code> to define my main UI MOC, and use NSPrivateQueueConcurrencyType to define my webMOC and diskMOC. Question is that, shall I put everything into [UIMOC performBlock: ^{......}] ?</p></li>\n<li><p>I am quite confused right now, isn't UI runs on main thread? so what is the point of NSMainQueueConcurrencyType?</p></li>\n<li><p>After reading lot of documents, I found that the way to share data between childMOC and parentMOC are either make childMOC run \"save\" function, or call merge function through notification.\n(a) for the first one, do I need to [childMOC save] then do [parentMOC save]? or after [childMOC save], parentMOC automatically get updated?\n(b) I am not sure which way is more appropriate.</p></li>\n<li><p>The image above have 3 levels MOC. If I do \"save\" function at the lowest level MOC and can highest level MOC get data shared?</p></li>\n<li><p>As what I thought about, why couln't the lowest level MOC combined with highest level MOC and to read and write? meantime, the UIMOC in the middle, do I have to put it into performBlock function of Context to run NSFetchedResultController?</p></li>\n</ol>\n"},{"tags":["c#",".net","multithreading","timer","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12764940,"title":"Any need for BackgroundWorker if using System.Threading.Timer?","body":"<p>If I need a task to run in the background once per hour, can I just use a <code>Timer</code> object which apparently will use a separate thread: <a href=\"http://msdn.microsoft.com/en-us/library/zdzx8wx8.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/zdzx8wx8.aspx</a> ?  </p>\n\n<p>It would seem from this that there is no need to use a <code>BackgroundWorker</code> for my purposes. Is this correct?</p>\n"},{"tags":[".net","multithreading","timer"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12764998,"title":"System.Threading.Timer or System.Timers.Timer?","body":"<p>If you want a task run on a separate thread at timed intervals, should a <code>System.Threading.Timer</code> or <code>System.Timers.Timer</code> be used?</p>\n\n<p>Apparently either can use a new thread for execution of the callback function: <a href=\"http://stackoverflow.com/a/1436331/327528\">http://stackoverflow.com/a/1436331/327528</a></p>\n"},{"tags":["ruby","multithreading","jruby"],"answer_count":3,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":2350,"score":5,"question_id":999482,"title":"What practical effect will different Ruby threading models (Ruby vs JRuby) have on your code as a developer?","body":"<p>I'm trying to understand the practical impact of different threading models between MRI Ruby 1.8 and JRuby.</p>\n\n<p>What does this difference mean to me as a developer?</p>\n\n<p>And also, are there any practical examples of code in MRI Ruby 1.8 that will have worse performance characteristics on JRuby due to different threading models?</p>\n"},{"tags":["android","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12764750,"title":"Is it possible to wait on the main thread for the main thread?","body":"<p>I want to use a WebView as a Javascript-Interpreter. To check if some libraries are already loaded, I wanted to use a CountDownLatch which gets counted down in the onPageFinished()-method of the WebViewClient. It looks like this:</p>\n\n<pre><code>public JsInterpreter(Context context) {\n    interpreterWebView = new WebView(context);\n    interpreterWebView.getSettings().setJavaScriptEnabled(true);\n    interpreterWebView.setWebViewClient(new WebViewReadyListener());\n\n    webViewReadyCountDownLatch = new CountDownLatch(1);\n    interpreterWebView.loadUrl(/*javascriptLibrary*/);\n}\n\npublic void javaScriptRequest(String request) {\n    webViewReadyCountDownLatch.await();\n    interpreterWebView.loadUrl( \"javascript:\" + request );\n}\n\nprivate class WebViewReadyListener extends WebViewClient {\n    @Override\n    public void onPageFinished (WebView view, String url) {\n        webViewReadyCountDownLatch.countDown();\n    }\n}\n</code></pre>\n\n<p>First I thought this would be a good idea because like this I can wait for the library to be loaded but I haven't to deal with listeners when I call my javaScriptRequest()-method. But I forgot that both, the javaScriptRequest()- and the onPageFinished()-method, run on the main thread (in my case), so when I call await() the thread stops running and onPageFinished() never gets called => deadlock.</p>\n\n<p>But is there any working approach to wait (on the main thread) for the page being loaded?</p>\n"},{"tags":["c#",".net","multithreading","locking"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":250,"score":8,"question_id":2407943,"title":"How to test if a thread is holding a lock on an object in C#?","body":"<p>Is there a way to test if the current thread is holding a monitor lock on an object? I.e. an equivalent to the Thread.holdsLock in Java.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c","multithreading","pthreads","posix"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":116,"score":1,"question_id":12762411,"title":"how to suspend a thread before another thread finishes its work","body":"<p>hi there i'm working on POSIX threads and i have a work like</p>\n\n<ul>\n<li>We have 5 threads which each of them will print 'a','b','c','d,'e' separately with using same function</li>\n<li>Threads must be created in alphabetical order.</li>\n<li>Each character must be printed 50 times on screen</li>\n<li>'a' can only printed after all 'c's are printed</li>\n<li>'b' can only printed after all 'd's are printed</li>\n<li>'c' can only printed after all 'd's are printed</li>\n</ul>\n\n<p>so before i display my code i have to explain what i have done. first of all, i have 5 global variables (which are flags and all of them set to 1 initiallly ) and i assigned them to the value which pthread_create() function returns. and then in the main function i used if() conditions before i joined threads. but i guess i'm trying the wrong way. the issue is i coundnt handle with the process \"before thread_a, thread_d must finish its work\". i will appreciate if you can help and suggest some better ideas. and here is my code,</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint counter = 0;\n\nint flag_a = 1;\nint flag_b = 1;\nint flag_c = 1;\nint flag_d = 1;\nint flag_e = 1;\n\npthread_mutex_t mymutex=PTHREAD_MUTEX_INITIALIZER;\n\nvoid* thread_function(void* str);\nvoid print_char(char* ch);\n\nint main(){\n\n    pthread_t thread_a, thread_b, thread_c, thread_d, thread_e;\n\n    char* a = \"a\";\n    char* b = \"b\";\n    char* c = \"c\";\n    char* d = \"d\";\n    char* e = \"e\";\n\n\n    flag_a = pthread_create( &amp;thread_a, NULL, thread_function, (void*) a );\n    flag_b = pthread_create( &amp;thread_b, NULL, thread_function, (void*) b );\n    flag_c = pthread_create( &amp;thread_c, NULL, thread_function, (void*) c );\n    flag_d = pthread_create( &amp;thread_d, NULL, thread_function, (void*) d );\n    flag_e = pthread_create( &amp;thread_e, NULL, thread_function, (void*) e );\n\n    if(flag_c==0)\n        pthread_join( thread_a, NULL );\n\n    pthread_join( thread_b, NULL );\n\n    if(flag_d==0)\n        pthread_join( thread_c, NULL );\n\n    if(flag_d==0)\n        pthread_join( thread_d, NULL );\n\n    pthread_join( thread_e, NULL );\n\n    printf(\"\\nCounter = %d\\n\", counter);\n\n    return 0;\n}\n\nvoid* thread_function(void* str) {\n\n    int i;\n    char* msg = (char*) str;\n\n        for(i=0; i&lt;50; i++) {\n\n            pthread_mutex_lock(&amp;mymutex);\n            counter++;  \n            print_char(msg);\n            pthread_mutex_unlock(&amp;mymutex);\n\n        }\n    }\n\nvoid print_char(char* ch){\n\n    int i;\n\n    for(i=0; i&lt;1; i++) {\n        printf(\"%s --&gt; \", ch);\n        fflush(stdout);\n        sleep(1);\n    }\n}\n</code></pre>\n\n<p>edit: i found a solution which prints the characters properly but the issue i cant print them asynchronousnly. i mean whenever i run the code it has same output like:</p>\n\n<p>e-->d-->c-->b-->a (every character printed at 50 times )</p>\n\n<p>and this the editted part of thread_function()</p>\n\n<pre><code>void* thread_function(void* str) {\n\n    int i;\n    char* msg = (char*) str;\n\n        while( (strcmp(msg,\"a\") == 0) &amp;&amp; (counter_c &lt; 5) ){\n        ;;\n    }\n\n        while( (strcmp(msg,\"c\") == 0) &amp;&amp; (counter_d &lt; 5) ){\n        ;;\n    }\n\n        while( (strcmp(msg,\"b\") == 0) &amp;&amp; (counter_d &lt; 5) ){\n        ;;\n    }\n\n        for(i=0; i&lt;5; i++) {\n\n            pthread_mutex_lock(&amp;mymutex);               \n            counter++;\n\n                if( strcmp(msg,\"d\") == 0 )\n                    counter_d++;\n\n                if( strcmp(msg,\"c\") == 0 )\n                    counter_c++;\n\n            print_char(msg);\n            pthread_mutex_unlock(&amp;mymutex);\n\n        }\n    }\n</code></pre>\n"},{"tags":["multithreading","ios5","nsurl","gcd"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12763239,"title":"How to download JSON data and process it in background thread in iOS?","body":"<p>I need to download JSON and process it all in background in iOS5,  so I don't freeze my main thread. I haven't had any success doing that.</p>\n\n<p>Here is what I am doing:</p>\n\n<pre><code>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0),^{\n\n  NSURL *url = [NSURL URLWithString:myURL];\n   myData = [NSData dataWithContentsOfURL:url];\n\n  [self performSelectorOnMainThread:@selector(ProcessTheData:) withObject:\n   myData  waitUntilDone:YES];\n  }); \n\n  -(void)processTheData:(NSData *)data\n    {\n      //Parse JSON here\n    }\n</code></pre>\n\n<p>In the above code, Once download is done, I process it on Main thrd. How can I run it on background when I know I got the data?</p>\n"},{"tags":["python","multithreading","join","exit"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12762456,"title":"python - multithreading -- join() method","body":"<pre><code>import threading, time\n\nclass test(threading.Thread):                 \n\n    def __init__(self,name,delay):\n        threading.Thread.__init__(self)\n        self.name = name\n        self.delay = delay\n\n    def run(self):\n        c = 0\n        while True:\n            time.sleep(self.delay)            \n            print 'This is thread %s on line %s' %(self.name,c)\n            c = c + 1 \n            if c == 15:\n                print 'End of thread %s' % self.name\n                break\n\none = test('one', 1).start()\ntwo = test('two', 3).start()\n\none.join()\ntwo.join()\n\nprint 'End of main'\n</code></pre>\n\n<p>Problem: cannot get join() methods to work properly, gives the following error:</p>\n\n<pre><code>Traceback (most recent call last)line 29, in &lt;module&gt; join() NameError: name 'join' is not defined\n</code></pre>\n\n<p>if i remove:</p>\n\n<pre><code>one.join\ntwo.join\n</code></pre>\n\n<p>the code works perfectly fine.</p>\n\n<p>I wanted to print the last line,</p>\n\n<pre><code>print 'End of main'\n</code></pre>\n\n<p>after the two threads have ended. I can't seem to understand why join() is not an attribute of the two instances?</p>\n"},{"tags":["python","multithreading","pthreads","gil","green-threads"],"answer_count":1,"favorite_count":6,"up_vote_count":7,"down_vote_count":0,"view_count":143,"score":7,"question_id":12758952,"title":"Green-threads and thread in python","body":"<p>As Wikipedia States:</p>\n\n<blockquote>\n  <p>Green threads emulate multithreaded environments without relying on any native OS capabilities, and they are managed in user space instead of kernel space, enabling them to work in environments that do not have native thread support.</p>\n</blockquote>\n\n<p>Python's threads are implemented as pthreads (kernel threads)\nand because of the Global Interpreter Lock (GIL), a python process only runs one thread at a time.</p>\n\n<p>But in the case of Greenthreads (or so-called greenlet or tasklets),</p>\n\n<ol>\n<li>Does the GIL affect them? Can there be more than one greenlet\nrunning at a time ?</li>\n<li>What are the pitfalls of using greenlets or tasklets ?</li>\n<li>If I use greenlets, how many of them can a process can handle? (I am wondering because in a single process you can open threads up to <em>umask</em> limit set in your *ix system.)</li>\n</ol>\n\n<p>I need a little insight, It would help if someone could share their experience, or guide me to right path.</p>\n"},{"tags":["c#","multithreading","async-await","c#-5.0"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":261,"score":3,"question_id":12714717,"title":"Rewrite multi-thread wait using async/await","body":"<p>We have a webservice function that runs a list of tasks in the background.  When all tasks are complete, it returns.  I've revisited the function for C# 5.  I've managed to get the following snippet working:</p>\n\n<pre><code>var result = new List&lt;int&gt;();\nvar tasks = new List&lt;Task&lt;int&gt;&gt;();\n\nforeach (var row in rowlist)\n    tasks.Add(Task.Factory.StartNew(() =&gt; DoWork(row)));\nforeach (var task in tasks)\n    result.Add(task.Result);\n</code></pre>\n\n<p>The <code>task.Result</code> waits for the individual task to be done.  I've tested this by adding a three second delay to the <code>DoWork</code> method and verifying that it finishes in less than 5 seconds, for a list of 10 tasks.</p>\n\n<p>Now I've tried to rewrite the function using the new <code>async / await</code> syntax.  But I can't seem to get it to work.  If it compiles, it runs synchronously, as verified by adding a wait.</p>\n\n<p>Any ideas on how you can rewrite the above snippet using <code>async / await</code> ?</p>\n"},{"tags":["c++","multithreading","pthreads","parameter-passing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12761028,"title":"Multithreading using pthread in C++ with shared variables","body":"<p>I'm new to threading (and C/C++ for that matter), and I'm attempting to use multiple threads to access shared variables.</p>\n\n<p>In the main, I've created a variable char inputarray[100];</p>\n\n<p>Thread 1: This thread will be reading data from stdin in 2 byte bursts, and appending them to the inputarray. (input by feeding a file in)</p>\n\n<p>Thread 2: This thread will be reading data 1 byte at a time, performing a calculation, and putting its data into an output array.</p>\n\n<p>Thread 3: This thread will be outputting data from the output array in 2 byte bursts. (stdout)</p>\n\n<p>I've attempted the input part and got it working by passing a struct, but would like to do it without using a struct, but it has been giving me problems.</p>\n\n<p>If I can get input down, I'm sure I'll be able to use a similar strategy to complete output. Any help would be greatly appreciated.</p>\n\n<p>Below is a rough template for the input thread.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n\nusing namespace std;\n\nvoid* input(void* arg) {\n    char reading[3];\n    fread(reading,1,2,stdin);\n\n    //append to char inputarray[]..???\n}\n\nint main() {\n    char inputarray[100];\n    pthread_t t1;\n    pthread_create(&amp;t1, NULL, &amp;input, &amp;inputarray);\n    void *result;\n    pthread_join(t1,&amp;result);\n    return 0;\n}  \n</code></pre>\n"},{"tags":["c#",".net","multithreading","task-parallel-library"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":1,"view_count":100,"score":4,"question_id":12760956,"title":"Are there any scenario where Tasks should not be used?","body":"<p>I am reading about Tasks been preferred way of doing async programming with 4.0. I am just wondering if there are any use cases where use of Tasks should not be preferred over normal c# threads?</p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12761043,"title":"Java Thread execution on same data","body":"<p>first of all here is the code, you can just copy an paste</p>\n\n<pre><code>import java.util.ArrayList;\n\npublic class RepetionCounter implements Runnable{\nprivate int x;\nprivate int y;\nprivate int[][] matrix;\nprivate int xCounter;\nprivate int yCounter;\nprivate ArrayList&lt;Thread&gt; threadArray;\nprivate int rowIndex;\nprivate boolean[] countCompleted; \n\npublic RepetionCounter(int x, int y, int [][]matrix)\n{\n    this.x = x;\n    this.y = y;\n    this.matrix = matrix;\n    this.threadArray = new ArrayList&lt;Thread&gt;(matrix.length);\n    this.rowIndex = 0;\n    for(int i = 0; i &lt; matrix.length; i++){\n        threadArray.add(new Thread(this));\n    }\n    countCompleted = new boolean[matrix.length];\n}\n\npublic void start(){\n    for (int i = 0; i &lt; threadArray.size(); i++){\n        threadArray.get(i).start();\n        this.rowIndex++;\n    }\n}\n\npublic void count(int rowIndex)\n{\n    for(int i = 0; i &lt; matrix[rowIndex].length; i++){\n        if (matrix[rowIndex][i] == x){\n            this.xCounter++;\n        } else if (matrix[rowIndex][i] == y){\n            this.yCounter++;\n        }\n    }\n}\n\n@Override\npublic void run() {\n    count(this.rowIndex);\n    countCompleted[this.rowIndex] = true;\n}\n\npublic int getxCounter() {\n    return xCounter;\n}\n\npublic void setxCounter(int xCounter) {\n    this.xCounter = xCounter;\n}\n\npublic int getyCounter() {\n    return yCounter;\n}\n\npublic void setyCounter(int yCounter) {\n    this.yCounter = yCounter;\n}\n\npublic boolean[] getCountCompleted() {\n    return countCompleted;\n}\n\npublic void setCountCompleted(boolean[] countCompleted) {\n    this.countCompleted = countCompleted;\n}\n\npublic static void main(String args[]){\n    int[][] matrix = {{0,2,1}, {2,3,4}, {3,2,0}};\n    RepetionCounter rc = new RepetionCounter(0, 2, matrix);\n    rc.start();\n    boolean ready = false;\n    while(!ready){\n        for(int i = 0; i &lt; matrix.length; i++){\n            if (rc.getCountCompleted()[i]){\n                ready = true;\n            } else {\n                ready = false;\n            }\n        }\n    }\n    if (rc.getxCounter() &gt; rc.getyCounter()){\n        System.out.println(\"Thre are more x than y\");\n    } else {System.out.println(\"There are:\"+rc.getxCounter()+\" x and:\"+rc.getyCounter()+\" y\");\n\n    }\n}\n\n}\n</code></pre>\n\n<p>What I want this code to do: I give to the object a matrix and tow numbers, and I want to know how much times these two numbers occurs in the matrix. I create as many thread as the number of rows of the matrix (that' why there is that ArrayList), so in this object I have k threads (supposing k is the number of rows), each of them count the occurrences of the two numbers.\nThe problem is: if I run it for the first time everything work, but if I try to execute it another time I get and IndexOutOfBoundException, or a bad count of the occurrences, the odd thing is that if I get the error, and modify the code, after that it will works again just for once.\nCan you explain to me why is this happening?</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":66,"score":-2,"question_id":12760267,"title":"Execute Mutiple thread side by side","body":"<p>I want to execute multiple thread side by side.<br>\nex: There will be a simple counter method, the thread will access the method and will print the counter value. One thread should not wait for another thread to stop before starting.</p>\n\n<p>A sample output [maybe]:  </p>\n\n<p>T1 1<br>\nT2 1<br>\nT1 2<br>\nT1 3<br>\nT1 4<br>\nT2 2<br>\nT1 5  </p>\n\n<p>I've no prior idea on multi-threading and just want to learn. </p>\n"},{"tags":["python","multithreading","web-crawler","gil"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":706,"score":3,"question_id":7361922,"title":"running multiple threads in python, simultaneously - is it possible?","body":"<p>I'm writing a little crawler that should fetch a URL multiple times, I want all of the threads to run at the same time (simultaneously).</p>\n\n<p>I've written a little piece of code that should do that.</p>\n\n<pre><code>import thread\nfrom urllib2 import Request, urlopen, URLError, HTTPError\n\n\ndef getPAGE(FetchAddress):\n    attempts = 0\n    while attempts &lt; 2:\n        req = Request(FetchAddress, None)\n        try:\n            response = urlopen(req, timeout = 8) #fetching the url\n            print \"fetched url %s\" % FetchAddress\n        except HTTPError, e:\n            print 'The server didn\\'t do the request.'\n            print 'Error code: ', str(e.code) + \"  address: \" + FetchAddress\n            time.sleep(4)\n            attempts += 1\n        except URLError, e:\n            print 'Failed to reach the server.'\n            print 'Reason: ', str(e.reason) + \"  address: \" + FetchAddress\n            time.sleep(4)\n            attempts += 1\n        except Exception, e:\n            print 'Something bad happened in gatPAGE.'\n            print 'Reason: ', str(e.reason) + \"  address: \" + FetchAddress\n            time.sleep(4)\n            attempts += 1\n        else:\n            try:\n                return response.read()\n            except:\n                \"there was an error with response.read()\"\n                return None\n    return None\n\nurl = (\"http://www.domain.com\",)\n\nfor i in range(1,50):\n    thread.start_new_thread(getPAGE, url)\n</code></pre>\n\n<p>from the apache logs it doesn't seems like the threads are running simultaneously, there's a little gap between requests, it's almost undetectable but I can see that the threads are not really parallel. </p>\n\n<p>I've read about GIL, is there a way to bypass it with out calling a C\\C++ code?\nI can't really understand how does threading is possible with GIL? python basically interpreters the next thread as soon as it finishes with the previous one?</p>\n\n<p>Thanks. </p>\n"},{"tags":["c","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12398408,"title":"concurrency in user-level and kernel-level threads. why are the outputs different?","body":"<p>I am getting started learning about threads, and now I get to the point when the book confuses me with user-level and kernel-level threads.</p>\n\n<p>The book puts much emphasis on the differences and presents a problem, saying the outputs for the following two similar codes are different, however, (to my knowledge), the outputs of them appear to be the same to me.</p>\n\n<p>The first one is about user-level thread:</p>\n\n<pre><code>int number = 0;\nint main() {\nfork()\nif it is child {number--, return 0}\nif it is parent {number++, wait till child return, print number}}\n</code></pre>\n\n<p>my analysis is that since number-- and number++ have to be executed only once, and the output will be printed out after these two executions, so the output must be 0. </p>\n\n<p>The second case is about kernel-level thread:</p>\n\n<pre><code>int number = 0;\nt1() {number--}\nt2() {number++}\nmain() {\n    createThread(pass t1)\n    createThread(pass t2)\n    wait till both complete\n    print number\n}\n</code></pre>\n\n<p>In this case, same thing, the kernel creates two threads, one --, another ++, so both of them have to be executed only once. and the result must be 0 again.</p>\n\n<p>However, the book says the outputs are different, or there might be different outputs because of intervening, can anyone tell me why?</p>\n"},{"tags":["java","android","multithreading","sqlite","singleton"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":174,"score":3,"question_id":12758655,"title":"SQLiteDatabase multi-thread locking pattern","body":"<p>I use this class to manage connection to underlying SQLiteDatabase</p>\n\n<pre><code>public class BasicDataSource {\n\n    protected DatabaseHandler dbHelper;\n    protected volatile SQLiteDatabase readable_database;\n    protected volatile SQLiteDatabase writable_database;\n    protected Object read_lock = new Object();\n    protected Object write_lock = new Object();\n    protected Context context;\n\n    protected BasicDataSource(Context ctx) {\n        dbHelper = DatabaseHandler.getInstance(ctx);\n        getReadableDatabase();\n        dbHelper.onCreate(getWritableDatabase());\n        this.context = ctx;\n    }\n\n    public synchronized void close() {\n        dbHelper.close();\n    }\n\n    protected void closeInsertHelpers(InsertHelper... helpers) {\n        for (InsertHelper ih : helpers) {\n            if (ih != null)\n                ih.close();\n        }\n    }\n\n    protected SQLiteDatabase getReadableDatabase() {\n        synchronized (read_lock) {\n            if (readable_database == null || !readable_database.isOpen()) {\n                readable_database = dbHelper.getReadableDatabase();\n            }\n            return readable_database;\n        }\n    }\n\n    protected SQLiteDatabase getWritableDatabase() {\n        synchronized (write_lock) {\n            if (writable_database == null || !writable_database.isOpen()) {\n                writable_database = dbHelper.getWritableDatabase();\n            }\n            return writable_database;\n        }\n    }\n\n    protected synchronized void open() throws SQLException {\n        getReadableDatabase();\n        getWritableDatabase();\n    }\n}\n</code></pre>\n\n<p>It contains two locks, one for read, second for write.\nBut I'm still occasionally getting this kind of exception:</p>\n\n<pre><code>java.lang.RuntimeException: An error occured while executing doInBackground()\n        at android.os.AsyncTask$3.done(AsyncTask.java:299)\n        at java.util.concurrent.FutureTask$Sync.innerSetException(FutureTask.java:273)\n        at java.util.concurrent.FutureTask.setException(FutureTask.java:124)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:307)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:137)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1076)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:569)\n        at java.lang.Thread.run(Thread.java:856)\nCaused by: android.database.sqlite.SQLiteDatabaseLockedException: database is locked (code 5): , while compiling: PRAGMA journal_mode\n        at android.database.sqlite.SQLiteConnection.nativePrepareStatement(Native Method)\n        at android.database.sqlite.SQLiteConnection.acquirePreparedStatement(SQLiteConnection.java:882)\n        at android.database.sqlite.SQLiteConnection.executeForString(SQLiteConnection.java:627)\n        at android.database.sqlite.SQLiteConnection.setJournalMode(SQLiteConnection.java:313)\n        at android.database.sqlite.SQLiteConnection.setWalModeFromConfiguration(SQLiteConnection.java:287)\n        at android.database.sqlite.SQLiteConnection.open(SQLiteConnection.java:215)\n        at android.database.sqlite.SQLiteConnection.open(SQLiteConnection.java:193)\n        at android.database.sqlite.SQLiteConnectionPool.openConnectionLocked(SQLiteConnectionPool.java:463)\n        at android.database.sqlite.SQLiteConnectionPool.open(SQLiteConnectionPool.java:185)\n        at android.database.sqlite.SQLiteConnectionPool.open(SQLiteConnectionPool.java:177)\n        at android.database.sqlite.SQLiteDatabase.openInner(SQLiteDatabase.java:804)\n        at android.database.sqlite.SQLiteDatabase.open(SQLiteDatabase.java:789)\n        at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:694)\n        at android.app.ContextImpl.openOrCreateDatabase(ContextImpl.java:804)\n        at android.content.ContextWrapper.openOrCreateDatabase(ContextWrapper.java:221)\n        at android.database.sqlite.SQLiteOpenHelper.getDatabaseLocked(SQLiteOpenHelper.java:224)\n        at android.database.sqlite.SQLiteOpenHelper.getWritableDatabase(SQLiteOpenHelper.java:164)\n        at com.mycompany.myapplication.sql.BasicDataSource.getWritableDatabase(BasicDataSource.java:57)\n        at com.mycompany.myapplication.sql.datasources.SomeDataSource.fillUpDatabaseMethod(SomeDataSource.java:264)\n        at com.mycompany.myapplication.sql.datasources.SomeDataSource.renewCacheMethod(SomeDataSource.java:560)\n        at com.mycompany.myapplication.activities.lists.ListsActivity$Worker.doInBackground(ListsActivity.java:315)\n        at com.mycompany.myapplication.activities.lists.ListsActivity$Worker.doInBackground(ListsActivity.java:1)\n        at android.os.AsyncTask$2.call(AsyncTask.java:287)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)\n        ... 4 more\nandroid.database.sqlite.SQLiteDatabaseLockedException: database is locked (code 5): , while compiling: PRAGMA journal_mode\n        at android.database.sqlite.SQLiteConnection.nativePrepareStatement(Native Method)\n        at android.database.sqlite.SQLiteConnection.acquirePreparedStatement(SQLiteConnection.java:882)\n        at android.database.sqlite.SQLiteConnection.executeForString(SQLiteConnection.java:627)\n        at android.database.sqlite.SQLiteConnection.setJournalMode(SQLiteConnection.java:313)\n        at android.database.sqlite.SQLiteConnection.setWalModeFromConfiguration(SQLiteConnection.java:287)\n        at android.database.sqlite.SQLiteConnection.open(SQLiteConnection.java:215)\n        at android.database.sqlite.SQLiteConnection.open(SQLiteConnection.java:193)\n        at android.database.sqlite.SQLiteConnectionPool.openConnectionLocked(SQLiteConnectionPool.java:463)\n        at android.database.sqlite.SQLiteConnectionPool.open(SQLiteConnectionPool.java:185)\n        at android.database.sqlite.SQLiteConnectionPool.open(SQLiteConnectionPool.java:177)\n        at android.database.sqlite.SQLiteDatabase.openInner(SQLiteDatabase.java:804)\n        at android.database.sqlite.SQLiteDatabase.open(SQLiteDatabase.java:789)\n        at android.database.sqlite.SQLiteDatabase.openDatabase(SQLiteDatabase.java:694)\n        at android.app.ContextImpl.openOrCreateDatabase(ContextImpl.java:804)\n        at android.content.ContextWrapper.openOrCreateDatabase(ContextWrapper.java:221)\n        at android.database.sqlite.SQLiteOpenHelper.getDatabaseLocked(SQLiteOpenHelper.java:224)\n        at android.database.sqlite.SQLiteOpenHelper.getWritableDatabase(SQLiteOpenHelper.java:164)\n        at com.mycompany.myapplication.sql.BasicDataSource.getWritableDatabase(BasicDataSource.java:57)\n        at com.mycompany.myapplication.sql.datasources.SomeDataSource.fillUpDatabaseMethod(SomeDataSource.java:264)\n        at com.mycompany.myapplication.sql.datasources.SomeDataSource.renewCacheMethod(SomeDataSource.java:560)\n        at com.mycompany.myapplication.activities.lists.ListsActivity$Worker.doInBackground(ListsActivity.java:315)\n        at com.mycompany.myapplication.activities.lists.ListsActivity$Worker.doInBackground(ListsActivity.java:1)\n        at android.os.AsyncTask$2.call(AsyncTask.java:287)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:137)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1076)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:569)\n        at java.lang.Thread.run(Thread.java:856)\n</code></pre>\n\n<p>Which means, the database is somehow locked when trying to aquire lock in getWritableDatabase.</p>\n\n<p>My SQLiteOpenHelper is singleton pattern, and DataSources are only using BasicDataSource as parent class.</p>\n\n<p>What is the improvement I can do to avoid SQLiteDatabaseLockedException in showed code?</p>\n"},{"tags":["java","multithreading","timer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":88,"score":-3,"question_id":12369019,"title":"java multi-threading","body":"<p>I'm executing a batch file using java command and reading batch data in text file putting in database. For example I have to run for 430 nodes within 15 min interval using same batch file. So I divided 430 node in 12 threads, so each thread contains 40 nodes pointing same batch file . But threads running parallel  are not able wait for the batch file command to complete. I can't make  wait for each thread, because all task should complete within 15 min. Any suggestions?</p>\n\n<p>Below is piece of code running multi-threading. </p>\n\n<pre><code> for (int i = 0; i &lt; noOfMainThreads; i++) {\n        // running 12 thread for 40 node \n        threadArr[i] = new Thread(runnableArr[i]);\n        runnableArr[i] = new CodeBatchfile(nodeArr,nodeidArr);\n    }\n\n    for (int i = 0; i &lt; noOfMainThreads; i++) {\n        threadArr[i].start;\n    } \n\n\n class CodeBatchfile{  \n\n\n    void run(){\n        for (int i=1;i&lt;nodename.length;i++) {\n            // exciting batch file using 12 threads.\n            cmd = filepath + \" \" + nodenamelocal;\n            try {\n                process = Runtime.getRuntime().exec(cmd, null, bdir);\n                process.waitFor();\n            }\n            catch(Exception ex) {\n                System.out.println(\"Exception Running batch file\" + ex.getLocalizedMessage());\n            }\n        }\n    }\n</code></pre>\n"},{"tags":["java","multithreading","sockets","serversocket"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12757457,"title":"Java MultiThreading socket Progamming for Network Game","body":"<p>Hy.I am new in java Multithreading.Actully i want to make two player game on java on lan by using Socket programming.I just want that when both player will connect to the server after that the game will start.My GameServer is basically using thread.WHo make thread when client will connect to the server.My logic is that when one client will make a connection with the server after that this thread will wait untill the 2nd thread will make connection .When second thread successfully make a connectin.Then both thread will be live and start work. This is connection part of my GameServer logic.</p>\n\n<pre><code>for(int i = 0; i &lt;= 1; i++) {\n    connectionSocket = welcomeSocket.accept();\n    System.out.println(\"Connection has been accepted\");\n    no++;              \n}\n</code></pre>\n\n<p>But this code will not work logically. Any idea or suggestion please?</p>\n"},{"tags":["java","multithreading","arraylist"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":12298452,"title":"Java Multithreading: How to use multi-threading in different ArrayList containing record info?","body":"<p>I retrieved 50000 data from database and stored them to arraylist. I split the arraylist into half saying 250000 stored in ArrayList1 (even rows) and other 25000 ArrayList2 (odd rows). </p>\n\n<p>Now, I need to use multi-threading in order to process these such that all 50,000 records are processed at a time. Main aim is to speed up the transaction. </p>\n\n<p>The problem is <code>userList</code> gets too heavy and takes time. </p>\n\n<p>How can I implement ExecutorService to speed up?</p>\n\n<p>Hoping to receive your suggestions asap.</p>\n\n<pre><code>List&lt;String[]&gt; userList = new ArrayList&lt;String[]&gt;();\nvoid getRecords()\n{\n    String [] props=null;\n    while (rs.next()) {\n        props = new String[2];\n        props[0] = rs.getString(\"useremail\");\n        props[1] = rs.getString(\"active\");\n        userList.add(props);\n        if (userList.size()&gt;0) sendEmail();   \n    }\n}\n\nvoid sendEmail()\n{\n    String [] user=null;\n    for (int k=0; k&lt;userList.size(); k++) \n    { \n        user = userList.get(k);\n        userEmail = user[0];         \n        //send email code\n    }\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["multithreading","epoll"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12344755,"title":"EPOLLONESHOT returns multiple event","body":"<p>Currently I am implementing a muliti-thread network-client application with epoll.  My model is simple:</p>\n\n<ol>\n<li><p>get client_fd &amp; write request to remote server</p></li>\n<li><p>set fd nonblocking &amp; add it to epfd(EPOLLIN|EPOLLET|EPOLLONESHOT) to wait for response</p></li>\n<li><p>get EPOLLIN from fd, read the whole response and release the resources</p></li>\n</ol>\n\n<p><strong>The problem</strong> I encounter is that occasionally I get multiple EPOLLIN on the same fd (<strong>BY USING EPOLLIN|EPOLLET|EPOLLONESHOT</strong>). Since I had released all the resources (including the client_fd) at the first EPOLLIN evt, the second evt crashed my program.</p>\n\n<p><strong>Any suggestions strongly appreciated:)</strong></p>\n\n<p>Here is the code snippet:</p>\n\n<pre><code>//multi-thread wait on the sem, since there should be only one thread \n//at epoll_wait at the same time(L-F model)\nsem_wait(wait_sem); \n\nint nfds = epoll_wait(epoll_fd,evts,max_evt_cnt,wait_time_out);\n\n//leader got the fds to proceed\nfor(int i =0; i &lt; nfds; ++i){\n    io_request* req = (io_request*)evts[i].data.ptr;\n    int sockfd = req-&gt;fd;\n    if(evts[i].events &amp; EPOLLIN){\n        ev.data.fd=sockfd;\n        if(0!=epoll_ctl(epoll_fd,EPOLL_CTL_DEL,sockfd,&amp;ev)){\n            switch(errno){\n                case EBADF:\n                    //multiple EPOLLIN cause EPOLL_CTL_DEL fail\n                    WARNING(\"delete fd failed for EBADF\");\n                    break;\n                default:\n                    WARNING(\"delete fd failed for %d\", errno);\n            }\n         }\n         else{\n                //currently walk around by just ignore the error fd\n                crt_idx.push_back(i);\n         }\n    }\n}\n\nif(crt_idx.size() != nfds)//just warning when the case happen\n    WARNING(\"crt_idx.size():%u != nfds:%d there has been some error!!\", crt_idx.size(), nfds);\n\n//current leader waked up next leader, and become a follower\nsem_post(wait_sem);\n\nfor(int i = 0; i &lt; crt_idx.size(); ++i)\n{\n    io_request* req = (io_request*)evts[crt_idx[i]].data.ptr;\n    ...do business logic...\n    ...release the resources &amp; release the client_fd\n}\n</code></pre>\n"},{"tags":["android","multithreading","android-asynctask","mp3","splash"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12752366,"title":"Android splash activity with mp3 tone","body":"<p>In my android application I want to play mp3 tone while it loads the splash activity.I  have already finished  my animated splash activity.here is my code .please someone help me to playing mp3 tone .</p>\n\n<pre><code>package com.bni.www;\n\n import android.app.Activity;\n import android.content.Intent;\n import android.graphics.PixelFormat;\n import android.os.Bundle;\n import android.os.CountDownTimer;\n import android.view.Window;\n import android.view.WindowManager;\n import android.view.animation.Animation;\n import android.view.animation.AnimationUtils;\n import android.widget.ImageView;\n import android.widget.LinearLayout;\n\n\npublic class Main extends Activity {\n\n\n\n public void onAttachedToWindow() {\n     super.onAttachedToWindow();\n     Window window = getWindow();\n     window.setFormat(PixelFormat.RGBA_8888);\n    }\n\n\n   @Override\n   public void onCreate(Bundle savedInstanceState) {\n   super.onCreate(savedInstanceState);\nrequestWindowFeature(Window.FEATURE_NO_TITLE);\ngetWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,WindowManager.LayoutParams.FLAG_FULLSCREEN);\n\n setContentView(R.layout.spalsh);\n CountDown _tik;\n _tik=new CountDown(12000,100,this,Login.class);\n //Intent intent=new Intent(Main.this,Login.class);   \n _tik.start();\n StartAnimations();\n //startActivity(intent);\n}\n  private void StartAnimations() {\n Animation anim = AnimationUtils.loadAnimation(this, R.anim.alpha);\n anim.reset();\n LinearLayout l=(LinearLayout) findViewById(R.id.lin_lay);\n l.clearAnimation();\n l.startAnimation(anim);\n\n anim = AnimationUtils.loadAnimation(this, R.anim.translate);\n anim.reset();\n ImageView iv = (ImageView) findViewById(R.id.logo);\n iv.clearAnimation();\n iv.startAnimation(anim);\n\n   }\n\n\n\n }\n\n\n class CountDown extends CountDownTimer{\n private Activity _act;\n private Class _cls;\n public CountDown(long millisInFuture, long countDownInterval,Activity act,Class cls) {\n super(millisInFuture, countDownInterval);\n _act=act;\n _cls=cls;\n }\n @Override\n public void onFinish() {\n _act.startActivity(new Intent(_act,_cls));\n _act.finish();\n }\n@Override\npublic void onTick(long millisUntilFinished) {\n\n }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":114,"score":0,"question_id":12756011,"title":"how to have a thread in java read the values of two seperate threads","body":"<p>ok. I need to make three threads: one to get odd numbers, one to get evens, and one to add the  odd and evens together. The output would be something like this (1,2,3,3,4,7...).\nI'm new to threads and still shaky on how they work but this is what I have so far:</p>\n\n<pre><code>class even extends Thread \n{\n    public void even()\n    {\n        Thread ThreadEven = new Thread(this); \n        start(); \n    } \n    public void run() \n    {\n        try\n        {\n            for(int i = 0; i &lt; 10; i += 2) \n            {\n                System.out.println(i);\n            }\n            Thread.sleep(1000);\n        }\n        catch(Exception e) \n        {\n            System.out.println(\"Error: Thread Interrupted\");\n        } \n    } \n}\n\nclass odd extends Thread \n{ \n    public void odd() \n    {\n        Thread ThreadOdd = new Thread(this); \n        start(); \n    } \n    public void run() \n    {\n        try\n        {\n            for(int i = 1;i &lt; 10; i += 2) \n            System.out.println(i);\n            Thread.sleep(1000);\n        }\n        catch(Exception e) \n        {\n            System.out.println(\"Error: Thread Interrupted\");\n        } \n    } \n}\nclass ThreadEvenOdd\n{\n    public static void main(String args []) \n    {\n        even e = new even();\n        odd o = new odd();\n\n    } \n} \n</code></pre>\n\n<p>This prints out 0,2,4...and then 1,3,5.\nHow to interleave? And is interleaving what I want and should I synchronize the threads as well?\nWhat I don't understand is how to get the values of the odd and even thread into a third to add the sum.\nApologies beforehand if I didn't get the formatting correct for the code.</p>\n"},{"tags":["c","multithreading","gcc","compare-and-swap"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":96,"score":3,"question_id":12755130,"title":"atomic compare(not equal) and swap","body":"<p>I want to use atomic compare and swap, but instead of equal to, I want to swap only if the memory location is not equal to the old value. Is it possible in C?</p>\n"},{"tags":["multithreading","ios4","uiimage"],"answer_count":4,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":3678,"score":6,"question_id":3129434,"title":"iOS4 & background [UIImage setImage:]","body":"<p>Up to OS 3.2, I used this kind of code to load <code>UIImageView</code> image in background, and it worked fine...</p>\n\n<p>Code:</p>\n\n<pre><code>- (void)decodeImageName:(NSString *)name\n{\n    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];\n    UIImage *newImage = [UIImage imageNamed:name];\n    [myImageView setImage:newImage];\n    [pool release];\n}\n...\n[self performSelectorInBackground:@selector(decodeImageName:) withObject:@\"ID\"]\n</code></pre>\n\n<p>... even if <code>[UIImageView setImage:]</code> was not thread-safe !</p>\n\n<p>But since OS 4, it doesn't work any more... Images appear on screen two seconds after <code>setImage</code> call. And if I do a <code>[myImageView performSelectorOnMainThread:@selector(setImage:) withObject:newImage waitUntilDone:YES]</code> instead of <code>[myImageView setImage:newImage]</code>, images appear immediately but seem to be re-decoded again on-the-fly (ignoring the previous <code>[UIImage imageNamed:]</code> which should have already decoded the image data), causing a pause on my main thread... Even if documentation says \"The underlying image cache is shared among all threads.\".</p>\n\n<p>Any thought ?</p>\n"},{"tags":["c#",".net","multithreading","sockets","thread-safety"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1713,"score":1,"question_id":1337073,"title":".NET C# Socket Concurrency issues","body":"<p>An instance of System.Net.Sockets.Socket</p>\n\n<p>can be shared by 2 threads so one use the send() method and another it's receive() method ?</p>\n\n<p>Is it safe?</p>\n\n<p>Well, I need it to be not only thread-safe, but also that the send/receive methods be non-syncronized, so as to let each thread call them concurrently.</p>\n\n<p>Do I have another way of doing it ?</p>\n\n<p>Thanks for helping, I am experienced in java but having a hard time trying to make this one.</p>\n"},{"tags":["multithreading","perl","garbage-collection"],"answer_count":1,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":118,"score":6,"question_id":12753208,"title":"Garbage collection in Perl threads","body":"<p>This question is a point of curiosity, as one of the two programs below works.</p>\n\n<p>I'm using Image::Magick to resize a number of photos. To save a bit of time, I work on each photo in its own thread, and use a semaphore to limit the number of threads working simultaneously. Originally I allowed every thread to run at once, but the script would quickly allocate 3.5 GB for all the photos (I only have 2GB available), and the script would run 5x slower than normal because of all the swapping to disk.</p>\n\n<p>The working, semaphore version code looks something like this:</p>\n\n<pre><code>use threads;\nuse Thread::Semaphore;\nuse Image::Magick;\n\nmy $s = Thread::Semaphore-&gt;new(4);\nforeach ( @photos ) {\n    threads-&gt;create( \\&amp;launch_thread, $s );\n}\nforeach my $thr ( reverse threads-&gt;list() ) {\n    $thr-&gt;join();\n}\n\nsub launch_thread {\n    my $s = shift;\n    $s-&gt;down();\n    my $image = Image::Magick-&gt;new();\n\n    # do memory-heavy work here\n\n    $s-&gt;up();\n}\n</code></pre>\n\n<p>This quickly allocates 500MB, and runs quite nicely without ever requiring more. (The threads are joined in reverse order to make a point.) </p>\n\n<p>I wondered if there might be overhead from launching 80 threads simultaneously and blocking most of them, so I altered my script to block the main thread:</p>\n\n<pre><code>my $s = Thread::Semaphore-&gt;new(4);\nforeach ( @photos ) {\n    $s-&gt;down();\n    threads-&gt;create( \\&amp;launch_thread, $s );\n}\nforeach my $thr ( threads-&gt;list() ) {\n    $thr-&gt;join();\n}\n\nsub launch_thread {\n    my $s = shift;\n    my $image = Image::Magick-&gt;new();\n\n    # do memory-heavy work here\n\n    $s-&gt;up();\n}\n</code></pre>\n\n<p>This version starts fine, but gradually accumulates the 3.5GB of space the original version used. It's faster than running all threads at once, but still quite a bit slower than blocking threads.</p>\n\n<p>My first guess was that the memory used by a thread isn't freed until join() is called on it, and as it's the main thread that blocks, no threads are freed until they've all been allocated. However, in the first, working version, the threads pass the guard in a more-or-less random order, but join in reverse order. If my guess is correct, then, many more than the four running threads should be waiting to be join()ed at any time, and this version should be slower as well.</p>\n\n<p>So why are these two versions so different?</p>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12752607,"title":"Home button in runOnUiThread android","body":"<p>I'm drawing <code>Dialog</code> on main thread with <code>runOnUiThread</code> method but when I'm in this method and I press home button application crashes and says the unable to pause the activity:</p>\n\n<pre><code>@Override\n        public boolean onKeyDown(int keyCode, KeyEvent event) {\n            if (keyCode == KeyEvent.KEYCODE_BACK) {\n                GFXSurface.this.runOnUiThread(new Runnable() {\n                    public void run() {\n                        showPause(GFXSurface.this);\n                    }\n                });\n                return true;\n            }\n            return false;\n        }\n</code></pre>\n\n<p><code>showPause</code> which just show the <code>dialog</code> and if I press home button while I'm on <code>dialog</code> app crashes:</p>\n\n<pre><code>public void showPause(final Context context) {\n\n        Button toMenu;\n        Button resume;\n\n        final Dialog myDialog;\n        myDialog = new Dialog(context);\n        myDialog.setContentView(R.layout.showpopup);\n        myDialog.setTitle(\"Paused\");\n        myDialog.setCancelable(false);\n\n        resume = (Button) myDialog.findViewById(R.id.Btn1);\n        toMenu = (Button) myDialog.findViewById(R.id.Btn2);\n\n        onPause();\n        myDialog.show();\n\n        toMenu.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                onPause();\n                Intent menu = new Intent(context, Menu.class);\n                context.startActivity(menu);\n            }\n        });\n\n        resume.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                myDialog.cancel();\n                onCancel(myDialog);\n            }\n        });\n\n    }\n</code></pre>\n\n<p>onPause:</p>\n\n<pre><code>public void pause() {\n            isRunning = false;\n            while (true) {\n                try {\n                    ourThread.join();\n                } catch (InterruptedException e) {\n                    // TODO Auto-generated catch block\n                    e.printStackTrace();\n                }\n                break;\n            }\n            ourThread = null;\n        }\n\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n android:background=\"#8C8C8C\"\n android:layout_width=\"320dp\"\n android:layout_height=\"100dp\"\n style=\"@style/Theme.custom\"&gt;\"\n\n\n\n &lt;Button\n     android:id=\"@+id/Btn1\"\n     android:layout_width=\"100dp\"\n     android:layout_height=\"70dp\"\n     android:layout_alignParentBottom=\"true\"\n     android:layout_alignParentLeft=\"true\"\n     android:layout_below=\"@+id/checkBox2\"\n     android:text=\"Resume\" /&gt;\n\n &lt;CheckBox\n     android:id=\"@+id/checkBox2\"\n     android:layout_width=\"wrap_content\"\n     android:layout_height=\"wrap_content\"\n     android:layout_alignParentTop=\"true\"\n     android:layout_toRightOf=\"@+id/Btn1\"\n     android:text=\"Music on/off\" /&gt;\n\n &lt;Button\n     android:id=\"@+id/Btn2\"\n     android:layout_width=\"100dp\"\n     android:layout_height=\"52dp\"\n     android:layout_alignParentBottom=\"true\"\n     android:layout_alignParentRight=\"true\"\n     android:text=\"Menu\" /&gt;\n\n&lt;/RelativeLayout&gt;\n</code></pre>\n"},{"tags":["c","multithreading","operating-system"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":281,"score":8,"question_id":12623993,"title":"Making threads get equal timeslices","body":"<p>I am running this program where I have multiple threads. Three threads are generating signals for the same parent process. There are four handler threads for handling the signals generated by the signal generating threads. I have a monitoring thread which also receives the signals and processes according. However, I have a situation. I can see that the signals are not divided equally. I mean the signals are directed to the same process. I have four handler threads and one monitoring thread waiting for the signal. So anyone of them can receive the signal. I was expecting it to be distributed uniformly. However, I could see that at time a whole burst of signals are received by the handler threads. The very next time the whole burst of signals are handled by the monitor thread. Why isn't it uniform. I have added a sleep call after the handler/ monitor threads complete handling one signal. So as soon as the handler/monitor completes one signal it should have given the other opportunity to handle the next signal. However, the output doesn't show the case</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;iostream&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;cstdio&gt;\n#include &lt;stdlib.h&gt;\n\n#define NUM_SENDER_PROCESSES 3\n#define NUM_HANDLER_PROCESSES 4\n#define NUM_SIGNAL_REPORT 10\n#define MAX_SIGNAL_COUNT 100000\n\n\nusing namespace std;\n\nvolatile int usrsig1_handler_count = 0;\nint usrsig2_handler_count = 0;\nint usrsig1_sender_count = 0;\nint usrsig2_sender_count = 0;\nint monitor_count = 0;\nint usrsig1_monitor_count = 0;\nint usrsig2_monitor_count = 0;\ndouble time_1[10];\ndouble time_2[10];\nint lock_1 = 0;\nint lock_2 = 0;\nint lock_3 = 0;\nint lock_4 = 0;\nint lock_5 = 0;\n\n\ndouble timestamp() {\n  struct timeval tp;\n  gettimeofday(&amp;tp, NULL);\n  return (double)tp.tv_sec + tp.tv_usec / 1000000.;\n}\n\nvoid sleepMs(double seconds) {\n  usleep((unsigned int)(seconds*1000000));\n}\n\nvoid *senderfunc(void *parm) {\n  srand(time(0));\n  while(true) {\n    int signal_id = rand()%2 + 1;\n    if(signal_id == 1) {\n      while(__sync_lock_test_and_set(&amp;lock_3,1) != 0) {\n      }\n      usrsig1_sender_count++;\n      lock_3 = 0;\n      kill(getpid(), SIGUSR1);\n    } else {\n      while(__sync_lock_test_and_set(&amp;lock_4,1) != 0) {\n      }\n      usrsig2_sender_count++;\n      lock_4 = 0;\n      kill(getpid(), SIGUSR2);\n    }\n\n\n    int r = rand()%10 + 1;\n    double s = (double)r/100;\n    sleepMs(s);\n  }\n}\n\nvoid *handlerfunc(void *parm)\n{\n  int *index = (int *)parm;\n  sigset_t set;\n  sigemptyset(&amp;set);\n  //cout &lt;&lt; (*index) &lt;&lt; endl;\n  if((*index) % 2 == 0) {\n    sigaddset(&amp;set, SIGUSR1);\n  } else {\n    sigaddset(&amp;set, SIGUSR2);\n  }\n\n\n  int sig;\n\n  while(true) {\n    sigwait(&amp;set, &amp;sig);\n    //cout &lt;&lt; \"Handler\" &lt;&lt; endl;\n    if (sig == SIGUSR1) {\n      while(__sync_lock_test_and_set(&amp;lock_1,1) != 0) {\n      }\n      usrsig1_handler_count++;        \n      lock_1 = 0;\n    } else if(sig == SIGUSR2) {\n      while(__sync_lock_test_and_set(&amp;lock_2,1) != 0) {\n      }\n      usrsig2_handler_count++;\n      lock_2 = 0;\n    }\n\n    sleepMs(0.0001);\n  }\n\n}\n\nvoid *monitorfunc(void *parm) {\n\n  sigset_t set;\n  sigemptyset(&amp;set);\n\n  sigaddset(&amp;set, SIGUSR1);\n  sigaddset(&amp;set, SIGUSR2);\n\n  int sig;  \n\n  while(true) {\n    sigwait(&amp;set, &amp;sig);\n    //cout &lt;&lt; \"Monitor\" &lt;&lt; endl;\n    if(sig == SIGUSR1) {\n      time_1[usrsig1_monitor_count] = timestamp();\n      usrsig1_monitor_count++;\n    } else if(sig == SIGUSR2) {\n      time_2[usrsig2_monitor_count] = timestamp();\n      usrsig2_monitor_count++;\n    }\n    monitor_count++;\n    //cout &lt;&lt; monitor_count &lt;&lt; endl;\n\n    if(monitor_count == NUM_SIGNAL_REPORT) {\n      double difference_1 = 0;\n      double difference_2 = 0;\n      if(usrsig1_monitor_count &gt; 1) {\n        for(int i=0; i&lt;usrsig1_monitor_count-1; i++) {\n          difference_1 = difference_1 + time_1[i+1] - time_1[i];\n        }\n        cout &lt;&lt; \"Interval SIGUSR1 = \" &lt;&lt; difference_1/(usrsig1_monitor_count-1)&lt;&lt; endl;\n      }\n\n      if(usrsig2_monitor_count &gt; 1) {\n        for(int i=0; i&lt;usrsig2_monitor_count-1; i++) {\n          difference_2 = difference_2 + time_2[i+1] - time_2[i];\n        }\n        cout &lt;&lt; \"Interval SIGUSR2 = \" &lt;&lt; difference_2/(usrsig2_monitor_count-1) &lt;&lt; endl;\n      }\n      cout &lt;&lt; \"Count SIGUSR1 = \" &lt;&lt; usrsig1_sender_count &lt;&lt; endl;\n      cout &lt;&lt; \"Count SIGUSR2 = \" &lt;&lt; usrsig2_sender_count &lt;&lt; endl; \n      monitor_count = 0;\n      usrsig1_monitor_count = 0;\n      usrsig2_monitor_count = 0;\n    }\n\n    sleepMs(0.001);\n\n  }\n}\n\nint main(int argc, char **argv)\n{\n  if(argc != 2) {\n    cout &lt;&lt; \"Required parameters missing. \" &lt;&lt; endl;\n    cout &lt;&lt; \"Option 1 = 1 which means run for 30 seconds\" &lt;&lt; endl;\n    cout &lt;&lt; \"Option 2 = 2 which means run until 100000 signals\" &lt;&lt; endl;\n    exit(0);\n  }\n\n  int option = atoi(argv[1]);\n  int i;\n\n  pthread_t handlers[NUM_HANDLER_PROCESSES];\n  pthread_t generators[NUM_SENDER_PROCESSES];\n  pthread_t monitor;\n\n  sigset_t set;\n  sigset_t oldset;\n  sigemptyset(&amp;oldset);\n  sigemptyset(&amp;set);\n  sigaddset(&amp;set, SIGUSR1);\n  sigaddset(&amp;set, SIGUSR2);\n\n  pthread_sigmask(SIG_BLOCK, &amp;set, &amp;oldset);\n\n\n  int handler_mask[4] = {0,1,2,3};\n  //Initializing the handler threads\n  for(i=0; i&lt;NUM_HANDLER_PROCESSES; i++) {\n    pthread_create(&amp;handlers[i], NULL, handlerfunc, (void *)&amp;handler_mask[i]);\n  }\n\n  pthread_create(&amp;monitor, NULL, monitorfunc, NULL);\n\n  sleep(5);\n\n  for(i=0; i&lt;NUM_SENDER_PROCESSES; i++) {\n    pthread_create(&amp;generators[i], NULL, senderfunc, NULL);\n  }\n\n  if(option == 1) {\n    cout &lt;&lt; \"Option 1 \" &lt;&lt; endl;\n    //sleep(30);\n    while(true){\n\n    }\n    exit(0);\n  } else {\n    while(true) {\n      if((usrsig1_handler_count + usrsig2_handler_count) &gt;= MAX_SIGNAL_COUNT) {\n        cout &lt;&lt; \"Count SIGUSR1 = \" &lt;&lt; usrsig1_handler_count &lt;&lt; endl;\n        cout &lt;&lt; \"Count SIGUSR2 = \" &lt;&lt; usrsig2_handler_count &lt;&lt; endl;\n        exit(0);\n      } else {\n        pthread_yield();\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>Here is my output</p>\n\n<pre><code>HandlerHandler\n\nHandler\nHandler\nMonitor\nMonitor\n... whole bunch of Monitor messages\nMonitor\nMonitor\nHandler\nHandler\n... whole bunch of Handler messages\nHandler\nHandler\n</code></pre>\n\n<p>You can see the burst of monitor followed by burst of handler. However, in the code once a handler/monitor handles a signal and goes for sigwait, I have added a sleep call so that the turn is passed to the next available thread. However, this is not helping. This should have made it uniform I guess. However, still monitor gets burst and print. Even though in monitor I have placed sleep after it has finished its job for a signal</p>\n"},{"tags":["ios","multithreading","tableview","gcd"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12752424,"title":"iOS GCD use for a UITableView","body":"<p>I have a pretty intensive UITableView that needs to be optimized a little. The question is, how to use grand central station to do it effectively. Each cell has a UIView with a couple labels and two images. I have subclassed the TableViewCell and the view's are being reused though it is still a little laggy when the table gets bigger. How would I go about using GCD to optimize the table? OR is there a better way around it? I am not very strong in thread management and looking for some advice.</p>\n\n<p><strong>Here is the code to my tableview:</strong></p>\n\n<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath\n{\n\nstatic NSString *CellIdentifier = @\"Cell\";\nJointCAD *currentCall = [[xmlParser calls] objectAtIndex:indexPath.row];\nself.tableView.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@\"texture3.png\"]];\n\nTableViewCell *cell = (TableViewCell *)[tableView dequeueReusableCellWithIdentifier:CellIdentifier];\n\n    if (cell == nil)\n{\n    cell = [[TableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier];\n}\n\ncell.callTypeLabel.text = currentCall.currentCallType;\ncell.locationLabel.text = currentCall.location;\ncell.unitsLabel.text = currentCall.units;\ncell.stationLabel.text = [@\"Station: \" stringByAppendingString:currentCall.station];\ncell.selectedBackgroundView = cell.selectionView;\n\nif ([currentCall.callType isEqualToString:@\"F\"]) {\n    cell.imageType = Fire;\n}\nelse {\n    cell.imageType = EMS;\n}\n\nif ([currentCall.county isEqualToString:@\"W\"]) {\n    cell.imageType1 = Washington;\n}\nelse {\n    cell.imageType1 = Clackamas;\n}\n\nreturn cell;\n}\n</code></pre>\n\n<p><strong>Here is the subclassed tableviewcell:</strong></p>\n\n<pre><code>- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier\n{\nif (self = [super initWithStyle:style reuseIdentifier:reuseIdentifier]) {\n\n    callView = [[UIView alloc] initWithFrame:CGRectMake(7.5, 7, 305, 65)];\n    [callView setAutoresizingMask:UIViewAutoresizingFlexibleLeftMargin |\n     UIViewAutoresizingFlexibleRightMargin |\n     UIViewAutoresizingFlexibleWidth];\n    [callView setContentMode:UIViewContentModeTopLeft];\n    [callView setBackgroundColor: [UIColor colorWithRed:240.0/255.0 green:240.0/255.0 blue:240.0/255.0 alpha:1.0]];\n    callView.layer.borderWidth = 1.0;\n    callView.layer.borderColor = [UIColor colorWithRed:(0/255.0)  green:(0/255.0)  blue:(0/255.0)  alpha:1.0].CGColor;\n\n    [self.contentView addSubview:callView];\n\n    callTypeLabel = [[UILabel alloc]initWithFrame:CGRectMake(5, 2, 190, 21)];\n    callTypeLabel.font = [UIFont boldSystemFontOfSize:12.0];\n    callTypeLabel.textColor = [UIColor blackColor];\n    callTypeLabel.backgroundColor = [UIColor clearColor];\n    callTypeLabel.highlightedTextColor = [UIColor whiteColor];\n    callTypeLabel.adjustsFontSizeToFitWidth = YES;\n    [callView addSubview:callTypeLabel];\n\n    locationLabel = [[UILabel alloc]initWithFrame:CGRectMake(5, 17 , 190, 15)];\n    locationLabel.font = [UIFont systemFontOfSize:10.0];\n    locationLabel.textColor = [UIColor blackColor];\n    locationLabel.backgroundColor = [UIColor clearColor];\n    locationLabel.highlightedTextColor = [UIColor whiteColor];\n    locationLabel.adjustsFontSizeToFitWidth = YES;\n    [callView addSubview:locationLabel];\n\n    unitsLabel = [[UILabel alloc]initWithFrame:CGRectMake(4, 43, 190, 21)];\n    unitsLabel.font = [UIFont systemFontOfSize:10.0];\n    unitsLabel.textColor = [UIColor blackColor];\n    unitsLabel.backgroundColor = [UIColor clearColor];\n    unitsLabel.highlightedTextColor = [UIColor whiteColor];\n    unitsLabel.adjustsFontSizeToFitWidth = NO;\n    [callView addSubview:unitsLabel];\n\n    stationLabel = [[UILabel alloc]initWithFrame:CGRectMake(195 , 25, 75, 20)];\n    stationLabel.font = [UIFont systemFontOfSize:12.0];\n    stationLabel.textColor = [UIColor blackColor];\n    stationLabel.backgroundColor = [UIColor clearColor];\n    stationLabel.highlightedTextColor = [UIColor whiteColor];\n    stationLabel.adjustsFontSizeToFitWidth = YES;\n    [callView addSubview:stationLabel];\n\n    CGRect countyImageFrame = CGRectMake(275, 10, 18, 18);\n    UIImageView *countyImageView = [[UIImageView alloc] initWithFrame:countyImageFrame];\n    countyImageView.image = countyImage;\n    [callView addSubview:countyImageView];\n\n    CGRect callTypeImageFrame = CGRectMake(275, 37, 18, 18);\n    UIImageView *callTypeImageView = [[UIImageView alloc] initWithFrame:callTypeImageFrame];\n    callTypeImageView.image = callTypeImage;\n    [callView addSubview:callTypeImageView];\n\n    selectionView = [[UIView alloc] initWithFrame:CGRectMake(10, 7, 200, 65)];\n    [selectionView setBackgroundColor: [UIColor clearColor]];\n\n    }\n\n    return self;\n}\n\n- (void)setImageType:(CallType)newImageType {\nimageType = newImageType;\n\nif (imageType == Fire) {\n    CGRect callTypeImageFrame = CGRectMake(275, 37, 18, 18);\n    UIImageView *callTypeImageView = [[UIImageView alloc] initWithFrame:callTypeImageFrame];\n    callTypeImageView.image = [UIImage imageNamed:@\"red.png\"];\n    [callView addSubview:callTypeImageView];\n}\nelse if (imageType == EMS) {\n    CGRect callTypeImageFrame = CGRectMake(275, 37, 18, 18);\n    UIImageView *callTypeImageView = [[UIImageView alloc] initWithFrame:callTypeImageFrame];\n    callTypeImageView.image = [UIImage imageNamed:@\"yellow.png\"];\n    [callView addSubview:callTypeImageView];\n    }\n}\n\n- (void)setImageType1:(County)newImageType1 {\nimageType1 = newImageType1;\n\nif (imageType1 == Washington) {\n    CGRect callTypeImageFrame = CGRectMake(275, 10, 18, 18);\n    UIImageView *countyImageView = [[UIImageView alloc] initWithFrame:callTypeImageFrame];\n    countyImageView.image = [UIImage imageNamed:@\"blue.png\"];\n    [callView addSubview:countyImageView];\n}\nelse if (imageType1 == Clackamas) {\n    CGRect callTypeImageFrame = CGRectMake(275, 10, 18, 18);\n    UIImageView *countyImageView = [[UIImageView alloc] initWithFrame:callTypeImageFrame];\n    countyImageView.image = [UIImage imageNamed:@\"green.png\"];\n    [callView addSubview:countyImageView];\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","cursor","lag"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12751620,"title":"Cursor on console seems laggy","body":"<p>I have been writing a text based video game in java (I'm new to java, btw), and it does not have the performance i have been hoping for, specifically speech. I want the text to appear as if the person is speaking (I don't want it to appear all at once, just character by character). I have achieved the effect with this code:</p>\n\n<pre><code>void speak(String speak){\n    for(int x = 0; x &lt; speak.length(); x++){\n        System.out.print(speak.charAt(x));\n        pause(talkSpeed);\n    }\n}\n</code></pre>\n\n<p>talkSpeed is the object's speed of talking. pause is a function I made to make Thread.sleep easier. Too lazy to write try catch all the time. My only problem with this code is that it does not print to console very smoothly. It seems jerky, like it's lagging a bit. It looks like it prints world by word and not letter by letter. I don't understand why, it is a fairly simple piece of code. Maybe it is pause, and i should just use Thread.sleep. Also, im wondering how i can make the cursor follow the text.</p>\n\n<p>Or should I just rewrite this in c++ to get that performance boost? I know approx the same amount of C++</p>\n\n<pre><code>void pause(double time){\n    long y = (long) (1000 * time);\n    try {\n        Thread.sleep(y);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}\n</code></pre>\n\n<p>someone asked for the code to the pause function, so here it is</p>\n"},{"tags":["multithreading","delphi","delphi-xe2"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":133,"score":2,"question_id":12751031,"title":"Which wait method to call in an infinite waiting thread for Delphi XE2","body":"<p>if I've got a </p>\n\n<pre><code>While not terminated do\nbegin\n     doStuff;\n\nend\n</code></pre>\n\n<p>loop in the execute method of a Delphi XE2 thread, and I want to not make it bogart all my flops.</p>\n\n<p>What should I call,</p>\n\n<p>in Delphi 7, it was easy, I'd call Sleep(X) where X was inversely proportional to how interesting I thought the thread was.</p>\n\n<p>But now, I've got </p>\n\n<pre><code>SpinWait(X);\n</code></pre>\n\n<p>Which calls YieldProcessor X number of times</p>\n\n<p>and </p>\n\n<pre><code>Yield;\n</code></pre>\n\n<p>which calls the windows function \"SwitchToThread\".</p>\n\n<p>Should I use any of these or should I just set the priority of the thread?</p>\n"},{"tags":["ios","multithreading","nsmutablestring"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12750785,"title":"Is CFStringTransform thread safe and reentrant?","body":"<p>I see my app is stuck in deadlock state(the main thread is waiting in <code>semaphore_wait_trap</code>, see call stacks below) several times while calling more than one instances of <code>CFStringTransform</code> simultaneously in global background queue as follows:</p>\n\n<pre><code>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n    CFStringTransform(…);\n});\n</code></pre>\n\n<p>The call stacks look like these:</p>\n\n<pre><code>Thread 1, Queue : com.apple.main-thread\n#0  0x310bff04 in semaphore_wait_trap ()\n#1  0x341c1fae in _dispatch_semaphore_wait_slow ()\n#2  0x32bc5c32 in SBSProcessAssertionCreateForPID ()\n#3  0x3685bca4 in -[UIApplication beginBackgroundTaskWithExpirationHandler:] ()\n#4  0x0011a1c2 in -[XXX downloadPicture:]\n…\n#10 0x32f86a6e in __NSFireDelayedPerform ()\n#11 0x354a15de in __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ ()\n#12 0x354a1290 in __CFRunLoopDoTimer ()\n#13 0x3549ff00 in __CFRunLoopRun ()\n#14 0x35412ebc in CFRunLoopRunSpecific ()\n#15 0x35412d48 in CFRunLoopRunInMode ()\n#16 0x3594f2ea in GSEventRunModal ()\n#17 0x367f1300 in UIApplicationMain ()\n#18 0x000c3eb8 in main\n\n\nThread 3, Queue : com.apple.libdispatch-manager\n#0  0x310c0648 in kevent64 ()\n#1  0x341c3978 in _dispatch_mgr_invoke ()\n#2  0x341c3658 in _dispatch_mgr_thread$VARIANT$mp ()\n\n\nThread 5 WebThread, Queue : (null)\n#0  0x310bfeb4 in mach_msg_trap ()\n#1  0x310c004c in mach_msg ()\n#2  0x354a1044 in __CFRunLoopServiceMachPort ()\n#3  0x3549fda2 in __CFRunLoopRun ()\n#4  0x35412ebc in CFRunLoopRunSpecific ()\n#5  0x35412d48 in CFRunLoopRunInMode ()\n#6  0x349b6a74 in RunWebThread(void*) ()\n#7  0x3925f310 in _pthread_start ()\n#8  0x3925f1d8 in thread_start ()\n\n\nThread 11 com.apple.NSURLConnectionLoader, Queue : (null)\n#0  0x310bfeb4 in mach_msg_trap ()\n#1  0x310c004c in mach_msg ()\n#2  0x354a1044 in __CFRunLoopServiceMachPort ()\n#3  0x3549fda2 in __CFRunLoopRun ()\n#4  0x35412ebc in CFRunLoopRunSpecific ()\n#5  0x35412d48 in CFRunLoopRunInMode ()\n#6  0x32f0bbcc in +[NSURLConnection(Loader) _resourceLoadLoop:] ()\n#7  0x32f8f67c in __NSThread__main__ ()\n#8  0x3925f310 in _pthread_start ()\n#9  0x3925f1d8 in thread_start ()\n\n\nThread 14 com.apple.CFSocket.private, Queue : (null)\n#0  0x310d0594 in select$DARWIN_EXTSN ()\n#1  0x354a51f6 in __CFSocketManager ()\n#2  0x3925f310 in _pthread_start ()\n#3  0x3925f1d8 in thread_start ()\n</code></pre>\n\n<p>and 31 threads calling <code>CFStringTransform</code>:</p>\n\n<pre><code>Thread 12, Queue : com.apple.root.default-priority\n#0  0x310d00fc in __psynch_mutexwait ()\n#1  0x3924f128 in pthread_mutex_lock ()\n#2  0x31448548 in umtx_lock ()\n#3  0x3144a090 in icu::UnicodeString::doReplace(int, int, unsigned short const*, int, int) ()\n#4  0x314a5b3a in icu::UnicodeString::append(int) ()\n#5  0x314a1510 in icu::UnicodeSet::_appendToPat(icu::UnicodeString&amp;, int, signed char) ()\n#6  0x314a168c in icu::UnicodeSet::_generatePattern(icu::UnicodeString&amp;, signed char) const ()\n#7  0x314a2e4e in icu::UnicodeSet::applyPattern(icu::RuleCharacterIterator&amp;, icu::SymbolTable const*, icu::UnicodeString&amp;, unsigned int, icu::UnicodeSet&amp; (icu::UnicodeSet::*)(int), UErrorCode&amp;) ()\n#8  0x314a1e7c in icu::UnicodeSet::applyPattern(icu::UnicodeString const&amp;, icu::ParsePosition&amp;, unsigned int, icu::SymbolTable const*, UErrorCode&amp;) ()\n#9  0x314a1e06 in icu::UnicodeSet::UnicodeSet(icu::UnicodeString const&amp;, icu::ParsePosition&amp;, unsigned int, icu::SymbolTable const*, UErrorCode&amp;) ()\n#10 0x314a1d8e in icu::UnicodeSet::UnicodeSet(icu::UnicodeString const&amp;, icu::ParsePosition&amp;, unsigned int, icu::SymbolTable const*, UErrorCode&amp;) ()\n#11 0x314fe56c in ___lldb_unnamed_function2011$$libicucore.A.dylib ()\n#12 0x314fda50 in ___lldb_unnamed_function2010$$libicucore.A.dylib ()\n#13 0x314fd954 in ___lldb_unnamed_function2009$$libicucore.A.dylib ()\n#14 0x314ff540 in ___lldb_unnamed_function2031$$libicucore.A.dylib ()\n#15 0x314feed6 in ___lldb_unnamed_function2025$$libicucore.A.dylib ()\n#16 0x314feb0c in ___lldb_unnamed_function2024$$libicucore.A.dylib ()\n#17 0x31521468 in ___lldb_unnamed_function2248$$libicucore.A.dylib ()\n#18 0x3152015a in icu::Transliterator::createBasicInstance(icu::UnicodeString const&amp;, icu::UnicodeString const*) ()\n#19 0x31522cd6 in ___lldb_unnamed_function2296$$libicucore.A.dylib ()\n#20 0x31523c32 in ___lldb_unnamed_function2305$$libicucore.A.dylib ()\n#21 0x3152003a in icu::Transliterator::createInstance(icu::UnicodeString const&amp;, UTransDirection, UParseError&amp;, UErrorCode&amp;) ()\n#22 0x315200d6 in icu::Transliterator::createInstance(icu::UnicodeString const&amp;, UTransDirection, UErrorCode&amp;) ()\n#23 0x314bfc1c in ___lldb_unnamed_function1051$$libicucore.A.dylib ()\n#24 0x314bfb0e in ___lldb_unnamed_function1050$$libicucore.A.dylib ()\n#25 0x3151fada in icu::Transliterator::filteredTransliterate(icu::Replaceable&amp;, UTransPosition&amp;, signed char, signed char) const ()\n#26 0x3151f724 in icu::Transliterator::transliterate(icu::Replaceable&amp;, int, int) const ()\n#27 0x3154a8da in utrans_trans ()\n#28 0x354b3928 in CFStringTransform ()\n#30 0x002716c8 in __18-[Foo bar]_block_invoke_0\n#31 0x341bd11e in _dispatch_call_block_and_release ()\n#32 0x341c1960 in _dispatch_root_queue_drain ()\n#33 0x341c1ac0 in _dispatch_worker_thread2 ()\n#34 0x39254a10 in _pthread_wqthread ()\n#35 0x392548a4 in start_wqthread ()\n</code></pre>\n\n<p>It seems the problem happens in the string modification call <code>doReplace</code>. But it also seem <code>doReplace</code> is thread safe since it is using mutex so it should be OK for multiple threads to modify the same mutable string in the same time. In fact, in my case, no mutable string is being modified by more than one thread — each <code>CFStringTransform</code> is called for a unique string. So basically, I don't know why it is stuck.</p>\n"},{"tags":["android","multithreading","handler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12751895,"title":"Use of Handler in Single Threaded application","body":"<p>According to Android Documentation</p>\n\n<blockquote>\n  <p>\"A Handler allows you to send and process Message and Runnable objects\n  associated with a thread's MessageQueue. Each Handler instance is\n  associated with a single thread and that thread's message queue. When\n  you create a new Handler, it is bound to the thread / message queue of\n  the thread that is creating it -- from that point on, it will deliver\n  messages and runnables to that message queue and execute them as they\n  come out of the message queue.\"</p>\n</blockquote>\n\n<p>I totally get the use of Handler in Multi-Threaded application, in which one thread will post to other thread message queue using Handler, but what is the use of Handler in single threaded application. The reason why I am asking this is because I saw couple of sample applications at developer.google.com using HAndler in single threaded application. <a href=\"http://developer.android.com/training/basics/location/index.html\" rel=\"nofollow\">Here</a> is one example.</p>\n"},{"tags":["multithreading","android-ndk","jni","cross-compiling","libc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12696355,"title":"application crashes when trying loadLibrary(), issue with pthread_create on 4.1.1?","body":"<p>I am trying to debug a crash with trying to load a library that I cross-compiled using System.loadLibrary().  I have been able to successfully load this library on any device running 4.0.4 (ICS), but it crashes on all of my devices running 4.1.1 (JB).  It seems to crash when running in to pthread_create() in libc:</p>\n\n<pre><code>10-01 14:25:34.173: D/dalvikvm(8215): Trying to load lib /data/data/com.gnychis.awmon/lib/libtshark.so 0x410fb430\n10-01 14:25:34.181: A/libc(8215): Fatal signal 11 (SIGSEGV) at 0x5dfaa01c (code=2), thread 8232 (AsyncTask #1)\n// And here is the end of the stack....\nI/DEBUG   (  246):     #10  pc 0001263c  /system/lib/libc.so (pthread_create+180)\n</code></pre>\n\n<p>Here is the much longer crash log that is involved showing the entire stack trace, and you will see it ends at libc and pthread_create:</p>\n\n<pre><code>D/dalvikvm(26364): Trying to load lib /data/data/com.gnychis.awmon/lib/libtshark.so 0x410a5ee0\nF/libc    (26364): Fatal signal 11 (SIGSEGV) at 0x5dff301c (code=2), thread 27345 (AsyncTask #1)\nD/AndroidRuntime(27404): Calling main entry com.android.commands.am.Am\nI/DEBUG   (  246): *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***\nI/DEBUG   (  246): Build fingerprint: 'd2uc-user 4.0.4 IMM76D I747UCALEM release-keys'\nI/DEBUG   (  246): pid: 26364, tid: 27345, name: AsyncTask #1  &gt;&gt;&gt; com.gnychis.awmon &lt;&lt;&lt;\nI/DEBUG   (  246): signal 11 (SIGSEGV), code 2 (SEGV_ACCERR), fault addr 5dff301c\nD/AndroidRuntime(27404): Shutting down VM\nD/dalvikvm(27404): GC_CONCURRENT freed 99K, 88% free 498K/4096K, paused 1ms+1ms, total 7ms\nI/AndroidRuntime(27404): NOTE: attach of thread 'Binder_3' failed\nI/DEBUG   (  246):     r0 80000000  r1 02b1a000  r2 00000005  r3 5dff3000\nI/DEBUG   (  246):     r4 40102894  r5 4010aaec  r6 00000000  r7 00000029\nI/DEBUG   (  246):     r8 00000029  r9 5dff3000  sl 60871000  fp 02b1a000\nI/DEBUG   (  246):     ip 00000005  sp 5d95ace0  lr 6004d1bb  pc 400ec6e0  cpsr 600d0030\nI/DEBUG   (  246):     d0  61642f617461642f  d1  672e6d6f632f6174\nI/DEBUG   (  246):     d2  612e73696863796e  d3  62696c2f6e6f6d77\nI/DEBUG   (  246):     d4  00000000000e16f0  d5  000000000000695f\nI/DEBUG   (  246):     d6  000000000002a715  d7  0000012f00000000\nI/DEBUG   (  246):     d8  0000000000000000  d9  0000000000000000\nI/DEBUG   (  246):     d10 0000000000000000  d11 0000000000000000\nI/DEBUG   (  246):     d12 0000000000000000  d13 0000000000000000\nI/DEBUG   (  246):     d14 0000000000000000  d15 0000000000000000\nI/DEBUG   (  246):     d16 7420676e69797254  d17 6c2064616f6c206f\nI/DEBUG   (  246):     d18 0063002f00610074  d19 0067002e006d006f\nI/DEBUG   (  246):     d20 006800630079006e  d21 0061002e00730069\nI/DEBUG   (  246):     d22 006e006f006d0077  d23 00620069006c002f\nI/DEBUG   (  246):     d24 000000000000e16f  d25 0000000000000000\nI/DEBUG   (  246):     d26 000000000000695f  d27 0000000000000000\nI/DEBUG   (  246):     d28 000000000000695f  d29 0000000000000000\nI/DEBUG   (  246):     d30 0000000500000005  d31 0000000500000005\nI/DEBUG   (  246):     scr 60000012\nI/DEBUG   (  246): \nI/DEBUG   (  246): backtrace:\nI/DEBUG   (  246):     #00  pc 000046e0  /system/bin/linker\nI/DEBUG   (  246):     #01  pc 00005b6f  /system/bin/linker\nI/DEBUG   (  246):     #02  pc 0004f73b  /system/lib/libdvm.so (dvmLoadNativeCode(char const*, Object*, char**)+186)\nI/DEBUG   (  246):     #03  pc 000662bd  /system/lib/libdvm.so\nI/DEBUG   (  246):     #04  pc 000274e0  /system/lib/libdvm.so\nI/DEBUG   (  246):     #05  pc 0002be08  /system/lib/libdvm.so (dvmInterpret(Thread*, Method const*, JValue*)+180)\nI/DEBUG   (  246):     #06  pc 0005f9f5  /system/lib/libdvm.so (dvmCallMethodV(Thread*, Method const*, Object*, bool, JValue*, std::__va_list)+272)\nI/DEBUG   (  246):     #07  pc 0005fa1f  /system/lib/libdvm.so (dvmCallMethod(Thread*, Method const*, Object*, JValue*, ...)+20)\nI/DEBUG   (  246):     #08  pc 000545ab  /system/lib/libdvm.so\nI/DEBUG   (  246):     #09  pc 00012ee4  /system/lib/libc.so (__thread_entry+48)\nI/DEBUG   (  246):     #10  pc 0001263c  /system/lib/libc.so (pthread_create+180)\n</code></pre>\n\n<p>The interesting thing is that if I use arm-eabi-objdump on the library, the address 1263c seems to be when it tries to do a pthread_clone:</p>\n\n<pre><code>$ arm-eabi-objdump -S /tmp/libc.so | grep 1263c\n1263c:       ebffed71        bl      dc08 &lt;__pthread_clone&gt;\n</code></pre>\n\n<p>Does anyone have any insight as to why this would not be working on 4.1.1?  Also, why does my \"Build fingerprint\" at the top of my crash log show:</p>\n\n<pre><code>Build fingerprint: 'd2uc-user 4.0.4'\n</code></pre>\n\n<p>Could this be the root issue of why it's not running on 4.1.1?  I am using the newest NDK (r8b), with android-14 as the platform with the arm-eabi-4.4.3 toolchain.</p>\n\n<p>Thanks so much for any help/guidance.</p>\n\n<p><strong>EDIT:</strong>  The majority of my crashes now seem to be happening in  ... did I lose a symbol here or something?</p>\n\n<pre><code>D/dalvikvm(11194): Trying to load lib /data/data/com.gnychis.awmon/lib/libtshark.so 0x4130fac8\nF/libc    (11194): Fatal signal 11 (SIGSEGV) at 0x5df6b01c (code=2), thread 11230 (AsyncTask #1)\nI/DEBUG   ( 7539): *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***\nI/DEBUG   ( 7539): Build fingerprint: 'd2uc-user 4.0.4 IMM76D I747UCALEM release-keys'\nI/DEBUG   ( 7539): pid: 11194, tid: 11230, name: AsyncTask #1  &gt;&gt;&gt; com.gnychis.awmon &lt;&lt;&lt;\nI/DEBUG   ( 7539): signal 11 (SIGSEGV), code 2 (SEGV_ACCERR), fault addr 5df6b01c\nI/DEBUG   ( 7539):     r0 80000000  r1 02b1b000  r2 00000005  r3 5df6b000\nI/DEBUG   ( 7539):     r4 400e8894  r5 400f0aec  r6 00000000  r7 0000002a\nI/DEBUG   ( 7539):     r8 0000002a  r9 5df6b000  sl 607ea000  fp 02b1b000\nI/DEBUG   ( 7539):     ip 00000005  sp 5d8d2cd0  lr 5ffc5fff  pc 400d26e0  cpsr 600d0030\nI/DEBUG   ( 7539):     d0  61642f617461642f  d1  672e6d6f632f6174\nI/DEBUG   ( 7539):     d2  612e73696863796e  d3  62696c2f6e6f6d77\nI/DEBUG   ( 7539):     d4  00000000000e16f0  d5  000000000000695f\nI/DEBUG   ( 7539):     d6  000000000005a6e8  d7  0000012f00000000\nI/DEBUG   ( 7539):     d8  0000000000000000  d9  0000000000000000\nI/DEBUG   ( 7539):     d10 0000000000000000  d11 0000000000000000\nI/DEBUG   ( 7539):     d12 0000000000000000  d13 0000000000000000\nI/DEBUG   ( 7539):     d14 0000000000000000  d15 0000000000000000\nI/DEBUG   ( 7539):     d16 7420676e69797254  d17 6c2064616f6c206f\nI/DEBUG   ( 7539):     d18 00000000006f7478  d19 0067002e006d006f\nI/DEBUG   ( 7539):     d20 006800630079006e  d21 0061002e00730069\nI/DEBUG   ( 7539):     d22 006e006f006d0077  d23 00620069006c002f\nI/DEBUG   ( 7539):     d24 000000000000e16f  d25 0000000000000000\nI/DEBUG   ( 7539):     d26 000000000000695f  d27 0000000000000000\nI/DEBUG   ( 7539):     d28 000000000000695f  d29 0000000000000000\nI/DEBUG   ( 7539):     d30 0000000d0000000d  d31 0000000d0000000d\nI/DEBUG   ( 7539):     scr 60000012\nI/DEBUG   ( 7539): \nI/DEBUG   ( 7539): backtrace:\nI/DEBUG   ( 7539):     #00  pc 000046e0  /system/bin/linker\nI/DEBUG   ( 7539):     #01  pc 00005b6f  /system/bin/linker\nI/DEBUG   ( 7539):     #02  pc 0004f73b  /system/lib/libdvm.so (dvmLoadNativeCode(char const*, Object*, char**)+186)\nI/DEBUG   ( 7539):     #03  pc 000662bd  /system/lib/libdvm.so\nI/DEBUG   ( 7539):     #04  pc 00027524  /system/lib/libdvm.so\nI/DEBUG   ( 7539):     #05  pc 000fedd8  &lt;unknown&gt;\n</code></pre>\n"},{"tags":["c++","multithreading","qt","console","poco-libraries"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":151,"score":1,"question_id":11985041,"title":"Console application with signals, threads and network, Qt or POCO","body":"<p>I have to develop a console application interacting with a Qt Gui via IPC. I already have a good experience with the Qt framework, I am completely new to POCO. I also need a good SQLite wrapper.</p>\n\n<p>What are the pros and cons of Qt vs Poco for my case ?</p>\n\n<p>So far, I've listed:</p>\n\n<p>Qt pros:</p>\n\n<ul>\n<li>very good documentation</li>\n<li>active community</li>\n<li>in my case, experience</li>\n<li>easy to use</li>\n<li>cross platform</li>\n<li>SQLite wrapper is nice</li>\n<li>Easy threading via signals and slots (no need of mutexes)</li>\n</ul>\n\n<p>Qt cons:</p>\n\n<ul>\n<li>lack of integration with standard C++, everything works with Qt objects (QString, etc.)</li>\n<li>Meta object compiler (MOC)</li>\n<li>New developer must learn the Qt framework to code</li>\n<li>Stick to GCC 4.2.1 on Mac instead of the latest clang shipped from now on with Mac</li>\n<li>Must inherit from QObject to use signals, threads, etc.</li>\n</ul>\n\n<p>Poco pros:</p>\n\n<ul>\n<li>easy to use ?</li>\n<li>faster for networking (Http in my case) ?</li>\n<li>No need of MOC</li>\n<li>builds with Clang seamlessly ?</li>\n<li>cross-platform</li>\n<li>easy threading ?</li>\n</ul>\n\n<p>Poco cons:</p>\n\n<ul>\n<li>lack of documentation !</li>\n<li>small community</li>\n<li>?</li>\n</ul>\n\n<p>I hope Qt5 will be usable with clang, llvm on mac ?</p>\n\n<p>I would very much appreciate your insight about this. </p>\n\n<p>Thanks.</p>\n"},{"tags":["java","multithreading","jsp","servlets","struts2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12747818,"title":"How to run a thread from struts2","body":"<p>i am developing a sturts2 webapplication, i am having a login page with username and password fields. As soon as user submitted form with values , i am validaing the login, if the user provides valid username and passoword, it is redirected to home page. While redirecting the home page, <strong>i have to call a thread in  which i sets some data in session for future use</strong>. How to do this ?</p>\n\n<p>What i did is </p>\n\n<pre><code>import com.opensymphony.xwork2.ActionContext;\n\nif( loginSuccess(userInfo) ) {\n    initializeDatas(); // calling thread after userInfo bean validated\n    // redirecting to home page\n    return HOME_PAGE;\n}\n</code></pre>\n\n<p>I have added a new class which implements runnable. </p>\n\n<pre><code>class intilalizer implements Runnable {\n    @Override\n    public void run() {\n        try {\n            System.out.println(\"Started to set values \");\n            List&lt;String&gt; iphoneSdks = new ArrayList&lt;String&gt;();\n            List&lt;String&gt; iphoneOSSdks = IosSdkUtil.getMacSdks(MacSdkType.iphoneos);\n            List&lt;String&gt; simSdks = IosSdkUtil.getMacSdks(MacSdkType.iphonesimulator);\n            List&lt;String&gt; macSdks = IosSdkUtil.getMacSdks(MacSdkType.macosx);\n            iphoneSdks.addAll(iphoneOSSdks);\n            iphoneSdks.addAll(simSdks);\n            iphoneSdks.addAll(macSdks);\n\n            ActionContext context = ActionContext.getContext();\n            System.out.println(\"context ===&gt; \" + context); // here i am getting null value\n            String httpRequest = ServletActionContext.HTTP_REQUEST;\n            System.out.println(\"httpRequest =====&gt; \" + httpRequest);\n            Object object = context.get(httpRequest);\n            System.out.println(object);\n            HttpServletRequest req = (HttpServletRequest) object;\n\n            req.setAttribute(REQ_IPHONE_SDKS, iphoneSdks);\n            req.setAttribute(REQ_IPHONE_SIMULATOR_SDKS, simSdks);\n            System.out.println(\"Value initialized@@@@\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>I am getting </p>\n\n<pre><code>java.lang.NullPointerException\n    at com.photon.phresco.framework.actions.intilalizer.run(Login.java:286)\n    at java.lang.Thread.run(Thread.java:680)\n</code></pre>\n\n<p>I am getting this error on line .</p>\n\n<pre><code>ActionContext context = ActionContext.getContext();\nSystem.out.println(\"context ===&gt; \" + context); // here i am getting null value\n</code></pre>\n"},{"tags":[".net","multithreading",".net-2.0","iasyncresult"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":44,"score":1,"question_id":12750532,"title":"What are the strengths of the IAsyncResult pattern?","body":"<p>I feel that many classes (e.g. <code>TcpClient</code>, <code>UdpClient</code>, <code>HttpListener</code>) would've been much easier to understand and use if they were event driven. And <code>IAsyncResult</code> pattern is excessively hard to implement because it opens you to all kinds of weird use cases:</p>\n\n<ol>\n<li>What if caller calls multiple Begin methods in a row?</li>\n<li>What if caller mixes Begin and regular methods?</li>\n</ol>\n\n<p>And so on. Nevertheless, Microsoft has chosen to use it in most places. Why?</p>\n\n<p><strong>Edit:</strong> Please focus the discussion on .NET 2.0 as that's what I have to work with.</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":11438170,"title":"What is the most efficient way to implement multiple threads within a thread?","body":"<p>I need help with my Uni assignment that involves threads. In the assignment, I have to implement a program that contains 4 threads, and one of those threads contains another thread. I've made a diagram below to help explain it better:</p>\n\n<p><img src=\"http://i.stack.imgur.com/sGYmb.png\" alt=\"enter image description here\"></p>\n\n<p>What would be the best/efficient way to do this? My prof gave a very limited explanation on threads, and from what I've gathered so far on the web, I would have to implement the Runnable interface, and create 4 classes from within the main program's run() method, which will probably end up in a mess because I still do not fully grasp the concept of threads in Java. If anyone can suggest a resource where I would be able to learn more, please post it here.</p>\n\n<p>Here's an example of my understanding so far:</p>\n\n<pre><code>public class MainThread implements Runnable\n{\n/**\n * The run method from the Runnable interface that\n * executes the entire program.\n */\npublic void run()\n{\n    class Controller implements Runnable\n    {\n        public void run() \n        {\n            class MiniWalker implements Runnable\n            {\n                public void run ()\n                {\n                }\n            }\n        }\n\n    }\n\n    class ObjectWalker implements Runnable\n    {\n        public void run ()\n        {   \n        }\n    }\n\n    class GroupWalker implements Runnable\n    {\n        public void run ()\n        {               \n        }\n    }\n\n    class YearWalker implements Runnable\n    {\n        public void run ()\n        {           \n        }\n    }\n}\n\n/**\n * The heart and core of this assignment.\n */ \npublic static void main(String[] args) \n{\n    (new Thread(new MainThread ())).start();\n}\n\n}\n</code></pre>\n"},{"tags":["java","multithreading","hanging"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":159,"score":0,"question_id":9600679,"title":"How to make a Java thread hang","body":"<p>I am trying to create a solution to treat hung threads due to memory leaks, locked resources in our applications. One of the main problems I am having is trying to simulate a hung thread to deal with it. Any sugestions?</p>\n\n<p>This is what I tried, but it just doesn't seem to do the job. Any thoughts?</p>\n\n<pre><code>class KillerThread extends Thread{\n\n    public KillerThread() {\n        super();\n    }\n    public KillerThread(String threadName) {\n        super(threadName);\n    }\n    public void run (){\n        System.out.println(\"Start of KillerThread \" + this.getName() );\n        if ( System.currentTimeMillis() % 2L == 0 ){\n            try {\n                sleep(Long.MAX_VALUE);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        } else {\n            for(;;);\n        }\n    }\n}\n</code></pre>\n"},{"tags":["asp.net","multithreading","iis"],"answer_count":6,"favorite_count":13,"up_vote_count":28,"down_vote_count":0,"view_count":5814,"score":28,"question_id":536681,"title":"Can I use threads to carry out long-running jobs on IIS?","body":"<p>In an ASP.Net application, the user clicks a button on the webpage and this then instantiates an object on the server through the event handler and calls a method on the object.\nThe method goes off to an external system to do stuff and this could take a while. So, what I would like to do is run that method call in another thread so I can return control to the user with \"Your request has been submitted\".\nI am reasonably happy to do this as fire-and-forget, though it would be even nicer if the user could keep polling the object for status.</p>\n\n<p>What I don't know is if IIS allows my thread to keep running, even if the user session expires.\nImagine, the user fires the event and we instantiate the object on the server and fire the method in a new thread. The user is happy with the \"Your request has been submitted\" message and closes his browser. Eventually, this users session will time out on IIS, but the thread may still be running, doing work. Will IIS allow the thread to keep running or will it kill it and dispose of the object once the user session expires?</p>\n\n<p>EDIT: From the answers and comments, I understand that the best way to do this is to move the long-running processing outside of IIS. Apart from everything else, this deals with the appdomain recycling problem. In practice, I need to get version 1 off the ground in limited time and has to work inside an existing framework, so would like to avoid the service layer, hence the desire to just fire off the thread inside IIS. In practice, \"long running\" here will only be a few minutes and the concurrency on the website will be low so it should be okay. But, next version definitely will need splitting into a separate service layer.</p>\n"},{"tags":["java","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12747487,"title":"Java chat - thread listening from server","body":"<p>I'm trying to create a simple chat that uses thread to listen for incoming messages. I have a main class that opens up a socket to a server that at the moment just sends one message. I'm having problem listening for the incoming message though, and I cannot figure out what I am doing wrong.</p>\n\n<p>This is the main class, sorry for all the GUI code, it makes it long.</p>\n\n<pre><code>package def;\n\nimport java.awt.BorderLayout;\nimport java.awt.Dimension;\nimport java.awt.EventQueue;\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.io.ObjectInputStream;\nimport java.io.ObjectOutputStream;\nimport java.io.PrintWriter;\nimport java.net.Socket;\nimport java.net.UnknownHostException;\n\nimport javax.swing.JFrame;\nimport javax.swing.JMenu;\nimport javax.swing.JMenuBar;\nimport javax.swing.JMenuItem;\nimport javax.swing.JOptionPane;\nimport javax.swing.JPanel;\nimport javax.swing.JTextArea;\nimport javax.swing.JTextField;\nimport javax.swing.UIManager;\nimport javax.swing.border.EmptyBorder;\nimport java.awt.event.ActionListener;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.KeyAdapter;\nimport java.awt.event.KeyEvent;\n\n\npublic class GUI extends JFrame {\n\n    private JPanel contentPane;\n    private JTextField textField;\n\n    private static JMenuBar menuBar;\n    private JMenu fileMenu;\n    private JMenuItem openMenu;\n    private JMenuItem exitMenu;\n\n    private Socket socket;\n    private ObjectOutputStream oos;\n    private ObjectInputStream ois;\n\n    private String ipAddress;\n\n    private JTextArea textArea;\n    private String fromServer = \"\";\n\n\n    public static void main(String[] args) {\n        EventQueue.invokeLater(new Runnable() {\n            public void run() {\n                try {\n                    UIManager.setLookAndFeel(\"com.sun.java.swing.plaf.windows.WindowsLookAndFeel\");\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                try {\n                    GUI frame = new GUI();\n                    frame.setVisible(true);\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        });\n    }\n\n    public GUI() throws IOException {\n        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        setBounds(100, 100, 450, 325);\n        contentPane = new JPanel();\n        contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));\n        contentPane.setLayout(new BorderLayout(0, 0));\n        setContentPane(contentPane);\n\n        textArea = new JTextArea();\n        contentPane.add(textArea, BorderLayout.NORTH);\n        textArea.setPreferredSize(new Dimension(0, 230));\n        textArea.setEditable(false);\n\n        textField = new JTextField();\n        textField.addKeyListener(new KeyAdapter() {\n            @Override\n            public void keyPressed(KeyEvent arg0) {\n                if(arg0.getKeyCode() ==java.awt.event.KeyEvent.VK_ENTER){\n                    // TODO\n                }\n            }\n        });\n        contentPane.add(textField, BorderLayout.SOUTH);\n        textField.setColumns(10);\n\n\n        // Create menu item\n        menuBar = new JMenuBar();\n        fileMenu = new JMenu(\"File\");\n        openMenu = new JMenuItem(\"Open chat\");\n        openMenu.addActionListener(new ActionListener() {\n            public void actionPerformed(ActionEvent arg0) {\n                ipAddress = JOptionPane.showInputDialog(\"Ange IP-address: \");\n                try {\n                    openSocket(ipAddress);\n                } catch (UnknownHostException e) {\n                    e.printStackTrace();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        });\n\n        exitMenu = new JMenuItem(\"Exit\");\n        exitMenu.addActionListener(new ActionListener() {\n            public void actionPerformed(ActionEvent e) {\n                System.exit(0);\n            }\n        });\n        fileMenu.add(openMenu);\n        fileMenu.add(exitMenu);\n        menuBar.add(fileMenu);\n\n        setJMenuBar(menuBar); //Add the menubar\n        setVisible(true);\n    }\n\n    //Open a socket to the server\n    private void openSocket(String ipAddress) throws UnknownHostException, IOException {\n        socket = new Socket(ipAddress, 1337);\n        new ListenIncoming(socket, this).start();\n        System.out.println(\"Socket and thread started!\");\n    }\n\n    public void setMessage(String message){\n        textArea.setText(message);\n    }\n}\n</code></pre>\n\n<p>There is an action listener for the \"Open chat\" button in the menu, where it runs the method openSocket(). In this method, found at the bottom of the code, I open a socket and starts a new ListenIncoming-thread.</p>\n\n<p>This is the thread code:</p>\n\n<pre><code>    import java.io.IOException;\nimport java.io.ObjectInputStream;\nimport java.net.Socket;\n\npublic class ListenIncoming extends Thread{\n\n    private Socket socket;\n    private ObjectInputStream ois;\n    private GUI gui;\n\n\n    public ListenIncoming(Socket socket, GUI gui){\n        this.socket = socket;\n        this.gui = gui;\n    }\n\n\n    @Override\n    public void run() {\n        try {\n            ois = new ObjectInputStream(socket.getInputStream());\n        } catch (IOException e1) {\n            e1.printStackTrace();\n        }\n\n        //A loop that runs forever\n        while(true){\n            try {\n                String fromServer = ois.readObject().toString();\n                System.out.println(fromServer);\n                gui.setMessage(fromServer);\n            } catch (IOException e) {\n                e.printStackTrace();\n            } catch (ClassNotFoundException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This is the server that sends one message. I expected to receive the message \"Connected\" but I get nothing, no error nor exception. I don't know where my code is wrong.</p>\n\n<pre><code>public class Server {\n\n    private static Scanner in;\n    private static String toSend;\n\n    public static void main(String[] args) throws IOException {\n        toSend = \"\";\n        int port = 1337;\n        in = new Scanner(System.in);\n\n\n        ServerSocket serverSocket = null;\n        try {\n            serverSocket = new ServerSocket(port);\n        } catch (IOException e) {\n            System.err.println(\"Could not listen on port: \" + port);\n            System.exit(1);\n        }\n\n        Socket clientSocket = null;\n        try {\n            clientSocket = serverSocket.accept();\n        } catch (IOException e) {\n            System.err.println(\"Could not connect.\");\n            System.exit(1);\n        }\n\n        ObjectOutputStream oos = new ObjectOutputStream(clientSocket.getOutputStream());\n        ObjectInputStream ois = new ObjectInputStream(clientSocket.getInputStream());\n        String input, output;\n\n        output = \"Connected!\\n\";\n        oos.writeObject(output);\n        System.out.println(\"This code is reached?\");\n\n        oos.close();\n        ois.close();\n        clientSocket.close();\n        serverSocket.close();\n    }\n}\n</code></pre>\n\n<p>I get the printout from the GUI class when I run the program, though I don't get the debug out prints from the Server class. I'm using Eclipse, but shouldn't both classes be able to write to the console? How come I never reach that code? The problem seem to be at the server side, but wouldn't it generate some error on the client side when trying to read?</p>\n\n<p>Thanks for all the tips and inputs I can get on this!</p>\n"},{"tags":["multithreading","corba"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":98,"score":3,"question_id":12562559,"title":"Multithreaded Corba Client","body":"<p>There is a lot on multithreading on the Corba server side, but I'm interested about the <strong>client side</strong>. We have a multithreaded client (Solaris, Orbix 6.3) with a Corba singleton \"manager\" that initialises the ORB. During runtime 'lsof' shows only one TCP connection to the Corba server, so all synchronous calls made from the client worker threads should be serialised.</p>\n\n<p>Would like to change this arrangement to take advantage of parallelism: each thread to manage its own connection. I've changed the setup so that instead of a singleton each worker thread calls ORB_init(), etc.</p>\n\n<p>Totally puzzled now: 'lsof' shows now 2 TCP connections but there are 6 worker threads.\nSomething is not right, would have expected as many TCP connections as the number of worker threads. May be that the approach is naive - does it makes sense for example to call ORB_init() per thread?</p>\n\n<p>I'd need someones opinion on this. Sample code for a multithreaded <strong>client</strong> would greatly help. Again, using Orbix 6.3 on Solaris.</p>\n\n<p>Kind regards,</p>\n\n<p>Adrian</p>\n"},{"tags":["c#","multithreading","dictionary",".net-3.5"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12748275,"title":"How to recreate \"Index was outside the bounds of the array\" adding items to Dictionary?","body":"<p>I'm consistenlty getting this error on a multithreading .net 3.5 application</p>\n\n<blockquote>\n  <p>ERROR 26 Exception thrown. Details: 'System.IndexOutOfRangeException: Index was outside the bounds \n  of the array.</p>\n  \n  <p>at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)</p>\n  \n  <p>at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)</p>\n</blockquote>\n\n<p>I think I know how to fix it (adding locks where appropiate) but I'd like to be able to recreate this problem on my local environment so I'll be sure that I fixed it and also I be able to add a unit test for it.</p>\n\n<p>Do you know any consistent way to recreate this?</p>\n"},{"tags":["c#","multithreading","iframe","domdocument","mshtml"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12746326,"title":"Getting an iframe document object via c#","body":"<p>I have this code snippet that needs to retrieve the document object of an iframe and save it in an object. </p>\n\n<pre><code>//just a wrapper object to store the document object   \nDocObj obj = new DocObj(HtmlDoc);\n\nManualResetEvent aDoneEvents = new ManualResetEvent(false);\nstring errorMessage = \"\";\nThread aThread = new Thread(() =&gt;\n{\n    try\n    {\n        //finding the iframe element in the current document\n        IHTMLElement IElem = LocatorBuilder.GetLocator(Target)\n                   .Find(this.HTMLDoc);\n\n        obj.HTMLDoc = (IElem as HTMLIFrame).document as HTMLDocument;\n\n    }\n    catch (Exception e)\n    {\n        errorMessage = e.Message;\n    }\n    aDoneEvents.Set();\n});\n\naThread.SetApartmentState(ApartmentState.STA);\naThread.IsBackground = true;\naThread.Start();\naDoneEvents.WaitOne();\nif (errorMessage != \"\")\n{\n    throw new Exception(errorMessage);\n}\nHtmlDoc = obj.HTMLDoc;\n</code></pre>\n\n<p>But when I try to retrieve the new  document object I get this exception on the last line:</p>\n\n<blockquote>\n  <p>Function evaluation disabled because a previous function evaluation\n  timed out. You must continue execution to reenable function evaluation</p>\n</blockquote>\n"},{"tags":["c++","windows","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12744324,"title":"How to detach a thread on Windows C++","body":"<p>How to detach a thread on windows in <code>C++</code>. On <code>Posix</code> we have <code>pthread_detach(pthread_self());</code>. How to achieve this in windows enviornment.</p>\n"},{"tags":["java","multithreading","swing","swingworker"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12744631,"title":"Threading with Java Swing","body":"<p>I have a swing worker which configures a serial port connection. This process takes an indeterminable time to complete, sometimes 1 minute sometimes a lot more.</p>\n\n<p>My problem arises when users click a button that needs configuration data whilst the worker thread is still configuring.</p>\n\n<p>I would like to know how to execute a user's request only if the worker thread has completed. Else if worker thread in still alive, I want execution to wait until worker thread has finished.</p>\n"},{"tags":["java","multithreading","jsf","weblogic"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12742748,"title":"Weblogic Stuck Thread on native method, RNI.initializeClass","body":"<p>We are using Weblogic 10.3.2 with jrockit 1.6 64 bit, our application is using jboss seam framework.. Number of stuck threads are increasing steadily. These stuck threads are just waiting , they are not spending any cpu cycle . All stuck thread's stack traces are same, their status are native_waiting. </p>\n\n<p>Last java method call is   <code>com/sun/faces/application/ViewHandlerImpl.renderView(ViewHandlerImpl.java:186)</code>.  And here is the source code of 186th line of ViewHandlerImpl class ;</p>\n\n<pre><code>  WriteBehindStateWriter stateWriter =\n          new WriteBehindStateWriter(response.getWriter(),\n                                     context,\n                                     bufSize);\n</code></pre>\n\n<p>Full stack trace is attached to this email. Here is the  stack traces of some stuck threads ;</p>\n\n<pre><code>\"[STUCK] ExecuteThread: '29' for queue: 'weblogic.kernel.Default (self-tuning)'\" id=127 idx=0x230 tid=6974 prio=1 alive, native_waiting, daemon\n    at pthread_cond_wait@@GLIBC_2.3.2+185(:0)@0x3820a0aee9\n    at eventTimedWaitNoTransitionImpl+71(event.c:90)@0x2b1ffc771ec8\n    at syncWaitForSignalNoTransition+65(synchronization.c:28)@0x2b1ffc904312\n    at innerNativeDoWait+1112(nativelock.c:614)@0x2b1ffc893f99\n    at nativeWait+54(nativelock.c:721)@0x2b1ffc8942a7\n    at clsEnsureInitialized+378(class.c:222)@0x2b1ffc72c61b\n    at RJNI_jrockit_vm_RNI_initializeClass+19(trampoline.c:106)@0x2b1ffc90aba4\n    at jrockit/vm/RNI.initializeClass(J)V(Native Method)\n    at com/sun/faces/application/ViewHandlerImpl.renderView(ViewHandlerImpl.java:186)\n    at org/jboss/seam/jsf/SeamViewHandler.renderView(SeamViewHandler.java:87)\n    at com/sun/facelets/FaceletViewHandler.renderView(FaceletViewHandler.java:547)[optimized]\n    at org/ajax4jsf/application/ViewHandlerWrapper.renderView(ViewHandlerWrapper.java:100)[inlined]\n    at org/ajax4jsf/application/AjaxViewHandler.renderView(AjaxViewHandler.java:176)[optimized]\n    at com/sun/faces/lifecycle/RenderResponsePhase.execute(RenderResponsePhase.java:109)[optimized]\n    at com/sun/faces/lifecycle/Phase.doPhase(Phase.java:100)[optimized]\n\n\n\n\"[STUCK] ExecuteThread: '28' for queue: 'weblogic.kernel.Default (self-tuning)'\" id=126 idx=0x22c tid=6973 prio=1 alive, native_waiting, daemon\n    at pthread_cond_wait@@GLIBC_2.3.2+185(:0)@0x3820a0aee9\n    at eventTimedWaitNoTransitionImpl+71(event.c:90)@0x2b1ffc771ec8\n    at syncWaitForSignalNoTransition+65(synchronization.c:28)@0x2b1ffc904312\n    at innerNativeDoWait+1112(nativelock.c:614)@0x2b1ffc893f99\n    at nativeWait+54(nativelock.c:721)@0x2b1ffc8942a7\n    at clsEnsureInitialized+378(class.c:222)@0x2b1ffc72c61b\n    at RJNI_jrockit_vm_RNI_initializeClass+19(trampoline.c:106)@0x2b1ffc90aba4\n    at jrockit/vm/RNI.initializeClass(J)V(Native Method)\n    at com/sun/faces/application/ViewHandlerImpl.renderView(ViewHandlerImpl.java:186)\n    at org/jboss/seam/jsf/SeamViewHandler.renderView(SeamViewHandler.java:87)\n    at com/sun/facelets/FaceletViewHandler.renderView(FaceletViewHandler.java:547)[optimized]\n    at org/ajax4jsf/application/ViewHandlerWrapper.renderView(ViewHandlerWrapper.java:100)[inlined]\n    at org/ajax4jsf/application/AjaxViewHandler.renderView(AjaxViewHandler.java:176)[optimized]\n    at com/sun/faces/lifecycle/RenderResponsePhase.execute(RenderResponsePhase.java:109)[optimized]\n    at com/sun/faces/lifecycle/Phase.doPhase(Phase.java:100)[optimized]\n    at com/sun/faces/lifecycle/LifecycleImpl.render(LifecycleImpl.java:139)[optimized]\n    at javax/faces/webapp/FacesServlet.service(FacesServlet.java:266)[optimized]\n    at weblogic/servlet/internal/StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:227)[optimized]\n    at weblogic/servlet/internal/StubSecurityHelper.invokeServlet(StubSecurityHelper.java:125)[inlined]\n    at weblogic/servlet/internal/ServletStubImpl.execute(ServletStubImpl.java:292)[optimized]\n</code></pre>\n\n<p>Do you have any idea why these threads are waiting?...</p>\n"},{"tags":["android","multithreading","user-interface","activity","android-asynctask"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12735393,"title":"Showing Dialog in the current Activity","body":"<p>I'm writing a game. When user ends level, these things happen:</p>\n\n<ol>\n<li>Send a POST, to check if the level record was beaten. (1-5 seconds)</li>\n<li>If it was so, show a <code>Dialog</code> \"enter your name\". (fast)</li>\n<li>When user clicks OK, send a POST with his record. (1-5 seconds)</li>\n</ol>\n\n<p>When user ends level he is in the <code>GameActivity</code>. <code>checkWorldRecord()</code> is called, and in it, an <code>AsyncTask</code> is started:</p>\n\n<pre><code>private void checkWorldRecord(final RecordType recordType, final double time, final int level)\n{\n    new Handler(Looper.getMainLooper()).post(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            new DownloadTask(recordType, time, level).execute();\n        }\n    });\n}\n</code></pre>\n\n<p><code>DownloadTask</code> is doing these 3 things, which I listed at the beginning:</p>\n\n<pre><code>class DownloadTask extends AsyncTask&lt;Void, Void, Void&gt;\n{\n    RecordType recordType;\n    double time;\n    int level;\n\n    public DownloadTask(RecordType recordType, double time, int level)\n    {\n        super();\n        this.recordType = recordType;\n        this.time = time;\n        this.level = level;\n    }\n\n    @Override\n    protected Void doInBackground(Void... params)\n    {\n        try\n        {\n            if (!Network.isWorldRecord(recordType, time, level)) // 1.\n            {\n                return null;\n            }\n        }\n        catch (Exception e)\n        {\n            return null;\n        }\n        Dialogs.showEnterNameAndSend(GameActivity.this, recordType, time, level, highScores.getGamesPlayed(),\n                highScores.getStars()); // 2.\n        return null;\n    }\n}\n</code></pre>\n\n<p>Everything is fine, when the user waits after the game, if he stays in the <code>GameActivity</code>. </p>\n\n<p><strong>The problem is, when:</strong></p>\n\n<ol>\n<li>User ended the game. <code>checkWorldRecord()</code> is called.</li>\n<li>In separate thread the 1st POST starts.</li>\n<li>User presses back button and changes activity to another, to <code>MainActivity</code>.</li>\n<li><code>AsyncTask</code> finished checking, we have new record. <code>showEnterNameAndSend()</code> wants to first build and later display <code>AlertDialog</code>. BOOM. Because we were passing <code>GameActivity</code>, and now <code>MainActivity</code> is on the top:</li>\n</ol>\n\n<hr>\n\n<pre><code>public static void showEnterNameAndSend(final Activity activity, final RecordType recordType, final double time,\n        final int level, final long gamesPlayed, final int stars)\n{\n    AlertDialog.Builder builder = new AlertDialog.Builder(activity); // BOOM!!!\n    final EditText editText = new EditText(activity);\n    editText.setFilters(new InputFilter[]\n    { new InputFilter.LengthFilter(Const.MAX_NAME_LENGTH) });\n    editText.setInputType(InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS);\n    builder.setView(editText);\n    builder.setTitle(recordType + \" world record!\");\n    builder.setMessage(\"Enter your name:\");\n    builder.setPositiveButton(\"Ok\", new DialogInterface.OnClickListener()\n    {\n        @Override\n        public void onClick(DialogInterface dialog, int whichButton)\n        {\n            String username = editText.getText().toString();\n            if (username.equals(\"\"))\n            {\n                return;\n            }\n\n            try\n            {\n                Network.sendRecord(recordType, username, time, level, gamesPlayed, stars); // 3.\n            }\n            catch (Exception e)\n            {\n                showInternetError(activity);\n            }\n        }\n    });\n    showDialogOnUiThread(activity, builder);\n}\n\nprivate static void showDialogOnUiThread(Activity activity, final AlertDialog.Builder builder)\n{\n    activity.runOnUiThread(new Runnable()\n    {\n        @Override\n        public void run()\n        {\n            builder.show();\n        }\n    });\n}\n</code></pre>\n\n<p>Yes, I also prefer passing <code>Context</code>, instead of whole <code>Activity</code> to <code>showEnterNameAndSend()</code>. But, <code>showDialogOnUiThread()</code> (which is called by <code>showEnterNameAndSend()</code>) requires <code>Activity</code>, to show the <code>Dialog</code> on UI thread, with <code>activity.runOnUiThread()</code>.</p>\n\n<p><strong>How to repair this?</strong> Maybe for example there is some method <code>getCurrentActivity()</code>, so I don't have to pass an <code>Activity</code>, which can be already hidden? If I can somehow cancel showing the dialog, after the user closes <code>GameActivity</code>, it will be also fine.</p>\n"},{"tags":["c#","multithreading","events"],"answer_count":10,"favorite_count":19,"up_vote_count":37,"down_vote_count":0,"view_count":23721,"score":37,"question_id":22356,"title":"Cleanest Way to Invoke Cross-Thread Events","body":"<p>I find that the .NET event model is such that I'll often be raising an event on one thread and listening for it on another thread.  I was wondering what the cleanest way to marshal an event from a background thread onto my UI thread is.</p>\n\n<p>Based on the community suggestions, I've used this:</p>\n\n<pre><code>// earlier in the code\nmCoolObject.CoolEvent+= \n           new CoolObjectEventHandler(mCoolObject_CoolEvent);\n// then\nprivate void mCoolObject_CoolEvent(object sender, CoolObjectEventArgs args)\n{\n    if (InvokeRequired)\n    {\n        CoolObjectEventHandler cb =\n            new CoolObjectEventHandler(\n                mCoolObject_CoolEvent);\n        Invoke(cb, new object[] { sender, args });\n        return;\n    }\n    // do the dirty work of my method here\n}\n</code></pre>\n"},{"tags":["ruby-on-rails-3","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12741539,"title":"Accessing Database within new Threads in Ruby, Rails 3","body":"<p>My problem: Threads created do not seem to have access to the database. The following should have worked, but doesn't. </p>\n\n<p>Note: They are in a Rake task!</p>\n\n<p>Any idea what is going on and how to make it work?</p>\n\n<pre><code>existing_result = Result.new    \nexisting_result.period = args.period    \nexisting_result.save\n\nconsolidate_orders(existing_result)\n\n['COMPANY A', 'COMPANY B', 'COMPANY C'].each do |company|\n  Thread.new(existing_result, company) do |existing_result, company|\n    ActiveRecord::Base.connection_pool.with_connection do\n      generate_summary(existing_result, company)\n    end\n  end\nend\n</code></pre>\n\n<p>It does not work even with <code>config.threadsafe!</code> set to true. </p>\n\n<p>p.s. I know of Sidekiq and Resque, but trying not to go there yet, seems overkill as I just want a little optimization.</p>\n"},{"tags":["java","multithreading","spring-batch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12725301,"title":"How to scale Hibernate Readers?","body":"<p>I am trying to scale up a rather simple Springbatch tasklet.\nHere is the situation:</p>\n\n<ul>\n<li>HibernatePagingItemReader</li>\n<li>Custom processor: perform a webservice query based on data from HibernatePagingItemReader</li>\n<li>Custom writer</li>\n</ul>\n\n<p>The bottleneck is my processor, because webservice query is slow, and it can be easly parrellelized.</p>\n\n<p>I added a task-executor (org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor) on my tasklet, but it does not scale linearly: Above 5 threads, the total execution time is the same.</p>\n\n<p>Spring docs says that readers are not off-the-shelf scalable, but my needs are much simpler.\nEvery record fetched by the reader is indepedant, so I could execute readers in parrallel.</p>\n\n<p>My Questions are:</p>\n\n<ul>\n<li>How readers are executed in a multi-threaded context? Are they parrallelized, or do they distribut data to parrallelized readers?</li>\n<li>If readers are parrallelized, I would think that I should have smaller amount of records (setting maxItemCount) to distribute these records to processors</li>\n</ul>\n\n<p>Any other ideas to scale up that?</p>\n"},{"tags":["java","android","multithreading","onclicklistener"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12566133,"title":"onClickListener not get called second time Android","body":"<p>I'm doing paypal payment for that i have to run thread in onCreate() method which initializes Button with Paypal image i'm calling one function from it which validates above fields then fires an API, if user oes wrong Toast is appeared that \" ... this filed not be blanck.\" but after this when i correct that field and again click on Btn then it does nothing.</p>\n\n<pre><code>Thread libraryInitializationThread = new Thread() {\n            public void run() {\n\n\n                initLibrary();\n\n                // The library is initialised so let's create our CheckoutButton\n                // and update the UI.\n                if (PayPal.getInstance().isLibraryInitialized()) {\n\n                    runOnUiThread(new Runnable() {\n                        public void run() {\n                            /**\n                             * Create our CheckoutButton and update the UI.\n                             */\n                            PayPal pp = PayPal.getInstance();\n\n                            /**\n                             * Get the CheckoutButton. There are five\n                             * differentsizes. The text on the button can either\n                             * be of type TEXT_PAY or TEXT_DONATE.\n                             **/\n                            launchChainedPaymentBtn = pp.getCheckoutButton(\n                                    BuyDeal.this, PayPal.BUTTON_194x37,\n                                    CheckoutButton.TEXT_PAY);\n\n                            /**\n                             * You'll need to have an OnClickListener for the\n                             * CheckoutButton. For this application, MPL_Example\n                             * implements OnClickListener and we have the\n                             * onClick() method below.\n                             **/\n                            launchChainedPaymentBtn\n                                    .setOnClickListener(new OnClickListener() {\n\n                                        @Override\n                                        public void onClick(View v) {\n\n                                            // dealResponse\n                                            getDealResponseLogic();\n\n                                        }\n                                    });\n                            //\n                            BottomBtnsLinearLayout\n                                    .addView(launchChainedPaymentBtn);\n                            Log.v(\"Btn added \", \"SuccessFully...\");\n                            Flag = true;\n                        }\n                    });\n                    //\n                    //\n                    BottomBtnsLinearLayout.addView(launchChainedPaymentBtn);\n                    Log.v(\"Btn added \", \"SuccessFully...\");\n                    // }\n                    // });\n\n                    Log.i(\"Lib. initialized\", \"now...\");\n\n                    /** Calling Thread to add Btn to It! **/\n                    AddPayPalBtn.start();\n\n                } else {\n\n                    Log.i(\"Cannot Initialize Payment Btn\",\n                            \"setAPyment Btn..failed due to Lib. initialization..\");\n                }\n\n            }\n\n        };\n        libraryInitializationThread.start();\n</code></pre>\n\n<p>I called above thread in onCreate() method of my activity.</p>\n\n<p>code for dealResponseLogic() only deals with validation.</p>\n\n<p>initLibrary(); It get PayPal instance make use of internet and then set some fields of that instance.</p>\n\n<p>I know that i can call to that thread from that btn Listener code btn i'm looking for another way.</p>\n\n<p>Please... any help will be appreciated...  </p>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12742156,"title":"IllegalMonitorStateException injava","body":"<p>Hi i am trying to make Multiplayer game using Java socket programming.My server is using Multithreading enviornment.The problem is that , i want when both player will connect to the server then they can proceed forword other wise not...For this reason i have use loop for run for 2 times and accepts connectons from the both clients.and in loop i have use thread object and call its wait method ..When the loop is finish i have call obj.notifyALl method so that the current thread and previous threed shoudl awake and they will start work But i  am getting this exception ...Any ideas or suggestion are welcome.....</p>\n"},{"tags":["multithreading","mutex","critical-section"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":12702521,"title":"How can I grant ownership of a mutex to a specific thread?","body":"<p>Imagine I have a mutex locked. There is unlimited number of other threads waiting to lock the mutex. When I unlock the mutex, one of those threads will be chosen to enter the critical section. However I have no control over which one. What if I want specific thread to enter the critical section?</p>\n\n<p>I am prety sure this cannot be done  using POSIX mutex, however, can I emulate the behaviour using different synchronisation object(s)?</p>\n"},{"tags":["iphone","ios","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12741519,"title":"Print 2 thread values alternatively","body":"<p>I have two set of values in my two threads, for example, in my 1st thread i have odd numbers and in 2nd thread i have even number, but i want to print values like 1,2,3,4.....how to print the thread values alternatively???</p>\n\n<pre><code>NSThread* myThread = [[NSThread alloc] initWithTarget:self selector:@selector(myThreadMainMethod:) object:nil];\n\n[myThread setThreadPriority:1];\nNSThread* myThread2 = [[NSThread alloc] initWithTarget:self selector:@selector(myThreadMainMethod2:) object:nil];\n\n[myThread2 setThreadPriority:1];\n[myThread start];  // Actually create the thread\n\n[myThread2 start];  // Actually create the thread\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["c#",".net","multithreading","linq"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":52,"score":7,"question_id":12739448,"title":"Meaning of the underscore in WaitCallback","body":"<pre><code>ThreadPool.QueueUserWorkItem(new WaitCallback((_) =&gt; { MyMethod(param1, Param2); }), null);\n</code></pre>\n\n<p>Could you please explain the meaning of underscore (_) in the WaitCallBack constructor?</p>\n"},{"tags":["c#",".net","multithreading","web-services","windows-services"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12732469,"title":"How do I send many http requests at the same time?","body":"<p>I have an eBay account. To make updating my products easily, I created a windows service in C#. It waits (by <code>FileSystemWatcher</code>) for an xml file and once a file is appeared, a service reads it and sends requests to eBay server through their API. A file might hold about 1000-3000 rows.</p>\n\n<p>Previously I used to create <strong>12</strong> threads to make it faster. I don't know why I chose <strong>12</strong> threads,  I thought that was enough amount: not too much and not too little.</p>\n\n<p>So here is a method how I looked like before (bit dirty, <strong>12</strong> should be a constant)</p>\n\n<pre><code>private static void UpdateAsync(IEnumerable&lt;ProductInfo&gt; products)\n        {\n            ProductInfo[] productsInfo = items.ToArray();\n            Thread[] threads = new Thread[12];\n            bool sendPartialy = productsInfo .Length &gt; 12;\n            int delta = 0;\n            for (int i = 0; i &lt; productsInfo.Length; i++)\n            {\n                if (sendPartialy )\n                {\n                    if (i != 0 &amp;&amp; i % 12 == 0)\n                    {\n                        WaitForExecutedThreads(threads);\n                        delta = 12 * (i / 12);\n                    }\n                }\n\n                ProductInfo product = ProductInfo[i];\n                threads[i - delta] = new Thread(_ =&gt; product.UpdateItem(context));\n                threads[i - delta].Start();\n            }\n\n            WaitForExecutedThreads(threads);\n        }\n</code></pre>\n\n<p>Then they told me that using threads are not necessary because of <strong>only one</strong> network interface: it's narrow to allow 12 https requests be executed at the same time and thus, each of a thread will be waiting for another one.</p>\n\n<p>That's why I decided not to use multi-threading at all and just use a simple requests like that:</p>\n\n<pre><code>    var itemInfoLights = new List&lt;ItemInfoLight&gt;();\n    foreach (var p in productsInfo )\n    {\n       p.UpdateItem(context);\n    }\n</code></pre>\n\n<p>I know, it's too bad to send all request separately because each of them has their own headers, etc... That's not efficient.</p>\n\n<p>Well, what is the right approach to do that? </p>\n"},{"tags":["c","multithreading","pthreads","hardware","multiprocessing"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":107,"score":4,"question_id":12733640,"title":"Multiprocessors vs Multithreading in the context of PThreads","body":"<p>I have an application level (PThreads) question regarding choice of hardware and its impact on software development.</p>\n\n<p>I have working multi-threaded code tested well on a multi-core single CPU box.</p>\n\n<p>I am trying to decide what to purchase for my next machine:</p>\n\n<ul>\n<li>A 6-core single CPU box </li>\n<li>A 4-core dual CPU box</li>\n</ul>\n\n<p><strong>My question is, if I go for the dual CPU box, will that impact the porting of my code in a serious way?  Or can I just allocate more threads and let the OS handle the rest?</strong></p>\n\n<p>In other words, is multiprocessor programming any different from (single CPU) multithreading in the context of a PThreads application?</p>\n\n<p><em>I thought it would make no difference at this level, but when configuring a new box, I noticed that one has to buy separate memory for each CPU.  That's when I hit some cognitive dissonance.</em></p>\n\n<p><strong>More Detail Regarding the Code (for those who are interested):</strong>  I read a ton of data from disk into a huge chunk of memory (~24GB soon to be more), then I spawn my threads.  That initial chunk of memory is \"read-only\" (enforced by my own code policies) so I don't do any locking for that chunk.  I got confused as I was looking at 4-core dual CPU boxes - they seem to require separate memory.  In the context of my code, I have no idea what will happen \"under the hood\" if I allocate a bunch of extra threads.  Will the OS copy my chunk of memory from one CPU's memory bank to another?  <strong>This would impact how much memory I would have to buy (raising the cost for this configuration).</strong>  The ideal situation (cost-wise and ease-of-programming-wise) is to have the dual CPU share one large bank of memory, but if I understand correctly, this may not be possible on the new Intel dual core MOBOs (like the HP ProLiant ML350e)?</p>\n"},{"tags":["linux","multithreading","lazarus"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12733967,"title":"Threads on Lazarus Linux Ubuntu","body":"<p>I'm having problems when I run an application using threads, on windows works fine, but when I run it on Linux Ubuntu 12.04 my app crashes. </p>\n\n<p>It's a very small app just to understand threads.</p>\n\n<p>when the thread is created my app crashes. </p>\n\n<p>here si the code:</p>\n\n<pre><code>unit Unit1;\n\n{$mode objfpc}{$H+}\n\ninterface\n\nuses\n  Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, StdCtrls,\n  ComCtrls;\n\ntype\n\n  { TMyThread }\n\n  TMyThread = class(TThread)\n  private\n    fStatusText: string;\n    procedure CambiaLabel();\n  protected\n    procedure Execute; override;\n  public\n    constructor Create(CreateSuspended: boolean);\n  end;\n\n  { TForm1 }\n\n  TForm1 = class(TForm)\n    Button1: TButton;\n    Button2: TButton;\n    Label1: TLabel;\n    ProgressBar1: TProgressBar;\n    procedure Button1Click(Sender: TObject);\n    procedure Button2Click(Sender: TObject);\n\n    procedure FormCreate(Sender: TObject);\n  private\n    { private declarations }\n  public\n    { public declarations }\n     miHilo: TThread;\n  end;\n\n\nvar\n  Form1: TForm1;\n\nimplementation\n\n{$R *.lfm}\n\n{ TMyThread }\nprocedure TMyThread.CambiaLabel();\nbegin\n    Form1.Label1.Caption:=fStatusText;\n\n        Form1.ProgressBar1.StepIt;\n\n    if Form1.ProgressBar1.Position = Form1.ProgressBar1.Max then begin\n       Form1.miHilo.Terminate;\n       Form1.ProgressBar1.Position := 0;\n    end;\nend;\n\nprocedure TMyThread.Execute;\nvar\n  newStatus : string;\nbegin\n  fStatusText := 'TMyThread comenzando...';\n  fStatusText := 'TMyThread Corriendo ...';\n  while (not Terminated) and (true {any condition required}) do begin\n\n    //here goes the code of the main thread loop\n\n     Synchronize(@CambiaLabel);\n\n  end;\nend;\n\nconstructor TMyThread.Create(CreateSuspended: boolean);\nbegin\n  FreeOnTerminate := True;\n  inherited Create(CreateSuspended);\nend;\n\n{ TForm1 }\n\nprocedure TForm1.Button1Click(Sender: TObject);\n\nbegin\n\n    if miHilo &lt;&gt; nil then begin\n   ShowMessage('Ya se esta ejecutando');\n   end\n   else begin\n   miHilo := TMyThread.Create(false);\n   end;\n\nend;\n\nprocedure TForm1.Button2Click(Sender: TObject);\nbegin\n   if miHilo &lt;&gt; nil then begin\n   miHilo.Terminate;\n   ShowMessage('Hilo terminado');\n   miHilo:=nil;\n   end;\nend;\n\n\n\nprocedure TForm1.FormCreate(Sender: TObject);\nbegin\n\nend;\n\n\n\n\n\nend.\n</code></pre>\n\n<p>here the images with the error messages: <a href=\"http://i.imgur.com/KY7pW.png\" rel=\"nofollow\">error message image</a></p>\n"},{"tags":["java","multithreading","threadpool","atomic"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12738691,"title":"How to write an atomic function in Java?","body":"<p>I'm programming in Java. I have a pool of jobs (<code>BlockingQueue</code>), and some threads will monitor this pool.  When there is a new job, threads will try to take this job. The job performs some tasks, so I don't want the operating system to take the CPU for other threads when this job has not finished. This means I want my job as an atomic job.</p>\n"},{"tags":["vb.net","multithreading","sockets","tcp"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12736123,"title":"Multithreading TCP client","body":"<p>Ok some background. I am writing a TCP client which gets information from minecraft servers. </p>\n\n<p>i want to make a client which gets info from 10 servers simultaneously. So for this i have to use multithreading.</p>\n\n<p>here is the code i have so far, but it doesnt seem to work.</p>\n\n<pre><code>Imports System.Net.Sockets\nImports System.Text\nImports System.IO\n\nModule main\nPrivate socketclient As New System.Net.Sockets.TcpClient()\n\nSub Main()\n    Dim serverList() As String = _\n    {\"ag1.playeoe.com\", \"lava-craft.net\", \"play.diamcraft.com\", \"mc.ecocitycraft.com\", \"main.kingscrafters.com\", \"pvp.cursecraft.net\"}\n\n    For i = 0 To serverList.Length - 1 Step 1\n        Console.WriteLine(\"Connecting to \" &amp; serverList(i) &amp; \":\" &amp; port &amp; \"..\")\n        socketclient.BeginConnect(serverList(i), \"25565\", New AsyncCallback(AddressOf connect), socketclient)\n        Threading.Thread.Sleep(1000)\n    Next\n\n    Console.ReadLine()\n\nEnd Sub\n\nPublic Sub connect(ByVal ar As IAsyncResult)\n    If socketclient.Connected = True Then\n        Console.WriteLine(\"Connected!\")\n        Dim stream As NetworkStream = socketclient.GetStream\n        Dim sendBytes As [Byte]() = {&amp;HFE}\n        Console.WriteLine(\"Sending Data...\")\n        stream.Write(sendBytes, 0, sendBytes.Length)\n\n        'copied\n        Console.WriteLine(\"Recieving Response...\" &amp; vbNewLine)\n        Dim bytes(421) As Byte\n        stream.Read(bytes, 0, CInt(421))\n\n        'Trim Bytes\n        Dim trimbytes(bytes.Length - 3) As Byte\n        Array.Copy(bytes, 3, trimbytes, 0, bytes.Length - 3)\n\n        'Process output\n        Dim sb As New System.Text.StringBuilder\n        For i As Integer = 1 To 241 Step 2\n            If trimbytes(i) &lt;&gt; 0 Then\n                sb.Append(ChrW(BitConverter.ToInt16(trimbytes, i)))\n            End If\n        Next i\n        Dim message() As String = sb.ToString.Split(\"§\")\n\n        'Display OutPut\n        Console.WriteLine(\"----------Response Begin----------\")\n        Console.WriteLine(message(0))\n        Console.WriteLine(message(1))\n        Console.WriteLine(message(2))\n        Console.WriteLine(\"----------Response End----------\" &amp; vbNewLine &amp; vbNewLine)\n\n        socketclient.Close()\n    End If\nEnd Sub\nEnd Module\n</code></pre>\n\n<p>now this doesn't seem to work. I get only data from the first server but not the rest. When i debug it, it shows that the socket is not open for the other servers.</p>\n\n<p>here is the output \n<img src=\"http://i.stack.imgur.com/snVKV.png\" alt=\"OutPut of the program\"></p>\n"},{"tags":["java","multithreading","interrupt"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":230,"score":2,"question_id":9690792,"title":"How to interrupt a thread if it is to open socket?","body":"<p>I have tried to close the current thread that is a part of multi-threading server. \nThe thread is ready to open the socket that may be accessed by clients.</p>\n\n<p><strong>Everything works fine except when the code below is contained in while() loop.</strong></p>\n\n<blockquote>\n  <p>new ServerThread(serversocket.accept(), this.Rstr,\n  bag.numberofDatatoAcquire).start();</p>\n</blockquote>\n\n<p>Here is the code for the server:</p>\n\n<pre><code>public void run() {\n\n    System.out.println(\"This has been called \");   \n\n    try{\n\n       System.out.println(\"This has been tried\");    \n       serversocket = new ServerSocket(this.iPort);                                 \n\n       Thread thisThread = Thread.currentThread();\n\n       while(!thisThread.isInterrupted()){\n           new ServerThread(serversocket.accept(), this.Rstr, bag.numberofDatatoAcquire).start();\n           //sending socket accessed, where it will store the data and how much it will collect it.                            \n           System.out.println(\"This has been running\");                  \n           Thread.sleep(10);               \n       }           \n    }catch(InterruptedException e){\n        //why bother? it is an usual happening...lol\n    }catch(IOException ioe)\n    {\n        System.err.println(\"Can't open the socket on port\");               \n    }\n    finally{     \n       System.out.println(\"Thread is dead and ready for change\");\n    }\n}\n</code></pre>\n\n<p>And this is a part of GUI events: this works well without \"new ServerThread...\" code.</p>\n\n<pre><code>private OverWatch EW = new OverWatch(bag.iPortOrder, bag.SessionAcquisitionSavingDirectory);   \n\n....\n\nprivate void OverWatcherControl(boolean checker)\n{\n    if(checker)\n        EW.start();  \n    else\n        EW.interrupt();\n\n}\n</code></pre>\n\n<p>Since the variable bag.numberofDataToAcquire (public integer type) is supposed to be changed whenever user wants, I think I have to stop this thread and change the variable then run this thread again. Am I wrong? Or how can I interrupt this thread?</p>\n\n<p>Thanks,</p>\n"},{"tags":["java","multithreading","performance","executorservice","cyclicbarrier"],"answer_count":6,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":1508,"score":9,"question_id":2712232,"title":"What is the fastest cyclic synchronization in Java (ExecutorService vs. CyclicBarrier vs. X)?","body":"<p>Which Java synchronization construct is likely to provide the best \nperformance for a concurrent, iterative processing scenario with a\nfixed number of threads like the one outlined below? After experimenting \non my own for a while (using ExecutorService and CyclicBarrier) and\nbeing somewhat surprised by the results, I would be grateful for some \nexpert advice and maybe some new ideas. Existing questions here do \nnot seem to focus primarily on performance, hence this new one. \nThanks in advance! </p>\n\n<p>The core of the app is a simple iterative data processing algorithm,\nparallelized to the spread the computational load across 8 cores on\na Mac Pro, running OS X 10.6 and Java 1.6.0_07. The data to be processed\nis split into 8 blocks and each block is fed to a Runnable to be executed \nby one of a fixed number of threads. Parallelizing the algorithm was\nfairly straightforward, and it functionally works as desired, but\nits performance is not yet what I think it could be. The app seems\nto spend a lot of time in system calls synchronizing, so after some\nprofiling I wonder whether I selected the most appropriate\nsynchronization mechanism(s).</p>\n\n<p>A key requirement of the algorithm is that it needs to proceed in \nstages, so the threads need to sync up at the end of each stage. \nThe main thread prepares the work (very low overhead), passes it to \nthe threads, lets them work on it, then proceeds when all threads \nare done, rearranges the work (again very low overhead) and repeats \nthe cycle. The machine is dedicated to this task, Garbage Collection\nis minimized by using per-thread pools of pre-allocated items, and\nthe number of threads can be fixed (no incoming requests or the like,\njust one thread per CPU core).</p>\n\n<h2>V1 - ExecutorService</h2>\n\n<p>My first implementation used an ExecutorService with 8 worker\nthreads. The program creates 8 tasks holding the work and then\nlets them work on it, roughly like this:</p>\n\n<pre><code>// create one thread per CPU\nexecutorService = Executors.newFixedThreadPool( 8 );\n...\n// now process data in cycles\nwhile( ...) {\n    // package data into 8 work items\n    ...\n\n    // create one Callable task per work item\n    ...\n\n    // submit the Callables to the worker threads\n    executorService.invokeAll( taskList );\n}\n</code></pre>\n\n<p>This works well functionally (it does what it should), and for\nvery large work items indeed all 8 CPUs become highly loaded, as\nmuch as the processing algorithm would be expected to allow (some\nwork items will finish faster than others, then idle). However,\nas the work items become smaller (and this is not really under\nthe program's control), the user CPU load shrinks dramatically:</p>\n\n<pre><code>blocksize | system | user | cycles/sec\n256k        1.8%    85%     1.30\n64k         2.5%    77%     5.6\n16k         4%      64%     22.5\n4096        8%      56%     86\n1024       13%      38%     227\n256        17%      19%     420\n64         19%      17%     948\n16         19%      13%     1626\n</code></pre>\n\n<p>Legend:\n - block size = size of the work item (= computational steps)\n - system = system load, as shown in OS X Activity Monitor (red bar)\n - user = user load, as shown in OS X Activity Monitor (green bar)\n - cycles/sec = iterations through the main while loop, more is better</p>\n\n<p>The primary area of concern here is the high percentage of time spent\nin the system, which appears to be driven by thread synchronization\ncalls. As expected, for smaller work items, ExecutorService.invokeAll()\nwill require relatively more effort to sync up the threads\nversus the amount of work being performed in each thread. But\nsince ExecutorService is more generic than it would need to be\nfor this use case (it can queue tasks for threads if there are\nmore tasks than cores), I though maybe there would be a leaner\nsynchronization construct.</p>\n\n<h2>V2 - CyclicBarrier</h2>\n\n<p>The next implementation used a CyclicBarrier to sync up\nthe threads before receiving work and after completing it,\nroughly as follows:</p>\n\n<pre><code>main() {\n    // create the barrier\n    barrier = new CyclicBarrier( 8 + 1 );\n\n    // create Runable for thread, tell it about the barrier\n    Runnable task = new WorkerThreadRunnable( barrier );\n\n    // start the threads\n    for( int i = 0; i &lt; 8; i++ )\n    {\n        // create one thread per core\n        new Thread( task ).start();\n    }\n\n    while( ... ) {\n        // tell threads about the work\n        ...\n\n        // N threads + this will call await(), then system proceeds\n        barrier.await();\n\n        // ... now worker threads work on the work...\n\n        // wait for worker threads to finish\n        barrier.await();\n    }\n}\n\nclass WorkerThreadRunnable implements Runnable {\n    CyclicBarrier barrier;\n\n    WorkerThreadRunnable( CyclicBarrier barrier ) { this.barrier = barrier; }\n\n    public void run()\n    {\n        while( true )\n        {\n            // wait for work\n            barrier.await();\n\n            // do the work\n            ...\n\n            // wait for everyone else to finish\n            barrier.await();\n        }\n    }\n}\n</code></pre>\n\n<p>Again, this works well functionally (it does what it should),\nand for very large work items indeed all 8 CPUs become highly\nloaded, as before. However, as the work items become smaller,\nthe load still shrinks dramatically:</p>\n\n<pre><code>blocksize | system | user | cycles/sec\n256k        1.9%     85%    1.30\n64k         2.7%     78%    6.1\n16k         5.5%     52%    25\n4096        9%       29%    64\n1024       11%       15%    117\n256        12%        8%    169\n64         12%        6.5%  285\n16         12%        6%    377\n</code></pre>\n\n<p>For large work items, synchronization is negligible and the\nperformance is identical to V1. But unexpectedly, the results\nof the (highly specialized) CyclicBarrier seem MUCH WORSE than\nthose for the (generic) ExecutorService: throughput (cycles/sec)\nis only about 1/4th of V1. A preliminary conclusion would be \nthat even though this seems to be the advertised ideal use \ncase for CyclicBarrier, it performs much worse than the \ngeneric ExecutorService.</p>\n\n<h2>V3 - Wait/Notify + CyclicBarrier</h2>\n\n<p>It seemed worth a try to replace the first cyclic barrier await()\nwith a simple wait/notify mechanism:</p>\n\n<pre><code>main() {\n    // create the barrier\n    // create Runable for thread, tell it about the barrier\n    // start the threads\n\n    while( ... ) {\n        // tell threads about the work\n        // for each: workerThreadRunnable.setWorkItem( ... );\n\n        // ... now worker threads work on the work...\n\n        // wait for worker threads to finish\n        barrier.await();\n    }\n}\n\nclass WorkerThreadRunnable implements Runnable {\n    CyclicBarrier barrier;\n    @NotNull volatile private Callable&lt;Integer&gt; workItem;\n\n    WorkerThreadRunnable( CyclicBarrier barrier ) { this.barrier = barrier; this.workItem = NO_WORK; }\n\n    final protected void\n    setWorkItem( @NotNull final Callable&lt;Integer&gt; callable )\n    {\n        synchronized( this )\n        {\n            workItem = callable;\n            notify();\n        }\n    }\n\n    public void run()\n    {\n        while( true )\n        {\n            // wait for work\n            while( true )\n            {\n                synchronized( this )\n                {\n                    if( workItem != NO_WORK ) break;\n\n                    try\n                    {\n                        wait();\n                    }\n                    catch( InterruptedException e ) { e.printStackTrace(); }\n                }\n            }\n\n            // do the work\n            ...\n\n            // wait for everyone else to finish\n            barrier.await();\n        }\n    }\n}\n</code></pre>\n\n<p>Again, this works well functionally (it does what it should).</p>\n\n<pre><code>blocksize | system | user | cycles/sec\n256k        1.9%     85%    1.30\n64k         2.4%     80%    6.3\n16k         4.6%     60%    30.1\n4096        8.6%     41%    98.5\n1024       12%       23%    202\n256        14%       11.6%  299\n64         14%       10.0%  518\n16         14.8%      8.7%  679\n</code></pre>\n\n<p>The throughput for small work items is still much worse than that\nof the ExecutorService, but about 2x that of the CyclicBarrier.\nEliminating one CyclicBarrier eliminates half of the gap.</p>\n\n<h2>V4 - Busy wait instead of wait/notify</h2>\n\n<p>Since this app is the primary one running on the system and\nthe cores idle anyway if they're not busy with a work item,\nwhy not try a busy wait for work items in each thread, even if\nthat spins the CPU needlessly. The worker thread code changes\nas follows:</p>\n\n<pre><code>class WorkerThreadRunnable implements Runnable {\n    // as before\n\n    final protected void\n    setWorkItem( @NotNull final Callable&lt;Integer&gt; callable )\n    {\n        workItem = callable;\n    }\n\n    public void run()\n    {\n        while( true )\n        {\n            // busy-wait for work\n            while( true )\n            {\n                if( workItem != NO_WORK ) break;\n            }\n\n            // do the work\n            ...\n\n            // wait for everyone else to finish\n            barrier.await();\n        }\n    }\n}\n</code></pre>\n\n<p>Also works well functionally (it does what it should).</p>\n\n<pre><code>blocksize | system | user | cycles/sec\n256k        1.9%     85%    1.30\n64k         2.2%     81%    6.3\n16k         4.2%     62%     33\n4096        7.5%     40%    107\n1024       10.4%     23%    210\n256        12.0%    12.0%   310\n64         11.9%    10.2%   550\n16         12.2%     8.6%   741\n</code></pre>\n\n<p>For small work items, this increases throughput by a further\n10% over the CyclicBarrier + wait/notify variant, which is not \ninsignificant. But it is still much lower-throughput than V1 \nwith the ExecutorService.</p>\n\n<h2>V5 - ?</h2>\n\n<p>So what is the best synchronization mechanism for such a\n(presumably not uncommon) problem? I am weary of writing my\nown sync mechanism to completely replace ExecutorService\n(assuming that it is too generic and there has to be something\nthat can still be taken out to make it more efficient).\nIt is not my area of expertise and I'm concerned that I'd\nspend a lot of time debugging it (since I'm not even sure\nmy wait/notify and busy wait variants are correct) for\nuncertain gain.</p>\n\n<p>Any advice would be greatly appreciated.</p>\n"},{"tags":["java","multithreading","exception","concurrency"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12736142,"title":"Java Threads and Concurrent Modification Exception","body":"<p>I know this is a daft questions but cant work out how to fix this, I have not had much experience with using threads before.</p>\n\n<p>Below should create first of all a timer which will execute the command output.write(mylist) every 10 seconds which will simply output the contents of mylist.</p>\n\n<p>Secondly it loops through about 3 lists I have and for each them creates a thread which will continue to loop through getting the next word in the list.\nPlease note: this is stripped down version and not complete so please dont comment on the arraylist / list but rather the error itself.</p>\n\n<p>There is a concurrent modification exception happening frequently but not all the time when it tries to do output.write<br>\nI am guessing this is because one of the other threads are currently saving something to mylist? How would I go about fixing this?</p>\n\n<p>Many Thanks!</p>\n\n<pre><code>    Runnable timer = new Runnable() {\n        public void run() {\n            try {\n                while (true) {\n                    Thread.sleep(10000);\n                    output.write(mylist);\n                }\n            } catch (InterruptedException iex) {}\n        }\n    };\n    Thread timerThread = new Thread(timer);\n    timerThread.start();\n\n    for (final ValueList item : list) {\n\n        Runnable r = new Runnable() {\n            public void run() {\n                try {\n                    while (true) {\n\n                        char curr = item.getNext();\n\n                         mylist.addWord(curr);\n                    }\n                } catch (InterruptedException iex) {}\n            }\n        };\n\n        Thread thr = new Thread(r);\n        thr.start();\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","sockets","concurrency"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12735206,"title":"Atomic socket messages across multiple sockets","body":"<p>I have a couple questions about socket programming in Java.</p>\n\n<ol>\n<li><p>I have a process that needs to send one message across multiple socket connections. \nRight now I have this as follows</p>\n\n<pre><code>Socket[] connections; //Already initialized with all connections\n\nfor i=0 to connections.length - 1\n    Send Message across connection[i]; // a new PrintWriter linked to the output stream\n</code></pre>\n\n<p>Is that as atomic as this broadcast could be? Or is there potential in a concurrent environment they may not all be sent at the nearly same instant?</p></li>\n<li><p>In a concurrent environment are the output streams to socket connections (set up as a PrintWriter) already mutually exclusive? Say, two threads want to simultaneously write to the PrintWriter. Will any of the output to the stream be messed up without explicit mutual exclusion on the PrintWriter?</p></li>\n</ol>\n"},{"tags":["c++","multithreading","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12734325,"title":"Initial content of newly allocated heap memory (VS2010)","body":"<p>Below is a snippet of a simple VC++ program that is being run on Visual Studio 10 with Thread Building Blocks (open source 4.1) support.</p>\n\n<p>I compiled and ran a program from examples, and was surprised to see the output of new operator from the cout.</p>\n\n<pre><code>int main() {\n  string str[N] = { string(\"a\"), string(\"b\") };\n  for (size_t i = 2; i &lt; N; ++i) str[i] = str[i-1]+str[i-2];\n  string &amp;to_scan = str[N-1];\n  size_t num_elem = to_scan.size();\n\n  size_t *max = new size_t[num_elem];\n  size_t *pos = new size_t[num_elem];\n  cout &lt;&lt;\"*max : \" &lt;&lt; *max&lt;&lt; \", \"&lt;&lt;\"*pos :\"&lt;&lt;*pos&lt;&lt;endl;\n......\n......\n</code></pre>\n\n<p>The cout output is like one below : </p>\n\n<p>*max : 3452816845, *pos : 3452816845</p>\n\n<p><strong>What surprises me is the same values for max and pos in both cases.</strong></p>\n\n<p>Is this probably due to some overloading of new operator in the library ?</p>\n\n<p>OR</p>\n\n<p>Is this a bug to be reported ?</p>\n\n<p>OR </p>\n\n<p>Is this just a coincidence ?</p>\n"},{"tags":["java","multithreading","cpu","jrun","jstack"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12466153,"title":"jstack 100% CPU","body":"<p>So I got stuck trying to figure out why our application will occasionally consume 100% CPU.  I've read several very helpful stackovertflow post, but I think to be on the safe side I would like to get some advice...guidance... assistance...whatever.  Really what this comes down too is my inexperience looking through stack traces.  I would really appreciate if someone could point out the possible culprit here as well as show me so pointers so I can better understand this.     </p>\n\n<p>The noteworthy threads (so it would seem to me) are ones waiting for Monitors:</p>\n\n<pre>\nI get four of these threads consistently jndi-0 - jndi-4\n\n    \"jndi-0\" prio=6 tid=0x000000001113e000 nid=0x187c waiting for monitor entry [0x0000000012a9f000]\n       java.lang.Thread.State: BLOCKED (on object monitor)\n        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:388)\n        - waiting to lock  (a java.net.SocksSocketImpl)\n        at java.net.ServerSocket.implAccept(ServerSocket.java:453)\n        at java.net.ServerSocket.accept(ServerSocket.java:421)\n        at jrun.servlet.network.NetworkService.accept(NetworkService.java:356)\n        at jrun.naming.NamingNetworkService.accept(NamingNetworkService.java:115)\n        at jrun.naming.NamingNetworkService.createRunnable(NamingNetworkService.java:141)\n        at jrunx.scheduler.ThreadPool$DownstreamMetrics.createRunnable(ThreadPool.java:287)\n        at jrunx.scheduler.ThreadPool$ThreadThrottle.createRunnable(ThreadPool.java:349)\n        at jrunx.scheduler.ThreadPool$UpstreamMetrics.createRunnable(ThreadPool.java:241)\n        at jrunx.scheduler.WorkerThread.run(WorkerThread.java:62)\n       Locked ownable synchronizers:\n        - None\n</pre>\n\n<pre>\n\n    \"jrpp-298\" prio=6 tid=0x0000000014730800 nid=0xdd4 waiting for monitor entry [0x000000001cc4b000]\n       java.lang.Thread.State: BLOCKED (on object monitor)\n        at coldfusion.runtime.LocalScope.put(LocalScope.java:247)\n        - waiting to lock  (a coldfusion.runtime.VariableScope)\n        at coldfusion.runtime.NeoPageContext.SymTab_setValidatedSimpleName(NeoPageContext.java:1339)\n        at coldfusion.runtime.NeoPageContext.SymTab_setValidatedDottedName(NeoPageContext.java:1297)\n        at coldfusion.runtime.NeoPageContext.setValidatedAttribute(NeoPageContext.java:524)\n        at coldfusion.runtime.NeoPageContext.setAttribute(NeoPageContext.java:392)\n        at coldfusion.runtime.CfJspPage._set(CfJspPage.java:369)\n        at cfmathFunctions2ecfm1090027769$funcREDUCEBARBASE.runFunction(C:\\SIWEB\\cfw\\controllers\\ContentLogic\\mathFunctions.cfm:711)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:192)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2471)\n        at Statement26069.evaluate( :1)\n        at coldfusion.compiler.ExprClassLoader.evaluate(ExprClassLoader.java:143)\n        at coldfusion.runtime.CFPage.Evaluate(CFPage.java:1726)\n        at cfContentLogic2ecfc1938419849$funcEVALUATEFUNCTIONSTRING.runFunction(C:\\SIWEB\\cfw\\controllers\\ContentLogic.cfc:479)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfContentLogic2ecfc1938419849$funcFINDANDEVALUATE.runFunction(C:\\SIWEB\\cfw\\controllers\\ContentLogic.cfc:528)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.filter.SilentFilter.invoke(SilentFilter.java:47)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:192)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2471)\n        at cfContentLogic2ecfc1938419849$funcPREPAREDANSWERSBYQUESTIONIDQGID.runFunction(C:\\SIWEB\\cfw\\controllers\\ContentLogic.cfc:340)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfContentLogic2ecfc1938419849$funcPROCESSDYNAMICITEMBYQUESTIONIDQGID.runFunction(C:\\SIWEB\\cfw\\controllers\\ContentLogic.cfc:69)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:453)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:320)\n        at coldfusion.runtime.CfJspPage._invoke(CfJspPage.java:2222)\n        at cfitemPackaging2ecfm1230617345$funcPREPAREDITEMBYQUESTIONIDQGID.runFunction(C:\\SIWEB\\cfw\\controllers\\ProtectedBusinessLogic\\itemPackaging.cfm:693)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfitemPackaging2ecfm1230617345$funcPREPAREDITEMSANDPASSAGESSTRUCTBYQGID.runFunction(C:\\SIWEB\\cfw\\controllers\\ProtectedBusinessLogic\\itemPackaging.cfm:408)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfitemPackaging2ecfm1230617345$funcPREPAREDITEMSANDPASSAGESSTRUCTBYQGIDS.runFunction(C:\\SIWEB\\cfw\\controllers\\ProtectedBusinessLogic\\itemPackaging.cfm:73)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:453)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:320)\n        at coldfusion.runtime.CfJspPage._invoke(CfJspPage.java:2222)\n        at cfpracticesession2ecfm1218050444$funcPRACTICESESSION.runFunction(C:\\SIWEB\\cfw\\controllers\\Test\\practicesession.cfm:272)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at coldfusion.tagext.lang.InvokeTag.doEndTag(InvokeTag.java:432)\n        at coldfusion.runtime.CfJspPage._emptyTcfTag(CfJspPage.java:2662)\n        at cfcfml2ecfm667848367$func$INVOKE.runFunction(C:\\SIWEB\\cfw\\wheels\\global\\cfml.cfm:177)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.filter.SilentFilter.invoke(SilentFilter.java:47)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfprocessing2ecfm76711320$func$CALLACTION.runFunction(C:\\SIWEB\\cfw\\wheels\\controller\\processing.cfm:85)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.filter.SilentFilter.invoke(SilentFilter.java:47)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:463)\n        at coldfusion.runtime.CfJspPage._invokeUDF(CfJspPage.java:2436)\n        at cfprocessing2ecfm76711320$func$PROCESSACTION.runFunction(C:\\SIWEB\\cfw\\wheels\\controller\\processing.cfm:60)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.filter.SilentFilter.invoke(SilentFilter.java:47)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:192)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:448)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:308)\n        at coldfusion.runtime.CfJspPage._invoke(CfJspPage.java:2272)\n        at cfrequest2ecfm104933708$func$REQUEST.runFunction(C:\\SIWEB\\cfw\\wheels\\dispatch\\request.cfm:166)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.filter.SilentFilter.invoke(SilentFilter.java:47)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:192)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:448)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:308)\n        at coldfusion.runtime.CfJspPage._invoke(CfJspPage.java:2272)\n        at cfindex2ecfm812783003.runPage(C:\\SIWEB\\cfw\\wheels\\index.cfm:1)\n        at coldfusion.runtime.CfJspPage.invoke(CfJspPage.java:196)\n        at coldfusion.tagext.lang.IncludeTag.doStartTag(IncludeTag.java:370)\n        at coldfusion.runtime.CfJspPage._emptyTcfTag(CfJspPage.java:2661)\n        at cfrewrite2ecfm453288076.runPage(C:\\SIWEB\\cfw\\rewrite.cfm:1)\n        at coldfusion.runtime.CfJspPage.invoke(CfJspPage.java:196)\n        at coldfusion.tagext.lang.IncludeTag.doStartTag(IncludeTag.java:370)\n        at coldfusion.runtime.CfJspPage._emptyTcfTag(CfJspPage.java:2661)\n        at cfonrequest2ecfm951311187$funcONREQUEST.runFunction(C:\\SIWEB\\cfw\\wheels\\events\\onrequest.cfm:1)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:418)\n        at coldfusion.runtime.UDFMethod$ReturnTypeFilter.invoke(UDFMethod.java:360)\n        at coldfusion.runtime.UDFMethod$ArgumentCollectionFilter.invoke(UDFMethod.java:324)\n        at coldfusion.filter.FunctionAccessFilter.invoke(FunctionAccessFilter.java:59)\n        at coldfusion.runtime.UDFMethod.runFilterChain(UDFMethod.java:277)\n        at coldfusion.runtime.UDFMethod.invoke(UDFMethod.java:192)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:448)\n        at coldfusion.runtime.TemplateProxy.invoke(TemplateProxy.java:308)\n        at coldfusion.runtime.AppEventInvoker.invoke(AppEventInvoker.java:74)\n        at coldfusion.runtime.AppEventInvoker.onRequest(AppEventInvoker.java:243)\n        at coldfusion.filter.ApplicationFilter.invoke(ApplicationFilter.java:269)\n        at coldfusion.filter.RequestMonitorFilter.invoke(RequestMonitorFilter.java:48)\n        at coldfusion.filter.MonitoringFilter.invoke(MonitoringFilter.java:40)\n        at coldfusion.filter.PathFilter.invoke(PathFilter.java:86)\n        at coldfusion.filter.ExceptionFilter.invoke(ExceptionFilter.java:70)\n        at coldfusion.filter.ClientScopePersistenceFilter.invoke(ClientScopePersistenceFilter.java:28)\n        at coldfusion.filter.BrowserFilter.invoke(BrowserFilter.java:38)\n        at coldfusion.filter.NoCacheFilter.invoke(NoCacheFilter.java:46)\n        at coldfusion.filter.GlobalsFilter.invoke(GlobalsFilter.java:38)\n        at coldfusion.filter.DatasourceFilter.invoke(DatasourceFilter.java:22)\n        at coldfusion.filter.RequestThrottleFilter.invoke(RequestThrottleFilter.java:126)\n        at coldfusion.CfmServlet.service(CfmServlet.java:175)\n        at coldfusion.bootstrap.BootstrapServlet.service(BootstrapServlet.java:89)\n        at jrun.servlet.FilterChain.doFilter(FilterChain.java:86)\n        at com.intergral.fusionreactor.filter.FusionReactorFilter.k(FusionReactorFilter.java:636)\n        at com.intergral.fusionreactor.filter.FusionReactorFilter.d(FusionReactorFilter.java:266)\n        at com.intergral.fusionreactor.filter.FusionReactorFilter.doFilter(FusionReactorFilter.java:171)\n        at jrun.servlet.FilterChain.doFilter(FilterChain.java:94)\n        at coldfusion.monitor.event.MonitoringServletFilter.doFilter(MonitoringServletFilter.java:42)\n        at coldfusion.bootstrap.BootstrapFilter.doFilter(BootstrapFilter.java:46)\n        at jrun.servlet.FilterChain.doFilter(FilterChain.java:94)\n        at jrun.servlet.FilterChain.service(FilterChain.java:101)\n        at jrun.servlet.ServletInvoker.invoke(ServletInvoker.java:106)\n        at jrun.servlet.JRunInvokerChain.invokeNext(JRunInvokerChain.java:42)\n        at jrun.servlet.JRunRequestDispatcher.invoke(JRunRequestDispatcher.java:286)\n        at jrun.servlet.ServletEngineService.dispatch(ServletEngineService.java:543)\n        at jrun.servlet.jrpp.JRunProxyService.invokeRunnable(JRunProxyService.java:203)\n        at jrunx.scheduler.ThreadPool$DownstreamMetrics.invokeRunnable(ThreadPool.java:320)\n        at jrunx.scheduler.ThreadPool$ThreadThrottle.invokeRunnable(ThreadPool.java:428)\n        at jrunx.scheduler.ThreadPool$UpstreamMetrics.invokeRunnable(ThreadPool.java:266)\n        at jrunx.scheduler.WorkerThread.run(WorkerThread.java:66)\n       Locked ownable synchronizers:\n        - None\n\n</pre>\n\n<pre>\n\n    Trace Time:   10:50:51.504 18-Sep-2012Thread ID:    0x19 (25)Thread Name:  jndi-3Priority:     5Hashcode:     290417686State:        RUNNABLE\"jndi-3\" prio=5 runnablejava.net.PlainSocketImpl.socketAccept(PlainSocketImpl.java:???)[Native Method]java.net.PlainSocketImpl.accept(PlainSocketImpl.java:390)java.net.ServerSocket.implAccept(ServerSocket.java:453)java.net.ServerSocket.accept(ServerSocket.java:421)jrun.servlet.network.NetworkService.accept(NetworkService.java:356)jrun.naming.NamingNetworkService.accept(NamingNetworkService.java:115)jrun.naming.NamingNetworkService.createRunnable(NamingNetworkService.java:141)jrunx.scheduler.ThreadPool$DownstreamMetrics.createRunnable(ThreadPool.java:287)jrunx.scheduler.ThreadPool$ThreadThrottle.createRunnable(ThreadPool.java:349)jrunx.scheduler.ThreadPool$UpstreamMetrics.createRunnable(ThreadPool.java:241)jrunx.scheduler.WorkerThread.run(WorkerThread.java:62)\n\n</pre>\n"},{"tags":["multithreading","delphi","critical-section","readerwriterlockslim","readerwriterlock"],"answer_count":2,"favorite_count":3,"up_vote_count":12,"down_vote_count":2,"view_count":337,"score":10,"question_id":10378253,"title":"Faster TMultiReadExclusiveWriteSynchronizer?","body":"<p>Is there a <em>faster</em> kind of <code>TMultiReadExclusiveWriteSynchronizer</code> out there? FastCode perhaps?</p>\n\n<p>Starting with Windows Vista, Microsoft added a <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa904937%28v=vs.85%29.aspx\">Slim Reader/Writer lock</a>. It <a href=\"http://blog.delphi-jedi.net/2011/09/16/slim-readwrite-lock-the-fast-alternative-to-tmultireadexclusivewritesynchronizer/\">performs much better</a> than Delphi's <code>TMultiReadExclusiveWriteSynchronizer</code>. Unfortunately it only exists in Windows Vista and later, something which few customers actually have yet.</p>\n\n<p>Presumably the concepts in use inside a <code>Slim Reader/Writer lock</code> could be redone in native Delphi code - but has anyone done it?</p>\n\n<p>i have a situation where acquiring and releasing locks on a <code>TMultiReadExclusiveWriteSynchronizer</code> (even when there's no contention - a single thread), causes 100% overhead (the operation time doubles). i can run without locking, but then my class is no longer thread-safe.</p>\n\n<p>Is there a faster <code>TMultiReadExclusiveWriteSynchronizer</code>?</p>\n\n<p><strong>Note</strong>: If i use a <code>TCriticalSection</code> i only suffer a 2% performance hit (although critical sections are known to be fast when the <em>acquire</em> succeeds, i.e. while it's single threaded and there's no contention). The downside of a CS is that i lose the \"<em>multiple readers</em>\" capability.</p>\n\n<h2>Bonus Reading</h2>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/853316/is-critical-section-always-faster\">Is Critical Section always faster?</a></li>\n<li><a href=\"http://synopse.info/forum/viewtopic.php?id=322\">How to write fast multi-thread Delphi applications</a></li>\n</ul>\n"},{"tags":["c#","multithreading","windows-8","winrt"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":12713621,"title":"Windows 8 - Threading Error when async awaiting in For loop","body":"<p>I'm trying to load saved data in my Windows 8 app. All methods are asynchronous. When <code>await GetStoredActivitiesInFolder(groupFolder);</code> runs in the for loop for the second time I get an error because the thread is still processing the first one (I guess).</p>\n\n<p>The error (it's gone when I remove the above line of code):</p>\n\n<blockquote>\n  <p>An exception of type 'System.Runtime.InteropServices.COMException'\n  occurred in mscorlib.dll but was not handled in user code</p>\n  \n  <p>Additional information: The application called an interface that was\n  marshalled for a different thread. (Exception from HRESULT: 0x8001010E\n  (RPC_E_WRONG_THREAD))</p>\n</blockquote>\n\n<p>My code:</p>\n\n<pre><code> public async void LoadActivities()\n    {\n        StorageFolder storageFolder = ApplicationData.Current.LocalFolder;\n\n        StorageFolder activityFolder = await storageFolder.CreateFolderAsync(App.AppSettings.ActivityDirectory, CreationCollisionOption.OpenIfExists);\n\n        IReadOnlyList&lt;StorageFolder&gt; groupFolders = await activityFolder.GetFoldersAsync();\n\n        ObservableCollection&lt;ActivityDataGroup&gt; groups = new ObservableCollection&lt;ActivityDataGroup&gt;();\n\n        foreach (var groupFolder in groupFolders)\n        {\n            ActivityDataGroup group = new ActivityDataGroup();\n            group.GroupName = groupFolder.Name;\n\n            ICollection&lt;ActivityViewModel&gt;  activities = await GetStoredActivitiesInFolder(groupFolder);\n\n            foreach (var activity in activities)\n            {\n                group.Items.Add(activity);\n            }\n\n            AllGroups.Add(group);\n\n        }\n\n        this.IsDataLoaded = true;\n    }\n</code></pre>\n"},{"tags":["java","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12733997,"title":"Threaded java server only sends one file","body":"<p>I have a java server that sends files to an android client. for some reason, the server seems to be closing the socket after only one pass through, I want it to send all files then close socket, here is my server code. Thanks in advance</p>\n\n<pre><code>public void run() {\n   DataOutputStream dos = null;\n    try {\n        String path = \"/home/test\";\n        int count = 0;\n        dos = new DataOutputStream(\n                new BufferedOutputStream(socket.getOutputStream()));\n        DataInputStream dis = new DataInputStream(new BufferedInputStream(\n                socket.getInputStream()));\n\n        File[] files = new File(path).listFiles();\n        for (File file : files) {\n            String filename = file.getName();\n            String extension = filename.substring(\n                    filename.lastIndexOf(\".\") + 1, filename.length());\n            if (\"png\".equals(extension)) {\n                count += 1;\n            }\n\n        }\n        System.out.println(\"Sending \" + count + \" files\");\n        dos.writeInt(count);\n        dos.flush();\n        byte[] temp = new byte[1024];\n        int n = 0;\n        for (File file : files) {\n            String filename = file.getName();\n            String extension = filename.substring(\n                    filename.lastIndexOf(\".\") + 1, filename.length());\n            if (\"png\".equals(extension)) {\n                FileInputStream fis = new FileInputStream(file);\n                BufferedInputStream bis = new BufferedInputStream(fis);\n                byte fileContent[] = new byte[(int) file.length()];\n                bis.read(fileContent);\n                int dataLength = fileContent.length;\n                dos.writeInt(dataLength);\n                dos.flush();\n                int open = dis.readInt();\n                System.out.println(\"still open if open = 5: open = \"+open);\n                System.out.println(filename + \" is \" + dataLength\n                        + \" bytes long\");\n                while ((dataLength &gt; 0)\n                        &amp;&amp; (n = bis.read(temp, 0,\n                                (int) Math.min(temp.length, dataLength))) != -1) {\n                    dos.write(temp, 0, n);\n                    dos.flush();\n                    dataLength -= n;\n\n                }\n                System.out.println(\"Sent file \"+filename);\n                fis.close();\n                bis.close();\n\n            }\n        }\n\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n    finally\n    {   \n\n        try{\n        if (dos != null) {dos.close();}\n        } catch (Exception e) {\n\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n"},{"tags":["php","multithreading","hacks"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":7179,"score":5,"question_id":1532065,"title":"Php multithread","body":"<p>Php, isn't really made for multithread but do you have any workarround to deal with threads in php.</p>\n"},{"tags":["c#","multithreading","c#-4.0","thread-safety","monitoring"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":12729505,"title":"Waiting on multiple background threads","body":"<p>I want know when all thread has been finished in a multithread program </p>\n\n<p>without something like pooling</p>\n\n<pre><code>while(!allThreadFinished){\nthread.sleep(100);\n}\n</code></pre>\n\n<p>The solution should be used Monitor but i can't how can i approve that it's correct.\nsince the \"SomeMethod\" in the following code using network, it consume times.</p>\n\n<pre><code>public object SomeMethod(string input);\npublic object[] MultiThreadMethod(string[] inputs) {\n            var result = new object[inputs.Count()];\n            int i = 0;\n            foreach (var item in inputs) {\n                BackgroundWorker work = new BackgroundWorker();\n                work.DoWork += (sender, doWorkEventArgs) =&gt; { doWorkEventArgs.Result = SomeMethod(item); };\n                work.RunWorkerCompleted += (sender, runWorkerCompletedEventArgs) =&gt; { \n                    result[i] = runWorkerCompletedEventArgs.Result; \n                };\n                i++;\n                work.RunWorkerAsync();\n            }\n            /////////////////////////////////////////////////////////////\n            //**wait while all thread has been completed**\n            /////////////////////////////////////////////////////////////\n            return result;\n        }\n</code></pre>\n"},{"tags":["multithreading","qt","gui","pyqt"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12733636,"title":"Run arbitrary code from non-GUI thread to modify Qt GUI-managedobjects?","body":"<p>I'm using PyQt specifically but this question I'm sure applies to Qt in general.</p>\n\n<p>I'm wondering how I can execute arbitrary code on the GUI thread from within an external thread.  I.e., in my pyqt app, I have a python thread that based on certain conditions will create various components.  I prefer this \"gui code\" not to be hard coded in the Qt related code but externally located.</p>\n\n<p>The only way I know of is to use QMetaObject.invokeMethod but you need to pass a Qt-managed object as first parameter with a named slot which basically doesn't allow for \"dynamic\" or \"arbitrary\" code.</p>\n\n<p>Any ideas on how I may be able to execute arbitrary blocks of code in this fashion?</p>\n"},{"tags":["vb.net","winforms","multithreading","focus"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12733073,"title":"Get Control in Focus when loading .exe","body":"<p>I have vb.net form that opens another vb.net exe to test.  I am trying to test if a specific textbox has focus when the exe is loaded.</p>\n\n<p>My tester form loads the exe using Assembly.UnsafeLoadFrom(_path)\nIt then  runs the FormtoTest on a new thread</p>\n\n<p>I use the System.Type.GetProperty() and GetFields() functions to get all of the FormtoTest's input fields and their properties.</p>\n\n<p>I then find this textbox in the list of input fields, </p>\n\n<p>But when I call the System.Type.GetProperty(\"Focused\"), I get an error:\n\"Cross-thread operation not valid: Control 'txtID' accessed from a thread other than the thread it was created on.\"</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["android","multithreading","fatal-error"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":149,"score":1,"question_id":12709799,"title":"How to solve FATAL EXCEPTION: Thread-11","body":"<p>Now i am developing one in that useing Async Task Iam facing this Errors, Any one have idea of this.. </p>\n\n<pre><code>10-03 19:04:55.662: E/AndroidRuntime(1547): FATAL EXCEPTION: Thread-11\n10-03 19:04:55.662: E/AndroidRuntime(1547): java.lang.ExceptionInInitializerError\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at com.cc.accounts.ChatAccountsFragment.Gtalk_logInComplete(ChatAccountsFragment.java:579)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at com.cc.xmpp.GmailXmppClient.Login(GmailXmppClient.java:92)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at com.cc.accounts.ChatAccountsFragment$5.run(ChatAccountsFragment.java:482)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at java.lang.Thread.run(Thread.java:1096)\n10-03 19:04:55.662: E/AndroidRuntime(1547): Caused by: java.lang.RuntimeException: Can't create handler inside thread that has not called Looper.prepare()\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at android.os.Handler.&lt;init&gt;(Handler.java:121)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at android.os.AsyncTask$InternalHandler.&lt;init&gt;(AsyncTask.java:421)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at android.os.AsyncTask$InternalHandler.&lt;init&gt;(AsyncTask.java:421)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     at android.os.AsyncTask.&lt;clinit&gt;(AsyncTask.java:152)\n10-03 19:04:55.662: E/AndroidRuntime(1547):     ... 4 more\n</code></pre>\n\n<p>this is Async Task</p>\n\n<pre><code>public void Gtalk_logInComplete(String Uname, XMPPConnection _connection) {\n      Log.i(TAG, \"Uname\" +Uname);\n      Uname = current_username;\n      _connection = current_connection;\n      ForwardAction task = new ForwardAction(); // this is line no 579\n      task.execute();    \n}\n\nprivate class ForwardAction extends AsyncTask&lt;Void, Void, Void&gt; {          \n    private ArrayList&lt;String&gt; contactJids;\n    private GmailXmppClient Gtalk_xmpp_client;\n    private ArrayList&lt;String&gt; contactNames;\n\n    @Override\n    protected void onPreExecute() {\n        super.onPreExecute();\n        show();\n    }\n\n    protected Void doInBackground(Void... params) {\n\n //         new Thread() {\n //             public void run() {\n\n                synchronized (this.contactJids) {\n                    Roster roster = this.Gtalk_xmpp_client.getRoster();\n                    String file_name;\n                    for (RosterEntry entry : roster.getEntries()) {\n                        if (entry.getType() == ItemType.to || entry.getType() == ItemType.both) {\n\n                            this.contactJids.add(entry.getUser());\n                            this.contactNames.add(entry.getName());                         \n\n                            contact_db.open();\n                            boolean yes = contact_db.checkUsername(entry.getUser());\n                            Log.i(TAG, \"Con=\" + yes);\n                            if (!yes) {\n\n                                Bitmap buddy_img = buddyImage(entry, current_connection);\n                                if (buddy_img != null)\n                                    file_name = Store(buddy_img);\n                                else\n                                    file_name = \"\";\n                                if (entry.getName() == null)\n                                    contact_db.createContact(entry.getUser(), entry.getUser(), current_username, file_name, \"GOOGLE\");\n                                else\n                                    contact_db.createContact(entry.getName(), entry.getUser(), current_username, file_name, \"GOOGLE\");\n                            } else {\n                                Log.i(TAG, \"Con=exist\");\n                            }\n                        }\n                    }\n                } \n    //      }\n//      }.start();                      \n        contact_db.close();         \n        return null;\n    }\n\n    protected void onPostExecute(Void aVoid) {          \n        super.onPostExecute(aVoid);       \n        hide();\n    }        \n}\n</code></pre>\n"},{"tags":["java","multithreading","deadlock","named-pipes"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1946,"score":1,"question_id":4974989,"title":"Concurrent read/write of named pipe in Java (on windows)","body":"<p>I'm trying to provide communication between a C# app and a Java app on windows using named pipes with the method described by v01ver in this question: <a href=\"http://stackoverflow.com/questions/634564/how-to-open-a-windows-named-pipe-from-java\">How to open a Windows named pipe from Java?</a></p>\n\n<p>I'm running into a problem on the Java side because I have a reader thread constantly waiting for input on the pipe and when I try to write to the pipe from my main thread it gets stuck forever.</p>\n\n<pre><code>final RandomAccessFile pipe;\ntry {\n   pipe = new RandomAccessFile(\"\\\\\\\\.\\\\pipe\\\\mypipe\", \"rw\");\n}\ncatch (FileNotFoundException ex) {\n   ex.printStackTrace();\n   return;\n}\n\nThread readerThread = new Thread(new Runnable() {\n   @Override\n   public void run() {\n      String line = null;\n      try {\n         while (null != (line = pipe.readLine())) {\n            System.out.println(line);\n         }\n      }\n      catch (IOException ex) {\n         ex.printStackTrace();\n      }\n   }\n});\nreaderThread.start();\n\ntry { Thread.sleep(500); } catch (InterruptedException e) {}\n\ntry {\n   System.out.println(\"Writing a message...\");\n   pipe.write(\"Hello there.\\n\".getBytes());\n   System.out.println(\"Finished.\");\n}\ncatch (IOException ex) {\n   ex.printStackTrace();\n}\n</code></pre>\n\n<p>The output is: <pre>Writing a message...</pre>\nand then it waits forever.</p>\n\n<p>How can I write to a named pipe while waiting for input in another thread?</p>\n"},{"tags":["java","multithreading","synchronization","counter"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12731450,"title":"Java synchronized counter - what about get()?","body":"<p>It's known that simple <code>x++</code> is not an atomic operation, but in fact is read-increment-write operation. That is why it should be synchronized. But what about <code>get()</code>? I have read it should be synchronized too, but could someone explain me why? To avoid memory consistency errors by introducing <code>happens-before</code> relationship?\nWhat about a situation when <code>get()</code> is called very often by multiple threads and the value is rarely changed. Isn't <code>synchronized get()</code> slowing them down? Are there any other ways to achieve synchronization in that scenario (not using AtomicInteger)? Would <code>volatile</code> keyword work here?</p>\n\n<pre><code>public class Counter {\n    private int value;\n\n    public synchronized int get() { return value; }\n    public synchronized int increment() { return ++value; }\n    public synchronized int decrement() { return --value; }\n}\n</code></pre>\n\n<p>Thanks!</p>\n\n<p>edit:</p>\n\n<p>I would like to make myself clear. By using <code>volatile</code> I meant introducing that keyword and removing <code>synchronized</code> in <code>get()</code> method. I was wondering if it will make it thread-safe but also more efficient if many threads are reading the value and one is rarely changing it.</p>\n"},{"tags":[".net","multithreading","garbage-collection","finalizer"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12731280,"title":"Under which circumstances does GC.WaitForPendingFinalizers() block in .NET?","body":"<p>Quoting from the MSDN documentation for <a href=\"http://msdn.microsoft.com/library/system.gc.waitforpendingfinalizers.aspx\" rel=\"nofollow\">GC.WaitForPendingFinalizers()</a>:</p>\n\n<blockquote>\n  <p>The thread on which finalizers are run is unspecified, so there is no guarantee that this method will terminate. </p>\n</blockquote>\n\n<p>I don't really understand this sentence. Under which circumstances does this method not terminate? And what does this have to do with the thread the finalizer runs on? Why do they state that the thread is \"unspecified\"?</p>\n\n<p>Regarding the finalizer thread, I assume the following is correct(?):</p>\n\n<ul>\n<li>There's only <em>one</em> finalizer thread.</li>\n<li>The finalizers always run on a separate thread (i.e. never on the main thread, or any other user created thread).</li>\n</ul>\n\n<p><em>Note:</em> I can imagine this method will block when one of the finalizers blocks, but this problem exist no matter what thread is being used for the finalizers.</p>\n"},{"tags":["asp.net","ajax","multithreading","loading","webpage"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12730308,"title":"Load page then process rows in Asp.net","body":"<p>I have a webpage that is a site monitoring tool for my company. Basically, it pulls a list of 150 IP addresses from a database, and checks if the webpage loads for them. This takes about 15 minutes to load, I'd like it to load the list and go 1 by 1 and update the status with text or an icon.</p>\n\n<p>Here is my Function block, any way to thread this or help me get to what I need to get to?</p>\n\n<pre><code>Function SiteMonitorResults(ByVal WebAddress As String)\n    Try\n        'Code Example\n\n        Dim httpReq As HttpWebRequest = DirectCast(WebRequest.Create(WebAddress), HttpWebRequest)\n        httpReq.AllowAutoRedirect = False\n\n        Dim httpRes As HttpWebResponse = DirectCast(httpReq.GetResponse(), HttpWebResponse)\n        ' Close the response.\n        httpRes.Close()\n        ' Code for NotFound resources goes here.\n        If httpRes.StatusCode = HttpStatusCode.OK Then\n            Return \"Online\"\n        Else\n            Return \"Offline\"\n        End If\n    Catch ex As Exception\n        Return \"Unknown\"\n    End Try\n\nEnd Function\n</code></pre>\n"}]}
{"total":30059,"page":19,"pagesize":100,"questions":[{"tags":["c++","multithreading","events","memory","initialization"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12718196,"title":"Calling SetEvent with an invalid handle","body":"<p>I have an application where a thread calls SetEvent and another thread waits for that event. However, CreateEvent was never called.</p>\n\n<p><strong>The SetEven returns false (ERROR_INVALID_HANDLE), and the WaitForSingleObject returns WAIT_FAILED</strong></p>\n\n<p>Yesterday, we commit something apparently not related : two lines of code in the .rc removing buttons from a toolbar.</p>\n\n<p>Suddently, on realease-XP-32 the <strong>WaitForSingleObject returns WAIT_TIMEOUT</strong>. </p>\n\n<p>But I wonder :</p>\n\n<p>1- Why a commit (apparently unrelated) in the ressources did make a change in the return of the WaitForSingleObject ?</p>\n\n<p>2- When I launch the application (XP32) from Visual Studio I get a different behavior than when I launch the application directly. WaitForSingleObject() returns WAIT_FAILED instead of time out. Any idea why ?</p>\n"},{"tags":["objective-c","ios","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":83,"score":0,"question_id":12725611,"title":"Waiting for methods to finish in iOS","body":"<p>I have two classes Controller and Connector in objective c. The Controller asks the Connector to build up a connection to a webservice to get some data. The connection itself is implemented with a delegate. This delegate gets a method call if the data arrived. I set the delegate to be the Connector itself. \nMy problem is that I want the Controller to call a method on the Connector and this method immediately returns the data. This is without delegation.\nI tried out Multithreading and waiting in the Controller, but I only could find multithreading for a single method:</p>\n\n<pre><code>[NSThread detachNewThreadSelector:@selector(myMethod) toTarget:myClass withObject:nil];\n</code></pre>\n\n<p>Multithreading for a single method does not work, because the delegate method in the Connector can't be called, because the whole Connector class is not threaded. Can anyone help me how to solve this?</p>\n\n<p>EDIT: I add the code where I call the connector method (this is code from the controller):</p>\n\n<pre><code>_data = nil;\ndispatch_queue_t myQueue = dispatch_queue_create(\"my queue\", NULL);\ndispatch_async(myQueue, ^{\n    _data = [_soapConnector startRequestWithSOAPMessage:soapMessage];\n});\n\nwhile(!_data){\n    NSLog(@\"waiting\");\n}\n//data arrived successfully here so we can manipulate it\n</code></pre>\n"},{"tags":["java","xml","multithreading","string","rabbitmq"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":254,"score":0,"question_id":5456808,"title":"How can I set time for consumer side in RABBITMQ","body":"<p>This is my code and i set the true on autoDelete both queue , exchange finally publish is not sending any message to consumer several minute at this time i would like stop the consumer side automatically maybe you are not understand my sentence perfectly. </p>\n\n<p>how can i setting that ^^</p>\n\n<p>and how do I get document Object(doc) in server side</p>\n\n<pre><code> public void initConsumer() {\n  try {\n   ConnectionFactory factory = new ConnectionFactory();\n   Connection connection = factory.newConnection();\n   Channel channel = connection.createChannel();\n   channel.queueDeclare(this.queueName, this.maintain, false, this.queueAutoDelete, null);\n   channel.exchangeDeclare(this.exchangeName, this.exchangeType, this.maintain, this.exchangeAutoDelete, null);\n    channel.queueBind(this.queueName, this.exchangeName, this.routingKey);\n    QueueingConsumer consumer = new QueueingConsumer(channel);\n   channel.basicConsume(this.queueName, false, consumer);\n   while (true) {\n\n    QueueingConsumer.Delivery delivery = consumer.nextDelivery();\n\n    System.out.println(\" [x] Received \"\n      + new String(delivery.getBody()));\n\n    channel\n      .basicAck(delivery.getEnvelope().getDeliveryTag(),\n        false);\n    }\n  } catch (Exception e) {\n   System.out.println(\"Exception error at initConsumer()\");\n  }\n }\n</code></pre>\n"},{"tags":["multithreading","executorservice"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12719545,"title":"Key Based SingleThreadExecutor","body":"<p>Any implementation for a Key Based Thread Pool Executor. The idea is a Thread is dedicated for a specific key. New requests for the same Key  waits till the previous request finishes. If another request comes which evaluates to another key , it can be served by another thread</p>\n"},{"tags":["java","android","multithreading","android-mapview","marker"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12723195,"title":"How to dynamically update content (markers) on the MapView to another thread?","body":"<p>I'm interested in the problem - how it is possible to update the content (markers) on the map when they are added to the other thread. The problem lies in the fact - that I add markers to the map in the other thread, partly to avoid slowing down the user interface, because that is necessary to create a marker to analyze the database. It seems that the program works properly - but after the markers were set up, they do not check the map. In order to display them to make interaction with the card (touch or change of scale). Here's why I want to ask - is it possible to update the contents of the map by adding a marker? Initiate a change of scale in my not a good solution. I hope for your help. </p>\n\n<p>*<strong>UPDATE, BUT NOT WORK *</strong></p>\n\n<pre><code>public void onPostExecute(){                     \n                     SQLiteDatabase placeDataBase = SQLiteDatabase.openDatabase(\"/data/data/expir.java.file/databases/PlaceDataBase\",\n                            null ,\n                            0);             \n                     Cursor location_latitude = placeDataBase.query(\"AllInfo\",new String[]{\"LOCATION_LATITUDE\"}, null, null, null, null, null);\n                     location_latitude.moveToFirst();\n                     Log.d(\"CREATE CURSOR 1\", \"lat\");\n                     Cursor location_longitude = placeDataBase.query(\"AllInfo\", new String[]{\"LOCATION_LONGITUDE\"}, null, null, null, null, null);\n                     location_longitude.moveToFirst();\n                     Cursor location_name = placeDataBase.query(\"AllInfo\", new String[]{\"LOCATION_NAME\"}, null, null, null, null, null);\n                     location_name.moveToFirst();\n                     Cursor vicinity = placeDataBase.query(\"AllInfo\", new String[]{\"VICINITY\"}, null, null, null, null, null);\n                     vicinity.moveToFirst();\n                     Cursor id = placeDataBase.query(\"AllInfo\", new String[]{\"&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;\"}, null, null, null, null, null);\n                     id.moveToFirst();\n                     Log.d(\"CREATE CURSOR 2\", \"lon\");\n                     quantityPlace = location_latitude.getCount();\n                     int a = 0;\n                     for(int i=1;i&lt;=quantityPlace;i++){\n                        if((int)(location_latitude.getDouble(0)*1000000)&gt;=myLocationLatitude-(3*8998)&amp;&amp;\n                                (int)(location_latitude.getDouble(0)*1000000)&lt;=myLocationLatitude+(3*8998)&amp;&amp;\n                                (int)(location_longitude.getDouble(0)*1000000)&gt;=myLocationLongitude-(6*8998)&amp;&amp;\n                                (int)(location_longitude.getDouble(0)*1000000)&lt;=myLocationLongitude+(6*8998)){\n                            a++;\n                            Drawable drawable1 = MyMapActivity.this.getResources().getDrawable(R.drawable.scoutgroup);                      \n                            itemizedoverlay = new HelloItemizedOverlay(drawable1, MyMapActivity.this);                           ;\n                            GeoPoint point1 = new GeoPoint((int)(location_latitude.getDouble(0)*1000000), (int)(location_longitude.getDouble(0)*1000000));                                                          \n                            overlayitem = new OverlayItem(point1, location_name.getString(0), vicinity.getString(0));\n                            itemizedoverlay.addOverlay(overlayitem);\n                            mapOverlays.add(itemizedoverlay);\n                        }\n                        Log.d(\"INFO\", location_latitude.getPosition()+\"/\"+quantityPlace);\n                        location_latitude.moveToPosition(i);\n                        location_longitude.moveToPosition(i);\n                        location_name.moveToPosition(i);\n                        vicinity.moveToPosition(i);\n                        id.moveToPosition(i);\n                     }\n                     Log.d(\"On map view\", a+\" location(s)\");\n                                     mapView.invalidate();\n                     placeDataBase.close();\n                 }              \n</code></pre>\n"},{"tags":["c++","multithreading","boost-asio"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12727909,"title":"Canonical way to stop boost::asio operations","body":"<p>I have a <code>boost::asio::io_service</code> running in a thread that performs some operation:</p>\n\n<pre><code>struct clicker\n{\n    clicker(boost::asio::io_service&amp; io) : timer_(io) { wait_for_timer(); }\n\n    void stop() { timer_.cancel(); }\n\n    void wait_for_timer()\n    {\n        timer_.expires_from_now(std::chrono::milliseconds(500));\n        timer_.async_wait(std::bind(&amp;clicker::wait_completed, this, _1));\n    }\n\n    void wait_completed(const boost::system::error_code&amp; err)\n    {\n        if (!err) {\n            std::cout &lt;&lt; \"Click\" &lt;&lt; std::endl;\n            wait_for_timer();\n        }\n    }\n\n    boost::asio::steady_timer timer_;\n};\n\nint main()\n{\n    boost::asio::io_service io;\n    clicker cl(io);\n\n    std::thread io_thread(&amp;boost::asio::io_service::run, &amp;io);\n\n    while (true) { // the run loop\n        // gather input\n        if (user_clicked_stop_button()) { cl.stop(); break; }\n    }\n\n    io_thread.join();\n}\n</code></pre>\n\n<p>Now calling <code>stop()</code> should cancel waiting for the timer and fire <code>wait_completed()</code> with an error. However, we have a race condition here: at times, <code>stop()</code> will be called while <code>wait_for_timer()</code> is running and before the <code>async_wait</code> has been scheduled. Then, the code will run indefinitely.</p>\n\n<p>What's the recommended way to deal with this situation? A boolean flag inside <code>clicker</code> that is tested in <code>wait_completed</code>? A mutex?</p>\n\n<h2>Update:</h2>\n\n<p>This is just a simplified example, in the real code I have several operations running in the <code>io_service</code>, so calling <code>io_service::stop()</code> is not an option here.</p>\n"},{"tags":["java","android","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12725753,"title":"Java Thread giving strange error?","body":"<p>Sorry about the vague description, i didn't know how to explain it.</p>\n\n<p>I'm creating a thread within my Android/Java app, the code is simple enough but it keeps giving off a strange error?</p>\n\n<pre><code>final Thread buttonPress = new Thread(){ //X\n    try {\n        findViewById(R.id.button1).setBackgroundResource(R.drawable.button1_down);\n        wait(500);\n    } catch (InterruptedException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    } finally {\n        findViewById(R.id.button1).setBackgroundResource(R.drawable.button1);\n    }\n}; //XX\n</code></pre>\n\n<p>Besides where i marked /X i get the error message </p>\n\n<p>\"Multiple markers at this line\n    - Syntax error, insert \"}\" to complete ClassBody\n    - Syntax error, insert \";\" to complete LocalVariableDeclarationStatement\"</p>\n\n<p>And at the end of thread, besides the \"//XX\" i get the error message,</p>\n\n<p>\"Syntax error on token \"}\", delete this token\"</p>\n"},{"tags":["c#","multithreading","concurrency","parallel-processing"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":105,"score":7,"question_id":12725605,"title":"Variant of Dekker's algorithm confusion","body":"<p>This program execute two different threads and tell me who the winner of the \"race\" is.</p>\n\n<p>Unexpectedly sometimes BOTH threads \"wins\" (I expected someone or no one to win). Is this expected behaviour and why? I'm obviously missing something fundamental here.</p>\n\n<pre><code>class Program\n{\n    public volatile static int a = 0; \n    public volatile static int b = 0;\n\n    public static void Main()\n    {\n        for(int i = 0; i &lt; 1000; i++)\n        {\n            a = 0; \n            b = 0;\n\n            Parallel.Invoke(delegate { a = 1; if (b == 0) Console.WriteLine(\"A wins\"); },\n                            delegate { b = 1; if (a == 0) Console.WriteLine(\"B wins\"); });\n\n            Console.WriteLine(System.Environment.NewLine);\n\n            Thread.Sleep(500);\n        }\n    }\n}\n</code></pre>\n\n<p>Results:   </p>\n\n<pre><code>A wins\n\nB wins\n\nA wins\nB wins\n\nA wins\n\n...\n</code></pre>\n"},{"tags":["c#","multithreading","serial-port","backgroundworker"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12665020,"title":"Serial port worker thread freezing randomly","body":"<p>I am calling my background worker by the following code:</p>\n\n<pre><code>private void UpdateDataTimer_Tick(object sender, EventArgs e)\n{\n    if (!serialPortWorker.IsBusy)\n    {\n        serialPortWorker.RunWorkerAsync();\n    }\n}\n</code></pre>\n\n<p>My <code>DoWork</code> event is as follows:</p>\n\n<pre><code>private void serialPortWorker_DoWork(object sender, DoWorkEventArgs e)\n{\n    //Configures serial port\n    connection.BaudRate = 19200;\n    connection.DataReceived += new SerialDataReceivedEventHandler(DataReceivedEvent);\n\n    //Sends the commands for opening diagnostics\n    string[] init_commands = { \"STRING\", \"STRING\", \"STRING\", \"STRING\", \"STRING\" };\n    foreach (string command in init_commands)\n    {\n        connection.WriteLine(command + connection.NewLine);\n        Thread.Sleep(1000);\n    }\n\n    const string constant_message_section = \"G03\";\n    string[] command_list = { \"62\", \"64\", \"5C\" };\n\n    //Writes all commands to all radio addresses\n    foreach (int address in radioAddresses)\n    {\n        foreach (string command in command_list)\n        {\n            for (int i = 0; i &lt; MAX_ATTEMPTS; i++)\n            {\n                connection.WriteLine(constant_message_section + address.ToString(\"X4\") + command);\n                Thread.Sleep(500);\n            }\n        }\n    }\n\n    Thread.Sleep(1000); //Give a little time for all responses to come in\n}\n</code></pre>\n\n<p>For some reason, after a few hundred calls of the <code>UpdateDataTimer_Tick</code> event, it will not run the <code>serialPortWorker</code> any more. I put a debugger at <code>if (!serialPortWorker.IsBusy)</code>, and it indicated that the <code>serialPortWorker</code> is still busy. It must be hanging up somewhere in the <code>DoWork</code> event, right? Any ideas why?</p>\n\n<p>For those that are interested, the data received event is as follows:</p>\n\n<pre><code>public void DataReceivedEvent(object sender, SerialDataReceivedEventArgs e)\n{\n    SerialPort sp = (SerialPort)sender;\n    string receive = sp.ReadLine();\n\n    try\n    {\n        Debug.Logger.WriteToDebug(\"Data Received Serial Port: \" + receive);\n    }\n    catch { }\n\n    try\n    {\n        int unit_address = Int32.Parse(receive.Substring(1, 4), System.Globalization.NumberStyles.HexNumber);\n\n        if (radioAddresses.Contains(unit_address))\n        {\n            int radio_index = radioAddresses.IndexOf(unit_address) + 1;\n            int max_index = radio_index * 3;\n\n            integrityMonitor[radio_index] = DateTime.Now; //Last updated time\n\n            int message_data = 0;\n\n            if (receive.Contains(\"66\"))\n            {\n                //Stuff\n            }\n            else if (receive.Contains(\"61\"))\n            {\n                //Stuff\n            }\n            else if (receive.Contains(\"55\"))\n            {\n                //Stuff\n            }\n        }\n    }\n    catch { }\n}\n</code></pre>\n"},{"tags":["java","android","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12727173,"title":"Read from file in thread without delays in program work","body":"<p>How to read from file in threads without delays in program works.</p>\n\n<p>I use code bellow:</p>\n\n<p>//first part of program </p>\n\n<pre><code> Thread thread = new Thread() {\n        @Override\n    public void run() {\n       //read file\n    }\n      }\n   };\nthread.start();\n</code></pre>\n\n<p>//second code of program</p>\n\n<p>And between first and second parts of code is small program freezing, but less than the file reads without threads.</p>\n\n<p>Can I read from file without any delays?</p>\n"},{"tags":["multithreading","visual-c++","waitforsingleobject"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12724295,"title":"UI hangs when performed WaitForSingleObject in VC 6","body":"<p>I have an utility (server-client architecture). On File connect I will connect to the server and initialize thread for different PORTs(HIGHPORT, LOWPORT and MEDIUMPORT). On File exit I will disconnect from the server and Exit the application. But, the UI hangs in my utility. This issue happens if I run the application ISO image/from mounted Drive.</p>\n\n<p>I am Visual studio 6.0 with Service Pack 5 on windows XP service Pack 3.\nBelow is the code snippet of the issue. </p>\n\n<pre><code>void CMyApp::OnAppExit()\n{\n     MessageBox(\"Do you want to exit the application?\",\"My Utitlity\" MB_YESNO|MB_ICONQUESTION);\n     Disconnect(); // Disconnect from the server\n//     After this Control never returns and UI is hung\n     CWinApp::OnAppExit();\n}\n\nvoid CMyApp::Disconnect()\n{\n     m_commclass-&gt;Disconnect(); // m_commclass is an obect of CCommClas\n}\n\nvoid CCommClass::Disconnect()\n{\n    KillThreads();\n}\nvoid CCommClass::KillThreads()\n{\n    CMyThreadInfo *pThreadInfo = NULL;  \n    while(!m_ThreadInfo.IsEmpty())  \n    {\n        pThreadInfo = (CMyThreadInfo*)m_ThreadInfo.RemoveHead();\n\n        // Set the m_hEventKill object which signals the thread to shutdown\n        VERIFY(pThreadInfo-&gt;g_eventKill-&gt;SetEvent());               \n\n        // Wait for thread to terminate if it is not already exited\n        if (pThreadInfo-&gt;pThread-&gt;m_hThread != NULL)\n        {\n\n            WaitForSingleObject(pThreadInfo-&gt;pThread-&gt;m_hThread, INFINITE);\n        }\n\n        // now set CWinThread object to NULL since it is alread destroyed\n        pThreadInfo-&gt;pThread= NULL;\n\n        delete pThreadInfo;\n\n}\n</code></pre>\n\n<p>Please let me know if any solution to over come this issue.</p>\n\n<p>Thanks,\nShwetha</p>\n"},{"tags":["android","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":22,"score":-2,"question_id":12727324,"title":"thread receiving a value and a returning a value","body":"<p>i want a method in which a thread is doing process on the value received by the method.After the process in run method it should store the value so that it can be returned by the method</p>\n"},{"tags":["java","multithreading"],"answer_count":5,"favorite_count":4,"up_vote_count":30,"down_vote_count":0,"view_count":4678,"score":30,"question_id":6123024,"title":"Synchronization on the local variables","body":"<p>Today I was faced with the method <code>constructServiceUrl()</code> of the <a href=\"http://grepcode.com/file/repo1.maven.org/maven2/org.jasig.cas/cas-client-core/3.1.10/org/jasig/cas/client/util/CommonUtils.java#CommonUtils.constructServiceUrl%28javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,java.lang.String,java.lang.String,java.lang.String,boolean%29\"><code>org.jasig.cas.client.util.CommonUtils</code></a> class. I thought he was very strange:       </p>\n\n<pre><code>final StringBuffer buffer = new StringBuffer();\n\nsynchronized (buffer)\n{\n    if (!serverName.startsWith(\"https://\") &amp;&amp; !serverName.startsWith(\"http://\"))\n    {\n        buffer.append(request.isSecure() ? \"https://\" : \"http://\");\n    }\n\n    buffer.append(serverName);\n    buffer.append(request.getRequestURI());\n\n    if (CommonUtils.isNotBlank(request.getQueryString()))\n    {\n        final int location = request.getQueryString().indexOf(\n                artifactParameterName + \"=\");\n\n        if (location == 0)\n        {\n            final String returnValue = encode ? response.encodeURL(buffer.toString()) : buffer.toString();\n\n            if (LOG.isDebugEnabled())\n            {\n                LOG.debug(\"serviceUrl generated: \" + returnValue);\n            }\n\n            return returnValue;\n        }\n\n        buffer.append(\"?\");\n\n        if (location == -1)\n        {\n            buffer.append(request.getQueryString());\n        }\n        else if (location &gt; 0)\n        {\n            final int actualLocation = request.getQueryString()\n                    .indexOf(\"&amp;\" + artifactParameterName + \"=\");\n\n            if (actualLocation == -1)\n            {\n                buffer.append(request.getQueryString());\n            }\n            else if (actualLocation &gt; 0)\n            {\n                buffer.append(request.getQueryString().substring(0, actualLocation));\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Why did the author synchronizes a local variable?</p>\n"},{"tags":["java","timeout","multithreading","timer"],"answer_count":11,"favorite_count":24,"up_vote_count":39,"down_vote_count":0,"view_count":23742,"score":39,"question_id":2275443,"title":"How to timeout a thread","body":"<p>I want to run a thread for some fixed amount of time. If it is not completed within that time, I want to either kill it, throw some exception, or handle it in some way. How can it be done?</p>\n\n<p>One way of doing it as I figured out from <a href=\"http://groups.google.com.br/group/comp.lang.java.programmer/msg/0fea9dd5f0117a7f\" rel=\"nofollow\">this thread</a>\nis to use a TimerTask inside the run() method of the Thread.</p>\n\n<p>Are there any better solutions for this?</p>\n\n<p>&nbsp;<br>\nEDIT: Adding a bounty as I needed a clearer answer. The ExecutorService code given below does not address my problem. Why should I sleep() after executing (some code - I have no handle over this piece of code)? If the code is completed and the sleep() is interrupted, how can that be a timeOut?</p>\n\n<p>The task that needs to be executed is not in my control. It can be any piece of code. The problem is this piece of code might run into an infinite loop. I don't want that to happen. So, I just want to run that task in a separate thread. The parent thread has to wait till that thread finishes and needs to know the status of the task (i.e whether it timed out or some exception occured or if its a success). If the task goes into an infinite loop, my parent thread keeps on waiting indefinitely, which is not an ideal situation.</p>\n"},{"tags":["c#","multithreading","tcpclient","tcplistener"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":173,"score":1,"question_id":12725354,"title":"TcpClient/TcpListener communication problems when not on localhost (multithreaded)","body":"<p>I'm working on a project where I communicate serialized commands over TCP/IP. I have it working when I'm on local host but when I run my listener on a different server, it fails randomly when trying to deserialize commands at the listeners side.\nExceptions thrown are: 'Attempting to deserialize an empty stream.' and 'End of Stream encountered before parsing was completed.' from the serializer</p>\n\n<p>When I run a sequence of commands individually it works fine but when I create threads and runs several sequences simultaneously it fails.</p>\n\n<p>The Listener create listeners on 4 different ports and the client runs 1 thread for each port. When one of the threads reaches the end of a sequence it terminates.</p>\n\n<p>I tried to make my client singleton and also tried Mutex. But still the same problem.</p>\n\n<p>Here is my client:</p>\n\n<pre><code>public class TcpIpCommunicator : ICommunicator, IDisposable\n{\n    private Dictionary&lt;int,TcpClient&gt; clientSockets = new Dictionary&lt;int,TcpClient&gt;();\n    public IInverterCommand ReadAsyncCommand { set; get; }\n    private static TcpIpCommunicator tcpIpCommunicator;\n\n    private TcpIpCommunicator()\n    {\n    }\n\n    public static TcpIpCommunicator GetInstance()\n    {\n        if(tcpIpCommunicator == null)\n            tcpIpCommunicator = new TcpIpCommunicator();\n\n        return tcpIpCommunicator;\n    }\n\n    public void Send(IInverterCommand command, int id)\n    {\n        var serializer = new Serializer();\n        MemoryStream stream = serializer.SerializeMultipleObjects(command);\n        var _bytes = stream.GetBuffer();\n\n        var networkStream = clientSockets[id].GetStream();\n        networkStream.Write(_bytes, 0, _bytes.Length);\n        networkStream.Flush();\n    }\n\n    public IInverterCommand Read(int id)\n    {\n        var memoryStream = new MemoryStream();\n\n        byte[] buffer;\n        var networkStream = clientSockets[id].GetStream();\n        do\n        {\n            buffer = new byte[clientSockets[id].ReceiveBufferSize];\n            int sizeRead = networkStream.Read(buffer, 0, buffer.Length);\n            memoryStream.Write(buffer, 0, sizeRead);\n        } while (networkStream.DataAvailable);\n\n        networkStream.Flush();\n\n        memoryStream.Position = 0;\n        var serializer = new Serializer();\n        return serializer.DeSerializeMultipleObject(memoryStream);\n\n    }\n\n    public void ReadAsync(object id)\n    {\n        ReadAsyncCommand = Read((int)id);\n    }\n\n    public void Dispose()\n    {\n        foreach (var tcpClient in clientSockets.Values)\n        {\n            tcpClient.Close();\n        }\n    }\n\n    public int Connect(string ip, int port)\n    {\n        var tcpClient = new TcpClient();\n        tcpClient.ReceiveTimeout = int.MaxValue;\n        tcpClient.SendTimeout = int.MaxValue;\n        tcpClient.Connect(ip, port);\n        int key = findKey();\n        clientSockets.Add(key, tcpClient);\n\n        return key;\n    }\n\n    public void DestroyConnection(int id)\n    {\n        clientSockets[id].Close();\n        clientSockets.Remove(id);\n    }\n\n    private int findKey()\n    {\n        int key = 0;\n        while(clientSockets.ContainsKey(key))\n        {\n            key++;\n        }\n\n        return key;\n    }\n}\n</code></pre>\n\n<p>And my server side code is here:</p>\n\n<pre><code>public class TCPListener : IDisposable\n{\n    private readonly TcpListener _serverSocket;\n    private NetworkStream _networkStream;\n    private readonly TcpClient _clientSocket = default(TcpClient);\n\n    public TCPListener(int port)\n    {\n        _serverSocket = new TcpListener(port);\n        _serverSocket.Server.ReceiveTimeout = int.MaxValue;\n        _serverSocket.Server.SendTimeout = int.MaxValue;\n        _serverSocket.Start();\n        _clientSocket = _serverSocket.AcceptTcpClient();\n    }\n\n    public void Send(IInverterCommand message)\n    {\n        _networkStream = _clientSocket.GetStream();\n        var serialize = new Serializer();\n        var stream = serialize.SerializeMultipleObjects(message);\n        var _bytes = stream.GetBuffer();\n\n        if (_bytes.Length &gt; _clientSocket.ReceiveBufferSize)\n        {\n            byte[] bytes = new byte[_clientSocket.ReceiveBufferSize];\n            for (int i = 0; i &lt; _bytes.Length; i += _clientSocket.ReceiveBufferSize)\n            {\n                for (int j = 0; j &lt; _clientSocket.ReceiveBufferSize &amp;&amp; i + j != _bytes.Length; ++j)\n                {\n                    bytes[j] = _bytes[i + j];\n                }\n\n                _networkStream.Write(bytes, 0, _clientSocket.ReceiveBufferSize);\n            }\n        }\n        else\n        {\n            _networkStream.Write(_bytes, 0, _bytes.Length);\n        }\n\n        Thread.Sleep(50);\n\n        _networkStream.Flush();\n    }\n\n    public IInverterCommand ReadCommand()\n    {\n        _networkStream = _clientSocket.GetStream();\n        var memoryStream = new MemoryStream();\n\n        do\n        {\n            var buffer = new byte[_clientSocket.ReceiveBufferSize];\n            int sizeRead = _networkStream.Read(buffer, 0, buffer.Length);\n            memoryStream.Write(buffer, 0, sizeRead);\n            Thread.Sleep(50);\n        } while (_networkStream.DataAvailable);\n\n        _networkStream.Flush();\n        memoryStream.Position = 0;\n        var serializer = new Serializer();\n        return serializer.DeSerializeMultipleObject(memoryStream);\n    }\n\n    public void Dispose()\n    {\n        _clientSocket.Close();\n        _serverSocket.Stop();\n    }\n}\n</code></pre>\n\n<p>Here is typically calling code at client side:</p>\n\n<pre><code>IInverterCommand command = new SoftwareUpdateInverterCommand();\n        tcpClient.Send(command, tcpId);\n\n        var thread = new Thread(tcpClient.ReadAsync);\n        thread.Start(tcpId);\n\n        if (!thread.Join(timeout))\n        {\n            thread.Abort();\n            tcpClient.DestroyConnection(tcpId);\n            return;\n        }\n</code></pre>\n\n<p>And the server side calling code:</p>\n\n<pre><code>//Recieving CMD on software update\n            TcpListener = new TCPListener((int)port);\n            var command = TcpListener.ReadCommand();\n\n            //Sending OK back to server\n            command.Message = \"OK\";\n            TcpListener.Send(command);\n</code></pre>\n"},{"tags":["c#","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12725159,"title":"C# background thread property missing","body":"<p>i want to configure my Thread to be background thread, why this property missing in my Thread ?</p>\n\n<pre><code>    ThreadStart starter = delegate { openAdapterForStatistics(_device); };\n    new Thread(starter).Start();\n\npublic void openAdapterForStatistics(PacketDevice selectedOutputDevice)\n{\n    using (PacketCommunicator statCommunicator = selectedOutputDevice.Open(100, PacketDeviceOpenAttributes.Promiscuous, 1000)) //open the output adapter\n    {\n        statCommunicator.Mode = PacketCommunicatorMode.Statistics; //put the interface in statstics mode                \n        statCommunicator.ReceiveStatistics(0, statisticsHandler);\n\n    }\n}\n</code></pre>\n\n<p>i have try:</p>\n\n<pre><code>Thread thread = new Thread(openAdapterForStatistics(_device));\n</code></pre>\n\n<p>but i have got 2 compilation errors:</p>\n\n<blockquote>\n  <ol>\n  <li>The best overloaded method match for 'System.Threading.Thread.Thread(System.Threading.ThreadStart)' has some invalid arguments</li>\n  <li>Argument 1: cannot convert from 'void' to 'System.Threading.ThreadStart'</li>\n  </ol>\n</blockquote>\n\n<p>and i don't know why</p>\n"},{"tags":["multithreading","windows-phone-7","process","detect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12722335,"title":"WP7 detect thread","body":"<p>Is there any way that can detect which thread a line of code is in?</p>\n\n<p>I'm working with Background Audio Agent and I want to detect what process and thread it is in ?</p>\n"},{"tags":["c#","multithreading","locking"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12719953,"title":"Scheduling a method to run rather than lock in C#","body":"<p>I have a method (let's call it \"CheckAll\") that is called from multiple areas of my program, and can therefore be called for a 2nd time <em>before</em> the 1st time has completed.</p>\n\n<p>To get around this I have implemented a \"lock\" that (if I understand it correctly), halts the 2nd thread until the 1st thread has completed.</p>\n\n<p>However what I really want is for this 2nd call to return to the calling method immediately (rather than halt the thread), and to schedule CheckAll to be run again once it has completed the 1st time.</p>\n\n<p>I could setup a timer to do this but that seems cumbersome and difficult. Is there a better way?</p>\n"},{"tags":["java","multithreading","concurrency","scheduled-tasks","threadpool"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":90,"score":4,"question_id":12723001,"title":"Schedule periodic tasks in Java, avoid creating new threads untill necessary (like CachedThreadPool)","body":"<p>I have a number of tasks that I would like to execute periodically at different rates for most tasks. Some of the tasks may be scheduled for simultanious execution though. Also, a task may need to start executing while another is currently executing.</p>\n\n<p>I would also like to customize each task by setting an object for it, on which the task will operate while it is being executed.</p>\n\n<p>Usually, the tasks will execute in periods of 2 to 30 minutes and will take around 4-5 seconds, sometimes up to 30 seconds when they are executed.</p>\n\n<p>I've found <code>Executors.newSingleThreadedScheduledExecutor(ThreadFactory)</code> to be almost exactly what I want, except that it might cause me problems if a new task happens to be scheduled for execution while another is already executing. This is due to the fact that the Executor is backed up by a single execution thread. </p>\n\n<p>The alternative is to use <code>Executors.newScheduledThreadPool(corePoolSize, ThreadFactory)</code>, but this requires me to create a number of threads in a pool. I would like to avoid creating threads until it is necessary, for instance if I have two or more tasks that happen to need parallell executing due to their colliding execution schedules.</p>\n\n<p>For the case above, the <code>Executors.newCachedThreadPool(ThreadFactory)</code> appears to do what I want, but then I can't schedule my tasks. A combination of both cached and scheduled executors would be best I think, but I am unable to find something like that in Java.</p>\n\n<p>What would be the best way to implement the above do you think?</p>\n"},{"tags":["java","multithreading","threadpool","threadpoolexecutor"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":64,"score":4,"question_id":12722396,"title":"Specify task order execution in Java","body":"<p>I've searched a lot but couldn't find any solution.\nI use java thread pool in such way:</p>\n\n<pre><code>ExecutorService c = Executors.newFixedThreadPool(3);\nfor (int i = 0; i &lt; 10; ++i) {\n  c.execute(new MyTask(i));\n}\n</code></pre>\n\n<p>In such way Tasks are executed in consequent order (as in queue). But I need change \"select next task\" strategy. So I want assign to each task specify priority (it isn't thread priority) and execute tasks correspond to these priorities. So when executor have finished another task it chooses next task as task with maximum priority. \nIt describes common problem. Maybe there is more simple approach which doesn't account priorities. It selects last added task as next to execute instead of first added. Roughly speaking FixedThreadPool use FIFO strategy. Can I use for example LIFO strategy?</p>\n"},{"tags":["java","multithreading","web-crawler"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":72,"score":0,"question_id":12721900,"title":"Controlling the number of threads and controlling object accessing in a Multi Threaded Web Crawler in Java","body":"<p>I built a web crawler but it is single threaded. Now I am extending it to work with multiple threads. I am not able to understand the following :</p>\n\n<ol>\n<li>How many threads should I create? Should it be a fixed number or a dynamic one changing according to the length of the Queue holding the URIs? (Taking into consideration the available memory also)</li>\n<li>I have created a new class for the thread through the Runnable Interface and I want each thread's <code>run</code> method to access an object I created in my Main class which is calling <code>thread.start()</code>. How should I access this object from each thread?</li>\n</ol>\n\n<p>I am using NetBeans.  </p>\n"},{"tags":["java","android","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":357,"score":0,"question_id":9902396,"title":"Is there any way to stop background thread without process kill in Android?","body":"<p>My application has one service which runs until user pressed exit button. I know giving exit button in android is not good design but in my application it is desired. </p>\n\n<p>In my application I also have a thread to send Http request, download a file and then parse it in background so that UI will not block. In my thread's run method there are sequential steps (like download a file, then parse it), there is no while or for loop in it. </p>\n\n<p>When user presses exit button, is there any way to stop the background thread if it is running without kill process (using Process.kiil(pid) or System.exit(0)) ?</p>\n\n<p>I have tried AsyncTask also. Whatever in run method of thread, i put it in doInBackground method. When user presses exit button i have canceled asynctask. Cancelling task not stop the background thread completely because after file download it will go in parser to parse the file (i.e. parsing is done in background thread but it at the time of parsing it is not in doInBackground or run method. It will in parsing method of parser class or in Default handler class for parsing.)</p>\n\n<p>From googling I read many blogs and other stackoverflow questions about thread but still I cannot find any solution for it. \nPlease help....thanks in advance..</p>\n"},{"tags":["objective-c","multithreading","nsblockoperation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12715191,"title":"Grouping NSOperation working on same object and detect when they have finished in iOS","body":"<p>I have an iOS app where 5 NSBlockOperation produce an NSArray of objects each and add it to a shared synchronized NSMutableArray which serves as a UITableView datasource.</p>\n\n<p>The operation are independent from each other, and as soon as they have finished I need to launch a UITableView data reload.</p>\n\n<p>Unfortunately I couldn't find a way to do this with NSOperation. Do I need to use another multi thread design ?</p>\n"},{"tags":["c++","multithreading","pthreads","volatile","extern"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12720919,"title":"Volatile inter file or inter - thread?","body":"<p>I was wondering whether volatile keyword takes care of inter-thread affairs or inter file - via extern affairs or both?</p>\n\n<p>I did experiments but the results were bit confusing..</p>\n"},{"tags":["java","android","multithreading","fileoutputstream","filelock"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":71,"score":4,"question_id":12719706,"title":"How to check FileLock without truncating file?","body":"<p>I recently added filelocks to my downloader asynctask:</p>\n\n<pre><code>FileOutputStream file = new FileOutputStream(_outFile);\nfile.getChannel().lock();\n</code></pre>\n\n<p>and after download completes, <code>file.close()</code> to release lock.</p>\n\n<p>From a called BroadcastReceiver (different thread), I need to go through the files and see which are downloaded and which are still locked. I started with trylock:</p>\n\n<pre><code>for (int i=0; i&lt;files.length; i++) {\n    try {\n        System.out.print((files[i]).getName());\n        test = new FileOutputStream(files[i]);\n        FileLock lock = test.getChannel().tryLock();\n        if (lock != null) {\n            lock.release();\n            //Not a partial download. Do stuff.\n        }\n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        test.close();\n    }\n}\n</code></pre>\n\n<p><strike>Unfortunately I read the file is truncated (0 bytes) when the FileOutputStream is created.</strike>\nI set it to append, but the lock doesn't seem to take effect, all appear to be un-locked (fully downloaded)</p>\n\n<p>Is there another way to check if a write-lock is applied to the file currently, or am I using the wrong methods here? Also, is there a way to debug file-locks, from the ADB terminal or Eclipse?</p>\n"},{"tags":["c++","multithreading"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12718805,"title":"Is it wrong or not advised to have a thread locked for a long time? Tcp related","body":"<p>I am working on a server program with a slotmanager thread (queue of references to other tcpthreads waiting for a connection). Sort of like when you are waiting in queue for a game server. My initial plan was to have the slotmanager thread wait and then will continue if notified(client waiting). Then the tpcthreads would just request an update on the status every X ms.</p>\n\n<p>My other options would be to have the slotmanager thread finish when the queue is empty then start a new one if its not already running and the queue has a waiting client in or have the TCPthread wait, which could result in the connection timing out.</p>\n"},{"tags":["java","multithreading","serversocket"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12715895,"title":"Cleanly halt thread listening to serversocket in Java","body":"<p>I've got a program I'm working on where the main thread initializes a listener thread to listen for incoming connections to a serverSocket</p>\n\n<pre><code>    /*\n     * run - this will set up the server so that it is ready to listen.\n     */\n    public void run( serverVariables servVar, storageManager writer, storageVariables write, CoreVariables coreVar, serverFunctions serv, SQLFunctions SQL, SQLvariables SQLvar, netFunctions conn, netVariables netVar) {\n        ControlFunctions cntrl = new ControlFunctions();\n        util.doCommand(\"ifconfig eth0 \" + servVar.ip);\n        ListenerThread listen = new ListenerThread(servVar, coreVar, writer, serv, write, SQL, SQLvar, util);\n        try {\n            servVar.servSocket = new ServerSocket(servVar.port);\n            listen.start();\n            cntrl.getInput(util, clr.YELLOW, SQL, SQLvar, listen, conn, netVar);\n        } catch (IOException e) {\n            System.out.println(\"Could not read input stream\");\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n\n<p>then waits for input from the server admin (in cntrl.getInput()). That's all well and good, but the main function I'm trying to implement from the getInput is \"halt\" which should check that there are no connections, and then stop the listener and itself.</p>\n\n<p>Here's the listener thread:</p>\n\n<pre><code>   package server;\n\nimport java.io.IOException;\n\nimport net.netFunctions;\nimport net.netVariables;\nimport core.CoreVariables;\nimport utl.utilFunctions;\nimport utl.color;\nimport server.serverVariables;\nimport store.storageManager;\nimport store.storageVariables;\nimport conn.SQLFunctions;\nimport conn.SQLvariables;\n\npublic class ListenerThread extends Thread {\n    color clr = new color();\n    CoreVariables coreVar = new CoreVariables();\n    utilFunctions util = new utilFunctions();\n    netVariables netVar = new netVariables();\n    storageManager writer = new storageManager();\n    netFunctions conn = new netFunctions();\n    storageVariables write = new storageVariables();\n    serverFunctions serv = new serverFunctions();\n    serverVariables servVar = new serverVariables();\n    SQLFunctions SQL = new SQLFunctions();\n    SQLvariables SQLvar = new SQLvariables();\n    message msg = new message();\n\n    public ListenerThread(serverVariables servVar, CoreVariables coreVar,\n            storageManager writer, serverFunctions serv,\n            storageVariables write, SQLFunctions SQL, SQLvariables SQLvar,\n            utilFunctions util) {\n        super(\"ListenerThread\");\n        this.coreVar = coreVar;\n        this.util = util;\n        this.writer = writer;\n        this.write = write;\n        this.serv = serv;\n        this.servVar = servVar;\n        this.SQL = SQL;\n        this.SQLvar = SQLvar;\n    }\n\n    public void run() {\n        util.outColored(\"Listener thread started\", clr.CYAN);\n        while (true) {\n            try {\n                new ConnectionThread(clr.GREEN, servVar.servSocket.accept(),\n                        coreVar, util, writer, write, serv, servVar, SQL,\n                        SQLvar).start();\n            } catch (IOException e) {\n                System.out.println(\"Failed to accept\");\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>and the haltServer function:</p>\n\n<pre><code>private boolean haltServer(SQLFunctions SQL, SQLvariables SQLvar, utilFunctions util, String color, ListenerThread listen, netFunctions conn, netVariables netVar) {\n    Socket s = null;\n    boolean success = false;\n    String result = null;\n    int count = 0;\n    //check for open connections\n    SQL.doQuery(\"SELECT * FROM Clients WHERE Status != 0\", SQLvar);\n    try {\n        while(SQLvar.resultSet.next()) {\n            result = SQLvar.resultSet.getString(\"ClientID\");\n            util.outColored(\"Client \" + result + \" is still connected\", color);\n            count++;\n        }\n        if(count == 0) {\n            listen.stop();\n            success = true;\n        }\n        } catch (UnknownHostException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }catch (SQLException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n    return success;\n}\n</code></pre>\n\n<p>I'm aware that stop is depreciated, and looked in to using interupted() as a flag, but I don't think that will work due to the serverSocket.accept() call.</p>\n\n<p>Ideas?</p>\n"},{"tags":["multithreading","asynchronous","clojure","io","idioms"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":81,"score":4,"question_id":12718573,"title":"Clojure message handling / async, multithreaded","body":"<p>I have a small Clojure consumer/publisher receiving messages, processing them and sending them off to other consumers, all via RabbitMQ.</p>\n\n<p>I've defined a message-handler that handles messages in a separate thread (separate from the main thread that is).\nAs can be seen in the code below, the thread synchronously receives and sends messages, all happening in an event loop started by the <strong>lcm/subscribe</strong> function.</p>\n\n<p>So, the question is, what would be the \"Clojure way\" to create a N-sized thread pool of these synchronous message-handlers? I guess the non-Clojure way would be to manually spawn a number of threads via Java interop.</p>\n\n<p>Also, would that speed up message processing things at all, considering that the processing isn't very CPU intensive? Would it be better to make these message-handlers async - again, considering that more time is spent publishing than processing?</p>\n\n<p>And finally, how would I go about measuring the performance of these contending approaches (I come from the Ruby/Javascript world, and there isn't any multithreading there)?</p>\n\n<p><strong>NOTE</strong>:\nI know all this could be avoided by just scaling horizontally and spawning more JVM processes listening to the message bus, but since the app is going to be deployed on Heroku, I'd like to use as much resources as possible in each dyno/process.</p>\n\n<pre><code>(defn message-handler\n  [ch metadata ^bytes payload]\n  (let [msg (json/parse-string (String. payload \"UTF-8\"))\n        processed-message (process msg)] \n    (lb/publish ch \"e.events\" \"\" processed-message)))\n\n(defn -main\n  [&amp; args]\n  (let [conn          (rmq/connect {:uri (System/getenv \"MSGQ\")})\n        ch            (lch/open conn)\n        q-name        \"q.events.tagger\"\n        e-sub-name    \"e.events.preproc\"\n        e-pub-name    \"e.events\"\n        routing-key   \"tasks.taggify\"]\n    (lq/declare ch q-name :exclusive false :auto-delete false)\n    (le/declare ch e-pub-name \"fanout\" :durable false)\n    (lq/bind ch q-name e-sub-name :routing-key routing-key)\n    (.start (Thread. (fn []\n                       (lcm/subscribe ch q-name message-handler :auto-ack true))))))\n</code></pre>\n\n<hr>\n\n<p>On a more basic note... how would I go about refactoring this code to support registering the message-handler callback with an additional argument, like this:</p>\n\n<pre><code>    (.start (Thread. (fn []\n                       (lcm/subscribe ch q-name (message-handler pub-name) :auto-ack true))))))\n</code></pre>\n\n<p>and then publish with a reference:</p>\n\n<pre><code>    (lb/publish ch pub-name \"\" processed-message)))\n</code></pre>\n\n<p>instead of a literal:</p>\n\n<pre><code>    (lb/publish ch \"e.events\" \"\" processed-message)))\n</code></pre>\n"},{"tags":["multithreading","asynchronous","async-await","c#-5.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12675158,"title":"When should i use async/await and when not?","body":"<p>Should i use async/await from now on (c# 5) everytime when i don't require the outcome of an method immediatelly (Task&lt;>) or i have to fire a one-off method (void)?</p>\n\n<p>Should i use it in all the cases when i used the Task class in C# 4 and pushed work to the Backgroud threads?</p>\n\n<p>Should i use it only in cases when i used asynchronous .Net Framework Methods?</p>\n\n<p>Confused.</p>\n\n<p>I am basically looking for a simple explanation in which cases i should use await/async and when not.</p>\n"},{"tags":["java","multithreading","synchronization","waiting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12719054,"title":"What does a thread do after calling wait() in Java?","body":"<p>In multi-threading programs, I suspect that when a thread wait(), it does not engage much cpu utilization so that the cpu can swap to process other thread.</p>\n\n<p>For example, 100 threads start the same task together comparing to 50 threads actually do the task while other 50 threads wait until all 50 tasks are completed.\nThe latter case cost much less time than the former.</p>\n\n<p>Can anyone suggest some readings about this?</p>\n"},{"tags":["java","multithreading","swing","event-dispatch-thread","invokelater"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":12715432,"title":"Cannot update Swing component under a heavy process","body":"<p>I am running a very heavy process under an anonymous <code>SwingWorker</code> thread. In the meantime, I'm reporting progress to the GUI using a progress bar. However, Swing threading is doing me in. It's simply not updating anything in time. I'm not sure how to do it, as I've tried updating the GUI from the <code>SwingWorker</code> thread, and outside, and both refuse to work.</p>\n\n<h2><strong>How can I reliably update the Swing UI while a heavy worker thread is running?</strong></h2>\n\n<h3>Things I've tried</h3>\n\n<p>This does not work (with or without wrapping in the <code>invokeLater</code> command).</p>\n\n<pre><code>new LocalCompressor(compressor).execute();\n\nwhile (!compressionDone) {\n    SwingUtilities.invokeLater(new Runnable() {\n\n        @Override\n        public void run() {\n            int percent = compressor.getPercentDone();\n            progressBar.setValue(percent);\n            statusLabel.setText(percent);\n        }\n    });\n}\n</code></pre>\n\n<hr>\n\n<p>Additionally, attempting to update the UI from a concurrent measuring thread does not work:</p>\n\n<pre><code>class LocalCompressor extends SwingWorker&lt;Void, Void&gt; {\n\n    // [...]\n\n    public LocalCompressor(Compressor compressor) {\n        this.compressor = compressor;\n\n        // [...]\n    }\n\n    @Override\n        protected Void doInBackground() {\n\n            final Thread t1 = new Thread(new Runnable() {\n\n                @Override \n                public void run(){\n                    compressor.compress();\n                }\n            });\n\n            final Thread t2 = new Thread(new Runnable() {\n\n                @Override\n                public void run() {\n\n                    t1.start();\n\n                    while (t1.isAlive()) {\n                        updateUI(compressor.getPercentDone());\n                    }\n                }\n\n            });\n\n            t2.start();\n\n            return null;\n        }\n\n        // [...]\n}\n</code></pre>\n"},{"tags":["multithreading","qt","opencv"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":303,"score":1,"question_id":11543298,"title":"Qt + OpenCV - Displaying images on QLabel","body":"<p>I'm trying to capture live view from camera, and redirecting it to show up on QLabel.\nBut only half view comes (see below):\n<img src=\"http://i.stack.imgur.com/n8xDJ.png\" alt=\"Screenshot\"></p>\n\n<p>The left hand side window, is shown using cv::imshow(), which works perfectly.\nI'm capturing the Mat in a different thread, and then emitting a signal with a Qimage as a parameter, and then setting the image to the QLabel in the slot.</p>\n\n<p>here's the code:</p>\n\n<pre><code>while(true){\n    cam &gt;&gt; mat;\n    cv::imshow(\"name\",mat);\n    emit send_UIupdate(mat2qimage(mat));\n}\n</code></pre>\n\n<p>and in the slot setting the image to Qlabel:</p>\n\n<pre><code>void Dialog::updateUI(const QImage &amp;img){\n    label-&gt;setPixmap(QPixmap::fromImage(img));\n}\n</code></pre>\n\n<p>using the below to convert Mat to QImage:</p>\n\n<pre><code>QImage camera::mat2qimage(const cv::Mat&amp; mat) {\n    cv::Mat rgb;\n    cv::cvtColor(mat, rgb, CV_BGR2RGB);\n    return QImage((const unsigned char*)(rgb.data), rgb.cols, rgb.rows, QImage::Format_RGB888);\n}\n</code></pre>\n\n<p><strong>Any suggestions, to solve this problem ??</strong></p>\n"},{"tags":["android","multithreading","textview","runnable"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":12716850,"title":"Android update TextView in Thread and Runnable","body":"<p>I want to make a simple timer in Android that updates a TextView every second. It simply counts seconds like in Minesweeper.</p>\n\n<p>The problem is when i ignore the tvTime.setText(...) (make it //tvTime.setText(...), in LogCat will be printed the following number every second.\nBut when i want to set this number to a TextView (created in another Thread), the program crashes.</p>\n\n<p>Does anyone have an idea how to solve this easily?</p>\n\n<p>Here's the code (method is called on startup):</p>\n\n<pre><code>private void startTimerThread() {\n    Thread th = new Thread(new Runnable() {\n        private long startTime = System.currentTimeMillis();\n        public void run() {\n            while (gameState == GameState.Playing) {\n                System.out.println((System.currentTimeMillis() - this.startTime) / 1000);\n                tvTime.setText(\"\" + ((System.currentTimeMillis() - this.startTime) / 1000));\n                try {\n                    Thread.sleep(1000);\n                }\n                catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    });\n    th.start();\n}\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Finally, I got it.\nHere is the solution, for those who are interested in.</p>\n\n<pre><code>private void startTimerThread() {       \n    Thread th = new Thread(new Runnable() {\n        private long startTime = System.currentTimeMillis();\n        public void run() {\n            while (gameState == GameState.Playing) {                \n                runOnUiThread(new Runnable() {\n                    @Override\n                    public void run() {\n                        tvTime.setText(\"\"+((System.currentTimeMillis()-startTime)/1000));\n                    }\n                });\n                try {\n                    Thread.sleep(1000);\n                } \n                catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    });\n    th.start();\n}\n</code></pre>\n"},{"tags":["python","multithreading","pyqt","pyqt4","qthread"],"answer_count":1,"favorite_count":5,"up_vote_count":0,"down_vote_count":0,"view_count":2050,"score":0,"question_id":6783194,"title":"Background thread with QThread in PyQt","body":"<p>I have a program which interfaces with a radio I am using via a gui I wrote in PyQt.  Obviously one of the main functions of the radio is to transmit data, but to do this continuously, I have to loop the writes, which causes the gui to hang. Since I have never dealt with threading, I tried to get rid of these hangs using <code>QCoreApplication.processEvents().</code> The radio needs to sleep between transmissions, though, so the gui still hangs based on how long these sleeps last.  </p>\n\n<p>Is there a simple way to fix this using QThread?  I have looked for tutorials on how to implement multithreading with PyQt, but most of them deal with setting up servers and are much more advanced than I need them to be.  I honestly don't even really need my thread to update anything while it is running, I just need to start it, have it transmit in the background, and stop it.</p>\n"},{"tags":["java","multithreading","concurrency","java.util.concurrent","executor"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":85,"score":4,"question_id":12717251,"title":"Java Executor: Small tasks or big ones?","body":"<p>Consider one big task which could be broken into hundreds of small, independently-runnable tasks. To be more specific, each small task is to send a light network request and decide upon the answer received from the server. These small tasks are not expected to take longer than a second, and involve a few servers in total.</p>\n\n<p>I have in mind two approaches to implement this using the Executor framework, and I want to know which one's better and why.</p>\n\n<ol>\n<li>Create a few, say 5 to 10 tasks each involving doing a bunch of send and receives.</li>\n<li>Create a single task (Callable or Runnable) for each send &amp; receive and schedule all of them (hundreds) to be run by the executor.</li>\n</ol>\n\n<p>I'm sorry if my question shows that I'm lazy to test these and see for myself what's better (at least performance-wise). My question, while looking after an answer to this specific case, has a more general aspect. In situations like these when you want to use an executor to do all the scheduling and other stuff, is it better to create lots of small tasks or to group those into a less number of bigger tasks?</p>\n"},{"tags":["java","multithreading","concurrency","synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12717178,"title":"Should I access (not change) an object from multiple threads?","body":"<p>My situation is that I have two threads. The 1st thread produces a number of objects which the 2nd thread does not have access to until all of them are created. After that the 2nd thread reads fields in those objects but does so concurrently with the 1st. At this point no thread is changing the values of the fields of the objects.\nThe objects are not synchronized. Should I synchronize them or not?</p>\n"},{"tags":["python","multithreading","semaphore","task-queue","cancellationtokensource"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12449077,"title":"Simulating Cancellation Tokens in Python Threading","body":"<p>I just wrote a task queue in Python whose job is to limit the number of tasks that are run at one time. This is a little different than <code>Queue.Queue</code> because instead of limiting how many items can be in the queue, it limits how many can be taken out at one time. It still uses an unbounded <code>Queue.Queue</code> to do its job, but it relies on a <code>Semaphore</code> to limit the number of threads:</p>\n\n<pre><code>from Queue import Queue\nfrom threading import BoundedSemaphore, Lock, Thread\n\n\nclass TaskQueue(object):\n    \"\"\"\n    Queues tasks to be run in separate threads and limits the number\n    concurrently running tasks.\n\n    \"\"\"\n\n    def __init__(self, limit):\n        \"\"\"Initializes a new instance of a TaskQueue.\"\"\"\n        self.__semaphore = BoundedSemaphore(limit)\n        self.__queue = Queue()\n        self.__cancelled = False\n        self.__lock = Lock()\n\n    def enqueue(self, callback):\n        \"\"\"Indicates that the given callback should be ran.\"\"\"\n        self.__queue.put(callback)\n\n    def start(self):\n        \"\"\"Tells the task queue to start running the queued tasks.\"\"\"\n        thread = Thread(target=self.__process_items)\n        thread.start()\n\n    def stop(self):\n        self.__cancel()\n        # prevent blocking on a semaphore.acquire\n        self.__semaphore.release()\n        # prevent blocking on a Queue.get\n        self.__queue.put(lambda: None)\n\n    def __cancel(self):\n        print 'canceling'\n        with self.__lock:\n            self.__cancelled = True\n\n    def __process_items(self):\n        while True:\n            # see if the queue has been stopped before blocking on acquire\n            if self.__is_canceled():\n                break\n\n            self.__semaphore.acquire()\n\n            # see if the queue has been stopped before blocking on get\n            if self.__is_canceled():\n                break\n\n            callback = self.__queue.get()\n\n            # see if the queue has been stopped before running the task\n            if self.__is_canceled():\n                break\n\n            def runTask():\n                try:\n                    callback()\n                finally:\n                    self.__semaphore.release()\n\n            thread = Thread(target=runTask)\n            thread.start()\n            self.__queue.task_done()\n\n    def __is_canceled(self):\n        with self.__lock:\n            return self.__cancelled\n</code></pre>\n\n<p>The Python interpreter runs forever unless I explicitly stop the task queue. This is a lot more tricky than I thought it would be. If you look at the <code>stop</code> method, you'll see that I set a <code>canceled</code> flag, <code>release</code> the semaphore and <code>put</code> a no-op callback on the queue. The last two parts are necessary because the code could be blocking on the <code>Semaphore</code> or on the <code>Queue</code>. I basically have to force these to go through so that the loop has a chance to break out.</p>\n\n<p>This code works. This class is useful when running a service that is trying to run thousands of tasks in parallel. In order to keep the machine running smoothly and to prevent the OS from screaming about too many active threads, this code will limit the number of threads living at any one time.</p>\n\n<p>I have written a similar chunk of code in C# before. What made that code particular cut 'n' dry was that .NET has something called a <code>CancellationToken</code> that just about every threading class uses. Any time there is a blocking operation, that operation takes an optional token. If the parent task is ever canceled, any child tasks blocking with that token will be immediately canceled, as well. This seems like a much cleaner way to exit than to \"fake it\" by releasing semaphores or putting values in a queue.</p>\n\n<p>I was wondering if there was an equivalent way of doing this in Python? I definitely want to be using threads instead of something like asynchronous events. I am wondering if there is a way to achieve the same thing using two <code>Queue.Queue</code>s where one is has a max size and the other doesn't - but I'm still not sure how to handle cancellation.</p>\n"},{"tags":["multithreading","deadlock"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12715010,"title":"multithreading deadlock","body":"<p>Thread 1:</p>\n\n<pre><code>putQ\nsetFlag\n</code></pre>\n\n<p>Thread 2：</p>\n\n<pre><code>while (1) {\nwaitFlag\nprocessQ\nclearFlag\n}\n</code></pre>\n\n<p>This is an interview question.  I am not sure whether there is a while loop for Thread 1. \nBut the answer is like when Thread 2 re-enter the while loop, two threads go into deadlock. </p>\n\n<p>Can anyone tell me what's condition for deadlock? Thanks.</p>\n"},{"tags":["android","multithreading","alertdialog"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":442,"score":4,"question_id":6303713,"title":"The AlertDialog is invisible when the Activity back to foreground","body":"<p>I write a program support download file. When in this download activity, I start a progress bar and then run a thread to do the download things. This thread send message to UI thread to notify how many has been downloaded frequently. In the main(UI) thread, I update the progress bar display when receive the message. If any problem happen in download progress, it will send another message. When main thread receive the message, it stop the progress bar and pop up a new AlertDialog to show the error reason.</p>\n\n<p>Here is a special test for it. When downloading, switch the program to settings. Turn off the WIFI/GPRS to make the network off.</p>\n\n<p>When I back to my program, it should display the background ui and a pop up AlertDialog to show the reason as I wish. But it only display the background ui(which means the main activity) and with a half-light of backlight just as the popup windows still there. When I press back for first time, nothing happens except the backlight is bright just like I have close a pop up window. </p>\n\n<p>I think maybe it is because when I start the AlertDialog my activity is not in foreground.</p>\n\n<p>I tried to use:</p>\n\n<pre><code>ActivityManager am = (ActivityManager)Update.this.getSystemService(Context.ACTIVITY_SERVICE);\nComponentName cn = am.getRunningTasks(1).get(0).topActivity;\n</code></pre>\n\n<p>to judge whether the top activity is mine. But I want to show the dialog. If the activity isn't being seen by the user, when he gets back to my activity, I want it to show the dialog.</p>\n"},{"tags":["java","android","multithreading","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":425,"score":0,"question_id":5693199,"title":"how does a multi-threaded server work?","body":"<p>I've got from someone this example with a multithreaded server on android:</p>\n\n<p><a href=\"http://tutorials.jenkov.com/java-multithreaded-servers/singlethreaded-server.html\" rel=\"nofollow\">http://tutorials.jenkov.com/java-multithreaded-servers/singlethreaded-server.html</a></p>\n\n<p>But I have a few difficulties in understanding a part of the code:</p>\n\n<pre><code>while(! isStopped()) {\n    Socket clientSocket = null;\n    try {\n        clientSocket = this.serverSocket.accept();\n    } catch (IOException e) {\n        if (isStopped()) {\n            System.out.println(\"Server Stopped.\") ;\n            return;\n        }\n        throw new RuntimeException(\"Error accepting client connection\", e);\n    }\n</code></pre>\n\n<p>What I don't understand is, what happens when I have an exception at this line:</p>\n\n<pre><code>clientSocket = this.serverSocket.accept();\n</code></pre>\n\n<p>From what I can tell is that this function gets called:</p>\n\n<pre><code>private synchronized boolean isStopped() {\n    return this.isStopped;\n}\n</code></pre>\n\n<p>But how it gets to close that socket?  Cause if u get exception in the attempt to accept a client you should close the socket returned by accept.</p>\n\n<p>I assume that this is done in here:</p>\n\n<pre><code>public synchronized void stop() {\n    this.isStopped = true;\n    try {\n        this.serverSocket.close();\n    } catch (IOException e) {\n        throw new RuntimeException(\"Error closing server\", e);\n    }\n}\n</code></pre>\n\n<p>But where is <code>stop()</code> called,how it gets to make the connection between <code>isStopped()</code> and <code>onStop()</code>....And what is with that \"synchronized\"?</p>\n\n<p>Hope I've been clear with my unclarities!  Thank u in advance:)</p>\n"},{"tags":["c++","multithreading","c++11","atomic","language-lawyer"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12703532,"title":"Requirements for std::thread::id. Can it be atomized?","body":"<p>The standard says: \"An object of type thread::id provides... a single distinct value for all thread objects that do not represent a thread of execution\". Is that a single/distinct value with regard to <code>operator==</code>, or is it the actual bitwise-single/distinct value?</p>\n\n<p>The reason for the question: MSVC2012's <code>std::thread::id::id()</code> leaves garbage in one of its fields, and it breaks code that does compare-exchange on an <code>std::atomic&lt;std::thread::id&gt;</code> (since the latter depends on bitwise comparisons).</p>\n\n<p>Is <code>std::atomic&lt;std::thread::id&gt;</code> a legal construct in the first place?</p>\n\n<p>EDIT: for the reference, the code goes like this:</p>\n\n<pre><code>while( !worker_id.compare_exchange_weak( no_id = thread_id_type(), self_id ) )\n    sleep();\n</code></pre>\n"},{"tags":["multithreading","linux-kernel","scheduler"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12713880,"title":"Would process with more threads on linux have more cpu time than process with one thread?","body":"<p>Would process with more threads on linux have more cpu time than process with one thread?<br/><br/>\nIn linux processes and threads described by one struct task, and scheduling is based on tasks(http://stackoverflow.com/questions/8463741/how-linux-handles-threads-and-process-scheduling). I found (here <a href=\"http://oreilly.com/catalog/linuxkernel/chapter/ch10.html\" rel=\"nofollow\">http://oreilly.com/catalog/linuxkernel/chapter/ch10.html</a>) the next:<br/>\n\"When a new process is created, do_fork( ) sets the counter field of both current (the parent) and p (the child) processes in the following way:<br/>\n<code>\ncurrent->counter >>= 1;<br/></code>\n<code>p->counter = current->counter;<br/>\n</code>\nIn other words, the number of ticks left to the parent is split in two halves, one for the parent and one for the child. This is done to prevent users from getting an unlimited amount of CPU time by using the following method: the parent process creates a child process that runs the same code and then kills itself; by properly adjusting the creation rate, the child process would always get a fresh quantum before the quantum of its parent expires. This programming trick does not work since the kernel does not reward forks. Similarly, a user cannot hog an unfair share of the processor by starting lots of background processes in a shell or by opening a lot of windows on a graphical desktop. More generally speaking, a process cannot hog resources (unless it has privileges to give itself a real-time policy) by forking multiple descendents.\"<br/><br/>\nActually I didn't found that in kernel sources, but maybe it's my fault, maybe I saw wrong kernel version.<br/><br/>\nBut what happens later, would every thread participate in scheduling like separate process? Would process with ten threads get ten times more ticks than process with one thread?\nWhat about IO in this sense?</p>\n"},{"tags":["java","android","multithreading","thread-safety"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12714887,"title":"SurfaceView and thread already started exception","body":"<p>Checking the LunarLander example it uses that code for resume the drawer thread:</p>\n\n<pre><code>public void surfaceCreated(SurfaceHolder holder) {\n    // start the thread here so that we don't busy-wait in run()\n    // waiting for the surface to be created\n    thread.setRunning(true);\n    thread.start();\n}\n</code></pre>\n\n<p>and this for end:</p>\n\n<pre><code>public void surfaceDestroyed(SurfaceHolder holder) {\n    // we have to tell thread to shut down &amp; wait for it to finish, or else\n    // it might touch the Surface after we return and explode\n    boolean retry = true;\n    thread.setRunning(false);\n    while (retry) {\n        try {\n            thread.join();\n            retry = false;\n        } catch (InterruptedException e) {\n        }\n    }\n}\n</code></pre>\n\n<p>But when I execute the project, press the home button and resume the application it crashes with </p>\n\n<pre><code> java.lang.IllegalThreadStateException: Thread already started.\n    at java.lang.Thread.start(Thread.java:1045)\n    at com.example.android.lunarlander.LunarView.surfaceCreated(LunarView.java:862)\n    at android.view.SurfaceView.updateWindow(SurfaceView.java:533)\n    at android.view.SurfaceView.onWindowVisibilityChanged(SurfaceView.java:226)\n    at android.view.View.dispatchWindowVisibilityChanged(View.java:5839)\n    at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:945)\n    at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:945)\n    at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:945)\n    at android.view.ViewGroup.dispatchWindowVisibilityChanged(ViewGroup.java:945)\n</code></pre>\n\n<p>I've seen this method for handling the background thread in other examples but it crashes. What is the problem with it?</p>\n"},{"tags":["multithreading","apache","cgi","single-threaded"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12714669,"title":"Is Apache launching CGI single threaded?","body":"<p>I know Apache could run multiple CGI processes in parallel. But how about the process to launch CGI processes?</p>\n\n<p>I was doing some tests for Apache CGI on Ubuntu 12.04. I wanted to know how long apache would start a CGI script. Say t1 is the time right before request is sent and t2 is the time right after the CGI script is lauched. tx = t2- t1 should be roughly the time for Apache to start a CGI. I have X users. Each user runs 50 continuesly. <strong>If X users are running concurrently, tx would be X times slower than running just 1 user.</strong> That looks like single threaded. Is it what Apache should be or is it something wrong with my configuration?</p>\n\n<p>BTW, for mpm, I tried both prefork and worker. For cgi module, I tried mod_cgi and mod_cgid. Same thing happened.</p>\n"},{"tags":["multithreading","core-data","merge","nsmanagedobject","nsmanagedobjectcontext"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12711029,"title":"NSManagedObjectContext merge from main thread to other thread","body":"<p>I've used Core Data in various projects so I'm aware of how to deal with context merging from a thread to the main app.</p>\n\n<p>My problem is that in a new application I'm working on I have a main context and a thread context that lives for the whole application lifetime whereas usually I created a context for each threaded call.</p>\n\n<p>So I'm not sure of how to deal with cases where I modify objects in the main thread. Do I need to merge them to the context thread ? How ? Is it possible to ask the context thread to resync from the main context before each call ?</p>\n"},{"tags":[".net","multithreading","clr","threadpool"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12711028,"title":"Detecting when a ThreadPool user work item gets cleaned up","body":"<p>It is my understanding that anything running using .NETs threadpool like this:</p>\n\n<pre><code>ThreadPool.QueueUserWorkItem(myproc);\n</code></pre>\n\n<p>will get terminated cleanly by the CLR when the application is closed down.</p>\n\n<p>Let's say in this case that the myproc function contains an infinite loop. Is there a way I can hook into the termination of the thread?</p>\n"},{"tags":["c++","c","multithreading","compiler","x86"],"answer_count":7,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":219,"score":6,"question_id":12710336,"title":"Can compiler sometimes cache variable declared as volatile","body":"<p>From what I know, the compiler never optimizes a variable that is declared as <code>volatile</code>. However, I have an array declared like this.</p>\n\n<pre><code>volatile long array[8];\n</code></pre>\n\n<p>And different threads read and write to it. An element of the array is only modified by one of the threads and read by any other thread. However, in certain situations I've noticed that even if I modify an element from a thread, the thread reading it does not notice the change. It keeps on reading the same old value, as if compiler has cached it somewhere. But compiler in principal should not cache a volatile variable, right? So how come this is happening.</p>\n\n<p><strong>NOTE</strong>: I am not using <code>volatile</code> for thread synchronization, so please stop giving me answers such as use a lock or an atomic variable. I know the difference between volatile, atomic variables and mutexes. Also note that the architecture is x86 which has proactive cache coherence. Also I read the variable for long enough after it is supposedly modified by the other thread. Even after a long time, the reading thread can't see the modified value.</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":322,"score":0,"question_id":10526510,"title":"C# serial port class library","body":"<p>I am writing a class library that uses serial port to transfer data across from a device using a proprietary protocol.</p>\n\n<p>It worked fine when I was using as a windows form app.  The moment I converted it to a class lib, it ends after it processes the first bit of data.  Is there some threading that needs to be done to keep it from just returning it to the application that called it?  It needs to make sure all the data from the device has been gathered before returning control to the application which called it.</p>\n\n<p>Here is the full code that is ending early:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>using System;\nusing System.Text;\nusing System.IO.Ports;\nusing System.IO;\nusing System.Text.RegularExpressions;\nusing System.Threading;\n     using System.Runtime.InteropServices;\n\n     namespace ValidataDex\n     {\n\n\n\n    public class DexLib\n    {\n\n        public Crc16 c = new Crc16();\n        public Search s = new Search();\n\n        const ushort polynomial = 0xA001;\n\n        ushort[] table = new ushort[256];\n\n        SerialPort port = null; // create port so it can be used and seen everywhere\n\n        int good = 0;  // is dex good \n\n        public string myblock;\n\n        public delegate void SetTextDeleg(byte[] text);\n        public int count;\n\n        public string stage = \"initial\";\n        public string position = \"\";\n\n        public string crcstuff = \"\";\n        public byte[] crcdata;\n\n        public int lastsent = 0;\n\n        public int audit = 0;\n        public char etboretx;\n        public int gotenq = 0;\n        public int x = 2;\n        public int positiondetermined = 0;\n\n        // Dex Commands\n        public byte NUL = 0x00;\n        public byte SOH = 0x01;\n        public byte STX = 0x02;\n        public byte ETX = 0x03;\n        public byte EOT = 0x04;\n        public byte ENQ = 0x05;\n        public byte ACK = 0x06;\n        public byte DLE = 0x10;\n        public byte NAK = 0x15;\n        public byte SYN = 0x16;\n        public byte ETB = 0x17;\n        public string Dex;\n        public int rte=0;\n\n        public string CHANGER_IS_SLAVE = \"9252130100RR01L01\";\n\n        byte zero = 0x30;\n        byte one = 0x31;\n\n        public void Data_Received(object sender, SerialDataReceivedEventArgs e)\n        {\n            SerialPort sp = (SerialPort)sender;\n            count = port.BytesToRead;\n            byte[] data = new byte[count];\n            port.Read(data, 0, data.Length);\n\n            // audit function activated by a file named debug residing in application directory\n            string path = System.IO.Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().GetName().CodeBase);\n            if (audit == 1 || File.Exists(path + @\"\\debug.txt\"))\n            {\n                x = 0;\n                foreach (byte b in data)\n                {\n                    audit_file(1, \"stage:\"+stage+\" command:\"+getdexcommand(b)+\" pos det:\"+positiondetermined);\n                    //                textBox1.Text += getdexcommand(b);\n                    x++;\n                }\n            }\n\n\n            try\n            {\n                // wait for device to transmit a DLE to begin DEX\n                if (data[0] == DLE || positiondetermined == 1)\n                {\n                     DexasMaster(data);\n                }\n            }\n            catch (Exception ee)\n            {\n                audit_file(2, ee.InnerException.ToString());\n            }\n        }\n</code></pre>\n"},{"tags":["ios","multithreading","core-data","uisearchbar","nsfetchedresultscontrolle"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":11251430,"title":"background thread behaving differently depending on when the method it's called","body":"<p>On a CoreDataTableViewController (that subclass done by the people from Stanford) I have a fetch from a sqlite database. </p>\n\n<p>The fetch is very fast on the simulator and on the device, but to make it older-devices-friendly, I'd like to perform the fetch on the background and add a spinner while it's being done. So I added a prefetch method. The whole thing looks like this:</p>\n\n<pre><code>-(void)setupFetchedResultsController{\n\n    NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:self.entity];\n\n    request.propertiesToFetch=[NSArray arrayWithObject:self.attribute];\n    request.resultType=NSDictionaryResultType;\n    request.returnsDistinctResults=YES;\n\n    NSPredicate *predicate1 = [NSPredicate predicateWithFormat:@\"%K != nil\", self.attribute]; \n    NSPredicate *predicate2 = [NSPredicate predicateWithFormat:@\"%K != ''\", self.attribute];\n    NSPredicate *predicate3=  [NSPredicate predicateWithFormat:@\"%K contains[cd] %@\", self.attribute, self.seachBar.text];\n\n    NSArray *prepredicateArray;\n\n    if ([self.seachBar.text length]) {\n         prepredicateArray = [NSArray arrayWithObjects:predicate1, predicate2, predicate3,nil];\n\n    }else {\n         prepredicateArray = [NSArray arrayWithObjects:predicate1, predicate2,nil];\n\n    }\n\n    request.predicate=[NSCompoundPredicate andPredicateWithSubpredicates:prepredicateArray];\n    request.sortDescriptors = [NSArray arrayWithObject:[NSSortDescriptor sortDescriptorWithKey:self.attribute ascending:YES ]];\n\n\n    self.fetchedResultsController = [[NSFetchedResultsController alloc] initWithFetchRequest:request\n                                                                        managedObjectContext:self.managedObjectContext\n                                                                          sectionNameKeyPath:nil\n                                                                                   cacheName:nil];\n\n\n    [self performFetch];\n}\n\n\n\n\n\n-(void)prefetch{\n\n    UIView *translucentView=[[UIView alloc]initWithFrame:CGRectMake(110, 102, 100, 100)];\n    [translucentView setCornerRadius:7.0];\n    translucentView.backgroundColor=[UIColor blackColor];\n    translucentView.alpha=0.65;\n\n    UIActivityIndicatorView *spinner=[[UIActivityIndicatorView alloc]initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhiteLarge];\n    spinner.frame=CGRectMake(0, 31.5, 100, 37);\n    [translucentView addSubview:spinner];\n\n    [spinner startAnimating];\n\n    [self.view addSubview:translucentView];\n\n\n    dispatch_queue_t fetchQueue = dispatch_queue_create(\"fetch stuff\", NULL);\n\n    dispatch_async(fetchQueue, ^{\n\n        [self setupFetchedResultsController];\n\n        dispatch_async(dispatch_get_main_queue(), ^{\n\n            [translucentView removeFromSuperview];\n\n        });\n\n    });\n\n    dispatch_release(fetchQueue);\n\n}\n</code></pre>\n\n<p>The thing is that when I call the <code>prefetch</code> method from <code>viewWillAppear</code> everything is fine, but when I call it from a method called when editing the searchBar (the fetch dynamically shows the fetched results while typing on a searchBar) it gives the following error:</p>\n\n<pre><code>void _WebThreadLockFromAnyThread(bool), 0x6b9b730: Obtaining the web lock from a thread other than the main thread or the web thread. UIKit should not be called from a secondary thread.\n</code></pre>\n\n<p>It was my understanding that UI stuff should be performed on the main thread, but I fail to see where the error is.</p>\n\n<p>Any pointers?  Thanks in advance!</p>\n"},{"tags":["c","multithreading","mutex","condition-variable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12712036,"title":"Can pthread_mutex_lock() unblock before pthread_cond_wait() unblocks?","body":"<p>Imagine a thread blocks on a condition variable:</p>\n\n<pre><code>pthread_mutex_lock (mutex);\ndo_something ();\npthread_cond_wait(cond, mutex); // [1]\ndo_something_else ();\npthread_mutex_unlock (mutex);\n</code></pre>\n\n<p>The mutex is unlocked and a different thread trying to lock the mutex is unblocked:</p>\n\n<pre><code>pthread_mutex_lock (mutex);\ndo_some_work ();\npthread_cond_signal (cond);\npthread_mutex_unlock (mutex);\n</code></pre>\n\n<p>At the same time there's another thread waiting to acquire the ownership of the critical section:</p>\n\n<pre><code>pthread_mutex_lock (mutex); // [2]\ndo_some_random_work ();\npthread_mutex_unlock (mutex);\n</code></pre>\n\n<p>Now, the question is: When pthread_cond_signal() is called, is it guaranteed that the pthread_cond_wait() [1] will unblock before pthread_mutex_lock() [2]?</p>\n\n<p>The POSIX specification seems to say nothing about the case.</p>\n"},{"tags":["multithreading","cocoa","crash","enumeration","nsarraycontroller"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1683,"score":0,"question_id":3925054,"title":"Collection was mutated while being enumerated crash with NSTableView, NSArrayController and NSThread","body":"<p>In my small Core Data application I have some NSTableView views binded with NSArrayController controllers in Entity mode.</p>\n\n<p>When I try to import some big amount of data to my table in background thread, after some successfully added imports (from dozens to hundreds items) I get crash with log:</p>\n\n<p><strong>Serious application error.  Exception was caught during Core Data change processing: *** Collection  was mutated while being enumerated.NSHashTable (%@) {\n[5]  (entity: Word; id: 0x1001dd4b0  ; data: { ....... entity description here.... }</strong> ....</p>\n\n<p>...and stack trace:</p>\n\n<pre><code>#0  0x7fff83e0e2fa in mach_msg_trap\n#1  0x7fff83e0e96d in mach_msg\n#2  0x7fff8816c614 in _CGSSynchronizeWindowBackingStore\n#3  0x7fff88152169 in _CGSLockWindow\n#4  0x7fff88158cff in CGSDeviceLock\n#5  0x7fff81ecae43 in ripd_Lock\n#6  0x7fff81eca746 in ripl_BltShape\n#7  0x7fff81ec7d86 in ripc_Render\n#8  0x7fff81ec5317 in ripc_DrawRects\n#9  0x7fff88158641 in CGContextFillRects\n#10 0x7fff8818ee1a in CGContextFillRect\n#11 0x7fff86e712f8 in NSRectFillUsingOperation\n#12 0x7fff86f2152e in NSDrawWindowBackground\n#13 0x7fff86ea16c2 in -[NSThemeFrame drawWindowBackgroundRect:]\n#14 0x7fff86e6eb9a in -[NSFrameView drawThemeContentFill:inView:]\n#15 0x7fff86e68aa5 in -[NSThemeFrame drawRect:]\n#16 0x7fff86e68131 in -[NSView _drawRect:clip:]\n#17 0x7fff86e65907 in -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]\n#18 0x7fff86e64ee8 in -[NSThemeFrame _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:]\n#19 0x7fff86e6179a in -[NSView _displayRectIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:]\n#20 0x7fff86ddaff6 in -[NSView displayIfNeeded]\n#21 0x7fff86dd5ea2 in _handleWindowNeedsDisplay\n#22 0x7fff80099a2d in __NSFireTimer\n#23 0x7fff815aa678 in __CFRunLoopRun\n#24 0x7fff815a884f in CFRunLoopRunSpecific\n#25 0x7fff82c3991a in RunCurrentEventLoopInMode\n#26 0x7fff82c3971f in ReceiveNextEventCommon\n#27 0x7fff82c395d8 in BlockUntilNextEventMatchingListInMode\n#28 0x7fff86dab29e in _DPSNextEvent\n#29 0x7fff86daabed in -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:]\n#30 0x7fff86d708d3 in -[NSApplication run]\n#31 0x7fff86d695f8 in NSApplicationMain\n</code></pre>\n\n<p>Assuming there is an issue with updating table (enumeration not being thread safe), I have tried to solve this problem by disabling controller and table before import starts using:</p>\n\n<pre><code>[wordsController setEditable:NO];\n[wordsController setAutomaticallyPreparesContent:NO];\n[wordsTable setEnabled:NO];\n</code></pre>\n\n<p>but it does not help. During import I still see new entities being added to the tale until crash.</p>\n\n<p>Anyone knows what is the trick to disable NSArrayController from tracking changes for a time of background processing? Or maybe it is other issue here?</p>\n\n<p>Thank You very much for any hints.</p>\n"},{"tags":["c++","multithreading","unix"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":61,"score":-1,"question_id":12711036,"title":"Order in which threads are executed","body":"<p>I am new to multi threading and am following \"Advanced programming in unix environment\". I am not able to get the order in which the threads are executed. I have the following code.</p>\n\n<pre><code>int err1 = pthread_create(&amp;first, NULL, disp, a);\nint err2 = pthread_create(&amp;second, NULL, disp, b);\nint err3 = pthread_create(&amp;third, NULL, disp, c);\n</code></pre>\n\n<p>But the thread related to third tid is executing first, then the second and finally the first. Not sure if this is the behavior or something going wrong.</p>\n\n<p>Thx!\nRahul.</p>\n"},{"tags":["c#","multithreading","backgroundworker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":71,"score":0,"question_id":12710591,"title":"Two Threads for One Background Process?","body":"<p>I've got to call a routine from a supplied DLL. This DLL takes 2 to 10 minutes to run, depending on the speed of the PC it is being run on.</p>\n\n<p>I have put the DLL call into a BackgroundWorker thread so that the interface will remain responsive.</p>\n\n<pre><code>private object Load(string feature) {\n  object result = null;\n  using (var w = new BackgroundWorker()) {\n    w.WorkerReportsProgress = true;\n    w.WorkerSupportsCancellation = true;\n    w.DoWork += delegate(object sender, DoWorkEventArgs e) {\n      e.Result = DAL.get(feature);\n    };\n    w.RunWorkerCompleted += delegate(object sender, RunWorkerCompletedEventArgs e) {\n      progressBar1.Visible = false;\n      if (e.Error != null) {\n        MessageBox.Show(this, e.Error.Message, \"Load Error\", MessageBoxButtons.OK, MessageBoxIcon.Error);\n      } else {\n        result = e.Result;\n      }\n    };\n    w.RunWorkerAsync();\n    if (w.IsBusy) {\n      progressBar1.Style = ProgressBarStyle.Marquee;\n      progressBar1.Visible = true;\n    }\n  }\n  return result;\n}\n</code></pre>\n\n<p>This works, but I can't call this method inline with other calls that are waiting on its results because it will immediately return a null value.</p>\n\n<p>So, I stuck in a ManualResetEvent instance to try and get the method to wait until it actually had a value before returning:</p>\n\n<pre><code>private object Load(string feature) {\n  object result = null;\n  using (var w = new BackgroundWorker()) {\n    var mre = new ManualResetEvent(false);\n    w.WorkerReportsProgress = true;\n    w.WorkerSupportsCancellation = true;\n    w.DoWork += delegate(object sender, DoWorkEventArgs e) {\n      e.Result = DAL.get(feature);\n    };\n    w.RunWorkerCompleted += delegate(object sender, RunWorkerCompletedEventArgs e) {\n      progressBar1.Visible = false;\n      if (e.Error != null) {\n        MessageBox.Show(this, e.Error.Message, \"Model Load Error\", MessageBoxButtons.OK, MessageBoxIcon.Error);\n      } else {\n        result = e.Result;\n      }\n      mre.Set();\n    };\n    w.RunWorkerAsync();\n    if (w.IsBusy) {\n      progressBar1.Style = ProgressBarStyle.Marquee;\n      progressBar1.Visible = true;\n      progressBar1.Value = 0;\n      const string statusRun = @\"\\|/-\";\n      const string statusMsg = \"Loading Data...\";\n      int loops = 0;\n      do {\n        int index = loops++ % 4;\n        tsStatus.Text = statusMsg + statusRun[index].ToString(); // '\\', '|', '/', '-'\n      } while (!mre.WaitOne(200));\n    }\n  }\n  return result;\n}\n</code></pre>\n\n<p>However, it appears that doing this causes all of my CPU time to be spent on the ManualResetEvent's <code>WaitOne</code> method and the <code>Set()</code> trigger is never called.</p>\n\n<p>Has anyone encountered this behavior before and found a good workaround for it?</p>\n\n<p>I have created a workaround for it in the past, but it involved creating a second thread to run the <code>WaitOne</code> method so that the first thread can process the <code>DoWork</code> code.</p>\n"},{"tags":["multithreading","c#-4.0","callback"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12705804,"title":"Callback to execute when a thread is finished","body":"<p><strong>Disclaimer (fully editable/removable)</strong></p>\n\n<p><em>I've done my homework but to the best of my recognition, I can't see the very thing I'd like to know (which is a bit surprising, so I'm sure that a kind soul will flag me as a duplicate - please accept my apology in advance, haha).</em></p>\n\n<p><strong>Background and anticipated issue</strong></p>\n\n<p>When I start Outlook, I'm performing an update from CRM Dynamics, which takes a while. So, I decided to put the update in a thread. It works as supposed to <strong>but</strong> there's a button on the ribbon allowing a user to manually call for an update. Anticipating a frantic user, I realize that someone <strong>will</strong> click the button <strong>before</strong> the original update is finished and all kinds of excrement may hit the gas redistributive device.</p>\n\n<p><strong>Suggested solution</strong></p>\n\n<p>In order to avoid that, I've put a private property as follows.</p>\n\n<pre><code>private bool KeepYourPantsOn { get; set; }\n</code></pre>\n\n<p>As long as the said property is <code>true</code> (which it is set to right before I start the updating thread), all the frantic clicking will be either ignored or treated by a calm and informative</p>\n\n<pre><code>MessageBox.Show(\"Yes, yes... Updating still... Keep your pants on.\");\n</code></pre>\n\n<p>but as soon as the thread is done, I'd like the property to flip over to <code>false</code> enabling the user to manually update Outlook.</p>\n\n<p><strong>Implementation problem</strong></p>\n\n<p>My hick-up is that I haven't found any <code>OnFinished</code>, <code>WhenDone</code> etc. method to call in order to switch the value of <code>KeepYourPantsOn</code>. Moreover, I haven't really seen any suggested solution on how to resolve that (or, rather - I haven't <strong>perceived</strong> any solution - I might have seen one without realizing that was it, due to ignorance within the area of threaded programming).</p>\n"},{"tags":[".net","multithreading","wcf","task-parallel-library"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":12596421,"title":"Using threading.Task to run WCF methods","body":"<p>I'm using a generic function to execute wcf service calls - Please see below.\nI Just want to make sure I'm doing the right thing:</p>\n\n<ul>\n<li><p>The most Important requirement is service calls should be executed in a <strong>seperate thread</strong>. Initially I thought of Backgroundworker then decided to use <code>Threading.Task</code> so is it simple as<br>\n<code>Task.Factory.StartNew(Function() functionToCall.Invoke(serv))</code> ?<br>\nAnd get the result <code>result = t.Result</code></p></li>\n<li><p>Whats the diffrence if I do:</p>\n\n<blockquote>\n  <p>Dim t1 As New Task(Of Object)(Function() functionToCall.Invoke(serv))<br>\n  t1.Start()<br>\n  result = t1.Result </p>\n</blockquote></li>\n<li><p>Should I Consider <code>Parallel</code>?  </p></li>\n<li><p>Have I missed anything important?</p></li>\n</ul>\n\n<blockquote>\n  <p><strong>Edit: this function is in client solution's ServiceProxy project</strong></p>\n</blockquote>\n\n<pre><code>Private Function ServiceCall(ByVal functionToCall As ServiceDelegate(Of IEmpService)) As Object\n    Dim channel As New ChannelFactory(Of IEmpService)(_endPoint)\n    Dim serv As IEmpService\n    Dim result As Object = Nothing\n\n    serv = channel.CreateChannel()\n\n    Try\n        Dim t As Task(Of Object) = Task.Factory.StartNew(Function() functionToCall.Invoke(serv))\n        result = t.Result\n\n    Catch exp As Exception \n        CustomLog.Detail(exp)\n\n    Finally\n        If channel.State = CommunicationState.Faulted Then\n            channel.Abort()\n        Else\n            channel.Close()\n        End If\n    End Try\n\n    Return result\nEnd Function\n</code></pre>\n"},{"tags":[".net","multithreading","sockets","asynchronous","cultureinfo"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":11779707,"title":"Force Thread CultureInfo on all async socket callbacks","body":"<p>Is there a way to set the default CultureInfo (\"en-US\") for all async socket callbacks or do I really have to set manually on every callback?</p>\n"},{"tags":["c#","multithreading","thread-safety"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":166,"score":0,"question_id":12709183,"title":"Invoke event on MainThread from worker thread","body":"<p>I'm having trouble invoking an event from a secondary thread in the main thread. The event handler is not executed on main thread. Can anyone give me some pointers on what I'm doing wrong. </p>\n\n<p>Thanks</p>\n\n<pre><code>namespace ThreadSyncExample\n{\n  class Program\n  {\n    static void Main(string[] args)\n    {\n      Console.WriteLine(\"MainThread: \" + System.Threading.Thread.CurrentThread.ManagedThreadId);\n\n      Execute execThe = new Execute();\n      execThe.FinishedThread += (src, arg) =&gt;\n      {\n        //This shoould be executed on MainThread right?\n        Console.WriteLine(\"Thread Id: \" + System.Threading.Thread.CurrentThread.ManagedThreadId);\n      };\n\n      execThe.Run();\n      Console.ReadKey();\n    }\n\n  }\n\n\n  class Execute\n  {\n    public void Run()\n    {\n      Thread exec = new Thread(() =&gt;\n      {\n        Console.WriteLine(\"Worker Thread : \" + System.Threading.Thread.CurrentThread.ManagedThreadId);\n        OnFinishedThread();\n      });\n\n      exec.Start();\n    }\n\n    public event EventHandler FinishedThread;\n    protected virtual void OnFinishedThread()\n    {\n      if (null != FinishedThread)\n      {\n        EventArgs args = new EventArgs();\n        FinishedThread(this, EventArgs.Empty);\n      }\n    }\n  }\n}\n</code></pre>\n"},{"tags":["multithreading","apache","operating-system","cassandra","multiprocessing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12707924,"title":"Multiple process vs Multiple threads for CPU intensive and IO intensive processes on server","body":"<p>I have a server with say, 16 cores and 32G memory. For a process like <code>apache</code>, which spawns a new thread for every new connection which of the following alternatives is better, and why?\nAlso what will happen in the case of an application like <code>cassandra</code>. In case of cassandra  where there are a lot of writes to the memory, this will mean having two 'nodes' on the same machine will be beneficial in any way? </p>\n\n<ol>\n<li><p><strong>Multiple (say, two) instances of the same application running on the same machine and serving on two different ports.</strong> (May be an LB on a different machine in front of this machine).</p>\n\n<p>I'm confused how will the OS handle two instances of a multithreading application. Will both the processes will have threads running on all cores? In what cases will the context switching occur (between processes and threads) and how will it effect the performance? </p></li>\n<li><p><strong>A single instance of a multithreading application serving on one port.</strong></p></li>\n</ol>\n\n<p>In case of an application like cassandra where the threads are going to have shared memory to which they'll write, when will the context switch occur between threads? </p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":480,"score":8,"question_id":10395571,"title":"Condition vs wait notify mechanism","body":"<p>What is the advantage of using Condition interface/implementations over the conventional wait notify mechanism ?Here i quote the comments written by Doug Lea :-</p>\n\n<blockquote>\n  <p>Condition factors out the Object monitor methods (wait, notify and notifyAll) into distinct objects to give the effect of having multiple wait-sets per object, by combining them with the use of arbitrary Lock implementations. Where a Lock replaces the use of synchronized methods and statements, a Condition replaces the use of the Object monitor methods. </p>\n</blockquote>\n\n<p>I see this is a more Object Oriented way of implementing wait/notify mechanism. But is there a sound advantage over the former ? </p>\n"},{"tags":["c","multithreading","interrupt-handling"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":130,"score":7,"question_id":12704196,"title":"C printf() in interrupt handler?","body":"<p>I heard printf() in C is not supposed to be used in ISR. Is it because it's a blocking call, or is it because it's not re-entrant?</p>\n\n<p>If printf() is not re-entrant, then wouldn't it means that it can not be used for multi-thread program as well, unless it's 'synchronized' in some way?</p>\n\n<p>Thanks,</p>\n"},{"tags":["java","multithreading","repaint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1089,"score":2,"question_id":619675,"title":"Why is my Panel's repaint not being called?","body":"<p>I've got a problem which I just can't seem to get around involving a small animation. For a project we are designing a J9 application to run on a PDA (DELL Axim X51). The problematic code (shown below) is when a mouse click is detected to run a small animation in a nested panel. If the animation is run independently of the mouse click, it works fine and repaints perfectly. When the method is called when a mouse click is recognized the repaint at every animation interval us ignored and only once the animation is completed will the panel be repainted. </p>\n\n<p>I <em>think</em> it might have something to do with when a mouse click is recognized the application is synchronized with itself stopping any internal method calls to paint OR that the paint operation does not have high enough priority over the mouse click.</p>\n\n<h3><a href=\"http://pastebin.com/m33004354\" rel=\"nofollow\">My code:</a></h3>\n\n<pre><code>import java.awt.BorderLayout;\nimport java.awt.Color;\nimport java.awt.Font;\nimport java.awt.FontMetrics;\nimport java.awt.Frame;\nimport java.awt.Graphics;\nimport java.awt.Panel;\nimport java.awt.event.WindowAdapter;\nimport java.awt.event.WindowEvent;\n\npublic class StatusLoader extends Panel implements Runnable{\n\n        int progress;\n\n        public static void main(String[] args) {\n                Frame f = new Frame();\n                StatusLoader  mp = new StatusLoader();\n                mp.setBackground(Color.yellow);\n                f.add(mp);\n\n                f.setSize(300,300);\n                f.show();       \n                f.addWindowListener(new WindowAdapter() {            \n            public void windowClosing(WindowEvent e) {\n                System.exit(0);\n            }\n        });\n                mp.start();\n        }\n\n        public void start(){\n                Thread t = new Thread(this);\n                t.run();\n\n        }\n\n        public void run(){\n                for (int i = 0; i &lt; 10; i++) {\n                        progress+=10;\n                        this.repaint(0);\n                        System.out.println(i);\n                        try{\n                                Thread.sleep(100);\n                        }catch(InterruptedException ex){}\n                }\n        }\n\n        public void paint(Graphics g){\n                System.out.println(\"called repaint\");\n                g.setColor(Color.red);\n                g.setFont(new Font(\"Sansserif\",2,24));\n                FontMetrics fm = g.getFontMetrics();\n                int stringWidth = fm.stringWidth(\"Loading\");\n                g.drawString(\"Loading\", getWidth()/2-stringWidth/2, getHeight()/2);\n                g.setFont(new Font(\"Sansserif\",2,12));\n                fm = g.getFontMetrics();\n                stringWidth = fm.stringWidth(\"Map ziles for the new zoom level\");\n                g.drawString(\"Map tiles for the new zoom level\", getWidth()/2-stringWidth/2, getHeight()/2+30);\n                g.drawRect(getWidth()/2-100, getHeight()/2+60, 200, 10);\n                g.setColor(Color.blue);\n                g.fillRect(getWidth()/2-100, getHeight()/2+60, progress*2, 10);\n        }\n\n}\n</code></pre>\n"},{"tags":["iphone","ios","multithreading","nsdocumentsdirectory","pdf-reader"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12707096,"title":"How to read pdf file from document directory in iPhone?","body":"<p>Currently i am working in iPhone application, i have an pdf file in resource folder (Local pdf file) then i read that pdf file (paper.pdf) successfully, below i have mentioned read local pdf file for your reference.</p>\n\n<p>Example:</p>\n\n<pre><code>CFURLRef pdfURL = CFBundleCopyResourceURL(CFBundleGetMainBundle(), CFSTR(\"paper.pdf\"), NULL, NULL);\npdf = CGPDFDocumentCreateWithURL((CFURLRef)pdfURL);\nCFRelease(pdfURL);\n</code></pre>\n\n<p>Then i have tried to store pdf file (from URL) in NSDocument directory, stored successfully.</p>\n\n<pre><code>NSData *pdfData = [[NSData alloc] initWithContentsOfURL:[NSURL URLWithString:@\"http://www.msy.com.au/Parts/PARTS.pdf\"]];\n\n NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES); \n NSString *documentsDirectory = [paths objectAtIndex:0]; \n NSString *filePath = [documentsDirectory stringByAppendingPathComponent:@\"myPDF11.pdf\"];\n [pdfData writeToFile:filePath atomically:YES];\n</code></pre>\n\n<p>Then i tried read that pdf file (from NSDocument directory) but i didn't know that, please help me.</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["c#","multithreading","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12706602,"title":"BeginAcceptTcpClient not waiting","body":"<p>Im doing some sockets programming that will eventually go into a windows service. For testing purposes im using a console application. Im a little puzzled because the BeginAcceptTcpClient or the Task.WaitAll does not wait and the console application just ends. If i add a Console.ReadLine at the end of main , everything works ok. With some slight modifications in Main it also works when i run it as as service. Why doesnt the Task.WaitAll wait until all tasks in the console application has finished and why doesnt the BeginAcceptTcpClient halt and wait for connection in console but works perfectly when i run it in a service.</p>\n\n<pre><code>static void Main(string[] args)\n        {\n            listener = new TcpListener(IP_ADDRESS, Port);\n            listener.Start();\n\n            var tasks = new List&lt;Task&gt;();\n\n             Task task = Task.Factory.StartNew(() =&gt; AcceptClient(listener),TaskCreationOptions.LongRunning);\n                tasks.Add(task);\n\n            Task.WaitAll(tasks.ToArray());\n\n        }\n\n\n        private static void AcceptClient(TcpListener tcpListener)\n        {\n            Task&lt;TcpClient&gt; acceptTcpClientTask = Task.Factory.FromAsync&lt;TcpClient&gt;(tcpListener.BeginAcceptTcpClient, tcpListener.EndAcceptTcpClient, tcpListener);\n\n              acceptTcpClientTask.ContinueWith(task =&gt; { OnAcceptConnection(task.Result); AcceptClient(tcpListener); }, TaskContinuationOptions.OnlyOnRanToCompletion);\n        }\n</code></pre>\n"},{"tags":["java","multithreading","hibernate","assertions"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12705700,"title":"Hibernate AssertionFailure in different Threads","body":"<p>I connect to my database with one session. I have always the same session in my whole program. My Thread \"1\" catches primary data from the database. The user must be allowed to cancel this thread. So if the user presses the cancel button to often or to fast (this is my interpretation) the following error occures:</p>\n\n<pre><code>ERROR org.hibernate.AssertionFailure - HHH000099: an assertion failure occured (this may indicate a bug in Hibernate, but is more likely due to unsafe use of the session) \norg.hibernate.AssertionFailure: possible non-threadsafe access to the session\n</code></pre>\n\n<p>The same errors occures if i cancel my thread \"2\" which is running in the background after my thread \"1\" ist finished and the try to load another primary data set from the database.</p>\n\n<p>Is the failure that i am using the same session in my two threads?</p>\n\n<p>What is the right way to solve such a problem?</p>\n"},{"tags":["c#","multithreading","sockets","tcpclient","asyncsocket"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12705554,"title":"Async programming and explicit use of Thread pool. Are they mutually exclusive?","body":"<p>I have been using Async programming for developing a TCP Proxy Server. I am using BeginXXX and EndXXX for Accepting,Receiving,Connecting and Sending Operations. The listener socket runs on the main thread and is not blocked. </p>\n\n<p>My Question - Should I manually create a Thread Pool to manage the multiple clients connected  to the Server or the Async programming is going to handle the multiple clients itself (without the need for explicit thread creation) ?</p>\n\n<p>The TCP proxy Server listens on a port for incoming connections and once the connections are accepted, it relays the data from client to the main server and visa versa.</p>\n"},{"tags":["c#","multithreading"],"answer_count":6,"favorite_count":17,"up_vote_count":31,"down_vote_count":0,"view_count":29540,"score":31,"question_id":1584062,"title":"How to wait for thread to finish with .NET?","body":"<p>I've never really used threading before in C# where I need to have two threads, as well as the main UI thread. Basically, I have the following.</p>\n\n<pre><code>public void StartTheActions()\n{\n  //Starting thread 1....\n  Thread t1 = new Thread(new ThreadStart(action1));\n  t1.Start();\n\n  // Now, I want for the main thread (which is calling `StartTheActions` method) \n  // to wait for `t1` to finish. I've created an event in `action1` for this. \n  // The I wish `t2` to start...\n\n  Thread t2 = new Thread(new ThreadStart(action2));\n  t2.Start();\n}\n</code></pre>\n\n<p>So, essentially, my question is how to have a thread wait for another one to finish. What is the best way to do this?</p>\n"},{"tags":["c#","multithreading","abort"],"answer_count":7,"favorite_count":3,"up_vote_count":10,"down_vote_count":1,"view_count":18205,"score":9,"question_id":1051838,"title":"Killing a thread (C#)","body":"<p>I have created a thread running a certain method. But sometimes I would like to kill the thread even if it is still working. How can I do this? I tried Thread.Abort() but it shows up a messagebox saying \"Thread aborted\". What should I do? </p>\n"},{"tags":["c#","asp.net","multithreading","design-patterns","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":90,"score":-1,"question_id":12653804,"title":"ASP NET C# : Singleton with in Queue and thread worker on it","body":"<p>I need to create a single class instance in web application that manage a queue of process. This class have multiple thread inside that look for queue and consume it.\nWhat is the best why to do this?</p>\n\n<p>I have apply singleton design pattern, but I don't understand if have to create static or normal queue inside it. Some one can give me an example please?</p>\n\n<p><strong>SOLUTION</strong></p>\n\n<p>Ok thank you! This is my singleton class:</p>\n\n<pre><code>    public sealed class MyWorkingSingletonClass\n    {\n\n    private static readonly ILog LOG = LogManager.GetLogger(typeof(MyWorkingSingletonClass));\n    private static MyWorkingSingletonClass instanza;\n    private static readonly object lockObject = new object();\n    private static ConcurrentQueue&lt;Process&gt; syncCoda = new ConcurrentQueue&lt;Process&gt;();\n\n    private MyWorkingSingletonClass()\n    {\n    }\n\n    public static MyWorkingSingletonClass Instanza\n    {\n        get\n        {\n            lock (lockObject)\n            {\n                if (instanza == null)\n                    instanza = new PdfDucumentConverter();\n                return instanza;\n            }\n        }\n    }\n\n\n\n    public void AddProcess(Process p)\n    {\n        syncCoda.Enqueue(p);\n    }\n\n    public void Start()\n    {\n        Task.Factory.StartNew(WorkerTask2);\n    }\n\n    public static void WorkerTask2()\n    {\n\n        do\n        {\n            try\n            {\n                Process p;\n                if (syncCoda.TryDequeue(out p))\n                {\n                    p.Start();\n                    p.PriorityClass = ProcessPriorityClass.High;\n                    p.WaitForExit();\n                }\n            }\n            catch (Exception ex)\n            {\n                LOG.Error(ex);\n            }\n        } while (true);\n    }\n\n    }\n</code></pre>\n"},{"tags":["c#","multithreading","variables"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12703809,"title":"Change Properties on a Form from a running Thread C#","body":"<p>I found that running a thread is really isolated to a big degree from the main application. You cant change variables (globally declared in your class) and you cant change form properties or anything by simply giving them new values within your thread.</p>\n\n<p>When a thread runs, How would you go about changing the text in a label from inside the thread?</p>\n\n<p>I don't think locking the value is necessary since its not used in the main program, so deadlocks wont occur.</p>\n\n<p>What i tried, that failed.</p>\n\n<p>Having a Global variable (int = 0)</p>\n\n<p>Running a test thread to change the variable to 5.</p>\n\n<p>When i want to display that number <strong>outside my thread</strong> (messagebox.show(int.tostring()) the var is still 0</p>\n\n<p>How would you go about changing things in/on your main form from within a thread?</p>\n\n<p><strong>Code</strong></p>\n\n<p><em>This code to create a thread i did not use was this.</em></p>\n\n<pre><code>        Thread threadA = new Thread(new ThreadStart(DoWork));\n        threadA.Start();\n</code></pre>\n\n<p>When i use that way, i get the error</p>\n\n<p>\"Cross-thread operation not valid: Control 'button1' accessed from a thread other than the thread it was created on\"</p>\n\n<p>When i try to edit or change something on my thread.</p>\n\n<p>So i used this code.</p>\n\n<p><em>the lbldirectory is the name of my partial class.</em></p>\n\n<pre><code>            // StartFileCheckProcess();\n            workerObject = new lbldirectory(); \n            workerThread = new Thread(workerObject.DoWork);\n\n            // the worker thread.\n            workerThread.Start();\n</code></pre>\n\n<p>DoWork is my class where i try and change the properties on the Form.</p>\n\n<p>This is the DoWork class. Its really a plain class, but its just to understand the why this happens, and for other people just to understand the reason why and how they can overcome this.</p>\n\n<pre><code>public void DoWork()\n        {\n            button1.Text = \"Hello there\";\n        }\n</code></pre>\n\n<p>So that runs the thread, and the thread works, it just cant change anything on my form.</p>\n\n<p><em><strong>MODIFIED ANSWER</em></strong> (Given by Tudor and Konstantin Vasilcov)</p>\n\n<p>On a button click event.</p>\n\n<pre><code>var t = new Thread(TEST);\n    t.Start();\n</code></pre>\n\n<p>The class that the thread starts</p>\n\n<pre><code>private void TEST()\n            {\n                for (int i = 0; i &lt; 10; i++)\n                {\n                    lbl_CurrentFile.BeginInvoke(\n                    ((Action)(() =&gt; lbl_CurrentFile.Text = i.ToString())));\n                    Thread.Sleep(1000);\n                }\n            }\n</code></pre>\n\n<p>That successfully changes the text of a label inside a thread</p>\n"},{"tags":["android","multithreading","handler","runnable","ui-thread"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12279100,"title":"run code in a non-UI thread android","body":"<p>I have an image application and I'm playing music while the images are displayed.\nRight now, I have both the functionality in the UI thread.</p>\n\n<p>I want to move the music playback part of it into another thread that is different from the UI thread.</p>\n\n<p>How do I achieve this?</p>\n\n<p>The complication if I use handlers and runnables:</p>\n\n<p>the run() has to have everything that is to be executed\nbut the music code is scattered all over the place because it is event based and there's a different piece of code to execute each time</p>\n\n<p>so the only way i can implement this with handler and runnable is if I have several runnables each doing a particular function\nwhich means that all the music code will not run in the same thread, they would run in different threads\nwhich is not a good thing.</p>\n\n<p>So how do you do this?</p>\n"},{"tags":["c++","multithreading","pthreads"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":118,"score":3,"question_id":12685112,"title":"pthreads: thread starvation caused by quick re-locking","body":"<p>I have a two threads, one which works in a tight loop, and the other which occasionally needs to perform a synchronization with the first:</p>\n\n<pre><code>// thread 1\nwhile(1)\n{\n    lock(work);\n    // perform work\n    unlock(work);\n}\n\n// thread 2\nwhile(1)\n{\n    // unrelated work that takes a while\n    lock(work);\n    // synchronizing step\n    unlock(work);\n}\n</code></pre>\n\n<p>My intention is that thread 2 can, by taking the lock, effectively pause thread 1 and perform the necessary synchronization. Thread 1 can also offer to pause, by unlocking, and if thread 2 is not waiting on lock, re-lock and return to work.</p>\n\n<p>The problem I have encountered is that mutexes are not fair, so thread 1 quickly re-locks the mutex and starves thread 2. I have attempted to use <code>pthread_yield</code>, and so far it seems to run okay, but I am not sure it will work for all systems / number of cores. Is there a way to guarantee that thread 1 will always yield to thread 2, even on multi-core systems?</p>\n\n<p>What is the most effective way of handling this synchronization process?</p>\n"},{"tags":["multithreading","process","operating-system"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12702523,"title":"Threads and Processes","body":"<p>I am trying to revise my Operating System concepts, but I had some confusions. I know that a process is a thread with its own address space. </p>\n\n<p>1) Are deadlocks only caused by threads or processes? (Threads share the process's stack, where as different processes have different stacks).</p>\n\n<p>2) Can a single process cause a deadlock? or does it take more than one process for a deadlock to occur?</p>\n\n<p>I am not sure if this is the right place to ask this. If not, please let me know and I will delete the question. </p>\n"},{"tags":["java","multithreading"],"answer_count":7,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":12638038,"title":"java multiple thread isalive or not","body":"<p>this way i am generating threads,but after for loop how to check that all threads are alive or not<br>\nfurther process depends on the all threads <br>\nif threads are <code>dead</code> then go for further process</p>\n\n<pre><code>for (int i = 0;i&lt;List.size();i++) {\n                if(List.get(i).trim().length() &gt;0 ){\n\n                    Thread thread = new Thread(\"Thread\"+i){\n                        public void run(){              \n                            threading(List.get(i),ctx,userSesionObj);\n                        }\n                      };\n                      thread.start();\n                }\n            }\n</code></pre>\n\n<p>here <code>threading</code> is my function which perform on different data that i pass</p>\n"},{"tags":["python","multithreading","popen"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12697908,"title":"Call to POPEN causes hang inside thread","body":"<p>My code seems to hang on this popen call</p>\n\n<pre><code>command = \"ls\"\ncommandList = shlex.split(command)\nprint(\"Executing \" + command +\"\\n\")\nprint(commandList)\noutput = \"#\" * 10 + \"\\n\" + server.name + \"\\n\\n\"\nprocess = subprocess.Popen(\n    command,\n    shell=True,\n    stdin=subprocess.PIPE, \n    stdout=subprocess.PIPE)\noutput = process.communicate()[0]\n#scriptRunner.threadComplete(output)\nreturn output\n</code></pre>\n\n<p>The code is in the <code>executeScriptOverSSH</code> method on the <code>SshWorker</code></p>\n\n<pre><code>class WorkerThread(threading.Thread):\n    def __init__(self, pathToScript, server, runner):\n        super(WorkerThread, self).__init__()\n        self.scriptRunner = runner\n        self.server = server\n        self.pathToScript = pathToScript\n        self.sshWorker = SshWorker.SshWorker()\n\n    def run(self):\n        print('Thread Starting')\n        output = self.sshWorker.executeScriptOverSSH(\n            self.server, \n            self.pathToScript)\n        print('Thread Finishing!')\n        self.scriptRunner.threadComplete(output)`\n</code></pre>\n\n<p>The threads never get past the call to <code>Popen</code> -- I've checked by using print statements there. Any ideas?</p>\n"},{"tags":["c#","multithreading",".net-4.5"],"answer_count":5,"favorite_count":5,"up_vote_count":6,"down_vote_count":0,"view_count":876,"score":6,"question_id":11638821,"title":"c# .net 4.5 async / multithread?","body":"<p>I'm writing a C# console application that scrapes data from web pages. </p>\n\n<p>This application will go to about 8000 web pages and scrape data(same format of data on each page).  </p>\n\n<p>I have it working right now with no async methods and no multithreading.</p>\n\n<p>However, I need it to be faster. It only uses about 3%-6% of the CPU, I think because it spends the time waiting to download the html.(WebClient.DownloadString(url))</p>\n\n<p>This is the basic flow of my program</p>\n\n<pre><code>DataSet alldata;\n\nforeach(var url in the8000urls)\n{\n    // ScrapeData downloads the html from the url with WebClient.DownloadString\n        // and scrapes the data into several datatables which it returns as a dataset.\n    DataSet dataForOnePage = ScrapeData(url);\n\n    //merge each table in dataForOnePage into allData\n}\n\n//\nPushAllDataToSql(alldata);\n</code></pre>\n\n<p>Ive been trying to multi thread this but am not sure how to properly get started. I'm using .net 4.5 and my understanding is async and await in 4.5 are made to make this much easier to program but I'm still a little lost.</p>\n\n<p>My idea was to just keep making new threads that are async for this line</p>\n\n<pre><code>    DataSet dataForOnePage = ScrapeData(url);\n</code></pre>\n\n<p>and then as each one finishes, run </p>\n\n<pre><code>    //merge each table in dataForOnePage into allData\n</code></pre>\n\n<p>Can anyone point me in the right direction on how to make that line async in .net 4.5 c# and then have my merge method run on complete?</p>\n\n<p>Thank you.</p>\n\n<p>Edit: Here is my ScrapeData method:</p>\n\n<pre><code>public static DataSet GetProperyData(CookieAwareWebClient webClient, string pageid)\n        {\n            var dsPageData = new DataSet();\n\n            // DOWNLOAD HTML FOR THE REO PAGE AND LOAD IT INTO AN HTMLDOCUMENT\n            string url = @\"https://domain.com?&amp;id=\" + pageid + @\"restofurl\";\n            string html = webClient.DownloadString(url);\n            var doc = new HtmlDocument();\n            doc.LoadHtml(html );\n\n            // A BUNCH OF PARSING WITH HTMLAGILITY AND STORING IN dsPageData \n            return dsPageData ;\n        }\n</code></pre>\n"},{"tags":["c","multithreading","optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":12683200,"title":"cost on blocked operation was increased by the number of thread","body":"<p>I've written a program that executes some calculations and then merges the results.<br>\n<br>\nI've used multi-threading to calculate in parallel.<br>\n<br>\nDuring the phase of merge result, each thread will lock the global array, and then append individual part to it, and some extra work will be done to eliminate the repetitions.<br>\n<br>\nI test it and find that the cost on merging increases with the number of threads, and the rate is unexpected:<br>\n<br>\n2 thread: 40,116,084(us)<br>\n6 thread:511,791,532(us)<br>\n<br>\nWhy: what occurs when the number of threads increases? How do I change this?<br>\n<br>\n--------------------------slash line -----------------------------------------------------<br>\n<br>\nActually, the code was very simply, there is the pseudo-code:<br>\n<br>\ntypedef my_object{<br> \nlong no;<br> \nint count;<br>\ndouble value;<br> \n//something others <br>\n} my_object_t;<br>\n<br>\nstatic my_object_t** global_result_array; //about ten thounds<br>\n<br>\nstatic pthread_mutex_t global_lock;<br>\n<br>\nvoid* thread_function(void* arg){ <br>\nmy_object_t** local_result;<br>\nint local_result_number;<br> \nint i;<br> \nmy_object_t* ptr;<br> \nfor(;;){<br> \nif( exit_condition ){ return NULL;}<br> \nif( merge_condition){<br>\n//start time point to log<br> \npthread_mutex_lock( &amp;global_lock);<br> \nfor( i = local_result_number-1; i>=0 ;i++){<br> \nptr = local_result[ i] ;<br> \nif( NULL == global_result_array[ ptr->no] ){<br> \nglobal_result_array[ ptr->no] = ptr; //step 4 <br>\n}else{ <br>\nglobal_result_array[ ptr->no] -> count += ptr->count; // step 5 <br>\nglobal_result_array[ ptr->no] -> value += ptr->value; // step 6 <br>\n}<br> \n}<br> \npthread_mutex_unlock( &amp;global_lock); // end time point to log <br>\n}else{ <br>\n//do some calculation and produce the partly and thread-local result ,namely the local_result and local_result_number <br>\n}<br> \n}<br> \n}<br></p>\n\n<p><br>\nAs above, the difference between two threads and six threads are step 5 and step6, i has counted that there were about hundreds millions order of execution of step 5 and 6. The others are same.<br>\nSo, from my view, the merge operation was very light, in spite of using 2 thread or 6 thread, they both need to lock and do merge exclusively.<br>\nAnother astonished thing was : when using six thread, the cost on step 4 was boomed! It was the boot reason that the total cost was boomed!<br>\n<br>\nbtw: The test server has two cpus ,each cpu has four cores.<br></p>\n"},{"tags":["c","multithreading","visual-studio-2010","openmp"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12684149,"title":"Using thread private variables in dynamic DLLs?","body":"<p>I am looking for some advice about OpenMP. I am confused about the use of threadprivate variables. The problem can be presented in the following example:</p>\n\n<pre><code>-----------\n\n// The code below is located the dynamically loaded DLL.\n/* Global variable. */\nint *p;\n#pragma omp threadprivate(p)\n\nextern \"C\" __declspec(dllexport) int MyFunc1(void)\n{\n  int i;\n  #pragma omp parallel for\n  for (i = 0; i &lt; n; i++) {\n     MyFunc2(i);\n  }\n   return TRUE;\n}\n\nvoid MyFunc2(void)\n{\n    p  = malloc(sizeof(int));\n   *p  = 0;\n    printf(“value = %d”,*p);\n    free(p);\n}\n\n-----------\n</code></pre>\n\n<p>Here I want each thread to have a separate copy of a global thread-independent variable that will be visible in all functions of the thread. The variable will be initialized and destroyed within the thread.</p>\n\n<p>The “problem” here is that all code including definition of the global variable “p” is located the dynamically loaded DLL (via LoadLibrary).  </p>\n\n<p>Microsoft says<a href=\"http://msdn.microsoft.com/en-us/library/2z1788dd.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/2z1788dd.aspx</a>: <em>“You cannot use threadprivate in any DLL that will be loaded via LoadLibrary. This includes DLLs that are loaded with /DELAYLOAD (Delay Load Import), which also uses LoadLibrary.”</em> So, if I got it right, the above code is not correct – threadprivate variables and dynamically loaded DLL do not mix.</p>\n\n<p>To verify this I created a test project that dynamically loads a DLL add runs a function in parallel using threadprivate as described above. It all worked just fine! </p>\n\n<p>Hmmm ... Now I am confused because that project was not supposed to work.</p>\n\n<p>Can I really use thread private variables in dinamic DLLs or is there a trick to this?</p>\n\n<p>Thank you,</p>\n\n<p>Alex</p>\n"},{"tags":["java","multithreading","synchronization","thread-safety","synchronized"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12699757,"title":"How to individually synchronize data members","body":"<p>I have been searching the web for this, but have been unable to find any article that comes close to this, and I'm quite surprised by that. Maybe the wisdom is hidden somewhere that I have yet to find.</p>\n\n<p>Suppose I have a class with 10 members of various types (for the sake of simplicity, let's say they are mixed of ints and Strings), and each one of them has its own accessor methods. Now, I want to make this class thread-safe. But, some of these data members don't necessarily interact with each other. For example the class <code>Person</code> below, has <code>age</code> and <code>name</code> and other properties.</p>\n\n<pre><code>public class Person {\n    private volatile int age;\n    private String name;\n    private volatile long blabla;\n    // ... and so on\n\n    public synchronized int getAge() {\n        return age;\n    }\n\n    public synchronized void setAge(int age) {\n        this.age = age;\n    }\n\n    // .. and so on for each data member\n}\n</code></pre>\n\n<p>One thread may only need to read/write <code>age</code>, and other threads only need to modify <code>name</code>.  Obviously, adding <code>synchronized</code> to each and every one of the accessor methods is a bad idea as it locks the entire instance of the object. A thread that's calling <code>getAge()</code> has to wait for another thread that's calling <code>getName()</code> even though <code>age</code> and <code>name</code> are two separate fields.</p>\n\n<p>So, one obvious solution is to create a lock for each field (or add <code>volatile</code> to primitive types).  However, this seems to be an overkill. If I have 10 data members, do I also need 10 locks?  I'm wondering if there's another way of achieving this without excessive locking.</p>\n"},{"tags":["android","multithreading","android-service"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":12574273,"title":"Android service starts ramdomly/automatically","body":"<p>I have an android service, I bound it to an activity, and unbound on destroy. The problem is, it starts out of nothing when the application is closed, sometimes when I turn on the device, sometimes ramdomly, I know it starts 'cause of a toast message. Lets get to the code...</p>\n\n<p>Activity onCreate</p>\n\n<pre><code>Intent intent = new Intent(this, Sincronizacao.class);\nthis.bindService(intent, mConnection, Context.BIND_AUTO_CREATE);\nthis.startService(intent);\n</code></pre>\n\n<p>The code for mConnection</p>\n\n<pre><code>private ServiceConnection mConnection = new ServiceConnection() {\n    public void onServiceConnected(ComponentName className, IBinder service) {\n        serviceBound = true;\n        localBinder = (LocalBinder&lt;Sincronizacao&gt;) service;\n    }\n    public void onServiceDisconnected(ComponentName className) {\n        serviceBound = false;\n        localBinder = null;\n    }\n};\n</code></pre>\n\n<p>And on destroy</p>\n\n<pre><code>@Override\nprotected void onDestroy() {\n    super.onDestroy();\n    if (serviceBound &amp;&amp; mConnection != null) {\n        unbindService(mConnection);\n    }\n    Intent intent = new Intent(this, Sincronizacao.class);\n    stopService(intent);\n    localBinder = null;\n}\n</code></pre>\n\n<p>In my service, onStartCommand is implemented, in there I start out a thread wich query a web service and insert data into a database, the thread has a while(true), I simply interrupt it onDestroy method of the service...</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>Here's the manifest line</p>\n\n<pre><code>android:name=\"com.company.package.service.Sincronizacao\" /&gt;\n</code></pre>\n\n<p>I'm struggling in this bug for some time already, hope you can help me.</p>\n\n<p>Thanks,</p>\n"},{"tags":["java","multithreading","executorservice"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12691526,"title":"Is there anything wrong with my ExecutorService code?","body":"<p>So I've written a block of code that will submit an array of objects through a task handler, I had an instance come up where the program crashed and did not close properly... Will this code do what I'm thinking it should?</p>\n\n<p>In my mind the following code should take an object, pass it to a handler, and then wait until a maximum of 30s has passed, and if that thread hasn't completed, kill it.   Right?</p>\n\n<pre><code> //Iterate through the array to submit them into individual running threads.\n    ExecutorService threadPool = Executors.newFixedThreadPool(12);\n    List&lt;Future&lt;?&gt;&gt; taskList = new ArrayList&lt;Future&lt;?&gt;&gt;();\n    for (int i = 0; i &lt; objectArray.length; i++) {\n        Future&lt;?&gt; task = threadPool.submit(new ThreadHandler(objectArray[i], i));\n        taskList.add(task);\n        Thread.sleep(500);\n    }\n\n    //Event handler to kill any threads that are running for more than 30 seconds (most threads should only need .25 - 1 second to complete.\n    for(Future future : taskList){\n        try{\n            future.get(30, TimeUnit.SECONDS);\n        }catch(CancellationException cx){ System.err.println(\"Cancellation Exception: \"); cx.printStackTrace();\n        }catch(ExecutionException ex){ System.err.println(\"Execution Exception: \");ex.printStackTrace();\n        }catch(InterruptedException ix){ System.err.println(\"Interrupted Exception: \");ix.printStackTrace();\n        }\n    }\n    threadPool.shutdown(); // SHUT. DOWN. EVERYTHING.\n</code></pre>\n"},{"tags":["python","multithreading","timeout","subprocess"],"answer_count":15,"favorite_count":32,"up_vote_count":44,"down_vote_count":0,"view_count":22749,"score":44,"question_id":1191374,"title":"subprocess with timeout","body":"<p>Here's the Python code to run an arbitrary command returning its <code>stdout</code> data, or raise an exception on non-zero exit codes:</p>\n\n<pre><code>proc = subprocess.Popen(\n    cmd,\n    stderr=subprocess.STDOUT,  # merge stdout and stderr\n    stdout=subprocess.PIPE,\n    shell=True)\n</code></pre>\n\n<p><code>communicate</code> is used to wait for the process to exit:</p>\n\n<pre><code>stdoutdata, stderrdata = proc.communicate()\n</code></pre>\n\n<p>The <code>subprocess</code> module does not support timeout--ability to kill a process running for more than X number of seconds--therefore, <code>communicate</code> may take forever to run. </p>\n\n<p>What is the <strong>simplest</strong> way to implement timeouts in a Python program meant to run on Windows and Linux?</p>\n"},{"tags":["python","multithreading","multiprocessing"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12696979,"title":"Python - start two processes to run indefinitely","body":"<p>I have a simple example script constructed that defines three separate processes using <code>multiprocessing</code> in python.  My objective is to have one parent thread that spawns two smaller threads that will collect and process data.</p>\n\n<p>Currently, my implementation looks like this:</p>\n\n<pre><code>from Queue import Queue,Empty\nfrom multiprocessing import Process\nimport time\nimport hashlib\n\n\nclass FillQueue(Process):\n    def __init__(self,q):\n        Process.__init__(self)\n        self.q = q\n\n    def run(self):\n        i = 0\n        while i is not 5:\n            print 'putting'\n            self.q.put('foo')\n            i+=1\n        self.q.put('|STOP|')\n\nclass ConsumeQueue(Process):\n    def __init__(self,q):\n        Process.__init__(self)\n        self.q = q\n\n    def run(self):\n        print 'Consume'\n        while True:\n            try:\n                value =  self.q.get(False)\n                print value\n                if value == '|STOP|':\n                    print 'done'\n                    break;\n            except Empty:\n                print 'Nothing to process atm'\n\nclass Ripper(Process):\n\n    q = Queue()\n\n    def __init__(self):\n        self.fq = FillQueue(self.q)\n        self.cq = ConsumeQueue(self.q)\n        self.fq.daemon = True\n        self.cq.daemon = True\n\n    def run(self):\n        try:\n            self.fq.start()\n            self.cq.start()\n        except KeyboardInterrupt:\n            print 'exit'\n\nif __name__ == '__main__':\n    r = Ripper()\n    r.start()\n</code></pre>\n\n<p>As it runs presently, the output from the script on CLI looks like this:</p>\n\n<pre><code>putting\nputting\nputting\nputting\nputting\nConsume\nfoo\nfoo\nfoo\nfoo\nfoo\n|STOP|\ndone\n</code></pre>\n\n<p>Obviously, the way I am starting my two threads is blocking, since the consumer doesn't even begin to process the items in the queue until the filler finishes adding items. </p>\n\n<p>How should I rewrite this to make both threads begin immediately and not block, so the consumer will simply pass to the <code>Empty</code> except block while there is no work to process, but will exit completely when it receives the stop message?</p>\n\n<p>EDIT: typo, had the <code>start</code> and <code>run</code> methods mixed up</p>\n"},{"tags":["c#","multithreading","asynchronous","locking","cross-threading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12532877,"title":"Asynchronously add value to Bindinglist/Cross-threading & Locking issue","body":"<p>I have a BindingList databound to a datgridview. I'm using it to keep track of some real-time prices. The method 'update(Quote quote)' is called multiple times a second by various threads. If the datagridview doesn't contain the Quote, it is added. If it does, the values of the quote are updated. I don't want the same quote to appear in the BindingList (or on the GUI) twice, so I tried to put a lock around the operation that checks whether the value is in the list or not. It doesn't work! What am I doing wrong? I've tried two different ways of locking, and am locking on a String object rather than just an object. The problem is definitely in the <code>BeginInvoke(new MethodInvoker(delegate() { activeQuotes.Insert(0, quote); }));</code> call (which is probably taking some time), but if I make that synchronous, the 'add' method throws a 'cross-threading' error. . . What can I do to avoid the cross-threading error, but ensure that the lock works also??</p>\n\n<pre><code>public BindingList&lt;Quote&gt; activeQuotes = new BindingList&lt;Quote&gt;();\nobject lockObject = \"lockObject\";\n\ndataGridViewActive.DataSource = activeQuotes;\n\n\npublic void update(Quote quote)\n{\n//lock (lockObject)\nif(Monitor.TryEnter(lockObject))\n{\ntry\n   {\n    if (!activeQuotes.Contains(quote))\n    {\n       try\n       {\n          activeQuotes.Add(quote);\n          AddQuote(quote);\n       }\n       catch (Exception ex)\n       {\n          Console.WriteLine(\"Datagridview!!!!!!\");\n       }\n     }\n else\n {\n   int index = activeQuotes.IndexOf(quote);\n   activeQuotes[index].Bid = quote.Bid;\n   activeQuotes[index].Ask = quote.Ask;\n   activeQuotes[index].Mid = quote.Mid;\n   activeQuotes[index].Spread = quote.Spread;\n   activeQuotes[index].Timestamp = quote.Timestamp;\n}\nfinally\n{\n    Monitor.Exit(lockObject);\n}\n}\n\nprivate void AddQuote(Quote quote)\n{\n     if (this.InvokeRequired)\n     {\n                BeginInvoke(new MethodInvoker(delegate() { activeQuotes.Insert(0, quote); }));\n                BeginInvoke(new MethodInvoker(delegate() { dataGridViewActive.Refresh(); }));\n                BeginInvoke(new MethodInvoker(delegate() { dataGridViewActive.AutoResizeColumns(DataGridViewAutoSizeColumnsMode.AllCells); }));\n    }\n    else\n    {\n                activeQuotes.Add(quote);\n                dataGridViewActive.Refresh();\n                dataGridViewActive.AutoResizeColumns (DataGridViewAutoSizeColumnsMode.AllCells);\n     }\n}\n</code></pre>\n\n<p>I'd appreciate any help at all on this. </p>\n\n<p>Thanks.</p>\n"},{"tags":["multithreading","perl","filehandle"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":66,"score":-1,"question_id":12696375,"title":"perl share filehandle with threads","body":"<p>I've found the code below online, it seems the way the program control the loop is to check the shared variable $TERM is 0 or not. Can I share a filehandle between threads, that every thread deal with one line of a file and loop ends when the file reaches the last line? </p>\n\n<pre><code>#!/usr/bin/perl\n\nuse strict;\nuse warnings;\n\nuse threads 1.39;\nuse threads::shared;\nuse Thread::Queue;\n\n### Global Variables ###\n\n# Maximum working threads\nmy $MAX_THREADS = 10;\n\n# Flag to inform all threads that application is terminating\nmy $TERM :shared = 0;\n\n# Threads add their ID to this queue when they are ready for work\n# Also, when app terminates a -1 is added to this queue\nmy $IDLE_QUEUE = Thread::Queue-&gt;new();\n\n\n### Signal Handling ###\n\n# Gracefully terminate application on ^C or command line 'kill'\n$SIG{'INT'} = $SIG{'TERM'} =\n    sub {\n        print(\"&gt;&gt;&gt; Terminating &lt;&lt;&lt;\\n\");\n        $TERM = 1;\n        # Add -1 to head of idle queue to signal termination\n        $IDLE_QUEUE-&gt;insert(0, -1);\n    };\n\n\n### Main Processing Section ###\nMAIN:\n{\n    ### INITIALIZE ###\n\n    # Thread work queues referenced by thread ID\n    my %work_queues;\n\n    # Create the thread pool\n    for (1..$MAX_THREADS) {\n        # Create a work queue for a thread\n        my $work_q = Thread::Queue-&gt;new();\n\n        # Create the thread, and give it the work queue\n        my $thr = threads-&gt;create('worker', $work_q);\n\n        # Remember the thread's work queue\n        $work_queues{$thr-&gt;tid()} = $work_q;\n    }\n\n\n    ### DO WORK ###\n\n    # Manage the thread pool until signalled to terminate\n    while (! $TERM) {\n        # Wait for an available thread\n        my $tid = $IDLE_QUEUE-&gt;dequeue();\n\n        # Check for termination condition\n        last if ($tid &lt; 0);\n\n        # Give the thread some work to do\n        my $work = 5 + int(rand(10));\n        $work_queues{$tid}-&gt;enqueue($work);\n    }\n\n\n    ### CLEANING UP ###\n\n    # Signal all threads that there is no more work\n    $work_queues{$_}-&gt;enqueue(-1) foreach keys(%work_queues);\n\n    # Wait for all the threads to finish\n    $_-&gt;join() foreach threads-&gt;list();\n}\n\nprint(\"Done\\n\");\nexit(0);\n\n\n### Thread Entry Point Subroutines ###\n\n# A worker thread\nsub worker\n{\n    my ($work_q) = @_;\n\n    # This thread's ID\n    my $tid = threads-&gt;tid();\n\n    # Work loop\n    do {\n        # Indicate that were are ready to do work\n        printf(\"Idle     -&gt; %2d\\n\", $tid);\n        $IDLE_QUEUE-&gt;enqueue($tid);\n\n        # Wait for work from the queue\n        my $work = $work_q-&gt;dequeue();\n\n        # If no more work, exit\n        last if ($work &lt; 0);\n\n        # Do some work while monitoring $TERM\n        printf(\"            %2d &lt;- Working\\n\", $tid);\n        while (($work &gt; 0) &amp;&amp; ! $TERM) {\n            $work -= sleep($work);\n        }\n\n        # Loop back to idle state if not told to terminate\n    } while (! $TERM);\n\n    # All done\n    printf(\"Finished -&gt; %2d\\n\", $tid);\n}\n</code></pre>\n"},{"tags":["objective-c","multithreading","core-data","grand-central-dispatch","nsmanagedobjectcontext"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":182,"score":3,"question_id":12466823,"title":"Core Data Multithreading: Code Examples","body":"<p>I've been having <a href=\"http://stackoverflow.com/questions/12410131/hang-in-mergechangesfromcontextdidsavenotification-and-merge-conflicts\">problems</a> with my multi-threaded Core Data enabled app, and I figured I should take a hard look at what I'm doing and how.  Please let me know if the following should work.</p>\n\n<p>I have a singleton <code>DataManager</code> class that handles the Core Data stuff.  It has a property <code>managedObjectContext</code> that returns a different MOC for each thread.  So, given <code>NSMutableDictionary *_threadContextDict</code> (string thread names to contexts) and <code>NSMutableDictionary *_threadDict</code> (string thread names to threads), it looks something like this:</p>\n\n<pre><code>-(NSManagedObjectContext *)managedObjectContext\n{\n  if ([NSThread currentThread] == [NSThread mainThread])\n  {\n    MyAppDelegate *delegate = [[UIApplication sharedApplication] delegate];\n    return delegate.managedObjectContext; //MOC created in delegate code on main thread\n  }\n  else\n  {\n    NSString *thisThread = [[NSThread currentThread] description];\n    {\n      if ([_threadContextDict objectForKey:thisThread] != nil)\n      {\n        return [_threadContextDict objectForKey:thisThread];\n      }\n      else\n      {\n        NSManagedObjectContext *context = [[NSManagedObjectContext alloc]init];\n        MyAppDelegate *delegate = [[UIApplication sharedApplication] delegate];\n        [context setPersistentStoreCoordinator:delegate.persistentStoreCoordinator];\n        [_threadContextDict setObject:context forKey:thisThread];\n        [_threadDict setObject:[NSThread currentThread] forKey:thisThread];\n\n        //merge changes notifications\n        NSNotificationCenter *center = [NSNotificationCenter defaultCenter];\n        [center addObserver:self selector:@selector(mergeChanges:)\n            name:NSManagedObjectContextDidSaveNotification object:context];\n\n        return context;\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>In the <code>mergeChanges</code> method, I merge the changes from the incoming notification to all contexts except the one that generated the notification.  It looks like this:</p>\n\n<pre><code>-(void)mergeChanges:(NSNotification *)notification\n{\n  MyAppDelegate *delegate = [[UIApplication sharedApplication] delegate];\n  NSManagedObjectContext *context = delegate.managedObjectContext;\n  [context performSelectorOnMainThread:@selector(mergeChangesFromContextDidSaveNotification)\n     withObject:notification waitUntilDone:YES];\n\n  for (NSString *element in [_threadContextDict allKeys])\n  {\n    if (![element isEqualToString:[[NSThread currentThread] description]])\n    {\n      NSThread *thread = [_threadDict objectForKey:element];\n      NSManagedObjectContext *threadContext = [_threadContextDict objectForKey:element];\n      [threadContext performSelector:@selector(mergeChangesFromContextDidSaveNotification)\n         onThread:thread withObject:notification waitUntilDone:YES];\n    }\n  }\n}\n</code></pre>\n\n<p>Whenever I save changes on a MOC, it's done with a call to a <code>saveContext</code> method on this shared <code>DataManager</code>, which calls <code>save</code> on a context obtained from the aforementioned property:</p>\n\n<pre><code>-(void)saveContext\n{\n  NSManagedObjectContext *context = self.managedObjectContext;\n  NSError *err = nil;\n  [context save:&amp;err];\n  //report error if necessary, etc.\n}\n</code></pre>\n\n<p>Given my understanding of the Core Data multithreading rules, I feel like this should work.  I'm using a separate context for each thread, but the same persistent store for all of them.  But when I use this, I get a lot of merge conflicts, even though my threads aren't working on the same objects (<code>NSManagedObject</code> subclasses).  I'm just downloading data from the network, parsing the results, and saving them to Core Data.</p>\n\n<p>Am I doing something wrong?  I've tried using <code>NSLock</code> instances to lock around some things, but then I just get hangs.</p>\n\n<p><B>UPDATE/RESOLUTION</B>: I was able to make this work by adding one simple thing: a way to remove a thread/MOC pair from my dictionary when I'm finished with it.  At the end of each block in each call to <code>dispatch_async</code> where I do Core Data stuff, I call <code>[self removeThread]</code>, which removes the current thread and its MOC from the dictionary.  I also only merge changes to the main thread MOC.  Effectively, this means that every time I do work on a background thread, I get a fresh new MOC.</p>\n\n<p>I also distinguish threads by adding a number to <code>userInfoDict</code>, instead of calling <code>description</code>.  The number is obtained by a readonly property on my class that returns a higher number each time it's called.</p>\n"},{"tags":["c++","multithreading","sqlite"],"answer_count":4,"favorite_count":4,"up_vote_count":10,"down_vote_count":0,"view_count":4287,"score":10,"question_id":1680249,"title":"How to use SQLite in a multi-threaded application?","body":"<p>I'm developing an application with <a href=\"http://en.wikipedia.org/wiki/SQLite\">SQLite</a> as the database, and am having a little trouble understanding how to go about using it in multiple threads (none of the other Stack Overflow questions really helped me, unfortunately).</p>\n\n<p>My use case: The database has one table, let's call it \"A\", which has different groups of rows (based on one of their columns). I have the \"main thread\" of the application which reads the contents from table A. In addition, I decide, once in a while, to update a certain group of rows. To do this, I want to spawn a new thread, delete all the rows of the group, and re-insert them (that's the only way to do it in the context of my app). This might happen to different groups at the same time, so I might have 2+ threads trying to update the database.</p>\n\n<p>I'm using different transactions from each thread, I.E. at the start of every thread's update cycle, I have a begin. In fact, what each thread actually does is call \"BEGIN\", delete from the database all the rows it needs to \"update\", and inserts them again with the new values (this is the way it must be done in the context of my application).</p>\n\n<p>Now, I'm trying to understand how I go about implementing this. I've tried reading around (other answers on Stack Overflow, the SQLite site) but I haven't found all the answers. Here are some things I'm wondering about:</p>\n\n<ol>\n<li>Do I need to call \"open\" and create a new sqlite structure from each thread?</li>\n<li>Do I need to add any special code for all of this, or is it enough to spawn different threads, update the rows, and that's fine (since I'm using different transactions)? </li>\n<li>I saw something talking about the different lock types there are, and the fact that I might receive \"SQLite busy\" from calling certain APIs, but honestly I didn't see any reference that completely explained when I need to take all this into account. Do I need to?</li>\n</ol>\n\n<p>If anyone can answer the questions/point me in the direction of a good resource, I'd be very grateful.</p>\n\n<p><strong>UPDATE 1:</strong> From all that I've read so far, it seems like you can't have two threads who are going to write to a database file anyway.</p>\n\n<p>See: <a href=\"http://www.sqlite.org/lockingv3.html\">http://www.sqlite.org/lockingv3.html</a>. In section 3.0: A RESERVED lock means that the process is planning on writing to the database file at some point in the future but that it is currently just reading from the file. Only a single RESERVED lock may be active at one time, though multiple SHARED locks can coexist with a single RESERVED lock. </p>\n\n<p>Does this mean that I may as well only spawn off a single thread to update a group of rows each time? I.e., have some kind of poller thread which decides that I need to update some of the rows, and then creates a new thread to do it, but never more than one at a time? Since it looks like any other thread I create will just get SQLITE_BUSY until the first thread finishes, anyway.</p>\n\n<p>Have I understood things correctly?</p>\n\n<p>BTW, thanks for the answers so far, they've helped a lot.</p>\n"},{"tags":["c","multithreading","producer-consumer","lock-free","ring-buffer"],"answer_count":2,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":345,"score":6,"question_id":12264104,"title":"Looking for the right ring buffer implementation in C","body":"<p>I am looking for a ring buffer implementation (or pseudocode) in C with the following characteristics:</p>\n\n<ul>\n<li>multiple producer single consumer pattern (MPSC)</li>\n<li>consumer blocks on empty</li>\n<li>producers block on full</li>\n<li>lock-free (I expect high contention)</li>\n</ul>\n\n<p>So far I've been working only with SPSC buffers - one per producer - but I would like to avoid the continuous spinning of the consumer to check for new data over all its input buffers (and maybe to get rid of some marshaling threads in my system).</p>\n\n<p>I develop for Linux on Intel machines.</p>\n"},{"tags":["ios","multithreading","avfoundation","grand-central-dispatch","race-condition"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12658500,"title":"iOS: selectively disabling processing of captureOutput:didOutputSampleBuffer:fromConnection: from the main thread in AVFoundation","body":"<p>I need to selectively (and reliably) turn off processing of sampleBuffers in my <code>captureOutput:didOutputSampleBuffer:fromConnection:</code> method. As you know it's called from a GCD queue and not on the main thread... but I'm taking user input from a UIButton (on the main thread of course) and telling my camera object to halt all processing by setting a BOOL flag.</p>\n\n<p>However, sometimes I'm seeing 1 extra frame slip through the cracks after processing was supposedly stopped. Is there any way I can be absolutely sure that nothing will be processed after the button is pressed? Right now I'm doing a trivial test:</p>\n\n<pre><code>// in ViewController:\n- (IBAction)tappedStop:(id)sender {\n    NSLog(\"stop processing!\");\n    _camera.capturing = NO;\n}\n\n// in my camera obj:\n- (void)captureOutput:(AVCaptureOutput *)captureOutput did... {\n    if (!capturing) {\n        return;\n    }\n    NSLog(@\"processing!\");\n}\n</code></pre>\n\n<p>I've tried using @synchronized, a static BOOL, and using a semaphore, but to no avail... sometimes that extra frame still sneaks in. Anyone have and ideas? There's probably some GCD method that does what I want but I'm not sure how to go about it.</p>\n\n<p>Here's how the results (sometimes) look in my debug console (shortened to make it more readable):</p>\n\n<pre><code>2012-09-29 23:29:01.869 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.910 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.953 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.994 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.047 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.078 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.121 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.166 -[ViewController tappedButton:] [Line 913] stop processing!\n2012-09-29 23:29:02.161 __33-_block_invoke_0 [Line 322] processing!\n...\n</code></pre>\n\n<p>But usually (about 4 out of 5 times) my console looks like:</p>\n\n<pre><code>2012-09-29 23:29:01.869 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.910 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.953 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:01.994 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.047 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.078 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.121 __33-_block_invoke_0 [Line 322] processing!\n2012-09-29 23:29:02.166 -[ViewController tappedButton:] [Line 913] stop processing!\n</code></pre>\n\n<p>I should probably also mention that I don't have access to the original queue that's calling <code>captureOutput:didOutput...</code> since it's in a superClass of a framework that I can't control.</p>\n"},{"tags":["java","multithreading","fields"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12629408,"title":"Reading value from field variable","body":"<p>I am developing desktop app in Java 7. I have here a situation. At the method below</p>\n\n<pre><code>private synchronized void decryptMessage\n    (CopyOnWriteArrayList&lt;Integer&gt; possibleKeys, ArrayList&lt;Integer&gt; cipherDigits)\n{\n    // apply opposite shift algorithm:\n    ArrayList&lt;Integer&gt; textDigits = shiftCipher(possibleKeys, cipherDigits);\n\n    // count CHI squared statistics:\n    double chi = countCHIstatistics(textDigits);\n\n    if(chi &lt; edgeCHI) // if the value of IOC is greater or equal than that\n    {\n        System.err.println(chi + \" \" + possibleKeys + \" +\");\n        key = possibleKeys; // store most suitable key\n        edgeCHI = chi;\n    }       \n}\n</code></pre>\n\n<p>I count the value called 'chi' and based on that if 'chi' is less than 'edgeCHI' value I save the key at instance variable. That method is invoked by some threads, so I enforce synchronization.</p>\n\n<p>When all the threads complete the program continues to execute by passing control to a method which controls the sequence of operations. Then this line has been executed at that method:</p>\n\n<pre><code>System.err.println(edgeCHI+\" \"+key+\" -\"); \n</code></pre>\n\n<p>It prints correct value of 'chi', as has been printed the last value of 'chi' at <code>decryptMessage</code> method, but the value of key is different. The 'decryptMessage' method has been invoked by threads which generate key values.</p>\n\n<p>I store the key value as global variable\n <code>private volatile CopyOnWriteArrayList&lt;Integer&gt; key = null; // stores the most suitable key for decryption</code>.\nWhy do I have two different key values? The values itself are not important. The matter is that the value of key printed at the last call at 'decryptMessage' method (when chi &lt; edgeCHI) must match the one printed at the method which controls the flow of operations. \nThis is how you create <strong>threads</strong>:</p>\n\n<pre><code>for(int y = 0; y &lt; mostOccuringL.length; y++){// iterate through the five most frequent letters\n                for(int i = (y + 1); i &lt; mostOccuringL.length; i++ ){//perform letter combinations\n                    int [] combinations = new int[2];\n                    combinations[0] = y;\n                    combinations [1] = i;                   \n                    new KeyMembers(\"\"+y+\":\"+i ,combinations, keywords, intKeyIndex, cipherDigits).t.join();\n                }\n            }   \n</code></pre>\n\n<p>Within run method you invoke <em>decryptMesssage</em> method in order to identify most feasible decryption key.\nI have been trying to figure out what is the prob for two days, but I don't get it.\nSuggestions?</p>\n"},{"tags":["c#","multithreading","algorithm",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":12694037,"title":"Concurrent skiplist Read locking","body":"<p>I will try to make this question as generic as possible, but I will give a brief introduction to my actual problem - </p>\n\n<p>I am trying to implement a concurrent skiplist for a priority queue. Each 'node', has a value, and an array of 'forward' nodes, where node.forward[i] represents the next node on the i-th level of the skiplist. For write access (i.e. insertions and deletions), I use a Spinlock (still to determine if that is the best lock to use)</p>\n\n<p>My question is essentially, when I need a read access for a traversal,</p>\n\n<pre><code>node = node.forward[i]\n</code></pre>\n\n<p>What kind of thread safety do I need around something like this? If another thread is modifying node.forward[i] at exactly the same time that I read (with no current locking mechanism for read), what can happen here?</p>\n\n<p>My initial thought is to have a ReaderWriterLockSLim on the getter and setter of the indexer for Forward. Will there be too much unnecessary locking in this scenario?</p>\n\n<p>Edit: Or would it be best to instead use a Interlocked.Exchange for all of my reads?</p>\n"},{"tags":["java","android","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12693419,"title":"How to have the UI not blocked during long time operation?","body":"<p>I have a button, when user clicks it, it will update the entire UI(textview, graphs). The content of the UI comes from a SQLite database, I named the update function loading(). You could imagine, inside the loading(), there are lots of database operations and UI updates. \nWhen the size of the data getting bigger, the time for this loading() to be done is longer, so the button will stay in pressed state for a longer time. </p>\n\n<p>I tried to use <strong>asynctask</strong> to deal with this situation so that a progressdialog comes out instead of the button freezed, but I cannot place the loading() method on the doinbackground() of <strong>asynctask</strong> because doinbackground() cannot touch the UI components that are declared from the onCreate() method of its activity.</p>\n\n<p>I don't want to rewrite the loading() function.</p>\n\n<p>Any other way to do so?? Please help, and if you could, please provide some examples, I appreciate that.</p>\n"},{"tags":["java","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":801,"score":3,"question_id":3130701,"title":"killing a running thread in java?","body":"<p>How to kill a running thread in java</p>\n"},{"tags":["c#","multithreading","delegates"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12692032,"title":"Why do I get TargetInvocationException in my threaded C# application?","body":"<p>Here is the code (in a simple form):</p>\n\n<pre><code>delegate DataTable Functie();\nFunctie deleg;\n\nDataTable find1()\n{\n    return new DataTable();\n}\nDataTable find2()\n{\n    return new DataTable();\n}\n\n\nprivate void btnFind1_Click(object sender, EventArgs e)\n{\n    deleg = this.find2;\n    backgroundWorker1.RunWorkerAsync();\n}\n\n\nprivate void btnFind2_Click(object sender, EventArgs e)\n{\n    deleg = this.find1;\n    backgroundWorker1.RunWorkerAsync();\n}\n\nprivate void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)\n{\n    BackgroundWorker bk = sender as BackgroundWorker;\n    e.Result = deleg;\n\n    if (bk.CancellationPending)\n    {\n        e.Cancel = true;\n    }\n}\n\n\nprivate void backgroundWorker1_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n{\n    if (e.Cancelled)\n    {\n        MessageBox.Show(\"Operation was canceled\");\n    }\n    else if (e.Error != null)\n    {\n        MessageBox.Show(\"An error occurred: \" + e.Error.Message);\n    }\n    else\n    {\n        dataGridView1.DataSource = (DataTable)e.Result;\n    }\n}\n</code></pre>\n\n<p>So, basically I have 2 functions <code>find1</code> and <code>find2</code> and these are long-time-processing functions. I want to run these 2 functions on an <code>BackgroundThread</code> so I created a delegate. When i call one function, the delegate takes the address of a function or the other.\nWhen I start the thread, I pass the delegate instead of directly typing the function, so I won't create 2 background threads, each with its own events and stuff.\nBut I run into problems, when I run the program, the following error is thrown:</p>\n\n<pre><code>\"System.Reflection.TargetInvocationException was unhandled\nException has been thrown by the target of an invocation.\"\n</code></pre>\n\n<p>It has to do with the delegate passed to the thread. I can, of course, write everything simpler with conditions to see what functions has to be ran, but I got into this and I didn't know how to solve it. I want to know what I did wrong.</p>\n"},{"tags":["java","multithreading","threadpool"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12691786,"title":"Using daemon threads in a Java threadpool is not working","body":"<p>I have a Java threadpool created via <code>Executors.newFixedThreadPool()</code> that I want to use daemon threads.</p>\n\n<p>The reason is that this is a GUI app and I don't want these threads to cause the program to stay running after the Window is closed.</p>\n\n<p>I implemented a custom <code>ThreadFactory</code> that sets <code>Thread.setDaemon(true)</code> on the threads it creates.</p>\n\n<p>The class is this:</p>\n\n<pre><code>import java.util.concurrent.ThreadFactory;\n\npublic class DaemonThreadFactory implements ThreadFactory{\n\n    public Thread newThread(Runnable runnable){\n        Thread thread = new Thread();\n        thread.setDaemon(true);\n        return thread;\n    }\n\n}\n</code></pre>\n\n<p>For some reason when I use <code>DaemonThreadFactory</code> with <code>Executors.newFixedThreadPool()</code> none of my queued tasks are executed. If I change it back to regular <code>ThreadFactory</code> it works.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#","multithreading","visual-studio-2010","windows-services"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12691244,"title":"How to format a windows service with vs template?","body":"<p>Im creating a windows service in c# visual studio ultimate..\nvs gives a template to use but im not sure where to put my code. there is program.cs</p>\n\n<pre><code>static class Program\n{\n    static void Main()\n    {\n        ServiceBase[] ServicesToRun;\n        ServicesToRun = new ServiceBase[] \n        { \n            new Service1() \n        };\n        ServiceBase.Run(ServicesToRun);\n    }\n}\n</code></pre>\n\n<p>and service1.cs the sample code shows how im formatting it but im not sure that what im doing is right. ive searched quite a bit but cant find what way to structure my program</p>\n\n<pre><code>public partial class Service1 : ServiceBase\n{\n    Thread thread1;\n\n    public Service1()\n    {\n        InitializeComponent();\n\n        thread1 = new Thread(function);\n        thread1.Start();\n    }\n\n    protected override void OnStart(string[] args)\n    {\n    }\n\n    protected override void OnStop()\n    {\n    }\n\n    public void function()\n    {\n        while (true)\n        {\n            //keep doing something\n        }\n    }\n}\n</code></pre>\n\n<p>basically im asking where do i call the loop funtion? where ive placed it or from the main?\nthanks</p>\n"},{"tags":["java","multithreading","collections","arraylist"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12691055,"title":"Thread removing from arrayList and function inserting","body":"<p>As title states I have problem with thread based structure. What I need to do is:</p>\n\n<ul>\n<li><p>one thread running in loop and checking if there exists something in list and if so then performing some operation on object and then removing it from list</p></li>\n<li><p>function which is called from 'outside' and adding new objects to this list.</p></li>\n</ul>\n\n<p>here is my approach:</p>\n\n<pre><code>public class Queue implements Runnable {\n    private List&lt;X&gt; listOfObjects = new ArrayList&lt;X&gt;;\n\n    public void addToList(X toAdd){\n        listOfObject.add(toAdd);\n    }\n\n    public void run() {\n        while(true){\n            synchronized(listOfObjects){\n            if(!listOfObjects.isEmpty()){\n                listOfObjects.get(0).doSth();\n                listOfObjects.remove(0);\n            }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Is it proper approach? Should I also synchronize adding to this list?</p>\n"},{"tags":["c++","multithreading","thread-safety","game"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":137,"score":3,"question_id":12684844,"title":"Structuring and Synchronizing a Multithreaded Game Loop","body":"<p>I'm running into a mild conundrum concerning thread safety for my game loop. What I have below is 3 threads (including the main) that are meant to work together. One for event managing (main thread), one for logic, and one for the rendering. All 3 of these threads exist within their own class, as you can see below. In basic testing the structure works without problems. This system uses SFML and renders with OpenGL. </p>\n\n<pre><code>int main(){\n    Gamestate gs;\n    EventManager em(&amp;gs);\n    LogicManager lm(&amp;gs);\n    Renderer renderer(&amp;gs);\n\n    lm.start();\n    renderer.start();\n    em.eventLoop();\n\n    return 0;\n}\n</code></pre>\n\n<p>However, as you may have noticed I have a \"Gamestate\" class that is meant to act as a container of all the resources that need to be shared between the threads (mostly with LogicManager as a writer and Renderer as a reader. EventManager is mostly just for window events). My questions are: (1 and 2 being the most important)</p>\n\n<p>1) Is this a good way of going about things? Meaning is having a \"global\" Gamestate class a good idea to use? Is there a better way of going about it?</p>\n\n<p>2) My intention was to have Gamestate have mutexes in the getters/setters, except that doesn't work for reading because I can't return the object while it's still locked, which means I'd have to put synchronization outside of the getters/setters and make the mutexes public. It also means I'd have a bloody ton of mutexes for all the different resources. What is the most elegant way of going about this problem?</p>\n\n<p>3) I have all of the threads accessing \"bool run\" to check if to continue their loops</p>\n\n<pre><code>while(gs-&gt;run){\n....\n}\n</code></pre>\n\n<p>run gets set to false if I receive a quit message in the EventManager. Do I need to synchronize that variable at all? Would I set it to volatile?</p>\n\n<p>4) Does constantly dereferencing pointers and such have an impact on performance? eg gs->objects->entitylist.at(2)->move(); Do all those '->' and '.' cause any major slowdown?</p>\n"},{"tags":["java","multithreading","scheduler","thread-priority"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12689158,"title":"Threading: Max priority thread does not always completed first","body":"<pre><code>class A extends Thread {\n    public void run() {\n        for (int i = 1; i &lt; 5; i++) {\n            System.out.println(\"Thread A Loop NO \" + i);\n\n        }\n        System.out.println(\"Exit from A\");\n    }\n}\n\nclass B extends Thread {\n    public void run() {\n        for (int j = 1; j &lt; 5; j++) {\n            System.out.println(\"Thread B Loop no. \" + j);\n        }\n        System.out.println(\"Exit from B\");\n    }\n}\n\nclass C extends Thread {\n    public void run() {\n        for (int k = 1; k &lt; 5; k++) {\n            System.out.println(\"Thread C Loop no \" + k);\n        }\n        System.out.println(\"Exit Form c\");\n    }\n}\n\nclass Demo1 {\n    public static void main(String args[]) {\n        A a1 = new A();\n        B b1 = new B();\n        C c1 = new C();\n\n        c1.setPriority(Thread.MAX_PRIORITY);\n        a1.start();\n        b1.start();\n        c1.start();\n    }\n}  \n</code></pre>\n\n<p>I ran this program several times.\nSometimes the thread \"C\" with  max priority completes at the last\nDoes the max priority not ensure it to terminate first? I mean before any other thread exits from the loop?\nIf not what is the scheduler policy?</p>\n"},{"tags":["c++","multithreading"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":102,"score":1,"question_id":12689038,"title":"how to run a static function in a new thread?","body":"<p>After searching trough the forum, i came across some answers nevertheles I could not get a clear answer to how to run a static method in a new thread in c++. My main concern is what is the best way to start a thread?(Is it working also from inside of another thread?)\nwhich header is better to use? thread.h, pthread.h?</p>\n\n<p>I would like to create a new thread(when a given method is called) and call inside this thread another function...\nAny hints how I could approach this issue?</p>\n\n<p>Thank you guys very much in advance!</p>\n"},{"tags":["c#","multithreading","backgroundworker"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12687675,"title":"progressbar not progressing using backgroundworker","body":"<p>I am using a background worker to update some tables in sqlserver. the progressbar max is getting set to the correct value, the progressbar value is being incremented, the backgroundworker progresschanged is being called correctly with correct value, yet the bar is not progressing.</p>\n\n<p>here is the code for the form\nin the background_dowork method there is a loop which calls updateProgressBarValue which works with correct values.</p>\n\n<pre><code>public InterfaceConvertLonLat()\n{\n    InitializeComponent();\n    Shown += new EventHandler(Form1_Shown);\n    backgroundWorker1.WorkerReportsProgress = true;\n    backgroundWorker1.ProgressChanged += new ProgressChangedEventHandler(backgroundWorker1_ProgressChanged);\n    backgroundWorker1.DoWork += new DoWorkEventHandler(backgroundWorker1_DoWork);\n}\n\npublic void ConvertLonLat_Load(object sender, EventArgs e)\n{ \n}\n\npublic void updateProgressBarValue()\n{\n    progressBar1.Value++;\n    backgroundWorker1.ReportProgress(progressBar1.Value);\n}\n\npublic void setProgressBarMax(int max)\n{\n    progressBar1.Maximum = max;\n    MessageBox.Show(\"setprogressbarmax \" + max);\n}\n\npublic void Form1_Shown(object sender, EventArgs e)\n{     \n    backgroundWorker1.RunWorkerAsync();\n}\n\npublic void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)\n{\n    convert.OSGB36ToWGS84(\"paf\");\n}\n\npublic void backgroundWorker1_ProgressChanged(object sender, ProgressChangedEventArgs e)\n{\n    progressBar1.Value = e.ProgressPercentage;\n}\n</code></pre>\n\n<p>here is the loop contained in another class which calls updateprogressbarvalue, this is being fired and as stated backgroundworker1_progressChanged is being fired but the bar is not moving.</p>\n\n<pre><code>con.setProgressBarMax(address.Tables[0].Rows.Count); \n\nforeach (DataRow LonLat in address.Tables[0].Rows)\n{\n    con.updateProgressBarValue();\n    Double lon = 0;\n    Double lat = 0;\n    lat = Convert.ToDouble(LonLat[\"LTO\"]);\n    lon = Convert.ToDouble(LonLat[\"LGO\"]);\n    LocalToWGS84(ref lat, ref lon, OGB_M);\n\n    cmd1.Parameters[\"@LTW\"].Value = lat;\n    cmd1.Parameters[\"@LGW\"].Value = lon;\n\n    string dbQuery1 = \"update \" + tableName + \" set LTW = @LTW, LGW = @LGW\";\n\n    cmd1.CommandText = (dbQuery1);\n    cmd1.CommandType = CommandType.Text;\n    cmd1.Connection = conn;\n    cmd1.ExecuteNonQuery();\n}\n}\ncatch (Exception e)\n{\n    MessageBox.Show(\"error converting: \" + e.Message);\n}\nfinally\n{\n    conn.Close();\n}\n</code></pre>\n"}]}
{"total":30059,"page":20,"pagesize":100,"questions":[{"tags":["c++","multithreading","boost","atomic","lock-free"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1468,"score":2,"question_id":9450511,"title":"Lock-Free Queue with boost::atomic - Am I doing this right?","body":"<p><strong>Short version:</strong></p>\n\n<p>I'm trying to replace std::atomic from C++11 used in a lock-free, single producer, single consumer queue implementation from <a href=\"http://drdobbs.com/parallel/210604448\" rel=\"nofollow\">here</a>. How do I replace this with <a href=\"http://www.chaoticmind.net/~hcb/projects/boost.atomic/\" rel=\"nofollow\"><code>boost::atomic</code></a>?</p>\n\n<p><strong>Long version:</strong></p>\n\n<p>I'm trying to get a better performance out of our app with worker threads. Each thread has its own task queue. We have to synchronize using lock before dequeue/enqueue each task. </p>\n\n<p>Then I found Herb Sutter's article on lock-free queue. It seems like an ideal replacement. But the code uses <code>std::atomic</code> from C++11, which I couldn't introduce to the project at this time.</p>\n\n<p>More googling led to some examples, such as <a href=\"http://www.soa-world.de/echelon/2011/02/a-simple-lock-free-queue-in-c.html\" rel=\"nofollow\">this one for Linux (echelon's)</a>, and <a href=\"http://tinesware.blogspot.com/2009/07/simple-lockfree-queue-c-windows.html\" rel=\"nofollow\">this one for Windows (TINESWARE's)</a>. Both use platform's specific constructs such as WinAPI's <code>InterlockedExchangePointer</code>, and GCC's <code>__sync_lock_test_and_set</code>.</p>\n\n<p>I only need to support Windows &amp; Linux so maybe I can get away with some <code>#ifdef</code>s. But I thought it might be nicer to use what <code>boost::atomic</code> provides. Boost Atomic is not part of official Boost library yet. So I downloaded the source from <a href=\"http://www.chaoticmind.net/~hcb/projects/boost.atomic/\" rel=\"nofollow\">http://www.chaoticmind.net/~hcb/projects/boost.atomic/</a> and use the include files with my project.</p>\n\n<p>This is what I get so far:</p>\n\n<pre><code>#pragma once\n\n#include &lt;boost/atomic.hpp&gt;\n\ntemplate &lt;typename T&gt;\nclass LockFreeQueue\n{\nprivate:\n    struct Node\n    {\n        Node(T val) : value(val), next(NULL) { }\n        T value;\n        Node* next;\n    };\n    Node* first; // for producer only\n    boost::atomic&lt;Node*&gt; divider;  // shared\n    boost::atomic&lt;Node*&gt; last; // shared\n\npublic:\n    LockFreeQueue()\n    {\n        first = new Node(T());\n        divider = first;\n        last= first;\n    }\n\n    ~LockFreeQueue()\n    {\n        while(first != NULL) // release the list\n        {\n            Node* tmp = first;\n            first = tmp-&gt;next;\n            delete tmp;\n        }\n    }\n\n    void Produce(const T&amp; t)\n    {\n        last.load()-&gt;next = new Node(t); // add the new item\n        last = last.load()-&gt;next;\n        while(first != divider) // trim unused nodes\n        {\n            Node* tmp = first;\n            first = first-&gt;next;\n            delete tmp;\n        }\n    }\n\n    bool Consume(T&amp; result)\n    {\n        if(divider != last) // if queue is nonempty\n        {\n            result = divider.load()-&gt;next-&gt;value; // C: copy it back\n            divider = divider.load()-&gt;next;\n            return true;  // and report success\n        }\n        return false;  // else report empty\n    }\n};\n</code></pre>\n\n<p>Some modifications to note:</p>\n\n<pre><code>boost::atomic&lt;Node*&gt; divider;  // shared\nboost::atomic&lt;Node*&gt; last; // shared\n</code></pre>\n\n<p>and</p>\n\n<pre><code>    last.load()-&gt;next = new Node(t); // add the new item\n    last = last.load()-&gt;next;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>        result = divider.load()-&gt;next-&gt;value; // C: copy it back\n        divider = divider.load()-&gt;next;\n</code></pre>\n\n<p>Am I applying the load() (and the implicit store()) from boost::atomic correctly right here? Can we say this is equivalent to Sutter's original C++11 lock-free queue?</p>\n\n<p>PS. I studied many of the threads on SO, but none seems to provide an example for boost::atomic &amp; lock-free queue.</p>\n"},{"tags":["java","multithreading","interrupt"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12688928,"title":"Thread interrupt does not work","body":"<p>This is my first attempt at creating my own thread pool. The program works except when I try stopping all the threads.\nI'm trying to interrupt all the threads but for some reason it nevers reaches this segment:</p>\n\n<p>if (this.currentThread().isInterrupted())</p>\n\n<p>This is the output:</p>\n\n<p>All tasks added<br>\nTask 5 recieved by thread 0<br>\nThis is task #5<br>\nTask 4 recieved by thread 2<br>\nThis is task #4<br>\nTask 3 recieved by thread 1<br>\nThis is task #3<br>\nAll done, threadpool closed<br>\nTask 5 now being executed by thread 0<br>\nTask 2 recieved by thread 0<br>\nThis is task #2<br>\nTask 3 now being executed by thread 1<br>\nTask 1 recieved by thread 1<br>\nThis is task #1<br>\nTask 4 now being executed by thread 2<br>\nNo available tasks...<br>\nTask 1 now being executed by thread 1<br>\nNo available tasks...<br>\nTask 2 now being executed by thread 0<br>\nNo available tasks...<br></p>\n\n<p>The program is supposed to stop generating output after the stopPool() method is called.</p>\n\n<p>Can anyone tell me what is going wrong here? </p>\n\n<pre><code>public class CustomThread extends Thread\n{\n            private int id;\n            private Task task;\n            private ThreadPool threadpool;\n\n            public CustomThread(int id, Task task, ThreadPool threadpool)\n            {\n                this.id = id;\n                this.task = task;\n                this.threadpool = threadpool;\n            }\n\n            public synchronized void run()\n            {\n                while(true)\n                {\n                    if (this.currentThread().isInterrupted())\n                    {\n                        System.out.println(\"Thread \" + id + \" is halted\");\n                    }\n                    else\n                    {\n                        if (threadpool.getTaskQueue().isEmpty())\n                        {\n                            System.out.println(\"No available tasks...\");\n                            try \n                            {\n                                this.wait();\n                            } \n                            catch (InterruptedException e) \n                            {\n                                e.printStackTrace();\n                            }\n                        }\n                        else\n                        {   \n                            task = threadpool.retrieveTask();\n                            System.out.println(\"Task \" + task.getID() + \" recieved by thread \" + id);\n                            task.run();\n                            task.setState(true);\n                            System.out.println(\"Task \" + task.getID() + \" now being executed by thread \" + id);\n                        }\n                    }\n                }\n            }\n\n            public synchronized void wakeUp()\n            {\n                this.notify();\n            }\n\n            public int getThreadID()\n            {\n                return id;\n            }\n\n        }\n\n    import java.util.List;\n    import java.util.ArrayList;\n    import java.util.Stack;\n    import java.util.concurrent.BlockingQueue;\n    import java.util.concurrent.LinkedBlockingQueue;\n\n\n    public class ThreadPool\n    {\n        private List&lt;CustomThread&gt; thread_list;\n        private Stack&lt;Task&gt; task_queue;\n\n        public ThreadPool(int threads)\n        {\n            thread_list = new ArrayList&lt;CustomThread&gt;();\n            task_queue = new Stack&lt;Task&gt;();\n            for(int i=0; i&lt;threads; i++)\n            {\n                CustomThread thread = new CustomThread(i, null, this);\n                thread_list.add(thread);\n                thread.start();\n            }\n        }\n\n        //Must use notify() to wake up an idle thread\n        public synchronized void add(Task task)\n        {\n            task_queue.push(task);\n            try\n            {\n                for(CustomThread t : thread_list)\n                {\n                    t.wakeUp();\n                }\n\n            }\n            catch (Exception e)\n            {\n                e.printStackTrace();\n            }\n\n        }\n\n        public synchronized void stopPool()\n        {\n            for(CustomThread t : thread_list)\n            {\n                t.currentThread().interrupt();\n            }\n\n        }\n\n        public synchronized Stack getTaskQueue()\n        {\n            return task_queue;\n        }\n\n        public synchronized Task retrieveTask()\n        {\n            return task_queue.pop();\n        }\n    }\n\npublic class Task implements Runnable\n{\n    private int id;\n    private boolean finished = false;\n    public Task(int id)\n    {\n        this.id = id;\n    }\n\n    public synchronized void run()\n    {\n            System.out.println(\"This is task #\" + id);\n\n            try\n            {\n                Thread.sleep(1000);\n            }\n            catch (Exception e)\n            {\n                e.printStackTrace();\n            }\n    }\n\n    public int getID()\n    {\n        return id;\n    }\n\n    public void setState(Boolean finished)\n    {\n        this.finished = finished;\n    }\n\n    public boolean getState()\n    {\n        return finished;\n    }\n}\n\n\npublic class Init \n{\n    public static void main(String[] args)\n    {\n        ThreadPool threadpool = new ThreadPool(3);\n        threadpool.add(new Task(1));\n        threadpool.add(new Task(2));\n        threadpool.add(new Task(3));\n        threadpool.add(new Task(4));\n        threadpool.add(new Task(5));\n        System.out.println(\"All tasks added\");\n        {\n            try\n            {\n                Thread.sleep(1000);\n            }\n            catch(Exception e)\n            {\n                e.printStackTrace();\n            }\n        }\n        threadpool.stopPool();\n        System.out.println(\"All done, threadpool closed\");\n    }\n\n}\n</code></pre>\n"},{"tags":["linux","multithreading","matlab","64bit","x64"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1025,"score":0,"question_id":9191403,"title":"Matlab 2011a Use all Cores Available on 64 bit Linux?","body":"<p>Hi I've looked online but I can't seem to find the answer whether I need to do anything to make matlab use all cores? From what I understand multi-threading has been supported since 2007. On my machine matlab only uses one core @100% and the rest hang at ~2%. I'm using a 64 bit Linux (Mint 12). On my other computer which has only 2 cores and is 32 bit Matlab seems to be utilizing both cores @100%. Not all of the time but in sufficient number of cases. On the 64 bit, 4 core PC this never happens.</p>\n\n<p>Do I have to do anything in 64 bit to get Matlab to use all the cores whenever possible? I had to do some custom linking after install as Matlab wasn't finding the libraries (eg. libc.so.6) because it wasn't looking in the correct places.</p>\n"},{"tags":["android","multithreading","surfaceview","game-engine","android-lifecycle"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":150,"score":2,"question_id":12686912,"title":"Android : game loop pause/resume issue","body":"<p>I am able to pause/resume my game by making my game thread(which holds/synchronized with surfaceview)  wait/notifyAll. This all runs well using the in game pause button.</p>\n\n<p>However, when I click home/back button I am able to pause my game, but when I resumes my game by clicking on its icon, I receive non responsive game screen back to me.</p>\n\n<p>I have put logs on OnResume() method but nothing gets printed in LogCat!\nIf I click on my game screen I get error dialog to \"Force Close\" or \"Wait\" on my game activity.</p>\n\n<p>Why I am getting this non responsive screen as if my application Hangged after pause ?\nHow can I handle physical buttons in same way as inGame pause/resume button ?</p>\n\n<p>here is my logcat view of the operation. you can see onResume sop not getting printed similar to onPause.</p>\n\n<p><img src=\"http://i.stack.imgur.com/EKlrw.png\" alt=\"LogCat View\"> </p>\n\n<p>EDIT : Code called by my pause/resume button and by onPause/onResume functions\nwhere \"this\" is thread class itself</p>\n\n<pre><code>protected void setPause(){\n        synchronized (this) {\n            isPaused = true;\n                }\n    }\n\n    protected void setResume(){\n        synchronized (this) {\n            isPaused = false;\n            this.notifyAll();\n        }\n    }\n</code></pre>\n\n<p>Game Loop Code :</p>\n\n<pre><code>synchronized (this) {\n            while (running) {\n                if (isPaused) {\n                    try {\n                        this.wait();\n                    } catch (InterruptedException e) {\n                        // TODO Auto-generated catch block\n                        e.printStackTrace();\n                    }\n                } else {\n                    Canvas c = null;\n\n                    try {\n                        c = view.getHolder().lockCanvas();\n                        synchronized (view.getHolder()) {\n                            view.onDraw(c);\n                        }\n                    } catch (Exception e) {\n                        // TODO Auto-generated catch block\n                        e.printStackTrace();\n                    } finally {\n                        if (c != null) {\n                            view.getHolder().unlockCanvasAndPost(c);\n                        }\n                    }\n                    sleepTime = ticksPS\n                            - (System.currentTimeMillis() - startTime);\n                    try {\n                        if (sleepTime &gt; 0)\n                            sleep(sleepTime);\n                        else\n                            sleep(10);\n                    } catch (Exception e) {\n                        // TODO Auto-generated catch block\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n</code></pre>\n\n<p>This how I am calling it from surface view :</p>\n\n<pre><code>public void surfaceCreated(SurfaceHolder holder) {\n\n                // start the game loop\n                System.out.println(\"Starting Game Loop @@@@@@@@@\");\n                if(isPaused){\n                    System.out.println(\"GamePaused\");\n                    gameLoopThread.setResume();\n                }\n                else{\n                    System.out.println(\"Game Starting\");\n                    gameLoopThread.setRunning(true);\n                }\n                gameLoopThread.start();\n\n            }\n</code></pre>\n\n<p>EDIT 2:\nIf I Pause my game using pause button and let my phone get locked automatically... after resuming I am able to play normally with out any issue.\nAs per logs I see surface destroyed is not getting called in this case.</p>\n"},{"tags":["java","multithreading","osx","awt","clipboard"],"answer_count":2,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":558,"score":5,"question_id":10185754,"title":"Clipboard monitoring on Mac OS X | Java","body":"<p>I'm having troubles getting data from the system clipboard on Mac OS X.\nWhat I'm trying to do is to listen to the system clipboard and print the content of the clipboard each time new [text based] information is put into it.</p>\n\n<p>The problem: bellow code works perfectly fine on Windows 7 and openSUSE Linux machines, however when I try running the same code on Mac OS X the program fails to print the new content of the clipboard until focus is given to the application. [Nothing is printed until I click on the application icon on the dock...]</p>\n\n<p>My source code:</p>\n\n<pre><code>import java.awt.Toolkit;  \nimport java.awt.datatransfer.*;  \nimport java.io.IOException;  \n\npublic class ClipboardListener extends Thread implements ClipboardOwner {\n\n    Clipboard systemClipboard = Toolkit.getDefaultToolkit().getSystemClipboard();  \n\n    public void run(){  \n        Transferable selection = systemClipboard.getContents(this);  \n        gainOwnership(selection);  \n    }  \n\n    public void gainOwnership(Transferable t){ \n        try {this.sleep(100);} \n        catch (InterruptedException e) {e.printStackTrace();}\n        systemClipboard.setContents(t, this);  \n    }  \n\n    public void lostOwnership(Clipboard clipboard, Transferable contents) {\n        try {System.out.println((String) clipboard.getData(DataFlavor.stringFlavor));} \n        catch (UnsupportedFlavorException e) {} \n        catch (IOException e) {}\n        gainOwnership(contents);  \n    }  \n}\n</code></pre>\n\n<hr>\n\n<pre><code>public class myApp {\n\n    public static void main(String[] args){\n        ClipboardListener listener = new ClipboardListener();\n        listener.start();\n        while(true){}}\n\n}\n</code></pre>\n\n<p>What I'm missing/doing wrong?</p>\n\n<p><strong>[Update]</strong>\nI found similar problem posted here: <a href=\"http://stackoverflow.com/questions/10039275/java-thread-goes-to-sleep-when-not-in-focus-on-osx\">Java thread goes to sleep when not in focus on OSX</a>\nHowever using the command \"java -jar myApp.jar &amp;\" didn't work as a workaround for me.</p>\n"},{"tags":["android","multithreading","listview","drawable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12687757,"title":"ListView lags when loading from application cache","body":"<p>I wrote a little piece of code that download image from internet and cache them into cache dir.\n<strong>It runs in a secondary thread.</strong></p>\n\n<pre><code>{\n\n    String hash = md5(urlString);\n    File f = new File(m_cacheDir, hash);\n\n    if (f.exists())\n    {\n        Drawable d = Drawable.createFromPath(f.getAbsolutePath());\n        return d;\n    }\n\n    try {\n        InputStream is = download(urlString);\n        Drawable drawable = Drawable.createFromStream(is, \"src\");\n\n        if (drawable != null)\n        {\n            FileOutputStream out = new FileOutputStream(f);\n            Bitmap bitmap = ((BitmapDrawable)drawable).getBitmap();\n            bitmap.compress(CompressFormat.JPEG, 90, out);\n        }\n\n        return drawable;\n    } catch (Throwable e) { }\n\n    return null;\n}\n</code></pre>\n\n<p>I use this code to load picture inside a ListView item, and it works fine. If I remove the first if (where i load image from disk) it runs smoothly (and download picture every time!). If I keep it, when you scroll listview you feel some lags during picture's loading from disk, why?</p>\n"},{"tags":["python","multithreading","concurrency"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12686160,"title":"Clean up code when Ctrl+C is caught in python","body":"<p>By registering the signal handler, I can put my clean up code in signal_handler</p>\n\n<pre><code>signal.signal(signal.SIGINT, signal_handler)\n</code></pre>\n\n<p>But the problem is when user presses ctrl+c multiple times, the signal handler run multiple times and the clean up goes crazy.</p>\n\n<p><strong>My problem is that, how can I make sure that the clean up handler is being ran once only before exit.</strong> </p>\n\n<p>Here is my trial using lock, but deadlock is occured</p>\n\n<pre><code>def cleanup_handler():\n    lock.acquire()\n    if not done:\n        try:\n            cleanup()\n            done = True\n        finally:\n            print \"release lock\"\n            lock.release()\n</code></pre>\n\n<p>The problem is that finally block is never ran (that is I can't see the \"release lock\" being printed).</p>\n\n<p><strong>Remark</strong><br>\nAfter doing a little experiment, it seems that the signaler handler is not being ran at the same time. When new Ctrl+C is received, the old handler is killed and a new handler is ran. Am I correct? If yes, the problem becomes more complicated as I don't want my handler ends in the middle of the....</p>\n"},{"tags":["java","multithreading"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12685123,"title":"Trying to use 100 thread at a time.","body":"<p>I am creating one Testing Tool which is test the performance of the Web-Services. Now i want to test performance of my tool when 100 user hit this web service.<br>\nIn Current, I create one thread which heat and show me request-response details in log. But i need to create 100 threads which work parallel and show me request-response of 100 threads.<br>\nMy question is how to create <code>100 parallel thread's</code>.  Here i try to create 100 thread parallel but when i run this program it will not call <code>run()</code> method.    </p>\n\n<p>Here is my code.   </p>\n\n<pre><code>public class Main implements Runnable\n{\nint counter= 0;\n public static void main(String args[]) throws Throwable  \n {      \n  Thread t[]=new Thread[100];\n  for (int j=0; j&lt;100;j++)\n  {\n      t[j]=new Thread();\n      t[j].start();       \n  }          \n }\n public void run()\n {\n  try {\n\n        System.out.println(\"thread \"\n           +Thread.currentThread().getName()+\" step \"+counter++);\n\n  } \n  catch (Throwable t) { \n      t.printStackTrace();\n   }\n }\n}\n</code></pre>\n\n<p>Give me some hint or reference. I don't understand where i wrong.<br>\nThanks in Advance.</p>\n"},{"tags":["c#",".net","multithreading","task-parallel-library"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12241983,"title":"How to process items in collection parallely and serially both","body":"<p>I have a collection which has elements to be processed and at max only four elements can be processed together. At run time all process started together and all goes in waiting state. Only four elements are processed at one time. </p>\n\n<p>Problem is the processing elements are chosen randomly as all threads are waiting for resources to get free. Means first element can be the last one from collection.</p>\n\n<p>But, I need to process elements in order they are in the collection.</p>\n\n<p>Please tell me how can I achieve this?</p>\n\n<p>I am using TPL and C# 4.0</p>\n"},{"tags":["sql","sql-server","multithreading","tsql","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":243,"score":1,"question_id":8134318,"title":"SQLserver multithreaded locking with TABLOCKX","body":"<p>I have a table \"tbluser\" with 2 fields:</p>\n\n<ul>\n<li>userid = integer (autoincrement)</li>\n<li>user = nvarchar(100)</li>\n</ul>\n\n<p>I have a multithreaded/multi server application that uses this table.</p>\n\n<p>I want to accomplish the following:</p>\n\n<ul>\n<li>Guarantee that field user is unique in my table</li>\n<li>Guarantee that combination userid/user is unique in each server's memory</li>\n</ul>\n\n<p>I have the following stored procedure:</p>\n\n<pre><code>CREATE PROCEDURE uniqueuser @user nvarchar(100) AS\nBEGIN\nBEGIN TRAN\n    DECLARE @userID int\n    SET  nocount ON\n    SET  @userID = (SELECT @userID FROM tbluser WITH (TABLOCKX) WHERE  [user] = @user)\n    IF @userID &lt;&gt; ''\n    BEGIN\n        SELECT  userID = @userID\n    END\n    ELSE\n    BEGIN\n        INSERT INTO  tbluser([user]) VALUES (@user)\n        SELECT userID = SCOPE_IDENTITY() \n    END \nCOMMIT TRAN\nEND\n</code></pre>\n\n<p>Basically the application calls the stored procedure and provides a username as parameter.\nThe stored procedure either gets the userid or insert the user if it is a new user.</p>\n\n<p>Am I correct to assume that the table is locked (only one server can insert/query)?</p>\n"},{"tags":["c","multithreading","pthreads"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12684668,"title":"Conceptual thread issue","body":"<p>I'm generating hashes (MD5) of numbers from 1 to N in some threads. According to the first letter of the hash, the number that generates it is stored in an array. E.g, the number 1 results in c4ca4238a0b923820dcc509a6f75849b and the number 2 in c81e728d9d4c2f636f067f89cc14862c, so they are stored in a specific array of hashes that starts with \"c\".</p>\n\n<p>The problem is that I need to generate them sorted from the lower to the higher. It is very expensive to sort them after the sequence is finished, N can be as huge as 2^40. As I'm using threads the sorting never happens naturally. E.g. One thread can generate the hash of the number 12 (c20ad4d76fe97759aa27a0c99bff6710) and store it on \"c\" array and other then generates the hash of the number 8 (c9f0f895fb98ab9159f51fd0297e236d) and store it after the number 12 in \"c\" array.</p>\n\n<p>I can't simply verify the last number on the array because as far as the threads are running they can be very far away from each other.</p>\n\n<p>Is there any solution for this thread problem? Any solution that is faster than order the array after all the threads are finished would be great.</p>\n\n<p>I'm implementing this in C.</p>\n\n<p>Thank you!</p>\n"},{"tags":["ruby","multithreading","shoes"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":12616240,"title":"Killing Threads in Ruby Shoes doesn't seem to work?","body":"<p>I try to make this piece of code works in Ruby Shoes, but I can't succeed to kill the thread named \"airodump\". Each time I click on the \"stop scanning\" button, it doesn't do anything :s</p>\n\n<p>Thanks</p>\n\n<pre><code>    button \"scan networks\" do\n      airodump = Thread.new do\n         `sudo airodump-ng --write tuto wlan0`\n       end\n       Thread.new do\n         button \"Stop scanning\" do\n           Thread.kill(airodump)\n         end\n       end\n    end\n</code></pre>\n"},{"tags":["multithreading","haskell","concurrency","shelly"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":12684754,"title":"Why is main executable busy when calling external executable with Shelly.Background","body":"<p>I am trying to write a program with <a href=\"http://hackage.haskell.org/package/shelly-0.14.1\" rel=\"nofollow\">Shelly</a> to compile Delphi projects in parallel. I thought the program would be blocked while waiting for the Delphi compilers to return. But my program starts to max out one CPU-core after compiled 2 projects. I couldn't work out what it's so busy doing. Please help? Thanks.</p>\n\n<p>ps: I am quite new to Haskell, if I'm not implementing this the right way, pointers are appreciated.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, ExtendedDefaultRules #-}\n{-# OPTIONS_GHC -fno-warn-type-defaults #-}\nimport Shelly \nimport Shelly.Background\n\nimport Control.Monad\nimport Control.Arrow\nimport System.IO.Temp (withSystemTempDirectory)\nimport System.Directory (getCurrentDirectory)\nimport System.FilePath (splitFileName)\nimport Data.Text.Lazy (Text, pack)\ndefault (Int, Text)\n\ndcc32 = command \"dcc32\" [\"-RC:\\\\Program Files\\\\Borland\\\\BDS\\\\4.0\\\\Lib\", \"-Q\", \"-H\", \"-W\", \"-B\"]\n\ncompile project = liftIO $ withSystemTempDirectory \"TempDCU_\" compile'\n  where\n    compile' tmpDir = shellyNoDir $ silently $ \n      chdir dir (dcc32 [toTextIgnore file, pack $ \"-N\" ++ tmpDir])\n    (dir, file) = mapTuple (fromText . pack) $ splitFileName project\n    mapTuple = join (***)\n\ncompilePooled n projects = shellyNoDir $ jobs n (\\job -&gt; mapM (background job . compile) projects)\n\nprojectList = [\n    \"C:\\\\Path\\\\to\\\\project1.dpr\",\n    \"C:\\\\Path\\\\to\\\\project2.dpr\",\n    \"C:\\\\Path\\\\to\\\\project3.dpr\",\n    \"C:\\\\Path\\\\to\\\\project4.dpr\",\n    ]\n\nmain = do\n  output &lt;- compilePooled 2 projectList\n  shellyNoDir $ mapM getBgResult output &gt;&gt;= mapM_ inspect \n</code></pre>\n"},{"tags":["java","android","multithreading","timer","scheduled-tasks"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":165,"score":0,"question_id":12684604,"title":"Android Timer schedule vs scheduleAtFixedRate","body":"<p>I'm writing an Android application that records audio every 10 minutes. I am using a Timer to do that. But what is the difference between schedule and scheduleAtFixedRate? Is there any performance benefit in using one over the other?</p>\n"},{"tags":["java","multithreading","synchronization","bank"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12682113,"title":"Java Multi-threaded bank transfer, synchronization issues","body":"<p>I am attempting the multi-threaded bank transfer problem. However, I am having issues with correctly synchronizing the threads. Periodically after a thread performs a transfer between accounts it will test to ensure no money has been gained or loss altogether.</p>\n\n<p>When a thread enters the test method it is supposed to set a flag that will prevent any other thread from entering the tranfer method, then wait until all threads currently performing transfers to end.</p>\n\n<pre><code>public void transfer(int from, int to, int amount) {        \n    //finish running all threads' current transactions before test\n\n    accounts[from].waitForAvailableFunds(amount);\n    if (!open) return;    \n\n    //checks to see if any thread is currently testing\n    //if so, wait\n    while(flag) {\n        try {\n            wait();\n        } catch (InterruptedException e) { /*ignore*/ }\n    }\n\n    //do not execute these two statements when a thread\n    //is performing a test\n    if (accounts[from].withdraw(amount)) {\n        accounts[to].deposit(amount);\n\n    }  \n\n    if (shouldTest() &amp;&amp; !flag)   test();\n\n}\n\n//only one thread can perform a test at any given moment\npublic synchronized void test() {        \n\n    //when test starts set a flag telling threads to\n    //not begin any new transfers\n    flag = true;\n\n    //wait for all threads currently performing transfers\n    //to finish current transfer before continuing\n\n\n    int sum = 0;\n    for (int i = 0; i &lt; accounts.length; i++) {\n        System.out.printf(\"%s %s%n\", \n                Thread.currentThread().toString(),accounts[i].toString());\n        sum += accounts[i].getBalance();\n    }\n    System.out.println(Thread.currentThread().toString() + \n            \" Sum: \" + sum);\n    if (sum != numAccounts * initialBalance) {\n        System.out.println(Thread.currentThread().toString() + \n                \" Money was gained or lost\");\n        System.exit(1);\n    } else {\n        System.out.println(Thread.currentThread().toString() + \n                \" The bank is in balance\");\n    }\n\n    //reset flag and notify threads test is complete.\n    flag = false;\n    notifyAll();\n}\n</code></pre>\n\n<p>Firstly, I'm not even positive I have set the flag and waiting correctly. Secondly, how do I have the thread that entered the test method wait for all other threads that are already performing tranfers to complete the current transfer.</p>\n\n<p>Thanks </p>\n"},{"tags":["c#","wpf","multithreading","user-interface","slider"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12683323,"title":"How to block a wpf UI to avoid illegal states?","body":"<p>Lets say I have 3 or more Slider and each slider can have a value from 0 to 100.\nHowever I want that the sum of all slider values is &lt;= 100. In case I have 4 slider everyones max value would be 25.</p>\n\n<p>Every slider has a binding to a double variable and every time the user uses a slider (tick frequency 0.1) I calculate the sum and set other slider back or if necessary set the same slider back, so that the sum is &lt;= 100.</p>\n\n<p>The problem is, that the calculation needs a decent amount of time and in the meantime the user can set illegal values. I would like to solve this by blocking the UI until the calculation is over. Basically the opposite of the desired responsiveness. </p>\n\n<p>Other ideas and suggestions to solve the slider thing are welcome.</p>\n\n<p><img src=\"http://i.stack.imgur.com/H8Phy.jpg\" alt=\"For example 3 slider.\"></p>\n\n<p>slider binding</p>\n\n<pre><code>public BindingList&lt;WLCToolParameter&gt; WLCParameter\n   {\n       get { return _toolParameter; }\n       set { _toolParameter = value; }\n   }\n</code></pre>\n\n<p>should be instant - not really :(</p>\n\n<pre><code> using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing MCDA.Entity;\nusing MCDA.Extensions;\n\nnamespace MCDA.Model\n{\n    class ProportionalDistributionStrategy : IWeightDistributionStrategy\n    {\n        public void Distribute&lt;T&gt;(IList&lt;T&gt; listOfToolParameter) where T : class, IToolParameter\n        {\n\n            if (listOfToolParameter.Count == 0)\n                return;\n\n            IToolParameter lastWeightChangedToolParameter =  lastWeightChangedToolParameter = listOfToolParameter[0].LastWeightChangedToolParameter;\n\n            double sumOfAllWeights = listOfToolParameter.Sum(t =&gt;t.Weight);\n\n            //we have to rescale\n            if (sumOfAllWeights &gt; 100)\n            {\n                double overrun = sumOfAllWeights - 100;\n\n                //how much do we have without the locked and the last changed?\n                double availableSpace = listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t != lastWeightChangedToolParameter).Sum(t =&gt; t.Weight);\n\n                //we have enough by taking from the non locked\n                if (availableSpace &gt; overrun)\n                {\n                    //lets remove proportional\n                    double sumOfChangeableWeights = listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t != lastWeightChangedToolParameter).Sum(t =&gt; t.Weight);\n\n                    //in case we have only one element that is suitable we can directly remove all from this one\n                    if (listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t.Weight &gt; 0 &amp;&amp; t != lastWeightChangedToolParameter).Count() == 1)\n                    {\n                        listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t.Weight &gt; 0 &amp;&amp; t != lastWeightChangedToolParameter).ForEach(t =&gt; t.Weight = t.Weight - overrun);\n                        return;\n                    }\n                    listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t.Weight &gt; 0 &amp;&amp; t != lastWeightChangedToolParameter).ForEach(t =&gt; t.Weight = t.Weight - (sumOfChangeableWeights / (sumOfChangeableWeights - t.Weight)) * overrun);\n                }\n\n                //we have to resize also the latest change, but we try to keep as much as possible of the latest change\n                else\n                {\n                    //lets set them to zero\n                    listOfToolParameter.Where(t =&gt; t.IsLocked == false &amp;&amp; t != lastWeightChangedToolParameter).ForEach(t =&gt; t.Weight = 0);\n\n                    //how much are we still over?\n                    double stillOver = listOfToolParameter.Sum(t =&gt; t.Weight) - 100;\n\n                    //and cut from the last changed\n                    listOfToolParameter.Where(t =&gt; t == lastWeightChangedToolParameter).ForEach(t =&gt; t.Weight -= stillOver);\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","sleep"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":126,"score":0,"question_id":12681113,"title":"sleeping a new thread c#","body":"<p>so im trying to delay the sending of email from my program.\nIn order to keep the UI interactive, i started a new thread and called the email method in the thread. It works. It sends the emails. However i cant figure out how to sleep the thread.\nIve tried using Thread.sleep() in the actual email method, but it doesnt seem to work. </p>\n\n<pre><code>Thread oThread = new Thread(new ThreadStart(() =&gt; { sendEMailThroughOUTLOOK(recipientAddress, subjectLine, finalbody); }));\n                oThread.Start();\n</code></pre>\n\n<p>email method..</p>\n\n<pre><code>public void sendEMailThroughOUTLOOK(string recipient, string subject, string body)\n    {\n        Thread.Sleep(60000);\n\n        try\n        {\n\n            // Create the Outlook application.\n            Outlook.Application oApp = new Outlook.Application();\n            // Create a new mail item.\n            Outlook.MailItem oMsg = (Outlook.MailItem)oApp.CreateItem(Outlook.OlItemType.olMailItem);\n            // Set HTMLBody. \n            //add the body of the email\n            oMsg.Body = body;\n\n            oMsg.Subject = subject;\n            // Add a recipient.\n            Outlook.Recipients oRecips = (Outlook.Recipients)oMsg.Recipients;\n            // Change the recipient in the next line if necessary.\n            Outlook.Recipient oRecip = (Outlook.Recipient)oRecips.Add(recipient);\n            oRecip.Resolve();\n            // Send.\n            oMsg.Send();\n            // Clean up.\n            oRecip = null;\n            oRecips = null;\n            oMsg = null;\n            oApp = null;\n\n\n\n        }//end of try block\n        catch (Exception ex)\n        {\n        }//end of catch\n\n        //end of Email Method\n    }\n</code></pre>\n"},{"tags":["android","multithreading","android-sqlite"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12569372,"title":"Sqlite interaction in my Runnable is causing ANR","body":"<p>I have a class, Recorder, which captures sensor data and writes it to a database. All the database handling occurs in Recorder. Here  I'm running it in a new thread. mContext comes from getApplicationContext().</p>\n\n<pre><code>        Runnable startRunnable = new Runnable(){\n            public void run() {\n                Recorder recorder = new Recorder((SensorManager) getSystemService(SENSOR_SERVICE), mContext);\n                recorder.start();\n            }\n        };\n        recorderThread = new Thread(startRunnable);\n        recorderThread.start();\n</code></pre>\n\n<p>Here are the relevant bits for Recorder: </p>\n\n<pre><code>public Recorder(SensorManager sensorManager, Context context){\n    mSensorManager = sensorManager;\n    mContext = context;\n}\n\nvoid start(){               \n    List &lt;Sensor&gt; sensorList = mSensorManager.getSensorList(Sensor.TYPE_ALL);\n    for(Sensor sensor : sensorList){\n        mSensorManager.registerListener(this, sensor, SensorManager.SENSOR_DELAY_GAME);\n    }\n}\n\npublic void onSensorChanged(SensorEvent event) {\n    SensorDatabase dbHelper = new SensorDatabase(mContext);\n    mDb = dbHelper.getWritableDatabase();\n\n    if(mDb != null &amp;&amp; mDb.isOpen()){\n        ContentValues values = new ContentValues();\n        values.put(DataColumns.ACCURACY, event.accuracy);\n        // more values stuff ... \n\n        mDb.insert(SensorDatabase.TABLE_NAME, null, values);\n        mDb.close();\n    }\n}\n</code></pre>\n\n<p>The application records the data, but is getting ANR errors. If I make it so that the database doesn't get initialized in Recorder, there is no ANR error. </p>\n\n<p>How could this Runnable be blocking the UI thread here? There are no callbacks, and the UI thread never tries to open a database connection, at least it isn't my intention to do so.  </p>\n\n<p>I looked into traces.txt for the ANR, it said thread \"main\" was executing: </p>\n\n<pre><code> android.database.sqlite.SQLiteStatement.native_executeSql(Native Method) \n</code></pre>\n\n<p>Any pointers? I'm pretty confused. </p>\n"},{"tags":["objective-c","ios","multithreading","ipad","grand-central-dispatch"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":131,"score":2,"question_id":12680483,"title":"GCD - Asynchronous Queue with Synchronous Tasks","body":"<p>I am trying to download data from an API before displaying it to the user.</p>\n\n<p>Here's what I am doing:</p>\n\n<pre><code>dispatch_queue_t concurrentQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);\ndispatch_async(concurrentQueue, ^{\n\n    __block NSMutableArray *newImages;\n\n    dispatch_sync(concurrentQueue, ^{\n        newImages = [NSMutableArray array];\n        // images retrieved using `NSURLConnection sendSynchronousRequest`\n    });\n\n    dispatch_sync(dispatch_get_main_queue(), ^{\n        // display images to the user\n    });\n});\n</code></pre>\n\n<p>My question is, since <code>newImages</code> is declared with <code>__block</code>, am I always guaranteed to have the latest <code>newImages</code> data when executing the second task at the main queue? If not, what's the safest way to pass that array's content into the second block and making sure its the latest content?</p>\n\n<p>I think my data is getting messed up somewhere, hence why I am asking this.</p>\n\n<p>If this looks fine, then I will post my full code for help with the whole thing in case something else is wrong.</p>\n"},{"tags":["multithreading","delphi","winapi","delphi-7","multitasking"],"answer_count":3,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":389,"score":9,"question_id":11942827,"title":"Why threads starve even on preemptive multitasking OS (Windows 7)","body":"<p>I wrote a Win32 application (in Delphi-7 which is 32-bit using TThread class) to create 100 threads. Each thread when resumed will continuously (in a loop) increment a 64 bit counter associated with the thread object (so no locking or sharing of data). </p>\n\n<p>If you let the system run for 10 to 15 seconds and stop after that, you should see roughly the same counts in each of the threads. But what I observed was that 81 threads ran under 400 million loops and the remaining ones looped more than 950 million times. Slowest thread got only 230 million compared to the fastest 2111 million. </p>\n\n<p>According to MSDN, the preemptive multitasking is at the thread-level (not process level), so each of my thread should have gotten its time-slice in a round-robin fashion. What am I missing here and why is this discrepancy? </p>\n\n<p>Edit1: Machine configuration: Intel i7 Quad Core 3.4GHz with hyper-threading turned on (8 active threads at a time). Running Windows-7 64 bit professional (and the test application is 32 bit)</p>\n\n<p>Edit2 (thread code): The test application is built with optimization turned on and without any debug info. Run the test application outside of IDE.</p>\n\n<pre><code>type\n\n  TMyThread = class(TThread)\n  protected\n    FCount: Int64;\n  public\n    constructor Create;\n    procedure Execute; override;\n    property Count: Int64 read FCount;\n  end;\n\n\n{ TMyThread }\n\nconstructor TMyThread.Create;\nbegin\n  inherited Create(True);\n  FCount := 0;\nend;  \n\nprocedure TMyThread.Execute;\nbegin\n  inherited;\n  while not Terminated do\n  begin\n    Inc(FCount);\n  end;\nend;\n</code></pre>\n"},{"tags":["c#","multithreading",".net-4.0","thread-safety"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12682156,"title":"Avoiding duplicate if statements inside and outside a lock","body":"<p>The below code is a very simplified example of what I am trying to accomplish.</p>\n\n<pre><code> private object _highestLevelLock = new object();\n    private int _highestValue;\n    private void SetHighestValue()\n    {\n        var random = new Random();\n        var next = random.Next(0, 100);\n        if (next &gt; _highestValue)\n        {\n            lock (_highestLevelLock)\n            {\n                if(next &gt; _highestValue)\n                    _highestValue = next;\n            }\n        }\n    }\n</code></pre>\n\n<p>Namely, I have a variable that holds the highest integer that I have come across so far. SetHighestValue() can be accessed by multiple threads.</p>\n\n<p>If the random integer generated is larger than the currently largest integer, I will update the _highestValue.</p>\n\n<p>My question is, how can I avoid checking twice if next > highestValue? If I remove it from inside the lock, then there is the risk that _highestValue will get set to something even higher, before this thread sets the value, and in this scenario, _highestValue will be inaccurate.</p>\n\n<p>I know that I can get rid of the if statement outside the lock, but I do not want to lock unnecessarily.</p>\n\n<p>Is there a better way to accomplish this? Potentially some combination of locking and/or using the Interlocked namespace?</p>\n\n<p>On a somewhat related note, should _highestValue be volatile? Even if so, I assume that will not help with my question at hand.</p>\n\n<p>Thanks!</p>\n"},{"tags":[".net","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12681400,"title":"Sleep .NET Task, Wake on CancellationTokenSource.Cancel()","body":"<p>I have code that must poll an external resource periodically.  Simplified, it looks like:</p>\n\n<pre><code>CancellationTokenSource cancellationSource = new CancellationTokenSource();\n\nTask t = Task.Factory.StartNew(() =&gt;\n    {\n        while (!cancellationSource.IsCancellationRequested)\n        {\n            Console.WriteLine(\"Fairly complex polling logic here.\");\n\n            // Finishes sleeping before checking for cancellation request\n            Thread.Sleep(10000); \n        }\n    },\n    cancellationSource.Token);\n</code></pre>\n\n<p>How can I code the 10 second delay in such a manner that it will be interrupted if cancellationSource.Cancel() is called?</p>\n"},{"tags":["wpf","multithreading","mvvm","binding"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12676684,"title":"Multiplethreading MVVM update value when Current Dispatcher is working","body":"<p>I've problem with update value in window, which is open via <code>Show()</code> method not <code>ShowDialog()</code> method. I use <code>MVVM</code> and use binding like:</p>\n\n<pre><code>Value=\"{Binding Path=MainProgressValue, UpdateSourceTrigger=PropertyChanged}\"\n</code></pre>\n\n<p>In my property I use <code>INotifyPropertyChanged</code> for notify UI.</p>\n\n<p>It worked fine, but now I open new window</p>\n\n<pre><code> window.DataContext = context;\n if (owner != null)\n       window.Owner = owner;\n resultHandler = new ViewModelBaseClass.ResultHandler(context_RequestClosing);\n getDialogResultHandler = new ViewModelBaseClass.GetDialogResultHandler(context_GetDialogResultAction);\n context.RequestClosing += resultHandler;\n context.GetDialogResult += getDialogResultHandler;\n window.Show();\n</code></pre>\n\n<p>There is progress bar. The window is shown and main thread continue with proceed program. But when <code>DataContext</code> call <code>RaisePropertyChanged</code>, the progress bar doesn't update. Is it possible that the window with progress bar uses another thread than the main thread?</p>\n\n<p>How to update this value?</p>\n"},{"tags":["python","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12678750,"title":"Exit python thread based on flag","body":"<p>Suppose inside run() method of a python Thread , I check a flag.If that flag is True , I assume my thread should exit has done it's job and should exit.</p>\n\n<p>How should I exit the thread at that point ? Trying <code>Thread.exit()</code></p>\n\n<pre><code>class  workingThread(Thread):\n\n    def __init__(self, flag):\n        Thread.__init__(self)\n        self.myName = Thread.getName(self)\n        self.FLAG= flag\n        self.start()    # start the thread\n\n    def run(self) : # Where I check the flag and run the actual code\n\n        # STOP\n        if (self.FLAG == True):\n\n                # none of following works all throw exceptions    \n                self.exit()\n                self._Thread__stop()\n                self._Thread_delete()\n                self.quit()\n\n        # RUN\n        elif (self.FLAG == False) :\n               print str(self.myName)+ \" is running.\"\n</code></pre>\n"},{"tags":["c#","multithreading","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12680315,"title":"Using a thread to timeout a ADO.NET query","body":"<p>I have a need to run a query on a couple different ADO.NET connection types (Sql and Oracle). I want to have the ability to cancel the query after X seconds if it has not yet completed.  I thought a thread might be a good way to approach this, so I could just kill the thread after X seconds, if it's still alive:</p>\n\n<pre><code>var thread = new Thread((param) =&gt;\n{\n    try\n    {\n        string connStr = \"****\";\n        OracleConnection conn = new OracleConnection(connStr);\n        try\n        {                       \n            conn.Open();\n            Debug.WriteLine(\"Connection Open: \" + DateTime.Now.ToLongTimeString());\n            OracleCommand cmd = new OracleCommand(param as string, conn);\n            Debug.WriteLine(\"Command Start: \" + DateTime.Now.ToLongTimeString());\n            OracleDataReader reader = cmd.ExecuteReader();\n            Debug.WriteLine(\"Command End: \" + DateTime.Now.ToLongTimeString());\n            conn.Close();\n            Debug.WriteLine(\"Connection Close: \" + DateTime.Now.ToLongTimeString());\n        }\n        catch (Exception ex)\n        {\n            Debug.WriteLine(\"Exception: \" + ex.Message);\n        }\n    }\n    catch (ThreadInterruptedException)\n    {\n        Debug.WriteLine(\"Cancel: \" + DateTime.Now.ToLongTimeString());\n    }\n});\n\nDebug.WriteLine(\"Start: \" + DateTime.Now.ToLongTimeString());\n\nthread.Start(\"begin dbms_lock.sleep(10); end;\"); \nDateTime start = DateTime.Now;\nwhile (thread.IsAlive)\n{\n    if (DateTime.Now &gt; start.AddSeconds(5))\n    {\n        thread.Interrupt();\n    }\n}                \n\nDebug.WriteLine(\"End: \" + DateTime.Now.ToLongTimeString());\n</code></pre>\n\n<p>However, this is not cancelling with the <code>thread.Interrupt()</code> like other code I've used before.</p>\n\n<p>How can I get this to work, or is there a better way to approach this issue?</p>\n"},{"tags":["c#","multithreading","user-interface"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12679853,"title":"Reload UI language strings after changing settings","body":"<p>I have a problem with changing my UI strings after the user has changed the language in the option window. To change the UI strings of the main form, I have to restart the program every time, so that changes take effect, but that's annoying. So I tried it with a delegate to call the function, which loads the strings for the main window in the option window after saving the new settings. The function is called in the option window, but it doesn't change the strings of the main window.</p>\n\n<p>Code in the main window</p>\n\n<pre><code>public delegate void CallLoadUIStrings(SupportedLanguages lang);\npublic CallLoadUIStrings callLoadUIStrings;\n\npublic Renamer()\n{\n     callLoadUIStrings = new CallLoadUIStrings(LoadUIStrings);\n}\n\n public void LoadUIStrings(SupportedLanguages lang)\n {\n       try\n       {\n            switch (lang)\n            {\n                    #region \"DE/JA/FR/ES/NL\"\n                    case SupportedLanguages.De:\n                    case SupportedLanguages.Ja:\n                    case SupportedLanguages.Fr:\n                    case SupportedLanguages.Es:\n                    case SupportedLanguages.Nl:\n                         // reads the language file where the ui strings are stored\n                        langHelper.Read(RenamerLangOpener.RenamerMainWindow);\n\n                        this.mnuFile.Text = langHelper.Files;\n                        this.mnuClose.Text = langHelper.Close;\n\n                        this.mnuEdit.Text = langHelper.Edit;\n                        this.mnuUndo.Text = langHelper.Undo;\n                        this.mnuCut.Text = langHelper.Cut;\n                        this.mnuCopy.Text = langHelper.Copy;\n                        this.mnuPaste.Text = langHelper.Paste;\n                        this.mnuDelete.Text = langHelper.Delete;\n                        this.mnuSelectAll.Text = langHelper.SelectAll;\n                     #endregion\n            }\n       }\n       catch (Exception ex) { //exception handling }\n}\nprivate void mnuOpt_Click(object sender, EventArgs e)\n{\n       Preferences opt = new Preferences(this);\n       opt.ShowDialog();\n} \n</code></pre>\n\n<p>Code in the option window</p>\n\n<pre><code>    internal Renamer instance = null;\n    public Preferences(Renamer form)\n    {\n        instance = form;\n    }\n    public void UpdateUI()\n    {\n        langHelper.ReadSettingsValues();\n        instance.BeginInvoke(instance.callLoadUIStrings,new object[] { langHelper.GetLang});\n    }\n</code></pre>\n\n<p>Since I've never worked with delegates I don't have a clue where the mistake is.\nI've googled so much to find a solution for a similar problem, but I haven't found something that matched my problem.</p>\n"},{"tags":["java","multithreading","cpu","scheduling","simulation"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":174,"score":4,"question_id":12679943,"title":"Shortest Remaining Time First: Java Multithreading","body":"<p>I am trying to simulate CPU scheduling algorithms in java and am using multithreading. I have successfully implemented FCFS(First Come First Serve) and SJF(Shortest Job First). But the problem is when i start to think of SRTF(Shortest Remaining Time First) which is a preemptive form of SJF. \nI am using the following model:</p>\n\n<ul>\n<li>A thread for CPU, which has a <code>CLOCK</code> variable, which keeps ticking(a simple clock increment) every <code>100ms</code>. I have a <code>boolean isAvailable;</code> flag for the processes to check if the CPU is available before starting execution.</li>\n<li>A thread for Long Term Scheduler(LTS), which pushes the process from the process list to a Ready Queue.</li>\n<li>A thread for Short Term Scheduler(STS), which takes a process from the ReadyQueue and assigns it to the CPU.</li>\n<li>Once a process is removed from the ReadyQueue by STS for execution, the process checks for the <code>isAvailable</code> flag of CPU. If <code>true</code>, it sets the flag to false and starts its execution (for which i am just making the thread to sleep for <code>(100 * burstTime) ms</code> as this is just a simulation). Otherwise, the process just keeps busy waiting :  <code>while(CPU.isAvailable != true);</code>. </li>\n</ul>\n\n<p>I have the list of processes along with their arrival and burst times before hand. \nIt is ok till i am simulatiing non-preemptive scheduling(FCFS and SJF). But as i try for SRTF, I am unable to find a way to preempt the currently running process thread.</p>\n\n<p>For SRTF, i know the way ahead to select the next process from ReadyQueue. I can try to set the <code>isAvailable</code> flag to <code>false</code> once i select a process from the queue, but then how am I to know which thread was originally executing? And since I am not using much of synchronization b/w threads, I will have multiple processes using the <code>CPU</code> thread. Its getting a little messed up. Please help. Thanks!</p>\n\n<p>This is the code for a Process:</p>\n\n<pre><code>enum State {ARRIVED, WAITING, READY, RUNNING, EXECUTED}\npublic class Process implements Runnable\n{\n    int pid;\n    int arrTime;\nint burstTime;\nint priority;\nlong startTime;\nlong endTime;\nState procState = null;\n\nProcess(int pid, int arrTime, int burstTime, int priority)\n{\n    this.pid = pid;\n    this.arrTime = arrTime;\n    this.burstTime = burstTime;\n    this.priority = priority;\n    this.procState = State.ARRIVED;\n    this.startTime = 0;\n\n\n    this.endTime = 0;    /* I also considered adding a timeElapsedUnderExecution\n attribute to the process. So I can check after every cycle if the CPU is still available\n and keep incrementing the time elapsed. Once the timeElapsed becomes same as burstTime, i\n stop the process. Or if after a cycle, the CPU is not available, i know from where to\n resume my Process. Is this the way to go ? */\n\n    }\n\nboolean isReady()\n{\n    if((this.arrTime &lt;= CPU.CLOCK) &amp;&amp; (this.procState == State.ARRIVED))\n        return true;\n    else return false;\n}\n\n@Override\npublic void run() {\n    // TODO Auto-generated method stub\n    if(this.procState == State.READY)\n        this.procState = State.WAITING;\n\n    while(!CPU.isAvailable());\n\n    try \n    {\n        this.procState = State.RUNNING;\n        System.out.println(\"Process \" + pid + \" executing...\");\n        this.startTime = CPU.CLOCK;\n        System.out.println(\"Process \" + this.pid + \": Begins at \" + this.startTime);\n        Thread.sleep(this.burstTime * 100);\n        this.endTime = CPU.CLOCK;\n        System.out.println(\"Process \" + this.pid + \": Ends at \" + this.endTime);\n        this.procState = State.EXECUTED;\n\n    }\n    catch (InterruptedException e) \n    {\n        // TODO Auto-generated catch block\n        System.out.println(\"Interrupted: \" + pid);\n        e.printStackTrace();\n    }\n    }\n}\n</code></pre>\n\n<p>The code for CPU:</p>\n\n<pre><code>    import java.util.LinkedList;\n    import java.util.Queue;\n\n    public class CPU implements Runnable\n\n{\n    static Long CLOCK = new Long(0);\n    static LinkedList&lt;Process&gt; ReadyQ = new LinkedList&lt;Process&gt;();\nprivate static boolean isAvailable = true;\nstatic boolean done = false;\n\npublic static boolean isAvailable() {\n    return isAvailable;\n}\n\npublic static void setAvailable(boolean isAvailable) {\n    CPU.isAvailable = isAvailable;\n}\n\nstatic void incrementCLOCK()\n{\n    LTS.checkArrival();\n    CPU.CLOCK++;\n    try {\n        Thread.sleep(100);\n    } catch (InterruptedException e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n    System.out.println(\"Clock Tick: \" + CPU.CLOCK);\n}\n\n@Override\npublic void run() {\n    // TODO Auto-generated method stub\n    System.out.println(\"CPU starts.!!!\");\n    while(CPU.done != true)\n        synchronized(CPU.CLOCK)\n        {\n            incrementCLOCK();\n            }\n    }\n}\n</code></pre>\n\n<p>The code for LTS:</p>\n\n<pre><code>public class LTS implements Runnable \n{\n    private static Process[] pList = null;\n    private final int NUM;\n    static Integer procStarted;\n    static Integer procFinished;\n    static boolean STSDone = false;\n\n\nLTS(Process[] pList, int num)\n{\n    this.NUM = num;\n    LTS.pList = pList;\n}\n\nstatic void checkArrival()\n{\n    if(pList == null) return;\n    for(int i = 0; i &lt; pList.length; i++)\n        if(pList[i].isReady())\n        {\n            pList[i].procState = State.READY;\n            System.out.println(\"Process \" + pList[i].pid + \" is now ready.\");\n            CPU.ReadyQ.add(pList[i]);\n        }\n}\n\n@Override\npublic void run() {\n    // TODO Auto-generated method stub\n    System.out.println(\"Long Term Scheduler starts.!!!\");\n    while(LTS.STSDone != true)\n    {\n        try {\n            Thread.sleep(100);\n        } catch (InterruptedException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n    }\n    System.out.println(LTS.STSDone);\n    System.out.println(\"LTS ends.!!!\");\n        CPU.done = true;\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","email","outlook"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":12680106,"title":"starting a new thread and calling a method with arguments C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12675864/delaying-the-sending-of-email-messages-without-using-thread-sleep-c-sharp\">delaying the sending of email messages without using Thread.Sleep c#</a>  </p>\n</blockquote>\n\n\n\n<p>so i am trying to start a new thread inside a for loop of my application. Im not familiar with threading at all so I need some info.</p>\n\n<p>im sending emails through outlook using this method:</p>\n\n<pre><code>public void sendEMailThroughOUTLOOK(string recipient, string subject, string body)\n    {\n\n        try\n        {\n\n            // Create the Outlook application.\n            Outlook.Application oApp = new Outlook.Application();\n            // Create a new mail item.\n            Outlook.MailItem oMsg = (Outlook.MailItem)oApp.CreateItem(Outlook.OlItemType.olMailItem);\n            // Set HTMLBody. \n            //add the body of the email\n            oMsg.Body = body;\n\n            oMsg.Subject = subject;\n            // Add a recipient.\n            Outlook.Recipients oRecips = (Outlook.Recipients)oMsg.Recipients;\n            // Change the recipient in the next line if necessary.\n            Outlook.Recipient oRecip = (Outlook.Recipient)oRecips.Add(recipient);\n            oRecip.Resolve();\n            // Send.\n            oMsg.Send();\n            // Clean up.\n            oRecip = null;\n            oRecips = null;\n            oMsg = null;\n            oApp = null;\n        }//end of try block\n        catch (Exception ex)\n        {\n        }//end of catch\n\n        //end of Email Method\n    }\n</code></pre>\n\n<p>and in a foreach loop i send an email each iteration. </p>\n\n<p>However i need those emails delayed, but I dont want to sleep the UI thread.</p>\n\n<p>I asked a few hours ago and got some answers but wasnt able to check my question frequently.</p>\n\n<p>I tried some of their suggestions such as using this:</p>\n\n<pre><code>Thread oThread = new Thread(new ThreadStart((sendEMailThroughOUTLOOK(recipient, subjectLine, finalbody)));\n</code></pre>\n\n<p>But im getting an error. Its saying its expecting a method name...and i do have a method name in there. Is it because of the arguments of my method?</p>\n"},{"tags":["c#","multithreading","performance","zip","zipfile"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12679165,"title":"multithreading for file load in C# 4.0","body":"<p>I need to zip each text file and copy into another server. File size may very from 500MB to 8GB. there is no dependency in each file. I have 35 files Appx.</p>\n\n<p>My regular code taking appx 3-4 hours for this. To reduce the time, I am just thinking to implement Threading for this. Do you thing Threading will reduce the time or is there any other best way to do this.</p>\n"},{"tags":["python","django","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12677715,"title":"What’s the correct way to run a long-running task in Django whilst returning a page to the user immediately?","body":"<p>I’m writing a tiny Django website that’s going to provide users with a way to delete all their contacts on Flickr.</p>\n\n<p>It’s mainly an exercise to learn about <a href=\"http://seleniumhq.org/\" rel=\"nofollow\">Selenium</a>, rather than something actually useful — because the Flickr API doesn’t provide a way to delete contacts, I’m using Selenium to make an actual web browser do the actual deleting of contacts.</p>\n\n<p>Because this might take a while, I’d like to present the user with a message saying that the deleting is being done, and then notify them when it’s finished.</p>\n\n<p>In Django, what’s the correct way to return a web page to the user immediately, whilst performing a task on the server that continues after the page is returned?</p>\n\n<p>Would my Django view function use <a href=\"http://docs.python.org/library/threading.html#module-threading\" rel=\"nofollow\">the Python threading module</a> to make the deleting code run in another thread whilst it returns a page to the user?</p>\n"},{"tags":["java","multithreading","libgdx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12671089,"title":"java Threads in libGDX","body":"<p>Hey guys I am working on making a game with libGDX and I really want to thread the game so I am running a paint loop and a logic loop on separate threads much like you would making a simple java swing game with the paintcomponent loop and the runnable run loop</p>\n\n<p>I am experienced with threading in c but not so much in java\nthe only way I was able to make a thread was by making a class that extends threads and then creating the run loop in there</p>\n\n<p>but the point of making the run loop was to allow each screen to compute logic freely so I would end up needing some sort of abstractscreen class that has the custom thread class implemented</p>\n\n<p>Im asking if there is a simpler or more standard way of implementing threads for this situation </p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12677263,"title":"How can two threads communicate while both are running?","body":"<p>I've been trying to teach myself concurrency, and I've run into an issue.  I understand that two Java threads can communicate to each other via <code>wait()</code> and <code>notify()</code>.  However, this requires one thread to be inactive and essentially \"just sitting around\" until the other one wakes it up.</p>\n\n<p>Is it possible to have both threads running simultaneously and still have them listening for notifications from the other?  Would this be accomplished through concurrency techniques or instead something like an <code>ActionListener</code>?</p>\n\n<p>For example, the project I'm testing this on is basically a grid where different entities wander around through different cells.  When two of the entities happen to wander into the same cell, I'd like one to notify the other and something different to happen based on this (for instance, a greeting: \"Hello there!\").  But as it stands, with the wait/notify paradigm, one of the threads/entities has to simply sit in one cell waiting for another to wander in; they can't both move around.</p>\n"},{"tags":["c++","multithreading","cuda","gpu","gpgpu"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12671408,"title":"CUDA indices for loops with counters","body":"<p>I've got a nested loop with a counter in between.\nI've managed to use CUDA indices for the outer loop, but I can't think of any way of getting exploiting more parallelism in this kind of loops.\nDo you have any experience working with something similar to that?</p>\n\n<pre><code>int i = threadIdx.x + blockIdx.x * blockDim.x;\nif (i &lt; Nx) {\n    counter = 0;\n    for (k = 0; k &lt; Ny; k++) {\n\n        d_V[i*Ny + k] = 0;\n\n        if ( d_X[i*Ny + k] &gt;= 2e2 ) {\n\n             /* do stuff with i and k and counter i.e.*/\n                d_example[i*length + counter] = k;\n                    ...\n             /* increment counter */\n             counter++;\n        }\n    }\n}\n</code></pre>\n\n<p>The problem that I see is how to deal with counter, as <code>k</code> could be also be indexed in CUDA with <code>threadIdx.y + blockIdx.y * blockDim.y</code></p>\n"},{"tags":["c#","wpf","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12678244,"title":"WPF UI hangs when trying to run an endless loop thread","body":"<p>so my problem is that when i set for my wpf application an endless thread the ui hangs but of course this is not what i expect from a multi-threaded application.</p>\n\n<p>heres my code</p>\n\n<pre><code>public partial class MainWindow : Window\n{\n    public MainWindow()\n    {\n        InitializeComponent();\n        System.Threading.Thread thread = new System.Threading.Thread(\n            new System.Threading.ThreadStart(\n                delegate\n                {\n                    Dispatcher.Invoke(DispatcherPriority.Normal,\n                        new Action&lt;Polyline&gt;(ChangePoints), polyline);\n                }));\n        thread.Start();\n    }\n\n    private void ChangePoints(Polyline p)\n    {\n        while (true)\n        {\n            Random random = new Random();\n            p.Points.Clear();\n            for (int i = 0; i &lt; 500; i += 10)\n            {\n                p.Points.Add(new Point(i, random.Next(1, 300)));\n            }\n        }\n    }\n}\n\n\n&lt;Window x:Class=\"ClientSide.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        Title=\"MainWindow\" Height=\"300\" Width=\"500\"&gt;\n    &lt;Canvas x:Name=\"canvas\" Background=\"#00FFFFFF\"&gt;\n        &lt;Polyline x:Name=\"polyline\" Stroke=\"DarkGreen\" StrokeThickness=\"3\" /&gt;\n    &lt;/Canvas&gt;\n&lt;/Window&gt;\n</code></pre>\n\n<p>can you guys tell me whats wrong in here?</p>\n"},{"tags":["android","multithreading","android-view"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":11551837,"title":"Is there a way to invalidate (update) screen from a thread without using a runnable","body":"<p>I have a background thread that sleeps for 1/10 of a second, then re loops.  I would like it to invalidate the screen, so it will redraw and do a simple animation.  It seems like the only way I can invalidate the screen is if I do it in a Runnable, which  assume has a lot of overhead.</p>\n\n<p>Is there a way to invalidate the screen inside a thread without using a runnable??</p>\n"},{"tags":["c#","multithreading"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":257,"score":2,"question_id":2864910,"title":"C# regularly return values from a different thread","body":"<p>I'm very new to multithreading and lack experience. I need to compute some data in a different thread so the UI doesn't hang up, and then send the data as it is processed to a table on the main form. So, basically, the user can work with the data that is already computed, while other data is still being processed. What is the best way to achieve this? I would also be very grateful for any examples. Thanks in advance.</p>\n"},{"tags":["python","multithreading"],"answer_count":3,"favorite_count":4,"up_vote_count":10,"down_vote_count":0,"view_count":3156,"score":10,"question_id":1348026,"title":"How do I create a file in python without overwriting an existing file","body":"<p>Currently I have a loop that tries to find an unused filename by adding suffixes to a filename string.  Once it fails to find a file, it uses the name that failed to open a new file wit that name.  Problem is this code is used in a website and there could be multiple attempts to do the same thing at the same time, so a race condition exists.</p>\n\n<p>How can I keep python from overwriting an existing file, if one is created between the time of the check and the time of the open in the other thread.</p>\n\n<p>I can minimize the chance by randomizing the suffixes, but the chance is already minimized based on parts of the pathname.  I want to eliminate that chance with a function that can be told, create this file ONLY if it doesn't exist.</p>\n\n<p>I can use win32 functions to do this, but I want this to work cross platform because it will be hosted on linux in the end.</p>\n"},{"tags":["c#","multithreading","progress-bar"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12676490,"title":"progress bar not progressing","body":"<p>I have a program which is updating a table in sqlserver, I have a form which I want to show the progress of this, the progress bar is incrementing but this is not being displayed. do i need to use background worker for this? example of what im doing</p>\n\n<pre><code>public void updateTable(string tableName)\n{\n  // con is an instance of my form to access progressbar\n  con.progressBar1.Minimum = 1;\n  con.progressBar1.Step = 1;\n  string dbQuery = \"select summet from someting\"\n\n  con.progressBar1.Maximum = address.Tables[0].Rows.Count;\n  MessageBox.Show(\"progress bar max \" + con.progressBar1.Maximum);\n\n   foreach (DataRow LonLat in address.Tables[0].Rows)\n   {\n       con.progressBar1.PerformStep();\n       MessageBox.Show(con.progressBar1.Value.ToString()); // this is incrementing\n       //plus updating table \n\n   }\n\n\n}\n</code></pre>\n"},{"tags":["vb.net","multithreading","web-services","timer","freeze"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12676298,"title":"Display timer while connecting to web service","body":"<p>I inherited a VB2010 application that hits a web service every so often. Its working great except once in a while the connection to the web service becomes problematic. Right now the .Timeout for the service is set at 100000 or 100 seconds. What I would like to do is just update a label on the form so that the user knows how long he has to wait for the timeout. Like \"Connecting (10s)\" or something of the sort. Anyway I tried  several timers and they all seem to freeze since it seems everything else is waiting for the connection thread to finish. Is there a way to update my label while the service is attempting to connect?</p>\n"},{"tags":["c++","multithreading","signals"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12665601,"title":"Threads not relinquishing CPU time even if using sleep","body":"<p>I am running this program where I have multiple threads. Three threads are generating signals for the same parent process. There are four handler threads for handling the signals generated by the signal generating threads. I have a monitoring thread which also receives the signals and processes according. However, I have a situation. I can see that the signals are not divided equally. I mean the signals are directed to the same process. I have four handler threads and one monitoring thread waiting for the signal. So anyone of them can receive the signal. I was expecting it to be distributed uniformly. However, I could see that at time a whole burst of signals are received by the handler threads. The very next time the whole burst of signals are handled by the monitor thread. Why isn't it uniform. I have added a sleep call after the handler/ monitor threads complete handling one signal. So as soon as the handler/monitor completes one signal it should have given the other opportunity to handle the next signal. However, the output doesn't show the case</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;iostream&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;cstdio&gt;\n#include &lt;stdlib.h&gt;\n\n#define NUM_SENDER_PROCESSES 3\n#define NUM_HANDLER_PROCESSES 4\n#define NUM_SIGNAL_REPORT 10\n#define MAX_SIGNAL_COUNT 100000\n\n\nusing namespace std;\n\nvolatile int usrsig1_handler_count = 0;\nint usrsig2_handler_count = 0;\nint usrsig1_sender_count = 0;\nint usrsig2_sender_count = 0;\nint monitor_count = 0;\nint usrsig1_monitor_count = 0;\nint usrsig2_monitor_count = 0;\ndouble time_1[10];\ndouble time_2[10];\nint lock_1 = 0;\nint lock_2 = 0;\nint lock_3 = 0;\nint lock_4 = 0;\nint lock_5 = 0;\n\n\ndouble timestamp() {\n  struct timeval tp;\n  gettimeofday(&amp;tp, NULL);\n  return (double)tp.tv_sec + tp.tv_usec / 1000000.;\n}\n\nvoid sleepMs(double seconds) {\n  usleep((unsigned int)(seconds*1000000));\n}\n\nvoid *senderfunc(void *parm) {\n  srand(time(0));\n  while(true) {\n    int signal_id = rand()%2 + 1;\n    if(signal_id == 1) {\n      while(__sync_lock_test_and_set(&amp;lock_3,1) != 0) {\n      }\n      usrsig1_sender_count++;\n      lock_3 = 0;\n      kill(getpid(), SIGUSR1);\n    } else {\n      while(__sync_lock_test_and_set(&amp;lock_4,1) != 0) {\n      }\n      usrsig2_sender_count++;\n      lock_4 = 0;\n      kill(getpid(), SIGUSR2);\n    }\n\n\n    int r = rand()%10 + 1;\n    double s = (double)r/100;\n    sleepMs(s);\n  }\n}\n\nvoid *handlerfunc(void *parm)\n{\n  int *index = (int *)parm;\n  sigset_t set;\n  sigemptyset(&amp;set);\n  //cout &lt;&lt; (*index) &lt;&lt; endl;\n  if((*index) % 2 == 0) {\n    sigaddset(&amp;set, SIGUSR1);\n  } else {\n    sigaddset(&amp;set, SIGUSR2);\n  }\n\n\n  int sig;\n\n  while(true) {\n    sigwait(&amp;set, &amp;sig);\n    //cout &lt;&lt; \"Handler\" &lt;&lt; endl;\n    if (sig == SIGUSR1) {\n      while(__sync_lock_test_and_set(&amp;lock_1,1) != 0) {\n      }\n      usrsig1_handler_count++;        \n      lock_1 = 0;\n    } else if(sig == SIGUSR2) {\n      while(__sync_lock_test_and_set(&amp;lock_2,1) != 0) {\n      }\n      usrsig2_handler_count++;\n      lock_2 = 0;\n    }\n\n    sleepMs(0.0001);\n  }\n\n}\n\nvoid *monitorfunc(void *parm) {\n\n  sigset_t set;\n  sigemptyset(&amp;set);\n\n  sigaddset(&amp;set, SIGUSR1);\n  sigaddset(&amp;set, SIGUSR2);\n\n  int sig;  \n\n  while(true) {\n    sigwait(&amp;set, &amp;sig);\n    //cout &lt;&lt; \"Monitor\" &lt;&lt; endl;\n    if(sig == SIGUSR1) {\n      time_1[usrsig1_monitor_count] = timestamp();\n      usrsig1_monitor_count++;\n    } else if(sig == SIGUSR2) {\n      time_2[usrsig2_monitor_count] = timestamp();\n      usrsig2_monitor_count++;\n    }\n    monitor_count++;\n    //cout &lt;&lt; monitor_count &lt;&lt; endl;\n\n    if(monitor_count == NUM_SIGNAL_REPORT) {\n      double difference_1 = 0;\n      double difference_2 = 0;\n      if(usrsig1_monitor_count &gt; 1) {\n        for(int i=0; i&lt;usrsig1_monitor_count-1; i++) {\n          difference_1 = difference_1 + time_1[i+1] - time_1[i];\n        }\n        cout &lt;&lt; \"Interval SIGUSR1 = \" &lt;&lt; difference_1/(usrsig1_monitor_count-1)&lt;&lt; endl;\n      }\n\n      if(usrsig2_monitor_count &gt; 1) {\n        for(int i=0; i&lt;usrsig2_monitor_count-1; i++) {\n          difference_2 = difference_2 + time_2[i+1] - time_2[i];\n        }\n        cout &lt;&lt; \"Interval SIGUSR2 = \" &lt;&lt; difference_2/(usrsig2_monitor_count-1) &lt;&lt; endl;\n      }\n      cout &lt;&lt; \"Count SIGUSR1 = \" &lt;&lt; usrsig1_sender_count &lt;&lt; endl;\n      cout &lt;&lt; \"Count SIGUSR2 = \" &lt;&lt; usrsig2_sender_count &lt;&lt; endl; \n      monitor_count = 0;\n      usrsig1_monitor_count = 0;\n      usrsig2_monitor_count = 0;\n    }\n\n    sleepMs(0.001);\n\n  }\n}\n\nint main(int argc, char **argv)\n{\n  if(argc != 2) {\n    cout &lt;&lt; \"Required parameters missing. \" &lt;&lt; endl;\n    cout &lt;&lt; \"Option 1 = 1 which means run for 30 seconds\" &lt;&lt; endl;\n    cout &lt;&lt; \"Option 2 = 2 which means run until 100000 signals\" &lt;&lt; endl;\n    exit(0);\n  }\n\n  int option = atoi(argv[1]);\n  int i;\n\n  pthread_t handlers[NUM_HANDLER_PROCESSES];\n  pthread_t generators[NUM_SENDER_PROCESSES];\n  pthread_t monitor;\n\n  sigset_t set;\n  sigset_t oldset;\n  sigemptyset(&amp;oldset);\n  sigemptyset(&amp;set);\n  sigaddset(&amp;set, SIGUSR1);\n  sigaddset(&amp;set, SIGUSR2);\n\n  pthread_sigmask(SIG_BLOCK, &amp;set, &amp;oldset);\n\n\n  int handler_mask[4] = {0,1,2,3};\n  //Initializing the handler threads\n  for(i=0; i&lt;NUM_HANDLER_PROCESSES; i++) {\n    pthread_create(&amp;handlers[i], NULL, handlerfunc, (void *)&amp;handler_mask[i]);\n  }\n\n  pthread_create(&amp;monitor, NULL, monitorfunc, NULL);\n\n  sleep(5);\n\n  for(i=0; i&lt;NUM_SENDER_PROCESSES; i++) {\n    pthread_create(&amp;generators[i], NULL, senderfunc, NULL);\n  }\n\n  if(option == 1) {\n    cout &lt;&lt; \"Option 1 \" &lt;&lt; endl;\n    //sleep(30);\n    while(true){\n\n    }\n    exit(0);\n  } else {\n    while(true) {\n      if((usrsig1_handler_count + usrsig2_handler_count) &gt;= MAX_SIGNAL_COUNT) {\n        cout &lt;&lt; \"Count SIGUSR1 = \" &lt;&lt; usrsig1_handler_count &lt;&lt; endl;\n        cout &lt;&lt; \"Count SIGUSR2 = \" &lt;&lt; usrsig2_handler_count &lt;&lt; endl;\n        exit(0);\n      } else {\n        pthread_yield();\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>Here is my output</p>\n\n<pre><code>HandlerHandler\n\nHandler\nHandler\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nMonitor\nHandler\nHandler\nHandler\nHandler\nHandler\nHandler\nHandler\nHandler\nHandler\nHandler\n</code></pre>\n\n<p>You can see the burst of monitor followed by burst of handler. However, in the code once a handler/monitor handles a signal and goes for sigwait, I have added a sleep call so that the turn is passed to the next available thread. However, this is not helping. This should have made it uniform I guess. However, still monitor gets burst and print. Even though in monitor I have placed sleep after it has finished its job for a signal</p>\n"},{"tags":["c#",".net","multithreading","namedpipeserverstream"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12675579,"title":"Multithreaded, MultiClient NamedPipeServer in C#","body":"<p>I was trying to build a multi threaded named pipe server/client. The code base is based on this thread, <a href=\"http://stackoverflow.com/questions/4570653/multithreaded-namepipeserver-in-c-sharp?lq=1\">Multithreaded NamePipeServer in C#</a></p>\n\n<p>The real problem is, i need a bi-directional pipe, to write acknowledgement to cleint. For this, in <code>ProcessClientThread</code> i tried to create <code>StreamWriter</code> using the input <code>pipeStream</code> and write to it, but I'm getting \"Broken Pipe\" exception. The pipe is <code>PipeDirection.InOut</code> already.</p>\n\n<p>Any idea?</p>\n"},{"tags":["java","multithreading","file-io"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":180,"score":1,"question_id":10615867,"title":"File writing and reading objects using Threads","body":"<p>I have a main thread from which we start two subsequent threads that perform  file writing and file reading operations respectively.I have another class called orderDetails with attributes and its getter and setters. The current program runs in such a way that it writes object list to the file in a stretch and reads it back.</p>\n\n<p><em><strong>QUESTION: I am in need to write the contents of the object(cust1) into a file and read it back from file simultaneously.This has to be performed for all the objects(cust1,cust2) specified. Suggest the possible ways to resolve this.</em></strong></p>\n\n<p><strong>Main Class</strong>  </p>\n\n<pre><code>public class MainThread  {\n         public static void main(String[] args) throws InterruptedException {\n              Thread1 td1=new Thread1();\n              Thread2 td2=new Thread2();\n              Thread t1=new Thread(td1);\n              Thread t2=new Thread(td2);\n              t1.start();\n              t1.sleep(100);\n              t2.start();\n        }\n    }\n</code></pre>\n\n<p><strong>orderDetails class- a normal pojo class</strong> </p>\n\n<pre><code> public class orderDetails {\n        private String custName;\n        private double advancePaid;\n        private int mobileModel;\n        private boolean replacement;\n        private String problemFaced;\n        private boolean softwareRequirement;\n       public orderDetails(String custName, double advancePaid, int mobileModel,\n                boolean replacement, String problemFaced,\n                boolean softwareRequirement) {\n            super();\n            this.custName = custName;\n            this.advancePaid = advancePaid;\n            this.mobileModel = mobileModel;\n            this.replacement = replacement;\n            this.problemFaced = problemFaced;\n            this.softwareRequirement = softwareRequirement;\n        } \n        public boolean isSoftwareRequirement() {\n            return softwareRequirement;\n        }\n        public void setSoftwareRequirement(boolean softwareRequirement) {\n            this.softwareRequirement = softwareRequirement;\n        }\n        public int getMobileModel() {\n            return mobileModel;\n        }\n        public void setMobileModel(int mobileModel) {\n            this.mobileModel = mobileModel;\n        }\n        public String getProblemFaced() {\n            return problemFaced;\n        }\n        public void setProblemFaced(String problemFaced) {\n            this.problemFaced = problemFaced;\n        }\n        public boolean isReplacement() {\n            return replacement;\n        }\n        public void setReplacement(boolean replacement) {\n            this.replacement = replacement;\n        }\n        public double getAdvancePaid() {\n            return advancePaid;\n        }\n        public void setAdvancePaid(double advancePaid) {\n            this.advancePaid = advancePaid;\n        }\n        public String getCustName() {\n            return custName;\n        }\n        public void setCustName(String custName) {\n            this.custName = custName;\n        }\n\n    }\n</code></pre>\n\n<p><strong>File Writing-Writes the attributes into the file</strong>    </p>\n\n<pre><code> public class FileWriting implements Runnable {\n        orderDetails cust1=new orderDetails(\"vid\",2000.00,2543,true,\"display\",false);\n        orderDetails cust2=new orderDetails(\"kesav\",8000.00,7845,false,\"battery\",true);\n        ArrayList&lt;orderDetails&gt; orderArr=new ArrayList&lt;orderDetails&gt;();\n         orderDetails obj;\n                public void run() {\n            orderArr.add(cust1);\n            orderArr.add(cust2);\n             try {\n                for(orderDetails obj:orderArr)\n                {\n                fileOperations(obj);\n                }\n            }\n                catch (IOException e) {\n                    e.printStackTrace();\n            }\n        }\n\n        public void fileOperations(orderDetails obj) throws IOException{\n            File f= new File(\"C:\\\\Users\\\\311518\\\\Desktop\\\\threadtest2.txt\");\n            Calendar calNow = Calendar.getInstance();\n            Calendar orderDate;\n            SimpleDateFormat formatter = new SimpleDateFormat(\"dd/MM/yyyy\");\n            FileWriter fstream;\n              if(f.exists()){\n                  //append mode\n             fstream = new FileWriter(f,true);\n              }\n              else\n              {\n                  // to open a new file\n              f.createNewFile();\n                    // write mode\n             fstream = new FileWriter(f,false);\n              }\n              BufferedWriter out = new BufferedWriter(fstream);\n                     out.write(obj.getCustName()+\" \"+obj.getMobileModel()+\" \"+obj.getProblemFaced()+\" \"+obj.getAdvancePaid()+\" \"+obj.isReplacement()+\" \"+obj.isSoftwareRequirement());  \n                     double balanceAmt=obj.getAdvancePaid()-200;\n                     out.write(\" \"+balanceAmt); \n                     orderDate = (Calendar) calNow.clone();\n                     out.write(\" \"+formatter.format(orderDate.getTime()));\n                     orderDate.add(Calendar.DAY_OF_YEAR, + 10);\n                     out.write(\" \"+formatter.format(orderDate.getTime()));\n                     out.newLine();\n                 out.close();\n        }\n     }\n</code></pre>\n\n<p><strong>File Reading class-Reads the attributes from the file</strong>   </p>\n\n<pre><code> public class FileReading implements Runnable{\n        File f= new File(\"C:\\\\Users\\\\311518\\\\Desktop\\\\threadtest2.txt\");\n        public void run() {\n            try {\n                readingText();\n                System.out.println(\"Thanks for ur order\");\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n        public void readingText() throws IOException{\n            String [] temp = null;\n            FileReader fr = new FileReader(f); \n            BufferedReader br = new BufferedReader(fr); \n            String s; \n            System.out.println(\"--------ORDER DETAILS------\");\n             System.out.println(\"Name Model Adv Prob Replacement S/w Bal OrderDate Deliverdate \");\n                while((s = br.readLine()) != null) { \n                                      //display ordered details\n                      temp = s.toString().split(\"\\n\");\n                      for(int i=0;i&lt;temp.length;i++){\n                    System.out.println(temp[i]);\n                      }\n        }\n\n    }\n    }\n</code></pre>\n"},{"tags":["multithreading","language-agnostic","asynchronous"],"answer_count":10,"favorite_count":10,"up_vote_count":10,"down_vote_count":0,"view_count":5442,"score":10,"question_id":600795,"title":"Asynchronous vs Multithreading- is there a difference?","body":"<p>Does an asynchronous call always create a new thread? What is the difference between the two?</p>\n\n<p>EDIT: </p>\n\n<p>Does an asynchronous call always create or use a new thread?</p>\n\n<p>Wikipedia says:</p>\n\n<p>In programming, asynchronous events are those occurring independently of the main program flow. Asynchronous actions are actions executed in a non-blocking scheme, allowing the main program flow to continue processing.</p>\n\n<p>I know async calls can be done on single threads? How is this possible?</p>\n"},{"tags":["android","multithreading","asynchronous","task"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":404,"score":5,"question_id":9763476,"title":"Start Async Task within a worker thread","body":"<p>I have two questions:</p>\n\n<ul>\n<li>Can we start/execute an Async Task within a worker thread?</li>\n<li>If yes, the methods <code>onPreExecute()</code>, <code>onProgressUpdate(Progress...)</code> and <code>onPostExecute(Result)</code> are invoked on the UI thread?</li>\n</ul>\n\n<p>I wanna know that because I have a TCP connection running on a worker thread and when a packet is received I wanna start a new thread to make the parse of this packet and after that refresh some data structures on the UI thread.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["multithreading","spring","aop"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":11495320,"title":"Spring AOP aspect not triggered in thread","body":"<p>Every method that called before thread is running, works good, but after starting a thread It doesn't enters aspect.</p>\n\n<p>I'm using JDK dynamic proxy objects that implements interface,\nall public methods called from other thread and not from object itself.</p>\n\n<p>I'm using spring 3.0.6.</p>\n\n<p>Please help me to understand what I'm missing.</p>\n\n<p>Aspect:</p>\n\n<pre><code>@Aspect \npublic class CabLoggingAspect {\n\n    public void init() {\n        System.out.println(\"CabLoggingAspect: init()\");\n    }\n\n    @Pointcut(\"execution(* com.station.taxi.ICab.*(..))\")\n    public void anyCall() { }\n\n    @Before(\"anyCall()\")\n    public void logAnyCall(JoinPoint joinPoint) {\n        System.out.println(\"CabLoggingAspect: logAnyCall(): \"+joinPoint.getSignature().getName());\n    }\n}\n</code></pre>\n\n<p>Spring Configuration:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd \n       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd \"&gt;\n\n    &lt;bean id=\"cab\" class=\"com.station.taxi.Cab\" scope=\"prototype\" /&gt;    \n    &lt;aop:aspectj-autoproxy&gt;\n        &lt;aop:include name=\"cabLoggingAspect\"/&gt;\n    &lt;/aop:aspectj-autoproxy&gt;\n    &lt;!-- AspectJ --&gt;\n    &lt;bean id=\"cabLoggingAspect\" class=\"com.station.taxi.aop.CabLoggingAspect\" init-method=\"init\"/&gt;\n&lt;/beans&gt;\n</code></pre>\n\n<p>Creation of bean:</p>\n\n<pre><code>public ICab createCab(int num, String whileWaiting) {\n    Object o = mApplicationContext.getBean(\"cab\", num, whileWaiting);\n    return (ICab)o;\n}\n</code></pre>\n\n<p>Running threads:</p>\n\n<pre><code>// public interface ICab extends Runnable { ...\n// ... \n// initCabs.add(mContext.createCab(Integer.valueOf(cabNum), whileWaiting));\n// ...\nfor(ICab cab: initCabs) {\n    cab.setMeter(createTaxiMeter());\n    cab.setStationEventListener(this);\n    mInitThreads.add(cab);\n}\n// ...\nfor(Runnable t: mInitThreads) {\n    new Thread(t).start();\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>CabLoggingAspect: init()\nCabLoggingAspect: logAnyCall(): setMeter\nCabLoggingAspect: logAnyCall(): setStationEventListener\nCabLoggingAspect: logAnyCall(): setMeter\nCabLoggingAspect: logAnyCall(): setStationEventListener\nCabLoggingAspect: logAnyCall(): run\nCabLoggingAspect: logAnyCall(): run\n</code></pre>\n\n<p>run() function called and nothing else printed by aspect.  I'm modifying existing project, all thread are running and I can see output from threads, not related to implementation of aspect </p>\n\n<pre><code>15/07/2012 23:19:05 Usjy - Passanger is ready and running...\n15/07/2012 23:19:05 Usjy - Took cab starting transit\n15/07/2012 23:19:06 MCMk - Passanger is ready and running...\n15/07/2012 23:19:06 MCMk - Took cab starting transit\n15/07/2012 23:19:08 Usjy - Arrived at TelAviv paid 5.8\n15/07/2012 23:19:10 MCMk - Arrived at TelAviv paid 6.3\n</code></pre>\n\n<p><strong>Update/Solution</strong></p>\n\n<p><em>Problem</em></p>\n\n<p>As described by Biju Kunjummen in his answer. When thread is running it notifies back to the caller and pass self instance. All following calls were executed on this instance directly  bypassing proxy.</p>\n\n<p>public class CabImpl implements ICab { \n       @Override\n       public void run() {<br>\n          mStationListener.onCabReady(this);\n       }\n   }</p>\n\n<p><em>Solution</em></p>\n\n<p>Because I have multiple places where I pass the instance of the original object with event, the quick solution was to store reference to the proxy object inside instance and send it. But more correct solution is to use AspectJ, this will illuminate unnecessary code modification and dependencies.</p>\n\n<p>Modifications inside cab object</p>\n\n<pre><code>private ICab mAopProxy;\n//...\npublic void setAopProxy(ICab proxy) {\n    mAopProxy = proxy;\n}\n\n@Override\npublic void run() {\n    mStationListener.onCabReady(mAopProxy);\n    //...\n}\n</code></pre>\n\n<p>Creation of cab</p>\n\n<pre><code>Advised advised = (Advised)mApplicationContext.getBean(\"cab\", num, whileWaiting);\nCab cab = (Cab) advised.getTargetSource().getTarget();\ncab.setAopProxy((ICab)advised);\n</code></pre>\n"},{"tags":["android","multithreading","graphics","surfaceview","invalidate"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":167,"score":2,"question_id":12311731,"title":"Android SurfaceView, OnDraw called but display is not updating without invalidate()","body":"<p>I'm having a little trouble following a typical Android graphics flow. There are many examples but mine seems not to work. In my main activity I do this: </p>\n\n<pre><code>super.onCreate(savedInstanceState);                           \nsetContentView(R.layout.activity_main); \n</code></pre>\n\n<p>In my resources file I have 3 custom classes that override SurfaceView. In my constructor for these Surface Views I have something like this:</p>\n\n<pre><code>super(context, attrs);\ngetHolder().addCallback(this);\nthis.thread = new MyThread(getHolder(),this);\n</code></pre>\n\n<p>In my thread's run method I do this (lifted from many examples I've seen):</p>\n\n<pre><code>Canvas c;\ntry {\n    c = surfaceHolder.lockCanvas(null);\n    synchronized (surfaceHolder) {\n        panel.onDraw(c);\n    }\n} finally {\n    if (c != null) {\n    surfaceHolder.unlockCanvasAndPost(c);\n}\n</code></pre>\n\n<p>This thread is started in my SurfaceView's 'surfaceCreated' event.  In onDraw I do this:</p>\n\n<pre><code>public void onDraw(Canvas canvas) { \n    super.onDraw(canvas);\n    &lt;some drawing stuff here using canvas&gt;\n}\n</code></pre>\n\n<p>When I run, the thread does indeed run, and I can see that onDraw is getting called (I put log print command in there), however my graphics don't update as expected. If I call this.invalidate(), however, the graphics do update a handful of times as I expect until I crash with this: </p>\n\n<pre><code>E/AndroidRuntime(748): android.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.\n</code></pre>\n\n<p>I realize according the examples I've seen I shouldn't need to call invalidate in OnDraw, but I did it just to verify that the code in my onDraw is valid. So, it seems to me that without the invalidate() the onDraw event is getting called, and my code should be updating the graphics properly, but the screen never updates. I'm missing something in how the main Activity actually decides that it needs to repaint it's children.</p>\n\n<p>Any ideas would be greatly appreciated. I've spent a while trying to copy stuff from some working demos but I just seem to be stuck. Thanks</p>\n"},{"tags":["java","multithreading","race-condition"],"answer_count":7,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":497,"score":4,"question_id":3381619,"title":"Help needed in Multithreading to determing which thread stops first","body":"<p><em>Write a class named RaceHorse that extends Thread. Each RaceHorse has a name and run() method that displays the name 5000 times. Write a Java application that instantiates 2 RaceHorse objects. The last RaceHorse to finish is the loser.</em></p>\n\n<p>This is the question.\nI have written the code for the two classes two run the thread\nHere are the codes :-\n<strong>RaceHorse</strong></p>\n\n<pre><code>class RaceHorse extends Thread\n{\n    public String name;\n    public RaceHorse(String name)\n    {\n        this.name = name;\n    }\n    public void run()\n    {\n        for(int i = 1 ; i &lt;= 5000; i++)\n        {\n            System.out.println(i+\"  \"+name);\n        }\n        System.out.println(name+\" finished.\");\n    }\n}\n</code></pre>\n\n<p><strong>Runner</strong></p>\n\n<pre><code>class Runner{\n    public static void main(String args[])\n    {\n        RaceHorse obj = new RaceHorse(\"Lol\");\n        RaceHorse obj2 = new RaceHorse(\"BOL\");\n        Thread t = new Thread(obj);\n        Thread t2 = new Thread(obj2);\n        t.start();\n        t2.start();\n    }\n}\n</code></pre>\n\n<p>*Now my problem is I am unable to find which of the thread finishes first and which seconds, i.e. which of the horse wins and which loses.!\nSo please anyone help me out.!<strong>*strong text</strong></p>\n"},{"tags":["java","multithreading","dining-philosopher"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1529,"score":2,"question_id":604667,"title":"Another way to solve the Dining Philosopher (need a point in the right direction)","body":"<p>for a programming assignment I have been asked to implement a solution to the Dining Philosopher problem. I must do so in two ways:</p>\n\n<ol>\n<li>Use the wait() and notifyAll() mechanism</li>\n<li>Using an existing concurrent data structure provided in the Java API</li>\n</ol>\n\n<p>I have already complete the first implementation. Which concurrent data structure is my professor talking about for step two? I don't remember her mentioning anything. I don't need any source code, just a pointer in the right direction.</p>\n"},{"tags":["python","multithreading","timer","python-multithreading"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12672750,"title":"Running a timer for few minutes in python","body":"<p>I am trying to run a certain function \"foo\" every second. I have to do this for a few minutes (say 5).</p>\n\n<p>The function foo() makes 100 HTTP Requests (which contains a JSON object) to the server and prints the JSON response.</p>\n\n<p>In short, I have to make 100 HTTP requests per second for 5 minutes.</p>\n\n<p>I have just started learning python, thus don't have extensive knowledge. This is what I have tried:</p>\n\n<pre><code>import threading\nnoOfSecondsPassed = 0\ndef foo():\n   global noOfSecondsPassed\n   # piece of code which makes 100 HTTP requests (I use while loop)\n   noOfSecondsPassed += 1\n\nwhile True:\n   if noOfSecondsPassed &lt; (300)  # 5 minutes\n       t = threading.Timer(1.0, foo)\n       t.start()\n</code></pre>\n\n<p>Due to multiple threads, the function foo isn't called 300 times but much much more than that.\nI have tried setting a lock too:</p>\n\n<pre><code>def foo():\n  l = threading.Lock()\n  l.acquire()\n  global noOfSecondsPassed\n  # piece of code which makes 100 HTTP requests (I use while loop)\n  noOfSecondsPassed += 1\n  l.release()\n</code></pre>\n\n<p>Rest of code is same as the previous code snippet. But this also does not work.</p>\n\n<p>How do I do this?</p>\n\n<p><strong>Edit: Different Approach</strong></p>\n\n<p>I have tried this approach which worked for me:</p>\n\n<pre><code>def foo():\n    noOfSecondsPassed = 0\n    while noOfSecondsPassed &lt; 300:\n       #Code to make 100 HTTP requests\n       noOfSecondsPassed +=1\n       time.sleep(1.0)\nfoo()\n</code></pre>\n\n<p>Any disadvantages in doing so?</p>\n"},{"tags":["c#","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12671636,"title":"How to create a calling machine?","body":"<p>I have to create a c# program that reads from a list of items such as OperatorID, PhoneNumber and makes call to a different device by OperatorID.</p>\n\n<p>Items with different OperatorID's and same PhoneNumber can exist in the list. For Example:</p>\n\n<ul>\n    <li>(22201,911)\n    <li>(22210,911)\n</ul>\n\n<p>All must be do with thread and i have to avoid call collisions (cannot call a number at the same time with different OperatorID, otherwise line will be busy!).</p>\n\n<p>What OOP design pattern can I use? should I implement a dispatcher? Any ideas?</p>\n"},{"tags":["java","multithreading","wait","notify"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":2,"view_count":563,"score":2,"question_id":8358600,"title":"A good small example to demonstrate wait() and notify() method in java","body":"<p>Can anybody please provide me a good small example demonstrate wait() and notify() functionality in java. I've tried with the below piece of code but it's not showing what i expected. </p>\n\n\n\n<pre><code>public class WaitDemo {\n    int i = 10;\n\n    int display() {\n        System.out.println(\"Lexmark\");\n        i++;\n        return i;\n    }\n}\n</code></pre>\n\n    \n\n<pre><code>public class ClassDemo1 extends Thread {\n\n    private WaitDemo wd = new WaitDemo();\n\n    public static void main(String[] args) {\n        ClassDemo1 cd1 = new ClassDemo1();\n        ClassDemo1 cd2 = new ClassDemo1();\n        cd1.setName(\"Europe\");\n        cd2.setName(\"America\");\n        cd1.start();\n        cd2.start();\n\n    }\n\n    synchronized void display() {\n        System.out.println(\"Hello\");\n        notifyAll();\n    }\n\n    public void run() {\n\n        synchronized (this) {\n            try {\n                {\n                    notify();\n                    System.out.println(\"The thread is \" + currentThread().getName());\n                    wait();\n                    System.out.println(\"The value is \" + wd.display());\n                }\n            } catch (InterruptedException e) {\n\n            }\n\n        }\n    }\n}\n</code></pre>\n\n<p>The issue is that the method in the class WaitDemo is not getting executed and as per my idea the SOP after wait() should execute. Please help me out on this.</p>\n"},{"tags":["java","multithreading","http","producer-consumer"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":12667003,"title":"Store raw HTML content from URL then get a InputStream from memory (not using a connection)","body":"<p>I have a kind of tricky problem involving multi-threading. What I do is that I use a thread pool (<code>ExecutorService</code>) that is tasked with opening connections and putting them in a <code>LinkedBlockingQueue</code>.</p>\n\n<p>So far I have used:</p>\n\n<pre><code>//run method in \"getter threads\"\npublic void run() {\n\n    try {\n\n    URL url = new URL(url_s); //url_s is given as a constructor argument\n\n    //if I am correct then url.openStream will wait until we have the content\n    InputStream stream = url.openStream();\n\n    Request req = new Request(); //a class with two variables:\n    req.html_stream = new InputSource(stream);\n    req.source = stream;\n\n    //this is a class variable (LinkedBlockingQueue&lt;Request&gt;)\n    blocking_queue.put(req);\n\n    } catch  (Exception ex) {\n    logger.info(\"Getter thread died from an exeption\",ex);\n    return;\n    }\n}\n</code></pre>\n\n<p>I then have consumer thread (java.lang.Thread) that takes these <code>InputSource</code>s and <code>InputStream</code>s and does:</p>\n\n<pre><code>public void run() {\n   while(running) {\n        try {\n            logger.info(\"waiting for data to eat\");\n            Request req = blocking_queue.take();\n            if(req.html_stream != null)\n            eat_data(req);\n        } catch (Exception ex) {\n            logger.error(ex);\n            return;\n        }\n   }\n}\n</code></pre>\n\n<p>Where eat_data calls an external library that takes InputSource. The library uses a singleton instance to do the processing so I cant put this step in the \"getter\" threads.</p>\n\n<p>When I tested this code for small amounts of data it worked fine, but when I supplied it with several thousands of URLs I started to have real problems. Its not easy to find out exactly what is wrong, but I suspect that the connections time out before the consumer thread get to them, sometimes even causing deadlock.</p>\n\n<p>I implemented it this way because it was so easy to go from url.openStream() to InputSource but I realize that I really must store the data locally for this to work.</p>\n\n<p>How do I get from url.openStream() to some object I can store in my <code>LinkedBlockingQueue</code> (all data in memory) that I can later turn into an InputSoruce when my consumer thread has time to process it?</p>\n"},{"tags":["iphone","objective-c","ios","multithreading","background"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12671042,"title":"moving a function to a background thread in objective c","body":"<p>I have a function that returns a string that takes 15 seconds to compute on an iPhone. </p>\n\n<p>I want to be able to run the function on the background thread so that the main thread can be used for the user interface.</p>\n\n<p>I've heard <code>GCD</code> is a new technology that is good for this, can someone provide some example code in regards to how this would work?</p>\n\n<p>That is to run a generic function on the background thread and return the result to a UI text field.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Thanks Alladinian it works a treat. </p>\n\n<p>However, when I use GCD my function takes 1 second longer to execute on the iphone simulator (I'd guess this'd be about 5 seconds on an iphone (ill have to test it later today to be sure))</p>\n\n<p>Is there any reason why this is? Perhaps the background thread is slower or something?</p>\n"},{"tags":["java","multithreading","spring-mvc"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":12670720,"title":"Submitting a background task from spring mvc app","body":"<p>I've got working spring MVC app and what I'm trying to do next is to start or submit a background task from my app.</p>\n\n<p>Basically I'd like to keep the task going until it completes even if the user decides to do something else on the app.</p>\n\n<p>But also I'd like to stop/kill/pause the task if I needed to. Since I haven't done this before I'm looking for a good/better way to do this.</p>\n\n<p>I found these to be useful:</p>\n\n<p><a href=\"http://blog.springsource.com/2010/01/05/task-scheduling-simplifications-in-spring-3-0/\" rel=\"nofollow\">http://blog.springsource.com/2010/01/05/task-scheduling-simplifications-in-spring-3-0/</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/671049/how-do-you-kill-a-thread-in-java\">How do you kill a thread in Java?</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/181615/java-threads-is-it-possible-view-pause-kill-a-particular-thread-from-a-differen\">Java threads: Is it possible view/pause/kill a particular thread from a different java program running on the same JVM?</a></p>\n\n<p>So I wanted to use @Async task to submit my background task, but wanted to use threads' id to obtain it later on and stop it if needed?</p>\n\n<p>Is this the right approach? I don't have any experience with multithreading so I'm here to listen.</p>\n\n<p><strong>Code update :</strong></p>\n\n<pre><code>public interface Worker {\n    public void work();\n    public void cancel();\n}\n</code></pre>\n\n<p>implementation :</p>\n\n<pre><code>@Component(\"asyncWorker\")\npublic class AsyncWorker implements Worker {\n\n    @Async\n    public void work() {\n        String threadName = Thread.currentThread().getName();\n        System.out.println(\"   \" + threadName + \" beginning work\");\n        try {\n                Thread.sleep(10000); // simulates work\n        } catch (InterruptedException e) {\n            System.out.println(\"I stopped\");\n        }\n        System.out.println(\"   \" + threadName + \" completed work\");\n    }\n\n    public void cancel() { Thread.currentThread().interrupt(); }\n}\n</code></pre>\n\n<p>Controller for testing purposes :</p>\n\n<pre><code>@ResponseBody\n@RequestMapping(\"/job/start\")\npublic String start() {\n    asyncWorker.work();\n    return \"start\";\n}\n\n@ResponseBody\n@RequestMapping(\"/job/stop\")\npublic String stop() {\n    asyncWorker.cancel();\n    return \"stop\";\n}\n</code></pre>\n\n<p>When I visit <code>/job/start</code>, I can't execute more that one task simultaneously. The other one starts to execute only after first one has completed</p>\n\n<p>Also when I visit <code>/job/stop</code> the process isn't stopped, what am I missing here?</p>\n"},{"tags":[".net","multithreading","task-parallel-library"],"answer_count":3,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":153,"score":7,"question_id":12445175,"title":"How many processor cores does the .NET task scheduler support","body":"<p>Just out of curiosity I would like to know how many processor cores the .NET task scheduler supports.</p>\n\n<p>Windows Server 2012 supports up to 640 cores. Was (is) .NET limited to 64 or would it use all available cores?</p>\n"},{"tags":["java","multithreading"],"answer_count":9,"favorite_count":4,"up_vote_count":0,"down_vote_count":0,"view_count":913,"score":0,"question_id":5498999,"title":"how many threads to run in java?","body":"<p>I had this brilliant idea to speed up the time needed for generating 36 files: use 36 threads!! Unfortunately if I start one connection (one <code>j2ssh</code> connection object) with 36 threads/sessions, everything lags way more than if I execute each thread at a time.<br>\nNow if I try to create 36 new connections (36 <code>j2ssh</code> connection objects) then each thread has a separate connection to server, either i get out of memory exception (somehow the program still runs, and successfully ends its work, slower than the time when I execute one thread after another).   </p>\n\n<p>So what to do? how to find the optimal thread number I should use?\nbecause <code>Thread.activeCount()</code> is 3 before starting mine 36 threads?! i'm using Lenovo laptop Intel core i5. </p>\n"},{"tags":["java","multithreading","udp","datagram"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":11524924,"title":"DatagramChannel  packet listener taking high CPU","body":"<p>I have a packet Listener Thread in Java for UDP packets along with 2-3 other threads.</p>\n\n<p>It was running fine till today but now the process javaw.exe has started using CONSTANT 50% CPU.</p>\n\n<p>Here is my code.</p>\n\n<pre><code>public class PacketListenerThread implements Runnable {\n    private SocketAddress receivedSocketAddress;\n    private DatagramChannel channel;\n    private ExecutorService pool;\n\n    public PacketListenerThread(DatagramChannel channel, ExecutorService pool) {\n        this.channel = channel;\n        this.pool = pool;\n    }\n\n    @Override\n    public void run() {\n        while (true) {\n            receivedSocketAddress = null;\n            ByteBuffer recvbuf = ByteBuffer.allocate(1400);\n            recvbuf.clear();\n            try {\n                receivedSocketAddress = channel.receive(recvbuf);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            if (receivedSocketAddress != null) {\n                pool.submit(new PacketHandlerRunnable(new TaskObject(receivedSocketAddress, recvbuf)));\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I have stopped all other threads but this thread still uses \"CONSTANT\" 50% CPU .</p>\n"},{"tags":["c#","multithreading","static-methods"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":12670233,"title":"thread safety of a static class","body":"<p>I want to create my own event system in my windows application in c#. To do this, i write the following class:<br></p>\n\n<pre><code>internal class EventManager\n{\n    private static List&lt;EventRecord&gt; s_listEvents = new List&lt;EventRecord&gt;();\n\n    public static void AddEvent(EventRecord record)\n    {\n        record.EventDate = DateTime.Now;\n        s_listEvents.Add(record);\n    }\n\n    public static List&lt;EventRecord&gt; GetRecordsByDate(DateTime date)\n    {\n        var r = (from l in s_listEvents\n                 where l.EventDate &gt;= date\n                 select l).ToList&lt;EventRecord&gt;();\n        return r;\n    }\n}\n</code></pre>\n\n<p>I want to be sure that EventManager class is thread-safe. Because i am going to create hundreds of threads at the same time in my application. All the threads will most probably use this class to generate events. And <code>GetRecordsByDate</code> function may be called from outside of the class at the time when <code>AddEvent</code> function will be called from different threads.<br><br>\nSimply, can you tell me that this design is appropriate for multi-thread windows application? If this is not thread-safe, then how can i make my class or its members thread-safe? Should i use a sync object to lock the whole <code>EventManager</code> class or should i use readwritelocker to lock my <code>s_listEvents</code> static member?</p>\n"},{"tags":["java","multithreading","jni"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12670857,"title":"Java Native Function Returns value to a different caller object","body":"<p>I have one class which makes a native call to authenticate a user. At any given point of a time there can be 50-100 objects of this class trying to authenticate a user. The execution time for the native call function is in milliseconds but when it returns the result, the result gets mapped to a different object because of which the authentication fails.</p>\n\n<p>e.g -</p>\n\n<pre><code>public class AS400Invoker {\n    native String authenticateUser(String message, String channelNo);\n    native String changePin(String message, String channelNo);\n    private Logger logger = Logger.getLogger(AS400Invoker.class);\n    static {\n        System.loadLibrary(PropertiesBean.readProperty(\"libraryname\"));\n    }\n    public String userAuthetication(String ucid, String phoneCode, String pin, String channelNo){\n        String toRet = null;\n        try {\n            logger.info(\"[\"+ucid+\"] Inside user authentication function\");\n            logger.info(\"[\"+ucid+\"] phone code received from IVR: \"+phoneCode);\n            logger.info(\"[\"+ucid+\"] channel number received from IVR: \"+channelNo);\n            UserAuthentication ua = new UserAuthentication();\n            String formedMessage = ua.authenticateUser(ucid, phoneCode, pin);\n            logger.info(\"[\"+ucid+\"] user authentication formed message length: \"+formedMessage.length());\n            logger.info(\"[\"+ucid+\"] calling native function to authenticate user....\");\n            if(null != formedMessage)\n                toRet = authenticateUser(formedMessage, channelNo);\n            logger.info(\"[\"+ucid+\"] response received from native function: \"+toRet);\n        }catch(RuntimeException e){\n            logger.error(\"[\"+ucid+\"] Runtime exception occured\", e);\n        }catch(Exception e){\n            logger.error(\"[\"+ucid+\"] Generic exception occured\", e);\n        }\n        return toRet;\n    }\n    public String pinChange(String ucid, String phoneCode, String pin, String cif, String channelNo){\n        String toRet = null;\n        try {\n            logger.info(\"[\"+ucid+\"] Inside pin change function\");\n            logger.info(\"[\"+ucid+\"] phone code received from IVR: \"+phoneCode);\n            logger.info(\"[\"+ucid+\"] CIF received from IVR: \"+cif);\n            logger.info(\"[\"+ucid+\"] channel number received from IVR: \"+channelNo);\n            PinChange pc = new PinChange();\n            String formedMessage = pc.changePin(ucid, phoneCode, pin, cif);\n            logger.info(\"[\"+ucid+\"] pin change formed message length: \"+formedMessage.length());\n            logger.info(\"[\"+ucid+\"] calling native function to change the pin....\");\n            if(null != formedMessage)\n                toRet = changePin(formedMessage, channelNo);\n            logger.info(\"[\"+ucid+\"] response received from native function: \"+toRet);\n        }catch(RuntimeException e){\n            logger.error(\"[\"+ucid+\"] Runtime exception occured\", e);\n        }catch(Exception e){\n            logger.error(\"[\"+ucid+\"] Generic exception occured\", e);\n        }\n        return toRet;\n    }\n}\n</code></pre>\n\n<p>In the above scenario, the result from the native call gets jumbled up. Can any one of you please throw some light on what might be going wrong in these calls? Below is the Log snippet for the same. In the below snippet the request is raised by the object whose UCID is 00001081951348702252 but the response gets mapped to a different UCID 00001080011348671171 and in reality, the response is for 00001081951348702252 UCID.</p>\n\n<pre><code>INFO 2012-09-27 07:30:58,046 [http-7080-2] (UserAuthentication.java:11) - [00001081951348702252] Inside User Authentication\nINFO 2012-09-27 07:30:58,047 [http-7080-2] (UserAuthentication.java:21) - [00001081951348702252] Phone Code: 7447225\nINFO 2012-09-27 07:30:58,047 [http-7080-2] (UserAuthentication.java:23) - [00001081951348702252] Pin code received\nINFO 2012-09-27 07:30:58,048 [http-7080-2] (AS400Invoker.java:51) - [00001081951348702252] user authentication formed message length: 68\nINFO 2012-09-27 07:30:58,048 [http-7080-2] (AS400Invoker.java:52) - [00001081951348702252] calling native function to authenticate user....\nINFO 2012-09-27 07:30:58,201 [http-7080-13] (AS400Invoker.java:55) - [00001080011348671171] response received from native function: 000OCBC08100C1C000000000008zF      621372010937239879230990239023    9D0001641412549001       01                                                                                                                                                                                                                                                                                                      C              HHHHH CULTURE PVT. LTD     201206449R                         XYZ \n</code></pre>\n"},{"tags":["c++","multithreading","winapi","windows-7","windows-7-x64"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12670097,"title":"What is the purpose of this mysterious _TppWaiterpThread thread","body":"<p>Consider this code sample for LookupPrivilegeValue taken from <a href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/aa446619%28v=vs.85%29.aspx\" rel=\"nofollow\">MSDN</a> (with minor code formatting edits)</p>\n\n<pre><code>BOOL SetPrivilege(HANDLE hToken, LPCTSTR lpszPrivilege, BOOL bEnablePrivilege) {\nTOKEN_PRIVILEGES tp;\nLUID luid;\n\nif ( !LookupPrivilegeValue(NULL, lpszPrivilege, &amp;luid ) )  {\n    printf(\"LookupPrivilegeValue error: %u\\n\", GetLastError() ); \n    return FALSE; \n}\n// SET A BREAKPOINT BELOW, notice a new thread was created\ntp.PrivilegeCount = 1;\ntp.Privileges[0].Luid = luid;\nif (bEnablePrivilege) {\n    tp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n}\nelse {\n    tp.Privileges[0].Attributes = 0;\n}\n// Enable the privilege or disable all privileges.\nif ( !AdjustTokenPrivileges( hToken, FALSE, &amp;tp, sizeof(TOKEN_PRIVILEGES), \n(PTOKEN_PRIVILEGES) NULL, (PDWORD) NULL) ) { \n      printf(\"AdjustTokenPrivileges error: %u\\n\", GetLastError() ); \n      return FALSE; \n} \n\nif (GetLastError() == ERROR_NOT_ALL_ASSIGNED) {\n      printf(\"The token does not have the specified privilege. \\n\");\n      return FALSE;\n} \nreturn TRUE;\n}\n</code></pre>\n\n<p>Using VS 2010/2008 debugger after the first call to LookupPrivilegeValue I've noticed that a new worker thread called _TppWaiterpThread@4 was created. This thread lives until the process exits and its stack trace is the following:</p>\n\n<pre><code>ntdll.dll!_KiFastSystemCallRet@0()  \nntdll.dll!_ZwWaitForMultipleObjects@20()  + 0xc bytes   \nntdll.dll!_TppWaiterpThread@4()  + 0x12c bytes  \nkernel32.dll!@BaseThreadInitThunk@12()  + 0x12 bytes    \nntdll.dll!___RtlUserThreadStart@8()  + 0x27 bytes   \nntdll.dll!__RtlUserThreadStart@8()  + 0x1b bytes    \n</code></pre>\n\n<p>Tested on Windows 7 x86/x64 (remote/local debugging). I tried setting two privileges SE_DEBUG_NAME &amp; SE_SYSTEM_NAME. This is how I've called SetPrivilege:</p>\n\n<pre><code>HANDLE hProcess;\nhProcess = OpenProcess(PROCESS_ALL_ACCESS, NULL, GetCurrentProcessId());\nSetPrivilege(hProcess, SE_SYSTEMTIME_NAME, TRUE);\n//SetPrivilege(hProcess, SE_DEBUG_NAME, TRUE);\n</code></pre>\n\n<p>On XP this new thread does not appear.</p>\n\n<p>So my questions are:</p>\n\n<ul>\n<li>What is the purpose of this _TppWaiterpThread thread?  </li>\n<li>Is LookupPrivilegeValue creating this thread behind the scenes to complete its work?</li>\n</ul>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":109,"score":-3,"question_id":10589126,"title":"Writing concurrent calculator in java","body":"<p>I need to write a server that utilizes concurrency to solve math calculations. There is a server and client mode, and the main issue I'm having is that the server needs to have multiple processes, each of which can do arbitrary math calculations. The number of processes running is dynamic and can be expected to change, however there is a main process that gets requests from clients.</p>\n\n<p>I already have the calculator code (all the math and so on..) - I just don't know how to turn my calculator into a multithreaded program.</p>\n\n<p>I really don't know where to start; I read about it on google but I have not found any simple examples to start with. </p>\n\n<p>Can I please get some help ?</p>\n"},{"tags":["javascript","multithreading","node.js","asynchronous","opa"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12662677,"title":"Opa flow control, threading?","body":"<p>Node.js itself supports worker threads and creation of child processes. \nThose of you who have worked with Node.js, may be familiar with flow control libraries such as Async.js or Step.</p>\n\n<p>Now since Opa runs on the Node.js stack, is there a way to use the Async.js library as a javascript module?</p>\n\n<p>Are there any bindings of the Opa language to allow for either threading or some sort of async flow control? \nI suspect not, but I am curious as to <strong>what are the possible options of implementing threading or async flow control in Opa</strong>?</p>\n\n<p>*Now I know I can shell-out and pass my work off to another script in a non-Opa language, but is that my only option?</p>\n\n<p>Thanks in advance, as I am new to Opa and am trying to understand its capabilities!</p>\n"},{"tags":["wpf","multithreading","wcf"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12670035,"title":"Client application hangs while waiting for response from WCF","body":"<p>We have a WPF application, which makes requests to WCF services which are hosted as windows service.\nThe call to the service is on a different thread. However, it is noticed that, when there is some sort of time wait or sleep on the WCF side, the WPF application hangs.\nThe Instance context mode on the service is set to single. Is this a concern?</p>\n\n<p>How can we make the client more responsive? Why should a sleep on the service make the client wait even when the call is not on the UI thread?</p>\n"},{"tags":["android","multithreading","animation","andengine"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12670133,"title":"andengine android animation threads","body":"<p>Hello I have the following code using the Andengine library. The code works, basically it gets the path from the enemy ( a black sheep) in this case to the player, it then uses a path modifier to move the sheep, at the end of the path the process is started again -- so I am creating perpetual movement if you like, using threads. My question is is this the most efficient clean way to do this kind of perpetual path finding?? Thanks</p>\n\n<pre><code>public  void startThread(){  stop1=true; t1 = new Thread(mMoveBlackSheep); t1.start(); }\npublic  void stopThread(){ if(t1 != null){   stop1=false; t1.interrupt(); }}\npublic  void startThread1(){ stop2=true; t2 = new Thread(mMoveBlackSheep1); t2.start(); }\npublic  void stopThread1(){ if(t2 != null){  stop2=false; t2.interrupt(); }}\n\n\nprivate synchronized Path get_coords( int sheep )  {\n    Path retxy=null;\n    try {\n        final float[] playerFootCordinates = player.convertLocalToSceneCoordinates( 12,31 );\n        final TMXTile tmxTile = tmxLayer.getTMXTileAt(playerFootCordinates[Constants.VERTEX_INDEX_X], playerFootCordinates[Constants.VERTEX_INDEX_Y]);\n        int pColPlayer = 0;\n        int pRowPlayer = 0;\n        if(tmxTile != null) {\n            pColPlayer = tmxTile.getTileColumn();\n            pRowPlayer = tmxTile.getTileRow();\n        }\n    AnimatedSprite blacksheep = black_sheep.get(sheep);\n    int pColBlackSheep = 0;\n    int pRowBlackSheep = 0;\n    final float[] MonsterFootCordinates = blacksheep.convertLocalToSceneCoordinates( 12,31 );\n    final TMXTile tmxTile1 = tmxLayer.getTMXTileAt(MonsterFootCordinates[Constants.VERTEX_INDEX_X], MonsterFootCordinates       [Constants.VERTEX_INDEX_Y]);\n    if(tmxTile1 != null) {\n        pColBlackSheep = tmxTile1.getTileColumn();\n        pRowBlackSheep = tmxTile1.getTileRow();\n    }\n    int xx1 = (int)(player.getX() / TileWidth );\n    int yy1 = (int)(player.getY() / TileHeight );\n    int selectedx = pRowBlackSheep;\n    int selectedy = pColBlackSheep;\n\n    pathfinding.Path path=null;\n    Random r1 = new Random();\n    int d1 = r1.nextInt(20);\n        path = finder_sheep.findPath(new UnitMover(1),  selectedx, selectedy, pRowPlayer , pColPlayer );\n    // still null restart thread.\n    if (path==null)\n    {\n        try {\n            int randomAmountOfTime=500;\n            if ( !Thread.interrupted() ) {\n                Thread.sleep(randomAmountOfTime);\n            }\n        } catch (InterruptedException e) {\n        return null;\n        }\n        catch (Exception e)  { e.printStackTrace(); }\n        }\n\n        if (path != null) {\n            int p1=path.getLength();\n            float[] x1        = new float[p1]; \n            float[] y1        = new float[p1];\n            int[]   direction = new int[p1];\n            for (int i=0; i&lt;p1; i++)\n            {\n                int vecX = path.getX(i) * TileWidth;\n                int vecY = path.getY(i) * TileHeight;\n                x1[i] = vecX;\n                y1[i] = vecY;\n                if ( i &gt; 0 ) {\n                    int vecXPrev = path.getX(i-1) * TileWidth;\n                    int vecYPrev = path.getY(i-1) * TileHeight;\n                } else { direction[0]=0; }\n            }\n            retxy = new Path(y1 , x1 );\n            Log.d(\"END CREATE  XY ARRAY\", \"END CREATE XY ARRAY\");\n\n        } else {  retxy=null; }\n    }\n    catch (Exception e) { }\n    return retxy;\n    }\n\n\n    Runnable mMoveBlackSheep =  new Runnable() {public void run()  { if (t1!=null ) { while(!t1.isInterrupted()) {  run1(); }}}};\n    Runnable mMoveBlackSheep1 = new Runnable() {public void run() { if (t2!=null) { while(!t2.isInterrupted())   {  run2(); }}}};\n\n\n    private void run1() {\n        try {\n        Path co1 = get_coords(0);\n        if (co1 != null) {\n            followPath(co1 , 0 ,0 );\n        }\n        } catch (Exception e) {\n            //Log.d(\"run1\", e.getMessage()); \n            }\n    }               \n    private void run2() {\n        try {\n        // get the Column / Row for the player.\n        Path co1 = get_coords(1);\n        if (co1 != null) {\n            followPath(co1 , 1 ,1 );\n        }\n        } catch (Exception e) { \n            //Log.d(\"run1\", e.getMessage()); \n            }\n    }\n\n\nprivate synchronized void followPath( final Path p1 , final int current_sheep , final int threadnum )\n{\n    try\n    {\n        float speedOfPlayer= 4;\n        black_sheep.get(current_sheep).registerEntityModifier(new PathModifier(speedOfPlayer, p1, null, new IPathModifierListener() {\n        public void onPathStarted(final PathModifier pPathModifier, final IEntity pEntity) {\n        }\n\n        //@Override\n        public void onPathWaypointStarted(final PathModifier pPathModifier, final IEntity pEntity, final int pWaypointIndex) {\n                    final long[] frameDurations = new long[3];\n                    Arrays.fill(frameDurations, 500);\n                    black_sheep.get(current_sheep).animate(frameDurations, 0, 2, true);\n        } \n        //@Override\n        public void onPathWaypointFinished(final PathModifier pPathModifier, final IEntity pEntity, final int pWaypointIndex)                   {\n        }\n\n\n        //@Override\n        public void onPathFinished(final PathModifier pPathModifier, final IEntity pEntity) {\n            if ( current_sheep==0) {\n                stopThread();\n                startThread(); }\n            if ( current_sheep==1) {\n                stopThread1();\n                startThread1(); }\n\n        }\n    }));\n\n    }\n    catch (Exception e) {\n        //Log.d(\"ERROR~~~\", e.getMessage() ); \n        } \n}\n</code></pre>\n"},{"tags":["iphone","multithreading","core-data"],"answer_count":4,"favorite_count":24,"up_vote_count":12,"down_vote_count":0,"view_count":8320,"score":12,"question_id":2138252,"title":"Core Data multi thread application","body":"<p>I'm trying to use core data in a multi thread way.\nI simply want to show the application with the previously downloaded data while downloading new data in background. \nThis should let the user access the application during update process.</p>\n\n<p>I have a NSURLConnection which download the file asyncronously using delegate (and showing the progress), then i use an XMLParser to parse the new data and create new NSManagedObjects in a separate context, with its own persistentStore and using a separate thread.</p>\n\n<p>The problem is that creating new objects in the same context of the old one while showing it can throws BAD_INSTRUCTION exception. \nSo, I decided to use a separate context for the new data, but I can't figure out a way to move all the objects to the other context once finished.</p>\n\n<p>Paolo aka SlowTree</p>\n"},{"tags":["asp.net","vb.net","multithreading","excel","quartz.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":87,"score":0,"question_id":12654189,"title":"error occoured while work with excel files with multi thread","body":"<p>In Asp.net\nWhen working with multi threading via Excel Interop using the below code:</p>\n\n<pre><code>Public Class ImportService\nPublic Function ImportsFiles(ByVal files as list(Of String))\nDim rowEffect As Integer = 0\nFor j as Integer=0 to files.Count-1\ndim fileAddress=files(j)\nDim app As New Application\nDim Wbook As Workbook\n\nTry\n    Wbook = app.Workbooks.Open(fileAddress, [ReadOnly]:=True)\n    For i As Integer = 1 To Wbook.Sheets.Count\n        If Not Wbook.Sheets(i).Name.ToString.ToLower.Contains(\"partial read of load profile\") Then\n            Dim con As New System.Data.OleDb.OleDbConnection(\"provider=Microsoft.ACE.OLEDB.12.0; Data Source=\" &amp; fileAddress &amp; \"; Extended Properties=\"\"Excel 12.0 Xml;HDR=No;IMEX=1\"\";\")\n            Dim cmd As New OleDbCommand\n            Dim s As String = \"SELECT * FROM [\" &amp; Wbook.Sheets(i).Name &amp; \"$]\"\n            cmd.CommandText = s\n            cmd.Connection = con\n            Dim da As New OleDbDataAdapter\n            da.SelectCommand = cmd\n            Dim dt As New System.Data.DataTable\n            da.Fill(dt)\n            Dim err As New Dictionary(Of String, String)\n            Dim fileDate As String = Wbook.Sheets(i).Name.ToString.Trim.Replace(\" \", \"/\")\n            rowEffect += InsertLps(Path.GetFileName(fileAddress), fileDate, dt.Rows, err)\n            dt.Dispose()\n            da.Dispose()\n            con.Dispose()\n            cmd.Dispose()\n        End If\n        ReleaseCOMObject(Wbook.Sheets(i))\n        Next\n    Wbook.Close(SaveChanges:=False)\nCatch ex As Exception\n    summary.Add(fileAddress, ex.Message)\nFinally\n    GC.Collect()\n    GC.WaitForPendingFinalizers()\n    GC.Collect()\n    GC.WaitForPendingFinalizers()\n    If app.Workbooks IsNot Nothing Then\n        For Each wb In app.Workbooks\n            For Each ws In wb.Worksheets\n                ReleaseCOMObject(ws)\n            Next\n            wb.Close(False)\n            ReleaseCOMObject(wb)\n        Next\n    End If\n    app.Workbooks.Close()\n    app.Quit()\n    ReleaseCOMObject(app)\n    GC.WaitForFullGCComplete()\nNext\nEnd Function\nEnd Class\n</code></pre>\n\n<p>An error occurs:</p>\n\n<blockquote>\n  <p>Transition into COM context 0x946d20 for this RuntimeCallableWrapper\n  failed with the following error: The object invoked has disconnected\n  from its clients. (Exception from HRESULT: 0x80010108\n  (RPC_E_DISCONNECTED)). This is typically because the COM context\n  0x946d20 where this RuntimeCallableWrapper was created has been\n  disconnected or it is busy doing something else. Releasing the\n  interfaces from the current COM context (COM context 0x946c68). This\n  may cause corruption or data loss. To avoid this problem, please\n  ensure that all COM contexts/apartments/threads stay alive and are\n  available for context transition, until the application is completely\n  done with the RuntimeCallableWrappers that represents COM components\n  that live inside them.</p>\n</blockquote>\n\n<p>i'm trying to work with Quartz.net and more triggers do job in background.\nwhen 2 trrigger start job by  this code:</p>\n\n<pre><code>Public Class ImportJob\nImplements IJob\nPublic Sub Execute(context As IJobExecutionContext) Implements IJob.Execute\n    Dim importHelpers As New ImportFilesHelpers\n    Dim exts As New List(Of String)\n    exts.Add(\".xls\")\n    Dim files = importHelpers.GetFiles(ImportFilesHelpers.BaseAssress, exts)\n    Dim import = New ImportService()\n    import.ImportsFiles(files)\nEnd Sub\nEnd Class\n</code></pre>\n\n<p>Following Error Acoures in This Line</p>\n\n<pre><code>Dim fileDate As String = Wbook.Sheets(i).Name.ToString.Trim.Replace(\" \", \"/\")\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["python","multithreading","methods"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12668962,"title":"Invoking a method in a thread","body":"<p>My code spawns a number of threads to manage communications with a number of I/O boards. Generally the threads receive events from the boards and update external data sources as necessary. The threads (1 or more) are invoked as:</p>\n\n<pre><code>phThreadDict[devId] = ifkit(self, phDevId, phIpAddr, phIpPort, phSerial)\nphThreadDict[devId].start()\n</code></pre>\n\n<p>This works fine. However, in some cases I also need the thread to send a message to the boards. The thread contains a method that does the work and I call that method, from the main thread, as: (this example turns on a digital output)</p>\n\n<pre><code>phThreadDict[devId].writeDigitalOutput(digitalOut, True)\n</code></pre>\n\n<p>this is the method contained in the thread:</p>\n\n<pre><code>def writeDigitalOutput(self,index, state):\n    interfaceKit.setOutputState(index, state)\n</code></pre>\n\n<p><code>threading.enumerate()</code> produces:</p>\n\n<pre><code>{134997634: &lt;ifkit(Thread-1, started daemon)&gt;, 554878244: &lt;ifkit(Thread-3, started daemon)&gt;, 407897606: &lt;tempsensor(Thread-4, started daemon)&gt;}\n</code></pre>\n\n<p>and the instance is:</p>\n\n<pre><code>&lt;ifkit(Thread-3, started daemon)&gt;\n</code></pre>\n\n<p>This works fine if I have only one thread. But, if I have multiple threads, only one is used - the choice appears to be made at random when the program starts.</p>\n\n<p>I suspect that storing the thread identifier in the dict is the problem, but still, it works with one thread.</p>\n"},{"tags":["java","multithreading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12652033,"title":"JAVA Get runnable object in thread","body":"<p>I'm using this standard constructor:</p>\n\n<pre><code>   new Thread(myRunnable);\n</code></pre>\n\n<p>where myRunnable is custom object with Runnable interface.</p>\n\n<p>During the thread process I need to access to that runnable object (to tell the process status and progress), how can I do?</p>\n\n<p>If my object would be a Thread I would use:</p>\n\n<pre><code>   (MyThread) Thread.getCurrentThread()\n</code></pre>\n\n<p>but with runnable passed as parameter I can not get that.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>This is my code structure:</p>\n\n<pre><code>public abstract class ProgressThread{\n    private float progress;     //... progress getter, setter...    \n}\n\npublic class MyRunnable extends ProgressThread implements Runnable{\n    public void run(){\n        //starting processes...\n        Job1 j1=new Job1().do();\n        Job1 j2=new Job2().do();\n    }\n\n    private class Job1(){\n        for(int i=0;i&lt;10;i++){\n            // do something\n            float progress=i/10;\n            // set job progress in thread\n            Thread.getCurrentThread().getRUNNABLE().setProgress(progress);\n        }\n    }\n\n}\n</code></pre>\n\n<p>This is why i need getRUNNABLE() method (or a workaround!).\nThanks.</p>\n"},{"tags":["c#","multithreading","parallel-processing","task-parallel-library","parallel-extensions"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":12662030,"title":"Can I TryTake a group of items from a BlockingCollection<T>?","body":"<p>In an application I'm working on, thousands of updates are being received per second. Reflecting these updates on the UI immediately and one by one is performance overkill.</p>\n\n<p>The following code yields very bad performance, because handling each update requires invoking the UI thread and adding a new item to an ObservableCollection which in turn triggers the CollectionChanged event.</p>\n\n<pre><code>foreach (var update in updates.GetConsumingEnumerable())\n{\n    // Handle Update\n}\n</code></pre>\n\n<p>What I'm trying to do is to make the consumer wait for a little bit of time (i.e. 50 millisecond) to give a chance to the publisher to add more items, and then handle these updates in chunks.</p>\n\n<p>Currently, I'm using the following code, but I find it hard to predict for how long the items will stay in the collection before being consumed, I'm afraid this approach may produce another performance bottleneck.</p>\n\n<pre><code>List&lt;Tuple&lt;T, List&lt;string&gt;&gt;&gt; updatesToHandle = new List&lt;Tuple&lt;T, List&lt;string&gt;&gt;&gt;();\nwhile (!updates.IsAddingCompleted)\n{\n    Tuple&lt;T, List&lt;string&gt;&gt; item = null;\n    if (updates.TryTake(out item, 5)) // Try Take for 5 Milliseconds\n    {\n        updatesToHandle.Add(item);\n    }\n    else\n    {\n        var newItems = new List&lt;T&gt;(updatesToHandle.Count);\n        var updatedItems = new List&lt;Tuple&lt;T, List&lt;string&gt;&gt;&gt;(updatesToHandle.Count);\n        foreach (var update in updatesToHandle)\n        {\n            try\n            {\n                // Handle Update\n            }\n            finally\n            {\n                updatesToHandle.Clear();\n                Thread.Sleep(50);\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading","concurrency","threadpool","thread-pool"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1026,"score":1,"question_id":3174221,"title":"java thread pool keep running","body":"<p>This is more a generic question than a specific one. I'm trying to have a multi threaded environment that stays active so that I can just submit tasks and run them. I want to do this without the hassle of executing in a web server or application server. The idea was to use a java thread pool for this, but the issue here is that the pool stays open just until my main method finishes, after which obviously it closes and the program finishes. How can I prevent this from happening? I'm sure there are several options, some more naive than others (while true loops come to mind). \nAny ideas? Thanks. </p>\n"},{"tags":["android","multithreading","service","operating-system","schedule"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12667356,"title":"Android rescheduling service for obnoxious long time","body":"<p>I have a service that runs in my app everything works perfectly fine except that when the OS kills the service for whatever reason or the user kills the app to instead of restarting quickly like other apps it says \"Scheduling restart of service in xxxxxxxxxms\" like thousands of seconds, I notice other apps when i kill them they say scheduling restart of service in 5 seconds.</p>\n"},{"tags":["java","multithreading","client-server"],"answer_count":6,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":528,"score":0,"question_id":4049010,"title":"\"static class\" or pass references around?","body":"<p>I'm part of a team designing the server for a client/server model naval warfare video game (University course). We have a fairly concrete (well, I think) system design, but there is one aspect that bothers me.</p>\n\n<p>The basic layout of the system is:</p>\n\n<pre><code>Server [thread] (handles incoming connections)\n|\nGame [thread] (deals with game events in it's work queue and sending messages to clients)\n|--Environment (holds environment variables, deals with collision)\n|--Client(s) [thread] (handles incoming messages from client sockets and adds events to the Game's work queue)\n    |--Ship (holds game data, eg: hit points, fire power, etc)\n    |--Parser (parses client messages and creates game event objects)\n|--GameEvent (event objects held in a queue that can preform appropriate work and send appropriate responses to clients)\n</code></pre>\n\n<p>Now, my issue is that both Client and GameEvent (and probably Environment, once we get to it) need a reference to the Game object that they belong to.</p>\n\n<p>Clients need to add GameEvent's to the Game's work queue.</p>\n\n<p>GameEvent's need to access other game data (other Client's Ships, Environment).</p>\n\n<p>Is there a better/more conventional method instead of having these objects store a local reference to their Game? What about declaring all of Game's methods as static? We only need to handle one game at a time, so there wouldn't ever be more than one instance of Game...</p>\n\n<p>I'm sure there is a convention for a system with one central object that has many helper objects that need to reference it.</p>\n"},{"tags":["java","multithreading","ada"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":110,"score":3,"question_id":12666320,"title":"Java equivalent of Ada Select statement","body":"<p>Does anyone know if it's possible to have an Ada-style select statement for threads in Java or if there is an equivalent way to do it?</p>\n\n<p>Specifically I would like to be able to use structures:</p>\n\n<pre><code>select\n  javaThread.someEntry();\nelse\n  //do something else if call not accepted straight away\nend select\n</code></pre>\n\n<p>or</p>\n\n<pre><code>select\n  javaThread.someEntry();\nor\n  //delay before entry call expires\nend select\n</code></pre>\n\n<p>Where <code>someEntry()</code> is a synchronized method that could take a bit of time to enter due to a lot of other threads wanting the lock as well.</p>\n\n<p>Thanks!</p>\n"},{"tags":["java","multithreading","client-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12666262,"title":"Multithreading my client Java program","body":"<p>I have a Java client (client server app) that does two main things: (1) listen to server to receive files and save them to a local folder and (2) watch that folder for changes and send changes to the server. I want to run each in its own thread. First, is it a good idea to run each task on a separate thread. Second, how do I lock the folder when it's used by either task to avoid interference?</p>\n"},{"tags":["ruby","multithreading","rubygems","eventmachine"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":166,"score":1,"question_id":9753992,"title":"Concurrency with EventMachine for a high performance need","body":"<p>I need a high performance network tcp server. I wrote this code in EventMachine.</p>\n\n<pre><code>class ReactingServer &lt; EventMachine::Connection\n  attr_accessor :packet, :packet_class\n  @@packet_count = 0\n\n  def initialize(packet_class)\n    super\n    @packet_class = eval(packet_class)\n    @packet = @packet_class.new\n    @@packet_count = 0\n  end\n\n  def receive_data(data)\n    @packet.clear\n\n    operation = proc do\n      @packet.read(data)\n      @@packet_count = @@packet_count +1\n    end\n\n    call_back = proc do\n      puts @packet.inspect\n      puts \"-------------------#{@@packet_count}------------------------\\n\"\n    end\n    EventMachine.defer operation, call_back\n  end\nend\n</code></pre>\n\n<p>Then i wrote a ruby client.</p>\n\n<pre><code>require 'rubygems'\nrequire 'socket'\n\nsock = TCPSocket.new(\"192.168.15.5\", 8181)\n\n500.times do |n|\n    packet = \"\\x00\\x01\\x1\\x0\\x1FNazar Hu\\x00\\x0F\\xF\\xF\\xF\\xF\\xF\\xF\"\n    sock.send packet, 0\n  sleep 0.01\nend\n</code></pre>\n\n<p>The first problem i am facing is that, if i remove <code>sleep</code> from client many of the packets can't be received on server end. If i send 5 packets, on average 3 packets are received. Why this is been happening.</p>\n\n<p>Other question is that my server needed to server around <code>20K</code> connection and on average 10 connections would be sending packets to server per second. Does <code>EventMachine</code> is capable of handling this kind of load?</p>\n"},{"tags":["multithreading","pyqt","example","qtconcurrent","high-level"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12651726,"title":"How to \"multithread\" single table items that require long time to calculate, using QtConcurrent with PyQt?","body":"<p>I'm a real beginner in multithreading. This question is about high-level multithreading in PyQt. </p>\n\n<p>Suppose that a table widget requires much time to be populated because of some single items, making the window unresponsive meanwhile.\nSo I imagine that a responsive window should require a multithreaded solution in this case, where the big calculations (not every ones) are supposed to use separate threads.\nA simpler version could use a separate thread for every single column instead of single items.</p>\n\n<p>Working examples are really appreciated.\nThank you and sorry for my bad english.</p>\n"},{"tags":["java","multithreading","process","zip"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12653982,"title":"Java process - unable to unzip zip file","body":"<p>I am trying to unzip some zip file, it has about 65 megs. Code snippets below:</p>\n\n<p>This method actually unzips a file:</p>\n\n<pre><code>public synchronized void execute(Path zipFile) {\n    final ProcessBuilder builder = new ProcessBuilder(\"/bin/unzip\",zipFile.toAbsolutePath().toString(), \"-d\", dir.toAbsolutePath().toString());\n    FutureTask&lt;Integer&gt; task = new FutureTask&lt;Integer&gt;(new Callable&lt;Integer&gt;() {\n        @Override public Integer call() {\n            try {\n                System.out.println(\"started and waiting\");\n                int status = builder.start().waitFor();\n                System.out.println(\"status: \" + status);\n                return status;\n            } catch (InterruptedException e) {\n            } catch (IOException e) {\n            }\n            return 0;\n        }\n    });\n\n    List&lt;FutureTask&lt;Integer&gt;&gt; tasks = new ArrayList&lt;FutureTask&lt;Integer&gt;&gt;();\n    tasks.add(task);\n    System.out.println(\"task added\");\n    ExecutorService executor = Executors.newCachedThreadPool();\n    for (FutureTask&lt;Integer&gt; t : tasks) {\n        executor.submit(t);\n        System.out.println(\"submitted\");\n    }\n    executor.shutdown();\n    System.out.println(\"shutdown\");\n}\n</code></pre>\n\n<p>That executor / future stuff is there just to be sure I do it properly. This method is called in the class Finder, which finds zip file in the directory and tries to unzip it. It is based on this code <a href=\"http://docs.oracle.com/javase/tutorial/essential/io/walk.html\" rel=\"nofollow\">http://docs.oracle.com/javase/tutorial/essential/io/walk.html</a></p>\n\n<p>So to be concrete:</p>\n\n<pre><code>@Override\npublic FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {\n    if (find(file)) {\n        synchronized(Finder.class) {\n            executor.execute(file);\n        }\n    }\n    return CONTINUE;\n}\n</code></pre>\n\n<p>Now the problem. It is really funny. Whenever I extract something by this code, the zip file actually gets unzipped but ONLY some directories are unzipped and others are not. For example I have a zip file with directories temp foo and bar but after unzipping, there are only e.g temp and foo directories and bar is not extracted.</p>\n\n<p>Output from this is:</p>\n\n<pre><code>task added\nsubmitted\nstarted and waiting\nshutdown\n</code></pre>\n\n<p>Why there is no \"status = something\" output?</p>\n\n<p>I can't understand why it is so. When I unzip it manually, it gets unzipped properly.</p>\n\n<p>// EDIT</p>\n\n<p>this did the trick</p>\n\n<pre><code>@Override\npublic synchronized void execute(String file, String dest) {\n    ProcessBuilder pb = new ProcessBuilder(\"/bin/unzip\",\"-qq\", file, \"-d\", dest);\n    pb.redirectErrorStream(true);\n\n    try {\n        Process p = pb.start();\n        InputStream is = p.getInputStream();\n        InputStreamReader r = new InputStreamReader(is);\n        BufferedReader in = new BufferedReader(r);\n        String line;\n        while ((line = in.readLine()) != null) {\n            // because of the -qq option, it does actually write out nothing\n            System.out.println(line);\n        }\n    } catch (IOException ex) {\n        System.err.println(ex.getMessage());\n    }\n}\n</code></pre>\n"},{"tags":["c","multithreading","debugging","signals"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12664669,"title":"Debugging signal handling in multithreaded application","body":"<p>I have this multithreaded application using pthreads. My threads actually wait for signals using sigwait. Actually, I want to debug my application, see which thread receives which signal at what time and then debug it. Is there any method, I can do this. If I directly run my program, then signals are generated rapidly and handled by my handler threads. I want to see  which handler wakes up from the sigwait call and processes the signal and all.</p>\n"},{"tags":["java","multithreading","jscrollpane"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12664605,"title":"Java ScrollPane OnChange Timeout","body":"<p>I have a JScrollPane which gets populated with images.</p>\n\n<p>I have added a Change Listener as follows:</p>\n\n<pre><code>scrollPane.getViewport().addChangeListener(new ChangeListener()\n{\n    public void stateChanged(ChangeEvent e)\n    {\n        System.out.println(\"Maximum: \" + scrollPane.getVerticalScrollBar().getModel().getMaximum() + \" Current: \" + (scrollPane.getVerticalScrollBar().getModel().getValue() + 800));\n        if ((scrollPane.getVerticalScrollBar().getModel().getValue() + 800) == scrollPane.getVerticalScrollBar().getModel().getMaximum())\n        {\n            getNextPage();\n        }\n    }\n});\n</code></pre>\n\n<p>I have 1 issue with my code:</p>\n\n<p>As soon as the ChangeListener fires, the ScrollPane isn't populated instantly, and it seems the getNextPage(); method gets executed several times. How can I set a timeout, to perhaps check every 3 seconds?</p>\n\n<p>If any more information is required please let me know.</p>\n\n<p>Thanks in advance everyone.</p>\n"},{"tags":["python","multithreading","download","pycurl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12664314,"title":"Split a file into parts to parallel download with pycurl","body":"<p>I want to download a file with pycurl in python. So I want to find a way to download it in multiple parts that increases the speed of downloading. I know in theory it is the same as downloading the file in one part but it seems it's faster to download it in several parts concurrently.</p>\n"},{"tags":["c#","multithreading"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":6272,"score":8,"question_id":2490219,"title":"How to pass more than one parameter to a C# thread?","body":"<p>How to pass more than one parameter to a C# thread? Any example will be appreciated.</p>\n"},{"tags":["java","multithreading","object"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":39,"score":-2,"question_id":12663532,"title":"Hook up of two threads","body":"<p>I hava got 2 Threads in java and I want hook up them. I used class PipedInputStream and PipedOutputStream, but I want sending objects, how I do it?\nThank you</p>\n"},{"tags":["c","multithreading","sockets","accept"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":173,"score":3,"question_id":12654350,"title":"Server seems to drop connections in accept","body":"<p>I'm having trouble with implementing a server that has a master thread invoking <code>accept()</code> and then passing on the new client socket to a slave thread (I have a fixed-size thread pool created previously).</p>\n\n<p>It is implemented in a way that I'm using a simple array of integers to represent a stack of client sockets, which gets filled up by successful <code>accept()</code> calls. There is one mutex per slave thread, and each slave is implicitly free if its current client file descriptor is set to <code>-1</code> (it is set as such in the thread code, at the end of satisfying a request).</p>\n\n<p>In a use-case, I have a shell script launching a given number of clients, for example, six concurrent clients (six processes). Checking TCP connection set up, none of the clients receive any errors on <code>connect()</code>.</p>\n\n<p>Now here is the problem. On this specific test scenario with <strong>six clients</strong>, the server is only printing <strong>five <code>accept()</code> success messages</strong> (<code>&gt; Server got connection from ...</code>) from an <strong>expected six</strong>. I'm not sure but it feels like one of the client connections to accept is simply being lost!</p>\n\n<p>Even stranger, I added a <code>continue</code> (<code>//MAGICAL TEST</code>) between receiving the accepted socket and dispatching it to a slave thread. With that <code>continue</code> in place, no slaves receive work BUT now all of the client connections are printed as expected. I'm not exactly sure, but is it possible that while the master thread dispatches work to slaves, one of the client connections in the accept queue gets dropped? </p>\n\n<p>EDIT: this is only happening when I have a number of slave threads lower than the number of simultaneous requests. Still, I do not understand why one of the extra connects seems to not be printed by the master thread in that case (e.g. 2 slaves versus 6 concurrent requests).</p>\n\n<p>Thread-local data defined in the following:</p>\n\n<pre><code>#define PENDING_CONNS 35\ntypedef struct _ThreadData {\n    pthread_t m_Thread;\n    pthread_mutex_t m_Mutex;\n    char* m_Task;\n    int m_ClientFD;\n    unsigned int m_Index;\n    unsigned short int m_Networking;\n    char* m_OutputDir;\n} ThreadData;\nstatic ThreadData *g_Workers = NULL;\nstatic unsigned int g_NumWorkers = 0;\nstatic pthread_barrier_t g_StartBarrier;\n</code></pre>\n\n<p>And then here's the master thread section:</p>\n\n<pre><code>/*\n * Executed by the coordinating thread. Awaits and passes new client connections to free working threads.\n */\nint RunServer(char* port) {\n    // Listen on sock_fd, new connection on new_fd.\n    int sockfd, new_fd;\n    struct addrinfo hints, *servinfo, *p;\n\n    // Connector's address information.\n    struct timeval timeout;\n    struct sockaddr_storage their_addr;\n    socklen_t sin_size;\n\n    //  struct sigaction sa; //TODO: possible signal handling later.\n    int yes = 1;\n    char s[INET6_ADDRSTRLEN];\n    int rv;\n\n    memset(&amp;hints, 0, sizeof hints);\n    hints.ai_family = AF_UNSPEC;\n    hints.ai_socktype = SOCK_STREAM;\n    hints.ai_flags = AI_PASSIVE; // use my IP\n\n    if ((rv = getaddrinfo(NULL, port, &amp;hints, &amp;servinfo)) != 0) {\n        fprintf(stderr, \"&gt; Server: getaddrinfo: %s\\n\", gai_strerror(rv));\n        return -1;\n    }\n\n    // Loop through all the results and bind to the first we can\n    for (p = servinfo; p != NULL; p = p-&gt;ai_next) {\n        if ((sockfd = socket(p-&gt;ai_family, p-&gt;ai_socktype, p-&gt;ai_protocol)) == -1) {\n            perror(\"&gt; Server: socket\");\n            continue;\n        }\n\n        if (setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;yes, sizeof(int)) == -1) {\n            perror(\"&gt; Server: setsockopt\");\n            return -1;\n        }\n\n        if (bind(sockfd, p-&gt;ai_addr, p-&gt;ai_addrlen) == -1) {\n            close(sockfd);\n            perror(\"&gt; Server: bind\");\n            continue;\n        }\n        break;\n    }\n\n    if (p == NULL) {\n        fprintf(stderr, \"&gt; Server: failed to bind\\n\");\n        return -1;\n    }\n\n    // All done with this structure.\n    freeaddrinfo(servinfo);\n    //PENDING_CONNS defined as 25\n    if (listen(sockfd, PENDING_CONNS) == -1) {\n        perror(\"&gt; Server: listen\");\n        return -1;\n    }\n\n    printf(\"&gt; Server: waiting for connections...\\n\");\n\n    fd_set_blocking(sockfd, 0); // NON BLOCKING\n    int requestStack[1000];\n    int stackTop = 0;\n\n    // Main loop of coordinating thread.\n    while (1) {\n        sin_size = sizeof their_addr;\n        new_fd = accept(sockfd, (struct sockaddr *) &amp;their_addr, &amp;sin_size);\n        if (new_fd == -1) {\n            //queue was probably empty...\n        }\n        else {\n            inet_ntop(their_addr.ss_family,\n                GetInAddress((struct sockaddr *) &amp;their_addr), s, sizeof s);\n            printf(\"&gt; Server: got connection from %s\\n\", s);\n\n            requestStack[stackTop++] = new_fd;\n            printf(\"&gt; Server: stack top is now %i with value %i.\\n\", stackTop, requestStack[stackTop-1]);\n        }\n\n        // MAGICAL TEST: continue;\n\n        // Linear search for a free worker thread...\n        unsigned int i;\n        int rc;\n        for (i = 0; i &lt; g_NumWorkers &amp;&amp; stackTop &gt; 0; i++) {\n            rc = pthread_mutex_trylock(&amp;(g_Workers[i].m_Mutex));\n            if (rc == EBUSY)  // If it was already locked, skip worker thread.\n                continue;\n            else if (!rc) { // If we managed to lock the thread's mutex...\n                if (g_Workers[i].m_ClientFD == -1) { // Check if it is currently out of work.\n                    g_Workers[i].m_ClientFD = requestStack[--stackTop];\n                    printf(\"&gt; Server: master thread assigned fd %i to thread %u\\n\", requestStack[stackTop], i);\n                }\n                rc = pthread_mutex_unlock(&amp;(g_Workers[i].m_Mutex));\n                if (rc) {\n                    printf(\"&gt; Server: main thread mutex unlock failed on thread %i with error %i!\\n\", i, rc);\n                    return -1;\n                }\n            }\n            else\n                printf(\"&gt; Server: main thread try-lock failed on thread %i with error %i!\\n\", i, rc);\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>My apologies for the verbosity of the code and for possibly having missed any basic information from the man pages.</p>\n\n<p>As requested, here is the slave thread function:</p>\n\n<pre><code>static void *WorkRoutine(void *args) {\n    ThreadData * const threadData = (ThreadData*) args;\n    pthread_mutex_t * const tMutex = &amp;(threadData-&gt;m_Mutex);\n    const unsigned int tIndex = threadData-&gt;m_Index;\n    int clientFD = threadData-&gt;m_ClientFD;\n\n    // Each thread initializes its own mutex.\n    int rc = pthread_mutex_init(tMutex, NULL);\n    if (!rc)\n        printf(\"&gt; Slave %u: mutex %p initialization was sucessful!\\n\", tIndex, tMutex);\n    if (rc &amp;&amp; rc != PTHREAD_BARRIER_SERIAL_THREAD) {\n        printf(\"&gt; Slave %u: failed mutex initialization!\\n\", tIndex);\n        perror(\"pthread_mutex_init\");\n        exit(-1); //TODO: implement graceful error exit.\n    }\n\n    // Synchronization point: all threads including the master thread wait for all slave mutexes to be initialized.\n    rc = pthread_barrier_wait(&amp;g_StartBarrier);\n    if (rc &amp;&amp; rc != PTHREAD_BARRIER_SERIAL_THREAD) {\n        printf(\"&gt; Slave %u: failed initial barrier synchronization!\\n\", tIndex);\n        perror(\"pthread_barrier_wait\");\n        exit(-1); //TODO: implement graceful error exit.\n    }\n\n    while (1) { //TODO replace 1 with state var that is turned off when the master thread receives a request to shutdown server.\n        rc = pthread_mutex_lock(tMutex);\n        if (rc) {\n            printf(\"&gt; Slave %u: mutex lock returned an error: %i!\\n\", tIndex, rc);\n            perror(\"pthread_mutex_lock()\");\n            continue;\n        }\n        clientFD = threadData-&gt;m_ClientFD;\n        if (!threadData-&gt;m_Task &amp;&amp; clientFD == -1) {\n            rc = pthread_mutex_unlock(tMutex);\n            int yieldStatus = sched_yield();\n            if (yieldStatus) {\n                printf(\"&gt; Slave %u: error while attempting to yield!\\n\", tIndex);\n                perror(\"sched_yield()\\n\");\n            }\n            continue;\n            //printf(\"&gt; Slave %u: yielding.\\n\", tIndex);\n        }\n        else if (!threadData-&gt;m_Task &amp;&amp; clientFD != -1) {\n            // Read client request.\n            threadData-&gt;m_Task = (char*) calloc(FILE_BUFFER, sizeof(char)); //TODO: stop allocating buffer on every task.\n            printf(\"&gt; Slave %u going to read from %i into %p\\n\", tIndex, clientFD, threadData-&gt;m_Task);\n\n            MessageHeader h;\n            GetHeader(&amp;h, clientFD);\n            if (h.m_ID != BeginSession) {\n                //protocol implementation error\n                exit(-1);\n            }\n            printf(\"&gt; Slave %u: expecting client command of length %i\\n\", tIndex, h.m_ContentSize);\n            int n = GetContent((void*) threadData-&gt;m_Task, h.m_ContentSize * sizeof(char), clientFD);\n            printf(\"&gt; Slave %u: client of file descriptor %i sent [%s] at a total of %i bytes\\n\", tIndex, clientFD, threadData-&gt;m_Task, n);\n            short int remoteOperation;\n\n            int baseArgvSize = 10;\n            char **argv = (char**) calloc(baseArgvSize, sizeof(char*)); //TODO: stop allocating table on every task.\n            int argc = CmdToTable(threadData-&gt;m_Task, &amp;argv, &amp;baseArgvSize);\n\n            int localLen = strlen(\"local\");\n            int remoteLen = strlen(\"remote\");\n\n            if(!strncmp(threadData-&gt;m_Task, \"remote\", remoteLen)) {\n                remoteOperation = 1;\n                g_Workers[tIndex].m_Networking = 1;\n\n            }\n            else if(!strncmp(threadData-&gt;m_Task, \"local\", localLen)) {\n                remoteOperation = 0;\n                g_Workers[tIndex].m_Networking = 0;\n                g_Workers[tIndex].m_OutputDir = (char*) calloc(FILE_BUFFER, sizeof(char));\n\n                MessageHeader hPath;\n                GetHeader(&amp;hPath, clientFD);\n                if (hPath.m_ID != SendMessage) {\n                    //protocol implementation error\n                    exit(-1);\n                }\n\n                int cnt = GetContent((void*) g_Workers[tIndex].m_OutputDir, hPath.m_ContentSize * sizeof(char), clientFD);\n                g_Workers[tIndex].m_OutputDir[hPath.m_ContentSize * sizeof(char)] = '/';\n                printf(\"&gt; Slave %u: received message with %i bytes.\\n\", tIndex, cnt);\n                printf(\"&gt; Slave %u: client output going to %s\\n\", tIndex, g_Workers[tIndex].m_OutputDir);\n            }\n            else {\n                printf(\"&gt; Slave %u: received bogus client command: %s\\n\", tIndex, threadData-&gt;m_Task);\n                return NULL;\n            }\n            printf(\"&gt; Slave %u: remote mode - %i.\\n\", tIndex, g_Workers[tIndex].m_Networking);\n            // Debug print the table built from the client command.\n            printf(\"&gt; Slave %u: table has %i entries.\\n\", tIndex, argc);\n            int i;\n            for (i = 0; i &lt; argc; i++) {\n                printf(\"&gt; Slave %u: argument %i is %s.\\n\", tIndex, i, argv[i]);\n            }\n            // Prepare the input files the client will send.\n            char**filenames = (char**) calloc(argc, sizeof(char*));\n            FILE**files = (FILE**) calloc(argc, sizeof(FILE*));\n            unsigned int reqIDIndex = 0;\n            unsigned int reqIDLen = strlen(argv[reqIDIndex]);\n\n            if(!remoteOperation)\n                continue;\n\n            // Check which files need to be sent from the client.\n            for (i = reqIDIndex + 1; i &lt; argc; i++) {\n                unsigned int argSize = strlen(argv[i]);\n                if (strstr(argv[i], FILETYPE_SEPARATOR) != NULL\n                        &amp;&amp; strstr(argv[i], INDEX_FILETYPE) == NULL) {\n                    // If the current argument has a file type and isn't an index type.\n                    filenames[i] = calloc(reqIDLen + argSize + 2, sizeof(char)); // +2 to account for terminator char and hyphen between reqID and filename\n\n                    printf(\"&gt; Slave %u: arg %s check with req %s\\n\", tIndex, argv[i], argv[reqIDIndex]);\n                    int noReqYet = strncmp(argv[i], argv[reqIDIndex], reqIDLen);\n                    if (noReqYet) {\n                        printf(\"&gt; Slave %u: no prepended request yet!\\n\", tIndex);\n                        strncpy(filenames[i], argv[reqIDIndex], reqIDLen);\n                        filenames[i][reqIDLen] = '-';\n                    }\n                    // If the argument is a path to a file, get the filename and discard the path (that was local to the client).\n                    char*nameStart = strrchr(argv[i], '/'); //TODO: make a define for 92: backslash ascii char number\n                    printf(\"&gt; Slave %u: going to remove backslash from %s\\n\", tIndex, argv[i]);\n\n                    if (nameStart != NULL )\n                        nameStart++;\n                    else\n                        nameStart = argv[i];\n\n                    printf(\"&gt; Slave %u: got %s after removing backslash\\n\", tIndex, nameStart);\n                    printf(\"noReqYet: %i\\n\", noReqYet);\n                    if (!noReqYet)\n                        strncpy(filenames[i], nameStart, strlen(nameStart));\n                    else\n                        strncpy(filenames[i] + reqIDLen + 1, nameStart,\n                                strlen(nameStart)); //+1 to account for the hyphen.\n                    // When freeing the argv table, only need to free(argv). There is no need to free argv[i] elements.\n                    argv[i] = filenames[i];\n                }\n                else if (strstr(argv[i], FILETYPE_SEPARATOR) != NULL &amp;&amp; strstr(argv[i], INDEX_FILETYPE) != NULL ) {\n                    // If the current argument is the index type.\n                    char*nameStart = strrchr(argv[i], '/');\n                    if (nameStart != NULL ) {\n                        nameStart++;\n                        argv[i] = nameStart;\n                    }\n                }\n            }\n\n            // Debug print the needed files.\n            printf(\"&gt; Slave %u: awaiting files:\", tIndex);\n            for (i = 0; i &lt; argc; i++) {\n                if (filenames[i] != NULL ) {\n                    printf(\" %s\", filenames[i]);\n                }\n            }\n            printf(\"\\n\");\n\n            // Await each input file from the client.\n            for (i = 0; i &lt; argc; i++) {\n                if (filenames[i] != NULL ) {\n                    files[i] = GetFile(clientFD, filenames[i]); // Note: GetFile invokes fclose!\n                    if (files[i])\n                        printf(\"&gt; Slave %u: locally stored file %s\\n\", tIndex, filenames[i]);\n                }\n            }\n        }\n        printf(\"&gt; Slave %u: going to invoke SatisfyRequest with arguments: \", tIndex);\n        for (i = reqIDIndex; i &lt; argc; i++) {\n            if (argv[i] != NULL )\n                printf(\"%s \", argv[i]);\n        }\n        printf(\"\\n\");\n\n        // Process the request against the index.\n        int res = SatisfyRequest(argc, argv, tIndex, clientFD);\n\n        char* dummy;\n        if (!res)\n            dummy = \"Your request succeeded.\";\n        else\n            dummy = \"Sorry, there was an error.\";\n\n        // Terminate session with the client.\n        SendMsg(EndSession, (void*)dummy, strlen(dummy), clientFD);\n        printf(\"&gt; Slave %u: task result delivered to client of file descriptor %i.\\n\", tIndex, clientFD);\n        close(clientFD);\n        free(threadData-&gt;m_Task);\n        free(argv);\n        if(!remoteOperation) {\n            free(g_Workers[tIndex].m_OutputDir);\n        }\n        // Free received file names and file pointer array.\n        for (i = 0; i &lt; argc; i++) {\n            if (filenames[i])\n                free(filenames[i]);\n        }\n        free(filenames);\n        free(files);\n\n        // Reset thread-local data.\n        threadData-&gt;m_Task = NULL;\n        threadData-&gt;m_ClientFD = -1;\n        clientFD = -1;\n\n        printf(\"&gt; Slave %u: task finished.\\n\", tIndex);\n        rc = pthread_mutex_unlock(tMutex);\n        if(!rc)\n            continue;\n    }\n    if (rc) {\n        printf(\"&gt; Slave %u: mutex unlock returned an error: %i!\\n\", tIndex, rc);\n        perror(\"pthread_mutex_unlock()\");\n    }\n    return NULL;\n}\n</code></pre>\n\n<p>This is the client-side part of the code:</p>\n\n<pre><code>char*cmdBuffer = (char*)calloc(FILE_BUFFER, sizeof(char));\nchar*cmdRealPath = (char*)calloc(FILE_BUFFER, sizeof(char));\nint auxNameTableSz = 25;\nchar**auxNameTable = (char**)calloc(auxNameTableSz, sizeof(char*));\n\nchar* ip = argv[2];\nchar* port = argv[3];\nchar* networkMode = argv[4];\n//  char* reqID = argv[5];\nconst int cmdStartIndex = 6;\nshort int remoteOperation;\n\nif(!strcmp(networkMode, \"remote\")) {\n    remoteOperation = 1;\n    auxNameTableSz = 0;\n}\nelse if(!strcmp(networkMode, \"local\")) {\n    // If the client is on the server's machine, need to convert argument files to absolute paths.\n    remoteOperation = 0;\n    int i = cmdStartIndex;\n    int j = 0;\n    while(i &lt; argc) {\n        if(strrchr(argv[i], '/') || strrchr(argv[i], '.')) {\n            argv[i] = realpath(argv[i], NULL);\n            auxNameTable[j++] = argv[i];\n        }\n        i++;\n    }\n    auxNameTableSz = j;\n}\nelse {\n    printf(\"&gt; Client: argument four must be either \\\"global\\\" or \\\"local\\\"!\");\n    free(cmdBuffer);\n    free(cmdRealPath);\n    FreePathsTable(&amp;auxNameTable, auxNameTableSz);\n    DeallocateGlobals();\n    return 0;\n}\n\n// Concatenate client arguments into a single string.\nMakeCommand(argc, argv, cmdBuffer);\nprintf(\"&gt; Client: [Command]: %s\\n\", cmdBuffer);\n\n// Establish a (TCP) connection with the server.\nif(PrepareConnection(ip, port)) {\n    // Failed to prepare connection.\n    free(cmdBuffer);\n    free(cmdRealPath);\n    FreePathsTable(&amp;auxNameTable, auxNameTableSz);\n  DeallocateGlobals();\n    return 0;\n}\nif(ConnectToServer()) {\n    // Failed to establish a stream socket connection.\n    free(cmdBuffer);\n    free(cmdRealPath);\n    FreePathsTable(&amp;auxNameTable, auxNameTableSz);\n    DeallocateGlobals();\n    return 0;\n}\n\n// Send the client command to the server.\nprintf(\"&gt; Client: sending command of %i bytes to server: [%s].\\n\", (int)strlen(cmdBuffer), cmdBuffer);\nint count=0;\nif((count=WriteToServer(BeginSession, cmdBuffer)) == -1) {\n    // Command send failed.\n    free(cmdBuffer);\n    free(cmdRealPath);\n    FreePathsTable(&amp;auxNameTable, auxNameTableSz);\n    DeallocateGlobals();\n    return 0;\n}\nprintf(\"&gt; Client sent command to the server at %i bytes.\\n\", count);\nif(remoteOperation) {\n        // Send the correct input files to the server.\n        SendInputFiles(argc, argv, cmdStartIndex);\n}\nelse {\n    // Send the real path of the client's working directory to the server.\n    char *localDir = realpath(\".\", NULL);\n    count=WriteToServer(SendMessage, localDir);\nprintf(\"&gt; Client sent the real path to the server at %i bytes.\\n\", count);\n    free(localDir);\n}\n\n// Await reply from the server.\nchar *buffer = (char*) calloc(FILE_BUFFER, sizeof(char));\ncount = ReceiveFromServer(buffer);\n\nchar *backPtr = buffer;\n\nif(remoteOperation) {\n    printf(\"&gt; Client: got output list [%s] totalling %i bytes.\\n\", buffer, count);\n    // Receive the files produced by the server if the client and server are not on the same machine.\n    ReceiveOutputFiles(buffer);\n\n    // Await session termination.\n        buffer = backPtr;\n        memset(buffer, 0, sizeof(char)*FILE_BUFFER);\n        count = ReceiveFromServer(buffer);\n\n}\nelse {\n\n}\n\nprintf(\"&gt; Client: server response: [%s]-[%s]\\n\", buffer, cmdBuffer);\n</code></pre>\n"},{"tags":["android","multithreading"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12662912,"title":"Update TextView during long Thread process","body":"<p>Just to be clear, this question is not about <em>how</em> to update a TextView from a Thread, that's working fine. The problem is that even if I make multiple calls to update the TextView throughout the Thread, the updates only appear after the Thread is done it's work. Here's an example:</p>\n\n<pre>public class NDThread extends Thread {\n\n    protected LogActionListener log_listener;\n    private Handler handler = new Handler();\n\n\n    public void run() {\n        logAction(\"starting\");\n        // Do many things..\n        logAction(\"halfway\");\n        // Many more things..\n        logAction(\"done\");\n    }\n\n    public interface LogActionListener {\n        public void onLogAction(String paramString);\n    }\n\n    public void logAction(final String str) {\n        if(log_listener != null) handler.post(new Runnable() {\n            @Override\n            public void run() {\n                log_listener.onLogAction(str);          \n            }       \n        });\n    }\n}\n</pre>\n\n<p>And in my main Activity, I implement <code>LogActionListener</code> to recieve the Strings and update the TextView:</p>\n\n<pre>NDThread thread = new NDThread();\nthread.setOnLogActionListener(this);\nthread.run();\n\n// Elsewhere..\n@Override\npublic void onLogAction(final String msg) {\n        handler.post(new Runnable() {\n\n            @Override\n            public void run() {\n                textView.append(msg);\n            }\n\n        });\n}\n</pre>\n\n<p>As you can see, I've used <code>Handler</code>s in both the Thread and the Activity because I wasn't really sure which was correct to use. However, the result is always a blank TextView for the entirety of the Thread, then at the end it will print the 3 lines. What am I doing wrong?</p>\n"},{"tags":["java","android","multithreading"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12662331,"title":"working with handles/ threads using local class variables","body":"<p>i am programing something in android, and i want to create a delay.\nwhen i add to my activity class thread, the app stack after implement data to variable,\nbut when i use handler(with postDelay) it works fine.\n1.why?</p>\n\n<p>the code (mapView and userPointOverlay are class private local variables):</p>\n\n<p>using thread:</p>\n\n<pre><code>                new Thread(new Runnable()       //2.5sec delay between switches\n                {\n\n                    @Override\n                    public void run()\n                    {\n                        try\n                        {\n                            Thread.sleep(5000);             \n                            mapView.getOverlays().remove(userPointOverlay); \n                        } catch (InterruptedException e)\n                        {\n                            e.printStackTrace();\n                        }                           \n                    }\n                }).start();\n</code></pre>\n\n<p>using handler:</p>\n\n<pre><code>                handler.postDelayed(new Runnable()\n                {\n\n                    @Override\n                    public void run()\n                    {\n                        mapView.getOverlays().remove(userPointOverlay);                     \n                    }\n                }, 5000);   \n</code></pre>\n\n<p>2.what is the main diffrence between thread and handler? i understood that the handler\nrun on the thread i call him from it (share with main thread cpu time), its currect?</p>\n\n<ol>\n<li>it look like i have access to class local variables from handler. but in thread, the eclipse let me write local class variables in thread but when it starts the address of this locals is not as the thread locals and i dont hava access to this class locals when thread run.</li>\n</ol>\n\n<p>thank you!!!</p>\n"},{"tags":["java","multithreading","semaphore"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":77,"score":0,"question_id":12662428,"title":"Semaphore won't work","body":"<p>I'm trying to create a small program that demonstrates the use of semaphores. I create 2 threads, that run two instances of Farmer: one with the string \"north\" as a parameter and one with \"south\". Instead of having 1 thread finish followed by the 2nd, they both seem to finish at the same time (as indictated by the output:</p>\n\n<p>Farmer going over the bridge, heading north<br>\nFarmer going over the bridge, heading south<br>\nFarmer has crossed the bridge and is now heading north<br>\nFarmer has crossed the bridge and is now heading south<br></p>\n\n<p>Can anyone tell me what I´m doing wrong here? </p>\n\n<pre><code>import java.util.concurrent.Semaphore;\npublic class Farmer implements Runnable\n{\n    private String heading;\n    private final Semaphore bridge = new Semaphore(1);\n    public Farmer(String heading)\n    {\n        this.heading = heading;\n    }\n\n    public void run() \n    {\n        if (heading == \"north\")\n        {\n            try \n            {\n                //Check if the bridge is empty\n                bridge.acquire();\n                System.out.println(\"Farmer going over the bridge, heading north\");\n                Thread.sleep(1000);\n                System.out.println(\"Farmer has crossed the bridge and is now heading north\");\n                bridge.release();\n            } \n            catch (InterruptedException e) \n            {\n                e.printStackTrace();\n            }\n            //Farmer crossed the bridge and \"releases\" it\n\n        }\n        else if (heading == \"south\")\n        {\n            try \n            {\n                //Check if the bridge is empty\n                bridge.acquire();\n                System.out.println(\"Farmer going over the bridge, heading south\");\n                Thread.sleep(1000);\n                //Farmer crossed the bridge and \"releases\" it\n                System.out.println(\"Farmer has crossed the bridge and is now heading south\");\n                bridge.release();\n            } \n            catch (InterruptedException e) \n            {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre>\n"},{"tags":["c#","multithreading","manualresetevent","waitone","countdownevent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12307205,"title":"Main thread not proceeding when child threads have finished","body":"<p>I am trying to use multithreading in my application. The method <code>test5</code> tries to fetch some content from Internet, while the <code>main</code> thread waits for all threads to finish before continuing with other work.</p>\n\n<p>But my <code>main</code> thread doesn't come back after calling <code>test5</code>, and my console lines <code>Done Inside!!</code> and <code>thread all got back!!</code> are never reached.</p>\n\n<p>How can I resolve this issue?</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n        string[] url =\n        {\n            \"http://...\", \"http://...\", \"http://...\", \"http://...\", \"http://...\"\n        };\n\n        test5(url); \n        Console.WriteLine(\"thread all got back!!\");\n\n        // Do some other work after all threads come back\n        Console.ReadLine();\n    }\n\n    private static void test5(string[] _url)\n    {\n        int numThreads = _url.Length;\n        ManualResetEvent resetEvent = new ManualResetEvent(false);\n        int toProcess = numThreads;\n\n        for (int i = 0; i &lt; numThreads - 1; i++)\n        {\n            new Thread( delegate() {\n                testWebWorking(_url[i]);\n                if (Interlocked.Decrement(ref toProcess) == 0)\n                    resetEvent.Set();\n            }).Start();\n        }\n        resetEvent.WaitOne();\n        Console.WriteLine(\"Done inside!!\");\n    }\n\n    private static void test6(string[] _url)\n    {\n        int numThreads = _url.Length;\n        var countdownEvent = new CountdownEvent(numThreads);\n\n        for (int i = 0; i &lt; numThreads - 1; i++)\n        {\n            new Thread(delegate() {\n                testWebWorking(_url[i]);\n                countdownEvent.Signal();\n            }).Start();\n        }\n        countdownEvent.Wait();\n        Console.WriteLine(\"Done inside!!\");\n    }\n\n    private static void testWebWorking(object url)\n    {\n        Console.WriteLine(\"start {0}\", Thread.CurrentThread.ManagedThreadId);\n        string uri = (string)url;\n        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uri);\n        request.KeepAlive = true;\n        request.Timeout = 5000;\n        request.ReadWriteTimeout = 5000;\n        request.Proxy = null;\n\n        try\n        {\n            using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())\n            {\n                //Console.WriteLine(response.ContentType + \"; uri = \" + uri);\n                Stream receiveStream = response.GetResponseStream();\n                Encoding encode = System.Text.Encoding.GetEncoding(\"utf-8\");\n                // Pipes the stream to a higher level stream reader with the required encoding format. \n                StreamReader readStream = new StreamReader(receiveStream, encode);\n                //Console.WriteLine(\"\\r\\nResponse stream received.\");\n                Char[] read = new Char[256];\n                // Reads 256 characters at a time.    \n                int count = readStream.Read(read, 0, 256);\n                //Console.WriteLine(\"HTML...\\r\\n\");\n                String str = \"\";\n                while (count &gt; 0)\n                {\n                    // Dumps the 256 characters on a string and displays the string to the console.\n                    str = new String(read, 0, count);\n                    //Console.Write(str);\n                    count = readStream.Read(read, 0, 256);\n                }\n                //Console.WriteLine(str);\n                // Releases the resources of the response.\n                response.Close();\n                // Releases the resources of the Stream.\n                readStream.Close();\n\n                Console.WriteLine(\"end {0}\", Thread.CurrentThread.ManagedThreadId);\n            }\n        }\n        catch (WebException ex)\n        {\n            //Console.WriteLine(ex.GetBaseException().ToString() );\n            //Console.WriteLine(url);\n            Console.WriteLine(\"time out !!\");\n        }\n        finally\n        {\n            request.Abort();\n            request = null;\n            GC.Collect();\n        }\n    }\n}\n</code></pre>\n"},{"tags":["java","multithreading"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12657428,"title":"main thread not getting interrupted","body":"<p>I have written a code which prints 1 if the number being tested is a happy number and 0 otherwise.</p>\n\n<pre><code>class Ishappy extends Thread {\n    private Integer num;\n    private Thread main;\n    private volatile boolean out = false;\n\n    Ishappy(int i, Thread main) {\n        this.main = main;\n        num = i;\n    }\n\n    void Exit() {\n        out = true;\n    }\n\n    @Override\n    public void run() {\n        while(!out &amp;&amp; num != 1) {\n            if(num == 1) {\n                main.interrupt();\n                break;\n            }\n\n            String s = num.toString();\n            int temp = 0;\n            for(int i = 0 ; i &lt; s.length(); i++) {\n                int x = Integer.parseInt(s.substring(i, i+1));\n                temp += x*x;\n            }\n            num = temp;\n        }\n    }\n}\n\npublic class Happy_numbers {\n    public static void main(String[] args) {\n        byte path[] = null;\n\n        String s = \"d:\\\\data.txt\";\n\n        try(FileInputStream fin = new FileInputStream(s)) {\n            InputStreamReader in = new InputStreamReader(fin);\n            BufferedReader br = new BufferedReader(in);\n            s = br.readLine();\n            int num;\n            while(s != null) {\n                num = Integer.parseInt(s);\n\n                Ishappy ishappy = new Ishappy(num,Thread.currentThread()); \n                ishappy.start();\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException ex) {\n                    System.out.println(1);\n                    continue;\n                }\n                if(ishappy.isAlive()) {\n                    ishappy.Exit();\n                    System.out.println(0);\n                } else\n                    System.out.println(11);\n\n                s = br.readLine();\n            }\n        } catch (FileNotFoundException ex) {\n            System.out.println(\"File not found.\");\n        }catch(IOException ex){\n        }\n    }\n}\n</code></pre>\n\n<p>but the above code always prints 11 for a happy number which means <code>main</code> is never getting interrupted. Whats wrong??</p>\n\n<p>The contents of data.txt are</p>\n\n<pre><code>1\n7\n22\n</code></pre>\n\n<p>Out of which 1 and 7 are happy numbers whereas 22 is not.</p>\n"},{"tags":["java","multithreading","concurrency"],"answer_count":7,"favorite_count":1,"up_vote_count":7,"down_vote_count":1,"view_count":194,"score":6,"question_id":11266484,"title":"When is it appropriate to multi-thread?","body":"<p>I think I \"get\" the basics of multi-threading with Java. If I'm not mistaken, you take some big job and figure out how you are going to chunk it up into multiple (concurrent) tasks. Then you implement those tasks as either <code>Runnable</code>s or <code>Callable</code>s and submit them all to an <code>ExecutorService</code>. (So, to begin with, if I am mistaken on this much, <strong>please start by correcting me!!!</strong>)</p>\n\n<p>Second, I have to imagine that the code you implement inside <code>run()</code> or <code>call()</code> has to be as \"parallelized\" as possible, using non-blocking algorithms, etc. And that this is where the hard part is (writing parallel code). <strong>Correct? Not correct?</strong></p>\n\n<p>But the real problem I'm still having with Java concurrency (and I guess concurrency in general), and which is the true subject of this question, is:</p>\n\n<blockquote>\n  <p>When is it even appropriate to multi-thread in the first place?</p>\n</blockquote>\n\n<p>I saw an example from another question on Stack Overflow where the poster proposed creating multiple threads for reading and processing a huge text file (the book <em>Moby Dick</em>), and one answerer commented that multi-threading for the purpose of reading from disk was a <em>terrible</em> idea. Their reasoning for this was because you'd have multiple threads introducing the overhead of context-switching, <em>on top</em> of an already slow process (disk access).</p>\n\n<p>So that got me thinking: <strong>what classes of problems are appropriate for multi-threading, what classes of problems should always be serialized?</strong> Thanks in advance!</p>\n"},{"tags":["android","multithreading","android-sqlite"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12637656,"title":"Android \"application-global\" thread","body":"<p>I have an application, which consists of 3 activities. In the first activity I start thread in onCreate() and stop it in onDestroy(), so I hope this thread will work while application running. In this thread I read data from database and send it to the server.</p>\n\n<p>Main question: Is there right way to do this work, or first activity can be destroyed while application works? How to do that in the right way?</p>\n\n<p>Side question: Due to multi-write to the database problem, is there a way to create class, which will manage SQLite writing and which will be accessible from every activity?</p>\n\n<p>I think about using Application class, but have some doubts about that.</p>\n"},{"tags":["java","multithreading","blackberry","java-me"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2208,"score":4,"question_id":1643331,"title":"How can I schedule a particular thread in Blackberry","body":"<p>I want to auto-schedule a thread with a particular time interval. I also need to execute this in the background continously without hangs to the device.</p>\n\n<p>I have tried this with Application Manager Class but it's for application scheduling and I need to schedule thread within the application.</p>\n"},{"tags":["c++","multithreading","qt","debugging","opencv"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":11593461,"title":"Multithreading Crash using QT and QOGL","body":"<p>I have an QOGLWidget widget which is constructed in a another window, which is activated by button from the QMainwindow. \nI'm trying to send a surface of an image from the widget to the main window's QOGLWidget, the problem that it crashes and gives a first chance exception access violation.</p>\n"},{"tags":["c++","multithreading","qt"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":11594027,"title":"Best way in Qt to send OpenGL images between two widgets","body":"<p>I want to use a GLWidget which is inside a simulator window, and would like to send the data using framebuffer object to the mainwindow's glwidget. </p>\n\n<p>I have used signal/slot to achieve that but I had many problems with multi-threading problem and exceptions.</p>\n\n<p>What is the best way to achieve that scenario. ![attached a picture of the scenario I want to do][1]</p>\n"},{"tags":["c#","multithreading","exception","xna","spritebatch"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12653637,"title":"C# XNA Multi-threading SpriteBatch.End() \"Object reference not set to an instance of an object\"","body":"<p>I'm new to multi-threading so all the other issues aside for a moment. I'm having trouble working out how to resolve my sprite batch being ended by the faster thread and the next thread causing \"Object reference not set to an instance of an object\".</p>\n\n<p>Oh and if you can see anything else wrong with my code feel free to make me feel like an idiot ^^</p>\n\n<pre><code>spriteBatch.Begin();\n\n// Draw Particles\nList&lt;Thread&gt; threads = new List&lt;Thread&gt;();\nfor (int i = 0; i &lt; CPUCores; i++)\n{\n    int tempi = i; // This fixes the issue with i being shared\n    Thread thread = new Thread(() =&gt; DrawParticles(tempi + 1, CPUCores));\n    threads.Add(thread);\n    thread.Start();\n}\nforeach (var thread in threads)\n{\n    thread.Join();\n}\n\n// ..More Drawing Code..\n\nspriteBatch.End(); // &lt;-- This is where the program crashes\n</code></pre>\n\n<p>PS Who decided it was a good idea to use 4 spaces to signify code instead of [code] [/code]? ¬_¬</p>\n"},{"tags":["java","multithreading","synchronization","mutex"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12660821,"title":"Nested Lock with the same name","body":"<p>if I have two locks nested\nsay (I am concerning java here）</p>\n\n<pre><code>synchronized (clientInfMutex) {\n...\n    synchronized (clientInfMutex) {\n        //Will this part executable?\n\n\n  }\n\n\n}\n</code></pre>\n\n<p>Will the inner part executable? the concern is that when the outer lock is getting the lock, the inner lock might not be able to lock the lock again. If the inner part is not executable, is there a mechanism, such that if I hold the lock in the outer lock already, I will be able to access the inner lock without a problem? Thanks.</p>\n"},{"tags":["java","multithreading","runnable","blockingqueue"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":12660754,"title":"Java peer-to-peer thread model, everyone wait for Job","body":"<p>This is a schoolwork.\nI am trying to create peer-to-peer Thread model:</p>\n\n<p><a href=\"http://www.informit.com/articles/article.aspx?p=169479&amp;seqNum=5\" rel=\"nofollow\">http://www.informit.com/articles/article.aspx?p=169479&amp;seqNum=5</a></p>\n\n<blockquote>\n  <p>Where the delegation model has a boss thread that delegates tasks to worker threads, <strong>in the peer-to-peer model all the threads have an equal working status</strong>. Although there is a single thread that initially creates all the threads needed to perform all the tasks, that thread is considered a worker thread and does no delegation. In this model, there is no centralized thread.</p>\n</blockquote>\n\n<p>So my main thread willl create 5 threads, that start listening to my queue and also create jobs with main thread for 10 seconds. And since all threads must perform tasks, this thread must also wait for jobs. How can I do this?</p>\n\n<pre><code>BlockingQueue&lt;Job&gt; queue = new ArrayBlockingQueue&lt;Job&gt;(1000);\n\n    Collection&lt;Thread&gt; workers = new ArrayList&lt;Thread&gt;();\n    for(int i = 0; i &lt; 5; i++) {\n        Thread thread = new Thread(new Worker(queue));\n        workers.add(thread);\n        thread.start();\n    }\n\n    long endTime = System.currentTimeMillis() + 10000;\n    Random r = new Random();\n    while(System.currentTimeMillis() &lt; endTime) {\n        try {\n            CalculateJob job = new CalculateJob(r.nextInt(50), r.nextInt(50), r.nextInt(50));\n            queue.put(job);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }   \n</code></pre>\n\n<p>So my main thread will be working with creating threads, and workers are just sitting with <code>queue.take()</code>. </p>\n\n<p><strong>Do I understand correctly that in peer-to-peer model, every thread must <code>queue.take()</code> or  wait for jobs. If so, how can I do this? Any suggestions?</strong></p>\n"},{"tags":["c","multithreading","pthreads","mutex","condition-variable"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12659093,"title":"Boss Worker Pthreads Web Server in C - Server crashes if more requests sent than number of threads","body":"<p>I'm writing a web server in C (which I suck with) using Pthreads (which I suck with even more) and I'm stuck at this point. The model for the server is boss-worker so the boss thread instantiates all worker threads at the beginning of the program. There is a global queue that stores the socket of the incoming connection(s). The boss thread is the one that adds all items (sockets) to the queue as the connections are accepted. All of the worker threads then wait for an item to be added to a global queue in order for them to take up the processing. </p>\n\n<p>The server works fine as long as I connect to it less times than the number of worker threads that the server has. Because of that, I think that either something is wrong with my mutexes (maybe the signals are getting lost?) or the threads are being disabled after they run once (which would explain why if there are 8 threads, it can only parse the first 8 http requests).</p>\n\n<p>Here is my global queue variable.</p>\n\n<pre><code>int queue[QUEUE_SIZE];\n</code></pre>\n\n<p>This is the main thread. It creates a queue struct (defined elsewhere) with methods enqueue, dequeue, empty, etc. When the server accepts a connection, it enqueues the socket that the incoming connection is on. The worker threads which were dispatched at the beginning are constantly checking this queue to see if any jobs have been added, and if there are jobs, then they dequeue the socket, connect to that port, and read/parse/write the incoming http request.</p>\n\n<pre><code>int main(int argc, char* argv[])\n{\nint hSocket, hServerSocket;  /* handle to socket */\nstruct hostent* pHostInfo;   /* holds info about a machine */\nstruct sockaddr_in Address; /* Internet socket address stuct */\nint nAddressSize = sizeof(struct sockaddr_in);\nint nHostPort;\nint numThreads;\nint i;\n\ninit(&amp;head,&amp;tail);\n\n//**********************************************\n//ALL OF THIS JUST SETS UP SERVER (ADDR STRUCT,PORT,HOST INFO, ETC)\nif(argc &lt; 3) {\n    printf(\"\\nserver-usage port-num num-thread\\n\");\n    return 0;\n}\nelse {\n    nHostPort=atoi(argv[1]);\n    numThreads=atoi(argv[2]);\n}\n\nprintf(\"\\nStarting server\");\n\nprintf(\"\\nMaking socket\");\n/* make a socket */\nhServerSocket=socket(AF_INET,SOCK_STREAM,0);\n\nif(hServerSocket == SOCKET_ERROR)\n{\n    printf(\"\\nCould not make a socket\\n\");\n    return 0;\n}\n\n/* fill address struct */\nAddress.sin_addr.s_addr = INADDR_ANY;\nAddress.sin_port = htons(nHostPort);\nAddress.sin_family = AF_INET;\n\nprintf(\"\\nBinding to port %d\\n\",nHostPort);\n\n/* bind to a port */\nif(bind(hServerSocket,(struct sockaddr*)&amp;Address,sizeof(Address)) == SOCKET_ERROR) {\n    printf(\"\\nCould not connect to host\\n\");\n    return 0;\n}\n/*  get port number */\ngetsockname(hServerSocket, (struct sockaddr *) &amp;Address,(socklen_t *)&amp;nAddressSize);\n\nprintf(\"Opened socket as fd (%d) on port (%d) for stream i/o\\n\",hServerSocket, ntohs(Address.sin_port));\n\nprintf(\"Server\\n\\\n      sin_family        = %d\\n\\\n      sin_addr.s_addr   = %d\\n\\\n      sin_port          = %d\\n\"\n      , Address.sin_family\n      , Address.sin_addr.s_addr\n      , ntohs(Address.sin_port)\n    );\n//Up to this point is boring server set up stuff. I need help below this.\n//**********************************************\n\n//instantiate all threads\npthread_t tid[numThreads];\n\nfor(i = 0; i &lt; numThreads; i++) {\n    pthread_create(&amp;tid[i],NULL,worker,NULL);\n}\n\nprintf(\"\\nMaking a listen queue of %d elements\",QUEUE_SIZE);\n/* establish listen queue */\nif(listen(hServerSocket,QUEUE_SIZE) == SOCKET_ERROR) {\n    printf(\"\\nCould not listen\\n\");\n    return 0;\n}\n\nwhile(1) {\n\n    pthread_mutex_lock(&amp;mtx);\n    printf(\"\\nWaiting for a connection\");\n\n    while(!empty(head,tail)) {\n        pthread_cond_wait (&amp;cond2, &amp;mtx);\n    }\n\n    /* get the connected socket */\n    hSocket = accept(hServerSocket,(struct sockaddr*)&amp;Address,(socklen_t *)&amp;nAddressSize);\n\n    printf(\"\\nGot a connection\");\n\n    enqueue(queue,&amp;tail,hSocket);\n\n    pthread_mutex_unlock(&amp;mtx);\n    pthread_cond_signal(&amp;cond);     // wake worker thread\n}\n}\n</code></pre>\n\n<p>Here is the worker thread. This should be always running checking for new requests (by seeing if the queue is not empty). At the end of this method, it should be deferring back to the boss thread to wait for the next time it is needed.</p>\n\n<pre><code>void *worker(void *threadarg) {\n\npthread_mutex_lock(&amp;mtx);\n\nwhile(empty(head,tail)) {\n    pthread_cond_wait(&amp;cond, &amp;mtx);\n}\nint hSocket = dequeue(queue,&amp;head);\n\nunsigned nSendAmount, nRecvAmount;\nchar line[BUFFER_SIZE];\n\nnRecvAmount = read(hSocket,line,sizeof line);\nprintf(\"\\nReceived %s from client\\n\",line);\n\n\n//***********************************************\n//DO ALL HTTP PARSING (Removed for the sake of space; I can add it back if needed)\n//***********************************************\n\n\nnSendAmount = write(hSocket,allText,sizeof(allText));\n\nif(nSendAmount != -1) {\n    totalBytesSent = totalBytesSent + nSendAmount;\n}\nprintf(\"\\nSending result: \\\"%s\\\" back to client\\n\",allText);\n\nprintf(\"\\nClosing the socket\");\n/* close socket */\nif(close(hSocket) == SOCKET_ERROR) {\n    printf(\"\\nCould not close socket\\n\");\n    return 0;\n}\n\n\npthread_mutex_unlock(&amp;mtx);\npthread_cond_signal(&amp;cond2);\n}\n</code></pre>\n\n<p>Any help would be greatly appreciated. I can post more of the code if anyone needs it, just let me know. I'm not the best with OS stuff, especially in C, but I know the basics of mutexes, cond. variables, semaphores, etc. Like I said, I'll take all the help I can get. (Also, I'm not sure if I posted the code exactly right since this is my first question. Let me know if I should change the formatting at all to make it more readable.)</p>\n\n<p>Thanks!</p>\n"},{"tags":["objective-c","ios","xml","multithreading","nsthread"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12315555,"title":"Possible? NSThread request URL by singleton Objective-C iOS","body":"<p>Situation.\nXMLProxy Class is singleton. XMLRequest Class too.</p>\n\n<p>Normally, when I want to request URL.\nExample :</p>\n\n<pre><code>XMLProxy *xmlProxy = [XMLProxy sharedInstance];\n[xmlProxy tryGetDataWithParameter:example_parameter];\n\n// Method \"tryGetDataWithParameter\" will call method \"requestURL\" from XMLRequest Class\n\n// Assume that is [xmlRequest requestURL];\n\n// and XMLProxy Class (XMLProxy delegate) will create xml parser for each \"example_parameter\" \ntype to response xml data receive.\n</code></pre>\n\n<p>It's no problem.</p>\n\n<p>Question?\nI want to create visual background process to request URL and I create AutoSending Class that is singleton.</p>\n\n<blockquote>\n  <p>I want to use AutoSending Class to call method\n  \"tryGetDataWithParameter\"  (from XMLProxy class). Example to call :\n  [autoSending start];</p>\n  \n  <p>-(void)start{  XMLProxy *xmlProxy = [XMLProxy sharedInstance]; [xmlProxy tryetDataWithParameter:example_parameter]; }</p>\n</blockquote>\n\n<p>Can I use NSThread to call statement \"[autoSending start]\";\nIt is the result of a visual Background Process.</p>\n"},{"tags":["java","multithreading","netty"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12653414,"title":"Netty - relationship between NioWorker pool and worker thread pool","body":"<p>The context is Netty 3.5.x.</p>\n\n<p>What is the relationship between the number of <code>NioWorker</code>s and the number of the threads in the worker thread pool when an <code>NioServerSocketChannelFactory</code> or <code>NioClientSocketChannelFactory</code> is created? Does the design of Netty dictate that there should be at least as many threads available in the threadpool as the number of <code>NioWorkers</code>? What happens if you have a fewer number of threads in the thread-pool than the number of <code>NioWorker</code>s?</p>\n"},{"tags":["c++","multithreading","qt","queue","simultaneous"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12654967,"title":"How can I run two Threads at the same time? Qt C++","body":"<p>My task is to simulate a bottler process. </p>\n\n<p>There is a person who is in charged of putting \"bottles\" in a queue. For example his speed is 1 bottle per second. I did this with a thread. But the problem is that there must be a second thread, this will be a machine who will be in charged of taking these \"bottles\" and dequeue them and then put them into another queue. </p>\n\n<p>I did this by creating the queues and threads in the 'main' function. Then I started the thread, and as parameter I entered the queue which I just created. In this way the thread (in this case, the person) will put the \"bottles\" into the queue passed as parameter.</p>\n\n<p>Then when the program is run, is does work, but not as it should be. \nThe first thread (person) start putting elements into the queue, and when it finishes, then the second thread (machine) starts removing the elements of the queue.</p>\n\n<p>What I want my program to do is to do these two tasks at the same time, this means that as soon as the person (the first thread) starts putting elements into the queue, the machine (second thread) start removing them from the queue.</p>\n\n<p>Here is some of my code:</p>\n\n<pre><code>int main(int argc, char *argv[])\n{\nQCoreApplication a(argc, argv);\n\nQueue *queue1 = new Cola (\"\"); // First queue\nThread *Person = new Thread (); // Person who is in charged of putting bottles\nThread *Machine = new Thread (); // Machine in charged of removing elements of the queue\n\nPerson-&gt;queue(queue1);\nMachine-&gt;dequeue(queue1);\n\nsystem(\"Pause\");\nreturn 0;\n\nreturn a.exec();\n}\n</code></pre>\n\n<p>and here is some of the code of Thread</p>\n\n<pre><code>void Thread::queue(queue *c)\n{\n\nfor (int i = 0; i &lt; 10; i++)\n{\n    c -&gt; push (i);\n    cout &lt;&lt; \"Inserting to the queue the: \" &lt;&lt; i &lt;&lt; endl;\n    this -&gt; sleep (1);\n}\n}\n\nvoid Thread::dequeue(queue *c)\n{\n\nwhile (!c -&gt; empty())\n{\n    c -&gt; pop ();\n    this -&gt; sleep (2);\n}\n}\n</code></pre>\n\n<p>Any ideas of how can these two threads work at the same time?\nThanks for your help and ideas, I really appreciate them.</p>\n"}]}
