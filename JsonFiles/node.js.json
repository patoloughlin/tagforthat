{"count":14186,"tag":"node.js","questions":[{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13281617,"title":"node.js module for specific block of code","body":"<p>I have a specific block of code (the forEach loop) that I use all over the place in my code base, whenever I have an \"item\".</p>\n\n<p>How can I refactor this into a module or a global function that I can call whenever I need to.</p>\n\n<p>Here's the context:</p>\n\n<pre><code>Item.findById(itemid).populate('wants').exec(function(err, item){\n        item.wants.forEach(function(person){\n            person.avatar = gravatar.url(person.email, {size: 80, default: 'mm' });\n        });\n\n       //do some more stuff with item\n});\n</code></pre>\n\n<p>I want to re-use this forEach loop in other places where I have an \"item\" object. I'm thinking I pass in the item object and return it again.</p>\n\n<pre><code>    item.wants.forEach(function(person){\n        person.avatar = gravatar.url(person.email, {size: 80, default: 'mm' });\n    });\n</code></pre>\n\n<p>Something like:</p>\n\n<pre><code>var myLib = require('./lib/myLib');\n...\nitem = myLib.doStuff( item );\n</code></pre>\n"},{"tags":["node.js","mocha","phantomjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13281561,"title":"using mocha-phantomjs to automate functional testing","body":"<p>My project is using: Node, Coffeescript, SocketIO, Browserify and Mocha. (mocha for standard server-side unit tests)</p>\n\n<p>I would like to automate some client-side interface testing using a headless browser. PhantomJS looked like the ideal choice (picked over Zombie due to web socket support).</p>\n\n<p>The PhantomJS pages warn it is not a test runner, which I understand, and they recommend using the <a href=\"https://github.com/metaskills/mocha-phantomjs\" rel=\"nofollow\">mocha-phantomjs</a> project to drive your tests.</p>\n\n<p>So I've been able to get the sample tests running (e.g. <code>mocha-phantomjs tests/mixed.html</code>), but my current problem is actually using PHANTOM within the tests. All the sample tests in the mocha-phantomjs repo seem to use standard mocha server-side unit test.</p>\n\n<p>e.g. I can easily run <code>mocha-phantomjs tests/mixed.html</code> to view boring old unit tests. Or I can run <code>phantomjs tests/login.coffee</code> to load up my login screen... but how do I combine the two to make assertions on what I should expect to see on my login screen?</p>\n\n<p>I can't find any examples of this on the web, and I'm struggling with understanding the best way to go about this.</p>\n\n<p>Hope this all makes sense. Thanks in advance for any assistance.</p>\n\n<p><strong>UPDATE</strong>: I found the following suggestion by the author (<a href=\"https://github.com/metaskills/mocha-phantomjs/issues/18\" rel=\"nofollow\">here</a>), but I don't really understand exactly what to do with it: <code>phantomjs lib/mocha-phantomjs.coffee test/mixed.html</code></p>\n"},{"tags":["php","node.js","hosting","web-hosting","vps"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13280897,"title":"Node.js + PHP + MySQL VPS hosting","body":"<p>I have a website that I am building that is coded in PHP and I use MySQL for the database, I am also using node.js for most everything, so my website cannot exist without it for the most part. </p>\n\n<p>I have been with a small company (One that a friend of mine started up) and they have given me cheap VPS hosting, and they even setup everything on the server that I needed done (because I have no clue how to set up a server myself) I currently pay $15 per month for hosting, and would not want to pay anymore than that at this time. (As my website is still in development, so it's just for my own personal usage and sharing among some friends for testing and such). </p>\n\n<p>I need a relatively cheap hosting provider that gives me basically 100% control of the server (as I have many needs that usually are not part of packages), and I would also like to be able to have them (or someone) set up the server for me.</p>\n"},{"tags":["node.js","npm"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13281454,"title":"How to use a specific version of NPM?","body":"<p>How can I switch which version of npm I'm using?</p>\n\n<p>Currently:</p>\n\n<pre><code>$ npm -v\n1.1.65\n</code></pre>\n\n<p>But I need: 1.0.x</p>\n\n<p>I tried but got an error:</p>\n\n<pre><code>$npm version 1.0\nnpm ERR! version No package.json found\n</code></pre>\n\n<p>Anyone know how to use a different version of NPM? Thanks</p>\n"},{"tags":["javascript","json","node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13281142,"title":"How to change JSON form?","body":"<p>I have following json</p>\n\n<p><code>{\"result\": { \"a\": 1, \"b\": 2 \"c\": [ { \"d\": 3, \"e\": 4 }, { \"d\": 3, \"e\": 4 } ] }}</code></p>\n\n<p>I want to change it become like this:</p>\n\n<p><code>{\"result\": [{ \"a\": 1, \"b\": 2, \"d\": 3, \"e\": 4 }, { \"a\": 1, \"b\": 2, \"d\": 3, \"e\": 4 }]}</code></p>\n\n<p>is there a way change JSON like this?</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13281317,"title":"Asset paths in express","body":"<p>I used the following to declare my asset paths in my node app:</p>\n\n<pre><code>app.use(\"/styles\", express.static(__dirname + '/public/styles'));\napp.use(\"/images\", express.static(__dirname + '/public/images'));\napp.use(\"/script\", express.static(__dirname + '/public/script'));\n</code></pre>\n\n<p>...but it seems to be adding the url path (e.g. '/search') in the asset path which then passes it through the logic. All paths are relative for portability - how do I avoid this?</p>\n\n<p>Thanks in advance... :)</p>\n\n<p>James</p>\n"},{"tags":["javascript","node.js","asynchronous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13279647,"title":"node.js take items from functions until reached count","body":"<p>is there a better way to do this, i have 2 examples of implementations below.</p>\n\n<p>these function could return any number of elements back, just an example here</p>\n\n<pre><code>var location1 = function(id, callback) {\n  callback(null, ['l1.saved1','l1.saved2']);\n}\n\nvar location2 = function(id, callback) {\n  callback(null, ['l2.saved1', 'l2.saved2']);\n}\n\nvar location3 = function(id, callback) {\n  callback(null, ['l3.saved1']);\n}\n</code></pre>\n\n<p>one way, that is using process.nextTick()</p>\n\n<pre><code>function take() {\n  var strategies = Array.prototype.slice.call(arguments);\n  var id = strategies.shift();\n  var count = strategies.shift();\n  var callback = strategies.pop();\n\n  var searches = [];\n\n  function next() {\n    if (!strategies.length) {\n      return callback(null, searches);\n    }\n    //Get the first strategy in the list\n    var strategy = strategies.shift();\n\n    strategy(id, function (err, output) {\n      if (output.length) {\n        searches = searches.concat(output);\n\n        if (searches.length &gt;= count) {\n          return callback(err, searches.slice(0, count));\n        }\n      }\n\n      //Otherwise, try another strategy\n      process.nextTick(next);\n    })\n  }\n\n  // Start the engine an pass nothing to the first step.\n  next();\n}\n</code></pre>\n\n<p>another way, that uses async library</p>\n\n<pre><code>var async = require('async');\nvar otherTake = function() {\n  var searches = [];\n\n  var strategies = Array.prototype.slice.call(arguments);\n  var id = strategies.shift();\n  var count = strategies.shift();\n  var callback = strategies.pop();\n\n  async.until(\n    function() { return !strategies.length || searches.length &gt;= count; },\n    function(callback) {\n      var strategy = strategies.shift();\n      strategy(id, function(err, results) {\n        searches = searches.concat(results).slice(0, count);\n        return callback(null);\n      });\n    },\n    function(err) {\n      console.log(err);\n    }\n  );\n\n  callback(null, searches);\n}\n\notherTake('id', 3, location1, location2, location3, function(err, result) {\n  console.log(result);\n});\n</code></pre>\n\n<p>Other ways, pros/cons?</p>\n\n<p>thanks</p>\n"},{"tags":["java","node.js","tcp"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":17,"score":2,"question_id":13279754,"title":"NodeJS TCP Server, onData small chunks","body":"<p>I made a simple NodeJS TCP server which a Java Client sends an image:</p>\n\n<pre><code>encodedImage = &lt;a base64 encoded image&gt;\nout.write(\"IMG;\" + encodedImage);\nout.flush();\n</code></pre>\n\n<p>My NodeJS server is as follows:</p>\n\n<pre><code>net.createServer(function(TCPSocket){\n        TCPSocket.on(\"data\", function(data){\n            console.log(\"TCP Recieved: \" + data.length);    \n        });\n}).listen(5000);\n</code></pre>\n\n<p>However, even if I send all data and flush it immediately, the output is as follows:</p>\n\n<pre><code>TCP Recieved: 13\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1472\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1344\nTCP Recieved: 1344\n</code></pre>\n\n<p>I want it to recieve it in a simple chunk, but I assume it is happenng due to NodeJS's event handling mechanism, what is the best way to achieve single chunk of data for data sent as a single chunk? As far as I know, a TCP window can be much larger than 1344 bytes of data. I thought of using header values as  HTTP so I know the length ad construct the object I want.</p>\n"},{"tags":["node.js","coffeescript","express","oauth2"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13280024,"title":"Passport.js authenticate not executed","body":"<p>I try to use passport.js with my backbone app to authenticate with a Facebook app. I can get the route /auth/facebook to work through a href-tag on my client. </p>\n\n<p>But I want to do the authentication through ajax. I attempted to make an express.js route that calls the authenticate method. It appears that the authenticate is never invoked.</p>\n\n<pre><code>express = require('express')\nroutes = require('./routes')\nmongo = require('mongoskin')\ncrypto = require('crypto')\nfs = require('fs')\n\npassport = require('passport')\n\nFBStrategy = require('passport-facebook').Strategy\nLocalStrategy = require('passport-local').Strategy\n\npassport.serializeUser (user,done)-&gt;\n    done(null, user)\n\npassport.deserializeUser (obj, done)-&gt;\n    done null, obj\n\nfb = new FBStrategy\n    clientID: ''\n    clientSecret: ''\n    callbackURL: 'http://localhost:8811/auth/facebook/callback'\n    (accessToken, refreshToken, profile, done) -&gt;\n        console.log 'accesstoken', accessToken\n        console.log 'profile', profile\n        user = {}\n        done(null, user)\n\n\npassport.use fb\n\nlogErrors = (err, req, res, next)-&gt;\n    console.error(err.stack)\n    next(err)\n\nclientErrorHandler = (err, req, res, next)-&gt;\n    if req.xhr\n        res.send 500, error: 'something blew up'\n    else\n        next(err)\n\nerrorHandler = (err, req, res, next)-&gt;\n    res.status 500\n    res.render 'error', {error: err}\n\napp.configure ()-&gt;\n  app.set 'views', __dirname + '/views'\n  app.set 'view engine', 'jade'\n  app.set 'name','tapuna'\n  app.use express.bodyParser({uploadDir: './uploads'})\n  app.use express.methodOverride()\n  app.use express.cookieParser()\n  app.use express.session({secret: 'tapcat'})\n  app.use passport.initialize()\n  app.use passport.session()\n  app.use express.favicon()\n  app.use logErrors\n  app.use clientErrorHandler\n  app.use errorHandler\n  app.use express.static(__dirname + '/public.optimized')\n  app.use app.router\n\n\napp.configure 'development', () -&gt;\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }))\n\napp.configure 'production', () -&gt;\n  app.use(express.errorHandler())\n\n\n# this route works fine\napp.get '/auth/facebook', passport.authenticate('facebook', {scope:['email']})\n# this one also\napp.get '/auth/facebook/callback', passport.authenticate('facebook', {successRedirect:'/', faiureRedirect: '/login'})\n\n# the 'ajax route'\napp.post('/fb_login',\n    (req,res,next)-&gt;\n        console.log 'fb_login called' # i see this one\n        passport.authenticate('facebook',{scope:['email']}, (err,user,info)-&gt;\n            console.log 'fb'  # but i never see this one\n        )(req, res, next)\n    ,\n    (err, req,res,next)-&gt;\n        console.log 'err', err\n        res.send status: 'err', message: err\n)\n</code></pre>\n\n<p>Help is greatly appreciated. </p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13263873,"title":"mongoose keep having Error: unauthorized for a simple collection.find()","body":"<p>Trying for about 3 hours to translate a db.collection('collection-name').find() to mongoose but never seem to be able to auth the find().</p>\n\n<p>Stack Trace: </p>\n\n<pre><code>Error: unauthorized db:parks ns:parks.parkpoints lock type:0 client:127.2.132.1\nat Promise.error (/var/lib/user/app-root/runtime/repo/node_modules/mongoose/lib/promise.js:88:38)\nat cb (/var/lib/user/app-root/runtime/repo/node_modules/mongoose/lib/query.js:1454:29)\nat /var/lib/user/app-root/runtime/repo/node_modules/mongoose/lib/utils.js:408:16\nat /var/lib/user/app-root/runtime/repo/node_modules/mongodb/lib/mongodb/cursor.js:146:30\nat /var/lib/user/app-root/runtime/repo/node_modules/mongodb/lib/mongodb/cursor.js:188:32\nat /var/lib/user/app-root/runtime/repo/node_modules/mongodb/lib/mongodb/cursor.js:504:39\nat Cursor.close (/var/lib/user/app-root/runtime/repo/node_modules/mongodb/lib/mongodb/cursor.js:776:5)\nat [object Object].&lt;anonymous&gt; (/var/lib/user/app-root/runtime/repo/node_modules/mongodb/lib/mongodb/cursor.js:504:21)\nat [object Object].g (events.js:156:14)\nat [object Object].emit (events.js:88:20)\nnpm info Sample-App@1.0.0 Failed to exec start script\n</code></pre>\n\n<p>Connection.once('open') event is hit, so connection shouldn't be the problem, but I keep hitting the err at console.log(\"find() error\");</p>\n\n<p>Anyone has any clue on what's going on?</p>\n\n<ul>\n<li>Database name: parks</li>\n<li>Collection name: parkpoints</li>\n<li>Mongoose version: 3.3.1</li>\n<li>Mongodb version: 2.2.0</li>\n</ul>\n\n<p>I double-checked the values for user, pass, host, and port, those shouldn't be the source of problem. </p>\n\n<pre><code>self.connectDb = function(callback){\nmongoose.connection.on('error', function(err){\n  console.log(\"connection error\");\n  throw err;});\nmongoose.connection.once('open', function(){\n  callback();\n  self.Parkpoint=mongoose.connection.model('Parkpoint', \n           new Schema({ Name: String, pos: [Number]})); \n\n  self.Parkpoint.find().exec(function(err, names) {\n    if(err){\n      console.log(\"find() error\");\n      throw err};\n     console.log(\"names: \"+names);\n    res.header(\"Content-Type:\",\"application/json\");\n    res.end(JSON.stringify(names));\n});\n\n\n});\n\nvar dbUri = 'mongodb://'+self.dbUser+':'+self.dbPass+'@'+self.dbHost+':'+self.dbPort+'/parks';\nconsole.log(dbUri);\nmongoose.connect(self.dbHost, \"parks\", self.dbPort, {user:self.dbUser, pass:self.dbPass});\n};\n</code></pre>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13279676,"title":"Socket.io re-authorization","body":"<p>I am trying to transmit a cookie back to the server, long after an authorization has occurred. The reason being I want to check if a user is still logged in after a socket has been open for a while. Is there a way to do this with socket.io? Maybe by forcing an authorization again; is this possible?</p>\n"},{"tags":["javascript","node.js","backbone.js","backbone.marionette","parse.com"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":26,"score":3,"question_id":13277258,"title":"Object Security in Parse using the JavaScript API - Tying Users to the objects that are saved","body":"<p>In managing entities in Parse there are a lot of objects that I need to tie to the current logged in user. </p>\n\n<p>My concerns are:</p>\n\n<ol>\n<li>There is no backend code ensuring that the <code>User</code> being passed in is the current logged in user.</li>\n<li>Users could assign any newly created objects to other users.</li>\n</ol>\n\n<p>They have <a href=\"http://parseplatform.github.com/Todo/\" rel=\"nofollow\">this example TODO app</a> which in <a href=\"https://parse.com/tutorials/todo-app-with-javascript\" rel=\"nofollow\">the documentation</a> shows no Cloud Code in place to ensure that the <code>User</code> that the <code>Todo</code> is assigned to is the currently logged in user.</p>\n\n<p>Now that I look through <a href=\"http://parseplatform.github.com/Todo/js/todos.js\" rel=\"nofollow\">the code</a> I'm starting to think that whenever an object is saved it gets tied to the user. Can anyone explain why this application works and how it is associating the <code>Todo</code>s with the <code>User</code>?</p>\n\n<p><strong>UPDATE:</strong> Nevermind, I found the place in their code where they specify the user to save for the Todo. My question is, what's stopping a user from writing code that saves the todo with someone else's user id?</p>\n\n<pre><code>this.todos.create({\n        content: this.input.val(),\n        order:   this.todos.nextOrder(),\n        done:    false,\n        user:    Parse.User.current(),\n        ACL:     new Parse.ACL(Parse.User.current())\n      });\n</code></pre>\n\n<p><strong>UPDATE #2:</strong> If the <code>User</code> object has an <code>ACL</code> set to only allows users to be able to read <code>User</code> objects they own, then they wouldn't be able to query to get another user object to pass up. However, there are two other possible problems:</p>\n\n<ol>\n<li>Is it possible for them to pass the objectId of the user instead of the entire <code>User</code> object even if the <code>user</code> field on the <code>Todo</code>s table requires a <code>_User</code>?</li>\n<li>I believe they could also create a new user object and assign it to that... I'm trying to think of a scenario where this would be an issue, but I can't right now.</li>\n</ol>\n\n<p>If anyone can confirm or provide solutions to either of those that would be helpful. Going to try to test #1 right now.</p>\n\n<p><strong>UPDATE #3 -- After some testing:</strong> </p>\n\n<ol>\n<li>If the <code>user</code> field on the <code>Todo</code>s table requires a <code>_User</code> object, it will not take the objectId as a string.</li>\n<li><p>The they can however create a new user object and set the objectId there to get around this.</p>\n\n<pre><code>var user = new Parse.User();      // Create user object\nuser.id = \"cqmEuj1Bzf\";           // Assign user id\n\n// Create and save Todo\nvar td = new Todo();              \ntd.set(\"name\", \"Some ting todo\");\ntd.set(\"user\", user);\ntd.save();\n</code></pre></li>\n</ol>\n\n<p>This right here is exactly what I was worried about. <strong>I was able to successfully save a Todo to another user's account</strong>--as long as I know their user_id (<code>objectId</code>). With enough users they can likely guess at least one to randomly screw up someone's account.</p>\n\n<p>So what now?</p>\n\n<p><strong>Answer:</strong> Use Cloud Code to verify that the user passed in matches the current user. Answer was posted on <a href=\"https://parse.com/questions/object-security-in-parse-using-the-javascript-api-tying-users-to-the-objects-that-are-saved\" rel=\"nofollow\">Parse's forums here</a>.</p>\n"},{"tags":["node.js","express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13279563,"title":"express js session is serialized incorrectly","body":"<p>I use node.js and expressexpress.\nI add a dictionary to the req.session. It appears that the value inside the dictionary does not saved ()between cleints calls) </p>\n\n<p>I will really appreciate any solution.</p>\n\n<pre><code>'req.session.test = [];\n'req.session.test[\"obj1\"] = obj; // Does not save in the session! - disappears between client calls'\n'req.session.test.push(obj);     // saved in the session and can be found between client calls'\n</code></pre>\n\n<p>Thanks in advance,\nShai</p>\n"},{"tags":["javascript","image","node.js","canvas","base64"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13138297,"title":"A .tiff library for Javascript","body":"<p>Is there a library like <a href=\"http://www.nihilogic.dk/labs/canvas2image/canvas2image.js\" rel=\"nofollow\">canvas2image</a> (please look at createBMP function) for making .tiff in JavaScript (browser or nodejs)?</p>\n"},{"tags":["javascript","node.js","underscore.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13278515,"title":"Front-end: underscore.js or async.js via browserify?","body":"<p>So if you're a back-end node.js dev, you'll know about the awesome lib called <a href=\"https://github.com/caolan/async\" rel=\"nofollow\">async</a> .</p>\n\n<p>If you're a front-end dev, you'll know abwt the awesome lib called <a href=\"https://github.com/documentcloud/underscore\" rel=\"nofollow\">underscore</a>.</p>\n\n<hr>\n\n<p>Now the thing is, both of these libs tend to provide similar features to some extend.</p>\n\n<p>So the question is, does it make sense to user async on the front end using <a href=\"https://github.com/substack/node-browserify\" rel=\"nofollow\">browserify</a> ?</p>\n"},{"tags":["javascript","node.js","coffeescript"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":294,"score":1,"question_id":8998742,"title":"Merge coffeescript into your node project?","body":"<p>Is setting a bunch of watchers to compile to js still the best approach in development or is there something more elegant? </p>\n\n<p>I'm looking for techniques or packages that handle CoffeeScript in development and make it really nice instead of just watching and compiling to another js folder. Anything out there?</p>\n\n<p>Thanks for any ideas! </p>\n"},{"tags":["node.js","mongodb","express","nodejitsu","appfog"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":13275535,"title":"What kind of situations don't work well on Node and Mongo? How hard will it be to set up a server for it?","body":"<p>I have worked with PHP in the past, but I find it easier in Node to follow an MVC structure. (PHP MVC frameworks always required too much I couldn't quite grasp).</p>\n\n<p>The question : <strong>Is Node and Mongo really production suited for such an app? It's not going to require massive scale initially. And it doesn't require real-time.</strong></p>\n\n<p>Also while I develop and test, I plan to use a PAAS such as AppFog or Nodejitsu, along with MongoHQ/MongoLab.</p>\n\n<p>But that will probably be too expensive to continue long into production. <strong>How hard will it be to set up a VPS server for it, considering I have no experience with Server management, and no idea on how to deploy a node app on one.</strong> The blog say that I should use it with Nginx proxy. Is it manageable?</p>\n\n<p>I've been hearing about <strong>Nodestack and smartOS</strong>, can I use that?\nLong question, but any help would be greatly appreciated.</p>\n"},{"tags":["node.js","mongodb","expressjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13278176,"title":"Connection to mongo fails in production","body":"<p>I'm sorta new to node and express, but I'm really liking it.\nI'm working on a website with a mongodb database. It works great, except, when I change the node_env to production, suddenly, it stops writing to mongo, without giving very helpful errors.</p>\n\n<p>Any idea what goes wrong? It works perfect in development mode.</p>\n\n<p>I should add that the database is hosted on MongoHQ, if that makes a difference.</p>\n"},{"tags":["node.js","tomcat","spring-security","single-sign-on","passport"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13276075,"title":"Single Sign On with Tomcat and NodeJS","body":"<p>I have two different applications running on the same server, one is Java-based running in Tomcat with spring-social and spring-security, and the other is a NodeJS application using PassportJS as security framework.</p>\n\n<p>Both apps are configured to access using Google OAuth2 with the same clientId/secret, so I can login with my google account in each of them. But if I change from one of them to another, I need to login again, because the session doesn't exist on the other app.</p>\n\n<p>I'm looking at the session cookies, the Java app creates the JSESSIONID cookie whereas the Node app creates a \"connect.sid\" cookie. Maybe I could create a session in each app everytime a user do a login? Or I have to deal with OAuth tokens?</p>\n\n<p>Please, could you point me in the right direction? Should I use another library/framework?\nThank you in advance.</p>\n"},{"tags":["node.js","jsp","express","tiles","template-engine"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13272335,"title":"Is there any template engine for node.js express quitely like JSP?","body":"<p>I need a real jsp-mode template engine, not like jade and ejs:</p>\n\n<ol>\n<li>just put a new page file in the webpage folder, type it's uri in browser, it will come to show</li>\n<li>delete this page file, and it will gone</li>\n<li>and support <code>&lt;%include %&gt;</code> like jsp (support query params)</li>\n</ol>\n\n<p>if more fortune, it would support tile like apache tile. in apache tiles, i can write a template page like</p>\n\n<pre><code>main.jsp:\n&lt;%@ taglib uri=\"http://tiles.apache.org/tags-tiles\" prefix=\"tiles\" %&gt;\n&lt;tiles:insertTemplate template=\"/layout/simple.jsp\"&gt;\n  &lt;tiles:putAttribute name=\"header\"  value=\"/common/header.jsp\" /&gt;\n  &lt;tiles:putAttribute name=\"left\" value=\"/common/leftmenu.jsp\" /&gt;\n  &lt;tiles:putAttribute name=\"body\" value=\"&lt;%= request.getParameter(\"body\")%&gt;\" /&gt;\n  &lt;tiles:putAttribute name=\"footer\"   value=\"/common/footer.jsp\" /&gt;\n&lt;/tiles:insertTemplate&gt;\n</code></pre>\n\n<p>now type <code>main.jsp?body=content1.jsp</code>, you will saw content.jsp appear inside main.jsp, dress layout/simple.jsp.</p>\n\n<p>I can do all above runtime, need not restart webserver.</p>\n"},{"tags":["javascript","node.js","console"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13267014,"title":"Collapsable/expandable browser-style console for node.js?","body":"<p>When I log an object in a browser console, I can expand/collapse keys which have 'large' (to display) values, eg, a key whose value is another object.</p>\n\n<p>I'd like to be able to do the same for node. Eg, say I: </p>\n\n<pre><code>console.log(request) \n</code></pre>\n\n<p>...in an express app. Express 'request' items are large, and will easily scroll right off the screen. Being able to expand/collapse larger items would be super useful.</p>\n\n<p>Is there an collapsing/expanding console for node.js?</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2364,"score":2,"question_id":7069360,"title":"Express Static nodejs","body":"<p>There is a <code>style.css</code> in <code>public</code>, but I can't seem to make the express static option work.  I deleted <code>express</code> and have done <code>npm install express</code>, but still it isn't working.  I just get a 404 error.</p>\n\n<pre><code>var express = require('express')\n  , app = express.createServer();\n\napp.use(express.static(__dirname+'/public'));\n\napp.listen(8080, \"127.0.0.1\");\n</code></pre>\n\n<p>I have added an <code>app.get()</code> block to insure express is properly running, but I am still unable to request the static file.</p>\n"},{"tags":["javascript","node.js","websocket","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13222232,"title":"(Solved) Node.js + socket.io: app on server not working correctly","body":"<p>I'm new to node.js and socket.io and tried to connect the server to the client with the example from <a href=\"http://socket.io/#how-to-use\" rel=\"nofollow\">http://socket.io/#how-to-use</a>. (no localhost)</p>\n\n<p>Server:</p>\n\n<pre><code>    var app = require('http').createServer(handler)\n  , io = require('socket.io').listen(app)\n  , fs = require('fs')\n\napp.listen(80);\n\nfunction handler (req, res) {\n  fs.readFile(__dirname + '/index.html',\n  function (err, data) {\n    if (err) {\n      res.writeHead(500);\n      return res.end('Error loading index.html'+err);\n    }\n\n    res.writeHead(200);\n    res.end(data);\n  });\n}\n\nio.sockets.on('connection', function (socket) {\n    socket.on('message', function(msg){\n        console.log('Got text: '+msg);\n        socket.broadcast.send(msg);\n    });\n    socket.on('disconnect', function () { });\n});\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>&lt;html&gt;&lt;head&gt;&lt;script src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n  var socket = io.connect();\n  socket.on('connect', function () {\n    alert('connected.');\n\n    socket.on('message', function (msg) {\n      // my msg\n      alert('message received: '+msg);\n    });\n    socket.send('hi');\n\n  });\n\n\n&lt;/script&gt;\n&lt;/head&gt;&lt;body&gt;This is the content :)&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Google Chrome displays in the console:</p>\n\n<pre><code>Unexpected response code: 502\n</code></pre>\n\n<p>Also, after receiving every message, Chrome adds</p>\n\n<pre><code>GET http://[myServer]/socket.io/1/?t=1352313105809  socket.io.js:1659\nSocket.handshake socket.io.js:1659\nSocket.connect socket.io.js:1699\nmaybeReconnect\n</code></pre>\n\n<p>to the console.\nWheres the problem?</p>\n"},{"tags":["node.js","caching","cluster-computing","worker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13276104,"title":"nodejs cluster - keep client session on one worker","body":"<p>Is it possible to change strategy of assigning worker to request on nodejs cluster?\nI mean on first client access select worker and later keep client on this worker by session id.</p>\n\n<p>I'm using memory cache as a storage for large structure of objects. Every client (session) has own data in this storage. All stored objects are configured and referenced (with cycles). This was solution to complicated serialization to redis/memcached.</p>\n\n<p>Now on cluster, every request could be processed by different worker, so data for same session will be created, in worst case, under every worker.</p>\n\n<p>Is it about some setting of cluster, or is it possible to write method? which helps select worker for client session. When worker dies, it will select new one and session data will be recreated from permanent storage (mysql).</p>\n"},{"tags":["node.js","sockets","stream","zeromq"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13276680,"title":"ZeroMQ push/pull and nodejs read stream","body":"<p>I'm trying to read some file by opening read stream and send chunks of the file through ZMQ to another process to consume them. The stream is working like it should, however when I start the worker, it doesn't see the data that's been sent. </p>\n\n<p>I tried sending data through socket every 500ms, not in a callback, and when I start the worker it collects all previous chunks of data:</p>\n\n<pre><code>sender = zmq.socket('push')\nsetInterval(() -&gt;\n  console.log('sending work');\n  sender.send('some work')\n, 500)\n</code></pre>\n\n<hr>\n\n<pre><code>receiver = zmq.socket(\"pull\")\nreceiver.on \"message\", (msg) -&gt;\n  console.log('work is here: %s', msg.toString())\n</code></pre>\n\n<hr>\n\n<p>Outputs:</p>\n\n<pre><code>sending work\nsending work\nsending work\nsending work\nsending work\n// here I start the worker\nsending work\nwork is here: some work\nwork is here: some work\nwork is here: some work\nwork is here: some work\nwork is here: some work\nwork is here: some work\nsending work\nwork is here: some work\nsending work\nwork is here: some work\nsending work\nwork is here: some work\n</code></pre>\n\n<p>So, when the worker starts, it begins with pulling all the previous data and then it pulls it every time sth new comes in. This does not apply when I do this:</p>\n\n<pre><code>readStream = fs.createReadStream(\"./data/pg2701.txt\", {'bufferSize': 100 * 1024})\nreadStream.on \"data\", (data) -&gt;\n  console.log('sending work');\n  sender.send('some work'); // I'd send 'data' if it worked..\n</code></pre>\n\n<p>In this scenario, the worker doesn't pull any data at all. \nAre those kind of sockets supposed to create a queue or not? What am I missing here?</p>\n"},{"tags":["node.js","instanceof"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13273020,"title":"NodeJS: runInNewContext and instanceof","body":"<p>I have a script which does something like this:</p>\n\n<pre><code>var context = {}\nvm.runInNewContext(\"var someFunc = function() {}\", context);\nconsole.log(typeof context.someFunc); //function\nconsole.log(context.someFunc instanceof Function); //false\n</code></pre>\n\n<p>I do understand why the 4th line returns false: inside the new context there is a new <code>Function</code> object, which is not equal to the <code>Function</code> object in the outer context. Therefore, <code>context.someFunc</code> is not an instance of that outer <code>Function</code> object. </p>\n\n<p>However, the <code>context.someFunc</code> function is used by a third-party library which uses <code>instanceof Function</code>. Since <code>context.someFunc</code> is a function, but not an instance of the <code>Function</code> in that context, the third party won't treat it as a function while it should and therefore it crashes. I tried using the following context:</p>\n\n<pre><code>var context = {\n    \"Function\" : Function\n}\n</code></pre>\n\n<p>but that didn't resolve my problem either.</p>\n\n<p>Perhaps using <code>var someFunc = new Function(arg, body)</code> will work (haven't tested it), however I do not have full control of the code passed to <code>vm.runInNewContext</code> and therefore I can't use that solution either.</p>\n\n<p>How can I let <code>context.someFunc instanceof Function</code> return true outside of the context?</p>\n"},{"tags":["node.js","mustache"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13260111,"title":"Node: Mustache templates on both server and client","body":"<p>I would like to use mustache templates with node.js/express/hogan.<br>\nBut I would also like to use mustache templates on the client with ember.js</p>\n\n<p>How is this problem normally solved?\nShould I use different template engines on server/client?</p>\n"},{"tags":["android","iphone","node.js","mongodb"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":49,"score":1,"question_id":13275011,"title":"Which is the best technology for real time application","body":"<p>I am trying to create a voting application, where the users send in their vote/likes/dislikes. The information is obtained by the server and stored in our database. Also the users will be able to see the realtime statistics like how many likes/dislikes. For this also the clients will constantly make requests for the updates.</p>\n\n<p>I want this application to be scalable and platform independent. So I was thinking of create a web app. I was thinking of using node.js and mongodb for the database. Will it be the best option that I will have or there are other better alternatives. If I use node, how many connections will I be able to handle since the connected users will be constantly requesting for updates</p>\n\n<p>If I want to make android/iphone app for this, is it feasible. I mean I will be using websockets for the clients to request for updates. I am not sure if android/iphone platforms will have this capability if I need to create a separate app for them rather than browsing the web.</p>\n\n<p>What do you suggest?</p>\n"},{"tags":["node.js","mongodb","coffeescript","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13273823,"title":"Updating subdocuments with Mongoose","body":"<p>Okay, so I'm trying to update a subdocument (embedded document) with Mongoose. I have:</p>\n\n<pre><code>    query =\n      'fanclubs.fanclub_id': fanclub_id\n\n    fan_update =\n      'fanclubs.$.fanclub_name': fanclub_data.fanclub_name\n\n    Fan.update query, fan_update, (err, numAffected) -&gt;\n      console.log err\n      console.log numAffected\n</code></pre>\n\n<p>Doesn't seem to actually update the <code>Fan</code> object with the new <code>fanclub_name</code>. Ideas?</p>\n\n<p>I want to update the <code>fanclub_name</code> field</p>\n\n<p><strong>EDIT</strong> My <code>Fan</code> Schema</p>\n\n<pre><code>mongoose = require \"mongoose\"\n{FanClubMemberSchema} = require './schemas/fanClubMemberSchema'\nvalidation = require './validation'\n\nFanSchema = new mongoose.Schema(\n  first_name:\n    type: String\n    trim: true\n    required: true\n\n  last_name:\n    type: String\n    trim: true\n    required: true\n\n  fullname:\n    type: String\n    trim: true\n    required: true\n\n  email:\n    type: String\n    lowercase: true\n    unique: true\n    required: true\n    validate: [validation.email, 'Email is invalid']\n\n  fanclubs:\n    type: [FanClubMemberSchema]\n    required: false\n\n  added_on:\n    type: Date\n    default: Date.now\n    required: true\n)\n</code></pre>\n\n<p><strong>FanClubMemberSchema</strong></p>\n\n<pre><code>mongoose = require \"mongoose\"\n\nFanClubMemberSchema = new mongoose.Schema\n  fanclub_id:\n    type:  String\n    trim:  true\n    required: true\n\n  fanclub_name:\n    type: String\n    trim: true\n    required: true\n\n  fanclub_image:\n    type: String\n    trim:true\n    required:true\n\n  access:\n    type:  String\n    trim:  true\n    required: true\n\n  joinedOn:\n    type:  Date\n    default: Date.now\n    required: true    \n\nexports.FanClubMemberSchema = FanClubMemberSchema\n</code></pre>\n"},{"tags":["windows","node.js","npm"],"answer_count":6,"favorite_count":5,"up_vote_count":12,"down_vote_count":0,"view_count":9639,"score":12,"question_id":7300132,"title":"How to use npm with node.exe?","body":"<p>I have downloaded <a href=\"http://nodejs.org/dist/v0.5.5/node.exe\" rel=\"nofollow\">windows binary of nodejs</a>. How can I install and use <code>npm</code> (Node package manager)?</p>\n"},{"tags":["css","node.js","compass-css","bless"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":60,"score":5,"question_id":13259419,"title":"How to combine compass with bless?","body":"<p>I am working on a Compass project and my final css output is huge so it needs to be be <a href=\"http://blesscss.com/\">blessed</a> . </p>\n\n<p>I am using Codekit to compile my SCSS files, and it has the bless option for the less and sass files but unluckly this option seems to be not available for the compass projects (BTW there is no workaround to fix the problem <a href=\"https://github.com/bdkjones/CodeKit/issues/163\">https://github.com/bdkjones/CodeKit/issues/163</a>)</p>\n\n<p>Is there an alternative way to do that automatically after the compiling process? Is it possible to watch the css file with nodejs and then bless it?</p>\n"},{"tags":["image","node.js","pinterest"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13247192,"title":"what bits of info are stored in pinterest image urls?","body":"<p>The first bit before the _ is the id of the pin...what are the <em>ZZtfjmGQ</em> used for? I'm assuming the _c is probalby something to do with size.</p>\n\n<pre><code>http://media-cache-lt0.pinterest.com/upload/33284484717557666_HZtfjmFQ_c.jpg\n</code></pre>\n\n<p>I'm building an image upload service in node.js and was curious what other sites do to store the image.</p>\n"},{"tags":["regex","node.js","routing","express","params"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13273581,"title":"multiple conditional GET parameters","body":"<p>How can I merge these two get requests into one?</p>\n\n<pre><code>app.get('/:something/:else', function(req, res){\n  res.render(\"something\");\n});\n\napp.get('/:something', function(req, res){\n  res.render(\"something\");\n});\n</code></pre>\n\n<p>I tried this and it didn't work.</p>\n\n<pre><code>app.get('(/:something|/:something/:else)', function(req, res){\n  res.render(\"something\");\n});\n</code></pre>\n"},{"tags":["linux","performance","node.js","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13271057,"title":"node.js vs IIS 7.5 performance","body":"<h2>The setup:</h2>\n\n<p>2 machines on EC2 of type m3.xlarge.</p>\n\n<p>First one with ubuntu server.</p>\n\n<p>Second one win2008r2.</p>\n\n<p>node.js on ubuntu using the basic example to return a string response to any request.</p>\n\n<p>asp.net httphandler to return the same response.</p>\n\n<p>using <a href=\"https://github.com/newsapps/beeswithmachineguns\" rel=\"nofollow\">https://github.com/newsapps/beeswithmachineguns</a> \nI used 10 machines to execute 200000 with concurrency of 2000 (200 per machine)\nI ran the benchmark and got:</p>\n\n<h2>NodeJS:</h2>\n\n<pre><code> Complete requests:         200000\n\n Requests per second:       5605.170000 [#/sec] (mean)\n\n Time per request:          358.071900 [ms] (mean)\n\n 50% response time:         31.000000 [ms] (mean)\n\n 90% response time:         239.300000 [ms] (mean)\n</code></pre>\n\n<h2>IIS:</h2>\n\n<pre><code> Complete requests:         200000\n\n Requests per second:       9263.810000 [#/sec] (mean)\n\n Time per request:          215.992900 [ms] (mean)\n\n 50% response time:         214.000000 [ms] (mean)\n\n 90% response time:         244.000000 [ms] (mean)\n</code></pre>\n\n<p>The nodeJS code is:</p>\n\n<pre><code>http.createServer(function (request, response) {\n  response.writeHead(200, {'Content-Type': 'text/plain'});\n  response.end('Some response\\n');\n}).listen(80);\n</code></pre>\n\n<p>The httphandler code is:</p>\n\n<pre><code>context.Response.Write(\"Some response\\n\" + Guid.NewGuid().ToString(\"N\"));\n</code></pre>\n\n<p>I thought node js will be much faster, did I do something wrong?</p>\n\n<h2>EDIT:</h2>\n\n<p>after using the cluster module I got 16685 request per second from the node js\nI\"m going to bring up the strongest EC2 instances and check on them</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13272824,"title":"Combine two OR-queries with AND in Mongoose","body":"<p>I want to combine two OR-queries with AND in Monoose, like in this SQL statement:</p>\n\n<pre><code>SELECT * FROM ... WHERE (a = 1 OR b = 1) AND (c=1 OR d=1)\n</code></pre>\n\n<p>I tried this in a NodeJS module which only gets the model object from the main application:</p>\n\n<pre><code>/********** Main application ***********/\nvar query = MyModel.find({});\nmyModule1.addCondition(query);\nmyModule2.addCondition(query);\nquery.exec(...)\n\n/************ myModule1 ***************/\nexports.addCondition = function(query) {\n  query.or({a: 1}, {b: 1});\n}\n\n/************ myModule2 ***************/\nexports.addCondition = function(query) {\n  query.or({c: 1}, {d: 1});\n}\n</code></pre>\n\n<p>But this doesn't work, all OR-conditions will get joined together like in this SQL statement:</p>\n\n<pre><code>SELECT * FROM ... WHERE a = 1 OR b = 1 OR c=1 OR d=1\n</code></pre>\n\n<p>How can I combine the two conditions of <code>myModule1</code> and <code>myModule2</code> with AND in Mongoose?</p>\n"},{"tags":["node.js","terminal","terminalservices"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13272264,"title":"How to stop AngularJS tutorial web server","body":"<p>Following the AngularJS tutorial on docs.angularjs.org I started the simple webserver I started the web server in <code>web-server.js</code> just to test it, and to try Node for the first time.<br>\nI used it for a bit to view a few files and directories and then I wanted to stop it. And realised I didn't know how.  </p>\n\n<p>Please help, just closing the Terminal window (yes, I have a Mac OS X 10.6.8) and stopping all processes manually just doesn't feel right and I think there should be another way.</p>\n"},{"tags":["node.js","events","event-handling","race-condition","event-loop"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13267594,"title":"How to avoid the need to delay event emission to the next tick of the event loop?","body":"<p>I'm writing a Node.js application using a global event emitter. In other words, my application is built entirely around events. I find this kind of architecture working extremely well for me, with the exception of one side case which I will describe here.</p>\n\n<p>Note that I do not think knowledge of Node.js is required to answer this question. Therefore I will try to keep it abstract.</p>\n\n<p>Imagine the following situation:</p>\n\n<ul>\n<li>A global event emitter (called <code>mediator</code>) allows individual modules to listen for application-wide events.</li>\n<li>A HTTP Server is created, accepting incoming requests.</li>\n<li>For each incoming request, an event emitter is created to deal with events specific to this request</li>\n</ul>\n\n<p>An example (purely to illustrate this question) of an incoming request:</p>\n\n<pre><code>mediator.on('http.request', request, response, emitter) {\n\n    //deal with the new request here, e.g.:\n    response.send(\"Hello World.\");\n\n});\n</code></pre>\n\n<p>So far, so good. One can now extend this application by identifying the requested URL and emitting appropriate events:</p>\n\n<pre><code>mediator.on('http.request', request, response, emitter) {\n\n    //identify the requested URL\n    if (request.url === '/') {\n        emitter.emit('root');\n    }\n    else {\n        emitter.emit('404');\n    }\n\n});\n</code></pre>\n\n<p>Following this one can write a module that will deal with a root request.</p>\n\n<pre><code>mediator.on('http.request', function(request, response, emitter) {\n\n    //when root is requested\n    emitter.once('root', function() {\n\n        response.send('Welcome to the frontpage.');\n\n    });\n\n});\n</code></pre>\n\n<p>Seems fine, right? Actually, it is <strong>potentially broken</strong> code. The reason is that the line <code>emitter.emit('root')</code> may be executed before the line <code>emitter.once('root', ...)</code>. The result is that the listener never gets executed.</p>\n\n<p>One could deal with this specific situation by delaying the emission of the <code>root</code> event to the end of the event loop:</p>\n\n<pre><code>mediator.on('http.request', request, response, emitter) {\n\n    //identify the requested URL\n    if (request.url === '/') {\n        process.nextTick(function() {\n            emitter.emit('root');\n        });\n    }\n    else {\n        process.nextTick(function() {\n            emitter.emit('404');\n        });\n    }\n\n});\n</code></pre>\n\n<p>The reason this works is because the emission is now delayed until the current event loop has finished, and therefore all listeners have been registered.</p>\n\n<p>However, there are many issues with this approach:</p>\n\n<ol>\n<li>one of the advantages of such event based architecture is that emitting modules do not need to know who is listening to their events. Therefore it should not be necessary to decide whether the event emission needs to be delayed, because one cannot know what is going to listen for the event and if it needs it to be delayed or not.</li>\n<li>it significantly clutters and complexifies code (compare the two examples)</li>\n<li>it probably worsens performance</li>\n</ol>\n\n<p>As a consequence, my question is: how does one avoid the need to delay event emission to the next tick of the event loop, such as in the described situation? </p>\n"},{"tags":["node.js","express","mocha","zombie.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13272416,"title":"How to test express app headless with Mocha and Zombie.js","body":"<p>I am trying to run some Mocha/Zombie.js tests on my new node.js (express) app.</p>\n\n<p>Now I want to do it without having to restart the node app.</p>\n\n<p>Now, I have a working test, something like this:</p>\n\n<pre><code>var assert=require('assert')\n    , Browser = require(\"zombie\")\n    ;\n\nvar browser = new Browser();\nbrowser.site = \"http://domain.com\";\nbrowser.silent = false;\n\ndescribe('Home page', function(){\n    describe ('Page title', function(){\n        it('should open a home page', function(done){\n            browser.visit('/').\n            then(function(done){\n                assert.equal(browser.text(\"title\"), \"My page title\");\n                done();\n            }).fail(function(err){\n                done(err);\n            });\n        });\n    });\n});\n</code></pre>\n\n<p>So, when the test fails, I change the page title, <em>reload the app</em> and then re-run the test so it passes.</p>\n\n<p>I know I can do something like:</p>\n\n<pre><code>var server = require('../server');\nvar browser = new Browser();\n</code></pre>\n\n<p>I just don't know how, and I can't see from Mocha and Zombie example pages.</p>\n\n<p>How do I tell the browser.visit to visit the <em>server</em> and not the real deployed web page?</p>\n"},{"tags":["javascript","html5","node.js","upload","compression"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":1,"view_count":82,"score":5,"question_id":13271061,"title":"Compressing huge files (> 2GB) into ZIP on the client side","body":"<p>Im building an upload tool using <code>node.js</code> and <code>socket.io</code>, because they usually upload incredibly huge files and normal upload forms wouldnt work. The problem is that they wanted to compress the files into a zip before sending them, to increase efficiency in transmission.</p>\n\n<p>I've been researching around compression methods like <a href=\"http://stuartk.com/jszip/\" rel=\"nofollow\">JSZip</a> or <a href=\"http://gildas-lormeau.github.com/zip.js/\" rel=\"nofollow\">zip.js</a>, but neither of those work well with extremely big files. What could I do?</p>\n"},{"tags":["javascript","node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13263562,"title":"Unable to update array fields in mongoosejs","body":"<p>I have a weird issue I can't resolve. I have a Mongoose schema:</p>\n\n<pre><code>Product = new Schema({\n  title: {\n     type: String\n  },\n  prices: {\n     type: Array\n  },\n  sync: {\n     type: Boolean\n  }\n  ...\n</code></pre>\n\n<p>I use the post save middleware to update a 3rd party site if the sync flag is true. On return of that operation I update the prices array and set sync to false so that it will not result in an endless loop.</p>\n\n<pre><code>Product.post('save', function () { \n    if(this.sync) {\n        this.title = \"HELLO\";\n        this.prices[0].retail = '24';\n        this.sync = false;\n        this.save();\n    }\n});\n</code></pre>\n\n<p>If I do the above the title and sync fields change but not the prices array. Actually I cannot update any array in my schema. In the above example, the prices array contains about 10 entries - each an object that contains many field including a retail field. I have also tried adding to that array:</p>\n\n<pre><code>this.prices.push({ retail: \"10 });\n</code></pre>\n\n<p>As well as reinit the array:</p>\n\n<pre><code>this.prices = [];\n</code></pre>\n\n<p>No matter what I do it has no effect. Any non array field can however, be updated.</p>\n\n<p>Any ideas what is going on?</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1363,"score":0,"question_id":11266608,"title":"Socket.io error","body":"<p>I am attempting to run Nodejs with the Socket.io module. I have installed the latest version of Nodejs, and I installed socket.io from a command prompt opened as an administrator (I'm in windows 7) using the command npm install socket.io\nThe install appears to complete without any problems but when I attempt to run the following test program: </p>\n\n<pre><code>var io = require('socket.io').listen(80);\n\nio.sockets.on('connection', function (socket) {\n  socket.emit('news', { hello: 'world' });\n  socket.on('my other event', function (data) {\n    console.log(data);\n  });\n});\n</code></pre>\n\n<p>I receive this error:</p>\n\n<pre><code>module.js:340\n    throw err;\nError: Cannot find module 'socket.io'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (C:\\xampp\\htdocks\\HTML5Game\\impact\\app.js:1:72)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function .Module._load (module.js:312:12)\n    at Module.runMain (module.js:487:10)\n</code></pre>\n\n<p>In my searching I found some things about dependency problems, and some suggestions about incompatibility between socket.io and a version of Nodejs, but both were talking about older versions of socket.io and Node\nThanks.</p>\n"},{"tags":["javascript","mysql","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13266013,"title":"When to close MySQL connection using node-mysql?","body":"<p>Currently using: <a href=\"https://github.com/felixge/node-mysql\" rel=\"nofollow\">https://github.com/felixge/node-mysql</a></p>\n\n<p>I have the following code:</p>\n\n<pre><code>var connection = mysql.createConnection({\n    host     : 'localhost',\n    user     : 'me',\n    password : 'secret',\n    database : 'Database1'\n});\napp.put('/api/upload', function(req, res, next)\n{\n    connection.connect();\n    doMultipleQueries(function(err)\n    {\n        connection.end();\n    });          \n};\n</code></pre>\n\n<p>The put request works perfectly fine, but calling it the second time, I get the following error</p>\n\n<pre><code>events.js:68\n        throw arguments[1]; // Unhandled 'error' event\n                       ^\nError: Cannot enqueue Handshake after invoking quit.\n    at Protocol._validateEnqueue (/Users/anon/Desktop/project Web/node_modules/mysql/lib/protocol/Protocol.js:110:16)\n</code></pre>\n\n<p>Am I supposed to leave the connection open until the server dies?</p>\n\n<p>UPDATE:\nWhen I move the mysql.createConnection into the put request function like so:</p>\n\n<pre><code>var connection = null; \napp.put('/api/upload', function(req, res, next)\n{\n    connection = mysql.createConnection({\n        host     : 'localhost',\n        user     : 'me',\n        password : 'secret',\n        database : 'Database1'\n    });\n    connection.connect();\n    doMultipleQueries(function(err)\n    {\n        connection.end();\n    });          \n};\n</code></pre>\n\n<p>It works fine. Does this mean connection.end() closes what mysql.createConnection created and cannot be reconnected?</p>\n"},{"tags":["javascript","node.js","jade"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13269200,"title":"Node.js + Jade - Passing array of classes to HTML tag doesn't work","body":"<p>I've got this:</p>\n\n<pre><code>    - var bodyClasses = []\n    - var noUser = \"no-user\";\n    - if(!user)\n      - if(typeof classes == \"object\") \n        bodyClasses = classes\n        bodyClasses.push(noUser)\n      - else bodyClasses = [classes,noUser]\n    - else bodyClasses = classes\n\n    html.no-js(xmlns:fb=\"http://ogp.me/ns/fb\", lang=\"en\",class=bodyClasses)\n     body(class=bodyClasses)\n</code></pre>\n\n<p>I was trying to add move up the body classes to the <code>html</code> tag but it doesn't work.\nThe above would render as:</p>\n\n<pre><code>&lt;html  class=\"home,no-user no-js ...\" ... &gt; &lt;!-- no bueno --&gt;\n  &lt;body class=\"home no-user\"&gt; &lt;!-- This gets rendered correctly --&gt;\n</code></pre>\n\n<p>Why is the array rendered as a string in the <code>html</code> tag?</p>\n"},{"tags":["node.js","redis","socket.io"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":22,"score":2,"question_id":13263246,"title":"Scaling NodeJS chat room - store connection status in Redis","body":"<p>The chat room app are running on multiple servers and consists two services: <br />\n1. connection manager <br />\nBefore joining the chat room, client ask for a chat service url from connection manager first <br />\n2. chat service <br />\nA typical socket.io based chat implementation. <br />\n<br />\nI need to store each client's connection status in Redis, such as user connect to which room, how many users are in one room etc. So the connection manager can use the data to do load balancing. </p>\n\n<p>I can use socket connection/disconnect event to maintain the current connection status in Redis, but in case of NodeJS server failure, how to make sure Node and Redis data are synchronized? What's  the best way to do this?</p>\n"},{"tags":["javascript","node.js","asynchronous","recursion","callback"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13268479,"title":"Exiting in node.js after recursive function is done","body":"<p>I try to rewire my brain for async coding and I still I still seem to fail. Unfortunately I can't figure out how to do it properly in this case. Let me give an example:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var nconf = require('nconf');\n\n nconf.argv()\n .env();\n\n function runme(callback){\n   var nummessages = nconf.get('SMS_MESSAGES');\n   decodemessage(0, nummessages);\n   callback();\n }\n\n function decodemessage(i, nummessages) {\n  if( i &lt; nummessages ) {\n    var message = 'SMS_'+(i+1)+'_TEXT';\n    var number = 'SMS_'+(i+1)+'_NUMBER';\n    console.log('number: '+number);\n    console.log('message: '+message);\n    console.log('message text: '+ nconf.get(message));\n    console.log('message number: '+ nconf.get(number));\n    decodemessage(i+1);\n  }\n} \n\nrunme(function(){\n  process.exit(0);\n});\n</code></pre>\n\n<p>This gets called by gammu-smsd which receives SMS messages and puts them into ENV vars and launches a script. This works fine as long as I run it on my own, return code seems to work as well. When I run it from gammu-smsd it fails and it looks like decodemessage is never executed. Some debug output shows that I do go into runme().</p>\n\n<p>My guess is that the callback in runme() gets executed before the recursive decodemessage() call is done. Am I right and if so can someone explain how I can do that properly?</p>\n\n<p>If you want to test run it like this:</p>\n\n<pre><code>node server.js --SMS_MESSAGES 2 --SMS_1_TEXT blabliblo --SMS_1_NUMBER=47796546546 --SMS_2_TEXT Iammessagetwo --SMS_2_NUMBER 12345678\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1226,"score":1,"question_id":10589177,"title":"Cannot find module `express` | socket.io [node.js]","body":"<p>So I went to Git Bash and typed <code>npm install socket.io</code> I found the the directory in my user folder: <code>C:\\Users\\weka\\node_modules</code>... anyway, I dragged the <code>socket.io</code> folder into my project <code>www</code> folder because I am using <code>WAMP</code> server.</p>\n\n<p>So, here's my <code>server.js</code> for testing: </p>\n\n<pre><code>var app = require('express').createServer();\nvar io = require('socket.io').listen(app);\n\nio.sockets.on('connection', function (socket) {\nconsole.log('Someone connected!');\nsocket.on('set nickname' , function (nickname) {\nsocket.nickname = nickname;\nconsole.log(nickname + ' just connected!');\n});\n\n});\n\napp.listen(8080);\n</code></pre>\n\n<p>and I go into <code>cmd</code> and type <code>node C:\\wamp\\www\\gameTest\\server.js</code></p>\n\n<p>and I get the error that it cannot find the <code>module</code> called <code>express</code>. I thought I downloaded <code>socket.io</code>? I am a newb when it comes to GitHub.. so I probably did it wrong. :\\</p>\n\n<p>Help?</p>\n\n<p>UPDATE: I found out I hadn't installed it. OK, I typed <code>npm install express</code> and I now I have <code>express</code> folder in my <code>node_modules</code> folder.</p>\n"},{"tags":["node.js","phonegap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13267180,"title":"Which node.js framework is suitble for a phonegap app project?","body":"<p>I am planing to build a mobile app (kind of twitter with LBS) using phonegap, but now, I am not sure which Node Framework is a best solution which is running on the server side, Tower.js, FlatIron, Express, SocketStream, Meteor, or any others? </p>\n"},{"tags":["node.js","request"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13230236,"title":"nodejs request module parse body","body":"<p>I have the following code:</p>\n\n<pre><code>var express = require('express');\nvar app = express.createServer();\nvar request = require('request');\n\napp.use(myMiddleware);\napp.listen(5010);\n\nvar payload = { id: 1 };\n\nrequest({\n  method: 'POST',\n  body:JSON.stringify(payload),\n  url: 'http://localhost:5000'\n}, function(err, res, body) {\n  console.info(\"Request Done\");\n})\n</code></pre>\n\n<p>In my middleware code I want to parse the body and extract the request id, yet for some reason the following code doesn't work (payload is undefined):</p>\n\n<pre><code>  var myMiddleware= function (req, res, next){\n  var payload = req.body;\n  if (payload.id === 1) console.info(\"first request!!!!!\");\n  next();\n} \n</code></pre>\n\n<p>When I try to print \"payload\" all I get is <code>[object Object]</code>.</p>\n\n<p>Could you please tell me how to extract the id, and how to print the attributes of the payload object?</p>\n\n<p>Thanks,\nLi</p>\n"},{"tags":["node.js","ldap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13265553,"title":"ldapjs error when adding user","body":"<p>Doing testing on ldapjs => <a href=\"http://ldapjs.org/guide.html\" rel=\"nofollow\">ldapjs guide</a>.</p>\n\n<p>I am at the part, where a new enry is being added to ldap, giving the command:</p>\n\n<pre><code>ldapadd -H ldap://localhost:1389 -x -D cn=root -w secret -f ./user.ldif\n</code></pre>\n\n<p>the user.ldif file is the following (see link)</p>\n\n<pre><code>dn: cn=ldapjs, ou=users, o=myhost\nobjectClass: unixUser\ncn: ldapjs\nshell: /bin/bash\ndescription: Created via ldapadd\n</code></pre>\n\n<p>However when giving the 'add' command, I get:</p>\n\n<pre><code>adding new entry \"cn=ldapjs, ou=users, o=myhost\"\nldap_add: Operations error (1)\nmatched DN: ou=users, o=myhost\nadditional info: Cannot read property 'ldapjs' of undefined\n</code></pre>\n\n<p>I do not get the given error.\nWhat is actually suppose to be done to fix this?\nI did not find any information about this.</p>\n"},{"tags":["node.js","socket.io","express.js"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":2692,"score":0,"question_id":7420051,"title":"Store session data using MemoryStore in Node, similar to $_SESSION['data'] = value in PHP","body":"<h1>Question:</h1>\n\n<p>Is it possible to store session data similar to $_SESSION['somedata'] = \"Hello\" in php?</p>\n\n<p>Here is my code so far:</p>\n\n<p><strong>Creating the memory store</strong></p>\n\n<pre><code>var MemoryStore = express.session.MemoryStore,\n    sessionStore = new MemoryStore();\n</code></pre>\n\n<p><strong>Express Config</strong></p>\n\n<pre><code>app.configure(function(){\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(express.cookieParser());\n  app.use(express.session({\n    store: sessionStore,\n    secret: 'secret', \n    key: 'express.sid'}));\n  app.use(require('stylus').middleware({src: __dirname + '/public'}));\n  app.use(app.router);\n  app.use(express.static(__dirname + '/public'));\n});\n</code></pre>\n\n<p><strong>Parsing the cookie to get the session id on handshake authorization</strong></p>\n\n<pre><code>var parseCookie = require('connect').utils.parseCookie;\n\nio.set('authorization', function (data, accept) {\n  if (data.headers.cookie) {\n    data.cookie = parseCookie(data.headers.cookie);\n    data.sessionID = data.cookie['express.sid'];\n\n    sessionStore.get(data.sessionID, function (err, session) {\n      if (err) \n      {\n          accept(err.message, false); //Turn down the connection\n      } \n      else\n      {\n          data.session = session; //Accept the session\n          accept(null, true);\n      }\n    });\n  } else {\n     return accept('No cookie transmitted.', false);\n  }\n});\n</code></pre>\n\n<p><strong>Storing 'loggedin' when the password and username are 'admin'</strong></p>\n\n<pre><code>io.sockets.on('connection', function (socket) {\n\n  socket.on('details', function(data){\n    console.log(\"Details: \" + data.u + data.p);\n    if(data.p == \"admin\" &amp;&amp; data.u == \"admin\")\n    {\n      //Add the logged in field to the session\n    }\n  });\n});\n</code></pre>\n\n<p><strong>If the user is logged in redirect them to the home page</strong></p>\n\n<pre><code>app.get(navigation.login.uri, function(req, res){\n  if(req.session.loggedin)\n  {\n    res.redirect('/home');\n  }\n  else\n  {\n    res.render('login', {\n      title: navigation.login.title,\n      navigation: navigation\n    });\n  }\n});\n</code></pre>\n\n<p>When I try to use:</p>\n\n<pre><code>req.session.loggedIn\n</code></pre>\n\n<p><strong>The value is undefined. Could this be a storage problem, or am I accessing it incorrectly?</strong></p>\n"},{"tags":["javascript","oop","node.js","events"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13264937,"title":"Constructor function as an event emitter","body":"<p>I would like to write a constructor function for some work I'm doing in node.js. Amongst other things, I'd like to log the number of instances it creates using an event emitter. At the moment I do this by giving the constructor object a method which is an event emitter. For example:</p>\n\n<pre><code>var EventEmitter = require('events').EventEmitter;\n\nfunction MyObject() {\n    ...\n    MyObject.events.emit('createdMyObject')\n}\n\nMyObject.events = new EventEmitter();\n\n/* somewhere else... */\n\nMyObject.events.on('createdMyObject', function () {\n    // Do something when a new instance is created.\n});\n</code></pre>\n\n<p>What I'd really prefer is for the constructor to more directly emit events, so I could listen for them with something like:</p>\n\n<pre><code>MyObject.on('createdMyObject', function () {\n    // Do something when a new instance is created.\n});\n</code></pre>\n\n<p>Is there a way to do this?</p>\n\n<p>Please note, I don't need the instances to be event emitters (there are lots of examples of this when you google it). I want something equivalent to a <em>class method</em> in the parlance of some other OO languages.</p>\n"},{"tags":["node.js","amazon-s3","amazon-web-services","express","meteor"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13261606,"title":"Uploading user images to s3 and generating thumbnails from node","body":"<p>I'm currently considering developing a Meteor node.js app, but am struggling with how best to handle uploading of user images. In particular, I want to create a photography website that will allow the photographer to upload images in an 'admin' section, and these images will then be displayed on the website. I need to create a thumbnail of these images, and save the respective URLs to the database. I'm struggling with how to best accomplish this in meteor.</p>\n\n<p>Is my best bet to use something like s3 combined with an AWS process for generating thumbnails? </p>\n\n<p>Or should I save and host the images directly in the Meteor/node session? </p>\n\n<p>Or should I scrap Meteor and use something like Express.js for this project? </p>\n"},{"tags":["facebook","api","node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3082,"score":4,"question_id":5574440,"title":"How to access Facebook user data from Node.js?","body":"<p>I have PHP app which is a Facebook app. User logs in to it, gives permissions, and then I need  my backend Node.js to get some data about this user. It's a weird flow, but there is a reason for that. Technically all what Node.js knows about user currently is Facebook user id.\nWhat esle does it need to know to be able to fetch info about this user (assuming that user just authenticated with PHP part, so PHP can supply me this data). And what's the best Node.js library to use for that?</p>\n"},{"tags":["javascript","node.js","nowjs"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13265423,"title":"It is possible to send a message to a specific user (selective push notification) using nowjs and node.js","body":"<p>I have a group a users, all connected to a single server, and I want to send a message from one user to another user, with the receiving user not having to accept any sort of a request from the originating message. So I am trying to use nowjs for this, where I would simply broadcast the msg meant for a specific user, and only the required user would accept it. In short I need to send something like a selective push notification. Do you think this approach of broadcasting is a good idea, as I think I will have max 300 users at once, and if not do have any others suggestions how I can implement this. Thanks in advance. </p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13265255,"title":"ldapjs error in server.js","body":"<p>I received this error:</p>\n\n<pre><code>/home/user/node_modules/ldapjs/lib/server.js:65\nthrow new TypeError('Invalid argument type: ' + typeof (argv[i]));\n        ^\nTypeError: Invalid argument type: undefined\nat mergeFunctionArgs (/home/user/node_modules/ldapjs/lib/server.js:65:13)\nat Server._mount (/home/user/node_modules/ldapjs/lib/server.js:814:35)\nat Server.add (/home/user/node_modules/ldapjs/lib/server.js:500:15)\nat Object.&lt;anonymous&gt; (/home/user/workspace/ldap/ldap.js:34:8)\nat Module._compile (module.js:449:26)\nat Object.Module._extensions..js (module.js:467:10)\nat Module.load (module.js:356:32)\nat Function.Module._load (module.js:312:12)\nat Module.runMain (module.js:492:10)\nat process.startup.processNextTick.process._tickCallback (node.js:244:9)\n</code></pre>\n\n<p>when attempting to do the tests on <a href=\"http://ldapjs.org/guide.html\" rel=\"nofollow\">ldapjs guide</a>.</p>\n\n<p>This error pretty much blocks on doing further testing since the service won't start.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13227489,"title":"How can one get the file path of the caller function in node.js?","body":"<p>Here is some sample code from three files:</p>\n\n<pre><code>// foo.js\nvar myFunc = require(\"./myFunc\");\nfunction foo(){\n   myFunc(\"message\");\n}\n\n// bar.js\nvar myFunc = require(\"./myFunc\");\nfunction bar(){\n   myFunc(\"message\");\n}\n\n// myFunc.js\nmodule.exports = myFunc;\nfunction myFunc(arg1){\n   console.log(arg1);\n   // Here I need the file path of the caller function\n   // For example, \"/path/to/foo.js\" and \"/path/to/bar.js\"\n}\n</code></pre>\n\n<p>I need to get the file path of the caller function dynamically, without any extra argument passing, for <code>myFunc</code>.</p>\n"},{"tags":["node.js","tds","node-tds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13264752,"title":"Node-tds's result set too big will cause program to hang","body":"<p>node-tds refers to this: <a href=\"https://github.com/cretz/node-tds\" rel=\"nofollow\">https://github.com/cretz/node-tds</a></p>\n\n<p>I realise if my results return have too much rows, eg 30, the program will hang. When I stepped into the node-tds code, I realised it was cos it hit an error in the method _handleToken() of tds-client.js. The error was StreamIndexOutOfBoundsError. When I stepped further inside, I found that the error came from assertBytesAvailable() of buffer-stream.js. A guess is that the buffer set is not big enough, but I can't understand how the buffer size is set in order to change it.</p>\n\n<p>This is probably the same problem I encountered last time hvg my declared datatype to of max size, I 'fixed' this by setting a feasible size for my datatype. But I can't control my results set, I can hv a lot of results!</p>\n\n<p>I think this is a problem with tds-client, is there any fixes for this bug?? Or any workarounds or alternatives?</p>\n"},{"tags":["node.js","mongodb","nginx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13262581,"title":"Using NGinx as an image server with mongodb as a DB and node as app server...?","body":"<p>I want to host a social type of site. It will be on node (or vertx) . My question is........ if I have a separate image server on my Local area network.. when a user uploads a file should the file be saved to the image -nginx server and then the database told about it and given a link for the picture?</p>\n\n<p>for instance it would be like this:</p>\n\n<p>db.users.find('profilepicture' : 1)</p>\n\n<p>profilepicture: localaddressoftheneginxserver/imagefolder/imagename.jpg  </p>\n\n<p>Am I thinking things through correctly? Have the image served on a separate nginx server... have the database not include the actual picture but a link to the picture... so when a client connects to the app server and asks for a particular picture it queries the database, the database sends the link to the app server... and then the app server informs the users computer of the pictures location?</p>\n\n<p>would that work? i'm just a little confused about how someone on the outside could connect to an app server and then also be able to connect to an image server on the same local area network even if they had the address. Would the image server need to be some separate IP?</p>\n"},{"tags":["node.js","v8"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":3822,"score":5,"question_id":5356113,"title":"How to check which version of v8 is installed with my NodeJS?","body":"<p>How is V8 installed along with NodeJs? What version is my current V8 engine?</p>\n"},{"tags":["node.js","map","ejs"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13260487,"title":"Does EJS handle array.map(callback)?","body":"<p>I am passing an array of objects to an EJS template, which I would like to map into links using the regular .map() method of arrays. But for reasons I can't figure out, the callback I'm passing to map() doesn't work within EJS the way I'd expect, and I'm getting empty results.</p>\n\n<p>My data is an array of objects, each with a \"section\" and a \"name\" key. This array is passed as \"entries\" to the template:</p>\n\n<pre><code>siteHeaders = [ { section: \"home\", name: \"Home\"}, \n                { section: \"about\", name: \"About Me\"}, \n                ... plus few more ]\n</code></pre>\n\n<p>The template looks like this, and I have it in a local variable called (surprise) <code>template</code>:</p>\n\n<pre><code>&lt;% entries = entries.map(function(elem) { -%&gt;\n  &lt;% return -%&gt;\n  &lt;a href=\"/&lt;%= elem.section %&gt;\"&gt;\n    &lt;%= elem.name %&gt;\n  &lt;/a&gt;\n&lt;% } ) -%&gt;\n&lt;p&gt;&lt;%- entries.join(\" | \") %&gt;&lt;/p&gt;\n</code></pre>\n\n<p>The result of this template, when I call <code>require('ejs').render(template, {entries: siteHeaders})</code> is:</p>\n\n<pre><code>          &lt;p&gt; |  |  |  | &lt;/p&gt;\n</code></pre>\n\n<p>What I don't get is why this doesn't work in an EJS template, when the corresponding map call works just fine in REPL:</p>\n\n<pre><code>&gt; siteHeaders.map(function(e){ return '&lt;a href=\"/' + e.section +'\"&gt;' + e.name + '&lt;/a&gt;' })\n[ '&lt;a href=\"/home\"&gt;Home&lt;/a&gt;',\n  '&lt;a href=\"/guide\"&gt;About Me&lt;/a&gt;',\n  '&lt;a href=\"/quickstart\"&gt;Portfolio&lt;/a&gt;',\n  '&lt;a href=\"/reference\"&gt;Blog&lt;/a&gt;',\n  '&lt;a href=\"/downloads\"&gt;Contact&lt;/a&gt;' ]\n&gt;\n</code></pre>\n\n<p>Any clues?</p>\n"},{"tags":["node.js","meteor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11733870,"title":"Meteor connection count","body":"<p>What would be the best way to record a live count of connections using the Meteor framework? I have the requirement of live sharing users online and have resorted to creating a collection and just replacing a record on initialize for each user, but the count seems to reset, what I have so far below, thanks in advanced.</p>\n\n<pre><code>Counts = new Meteor.Collection \"counts\"\n\nif Meteor.is_client\n  if Counts.findOne()\n    new_count = Counts.findOne().count + 1\n    Counts.remove {}\n    Counts.insert count: new_count\n  Template.visitors.count = -&gt;\n    Counts.findOne().count\n\nif Meteor.is_server\n  reset_data = -&gt;\n    Counts.remove {}\n    Counts.insert count: 0\n  Meteor.startup -&gt;\n    reset_data() if Counts.find().count() is 0\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13262461,"title":"what is process.env","body":"<p>where can I get the documentation for process.env?\nwhat all the variables I can access in that env</p>\n\n<p>what does  process.env.port || 1137</p>\n\n<p>I understand process.env is environment and we are looking for port in it. what is || means?</p>\n"},{"tags":["javascript","html","node.js","node-xmpp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13261919,"title":"Get HTML page to communicate with node-xmpp/xmpp server","body":"<p>Please keep in mind that I am VERY new to all of this javascript/node.js style of HTML coding. In the past, all I have ever done with HTML is static/information style pages.</p>\n\n<p>I am trying to create an HTML webpage that will take xmpp related information from a user (server address, port, user JID, password, chat messages, other user JID, etc.) and route it through the node.js server to the xmpp server. Ultimately, what I am trying to do is take the <a href=\"https://github.com/webRTC/\" rel=\"nofollow\">webrtc.io code</a> and extend it to be tied to and interact with users on an XMPP server. In trying to do this, I found the node-xmpp module and \"installed\" it (npm install) to the node_modules folder within my project working directory. </p>\n\n<p>I then created a very basic index.html file (text input boxes) that takes user information and then calls functions within a javascript file that is included in the index.html file. Within the javascript file, I added the require function/call <code>const xmpp = require('node-xmpp')</code>, added the <code>var client = new xmpp.Client({[connection settings]});</code> and then started with some basic stanza handler and other xmpp functions. </p>\n\n<p>When I then \"run\" the code in the browser, before I even start entering in information, I see that the console is reporting errors. At first they were errors with the xmpp functions I wrote, so I commented everything out to just have the <code>new xmpp.Client({})</code> line just to see if it would even connect. But then, I would get an error with the <code>cont xmpp = require('node-xmpp')</code>. That error is </p>\n\n<blockquote>\n  <p>Uncaught ReferenceError: require is not defined (anonymous function)</p>\n</blockquote>\n\n<p>From my limited understanding of all of this html/javascript/server stuff, I think what is happening is that the client/browser does not know/have access to either the node.js or node-xmpp library. </p>\n\n<p>Is this right? Should I be doing things differently? And are there any good tutorials/documentation out there that covers this?</p>\n"},{"tags":["javascript","node.js","gruntjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12256704,"title":"grunt.js console.log in callback doesn't output anything","body":"<p>What is wrong with my codes, the console.logs that is inside a call back of file related API's doesn't show anything in CLI.</p>\n\n<pre><code>module.exports = function (grunt) {\n\n    var path = require(\"path\"),\n        fs = require(\"fs\"),\n        gm = require(\"gm\");\n    grunt.registerMultiTask(\"imagesizeslist\", \"Generate image sizes list\", function () {\n        var files = grunt.file.expandFiles(this.file.src);\n        grunt.helper('imagesizeslist', files);\n    });\n\n    //  grunt.log.write(contents);\n\n\n    grunt.registerHelper('imagesizeslist', function (files) {\n        files.forEach(function (file) {\n            basename = path.resolve(file);\n            var exec = require('child_process').exec,\n            child;\n            //using sips\n            console.log('sips \"'+basename+'\" -g pixelHeight');\n            child = exec('sips \"'+basename+'\" -g pixelHeight',\n              function (error, stdout, stderr) {\n                  console.log(error);\n                console.log('stdout: ' + stdout);\n            });\n            // using gm\n            gm(basename).size(function (err, size) {\n                if (!err)\n                    console.log(size.width &gt; size.height ? 'wider' : 'taller than you');\n                else\n                    console.log(\"test\");\n                console.log(size);\n            });\n        });\n    });\n};\n</code></pre>\n"},{"tags":["node.js","web-applications","monitoring","analytics","joyent"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13262077,"title":"What are the most important statistics to look at when deploying a Node.js web-application?","body":"<p><strong>First - a little bit about my background:</strong> I have been programming for some time (10 years at this point) and am fairly competent when it comes to coding ideas up. I started working on web-application programming just over a year ago, and thankfully discovered nodeJS, which made web-app creation feel a lot more like traditional programming. Now, I have a node.js app that I've been developing for some time that is now running in production on the web. <strong>My main confusion stems from the fact that I am very new to the world of the web development, and don't really know what's important and what isn't when it comes to monitoring my application.</strong> </p>\n\n<p>I am using a Joyent SmartMachine, and looking at the analytics options that they provide is a little overwhelming. There are so many different options and configurations, and I have no clue what purpose each analytic really serves. For the questions below, I'd appreciate any answer, whether it's specific to Joyent's Cloud Analytics or completely general. </p>\n\n<p><br/></p>\n\n<h2>QUESTION ONE</h2>\n\n<p>Right now, my main concern is to figure out how my application is utilizing the server that I have it running on. I want to know if my application has the right amount of resources allocated to it. Does the number of requests that it receives make the server it's on overkill, or does it warrant extra resources? What is analytics are important to look at for a NodeJS app for that purpose? (using both MongoDB and Redis on separate servers if that makes a difference)</p>\n\n<p><br /></p>\n\n<h2>QUESTION TWO</h2>\n\n<p>What other statistics are generally really important to look at when managing a server that's in production? I'm used to programs that run once to do something specific (e.g. a raytracer that finishes running once it has computed an image), as opposed to web-apps which are continuously running and interacting with many clients. I'm sure there are many things that are obvious to long-time server administrators that aren't to newbies like me. </p>\n\n<p><br /></p>\n\n<h2>QUESTION THREE</h2>\n\n<p>What's important to look at when dealing with NodeJS specifically? What are statistics/analytics that become particularly critical when dealing with the single-threaded event loop of NodeJS versus more standard server systems?</p>\n\n<p>I have other questions about how databases play into the equation, but I think this is enough for now...</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13261550,"title":"connect-flash middleware not working","body":"<p>im trying to get connect-flash working in my express3 application.</p>\n\n<p>I installed successfully the package:</p>\n\n<pre><code>$ npm install connect-flash\n</code></pre>\n\n<p>I included it:</p>\n\n<pre><code>var flash = require('connect-flash');\n</code></pre>\n\n<p>Setted up the middleware:</p>\n\n<pre><code>app.use(function(req, res, next) {\n    res.locals.message = req.flash();\n    next();\n  });\napp.use(flash());\n</code></pre>\n\n<p>And used it:</p>\n\n<pre><code>app.get('/admin', function(req, res) {   \n    if(loggedIn === true) {      \n      res.redirect('/admin/books');\n    }\n    else {      \n      res.render('login', {message: req.flash('error') });\n    }    \n  });\n  app.post('/admin', function(req, res) {    \n    if((adminAccount.username === getCrypted(req.body.username)) &amp;&amp; \n      (adminAccount.password === getCrypted(req.body.password))) {\n\n      loggedIn = true;\n      res.redirect('/admin/books');\n    }\n    else {\n      req.flash('error', 'Woops, looks like that username and password are incorrect.');\n      res.redirect('/admin');\n    }\n  });\n</code></pre>\n\n<p>However I get: <code>TypeError: Object #&lt;IncomingMessage&gt; has no method 'flash'</code>. I followed the instructions on its github page. What am I missing?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11854789,"title":"Run MapReduce from MongoJS","body":"<p>Is it possible to run a mapreduce job using <a href=\"https://github.com/gett/mongojs\" rel=\"nofollow\">mongojs</a> in a node application. I realize that using mapreduce in the web server code is not the most efficient way to do this but it is for testing purposes.</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13261117,"title":"ExpressJS GET redirection","body":"<p>I'm implementing a little aunthentication routes on my Node app, as simple as this:</p>\n\n<pre><code> app.get('/admin', function(req, res) {\n    res.render('login', { error: false });\n  });\n  app.post('/admin', function(req, res) {    \n    if((adminAccount.username === req.body.username) &amp;&amp; \n      (adminAccount.password === req.body.password)) {\n\n      res.redirect('/admin/books');\n    }\n    else {\n      res.redirect('/admin', { error: true });\n    }\n  });\n</code></pre>\n\n<p>If I login with the right credentials it works flawless, how ever if I failed, it should make a GET request to <code>/admin</code> by redirect. \nHowever I get: <code>undefined. Redirecting to //127.0.0.1:3000/admin</code></p>\n\n<p>That makes me thing that <code>res.redirect</code> is making a <code>POST</code> request to <code>/admin</code> intead of a <code>GET</code> one. </p>\n\n<p>What can I do? How do I specify <code>res.redirect</code> to redirect the right way?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13260769,"title":"return all unique indexes errors while saving","body":"<p>I have to following code:</p>\n\n<pre><code>var UserSchema = mongoose.Schema({\n  email: {\n    type: String,\n    unique: true\n  },\n  username: {\n    type: String,\n    unique: true\n  }\n});\n\nvar User = db.model('User', UserSchema);\n\nvar user = new User();\n\nuser.email = 'some@email.com'\nuser.username = 'peter'\n\nuser.save(function(err){\n  if (err) return console.log(err)\n  console.log('user saved')\n})\n</code></pre>\n\n<p>On the first run it shows <code>user saved</code> which is totally fine. On the second run it gives me</p>\n\n<pre><code>{ [MongoError: E11000 duplicate key error index: node-login.users.$username_1  dup key: { : \"peter\" }]\n  name: 'MongoError',\n  err: 'E11000 duplicate key error index: node-login.users.$username_1  dup key: { : \"peter\" }',\n  code: 11000,\n  n: 0,\n  lastOp: 0,\n  connectionId: 1455732,\n  ok: 1 }\n</code></pre>\n\n<p>What about the <code>email</code>? It is also a duplicate and should return an error. If only one error is thrown each time, why is it the <code>username</code> and not <code>email</code>? <code>email</code> is above <code>username</code> in the schema. How does <code>mongoose</code> decide about what duplicate to check/return first?</p>\n"},{"tags":["node.js","azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13160366,"title":"Error when communicating to azure queues from node.js in a WebRole","body":"<p>I am getting this error when trying to create a message on a queue in azure using node.js azure package version 0.6.6:  {\"code\":\"ECONNREFUSED\",\"errno\":\"ECONNREFUSED\",\"syscall\":\"connect\"}</p>\n\n<p>It only happens in the deployed WebRole, but works fine locally and in Azure websites.  I need this to be in a webrole as I need to have an SSL certificate.</p>\n\n<p>I deployed the role using this method: <a href=\"https://www.windowsazure.com/en-us/develop/nodejs/tutorials/getting-started/\" rel=\"nofollow\">https://www.windowsazure.com/en-us/develop/nodejs/tutorials/getting-started/</a></p>\n\n<p>An error I see in the logs is this which may help diagnose.</p>\n\n<pre><code>Application has thrown an uncaught exception and is terminated:\nTypeError: Cannot read property 'statusCode' of null\n    at E:\\approot\\node_modules\\azure\\lib\\services\\queue\\queueservice.js:295:54\n    at Request._callback (E:\\approot\\node_modules\\azure\\lib\\services\\core\\serviceclient.js:197:9)\n    at E:\\approot\\node_modules\\azure\\node_modules\\request\\main.js:122:22\n    at Request.&lt;anonymous&gt; (native)\n    at Request.emit (events.js:67:17)\n    at ClientRequest.&lt;anonymous&gt; (E:\\approot\\node_modules\\azure\\node_modules\\request\\main.js:224:10)\n    at ClientRequest.emit (events.js:67:17)\n    at Socket.socketErrorListener (http.js:1188:9)\n    at Socket.emit (events.js:67:17)\n    at Array.0 (net.js:301:14)\n</code></pre>\n"},{"tags":["node.js","64bit","windows-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":262,"score":3,"question_id":11515341,"title":"\"The specified module could not be found.\" when copying project with native addon to server machine","body":"<p>I created a native addon for node, a 64bit dll, compiled with the <code>/clr</code> flag to access another .net dll.</p>\n\n<p>All works nicely on my development box (Windows 7, 64bit), but when copying the whole directory over to a server box (Windows Server 2008 R2, 64bit, .net 4.0 Client Profile &amp; Extended installed), a</p>\n\n<pre><code>var myaddon = require('./build/Release/myaddon');\n</code></pre>\n\n<p>yields the following error:</p>\n\n<pre><code>module.js:485\n  process.dlopen(filename, module.exports);\n          ^\nError: The specified module could not be found.\nC:\\Users\\x\\build\\Release\\myaddon.node\n    at Object.Module._extensions..node (module.js:485:11)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n</code></pre>\n\n<p>I know it successfully finds the file 'myaddon.node', because when I change the require statement slightly to point to a non-existing file, it will complain with a different error message.</p>\n\n<p>Without my require statement, node starts up fine.</p>\n\n<p>Why the error and how to fix it?</p>\n"},{"tags":["node.js","ubuntu","ssl","apns"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":220,"score":0,"question_id":10963441,"title":"NodeJS APN module cannot find certificate file on Ubuntu","body":"<p>I am using the apn module (https://github.com/argon/node-apn) to send push notifications to iPhones from NodeJS.</p>\n\n<p>My code works fine on my development machine (Mac OSX) and is successfully pushing notifications through the Apple sandbox gateway (gateway.sandbox.push.apple.com), but when I move it to the staging server (which is running Ubuntu) pushing notifications fails with the message:</p>\n\n<pre><code> Error: ENOENT, no such file or directory 'apns-dev-cert.pem'\n</code></pre>\n\n<p>I am setting up the NodeJS apn object as such:</p>\n\n<pre><code>var options = {\n    cert: \"apns-dev-cert.pem\",          \n    key:  \"apns-key.pem\",               \n    passphrase: null,   \n    gateway: \"gateway.sandbox.push.apple.com\",              \n    port: 2195,                         \n    enhanced: true,                     \n    errorCallback: undefined,                       \n    cacheLength: 5                                  \n};\n</code></pre>\n\n<p>On my development Mac OSX machine, the cert is installed in the Keychain. From my limited understanding of Ubuntu, the equivalent would be to copy the cert file to /etc/ssl/certs. I tried doing this, and also changing the path to \"/etc/ssl/certs/apn-dev-cert.pem\" in my NodeJS code, but the same error message shows up.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["security","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13259896,"title":"Node.JS switch user while running","body":"<p>Is it possible for a Node.JS program that is running as root, to downgrade its authority while it is running? This would be one of the first things it does, and the purpose is of course to limit possible damage it could cause, in the unlikely event that there is a vulnerability, or mis-trusted code that runs in this process.</p>\n\n<p>Alternatively, is there a way for Node.JS process that is running as root, to start a separate process which is non-root? (preferably without adding a layer in between, such as sudo)</p>\n"},{"tags":["node.js","meteor"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13018350,"title":"Meteor directories","body":"<p>I was looking for a way to look up the meteor project path from a smart package (e.g.: obtain the path of the directory where the .meteor folder is ...).\nI was not able to do it using node's __dirname and __filename because somehow in meteor they are not avaiable.\nAny tips ?</p>\n"},{"tags":["node.js","session","sequelize.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13244526,"title":"nodejs session stores only json?","body":"<p>I have a logged in user object that i shove into my session. The user object is a sequelize user object instance, it has many useful methods on it.</p>\n\n<p>When i read the object back from session, all i have now is a json representation of my object. All the useful methods are gone. </p>\n\n<p><strong>Node Question:</strong> Is it possible to put full object into the session, not just the json representations?</p>\n\n<p><strong>Sequelize Question:</strong> Having a json representation of an object, is it possible to construct a full sequelize object without having to requery? </p>\n"},{"tags":["mysql","node.js","etherpad","vmc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13210795,"title":"There was an error processing your settings.json file: process is not defined","body":"<p>when I push my code of etherpad, it said that</p>\n\n<p>[31m[2012-11-03 15:14:00.102] [ERROR] console - [39mThere was an error process\ning your settings.json file: process is not defined</p>\n\n<p>this key code is below</p>\n\n<pre><code>/*\n  This file must be valid JSON. But comments are allowed\n\n  Please edit settings.json, not settings.json.template\n*/\n{\n  //Ip and port which etherpad should bind at\n  \"ip\": process.env.VCAP_APP_HOST,\n  \"port\" : process.env.VCAP_APP_POR,\n\n  //The Type of the database. You can choose between dirty, postgres, sqlite and mysql\n  //You shouldn't use \"dirty\" for for anything else than testing or development\n  /*\"dbType\" : \"dirty\",*/\n  //the database specific settings\n  /*\"dbSettings\" : {\n                   \"filename\" : \"var/dirty.db\"\n                 },*/\n\n  /* An Example of MySQL Configuration */\n   \"dbType\" : \"mysql\",\n   \"dbSettings\" : {\n                    \"user\"    : process.env.VCAP_SERVICES[\"etherpadDB\"][0][\"credentials\"][\"user\"], \n                    \"host\"    : process.env.VCAP_SERVICES[\"etherpadDB\"][0][\"host\"], \n                    \"password\": process.env.VCAP_SERVICES[\"etherpadDB\"][0][\"password\"], \n                    \"database\": process.env.VCAP_SERVICES[\"etherpadDB\"][0][\"name\"]\n                  },\n\n\n\n}\n</code></pre>\n"},{"tags":["node.js","ubuntu","upstart"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13255997,"title":"config file for upstart with nodejs","body":"<p>Can you advise a upstart config file for nodejs on ubuntu? I've found the follows tutorial: <a href=\"http://howtonode.org/deploying-node-upstart-monit\" rel=\"nofollow\">http://howtonode.org/deploying-node-upstart-monit</a> but it seem very old.</p>\n"},{"tags":["node.js","events","scope"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13255873,"title":"Node.js event scope?","body":"<p>I would like to use an event in node.js to execute some code; my question is, what is the scope of the invoked event code?  Specifically, does it share the scope of the event invoker, or is it \"isolated\"?  I know that I can pass parameters to the code invoked on the event to achieve a similar effect, but ideally I'd like to have the invoking scope available.</p>\n"},{"tags":["javascript","node.js","encryption","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13237494,"title":"mongoose how to handle password encoding nicely?","body":"<p>I want to refactor my user schema. The main reason for this decision is that I do not want to worry about password and salt generation. So I would like to move the encoding logic from the pre save handler to a setter. Unfortunately I do not have access from a setter to other properties of the object (like salt).</p>\n\n<p>So defaulting a salt does not work and encoding a password with a salt also not.</p>\n\n<p>My current implementation is:</p>\n\n<pre><code>var userSchema = new mongoose.Schema({\n\n    username: { \n        type: String, \n        index: { unique: true, sparse: true }, \n        required: true, lowercase: true, trim: true\n    },\n\n    email: {\n        type: String,\n        index: { unique: true, sparse: true }, \n        required: true, lowercase: true, trim: true\n    },\n\n    salt: {\n        type: String,\n        select: false\n    },\n\n    password: {\n        type: String,\n        select: false\n    },\n\n    plainPassword: {\n        type: String,\n        select: false\n    }\n\n});\n\n// FIXME: password encoding only on change, not always\nuserSchema.pre('save', function(next) {\n    // check if a plainPassword was set\n    if (this.plainPassword !== '') {\n        // generate salt\n        crypto.randomBytes(64, function(err, buf) {\n            if (err) return next(err);\n            this.salt = buf.toString('base64');\n            // encode password\n            crypto.pbkdf2(this.plainPassword, this.salt, 25000, 512, function(err, encodedPassword) {\n                if (err) return next(err);\n                this.password = new Buffer(encodedPassword, 'binary').toString('base64');\n                this.plainPassword = '';\n            }.bind(this));\n        }.bind(this));\n    }\n\n    next();\n});\n\n// statics\nuserSchema.methods.hasEqualPassword = function(plainPassword, cb) {\n    crypto.pbkdf2(plainPassword, this.salt, 25000, 512, function(err, encodedPassword) {\n        if (err) return next(err);\n        encodedPassword = new Buffer(encodedPassword, 'binary').toString('base64');\n        cb((this.password === encodedPassword));\n    }.bind(this));\n}\n\nmodule.exports = mongoose.model('User', userSchema, 'Users');\n</code></pre>\n\n<p>Has somebody managed to move encryption to mongoose setters?</p>\n\n<p>Regards, bodo</p>\n"},{"tags":["node.js","submit","express"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":1256,"score":2,"question_id":8624093,"title":"Node.js - submit form","body":"<p>I use node.js and express. When I press the button (btnSend), I want to send data to node.js by express (without refresh the page). How do I send data? Using jquery?</p>\n\n<p>Please help.</p>\n\n<p>Thanks for the advice.</p>\n\n<pre><code>&lt;form action=\"/Send\" method=\"post\"&gt;\nUsername: \n&lt;input type=\"text\" name=\"user\" id=\"txtUser\" /&gt;\n&lt;input type=\"submit\" value=\"Submit\" id=\"btnSend\" /&gt;\n&lt;/form&gt;\n</code></pre>\n"},{"tags":["windows","node.js","spawn"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13211706,"title":"nodejs, widows 7, spawn chrome, can't set user-data-dir","body":"<p>I'm trying to open chrome with nodejs on windows7 using spawn. It seems to work for all arguments except for setting the user-data-dir . --user-data-dir works directly from command line and also works if I call a .cmd file from node, passing the argument through it.</p>\n\n<p>Chrome opens in the background (shows in task manager) but the browser window doesn't open and I have to manually kill the process in task manager to end it.</p>\n\n<p>I get no errors or any indication of what the problem is.</p>\n\n<p>Here is my node code:</p>\n\n<pre><code>var spawn  = require('child_process').spawn;\nvar exe = 'C:\\\\Program Files\\\\Google\\\\Chrome\\\\application\\\\chrome.exe';\n\n\n//this does not work and gives no errors just starts chrome in the background but fails to open browser window\n// var args = [\n//      '--user-data-dir=C:\\\\Windows\\\\Temp\\\\testingdir',\n//      'http://www.google.com'\n//  ];\n\n//actual output from running this through a .cmd file and echoing out the arguments\n// --user-data-dir=C:\\Windows\\Temp\\testingdir http://www.google.com\n//running the above arguments through a .cmd file from nodejs or manually running them in the cli works\n\n\n\n//this works from nodejs, other arguments work too, just not the --user-data-dir argument\n// var args = ['http://www.google.com'];\n\nchrome = spawn(exe, args);\n\n\nchrome.stdout.on('data', function (data) {\n  console.log('stdout: ' + data);\n});\n\nchrome.stderr.on('data', function (data) {\n  console.log('stderr: ' + data);\n});\n\nchrome.on('exit', function (code) {\n  console.log('child process exited with code ' + code);\n  // chrome.kill();\n});\n</code></pre>\n\n<p>As you can see in the commented out code it works as long as I don't try to change the user-data-dir. I've tried different temp directories and setting full access to 'everyone' on the temp directory in case it was a permissions issue.</p>\n\n<p><strong>Update:</strong> I just updated from v0.8.1 I think to the latest v0.8.14 and now when it fails the on('exit', function()) actually returns a code.</p>\n\n<pre><code>child process exited with code 20\n</code></pre>\n\n<p>How can I look up this code to find out what it means?</p>\n\n<p><strong>Update 2</strong> The exit code 20 I think was just a one time fluke because I can't reproduce it any more. Trying to test different things is kinda buggy because I have to remember to kill the chrome processes in task manager each time to make sure I get the same results. So it's back to the same results as before, no errors but no chrome window, and some chrome processes running that have to be manually killed.</p>\n\n<p><strong>Update 3</strong>\nI just moved this script over to Ubuntu and changed the exe and args to reflect the different file structure, and it works on Ubuntu.</p>\n\n<pre><code>exe = \"/opt/google/chrome/google-chrome\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>args = [\n    \"http://www.google.com\",\n    \"--user-data-dir=/home/lotus/testdir\"\n    ];\n</code></pre>\n\n<p>So I can confirm this is specifically related to chrome on Windows.</p>\n"},{"tags":["node.js","web-applications","frameworks","resources","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13255654,"title":"best resources for long-term projects in node.js","body":"<p>Until now I've been developing in PHP. Now I'm about to begin a couple of new projects, and I think node.js would be perfect for them. I read some general (internet-oriented) guides on the language, and I can understand them with no problem, but then it seems to become all extremely messy when it comes to put it all together in a real development situation (trough the usage of the many, many available frameworks).\nThe best guides that I could find looked really dated when I tried to follow them.</p>\n\n<p>Therefore I came to ask in person if you could provide me with some recent and vaguely complete tutorials/resources on how to develop applications (both server side and client side) entirely in javascript.</p>\n\n<p>I usually tend to work only in long term (and medium to large scale) projects and therefore I would like to keep the libraries to a minimum. But I'm also not a hackery type: I like to be able to focus on the logic of the programs, and usage of frameworks is totally accepted. I just wouldn't like to be overloaded with functions that I'm never going to use (or could easily implement myself).</p>\n\n<p>Thanks a lot for your help!</p>\n"},{"tags":["javascript","node.js","ldap"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13255389,"title":"ldapjs authentification (user login setup)","body":"<p><strong>So I'm currently running node.js, which has ldapjs installed.</strong> My aim is to have a system that uses ldapjs to allow users to login with a username and password.</p>\n\n<p>I have been reading over the <a href=\"http://ldapjs.org\" rel=\"nofollow\">http://ldapjs.org</a> documentation for awhile now but am struggling to understand the whole idea of ldap and ldapjs's implementation of it.</p>\n\n<p>I currently have this from the documentation</p>\n\n<pre><code>var ldap = require('ldapjs');\n\nvar server = ldap.createServer();\n\nserver.bind('cn=root', function(req, res, next) {\n  if (req.dn.toString() !== 'cn=root' || req.credentials !== 'secret')\n    return next(new ldap.InvalidCredentialsError());\n\n  res.end();\n  return next();\n});\n\nserver.listen(1389, function() {\n  console.log('LDAP server up at: %s', server.url);\n});\n</code></pre>\n\n<p>Which allows me to run the below and successfully bind to the server.</p>\n\n<pre><code>ldapsearch -H ldap://localhost:1389 -x -D cn=root -w secret -LLL -b \"o=myhost\" objectclass=*\n</code></pre>\n\n<p>But I'm really unsure of where to go from here or even if this is the correct approach...</p>\n\n<p>The ideal setup would be to have a range of users and passwords, and on a successful ldap connection confirm the details are correct and respond with a true, or false if the username/pass was incorrect.</p>\n\n<p>Does anyone know of any good resources for finding out more about this, or better yet can suggest some basic client/server side code to give me an idea of where to go next!</p>\n\n<p>Any replies would be really appreciated.</p>\n\n<p>Many Thanks</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13254549,"title":"In Express, what does app.router do exactly?","body":"<p>When I create a sample Express application using the express binary, the bootstrap code has these lines: </p>\n\n<pre><code>...\n\nvar app = express();\n...\napp.use(app.router);\n</code></pre>\n\n<p>I didn't find much about app.router. I thought that this is the middleware that handles the routing (app.get(), app.post() etc.) rules, but these rules also get executed when I remove the app.use(app.router); line.</p>\n\n<p>So what is the exact purpuse of this middleware?</p>\n"},{"tags":["node.js","https","express"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13252230,"title":"Node.js and https configuration","body":"<p>I have a simple application that I run using node.js. Below is my server.js:</p>\n\n<pre><code>var myApp = require('./lib/myapp')\nnew myApp({\nport: 8000\n });\n</code></pre>\n\n<p>I can access the application at <a href=\"http://myserver.com:8000\" rel=\"nofollow\">http://myserver.com:8000</a></p>\n\n<p>I would like to set it up, so I can access it using <a href=\"https://myserver.com\" rel=\"nofollow\">https://myserver.com</a></p>\n\n<p>I have tried various methods answered in questions asked here, but I am unable to get it working. I think the way application is being initialized is the reason, but I am not sure about that.</p>\n\n<p>I know I can put it behind Apache, but I would like to do it using node.</p>\n\n<p>If anyone can modify this server.js for me, that would be a great help!</p>\n\n<p>Thanks</p>\n\n<p>Noman A. </p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13253546,"title":"Mongoose opens 2 connections to DB on second request","body":"<p>I'm writing a small Node to just monitor MongoDB by making a simple query via Mongoose. If something is returned, the service is deemed as available. Here is my script</p>\n\n<pre><code>var res;\nvar logPrefix = '[MongoDB]';\nvar counter = 0;\n\nvar mongoose = require('mongoose');\n// Simple schema and model for getting a companyprofiles document\nvar companyProfile = new mongoose.Schema({\n    _id: String\n});\ncompanyProfile.virtual('Id').get(function () {return this._id});\n\nfunction closeConnection() {\n    console.log('8');\n    mongoose.connection.close(function () {\n        console.log('9');\n        console.log('%s Closed connection%d', logPrefix, counter);\n    });\n}\n\nfunction connectAndCheckHealth() {\n    console.log('2');\n    mongoose.connect('mongodb://localhost:27017/testdb');\n\n    console.log('3');\n    mongoose.connection.on('error', function(err) {\n        console.log('%s Error connecting to DB:\\n%s %s', logPrefix, logPrefix, err);\n        res.send(503, 'ERR');\n    });\n\n    mongoose.connection.on('open', function() {\n        mongoose.connection.db.serverConfig.options.auto_reconnect = false;\n    });\n\n    console.log('4');\n    mongoose.connection.on('connected', checkHealth);\n\n    console.log('5');\n    mongoose.connection.on('close', function() {\n        console.log('%s Connection to MongoDB closed %d', logPrefix, counter);\n    });\n}\n\nfunction checkHealth() {\n    console.log('6');\n    cpModel = mongoose.model('companyProfile', companyProfile, 'companyprofiles');\n    cpModel.findById('spin', handleModelResponse);\n}\n\nfunction handleModelResponse(error, doc) {\n    console.log('7');\n    closeConnection();\n    console.log('10');\n    if (error !== null) {\n        console.log('11');\n        console.log('%s Error handling response from model:\\n%s %s', logPrefix, logPrefix, error);\n        res.send(503, 'ERR');\n    } else {\n        console.log('12');\n        if (doc.Id.match(/company1/)) {\n            console.log('13');\n            console.log('%s App status is ok', logPrefix);\n            res.send(200, 'OK');\n        } else {\n            console.log('14');\n            console.log('%s Couldn\\'t find the spin company profile. Found %s', logPrefix, doc.Id);\n            res.send(503, 'ERR');\n        }\n    }\n}\n\nmodule.exports = {\n    health: function(response) {\n        counter++;\n        var date = new Date();\n        console.log('%s Retrieving health from MongoDB at %s', logPrefix, date);\n        res = response;\n        console.log(mongoose.connection);\n        console.log('1');\n        connectAndCheckHealth();\n        console.log('15');\n    }\n}\n</code></pre>\n\n<p>As you can see, I've pepped the script with console.log lines with numbers to try and work out the control flow. Here's the output:</p>\n\n<pre><code>1\n2\n3\n4\n5\n15\n6\n6\n6\n7\n8\n[MongoDB] Connection to MongoDB closed 3\n[MongoDB] Connection to MongoDB closed 3\n[MongoDB] Connection to MongoDB closed 3\n9\n[MongoDB] Closed connection3\n10\n12\n13\n[MongoDB] App status is ok\n7\n8\n9\n[MongoDB] Closed connection3\n10\n12\n13\n[MongoDB] App status is ok\n\n/home/GTP/healthcheck/node_modules/mongoose/lib/utils.js:413\n        throw err;\n              ^\nError: Can't set headers after they are sent.\n</code></pre>\n\n<p>Notice that 6 appears three times (the callback after we have connected). I can't tell why we are opening multiple connections. I've turned autoconnect off and am closing the connection after every request.</p>\n\n<p>Any help would be greatly appreciated.</p>\n"},{"tags":["hash","node.js"],"answer_count":3,"favorite_count":3,"up_vote_count":27,"down_vote_count":0,"view_count":5777,"score":27,"question_id":5878682,"title":"node.js hash string?","body":"<p>I have a string that I want to hash. What's the easiest way to generate the hash in node.js?</p>\n\n<p>The hash is for versioning, not security.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","testing","mocha","zombie.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13253083,"title":"Where am I failing in writing this mocha-zombie node.js test?","body":"<p>I'm trying to setup a new node.js project (something with express and stuff). But before I get anything, I want to setup testing. Since I'm completely new to TDD with node.js, I'm having trouble setting this up.</p>\n\n<p>Can some kind soul tell me why is this little test passing? It doesn't matter if I put the correct URL, whatever. It just passes.</p>\n\n<pre><code>var assert=require('assert');\nvar Browser = require(\"zombie\");\nvar browser = new Browser();\ndescribe('Home page', function () {\n   describe ('title', function () {\n        it ('should have a title', function () {\n            browser.visit (\"http://no-such-site.com/\").\n            then(function (){\n                assert.equal(browser.text(\"title\"), \"Whatever goes here\");\n            }).\n            fail(function(err) {\n                console.log(\"Failed with error: \", error);\n            });\n        });\n   });\n});\n</code></pre>\n"},{"tags":["javascript","jquery","html","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13254029,"title":"Delete the session on browser close in nodejs","body":"<p>It is possible to delete the session in node js when the browser closes?</p>\n\n<p>I want to have the check that if the user did not select the keep me login checkbox and then closes the window. He should asked to re login.</p>\n"},{"tags":["javascript","class","node.js","events"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13244664,"title":"Is it possible for different classes to detect 'emits' from eachother in Nodejs?","body":"<p>I am struggling with what seems to be a simple concept which makes me think what I am doing can't be done.</p>\n\n<p>In nodejs, if class objectA.emits('hey there'), can class objectB.on('hey there') repsond with 'yo'?</p>\n\n<p>Object A and B have nothing to do with eachother other than they both extend EventEmitter and are in the same nodejs app.</p>\n\n<p>Sorry if this question has been asked before, I can't find it.</p>\n"},{"tags":["node.js","express","jade"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13253421,"title":"ExpressJS: How can I make Jade compilation less verbose?","body":"<p>Here's the problem: When I spin up an expressjs 3.x server, I would like to do console.log to look into certain variables. However, that output gets buried under text from Jade compiler output.</p>\n\n<p>I tried passing this option, but it didn't work:</p>\n\n<pre><code>app.set(\"view options\", {\n  compileDebug: false\n});\n</code></pre>\n\n<p>Any ideas on how I can make Jade output less info when compiling?</p>\n"},{"tags":["visual-studio","node.js","typescript","tsc"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":13250359,"title":"TypeScript, node.js development with Visual Studio 2012 express","body":"<p>How can I write, build and run a node.js app in Visual Studio? I install the TypeScript extension on VS and the node.js package. When I create new project of type TypeScript it is only able to write script for browsers only.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I want autocomplete and error handling for node.js libraries</p>\n"},{"tags":["javascript","node.js","meteor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13247790,"title":"How can I properly use Jquery ui's progress bar with Meteor?","body":"<p><a href=\"http://jqueryui.com/slider/#range\" rel=\"nofollow\">http://jqueryui.com/slider/#range</a></p>\n\n<p>So the official jquery-ui document for the slider has script below.</p>\n\n<pre><code>$(function() {\n    $( \"#slider-range\" ).slider({\n        range: true,\n        min: 0,\n        max: 500,\n        values: [ 75, 300 ],\n        slide: function( event, ui ) {\n            $( \"#amount\" ).val( \"$\" + ui.values[ 0 ] + \" - $\" + ui.values[ 1 ] );\n        }\n    });\n});\n</code></pre>\n\n<p>In Meteor, I added this script between <code>&lt;head&gt;&lt;/head&gt;</code> so that above script will be loaded as a last script.</p>\n\n<p>I also have view template like below.</p>\n\n<pre><code>&lt;template name=\"rangeBar\"&gt;\n    &lt;div id=\"slider-range\"&gt;&lt;/div&gt;\n&lt;/template&gt;\n&lt;template name=\"wrapper\"&gt;\n    &lt;input type=\"text\" id=\"amount\" /&gt;\n    {{minRangeValue}} - {{maxRangeValue}}\n    {{&gt; rangeBar}}\n&lt;/template&gt;\n</code></pre>\n\n<p>Now, I tried adding below snippet of javascript to client.js.</p>\n\n<pre><code>Template.wrapper.minRangeValue = function(){\n     return $(\"#slider-range\").slider(\"values\",0);\n}\n</code></pre>\n\n<p>But it fails because client.js gets loaded before jquery-ui.js. </p>\n\n<p>So I tried adding above code inside of $(function(){ }); block, but got no luck.</p>\n\n<p>So my first question is, <strong>how can I property catch 'slide' events in Meteor way?</strong></p>\n\n<pre><code>$(function() {\n    $( \"#slider-range\" ).slider({\n        slide: function( event, ui ) {\n            $( \"#amount\" ).val( \"$\" + ui.values[ 0 ] + \" - $\" + ui.values[ 1 ] );         \n        }\n    });\n})\n</code></pre>\n\n<p>The temporary solution that I came up with is using the Session like below,</p>\n\n<pre><code>$(function() {\n    $( \"#slider-range\" ).slider({\n        slide: function( event, ui ) {\n            Session.set(\"minRange\",ui.values[0]\");\n            Session.set(\"maxRange\",ui.values[1]\");\n        }\n    });\n})\n</code></pre>\n\n<p>and then using below snippet of code to get value.</p>\n\n<pre><code>Template.wrapper.minRangeValue = function(){\n    return Session.get(\"minRange\")\n};\n</code></pre>\n\n<p>but I am worried little bit about calling <code>Session.set()</code> so many times while the user slides the bar, which just seem not right. <strong>Is it okay to numerously call Session.get, and Session.set?</strong></p>\n\n<p>And here is my last question.</p>\n\n<p>If I use <code>Session.set()</code> solution like above, the range bar disappears as soon as I move the bar. <strong>Is it because I did not property called <code>.slider</code> to the $(\"#slider-range\") element in a Meteor way? Should I use something like Template.myTemplate.rendered?</strong> </p>\n"},{"tags":["mongodb","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1020,"score":2,"question_id":7954381,"title":"MongoDB + Node.js: unable to insert date properly","body":"<p>I′ve been using <a href=\"https://github.com/guileen/node-mongoskin\" rel=\"nofollow\">node-mongoskin</a> to connect this two. Everything was ok until I queried some \"date\" field which I think should be returned as javascript′s <code>Date</code> object. But result′s type was string, which is odd (for me) and inconvenient.</p>\n\n<p>Inserting looks something like this:</p>\n\n<pre><code>var doc = {\n  date: new Date(),\n  info: 'Some info'\n}\ndb.users.insert( doc, {safe: true}, function(err, res) {\n  ...\n});\n</code></pre>\n\n<p>And result of above is (without <code>_id</code> field):</p>\n\n<pre><code>{ \"date\" : \"Mon Oct 24 2011 18:00:57 GMT+0400 (MSK)\", \"info\": \"Some info\" }\n</code></pre>\n\n<p>However, inserting with MongoDB Shell works just fine, except type of field is <code>ISODate</code></p>\n\n<pre><code>&gt; db.things.insert({ date: new Date() }); db.things.find();\n{ \"_id\" : ObjectId(\"4eae9f2a34067b92db8deb40\"), \"date\" : ISODate(\"2011-10-31T13:14:18.947Z\") }\n</code></pre>\n\n<p>So, the question is: how should I insert documents to query date fields as <code>Date</code> object? What I want is setting fields on database-server-side. I just send something like null-fields, and db-server setting those for me using default mongo′s mechanisms.</p>\n\n<p>Inserting timestamps (as <a href=\"http://www.mongodb.org/display/DOCS/Timestamp+data+type\" rel=\"nofollow\">native MongoDB timestamp</a>) is also a problem, but it′s not such a big deal.</p>\n\n<p>PS: No luck going through mongoskin and <a href=\"https://github.com/christkv/node-mongodb-native/\" rel=\"nofollow\">mongodb-native</a> docs.</p>\n"},{"tags":["javascript","node.js","architecture","game"],"answer_count":0,"favorite_count":3,"up_vote_count":3,"down_vote_count":2,"view_count":51,"score":1,"question_id":13252063,"title":"Web game architecture","body":"<p>I am working on a web based game in JS (typescript), with a node.js server and AJAX. I know very little of game based architecture, and as the game grows, it becomes more and more complicated which made me think of rebuilding it with a proper architecture. What tuts/books should I read about architecture, knowing that a web-based game with strong logic on both client and server side requires a somewhat specific knoweldge ? Thank you for your help</p>\n"},{"tags":["node.js","express.js","jade"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":443,"score":0,"question_id":7380199,"title":"How to embed content in jade","body":"<p>I'm currently experimenting with jade template engine. I've got the follow basic code in my layout.jade file:</p>\n\n<pre><code>!!! 5\nhtml\n  head\n    title= title\n    link(rel='stylesheet', href='/stylesheets/style.css')\n  body!= body\n    header != partial('partials/head')  \n    'dependant page content to go here'\n    footer != partial('partials/foot')  \n</code></pre>\n\n<p>I'd like every page to follow this same structure (for now). However I would like the content to change, and the content should be depended on what is inside the 'pagename'.jade files e.g. index.jade:</p>\n\n<pre><code>section#page-content\n  h1= title\n  p Welcome to #{title}\n</code></pre>\n\n<p>What i'm trying to say is, upon a new page loading.. the content tag in layout should somehow be replaced by the appropriate tag of the page being loaded.</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":27,"score":-2,"question_id":13250763,"title":"Node.js mulitple rooms application","body":"<p>I am in the process of developing a multi room application using node.js. I have some concerns about scalability.</p>\n\n<p>The application should work like it follows. The user enters the site and then he can enter any available room or he can create a new room in which other users can enter. These rooms will not be only for chat. There is some logic that has to be implemented when the users are in the room. Also users can do some action which has to be processed correctly. </p>\n\n<p>I was wondering what would be the best way to proceed. So far I have two option.</p>\n\n<p>Create a new process for every newly created room and do logic in that process.\n//with an increase on rooms there would be a lot of processes</p>\n\n<p>or do something similar to this</p>\n\n<pre><code>on 'connection'\nsocket.username = username;\nusers[username]=username;\nsocket.room = room;\n\n\non 'action1'\nio.sockets.in(socket.room)//do something\n\non 'action2' \nio.sockets.in(socket.room) //do something else\nio.sockets.in(socket.room).emit(result of the action)\n</code></pre>\n\n<p>As you see I will be using sockets.</p>\n\n<p>I cant decide which option to choose. Any help would be appreciated.Thank you </p>\n"},{"tags":["node.js","build","dojo"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13231168,"title":"How to do a dojo build using nodejs?","body":"<p>I'm currently using the dojotoolkit and its build system.\nI read the new build tutorial for 1.8 at <a href=\"http://dojotoolkit.org/documentation/tutorials/1.8/build/\" rel=\"nofollow\">http://dojotoolkit.org/documentation/tutorials/1.8/build/</a>.\nIn the tutorial it mentions that you can speed up your build by using nodejs.</p>\n\n<blockquote>\n  <p>The build tool itself relies on Java (and, optionally, Node.js for even faster builds), so make sure that have you that installed as well.</p>\n</blockquote>\n\n<p>But it fails to mention how to do this. Anyone know how this works?</p>\n"},{"tags":["node.js","testing","mocha","should.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13246798,"title":"Mocha runs correctly, but shows undefined","body":"<p>I use <code>mocha</code> to test my nodejs code, and the test runs just ok, but when I use <code>mocha test.js</code> to run test, it seems that the string I passed to <code>describe</code> does not show.</p>\n\n<p>The code is as follows:</p>\n\n<pre><code>var assert = require(\"should\");\ndescribe(\"FrontEndTest\", function(){\n    describe('websocket establish connection', function(){\n        it('should establish connection correctly', function(done){\n            var res;\n            var wsClient = create_ws_client('ws://127.0.0.1:9876','brain_burst');\n            wsClient.on('connect', function(connection){\n                res = true;\n                res.should.be.true;\n                done();\n            });\n            wsClient.on('connectFailed', function(error){\n                res = false;\n                res.should.be.true;\n                done();\n            });\n            console.log(res);\n        });\n        it('should disconnected by server.(also, that may crash server if there is not a protocol validation)', function(done){\n            var res;\n            var wsClient = create_ws_client('ws://127.0.0.1:9876');\n            wsClient.on('connect', function(connection){\n                res = true;\n                res.should.be.false;\n                done();\n            });\n            wsClient.on('connectFailed', function(error){\n                res = false;\n                res.should.be.false;\n                done();\n            });\n        });\n    });\n});\n</code></pre>\n\n<p>The result of <code>mocha</code> command shows:</p>\n\n<blockquote>\n  <p>undefined ․․</p>\n  \n  <p>✔ 2 tests complete (68 ms)</p>\n</blockquote>\n\n<p>Why it shows <code>undefined</code> since I already pass a string?</p>\n"},{"tags":["node.js","express","connect"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12829258,"title":"how to access http.Server.connection property in express 3 router?","body":"<p>I would like to use http.Server.connections in my express 3 route?\nIs there no way to get it anymore?</p>\n\n<p>Should I just \n   app.set('server', server);</p>\n\n<p>express.createServer() is deprecated and express applications no longer inherit from http.Server</p>\n\n<pre><code>var app = express(),\nserver = http.createServer(app);\nserver.listen(8080);\n...\nmodule.exports = function (app) {\n\n    app.get('/connections', function (req, res) {\n        res.send({\n            connections: app.connections \n            // app != http.Server in express 3\n        });\n    });\n\n};\n</code></pre>\n"},{"tags":["apache","node.js","nginx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13249427,"title":"How can I use apache or nginx as frontend for a node app?","body":"<p>I'm trying to develop a <strong>Node.js</strong> web application, but my production environment-to-be is already hosting <strong>Apache/2.2.22</strong>. So I can't have Node use port 80, and I don't want my users to have to go to <a href=\"http://myapp.com:4000/\" rel=\"nofollow\">http://myapp.com:4000/</a>.</p>\n\n<p>Is there an apache module that does this, perhaps like mod_jk does this for Tomcat?</p>\n\n<p>The same question goes for <strong>nginx</strong>.</p>\n"},{"tags":["node.js","base64","encode"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":336,"score":0,"question_id":11280063,"title":"get image from another domain and encode base64 by node js","body":"<p>I want get a image from url and encode base64 that image by nodejs, then show that image by base64 encode, but this code is incorrect.\nthis code save incorrect png file. </p>\n\n<pre><code>var http = require('http')\n  , fs = require('fs')\n  , options\n\noptions = {\n    host: 'google.com'\n  , port: 80\n  , path: '/images/srpr/logo3w.png'\n}\n\nfunction base64_encode(bitmap) {  \n    return new Buffer(bitmap).toString('base64');\n}\n\nfunction ImageReady(res2){\n    var request = http.get(options, function(res){\n        var imagedata = '';\n        res.setEncoding('binary');\n\n        res.on('data', function(chunk){\n            imagedata += chunk;\n        })\n\n        res.on('end', function(){\n            var base64encode = base64_encode(imagedata);\n            res2.end('&lt;img src=\"data:image/png;base64,'+base64encode+'\" /&gt;');\n            fs.writeFile('logo.png', imagedata, 'binary', function(err){\n            if (err) throw err\n            console.log('File saved.')\n        })\n        })\n\n    })\n}\n\nvar httpListen = require('http');\nhttpListen.createServer(function (req, res) {\n    res.writeHead(200, {'Content-Type': 'text/html'});\n    ImageReady(res);\n}).listen(8080);\nconsole.log('Server running!');\n</code></pre>\n"},{"tags":["node.js","dropbox","dropbox-api"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13244569,"title":"node.js dropbox OAuth","body":"<p>I'm having some trouble understanding the Dropbox JS api for node.js</p>\n\n<p>after I create an authDriver, how do I route my client to a dropbox access dialog? Suppose they get a route '/applogin' that my express app handles, how do I pass the client to dropbox?</p>\n\n<p>Thanks!</p>\n\n<pre><code>    var Dropbox = require(\"dropbox\");\n    var client = new Dropbox.client({\n        key: \"mykey\", secret: \"mysecret\", sandbox: true\n    });\n    client.authDriver(new Dropbox.Drivers.NodeServer(8081));\n//what comes next?\n</code></pre>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12229364,"title":"socket.io binary support documnetation","body":"<p>Can anyone point me to any sort of documentation for how to implement binary on socket.io? Its listed that they have added the support a few months ago, but i cant find any documentation for it.</p>\n"},{"tags":["node.js","express","socket.io","rabbitmq","amqp"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":115,"score":2,"question_id":13071734,"title":"Express + Socket.IO + RabbitMQ (node-amqp)","body":"<p>I'm having a hard time putting all these three together, probably because I'm not getting properly the concept of routing with Express.</p>\n\n<p>I have a RabbitMQ queue with event updates. We can recognize these events by their id. So I want to get on a given page about an event, just the updates corresponding to its id.</p>\n\n<p>Queue: 1316, 1539, 3486, 3479, 1316, 3890, 3479, ... -> Feed from the DB indefinitely.\nwww.example.com/event/1316 -> Gets from the queue just messages with id 1316\nwww.example.com/event/3479 -> Gets from the queue just messages with id 3479</p>\n\n<p>My code works good when I load the first event, but when I load the second one in a different window, it gets messages from both events, and if I load a third one, guess right, it gets messages from the three ids.</p>\n\n<p><strong>app.js</strong></p>\n\n<pre><code>var express = require('express')  \n, http = require('http');\nvar app = express();\nvar server = http.createServer(app);\nvar io = require('socket.io').listen(server, { log: false });\nrequire('./io')(io);\n\nvar amqp = require('amqp');\nvar rabbitMQ = amqp.createConnection({ host: 'localhost' });\n\nrabbitMQ.on('ready', function() {\n  console.log('Connected to RabbitMQ');\n  io.sockets.on('connection', function (socket) {\n    console.log('Socket connected: ' + socket.id);\n    rabbitMQ.queue('offer', { autoDelete: false, durable: false, exclusive: false }, function(q) {    \n      q.bind('#'); // Catch all messages    \n      q.subscribe(function (message) {\n        obj = JSON.parse(message.data.toString());\n        //socket.broadcast.to(obj.id).emit('message', obj);\n        io.sockets.in(obj.id).emit('message', obj);\n      });\n    });\n  });\n});\n\nvar routes = require('./routes')\n, event = require('./routes/event');\n\napp.get('/', routes.index);\napp.get('/event/:id', event.index);\n\nserver.listen(app.get('port'), function(){\n  console.log(\"Express server listening on port \" + app.get('port'));\n});\n</code></pre>\n\n<p><strong>io.js</strong></p>\n\n<pre><code>var socketio = function (io) { \n  if (!io) return socketio._io;  \n  socketio._io = io;\n} \n\nmodule.exports = socketio;\n</code></pre>\n\n<p><strong>routes/event.js</strong></p>\n\n<pre><code>var io = require('../io')();\n\nexports.index = function(req, res) {\n  io.sockets.on('connection', function (socket) {\n    socket.join(req.params.id);\n  });\n  res.render('event', { title: 'Event' });\n};\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":12228274,"title":"socket.io streaming binary data","body":"<p>I have just started using node.js, I'm running a node server with sockets.io and i need to send a buffer of bytes to the client.</p>\n\n<p>I understand that this can be done by first translating the byte buffer to base64 and sending that, then translating it back on the client side. but i was wondering if there is a more elegant way of getting the byte stream to the client. </p>\n"},{"tags":["node.js","railway.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11870322,"title":"Updating DB Fields in RailwayJS upon Create and Update","body":"<p>I'm new to RailwayJS (but not Rails) and I had a question about the <em>best</em> way to save my <code>created_at</code> field on Create, and <code>updated_at</code> field on Update.</p>\n\n<p>This is my model (db/schema.js):</p>\n\n<pre><code>var Post = define('Post', function() {\n    property('title', String);\n    property('content', Text);\n    property('desc', String);\n    property('created_at', Date);\n    property('updated_at', Date);\n});\n</code></pre>\n\n<p>So in my <code>posts_controller.js</code>, I'm setting the \"created_at\" field before the <code>create</code> method:</p>\n\n<pre><code>action(function create() {\n    req.body.Post.created_at = new Date;\n    Post.create(req.body.Post, function (err, post) {\n      // Handle error or do stuff\n    });\n});\n</code></pre>\n\n<p>...and I'm pretty much doing the same for the <code>update</code> method:</p>\n\n<pre><code>action(function update() {\n    body.Post.updated_at = new Date;\n    this.post.updateAttributes(body.Post, function (err) {\n      // Handle error or do stuff\n    }.bind(this));\n});\n</code></pre>\n\n<p>Couldn't (shouldn't) this be done in a before filter in my model? If so, how?</p>\n"},{"tags":["javascript","facebook","node.js","coffeescript"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13225584,"title":"Node.js hostname/IP doesnt match certificates altnames","body":"<p>I'm writing some node code to do a server side login to Facebook.  I'm pretty close to having it completely functioning, but I am having troubles requesting the auth_code.\nI'm thinking it might have something to do with the facebook app setting <code>Site URL</code> but nothing I've tried has worked.\nI'm using node version 0.8.14.</p>\n\n<p>Here is the code I do my request in:</p>\n\n<pre><code>options =\n    host: 'graph.facebook.com'\n    port: 443\n    path: \"/oauth/access_token?\" + qs.stringify(\n        client_id:     app_id\n        redirect_uri:  my_url\n        client_secret: app_secret\n        code:          vars.code)\n\nhttps.get(options, (face_res)-&gt;\n    console.log face_res\n)\n</code></pre>\n\n<p>In the <code>face_res</code> I get a couple of objects like this:</p>\n\n<pre><code>authorizationError: 'Hostname/IP doesn\\'t match certificate\\'s altnames'\n</code></pre>\n\n<p>Any help is greatly appreciated</p>\n"},{"tags":["node.js","paypal","paypal-adaptive-payments"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13231642,"title":"Trouble with PayPal Adaptive Payments in Node.js","body":"<p>I cannot for the life of me figure out what's going on.  I'm just trying to do a basic call to PayPal's Adaptive Payments API, the <code>Pay</code> call specifically.  I'm trying to achieve this with node.js.  I can make successful calls with <code>curl</code>, but node simply refuses to work.  I keep getting a <code>'Invalid request: {0}'</code> error message, errorId <code>580001</code>.  I've searched for a long time for a solution, and although many people have had seemingly similar issues, their problems were different from mine, and so their solutions haven't worked.  </p>\n\n<p>Any help you can offer is <strong>MUCH</strong> appreciated.</p>\n\n<p>Here is the response I keep getting (prettified):</p>\n\n<pre><code>{ responseEnvelope: \n   { timestamp: '2012-11-05T03:50:08.216-08:00',\n     ack: 'Failure',\n     correlationId: 'b1dbb6fea8378',\n     build: '4110101' },\n  error: \n   [ { errorId: '580001',\n       domain: 'PLATFORM',\n       subdomain: 'Application',\n       severity: 'Error',\n       category: 'Application',\n       message: 'Invalid request: {0}' } ] }\n</code></pre>\n\n<p>Here's my node code: (Note: I'm using the <code>request</code> module: <a href=\"https://github.com/mikeal/request\" rel=\"nofollow\">https://github.com/mikeal/request</a>)</p>\n\n<pre><code>request = require 'request'\n\nbody = JSON.stringify\n\n  actionType: \"PAY\"\n  senderEmail: \"happy_1349101075_biz@onehappystudent.com\"\n  receiverList:\n    receiver: [\n      email: \"luke_1346604373_biz@onehappystudent.com\"\n      amount: \"1.00\"\n    ]\n  currencyCode: \"USD\"\n  feesPayer: \"EACHRECEIVER\"\n  memo: \"This is a test\"\n  cancelUrl: \"http://cancelurl\"\n  returnUrl: \"http://returnUrl\"\n  ipnNotificationUrl: \"http://your_ipn_notification_url\"\n  requestEnvelope:\n    errorLanguage: \"en_US\"\n\nconsole.log body\n\nconsole.log request\n\n  url: 'https://svcs.sandbox.paypal.com/AdaptivePayments/Pay'\n\n  headers:\n    \"X-PAYPAL-SECURITY-USERID\": \"happy_1349101075_biz_api1.onehappystudent.com\"\n    \"X-PAYPAL-SECURITY-PASSWORD\": \"1349101103\"\n    \"X-PAYPAL-SECURITY-SIGNATURE\": \"AFcWxV21C7fd0v3bYYYRCpSSRl31Avw12OuF33eJo9IbQpXMS6wrOp1.\"\n\n    \"X-PAYPAL-REQUEST-DATA-FORMAT\": \"JSON\"\n    \"X-PAYPAL-RESPONSE-DATA-FORMAT\": \"JSON\"\n\n    \"X-PAYPAL-APPLICATION-ID\": \"APP-80W284485P519543T\"\n\n    \"Content-Type\": \"application/json\"\n\n  body: body\n\n, (err, res, bod) -&gt;\n\n  console.log bod\n</code></pre>\n\n<p>Here's the output from running the above code:</p>\n\n<pre><code>{\"actionType\":\"PAY\",\"senderEmail\":\"happy_1349101075_biz@onehappystudent.com\",\"receiverList\":{\"receiver\":[{\"email\":\"luke_1346604373_biz@onehappystudent.com\",\"amount\":\"1.00\"}]},\"currencyCode\":\"USD\",\"feesPayer\":\"EACHRECEIVER\",\"memo\":\"This is a test\",\"cancelUrl\":\"http://cancelurl\",\"returnUrl\":\"http://returnUrl\",\"ipnNotificationUrl\":\"http://your_ipn_notification_url\",\"requestEnvelope\":{\"errorLanguage\":\"en_US\"}}\n{ readable: true,\n  writable: true,\n  headers: \n   { 'X-PAYPAL-SECURITY-USERID': 'happy_1349101075_biz_api1.onehappystudent.com',\n     'X-PAYPAL-SECURITY-PASSWORD': '1349101103',\n     'X-PAYPAL-SECURITY-SIGNATURE': 'AFcWxV21C7fd0v3bYYYRCpSSRl31Avw12OuF33eJo9IbQpXMS6wrOp1.',\n     'X-PAYPAL-REQUEST-DATA-FORMAT': 'JSON',\n     'X-PAYPAL-RESPONSE-DATA-FORMAT': 'JSON',\n     'X-PAYPAL-APPLICATION-ID': 'APP-80W284485P519543T',\n     'Content-Type': 'application/json',\n     host: 'svcs.sandbox.paypal.com',\n     'content-length': 409 },\n  body: &lt;Buffer 7b 22 61 63 74 69 6f 6e 54 79 70 65 22 3a 22 50 41 59 22 2c 22 73 65 6e 64 65 72 45 6d 61 69 6c 22 3a 22 68 61 70 70 79 5f 31 33 34 39 31 30 31 30 37 35 ...&gt;,\n  callback: [Function],\n  pool: {},\n  dests: [],\n  __isRequestRequest: true,\n  _callback: [Function],\n  _events: \n   { error: [Function],\n     complete: [Function],\n     pipe: { [Function: g] listener: [Function] } },\n  uri: \n   { protocol: 'https:',\n     slashes: true,\n     host: 'svcs.sandbox.paypal.com',\n     hostname: 'svcs.sandbox.paypal.com',\n     href: 'https://svcs.sandbox.paypal.com/AdaptivePayments/Pay',\n     pathname: '/AdaptivePayments/Pay',\n     path: '/AdaptivePayments/Pay',\n     port: 443 },\n  _redirectsFollowed: 0,\n  maxRedirects: 10,\n  followRedirect: true,\n  followAllRedirects: false,\n  redirects: [],\n  setHost: true,\n  originalCookieHeader: undefined,\n  _jar: undefined,\n  port: 443,\n  host: 'svcs.sandbox.paypal.com',\n  clientErrorHandler: [Function],\n  _parserErrorHandler: [Function],\n  path: '/AdaptivePayments/Pay',\n  httpModule: \n   { Server: { [Function: Server] super_: [Object] },\n     createServer: [Function],\n     globalAgent: \n      { options: {},\n        requests: {},\n        sockets: {},\n        maxSockets: 5,\n        _events: [Object],\n        createConnection: [Function: createConnection] },\n     Agent: { [Function: Agent] super_: [Object] },\n     request: [Function],\n     get: [Function] },\n  agentClass: \n   { [Function: Agent]\n     super_: { [Function: Agent] super_: [Function: EventEmitter], defaultMaxSockets: 5 } },\n  agent: \n   { options: {},\n     requests: {},\n     sockets: {},\n     maxSockets: 5,\n     _events: { free: [Function] },\n     createConnection: [Function: createConnection] } }\n{\"responseEnvelope\":{\"timestamp\":\"2012-11-05T03:50:08.216-08:00\",\"ack\":\"Failure\",\"correlationId\":\"b1dbb6fea8378\",\"build\":\"4110101\"},\"error\":[{\"errorId\":\"580001\",\"domain\":\"PLATFORM\",\"subdomain\":\"Application\",\"severity\":\"Error\",\"category\":\"Application\",\"message\":\"Invalid request: {0}\"}]}\n</code></pre>\n\n<p>Here's the successful <code>curl</code>:</p>\n\n<pre><code>curl -s --insecure \\\n-H \"X-PAYPAL-SECURITY-USERID: happy_1349101075_biz_api1.onehappystudent.com\" \\\n-H \"X-PAYPAL-SECURITY-PASSWORD: 1349101103\" \\\n-H \"X-PAYPAL-SECURITY-SIGNATURE: AFcWxV21C7fd0v3bYYYRCpSSRl31Avw12OuF33eJo9IbQpXMS6wrOp1.\" \\\n-H \"X-PAYPAL-REQUEST-DATA-FORMAT: JSON\" \\\n-H \"X-PAYPAL-RESPONSE-DATA-FORMAT: JSON\" \\\n-H \"X-PAYPAL-APPLICATION-ID: APP-80W284485P519543T\" \\\n-H \"host: svcs.sandbox.paypal.com\" \\\nhttps://svcs.sandbox.paypal.com/AdaptivePayments/Pay -d '{\n  \"actionType\":\"PAY\",\n  \"senderEmail\":\"happy_1349101075_biz@onehappystudent.com\",\n  \"receiverList\":{\n    \"receiver\":[{\n      \"email\":\"luke_1346604373_biz@onehappystudent.com\",\n      \"amount\":\"1.00\"\n    }]\n  },\n  \"currencyCode\":\"USD\",\n  \"feesPayer\":\"EACHRECEIVER\",\n  \"memo\":\"This is a test\",\n  \"cancelUrl\":\"http://cancelurl\",\n  \"returnUrl\":\"http://returnUrl\",\n  \"ipnNotificationUrl\":\"http://your_ipn_notification_url\",\n  \"requestEnvelope\":{\n    \"errorLanguage\":\"en_US\"\n  }\n}'\n</code></pre>\n\n<p>And here's the response: (prettified for your convenience)</p>\n\n<pre><code>{ responseEnvelope: \n   { timestamp: '2012-11-05T03:40:10.613-08:00',\n     ack: 'Success',\n     correlationId: 'abaf5b13c5515',\n     build: '4110101' },\n  payKey: 'AP-4B1870921M506553S',\n  paymentExecStatus: 'COMPLETED' }\n</code></pre>\n\n<p>Again, any help you can offer is <strong>MUCH</strong> appreciated.</p>\n"},{"tags":["javascript","arrays","node.js","get"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13245487,"title":"Node.js convert get data into array","body":"<p>I am receiving data as such from URL.The URL is </p>\n\n<pre><code>data=%5B1%2C2%2C3%2C4%2C0%5D\n</code></pre>\n\n<p>which decodes to <code>[1,2,3,4,0]</code>.</p>\n\n<p>I have parsed this data using the below snippet</p>\n\n<pre><code>var queryObj = querystring.parse( theUrl.query );\n</code></pre>\n\n<p>But I think its not an array.How do I convert it into array.I have used <code>toArray()</code>method but in vain.Thankx in advance.</p>\n"},{"tags":["asynchronous","mongodb","node.js"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1530,"score":2,"question_id":5807838,"title":"async nodejs querying and processing results","body":"<p>I have an array of objects taken from mongodb. Every element in the array is a post, with author as user_id. Now i wish to find the user info related to the user_id.</p>\n\n<p>Since node uses async methods to find the data from db, the forEach loop finishes before the callbacks finish.</p>\n\n<pre><code>docs.forEach(function(doc, index){\n        //get the user for this doc\n        User.find({_id: mongo.BSONPure.ObjectID(doc.user_id)}, {name: 1, username: 1, email: 1}).skip(0).limit(1).toArray(function(err, user){\n            user = user[0]\n            if(err) {\n                throw new Error(err)\n            } else {\n                docs[index].user = user\n                if(doc.for_id) {\n                    User.find({_id: mongo.BSONPure.ObjectID(doc.for_id)}, {name: 1, username: 1, email: 1}).skip(0).limit(1).toArray(function(err, for_user){\n                        for_user = for_user[0]\n                        if(err) {\n                            throw new Error(err)\n                        } else {\n                            docs[index].for_user = for_user\n                        }\n                    })\n                }\n            }\n        })\n    })\n</code></pre>\n\n<p>So at the end of this loop, if i send a cb(docs), docs do not have the user and for_user attribute. How do I overcome this?</p>\n"},{"tags":["mongodb","node.js","express","mongoose"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":5542,"score":6,"question_id":6180896,"title":"How to return Mongoose results from the find method?","body":"<p>Everything I can find for rending a page with mongoose results says to do it like this:</p>\n\n<pre><code>users.find({}, function(err, docs){\n    res.render('profile/profile', {\n        users:     docs\n    });\n});\n</code></pre>\n\n<p>How could I return the results from the query, more like this?</p>\n\n<pre><code>var a_users = users.find({}); //non-working example\n</code></pre>\n\n<p>So that I could get multiple results to publish on the page?</p>\n\n<p>like:</p>\n\n<pre><code>/* non working example */\nvar a_users    = users.find({});\nvar a_articles = articles.find({});\n\nres.render('profile/profile', {\n      users:    a_users\n    , articles: a_articles\n});\n</code></pre>\n\n<p>Can this be done?</p>\n"},{"tags":["node.js","dart"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13239996,"title":"NodeJs http.get for Dart","body":"<p>In Node.js I can do: </p>\n\n<pre><code>var http = require('http')\n\nvar url = 'mylinkedsite.com'\nhttp.get({ host: url }, function(){...})\n</code></pre>\n\n<p>In Dart I'm trying the same:</p>\n\n<pre><code>import 'dart:io';\nimport 'dart:uri';\n\nvar url = 'mylinkedsite.com';        \nvar client = new HttpClient();\nvar uri = new Uri.fromString(url);\nvar connection = client.getUrl(uri);\nconnection.onResponse = (res){...};\n</code></pre>\n\n<p>But I am unable to get the same result without the url.scheme and url.path explicitly added. Both of which are final. What's the simplest way to accomplish the same result.</p>\n"},{"tags":["node.js","express","mongoose"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13243507,"title":"rendering results of multiple DB/mongoose queries to a view in express.js","body":"<p>given the async nature of mongoose (or sequelize, or redis) queries, what do you do when you have multiple queries you need to make before rendering the view?</p>\n\n<p>For instance, you have a <code>user_id</code> in a session, and want to retrieve some info about that particular user via <code>findOne</code>. But you also want to display a list of recently logged in users.</p>\n\n<pre><code>exports.index = function (req, res) {\n    var current_user = null\n\n    Player.find({last_logged_in : today()}).exec(function(err, players) {\n        if (err) return res.render('500');\n\n        if (req.session.user_id) {\n            Player.findOne({_id : req.session.user_id}).exec(function(err, player) {\n                if (err) return;\n                if (player) {\n                    current_user = player\n                }\n            })\n        }\n\n        // here, current_user isn't populated until the callback fires \n        res.render('game/index', { title: 'Battle!',\n                   players: players,\n                   game_is_full: (players.length &gt;= 6),\n                   current_user: current_user\n        });\n    });\n};\n</code></pre>\n\n<p>So <code>res.render</code> is in the first query callback, fine. But what about waiting on the response from <code>findOne</code> to see if we know this user? It is only called conditionally, so I can't put <code>render</code> inside the inner callback, unless I duplicate it for either condition. Not pretty.</p>\n\n<p>I can think of some workarounds -</p>\n\n<ul>\n<li><p>make it <em>really</em> async and use AJAX on the client side to get the current user's profile. But this seems like more work than it's worth.</p></li>\n<li><p>use <code>Q</code> and promises to wait on the resolution of the <code>findOne</code> query before rendering. But in a way, this would be like forcing blocking to make the response wait on my operation. Doesn't seem right.</p></li>\n<li><p>use a middleware function to get the current user info. This seems cleaner, makes the query reusable. However I'm not sure how to go about it or if it would still manifest the same problem.</p></li>\n</ul>\n\n<p>Of course, in a more extreme case, if you have a dozen queries to make, things might get ugly. So, what is the usual pattern given this type of requirement?</p>\n"},{"tags":["node.js","azure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13240514,"title":"How to write to a tmp/temp directory in Windows Azure website","body":"<p>How would I write to a tmp/temp directory in windows azure website?  I can write to a blob, but i'm using an NPM that requires me to give it file names so that it can directly write to those filenames.</p>\n"},{"tags":["node.js","socket.io","broadcast"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13232870,"title":"Node.JS and Socket.io - Broadcast returns to sender","body":"<p>I am building a real-time web-application with multiple clients and a node.js server to handle state and broadcast event changes from clients. I have implemented Socket.io as transport mechanism between clients and server. When a client performs a specific action an event this is send to the server, which is broadcasted to other clients on the network. </p>\n\n<p>However, <em>sometimes</em> when an array of events is recieved by the server, the server doesn't broadcast it but instead sends it back to the sending client - or sends it to all connected sockets including the sending client.</p>\n\n<p>Here is a snippet of the server implementation, which basically listens for client events, collects them in an array which is broadcasted every 2 seconds.</p>\n\n<p>If you want, I can include relevant snippets from the client implementation. </p>\n\n<pre><code>// Require HTTP module (to start server) and Socket.IO\nvar http = require('http'), io = require('socket.io'), users = require('./users');\n\n// Commands to client\nvar USER_LOGIN = 0,\n    USER_LIST = 1,\n    USER_CONNECTED = 2,\n    USER_DISCONNECTED = 3,\n    COMMAND = 4,\n    COMMAND_SETNICKNAME = 0,\n    COMMAND_POSITION = 1,\n    COMMAND_MOUSEDOWN = 2,\n\nvar array = [];\nvar activeUsers = {};\n\n\n// Start the server at port 8080\nvar server = http.createServer(function(req, res){ \n    res.writeHead(200,{ 'Content-Type': 'text/html' }); \n});\nserver.listen(8080);\n\n// Create a Socket.IO instance, passing it our server\nvar io = io.listen(server);\n\n// Add a connect listener\nio.sockets.on('connection', function(client){ \n    console.log(\"started\");\n\n\n    // Create periodical which ends a JSON message to the client every 2 seconds\n    var interval = setInterval(function() {\n        if(array.length &gt;0) {\n            console.log(\"Sending to clients \" + array);\n        //client.send(JSON.stringify(array));\n        client.broadcast.send(JSON.stringify(array));\n        array = [];\n    }\n},2000);\n\n// Success!  Now listen to messages to be received\nclient.on('message',function(event){ \n        console.log(\"--Reading event \" + event);\n        var eventArray = JSON.parse(event);\n    for(var i = 0; i &lt; eventArray.length; i++) {\n        var dataArray = eventArray[i];\n        var userId = parseInt(dataArray[0]);\n        var position = 1;\n\n        console.log(\"current element in array \" + dataArray);\n\n        switch (parseInt(dataArray[position++])) {\n            case USER_LOGIN: \n                // Log in user with USERID. \n                var username = dataArray[position++];\n                console.log(\"Attempting to log in with user \" + username);\n\n                // If valid, send USER_LOGIN broadcast to clients\n                if(login(username)) {\n                    array.push([0, USER_LOGIN, login(username)]);\n                }\n                break;\n</code></pre>\n"},{"tags":["javascript","arrays","node.js","sorting","underscore.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13199251,"title":"How can I sort an array of integers, integer-letter combos, and ranges in Javascript?","body":"<p>I have a strange array that I need to sort in a certain way, and I'm not sure if it's doable without a lot of manual labor.</p>\n\n<p>Consider the array: <code>[ '1a', '2a', '2aa', '5-6', '1', '2', '3', '20' , '7', '8']</code></p>\n\n<p>It's an array of strings. Sorted properly, it would look like:</p>\n\n<p><code>[ '1', '1a', '2', '2a', '2aa', '3', '5-6', '7', '8', '20' ]</code></p>\n\n<p>Think of it like an outline numbering system of sorts.</p>\n\n<p>How can I sort in that order?</p>\n\n<p>Here's a jsfiddle showing how a regular sort treats it with its default lexicographical behavior (it's actually pretty close to what it needs to be):</p>\n\n<p><a href=\"http://jsfiddle.net/qkE9m/\" rel=\"nofollow\">http://jsfiddle.net/qkE9m/</a></p>\n\n<p>I am working in node.js and have underscore.js at my disposal.</p>\n"},{"tags":["node.js","npm","single-page-application"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":55,"score":-4,"question_id":13243166,"title":"How do I create a perfect single page application in Node.js?","body":"<p>This question is a fictitious tutorial for creating a single page application on the Node.js platform.  I will accept the answer that identifies the stack that will help me accomplish this as painlessly as possible.  I am relatively new to Node but I have worked with the following:</p>\n\n<ul>\n<li><a href=\"http://expressjs.com/\" rel=\"nofollow\">Express</a></li>\n<li><a href=\"http://requirejs.org/\" rel=\"nofollow\">Require.js</a></li>\n<li><a href=\"https://github.com/substack/node-browserify\" rel=\"nofollow\">Browserify</a></li>\n<li><a href=\"http://learnboost.github.com/stylus/\" rel=\"nofollow\">Stylus</a></li>\n<li><a href=\"https://github.com/visionmedia/jade\" rel=\"nofollow\">Jade</a></li>\n<li><a href=\"https://github.com/satyr/coco\" rel=\"nofollow\">Coco</a></li>\n<li><a href=\"https://github.com/senchalabs/connect\" rel=\"nofollow\">Connect</a></li>\n<li><a href=\"https://github.com/dsc/connect-compiler\" rel=\"nofollow\">Connect Compiler</a></li>\n<li><a href=\"http://knockoutjs.com\" rel=\"nofollow\">Knockout</a></li>\n<li><a href=\"https://github.com/ifandelse/Knockout.js-External-Template-Engine\" rel=\"nofollow\">Knockout External Templates</a></li>\n</ul>\n\n<p>So, considering that I have a beginner to intermediate understanding of all the above, what follows is a tutorial that I need your help to make into a reality.  It seems to me that <a href=\"http://meteor.com/\" rel=\"nofollow\">meteor</a> accomplishes some of what I'd love, but I'd prefer to stick within the node ecosystem.  The above projects are mostly good examples of said ecosystem.  Without further ado:</p>\n\n<p><strong>Dan's Perfect Framework</strong></p>\n\n<p><em>Getting Started</em></p>\n\n<pre><code>npm install -g dan\ndan create singlePageApplication\ncd singlePageApplication\ndan\n</code></pre>\n\n<p>Now your application is serving on <code>http://localhost:3000</code>.  Here's an overview of the structure, followed by an explanation of each folder:</p>\n\n<pre><code>singlePageApplication/\n    .build/\n    data/\n    scripts/\n        pages/\n            home.co\n        main.co\n    styles/\n        pages/\n            home.styl\n        main.styl\n    templates/\n        pages/\n            home.jade\n    app.co\n    main.jade\n</code></pre>\n\n<p><code>app.co</code> configures and runs the project rendering the only server-side template which here is called main.jade</p>\n\n<p><code>main.jade</code> sets up the greatest common set of html that's shared by all client side pages in your application.  In this case, doctype, html/head/body structure, a templated title tag, requirejs with /scripts/main.co as the main entry point, and a stylesheet link to /styles/main.styl</p>\n\n<p><code>main.co</code> is the entrypoint that sets up client side routing by instantiating dan.Router.  The router loads the home page by:</p>\n\n<ul>\n<li>creating a singleton of /scripts/pages/home.co which inherits from dan.Page</li>\n<li>which injects home.jade into index.jade, fetching it from the server if it hasn't been fetched yet.</li>\n<li>and includes /styles/pages/home.styl if it exists.  This also removes any other style definition that was dynamically added at the same level as home.styl (not by templates that are added to home.jade)</li>\n</ul>\n\n<p><code>scripts/</code> is where javascript, coffeescript, coco, or whatever you choose to write your app logic in, go.  In the case of the basic app, main.co</p>\n\n<p><code>scripts/pages/*.co</code> deserves special mention because these inherit from dan.Page and are instantiated as singletons by dan.Router.  Navigation links can be created as <code>&lt;a class=\"navigate\" href=\"#somePage\"&gt;&lt;/a&gt;</code> tags and are handled by the router which instantiates and/or runs scripts/pages/somePage.co.  Navigation can be done programatically with dan.Router.go('somePage').  The pages hang on to their state because they're singletons but can also store it to localStorage to handle the user refreshing the browser.</p>\n\n<p><code>styles/</code> is where css, styl, less, or any other style definition files go.</p>\n\n<p><code>templates/</code> is where html, jade, haml, or any other markup files go.</p>\n\n<p><code>data/</code> is where javascript objects are saved to the database mechanism of choice.  By default, <code>dan</code> stores objects to the filesystem.  However, the middleware that it uses to do that can be replaced by any other database implementation like CouchDB, MongoDB, Sqlite, etc.  From the client's perspective, working with the database is as simple as calling save and load on objects that inherit dan.Storable:</p>\n\n<pre><code>objectInstance = new MyObject() // MyObject inherits dan.Storable\nobjectInstance.save()\nanotherObject = new MyObject({id:'1234'})\nanotherObject.load()\n</code></pre>\n\n<p>In the cases above, both save and load methods have options for saving entire complex objects or just the first level of properties.</p>\n\n<p><code>.build/</code> is where ALL non-project artifacts go.  For example, css files from *.styl compilation, js from *.co, html from *.jade, the ugly node_modules directory, etc.</p>\n\n<p>In case you're wondering, <code>dan</code> stands for \"Dan is Amazed/Annoyed by Node\" ;)\nSo, what say you?  How easy is it to create something like this?</p>\n"},{"tags":["node.js","express","port","collapse"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13241905,"title":"Multiple node.js programs running at the same time","body":"<p>I have one node app running and I want to try the express framework while node is running the other process, but when I run the express sample app it says that:</p>\n\n<pre><code>Error: listen EADDRINUSE\nat errnoException (net.js:776:11)\nat HTTPServer.Server._listen2 (net.js:915:14)\nat listen (net.js:942:10)\nat HTTPServer.Server.listen (net.js:992:5)\nat Object.&lt;anonymous&gt; (/home/omar/webServer/app.js:35:5)\nat Module._compile (module.js:449:26)\nat Object.Module._extensions..js (module.js:467:10)\nat Module.load (module.js:356:32)\nat Function.Module._load (module.js:312:12)\nat Module.runMain (module.js:492:10)\n</code></pre>\n\n<p>I know that this happens when you try to run both node programs at the same port but I'm using in one app port 3000 and the other 8080, so I don't know if one node instance blocks out the other.</p>\n"},{"tags":["ruby","node.js","zlib","inflate"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13241360,"title":"Read with Ruby a Zlib string created with Node.js","body":"<p>Some pieces of our app are written in Ruby and others are written using node.js.</p>\n\n<p>We share data among them using a redis store that stores zlib chunks.\nWe write to it with the following code using node:</p>\n\n<pre><code>zlib.deflate(xml.toString(), function(error, deflated) {\n  ...\n  deflated.toString('binary'); // That's the string we write in Redis\n  ...\n});\n</code></pre>\n\n<p>Now, we read this data in the redis store using Ruby (1.8.7) and I have to say I'm not sure how to do that.</p>\n\n<p>The typical string we get from the store looks like this:</p>\n\n<pre><code>=&gt; \"xuAo \\020ÿ\\ná.£v½\\030dÿCO½±:«¤(\\004Æªÿ¾¬®5MÚ\\003÷½IÞ q¤°²e°c¼òÈ×\\000ó&lt;ùM¸ÐAç\\025ÜÈ\\r|gê\\016Ý/.é\\020ãÆî×\\003Ôç&lt;Ýù2´F\\n¨Å\\020!zl \\0209\\034p|üÀqò\\030\\036m\\020\\e`\\031¼ÏütÓ=Ã¸¦U/ÔO±\\177zB{\\037½£-ðBu©ò¢X\\000kb­*Ó[V\\024Y^½EÎ¥üpúrò­¦\\177ÁÃdÈ¢j\\0353$a\\027²q#¥]*Ýi3J8¤´füd\\eså[³öÊµ%\\fcÇY\\037ð¬ÿg§í^¥8£Õ§a¶\\001=\\r;¡¾\\001\\020Pí\" \n</code></pre>\n\n<p>Of course, I tried using  <code>Zlib::Inflate.new.inflate(compressed)</code> but that fails with a <code>Zlib::DataError: incorrect header check</code>.</p>\n\n<p>Any idea on what kind of transformation we should do to that string to inflate it from Ruby?</p>\n\n<p>PS: inflating it from node is easy and works, so the problem is not how we compress it.</p>\n"},{"tags":["javascript","json","node.js","express","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13241627,"title":"Return value from Object match","body":"<p>I'm, by no means, JS fluent, so forgive me if im asking for some really basic stuff, but I've not being able to find a proper answer to my question.</p>\n\n<p>Im writting my first Node.js (plus Extra Framework and Socket.io) app and Im having some fun setting up the server side of a FB-like messenger (surprise!!!).</p>\n\n<p>So, let's say I have this data structure to store online users(This is a JSON Array, but I'm not sure it is the best way to do it or should I go with Javascript Objects):</p>\n\n<pre><code>[\n  {\n    \"site\": 45,\n    \"users\": [\n        {\n            \"idUser\": 5,\n            \"idSocket\": \"qwe87r7w8qwe\",\n            \"name\": \"Carlos Ray Norris\"\n        },\n        {\n            \"idUser\": 6,\n            \"idSocket\": \"v8d9d0fgfs7d\",\n            \"name\": \"John Connor\"\n        }\n    ]\n},\n{\n    \"site\": 48,\n    \"users\": [\n          {\n            \"idUser\": 22,\n            \"idSocket\": \"qwe87r7w8qwe\",\n            \"name\": \"David Bowie\"\n          },\n          {\n            \"idUser\": 23,\n            \"idSocket\": \"v8d9d0fgfs7d\",\n            \"name\": \"Barack H. Obama\"\n          }\n      ]\n  }\n]\n</code></pre>\n\n<p>What I want to do is to search in the array for x value given y. In this case, retrieving the idSocket knowing the idUser <strong>WITHOUT</strong> having to run through the array values.</p>\n\n<p>So I have basically 2 questions: first, what would be the proper way to store users online? and secondly, how to find values matching with the values I already know (find the idSocket that has a given idUser).</p>\n\n<p>I would like a pure JS approach(or using some of the tools given by Node, Socket.io or Express), but if that's not possible then I can look for some JQuery.</p>\n\n<p><strong>EDIT</strong>\nI took chovy's advice and modified a little the structure, now it looks like this</p>\n\n<pre><code>{\n  45: { // site\n    05: { // userId\n        \"name\": \"Carlos Ray Norris\",\n        \"socketID\": \"qwe87r7w8qwe\"\n    },\n    06: {\n        \"name\": \"John Connor\",\n        \"socketID\": \"v8d9d0fgfs7d\"\n    }\n},\n48: {\n    22: {\n        \"name\": \"David Bowie\",\n        \"socketID\": \"erv7e6v876vr\"\n    },\n    23: {\n        \"name\": \"Barack H. Obama\",\n        \"socketID\": \"brt877brtt87\"\n    }\n  }\n}\n</code></pre>\n\n<p>Thanks to Node.js, I can easily access to the data like this (I know both, the site and userId value) <code>var socket = data[site][\"05\"].socketId</code>. Im guessing this is done thanks to Node.js, but Im not completely sure.</p>\n"},{"tags":["node.js","coffeescript"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13210765,"title":"coffeescript with Request scoping","body":"<pre><code>request = require('request')\n\nauth =\nurl: ''\nmethod: 'POST'\njson:\n  credentials:\n  username: \"\"\n  key: \"\"\n\nexports = exports ? this\n\nrequest auth, (err, res, body) -&gt;\n  exports.inside = body\n\nconsole.log(exports.inside)\n</code></pre>\n\n<p><br></p>\n\n<p>Then above is Coffeescript with the request module for Node.js.  I cannot figure out how to get the data  inside of the request function out.  This has been a major road-block for my application.</p>\n\n<p>Thank you!</p>\n"},{"tags":["javascript","node.js","mongodb-query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":38,"score":-1,"question_id":13241956,"title":"dynamically setting a key in an object","body":"<p>I'm trying to dynamically build a query for mongodb in node. The function that creates it is:</p>\n\n<pre><code>    app.set('searchTerm', function (field, str){\n        var i, searchTerm, keywords;\n        keywords = str.split(' ');\n        searchTerm = {field : str , _keywords : keywords};\n        return searchTerm;\n    });\n</code></pre>\n\n<p>My problem is that the object constructed ends up with the string 'field' as a key, not the passed argument. How do I get it to evaluate the argument?</p>\n\n<p>Thanks</p>\n\n<p>James</p>\n"},{"tags":["node.js","aptana"],"answer_count":4,"favorite_count":4,"up_vote_count":20,"down_vote_count":0,"view_count":5010,"score":20,"question_id":8025825,"title":"Is there a NodeJS plugin for Aptana Studio?","body":"<p>Is there a NodeJS plugin for Aptana Studio?</p>\n\n<ul>\n<li>At least for NodeJS code-assist</li>\n<li>And perhaps a way to create NodeJS project</li>\n<li>And local NodeJS debugging</li>\n</ul>\n"},{"tags":["javascript","node.js","jsdom"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13240303,"title":"How to execute an external script in jsdom","body":"<p>I have a method in a products.js file like so:</p>\n\n<pre><code>var handler = function(errors, window) {...}\n</code></pre>\n\n<p>and would like to execute it within a jsdom env callback:</p>\n\n<pre><code>jsdom.env({\n    html : \"http://dev.mysite.com:3000/products.html\",\n    scripts : [ \"http://code.jquery.com/jquery.js\", \"page-scrapers/products.js\" ],\n    done : function(errors, window) {\n        handler(errors, window)\n        }  \n});\n</code></pre>\n\n<p>When executed, it tells me 'handler is not defined'.  Am I getting close?</p>\n"},{"tags":["javascript","node.js","prototype","commonjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":298,"score":0,"question_id":9364654,"title":"Node.JS - Using prototype in a module","body":"<p>So I'm writing a whole bunch of vendor-specific files in node which all have a similar controller pattern, so it makes sense for me to cut them out and put into a common file.</p>\n\n<p>You can see my common controller file here: <a href=\"https://gist.github.com/081a04073656bf28f46b\" rel=\"nofollow\">https://gist.github.com/081a04073656bf28f46b</a></p>\n\n<p>Now when I use them in my multiple modules, each consecutively loaded module is overwriting the first. This is because the file is only required once and passed dynamically through to each module on load (this allows me to add extra modules and these modules are able to add their own routes, for example). You can see an example module here: <a href=\"https://gist.github.com/2382bf93298e0fc58599\" rel=\"nofollow\">https://gist.github.com/2382bf93298e0fc58599</a></p>\n\n<p>You can see here on line 53 I've realised that we need to create a seperate instance every time, so I've tried to create a new instance by copying the standardControllers object into a new object, then initialising the new object. This has zero impact on the code, and the code behaves in exactly the same way.</p>\n\n<p>Any ideas guys? I'm in a bit of a jam with this one!</p>\n"},{"tags":["javascript","node.js","closures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13239452,"title":"Adding extra parameters to a callback","body":"<p>So after reading up I see that I need a closure or to use bind but I am not fully clear on the proper syntax and which I should use.</p>\n\n<p>I am using the imagemagick module from <a href=\"https://github.com/rsms/node-imagemagick\" rel=\"nofollow\">https://github.com/rsms/node-imagemagick</a> and need to pass the filename to the resize callback.</p>\n\n<p>Syntax is:</p>\n\n<pre><code>var filename = 'myfile.jpeg';\nim.resize(options, callback(err, stdout, stderr))\n</code></pre>\n\n<p>Now I want my callback to accept extra parameters such as the filename.</p>\n\n<p>I would like to be able to call another function and have the filename along with the 3 callback parameters (also note that this is in a loop so the filename is from an array - not sure if that matters)</p>\n\n<p>So I have a callback function:</p>\n\n<pre><code>var callback = function(err, stdout, stderr) {\n    //how do I access filename?\n}\n</code></pre>\n\n<p>Can I get an explanation of which I should use (closure or bind) and pros/cons and, if a closure, how would I actually write the callback function - I am unclear on how I access err, stdout and stderr in that way.</p>\n"},{"tags":["json","node.js","parsing","require","read-eval-print-loop"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13241165,"title":"Node.JS: Can't use require to parse .json file in REPL","body":"<p>So I'm trying to parse a config.json file from the REPL.\nThe file is: app/config/config.json and I'm running the REPL from app/.</p>\n\n<p>In the REPL if I try to require the file, the REPL doesn't execute, instead waiting for more input:</p>\n\n<pre><code>$ node\n&gt; var config = require('./config/config.json');\n...\n</code></pre>\n\n<p>I'm sure it can be done, but I'm not sure what I'm doing wrong:\n<a href=\"http://stackoverflow.com/a/9804910/1027966\">http://stackoverflow.com/a/9804910/1027966</a></p>\n"},{"tags":["javascript","node.js","dojo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13239463,"title":"Get Javascript objects by class?","body":"<p>Dojo for instance adds a member to a JS object called \"declared_class\". I would like to find those and replace some stuff. And, can this be done also outside of Dojo ? I know, JS is not type oriented but you never know whats out to bypass this lack of introspection facilities. </p>\n\n<p>Update : This is NOT about DOM objects. I am writing a sort of real-time Javascript editor. After I reloaded the script, I need to locate related (Dojo modules) objects and mixin altered functions only. </p>\n\n<p>Update 2 : It doesn't seem to be possible without a prototype or a similar patch. Since all the code is running 1:1 in a node instance as well, I am wondering whether I can determine those objecys in a node.js instance ?  </p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":669,"score":3,"question_id":10695629,"title":"node.js Express next()","body":"<p>So in Express, You have a simple block of code like this:</p>\n\n<pre><code>app.get('/', function(req, res){\n    res.send('Hello World');\n});\n</code></pre>\n\n<p>On request of '/', do this function of code sending in req and res objects.</p>\n\n<p>Some other blocks of code, seem to pass a 3rd argument in being next()</p>\n\n<p><em>Pulled from the Express documentation</em></p>\n\n<pre><code>app.get('/users/:id?', function(req, res, next){\n    var id = req.params.id;\n    if (id) {\n        // do something\n    } else {\n        next();\n    }\n});\n</code></pre>\n\n<p>I can't understand what the point of next() is or why its being used. In that example, if id doesn't exist, what is next actually doing?</p>\n"},{"tags":["javascript","node.js","jsdom"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":114,"score":1,"question_id":10037221,"title":"How can I catch errors thrown by my jsdom.jqueryify callback?","body":"<p>The output of this code when run in node.js is the stack trace of an error that occurs on the last line (line number 9). The error that occurs on line 7 is somehow 'absorbed' by node. Even if I wrap it in a try/catch statement I can't seem to get as detailed a stack trace output as I do from node's default error handling code.</p>\n\n<p>How can I catch the error on line 7 and get as much detail about it as I can from line 9?</p>\n\n<pre><code>jsdom = require('jsdom');\nvar testHTML = \"&lt;html&gt;&lt;head&gt;&lt;title&gt;Hi!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;Hi!&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;\";\njsdom.jQueryify(\n    jsdom.jsdom(testHTML).createWindow(),\n    'http://code.jquery.com/jquery-1.4.2.min.js' ,\n    function() {\n        var a = broken();\n    });\nvar a = broken();\n</code></pre>\n\n<p>(NB: This is a simplified example from a much more complex script I'm writing with errors that occur in a 'deeply' nested stack that forms as a result of a call from within a jQueryify call-back, and debugging it is an <em>absolute</em> pain right now without being able to get detailed stats on the error)</p>\n"},{"tags":["node.js","parsing","csv"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13200136,"title":"Stop node-csv-parser when an error ocurrs","body":"<p>I'm using node-csv-parser (<a href=\"http://www.adaltas.com/projects/node-csv/from.html\" rel=\"nofollow\">http://www.adaltas.com/projects/node-csv/from.html</a>) in order to parse a CSV file uploaded to a node+express instance.\nWhen an error ocurrs into the 'record' event I want to stop the file parsing and return the error to the client, but the 'error' event is called several times (for each record in the CSV file).</p>\n\n<p>Here's my code:</p>\n\n<pre><code>  csv()\n  .from(req.files.file.path)\n  .on('record', function(data, index){\n    var date = data[0];\n    var vehicle = data[1];\n    var taxId = data[4];\n    var customer = data[7];\n    var address = data[8] + ' ' + data[9];\n    var quantity = data[10]\n    console.log(date + ' | ' + vechile + ' | ' + taxId + ' | ' + customer + ' | ' + address + ' | ' + quantity);\n  })\n  .on('end', function() {\n    fs.unlinkSync(req.files.file.path);\n    res.end();\n  })\n  .on('error', function(error) {\n    fs.unlinkSync(req.files.file.path);\n    console.log('HI');\n    res.end('error|' + req.files.file.name);\n  });\n</code></pre>\n\n<p>As you can see above, there's an intentional error when printing to console the full record. The variable called vehicle is wrongly typed (vechile). The 'error' event is then fired multiple times printing 'HI' several times to the console.</p>\n\n<p>What I want is to interrupt the file parsing when the first error occurs, so I can get rid of the file properly (now it's being deleted several times, failing on the second time) and return the error to the client.</p>\n\n<p>I tried using the end() method, but it didn't worked.</p>\n\n<p>Am I on the right track? Any advise? </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["mongodb","node.js","mongoose"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":363,"score":2,"question_id":7499915,"title":"Defining a Mongoose Schema on the fly","body":"<p>I have a model file that gathers together all my Mongoose models. One of the models I would like to initialize with a variable number of fields. Currently I'm defining more fields than I think I am going to require:</p>\n\n<pre><code>TallySchema = new mongoose.Schema\n  0: Number\n  1: Number\n  ...\n  20: Number\n</code></pre>\n\n<p>Obviously this is not ideal. I see Mongoose will let you specify options outside the Schema definition but can't see how to add new fields (or paths, I guess, in Mongoose). </p>\n"},{"tags":["javascript","node.js","jasmine","zombie.js"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13238889,"title":"Zombie.js and scripts that write to window","body":"<p>I'm having some trouble with <code>Zombie.js</code> and evaluating scripts which write stuff to the <code>window</code> variable. Here is an example to show what I mean:</p>\n\n<p>Say I have a script <code>foo.js</code> which does the following:</p>\n\n<p><code>window.foo = 'foo';</code></p>\n\n<p>Then I visit the following html page (which includes <code>foo.js</code>) using zombie.js:</p>\n\n<p><strong>HTML</strong></p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n\n &lt;html&gt;\n &lt;head&gt;\n   &lt;title&gt;zombiejs test &lt;/title&gt;\n   &lt;script type=\"text/javascript\" src=\"foo.js\"&gt;&lt;/script&gt;\n &lt;/head&gt;\n &lt;body&gt;\n    &lt;script type=\"text/javascript\"&gt;\n      console.log(window.foo);\n    &lt;/script&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n</code></pre>\n\n<p>I would have assumed that the <code>window.foo</code> variable would be available for the rest of the page after the execution of foo.js, but it seems this is not the case as running:</p>\n\n<p><code>Browser.visit('http://localhost:8087/test.html')</code></p>\n\n<p>gives me <code>undefined</code>.</p>\n\n<p>Is there any particular reason this happens or am I doing something wrong here? Does Zombie.js evaluate the scripts into a different context which is not the same context where the page is run?</p>\n"},{"tags":["node.js","exception","dns","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13228649,"title":"Unable to handle exception with node.js domains using express","body":"<p>I want to use Node.js Domains to catch exceptions.  It is working so far, but there is one place I can't get domains to catch the exception.  exception2 in the callback is caught and handled in the domain.on('error') handler, but exception1 is not caught.  The odd thing is that when exception1 is thrown, it doesn't shutdown Node like I would expect.  Here is my example app:</p>\n\n<pre><code>var domain = require('domain');\nvar request = require('request');\nvar express = require('express');\n\nvar serverDomain = domain.create();\nserverDomain.on('error', function(err) {\n  console.log(\"Server Domain Error: \" + err);\n});\n\nvar app;\n\nserverDomain.run(function() {\n  app = express();\n  app.listen(3000);\n});\n\napp.use(function(req, res, next) {\n\n  var reqDomain = domain.create();\n  reqDomain.add(req);\n  reqDomain.add(res);\n  reqDomain.on('error', function(err) {\n    console.log(\"Req Domain Error: \" + err);\n    reqDomain.dispose();\n    next(err);\n  });\n\n  next();\n});\n\napp.get('/', function(req, res) {\n  var uri = \"http://google.com\";\n\n  exception1.go();\n\n  request.get({url:uri, json: {}},\n    function (error, response, body) {\n      if(response.statusCode === 200) {\n        exception2.go();\n        res.send('Success getting google response');\n      }\n    });\n});\n</code></pre>\n\n<p>To get exception2 to execute, I comment out exception 1.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13215877,"title":"responding with a json object in Node js","body":"<p>I want to return a Json object in 200 OK.</p>\n\n<p>I am getting the data from my nosql.</p>\n\n<p>I know the how to fill the structure. (that is in the json body the values to keep)</p>\n\n<p>Here Name, Class and Address are fixed:</p>\n\n<pre><code>Name= entity[4]\nClass= entityclass[4]\nAddress = entityaddrss[4]\n</code></pre>\n\n<p>...\nenity..will be coming from nosql.</p>\n\n<p>how can I construct and send a 200Ok with json body.</p>\n\n<pre><code>response.end({})\n</code></pre>\n\n<p>can you plesae let me what I should write in end.I have all the required data:\n    Name= entity[4]\n    Class= entityclass[4]\n    Address = entityaddrss[4]</p>\n"},{"tags":["node.js","memcached"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":12206318,"title":"Custom in-memory cache","body":"<p>Imagine there's a web service:</p>\n\n<ul>\n<li>Runs on a cluster of servers (nginx/node.js)</li>\n<li>All data is stored remotely</li>\n<li>Must respond within 20ms</li>\n</ul>\n\n<p>Data that must be read for a response is split like this..</p>\n\n<p><strong>BatchA</strong></p>\n\n<ul>\n<li>Millions of small objects stored in AWS DynamoDB</li>\n<li>Updated randomly at random times</li>\n<li>Only consistent reads, can't be catched</li>\n</ul>\n\n<p><strong>BatchB</strong></p>\n\n<ul>\n<li>~2,000 records in SQL</li>\n<li>Updated rarely, records up to 1KB</li>\n<li>Can be catched for up to 60-90s</li>\n</ul>\n\n<p>We can't read them all at once as we don't know which records to fetch from BatchB until we read from BatchA.</p>\n\n<p>Read from DynamoDB takes up to 10ms. If we read BatchB from remote location, it would leave us with no time for calculations or we would have already been timed out.</p>\n\n<p>My current idea is to load all BatchB records into memory of each node (that's only ~2MB). On startup, the system would connect to SQL server and fetch all records and then it would update them every 60 or 90 seconds. The question is <strong>what's the best way to do this</strong>?</p>\n\n<p>I could simply read them all into a variable (array) in node.js and then use SetTimeout to update the array after 60-90s. But <strong>is the the best solution</strong>?</p>\n"},{"tags":["node.js","mongodb","gridfs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13239732,"title":"MongoDB: How to write a GridFS file to a temp location on the local File System for manipulation?","body":"<p>I have a bunch of PDF files that I store in GridFS. I need to cat a couple together into a new file using <a href=\"http://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/\" rel=\"nofollow\">pdfTK</a> and then I will write the newly created PDF to GridFS as a new file. </p>\n\n<p>Using Node.js, what's the best method for writing a file from GridFS to a temporary file on the main filesystem so I can perform external operations on it?</p>\n"},{"tags":["node.js","cookies","express"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":174,"score":3,"question_id":10183906,"title":"Node.js unit testing for session-specific middleware","body":"<p>I'm writing a unit test for a middleware that relies on persistent sessions in connect. (namely connect-mongo).</p>\n\n<p>I'd like to create a fake session, but can't seem to figure out how.</p>\n\n<p>I have a connect.sid cookie in my browser that I assume correlates to the _id in my sessions collection in some encrypted manner.</p>\n\n<p>Here's what I tried:</p>\n\n<p>I added in the cookieParser middleware and a session store to a server, then used the following request to send it up to the server (copied the key from chrome's dev tools panel):</p>\n\n<pre><code>var jar = request.jar(),\n    cookie = request.cookie('connect.sid=&lt;REALLYLONGKEY&gt;');\njar.add(cookie);\nrequest({url : 'http://localhost:8585/',jar : jar},this.callback);\n</code></pre>\n\n<p>that correctly set the cookie on the server side, and I have verified that sessions are working.</p>\n\n<p>However, the magic conversion from cookie to session didn't happen as I had hoped - what's the correct way to do this?</p>\n"},{"tags":["node.js","synchronization","fs","flock"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13205744,"title":"How can I synchronize access to a file within a single process in node.js?","body":"<p>I have a Web server that reads and writes to a data file on disk. I'd like a file only be written to in a single Web request.</p>\n\n<p>Here's an example program that illustrates my problem. It keeps a state file in \"/tmp/rw.txt\" and increments the integer contents on each Web hit. Running this program, and then running something like <code>ab -n 10000 -c 1000 http://localhost:3000/</code>, shows that the same value is read from the file by multiple hits, and it's written multiple times.</p>\n\n<p>NOTE: I know about flock() and <a href=\"https://github.com/baudehlo/node-fs-ext\" rel=\"nofollow\">fs-ext</a>. However, flock() will lock the file to the current process; since all the access here is in the same process, flock() doesn't work (and complicates this example considerably).</p>\n\n<p>Also note that I'd usually use express, async, etc. to get most of this done; just sticking to the basics for the sake of example.</p>\n\n<pre><code>var http = require(\"http\"),\n    fs = require(\"fs\");\n\nvar stateFile = \"/tmp/rw.txt\";\n\nvar server = http.createServer(function(req, res) {\n\n    var writeNum = function(num) {\n        var ns = num.toString(10);\n        console.log(\"Writing \" + ns);\n        fs.writeFile(stateFile, ns, function(err) {\n            if (err) {\n                res.writeHead(500, {\"Content-Type\": \"text/plain\"});\n                res.end(err.message);\n            } else {\n                res.writeHead(200, {\"Content-Type\": \"text/plain\"});\n                res.end(ns);\n            }\n        });\n    };\n\n    switch (req.url) {\n    case \"/reset\":\n        writeNum(0);\n        break;\n    case \"/\":\n        fs.readFile(stateFile, function(err, data) {\n            if (err &amp;&amp; err.code == \"ENOENT\") {\n                // First time, set it to zero\n                writeNum(0);\n            } else if (err) {\n                res.writeHead(500, {\"Content-Type\": \"text/plain\"});\n                res.end(err.message);\n            } else {\n                writeNum(parseInt(data, 10) + 1);\n            }\n        });\n        break;\n    default:\n        res.writeHead(404, {\"Content-Type\": \"text/plain\"});\n        res.end(\"No such resource: \" + req.url);\n    }\n});\n\nserver.listen(3000);\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13236355,"title":"How to generate random bytes via Cryptographic Service Provider (CSP) without .NET/COM?","body":"<p>Is there a way to generate strong random bytes via Microsoft's Cryptographic Service Provider (CSP) without using .NET/COM? For example, using command line or some other way?</p>\n\n<p>I'd like to use it in NodeJS to be more specific.</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13234991,"title":"valid nodejs code in string to javascript object","body":"<p>My Goal: I am trying to encrypt .js files into .jse and decrypt only when it is running (obfuscate nodejs code).</p>\n\n<pre>\nvar ffi = require('ffi');\n\n//libpcrypt.so is a library to encrypt and decrypt files\nvar crypt = ffi.Library('./libpcrypt', {\n  'decrypt' : [ 'string', ['string', 'string']]\n});\n\nrequire.extensions[\".jse\"] = function (module) {\n   module.exports = (crypt.decrypt(module.filename, 'out'));\n};\n\nconsole.log(require('./routes.jse'));\n\n</pre>\n\n<p>I know, with cosole.log() source code can be printed out.<br></p>\n\n<p><b>Problem:</b> Decrypted code is a plain string, I am not able to convert it into a valid javascript object for exports. Is there a way to export the code string I decrypted?</p>\n"},{"tags":["javascript","node.js","typescript"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":13235257,"title":"How to use declaration files in TypeScript","body":"<p>There is something I am not getting in TypeScript when it comes to declaration files and 3rd party libraries written in pure Javascript. Let's say I have the following Javascript class:</p>\n\n<pre><code>$ cat SomeClass.js\n\nvar SomeClass = (function () {\n    function SomeClass() {\n    }\n    SomeClass.prototype.method1 = function () {\n            return \"some string\";\n    };\n    return SomeClass;\n})();\nexports.SomeClass = SomeClass;\n</code></pre>\n\n<p>And I want to get type checking for it, so I create declaration file like this:</p>\n\n<pre><code>$ cat test.d.ts\n\nclass SomeClass {\n    public method1(): string;\n}\n</code></pre>\n\n<p>Then I want to use the class and declaration file in some code:</p>\n\n<pre><code>$ cat main.ts\n\n///&lt;reference path=\"./test.d.ts\"/&gt;\nimport ns = module(\"./SomeClass\");\n\nfunction test(): string {\n   var sc = new ns.SomeClass();\n   return sc.method1();\n}\n</code></pre>\n\n<p>When I try to compile it, I get this:</p>\n\n<pre><code>$ tsc main.ts\nmain.ts(2,19): The name '\"./SomeClass\"' does not exist in the current scope\nmain.ts(2,19): A module cannot be aliased to a non-module type\nmain.ts(5,16): Expected var, class, interface, or module\n</code></pre>\n\n<p>From what I can tell, the import statement requires an actual TypeScript class to exist and the reference statement isn't enough to help the compiler figure out how to handle it. </p>\n\n<p>I tried changing it to</p>\n\n<pre><code>import ns = module(\"./test.d\");\n</code></pre>\n\n<p>But no dice either.</p>\n\n<p>The only way I can get this to actually compile and run is to use the require statement instead of import, like this:</p>\n\n<pre><code>$ cat main.ts\n\n///&lt;reference path=\"./node.d.ts\"/&gt;\n///&lt;reference path=\"./test.d.ts\"/&gt;\nvar ns = require(\"./SomeClass\");\n\nfunction test(): string {\n   var sc = new ns.SomeClass();\n   return sc.method1();\n}\n</code></pre>\n\n<p>The problem with this code is that TypeScript is not running any type checking. In fact, I can totally remove the line</p>\n\n<pre><code>///&lt;reference path=\"./test.d.ts\"/&gt;\n</code></pre>\n\n<p>and it doesn't change anything.</p>\n\n<p>However, if I remove the require statement, I can get type checking, but the code blows up at runtime because there is no require statement.</p>\n\n<pre><code>$ cat main.ts\n\n///&lt;reference path=\"./test.d.ts\"/&gt;\n\nfunction test(): string {\n   var sc = new SomeClass();\n   return sc.method1();\n}\n\ntest();\n\n$ node main.js\n\nmain.js:2\n    var sc = new SomeClass();\n                 ^\nReferenceError: SomeClass is not defined\n    ...\n</code></pre>\n"},{"tags":["linux","node.js"],"answer_count":5,"favorite_count":7,"up_vote_count":28,"down_vote_count":0,"view_count":16308,"score":28,"question_id":5123533,"title":"How can I uninstall or upgrade my old node.js version?","body":"<p>some time ago I have installed node.js on my Ubuntu system. with the following steps (dump of my history):</p>\n\n<pre><code>309  git clone git://github.com/joyent/node.git\n310  cd node/\n311  ./configure \n312  make\n313  ls -l\n314  node\n315  sudo make install\n</code></pre>\n\n<p>My Version is v0.3.2-pre.</p>\n\n<p>Please, is there a clean way to get a new version by uninstall/install or upgrade? I have not much experience with make or git.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":12925802,"title":"Run a node.js script with command-line arguments","body":"<p>What is the correct syntax for running a node.js script with command-line arguments on Linux or Mac?\nTo run the script with no arguments, I would simply use the command <code>node stuff.js</code>, but in this case, I'd like to run a script called <code>stuff.js</code> with the arguments <code>\"blah\", \"hee\", \"woohoo!\"</code>.</p>\n"},{"tags":["node.js","sockets","tcp","tls"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":76,"score":4,"question_id":12971738,"title":"Pass tls.CleartextStream instance to worker process","body":"<p>I want to pass a <a href=\"http://nodejs.org/api/tls.html#tls_class_tls_cleartextstream\" rel=\"nofollow\"><code>tls.CleartextStream</code></a> instance to a worker process (created by <a href=\"http://nodejs.org/api/cluster.html#cluster_cluster_fork_env\" rel=\"nofollow\">cluster.fork()</a> method). While I can send <code>net.Socket</code> instances using the <a href=\"http://nodejs.org/api/child_process.html#child_process_child_send_message_sendhandle\" rel=\"nofollow\">send(message, handle)</a> method I can't do the same using the ClearStream class. </p>\n\n<p>Might there be a way to \"rewrap\" the connected raw socket by serializing the original CleartextStream instance?</p>\n\n<p>This is what I want to achieve: The master process of a Node.js application is listening for TLS connections. There are a number of certain worker processes which where spawned at startup. A client connected to the master process want to be redirected to <em>a certain</em> worker process. Therefore the master should send the socket to the corresponding worker process. This actually works but as the TLS context gets lost the worker process can neither de- nor encode data to communicate to the connected client.</p>\n\n<p><img src=\"http://i.stack.imgur.com/QSPUw.png\" alt=\"enter image description here\"></p>\n\n<p>Do you have any idea how this could be realized?</p>\n"},{"tags":["c#","c++","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":13236868,"title":"Is it possible to create a NodeJS server with SocketIO in C++ or C#?","body":"<p>Is it possible to create a NodeJS server with SocketIO in C++ or C#? If so, where can I find sample code?</p>\n"},{"tags":["node.js","http-server"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1751,"score":3,"question_id":9204706,"title":"node js process nexttick error for simple httpserver","body":"<p>I have simple node js http server.</p>\n\n<pre><code>var http = require(\"http\");\n\nhttp.createServer(function(request, response) {\n  response.writeHead(200, {\"Content-Type\": \"text/plain\"});\n  response.write(\"Hello World\");\n  response.end();\n}).listen(8888);\n</code></pre>\n\n<p>If I run</p>\n\n<pre><code>node basicserver.js \n</code></pre>\n\n<p>I get</p>\n\n<pre><code>node.js:201\n        throw e; // process.nextTick error, or 'error' event on first tick\n              ^\nError: listen EADDRINUSE\n    at errnoException (net.js:642:11)\n    at Array.0 (net.js:743:26)\n    at EventEmitter._tickCallback (node.js:192:40)\n</code></pre>\n\n<p>I have seen <a href=\"http://stackoverflow.com/questions/8673775/process-nexttick-error-in-node-js\">this</a> post, but that post seems to be specific to TCP server and not http server. Could anyone please help.</p>\n"},{"tags":["node.js","angularjs","angular","testacular"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":13219435,"title":"Error install testacular","body":"<p>I am following the testatcular vide tutorial <a href=\"http://vojtajina.github.com/testacular/\" rel=\"nofollow\">http://vojtajina.github.com/testacular/</a>.</p>\n\n<p>I installed nodejs and when I tried to install testacular with </p>\n\n<p><code>sudo npm install -g testacular</code> \nI get this error :</p>\n\n<pre><code>npm http GET https://registry.npmjs.org/testacular\nnpm http 304 https://registry.npmjs.org/testacular\nnpm http GET https://registry.npmjs.org/chokidar\nnpm http GET https://registry.npmjs.org/minimatch\nnpm http GET https://registry.npmjs.org/socket.io\nnpm http GET https://registry.npmjs.org/glob\nnpm http GET https://registry.npmjs.org/optimist\nnpm http 304 https://registry.npmjs.org/glob\nnpm http 304 https://registry.npmjs.org/socket.io\nnpm http 304 https://registry.npmjs.org/optimist\nnpm http 304 https://registry.npmjs.org/chokidar\nnpm http 304 https://registry.npmjs.org/minimatch\n\n&gt; chokidar@0.4.0 postinstall /usr/local/lib/node_modules/testacular/node_modules/chokidar\n&gt; node setup.js postinstall\n\nnpm ERR! error installing chokidar@0.4.0\nnpm WARN This failure might be due to the use of legacy binary \"node\" \nnpm WARN For further explanations, please read\nnpm WARN /usr/share/doc/nodejs/README.Debian\nnpm WARN \nnpm ERR! error installing testacular@0.0.17\n\nnpm ERR! Error: ENOENT, lstat '/usr/local/lib/node_modules/testacular/node_modules/___minimatch.npm/package/minimatch.js'\nnpm ERR! You may report this log at:\nnpm ERR!     &lt;http://bugs.debian.org/npm&gt;\nnpm ERR! or use\nnpm ERR!     reportbug --attach /home/adio/workspace/java/tutorial/angularJS/npm-debug.log npm\nnpm ERR! \nnpm ERR! System Linux 3.5.0-17-generic\nnpm ERR! command \"/usr/bin/nodejs\" \"/usr/bin/npm\" \"install\" \"-g\" \"testacular\"\nnpm ERR! cwd /home/adio/workspace/java/tutorial/angularJS\nnpm ERR! node -v v0.6.19\nnpm ERR! npm -v 1.1.4\nnpm ERR! path /usr/local/lib/node_modules/testacular/node_modules/___minimatch.npm/package/minimatch.js\nnpm ERR! fstream_path /usr/local/lib/node_modules/testacular/node_modules/___minimatch.npm/package/minimatch.js\nnpm ERR! fstream_type File\nnpm ERR! fstream_class FileWriter\nnpm ERR! code ENOENT\nnpm ERR! message ENOENT, lstat '/usr/local/lib/node_modules/testacular/node_modules/___minimatch.npm/package/minimatch.js'\nnpm ERR! errno {}\nnpm ERR! fstream_stack Object.oncomplete (/usr/lib/nodejs/fstream/lib/writer.js:204:26)\nnpm ERR! error rolling back testacular@0.0.17 Error: ENOTEMPTY, rmdir '/usr/local/lib/node_modules/testacular/node_modules/___glob.npm/package/test'\n\nnpm ERR! chokidar@0.4.0 postinstall: `node setup.js postinstall`\nnpm ERR! `sh \"-c\" \"node setup.js postinstall\"` failed with 1\nnpm ERR! \nnpm ERR! Failed at the chokidar@0.4.0 postinstall script.\nnpm ERR! This is most likely a problem with the chokidar package,\nnpm ERR! not with npm itself.\nnpm ERR! Tell the author that this fails on your system:\nnpm ERR!     node setup.js postinstall\nnpm ERR! You can get their info via:\nnpm ERR!     npm owner ls chokidar\nnpm ERR! There is likely additional logging output above.\nnpm ERR! \nnpm ERR! System Linux 3.5.0-17-generic\nnpm ERR! command \"/usr/bin/nodejs\" \"/usr/bin/npm\" \"install\" \"-g\" \"testacular\"\nnpm ERR! cwd /home/adio/workspace/java/tutorial/angularJS\nnpm ERR! node -v v0.6.19\nnpm ERR! npm -v 1.1.4\nnpm ERR! code ELIFECYCLE\nnpm ERR! message chokidar@0.4.0 postinstall: `node setup.js postinstall`\nnpm ERR! message `sh \"-c\" \"node setup.js postinstall\"` failed with 1\nnpm ERR! errno {}\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /home/adio/workspace/java/tutorial/angularJS/npm-debug.log\nnpm not ok\n</code></pre>\n\n<p>anybody ran into this problem ? </p>\n\n<p>thanks in advance for help.</p>\n"},{"tags":["node.js","express","websocket","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13227199,"title":"sockect.io difference between creating http server and not creating http","body":"<p>I am trying to create a new notifier system using nodejs, for that i am using socket.io. what is the difference between the below two codings. </p>\n\n<p>Coding 1: //Created a HTTP server and Socket connection</p>\n\n<pre><code>var app = require('express').createServer() \nvar io = require('socket.io').listen(app); \napp.listen(8080);\n</code></pre>\n\n<p>Coding 2: //only created Socket connection</p>\n\n<pre><code>var io = require('socket.io').listen(8080);\n</code></pre>\n\n<p>Please suggest?</p>\n"},{"tags":["javascript","node.js","date"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":13,"score":2,"question_id":13234865,"title":"JavaScript Node.js Date Comparison and Array sort by Date","body":"<p>First, does JavaScript have no basic Date comparision the way Python might?</p>\n\n<p>In my Node.js script, I have the following lines:</p>\n\n<pre><code>console.log(Date(2012,11,10) &lt; Date(2012, 11, 9))\nconsole.log(Date(2012,11,10) &gt; Date(2012, 11, 9))\n</code></pre>\n\n<p>However, <em>both</em> of these lines return <em>false</em>.</p>\n\n<p>It appears there are tons of questions about \"Date Comparison in JavaScript\".</p>\n\n<p>However, for virtually all of them someone responds with their home-made solution for comparing dates, some of them quite long and/or \"hacky\".</p>\n\n<p>Is there really no inherent or idiomatic way to simply compare dates in JavaScript.<br>\nDo any Node libraries support it?</p>\n"},{"tags":["node.js","nginx","request"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13232035,"title":"Nginx+Node.js sometimes the request failes when the data to be retrived is big data (>15KB, 64KB)","body":"<p>I have a problem with google chrome and other browsers when retrieving a big data like 16KB or 64KB.. This doesn't happen all the time, but sometimes it happens and then happens even on refresh, I have to refresh about 5 times to make it work sometimes. And only happens with big data. So I don't really know what is the problem. I notice that it times out always at 1.1m.</p>\n\n<p>In the network panel in developer mode when I don't click on any of the requests (general view) I can see my request with the method post (see image):</p>\n\n<p><img src=\"http://i.stack.imgur.com/odhM4.jpg\" alt=\"enter image description here\"></p>\n\n<p>In nginx error logs it shows up something like this:</p>\n\n<blockquote>\n  <p>2012/11/05 12:05:36 [crit] 2344#0: *10327 open() \"/var/lib/nginx/proxy/3/16/0000000163\"       failed (13: Permission denied) while reading upstream, client: 192.168.1.56, server: , request: \"POST /production/assembly/rpc?nocache=1352117111478 HTTP/1.1\", upstream: \"http://127.0.0.1:3000/rpc?nocache=1352117111478\", host: \"192.168.1.17\", referrer: \"http://192.168.1.17/production/assembly/\"</p>\n</blockquote>\n\n<p>I find this by <code>http://127.0.0.1:3000/rpc?nocache=1352117111478</code>, because the <code>1352117111478</code> part is unique.</p>\n"},{"tags":["javascript","node.js"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":13234327,"title":"calling parseInt on string in node js returns NaN","body":"<p>I'm passing in a Buffer from the client-side using the binaryjs module in node js. This buffer contains a pipe delimited string that I eventually parse on the server.</p>\n\n<p>On the client side I convert a String to a Uint8Array. My String looks something like this:</p>\n\n<pre><code>var stringToConvert = 'A_1_22|B_2_33|C_3_44';\n</code></pre>\n\n<p>When this Uint8Array is passed to my server, it's received as a Buffer. I first chunk together the Buffer into an array:</p>\n\n<pre><code>var parts = [];\n// ...\n// as data is received:\nparts.push(data);\n</code></pre>\n\n<p>When I have all the data streamed, I convert this array to a String and split by \"|\":</p>\n\n<pre><code>var arrayString = parts.toString().split(\"|\");\n</code></pre>\n\n<p>This gets me the desired array output:</p>\n\n<pre><code>arrayString = ['A_1_22', 'B_2_33', 'C_3_33'];\n</code></pre>\n\n<p>I then iterate over this arrayString and split again by \"_\".</p>\n\n<pre><code>for(var i = 0; i &lt; arrayString.length; i++)\n{\n    var thisArray = arrayString[i].split(\"_\");\n    // ...\n</code></pre>\n\n<p>The problem occurs when I try to iterate over thisArray to convert the second and third values to ints:</p>\n\n<pre><code>var intVal1 = parseInt(thisArray[1]); // returns NaN\nvar intVal2 = parseInt(thisArray[2]); // returns NaN\nconsole.log(typeof thisArray[1]); // returns string\n</code></pre>\n\n<p>Running the identical code on the client side properly converts the strings to ints. Not sure what I'm missing here?</p>\n"},{"tags":["javascript","testing","node.js","jasmine"],"answer_count":3,"favorite_count":2,"up_vote_count":18,"down_vote_count":0,"view_count":4419,"score":18,"question_id":4144686,"title":"How to write a test which expects an Error to be thrown","body":"<p>I'm trying to write a test for the <a href=\"http://pivotal.github.com/jasmine\">Jasmine Test Framework</a> which expects an error. At the moment I'm using a <a href=\"https://github.com/sconover/jasmine-node\">jasmine nodejs integration from github</a>.</p>\n\n<p>In my nodejs module I have the following code:</p>\n\n<pre><code>throw new Error(\"Parsing is not possible\");\n</code></pre>\n\n<p>Now I try to write a test which expects this error:</p>\n\n<pre><code>describe('my suite...', function() {\n    [..]\n    it('should not parse foo', function() {\n    [..]\n        expect(parser.parse(raw)).toThrow(new Error(\"Parsing is not possible\"));\n    });\n});\n</code></pre>\n\n<p>I tried also <code>Error()</code> and some other variants and just can't figure out how to make it work.</p>\n\n<p>Here is the code of the jasmine lib where toThrow is defined:</p>\n\n<pre><code>jasmine.Matchers.prototype.toThrow = function(expected) {\n  var result = false;\n  var exception;\n  if (typeof this.actual != 'function') {\n    throw new Error('Actual is not a function');\n  }\n  try {\n    this.actual();\n  } catch (e) {\n    exception = e;\n  }\n  if (exception) {\n    result = (expected === jasmine.undefined || this.env.equals_(exception.message || exception, expected.message || expected));\n  }\n\n  var not = this.isNot ? \"not \" : \"\";\n\n  this.message = function() {\n    if (exception &amp;&amp; (expected === jasmine.undefined || !this.env.equals_(exception.message || exception, expected.message || expected))) {\n      return [\"Expected function \" + not + \"to throw\", expected ? expected.message || expected : \" an exception\", \", but it threw\", exception.message || exception].join(' ');\n    } else {\n      return \"Expected function to throw an exception.\";\n    }\n  };\n\n  return result;\n};\n</code></pre>\n"},{"tags":["node.js","redis","distributed-computing","publish-subscribe"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12555746,"title":"Distributed pub/sub with single consumer per message type","body":"<p>I have no clue if it's better to ask this here, or over on Programmers.SE, so if I have this wrong, please migrate.</p>\n\n<p>First, a bit about what I'm trying to implement. I have a node.js application that takes messages from one source (a socket.io client), and then does processing on the message, which might result in zero or more messages back out, either to the sender, or other clients within that group.</p>\n\n<p>For the processing, I would like to essentially just shove the message into a queue, then it works its way through various message processors that might kick off their own items, and eventually, the bit running socket.io is informed \"Hey, send this message back\"</p>\n\n<p>As a concrete example, say a user signs into the service, that sign in message is then placed in the queue, where the authorization processor gets it, does it's thing, then places a message back in the queue saying the client's been authorized. This goes back to the socket.io socket that is connected to the client, along with other clients that might be interested. It can also go to other subsystems that might want to do more processing on authorization (looking up user info, sending more info to the client based on their data, etc).</p>\n\n<p>If I wanted strong coupling, this would be easy, but I tried that before, and it just goes to a mess of spaghetti code that's very fragile, and I would like to avoid that. Another wrench in the setup is this should be cluster-able, which is where the real problem comes in. There might be more than one, say, authorization processor running. But the authorization message should be processed only once.</p>\n\n<p>So, in short, I'm looking for a pattern/technique that will allow me to, essentially, have multiple \"groups\" of subscribers for a message, and the message will be processed only once per group.</p>\n\n<p>I thought about maybe having each instance of a processor generate a unique name that would be used as a list in Reids. This name would then be registered with some sort of dispatch handler, and placed into a set for that group of subscribers. Then when a message arrives, the dispatch pulls a random member out of that set, and places it into that list. While it seems like this would work, it seems somewhat over-complicated and fragile. </p>\n\n<p>The core problem is I've never designed a system like this, so I'm not even sure the proper terms to use or look up. If anyone can point me in the right direction for this, I would be most appreciative. </p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1345,"score":6,"question_id":10058814,"title":"Get data from fs.readFile","body":"<pre><code>    var content;\n    fs.readFile('./Index.html', function read(err, data) {\n        if (err) {\n            throw err;\n        }\n        content = data;\n    });\n    console.log(content);\n</code></pre>\n\n<p>Error: content is undefined. Can you help me?</p>\n"},{"tags":["node.js","socket.io"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13233615,"title":"NodeJS and Socket.IO to keep track of user visit time High performance","body":"<p>I've build an application with node and socket.io to keep track when a visitor visits a page, and leaves. When the visitor leaves I store the time the visitor was on the page to redis. That's all the application has to do. </p>\n\n<p>Here's the thing, the application needs to support ~15k concurrent connections, but i'm getting allot of handshake errors when the benchmark hits around 10.000 conc. visitors. I don't know why exactly. Does anyone have any experience with these kind of problems? </p>\n\n<p>I also tried scaling the application in multiple processes, using the RedisStore backend for node but haven't had much success. </p>\n"},{"tags":["javascript","node.js","asynchronous","coffeescript"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13224663,"title":"Scoping issue with prototypes and async.forEach","body":"<p>I have a scope issue that I don't understand.</p>\n\n<p>I have this object with some methods:</p>\n\n<pre><code>FileInfo = (file) -&gt;\n   @name = path.basename(file.path);\n\nFileInfo::uploadImage = (filename, callback) -&gt;\n\nFileInfo::handleImage = (version, callback) -&gt;\n   # Here I would like to call uploadImage\n</code></pre>\n\n<p>I am calling handleImage from an async.forEach loop as:</p>\n\n<pre><code>async.forEach options, fileInfo.handleImage,  (err) -\n</code></pre>\n\n<p>I would like to call uploadImage from within handleImage but I get TypeError: Object # has no method 'uploadImage'</p>\n\n<p>I have tried, inside of handleImage, the following:</p>\n\n<pre><code>this.uploadImage\n</code></pre>\n\n<p>as well as:</p>\n\n<pre><code>that = this\nthat.uploadImage\n</code></pre>\n\n<p>Neither work. </p>\n\n<p>If I call fileInfo.handleImage outside of the forEach loop it works fine with either this or that.</p>\n"},{"tags":["node.js","express","stylus"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13225447,"title":"Node.js Express - How do I compile Styleus .styl files into CSS","body":"<p>I'm trying to build an application starting from Balloons (http://balloons.io), which uses Backbone.js and express to setup the UI. I've never used these frameworks, and I'm having a hard time actually making changes.</p>\n\n<p>As I understand it, .styl files are compiled into CSS files. How do I do this compilation?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13227069,"title":"Getting -- TypeError: Object #<Object> has no method 'toSource'","body":"<p>Command Executed :</p>\n\n<pre><code>  arguments.toSource();\n</code></pre>\n\n<p>I am getting the below error when I am accessing the arguments in any funtion to display the arguments.</p>\n\n<pre><code>  TypeError: Object #&lt;Object&gt; has no method 'toSource'\n</code></pre>\n\n<p>Is arguments is array or not ?</p>\n"},{"tags":["javascript","node.js","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13227231,"title":"How to convert asynchronous call to synchronous in javascript?","body":"<p>I am using javascript in client side and node.js in server side, Actually i have tried to make a remote validation for input fields, result must be boolean and it should be based on the server call, My code as follows,</p>\n\n<pre><code> jQuery.validator.addMethod(\"remoteValidation\", function(value, element) {\n\n    var accountName = $(\"#accountName\").val();\n    var accountType = $(\"#accountType\").val();\n    var valid = this.Validation(accountType,accountName);\n   //returning undefined becoz return statement executing before server side execution\n    return valid;\n\n}, \"Entered email or username already exists\");\n\n this.validation = function(accountType,accountName,cb){\n    var valid =null;\n  ss.rpc('AccountsManagement.userNameChecker',accountType,accountName,function(res) {\n            // res will return boolean\n        valid = res;\n    });\n            //valid is null becoz this line is executing before valid = res line.\n    return valid;\n};\n</code></pre>\n\n<p>my server side code:</p>\n\n<pre><code>   services.imAccountsService.getAllImAccounts(accountType,accountName,\n   function(err,result){\n    if(err){\n    return;\n    }\n    if(result == null){\n       res(true);\n    }\n    else{\n       res(false);\n    }\n\n   });\n</code></pre>\n\n<p>My problem is async execution, how to make code synschronous in this situation..</p>\n"},{"tags":["node.js","chat","user-input","livechat"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":213,"score":0,"question_id":8858423,"title":"Olark like software in node.js needed","body":"<p>Do you know any node.js application that do something similar to <a href=\"http://olark.com\" rel=\"nofollow\">http://olark.com</a>. Not necessarily for multiple website, I just need it for single domain.\nI just want to install it myself on heroku and run chat customer support for my website on it.</p>\n\n<p>Thanks,</p>\n\n<p>Michalh</p>\n"},{"tags":["node.js","url","cross-domain"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13230588,"title":"NodeJS refer to another URL","body":"<p>I need to hide reference to another domain from my website. Basically, if someone asks for some file from my web site like so:</p>\n\n<p><a href=\"http://www.mydomain.com/file/12345\" rel=\"nofollow\">http://www.mydomain.com/file/12345</a></p>\n\n<p>it should go to amazon s3, get it and give back. How could this be done?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":358,"score":2,"question_id":10669121,"title":"mongo native ensureIndex does not create index","body":"<p>I am using the mongodb native driver for node. I call <code>ensureIndex({ keywords: 1})</code> after retrieving the collection. When I check in the mongo console, nothing appears when I call <code>db.mycol.getIndexes()</code>.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["javascript","node.js","expresso"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":11939559,"title":"Expresso not installing on Windows 7","body":"<p>Having a problem install Expresso on my machine similar to <a href=\"http://stackoverflow.com/questions/8781135/running-expresso-tdd-in-node-js-on-windows\">this</a>  </p>\n\n<p>windows 7 x64<br>\nnode.js version: 0.8.0<br>\nnpm version: 1.1.32   </p>\n\n<pre><code>&gt; npm install expresso\nnpm http GET https://registry.npmjs.org/expresso\nnpm http 304 https://registry.npmjs.org/expresso\n\n&gt; expresso@0.9.2 preinstall C:\\node_modules\\expresso\n&gt; make deps/jscoverage/node-jscoverage\n\nmake: Interrupt/Exception caught (code = 0xc0000005, addr = 0x0x770843f9)\nnpm ERR! expresso@0.9.2 preinstall: `make deps/jscoverage/node-jscoverage`\nnpm ERR! `cmd \"/c\" \"make deps/jscoverage/node-jscoverage\"` failed with 255\nnpm ERR!\nnpm ERR! Failed at the expresso@0.9.2 preinstall script.\nnpm ERR! This is most likely a problem with the expresso package,\nnpm ERR! not with npm itself.\nnpm ERR! Tell the author that this fails on your system:\nnpm ERR!     make deps/jscoverage/node-jscoverage\nnpm ERR! You can get their info via:\nnpm ERR!     npm owner ls expresso\nnpm ERR! There is likely additional logging output above.\n\nnpm ERR! System Windows_NT 6.1.7601\nnpm ERR! command \"C:\\\\Program Files\\\\nodejs\\\\\\\\node.exe\" \"C:\\\\Program Files\\\\nodejs\\\\n\n\\\\npm\\\\bin\\\\npm-cli.js\" \"install\" \"expresso\"\nnpm ERR! cwd C:\\\nnpm ERR! node -v v0.8.0\nnpm ERR! npm -v 1.1.32\nnpm ERR! code ELIFECYCLE\nnpm ERR! message expresso@0.9.2 preinstall: `make deps/jscoverage/node-jscoverage`\nnpm ERR! message `cmd \"/c\" \"make deps/jscoverage/node-jscoverage\"` failed with 255\nnpm ERR!\nnpm ERR! Additional logging details can be found in:\nnpm ERR!     C:\\npm-debug.log\nnpm ERR! not ok code 0\n</code></pre>\n\n<p>any help would be greatly appreciated.</p>\n"},{"tags":["node.js","mongodb","indexing","geospatial","mongoskin"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13108288,"title":"MongoDB query against geospatial index with maxDistance fails from node.js client","body":"<p>I want to query against a geospatial index in mongo-db (designed after this tutorial <a href=\"http://www.mongodb.org/display/DOCS/Geospatial+Indexing\" rel=\"nofollow\">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a>).</p>\n\n<p>So when I execute this from the shell everything works fine:</p>\n\n<pre><code>db.sellingpoints.find(( { location : { $near: [48.190120, 16.270895], $maxDistance: 7 / 111.2 } } );\n</code></pre>\n\n<p>but the same query from my nodejs application (using mongoskin or mongoose), won't return any results until i set the distance-value to a very high number (5690)</p>\n\n<pre><code>db.collection('sellingpoints')\n .find({ location: { $near: [lat,lng], $maxDistance: distance / 111.2} })\n .limit(limit)\n .toArray(callback);\n</code></pre>\n\n<p>Has someone any idea how to fix that?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13127667,"title":"Howto handle a data stream over a fragile connection with Node.js?","body":"<p>I would like to start using Node.js for a project I'll be working on.</p>\n\n<p>I have streaming position information in an electric car, and I'd like to store this locally on a small database in the car and synchronize it over a (fragile) 3G connection, when this connection is up, to a server with a large DB. So:</p>\n\n<pre>\n                     Car Os    3G    Server OS\nData stream   --->   ------   --->   ---------\n                     Node.js         Node.js\n                     MongoDB         MongoDB\n                     Small DB        Large DB\n</pre>\n\n<p>The part that I'm worried about is how to sync the local DB to the server DB over a non-continuous 3G connection. What Node.js module is perfect for this job?</p>\n\n<p>Thank you for your advice!   </p>\n"},{"tags":["node.js","npm","nodester"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":11552079,"title":"nodester node version error","body":"<p>Every time I try to install a module or list the installed modules with <code>nodester npm</code>, I end up with this.</p>\n\n<pre><code>nodester Error: npm doesn't work with node v0.8.1\nnodester Required: node@0.4 || 0.5 || 0.6\nnodester     at /usr/lib/node_modules/npm/bin/npm-cli.js:57:23\nnodester     at Object.&lt;anonymous&gt; (/usr/lib/node_modules/npm/bin/npm-cli.js:77:\n3)\nnodester     at Module._compile (module.js:449:26)\nnodester     at Object.Module._extensions..js (module.js:467:10)\nnodester     at Module.load (module.js:356:32)\nnodester     at Function.Module._load (module.js:312:12)\nnodester     at Module.runMain (module.js:487:10)\nnodester     at process.startup.processNextTick.process._tickCallback (node.js:2\n</code></pre>\n\n<p>Does anyone know what this message actually means? I can't seem to find any information on it.\nIt's talking about the version of npm on the nodester server judging by the path (I'm on Windows).</p>\n"},{"tags":["node.js","stdin","phantomjs","external-process","child-process"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13230370,"title":"Nodejs Child Process: write to stdin from an already initialised process","body":"<p>I am trying to spawn an external process <code>phantomjs</code> using node's <code>child_process</code> and then send information to that process after it was initialized, is that possible?</p>\n\n<p>I have the following code:</p>\n\n<pre><code>var spawn = require('child_process').spawn,\n    child = spawn('phantomjs');\n\nchild.stdin.setEncoding = 'utf-8';\nchild.stdout.pipe(process.stdout);\n\nchild.stdin.write(\"console.log('Hello from PhantomJS')\");\n</code></pre>\n\n<p>But the only thing I got on the stdout is the initial prompt for phantomjs console.</p>\n\n<pre><code>phantomjs&gt; \n</code></pre>\n\n<p>So it seems the <code>child.stdin.write</code> is not making any effect.</p>\n\n<p>I am  not sure I can send additional information to phantomjs ater the initial spawn.</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["javascript","node.js","stream","buffer"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13230487,"title":"Converting a Buffer into a ReadableStream in nodejs","body":"<p>I'm fairly new to Buffers and ReadableStreams, so maybe this is a stupid question. I have a library that takes as input a ReadableStream, but my input is just a base64 format image. I could convert the data I have in a Buffer like so:</p>\n\n<pre><code>var img = new Buffer(img_string, 'base64');\n</code></pre>\n\n<p>But I have no idea how to convert it to a ReadableStream or convert the Buffer I obtained to a ReadableStream.</p>\n\n<p>Is there a way to do this or am I trying to achieve the impossible?</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","iis"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":49,"score":3,"question_id":13217114,"title":"How to access a shared network drive in node.js","body":"<p>In IIS, I have a web service which runs under an application pool which has the identity of a user that has access to a drive on a remote machine. In this way, when the web service runs and it tries access the remote machine to read a file, we do not get any invalid authorization errors.</p>\n\n<p>I have now written my first Node.js app but I am not sure how to allow access to a file stream from the app to the remote machine. I have the unc path name to the remote machine's file I want to read but I am not sure if I have to pass in the credentials of the user to access the file or I have to run the Node.js app under certain credentials.</p>\n\n<p>Any clues?</p>\n\n<p>I know there is node for IIS, but is there another way of doing this without IIS.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Just ran my app under my user account and this account is configured to allow access to a remote machine and I have access to the remote machine without changing my code (in other words just using the Unc path directly). However, how can I do this using another user's credentials (i.e. impersonation in Node.js?)</p>\n"},{"tags":["node.js","imagemagick"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12582652,"title":"Resizing images using imagemagick in node.js","body":"<p>In my application i tried to resize the image using imagemagick but i got following error error while resizing: imagesexecvp(): No such file or directory.this is my code</p>\n\n<pre><code>   im.resize({\n  srcPath:  '/tmp/Images/' + req.files.image.name,\n  dstPath: 'resized_'+req.files.image.name ,\n  width:42,\n  height:42\n}, function(err, stdout, stderr){\n  if (err) {\n\n      console.log('error while resizing images' + stderr);\n  };\n});\n</code></pre>\n"},{"tags":["javascript","node.js","parser-generator","peg"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13223758,"title":"Generated parser throws error for escaped quotes on Node.js","body":"<p>I am using <a href=\"http://pegjs.majda.cz/\" rel=\"nofollow\">PEG.js</a> to create a parser which includes parsing strings.<br>\nThe strings containing any kind of character are wrapped by quotes <code>\"</code> and may contain escaped quotes <code>\\\"</code>.<br>\nSo far I have the following rule:</p>\n\n<pre><code>start\n    = [\"] string:(( '\\\\\"' {return '\"';} / [^\"])*) [\"]\n        {return string.join('');}\n</code></pre>\n\n<p>It works in the <a href=\"http://pegjs.majda.cz/online\" rel=\"nofollow\">PEG.js Online Version</a> and produces <code>\"abc\\\"def\"</code> for the given input <code>\"abc\\\"def\"</code>.</p>\n\n<p>The parser generated for Node.js version 0.6.21 with PEG.js version 0.7.0 is executed the following way</p>\n\n<pre><code>var result = parser.parse('\"abc\\\"def\"');\n</code></pre>\n\n<p>and produces the following error:</p>\n\n<pre><code>{ name: 'SyntaxError',\n  expected: [],\n  found: 'd',\n  message: 'Expected end of input but \"d\" found.',\n  offset: 5,\n  line: 1,\n  column: 6 }\n</code></pre>\n\n<p>However, using <code>\\\\\"</code> instead of <code>\\\"</code> succeeds with the expected output.</p>\n\n<pre><code>var result = parser.parse('\"abc\\\\\"def\"'); // parses correctly\n</code></pre>\n\n<p>Is there an explanation or workaround for this problem?\nIn particular, it is not possible for me to double escape all quotes in the expected input of the parser.</p>\n"},{"tags":["php","node.js","command-line","webserver"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13230059,"title":"Using node.js to replace apache/nginx and execute php security","body":"<p>I've got a webserver written in node.js, it pretty much just serves the user with static files. To add PHP support to it I thought i could just download PHP and give PHP.exe the file. That works and will be sufficient if it where to be used by a single user. For an environment where multiple users would host their website on the server it'd however bring along a huge security issue. One could use a PHP script to do whatever he/she would want with any of the other websites or even the entire server.</p>\n\n<p>Oh did i mention it is a windows server?</p>\n\n<p>Anyways, so what i want is to get some permissions working to keep the php script within a specific directory.\nI'm thinking in the direction of creating a user for each website on which I'll apply the appropriate permissions and than when executing php.exe using something like 'run as' (assuming it is possible).\nAre there any other ways for me to achieve my goal? And if so would they be better? Why so?</p>\n\n<p>Also if you're interested, my code looks like: <a href=\"http://pastebin.com/gZjN1mnj\" rel=\"nofollow\">http://pastebin.com/gZjN1mnj</a></p>\n\n<p>Also I'm aware that $_POST, $_SERVER, $_COOKIE, $_SESSION etc. are all missing when using my server, but I've already thought of how to get that fixed and had one succesful test with it.</p>\n\n<p>Now I'm already feeling the responses: why the hell would you do that? OR don't, apache/nginx are better, etc. etc.\nConsider it a learning process, I was just interested whether i could get it all to actually work ^^</p>\n\n<p>Thank you.</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":14,"score":1,"question_id":13229556,"title":"NodeJS : outputting a string using Express EJS Template","body":"<p>I have a code where on error I return a status with an error message:</p>\n\n<pre><code>if (err){\n        res.render('page1', {status:2, msg:'Server Error : Probable unable to connect'});\n        return;\n}\n</code></pre>\n\n<p>In my page1.ejs, I have coded the following way:</p>\n\n<pre><code>    var status = &lt;%= status %&gt;;\n    alert ( 'The status = ' + status);\n    if( status == 2)\n    {\n            var msg = \"'\" + &lt;%= msg %&gt; + \"'\";\n            alert(msg);\n    }\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>    if( status == 2)\n    {\n            alert('\"' + &lt;%= msg %&gt; + \"'\");\n    }\n</code></pre>\n\n<p>I am trying to get the value of status and msg - but since 'msg' exists as multiple words I am not able to find a way to capture complete strings as passed from NodeJS. Firebug shows error as:</p>\n\n<p>SyntaxError: missing ) after argument list</p>\n\n<pre><code>alert('\"' + Server Error : Probable unable to connect+ \"'\");\n-------------------|\n</code></pre>\n"},{"tags":["ajax","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13227287,"title":"Problems with AJAX and node.js interaction","body":"<p>I am new to node.js and I am trying sending data from AJAX to Node.js server and getting back the things.My server side code is</p>\n\n<pre><code>var http = require('http');\nvar url=require('url');\nhttp.createServer(function (req, res) {\n    console.log(req.url);\n     var url_parts = url.parse(req.url, true);\n    switch(url_parts.pathname)\n    {\n        case '/':\n        res.writeHead(302,{'location':'http://localhost/testajax/index.html'});\n        res.end();\n        break;\n        case '/test':\n    console.log('request received');\n    res.writeHead(200, {'Content-Type': 'text/html'});\n    console.log(url_parts.query[\"page\"]);\n    res.end(url_parts.query[\"page\"]);\n    break;\n}\n}).listen(8124);\n</code></pre>\n\n<p>And that running on client side is</p>\n\n<pre><code>   &lt;script type=\"text/javascript\"&gt;\n\n   $(document).ready(function() {\n    $('a').click(function(){\n\n            $.get('http://localhost:8124/test', {'page':$(this).text()}, function(data){\n            alert(data);\n                $('#content').html(data);\n\n            });                       \n\n        });\n\n    });\n\n    &lt;/script&gt;\n</code></pre>\n\n<p>The content is in the <code>&lt;div&gt;</code> but that doesnt show up neither does it alert anything.On consoling the browser I get this error.</p>\n\n<pre><code>XMLHttpRequest cannot load http://localhost:8124/test?page=ProfilePage. Origin http://localhost is not allowed by Access-Control-Allow-Origin.\n</code></pre>\n\n<p>Is this a wrong way of doing things?Please help.</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13225044,"title":"Why do I keep getting the ReferenceError in node.js","body":"<p>I'm going the the Smashing Node.JS book and I keep getting a Reference Error when doing the file-explorer example. Why is this occurring and how can I correct the problem. I've follow the example in the book so I'm a little lost as to what's happening </p>\n\n<pre><code>    /**\n* Module dependencies. \n*/ \n\n    var fs = require('fs')\n        , stdin = process.stdin\n        , stdout = process.stdout;\n\n    fs.readdir(process.cwd(), function (err, files) {\n      console.log('');\n\n     if (!files.length) {\n      return console.log('  \\033[31m No files to show!\\033[39m\\n'); \n     } \n\n      console.log(' Select which file or directory you want to see\\n');\n\n      function file(i) {\n    var filename = files[i]; \n\n    fs.stat(__dirname + '/' + filename, function (err, stat) {\n      if (stat.isDirectory()) {\n        console.log('   '+i+'   \\033[36m' + filename + '/\\033[39m'); \n      } else {\n        console.log('       '+i+'   \\033[90m' + filename + '\\033[39m')\n      }\n\n      if (++i == files.length) {\n        read();\n      } else{\n        file(i); \n      }\n    });\n  }\n\n  file(0); \n});\n\nfunction read() {\n    console.log(''); \n    stdout.write('  \\033[33mEnter your choice: \\033[39m');\n\n    stdin.resume(); \n    stdout.setEncoding('utf8'); \n\n    stdin.on('data', option); \n\n    function option( data ) {\n        if (typeof files[Number(data)] !== \"undefined\" ) {\n            stdout.write('  \\033[31mEnter your choice: \\033[39m');\n        } else {\n            stdin.pause(); \n        }\n    }\n\n}\n</code></pre>\n"},{"tags":["linux","node.js","service","redhat"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13228305,"title":"How to setup a Node.js application as a service on Red Hat Linux","body":"<p>I created a node.js application. It is a web server with the Express framework. I can start it with the command <code>node server.js</code>. This application is deployed on a Red Hat Enterprise server. </p>\n\n<p>I want this applicaion can:</p>\n\n<ol>\n<li>Start automatically when the OS is started.</li>\n<li>Restart automatically when it crashes.</li>\n</ol>\n\n<p>I think OS service can meet my requirements, right? Is there any clue how to setup the Node.js application as service on Red Hat?</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13227882,"title":"Getting ERROR axconfig: port 1 not active with Node Js","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2424346/getting-error-while-running-simple-javascript-using-node-framework\">Getting error while running simple javascript using node framework</a>  </p>\n</blockquote>\n\n\n\n<p>I have Installed Node.js as ::</p>\n\n<pre><code>git clone https://github.com/joyent/node.git\ncd node\ngit checkout v0.6.18 #Try checking nodejs.org for what the stable version is\n./configure\nmake\nsudo make install\n</code></pre>\n\n<p>but I am getting \" axconfig: port 1 not active with Node Js\" Error when running node command.</p>\n"},{"tags":["node.js","ssl","express","socket.io"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13228422,"title":"SSL authentication between 2 nodejs servers","body":"<p>I followed <a href=\"http://www.gettingcirrius.com/2012/06/securing-nodejs-and-express-with-ssl.html\" rel=\"nofollow\">this</a> guide to secure my current express app with SSL client authentication (I'm using socket.io module for websockets). My app requires multiple node.js servers and I need to send messages between them. </p>\n\n<p>Let A and B be two of that node.js servers and let's say that B wants to start a communication with A. Right now I'm simply using the socket.io-client module for opening a socket between them but this is not a valid option for me: anybody who knows A's URL could open a websocket and start sending messages to A. A needs in some way to verify that it can really rely on B.</p>\n\n<p>Is it possible? I did not found any node.js module that meets my needs.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["node.js","proxy","express","reverse-proxy"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":652,"score":0,"question_id":10435407,"title":"Proxy with express.js","body":"<p>To avoid same-domain AJAX issues, I want my node.js web server to forward all requests to URL <code>/api/BLABLA</code> to another server, for example <code>other_domain.com:3000/BLABLA</code>, and return to user the same thing that this remote server returned, transparently. </p>\n\n<p>All other URLs (beside <code>/api/*</code>) are to be served directly, no proxying.</p>\n\n<p>How do I achieve this with node.js + express.js? Can you give a simple code example?</p>\n\n<p>(both the web server and the remote <code>3000</code> server are under my control, both running node.js with express.js)</p>\n\n<hr>\n\n<p>So far I found this <a href=\"https://github.com/nodejitsu/node-http-proxy/\" rel=\"nofollow\">https://github.com/nodejitsu/node-http-proxy/</a> , but reading the documentation there didn't make me any wiser. I ended up with</p>\n\n<pre><code>var proxy = new httpProxy.RoutingProxy();\napp.all(\"/api/*\", function(req, res) {\n    console.log(\"old request url \" + req.url)\n    req.url = '/' + req.url.split('/').slice(2).join('/'); // remove the '/api' part\n    console.log(\"new request url \" + req.url)\n    proxy.proxyRequest(req, res, {\n        host: \"other_domain.com\",\n        port: 3000\n    });\n});\n</code></pre>\n\n<p>but nothing is returned to the original web server (or to the end user), so no luck.</p>\n"},{"tags":["mvc","node.js","geddy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13215409,"title":"How to load model in to controller with geddy","body":"<p>I have a Locations controller and Location model\nI want to use the the Location model in another controller but calling</p>\n\n<pre><code>geddy.models.Locations.all(...);\n</code></pre>\n\n<p>does not work. It says Locations is undefined.</p>\n\n<p>How do I make it load the model manually? Or should I create a function in the Locations controller to grab the data using a request on the client or a call directly to the controller on the sever?</p>\n"},{"tags":["node.js","express","angularjs","angular"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":13222252,"title":"How to use AngularJS routes with Express (Node.js) when a new page is requested?","body":"<p>I'm using Express, which loads AngularJS from a static directory.  Normally, I will request <code>http://localhost/</code>, in which Express serves me my <code>index.html</code> and all of the correct Angular files, etc.  In my Angular app, I have these routes setup, which replace the content in an <code>ng-view</code>:</p>\n\n<pre><code>$routeProvider.when('/', {\n    templateUrl: '/partials/main.html',\n    controller: MainCtrl,\n});\n\n$routeProvider.when('/project/:projectId', {\n    templateUrl: '/partials/project.html',\n    controller: ProjectCtrl,\n});\n\n$locationProvider.html5Mode(true);\n</code></pre>\n\n<p>On my main page, I have a link to <code>&lt;a href=\"/project/{{project.id}}\"&gt;</code>, which will successfully load the template and direct me to <code>http://localhost/project/3</code> or whatever ID I have specified.  The problem is when I try to direct my browser to <code>http://localhost/project/3</code> or refresh the page, the request is going to the Express/Node server, which returns <code>Cannot GET /project/3</code>.  </p>\n\n<p>How do I setup my Express routes to accommodate for this?  I'm guessing it will require the use of <a href=\"http://docs.angularjs.org/guide/dev_guide.services.%24location\" rel=\"nofollow\"><code>$location</code></a> in Angular (although I'd prefer to avoid the ugly ?searches and #hashes they use), but I'm clueless about how to go about setting up the Express routes to handle this.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13226815,"title":"node js sending json body in response","body":"<p>re-posting this question with different information.</p>\n\n<p>I have 3 parameters.</p>\n\n<pre><code>  response.writeHead(200, \n        {       \n         'Content-Type': 'text/json'            \n        });      \n      response.end({ID:'bufid',Name: bufname,address: bufaddrss});\n\n    }\n</code></pre>\n\n<p>This is not working.\nHere I want to send to the end user in 200 Ok a JSON Body as:</p>\n\n<pre><code>{'ID; :'123',\n  'Name': 'alice',\n   'address': 'xxxxx'}\n</code></pre>\n\n<p>Here bufid,bufname and bufaddrss are  values which are determined by functions and which can be accessible any where (they are global)</p>\n\n<p>how can I send that information</p>\n"},{"tags":["node.js"],"answer_count":3,"favorite_count":8,"up_vote_count":43,"down_vote_count":0,"view_count":11593,"score":43,"question_id":3133243,"title":"How to get path to current script with node.js?","body":"<p>How would I get the path to the script in node.js? I know there's <code>process.cwd</code>, but that only refers to the directory where the script was called, not of the script itself.  For instance, say I'm in <code>/home/kyle/</code> and I run the following command:</p>\n\n<pre><code>node /home/kyle/some/dir/file.js\n</code></pre>\n\n<p>If I call <code>process.cwd()</code>, I get <code>/home/kyle/</code>, not <code>/home/kyle/some/dir/</code>.  Is there a way to get that directory?</p>\n"},{"tags":["node.js","mongodb","nosql","express"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":311,"score":0,"question_id":9589104,"title":"Web development frameworks using MongoDB","body":"<p>I used Node.js / Express.js with MongoDB. Unfortunately, there were parts missing for me that kept me back from using Node.js</p>\n\n<p>So I was wondering, could you list me some web development frameworks that natively support MongoDB? Whatever the programming langage it uses, I don't mind learning something new.</p>\n\n<p>Thanks!</p>\n"},{"tags":["node.js","mongodb","express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":29,"score":-4,"question_id":13226423,"title":"Storing values from URL to mongodb","body":"<p>HI I am able to store values locally using mongodb but i want to hit a url from node and then i shud store its response in mongodb.Will i be able to do that? Kindly suggest some way.Any help would be much appreciated.</p>\n"},{"tags":["node.js","rxjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":10407318,"title":"RxJS + node.js HTTP server implementation?","body":"<p>I 've been well with node.js until RxJS implementation.</p>\n\n<p>Here is my trial code studying-</p>\n\n<p><strong>Reactive-Extensions / rxjs-node\n<a href=\"https://github.com/Reactive-Extensions/rxjs-node\" rel=\"nofollow\">https://github.com/Reactive-Extensions/rxjs-node</a></strong></p>\n\n<hr>\n\n<p>rx_http.js<br>\n(RxJS wrapper of the http lib of node.js)</p>\n\n<pre><code>var Rx = require(\"./rx.min\");\nvar http = require(\"http\");\nfor(var k in http)\n{\n    exports[k] = http[k];\n}\nexports.createServer = function ()\n{\n    var subject = new Rx.AsyncSubject();\n    var observable = subject.asObservable();\n    observable.server = http.createServer(function (request, response)\n    {\n       subject.onNext({ request:request, response:response });\n       subject.onCompleted();\n    });\n    return observable;\n};\n</code></pre>\n\n<hr>\n\n<p>server.js </p>\n\n<pre><code>var http = require('./rx_http');\n\n// rxServer\nvar serverObservable = http.createServer();\nvar port = 3000;\nserverObservable.server.listen(port);\nconsole.log(\"Server listening on port: \"+port);\n\n// HTTP request event loop function\nserverObservable.subscribe(function (data)\n{\n    var req = data.request;\n    console.log(req.headers);\n\n    var res = data.response;\n    res.writeHead(200, {'Content-Type':\"text/html\"});\n    res.end(\"hello world\");\n\n    console.log(\"res content out\");\n});\n\n// exceptiopn\nprocess.on('uncaughtException', function (err)\n{\n    console.log(['Caught exception:', err.message].join(\" \"));\n});\n</code></pre>\n\n<hr>\n\n<p>The code ends up with one-time 'hello world' output to browser, and the RxServer stops reacting to another access (brwoser reload etc.).</p>\n\n<p>I'm on the way to learn RxJS thing, but few documentation found on the web.</p>\n\n<p>Tell me what's wrong with the code, and if you know better implementations, please share.\nThank you.</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13225530,"title":"what are the different node js npm install options","body":"<p>what is the difference between</p>\n\n<pre><code> npm install express \n npm install -g express\n</code></pre>\n\n<p>if you can also point me to a link which explains these options it will be very useful</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13225217,"title":"File validation with fs.stat always fail","body":"<p>I wrote a little function to validate a path image:</p>\n\n<pre><code>var validateImage = function(image) {\n  fs.stat('/images/' + image, function(err, stats) {\n    if(stats.isFile()) {\n      return true;\n    }\n  });\n};\n</code></pre>\n\n<p>It simply checks if the image parameter, that would be something like <code>\"myimage.jpg\"</code> exists under my public/images directory.</p>\n\n<p>I can access the image at:</p>\n\n<pre><code>http://127.0.0.1:3000/images/myimage.jpg\n</code></pre>\n\n<p>However <code>validateImage(\"myimage.jpg\")</code> always return false.</p>\n\n<p>The images directory is under <code>/public</code>, which is defined at my app.js:</p>\n\n<pre><code>app.use(express.static(path.join(__dirname, 'public')));\n</code></pre>\n\n<p>What am I missing?</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":665,"score":2,"question_id":11059211,"title":"Error Running Grunt - Module is undefined","body":"<p>New Grunt user here who is using a lot of new tools (npm nodejs) today.</p>\n\n<p>I've got Grunt \"installed\" and have been able to create a grunt.js file using the init task as described here: <a href=\"http://net.tutsplus.com/tutorials/javascript-ajax/meeting-grunt-the-build-tool-for-javascript/\" rel=\"nofollow\">http://net.tutsplus.com/tutorials/javascript-ajax/meeting-grunt-the-build-tool-for-javascript/</a> and here: <a href=\"https://github.com/cowboy/grunt/blob/master/docs/getting_started.md\" rel=\"nofollow\">https://github.com/cowboy/grunt/blob/master/docs/getting_started.md</a>. But whenever I run the \"grunt\" command I get an error:</p>\n\n<pre>\nWindows Script Host\nScript: c:\\users\\[]\\Documents\\code\\grunt\\grunt.js\nLine: 2\nChar: 1\nError: 'module' is undefined\nCode: 800A1391\nSource: Microsoft JScript runtime error\n</pre>\n"},{"tags":["node.js","everyauth"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13106088,"title":"node.js everyauth twitter mongodb error: You are trying to access the attribute/method configured by `findUserById`, which you did not configure?","body":"<p>In the <code>findOrCreateUser</code> function, I'm returning a <code>promise</code>, that I then fulfill with a user document from mongoDB.</p>\n\n<p>Then it gives this error <code>You are trying to access the attribute/method configured by findUserById, which you did not configure</code></p>\n\n<p>I used this guy's tutorial <a href=\"http://nodetuts.com/tutorials/26-starting-with-everyauth.html#video\" rel=\"nofollow\">http://nodetuts.com/tutorials/26-starting-with-everyauth.html#video</a> He didn't do any of that. Why does it even need a <code>findUserById</code> function? I'm returning to it the entire document, not just an id.</p>\n\n<p>So, yeah, how do I correct this? I thought after you returned your <code>promise</code>, everyauth was good to go.</p>\n"},{"tags":["php","javascript","linux","node.js","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13159795,"title":"Raspberry Node.js & Execute command","body":"<p>I'm trying to execute a Linux command from a webpage with node.js, socket.io and (I think...) PHP. I watched <a href=\"https://www.youtube.com/watch?v=SWSpRyCDfZE&amp;feature=g-all-u\" rel=\"nofollow\">this YouTube video</a>, and I'd like to do the same thing, but I don't know how.</p>\n\n<p>Could you give me an example?</p>\n"},{"tags":["node.js","azure","windows-azure-storage","azure-storage-tables"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13214680,"title":"Azure query using the select","body":"<p>I am trying to get a query in azure in which I want to get the entity with the given partition key and row key based on Date.</p>\n\n<p>I am keeping entities \nPartisionkey, row key, Date, Additional info.</p>\n\n<p>I am looking for a query using tableservies so that , \nI always get the latest one (using date)</p>\n\n<p>How can I get the query? (I am using node and Azure)</p>\n\n<pre><code>                TableQuery\n        .select()\n        .from('myusertables')\n        .where('PartitionKey eq ?', '545455');\n</code></pre>\n\n<p>How write the table query?</p>\n"},{"tags":["node.js"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1440,"score":1,"question_id":3782571,"title":"Basic node.js question: handling an exception","body":"<p>Consider the following code:</p>\n\n<pre><code>var meryl = require('meryl'),\n  merylex = require('meryl-extras'),\n  staticfile = merylex('staticfile'),\n  httpserv = require('http');\n\nmeryl.p('GET /static/&lt;filepath&gt;', staticfile({root: 'static', path: 'filepath'}));\n\nhttpserv.createServer(meryl.cgi()).listen(3000);\n</code></pre>\n\n<p>This works great, until you request a file that doesn't exist. If I request <code>/static/non-existent-file</code>, the server crashes and says:</p>\n\n<blockquote>\n<pre>/home/user/.node_libraries/meryl-extras/lib/plugins/staticfile.js:224\n        chain();\n        ^\nTypeError: undefined is not a function\n    at CALL_NON_FUNCTION (native)\n    at /home/user/.node_libraries/meryl-extras/lib/plugins/staticfile.js:224:9\n    at [object Object]. (fs:58:5)\n    at [object Object].emit (events:27:15)\n    at fs:655:12\n    at node.js:608:9</pre>\n</blockquote>\n\n<p>How can I catch this, so my app doesn't crash? Unfortunately, being such a new language, there doesn't seem to be a whole lot of examples that I've been able to find.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","knockout.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13220991,"title":"Best approach to data filtering","body":"<p>I'm building a little library applications to have a visual catalogue of my programming ebooks.\nBy now, I've added some of my ebooks info into a ko.observableArray in my BooksViewModel.js file.\nLater, I'll be implementing a NodeJS applications with all the data saved in a MongooseDB and access them from there, but by now, I'm just experimenting directly from Knockout.js.</p>\n\n<p>By default, my library shows all the books I added, desorganized, so I'm looking forward to implement \"categories\" by language. Every book object contains a language attribute.\nI want to filter the books showed by language but I'm a little bit confused on how will be the best way to do this.</p>\n\n<p>The books on the array are not organized, they are all dropped there.. some talks about javascript, other C and so on.\nAt first I thought about creating a separated array for each language, and then implemeting a method in the ViewModel to select the corresponding array of the language you requested.</p>\n\n<p>Later, I would implementa NodeJS API, to get them by language, lets say:</p>\n\n<pre><code>GET /languages/C // will get a json corresponding all the books that talks about C\n</code></pre>\n\n<p>The ViewModel could contain a method:</p>\n\n<pre><code>self.findByLanguage = function(lang) {\n   self.books = // GET /languages/:lang\n};\n</code></pre>\n\n<p>But that would query the database every time. I guess is better to load the whole books json first, saved all of them to an array on the client side, and then filter them. That way only one request would be made.\nI could have a global array containing all the books, and then implement the filter with ko.utils.ArrayFilter.</p>\n\n<p>What do you guys think will be the best approach? Maybe there is a better way.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["javascript","node.js","session","reference","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13221313,"title":"Why a reference to object is replaced with its value","body":"<p>I use node.js and express.</p>\n\n<p>I saved on the '<code>req.session</code>' a complex object that includes array of objects.\nIn addition I save reference to one of the objects in the array.\nFor example:</p>\n\n<pre><code>var value = {\n    name: \"name\"\n    , values: []\n};\n\nreq.session.value = value;\n\n//\n// I populate 'req.session.value' with values (with the same structure)\n//\n\n// then I save reference to one of the inner objects\n\nvar currentValue = req.session.value[3];\n\n//\n// later I try to change the save object\n//\n\ncurrentValue.name = \"newName\";\n</code></pre>\n\n<p>I expected that if I change the '<code>currentValue</code>' then the '<code>req.session.value[3]</code>' will be changed as well. However, for some reason it doesn't happen.</p>\n\n<p>To be concrete, if I change the <code>currentValue</code> immediately after I assign it then the <code>req.session.value[3]</code> is changed but if I am doing it in the next call then just the <code>currentValue</code> is changed.</p>\n\n<p>In the example: I do the assignments to the '<code>req.session</code>' in the \"<code>app.get(...)</code>\" if I change the value of the <code>currentValue</code> in the \"<code>app.get(...)</code>\" it is run ok (the value change in both places) but if I change it in the  '<code>app.post(...)</code>' the only object that change is the <code>currentValue</code> while the <code>req.session.value[3]</code> left the same.</p>\n\n<p>Thanks in advance,<br>\nShai </p>\n\n<p>The code:</p>\n\n<pre><code>'app.get(\"/template/:templateid/feature/add\", isTemplate, function(req, res) {'\n'    if (!req.session.features) { // if features empty'\n''\n'    // Save the first features level from the current template in the session '\n'    req.session.features = req.session.template.feature;'\n'    //'\n'    if (!req.session.featureNodes) { // featureNotes is a stack/branch of the features'\n'        req.session.featureNodes = [];'\n'    }'\n'    if (!req.query.featureroot || req.query.featureroot == \"\") {'\n'    } else {'\n'        var featureRoot = getFeature(req.query.featureroot, req.session.features); // get one object from req.session.features'\n'        if (featureRoot) {'\n'            req.session.featureNodes.push(featureRoot);     // save reference'\n'            var featureR = req.session.featureNodes.pop();  // do check that work!'\n'            var values = {'\n'                name: \"req.body.name\"'\n'                , description: \"req.body.description\"'\n'                , wieght: \"req.body.wieght\"'\n'                , created: new Date()'\n'                , modified: new Date()'\n'                , feature: []'\n'            };'\n''\n'            featureR.feature.push(values); // also req.session.features changed'\n'            req.session.featureNodes.push(featureRoot); // push the reference back for use later'\n'        }      '\n'    }'\n'    res.render(\"addfeature2template.jade\", { '\n'        title: \"Add new feature\"'\n'        ,template: req.session.template'\n'        ,feature: req.session.featureNodes'\n'    });'\n'});'\n''\n'app.post(\"/feature/add\", isUser, function(req, res) {'\n'    var SUBMIT = \"Create\";'\n'    var CANCEL = \"Cancel\";'\n'    switch ( req.param(\"feature\") ) {'\n'        case SUBMIT:'\n'            var fields = {  name: 1, description: 1, wieght: 1};'\n'            var values = {'\n'                name: req.body.name'\n'                , description: req.body.description'\n'                , wieght: req.body.wieght'\n'                , created: new Date()'\n'                , modified: new Date()'\n'                , feature: []'\n'            };'\n'            if (req.session.featureNodes.length &lt; 1) {'\n'                req.session.features.push(values);'\n'            } else {'\n'                var featureRoot = req.session.featureNodes.pop(); // pop the reference'\n'                featureRoot.feature.push(values);                 // change the object but the req.session.features didnt changed '\n'            }'\n'            req.session.template = template;'\n'            res.redirect(\"/template/\" + req.body.templateid);'\n'        break;'\n'        case CANCEL:'\n'            res.redirect(\"/template/\" + req.body.templateid);'\n'            break;'\n'    }'\n'});'\n</code></pre>\n"},{"tags":["node.js","express","ejs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13221760,"title":"Nodejs EJS helper functions?","body":"<p>Is there a way to register helper functions to EJS templates, so that they can be called from any EJS template? So, it should work something like this.</p>\n\n<p>app.js</p>\n\n<pre><code>ejs.helpers.sayHi = function(name) {\n    return 'Hello ' + name;\n});\n</code></pre>\n\n<p>index.ejs</p>\n\n<pre><code>&lt;%= sayHi('Bob') %&gt;\n</code></pre>\n"},{"tags":["java","javascript","node.js","typescript","tsc"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13218205,"title":"Run TypeScript compiler from Java","body":"<p>I am trying to run the TypeScript compiler from my Java application. To start, I am trying to figure out, whether I can run the compiler from command-line without Node.js:</p>\n\n<pre><code>$ jsc tsc.js\n</code></pre>\n\n<p>But this way I don't get any errors, nor help.</p>\n\n<pre><code>$ jsc tsc.js myscript.ts\n</code></pre>\n\n<p>Will get me nowhere.</p>\n\n<p>It is easy to run js code directly from java (and I am hoping to run the compiler in this way), but is it possible to run TypeScript compiler without node.js?</p>\n\n<p>EDIT:</p>\n\n<p>I confirm the same behaviour with rhino.</p>\n"},{"tags":["node.js","mongodb","express","socket.io","dust.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13217906,"title":"dust.js format text through a function","body":"<p>I've got a javascript function which blur's text:</p>\n\n<pre><code>function blurlines(data) {\n    var dataSplit = data.split(\" \");\n    var lastWord = dataSplit.pop();\n    var toBlur = '&lt;span class=\"blur\"&gt;' + dataSplit.join(\" \") +  '&lt;/span&gt;'; \n// Blur entire sentace, show only last word\n     var output = '&lt;li&gt;' + toBlur + lastWord + '&lt;/li&gt;';\n     return output;\n}\n</code></pre>\n\n<p>I'm trying to get this to work with dust.js by trying something like:</p>\n\n<pre><code>{#storylines}\n    &lt;script&gt;\n        blurlines(\"{text}\");\n    &lt;/script&gt;                   \n{/storylines}\n</code></pre>\n\n<p>Is there anyway to easily pass the {text} value through a JS function and then render the output?</p>\n\n<p>If i run it in console it seems to work:</p>\n\n<p><code>&gt; blurlines(\"This is a test line\")</code></p>\n\n<p><code>&gt; \"&lt;li&gt;&lt;span class=\"blur\"&gt;This is a test&lt;/span&gt;line&lt;/li&gt;\"</code></p>\n"},{"tags":["node.js","redis","mongoose","odm","ohm"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":401,"score":3,"question_id":10387412,"title":"Nodejs Object Document Model for Redis","body":"<p>I'm want use an ODM for redis in node.js.  Does anybody have any experience using any?  I ideally want something that is somewhat the equivalent of <a href=\"https://github.com/LearnBoost/mongoose\" rel=\"nofollow\">mongoose</a> (except instead for Redis instead of Mongodb).</p>\n\n<p>The two I have heard of so far are <a href=\"https://github.com/maritz/nohm\" rel=\"nofollow\">nohm</a> and <a href=\"http://www.adaltas.com/projects/node-ron/\" rel=\"nofollow\">ron</a>.  Can someone compare the experience of using either of these?  Also I have read about <a href=\"https://github.com/chriso/redback\" rel=\"nofollow\">redback</a> and I am curious if it would work well with an ODM.</p>\n"},{"tags":["node.js","one-to-many","jade","sequelize.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13222849,"title":"NodeJS+Sequelize+Jade; Using the hasMany collection on an object","body":"<p>I'm working on a nodejs+sequelize+jade web-app to learn nodejs. Everything basic is quite clear but now I want to up the ante. I have object(table) called brand. The object product has a one-to-many relation with brand. What I like to do is to findAll brands and show them in a Jade-template and also list the products under it.</p>\n\n<p>Here is some basic code</p>\n\n<pre><code>var Brand = sequelize.import(application_root + \"/models/brand.js\");\nvar Product = sequelize.import(application_root + \"/models/product.js\");\nBrand.hasMany(Product, { as: 'Products', foreignKey: 'brand'});\nProduct.belongsTo(Brand, { foreignKey: 'key'});\n</code></pre>\n\n<p>In the route for showing the brands and products I do;</p>\n\n<pre><code>  Brand.findAll().error(errorHandler).success(function(brands) \n    {   \n        brands[0].getProducts().success(function(products) {\n        brands[0].products = products;\n        });\n        res.render('listOfbrands.jade', {  title: 'List of brands', items: brands});\n    });\n</code></pre>\n\n<p>The strangest thing is that I can see a query being fired when the console.log has been executed but it doesn't create a correct query with the primary key of the brand. The query being select * from products where \"brand\" is null  </p>\n\n<p>Also I want to know if I'm assigning the sub collection correct to access it in my Jade template by doing like this</p>\n\n<pre><code>ul\neach item in items\nli(class='brandItem')= item.name\nul \neach product in item.products\nli=product.name\n</code></pre>\n"},{"tags":["node.js","coffeescript","version","npm","brunch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13122521,"title":"How to force brunch 0.8.1 to use coffescript 1.2","body":"<p>Spent quite a number of hours trying to find this thing out but to no avail. I'm sure it's as simple as syntax but maybe I've been staring at the problem for too long. I'm trying to build out a development environment for an old piece of code. Refactoring is not an option because of the size of the codebase currently. </p>\n\n<p>The biggest issue of course is the fact that I'm trying to mimic an environment that was built out 11 months ago, and need the following</p>\n\n<p>node v0.6.11\nnpm v1.1.1\nbrunch v0.8.1\ncoffee-script v1.2</p>\n\n<p>package.json currently has    </p>\n\n<pre><code> \"dependencies\": {\n    \"coffee-script\": \"&gt;= 1.1.1\",\n    \"underscore\":    \"&gt;= 1.1.7\",\n    \"eco\":           \"&gt;= 1.0.3\",\n    \"nomnom\":        \"1.0.0\",\n    \"stylus\":        \"&gt;= 0.13.7\",\n    \"async\":         \"&gt;= 0.1.9\",\n    \"yaml\":          \"&gt;= 0.2.1\",\n    \"file\":          \"&gt;= 0.1.1\",\n    \"stitch\":        \"&gt;= 0.3.2\",\n    \"uglify-js\":     \"&gt;= 1.0.6\"\n  },\n  \"devDependencies\": {\n    \"coffee-script\": \"&gt;= 1.1.1\",\n    \"express\":       \"&gt;= 2.4.3\",\n    \"nodeunit\":      \"&gt;= 0.5.3\",\n    \"zombie\":        \"&gt;= 0.9.7\"\n  }\n</code></pre>\n\n<p>The issue of course is that the coffeescript that was originally installed was 1.4 and I need the be compiling with 1.2. I've tried changing the package.json to be \"coffee-script\": \"1.2\" in the dependencies section and then ran \"cake setup\". But that didn't change anything. Where am I going wrong here or am I approaching this all wrong?</p>\n\n<p>I have a local copy of the correct version of coffee-script (1.2) on the same system but I don't know how to point brunch to use that one instead of the one installed in it's subdirectory. </p>\n\n<p>Any help is appreciated. Thanks</p>\n"},{"tags":["node.js","mongodb","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13221262,"title":"Handling asynchronous database queries in node.js and mongodb","body":"<p>I have this issue with querying mongodb asynchronously from node.js. Here is my code</p>\n\n<pre><code>var values = [];\nvar positives = new Array();\nvar negatives = new Array();\n\nvar server1 = new mongodb.Server('localhost',27017, {auto_reconnect: true});\nvar db1 = new mongodb.Db('clicker', server1);   \n\ndb1.open(function(err, db) {\n    if(!err) {\n\n        db1.collection('feedback', function(err, collection) {\n            for (var i=0;i &lt;5; i++) {\n                collection.find(\n                    {value:1},\n                    {created_on: \n                        {       \n                            $gte:startTime + (i*60*1000 - 30*1000),\n                            $lt: startTime + (i*60*1000 + 30*1000)\n                        }\n                    },\n                    function(err_positive, result_positive) {\n                        result_positive.count(function(err, count){\n                                console.log(\"Total matches: \" + count);\n                                positives[i] = count;\n                        });\n                    }\n\n                );              \n\n                collection.find(\n                    {value:0},\n                    {created_on: \n                        {\n                            $gte:startTime + (i*60*1000 - 30*1000),\n                            $lt: startTime + (i*60*1000 + 30*1000)\n                        }\n                    },\n                    function(err_negative, result_negative) {\n                        result_negative.count(function(err, count){\n                                console.log(\"Total matches: \" + count);\n                                negatives[i] = count;\n                        });\n                    }   \n                );                                  \n            }\n\n        });\n\n    } else {\n        console.log('Error connecting to the database');\n    }      \n\n});\n</code></pre>\n\n<p>Actually, I am trying to get some values from the database. And then I need to manipulate these values. It's just that I need to subtract negative count from positive count and then initialize the value array with positivecount-negative count. Now since the results are obtained asynchronously. How am I supposed to manipulate those values and put them in the values array.</p>\n"},{"tags":["node.js","asynchronous","crawler"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13221769,"title":"Node.JS: How to pass variables to asynchronous callbacks?","body":"<p>I'm sure my problem is based on a lack of understanding of asynch programming in node.js but here goes.</p>\n\n<p>For example: I have a list of links I want to crawl. When each asynch request returns I want to know which URL it is for. But, presumably because of race conditions, each request returns with the URL set to the last value in the list.</p>\n\n<pre><code>var links = ['http://google.com', 'http://yahoo.com'];\nfor (link in links) {\n    var url = links[link];\n    require('request')(url, function() {\n        console.log(url);\n    });\n}\n</code></pre>\n\n<p>Expected output:</p>\n\n<pre><code>http://google.com\nhttp://yahoo.com\n</code></pre>\n\n<p>Actual output:</p>\n\n<pre><code>http://yahoo.com\nhttp://yahoo.com\n</code></pre>\n\n<p>So my question is either:</p>\n\n<ol>\n<li>How do I pass url (by value) to the call back function? OR</li>\n<li>What is the proper way of chaining the HTTP requests so they run sequentially? OR</li>\n<li>Something else I'm missing?</li>\n</ol>\n\n<p>PS: For 1. I don't want a solution which examines the callback's parameters but a general way of a callback knowing about variables 'from above'.</p>\n"},{"tags":["node.js","centos"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13221979,"title":"How to generate a node.js flame graph on CentOS?","body":"<p>I'd like to <a href=\"http://blog.nodejs.org/2012/04/25/profiling-node-js/\" rel=\"nofollow\">generate a flame graph for my node.js app</a>. Unfortunately, my dev box is OSX (doesn't support utrace helpers, per the linked article) and my production box is CentOS (doesn't even have dtrace).</p>\n\n<p>I've found some indication that something like <a href=\"http://www.mysqlperformanceblog.com/2009/09/14/systemtap-dtrace-for-linux/\" rel=\"nofollow\">SystemTap might be a dtrace alternative</a>, but I've been unable to cobble together an effective working way to generate the appropriate stacks.out file to feed into stackvis.</p>\n\n<p>Does anybody know of a decent tutorial on how to get this up and running? I'd prefer it on CentOS (so I can examine my production app) but OSX would also be sufficient.</p>\n"},{"tags":["node.js","express","ejs"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13204461,"title":"using default value with an ejs filter","body":"<p>If item.description is undefined or empty, I want to default to 'No description':</p>\n\n<p>I've tried the following:</p>\n\n<pre><code>  &lt;%-: ( item.description | markdown ) || '&lt;p&gt;No description&lt;/p&gt;' %&gt;\n  &lt;%-: ( item.description || 'No description' ) | markdown %&gt;\n</code></pre>\n\n<p>What else can I do?</p>\n"},{"tags":["node.js","sockets","express"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13220565,"title":"\"Unhandled stream error in pipe\" from Node.js","body":"<p>My app: Node.js, Express, some middleware including connect-assets and express.static.</p>\n\n<p>All running on local machine (OSX, Node 0.8) in development mode (thus express.static).</p>\n\n<p><em>Probably important details: I recently made the whole app work through HTTPS (with redirect from HTTP when necessary)</em> and while developing I use self-signe certificate (enabled in my browser, of course).</p>\n\n<p>Now, the app is often failing wit stack traces like that:</p>\n\n<p>(1)</p>\n\n<pre><code>stream.js:81\n  throw er; // Unhandled stream error in pipe.\n        ^\nError: write EPIPE\n    at errnoException (net.js:769:11)\n    at Object.afterWrite (net.js:593:19)\n</code></pre>\n\n<p>(2)</p>\n\n<pre><code>stream.js:81\n  throw er; // Unhandled stream error in pipe.\n        ^\nError: socket hang up\n    at SecurePair.error (tls.js:948:15)\n    at EncryptedStream.CryptoStream._done (tls.js:432:17)\n    at EncryptedStream.CryptoStream._pull (tls.js:577:12)\n    at SecurePair.cycle (tls.js:866:20)\n    at EncryptedStream.CryptoStream.end (tls.js:405:13)\n    at Socket.onend (stream.js:66:10)\n    at Socket.EventEmitter.emit (events.js:126:20)\n    at TCP.onread (net.js:417:51)\n</code></pre>\n\n<p>(3)</p>\n\n<pre><code>stream.js:81\n  throw er; // Unhandled stream error in pipe.\n        ^\nError: socket hang up\n    at createHangUpError (http.js:1264:15)\n    at CleartextStream.socketCloseListener (http.js:1315:23)\n    at CleartextStream.EventEmitter.emit (events.js:126:20)\n    at SecurePair.destroy (tls.js:938:22)\n    at process.startup.processNextTick.process._tickCallback (node.js:244:9)\n</code></pre>\n\n<p>Important: this happens often but not every time, so I assume this not to be a bug in my code.</p>\n\n<p>I found this can be due to express.static and open files limit so I ran <code>ulimit -n 10000</code> - with no effect, unfortunately.</p>\n\n<p>Any ideas? This starts to be extremely frustrating.</p>\n"},{"tags":["html5","node.js","multiplayer","websocket"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":1,"view_count":3242,"score":5,"question_id":6098611,"title":"Multiplayer Game Architecture","body":"<p>Can anyone recommend Articles, Books, Tutorials about this?</p>\n\n<p>Maybe is (Articles, Books, Tutorials) about Multiplayer Game Architecture, Networking in HTML5, JavaScript, WebSockets, Node.js?</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":2220,"score":5,"question_id":10645994,"title":"Node.js - How to format a date string in utc","body":"<p>I am string to format a date time into the below pseudo format in Node.js.</p>\n\n<pre><code>    var ts_hms = new Date(UTC);\nts_hms.format(\"%Y-%m-%d %H:%M:%S\")\n</code></pre>\n\n<p>How do I do that?</p>\n\n<p>Thanks</p>\n"},{"tags":["osx","node.js","install","coffeescript","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1132,"score":2,"question_id":9027285,"title":"error installing coffeescript on mac 10.7.2","body":"<p>Node and npm are both installed and up to date but keep getting this error when trying to install coffeescript. I am still new to programming so any advice would be greatly appreciated.</p>\n\n<pre><code>dylan-hermans-macbook:~ Dylan$ npm -v\n1.1.0-3\ndylan-hermans-macbook:~ Dylan$ node -v\nv0.6.8\ndylan-hermans-macbook:~ Dylan$ npm install -g coffee-script\nnpm http GET https://registry.npmjs.org/coffee-script\nnpm http 304 https://registry.npmjs.org/coffee-script\nnpm ERR! Could not create /usr/local/lib/node_modules/___coffee-script.npm\nnpm ERR! error installing coffee-script@1.2.0\n\nnpm ERR! Error: EACCES, permission denied '/usr/local/lib/node_modules/___coffee-script.npm'\nnpm ERR! \nnpm ERR! Please try running this command again as root/Administrator.\nnpm ERR! \nnpm ERR! System Darwin 11.2.0\nnpm ERR! command \"node\" \"/usr/local/bin/npm\" \"install\" \"-g\" \"coffee-script\"\nnpm ERR! cwd /Users/Dylan\nnpm ERR! node -v v0.6.8\nnpm ERR! npm -v 1.1.0-3\nnpm ERR! path /usr/local/lib/node_modules/___coffee-script.npm\nnpm ERR! code EACCES\nnpm ERR! message EACCES, permission denied '/usr/local/lib/node_modules/___coffee-script.npm'\nnpm ERR! errno {}\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /Users/Dylan/npm-debug.log\nnpm not ok\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":270,"score":2,"question_id":11286979,"title":"How to search in an array in Node.js in a non-blocking way?","body":"<p>I have an array which is:</p>\n\n<pre><code>[ 4ff023908ed2842c1265d9e4, 4ff0d75c8ed2842c1266099b ]\n</code></pre>\n\n<p>And I have to find if the following, is inside that array</p>\n\n<pre><code>4ff0d75c8ed2842c1266099b\n</code></pre>\n\n<p>Here is what I wrote:</p>\n\n<pre><code>Array.prototype.contains = function(k) {\n  for(p in this)\n     if(this[p] === k)\n        return true;\n  return false;\n}\n</code></pre>\n\n<p>Apparently, it doesn't work properly, or better sometimes it works, but it looks to me blocking. Is there anyone that can check that one?</p>\n\n<p>many thanks</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13219429,"title":"node.js require(\"mongodb\") throws an exception","body":"<p>I am a newbie to <code>node.js</code> (but 10 years experience with C#)\nI have the following code</p>\n\n<pre><code>var http = require(\"http\");\nvar url = require(\"url\");\nvar path = require('path');\nvar fs = require(\"fs\");\nvar express = require(\"express\");\nvar mongo = require(\"./node_modules/mongo\");\nvar Server = mongo.Server;\nvar Db = mongo.Db;\nvar server = new Server('localhost', 27017, {auto_reconnect: true});\nvar db = new Db('mydb', server);\n</code></pre>\n\n<p>I get this exception:</p>\n\n<blockquote>\n  <p>Error: Cannot find module './node_modules/mongo'</p>\n\n<pre><code>at Function.Module._resolveFilename (module.js:338:15)\n</code></pre>\n</blockquote>\n\n<p>I also tried:</p>\n\n<pre><code>var mongo = require(\"mongo\");\n</code></pre>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13219420,"title":"how to populate map-reduced result","body":"<pre><code>TestSessionSchema.statics.getTopTesters = function(callback){\n    var o = {};\n    o.map = function(){\n        emit(this._customer, this.points);\n    };\n\n    o.reduce = function(_customer, values){\n        var result = {_customer: _customer, sum_points: 0, };\n        values.forEach(function(point){\n            result.sum_points += point;\n        });\n        return result;\n    };\n\n    o.out = { replace: 'createdCollectionNameForResults' };\n    o.verbose = true;\n\n    this.mapReduce(o,function(err, model, stats){\n        model.find().sort({'value.sum_points': \"desc\"}).limit(5).populate(\"_customer\").exec(function(error, results){\n\n            log(results);\n\n        })\n    });\n\n}\n</code></pre>\n\n<p>In map-reduce part I am geting _customers' points.</p>\n\n<p>Now i want to populate _customer to get customers' info\n <code>model.find().sort({'value.sum_points': \"desc\"}).limit(5).populate(\"_customer\")</code> does not work</p>\n\n<p>how can I do it?</p>\n"},{"tags":["node.js","web-hosting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":13218404,"title":"node.js hosting options","body":"<p>are there any hosting companies that allow a user to use Node.js as oppose to the PHP,ASP?</p>\n\n<p>Also why aren't this hosting providers catching up with this amazing technology ?</p>\n"},{"tags":["session","mongodb","node.js","express","lifetime"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1435,"score":2,"question_id":5696753,"title":"Session lifetime in node.js with express and MongoDB","body":"<p>I am using node.js with the express framework. As a session store I am using MongoDB. How can I set the lifetime after which the session objects are removed from MongoDB. This is how I am doing the declaration:</p>\n\n<pre><code>app.use(express.cookieParser());\n    app.use(express.session({\n                secret: \"Stays my secret\",\n                store: new MongoStore({ db: 'myDB' })\n                    }));\n</code></pre>\n"},{"tags":["windows","node.js","typescript","tsc"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":255,"score":2,"question_id":12725544,"title":"How to use the TypeScript compiler in the 'Watch output files' mode (tsc -w) on Windows?","body":"<p>The compiler version installed with the VS plugin doesn't have this option, but the version for node.js has. However I can't make this mode work on Windows. It creates empty files and doesn't compile anything. Is it a known bug? Can this be helped? I don't want to use heavy-weight VS, create a VS project and so on.</p>\n\n<p><strong>Update:</strong> I filed a <a href=\"http://typescript.codeplex.com/workitem/87\" rel=\"nofollow\">bug</a>. </p>\n"},{"tags":["javascript","ruby-on-rails","ruby-on-rails-3","node.js","ruby-on-rails-3.1"],"answer_count":5,"favorite_count":18,"up_vote_count":31,"down_vote_count":0,"view_count":13322,"score":31,"question_id":7092107,"title":"Rails 3.1 error - Could not find a JavaScript runtime?","body":"<p>I created a new Rails project using <code>rails 3.1.0.rc4</code> on my local machine but when I try to start the server I get:\nCould not find a JavaScript runtime. See <a href=\"https://github.com/sstephenson/execjs\">here</a> for a list of available runtimes. (<code>ExecJS::RuntimeUnavailable</code>)</p>\n\n<p>Note: This is not about Heroku.</p>\n"},{"tags":["javascript","node.js","http","jquery-ajax","cors"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13218174,"title":"CORS PUT: Not found with jQuery.ajax","body":"<p>I want to send some raw data to a subdomain of mine:</p>\n\n<pre><code>$.ajax({\n    url: \"http://accounts.example.com:3000/me\",\n    type: \"PUT\",\n    data: { wabo: \"chabo\" },\n    dataType: \"json\",\n    xhrFields: {\n        withCredentials: true\n    }\n});\n</code></pre>\n\n<p>The browser now sends two requests:</p>\n\n<ol>\n<li>OPTIONS to accounts.example.com:3000/me to check if CORS headers are valid</li>\n<li>PUT to send data</li>\n</ol>\n\n<p>The first one fails with HTTP 404 Not Found.\nThe CORS repsonse header looks valid:</p>\n\n<pre><code>HTTP/1.1 404 Not Found\nX-Powered-By: Express\nAccess-Control-Allow-Origin: http://node.example.com:3000\nAccess-Control-Allow-Methods: HEAD, GET, POST, PUT, DELETE, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, Origin, Accept\nAccess-Control-Allow-Credentials: true\nContent-Type: text/plain\nSet-Cookie: connect.sid=s%3Aru8njoU2ZAnoKL2W2w%2B0BHF7.%2Fe%2FQI5f6NKRWQvWlcYEkMG7HHSxxj0haFDBUID2g45A; Domain=.example.com; Path=/\nDate: Sun, 04 Nov 2012 11:31:22 GMT\nConnection: keep-alive\nTransfer-Encoding: chunked\n</code></pre>\n\n<p>In app.js of my node environment I have:</p>\n\n<pre><code>app.all('*', function(req, res, next) {\n    res.header('Access-Control-Allow-Origin', 'http://node.example.com:3000');\n    res.header('Access-Control-Allow-Methods', 'HEAD, GET, POST, PUT, DELETE, OPTIONS');\n    res.header('Access-Control-Allow-Headers', 'Content-Type, X-Requested-With, Origin, Accept');\n    res.header('Access-Control-Allow-Credentials', 'true');\n    next();\n});\n</code></pre>\n\n<p>and </p>\n\n<pre><code>var me = require('./me');\napp.get('/me', loadUser, me.show);\napp.put('/me', loadUser, me.update);\n</code></pre>\n\n<p>GETting data from the subdomain is no problem only sending\nAny idea what I have forgotten?</p>\n\n<p>Regards, bodo</p>\n"},{"tags":["node.js","mongodb","express","dust.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13217786,"title":"Express/Dust.js - View array of data","body":"<p>I currently have my homepage showing the 6 oldest Stories posts from MongoDB</p>\n\n<p>I use the below for the query from Mongo:</p>\n\n<pre><code>var query = Story\n            .find({maxlines:10})\n            .sort({_id:1})\n            .limit(6);\n</code></pre>\n\n<p>Then I'm using this to pass the information to dust.js</p>\n\n<pre><code>app.get('/', function(req, res){\n    query.exec(function(err, story) {\n        if (err) console.log(err);\n        res.render('index', {\n        title: 'Test!',\n        storytitle1: story[0].title,\n        storylines1: story[0].lines,\n        storyid1: story[0].sid,\n        storyslug1: slugs(story[0].title),   \n        storytitle2: story[1].title,\n        storylines2: story[1].lines,\n        storyid2: story[1].sid,\n        storyslug2: slugs(story[1].title), \n        storytitle3: story[2].title,\n        storylines3: story[2].lines,\n        storyid3: story[2].sid,\n        storyslug3: slugs(story[2].title),    \n        storytitle4: story[3].title,\n        storylines4: story[3].lines,\n        storyid4: story[3].sid,   \n        storyslug4: slugs(story[3].title), \n        storytitle5: story[4].title,\n        storylines5: story[4].lines,\n        storyid5: story[4].sid,  \n        storyslug5: slugs(story[4].title),  \n        storytitle6: story[5].title,\n        storylines6: story[5].lines,\n        storyid6: story[5].sid,  \n        storyslug6: slugs(story[5].title)     \n    });\n    });\n});\n</code></pre>\n\n<p>Then on i have the below on the .dust template</p>\n\n<pre><code>&lt;h1 class=\"title\"&gt;{storytitle1}&lt;/h1&gt;\n        {#storylines1}\n            &lt;ul&gt;{text}&lt;/ul&gt;\n        {/storylines1}\n\n&lt;h1 class=\"title\"&gt;{storytitle2}&lt;/h1&gt;\n        {#storylines2}\n            &lt;ul&gt;{text}&lt;/ul&gt;\n        {/storylines2}\n</code></pre>\n\n<p>Basically for each of the 6 i render them individually, it works perfectly fine, but i'm wondering if there is a better/cleaner way to do this? Because i want to implement another page '/all/ which shows for example the last 20 stories and i don't want to write them all individually within the template.</p>\n"},{"tags":["windows","node.js","com"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13217907,"title":"Is there an existing eventful COM (Component Object Model) binding for nodeJS","body":"<p>I have a client who interfaces the IRIS Exchequer accountancy suite via the Windows Component Object Model(COM).  I'm re-writing their existing Exchequer integration layer and would like to replace this with a non-blocking RESTful service in Express.  I've done an npm search and some googles, but cannot seem to find any bindings which will directly interface COM.</p>\n\n<p>Is there such a module out there and, if not, how would one set about implementing such a module?</p>\n"},{"tags":["node.js","sockets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":12,"score":-1,"question_id":13217049,"title":"How to setsockopt under node.js?","body":"<p>Is there a setsockopt/getsockopt-like socket options manipulation functionality in node.js?</p>\n"},{"tags":["node.js","npm","cloudfoundry","appfog"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13213692,"title":"AppFog error when updating","body":"<p>I always get this error when I'm updating my files in my appfog cloud hosting.</p>\n\n<pre><code>Uploading Application:\n  Checking for available resources: OK\n  Packing application: OK\n  Uploading (7K): OK   \nPush Status: OK\nStopping Application 'volkova': OK\nStaging Application 'volkova': OK                                               \nStarting Application 'volkova': .\nError: Application [volkova] failed to start, logs information below.\n\n====&gt; /logs/stderr.log &lt;====\n\n./startup: line 3: /opt/cloudfoundry/runtimes/nodejs-v0.6.17/bin/node: Permission denied\n</code></pre>\n\n<p>What is the cause of this and how can I prevent this?</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":92,"score":9,"question_id":13215822,"title":"javascript (nodejs) while loop bug","body":"<p>running the following code in nodejs cli:</p>\n\n<pre><code>var my_function = function() {                                                                                              \n    var next_value = 1\n      , value = undefined\n      , difference = undefined                                                                                              \n      , prev_difference = undefined                                                                                         \n\n    while ((typeof prev_difference === 'undefined') || (prev_difference &gt; 0)) {                               \n        value = next_value \n        next_value = 2\n        difference = next_value - value \n        if (difference &gt; prev_difference) {                                                                                 \n              throw new Error('Diminishing')\n        }                                                                                                                   \n        prev_difference = 0 \n    }                                                                                                                       \n    return next_value \n}              \n\nfor (var i = 0; i&lt; 300; i++) { console.log(i); console.log(my_function()) }\n</code></pre>\n\n<p>At iteration 282 of the loop I start getting the value '1' instead of '2'. Can't for the life of me understand why. This chunk of code is a reduction from something else I've been working on, hence the seemingly unnecessary if statement within the loop. There are a few ways to change this code such that the execution path does not get screwed up, but I'd like to understand why it's breaking with the current setup.</p>\n\n<p>Also, if you have any tips for tools that could aid me in debugging something like this in the future I would be very grateful. For the most part I used console.log to narrow this down.</p>\n\n<p>node.js version v0.8.6. Running on Mac OSX version 10.7.5. \nThanks</p>\n"},{"tags":["node.js","heroku","express","npm"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1050,"score":2,"question_id":8678449,"title":"deploy on heroku failed because npm version is not the latest","body":"<p>looks like heroku is using npm version 1.0.94</p>\n\n<p>I have a dependency that require node 0.6.x, but npm 1.0.94 is 'based' on node 0.4.7</p>\n\n<p>is there any workaround to solve this issue.</p>\n\n<pre><code>Installing dependencies with npm 1.0.94\n       npm ERR! Unsupported\n       npm ERR! Not compatible with your version of node/npm: palette@0.0.1\n       npm ERR! Required: {\"node\":\"0.6.x\"}\n       npm ERR! Actual:   {\"npm\":\"1.0.94\",\"node\":\"0.4.7\"}\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13215456,"title":"node js buffer and var difference","body":"<p>while using node js if I use </p>\n\n<pre><code>buf1= new Buffer(50);\nand var buf='';\n</code></pre>\n\n<p>what is the difference in this initialization.\nwhen should we use buffer </p>\n"},{"tags":["node.js","https"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":732,"score":0,"question_id":10771875,"title":"Node.js Https request Error","body":"<p>I've tried <a href=\"//nodejs.org/api/https.html#https_https_request_options_callback\">the sample from the documentation</a> and it works great.</p>\n\n<p>But when I change the URL to <code>https://api.mercadolibre.com/sites/</code>, the request hangs. The only thing I get is:</p>\n\n\n\n<pre class=\"lang-js prettyprint-override\"><code>{ [Error: socket hang up] code: 'ECONNRESET' }\n</code></pre>\n\n<p>Here's my code:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var https = require('https');\n\nthis.dispatch = function(req, res) {\n  var renderHtml = function(content) {\n    res.writeHead(200, {'Content-Type': 'text/html'});\n    res.end(content, 'utf-8');\n  }\n\n  var parts = req.url.split('/');\n\n  var options = {\n    host: 'api.mercadolibre.com',\n    port: 443,\n    path: '/sites/',\n    method: 'GET'\n  };\n\n  var request = https.request(options, function(res) {\n    console.log(\"statusCode: \", res.statusCode);\n    console.log(\"headers: \", res.headers);\n\n    res.on('data', function(d) {\n      process.stdout.write(d);\n    });\n  });\n\n  request.on('error', function(e) {\n    console.error('error');\n    console.error(e);\n  });\n\n  request.end();\n  return 'item id:' + parts[2];\n};\n</code></pre>\n\n<p>I've tried with curl, soapui and with a browser. On all cases works great, but with node.js it doesn't.</p>\n\n<p>How can I get more data on what's going on?</p>\n\n<p><em>added</em></p>\n\n<p>With curl i do: curl --sslv3 <a href=\"https://api.mercadolibre.com/sites/\" rel=\"nofollow\">https://api.mercadolibre.com/sites/</a> works.\nI've test same in centos 6 and works too.\nI've reinstalled node, this time from source, same problem. My Os is ubuntu 12.04. \nThanks.</p>\n"},{"tags":["javascript","mysql","node.js","query-string"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":13211783,"title":"Node.js beginner- request without query strings","body":"<p>I'm new to node.js. A project I'm working on requires that a large array (625 items) be stored in a MySQL database as a string and I'm using <a href=\"http://github.com/felixge/node-mysql\" rel=\"nofollow\">Node MySQL</a> to accomplish that.</p>\n\n<p>Right now I have it so that the row is updated when a request is made to \"/(column name)?(value)\". Unfortunately, it didn't take long to learn that passing 625 items as a string to node isn't the most efficient way of doing things.</p>\n\n<p>Do you have any suggestions for alternate methods of passing a large array as a string besides querystrings?</p>\n\n<pre><code>var http = require('http'),\n   mysql = require(\"mysql\"),\n   url = require(\"url\"),\n   express = require(\"express\");\n\nvar connection = mysql.createConnection({\n   user: \"root\",\n   database: \"ballot\"\n\n});  \n\nvar app = express();\napp.use(express.bodyParser());\n\napp.options('/', function (request, response)\n{\n    response.header(\"Access-Control-Allow-Origin\", \"*\");\n    response.end();\n});\n\napp.get('/', function (request, response)\n{\n    connection.query(\"SELECT * FROM pathfind;\", function (error, rows, fields) {\n        for(i=0;i&lt;rows.length;i++)\n        {\n            response.send('&lt;div id=\"layers\"&gt;'+rows[i].layers+'&lt;/div&gt; \\\n                            &lt;div         id=\"speed\"&gt;'+rows[i].speed+'&lt;/div&gt; \\\n                            &lt;div     id=\"direction\"&gt;'+rows[i].direction+'&lt;/div&gt;');\n        }\n        response.end();\n    });\n});\n\napp.post('/', function (request, response)\n{   \n    console.log(request.param('data', null));\n    var urlData = url.parse(request.url, true);\n    if(urlData.pathname = '/layers')\n    {\n        col = \"layers\";\n    }\n    else if(urlData.pathname = '/speed')\n    {\n        col = \"speed\";\n    }\nelse if(urlData.pathname = '/direction')\n    {\n        col = \"direction\";\n    }\n    req.addListener(\"data\", function(data) {\n        connection.query(\"UPDATE pathfind SET \"+col+\"=\"+data+\" WHERE num=0\",     function (error, rows, fields) {\n            if (error)\n            {\n                app.close();\n            }\n        }); \n    });\n});\n\napp.listen(8080);**\n</code></pre>\n\n<p>EDIT: So now I know I need to use posts. I've rewritten the above code using express.js. Most examples that I look at online use posts with HTML forms, which is fine, but my project needs to post data via an AJAX request. Can someone show me how that data is parsed in node.js?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13215689,"title":"Mongoose: Get doc _id after upsert","body":"<p>is there any way to get the record _id after an upsert?</p>\n\n<p>I've seen this post (<a href=\"http://stackoverflow.com/questions/10520501/how-to-insert-a-doc-into-mongodb-using-mongoose-and-get-the-generated-id\">How to insert a doc into mongodb using mongoose and get the generated id?</a>), but this is oriented only to inserts, not updates.</p>\n\n<p>Also, using the MongoDB you can use get the _id using getlasterror (<a href=\"https://groups.google.com/forum/?fromgroups=#!topic/mongoose-orm/ehZ11QY-OUw\" rel=\"nofollow\">https://groups.google.com/forum/?fromgroups=#!topic/mongoose-orm/ehZ11QY-OUw</a>), but Mongoose doesn't provides access to it (<a href=\"https://groups.google.com/forum/?fromgroups=#!topic/mongoose-orm/pSv6WrasvWg\" rel=\"nofollow\">https://groups.google.com/forum/?fromgroups=#!topic/mongoose-orm/pSv6WrasvWg</a>)</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":320,"score":2,"question_id":6514781,"title":"Is there a Recommended node.js equivalent for the Kohana Framework","body":"<p>The more I look at node.js the more, I'm really beginning to like it.  Everything is an object like ruby, but it isn't as different ( hippie like :P ).  Also you don't have to relearn all these syntaxes that are all globals <code>array_map</code>, <code>array_push</code>...</p>\n\n<h2>So is there a similar equivalent of Kohana php for node.js?</h2>\n\n<p>I'm assuming node.js is ready for prime time if I wanted to set up a server and everything, or is there anything that I shoud be concerned/worried about.  I noticed nodejs.com demo is down, which is a bit concerning if I wanted to go live.</p>\n"},{"tags":["node.js"],"answer_count":5,"favorite_count":11,"up_vote_count":22,"down_vote_count":0,"view_count":11201,"score":22,"question_id":3459476,"title":"How to append to a file in Node?","body":"<p>I am trying to <em>append</em> a string to a log file. However writeFile will erase the content each time before writing the string.</p>\n\n<pre><code>fs.writeFile('log.txt', 'Hello Node', function (err) {\n  if (err) throw err;\n  console.log('It\\'s saved!');\n}); // =&gt; message.txt erased, contains only 'Hello Node'\n</code></pre>\n\n<p>Any idea how to do this the easy way?</p>\n\n<p>ANSWER: found the answer myself:</p>\n\n<pre><code>var log = fs.createWriteStream('log.txt', {'flags': 'a'});\n// use {'flags': 'a'} to append and {'flags': 'w'} to erase and write a new file\nlog.write(\"this is a message\");\n</code></pre>\n\n<p>Daniel</p>\n"},{"tags":["mvc","frameworks","node.js"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":2889,"score":6,"question_id":6651146,"title":"State of the art in MVC frameworks for node.js?","body":"<p>I'd very much like to have some idea of the state of the art of MVC frameworks for <strong>node.js</strong>. Specifically, current commercial practice of the art, not research, with frameworks for front-end web apps. As a PHP programmer might choose Yii Framework—what are the options for node.js programmers and what are the pros and cons for the main contenders?</p>\n"},{"tags":["node.js","cpu","usage"],"answer_count":4,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":1414,"score":3,"question_id":7773826,"title":"How to find out the % CPU usage for Node.js process?","body":"<p>is there a way to find out the % cpu usage for a node.js process with the code?  so that when the node.js server is running and detect the CPU is over certain%, then it will put an alert or console output.  </p>\n"},{"tags":["javascript","node.js","error-handling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13197795,"title":"Handle errors thrown by require() module in node.js","body":"<p>having a bit of a snag in my code when trying to require() modules that don't exists.\nThe code loops through a directory and does a <code>var appname = require('path')</code> on each folder. This works for appropriately configured modules but throws: <code>Error: Cannot find module</code> when the loop hits a non-module.</p>\n\n<p>I want to be able to handle this error gracefully, instead of letting it stop my entire process. So in short, how does one catch an error thrown by <code>require()</code>?</p>\n\n<p>thanks!</p>\n"},{"tags":["javascript","json","cookies","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1466,"score":1,"question_id":3252400,"title":"How do I store this JSON object as a cookie and than read it in vanilla javascript?","body":"<p>I can actually seem to write it fine as a cookie like this:</p>\n\n<pre><code> [\"4c3dd477c441e17957000002\",\"4c2ac3cc68fe54616e00002e\",\"4c3dd477c441e17957000003\",\"4c3dd477c441e17957000004\"]\n</code></pre>\n\n<p>But how do I read the cookie?</p>\n\n<p>I'm using node.js/express.js (and coffee script), and when I read it the cookie key the value I get is just the first value of the above array.</p>\n\n<p>Do I need to parse it somehow? Or a more complex serialization/deserialization altogether?</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","login","multiple-domains","docpad"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":194,"score":0,"question_id":9628331,"title":"Multi-Domain Login","body":"<p>I'm working on a little node.js-project, and while googling alot, I kinda got a bit confused, but maybe some of you are able to point me towards the road again.</p>\n\n<p>Several websites are generated by <a href=\"https://github.com/bevry/docpad\" rel=\"nofollow\">DocPad</a> (excellent piece of software), and hosted on different domains.</p>\n\n<p>All these websites shall now get a \"login module\" (which is also written in Node.js, using passport). Visually, it will look similar to the excellent login-slider from Web-Kreation (<a href=\"http://web-kreation.com/demos/Sliding_login_panel_jquery/\" rel=\"nofollow\">Here</a> a demo). My plan was to use nginx and route all the /login-requests to the login-app, which is working fine. </p>\n\n<p>The problem is rather related to the multiple domains, and the clientside implementation of it all. All logins use the same database.</p>\n\n<p>Can I somehow use both together, and create the session-cookies from the Login-Module (which could use the same domain all the time)?</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13206724,"title":"how to get the list of process","body":"<p>I am playing around with node and just installed it on my machine. Now I want to get a list of processes running on my machine so I can see if apache is running and if mysql is started etc? how can I do that. I just have very basic code in my js file. I dont even know where to begin on this\nhere is my code</p>\n\n<pre><code>var http = require('http');\nhttp.createServer(function(request, response){\n    response.writeHead(200);\n    response.write(\"Hello world\");\n    console.log('Listenning on port 1339');\n    response.end();\n\n\n}).listen(8080);\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["image","node.js","drawing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":22,"score":0,"question_id":13212731,"title":"create a draw image in node.js","body":"<p>I'd like to create an application using node.js which creates an image. In the image I'd like to draw programmatically circles, lines or any function f(x) (well I could draw that function by adding points at some coordinates). I'd like to know which modules of node.json I should use or if there is something created for this.</p>\n\n<p>So I need to create a draw given by some mathematical functions and export it to an image file.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","node-mysql","vjet"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12872543,"title":"VJET With NodeJS Modules","body":"<p>I have just imported a NodeJS project into Eclipse with VJET plugin. It seems nice that it understands some of the NodeJS but I don't like that it doesn't recognize Node-MySQL. Is there any documentation on how to write a project (like NodejsTL) to fill up that missing functionality? I could analyze NodejsTL one but if there is any documentation and tutorial - I wouldn't have to.</p>\n"},{"tags":["json","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13212956,"title":"node js and json run time Error","body":"<p>I am using node js and trying to parse the Jason Body.\nI am getting the following error:</p>\n\n<pre><code>undefined:0\n\n^\nSyntaxError: Unexpected end of input\n    at Object.parse (native)\n    at IncomingMessage.&lt;anonymous&gt; (C:\\node\\xxxx.js:36:14)\n    at IncomingMessage.emit (events.js:64:17)\n    at HTTPParser.parserOnMessageComplete [as onMessageComplete] (http.js:130:23)\n    at Socket.ondata (http.js:1506:22)\n    at TCP.onread (net.js:374:27)\n</code></pre>\n\n<p>I am doing :</p>\n\n<pre><code>     request.on('data', function(chunk)\n    {\n    data+=chunk;\n    });\n     and in the end I am doing\n     obj = JSON.parse(data);  //its complaining at this point.\n</code></pre>\n\n<p>input is :</p>\n\n<pre><code>{\n    \"result\": \"success\",\n    \"source\": \"chat\"\n}\n</code></pre>\n"},{"tags":["javascript","node.js","web-applications"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":149,"score":5,"question_id":13084079,"title":"Two way communication with server side objects for web-application development","body":"<p><strong>Background</strong></p>\n\n<p>My background is high scale object oriented middleware and Applications development for embedded devices and desktops with C++. Now we need to create a high scale web-app for our startup. </p>\n\n<hr>\n\n<p><strong>Question</strong>  </p>\n\n<p>Request-response based and continuous polling based current web-development frameworks looks very primitive, inefficient. </p>\n\n<p>I am looking for completely server-side object oriented and event based programming. \nHere is an example it,</p>\n\n<p>There is a persistent object named <strong>employeeManager</strong> on server, </p>\n\n<p><strong>methods of this object</strong>,<br>\nempList getAllEmployeeList();<br>\nempList getEmployeeOfDepartment(string strDept);<br>\n/*Some more */</p>\n\n<p><strong>events of this object</strong><br>\nemployeeAdded(empID);<br>\nemployeeEdited(empID);<br>\nemployeeRemoved(empID);<br>\n/*Some more */</p>\n\n<p>Now, client side javascript should be able to call the methods of this (server-side) object and should be able to receive events of this object. We can have results of the method call in asynchronous mode. Framework should also provide a way so that view ( or html-js page ) can register for required server side events.</p>\n\n<p>Is there any frameworks which works on this methodology. Anything like this on top of socketIO? Any framework which provides a good two way RPC between client javascript and sever side objects?</p>\n"},{"tags":["node.js","express","dropbox"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13211401,"title":"How to keep node-dbox token between page refreshes in NodeJS/Express","body":"<p>Im trying to put together a little application using <code>NodeJS</code>, <code>node-dbox</code> and <code>Express</code>.\nWhen requesting for <code>DropBox</code> authorization - <a href=\"https://github.com/sintaxi/node-dbox#how-to-use\" rel=\"nofollow\">it's a 3 step process</a>, first need to get <code>request_token</code>, then user authorizes them visiting dropbox page, and only then request for <code>access_token</code>, based on <code>request_token</code> and the fact that user has authorized request.</p>\n\n<p>However, by the time I served the page for step 1 and 2 (getting <code>request_token</code>, and providing user with url)  - <code>request_token</code> instance is gone!, so in step 3 I can't request for an <code>access_token</code>, because it requires <code>request_token</code> being passed</p>\n\n<p>I'm trying to save <code>request_token</code> in a cookie, but given that contains sensitive data, sending it to the client may not be such a good idea. Any ideas?</p>\n\n<p>Simplified code is below:</p>\n\n<pre><code>(function() {\n    var dbox = require('dbox'),\n        config = require('easy-config'),\n        express = require('express'),\n        dboxApp = dbox.app(config.dropbox_credentials),\n        app = express();\n\n    app.use(express.cookieParser());\n\n    app.get('/', function(req, res) {\n        dboxApp.requesttoken(function(status, request_token) {\n            res.cookie('request_token', JSON.stringify(request_token));\n            res.send(\"&lt;a href='\" + request_token.authorize_url + \"' targe='_new'&gt;authorize via dropbox&lt;/a&gt;&lt;br/&gt;\" + \"&lt;a href='/next'&gt;next&lt;/a&gt;\");\n        });\n    });\n\n    app.get('/next', function(req, res) {\n        var request_token = JSON.parse(req.cookies.request_token);\n        if(request_token) {\n            dboxApp.accesstoken(request_token, function(status, access_token) {\n                var client = dboxApp.client(access_token);\n                client.account(function(status, reply){\n                  res.send(reply);\n                });\n            });\n        } else {\n            res.send('sorry :(');\n        }\n    });\n\n    app.listen(3000);\n\n})();\n</code></pre>\n\n<p>bonus question: <code>client</code> is created with <code>access_token</code>, so either instance of client or <code>access_token</code> need to be maintained across page refreshes as well, whats the best approach?</p>\n"},{"tags":["node.js","express","expressjs"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":27,"score":3,"question_id":13211156,"title":"Extending express app.get method in a nodejs app","body":"<p>I'm trying to extend the <strong>app.get</strong> behavior but it seems that after doing it, the app losses some configuration I did before extending it. </p>\n\n<p>In the following snippet the <strong>/sample</strong> and <strong>/es/sample</strong> output are <strong>empty</strong> and the expected output should be <strong>'value'</strong></p>\n\n<p>Am I doing something wrong?</p>\n\n<pre><code>var app = require('express')();\n\napp.set('myprop', 'value');\n\nvar _get = app['get'];\n\napp['get'] = function (route, middleware, callback) {\n    _get.call(app, route, middleware, callback);\n\n    // For instance: I generate a new route for 'es' language.\n    _get.call(app, '/es' + route, middleware, callback);\n};\n\napp.get('/sample', function(req, res){\n    res.send(app.get('myprop'));\n});\n\napp.use(app.router);\napp.listen(3000);\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Sorry, I will answer myself...</p>\n\n<p>I missed the following first line in the extension method :)</p>\n\n<pre><code>if (middleware === undefined &amp;&amp; callback === undefined) return _get.call(app, route);\n</code></pre>\n\n<p>now it works like a charm!</p>\n\n<pre><code>app['get'] = function (route, middleware, callback) {\n    if (middleware === undefined &amp;&amp; callback === undefined) return _get.call(app, route);\n    _get.call(app, route, middleware, callback);\n\n    // For instance: I generate a new route for 'es' language.\n    _get.call(app, '/es' + route, middleware, callback);\n};\n</code></pre>\n"},{"tags":["node.js","authentication","express","passport"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13206004,"title":"Custom Redirects in Passport","body":"<p>I am trying to set up a basic authentication for my first public facing node app. I have two passport strategies: 1) for Facebook and 2) For Twitter. I do not plan to include an email/password system at least for now till I understand the security implications.\nI have been able to get them working in an out of the box way and tie in Mongoose for creating new users. </p>\n\n<p>I now want to work on deduping social account users. So whenever a new user comes in via twitter auth I want to redirect them to a page that collects email. I am saving the token and profile object returned as session variables and would reuse them on that page when submitting the form as hidden fields.</p>\n\n<p>However I cannot understand how to implement this aspect using Passport. Here is the code I have so far with comments on what I am trying to do with each part. Essentially I am checking if the twitter user is an old user, if not I am setting session variables that I will reuse on the /addemail page, initializing the user object (so that Serialize, Deserialize function has something to act (not sure I understand what Serializing/Deserializing actually does). Now if the user is a new one, the session variable NewTwitterUser is true and I check it in the auth/callback url to redirect the user to appropriate page. This however does not work. </p>\n\n<pre><code>//basic modules and setup\nvar express = require('express')\n    , passport = require('passport')\n    , mongoose = require('mongoose')\n    , http = require('http')\n    , util = require('util')\n    , TwitterStrategy = require('passport-twitter').Strategy\n    , FacebookStrategy = require('passport-facebook').Strategy\n    , path = require('path');\n\nvar app = express();\n\n\n//Mongodb setup\nvar Schema = mongoose.Schema;\nvar ObjectId = Schema.ObjectId;\n\nvar UserSchema = new Schema({\n  provider: String,\n  uid: String,\n  fb_uid: String,\n  twitter_uid: String,\n  name: String,\n  first_name: String,\n  gender: String,\n  fb_username: String,\n  twitter_username: String,\n  profile_pic: String,\n  email: String,\n  location: String,\n  birthday: String,\n  created: {type: Date, default: Date.now}\n});\n\n\nvar User = mongoose.model('User', UserSchema);\nmongoose.connect('MongoHQ db connection here')'\n\n\n//User Authentication - Twitter\npassport.use(new TwitterStrategy({\n    consumerKey: 'KEY',\n    consumerSecret : 'SECRET',\n    callbackURL: \"CALLBACKURL\",\n    passReqToCallback: true\n},\n    function(req, token, tokenSecret, profile, done){\n        User.findOne({twitter_uid: profile.id}, function(err, user){\n            if (err) {\n            console.log('this is an error 1' + err);\n            return done(err);}\n            if(user){\n                console.log('this user' + user);\n                done(null, user);\n            } else {\n                console.log('this is a new user');\n                req.session.token = token;\n                req.session.tokenSecret = tokenSecret;\n                req.session.profile = profile;\n                req.session.newtwitteruser = true;\n                var user = new User();\n                user.uid = profile.id;\n                done(null, user);\n\n                /* This part is commented and is the default code I had if I needed to simply create a Twitter User right here.\n                var user = new User();\n                user.provider = profile.provider;\n                user.uid = profile.id;\n                user.twitter_uid = profile.id;\n                user.name = profile.displayName;\n                user.first_name = profile.displayName[0];\n                user.twitter_username = profile._json.screen_name;\n                user.profile_pic = profile._json.profile_image_url;\n                user.location = profile._json.location;\n                user.save(function(err){\n                    if(err) {throw err;}\n                    else {done(null, user);}\n                });*/\n            }\n        }); \n    }   \n));\n\n\n//User Authentication - Facebook\npassport.use(new FacebookStrategy({\n    clientID: 'ID',\n    clientSecret: 'SECRET',\n    callbackURL: \"URL\"\n},\n    function(accessToken, refreshToken, profile, done){\n        User.findOne({fb_uid: profile.id}, function(err, user){\n            if (err) {return done(err);}\n            if(user){\n                done(null, user);\n            } else {\n                var user = new User();\n                user.provider = profile.provider;\n                user.uid = profile.id;\n                user.fb_uid = profile.id;\n                user.name = profile.displayName;\n                user.first_name = profile._json.first_name;\n                user.gender = profile._json.gender;\n                user.fb_username = profile._json.username;\n                user.profile_pic = 'https://graph.facebook.com/' + profile.id + '/picture';\n                user.email = profile._json.email;\n                user.location = profile._json.location.name;\n                user.birthday = profile._json.birthday;\n                user.save(function(err){\n                    if(err) {throw err;}\n                    else {done(null, user);}\n                });\n            }\n        })  \n    }   \n));\n\n\npassport.serializeUser(function(user, done) {\n  done(null, user.uid);\n});\n\npassport.deserializeUser(function(uid, done) {\n  User.findOne({uid: uid}, function (err, user) {\n    done(err, user);\n  });\n});  \n\n\n//app configurations\napp.configure(function(){\n  app.set('port', process.env.PORT || 3000);\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(express.cookieParser(\"freecookie\"));\n  app.use(express.session({secret:\"freecookie\"}));\n  app.use(express.static(path.join(__dirname, 'public')));\n  app.use(express.errorHandler());\n  app.use(passport.initialize());\n  app.use(passport.session());\n  app.use(app.router);\n});\n\n\n//Basic Routing\napp.get('/', function(req, res){\n    res.render('home', {title: 'App Title', user: req.user});\n});\n\n\napp.get('/auth/twitter', passport.authenticate('twitter'));\n\napp.get('/auth/twitter/callback', \n    passport.authenticate('twitter', {failureRedirect: '/login' }), \n    function(req, res) {\n        if (req.session.newtwitteruser){\n        res.redirect('/addemail');}\n        else {res.redirect('/');}\n    });\n\napp.get('/addemail', function(req, res){\n    if (req.session.newtwitteruser){\n    res.render('email', {title: 'Add your Email'});}\n    else {res.redirect('/');}\n});\n\n\napp.get('/auth/facebook', passport.authenticate('facebook', {scope: ['email', 'user_location', 'user_birthday'] }));\n\napp.get('/auth/facebook/callback', \n  passport.authenticate('facebook', { successRedirect: '/', failureRedirect: '/login' }));  \n\n\napp.get('/logout', function(req, res){\n  req.logout();\n  res.redirect('/');\n});\n\n\n\n//create the server\nvar server = http.createServer(app);\nserver.listen(app.get('port'));\n\n\n//Checks if a request is authenticated\nfunction ensureAuthenticated(req, res, next) {\n  if (req.isAuthenticated()) { return next(); }\n  res.redirect('/login')\n}\n</code></pre>\n"},{"tags":["javascript","ruby-on-rails","node.js","coffeescript","execjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13211073,"title":"ExecJS::RuntimeError on any page including coffeescript","body":"<pre><code>ExecJS::RuntimeError in Users#index\n</code></pre>\n\n<p>I'm getting an error like this on every single page of my app. Everything used to work... for some reason it isn't working now when I restarted my app.</p>\n\n<p>I am on Windows</p>\n\n<p>I have node already installed, tried adding the following to my boot.rb to ensure it's using node</p>\n\n<pre><code>ENV['EXECJS_RUNTIME'] = 'Node'\n</code></pre>\n\n<p>I have </p>\n\n<pre><code>gem 'execjs'\n</code></pre>\n\n<p>but NOT rubyracer, because according to my research,</p>\n\n<ol>\n<li>Node is supposed to work too</li>\n<li>rubyracer can't install on windows (when I try it attempts to install libv8 which gives me errors on windows)</li>\n</ol>\n\n<p>I'm sure it's something silly, I mean it was JUST working. I am using thin server and start with <code>thin start</code></p>\n\n<p>The error in my log is</p>\n\n<pre><code>ActionView::Template::Error ([\"ok\",\"&lt;Some OK looking javascript code&gt;\"])\n(in &lt;path&gt;/global.js.coffee)\n</code></pre>\n\n<p>My application.js</p>\n\n<pre><code>//= require jquery\n//= require jquery_ujs\n//= require bootstrap\n//= require global\n//= require_tree .\n</code></pre>\n"},{"tags":["html5","node.js","svg","mustache"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13210793,"title":"SVG tag is taking extra space","body":"<p>So I am getting a weird size issue with the SVG element in HTML5. It is taking considerable more space than I suspected. Each small rectangle in the image is a rect element with width and height of \"20\".</p>\n\n<p>The SVG element should have height and width of 20*10 = 200 but instead has dimensions of 680x508.</p>\n\n<p>You can view the inspected svg element here -> <a href=\"http://i.stack.imgur.com/xrofn.png\" rel=\"nofollow\">http://i.stack.imgur.com/xrofn.png</a></p>\n\n<p>The HTML looks something like this:</p>\n\n<pre><code>    &lt;svg&gt;\n    &lt;rect x='0' y='0' height='20' width='20' stroke='black' stroke-width=''/&gt;\n    &lt;rect x='0' y='20' height='20' width='20' stroke='black' stroke-width=''/&gt;\n    &lt;rect x='0' y='40' height='20' width='20' stroke='black' stroke-width=''/&gt;\n    ...\n    &lt;/svg&gt;\n</code></pre>\n\n<p>It should be noted that I am running node.js and mustache.js.</p>\n\n<p>Edit:\nApparently SVG does something when it isn't sure about the width/height. Setting it manually solves the problem.</p>\n\n<pre><code>    &lt;svg height=\"200\" width=\"200\"&gt;\n</code></pre>\n"},{"tags":["javascript","node.js","random","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13210838,"title":"Randomly place object on array element","body":"<p>I'm making a sort of \"scratch and win\" game using canvas elements.\nThe things is, I've now come to a halt thinking about the best way to possibly make the game recognize a winner state.</p>\n\n<p>I have an array os 9 canvas elements and I want to be able to RANDOMLY choose 3 of them to place a background image (which is just a visual representation of the 3 required parameters for the \"prized\" element).</p>\n\n<p>So, let's say I want to be able to choose the 3 canvas elements from the array and place a background image in each one. Since I'm using Node.JS/Socket.io and the \"controller\" is supposed to be a mobile device (phone or tablet) how can I make sure that everything is in sync, so that the randomly chosen elements on the \"client\" are the same on the \"controller\"? And how would I use a truly random state?</p>\n\n<p>Hope this description is enough, but I can post some code if necessary.</p>\n\n<p>I think it will be interesting to see what your opinions are.</p>\n\n<p>Best Regards,\nCelso Santos</p>\n"},{"tags":["node.js","mongodb","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13202460,"title":"express: keep all DRY creating a mongoose connection module (using the new createConnection method)","body":"<p>Here's my actual db connection module:</p>\n\n<pre><code>var mongoose = require('mongoose'),\n  conn = mongoose.createConnection('localhost', 'doto');\n\nconn.on('error', function (err) {\n  console.log('Error! DB Connection failed.');\n});\n\nconn.once('open', function () {\n  console.log('DB Connection open!');\n});\n\nmodule.exports = conn;\n</code></pre>\n\n<p>and there's a place where I use it</p>\n\n<pre><code>exports.list = function (req, res) {\n  var conn = require('../lib/db_connection');\n\n  conn.once('open', function () { // if i dont wrap with this, the page will not be rendered...\n    conn.db.collectionNames(function (err, names) {\n      res.render('list_collections', {\n        title: 'Collections list',\n        collections_names: names\n      });\n    });\n  });\n}\n</code></pre>\n\n<p>My question is: I really need to use conn.once every time? Any suggestion?</p>\n"},{"tags":["ruby-on-rails","node.js","deployment","webserver","ubuntu-12.04"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13203335,"title":"Set Node.js to $PATH (Ubuntu 12.04)","body":"<p>I am studying RoR and I am setting this virtual machine to \"deploy\" RoR and I got stuck in the Node.js installation.</p>\n\n<p>I am using Ubuntu 12.04 and I followed this step of this guide:</p>\n\n<p><a href=\"http://railsapps.github.com/installing-rails.html\" rel=\"nofollow\">http://railsapps.github.com/installing-rails.html</a></p>\n\n<blockquote>\n  <p>Since Rails 3.1, a JavaScript runtime has been needed for development on Ubuntu Linux (it is not needed for Mac OS X or Windows). For\n  development on Linux Ubuntu, it is best to install the Node.js\n  server-side JavaScript environment:</p>\n  \n  <p><code>$ sudo apt-get install nodejs</code></p>\n  \n  <p>and set it in your $PATH.</p>\n</blockquote>\n\n<p>What does it mean, \"set to my $PATH\"?</p>\n\n<p>I've been searching for it on google in the last couple of hours and all solutions are different, for different problems and I get no simple answer for that. Can you give a little light here?</p>\n\n<p>Thanks!</p>\n"},{"tags":["ajax","node.js","asp.net-ajax","zombie.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13193205,"title":"Handle ajax response with node.js","body":"<p>I am trying to scrape information from a specified website. This site uses authentication first, thus a i use zombie.js:</p>\n\n<pre><code>var Browser = require(\"zombie\");\nvar browser = new Browser();\nbrowser.visit(\"https://*****login.aspx\", function(){\n    browser.fill('#user', '*****');\n    browser.fill('#pwd', '*****');\n    var button = browser.querySelector('#btnSubmit');\n    browser.fire('click', button, function(){\n    //scraping main.aspx\n    });\n});\n</code></pre>\n\n<p>It's working, i can scrape the main.aspx: there is a <code>&lt;table&gt;</code>, containig information about new messages(from, date, subject,), the problems comes here: the subject field is clickable, and clicking on it makes a new window appear with the actual message. However it is an ajaxgrid, and when i perform a click:</p>\n\n<pre><code>var field = browser.querySelector('#VeryLongIdOfTheField');\nbrowser.fire('click', field, function(){    \n    console.log(browser.querySelector('#VeryLongIdOfTheFieldContainingTheMessage').innerHTML);\n});\n</code></pre>\n\n<p>it returns an error message, saying that undefined has no innerHTML. I suppose its because this action handled with some ajax magic. I am new in this js/nodejs/jquery/.. world, some help needed to enlight me.</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13201775,"title":"Looking for a JavaScript implementation of node's \"util.inherits\"","body":"<p>I am implementing a JavaScript library that can also run on node, and I'd like to use node's API as much as possible. My objects emit events, so I found this nice library called <a href=\"https://github.com/hij1nx/EventEmitter2\" rel=\"nofollow\">eventemitter2</a>, and which reimplements EventEmitter for JavaScript. Now I'd like to find the same for <a href=\"http://nodejs.org/docs/latest/api/util.html#util_util_inherits_constructor_superconstructor\" rel=\"nofollow\">util.inherits</a>. Has anybody heard about such a project ?</p>\n"},{"tags":["node.js","subdomain"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13208145,"title":"Sub domains in nodejs","body":"<p>How can I handle subdomains request by nodejs?</p>\n\n<p>for example the following code echo <strong>test</strong> in console for any request on <strong>http://localhost:9876/[anything]</strong> :</p>\n\n<pre><code>var http = require('http');\n\nhttp.createServer(function(t1,t2){\n    console.log(\"test\");\n}).listen(9876);\n</code></pre>\n\n<p>now I wanna answer any request on <strong>http://[anything].localhost:9876/[anything]</strong>\nit can be done by  <strong>htaccess</strong> in apache,what is alternative in NodeJS?</p>\n"},{"tags":["flash","actionscript-3","sockets","node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1105,"score":2,"question_id":8691083,"title":"Socket data from Node.js is not received in the Flash client","body":"<p>I'm having a problem to receive data from <code>socket.io</code> to Flash (actionscript).</p>\n\n<p>I've tried: </p>\n\n<p><strong>Server (nodejs) socket.io :</strong></p>\n\n<pre><code>var io = require('socket.io').listen(9000);\nsetInterval(function() {\nio.sockets.emit('hello');\nconsole.log(\"test\");\n}, 500 );\n</code></pre>\n\n<p><strong>Client (actionscript) Socket();</strong></p>\n\n<pre><code>import flash.net.Socket;\nimport flash.events.*;\nvar socket:Socket = new Socket();\nSecurity.allowDomain(\"*\");\nsocket.connect(\"localhost\", 9000);\nsocket.addEventListener(Event.CONNECT, onConnect);\nsocket.addEventListener(ProgressEvent.SOCKET_DATA, socketDataHandler);\nfunction onConnect( evt:Event ):void\n{\ntrace( \"Connected to flash\");\n}\nfunction socketDataHandler(evt:ProgressEvent):void  \n{  \ntrace(\"socketDataHandler: \" + evt);\n}  \n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<p>Flash connects succesful to the server and trace \"Connected to flash\" but it cannot receive data. Any ideas?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":20,"score":-1,"question_id":13207410,"title":"Hardware code SPACE key in node.js","body":"<p>What is the hardware key for the SPACE key in node.js?</p>\n\n<p>For instance hardware key for W is 87</p>\n\n<p>...for A is 65</p>\n\n<p>...for D is 68</p>\n\n<p>ecc...</p>\n\n<p>Thanks!</p>\n"},{"tags":["linux","node.js","screen","pid","monit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":13201570,"title":"configure monitrc to monitor node js app process, can't find node app pidfile running with screen ec2 linux","body":"<p>I run my app.js (node js application) via screen on my ec2 linux instance.\nI'm trying to config my monitrc file and I need the app pidfile.\nIt's not in : \n/var/run\n(and there isn't a /var/www)</p>\n\n<p>Would really appreciate it if someone has any idea where the pidfile is or how can I find it out..<br>\nThank you!</p>\n"},{"tags":["node.js","amazon-web-services","cloud","cloud-hosting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13179264,"title":"Cloud Storage Website Sharing Two server","body":"<p>I have a cloud storage website running on single server.\nI want it to be like downloading and uploading on storage server and Webapp source on another server handling mysql query and other part.</p>\n\n<p>But in this case bandwidth of both the server will be used equally. because, in that case, if user upload file from server who handle the website part,than the temporary files handled by php will use quota of that server and storage server too.</p>\n\n<p>Is there any alternate way in which this can be done.</p>\n\n<p>Can i be using node.js in this, or any other way, in which it can be done.\nI do have api system for website, but that doesnt make any sense,i want directly upload my files to another server without have to connected to main server which is serving website.</p>\n\n<p>I am doing this to save my money.Nothing else.Please dont say buy cheaper server, because, i want to implement this technology.</p>\n"},{"tags":["node.js","azure","sdk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13189049,"title":"Azure Node.js Table Storage Query Not Returning Wanted Results","body":"<p>I'm using Azure Node.js SDK and am having trouble getting this query to work:</p>\n\n<pre><code>var ts1 = azure.createTableService(config.storageAccount, config.storageAccessKey, config.tableHost);\nvar query = azure.TableQuery\n    .select()\n    .from('users')\n    .where('PartitionKey eq ?', '0')\n    .and('FriendsSeeVideo eq ?', 'true')\n    .and('Status eq ?', 'Active');\n\nvar firstTimeThrough = true;\nfor (f in friends){\n    if (firstTimeThrough){\n        query.and('UserID eq ?', friends[f].id);\n        firstTimeThrough = false;\n    }\n    else query.or('UserID eq ?', friends[f].id);\n}\n</code></pre>\n\n<p>When I write the query to the screen I get an Azure Table Query that looks like this:</p>\n\n<pre><code>query = {\"_fields\":[],\"_from\":\"users\",\"_where\":[\"PartitionKey eq '0'\",\" and FriendsSeeVideo eq 'true'\",\" and Status eq 'Active'\",\" and UserID eq '763424639'\",\" or UserID eq '1385552681'\",\" or UserID eq '100001386550915'\",\" or UserID eq '100001869159941'\"],\"_top\":null,\"_partitionKey\":null,\"_nextPartitionKey\":null,\"_rowKey\":null,\"_nextRowKey\":null}\n</code></pre>\n\n<p>but it's not returning the result I expect.  There is 1 user that satisifies the conditions in table storage and the result should be returning the user with userID 763424639 but it's not?</p>\n\n<p>Basically I am passing in a friend set and asking table storage if these people exist in the users table and to return them if they have enabled the FriendsSeeVideo setting.</p>\n\n<p>Can anyone see what I am doing wrong?</p>\n"},{"tags":["node.js","oauth"],"answer_count":4,"favorite_count":6,"up_vote_count":14,"down_vote_count":0,"view_count":4369,"score":14,"question_id":6822840,"title":"Is there a Node OAuth Server Implementation","body":"<p>I only found the oauth client library for nodejs. Does anybody know where I can find a server implementation?</p>\n\n<p>Thanks,\n<br/>\nHao.</p>\n"},{"tags":["node.js","heroku","model","geddy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13188647,"title":"How to access multiple models from a controller","body":"<p>I have a Locations model and a Recorders model. I want to be able to pass all of the data for both data sets to my view model. How can I access them though because I think they're not in scope since I'm getting undefined errors because I'm calling 'all'</p>\n\n<p><a href=\"https://gist.github.com/3998302\" rel=\"nofollow\">https://gist.github.com/3998302</a></p>\n\n<pre><code>var Main = function () {\n  this.index = function (req, resp, params) {\n    var self = this;\n    var data = {};\n    geddy.model.Locations.all(function(err, locations) {\n        data.locations = locations;\n        geddy.model.Recorders.all(function(err, recorders) {\n            data.recorders = recorders;\n            self.respond({params: params, data: data}, {\n            format: 'html'\n            , template: 'app/views/locations/index'\n            }\n        });\n    }););\n  };\n\n};\n\nexports.Main = Main;\n</code></pre>\n\n<p>Error snippet:</p>\n\n<pre><code>timers.js:103\n            if (!process.listeners('uncaughtException').length) throw e;\n                                                                      ^\nTypeError: Cannot call method 'all' of undefined\n    at index (G:\\code\\PeopleTracker\\app\\controllers\\main.js:23:24)\n    at controller.BaseController._handleAction.callback (C:\\Users\\Chris\\AppData\\Roaming\\npm\\node_modules\\geddy\\lib\\base_\ncontroller.js:387:22)\n</code></pre>\n"},{"tags":["node.js","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13189239,"title":"Possible to install all missing modules for a node application?","body":"<p>I have a node app that I just started working with and each time I try to run it, it says there is a missing module.  I've just been using <code>npm install ...</code> for each module but after doing about 10 of them I'm wondering if there is a way to have npm pull down all needed modules for a node app without me installing each one manually.  Can it be done?</p>\n"},{"tags":["node.js","routing","express"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13204513,"title":"Catch-all root level routing in Express.js: considerations and reserving possible routes for future use?","body":"<p>I'm using Express.js (3.0) to develop a Node web app; I'd like to have clean URLs for both user profiles:</p>\n\n<p><strong>domain.com/username</strong></p>\n\n<p>as well as for pages each user creates and shares:</p>\n\n<p><strong>domain.com/username/pagename</strong></p>\n\n<p>I really prefer the clean URLs to using something like <strong>domain.com/profile/username</strong> or <strong>domain.com/pages/username/pagename</strong>.</p>\n\n<p>The current route configuration for our development is bootstrapped like so:</p>\n\n<pre><code>app.get('/', content.home);\napp.get('/about', content.about);\napp.get('/signup', users.signup);\napp.get('/login', users.login);\napp.get('/:user', users.profile);\napp.get('/:user/:userpage', userpage.render);\n</code></pre>\n\n<p>The last two being the catch all routes. Now this works fine, but I'm not sure if it's a bad design or implementation.</p>\n\n<p>More importantly, I'd like to reserve a 100 or so page names for future use, like 'contact', 'careers', 'cancels', 'pricing', etc. I don't plan to launch with these pages, but I'm wondering if I can create a route file that captures these requests and sends them to a placeholder page, rather than them being evaluated as a user profile or user generated page.</p>\n\n<p>I can obviously prevent those usernames from being created, but there's got to be a creative approach for the routing as well, and understand any other considerations when using catch-all root level routing-- this can cause an unwieldily amount of DB strain due to the user and page look ups for non-existing objects or pages.</p>\n"},{"tags":["node.js","socket.io","meteor"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13193908,"title":"Real Time Meteor.js http.get","body":"<p>I am looking to develop a new application that relies on talking to an external service API.</p>\n\n<p>For example, I want to create a real time Twitter feed that updates everytime there is a new tweet, I want to use Meteor as the framework but I'm not sure if it's possible to have Meteor display new tweets automatically without a page refresh.</p>\n\n<p>I know I could do this with Node.js and Socket.io but is it possible to do in solely Meteor? </p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","mongodb","heroku","meteor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13153314,"title":"Deploying Meteor and MongoDB to Heroku","body":"<p>I am attempting to deploy my project to Heroku following a particular guide (http://bytesofpi.com/post/20898722298/pushing-your-meteor-project-to-heroku)</p>\n\n<p>One of the steps states that </p>\n\n<pre><code>var mongo_url = process.env.MONGOHQ_URL;\n</code></pre>\n\n<p>Needs to replace \"MONGO_URL\" in server/server.js.</p>\n\n<p>The problem is I can't find that variable at all, the only mention of that variable is in the following code</p>\n\n<pre><code>    // check for a valid MongoDB URL right away\n    if (!process.env.MONGO_URL)\n         throw new Error(\"MONGO_URL must be set in environment\");\n</code></pre>\n\n<p>Does anybody have any experience with this, or know where to find \"MONGO_URL in order to change it?</p>\n"},{"tags":["node.js","express","npm"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":782,"score":1,"question_id":11379919,"title":"NPM, cannot find 'graceful-fs', no matter what I do","body":"<p>This is what I get when I try to install express for node.js</p>\n\n<pre><code>npm install express\n\nmodule.js:340\n    throw err;\n          ^\nError: Cannot find module 'graceful-fs'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (/usr/share/npm/lib/utils/ini.js:32:10)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n</code></pre>\n\n<p>I even tried others and still got the same error. I did some digging and i did find 'gracefui-fs' on my server.</p>\n\n<p>I am running ubuntu 12.04 LTS on an amazon ec2 server. Node installed with no errors, and npm still didn't work. I also un installed and re installed npm using </p>\n\n<pre><code>apt-get\n</code></pre>\n\n<p>as well as from source. During installation I received no errors either.</p>\n"},{"tags":["node.js","typescript"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":13203558,"title":"Typescript generating javascript that doesn't work","body":"<p>Node is not happy about something in the Javascript that TypeScript is generating and I can't figure out why. Here is the code</p>\n\n<p>Person.ts:</p>\n\n<pre><code>export module Models {\n    export class Person {\n        id: number;\n        firstName: string;\n        lastName: string;\n\n        constructor(f: string, l: string) {\n            this.firstName = f;\n            this.lastName = l;\n        }\n\n        public saySomething(): void {\n            console.log(\"my name is %s %s\", this.firstName, this.lastName);\n        }\n    }\n}\n</code></pre>\n\n<p>Database.ts:</p>\n\n<pre><code>import P = module(\"Person\");\n\nexport module Database {\n    export class DB {\n        public findPerson(id: number): P.Models.Person {\n            return new P.Models.Person(\"a\", \"b\");\n        }\n    }\n}\n</code></pre>\n\n<p>Test.ts:</p>\n\n<pre><code>var D = require(\"./DB\");\nvar db = new D.Database.DB();\nvar p = db.findPerson(123);\np.saySomething();\n</code></pre>\n\n<p>It compiles fine down in Javascript, but there appears to be something wrong with the DB.js file that is being created. When I try to run Test.js in node I get this:</p>\n\n<pre><code>$node Test.js\nDB.js:2\n(function (Database) {\n^\nTypeError: object is not a function\n    at Object.&lt;anonymous&gt; (DB.js:2:1)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (Test.js:1:73)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n</code></pre>\n\n<p>It's happening during the import of DB.js. Oddly enough, if I change the findPerson() method to return a string instead of a Person it works fine. It has something to do with creating that Person object.</p>\n\n<p>Here is the Javascript:</p>\n\n<pre><code>(function (Models) {\n    var Person = (function () {\n        function Person(f, l) {\n            this.firstName = f;\n            this.lastName = l;\n        }\n        Person.prototype.saySomething = function () {\n            console.log(\"my name is %s %s\", this.firstName, this.lastName);\n        };\n        return Person;\n    })();\n    Models.Person = Person;    \n})(exports.Models || (exports.Models = {}));\n\n\nvar P = require(\"./Person\")\n(function (Database) {\n    var DB = (function () {\n        function DB() { }\n        DB.prototype.findPerson = function (id) {\n            return new P.Models.Person(\"a\", \"b\");\n        };\n        return DB;\n    })();\n    Database.DB = DB;    \n})(exports.Database || (exports.Database = {}));\n\n\nvar dbx = require(\"./DB\")\nvar db1 = new dbx.Database.DB();\nvar p = db1.findPerson(123);\np.saySomething();\n</code></pre>\n"},{"tags":["node.js","express.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1171,"score":1,"question_id":7843961,"title":"How do express static directories work with a 404 route?","body":"<p>I have some code that looks like the following:</p>\n\n<pre><code>app.configure(function() {\n   app.set(\"views\", __dirname + \"/views\");\n   app.set(\"view engine\", \"ejs\");\n   app.use(express.bodyParser());\n   app.use(express.methodOverride());\n   app.use(express.logger()); \n   app.use(app.router);\n   app.use(express.static(__dirname + \"/public\"));\n});\n\n//Routes\napp.get(\"/\", function(req, res) {\n    res.render(\"index.ejs\", {locals: {\n      title: \"Welcome\"\n    }});\n});\n\n//Handle 404\napp.get(\"/*\", function(req, res, next) {\n    next(\"Could not find page\");\n});\n</code></pre>\n\n<p>The problem I have is that I can't access anything in the /public static directory: everything gets caught by the 404 route. Am I missing something about how this is supposed to work? </p>\n"},{"tags":["javascript","node.js","gzip","connect"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13163393,"title":"My returned data is not gzipped with connect.compress()","body":"<p>I am trying to use the <code>connect.compress()</code> middleware to gzip my responses to the client. I am able to partially get it to work but when I add my own response using <code>res.end</code> the response is no longer gzipped.</p>\n\n<p>Gzipped responses:</p>\n\n<pre><code>app = connect()\n      .use(connect.compress())\n      .use(connect.query())\n      .use(connect.json());\n</code></pre>\n\n<p>Not gzipped responses:</p>\n\n<pre><code>app = connect()\n      .use(connect.compress())\n      .use(connect.query())\n      .use(connect.json())\n      .use(function (req, res) {\n        res.end('hello');\n      });\n</code></pre>\n\n<p><strong>I would like to be able to respond with my own message but still have the content gzipped.</strong></p>\n"},{"tags":["php","ajax","node.js","livechat"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13203676,"title":"Is using websockets for a webchat possible using a webhost?","body":"<p>I'm an inexperienced PHP programmer and I am making a website using Codeigniter which runs on a server of a webhost. This website should, among other functionality, contain multiple chatrooms where medium-sized groups (+/- 25 people) could have real-time chat sessions. The number of chatrooms depends on the popularity of the site, so the chat functionality should be scalable and I want to be prepared to host hundreds or thousands of chatrooms.</p>\n\n<p>I've found that one way to do this, is using short-polling with ajax, i.e. saving every message in the database and polling the database every second. I thought this approach would not scale well (as it seems very intensive for the database), so I thought it would be better to use a long-polling approach, e.g. websockets with node.js. </p>\n\n<p>I'm not experienced with using sockets and as far as I've seen, node.js requires you to use your own server (e.g. localhost). Ideally, I want to integrate the functionality of node.js in my website so that every upcoming message is pushed to all the other chat-users, and that the messages are once in a while (e.g. every 10 minutes) sent to the database, so that chat history could later be reviewed.</p>\n\n<p>This doesn't seem possible as node.js needs to independently run on your own server. What could I do to make my chat work with websockets, while using the server of the webhost? Is this possible? Should I use a different webserver instead of a webhost, or should I stick to short polling? Many thanks in advance.</p>\n"},{"tags":["osx","node.js","wifi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13203651,"title":"How to make my MacBook into a Wifi hotspot without the actual internet connection","body":"<p>I need to show some demonstrations at an upcoming conference where I run a node.js server on my machine,  and let the audience connect to it (I'll give the IP address). </p>\n\n<p>The \"Internet Sharing\" capability of OSX works great if my MacBook have the Internet connection (via Ethernet), but that option is not available if it doesn't have the Internet connection. </p>\n\n<p>All I need is a local (isolated from the Internet) WiFi connection between my MacBook and audiences devices. I'd really appreciate if somebody could help me to solve this issue.  </p>\n"},{"tags":["javascript","node.js","zombie.js"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13202022,"title":"Missing element in array","body":"<p>I'm new to Node.js. I'm using zombie.js to scrape a web page title from a few websites. Below is my code:</p>\n\n<pre><code>var Browser = require(\"zombie\");\nvar util = require(\"util\");\nhalt = require('delayed');\ntitle = [];\nurl = [ 'http://www.apple.com', 'http://www.microsoft.com', 'http://www.dell.com' ];\n\n\nfunction getTitles(url){\n    //console.log('Start scraping title');\n    var length = url.length;\n    console.log('Total Site to Scrape: '+length);\n    label = 1;\n    for(var i=0;i&lt;length;i++){\n        browser = new Browser()\n        browser.runScripts = false\n        browser.setMaxListeners(0);\n        browser.visit(url[i], function(e, browser, status, errors) {\n        browser.wait(function(){\n            title[i] = browser.text('html &gt; head &gt; title');\n            console.log(label+': '+title[i]);\n            browser.close();\n            label++;\n        });\n        });\n    };  \n}\n\n\ngetTitles(url);\n\nhalt.delay(function () {\n    console.log('Array Length: '+title.length)\n    console.log('Array Content: '+title)\n}, 10)\n</code></pre>\n\n<p>Below is the output of the code:</p>\n\n<pre><code>Total Site to Scrape: 3\n1: Apple\n2: Dell Official Site - The Power To Do More | Dell\n3: Microsoft Home Page | Devices and Services\nArray Length: 4\nArray Content: ,,,Microsoft Home Page | Devices and Services\n</code></pre>\n\n<p>The part that I don't understand:</p>\n\n<ol>\n<li>Why is the array length returned 4 instead of 3? There are only\nthree urls</li>\n<li>Why is the array content only return the last element? Where are the other two missing elements?</li>\n</ol>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13202030,"title":"Closing Mongoose connection with Node.js","body":"<p>I have a server up and running with no errors being thrown.  I am streaming data from a mongodb.  When the data is done streaming I want to call 'close' and then disconnect the mongo database.  </p>\n\n<p>Below is the code that I have.  When I try to connect to the server a first request succeeds but any additional requests fail.  </p>\n\n<p>When I attempted to check if the mongodb was being disconnected I found out that it wasn't.    </p>\n\n<p>How do you use a <code>mongoose.connection.close()</code> and when will it fail?</p>\n\n<pre><code>var http = require('http')\n  , url = require('url')\n  , mongoose = require('mongoose')\n  , Schema = mongoose.Schema\n  , server, n;\n\nserver = http.createServer(function(request, response) {\n  var path = url.parse(request.url).pathname.slice(0, 4);\n  n = url.parse(request.url).pathname.slice(5);\n\n  // connect to mongo\n  mongoose.set('debug', true);\n  mongoose.connect('localhost', 'lotsOfNumber');\n  mongoose.connection.on('error', function(err) {\n    console.error('connection error: ' + err);\n  });\n\n  mongoose.connection.on('open',function() {\n\n    var stuff = mongoose.model('numbersHere', new Schema({serialNumber: Number}, {safe: true}));\n\n    switch (path) {\n\n      case '/slq':\n\n        var stream = stuff.find({}).limit(1).skip(n).sort('field value').stream();\n\n        stream.on('error', function(err) {\n          console.error(\"Error trying to stream from collection:\" + err);\n        });\n\n        stream.on('data', function(doc) {\n          response.writeHead(200, {'Content-Type': 'text/plain'});\n          response.write(doc.value.toString() + '\\n', 'utf8');\n          response.end();\n        });\n\n        stream.on('close', function() {\n          mongoose.connection.close();\n          mongoose.connection.on('close', function() {console.log('closed');});\n        });\n\n        break;\n\n      default:\n        console.log('nothing');\n        mongoose.connection.close();\n        break;\n    }\n  });\n});\n\nserver.listen(8080);\n</code></pre>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["debugging","node.js","v8"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2547,"score":4,"question_id":7663957,"title":"Debugging \"Maximum call stack size exceeded\"","body":"<p>I have a server that I can cause to die with the following output:</p>\n\n<pre><code>events.js:38\nEventEmitter.prototype.emit = function(type) {\n                                  ^\nRangeError: Maximum call stack size exceeded\n</code></pre>\n\n<p>However, without a stack dump or trace, I have no way of finding whether this is infinite recursion or just a slightly-too-large chain, let alone where the problem function is.</p>\n\n<p>Running Node with the <code>--trace</code> option caused my tests to not only run slow (as one would expect), but to not reproduce the problem.</p>\n\n<p>Anybody have any solutions or tips for getting to the bottom of this?</p>\n"},{"tags":["javascript","node.js","haml","meteor","slim-lang"],"answer_count":0,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13199033,"title":"Using Slim or HAML & Sass / SCSS with Node.js?","body":"<p>I have a rather robust project that has all of its templates implemented in Slim and a little HAML.  I have been considering starting to push the project over to a Node.js based structure (probably built atop Tower.js or something similar; maybe Meteor), however I would like to continue using Slim or HAML for the templates rather than shifting over to another template engine.</p>\n\n<p>Has anyone done this or spent the time to figure out how to accomplish this so far, and if so, what were your findings?</p>\n"},{"tags":["regex","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13202907,"title":"Apply regular expression for expressjs","body":"<p>I need to handle requests like this:</p>\n\n<pre><code>/key/6435.254.53538\n</code></pre>\n\n<p>I wrote regexp that work in RegexPal</p>\n\n<pre><code>(([0-9]+\\.?)+)\n</code></pre>\n\n<p>I create handler in Express.js</p>\n\n<pre><code>/key/:key(([0-9]+\\.?)+)\n</code></pre>\n\n<p>but it returns only last part of the key</p>\n\n<pre><code>req.params.key == '53538'\n</code></pre>\n\n<p>how can I retrieve full key?</p>\n"},{"tags":["iphone","ios","node.js","push-notification","apns"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13202772,"title":"NodeJS Node-apn implementation as daemon","body":"<p>I have a node-apn nodejs script running as a daemon on AmazonWS.  The daemon runs fine and the script stays up and comes back when it goes down but I believe I am having a synchronous execution and exiting issue with node.js.  When I release the process with process.exit(); even though all console.logs output saying they have sent my messages, they never are received on the phone.  I decided to remove the exit and let the process \"hang\" after execution and all messages were sent successfully.  This led me to do the following implementation using an ASYNC function, but the same result seems to be happening.  Can anyone provide insight to this?  There are no errors being thrown from APN or anywhere else.</p>\n\n<pre><code>function closeDB()\n{ \n\n    connection.end(function(err) {\n    if (err) {\n        console.log(\"ERROR: \" + util.inspect(err, false, 5));\n        process.exit(1);\n    } \n\n    console.log(\"APNS-PUSH: COMPLETED.\");\n});\n\nsetTimeout(function(){process.exit();}, 50);\n\n} // End of closeDB()\n\nfunction apnsError(err, notification)\n{\nconsole.log(err);\nconsole.log(notification);\ncloseDB();\n}  \n\nfunction async(arg, callback) \n{\napnsConnection.sendNotification(arg);\nconsole.log(arg); \nsetTimeout(function() { callback(1); }, 100);\n} \n\n/**\n* Our MySQL query callback.\n*/\nfunction queryCB(err, results) \n{\n\n//error in our all, report and exit\nif (err) {\n    console.log(\"ERROR: \" + util.inspect(err, false, 5));\n    closeDB();\n} \n\nif(results.length == 0)\n{\n    closeDB();\n}\n\nvar notes = [];\nvar count = 0;\n\ntry {\n    for( var i = 0; i &lt; results.length; i++ ) {\n        var myDevice = new apns.Device(results[i]['udid']);\n\n        var note = new apns.Notification();\n\n        note.expiry = Math.floor(Date.now() / 1000) + 3600; // Expires 1 hour from now.\n        note.badge = results[i][\"notification_count\"];\n        note.sound = \"ping.aiff\";\n        note.alert = results[i][\"message\"];\n        note.device = myDevice;\n\n        connection.query('UPDATE `tbl_notifications` SET `sent`=1 WHERE `id`=' + results[i][\"id\"] , function(err, results) {\n                if(err)\n                {\n                    console.log(\"ERROR: \" + util.inspect(err, false, 5));\n                }\n            });\n\n        notes.push(note);\n    }\n} catch( err ) {\n    console.log('error: ' + err)\n}\n\nconsole.log(notes.length);\n\nnotes.forEach(function(nNode) {\n    async(nNode, function(result) {\n        count++;\n        if(count == notes.length) {\n            closeDB();\n        }\n    })\n});         \n\n} // End of queryCB()\n</code></pre>\n"},{"tags":["node.js","tdd","bdd","mocha"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13078848,"title":"unobtrusive node testing","body":"<p>So, I'm new to testing in js and I'm trying to use mocha to test a node application.</p>\n\n<p>Ideally I'd like to have it so that the tests are in a separate file and are run on the node script itself (perhaps by use of a require call at the top of the test script). At the moment I'm doing something which I know can't be right which is to include the tests in a block at the bottom of the script file. The problem with this being test code included in production code and the fact that it comes back with 'describe is not defined' when you try to start the node server.</p>\n\n<p>I've read lots of tutorials on mocha, etc and it seems that you can export all of your methods individually by doing 'module.export.', but that seems costly and is also obtrusive.</p>\n\n<p>What am I missing here? Surely you don't have to construct two scripts (one with and one without the test code?) - that would end up with version issues.</p>\n\n<p>How is this best done (links to articles also gratefully accepted. :)</p>\n\n<p>Thanks</p>\n\n<p>James</p>\n"},{"tags":["node.js","mongodb","meteor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13201269,"title":"Running meteor in a cluster and real-time changes","body":"<p>I was planning on deploying Meteor to my Amazon AWS EC2 servers but I would like to also run multiple instances of the server at the same time to serve more clients. Is there a proper way to do this in Meteor without breaking the ability for clients to updated about updates to their collections? </p>\n"},{"tags":["javascript","ajax","node.js","gzip","http-compression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13202399,"title":"Decompress in browser a JSON datafile served as static file from Node.js","body":"<p>Similar to <a href=\"http://stackoverflow.com/questions/8350749/gzipped-json-file-not-decompressing\">this post</a> need to send a large 30MB JSON file to the browser, which compresses to 3MB.  (yes, yes, it's big and intensive to decompress, but better to serve it once as a static file than as, say, 150 separate AJAX calls to a REST API, and a bit of upfront load time is okay here).</p>\n\n<p>Also like the original post, it's a static file, so can compress it ahead of time (so the server doesn't need to compress it on each request).  Further, can serve it from the public directory on the server, which in  Node.js / Express.js I have marked as static:</p>\n\n<p><code>app.use(express.static(__dirname + \"/public\"));</code></p>\n\n<p>One commenter replied:</p>\n\n<p><em>\"It is also possible to precompress your JSON and then just tell Apache to serve the files with the appropriate headers to avoid having to recompress all the time.\"</em></p>\n\n<p><strong>Question 1:</strong>  How might I do that in Node/Express, i.e. tell Node to tell the browser the file is in gzip format, so that the browser automatically uncompresses it?</p>\n\n<p>Another answer remarks <em>\"...but do check that the browser supports compression \"</em>, which raises another question?</p>\n\n<p><strong>Question 2:</strong> Do ~most~ modern browsers have the ability to decompress content?  Or am I better off just including a javascript library for decompression, get the data via Ajax as a binary text, and always decompress it in my own code rather than browser's native utility?  </p>\n\n<p>(For my purpose, it's okay to exclude some old browsers, e.g. dropping IE6 would be okay, dropping support for IE9 would not)</p>\n"},{"tags":["javascript","python","string","node.js"],"answer_count":8,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":516,"score":1,"question_id":7790811,"title":"How do I put variables inside javascript strings? (Node.js)","body":"<pre><code>s = 'hello %s, how are you doing' % (my_name)\n</code></pre>\n\n<p>That's how you do it in python. How can you do that in javascript/node.js?</p>\n"},{"tags":["email","smtp","node.js","pop3"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":3495,"score":4,"question_id":5241409,"title":"Receiving email in NodeJS","body":"<p>I see a lot of nodejs modules out there that sends mail through SMTP. But is there a module to receive mail?</p>\n"},{"tags":["json","node.js","couchdb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13170841,"title":"Invalid UTF-8 JSON on CouchDB bulk document api","body":"<p>I have a node console app where I am trying to post a number of record to the bulk document api on a local CouchDB instance and getting an \"Invalid UTF-8 JSON.\" What makes this particularly odd, is that I'm generating my JSON using JSON.stringify on a object literal.</p>\n\n<p>I tested the actual json at <a href=\"http://jsonlint.com/\" rel=\"nofollow\">http://jsonlint.com/</a> and supposedly it's valid. I can't post the full json here as it's names and number from a directory, but I can show you a mock record to give you the basic structure.</p>\n\n<pre><code>{\n \"family\" : \"Smith\",\n        \"people\":{\n            \"Bob\":{\n                 \"name\":\"Bob\", \n                 \"active\" : true,\n                \"birthday\" : \"1/01\"\n            },\n            \"Sue\":{\n                \"name\": \"Sue\", \n                \"active\" : true,\n                \"birthday\" : \"1/01\"\n            }\n        },\n        \"address\": {\n            \"street\" :\"1111 Cool Road\",\n            \"city\" : \"Cincinnati\",\n            \"state\" : \"OH\",\n            \"zip\" : \"11111\"\n        },\n        \"phone\" : \"923-4908\"            \n};\n</code></pre>\n\n<p>I wrapped my array of records in a json object with the property \"docs\" as specified <a href=\"http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API\" rel=\"nofollow\">here</a>. Is there anything obviously wrong with what I'm trying to do?</p>\n\n<p>UPDATE:\nFollowing lambmj's suggestion, I wrote the string generated by node out to a file and then used curl to post that to the bulk document upload. That worked perfectly. I'd still like someone to help me correct my node code though, so that it works from within node. Here's the exact code that builds and posts the request</p>\n\n<pre><code>  //The result variable is my array of 'family' objects, \n  //It's generated by parsing a text file, not show here\n  var postOptions = {\n  host: 'localhost',\n  port: '5984',\n  path: '/members/_bulk_docs',\n  method: 'POST',\n  headers: {\n      'Content-Type': 'application/json',\n      'Content-Length': result.length\n  }\n};\nvar request = http.request(postOptions, function(res){\n    res.setEncoding('utf8');\n    res.on('data', function (chunk) {\n      console.log('Response: ' + chunk);\n    });\n});\nvar body = { \"docs\": result};\nvar stringData = JSON.stringify(body);\nconsole.log(stringData);\nrequest.write(stringData);\n</code></pre>\n"},{"tags":["javascript","node.js","garbage-collection","express","stackoverflowexception"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13201667,"title":"node.js / Express throws 'RangeError: Maximum call stack size exceeded' under high load","body":"<p>We are having an issue with our node environment running under high\nload that we have not been able to find the source of.</p>\n\n<p>A little background: we are running a clustered node application using\nExpress for the http framework.  Currently, there are 3 boxes with 8\nCPU cores on each, and each box is running a cluster of 6 node\nworkers.  The setup seems to work great and I've researched all the\nsuggested methodologies such that I believe the setup is solid. We're\nrunning node.js 0.8.1 with Express 2.5.11 and XMLHttpRequest 1.4.2.</p>\n\n<p>Here's the issue: We're doing a \"dark launch\" test of this product\n(i.e. the browser client code has javascript ajax calls to our APIs in\nthe background, but is not used on the page or shown to the user).  After a few minutes running successfully, the system is throwing:</p>\n\n<pre><code>[RangeError: Maximum call stack size exceeded]\n</code></pre>\n\n<p>We're catching the error with the 'uncaughtException' event in the\ncluster controller (which starts each worker), however there is no\nstack trace available at that level.  I've done extensive research on\nthis issue and can't seem to find anyone with a similar error.  After\ncombing through EVERY line of code in the system, here's what I know:</p>\n\n<ul>\n<li>I cannot find any recursion or circular references.  (I've read that\nthis error doesn't always mean a recursion problem, but we've checked;\nwe've actually run tests by removing most of the code anyways and it\nstill happens, see below);</li>\n<li>I've gone down to 1 worker process per box to try and eliminate the\ncluster as an issue -- the problem still happens;</li>\n<li>The problem ONLY happens under high load.  Our traffic is approx.\n1500 pages per second and, during heavy traffic times, can reach 15000\npages per second (we haven't been able to replicate on a dev\nenvironment);</li>\n<li>The timing of the error being caught varies, but is usually within 15 minutes;</li>\n<li>The error does NOT seem to impact operation!  By this, I mean that\nthere are no corrupt responses and, aside from the occasional timeout,\nthe system never crashes;</li>\n<li>The worker process that traps the error recovers and starts serving\nrequests again after a few seconds;</li>\n<li>I have gotten the error to happen on the most basic design--no\nadditional APIs are called.  Simply take a request and respond with a\nsimple json response.  This is the most curious part.  It doesn't seem\nlike the system is failing in any of my code -- It's failing without\ninstantiating any of the classes to do the <em>real</em> work.  Obviously, I\nstarted out with more code, but slowly took out pieces until it was\nstill failing under a bare-bones setup.</li>\n</ul>\n\n<p>The most telling symptom, I believe, is that the error always happens\nAFTER a request has been fully served.  That is, the server takes a\nrequest, finds the proper Express route, calls res.send, and is\nfinished.  This really feels like garbage collection to me!  I've read\nthat the V8 engine has a very good GC engine, but I'm wondering how\nmuch our heavy load is impacting things.</p>\n\n<p>As I said, the code throws the error even on a basic design.  Having\ntaken out most of our custom code, this is the basics of the setup.\nSorry that I'm cutting here, so not all variable declarations etc will\nbe included, however the code does work and all that stuff is in the\nreal code:</p>\n\n<p><strong>Cluster controller.  This is a cleaned-up version of what is started on the command line.</strong></p>\n\n<pre><code>cluster = require('cluster');\npath = require('path');\nfs = require('fs');\napp = require('./nodeApi');\n_ = require('underscore');\nnodeUtil = require(./nodeUtil);\n\nprocess.on('uncaughtException', function(err) {\n  var stamp;\n  stamp = new Date();\n  console.log(\"***************************** Exception Caught, \" + stamp);\n  return console.log(\"Exception is:\", err);\n});\n\nif (cluster.isMaster) {\n  if ((nodeUtil.isLiveServer() || nodeUtil.isCluster()) &amp;&amp; process.env.IS_CLUSTER !== '0') {\n    numCPUs = require(\"os\").cpus().length - 2;\n    if (numCPUs &lt;= 0) {\n      numCPUs = 1;\n    }\n  } else {\n    numCPUs = 1;\n  }\n  console.log(\"Forking \" + numCPUs + \" workers...\");\n  for (i = _i = 1; 1 &lt;= numCPUs ? _i &lt;= numCPUs : _i &gt;= numCPUs; i = 1 &lt;= numCPUs ? ++_i : --_i) {\n    worker = cluster.fork();\n  }\n} else {\n  app.start();\n}\n</code></pre>\n\n<p><strong>nodeWorker code.</strong>  Using Express and a simple route to serve a\nrequest.  Request is wrapped in a callback if jsonp is used (for our\ntesting with ajax, this was needed)</p>\n\n<pre><code>(function() {\n  var crypto, express, fs, modroot, path, staticroot, _;\n  express = require('express');\n  _ = require('underscore');\n  fs = require('fs');\n  path = require('path');\n\n  module.exports.start = function() {\n    logFile = fs.createWriteStream(\"\" + logpath + \"/access.log\", {\n      flags: 'a'\n    });\n\n    app = express.createServer();\n\n    app.configure(function() {\n      app.use(express.logger({\n        stream: logFile,\n        format: ':remote-addr - [:date] - \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" :response-time ms'\n      }));\n      app.use(express.errorHandler({\n        dumpExceptions: true,\n        showStack: true\n      }));\n      app.use(express.cookieParser());\n      app.use(express.bodyParser());\n      app.use(express.session({\n        secret: \"ourMemStoreSecret\",\n        cookie: {\n          domain: \".ourdomain.com\"\n        },\n        maxAge: new Date(Date.now() + 7200000),\n        // The store WAS a redis store.  I took it out to eliminate redis as the issue.  We don't use sessions anyway.\n        store: new require('express').session.MemoryStore({\n          reapInterval: 60000 * 15\n        })\n      }));\n      app.use(express[\"static\"](staticroot));\n      app.set('view engine', 'underscore');  // For our template rendering.  Not used in this test.\n      app.set('views', __dirname + '/views/src');\n      app.set('view options', {\n        layout: false\n      });\n      app.use(app.router);\n    });\n\n    ignore = function(req, res, next) {\n      if (req.params.api === 'favicon.ico') {\n        return next('route');\n      }\n      return next();\n    };\n\n    wrapCallback = function(req, res, next) {\n      var callbackName;\n      if (callbackName = req.query.callback) {\n        req.wrapCallback = true;\n        res._send = res.send;\n        res.send = function(data, status) {\n          var dataString;\n          if (_.isObject(data)) {\n            dataString = encodeURI(JSON.stringify(data));\n            res.setHeader('Content-Type', 'application/javascript');\n            return res._send(\"\" + callbackName + \"(\\\"\" + dataString + \"\\\")\", status);\n          } else {\n            data = encodeURI(data);\n            return res._send(\"\" + callbackName + \"(\\\"\" + data + \"\\\")\", status);\n          }\n        };\n      }\n      return next();\n    };\n\n    app.error(function(err, req, res, next) {\n      console.log(\"[\" + process.pid + \"] Error Handler. Ok.\", err);\n      return res.send({\n        error: err.msg\n      }, err.statusCode);\n    });\n\n    // Does anyone know how to hard-code a path AND put it into a variable at the same time?\n    // Kind of like: \"/:api=MyTestAPI\"  ??  That's why this route is here.\n    setAPIName = function(req, res, next) {\n      req.params.api = 'MyTestAPI';\n      return next();\n    };\n    app.get(\"/MyTestAPI\", setAPIName, wrapCallback, function(req, res) {\n      res.send({\n        hello: 'world'\n      }, 200);\n      return console.log(\"[\" + process.pid + \"] res.send (no cacher) is done\");\n    });\n\n    process.setMaxListeners(0);\n    process.send({\n      // For IPC - the controller has a handler for this message\n      cmd: 'isStarted'\n    });\n    return app.listen(process.env.APP_PORT);\n  };\n\n}).call(this);\n</code></pre>\n\n<p><strong>What the error looks like.</strong>  Basically, I never see it happen in\nthe middle of a request.  There isn't a call stack on the error\neither--it's only the stack overflow message.  Here you can see 2\nworker processes each serving a response, then the error on one of\nthem.</p>\n\n<pre><code>[660] res.send (no cacher) is done\n[654] res.send (no cacher) is done\n***************************** Exception Caught, Fri Nov 02 2012 10:23:48 GMT-0400 (EDT)\n</code></pre>\n\n<p>I would really appreciate some feedback on this.  The system runs\nbeautifully and is capable of handling our huge traffic with 3 boxes.\nThe load on the boxes is about 40% and humming.  I'd love to find the\nsource of this issue so others can be as proud of this system as I am,\nand show the node.js non-believers that this is a great product!\nThank you all for your help.</p>\n"},{"tags":["node.js","forever"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13201431,"title":"Forever with Node.JS not running","body":"<p>I have developped a node.js server.\nI was previously hosting it on an amazon ec2 instance, everything was working fine with forever.\nI just created a new instance, more powerful, reinstalled node and everything, and forever won't start.</p>\n\n<p>node -v\nv0.6.8</p>\n\n<p>npm ls</p>\n\n<p>/home/ec2-user/site\nâââ¬ forever@0.10.0\nâ âââ¬ cliff@0.1.8\nâ â âââ colors@0.6.0-1\nâ â âââ eyes@0.1.8\nâ âââ¬ flatiron@0.2.3\nâ â âââ¬ broadway@0.2.3\nâ â â âââ eventemitter2@0.4.9\nâ â âââ director@1.1.0\nâ â âââ¬ prompt@0.2.2\nâ â   âââ read@0.1.0\nâ â   âââ revalidator@0.1.3\nâ âââ¬ forever-monitor@1.0.1\nâ â âââ¬ broadway@0.2.5\nâ â â âââ eventemitter2@0.4.9\nâ â â âââ¬ nconf@0.6.4\nâ â â â âââ async@0.1.22\nâ â â â âââ ini@1.0.5\nâ â â âââ¬ utile@0.1.2\nâ â â   âââ async@0.1.22\nâ â â   âââ deep-equal@0.0.0\nâ â â   âââ i@0.3.1\nâ â â   âââ mkdirp@0.3.4\nâ â â   âââ ncp@0.2.6\nâ â â   âââ rimraf@1.0.9\nâ â âââ¬ minimatch@0.0.5\nâ â â âââ lru-cache@1.0.6\nâ â âââ¬ ps-tree@0.0.2\nâ â â âââ¬ parse-table@0.0.0\nâ â â   âââ¬ event-stream@0.5.3\nâ â â     âââ¬ optimist@0.2.8\nâ â â       âââ wordwrap@0.0.2\nâ â âââ¬ utile@0.0.10\nâ â   âââ async@0.1.22\nâ â   âââ mkdirp@0.3.4\nâ â   âââ ncp@0.2.6\nâ â   âââ rimraf@1.0.9\nâ âââ¬ nconf@0.6.1\nâ â âââ async@0.1.22\nâ â âââ ini@1.0.5\nâ âââ¬ nssocket@0.3.8\nâ â âââ eventemitter2@0.4.10\nâ â âââ lazy@1.0.8\nâ âââ¬ optimist@0.3.4\nâ â âââ wordwrap@0.0.2\nâ âââ pkginfo@0.2.3\nâ âââ timespan@2.0.1\nâ âââ¬ utile@0.1.2\nâ â âââ async@0.1.22\nâ â âââ deep-equal@0.0.0\nâ â âââ i@0.3.1\nâ â âââ mkdirp@0.3.4\nâ â âââ ncp@0.2.6\nâ â âââ rimraf@1.0.9\nâ âââ watch@0.5.1\nâ âââ¬ winston@0.6.2\nâ   âââ async@0.1.22\nâ   âââ colors@0.6.0-1\nâ   âââ cycle@1.0.0\nâ   âââ eyes@0.1.8\nâ   âââ request@2.9.203\nâ   âââ stack-trace@0.0.6\nâââ formidable@1.0.11\nâââ¬ mysql@2.0.0-alpha3\nâ âââ require-all@0.0.3\nâââ¬ socket.io@0.9.0\n  âââ policyfile@0.0.4\n  âââ redis@0.6.7\n  âââ¬ socket.io-client@0.9.0\n    âââ uglify-js@1.2.5\n    âââ¬ ws@0.4.0\n    â âââ commander@0.5.0\n    â âââ options@0.0.3\n    âââ xmlhttprequest@1.2.2</p>\n\n<p>I used to start my server with a little bash script :</p>\n\n<h1>!/bin/bash</h1>\n\n<h1>Invoke the Forever module (to START our Node.js server).</h1>\n\n<pre><code>./node_modules/forever/bin/forever \\\nstart \\\n-al forever.log \\\n-ao out.log \\\n-ae err.log \\\nindex.js\n</code></pre>\n\n<p>But now I always get :</p>\n\n<pre><code>[ec2-user@ip-XXXXXXXX site]$ ./start\n</code></pre>\n\n<p>info:    Forever processing file: index.js</p>\n\n<p>/home/ec2-user/site/node_modules/forever/lib/forever.js:404\n  monitor.send(JSON.stringify(options));\n          ^\nTypeError: Object # has no method 'send'\n    at Object.startDaemon (/home/ec2-user/site/node_modules/forever/lib/forever.js:404:11)\n    at /home/ec2-user/site/node_modules/forever/lib/forever/cli.js:229:13\n    at /home/ec2-user/site/node_modules/forever/lib/forever/cli.js:134:5\n    at Object.oncomplete (/home/ec2-user/site/node_modules/forever/lib/forever.js:340:24)</p>\n\n<p>Any idea of what could cause the crash ?\nThanks...</p>\n"},{"tags":["sql-server","node.js","unixodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":11414302,"title":"Node-odbc unable to connect to mssql","body":"<p>I've spent the last day or two setting up unixODBC and freetds on ubuntu 12 - not a fun process in itself but it does now work using both sqsh and isql. I've installed node-odbc and I'm using the code snippet provided in the <a href=\"https://github.com/w1nk/node-odbc\" rel=\"nofollow\">github readme</a> to test the connection but I always get</p>\n\n<pre><code> S1000:1:0:[unixODBC][FreeTDS][SQL Server]Unable to connect to data source\n WARNING: ev_unref is deprecated, use uv_unref\n [Error: Error opening database]\n</code></pre>\n\n<p>Using isql I run <code>isql -v SERVER user pass</code> (using the correct creds..) and then <code>use DATABASE</code> once connected and it all works and I can run queries fine. My connection string in the js is </p>\n\n<pre><code> \"DRIVER={FreeTDS};SERVER=SERVER;UID=user;PWD=pass;DATABASE=DATABASE\"\n</code></pre>\n\n<p>Which exactly matches the credentials used for connecting with isql but in Node I get the aforementioned error. Any ideas on why this is happening? Is it possible that it's to do the location of my odbc.ini and odbcinst.ini files or something like that?</p>\n\n<p>Just for reference:</p>\n\n<p>/etc/odbc.ini:</p>\n\n<pre><code>[SERVER]\nDriver      = FreeTDS\nTrace       = No\nServer      = SERVER\nPort        = 1433\nDatabase    = DATABASE\nUsageCount  = 1\nTDS_Version = 7.0\n</code></pre>\n\n<p>/etc/odbcinst.ini:</p>\n\n<pre><code>[FreeTDS]\nDescription = FreeTDS\nDriver = /usr/lib/libtdsodbc.so\nSetup = /usr/lib/libtdsS.so\nFileUsage   = 1\nCPTimeout   = 5\nCPReuse     = 20\nThreading   = 1\n</code></pre>\n\n<p>Thanks in advance for any help!</p>\n"},{"tags":["javascript","node.js","coding-style"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":74,"score":4,"question_id":13199697,"title":"Defensive programming in node.js using asserts","body":"<p>Considering that sometimes error messages in node are particularly unhelpful I like to liberally use asserts in my functions so that programming errors are caught asap and I can get a message which in general pinpoints the problem.</p>\n\n<pre><code>function doSomething(arg1, arg2){\n  assert(!arg1, \"arg1 is undefined\");\n  assert(!arg2, \"arg2 is undefined\");\n  assert(!arg1.expectedFn, \"arg1 does not have expectedFn\");\n\n  arg1.expectedFn(function(blah){\n    ...\n  }\n}\n</code></pre>\n\n<p>Is this a particularly bad thing to do in node/javascript programs? Does this have an impact on performance?</p>\n"},{"tags":["javascript","node.js","heroku"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13200810,"title":"Getting Heroku's config vars to work in node.js","body":"<p>I have a node app that has a line like this:</p>\n\n<pre><code>var ip = process.env.IP || 'http://localhost';\n</code></pre>\n\n<p>I am using it with <code>passport-facebook</code> node package to define the callback from Facebook authentication:</p>\n\n<pre><code>passport.use(new FacebookStrategy({\nclientID: FACEBOOK_APP_ID,\nclientSecret: FACEBOOK_APP_SECRET,\ncallbackURL: ip + \":\" + port + \"/auth/facebook/callback\"\n},\n  function(accessToken, refreshToken, profile, done) {\n    // asynchronous verification, for effect...\n    process.nextTick(function () {\n      return done(null, profile);\n    });\n  }\n));\n</code></pre>\n\n<p>It seems that Heroku doesn't know <code>process.env.IP</code> so I went ahead and defined a <code>config var</code> in Heroku:</p>\n\n<pre><code>heroku config:add process.env.IP=http://app.mydomain.com\n</code></pre>\n\n<p>Debugging the server I see that ip is not what I want but it's <code>http://localhost</code> same as I defined as the fallback in the first line of code.</p>\n\n<p>How do I get node to read the config var correctly from heroku ?</p>\n"},{"tags":["node.js","flock"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":499,"score":4,"question_id":5633050,"title":"call flock with node.js?","body":"<p>I have cron job to run node.js scripts.</p>\n\n<p>Want to use flock to lock a file to make sure my cron jobs are not\noverlapped.</p>\n\n<p>Any good module for doing file locking ?</p>\n\n<p>Or I should call that in child process ?</p>\n\n<p>Or I should not do any file locking ?</p>\n\n<p>Sorry, I am new to this and not sure file locking is good for async\nenv like node. Thanks</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13200113,"title":"How to enforce proxy settings for 3rd party nodejs models?","body":"<p>I am developing in Node.js behind a proxy. In my code I set the requests with proper proxy settings, but when using 3rd party models, I found that nearly all do not support proxy configuration. Is there a way to globally 'set' them to use a proxy/ some other work around to this?\nThanks</p>\n"},{"tags":["node.js","express"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13198129,"title":"Express 3 error middleware not being called","body":"<p>I am trying to setup error handling for my express app and running into the following problem.</p>\n\n<p>I defined an error middleware and add it as the last middleware:</p>\n\n<pre><code>// error handler\napp.use(function(err, req, res, next) {\n\n    console.log('JUST TESTING. ERROR HANLDER HAS BEEN CALLED...');\n    next(err);\n});\n</code></pre>\n\n<p>Now I would expect this middleware to be called whenever an error occurs:</p>\n\n<pre><code>app.get('/datenschutz', function(req, res, next){\n        return next(new Error('Just testing')); // handle everything here\n    });\n</code></pre>\n\n<p>However my middleware is never called! The browser does display the stack trace however.\nThis seems that there is another middleware that is catching this error and processing it before I can do anything about it.</p>\n\n<p>The problem is that I have no clue where this middleware could be defined, as I have a very simple setup:</p>\n\n<pre><code>// setup ssl for local testing\nvar\n    app = express();\n\napp.\n    use(express.static(__dirname + '/public')).\n    use(express.bodyParser()).\n    use(express.cookieParser());\n</code></pre>\n\n<p>Why is my error handling middleware not being called?\nWhere is this 'default' error handling taking place?</p>\n\n<p>Thanks!</p>\n\n<p><strong>* EDIT *</strong>\nI see that the middleware is indeed working. However this is the case if I call it from another middleware function.\nHowever it is not being invoked if the error occurs inside a function defined as an express route (GET, POST, etc..). This is very strange.\nIf I add my error middleware to the route callbacks it then works:</p>\n\n<pre><code>app.get('/testError', function(req, res, next){\n        return next(new Error('Just testing')); // handle everything here\n    }, function(err,req,res,next) {\n        console.log('This error handler is called!!');\n        return next();\n    });\n</code></pre>\n\n<p><strong>* EDIT 2 - FOUND ACCEPTABLE WORKAROUND **</strong>\nI am surprised it has to be done this way. As I had read many entries/questions about error handling in express and never found this possibility mentioned.\nHowever it seems that if an error ocurrs inside a route callback regular error middleware handlers will not pick it up. You will need to define an error handler at route level.</p>\n\n<pre><code>app.all('*', function(err,req,res,next) {\n        console.log('This is a global error handler at route level....');\n        return next(err);\n    });\n</code></pre>\n"},{"tags":["node.js","twitter-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13199607,"title":"Any known Twitter REST and Stream API NodeJS modules that support running behind a proxy?","body":"<p>I  have tried a few of the known modules (twitter, tuiter) and they seem not to support cases in which the app is ran behind a proxy. Are there any modules that do support that?\nThanks</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13180447,"title":"timing issues in node.js","body":"<p>i'm having trouble understanding how to correctly handle assignments in node callbacks. I'm reading a config file and setting it's values in an express app using props to parse the .yaml. When i try and use what i've apparently set i can't app.get these values. (cfg_decoder is required from the props module). The console.log() works properly in the callback but how to I handle app.get outside of the callback or know when the values have been set?</p>\n\n<pre><code>app = express()\n\nfs.readFile('./config.yaml', function (err,data) {\n  if (err) {\n    return console.log(err);\n  }\n\n  cfg = cfg_decoder(data);\n  app.set('title', cfg['title'])\n  app.set('port', cfg['port'])\n\n  console.log(app.get('title'))\n\n});\n</code></pre>\n\n<p>On a side note, is this a good way of setting configuration options?</p>\n"},{"tags":["javascript","node.js","npm","gruntjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13196701,"title":"Generating build meta data for a node/npm module","body":"<p>Our team is using grunt and requirejs to build/optimize our application.  It would be nice if I could output some json w/ build date and an updated minor version number.  Seems like this would be a fairly common thing.  Anything out there that does this already?</p>\n"},{"tags":["regex","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13197287,"title":"Parameters validation with Express using Regular Expressions","body":"<p>I would like to validate http request parameters in Express (and express-param) using regular expressions.\nThis parameter must be a number with 11 digits at least.</p>\n\n<p>Why <code>app.param('uid', /^[0-9]{11,}+$/);</code> returns an error?</p>\n\n<p>And why <code>app.param('uid', /^[0-9]{11,}/);</code> don't works fine?\nIt blocks params like <code>1234567890c</code> and accepts <code>12345678901c</code> or <code>12345678901ca</code>.</p>\n"},{"tags":["node.js","base64","image-manipulation"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13193290,"title":"Image manipulation in NodeJS with base64 image data","body":"<p>I have a nodejs server that receives images encoded in base64 through a websocket. I would like to do some image manipulation on those images and send them back. I searched a little bit on the net to find some library to help me doing this, but all I could find were libraries that take images stored somewhere in the server side, do the manipulation and save back the image. Apparently all of them take as input a string containing the filename of the image, so I guess under the hood they are fetching the image manually through a file stream.</p>\n\n<p>My question is, is there a library that may help me working directly on base64 data (that is, passing the data as input to the functions) or should I save every time the image on the server, modify it and send it back? I would rather not go with the latter because I'm working on some high-performance application, and all this saving/loading looks a waste of cycles. Otherwise, do you see some other way I could achieve this (that is, getting the image file without saving and loading it back, for example)?</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","express","stylus"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13196835,"title":"Stylus only recompiles .styl files on index page load","body":"<p>I was originally super frustrated when trying to set up Stylus, because I would adjust my <code>src</code> and <code>dest</code> settings, , restart Node, refresh, and Stylus wasn't compiling.  This was on a page like <code>http://localhost:3000/tasks</code>.  However, the <code>src</code> and <code>dest</code> paths were correct, and when I would restart Node and try to load the index page, <code>http://localhost:3000</code>, Stylus would then compile correctly.</p>\n\n<p>So now that I've figured out that it's compiling properly, but only from the home URL, I'm wondering if I have something set up wrong, because any changes to .styl files are not being updated until I refresh from the home page, not any GET parameter page.</p>\n\n<pre><code>var express = require('express');\nvar app = express();\nvar stylus = require('stylus');\n\napp.configure(function () {\n    this.set(\"views\", __dirname + \"/views/jade\");\n    this.set(\"view engine\", \"jade\");\n    this.use(express.bodyParser());\n    this.use(express.methodOverride());\n    this.use(this.router);\n\n    this.use(stylus.middleware({\n        src: __dirname + '/views/styl', //styl files to be compiled\n        dest: __dirname + '/public/css', //destination for compiled css\n        compress: true\n    }));\n\n    this.use(express.static(__dirname + '/public'));\n});\n</code></pre>\n\n<p>Is what I'm describing the normal process, or should Stylus recompile no matter what your URL is if it notices changes in a <code>.styl</code> file?</p>\n"},{"tags":["node.js","http","proxy","express"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13196540,"title":"“Proxying” a lot of HTTP requests with Node.js + Express","body":"<p>I'm writing proxy in Node.js + Express. Proxy should:</p>\n\n<ol>\n<li>decrypt POST payload and issue HTTP request to server based on result;</li>\n<li>encrypt reply from server and send it back to client.</li>\n</ol>\n\n<p>Encryption-related part works fine. The problem I'm facing is timeouts. Proxy should process requests in less than 15 secs. And most of them are under 500ms, actually.</p>\n\n<p>Problem appears when I increase number of parallel requests. Most requests are completed ok, but some are failed after 15 secs + couple of millis. <code>ab -n5000 -c300</code> works fine, but with concurrency of 500 it fails for some requests with timeout.</p>\n\n<p>I could only speculate, but it seems thant problem is an order of callbacks exectuion. Is it possible that requests that comes first are hanging until <code>ETIMEDOUT</code> because of node's focus in latest ones which are still being processed in time under 500ms.</p>\n\n<p>P.S.: There is no problem with remote server. I'm using <a href=\"https://github.com/mikeal/request\" rel=\"nofollow\">request</a> for interactions with it.</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13195847,"title":"Running Javascript code through NodeJS","body":"<p>I need help on running javascript code through NodeJS. So far I have the following code;</p>\n\n<pre><code>txt=\"&lt;bookstore&gt;&lt;book&gt;\";\ntxt=txt+\"&lt;title&gt;Everyday Italian&lt;/title&gt;\";\ntxt=txt+\"&lt;author&gt;Giada De Laurentiis&lt;/author&gt;\";\ntxt=txt+\"&lt;year&gt;2005&lt;/year&gt;\";\ntxt=txt+\"&lt;/book&gt;&lt;/bookstore&gt;\";\n\nparser=new DOMParser();\nxmlDoc=parser.parseFromString(txt,\"text/xml\");\nx=xmlDoc.getElementsByTagName(\"title\")[0].childNodes[0];\nx.nodeValue=\"Diffrent Title\";\n</code></pre>\n\n<p>I have it as test.js and I run it in the commant prompt as</p>\n\n<pre><code>node test.js\n</code></pre>\n\n<p>But it gives the following error:</p>\n\n<pre><code>ReferenceError: DOMParser is not defined\n</code></pre>\n\n<p>What as I doing wrong here. Can any one help please.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13195250,"title":"userdefined javascript function from nodeJS","body":"<p>I'm new to NodeJS.\nHow can I execute my own javascript function from NodeJS.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13190885,"title":"Preventing database-related race conditions in Node.js","body":"<h2>Overview</h2>\n\n<p>I am attempting to understand how to ensure aynchronous safety when using an instance of a model when using Node.js.  Here, I use the Mongoose ODM in code samples, but the question applies to any case where a database is used with the asynchronous event-driven I/O approach that Node.js employs.</p>\n\n<p>Consider the following code (which uses Mongoose for MongoDB queries):</p>\n\n<h3>Snippet A</h3>\n\n<pre><code>MyModel.findOne( { _id : &lt;id #1&gt; }, function( err, doc ) {\n    MyOtherModel.findOne( { _id : someOtherId }, ( function(err, otherDoc ) {\n        if (doc.field1 === otherDoc.otherField) {\n            doc.field2 = 0; // assign some new value to a field on the model\n        }\n        doc.save( function() { console.log( 'success' ); }\n    });\n});\n</code></pre>\n\n<p>In a separate part of the application, the document described by MyModel could be updated.  Consider the following code:</p>\n\n<h3>Snippet B</h3>\n\n<pre><code>MyModel.update( { _id : &lt;id #1&gt; }, { $set : { field1 : someValue }, callback );\n</code></pre>\n\n<p>In Snippet A, a MongoDB query is issued with a registered callback to be fired once the document is ready.  An instance of the document described by MyModel is retained in memory (in the \"doc\" object).  The following sequence could occur:</p>\n\n<ol>\n<li><strong>Snippet A</strong> executes</li>\n<li>A query is initiated for MyModel, registering a callback (callback A) for later use</li>\n<li><em>&lt;&lt; The Node event loop runs >></em></li>\n<li>MyModel is retrieved from the database, executing the registered callback (callback A) </li>\n<li>A query is initiated for MyOtherModel, registering a callback for later use (callback B)</li>\n<li><em>&lt;&lt; The Node event loop runs >></em></li>\n<li><strong>Snippet B</strong> executes</li>\n<li>The document (id #1) is updated</li>\n<li><em>&lt;&lt; The Node event loop runs >></em></li>\n<li>MyOtherModel is retrieved from the database, executing the registered callback (callback B)</li>\n<li>The stale version of the document (id #1) is incorrectly used in a comparison.</li>\n</ol>\n\n<h2>Questions</h2>\n\n<ol>\n<li>Are there any guarantees that this type of race condition won't happen in Node.js/MongoDB?  </li>\n<li>What can I do to deterministically prevent this scenario from happening?  </li>\n</ol>\n\n<p>While Node runs code in a single-threaded manner, it seems to me that any allowance of the event loop to run opens the door for potentially stale data.  Please correct me if this observance is wrong.</p>\n"},{"tags":["javascript","sql","sqlite","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12797332,"title":"SQLite SELECT * FROM table WHERE id=? Troubles","body":"<p>There's a gap in my knowledge here and I can't find the answer on the internet.</p>\n\n<p>Basically I'm making a node.js app that pushes entries from an SQLite Database using socket.io. </p>\n\n<p>I'm using the implementation of SQLite here -> <a href=\"https://github.com/developmentseed/node-sqlite3\" rel=\"nofollow\">https://github.com/developmentseed/node-sqlite3</a></p>\n\n<p>I'm trying to execute the statement:</p>\n\n<pre><code>db.serialize(function() {\n        db.run(\"SELECT * FROM messages WHERE id=?\", messageNum, function(err, row) {\n            console.log(row.id);            \n        });\n    });\n</code></pre>\n\n<p>I can't find documentation. It's throwing this error at the moment:</p>\n\n<p>Cannot read property 'id' of undefined</p>\n\n<p>I basically guessed the syntax... Anyone know what it actually is?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have got around the problem with an extremely inefficient solution for now:</p>\n\n<pre><code>db.serialize(function() {\n\n        db.each(\"SELECT id, msg, date FROM messages\", function(err, row) {\n            if(row.id === messageNum){\n                console.log(row.id);    \n            }\n        });\n\n    });\n</code></pre>\n\n<p>Would be good if someone could point me in the right direction at some point though, thanks.</p>\n"},{"tags":["node.js","express","socket.io","derbyjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":11882263,"title":"Derbyjs: how to connect to it with no-browser socket.io-client","body":"<p><strong>step:</strong></p>\n\n<ol>\n<li>start a derby app</li>\n<li>write a standalone node client app , set up socket.io-client , connect to derby's store's sockets</li>\n</ol>\n\n<p><strong>questions:</strong></p>\n\n<ol>\n<li><p>the client is not run at browser, so it don't has session, can it pass Racer's socket authorization?</p></li>\n<li><p>how to write dery service that can listen message from client, then put it into derby store/model?</p></li>\n</ol>\n"},{"tags":["node.js","web-applications"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13194041,"title":"socket.io-client and webpage","body":"<p>This is probably a very simple thing, but I can't figure it out as I'm relatively new to this. I have a server with an index.html page running great on nodejitsu. It works fine with no issues at all. However, I also have another node.js utilising socket.io-client. It's connecting fine and doing what I want it to do, but I'd like to incorporate an HTML page with it so I can control it with a click of a button. Essentially, I am trying to get my nodejitsu server page to refresh with a click of a button on my socket.io-client page. Here's the code on my client:</p>\n\n<pre><code>var io = require('socket.io-client'),\nsocket = io.connect('http://danturner81.server.jit.su', {port: 80});\n\nsocket.on('connect', function () { console.log(\"socket connected\"); });\nsocket.on('disconnect', function () { console.log(\"socket disconnected\"); });\nsocket.send('refreshScreen'); \n</code></pre>\n\n<p>When I start this node via the terminal, it refreshes the page at danturner81.server.jit.su just fine. How would I incorporate this into a webpage with a button that executes the 'socket.send'?</p>\n\n<p>Sorry if this appears dumb, but I really can't figure it out and I know I'm close to getting where I want!</p>\n\n<p>Regards</p>\n\n<p>Dan</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13193241,"title":"How to calculate how many unique not authorized users opened specific url in Node Js?","body":"<p>I'm using ExpressJs and MongoDB. I want to show how many not authorized unique users have opened specific event page. <br>\nHow should I implement this request counter ? <br>\nCheck IP address or add some mark in cookie...    </p>\n"},{"tags":["node.js","mongodb","mongoskin"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13157582,"title":"How to use gridfs().exist with mongoskin?","body":"<p>I'm using mongoskin for my mongo connection.</p>\n\n<p>I'm trying to check whether a file exists on gridfs, it's always returning false / causing a \"segmentation fault: 11\"</p>\n\n<p>I couldn't find anything in the documentation except for <code>node-mongodb-native</code>, which I've tried to follow because I'm under the impression mongoskin just repackages this driver, and leaves features like gridfs fairly untouched.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>var mongo = require( 'mongoskin' );\n\nvar db = mongo.db( 'http://localhost:27017/testdb', { safe: false } ),\n    gridfs = db.gridfs();\n\nvar filename = 'test',\n    data = 'test';\n\ngridfs.open( filename, 'w', function( error, gs ) {\n    gs.write( data, function( error, gs ) {\n        gs.close( function( error, result ){\n            gridfs.exist( db, filename, function( error, exists ) {\n                console.log( error, exists );\n                done();\n            });\n        });\n    });\n});\n</code></pre>\n\n<p>I believe the problem lies with this line:</p>\n\n<pre><code>gridfs.exist( db ...\n</code></pre>\n\n<p>I've tried <code>db</code>, <code>db.db</code>, and <code>'testdb'</code></p>\n"},{"tags":["javascript","node.js","express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13192660,"title":"Nodejs Error: EMFILE","body":"<p>I need to open a directory containing files.. open readstream for each and write the data from all the files into a single file. But I keep getting Error: EMFILE, open 'chunks/piece96.data'</p>\n\n<p>My ulimit was 256 and I increased it to 1024. I have 127 files in the directory to open, read and write into a single file. </p>\n\n<p>My code is below</p>\n\n<pre><code>\n\n    var DIR='chunks/';\n    var files=fs.readdirSync(DIR);\n    var filename='bach.mp3';\n\n    files.forEach(function(singlebit){\n        //console.log(files);\n        var bit=fs.createReadStream(DIR+singlebit);\n        var resultfile=fs.createWriteStream(filename,{\n            flags:'r+',\n            encoding:null,\n            mode:0666\n        });\n        bit.on('data',function(bitdata){ \n                resultfile.write(bitdata); \n                console.log(bitdata);\n            }).on('end',function(){\n                resultfile.end();\n            });\n        });\n    console.log('file complete');\n\n</code></pre>\n\n<p>How can I prevent the EMI file error. I am not opening many files at once since I am using readdirSync and not opening all of them at once. I need a way to read all the files and write to a single file. </p>\n"},{"tags":["javascript","node.js","ssl","heroku"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":114,"score":1,"question_id":13104185,"title":"running shadowsocks-nodejs on heroku","body":"<p>What I am trying to accomplish: Get <a href=\"https://github.com/clowwindy/shadowsocks-nodejs\" rel=\"nofollow\">shadowsocks-node.js</a> to run on heroku.</p>\n\n<blockquote>\n  <p>shadowsocks-nodejs is a lightweight tunnel proxy which can help you get through firewalls.</p>\n</blockquote>\n\n<p>I got it to run locally with both processes on the same machine.<br>\nMy next step was to deploy it to heroku and run server.js there and local.js locally on my machine. However, I can't seem to get a connection going.</p>\n\n<p>My problem: the connections seem to be refused by the server process.</p>\n\n<hr>\n\n<p>node local.js outputs: </p>\n\n<pre><code>calculating ciphers\nserver listening at port 1080\nserver connected\nconcurrent connections: 1\nremote connection refused\nserver connected\nconcurrent connections: 1\nremote connection refused\nserver connected\n</code></pre>\n\n<p>and so on...</p>\n\n<p>server.js outputs (via <code>heroku logs</code>):</p>\n\n<pre><code>012-10-27T20:39:57+00:00 app[web.1]: server connected\n2012-10-27T20:39:57+00:00 app[web.1]: concurrent connections: 1\n2012-10-27T20:39:57+00:00 app[web.1]: server disconnected\n2012-10-27T20:39:57+00:00 app[web.1]: concurrent connections: 0\n2012-10-27T20:42:02+00:00 app[web.1]: server connected\n2012-10-27T20:42:02+00:00 app[web.1]: concurrent connections: 1\n2012-10-27T20:42:02+00:00 app[web.1]: server disconnected\n</code></pre>\n\n<p>and so on.</p>\n\n<p>Chrome gives back the error:</p>\n\n<pre><code>Error 324 (net::ERR_EMPTY_RESPONSE): The server closed the connection without sending any data.\n</code></pre>\n\n<p>(makes sense)</p>\n\n<hr>\n\n<p>This is my config.json that is used by shadowsocks:</p>\n\n<pre><code>{\n    \"server\":[\"https://damp-woodland-7539.herokuapp.com\"],\n    \"server_port\":58954,\n    \"local_port\":1080,\n    \"password\":\"barfoo!\",\n    \"timeout\":60\n}\n</code></pre>\n\n<p>I edited server.js to read (line 31): </p>\n\n<pre><code>//PORT = config.server_port;\nPORT = process.env.PORT || 5000;\n</code></pre>\n\n<p>as advised for heroku apps.</p>\n\n<p>And this is my package.json file:</p>\n\n<pre><code>{\n  \"name\": \"shadowsocks-nodejs\",\n  \"scripts\": {\n    \"start\": \"server.js\"\n  },\n  \"version\": \"0.0.1\",\n  \"engines\": {\n    \"node\": \"0.8.x\"\n  },\n  \"dependencies\": {\n    \"fs\": \"*\",\n    \"net\": \"*\"\n  }\n}\n</code></pre>\n\n<hr>\n\n<p>This might be just a simple setup issue or some incorrect addresses. Would be great if someone of you could help me out.<br>\nThanks a lot!</p>\n"},{"tags":["node.js","emacs","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13185729,"title":"npm don't display prompt correctly under emacs eshell","body":"<p>This question <a href=\"http://stackoverflow.com/questions/9390770/node-js-prompt-can-not-show-in-eshell/9396083#9396083\">Node.js prompt &#39;&gt;&#39; can not show in eshell</a> solve the problem for the node repl, but that solution don't work when you call node from npm.</p>\n\n<p>By example if I make</p>\n\n<pre><code>$ npm init\nThis utility will walk you through creating a package.json file.\nIt only covers the most common items, and tries to guess sane defaults.\n\nSee `npm help json` for definitive documentation on these fields\nand exactly what they do.\n\nUse `npm install &lt;pkg&gt; --save` afterwards to install a package and\nsave it as a dependency in the package.json file.\n\nPress ^C at any time to quit.\n^[[1G^[[0Jname: (nodo1) ^[[15G\n</code></pre>\n\n<p>Or if you have a package.json with a \"scripts\" : { \"start\" :  \"node\" }</p>\n\n<pre><code>$ npm start\nnpm WARN package.json nodo1@0.0.1 No README.md file found!\n&gt; node\n\n^[[1G^[[0J&gt; ^[[3G\n</code></pre>\n\n<p>I know this one could be solved using \"start\" : \"env NODE_NO_READLINE=1 node\", but write this everywhere isn't a find solution. And maybe other user of the package don't use emacs and need set the env var in other way.</p>\n\n<p>I have try with a alias for npm setting NODE_NO_READLINE=1 but the same result</p>\n\n<pre><code>alias npm='env NODE_NO_READLINE=1 npm'\n</code></pre>\n"},{"tags":["node.js","web-applications","express","yeoman"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":55,"score":6,"question_id":13160599,"title":"Yeoman and ExpressJS","body":"<p>I want to know if there is some boilerplate code to use a frontend workflow tool like Yeoman with a backend framework like ExpressJS, if I want to maintain the same codebase for both the front and back ends.</p>\n\n<p>Basically I want to know -</p>\n\n<ul>\n<li><p>How do the boilerplate code produced by yeoman and express fit in together. Is there a way to integrate the two? (How does the gruntfile fit into the express project)</p></li>\n<li><p>Can I substitute yeoman's default watch with an express server which reloads pages on update? </p></li>\n</ul>\n"},{"tags":["linux","node.js","webserver"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13189474,"title":"Which Linux distribution is more suitable for the Node.js web server","body":"<p>I create a web server with Node.js. I'm using the Express framework. The database is MongoDB.</p>\n\n<p>I want to host web server on a Linux machine. I don't know how to make the decision between the different Linux distributions, such as Debian, Unbuntu or RedHat. </p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>What is the main difference of the different distributions?</li>\n<li>Which factors should I take into account?</li>\n<li>Which one is better for my requirement?</li>\n</ol>\n"},{"tags":["security","node.js","webserver"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13189508,"title":"How to save the confidential data at server side","body":"<p>I create a web server with Node.js. The database is MongoDB. I'm using a json file to save the server configuration. The node module 'nconf' is used to read the json file. </p>\n\n<p>Currently, all the data, including some confidential data, saved in the json file is plain text. I don't think it is security enough. What should I do to make sure the confidential data is security?</p>\n"},{"tags":["node.js","imagemagick"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":13176723,"title":"Node.js thumbnailer using Imagemagick: nondeterministic corruption","body":"<p>I have a Node.js server which dynamically generates and serves small (200x200) thumbnails from images (640x640) in a database (mongodb). I'm using the <a href=\"https://github.com/rsms/node-imagemagick\" rel=\"nofollow\">node-imagemagick</a> module for thumbnailing.</p>\n\n<p>My code works roughly 95% of the time; about 1 in 20 (or fewer) thumbnailed images are corrupt on the client (iOS), which reports:</p>\n\n<blockquote>\n  <p>JPEG Corrupt JPEG data: premature end of data segment</p>\n</blockquote>\n\n<p>For the corrupt images, the client displays the top 50% - 75% of the image, and the remainder is truncated.</p>\n\n<p>The behavior is non-deterministic and the specific images which are corrupt changes on a per-request basis.</p>\n\n<p>I'm using the following code to resize the image and output the thumbnail:</p>\n\n<pre><code>im.resize({\n  srcData: image.imageData.buffer,\n  width: opt_width,\n}, function(err, stdout) {\n  var responseHeaders = {};\n  responseHeaders['content-type'] = 'image/jpeg';\n  responseHeaders['content-length'] = stdout.length;\n  debug('Writing ', stdout.length, ' bytes.');\n  response.writeHead(200, responseHeaders);\n  response.write(stdout, 'binary');\n  response.end();\n});\n</code></pre>\n\n<p>What could be wrong, here?</p>\n\n<p>Notes:</p>\n\n<ol>\n<li>The problem is not an incorrect <code>content-length</code> header. When I omit the header, the result is the same.</li>\n<li>When I do not resize the image, the full-size image always seems to be fine.</li>\n<li>In researching this I found <a href=\"http://stackoverflow.com/questions/6164095/reading-binary-data-from-a-child-process-in-node-js\">this</a> and <a href=\"http://stackoverflow.com/questions/10221892/problems-serving-a-binary-image-passed-through-stdout-with-node\">this</a> StackOverflow questions, which both solved the problem by increasing the buffer size. In my case the images are very small, so this seems unlikely to be responsible.</li>\n<li>I was originally assigning <code>stdout</code> to a <code>new Buffer(stdout, 'binary')</code> and writing that. Removing it (<code>'binary'</code> will be deprecated) made no difference.</li>\n</ol>\n"},{"tags":["javascript","node.js","selenium-rc","soda"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13190474,"title":"How does soda.js chaining API work for selenium testing sites using node.js","body":"<p>I'm attempting to create a node.js script using <a href=\"https://github.com/LearnBoost/soda/\" rel=\"nofollow\">soda.js</a> for organizing and writing <a href=\"http://seleniumhq.org/\" rel=\"nofollow\">Selenium</a> scripts. The problem I am running into is that I fundamentally do not understand the <a href=\"https://github.com/LearnBoost/soda/\" rel=\"nofollow\">soda.js</a> chaining philosophy, especially the <code>and()</code> method and the docs are very weak in explaining how it works.</p>\n\n<p>Imagine the following test case:</p>\n\n<pre><code>var soda = require('soda');\nvar assert = require('assert');\n\nvar browser = soda.createClient({\n    host: 'localhost',\n    port: 4444,\n    url: 'http://www.google.com',\n    browser: 'firefox'\n});\n\nbrowser\n    .chain\n    .session()\n    .open(\"http://www.google.com\", function() {\n        console.log(\"open complete\");\n    })\n    .and(function() {\n        console.log(\"and\");\n    })\n    .and(function() {\n        return function(browser) {\n            console.log(\"and2\");\n        }\n    }())\n    .end(function() {\n        console.log(\"end\");\n    })\n</code></pre>\n\n<p>My understanding of the chaining API was that it was to prevent callback hell. So if I call browser.method1().method2().method3(). Then method2 would wait for method one. method3 would wait for method2() etc. Giving you the ease of synchronous, but the functionality of evented.</p>\n\n<p>I expect</p>\n\n<pre><code>open complete\nand\nand2\nend\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>and\nand2\nopen complete\nend\n</code></pre>\n\n<p>What? It clearly has something to do with the <code>and</code> method, which I thought was declaring your own arbitrary functions, but it doesn't seem to be following the queue order. As you can see in the test case I've tried two methods of declaring the and function, one using a self-executing function closure, and the other with a standard anonymous function. Same result in both cases. How do I get the <code>and()</code> to follow the queue order?</p>\n"},{"tags":["node.js","imagemagick"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13190029,"title":"Error while resizing image using imagemagick in nodejs , How to Fix this?","body":"<p>I am using imagemagick library for resizing image to fit for the UI specification,</p>\n\n<p>I have installed imagemagick by following cmd:\n sudo npm install imagemagick</p>\n\n<p>Installation is done correctly, but i am getting the error while resizing,</p>\n\n<p>My code :</p>\n\n<pre><code>                var im = require('imagemagick');\n                im.resize({\n                            srcPath:\"/tmp/\"+imageName,\n                            dstPath:\"/home/image/\" + imageName,\n                            width:43,\n                            height :43,\n                       }, function(err, stdout, stderr){\n                       if (err) {\n                                console.log('error while resizing image ' + err);\n                                }\n                          });\n</code></pre>\n\n<p>I am getting the following error:</p>\n\n<pre><code>      Error: Command failed: execvp(): No such file or directory\n</code></pre>\n"},{"tags":["javascript","node.js","template-engine","jade"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":243,"score":2,"question_id":10659775,"title":"Long block of text in Jade textarea?","body":"<p>I'm using <a href=\"http://jade-lang.com/\" rel=\"nofollow\">Jade</a> in my latest node.js app. I'd like to have a long block of text in a textarea by default.</p>\n\n<p>If I do something like this:</p>\n\n<pre><code>textarea(id=\"theTextarea\")\n</code></pre>\n\n<p>it renders just fine:</p>\n\n<pre><code>&lt;textarea id=\"theTextarea\"&gt;&lt;/textarea&gt;\n</code></pre>\n\n<p>However, if I do something like so:</p>\n\n<pre><code>textarea(id=\"theTextarea\")\n  Hello world.\n</code></pre>\n\n<p>I get this:</p>\n\n<pre><code>&lt;textarea id=\"theTextarea\"&gt;\n  &lt;hello&gt;world&lt;/hello&gt;\n&lt;/textarea&gt;\n</code></pre>\n\n<p>But I'd like it to be like so:</p>\n\n<pre><code>&lt;textarea id=\"theTextarea\"&gt;\n  hello, world\n&lt;/textarea&gt;\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["javascript","html5","node.js","server-side-events"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":142,"score":8,"question_id":12978466,"title":"JavaScript EventSource SSE not firing in browser","body":"<p>I have been developing a nodejs server to provide server-side-events for a new website I am developing in HTML5.</p>\n\n<p>When I telnet to the server it works correctly, sending me the required HTTP response headers followed by a stream of events that i am presently generating every 2 or 3 seconds just to prove it works.</p>\n\n<p>I have tried the latest version of FireFox, Chrome and Opera and they create the EventSource object and connect to the nodejs server OK but none of the browsers generate any of the events, including the onopen, onmessage and onerror.</p>\n\n<p>However, if I stop my nodejs server, terminating the connection from the browsers, they all suddenly dispatch all the messages and all my events are shown. The browsers then all try to reconnect to the server as per spec.</p>\n\n<p>I am hosting everything on a webserver. nothing is running in local files.</p>\n\n<p>I have read everything I can find online, including books I've purchased and nothing indicates any such problem. Is there something Im missing?</p>\n\n<p><strong>A sample server implementation</strong></p>\n\n<pre><code>  var http = require('http');\n  var requests = [];\n\n  var server = http.Server(function(req, res) {\n    var clientIP = req.socket.remoteAddress;\n    var clientPort = req.socket.remotePort;\n\n    res.on('close', function() {\n      console.log(\"client \" + clientIP + \":\" + clientPort + \" died\");\n\n      for(var i=requests.length -1; i&gt;=0; i--) {\n        if ((requests[i].ip == clientIP) &amp;&amp; (requests[i].port == clientPort)) {\n          requests.splice(i, 1);\n        }\n      }\n    });\n\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream', \n      'Access-Control-Allow-Origin': '*', \n      'Cache-Control': 'no-cache', \n      'Connection': 'keep-alive'});\n\n    requests.push({ip:clientIP, port:clientPort, res:res});\n\n    res.write(\": connected.\\n\\n\");\n  });\n\n  server.listen(8080);\n\n  setInterval(function test() {\n    broadcast('poll', \"test message\");\n  }, 2000);\n\nfunction broadcast(rtype, msg) {\n  var lines = msg.split(\"\\n\");\n\n  for(var i=requests.length -1; i&gt;=0; i--) {\n    requests[i].res.write(\"event: \" + rtype + \"\\n\");\n    for(var j=0; j&lt;lines.length; j++) {\n      if (lines[j]) {\n        requests[i].res.write(\"data: \" + lines[j] + \"\\n\");\n      }\n    }\n    requests[i].res.write(\"\\n\");\n  }\n}\n</code></pre>\n\n<p><strong>A sample html page</strong></p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;SSE Test&lt;/title&gt;\n    &lt;meta charset=\"utf-8\" /&gt;\n    &lt;script language=\"JavaScript\"&gt;\n      function init() {\n        if(typeof(EventSource)!==\"undefined\") {\n          var log = document.getElementById('log');\n          if (log) {\n            log.innerHTML = \"EventSource() testing begins..&lt;br&gt;\";\n          }\n\n          var svrEvents = new EventSource('/sse');\n\n          svrEvents.onopen = function() {\n            connectionOpen(true);\n          }\n\n          svrEvents.onerror = function() {\n            connectionOpen(false);\n          }\n\n          svrEvents.addEventListener('poll', displayPoll, false);             // display multi choice and send back answer\n\n          svrEvents.onmessage = function(event) {\n              var log = document.getElementById('log');\n              if (log) {\n                log.innerHTML += 'message: ' + event.data + \"&lt;br&gt;\";\n              }\n            // absorb any other messages\n          }\n        } else {\n          var log = document.getElementById('log');\n          if (log) {\n            log.innerHTML = \"EventSource() not supported&lt;br&gt;\";\n          }\n        }\n      }\n\n      function connectionOpen(status) {\n          var log = document.getElementById('log');\n          if (log) {\n            log.innerHTML += 'connected: ' + status + \"&lt;br&gt;\";\n          }\n      }\n\n      function displayPoll(event) {\n        var html = event.data;\n          var log = document.getElementById('log');\n          if (log) {\n            log.innerHTML += 'poll: ' + html + \"&lt;br&gt;\";\n          }\n      }\n    &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body onLoad=\"init()\"&gt;\n    &lt;div id=\"log\"&gt;testing...&lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>These examples are basic but of the same variety as every other demo i've seen in books and online. The eventSource only seems to be working if I end a client connection or terminate the server but this would be polling instead of SSE and I particularly want to use SSE.</p>\n\n<p>Interestingly, demos, such as thouse from <a href=\"http://www.html5rocks.com/en/tutorials/eventsource/basics/\">html5rock</a> also seem to not quite work as expected when I use them online..</p>\n"},{"tags":["node.js","sctp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13188977,"title":"SCTP on node.js","body":"<p>Is there an implementation of the SCTP (Stream Control Transmission Protocol) , also called the VOIP protocol on Node.js? Any pointers will be helpful.</p>\n"},{"tags":["javascript","node.js","anonymous-function"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13189406,"title":"Returning from anonymous function passed as parameter","body":"<p>Consider the following code:</p>\n\n<pre><code>function dbTask(q) {\n    mysql = new MySQL();\n    mysql.host = sqlHost;\n    mysql.user = sqlUser;\n    mysql.password = sqlPassword;\n    mysql.query(\"USE stock\");\n\n    return mysql.query(q, function(err, results, fields) {\n        if(err) {\n            console.log(\"MySQL Error: \" + err + \", Query: \" + q);\n            return false;\n        } else {\n            return results; //here\n        }\n    });\n};\n\nvar r = dbTask(\"SELECT * FROM user;\");\nconsole.log(r);\n</code></pre>\n\n<p>Whereas, I want the <code>results</code> to be returned from the inner anonymous function when calling <code>dbTask()</code> in the second last line, I am getting different output which seems like some internal construct of the mysql library under use.</p>\n\n<p>How can I get dbTask to return the <code>results</code> when called?</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13188748,"title":"(re)Populating mongodb collection from json - mongoose","body":"<p><code>enter code here</code>Hi is there a way to repopulate a mongo collection from a json array using mongoose?</p>\n\n<p>I have this schema.</p>\n\n<pre><code>var UserNote_Schema = new Schema({\n\nuser_id: {type:ObjectId, ref:require('../User/User_Schema.js')},\n\nnote: {type:String},\n\ncreated: {type:Date},\n\nlast_mod: {type:Date}\n\n});\n</code></pre>\n\n<p>and would like to populate it with this json and have it save to the collection.</p>\n\n<pre><code>   {\"_id\":\"506b8922a6bd97d322000011\",\n\"user_id\":\"504aaeef898f541527000012\",\n\"note\":\"a note\",\"created\":\"2012-03-10T00:38:58.000Z\",\n\"last_mod\":\"2012-03-10T00:38:58.000Z\"}\n</code></pre>\n\n<p>My goal is to reset my database to a certain state after running some tests which add remove and change some of the data within.\nHowever, if there is more convenient way of achieving a database reset from a previous state in mongoose/mongo I'd much appreciate any pointers. Keeping the versioning info would also be nice.</p>\n\n<p>thanks</p>\n"},{"tags":["node.js","httprequest","getaddrinfo"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":5614,"score":5,"question_id":9580226,"title":"nodejs httprequest with data - getting error getaddrinfo ENOENT","body":"<p>Update - Answered by self\ni see one has to make sure that the DNS is resolved properly from the machine, check out this code to make sure that url is reachable nodejs.org/docs/latest/api/dns.html#dns.resolve</p>\n\n<p><strong>Original Question</strong></p>\n\n<p>i am writing a nodes based program,in which the user can ask me to do a httprequest on their behalf {off course they provide me with some data, and method to call with} but every time i do a httprequest it gives me an error </p>\n\n<p>getaddrinfo ENOENT\nthis is how my code looks</p>\n\n<pre><code>   function makehttprequest(deviceid,httpaction,httppath,methods,actiondata,callback)\n{\nconsole.log('we are here with httpaction' + httpaction + ' path ' + httppath + ' method ' + methods + ' action data ' + actiondata);\n //do the http post work, get the data, and call the callback function with return data\n var options = {\n  host: httpaction,\n  port: 80,\n  path: httppath,\n  method: methods};\n\n    try\n    {\n    var req = http.request(options, function(res) {\n      console.log('STATUS: ' + res.statusCode);\n      console.log('HEADERS: ' + JSON.stringify(res.headers));\n      res.setEncoding('utf8');\n      res.on('data', function (chunk) {\n        console.log('BODY: ' + chunk);\n      });\n    });\n    }catch(e)\n    {\n     console.log('error as : ' + e.message);\n    }\n\n\n    req.on('error', function(e) {\n      console.log('problem with request: ' + e.message);\n    });\n\n    // write data to request body\n    console.log('writing data to request ..');\n    req.write(actiondata);\n    console.log('finished writing data to request…');\n    req.end();\n    console.log('request ended…');\n</code></pre>\n\n<p>}</p>\n\n<p>please help</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13185914,"title":"node.js mongo connection spike, write fail, connection pooling","body":"<p>I have a very simple logging application written in node that stores data in mongo.  It runs fine for a while (an hour), and then the amount of connections spike and all my writes fail for a while before the connections go down (presumably they timeout).  I know calling <code>db.close()</code> is important, and the event based, asynchronous aspect of node makes it not trivial on where to make that call.</p>\n\n<p>In my request handler, I have:</p>\n\n<pre><code>//val is an object previously defined\ndatabase.writeRecord(val)\ndatabase.userExists(val['cookie'], function(c){//returns 1 if user exists, 0 if not\n  if(c==0)  \n    database.createNewUserProfile(val['cookie'],'campaign',val, {cid:cid, event:event});\n  else\n    database.attachEventToUserProfile(val['cookie'], 'campaign',val, {cid:cid, event:event});\n});\n</code></pre>\n\n<p>Then, in my database handler, I have the following functions (forgive the length of this copy/paste):</p>\n\n<pre><code>function writeRecord(object_passbyreference){\n    //make a deep copy\n    var value = new Object();\n    for (var attr in object_passbyreference) {\n        value[attr] = object_passbyreference[attr];\n    }\n    if(additionalattributes!=undefined){//is there anything else i want to throw in this record?\n        for (var attr in additionalattributes) \n            value[attr] = additionalattributes[attr];\n    }\n\n\n    dbname='beacon';\n    collectionname='testcollection';\n\n    var db = new Db(dbname, new Server(host, port, {}), {native_parser:false});\n    db.open(function(err, db) {\n        if(db === null)\n            console.log('                                                         db is undefined');\n        else{\n            db.collection(collectionname, function(err, collection) {\n                collection.insert(value, function(err,doc){\n                    if(err) {  \n                        console.log('Insert ERROR!!!!! Is the database running? '+JSON.stringify(err));\n                    }\n                    db.close();\n                }) // collection.insert\n            }); //db.collection\n        }\n    }); // db.open\n}\n\n\n\nfunction userExists(cookieid, callback){\n    var db = new Db('beacon', new Server(host, port, {}), {native_parser:false});\n    db.open(function(err, db) {//opendb++\n        if(db === null)\n            console.log('                                                         db is undefined - profile');\n        else{ \n            db.collection('userprofiles', function(err, collection) {\n                collection.find({cookie:cookieid}).toArray(function(e, results) {\n                    if(e){\n                        console.log ('  ERROR IN saveUserProfileEvent error:'+JSON.stringify(e)+\"    cookie:\"+JSON.stringify({cookie:cookieid}));\n                    }\n                    else{//the query went alright, callback the count ...\n                        callback(results.length)//returns the size of the result set\n                    }\n                    db.close();\n                })\n            })\n        }\n    })\n}\n\nfunction createNewUserProfile(cookieid, eventtype, object_passbyreference, additionalattributes){\n    //make a deep copy, clone it\n    var object = new Object();\n    for (var attr in object_passbyreference) {\n        if(attr!='cookie')\n            object[attr] = object_passbyreference[attr];\n    }\n    if(additionalattributes!=undefined){//is there anything else i want to throw in this record?\n        for (var attr in additionalattributes) \n            object[attr] = additionalattributes[attr];\n    }\n    var recordtosave=new Object();\n    recordtosave['cookie']=cookieid;\n\n    recordtosave['items']=1;//keep this here, maybe just for fun, let's see if we can keep a count of total entries for this given user\n    recordtosave['campaign']=new Array();//new Array();\n    recordtosave['survey']=new Array();\n    recordtosave[eventtype]=[object];\n\n    recordtosave['demographics']=new Object();\n    recordtosave['demographics']['age']=functionobj.getAge();\n    recordtosave['demographics']['gender']=functionobj.getGender();\n    recordtosave['demographics']['income']=functionobj.getIncome();\n\n    var db = new Db('beacon', new Server(host, port, {}), {native_parser:false});\n    db.open(function(err, db) {//opendb++\n        if(db === null)\n            console.log('                                                         db is undefined - profile');\n        else{ \n            db.collection('userprofiles', function(err, collection) {\n                collection.insert(recordtosave, function(err,doc){\n                    if(err){\n                        console.log('        ERROR Adding new user '+cookieid);\n                    }\n                    else{\n                        console.log('Added new user '+cookieid);\n                    }\n                    db.close();\n                })\n            })\n        }\n    })\n}\n\n\nfunction attachEventToUserProfile(cookieid, eventtype, object_passbyreference, additionalattributes){\n    var object = new Object();\n    for (var attr in object_passbyreference) {\n        if(attr!='cookie')\n            object[attr] = object_passbyreference[attr];\n    }\n    if(additionalattributes!=undefined){//is there anything else i want to throw in this record?\n        for (var attr in additionalattributes) \n            object[attr] = additionalattributes[attr];\n    }\n\n\n    var db = new Db('beacon', new Server(host, port, {}), {native_parser:false});\n    db.open(function(err, db) {\n        if(db === null)\n            console.log('                                                         db is undefined - profile');\n        else{ \n            db.collection('userprofiles', function(err, collection) {\n                eventtopush=new Object();\n                eventtopush[eventtype]=object\n                collection.update({cookie: cookieid}, {$inc: { 'items' : 1 }, $push: eventtopush}, function(e,doc){\n                    if(e){\n                        console.log('        ERROR Updating user '+cookieid);\n                    }\n                    else{\n                        console.log('Updated user '+cookieid);\n                    }\n                    db.close();\n                });\n            })\n        }\n    });\n}\n</code></pre>\n\n<p>All my functions are of the form:</p>\n\n<pre><code>function f(param, callback){\n  db=new db;\n  db.open(...\n    db.collection(....\n      db.find/insert(....\n        callback()\n        db.close()\n}\n</code></pre>\n\n<p>Is that correct? I want the db.close at the end of the inner most function call, right? That means it will execute after everything has finished?  Is this the correct method to do a mongo query in node?</p>\n\n<p>Viewing mongostat, I see that my connections are very low and flat, and then, in a while, they spike to ~800 and my writes start failing (note, the time interval on this is 15 seconds):</p>\n\n<pre><code>    72     55     38      0       0     332  1.02g    62m      0    90k   307k    13  RTR   21:01:26 \n    68     52     37      0       0     316  1.03g    62m      0    85k   250k    12  RTR   21:01:41 \n    81     65     50      0       0     368  1.02g    62m      0   101k   280k     5  RTR   21:01:56 \n    70     54     39      0       0     322  1.02g    62m      0    87k   306k     4  RTR   21:02:11 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    73     52     36      0       0     334  1.09g    63m      0    88k   235k    79  RTR   21:02:26 \n    73     55     39      0       0     346  1.15g    64m      0    91k   250k   148  RTR   21:02:41 \n    70     59     42      0       0     328  1.02g    62m      0    90k   269k    26  RTR   21:02:56 \n    73     58     43      0       0     346  1.02g    62m      0    93k   303k     3  RTR   21:03:11 \n    71     55     41      0       0     337  1.02g    62m      0    90k   243k    16  RTR   21:03:26 \n    69     55     40      0       0     329  1.02g    62m      0    88k   322k     8  RTR   21:03:41 \n    70     56     42      0       0     338  1.02g    62m      0    91k   261k     5  RTR   21:03:56 \n    67     52     38      0       0     316  1.02g    62m      0    85k   261k     3  RTR   21:04:11 \n    64     50     36      0       0     306  1.02g    62m      0    82k   243k    25  RTR   21:04:26 \n    61     48     37      0       0     294  1.04g    62m      0    78k   259k    32  RTR   21:04:41 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    68     53     37      0       0     314  1.02g    62m      0    85k   241k     7  RTR   21:04:56 \n    65     53     41      0       0     319  1.02g    62m      0    85k   229k     3  RTR   21:05:11 \n    71     55     40      0       0     337  1.02g    62m      0    91k   274k    14  RTR   21:05:26 \n    63     47     35      0       0     297  1.07g    63m      0    79k   220k    63  RTR   21:05:41 \n    64     52     37      0       0     298  1.02g    62m      0    81k   230k     7  RTR   21:05:56 \n    67     53     39      0       0     322  1.02g    62m      0    87k   230k     4  RTR   21:06:11 \n    68     53     38      0       0     321  1.02g    62m      0    86k   273k     3  RTR   21:06:26 \n    70     56     41      0       0     336  1.02g    62m      0    90k   275k     3  RTR   21:06:41 \n    64     51     38      0       0     310  1.02g    62m      0    82k   220k     4  RTR   21:06:56 \n    66     51     38      0       0     315  1.02g    62m      0    84k   290k    21  RTR   21:07:11 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    62     50     38      0       0     299  1.02g    62m      0    80k   240k     5  RTR   21:07:26 \n    65     49     36      0       0     308  1.02g    62m      0    82k   235k    36  RTR   21:07:41 \n    68     51     36      0       0     298  1.02g    62m      0    81k   255k     6  RTR   21:07:56 \n    69     53     37      0       0     319  1.02g    62m      0    85k   235k     5  RTR   21:08:11 \n    66     52     37      0       0     312  1.02g    62m      0    84k   236k     6  RTR   21:08:26 \n    65     51     36      0       0     305  1.02g    62m      0    82k   214k     5  RTR   21:08:41 \n    68     53     38      0       0     320  1.02g    62m      0    85k   265k     9  RTR   21:08:56 \n    70     53     36      0       0     319  1.02g    62m      0    85k   226k    19  RTR   21:09:11 \n    69     52     37      0       0     312  1.02g    62m      0    84k   270k     4  RTR   21:09:26 \n    67     51     36      0       0     311  1.04g    63m      0    83k   256k    19  RTR   21:09:41 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    70     54     40      0       0     325  1.02g    62m      0    88k   288k     4  RTR   21:09:56 \n    69     52     36      0       0     317  1.03g    62m      0    85k   272k    14  RTR   21:10:11 \n    67     53     39      0       0     321  1.03g    62m      0    86k   253k    13  RTR   21:10:26 \n    70     55     39      0       0     330  1.03g    62m      0    88k   264k    12  RTR   21:10:41 \n    70     54     39      0       0     332  1.03g    63m      0    89k   264k    30  RTR   21:10:56 \n    69     52     36      0       0     319  1.07g    63m      0    85k   288k    73  RTR   21:11:11 \n    61     43     32      0       0     291  1.19g    66m      0    75k   250k   208  RTR   21:11:26 \n    62     42     30      0       0     285  1.32g    68m      0    74k   252k   321  RTR   21:11:41 \n    66     52     38      0       0     315  1.33g    69m      0    84k   274k   341  RTR   21:11:56 \n    68     42     30      0       0     302  1.51g    72m      0    78k   217k   500  RTR   21:12:11 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    53     27     20      0       0     256  1.78g    77m      0    62k   175k   780  RTR   21:12:26 \n    22     19     15      0       0     244  1.77g    78m      0    58k   158k   771  RTR   21:12:41 \n    21     17     11      0       0     245  1.75g    77m      0    59k   139k   755  RTR   21:12:56 \n     7      4      3      0       0     218  1.77g    78m      0    49k   103k   772  RTR   21:13:11 \n     2      1      0      0       0     214  1.77g    77m      0    47k    85k   773  RTR   21:13:26 \n     0      0      0      0       0     208  1.77g    77m      0    45k    79k   773  RTR   21:13:41 \n    61     60     41      0       0     323  1.49g    73m      0    91k   338k   489  RTR   21:13:56 \n    79     73     50      0       0     358  1.16g    65m      0   104k   328k   153  RTR   21:14:11 \n    74     50     32      0       0     315  1.22g    66m      0    84k   241k   220  RTR   21:14:26 \n    72     51     35      0       0     303  1.19g    66m      0    83k   290k   189  RTR   21:14:41 \ninsert  query update delete getmore command  vsize    res faults  netIn netOut  conn repl       time \n    74     52     35      0       0     310  1.19g    66m      0    84k   224k   180  RTR   21:14:56 \n    80     58     39      0       0     337  1.14g    65m      0    92k   344k   127  RTR   21:15:11 \n    81     48     30      0       0     314  1.22g    67m      0    83k   242k   215  RTR   21:15:26 \n    84     58     37      0       0     332  1.15g    65m      0    91k   275k   152  RTR   21:15:41 \n    82     58     39      0       0     328   1.1g    64m      0    90k   331k    83  RTR   21:15:56 \n    78     53     36      0       0     317  1.08g    64m      0    86k   271k    89  RTR   21:16:11 \n    82     47     32      0       0     314  1.19g    66m      0    83k   257k   200  RTR   21:16:26 \n    80     52     37      0       0     318  1.24g    67m      0    85k   304k   234  RTR   21:16:41 \n</code></pre>\n\n<p>Around 21:11:26, the amount of connections rapidly goes up without any significant increase in traffic.  You can see before that there is a long time when the connections are low and steady.</p>\n\n<p>Can somebody point me in the right direction here?  </p>\n\n<h2>Answer Update</h2>\n\n<p>With help below, I was able to get a solution.  Basically, you put you <code>app.listen(port)</code> inside <code>db.open()</code>.  Then, outside of that, still in main.js, you pass a reference to db to your path handlers.  Then pass that all the way through to the actual db call were you get the collection and do your query.  Then don't call <code>db.close()</code> at all.</p>\n\n<p>main.js:</p>\n\n<pre><code>mongodb = require('mongodb');\nvar serverOptions = {\n  'auto_reconnect': true,\n  'poolSize': 50\n};\nvar serv = new mongodb.Server('localhost', 27017, serverOptions);\nvar db = new mongodb.Db('beacon', serv);\n\napp.get('/log', function(req,res){          log.request(req,res, db)            });//writes events\n\ndb.open(function (error, db) {\n      if (!module.parent) {\n        app.listen(8888);\n        console.log(\"Express server listening on port %d\", app.address().port)\n      }\n});\n</code></pre>\n\n<p>log.js:</p>\n\n<pre><code>function request(req,res, db){\n  //build val object\n  database.writeRecord(db, val) \n}\n</code></pre>\n\n<p>database.js:</p>\n\n<pre><code>function writeRecord(db, value){\n    collectionname='testwritespeed';\n    db.collection(collectionname, function(err, collection) {\n        collection.insert(value, function(err,doc){\n            if(err) {  \n                console.log('Insert ERROR!!!!! Is the database running? '+JSON.stringify(err));\n            }\n            console.log(doc)\n            //don't do db.close() !!!!!\n        }) // collection.insert\n    }); //db.collection\n}\n</code></pre>\n"},{"tags":["node.js","resize","crop","graphicsmagick"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12455559,"title":"Node gm - use crop and resize cause error","body":"<p>The following code throw an error.</p>\n\n<blockquote>\n  <p>Error: Command failed: gm convert: geometry does not contain image\n  (unable to crop image).</p>\n</blockquote>\n\n<pre><code>var gm = require('gm');\n\ngm('/origin.jpg')\n.resize(600)\n.write('/beforeCrop', function (err) {\n    // beforeCrop is 600 * 450\n    gm('/beforeCrop')\n    .crop(70, 70, 100, 100)\n    .resize(50, 50)\n    .write('/result', function (err) {\n        if (err) throw err;\n    });\n});\n</code></pre>\n\n<p>Is seem that gm can not resolve the size of <strong>beforeCrop</strong>.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":13187486,"title":"Mongoose nested document update failing?","body":"<p>If I have a nested document, how can I update a field in that nested document in Mongoose?</p>\n\n<p>I carefully researched this problem using everything available I could find, and even changed my test code to match a similar answered question about this here on Stackoverflow, but I am still unable to figure this out.   Here are is my Schema and Models, the code, and the Mongoose debug output.  I am unable to understand what I am doing wrong, here.</p>\n\n<pre><code>var mongoose = require('mongoose')\n  , db = mongoose.createConnection('localhost', 'test')\n  , assert = require(\"node-assert-extras\");\n\nvar Schema = mongoose.Schema;\nvar ObjectId = Schema.ObjectId;\n\ndb.once('open', function () {\n  // yay!\n});\nmongoose.set('debug', true);\n\nvar PDFSchema = new Schema({\n      title     : { type: String, required: true, trim: true }\n})\n\nvar docsSchema = new Schema({\n     PDFs           : [PDFSchema] \n});\n\nvar A = db.model('pdf', PDFSchema);\nvar B = db.model('docs', docsSchema);\n\nfunction reset(cb) {\n  B.find().remove();\n  // create some data with a nested document A\n  var newA = new A( { title : \"my title\" })\n  var newB = new B( { PDFs: newA});\n  newB.save();\n  cb();\n}\n\nfunction test1( ) {\n    reset(function() {\n        B.findOne({}, 'PDFs', function(e,o)\n        {\n            console.log(o);\n            pdf_id = o.PDFs[0]._id;\n            console.log(\"ID \" + pdf_id);\n            B.update(\n                { 'pdfs.pdf_id': pdf_id }, \n                { $set: { \n                    'pdfs.$.title': 'new title'\n                }}, function (err, numAffected) { \n                    if(err) throw err;\n                    assert.equal(numAffected,1);  //KA Boom!\n                }\n            );  \n\n        });\n    });\n}\n\ntest1();\n\n/*\n$ node test2.js\nMongoose: docs.remove({}) {}  \nMongoose: docs.findOne({}) { fields: { PDFs: 1 }, safe: true }  \nMongoose: docs.insert({ __v: 0, PDFs: [ { _id: ObjectId(\"50930e3d0a39ad162b000002\"), title: 'my title' } ], _id: ObjectId(\"50930e3d0a39ad162b000003\") }) { safe: true }  \n{ _id: 50930e3d0a39ad162b000003,\n  PDFs: [ { _id: 50930e3d0a39ad162b000002, title: 'my title' } ] }\nID 50930e3d0a39ad162b000002\n\nassert.js:102\n  throw new assert.AssertionError({\n        ^\nAssertionError: 0 == 1\n\n\n\n*/\n</code></pre>\n"},{"tags":["javascript","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13183719,"title":"how can I modify or replace the directory index page in Express?","body":"<p>In express, I can something like this to have a static server, with directory index pages:</p>\n\n<pre><code>app.configure(function() {\n    app.use('/mystuff', _express.static(__dirname + \"/whatever/stuff\"));\n    app.use('/mystuff', _express.directory(__dirname + \"/whatever/stuff\"));\n});\n</code></pre>\n\n<p>I would like to modify the directory index pages, by giving them different css, adding some javascript, and maybe altering the html.  I prefer use as much of the existing functionality if possible, but if it is easy to just replace the whole directory middleware with my own code, that's an option.  Not sure where to start with this.  Of course, I don't want to actually edit code in the express or connect modules.</p>\n\n<p>BTW, one reason for this is to workaround a bug I mentioned here: <a href=\"http://stackoverflow.com/questions/12808295/how-do-i-set-up-static-serving-in-express-with-an-arbitrary-start-path\">How do I set up static serving in Express with an arbitrary start path?</a></p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13186781,"title":"What is the scope of JS variables in anonymous functions","body":"<p>Why does this code returns $products empty? If I test for $products inside the function it does show data... but once it finishes I can't seem to get the data. </p>\n\n<pre><code>var $products = new Array();\nconnection.query($sql, function(err, rows, fields) {\n    if (err) throw err;\n    for(i=0; i&lt; rows.length; i++)\n    {\n        $products[rows[i].source_identifier] = \"xyz\";\n    }\n\n});\nconnection.end();\n\nconsole.log($products); // Shows empty.\n</code></pre>\n"},{"tags":["javascript","node.js","this"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13186490,"title":"Javascript, nested eventhandler and this","body":"<p>I have this javascript class:</p>\n\n<pre><code>var Server = (function () {\n\nvar spawn = require('child_process').spawn;\n\nfunction Server(serverDefinition) {\n    this.definition = serverDefinition;\n    this.status = false;\n}\n\nServer.prototype.start = function () {\n    this.process = spawn('java', ['-jar', this.definition.jarfile]);\n    this.status = true;\n\n    this.process.on('exit', function(code, signal){\n        this.status = false;\n        console.log('Server stopped: code=' + code + ', signal=' + signal);\n    });\n\n    this.process.stdout.on('data', function(data){ console.log('stdout: ' + data);});\n    this.process.stderr.on('data', function(data){ console.log('stderr: ' + data);});\n};\n\nreturn Server;\n</code></pre>\n\n<p>})();</p>\n\n<p>My problem is that <code>this</code> inside of <code>this.process.on('exit', ... )</code> referes to <code>process</code>, not <code>Server</code> as I would like it to.</p>\n\n<p>What is the best pattern of dealing with this case? A <code>_self = this</code> ? In that case, where should that line be inserted, and should I stop referring to <code>this</code> and only use <code>_self</code> instead? </p>\n"},{"tags":["node.js","redis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13186239,"title":"Redis.io multiple multi() - can they be atomic?","body":"<p>My second multi() call requires results from the first multi().  However I want all commands from both multi() to be executed atomically.  How can I do this?</p>\n\n<p>This is using the node.js client.</p>\n\n<pre><code>db.multi()\n    .incr('next:user:id')\n    .sadd('users:facebookid', facebookId)\n    .exec(function(err, replies)\n    {\n        var newUserId = replies[0];\n        // if something fails in this multi(), then the previous multi() shouldn't be executed either.\n        db.multi()\n        .hmset('user:' + newUserId , 'facebookId', facebookId, 'name', userName)\n        .incr('users:count')\n        .exec()\n\n    });\n</code></pre>\n"},{"tags":["node.js","heroku","express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13186134,"title":"Node.JS, Express and Heroku - how to handle HTTP and HTTPS?","body":"<p>I have an app which is quite normal Express app - simple server logic, views, lots of client-side JS.\nI have to do many AJAX requests. Some of them need to be secured by HTTPS protocol (some needn't).</p>\n\n<p>So, my server should work with both HTTP and HTTPS.\nIt should also work o both the local machine (ran with nodemon normally) and on Heroku.</p>\n\n<p>As far as I understood, Heroku gives you a single port (process.env.PORT) you can listen to, and handles all requests through the proxy (so, you app is listening to this port and not bothering about the proto - right?)</p>\n\n<p>So, am I getting this right - I should have some different code for dev machine and Heroku?</p>\n\n<p>Like</p>\n\n<pre><code>...\napp = express()\n...\n\nif process.env.NODE_ENV == 'production'\n  app.listen(process.env.PORT)\nelse\n  https = require('https')\n  http = require('http')\n  http.createServer(app).listen(5080) # some local port\n  options = {\n    key: fs.readFileSync('key.pem'), \n    cert: fs.readFileSync('cert.pem') # my self-signed files\n  }\n  https.createServer(options, app).listen(5443) # some different local port\n</code></pre>\n\n<p>Is it the proper way to deal with this?</p>\n"},{"tags":["javascript","node.js","express","connect","vhosts"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12327170,"title":"Using connect vhost to serve multiple express.js apps","body":"<p>I want to use connect's vhost functionality to deploy  several express.js apps to my dev vps. Here is my server.js file that is supposed to send requests to the appropriate place:</p>\n\n<pre><code>var express = require('express')\nvar quotes = require('quote-of-the-day/lib/app.js');    \nvar server = express();  \nserver.use(express.vhost('inspiringquoteoftheday.com',quotes));    \nserver.listen(80);\n</code></pre>\n\n<p>Running node server.js throws this error:</p>\n\n<pre><code>Error: Cannot find module 'quote-of-the-day/lib/app.js' \n</code></pre>\n\n<p>Even though I can cd into app.js straight from the directory where server.js is located.</p>\n\n<p>Here is the lib/app.js file in which I export my express app (I think)</p>\n\n<pre><code>// Generated by CoffeeScript 1.3.3\n(function() {\n  var app, express, pub;\n\n  express = require('express');\n\n  module.exports = app = express();\n\n  pub = __dirname + '/public';\n\n  app.use(express[\"static\"](pub));\n\n  app.use(express.errorHandler());\n\n  app.use(app.router);\n\n  app.set('views', __dirname + '/views');\n\n  app.set('view engine', 'jade');\n\n  app.get('/', function(req, res) {\n    return res.render('home');\n  });\n\n}).call(this);\n</code></pre>\n"},{"tags":["node.js","messaging","rabbitmq","amqp","node-amqp"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1397,"score":2,"question_id":10620976,"title":"RabbitMQ / AMQP: single queue, multiple consumers for same message?","body":"<p>I am just starting to use RabbitMQ and AMQP in general.</p>\n\n<ul>\n<li>I have a queue of messages</li>\n<li>I have multiple consumers, which I would like to do different things with the <strong>same message</strong>. </li>\n</ul>\n\n<p>Most of the RabbitMQ documentation seems to be focused on round-robin, ie where a single message is consumed by a single consumer, with the load being spread between each consumer. This is indeed the behavior I witness. </p>\n\n<p>An example: the producer has a single queue, and send messages every 2 sec:</p>\n\n<pre><code>var amqp = require('amqp');\nvar connection = amqp.createConnection({ host: \"localhost\", port: 5672 });\nvar count = 1;\n\nconnection.on('ready', function () {\n  var sendMessage = function(connection, queue_name, payload) {\n    var encoded_payload = JSON.stringify(payload);  \n    connection.publish(queue_name, encoded_payload);\n  }\n\n  setInterval( function() {    \n    var test_message = 'TEST '+count\n    sendMessage(connection, \"my_queue_name\", test_message)  \n    count += 1;\n  }, 2000) \n\n\n})\n</code></pre>\n\n<p>And here's a consumer:</p>\n\n<pre><code>var amqp = require('amqp');\nvar connection = amqp.createConnection({ host: \"localhost\", port: 5672 });\nconnection.on('ready', function () {\n  connection.queue(\"my_queue_name\", function(queue){\n    queue.bind('#'); \n    queue.subscribe(function (message) {\n      var encoded_payload = unescape(message.data)\n      var payload = JSON.parse(encoded_payload)\n      console.log('Recieved a message:')\n      console.log(payload)\n    })\n  })\n})\n</code></pre>\n\n<p>If I start the consumer twice, <strong>I can see that each consumer is consuming alternate messages in round-robin behavior. Eg, I'll see messages 1, 3, 5 in one terminal, 2, 4, 6 in the other</strong>.</p>\n\n<p>My question is: </p>\n\n<ul>\n<li><p>Can I have each consumer receive the same messages? Ie, both consumers get message 1, 2, 3, 4, 5, 6? What is this called in AMQP/RabbitMQ speak? How is it normally configured?</p></li>\n<li><p>Is this commonly done? Should I just have the exchange route the message into two separate queues, with a single consumer, instead? </p></li>\n</ul>\n"},{"tags":["javascript","node.js","http","get"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13183448,"title":"node.js how to respond .js files with parameters","body":"<p>I have a node.js http application and i'm servicing GET requests ok. I can't however respond properly with requests for say foo.js?_param=1234. How do i deal correctly with files of this type where parameters are being passed?</p>\n\n<p>EDIT:</p>\n\n<p>I'm using express to service files as follows:</p>\n\n<pre><code>app.get('/*', function(req, res) {\n\n  res.sendfile(__application+req.url, {root: __root});\n\n});\n</code></pre>\n\n<p>__root is the root path of the application.</p>\n"},{"tags":["php","node.js","webserver","web-scraping","phantomjs"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13184161,"title":"How do I create a server that will pass phantomjs GET arguments, and output the result","body":"<p>This seemed like a simple task, set up a server that would receive some arguments and execute a phantomjs process from them.</p>\n\n<p>For example, I could manually visit, or curl something like,</p>\n\n<pre><code>http://localhost:8080/?foo=arg1&amp;bar=arg2\n</code></pre>\n\n<p>and the server  the server would run:</p>\n\n<pre><code>phantomjs myscript.js arg1 arg2\n</code></pre>\n\n<p>and write to the page what was returned to the console.</p>\n\n<p>I'm looking for speed, and thinking this would be simple to set up in node.js tried phantom-node and phantom-proxy but have gotten stuck with compatibility issues.</p>\n\n<p>I've tried spawning child processes in node.js based on <a href=\"http://stackoverflow.com/questions/9781214/node-js-parse-child-process-output-line-by-line-spawn\">this code</a> but I can't get my code to actually spawn the process and return a result, the page doesn't wait for the process to run.</p>\n\n<p>I've also looked at phantomjs's <a href=\"https://code.google.com/p/phantomjs/source/browse/examples/server.js\" rel=\"nofollow\">built in server</a>, but couldn't get it to work the way I wanted to either. - It also includes all sorts of warning about using it in production.</p>\n\n<p>I don't think this would such a difficult problem, and I've spent far too long scouring the internet and banging my head against the desk trying to make different solutions work, at this point I'm looking for any working code in node or otherwise that will run my script.</p>\n"},{"tags":["javascript","node.js","png"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":104,"score":4,"question_id":12261050,"title":"Node.js library for generating indexed PNGs?","body":"<p><strong>Does anyone know of a node.js module for creating <em>indexed</em> PNGs?</strong></p>\n\n<p>I've looked through <a href=\"https://github.com/joyent/node/wiki/modules#wiki-graphics\" rel=\"nofollow\">this list</a> of node graphics modules, and some of them allow png creation, but none seem to allow you to specify an index/pallete scheme.</p>\n\n<p>Just some extra info:  I have a 2d Array representing pixels, each referring to an index of a 1d palette array.  From this I would like to generate a valid indexed png file (1 channel, with 4 bits per channel).</p>\n"},{"tags":["node.js","upload","amazon-s3","express"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1583,"score":4,"question_id":6774201,"title":"How to upload a file from the browser to Amazon S3 with node.js, Express, and knox?","body":"<p>I'm trying to find some example code that utilizes node.js, Express, and knox.</p>\n\n<p>The docs for Knox only give clear examples of how to upload a file already stored in the file system. <a href=\"https://github.com/learnboost/knox#readme\" rel=\"nofollow\">https://github.com/learnboost/knox#readme</a></p>\n\n<p>Additionally, there a number of simple tutorials (even in Express itself) on how to upload files directly to express and save to the file system.</p>\n\n<p>What I'm having trouble finding is an example that lets you upload a client upload to a node server and have the data streamed directly to S3 rather than storing in the local file system first.</p>\n\n<p>Can someone point me to a gist or other example that contains this kind of information?</p>\n"},{"tags":["node.js","design-patterns","singleton"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13179109,"title":"Singleton pattern in nodejs - is it needed?","body":"<p>I recently came across this article on how to write a singleton in nodejs</p>\n\n<p><a href=\"http://simplapi.wordpress.com/2012/05/14/node-js-singleton-structure/\" rel=\"nofollow\">http://simplapi.wordpress.com/2012/05/14/node-js-singleton-structure/</a></p>\n\n<p>I know that the documentation of <code>require</code> <a href=\"http://nodejs.org/api/modules.html#modules_loading_from_node_modules_folders\" rel=\"nofollow\">states</a> that:</p>\n\n<pre><code>Modules are cached after the first time they are loaded. \nMultiple calls to require('foo') may not cause the module code to be executed multiple times.\n</code></pre>\n\n<p>So it seems that every required module can be easily used a singleton without the singleton boilerplate code.</p>\n\n<p><strong>Question:</strong></p>\n\n<p>Does the above article provide a round about solution to creating a singleton?</p>\n"},{"tags":["node.js","stream","amazon-s3","knox","formidable"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12526673,"title":"node application stream file upload directly to amazon s3","body":"<p>Hello :) I'm looking at the feasibility of having my node application stream HTTP POST file uploads directly through to an Amazon S3 Bucket.</p>\n\n<p>I'm looking at using Formidable and Knox for this.</p>\n\n<p>The part I'm unsure about is that S3 requires that you know the total number of bytes in the file before transmission.</p>\n\n<p>Would I be right in thinking that the only way to accomplish this then would be to use the HTML5 File API (And possibly an ActiveX control on Internet Explorer) to check the file size on the client and send this as part of the HTTP POST request ?</p>\n"},{"tags":["asp.net","node.js","umbraco","iisnode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13165404,"title":"Intercept requests for iisnode with HttpModule","body":"<p>I have a nodejs app running using iisnode in a sub directory for a .net application (umbraco actually).</p>\n\n<p>The .net application is using forms authentication and I want to secure the iisnode application using the same mechanism as the .net application.</p>\n\n<p>I've tried registering modules with the iisnode app but it doesn't even seem to fire the event handlers. Is it possible to do this?</p>\n"},{"tags":["query","post","node.js"],"answer_count":5,"favorite_count":12,"up_vote_count":18,"down_vote_count":0,"view_count":16441,"score":18,"question_id":5710358,"title":"how to get POST query in express node.js?","body":"<p>Here is my simple form:</p>\n\n<pre><code>&lt;form id=\"loginformA\" action=\"userlogin\" method=\"post\"&gt;\n        &lt;div&gt;\n            &lt;label for=\"email\"&gt;Email: &lt;/label&gt;\n            &lt;input type=\"text\" id=\"email\" name=\"email\"&gt;&lt;/input&gt;\n        &lt;/div&gt;\n&lt;input type=\"submit\" value=\"Submit\"&gt;&lt;/input&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Here is my express node.js code:</p>\n\n<pre><code>app.post('/userlogin', function(sReq, sRes){\n\n    var email = sReq.query.email.;\n\n}\n</code></pre>\n\n<p>I tried <code>sReq.query.email</code> or <code>sReq.query['email']</code> or <code>sReq.params['email']</code> etc. None of them work.  They all return <code>undefined</code>. </p>\n\n<p>When I change to a Get call, it works, so .. any idea?</p>\n"},{"tags":["javascript","node.js","npm","mustache","mustache.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13182068,"title":"Node mustache rendering server side","body":"<p>I'm trying to create a simple application to compile mustache templates into static pages server side, here's what I've got so far:</p>\n\n<pre><code>var view = {\n\n    title: \"Joe\",\n    calc: function () {\n\n        return 2+4;\n    }\n\n};\n\nvar mustache = require(\"mustache\");\nvar template = require(\"./home.template\");\n\nvar output = mustache.to_html(template, view);\n\nconsole.log(output);\n</code></pre>\n\n<p>And my template looks like:</p>\n\n<pre><code>{{title}} spend {{calc}}\n</code></pre>\n\n<p>Any suggestions as to what is causing this to fail?</p>\n\n<p>Here is the complete error message:</p>\n\n<pre><code>home.template:1\n} spend {{calc}}\n        ^\n\nmodule.js:437\n  var compiledWrapper = runInThisContext(wrapper, filename, true);\n                        ^\nSyntaxError: Unexpected token {\n    at Module._compile (module.js:437:25)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (/Users/MorehouseJ09/Documents/production_development/mustache/current/compiler.js:12:16)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n</code></pre>\n\n<p>Any help would be great!</p>\n"},{"tags":["jquery","html5","node.js","limejs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13182331,"title":"Using libraries with LimeJS HTML5","body":"<p>I was wondering if I could use any libraries I want like  Node.JS, JQuery with LimeJS ? it is possible ?</p>\n"},{"tags":["javascript",".net","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":13182400,"title":"What are the benefits of node.js over .NET?","body":"<p>I've never used node.js but have heard that it's good for use on the server where you're mostly IO-bound but that it's not as useful for stuff that's CPU-bound.</p>\n\n<p>I'd like to muck around with node.js at some point.  Should I find it useful for what we do, I asked at work if we could use it on our production servers.</p>\n\n<p>When I asked, I mentioned that more and more of our stuff just delegates out to other services and hence we are IO-bound which is the apparent sweet-spot of node.js.</p>\n\n<p>I got some replies:</p>\n\n<ul>\n<li>one about getting the same results using async callback patterns in C#/Java/C++</li>\n<li>one about node.js being new(ish) and shiny(ish), which it is (for me anyway, but that's an aside (honest!))</li>\n<li>one about being able to access native IO completion ports from .NET if we really wanted to</li>\n<li>one saying that the single threadedness of node.js only makes the code easier to reason about and doesn't really affect the bottleneck aspect</li>\n</ul>\n\n<p>To me, these are all valid comments.  But like most things, you can achieve the same results in more than one technology.  So as to not make this question subjective (<em>Is node.js any good?</em>), I've rephrased the comments I've received as questions that [mostly] could be answered objectively:</p>\n\n<ol>\n<li>I can use async callback patterns in C#/Java/C++, so why is node.js any better?</li>\n<li>Is node.js really just new(ish) and shiny(ish)?  There must be more to it than that based upon it's uptake.  I know this is subjective, but have you got any examples of where it make a big difference?</li>\n<li>I can already have seemingly parallel processing using native IO completion ports from .NET.  So why is it any easier/better in node.js?</li>\n<li>The single threadedness of node.js only makes the code easier to reason about (I personally think the usefulness of this alone is <strong>massive</strong>), and doesn't really affect the bottleneck aspect.  Does the use of IOCP really make such a difference?</li>\n</ol>\n"},{"tags":["javascript","node.js","dropbox-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13182204,"title":"How upload a file to Dropbox with dropbox.js?","body":"<p>I'm having problems to upload a file (image) to Dropbox from <strong>Node.js</strong> using the official dropbox.js.\nI want to upload a picture that I have in another server. For example with the dropbpox icon (www.dropbox.com/static/images/new_logo.png).</p>\n\n<pre><code>client.writeFile(file, 'www.dropbox.com/static/images/new_logo.png', function(error, stat) {\n if (error) {\n  return es.send(error.status);  // Something went wrong.\n }\n\n res.send(\"File saved as revision \" + stat.revisionTag);\n});\n</code></pre>\n\n<p>I know that this only creates a text file with the url, but how I can upload the picture to Dropbox?\nI also try to download the file using http.get and then upload this to dropbox but  it doesn't work.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13179700,"title":"Jade: dynamic image url","body":"<p>I'm trying to set an image url in jade...</p>\n\n<p>I have this: img(src = 'http://192.168.1.8:8081')</p>\n\n<p>I need to change 192.168.1.8 automatically with the server address...</p>\n\n<p>For example if I connect to my server from office, my url should become img(src = 'http://myPUBLICserveraddress:8081')</p>\n\n<p>How can I do this?</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","mongodb","express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13181193,"title":"Calling functions outside paths","body":"<p>In mongojs, when you do: </p>\n\n<pre><code>var birds = db.birds.find(searchTerm, callback);\n</code></pre>\n\n<p>...how do you pass arguments to the callback? I've tried bind, as in:</p>\n\n<pre><code>birds = db.birds.find(searchTerm, app.get('getBirds').bind(res));\n</code></pre>\n\n<p>...but to no avail. Just fyi I'm trying to pass the response object of the GET route so that the callback can render using res.send(results). </p>\n\n<p>The other option is to set app.set('res': res); and call app.get('res') from the callback - I'm not sure this is a good idea. It works, but it doesn't obey the events loop model too well - I think the request back to the app may be costly? Any help would be gratefully accepted. :)</p>\n"},{"tags":["node.js","tdd","express","jasmine","jasmine-node"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13176245,"title":"Automate Jasmine-Node and express.js","body":"<p>I created a simple Webapp using <a href=\"http://expressjs.com\" rel=\"nofollow\">express.js</a> and want to test it with <a href=\"https://github.com/mhevery/jasmine-node\" rel=\"nofollow\">jasmine-node</a>. Works fine so far but my problem is that I have to start the server manually every time before I can run my tests.</p>\n\n<p>Could you help me on how to write a spec-helper that runs the server (with another port then my development one) just for the tests and then kills it afterwards?</p>\n\n<p>Thanks, udo</p>\n"},{"tags":["node.js","heroku"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13181459,"title":"Node App crashes on Heroku with emailjs","body":"<p>I have integrated \"<strong>emailjs</strong>\" in my NodeApp and it works fine <strong>locally</strong>.</p>\n\n<p>When I push my NodeApp to Heroku I get this error and I can't seem to find the mistake. \nHope someone can help</p>\n\n<p>This is the error:</p>\n\n<pre><code>2012-11-01T15:24:28+00:00 app[web.1]:           ^\n2012-11-01T15:24:28+00:00 app[web.1]: Error: Cannot find module 'bufferjs/concat'\n2012-11-01T15:24:28+00:00 app[web.1]:     at Function._resolveFilename (module.js:337:11)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Object..js (module.js:464:10)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Module.load (module.js:353:31)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Function._load (module.js:311:12)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Module.require (module.js:359:17)\n2012-11-01T15:24:28+00:00 app[web.1]: \n2012-11-01T15:24:28+00:00 app[web.1]:     at Function._load (module.js:279:25)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Module.require (module.js:359:17)\n2012-11-01T15:24:28+00:00 app[web.1]:     at require (module.js:375:17)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Object.&lt;anonymous&gt; (/app/node_modules/emailjs/smtp/message.js:17:4)\n2012-11-01T15:24:28+00:00 app[web.1]:     at Module._compile (module.js:446:26)\n2012-11-01T15:24:30+00:00 heroku[web.1]: Process exited with status 1\n2012-11-01T15:24:30+00:00 heroku[web.1]: State changed from starting to crashed\n2012-11-01T15:24:31+00:00 heroku[router]: Error H10 (App crashed) -&gt; GET jeppestrom.dk/ dyno= queue= wait= service= status=503 bytes=\n2012-11-01T15:24:31+00:00 heroku[nginx]: 90.185.25.178 - - [01/Nov/2012:15:24:31 +0000] \"GET / HTTP/1.1\" 503 601 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4\" jeppestrom.dk\n2012-11-01T15:24:32+00:00 heroku[router]: Error H10 (App crashed) -&gt; GET jeppestrom.dk/favicon.ico dyno= queue= wait= service= status=503 bytes=\n2012-11-01T15:24:32+00:00 heroku[nginx]: 90.185.25.178 - - [01/Nov/2012:15:24:32 +0000] \"GET /favicon.ico HTTP/1.1\" 503 601 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4\" jeppestrom.dk\n2012-11-01T15:24:24+00:00 heroku[web.1]: State changed from crashed to down\n\nMy package.json:\n\n{\n\"name\":\"app.js\",\n\"version\":\"0.1.0\",\n\"engines\": {\n    \"node\": \"0.6.x\",\n    \"npm\":  \"1.0.x\"\n},\n\"dependencies\": {\n    \"express\":\"2.5.9\",\n    \"jade\":\"0.26.1\",\n    \"emailjs\":\"*\"\n}\n}\n</code></pre>\n\n<p>Thank you very much.</p>\n"},{"tags":["javascript","node.js","browser"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":81,"score":3,"question_id":13180195,"title":"assigment in javascript and the var keyword","body":"<p>I was reading the 'learning Node' book and I was stuck in a very simple issue, one that I haven't given too much thought about: assignment in javascript.</p>\n\n<p>The author states that we should realize that by using the Node's REPL, the following would return undefined:</p>\n\n<pre><code>var a = 2\n(undefined)\n</code></pre>\n\n<p>while the code below will return '2' in the REPL:</p>\n\n<pre><code>a = 2\n2\n</code></pre>\n\n<p>why is that? the code right above is not an attribution? how come? If the var 'a' hasn't existed until that point in the code, how come it is not and attribuition?</p>\n"},{"tags":["javascript","node.js","expressjs","nowjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13180886,"title":"Should I use express-expose or nowjs?","body":"<p>I need to share variables content between server and client side. For example, the result of a query on my database (a list of record). </p>\n\n<p>I don't know if I should use express-expose and store the result before rendering the page, or nowJS and invoke the query from the client side ?</p>\n\n<p>Thanks for your help !</p>\n"},{"tags":["javascript","c","node.js","parsing","compiler"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":13171616,"title":"C parser in Javascript","body":"<p>I'd like to parse C header files in Javascript. Is there any such library available? Otherwise, any tips to help me get started?</p>\n\n<p><strong>Update:</strong> My ultimate goal is to automatically build interfaces for <a href=\"https://github.com/rbranson/node-ffi\" rel=\"nofollow\">node-ffi</a>. The parser doesn't necessarily have to be in Javascript as long as it can spit out a format understandable by Javascript. If it's very hard to develop by myself, I'll probably have to go with an off the shelf solution...?</p>\n"},{"tags":["javascript","node.js","coffeescript"],"answer_count":2,"favorite_count":5,"up_vote_count":28,"down_vote_count":0,"view_count":6032,"score":28,"question_id":4768748,"title":"require()'ing a CoffeeScript file from a JavaScript file or REPL","body":"<p>I'm using Node.js and wanting to incorporate CoffeeScript into my workflow. I have two use-cases:</p>\n\n<ol>\n<li>I want to be able to write JavaScript files which require() CoffeeScript modules</li>\n<li>I want to be able to load CoffeeScript modules from within the node REPL</li>\n</ol>\n\n<p>For case #1 I can just compile from .coffee to .js and require() the .js module, as a workaround. For case #2 right now I'm eval()'ing the output of coffee-script.compile().</p>\n\n<p>Is there a better, more unified way to do this?</p>\n"},{"tags":["node.js","amazon-s3","knox"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":307,"score":-1,"question_id":9545669,"title":"statusCode 403 using knox in node.js","body":"<p>I am using knox from windows and my url was creating problem. I was getting 403. I found that an issue exist on knox running from windows OS. So included the workaround in client.js as mentioned in <code>https://github.com/LearnBoost/knox/issues/56</code></p>\n\n<p>Added a generous bucket policy also for my bucket cbc, but still I was getting 403 statusCode. I am suspecting the PATH below is still incorrect, even though the url looks fine now.\nI banged my head for a long time, but could not do much. What could be the problem ?</p>\n\n<pre><code>        method: 'PUT',\n        path: '//thumbnail/AUSTRALIA.jpg/',\n        _headers: [Object],\n        _headerNames: [Object],\n        _header: 'PUT //thumbnail/AUSTRALIA.jpg/ HTTP/1.1\\r\\nExpect: 100-continu\ne\\r\\nx-amz-acl: public-read\\r\\nContent-Type: image/jpeg\\r\\nContent-Length: 3354\\\nr\\nDate: Sat, 03 Mar 2012 10:51:03 GMT\\r\\nHost: cbc.s3.amazonaws.com\\r\\nA\nuthorization: AWS XXXXXXXXXXXXXXXXXXX:p+VNij8+LxdfoAK8o5l4tlrM/i4=\\r\\nConnectio\nn: keep-alive\\r\\n\\r\\n',\n        _headerSent: true,\n        _events: [Object],\n        url: 'http://cbc.s3.amazonaws.com/thumbnail/AUSTRALIA.jpg',\n</code></pre>\n"},{"tags":["node.js","twitter","twitter-api","twitter-oauth"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12921371,"title":"Posting images to twitter in Node.js using Oauth","body":"<p>I'm trying to post images to Twitter using the Oauth module. Here is what I have:</p>\n\n<p>It throws a 403 error, I know im doing something wrong with how I add the media to the post but Im just not sure where to go from here.</p>\n\n<pre><code>var https = require('https');\nvar OAuth= require('oauth').OAuth;\nvar keys = require('./twitterkeys');\nvar twitterer = new OAuth(\n           \"https://api.twitter.com/oauth/request_token\",\n           \"https://api.twitter.com/oauth/access_token\",\n           keys.consumerKey,\n           keys.consumerSecret,\n           \"1.0\",\n           null,\n           \"HMAC-SHA1\"\n          );\n\n\nvar params = {\n    status : \"Tiger!\",\n    media : [(\"data:\" + mimeType + \";base64,\") + fs.readFileSync(path,'base64')]\n};\n\n//function(url, oauth_token, oauth_token_secret, post_body, post_content_type, callback)\ntwitterer.post(\"https://upload.twitter.com/1/statuses/update_with_media.json\",\n           keys.token, keys.secret, params, \"multipart/form-data\",\n           function (error, data, response2) {\n           if(error){\n               console.log('Error: Something is wrong.\\n'+JSON.stringify(error)+'\\n');\n\n           }else{\n               console.log('Twitter status updated.\\n');\n               console.log(response2+'\\n');\n           }\n           });\n</code></pre>\n\n<p>Here is what I belive im supose to be doing but I don't know how to do that in the Node.js Oauth module.\n<a href=\"http://stackoverflow.com/questions/9616102/posting-image-to-twitter-using-twitteroauth\">Posting image to twitter using Twitter+OAuth</a></p>\n"},{"tags":["javascript","node.js","typescript"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":642,"score":6,"question_id":12717309,"title":"Does TypeScript provide an explicit Public API for NodeJS Module Access?","body":"<p>From within a node app I would like to do:</p>\n\n<pre><code>var typeScript = require('typescript'); \n\ntypeScript.compile('...')\n</code></pre>\n\n<p>I'm looking to implement the compiler into a build system but without access to a public API (typescript.compile, etc) this is impossible.  </p>\n\n<p>Here's a more complete example of what I would like to do, though the below is for LiveScript, not TypeScript, utilitized in a plugin written for the Brunch.io build-system:</p>\n\n<pre><code>LiveScript = require 'LiveScript'\nsysPath = require 'path'\n\nmodule.exports = class LiveScriptCompiler\n  brunchPlugin: yes\n  type: 'javascript'\n  extension: 'ls'\n\n  constructor: (@config) -&gt;\n    null\n\n  compile: (data, path, callback) -&gt;\n    try\n      result = LiveScript.compile data, bare: yes\n    catch err\n      error = err\n    finally\n      callback error, result\n\n  include: [\n    (sysPath.join __dirname, '..', 'vendor', 'prelude-browser-0.6.0.js')\n  ]\n</code></pre>\n\n<p>Curious if anyone found a work-around?</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":399,"score":1,"question_id":7809397,"title":"how to require from URL in Node.js","body":"<p>Is there a standard way to require a Node module located at some URL (not on the local filesystem)?</p>\n\n<p>Something like:</p>\n\n<pre><code>require('http://example.com/nodejsmodules/myModule.js');\n</code></pre>\n\n<p>Currently, I am simply fetching the file into a temporary file, and requiring that. </p>\n"},{"tags":["node.js","typescript"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":484,"score":3,"question_id":12729779,"title":"Use TypeScript compiler from node","body":"<p>It's pretty easy to do this with coffee-script.</p>\n\n<pre><code>var coffee = require('coffee-script');\ncoffee.compile(\"a = 1\");\n//=&gt; '(function() {\\n  var a;\\n\\n  a = 1;\\n\\n}).call(this);\\n'\n</code></pre>\n\n<p>Is there a way to do this with typescript?</p>\n\n<p><strong>Edit:</strong> also <a href=\"http://typescript.codeplex.com/discussions/398049\" rel=\"nofollow\">posted on codeplex</a></p>\n"},{"tags":["node.js","node-inspector"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":13,"score":2,"question_id":13179157,"title":"How to search files in node-inspector","body":"<p>I'm using node-inspector on Ubuntu for the first time, trying to debug an Express application.</p>\n\n<p>When I run the program and open <code>http://0.0.0.0:8080/debug?port=5858</code> in Chromium or Google Chrome, it seems to work, and all the scripts are loaded in the \"Scripts\" tab. </p>\n\n<p>But there are hundreds of files and there seems to be missing an option to:</p>\n\n<ul>\n<li>Collapse the Scripts Tree to see the directories only </li>\n<li>Or search files in the tree.</li>\n</ul>\n\n<p>Is there an option for this anywhere, or an alternative? </p>\n"},{"tags":["git","node.js","npm","githooks"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":13059991,"title":"update package.json version automatically","body":"<p>Before I do a small release and tag it, I'd like to update the package.json to reflect the new version of the program.</p>\n\n<p>Is there a way to edit the file <code>package.json</code> automatically?</p>\n\n<p>Would using a <code>git pre-release hook</code> help?</p>\n"},{"tags":["node.js","express","sequelize.js"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":158,"score":0,"question_id":12487416,"title":"How to organize a node app that uses sequelize?","body":"<p>I am looking for an example nodejs app that uses the sequelize ORM.</p>\n\n<p>My main concern is that it seems next to impossible to define your models in separate js files if those models have complex relationships to one another because of require() dependency loops. Maybe people define all their models in one file that is very very long?</p>\n\n<p>I am mainly interested in how the models are defined and use through out the app. I would like to have some validation that what i am doing on my own is the \"good\" way to do things.</p>\n"},{"tags":["web-services","apache","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":13169880,"title":"callback mechanism of Nodejs","body":"<p>Nodejs is said to use only one process to handle requests and then those function using I/O will do asynchronously, which will improve the efficiency of web server.  However, those process to handle I/O doesn't count? Compared with traditional web server, like Apache, which use multithread to handle requests where every request in one thread, Is the cost(request + I/O) reduced?</p>\n"},{"tags":["android","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13170654,"title":"NodeJS + Android SSL Authentication","body":"<p>I have no idea how to debug this, been at this for a while now, any pointers would be appreciated.</p>\n\n<p>I am trying out ssl/tls authentication between an Android app and a Nodejs server. I am running into this error message when I run the android app:</p>\n\n<pre><code>10-31 23:33:58.260: D/ExampleActivity(26199): Response code: 401\n10-31 23:34:05.901: W/DefaultRequestDirector(26199): Authentication error: Unable to respond to any of these challenges: {}\n</code></pre>\n\n<p><strong>Note</strong> that I have commented out the client authentication parts, and just trying to get basic SSL authentication working. Even that gives me the same warning/error.</p>\n\n<h2>NodeJs - Server.js</h2>\n\n<pre><code>var https = require('https'),\n    fs = require('fs');\n\nvar options = {\n    key: fs.readFileSync('certs/server_key.pem'),\n    cert: fs.readFileSync('certs/server.pem'),\n   // ca: [fs.readFileSync('certs/client.pem')],\n    passphrase: '33333',\n   // requestCert: true,\n   // rejectUnauthorized: false\n};\n\nhttps.createServer(options, function (req, res) {\n    if (req.client.authorized) {\n        res.writeHead(200, {\"Content-Type\": \"application/json\"});\n        res.end('{\"status\":\"approved\"}');\n    } else {\n        res.writeHead(401, {\"Content-Type\": \"application/json\"});\n        res.end('{\"status\":\"denied\"}');\n    }\n}).listen(8000);\n</code></pre>\n\n<h2>Android</h2>\n\n<pre><code>public class SecureHttpClient extends DefaultHttpClient {\n    private String ks = \"11111\";\n    private String ts = \"22222\";\n    private Context context;\n\n    public SecureHttpClient(final Context context) {\n        super();\n        this.context = context;\n    }\n\n    @Override\n    protected ClientConnectionManager createClientConnectionManager() {\n        SchemeRegistry registry = new SchemeRegistry();\n        SSLSocketFactory factory = newSslSocketFactory();\n        factory.setHostnameVerifier((X509HostnameVerifier) SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);\n\n        registry.register(new Scheme(\"https\", factory, 443));\n        HttpParams httpParams = new BasicHttpParams();\n        return new SingleClientConnManager(httpParams, registry);\n    }\n\n    private SSLSocketFactory newSslSocketFactory() {\n        try {\n            KeyStore keyStore = KeyStore.getInstance(\"BKS\");\n            KeyStore trustStore = KeyStore.getInstance(\"BKS\");\n            InputStream inKey= context.getResources().openRawResource(R.raw.client);\n            InputStream inTrust = context.getResources().openRawResource(R.raw.clienttruststore);\n            try {\n                keyStore.load(inKey, ks.toCharArray());\n                trustStore.load(inTrust, ts.toCharArray());\n            } finally {\n                inKey.close();\n                inTrust.close();\n            }\n            return new SSLSocketFactory(trustStore);\n        } catch (Exception e) {\n            throw new AssertionError(e);\n        }\n    }\n}\n</code></pre>\n\n<p>// MainActivity</p>\n\n<pre><code>public class MainActivity extends Activity {\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        setStrictMode();\n\n        final HttpClient client = new SecureHttpClient(this);\n\n        // Provide ip or address to where your test server is runnning\n        final HttpGet request = new HttpGet(\"https://192.168.0.105:8000/\");\n\n        HttpResponse response = null;\n        try {\n            response = client.execute(request);\n        } catch (ClientProtocolException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        } catch (IOException e) {\n            // TODO Auto-generated catch block\n            e.printStackTrace();\n        }\n\n        Log.d(\"ExampleActivity\", \"Response code: \" + response.getStatusLine().getStatusCode());\n    }\n\n    @TargetApi(9) \n    private void setStrictMode() {\n        StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build();\n\n        StrictMode.setThreadPolicy(policy); \n    }\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.activity_main, menu);\n        return true;\n    }\n}\n</code></pre>\n"},{"tags":["javascript","node.js","uglifyjs"],"answer_count":4,"favorite_count":6,"up_vote_count":5,"down_vote_count":0,"view_count":1407,"score":5,"question_id":5346672,"title":"Uglify directory","body":"<p>Rather than adding code and files to the uglify script individually, is there any way to tell uglify to grab an entire dir, and output into 1 script.js file?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13162979,"title":"Confusion between mongoose.connection() and mongoose.createConnection()","body":"<p>I've been studying mongoose for three days and I'm a bit confused about the use of these two methods (i know that \"mongoose.connection()\" will be deprecated in the future...)</p>\n\n<p>The problem is: when I'm trying to convert (from \"mongoose.connection()\" to \"mongoose.createConnection()\") the action.js file of this example <a href=\"https://gist.github.com/2785463\" rel=\"nofollow\">https://gist.github.com/2785463</a> it seems to not work for me...</p>\n\n<p>there's my code...</p>\n\n<pre><code>var mongoose = require('mongoose'),\ndb = mongoose.createConnection('localhost', 'test');\n\ndb.on('error', function () {\n  console.log('Error! Database connection failed.');\n});\n\ndb.once('open', function (argument) {\n  console.log('Database connection established!');\n\n  mongoose.connection.db.collectionNames(function (error, names) {\n    if (error) {\n      console.log('Error: '+ error);\n    } else {\n      console.log(names);\n    };\n  });\n});\n</code></pre>\n\n<p>and there's my terminal output (typing \"node test.js\" on my ubuntu terminal..)</p>\n\n<pre><code>Database connection established!\n\n/home/_user_/Scrivania/node_modules/mongoose/node_modules/mongodb/lib/mongodb/connection/server.js:437\n    throw err;\n          ^\nTypeError: Cannot call method 'collectionNames' of undefined\n  at NativeConnection.&lt;anonymous&gt; (/home/_user_/Scrivania/test2.js:11:25)\n  at NativeConnection.g (events.js:192:14)\n  at NativeConnection.EventEmitter.emit (events.js:93:17)\n  at open (/home/_user_/Scrivania/node_modules/mongoose/lib/connection.js:408:10)\n  at NativeConnection.Connection.onOpen (/home/_user_/Scrivania/node_modules/mongoose/lib/connection.js:415:5)\n  at Connection._open (/home/_user_/Scrivania/node_modules/mongoose/lib/connection.js:386:10)\n  at NativeConnection.doOpen (/home/_user_/Scrivania/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:47:5)\n  at Db.open (/home/_user_/Scrivania/node_modules/mongoose/node_modules/mongodb/lib/mongodb/db.js:287:14)\n  at Server.connect.connectCallback (/home/_user_/Scrivania/node_modules/mongoose/node_modules/mongodb/lib/mongodb/connection/server.js:235:7)\n  at g (events.js:192:14)\n</code></pre>\n"},{"tags":["php","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":841,"score":1,"question_id":10048978,"title":"Sending messages from PHP to Node.js","body":"<p>How to send messages from php to node.js?   I have a linux server running php and node.js. </p>\n\n<p>When a user completes a transaction (via php), I'd like send a message from php to node.js. Node will then update the client via a socket connection.</p>\n\n<p>What's a good way to send a small amount of data from php to node.js without defeating the performance of node.js?</p>\n"},{"tags":["javascript","asp.net","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13176371,"title":"\"Object moved\" — Attempts to login to ASP.Net webpage using node.js (request module by Mikeal) fail with this cryptic server response","body":"<p>After looking around SO quite a bit, <code>Object moved</code> seems to be a fairly common problem when trying to login to ASP.Net webpages via scripts. After reading a bunch of questions on using cURL to login to aspx pages, I'm still clueless as to how I can achieve the same using node.js</p>\n\n<p>Moving onto the specifics. I wrote a simple node.js script that logins to <code>guru.com/login.aspx</code> using Mikeal's <code>request</code> module. This is what I get when I log the response body:</p>\n\n<pre><code>&lt;html&gt;&lt;head&gt;&lt;title&gt;Object moved&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\n&lt;h2&gt;Object moved to &lt;a href=\"https://www.guru.com/login.aspx\"&gt;here&lt;/a&gt;.&lt;/h2&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>Here's the node.js code I'm using, along with login credentials of a dummy account so you can try the whole thing out on your end:</p>\n\n<pre><code>var \n,   app     = require( 'express' )()\n,   request = require( 'request' );\n\nfunction log( what ) { console.log( what ); }\n\napp.get( '/', function( req, res ) {\n    // I got the form_data below by looking at a login session in Chrome's inspector panel\n    var form_data   =   { \n                                userLogin$tbUsername:'dangi'\n                            ,   userLogin$tbUsername_reqd:'true'\n                            ,   userLogin$tbPassword:'dummydangi'\n                            ,   userLogin$tbPassword_reqd:'true'\n                            ,   userLogin$imgSignIn:'Sign in'\n                            ,   userLogin$hdnErrorFlag:2\n                            ,   userLogin$hdnIsError:2\n                            ,   userLogin$hdnPassword: ''\n                            ,   userLogin$accountUpdate$hdnUserName:''\n                            ,   userLogin$accountUpdate$hdndestinationUrl:'' \n                        }\n    ,   header_data =   { 'User-Agent':'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/24.0.1312.1 Safari/537.17' };\n\n\n    request.post({ url: 'http://www.guru.com/login.aspx', headers:header_data, form:form_data }, function( e, r, b ) {\n        if( !e ) log( b )\n            else log( e );\n    });\n});\n\napp.listen( 8888 );\n</code></pre>\n\n<p><strong>Miscellaneous info:</strong> I'm trying this out on localhost in Windows 7 using node v0.8.14.</p>\n\n<p>Anyone have experience working around this?</p>\n"},{"tags":["node.js","upgrade"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":2416,"score":6,"question_id":10075990,"title":"Upgrading Node.js to latest version","body":"<p>So, I have Node.js installed and now when I tried to install Mongoosejs I got an error telling me that I don't have the needed version of Node.js (I have v0.4.11 and v0.4.12 is needed).</p>\n\n<p>How can I upgrade to this version? I suppose I just could install it again with the latest version, but I don't want to do it before I'm sure that my project folders in the folder \"node\" won't be deleted.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["javascript","node.js","http-get"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13168938,"title":"Node.js http get request exits early with foreman","body":"<p>EDIT: As has been pointed out, this code actually runs fine directly through Node -- I realise now that the problem is when I try to run it with foreman, which is part of the Heroku tool-kit. Does anyone know why I should get a different result when run with the foreman command?</p>\n\n<p>I am trying to parse an XML feed using Node.js. I have code so far just to get the xml feed in chunks and output these to the console. For some reason, whenever I run it, I get an \"exited with code 0\" \"sending SIGKILL to all processes\" message at a random point (different at each run). The message comes interspersed with the last few lines of the xml (example end of output): </p>\n\n<pre><code>01:17:55 web.1  |     &lt;/item&gt;\n    01:17:55 web.1  | exited with code 0\n    01:17:55 web.1  |     &lt;item&gt;\n    01:17:55 system | sending SIGKILL to all processes\n    01:17:55        |       &lt;title&gt;The Church of Scot\n    C:\\CK3\\dashboard&gt;\n</code></pre>\n\n<p>Does anyone know what might be causing this early exit? Here is my code</p>\n\n<pre><code>var http = require('http');\n//var xml2js = require('xml2js');\n\nvar options = {\n  host: 'feeds.bbci.co.uk',\n  port: 80,\n  path: '/news/rss.xml'\n};\n\nvar req = http.get(options, function(res) {\n  //console.log('STATUS: ' + res.statusCode);\n  //console.log('HEADERS: ' + JSON.stringify(res.headers));\n  res.setEncoding('utf8');\n  res.on('data', function (chunk) {\n    console.log(\"\\n\\n new chunk \\n\\n\");\n    console.log(chunk);\n  });\n});\n\n\nreq.on('error', function(e) {\n  console.log('problem with request: ' + e.message);\n});\n\nreq.end();  \n</code></pre>\n\n<p>Many thanks for your time and responses!</p>\n\n<p>-Sixhobbits</p>\n"},{"tags":["forms","node.js","multipartform-data"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13174245,"title":"how to handle multipart/form-data in node.js","body":"<p>I am uploading image file from client side using multipart form data. I want to receieve and write it as a file in the server side using node.js.</p>\n\n<pre><code>&lt;html&gt;\n&lt;body&gt;\n&lt;form action=\"url\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n&lt;input type=\"text\" name=\"imageName\"&gt;\n&lt;input type=\"file\" name=\"sam\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>This is my client side code. How to handle this file in server side.</p>\n"},{"tags":["node.js","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13172376,"title":"how to populate schemaref in mongoose using callbacks?","body":"<p>I have a list of items retrieved from mongoose each with a list object referenced, but I need to somehow populate the item.list.user object associated with each list so I can use them in my template as item.list.user.username.</p>\n\n<pre><code>Item.find().populate('list').exec(function(err, items){\n  items.forEach(function(item){\n    User.findById(item.list.user), function(err, user){\n      item.list.user = user;\n    });\n  });\n\n //how to get back here from User.findById() so I can render?\n res.render('index', { items: items });\n});\n</code></pre>\n"},{"tags":["node.js","middleware"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13065944,"title":"nodejs: middleware should remove itself from the stack","body":"<p>I have a middleware that runs a sequence of actions once and then I don't wish to use it anymore when new requests arrive.\nIs there a way for my middleware to remove itself from the stack? </p>\n\n<p>Thanks,\nLi</p>\n"},{"tags":["node.js","redis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":33,"score":-1,"question_id":13169522,"title":"hdel inside hget block nodejs redis","body":"<p>I'm trying to execute an hdel command in node.js inside a hget block. Here's the code:</p>\n\n<pre><code>client.hget(requests[i], \"client\", function(err, client){\nif(isUser == true){\n    client.hdel(requests[i], function(err){\n          if(err){\n                 console.log(\"cannot process request\");\n              }\n     });\n    }\n});\n</code></pre>\n\n<p>It's not working and I can't understand why! Any help would be greatly appreciated.</p>\n"},{"tags":["node.js","coffeescript","redis","asynccallback","node-redis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13173166,"title":"Cannot read property 'length' of undefined in node_redis hgetall function","body":"<p>I have the following code generating the error:</p>\n\n<pre><code>leagueclient.hgetall userLeagueKey, getLeagueInfo\n</code></pre>\n\n<p>I've verified that the key is correct, and getLeagueInfo executes correctly with the correct return value, but in between I get the Cannot read property 'length' of undefined. Debug says it's in hgetall.</p>\n\n<p>I turned on debug messages in node_redis</p>\n\n<pre><code>send 127.0.0.1:6379 id 2: *2\n$7\nhgetall\n$14\nuserLeagueId:0\n\nsend_command buffered_writes: 0  should_buffer: false\ntrue\nCannot read property 'length' of undefined\nnet read 127.0.0.1:6379 id 2: *6\n$11\nchallengeId\n$1\n0\n$10\nleagueName\n$5\nOatmo\n$22\ncurrentDiscussionEntry\n$1\n2\n</code></pre>\n\n<p>So the error happens after sending the request and getting the result.</p>\n\n<p>Any idea what could be creating the error, and alternatively the best way to debug it?</p>\n"},{"tags":["node.js","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13170882,"title":"How to skip the functions while error occurs in node js step library?","body":"<p>I am using step library for synchronous behavior for validating and saving contacts,</p>\n\n<p>Following are the code which i am using right now</p>\n\n<pre><code>exports.actions = function(req, res, ss) {\n\nvar Step= require('step');\nreq.use('session');\n\nreturn {\n\n        addCon:function(contactObject){\n\n        Step(\n        function validation(){\n            var accounts =contactObject.contacts.accounts;\n            accounts.forEach(function(){\n                //database call\n                services.user.get(updateObj,function(err,rec){\n\n                    if(err || rec == null)\n                     {\n                        res(\"Saving Contact Failed,user Does Not Exist\");\n                        //here responding to client for showing alert message\n                        return false;\n                    }\n                    if(userId === rec.friendId){\n                        res(\"Error\");\n                        //here responding to client for showing alert message\n                        return false;\n                    }\n\n                });\n            });\n        },\n        function saving(){\n            //saving \n        }\n        ,\n        function pusblishing tofriend(){\n            //stuff\n        }\n        )\n\n        }\n }\n\n  }    \n</code></pre>\n\n<p>Actually i want to skip the saving function if any error occurs in the validation function.\nand any idea tobreak the loop, return false is not working.</p>\n"},{"tags":["node.js","exec"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13162136,"title":"node.js: Is there a way for the callback function of child_process.exec() to return the process PID","body":"<h1>Node.JS Exec Question:</h1>\n\n<p>I have a program which spawns multiple processes, and I'd like to log the order of the processes finishing by capturing the PID when the process finishes.  From what I can tell the standard callbacks do not include the PID (stdout,stderr,and error).  </p>\n\n<p>I'd like to avoid using spawn, but it looks like I'll have to, unless any kind souls have some ideas.</p>\n\n<p>Thanks in advance.</p>\n\n<p>EDIT: </p>\n\n<p>To clarify:</p>\n\n<pre><code>var child = child_process.exec(..., function() {\n    console.log( child.pid );\n});\n</code></pre>\n\n<p>will not work for multiple processes.  This returns the last process, not the process which triggered the call back.</p>\n"},{"tags":["node.js","mongodb","typescript"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13161276,"title":"MongoDB Upsert add to array","body":"<p>I'm trying to insert/update an array of strings in a mongodb document using some typescript code running in NodeJS.\nThe following code is typescript but I guess JS developers will get it w/o any problems:</p>\n\n<pre><code>export function addEvents(entityId: string, \n                          events: string[] , \n                          callback: () =&gt; void) {\n\n   db.collection('events', function(error, eventCollection) {\n       if(error) { \n           console.error(error); return; \n       }\n       eventCollection.update({ _id: entityId }, { \"$pushAll \": \n       { events: events }},\n           function(error, result) {\n               if(error) { \n                   console.error(error); return; \n               }\n               callback();\n           });\n   });\n}\n</code></pre>\n\n<p>the document have the following structure:</p>\n\n<pre><code>{\n    _id : string\n    events : [\"array\",\"of\",\"strings\"]\n}\n</code></pre>\n\n<p>I simply want to append an array strings at the end of the existing array for a specific _id.</p>\n\n<p>I don't quite get if I should use update,save, $push ,$pushall etc.</p>\n\n<p>Can someone explain?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13171498,"title":"Accessing mongodb connection failed","body":"<p>i installed mongodb and when i went to the bin from command line and gave mongo i got this error</p>\n\n<pre><code>connecting to: test\nThu Nov 01 10:37:12 Error: couldn't connect to server 127.0.0.1:27017 src/mongo/\nshell/mongo.js:91\nexception: connect failed\n</code></pre>\n\n<p>my system has a 32 bit windows 7 os could that be a problem kindly help me</p>\n"},{"tags":["node.js","http","cors","ajax-upload"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13171342,"title":"Node.js response to AJAX-uploaded file","body":"<p>I have Apache server running on port 80 and Node.js server running on port 3000. I'm trying to ajax-upload an audio file from Apache to Node.js, then encode it with ffmpeg and return its id3 tags as a response. I'm using <a href=\"https://github.com/valums/file-uploader\" rel=\"nofollow\">https://github.com/valums/file-uploader</a> as ajax-uploader widget.</p>\n\n<p>Uploading, encoding and parsing id3 metadata works fine, but the problem is Apache can't receive Node.js's response (response headers are OK, but body is empty).</p>\n\n<p>Node.js server code:</p>\n\n<pre><code>app.use(express.bodyParser());\n\n// Enable CORS (to allow cross-port (80 =&gt; 3000) requests\napp.all('/*', function(req, res, next){\n    if (req.method == 'OPTIONS') {\n        // Process preflight request if it is OPTIONS request\n        res.header('Access-Control-Allow-Origin', '*');\n        res.header('Access-Control-Allow-Method', 'POST, GET, PUT');\n        res.header('Access-Control-Allow-Headers', 'origin, x-requested-with, x-file-name, content-type, cache-control');\n        res.send(200);\n    } else {\n        // Else process the request\n        next();\n    }\n});\n\n// Process uploaded file\napp.post('/audio/upload', function(req, res, next){\n    var file = req.files.file;\n\n    // HUGE BLA-BLA-BLA (encode, save and parse the file - works fine)\n\n    // Time to response (metadata = {'artist': 'Foo', 'title': 'Bar', ...})\n    res.send(metadata) // Returns 200-OK but empty body\n    // OR\n    res.writeHead(200, {'Content-Type': 'text/json'});\n    res.write(JSON.stringify(metadata)) // Same - empty body\n    res.end();\n    // OR\n    res.writeHead(403); // Apache got 403-FORBIDDEN, so I'M ABLE to set headers but not body.\n    res.end();        \n});\n</code></pre>\n\n<p>Headers exchange log:</p>\n\n<pre><code>Response Headers\nConnection          keep-alive\nContent-Type    text/html\nDate            Thu, 01 Nov 2012 04:40:48 GMT\nX-Powered-By    Express\n\nRequest Headers\nAccept          text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Encoding gzip, deflate\nAccept-Language en-US,en;q=0.5\nCache-Control   no-cache\nConnection          keep-alive\nContent-Length  5055420\nContent-Type    multipart/form-data; boundary=---------------------------458377514194490712696533651\nHost            host.dev:3000\nOrigin          http://host.dev\nReferer         http://host.dev/audio/upload\nUser-Agent          Mozilla/5.0 (X11; Linux x86_64; rv:16.0) Gecko/20100101 Firefox/16.0\nX-File-Name         audiofile.mp3\nX-Requested-With    XMLHttpRequest\n</code></pre>\n"},{"tags":["node.js","phpstorm","mocha"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13151940,"title":"mocha + webstorm - error message broken","body":"<p>I try to use mocha with webstorm test runner on win 7.</p>\n\n<p>I have these config params:</p>\n\n<ul>\n<li><p>path to node:</p>\n\n<pre><code>C:\\Program Files (x86)\\nodejs\\node.exe\n</code></pre>\n\n<p>working directory:</p>\n\n<pre><code>D:\\creation\\software developer\\projects\\dev\\document root\\\n</code></pre>\n\n<p>path to node app js file:</p>\n\n<pre><code>C:\\Users\\inf3rno\\node_modules\\mocha\\bin\\_mocha\n</code></pre>\n\n<p>application parameters:</p>\n\n<pre><code>test\n</code></pre></li>\n</ul>\n\n<p>I got the following error message in webstorm console</p>\n\n<pre><code>✖ 1 of 1 test failed:\n</code></pre>\n\n<p>but nothing about which test failed. :S</p>\n\n<p>How to fix it?</p>\n\n<p>(in git bash I got a detailed error message, so mocha is installed well)</p>\n\n<p>Tried with different reporters, but none of them seems working. The problem is with the Error object I think. Everything else is displayed well.</p>\n\n<p>Wrote a custom reporter and found that it's fully random whether the stack shows up on the webstorm console, or not. The best choice was to print it with process.stderr.write, with console.log or process.stdout.write appears nothing. I don't know why is that. Maybe it's some type of timeout, but I set the timeout to 9999999. :S :S :S Hmm maybe the webstorm runner has a timeout, and it depends on that, not on the mocha timeout settings...</p>\n\n<p>Tested with this reporter:</p>\n\n<pre><code>exports = module.exports = WebStorm;\n\n/**\n * Initialize a new `WebStorm` test reporter.\n *\n * @param {Runner} runner\n * @api public\n */\n\n //decribe -&gt; suite\n //it -&gt; test\n\nfunction WebStorm(runner) {\n  var buffer = [];\n  var suites = [];\n  var fails = [];\n\n  runner.on(\"suite\", function(suite){\n     suites.push(suite.title || \"''\");\n  });\n\n  runner.on(\"suite end\", function(suite){\n     if (fails.length &gt; 0)\n         buffer.push(\"describe \"+suites.join(\".\")+\"\\n\"+fails.join(\"\\n\"));\n     fails = [];\n     suites.pop();\n  });\n\n  runner.on(\"fail\", function(test, err){\n      fails.push(\"  it fail \"+test.fullTitle() + err.message);\n  });\n\n  runner.on(\"end\", function (){\n      process.stderr.write(buffer.length+\"\\n\");\n      //process.stderr.write(buffer.join(\"\\n\"));\n  });\n}\n</code></pre>\n\n<p>I found it does not really matter how long the output text is, just how long you have to wait before displaying it. So I still think it's a timeout problem, and not an stdout bug. The webstorm console returns: \"Process finished with exit code 59\" which means \"An unexpected network error occured.\"</p>\n\n<p>Changed to jasmine-node, it's working.</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13170749,"title":"How can I decode quoted-printable content to normal strings in node.js?","body":"<p>For example, I have a string \"this=20is=20a=20string\" that I want to convert to \"this is a string\".</p>\n\n<p>Is there a library function or a npm module that does it or should I make my own function to do it?</p>\n"},{"tags":["node.js","express","socket.io","jade"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":804,"score":1,"question_id":11801882,"title":"node.js + express 3 + socket.io = Can't set headers after they are sent","body":"<p>I'm new to learning node.js and seem to have run into an error that can't get to fix.</p>\n\n<p>Its a very simple and beginners code so shouldn't need much explanation, more over it works fine on localhost, but breaks on production server.</p>\n\n<p><strong>App.js</strong></p>\n\n<pre><code>var express = require('express')\n  , routes = require('./routes')\n  , http = require('http')\n  , path = require('path');\n\nvar app = express();\n\napp.configure(function(){\n  app.set('port', process.env.PORT || 8000);\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.use(express.favicon());\n  app.use(express.logger('dev'));\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(app.router);\n  app.use(express.static(path.join(__dirname, 'public')));\n});\n\napp.configure('development', function(){\n  app.use(express.errorHandler());\n});\n\napp.get('/', routes.index);\n\nvar server = app.listen(8000);\nvar io = require('socket.io').listen(server);\n\nserver.listen(app.get('port'), function(){\n  console.log(\"Express server listening on port \" + app.get('port'));\n});\n</code></pre>\n\n<p><strong>And here's the dreaded error!</strong></p>\n\n<pre><code>http.js:644\n    throw new Error('Can\\'t set headers after they are sent.');\n          ^\nError: Can't set headers after they are sent.\n    at ServerResponse.OutgoingMessage.setHeader (http.js:644:11)\n    at ServerResponse.res.setHeader (/home1/artalatc/public_html/cloud1/node_modules/express/node_modules/connect/lib/patch.js:59:22)\n    at next (/home1/artalatc/public_html/cloud1/node_modules/express/node_modules/connect/lib/proto.js:153:13)\n    at Function.app.handle (/home1/artalatc/public_html/cloud1/node_modules/express/node_modules/connect/lib/proto.js:198:3)\n    at Server.app (/home1/artalatc/public_html/cloud1/node_modules/express/node_modules/connect/lib/connect.js:66:31)\n    at Manager.handleRequest (/home1/artalatc/public_html/cloud1/node_modules/socket.io/lib/manager.js:564:28)\n    at Server.&lt;anonymous&gt; (/home1/artalatc/public_html/cloud1/node_modules/socket.io/lib/manager.js:118:10)\n    at Server.EventEmitter.emit (events.js:115:20)\n    at HTTPParser.parser.onIncoming (http.js:1793:12)\n    at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:111:23)\n</code></pre>\n\n<p>Problem seems to be at <code>var io = require('socket.io').listen(server);</code> because commenting this like removes the error.</p>\n"},{"tags":["node.js","express","buffer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13169540,"title":"Node.js child_process.exec()","body":"<p>I'm trying to exec a child process in node, the name of which is coming from a post request. I'm using express, hence app.post(). My code is below.</p>\n\n<pre><code>app.post('/*', function(req, res) {\n\n  var buf = new Buffer(256);\n  var cont_len = buf.write(req.url, -1);\n  var controller = buf.toString('utf8', 0, cont_len);\n  var controller = controller.concat(' ')\n\n  var args = req.param('args', null);\n\n  var command = __root+__controllers+controller+args;\n\n  console.log(command);\n\n  c = exec(command,\n\n  function (error, stdout, stderr) {\n    res.send(stdout);\n    res.send(stderr);\n\n    if (error !== null) {\n      res.send(error);\n    }\n  });\n\n});\n</code></pre>\n\n<p>The part that doesn't work is when I try and build the command string using a dynamic command. I can hardcode the command variable and it works but when i use the variable 'controller' it doesn't exec my process. Also, is there a way of responding with the return value of the child process or must I stick to only using stdout?</p>\n"},{"tags":["node.js","inheritance","prototype","commonjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13167024,"title":"node.js good way of inheritance","body":"<p>Is this considered good code, is there a cleaner/better way?  So the child classes wouldn't know anything about how to actually get data from a storage mechanism.  Just be able to use those methods to compose functionality.</p>\n\n<p>base.js</p>\n\n<pre><code>function Base() {}\n\nBase.prototype.getInternal = function(id, cb) {}\n\nmodule.exports = Base;\n</code></pre>\n\n<p>child.js</p>\n\n<pre><code>function Child() {}\nutil.inherits(Child, Base);\n\nChild.prototype.get = function(id, cb) {\n  this.getInternal(id, cb);\n}\n\nmodule.exports = new Child();\n</code></pre>\n\n<p>test.js</p>\n\n<pre><code>var Child = require('child');\nChild.get('id', function(err, result) {\n});\n</code></pre>\n"},{"tags":["javascript","node.js","express"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":13166030,"title":"Best way to send data to client js from node.js","body":"<p>What is the best way to send some data (in the form of a json object ideally) from a node.js server to the client's javascript. I've thought of a couple options, but none of them seem to be very suitable in my opinion. A second opinion, or some other suggestions is what I'm looking for.</p>\n\n<ol>\n<li><p>Have the server output some code in a <code>&lt;script&gt;</code> tag to set a global variable.</p>\n\n<p>I've used this before, but I dislike the idea of it, mostly because it has potential for XSS, and I think it's bad practice, even if the data being sent isn't defined by a user.</p></li>\n<li><p>Set a cookie with the data inside it.</p>\n\n<p>This option is a little better, but since the data is likely to change for every page load (at least in my setup), it doesn't really fit since, in my opinion, cookies aren't supposed to be this volatile.</p></li>\n<li><p>Have the client javascript make an ajax request to the server on page load to request the json file.</p>\n\n<p>This works as well, but it adds a lot of unneeded overhead. 2 requests per page seems unnecessary.</p></li>\n</ol>\n\n<p><strong>Background:</strong></p>\n\n<p>I have a site with 2 templates: an index for logged-out users, and the main content template.</p>\n\n<p>My server side is built off node.js, express.js, jade, and less.</p>\n\n<p>I am using history.pushState for all my links and crossroads.js for the client's page routing.\nI want to be able to send the loaded template, and a user's id / if they are logged in to the client javascript, so it can handle page changes accordingly. Logged out users can view content pages, just without editing privileges, and clicking on certain links should bring them back to the index template.</p>\n"},{"tags":["javascript","node.js","passport"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13169333,"title":"Timing out on passport.authenticate, no idea why","body":"<p>When I <code>POST</code> to the endpoint that calls <code>passport.authenticate</code>, I get no response, nor does the server proceed to the strategy defined in <code>passport.use</code>. On Heroku, I get error H12 (timeout), and locally my browser responds with \"No data received.\"</p>\n\n<p>I made <a href=\"https://github.com/thure/baxter-app/tree/12d623f08b6659406c632c4821b1aed582dfe50b\" rel=\"nofollow\">a checkin to GitHub</a> with the code that has this problem.</p>\n\n<p>This isn't a database problem – a <code>console.log</code> is called before <code>.findOne</code>, but that message is never logged. It just seems to stop at <code>passport.authenticate</code>. Why?</p>\n\n<p>What's going on here? Is there something else I can do to diagnose?</p>\n"},{"tags":["javascript","node.js","geospatial","topology"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":25,"score":1,"question_id":13169496,"title":"Topology Library for JavaScript","body":"<p>I need to do some geographic topology teting (intersection, contains, etc.) for a project I'm working on. I would like to use a Node.js server and keep the data in a JSON-esque format as much as possible, meaning I would like to use a topology library that is written in JavaScript. I've found one, <a href=\"https://github.com/bjornharrtell/jsts\" rel=\"nofollow\">JSTS</a>, but it relies on OpenLayers and I only has one project using it at the moment. Does anyone have any experience with this library or any other topology libraries? Also, if this is a terrible idea please let me know and I'll move to a Java server with the JTS topology suite. </p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13169418,"title":"Javascript - Why does this code blocks?","body":"<p>I Don't get why this code blocks. I use nodejs async functions, but now I'm trying to figure out what's the essence of non-blocking programming, and how can I implement those.\nThis is the way I thought it would be, but Its still blocking.</p>\n\n<pre><code>   var async_func = function(x, func) {\n        func(x+5);\n    };\n\n    setTimeout( async_func(5, function(number) {\n        for (var x = 0; x &lt; 1000000000; x++) {;}\n        console.log(number);\n    }), 3000);\n\n    console.log(\"done\");\n</code></pre>\n"},{"tags":["node.js","heroku","web-deployment"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":190,"score":2,"question_id":9042054,"title":"Error on deploy a NodeJS app in Heroku","body":"<p>I'm getting the error:</p>\n\n<pre><code>2012-01-28T00:13:51+00:00 heroku[web.1]: Starting process with command `node server.js`\n2012-01-28T00:13:51+00:00 app[web.1]: \n2012-01-28T00:13:51+00:00 app[web.1]: node.js:134\n2012-01-28T00:13:51+00:00 app[web.1]:         throw e; // process.nextTick error, or 'error' event on first tick\n2012-01-28T00:13:51+00:00 app[web.1]:         ^\n2012-01-28T00:13:51+00:00 app[web.1]:     at Array.&lt;anonymous&gt; (module.js:423:10)\n2012-01-28T00:13:51+00:00 app[web.1]: Error: Cannot find module '/app/server.js'\n2012-01-28T00:13:51+00:00 app[web.1]:     at Function._resolveFilename (module.js:320:11)\n2012-01-28T00:13:51+00:00 app[web.1]:     at Function._load (module.js:266:25)\n2012-01-28T00:13:51+00:00 app[web.1]:     at EventEmitter._tickCallback (node.js:126:26)\n</code></pre>\n\n<p>My Node app server is in server.js at the root, I have no idea how to fix this. \nI've done it from cloud9ide and it works fine, I did a deploy from there to heroku.</p>\n"},{"tags":["javascript","flash","node.js","actionscript","audio-streaming"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13169384,"title":"Actionscript3/Flash | Possible to grab raw audio data from microphone?","body":"<p>is it possible to grab the raw audio data (Mic) from a Flash/Actionscript3 Application? </p>\n\n<p>I would like to stream this data to my node.js server.</p>\n\n<blockquote>\n  <p>At the moment I only have the RTMP Protocol with FMS using\n  <code>Net.Stream</code></p>\n  \n  <p><a href=\"http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetStream.html\" rel=\"nofollow\">http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetStream.html</a></p>\n</blockquote>\n\n<p>Creating an RTMP protocol module seems to be too difficult at the moment.\nIs it possible? Thanks!</p>\n"},{"tags":["node.js","mongodb","mongoose","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13168332,"title":"Installing mongoose on node","body":"<p>I'm trying to install mongoose on Mac OS X:</p>\n\n<pre><code>$ sudo npm install -g mongoose\nnpm http GET https://registry.npmjs.org/mongoose\nnpm http 304 https://registry.npmjs.org/mongoose\nnpm http GET https://registry.npmjs.org/hooks/0.2.1\nnpm http GET https://registry.npmjs.org/mongodb/1.1.11\nnpm http GET https://registry.npmjs.org/ms/0.1.0\nnpm http GET https://registry.npmjs.org/sliced/0.0.3\nnpm http 304 https://registry.npmjs.org/hooks/0.2.1\nnpm http 304 https://registry.npmjs.org/mongodb/1.1.11\nnpm http 304 https://registry.npmjs.org/ms/0.1.0\nnpm http 304 https://registry.npmjs.org/sliced/0.0.3\nnpm http GET https://registry.npmjs.org/bson/0.1.5\nnpm http 304 https://registry.npmjs.org/bson/0.1.5\n\n&gt; bson@0.1.5 install /usr/local/lib/node_modules/mongoose/node_modules/mongodb/node_modules/bson\n&gt; node install.js || (exit 0)\n\n================================================================================\n=                                                                              =\n=  Attempting to build bson c++ extension                                      =\n=   Windows: no build will be attempted as binaries are prepackaged            =\n=   Unix: on failure the package will still install without the C++ extension  =\n=                                                                              =\n================================================================================\nnode-gyp clean\nnode-gyp configure build\n  CXX(target) Release/obj.target/bson/ext/bson.o\n  SOLINK_MODULE(target) Release/bson.node\n  SOLINK_MODULE(target) Release/bson.node: Finished\nchild process exited with code 0\nmongoose@3.3.1 /usr/local/lib/node_modules/mongoose\n├── sliced@0.0.3\n├── hooks@0.2.1\n├── ms@0.1.0\n└── mongodb@1.1.11 (bson@0.1.5)\n$ node\n&gt; require('mongoose');\nError: Cannot find module 'mongoose'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at repl:1:1\n    at REPLServer.self.eval (repl.js:111:21)\n    at rli.on.e (repl.js:260:20)\n    at REPLServer.self.eval (repl.js:118:5)\n    at Interface.&lt;anonymous&gt; (repl.js:250:12)\n    at Interface.EventEmitter.emit (events.js:93:17)\n</code></pre>\n\n<p>Shouldn't <code>require</code> work? Am I doing something wrong?</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13168718,"title":"Node.js Memory Leak: Trouble Understanding my Heap Snapshots","body":"<p>I'm using nodetime to analyze my node app.\nClearly, there's a memory leak; here's my heap over a 2 day period (the 2 dropoffs are due to restarting the app):</p>\n\n<p><img src=\"http://i.stack.imgur.com/6E5Hn.png\" alt=\"enter image description here\"></p>\n\n<p>So I'm taking heap snapshots, but having a really hard time figuring out what the cause of the leak is. The objects seem to come and go (eg, it is not always the same objects in the heap). Here's an example:</p>\n\n<p><img src=\"http://i.stack.imgur.com/k8MPN.png\" alt=\"enter image description here\"></p>\n\n<p>I'm not quite sure where to go from here.\nIn this particular case, I recognize the strings represented in the \"largest instances.\"\nThe 2nd and 3rd strings are both coming from me loading the /me/home endpoint of the <a href=\"http://graph.facebook.com\" rel=\"nofollow\">Facebook Graph</a> using <a href=\"https://github.com/ciaranj/node-oauth\" rel=\"nofollow\">Node-OAuth</a>. </p>\n\n<p>Truth be told, I'm not actually clear if the \"body\" property is actually leaking, or if it was just <em>coincidentally</em> in the heap at the time I took the snapshot (if I take another snapshot, it is not always present).</p>\n\n<p>In any case, here's an excerpt from my OAuthNetwork class:</p>\n\n<pre><code>OAuthNetwork.prototype.oauth = function() {\n    return new OAuth(\n            this.settings['url_request_token'],\n            this.settings['url_access_token'],\n            this.data['key'],\n            this.data['secret'],\n            this.settings['version'],\n            this.settings['url_callback'],\n            this.settings['encoding'],\n            null,//nonceSize\n            this.settings['request_headers']\n        );\n};\nOAuthNetwork.prototype.requestWithCredentials = function(credentials, endpoint, method, params, callback)\n{\n    var url = this.getRequestURL(endpoint, method, params),\n        m = (method || 'GET').toUpperCase(),\n        body = (m==='PUT'||m==='POST') ? this.buildRequestBody(params) : '',\n        ct = this.settings.request_headers['Content-Type'] || null,\n        extra = null;\n\n    this.oauth()._performSecureRequest(credentials.key, credentials.secret, method, url, extra, body, ct, function(error, data, response) {\n\n        if(error)\n        {\n            callback(new Errors.External({'message':'there was an error with the remote service: '+JSON.stringify(error),'error':error,'endpoint': endpoint}));\n            return;\n        }\n        callback(null, {'body': data, 'response': response});\n    });\n};\n</code></pre>\n\n<p>So, I'm left with the impression that the \"body\" field is being retained/leaked somehow. I find it peculiar that the heap snapshot specifically references the body property, though, and not the \"response\" property.</p>\n\n<p>Can anybody provide me with some solid direction on how to go about figuring out the ultimate cause of the leak?</p>\n"},{"tags":["node.js","lua","libevent"],"answer_count":8,"favorite_count":6,"up_vote_count":18,"down_vote_count":0,"view_count":3504,"score":18,"question_id":2985388,"title":"Node.js for lua?","body":"<p>I've been playing around with node.js (nodejs) for the past few day and it is fantastic. As far as I can tell, lua doesn't have a similar integration of libev and libio which let's one avoid almost any blocking calls and interact with the network and the filesystem in an asynchronous manner.</p>\n\n<p>I'm slowly porting my java implementation to nodejs, but I'm shocked that luajit is much faster than v8 JavaScript AND uses far less memory!</p>\n\n<p>I imagine writing my server in such an environment (very fast and responsive, very low memory usage, very expressive) will improve my project immensly.</p>\n\n<p>Being new to lua, I'm just not sure if such a thing exists.  I'll appreciate any pointers.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13168013,"title":"mongoose connection connectTimeoutMS","body":"<p>I can't seem to get my mongo connection to timeout faster than the default.</p>\n\n<pre><code>var databaseUrl = 'mongodb://localhost/doesnotexist';\nvar options = { server: { connectTimeoutMS: 10000 } };\n\nvar db = mongoose.connect(databaseUrl, options, function (err) {\n    ...\n}\n</code></pre>\n\n<p>I am trying to simulate the DB going offline to test the failover to message queues, but can't seem to get this to work.</p>\n\n<p>Any help with this would be great, thanks.</p>\n"},{"tags":["node.js","twitter-bootstrap","npm"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13167775,"title":"Why is \"make test\" failing for me as I try to build Twitter Bootstrap? I installed connect, but I'm getting \"Error: Cannot find module 'connect'\"","body":"<p>So I used git to clone Twitter Bootstrap.  Then I got node.js and npm, because I was following the directions here: <a href=\"https://github.com/twitter/bootstrap\" rel=\"nofollow\">https://github.com/twitter/bootstrap</a>  Then I ran the command <code>npm install recess connect uglify-js jshint -g'  I also then installed phantomjs in the same manner (first without the</code>-g<code>flag and then with it).  Now I am supposed to be able to run</code>make<code>and then</code>make test<code>.</code>make<code>worked fine for me, but</code>make test` is throwing the following error.</p>\n\n<pre><code>jshint js/*.js --config js/.jshintrc\njshint js/tests/unit/*.js --config js/.jshintrc\nnode js/tests/server.js &amp;\nphantomjs js/tests/phantom.js \"http://localhost:3000/js/tests\"\n\nmodule.js:340\n    throw err;\n          ^\nError: Cannot find module 'connect'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (/Users/Jon/dev/blossom/bootstrap/js/tests/server.js:6:15)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.runMain (module.js:492:10)\nUnable to access network\nkill -9 `cat js/tests/pid.txt`\ncat: js/tests/pid.txt: No such file or directory\nkill: usage: kill [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill -l [sigspec]\nmake: *** [test] Error 1\n</code></pre>\n"},{"tags":["node.js","npm"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":13167588,"title":"what does the \"-g\" flag do in the command \"npm install -g <something>\"?","body":"<p>I'm following examples that use the <code>-g</code> flag when using <code>npm install</code> but I can't figure out through the help system what the <code>-g</code> flag is doing.</p>\n"},{"tags":["javascript","node.js"],"answer_count":6,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":128,"score":6,"question_id":13165963,"title":"Referencing \"this\" from within a javascript callback","body":"<p>Something has always bothered me about the way I do object-oriented coding in Javascript. When there's a callback, I frequently want to reference the object which originally called the function, which leads me to do something like this:</p>\n\n<pre><code>MyClass.prototype.doSomething = function(obj, callback) {\n    var me = this; // ugh\n    obj.loadSomething(function(err, result) {\n        me.data = result; // ugh\n        callback(null, me);\n    });\n}\n</code></pre>\n\n<p>First off, creating the additional variable alway seemed... excessive to me. Furthermore, I have to wonder if it might end up causing problems (circular references? un-GCd objects?) by passing the \"me\" variable back to the callback.</p>\n\n<p>Is there a better way to go about this? Is this approach evil?</p>\n"},{"tags":["javascript","node.js","websocket","socket.io"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":7,"view_count":46,"score":-7,"question_id":13166525,"title":"Node.js, Socket.io game - free hosting","body":"<p>I'm trying to make a real-time browser-based game, where can i get a free hosting for that? I guess i should use websocket for that, is that right? \nThnx for response</p>\n"},{"tags":["node.js","meteor","fs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13166503,"title":"Image Uploading in Meteor , uploading empty files","body":"<p>I am working on meteor framework and trying to upload images in one of my app using the code from the link </p>\n\n<p><a href=\"https://gist.github.com/3922137\" rel=\"nofollow\">https://gist.github.com/3922137</a></p>\n\n<p>Everything works good , except that it uploads the empty file in my public folder of app .</p>\n\n<p>I checked console and it shows 503 error there after I select a file to upload</p>\n\n<p>Here is the console screenshot\n<a href=\"http://img40.imageshack.us/img40/2956/consolewl.jpg\" rel=\"nofollow\">http://img40.imageshack.us/img40/2956/consolewl.jpg</a></p>\n\n<p>It keeps on looping and  the number of errors keeps on adding in console </p>\n\n<p>I am using meteor on windows . </p>\n\n<p>Does anyone has managed to get file uploads work in meteor on windows platform ? and if yes can you please share the code which worked for you .</p>\n\n<p>Thanks\nAman</p>\n"},{"tags":["node.js","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12703098,"title":"How to get a json file in express js and display in view","body":"<p>I have a problem in getting a .json file in express and displaying in a view. Kindly share your examples </p>\n"},{"tags":["node.js","architecture","model","middleware"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13165828,"title":"node.js base class for abstracting get/put logic to storage","body":"<p>I was wondering if anyone had any good examples of a node.js base \"class\" for abstracting out the get/put logic to storage.  For example pseudo code.  I realize it would prototypcal inheritance, i am just looking for a clean way to do this so i can split of the files for each of the pieces of functionality.  Or what would be the best way to roll our own ORM, but very dumbed down, just models and this base class?  Are models worth it?</p>\n\n<pre><code>class base\n\n  function get(id, cb) {\n    cb(null, obj);\n  }\n\n  function put(id, obj, cb) {\n    cb(null, obj);\n  }\n</code></pre>\n\n<p>Then i could have \"child\" classes</p>\n\n<pre><code>class function1\n  function getFunction1(id, cb) {\n    // do some other stuff.\n    super.get(id, cb);\n  }\n</code></pre>\n\n<p>so then as usage it makes it clean.</p>\n\n<pre><code>var function1 = require('./function1');\nfunction1.getFunction1('id' function(err, result) {});\nfunction1.putFunction1('');\n</code></pre>\n\n<p>Would it be worth or do you have an example of making this \"functions\" be all defined in single place, almost like middleware/plugins?</p>\n"},{"tags":["node.js","heroku","sass","foundation","compass-geolocation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13165499,"title":"Heroku Deployment of Node.js with Compass + Sass Foundation 3","body":"<p>Trying to get my application up and running with SASS + Compass Foundation 3 and am having issues I have already updated to the node.js buildpack on cedar stack. I get the WARNING: No version of Node.js specified in package.json, however I am specifying a version.\nI am not sure if this is because I now have a Gemfile and a config.rb file for Compass within my repo but everything is working great on local.</p>\n\n<p>Thanks for your help.</p>\n\n<p>Patrick</p>\n\n<pre><code>{\n  \"name\": \"Name\",\n  \"version\": \"1.0.1\",\n  \"engines\": {\n    \"node\": \"0.8.x\",\n    \"npm\": \"1.1.x\"\n  },\n  \"private\": true,\n  \"scripts\": {\n  \"start\": \"node app\"\n  },\n  \"dependencies\": {\n  \"express\": \"2.4.3\",\n  \"jade\": \"*\",\n  \"mailchimp\": \"*\" ,\n  }\n}\n</code></pre>\n"},{"tags":["javascript","node.js","tcp","proxy","udp"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13150378,"title":"How Listen for TCP packet take the data and send UDP with node.js","body":"<p>I'm trying listen on a port for a TCP packet and then take the data from it and forward that to a UDP port. The reason is the software listening on the UDP port only accepts UDP but I want to use javascript websockets to send it data which only uses TCP.</p>\n"},{"tags":["javascript","regex","node.js","optimization","logic"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":13163685,"title":"replace the \".\" into [dots] in multiple urls at a string","body":"<p>i want to replace the \".\" into tokens like [dot] from below input to below output</p>\n\n<p>input</p>\n\n<blockquote>\n  <p>this is a test.for a question. at stackoverflow.com the best place to learn. programming. test www.wikipedia.com</p>\n</blockquote>\n\n<p>output</p>\n\n<blockquote>\n  <p>this is a test.for a question. at stackoverflow[dot]com the best place to learn. programming. test www[dot]wikipedia[dot]com</p>\n</blockquote>\n\n<p>problems</p>\n\n<ol>\n<li>there is a possibly <code>test.for</code> we cant use good regex like <code>/[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}/gi</code> i think its best for using something like below better</li>\n<li>maybe i found a solution;</li>\n</ol>\n\n<p><code>found = string.match(/([a-zA-Z0-9]+\\.(com|co\\.cc)|more\\.domains)/gi);</code></p>\n\n<p>this work great, i have a problem to join/replace them to the original string. any  workarounds like <a href=\"http://stackoverflow.com/questions/13107078/how-can-we-filter-elements-in-array-with-regex-in-array-with-javascript\">how can we filter elements in array with regex in array with javascript?</a></p>\n\n<p>how would you tackle this problem? btw im using nodejs other language is acceptable.</p>\n\n<p>thanks</p>\n"},{"tags":["javascript","node.js","applescript","jslint","bbedit"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13161252,"title":"Integrating jsLint into BBEdit","body":"<p>How do I incorporate jsLint into BBEdit?</p>\n\n<ul>\n<li>Environment: \n<ul>\n<li>OSX Mountain Lion </li>\n<li>BBEdit <em>10.1.2 (3152)</em></li>\n</ul></li>\n</ul>\n\n<p>I installed <a href=\"http://nodejs.org/\" rel=\"nofollow\">Node.js</a> (<em>0.8.14</em>) and ran</p>\n\n<pre><code>sudo npm install -g jslint\n</code></pre>\n\n<p>I am able to run <strong>jslint</strong> from the command line by running</p>\n\n<pre><code>jslint [filepath/]filename\n</code></pre>\n\n<hr>\n\n<p>I found a <a href=\"http://forrst.com/posts/JSLint_Script_for_BBEdit-UQV\" rel=\"nofollow\">tutorial</a> that seems to explain how to connect <strong>jsLint</strong> to <strong>BBEdit</strong>; however, I have never written an AppleScript and have no idea where to start.</p>\n\n<p>Any guidance would be much appreciated.</p>\n\n<hr>\n\n<h2><strong>UPDATE</strong></h2>\n\n<p>I loaded the <a href=\"http://forrst.com/raw_code/c95ab22ac862655c91fbb8c0c35b65dfeebbdd88\" rel=\"nofollow\">AppleScript</a> from the tutorial into the AppleScript Editor Application and ran it.</p>\n\n<p>I'm now getting the following error message:</p>\n\n<blockquote>\n  <p>Can’t get paragraphs 3 thru -1 of \"Can’t make POSIX path of missing\n  value into type Unicode text.\".</p>\n</blockquote>\n"},{"tags":["javascript","node.js","mongodb","nosql","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13077609,"title":"Mongoose populate embedded","body":"<p>I use Mongoose.js and cannot solve problem with 3 level hierarchy document.</p>\n\n<p>There 2 ways to do it.</p>\n\n<p><strong>First</strong> - without refs.</p>\n\n<pre><code>C = new Schema({\n    'title': String,\n});\n\nB = new Schema({\n    'title': String,\n    'c': [C]\n});\n\nA = new Schema({\n    'title': String,\n    'b': [B]\n});\n</code></pre>\n\n<p>I need to show C record. How can i populate / find it, knowing only _id of C?</p>\n\n<p>I was try use:</p>\n\n<pre><code>A.findOne({'b.c._id': req.params.c_id}, function(err, a){\n    console.log(a);\n});\n</code></pre>\n\n<p>But i dont know how to get from returnet a object only c object that i need.</p>\n\n<p><strong>Second</strong> if working with refs:</p>\n\n<pre><code>C = new Schema({\n    'title': String,\n});\n\nB = new Schema({\n    'title': String,\n    'c': [{ type: Schema.Types.ObjectId, ref: 'C' }]\n});\n\nA = new Schema({\n    'title': String,\n    'b': [{ type: Schema.Types.ObjectId, ref: 'B' }]\n});\n</code></pre>\n\n<p>How to populate all B, C records to get hierarchy?</p>\n\n<p>I was try to use something like this:</p>\n\n<pre><code>A\n.find({})\n.populate('b')\n.populate('b.c')\n.exec(function(err, a){\n    a.forEach(function(single_a){\n        console.log('- ' + single_a.title);\n        single_a.b.forEach(function(single_b){\n            console.log('-- ' + single_b.title);\n            single_b.c.forEach(function(single_c){\n                console.log('--- ' + single_c.title);\n            });\n        });\n    });\n});\n</code></pre>\n\n<p>But it will return undefined for single_c.title. I there way to populate it?</p>\n\n<p>Thanks.</p>\n"},{"tags":["windows","node.js","symfony2","less","assetic"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":572,"score":1,"question_id":9029821,"title":"Less Windows Node.js Hanging","body":"<p>I have been trying to setup Symfony2 on Windows so that I can use assetic with less.</p>\n\n<p>I have installed node.js for Windows (0.6.8). Then I have run <code>npm install less --global</code> and found less in <code>C:\\Users\\Matt\\AppData\\Roaming\\npm\\node_modules</code></p>\n\n<p>As far as my Symfony setup, I have the master branch of <code>Assetic</code> (due to a bug I read about in 1.0.2), but the standard v1.0.1 of <code>AsseticBundle</code></p>\n\n<p>After some work, I was able to get an example less file to render via:\n    <a href=\"http://localhost/app_dev.php/css/compiled-main_part_1_boilerplate_1.css\" rel=\"nofollow\">http://localhost/app_dev.php/css/compiled-main_part_1_boilerplate_1.css</a></p>\n\n<p>Then I switched a .less file that @imports other .less files (in the same subdirectory).  Whenever I try to go to that page on my local server (using this less configuration) it hangs and I can see a command process and a node.exe process both running.</p>\n\n<p>The command is trying to run a script in node.js which exists in my temporary directory.  I can run that file through node.js in a command prompt fine, but I cannot get it to load using Symfony/Assetic.</p>\n\n<p>Is there anyway to use node.js, less, and assetic on Windows?</p>\n\n<p>Here is my relevant config file sections:</p>\n\n<pre><code># Assetic Configuration\nassetic:\n    debug:           %kernel.debug%\n    use_controller: false\n    bundles: [FeedStreamMainBundle]\n    # java: /usr/bin/java\n    filters:\n        cssrewrite: ~\n        less:\n            node: %assetic_node%\n            node_paths: [%assetic_less_path%]\n        yui_js:\n            jar: \"%kernel.root_dir%/Resources/java/yuicompressor.jar\"\n        yui_css:\n            jar: %kernel.root_dir%/java/yuicompressor-2.4.2.jar\n        # closure:\n        #     jar: %kernel.root_dir%/java/compiler.jar\n</code></pre>\n\n<p>dev config override:</p>\n\n<pre><code>assetic:\n    use_controller: true\n</code></pre>\n\n<p>in parameters.ini:</p>\n\n<pre><code>assetic_node=\"C:\\\\Program Files (x86)\\\\nodejs\\\\node\"\nassetic_less_path=\"C:\\\\Users\\\\Matt\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\"\n</code></pre>\n"},{"tags":["node.js","openssl","v8"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13163270,"title":"Using openssl lib to extract the content of a PKCS#7 message with v8?","body":"<p>I'm trying to build a NodeJS/V8 bridge for performing openssl operations.</p>\n\n<p>One of them is to extract the content of a PKCS#7 envelope. What I want is the equivalent to this cmd :</p>\n\n<pre><code>openssl smime -verify -inform DER -noverify\n</code></pre>\n\n<p>That just outputs the plain content inside the PKCS#7 envelope.</p>\n\n<p>I was looking at CMS_* operations, but it looks like CMS_verify is only supposed to return an int (see. <a href=\"http://www.openssl.org/docs/crypto/CMS_verify.html\" rel=\"nofollow\">http://www.openssl.org/docs/crypto/CMS_verify.html</a>), I'm looking for the string/binary content if the verify succeeds.</p>\n\n<p>Here is what I got so far. If the code to achieve that is trivial to any of you... That would be really awesome as the openssl docs sucks, it looks like there is not a single C code regarding CMS on the whole web... And finally, that's the first time I do any C++ of my whole life!</p>\n\n<p>PS: bonus question about the <code>DecodeWrite</code>stuff, do so know what this does??</p>\n\n<pre><code>static Handle&lt;Value&gt; Verify(const Arguments&amp; args) {\n    HandleScope scope;\n\n    ASSERT_IS_BUFFER(args[0]);\n    ssize_t klen = Buffer::Length(args[0].As&lt;Object&gt;());\n\n    if (klen &lt; 0) {\n        return ThrowException(Exception::TypeError(String::New(\"Bad argument\")));\n    }\n\n    // No clue of what these three lines do !\n    char* kbuf = new char[klen];\n    ssize_t kwritten = DecodeWrite(kbuf, klen, args[0], BINARY);\n    assert(kwritten == klen);\n\n    Handle&lt;Object&gt; options = args[1]-&gt;ToObject();\n    options-&gt;Get(String::New(\"inform\"))\n\n    //@todo!\n    //int CMS_verify(CMS_ContentInfo *cms, STACK_OF(X509) *certs, X509_STORE *store, BIO *indata, BIO *out, unsigned int flags);\n</code></pre>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13151693,"title":"Passing arguments to require (when loading module)","body":"<p>Is it possible to pass arguments when loading a module using require?</p>\n\n<p>I have module, login.js which provides login functionality. It requires a database connection, and I want the same database connection to be used in all my modules. Now I export a function login.setDatabase(...) which lets me specify a database connection, and that works just fine. But I would rather pass the database and any other requirements when I load the module.</p>\n\n<pre><code>var db = ...\nvar login = require(\"./login.js\")(db);\n</code></pre>\n\n<p>I am pretty new with NodeJS and usually develop using Java and the Spring Framework, so yes... this is a constructor injection :) Is it possible to do something like the code I provided above?</p>\n"},{"tags":["javascript","node.js","internationalization","jquery-globalization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13162928,"title":"Load Globalize cultures with Node.js?","body":"<p>I'm using <a href=\"https://github.com/jquery/globalize\" rel=\"nofollow\">jQuery Globalize</a> with Node.js. They have a <code>package.json</code> file so I can simply use it as a module and <code>require</code> it. However, it doesn't load all cultures by default. I was wondering what the proper way to load a culture would be? I could go and do something like</p>\n\n<pre><code>require('./node_modules/globalize/lib/cultures/globalize.culture.es-US.js')\n</code></pre>\n\n<p>and load the file directly, but that doesn't seem too elegant. Is there a \"proper\" way to do this?</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13161182,"title":"Start viewing a web page while the request is not complete","body":"<p>I am looking for a solution to start viewing a web page while the request is not complete. For example, with Express and EJS, if I query multiple data sources (which I do not have the mastery), I have to wait to retrieve all the data I need to use before \"res.render\" . </p>\n\n<p>Is it possible to send the top of the page and then blocks one by one ?</p>\n\n<p>Thank's for your help !</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13162574,"title":"Is this possible with node.js? (JSON, SQL and pushing changes)","body":"<p>I have a website which can have up to 500 concurrent viewers, with data updated every three seconds. Currently each user has an AJAX object which calls a web-page every three seconds which queries a DB and returns with the results.</p>\n\n<p>What I would love to do is have each client get a socket to a node.js object, this node.js would poll the DB every 3 seconds for updated data, if it had updated data it would then be announced (ideally through JSON) and each client would then have the data pushed to it and update the page accordingly.</p>\n\n<p>If this is possible, does anyone have a recommendation as to where I start? I am fairly familiar with JS but node.js seems to confuse me.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":11838586,"title":"Why does the following nodejs code not work with socketio+express 3?","body":"<p>I dont get why this does not work:</p>\n\n<p>I have a sample.js containing:</p>\n\n<pre><code>var http = require('http');\nvar socket = require('socket.io');\nvar express = require('express');\n\nvar app = express();\nvar server = http.createServer(app);\nvar io = socket.listen(server);\n\nio.sockets.on('connection', function(client) {\n    console.log('Client Connected...');\n\n    client.emit('messages', {hello: 'world'});\n});\n\nserver.listen(8080);\n</code></pre>\n\n<p>I have an index.html page that contains:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;script src=\"socket.io.js\"&gt;&lt;/script&gt;\n\n        &lt;script&gt;\n            var server = io.connect('http://mydomain:8080');\n            server.on('messages', function(data) {\n                alert(data.hello);\n            });         \n        &lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><strong>Update:</strong> When using the socket.io-client.js library, when I go to the <code>http://mydomain:8080</code> page, I get an \"info - unhandled socket.io url\"</p>\n\n<p>Can someone point out what I may be doing wrong?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13161931,"title":"Node.js: Execute command on Web Page button click","body":"<p>How can I execute a linux shell command on webpage button click or keyboard keypress with NodeJs and PHP?</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","callback","coffeescript","variable-scope","node-redis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13152517,"title":"Coffeescript variable scopes on node_redis hgetall callback function","body":"<p>I have the following code:</p>\n\n<pre><code>genUserLeagueDiscussionTable = (userLeagueId, firstEntry, displayEntries) -&gt;\n  # Generate League Discussion\n  leagueDiscussionTable = \n    striped:   yes\n    bordered:  yes\n    hover:     no\n    condensed: yes\n    columns:   [{head:\"Name\"}, {head:\"Comments\"}]\n\n  console.log \"get userLeague #{userLeagueId}\"\n  LeagueId = userLeagueId\n\n  getLeagueDiscussionEntries =  (entry, callback) =&gt;\n    getDiscussionEntry = (err,cnreply) -&gt;\n      setDiscussionTableRows = (err,replyObj,request) -&gt;\n        leagueDiscussionTable.rows[entry.dataentrynum].data = [replyObj.nickname,cnReply.entryText]\n      console.log \"Reply received for entry \",entry.entrynum\n      console.log cnreply.entryText\n      loginclient.hgetall 'uid:'+cnReply.postingUid, setDiscussionTableRows\n      callback()\n    lookupentry = entry.lookupentry\n    console.log \"getting entry for \", entry, \" database key \", lookupentry\n    leagueclient.hgetall lookupentry, getDiscussionEntry\n  getLeagueInfo = (err,lreplyObj) =&gt;\n    console.log \"got league info\", lreplyObj\n    leagueDiscussionTable.caption = lreplyObj.leagueName+\" League Info\"\n    console.log \"caption\", leagueDiscussionTable.caption\n    leagueDiscussionEntries = lreplyObj.currentDiscussionEntry\n    console.log \"Caption \",leagueDiscussionTable.caption,\" entries \", leagueDiscussionEntries, \" Display Entries \",displayEntries\n    lastEntry = Math.min(leagueDiscussionEntries,firstEntry+displayEntries)\n    console.log \"start entry \", firstEntry, \" last entry \", lastEntry\n    entries=[]\n    for num in [firstEntry..lastEntry]\n      console.log num,\".a\"\n      entries[num]={}\n      entries[num].entrynum=num\n      console.log num,\".b\"\n      entries[num].lookupentry=\"userLeagueId:#{LeagueID}:discussionEntryId:#{entry}\"\n      console.log num,\".c\"\n      entries[num].dataentrynum = num-firstEntry\n      console.log num,\" \", entries[num]\n    console.log \"Lookup the entries \", entries\n    async.forEach entries, getLeagueDiscussionEntries\n    , (err,reply) -&gt;\n      console.log \"callback 1\"\n  leagueclient.hgetall \"userLeagueId:#{LeagueId}\", getLeagueInfo\n  return leagueDiscussionTable\n</code></pre>\n\n<p>No matter what I do, I cannot access LeagueId or userLeagueId in getLeagueInfo. It works ok in the outside wrapper, but I can't access it inside the callback function.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>Thanks for the help.</p>\n\n<p>[Edit] Is there a way for me to pass that as a parameter to the function through the hgetall call to the callback?</p>\n\n<p>Fred</p>\n"},{"tags":["javascript","oop","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13139685,"title":"Is trying to imitate a interface/abstract class in javascript bad practice","body":"<p>I am writing some code in Node.js that jumped out at me as being better structured using the strategy pattern.  Coming from .Net I would create the interface the rest were based on and move from there, in JavaScript this is not so clear cut.</p>\n\n<p>I understand as a prototypical language JavaScript does not have the notion of interface inheritance, so I am not sure what I have done is a smell or not, as I cant seem to find references, apart from one blog post which tries to infer an interface by using a base abstract class which forces the inheriting classes to implement the function (as it throws).</p>\n\n<p><strong>My base class</strong></p>\n\n<pre><code>QueryStrategy = function () {\n\n};\n\nQueryStrategy.prototype.create = function(){\nthrow new Error(\"Not Implemented\");\n}\n\nmodule.exports = QueryStrategy;\n</code></pre>\n\n<p><strong>Implementation 1</strong></p>\n\n<pre><code>var util = require('util');\nvar QueryStrategy = require('./queryStrategy');\n\nSelectQueryStrategy = function (query) {\n    this.parameters = query.parameters || [];\n    this.entity = query.entity || '';\n};\n\nutil.inherits(SelectQueryStrategy, QueryStrategy);\n\nSelectQueryStrategy.prototype.create = function () {\n    var self = this,\n        params = self.parameters,\n        paramList = self.parameters.length &gt;= 1 ? '' : '*';\n\n    for (var i = 0; i &lt; params.length; i++) {\n        var suffix = i === (params.length - 1) ? '' : ', ';\n        paramList = paramList + params[i].key + suffix;\n    }\n\n    return util.format(\"SELECT %s FROM %s\", paramList, self.entity);\n};\n\nmodule.exports = SelectQueryStrategy;\n</code></pre>\n\n<p>Currently the base does not have any shared functions, or properties.  Shared functions will come, properties, because of the prototypical chain search i didn't see the point of adding the \"shared\" properties as they are overwritten by the instances created (please if this is wrong, let me know).</p>\n\n<p>Is this an acceptable approach or should I disregard inheritance in this instance.  There may be some type checking and it would make it easier if your could infer the the type to one (i.e. they must all be of the Type QueryStrategy) but I don't want my .Net prejudice to take over here.</p>\n\n<p><strong>Alternative Approach</strong></p>\n\n<p>Firstly, i am not trying to sell books here, i am just reading a lot around the subject with books that i have, but want to give credit where its due.</p>\n\n<p>Based on the couple of comments, it is correct to say that the type inference won't really make any difference here and possibly should be just left down to Duck Typing to check, and maybe trying to slot something in that is not defined in the language is not the best approach.  I have read in Addy Osmani Javascript patterns about interfaces, although my implementation was not the same, and although interface usage is acceptable, it is probably not needed.</p>\n\n<p>It might be simpler to keep the strategy approach but with a different implementation, one that is outlined in Javascript Patterns by Stoyan Stefanov, where you have one implementation and based on some form of configuration you know which strategy to use.</p>\n\n<p><strong>Pseudo Sample</strong></p>\n\n<pre><code>QueryBuilder = function () {\n   this.types = [];\n}\n\nQueryBuilder.prototype.create = function (type, query) {\n    var strategy = types[type];\n    strategy.create(query);\n};\n\nQueryBuilder.types.Select = {\n\n    create: function (query) {\n        params = query.parameters,\n        paramList = query.parameters.length &gt;= 1 ? '' : '*';\n\n        for (var i = 0; i &lt; params.length; i++) {\n            var suffix = i === (params.length - 1) ? '' : ', ';\n            paramList = paramList + params[i].key + suffix;\n        }\n\n        return util.format(\"SELECT %s FROM %s\", paramList, query.entity);\n    }\n};\n</code></pre>\n\n<p>That might be a cleaner way to go, one thing i am note sure about is if I should add types to the prototype, but I guess in this simple case it wouldn't be needed, but in a more complex scenario you could have a lot of strategies and in one file might need to be abstracted out. </p>\n\n<p>is this a more acceptable approach?</p>\n\n<p><strong>What I ended up with</strong></p>\n\n<p>I looked around and tried to understand more about Duck typing, Pros and Cons etc. and tried to simplify my design based on some of the comments and answer I received. I stuck with the strategy-ish approach in that every strategy defined the same function(s), essentially encapsulating what varied across the implementations and giving them a common contract for want of a better term.  </p>\n\n<p>One thing that changed was the base class/interface which, as correctly pointed was not doing anything constructive was removed, each strategy is independent (so not 100% in the classical representation of the pattern) they, as stated just define the same create function.</p>\n\n<p>From the place where the nested ifs and switches once belonged has been replaced with a single switch which decides which query strategy to use based on the type of query type requested.  This could be re-factored into a factory later on, but for now it serves its purpose:</p>\n\n<pre><code>Query.prototype.generate = function () {\n\nvar self = this,\n    strategy = undefined;\n\nswitch (this.queryType) {\n    case \"SELECT\":\n        strategy = new Select(self);\n        break;\n    case \"INSERT\":\n        strategy = new Insert(self);\n        break;\n    case \"UPDATE\":\n        strategy = new Update(self);\n        break;\n    case \"DELETE\":\n        strategy = new Delete(self);\n        break;\n}\n\nreturn strategy.create();\n};\n</code></pre>\n\n<p>Each strategy is independently tested, and i feel this is easier to maintain as if something fails, it will fail in one place and investigation will be easier based on the unit tests.  Obviously there is a trade off, more files, and a slightly more complex structure...we will see what happens.</p>\n"},{"tags":["node.js","session","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13158719,"title":"How can I do something right before the session expire(destroy)","body":"<p>Hi I am using <code>expressjs</code> for my web application, and I use the <code>session</code> middleware, my question is that how I can do something right before the session expire?</p>\n\n<p>For example, I store something in the session, and I set the <code>req.session.cookie.maxAge</code> to 60000(1 minute), when the session timeout, I want to save the data in the session to disk, how I can do this? I checked the API and the <code>destroy</code> function only support <code>callback</code>...</p>\n\n<p>Thanks!</p>\n"},{"tags":["node.js","logging","express","winston"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13157330,"title":"Logging with Winston in Express.js - how to configure for different environments?","body":"<p>I've started to use <a href=\"https://github.com/flatiron/winston\" rel=\"nofollow\">Winston</a> for logging errors and events with my node/express.js app.</p>\n\n<p>One thing I have not figured out is how to specify different Winston transports (or other config) for different environments (Dev/Test/Production).  E.g. I want to have everything logged to the console in the dev enviroment, but use a different transport in Production.</p>\n\n<p>Anyone know how to do this?</p>\n"},{"tags":["node.js","cloud9-ide"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":225,"score":1,"question_id":10504609,"title":"Using cloud9-ide on a network","body":"<p>I've got the cloud9 IDE up and running on my ubuntu box with the latest code from github today, and node.js 0.6.17.  It seems that I can view it fine on localhost:3131 or 127.0.0.1:3131, but if I try to view it with the machine's actual IP address, either from a different machine or even on the same machine, I get a \"not found\" error.  Is there any way to get this to work across a network?</p>\n\n<p>(I read that <a href=\"http://gratdevel.blogspot.com/2011/11/setting-up-cloud9-on-ubuntu-1110.html\" rel=\"nofollow\">there is a \"-l\" command-line argument</a> that would let you do this, but for now it doesn't seem to have an effect.  Was this feature removed?  When and why?)</p>\n"},{"tags":["javascript","node.js","xss"],"answer_count":2,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":1528,"score":6,"question_id":4685487,"title":"Anybody know a solid library/function in Javascript to clean user input","body":"<p>Do you guys know of a solid library/function in Javascript to clean user input.</p>\n\n<p>Mainly for preventing XSS attacks and the sort. </p>\n\n<p>It would be a plus if the said library had the option of allowing certain tags etc.</p>\n\n<p><strong>EDIT:</strong> I'm using node.js on the backend. That's why I need a javascript library for that sort of thing.</p>\n\n<p>People are recommending a part of Google Caja here:\n<a href=\"http://stackoverflow.com/questions/3705356/preventing-xss-in-node-js-server-side-javascript\">Preventing XSS in Node.js / server side javascript</a></p>\n\n<p>But I was just hoping to get more options.</p>\n"},{"tags":["javascript","validation","node.js"],"answer_count":5,"favorite_count":4,"up_vote_count":19,"down_vote_count":0,"view_count":6393,"score":19,"question_id":4088723,"title":"Validation library for Node.js","body":"<p>Is there a good validation framework for node.js that validates a variable for:</p>\n\n<ul>\n<li>if its a type of String, Date, Number etc</li>\n<li>max and min length</li>\n<li>email, phone</li>\n<li>etc...</li>\n</ul>\n"},{"tags":["node.js","jquery-mobile"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":15,"score":-1,"question_id":13158918,"title":"How to add new user in node chat application?","body":"<pre><code>How to add new users in node chat application?\n</code></pre>\n\n<ol>\n<li>i am using jquery mobile .</li>\n<li>on there i keep all online users in list view and new users also add in these listview.</li>\n</ol>\n"},{"tags":["facebook","node.js","passport"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13158724,"title":"Node.js - Facebook Logging in a user from the App Center (Visit website button)","body":"<p>I'm using <code>Passport</code> and <code>Facebook Strategy</code> for authentication. It works fine from within my website. Clicking the <em>login button</em> makes a get request to <code>auth/facebook/</code> and I succesfully log in the user.\n I have the same url in the app details:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wIO6i.png\" alt=\"Facebook login website\"> </p>\n\n<p>However the App Center <code>Visit Website</code> button adds this to the query:</p>\n\n<pre><code>{ fb_source: 'appcenter',\n  fb_appcenter: '1',\n  code:xxxxx...., // this is what i want\n}\n</code></pre>\n\n<p>And upon clicking i get this error:</p>\n\n<blockquote>\n  <p>\"Error validating verification code. Please make sure your redirect_uri is identical to the one you used in the OAuth dialog request\"</p>\n</blockquote>\n\n<p>What i don't get is that this works AT THE SAME time on my website. How do I handle this extra parameters and log in the user upon clicking on the <em>visit website</em> button?</p>\n\n<p>I also posted <a href=\"http://stackoverflow.com/questions/13149896/node-js-passport-get-facebook-session-on-page-load\">another question</a>. I've been dealing with this for a while now and can't get my head around it...</p>\n\n<p>note:\nAs far as I know, it is required for app approval that the <code>Visit Button</code> authenticates the user upon clicking and doesn't prompt them with another login message.</p>\n"},{"tags":["javascript","node.js","coffeescript","jasmine"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13141316,"title":"After modifying attributes on a node.js vm context (sandbox), the modifications aren't seen by code in the context","body":"<h1>Background</h1>\n\n<p>I'm working on <a href=\"https://github.com/nilbus/Backbone.dualStorage/tree/tests/spec\" rel=\"nofollow\">tests</a> for the <a href=\"https://github.com/nilbus/Backbone.dualStorage\" rel=\"nofollow\">Backbone.dualStorage</a> plugin for Backbone.js that replaces Backbone.sync.</p>\n\n<p>This is a browser plugin, but I'm using jasmine-node to test it. I load the coffeescript source into the node environment to simulate the browser <code>window</code> using vm.createContext:</p>\n\n<pre><code>vm = require 'vm'\nfs = require 'fs'\ncoffee = require 'coffee-script'\nbackboneDualstoragePath = './backbone.dualstorage.coffee'\nsource = fs.readFileSync(backboneDualstoragePath, 'utf8')\nwindow = require('./global_test_context.coffee').window\ncontext = vm.createContext window\ncoffee.eval source, sandbox: context, filename: backboneDualstoragePath\nexports.window = context\n</code></pre>\n\n<p>This works great - in my tests, I can access <code>window.foo</code>, where foo is an attribute exported on the window object in global_test_context.coffee.</p>\n\n<p>I can use Jasmine spies on and redefine methods on any object nested under the window sandbox. Eg:</p>\n\n<pre><code>spyOn(window.Store.prototype, 'create').andReturn(true)\nwindow.Store.create() # The spy is called\nwindow.localsync.create() # This function instantiates a Store object and calls create on it\n                          # The spy is called\n</code></pre>\n\n<p>However if I try to spy on or otherwise modify the context's direct attributes, the change is not seen inside the sandbox context:</p>\n\n<pre><code>spyOn(window, 'localsync').andReturn(true)\nwindow.localsync() # The spy is called\nwindow.dualsync() # This function references the global localsync\n                  # The original localsync is called\n</code></pre>\n\n<p>The <a href=\"http://nodejs.org/api/vm.html#vm_vm_createcontext_initsandbox\" rel=\"nofollow\">vm.createContext documentation</a> says:</p>\n\n<blockquote>\n  <p>A (V8) context comprises a global object together with a set of\n  build-in objects and functions. The optional argument initSandbox\n  <em>will be shallow-copied to seed the initial contents of the global object</em> used by the context.</p>\n</blockquote>\n\n<p>So it sounds like it copies the attributes from my window variable into the vm context. When I spy on or otherwise modify <code>window</code> after this point, I am working with the vm context, which I export as an attribute named <code>window</code>. Therefore I think that the paragraph above is irrelevant, but I wanted to include it in case I'm wrong.</p>\n\n<h1>The Question</h1>\n\n<p>The flow of events boils down to this:</p>\n\n<pre><code>window = vm.createContext({globalVariables: forTesting...})\n\n# similiar to vm.runInContext(backboneDualstorageSource, window)\ncoffee.eval(backboneDualstorageSource, sandbox: window)\n\n# localsync and dualsync are both defined in the backboneDualstorageSource\nspyOn(window, 'localsync')\nwindow.dualsync() # calls the original localsync instead of the spy\n</code></pre>\n\n<p>Why is it that after modifying attributes on the vm context, references to those \"global\" attributes/functions inside the vm don't change? I want to understand this.</p>\n\n<p>How can I work around this so that I can modify/spyOn globals in the browser script I'm testing?</p>\n\n<p>Feel free to look at <a href=\"https://github.com/nilbus/Backbone.dualStorage/tree/tests/spec\" rel=\"nofollow\">the source</a> to get a better idea of how things are actually written compared to the snippets in this question.</p>\n\n<h2>Edit</h2>\n\n<p>I was able to work around this issue by creating the spy inside an eval that runs in the context, like the rest of the tested code. See <a href=\"https://github.com/nilbus/Backbone.dualStorage/commit/eb6c2b21\" rel=\"nofollow\">https://github.com/nilbus/Backbone.dualStorage/commit/eb6c2b21</a></p>\n\n<p>Could someone explain why I'm able to modify global variables within the context but not outside the context, even though I have access to them?</p>\n"},{"tags":["node.js","socket.io"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13158315,"title":"how to show the online users in node chat application?","body":"<p>I have created a chat system using node and socket.io . When a user logs into this chat system, then it show in message  content area and also it show in another table.</p>\n\n<p>I making the UI for this chat application with using jquery mobile.</p>\n\n<ol>\n<li>I am using data-role=\"popup\" and it show in listview</li>\n<li>Online user show in list and when  click the particular online users then it<br>\n         show in chat application.    </li>\n</ol>\n"},{"tags":["javascript","node.js","requirejs","commonjs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":46,"score":1,"question_id":13155485,"title":"what is the history of modular JavaScript?","body":"<p>as we know, modular JavaScript is so popular today. there are many draft or protocol talking about modular JavaScript, such as CommonJS,AMD,CMD. there also have many module loader(RequireJS, LABjs, HeadJS). </p>\n\n<p>but i want to know what is the history of modular JavaScript? long long ago, we only have Dojo lader.</p>\n"},{"tags":["node.js","buffer","v8","node-gyp"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13157195,"title":"node-gyp crashing on a basic Buffer::Length operation about incompatible types","body":"<p>I've took a simple piece of code from the NodeJS core (crypto) :</p>\n\n<pre><code>ASSERT_IS_BUFFER(args[0]);\nssize_t klen = Buffer::Length(args[0]);\n</code></pre>\n\n<p>However when compiling this with <code>node-gyp</code> in my own native extension, I get the following error :</p>\n\n<pre><code>../deps/v8/include/v8.h:202:5: error: assigning to 'v8::Object *volatile' from incompatible type\n      'v8::Value *'\n    TYPE_CHECK(T, S);\n    ^\n../deps/v8/include/v8.h:145:37: note: expanded from macro 'TYPE_CHECK'\n    *(static_cast&lt;T* volatile*&gt;(0)) = static_cast&lt;S*&gt;(0);      \\\n                                    ^\n../src/openssljs.cc:300:33: note: in instantiation of function template specialization 'v8::Handle&lt;v8::Object&gt;::Handle&lt;v8::Value&gt;'\n      requested here\n                ssize_t klen = Buffer::Length(args[0]);\n                                              ^\n</code></pre>\n\n<p>Any idea what could be causing this?</p>\n"},{"tags":["ruby","node.js","raphael","jsdom","execjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13157386,"title":"Running Raphaël and JSDom in jsexec environment","body":"<p>I'm trying to use Raphaël in jsexec environment (using NodeJS as external runtime). As I see, i need JSDom library to make Raphaël working. I have following code:</p>\n\n<pre><code>require 'execjs'\nlib_source = Dir['js/libs/*.js'].map { |f| File.open(f, \"r\") { |io|  io.read}  }.join(\"\\n\\n\\n\")\ncontext = ExecJS.compile(lib_source)\nputs context.eval(\"Raphael(10, 50, 320, 200)\")\n</code></pre>\n\n<p>and while i'm trying to run it, i receive following error:</p>\n\n<pre><code>/home/vadim/.rvm/gems/ruby-1.9.3-p194/gems/execjs-1.4.0/lib/execjs/external_runtime.rb:68:in `extract_result': ReferenceError: document is not defined (ExecJS::ProgramError)\nfrom /home/vadim/.rvm/gems/ruby-1.9.3-p194/gems/execjs-1.4.0/lib/execjs/external_runtime.rb:28:in `block in exec'\nfrom /home/vadim/.rvm/gems/ruby-1.9.3-p194/gems/execjs-1.4.0/lib/execjs/external_runtime.rb:41:in `compile_to_tempfile'\nfrom /home/vadim/.rvm/gems/ruby-1.9.3-p194/gems/execjs-1.4.0/lib/execjs/external_runtime.rb:27:in `exec'\nfrom /home/vadim/.rvm/gems/ruby-1.9.3-p194/gems/execjs-1.4.0/lib/execjs/external_runtime.rb:19:in `eval'\nfrom execjs-test.rb:8:in `&lt;main&gt;'\n</code></pre>\n\n<p>In js/libs folder i have raphael.js, jsdom.js and jsdom folder with all files required by jsdom.</p>\n"},{"tags":["node.js","stream"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13156243,"title":"event associalted with fs.createWriteStream in node.js","body":"<p>What event is triggered when EOF is reached while writing to a stream ?\nMy code is as follows. and it is as per <a href=\"http://docs.nodejitsu.com/articles/advanced/streams/how-to-use-fs-create-write-stream\" rel=\"nofollow\">http://docs.nodejitsu.com/articles/advanced/streams/how-to-use-fs-create-write-stream</a></p>\n\n<p>But surprisingly my 'end' event is never fired. When I checked <a href=\"http://nodejs.org/api/stream.html#stream_event_end\" rel=\"nofollow\">http://nodejs.org/api/stream.html#stream_event_end</a>, I see that writable stream does not have any event on 'end'</p>\n\n<hr>\n\n<pre><code>var x = a1.jpg;\nvar options1 = {'url': url_of_an_image, 'encoding': null};\nvar r = request(options1).pipe(fs.createWriteStream('/tmp/imageresize/'+x));\n\nr.on('end', function(){\n    console.log('file downloaded to ', '/tmp/imageresize/'+x);\n}\n</code></pre>\n\n<p>How do I capture the EOF event ?</p>\n"},{"tags":["javascript","node.js","ldap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13157206,"title":"LDAPAUTH module node JS Segmentation fault 11","body":"<p>Can somebody please help? When I run the following code to connect to the LDAP, getting Segmentation Fault 11. Please help.</p>\n\n<pre><code>var ldapauth = require('./ldapauth'); \n\nldapauth.authenticate('ldap','ad.abc.com', 3268, 'abc\\vradhakrishnan', 'Ra124578',\n\n  function(err, result) {\n    if (err) {\n      console.log(\"Error\");\n    } else {\n      print(\"Credentials valid = \" + result); // true or false\n    }\n\n  });\n</code></pre>\n"},{"tags":["node.js","mongodb","analytics"],"answer_count":3,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":13118872,"title":"How to scale MongoDB based analytics up to millions events per day?","body":"<p>Regarding my previous question ( <a href=\"http://stackoverflow.com/questions/12401460/how-to-quickly-build-large-scale-analytics-server\">How to quickly build large scale analytics server?</a>\n) I'm now feeding my analytics data to MongoDB - Every event (with bunch of metadata) gets their own document in views collection.</p>\n\n<p>However, now I've hit the next roadblock: Now that inserts are done and analytics data is flowing, what would be the path of least resistance to do runs against that data? The idea is that once that data is sharded, the specific views would run mapReduces (say all events with specific ID one month back).</p>\n\n<p>So, my question is: As I'm quite new with MongoDB, what are the steps I would need to do to get those mapReduces as fast as possible? Should I structure the raw data differently or is the one document per event correct? Are there Mongo specific tricks that I can do to make things flow faster when running against dataset that gets millions of inserts per day?</p>\n\n<p>I would prefer to keep my technology stack as simple as possible (Node.js + MongoDB), so I'd prefer if things could be done without introducing extra technology (like say Hadoop).</p>\n\n<p>Example document of a event:</p>\n\n<pre><code>{\n    id: 'abc',\n    ip: '1.1.1.1',\n    type: 'event1',\n    timestamp: 1234,\n    metadata: {\n        client: 'client1'\n    }\n}\n</code></pre>\n\n<p>All main aggregations will be ID centric, analysing events in said ID, the most used being get all events with said ID for the last month. Minor aggregations would be grouping things with metadata (how many percents used client1 vs. client2 etc.). All the aggregations will be system defined, so users can't set them by themselves, at this point at least. Thus, as far as I understand, the sharding should be done through ID, as big majority of the aggregations will be ID centric? Also, this should mean that the most recent events on any given ID are always in memory as Mongo keeps the latest stuff in memory and only dumps the overflow to disk.</p>\n\n<p>Also, real time is not a requirement. Although, ofc it would be nice. :P</p>\n\n<p>Edit: Added example data</p>\n\n<p>Edit: Title should have been \"...per day\" not \"...per page\" + more spec about the aggregation sets</p>\n"},{"tags":["node.js","stack-trace"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":358,"score":4,"question_id":7697038,"title":"More than 10 lines in a node.js stack error?","body":"<p>Is there a way to get more than 10 lines in a node.js stack error?</p>\n\n<pre><code>function a() { dieInHell(); }\nfunction b() { a(); }\nfunction c() { b(); }\nfunction d() { c(); }\nfunction e() { d(); }\nfunction f() { e(); }\nfunction g() { f(); }\nfunction h() { g(); }\nfunction i() { h(); }\nfunction j() { i(); }\nfunction k() { j(); }\nfunction l() { k(); }\nfunction m() { l(); }\nfunction n() { m(); }\nfunction o() { n(); }\nfunction p() { o(); }\nfunction q() { p(); }\n\ntry {\n    q();\n}\ncatch(e) {\n    console.log(e.stack);\n}\n</code></pre>\n\n<p>shows :</p>\n\n<pre><code>$ node debug.js \nReferenceError: dieInHell is not defined\n    at a (/Users/julien/tmp/debug.js:2:5)\n    at b (/Users/julien/tmp/debug.js:6:5)\n    at c (/Users/julien/tmp/debug.js:10:5)\n    at d (/Users/julien/tmp/debug.js:14:5)\n    at e (/Users/julien/tmp/debug.js:18:5)\n    at f (/Users/julien/tmp/debug.js:22:5)\n    at g (/Users/julien/tmp/debug.js:26:5)\n    at h (/Users/julien/tmp/debug.js:30:5)\n    at i (/Users/julien/tmp/debug.js:34:5)\n    at j (/Users/julien/tmp/debug.js:38:5)\n</code></pre>\n\n<p>Is there a way to get more than 10 calls?</p>\n"},{"tags":["node.js","telnet"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13154542,"title":"Node.JS server receives data character by character instead of line by line","body":"<p>I've got a simple Node.JS server:</p>\n\n<pre><code>//Module dependencies\nvar net = require('net')\n\n\n//Create server\nvar server = net.createServer(function (conn) {\n\n  // handle connection\n  conn.setEncoding('utf8');\n\n  conn.write(\n      'Hi, please enter something: '\n  );\n\n  conn.on('data', function (data) {\n    console.log(data);\n  });\n\n});\n\n\n//Listen\nserver.listen(3000, function () {\n  console.log('\\033[96m   server listens at *:3000\\033[39m');\n});\n</code></pre>\n\n<p>It is supposed to echo a client's input in server's console window. But when I connect to the server using telnet client, it does so by outputting character by character, while I would rather it output line by line on pressing Enter.</p>\n\n<p>I know I cann collect all the input in the <code>conn.on</code> method, but can it be done on a lower level?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13152827,"title":"why are \"flushes\" required for bigpipe?","body":"<p><a href=\"https://github.com/jehrhardt/bigpipe-node/blob/master/app.js\" rel=\"nofollow\">https://github.com/jehrhardt/bigpipe-node/blob/master/app.js</a>\nhttp://www.subbu.org/blog/2010/07/bigpipe-done-in-node-js</p>\n\n<p>I've noticed that all implementations of bigpipe need to \"flush\" the HTML. In other words, something like this always happens:</p>\n\n<pre><code>// header n stuff\n\nres.write('&lt;script&gt;function flushHTML(id, html) {'\n  + 'document.getElementById(' + id + ').innerHTML = ' + html\n  + '};&lt;/script&gt;')\n\n// more stuff\n\n// a \"pagelet\"\nres.write('&lt;script&gt;flushHTML(' + someID + ', ' + myHTML + ');&lt;/script&gt;')\n\nres.end('&lt;/body&gt;&lt;/html&gt;')\n</code></pre>\n\n<p>Why can't you just <code>res.write(html)</code> each section without flushing?</p>\n"},{"tags":["security","node.js","session","express","sha256"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13151140,"title":"express secret key length","body":"<p>Are there any recommendations for the length of the secret key used to cryptographically hash session data in connect/express? I see everything from 60+ character strings to the canonical 'keyboard cat'.</p>\n\n<p>For my immediate use case, I intend to use SSL for the entire site and the payoff for a brute-force attack is medium to low.</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":168,"score":2,"question_id":11421974,"title":"Unexpected newline characters using nodejs/express","body":"<p>I'm working my way through an example using Nodejs &amp; Express.  When trying it I get an error.</p>\n\n<p>A portion of the main file:</p>\n\n<pre><code>    app.post('/send', express.bodyParser(), function(req, res) {\n    if(req.body &amp;&amp; req.body.tweet) {\n        tweets.push(req.body.tweet);\n        res.send({status:\"ok\",message:\"Tweet received\"});\n    } else {\n        res.send({status: \"nok\", message: \"No tweet received\"});    \n    }\n</code></pre>\n\n<p>});</p>\n\n<p>A portion of the test script:</p>\n\n<pre><code>    var req = http.request(opts, function(res) {\nres.setEncoding('utf8');\n\nvar data = \"\";\nres.on('data', function(d) {\n    data += d;  \n});\nres.on('end', function() {\n    assert.strictEqual(data, '{\"status\":\"ok\",\"message\":\"Tweet received\"}');\n});\n</code></pre>\n\n<p>});        </p>\n\n<p>This is the error:</p>\n\n<pre><code>assert.js:104\n  throw new assert.AssertionError({\n        ^\nAssertionError: \"{\\n  \\\"status\\\": \\\"ok\\\",\\n  \\\"message\\\": \\\"Tweet received\\\"\\n}\" === \"{\\\"status\\\":\\\"ok\\\",\\\"message\\\":\\\"Tweet received\\\"}\"\n    at IncomingMessage.&lt;anonymous&gt; (/home/jfb/Documents/Info/Nodejs/Up_and_Running/test.js:19:11)\n    at IncomingMessage.EventEmitter.emit (events.js:115:20)\n    at IncomingMessage._emitEnd (http.js:366:10)\n    at HTTPParser.parserOnMessageComplete [as onMessageComplete] (http.js:149:23)\n    at Socket.socketOnData [as ondata] (http.js:1356:20)\n    at TCP.onread (net.js:404:27)\n</code></pre>\n\n<p>I checked my file with an editor set to display special characters and there were no newline characters as shown by the error message.</p>\n\n<p>Could someone tell me what is happening here.</p>\n\n<p>Thanks,  Jim</p>\n"},{"tags":["node.js","mongodb","geddy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13148391,"title":"How to run Geddy with Mongo on Windows?","body":"<p>I have a strange problem with the Geddy and Mongo under Windows. I'm completely new with Node.js and all this stuff, and try their sample app, which was fine until mongo attached. Then it throw something like this on data save:</p>\n\n<pre><code>c:\\www\\__node\\wartex\\node_modules\\mongodb-wrapper\\node_modules\\mongodb\\lib\\mongo\ndb\\connection\\server.js:359\n        throw err;\n              ^\nReferenceError: model is not defined\n    at utils.mixin.insert.insert (C:\\Users\\Alex\\AppData\\Roaming\\npm\\node_modules\n\\geddy\\node_modules\\model\\lib\\adapters\\mongo\\index.js:309:29)\n    at utils.mixin.insert.insert (C:\\Users\\Alex\\AppData\\Roaming\\npm\\node_modules\n\\geddy\\node_modules\\model\\lib\\adapters\\mongo\\index.js:304:13)\n    at exports.Collection.self.insert (c:\\www\\__node\\wartex\\node_modules\\mongodb\n-wrapper\\lib\\mongodb-wrapper.js:303:17)\n    at insertAll (c:\\www\\__node\\wartex\\node_modules\\mongodb-wrapper\\node_modules\n\\mongodb\\lib\\mongodb\\collection.js:315:12)\n    at Collection.insert (c:\\www\\__node\\wartex\\node_modules\\mongodb-wrapper\\node\n_modules\\mongodb\\lib\\mongodb\\collection.js:90:3)\n    at exports.Collection.self.insert (c:\\www\\__node\\wartex\\node_modules\\mongodb\n-wrapper\\lib\\mongodb-wrapper.js:301:24)\n    at exports.Collection.self.ensureIndex.cb (c:\\www\\__node\\wartex\\node_modules\n\\mongodb-wrapper\\lib\\mongodb-wrapper.js:201:17)\n    at Db.collection (c:\\www\\__node\\wartex\\node_modules\\mongodb-wrapper\\node_mod\nules\\mongodb\\lib\\mongodb\\db.js:449:44)\n    at EventEmitter.exports.Collection.self.ensureIndex.cb (c:\\www\\__node\\wartex\n\\node_modules\\mongodb-wrapper\\lib\\mongodb-wrapper.js:193:16)\n    at EventEmitter.emit (events.js:99:17)\n[Tue, 30 Oct 2012 22:05:21 GMT] ERROR Worker 10576 died.\n</code></pre>\n\n<p>which is not too cool. It crashes on every save (create or update), still it create data and it is available for read after re-run geddy app. Delete works just fine too.</p>\n\n<p>How this could be fixed?</p>\n\n<hr>\n\n<p>Also, as a side question, maybe it is some better node.js framework, which have better documentation and crash reports, and shouldn't be re-run manually after each unexpected error?</p>\n"},{"tags":["git","node.js","heroku","foreman"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12031990,"title":"Node.js app in Heroku Works on Foreman but not When Deployed?","body":"<p>I successfully have my app running on foreman start perfectly well, but as soon as I deploy it to Heroku, it throws me an error in the logs:</p>\n\n<pre><code>2012-08-20T03:22:48+00:00 heroku[web.1]: Starting process with command `node index.js`\n2012-08-20T03:22:49+00:00 app[web.1]: Server has started.\n2012-08-20T03:22:49+00:00 heroku[web.1]: Error R11 (Bad bind) -&gt; Process bound to port 15134, should be 52717 (see environment variable PORT)\n2012-08-20T03:22:49+00:00 heroku[web.1]: Stopping process with SIGKILL\n2012-08-20T03:22:51+00:00 heroku[web.1]: Process exited with status 137\n2012-08-20T03:22:51+00:00 heroku[web.1]: State changed from starting to crashed\n</code></pre>\n\n<p>I have tried to change which port it binds to, but every time I do it changes the port again. Is there something else wrong in my app?</p>\n"},{"tags":["node.js","sftp"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13149838,"title":"Node.js SFTP server","body":"<p>I need to accept files by SFTP for users.  I also need to dynamically create, update, destroy user accounts.</p>\n\n<p>One way to accomplish this would be to install an SFTP server, and then write a script to handle editing/updating users.</p>\n\n<p>After playing with Node.js a small amount, it seems like it would be good at this sort of thing.  Any suggestions how to go about it, or modules that can accomplish this?</p>\n"},{"tags":["html","node.js"],"answer_count":5,"favorite_count":7,"up_vote_count":30,"down_vote_count":0,"view_count":13887,"score":30,"question_id":4720343,"title":"Loading basic HTML in NodeJS","body":"<p>Just a simple nodejs noob question here.  I'm trying to find out how to load and display a basic html file so I don't have to write stuff like<code>response.write('...&lt;p&gt;blahblahblah&lt;/p&gt;...');</code>.</p>\n"},{"tags":["json","http","rest","node.js","couchdb"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":516,"score":2,"question_id":7161465,"title":"How can I access my couchdb from my node server using REST/JSON/GET/POST?","body":"<p>I'm trying to access my couchdb from a node.js server.</p>\n\n<p>I've followed the nodejs tutorial, and have set up this simple nodejs server:</p>\n\n<pre><code>var http = require('http');\nhttp.createServer(function (req, res) {\n  res.writeHead(200, {'Content-Type': 'text/plain'});\n  res.end('Hello World\\n');\n}).listen(80, \"127.0.0.1\");\nconsole.log('Server running at http://127.0.0.1:80/');\n</code></pre>\n\n<p>I would like to make RESTful http and POST requests to the nodejs server. The nodejs server should then be able to make GET/POST request to the Couchdb, which responds with JSON objects.</p>\n\n<p>How might I do this?</p>\n"},{"tags":["javascript","node.js","global-variables","dsl","prototype-programming"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13150164,"title":"temporary global variables/functions and prototype overrides to write a JS DSL","body":"<p>I'm exploring a variety of options for a JavaScript routing framework that I'm working on, and I'd like to provide a DSL written in JavaScript for defining the router. </p>\n\n<p>I had the idea of using temporary prototype overrides on the String class (maintain a hash of the previous prototype values, override, run the DSL code, reset the prototype values to what they were) to all for something like this:</p>\n\n<pre><code>DSL.run(function() {\n  \"hello\".isSomething();\n  \"foo\".isSomethingElse();\n});\n</code></pre>\n\n<p>The other idea was to use define temporary global variables and then remove/reset them after the DSL is done running. That way, if you run the DSL closure with <code>window</code> (or whatever the global object is) as the <code>this</code> context, I believe you should be able to do something like:</p>\n\n<pre><code>DSL.run(function() {\n  defineSomething(\"hello\");\n  defineSomethingElse(\"foo\");\n});\n</code></pre>\n\n<p>I know I know I know I should be super careful about the prototype overloads and polluting the global namespace, but this seems to be a pretty localized and easily cleanup-able approach to keep that sort of thing from happening. My question is, are there any other considerations that would keep this from being a reality?</p>\n\n<p>One potential problem I could think of is whether this would work in a Node.js setting, where code is stored in separate modules and global variables kept from each other, which I think would eliminate option B, but what about String prototype overloads? Those are shared between modules, right? e.g. if I include module A, which sets String prototype values, those prototype values will be available in the including code, right?</p>\n\n<p>Also, let me know if anyone's done this sort of thing before. I think it's a clever approach to this sort of problem and I haven't seen anything quite like it, but I want to make sure I'm not leaving out something really obvious and damning.</p>\n"},{"tags":["node.js","rest","websocket","socket.io","restify"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13101469,"title":"Node.js restify with socket.io","body":"<p>Is it possible to run socket.io &amp; restify on the same port like express &amp; socket.io?</p>\n\n<p>I did just like this but it didn't work</p>\n\n<pre><code># server.coffee\nrestify = require 'restify'\nsocket  = require 'socket.io'\n\nserver = restify.createServer()\n\nio = socket.listen server\nserver.listen 1337\n</code></pre>\n\n<p>when I try to connect to socket.io:</p>\n\n<pre><code>GET http://localhost:1337/socket.io/socket.io.js 404 (Not Found) \n</code></pre>\n"},{"tags":["node.js","http","express"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13150277,"title":"Express request is called twice","body":"<p>To learn node.js I'm creating a small app that get some rss feeds stored in mongoDB, process them and create a single feed (ordered by date) from these ones.</p>\n\n<p>It parses a list of ~50 rss feeds, with ~1000 blog items, so it's quite long to parse the whole, so I put the following <code>req.connection.setTimeout(60*1000);</code> to get a long enough time out to fetch and parse all the feeds.</p>\n\n<p>Everything runs quite fine, but the request is called twice. (I checked with wireshark, I don't think it's about favicon here).</p>\n\n<p>I really don't get it.</p>\n\n<p>You can test yourself here : <a href=\"http://mighty-springs-9162.herokuapp.com/feed/mde/20\" rel=\"nofollow\">http://mighty-springs-9162.herokuapp.com/feed/mde/20</a> (it should create a rss feed with the last 20 articles about \"mde\").</p>\n\n<p>The code is here: <a href=\"https://github.com/xseignard/rss-unify\" rel=\"nofollow\">https://github.com/xseignard/rss-unify</a></p>\n\n<p>And if we focus on the interesting bits :</p>\n\n<p>I have a route defined like this : <code>app.get('/feed/:name/:size?', topics.getFeed);</code></p>\n\n<p>And the <code>topics.getFeed</code> is like this : </p>\n\n<pre><code>function getFeed(req, res) {\n  // 1 minute timeout to get enough time for the request to be processed\n  req.connection.setTimeout(60*1000);   \n\n  var name = req.params.name;\n  var callback = function(err, topic) {\n  // if the topic has been found\n  if (topic) {\n    // aggregate the corresponding feeds\n    rssAggregator.aggregate(topic, function(err, rssFeed) {\n      if (err) {\n        res.status(500).send({error: 'Error while creating feed'});\n      }\n      else {\n        res.send(rssFeed);\n      }\n    },\n    req);\n  }\n  else {\n    res.status(404).send({error: 'Topic not found'});\n  }};\n  // look for the topic in the db\n  findTopicByName(name, callback);\n}\n</code></pre>\n\n<p>So nothing fancy, but still, this getFeed function is called twice.</p>\n\n<p>What's wrong there? Any idea?</p>\n"},{"tags":["python","node.js","neo4j","read-write","cypher"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13139696,"title":"Neo4j - Cypher read-write-return query","body":"<p>I'm fairly new to neo4j. I've played a little bit with cypher and REST API. I want to be able to create a leaf node along certain path, consider these nodes are some types of events. I wouldn't know during run time the id of the node this event will be attached to. I need to either do a look-up and then get the id of the node and then create my new node. </p>\n\n<p>So during run time I was hoping I can do a MATCH using cypher to get the node to which I can attach the event and CREATE new node along with the relationship to the existing node returned by MATCH. So I came across the cypher cheat sheet which has a read-write-return query which I thought would be good fit. But there is nothing much mentioned about it in documentation or may be I'm not a super googler!! </p>\n\n<p>Could someone please tell me if this(read-write-return) is the right/valid approach? </p>\n\n<p>Many Thanks!</p>\n"},{"tags":["facebook","node.js","authentication","passport"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13149896,"title":"Node.js Passport get Facebook session on Page Load","body":"<p>I've got the passport <code>Facebook Strategy</code> working fine. However, reading <code>facebook</code> documentation I stumble upon this :</p>\n\n<p><strong>FACEBOOK DOCS</strong></p>\n\n<blockquote>\n  <p>A special consideration when using the Query String setting:</p>\n  \n  <p>If you would like to use the server-side authentication flow with App\n  Center it is important to make sure you are passing the redirect_uri\n  parameter correctly when exchanging your code for an access token. You\n  should set your redirect_uri parameter to the click-through URL to\n  your site. In most cases the URL will look something like:</p>\n  \n  <p><a href=\"http://www.example.com/?fb_appcenter=1&amp;fb_source=search&amp;code=CODE_HERE\" rel=\"nofollow\">http://www.example.com/?fb_appcenter=1&amp;fb_source=search&amp;code=CODE_HERE</a>\n  thus you should set your redirect_uri to the same value. Please make\n  sure that this logic is dynamic as the query parameters appended to\n  your click-through URL may be subject to change.</p>\n</blockquote>\n\n<p>On the App Center there is a <code>visit website</code> button that sends users to the app and in the process logs them in.\nHow can I do this with passport? Do I have to add the query string to the <code>callbackURL</code>?\nI'm guessing it's the same problem, but I'd also need something like the <code>FB.getLoginStatus()</code> provided by facebook javascript SDK to link users if they have their facebook open and previously added the app.\nIs all this provided by <code>passport</code> in any way?</p>\n"},{"tags":["node.js","soap","wsdl","coffeescript"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13149390,"title":"Is it me, or this new SOAP API?","body":"<p>I'm not very familiar with SOAP, and have bashed my head against the <a href=\"http://developer.itsmarta.com/BRDWebService/BRDWebService.asmx\" rel=\"nofollow\">new Marta SOAP API</a> in an attempt to get <em>anything</em> from the API besides an empty result set. In case I'm doing something wrong, I figure someone else may spot a glaring problem with my approach?  If this question is invalid in some way, don't hesitate to let me know.</p>\n\n<p>I'm using the <a href=\"https://github.com/milewise/node-soap\" rel=\"nofollow\">node-soap</a> package.  The API's WSDL is <a href=\"http://developer.itsmarta.com/BRDWebService/BRDWebService.asmx?WSDL\" rel=\"nofollow\">here</a>.</p>\n\n<p>My marta API test:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>util = require 'util'\nsandpaper = require 'soap'\n\nmartaApiUrl = 'http://developer.itsmarta.com/BRDWebService/BRDWebService.asmx?WSDL'\nargs = {routeabbr: 126}\n\ncallback = (err, result) -&gt; \n  console.log \":: req: #{util.inspect @client.lastRequest, null, null}\"\n  console.log \":: errors: #{util.inspect err, null, null}\"\n  console.log \":: result: #{util.inspect result, true, null}\"\n\nconsole.log \"|- starting client -|\"\nsandpaper.createClient martaApiUrl, (err,client) -&gt; \n  @client = client\n  console.log \"Here's the service details:\"\n  console.log util.inspect(client.describe(), true, null)\n  if err\n    console.log \": client errs: #{util.inspect err}\"\n  client.GetBRD(args, callback)\n</code></pre>\n\n<p>The results are below.  The mystery here is that the response seems to indicate a successful request, but is always empty ._.</p>\n\n<pre><code>○ → coffee soaptest.coffee \n|- starting client -|\nHere's the service details:\n{ BRDWEBService: \n   { BRDWEBServiceSoap12: \n      { GetBRD: \n         { output: { 'GetBRDResult[]': { '0': 'a', '1': 'n', '2': 'y' } },\n           input: { routeabbr: 's:int' } } },\n     BRDWEBServiceSoap: \n      { GetBRD: \n         { output: { 'GetBRDResult[]': { '0': 'a', '1': 'n', '2': 'y' } },\n           input: { routeabbr: 's:int' } } } } }\n:: req: '&lt;soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"  xmlns:tm=\"http://microsoft.com/wsdl/mime/textMatching/\" xmlns:tns=\"http://tempuri.org/\"&gt;&lt;soap:Header&gt;&lt;/soap:Header&gt;&lt;soap:Body&gt;&lt;tns:GetBRD&gt;&lt;routeabbr&gt;126&lt;/routeabbr&gt;&lt;/tns:GetBRD&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;'\n:: errors: null\n:: result: { GetBRDResult: [ { NewDataSet: {} }, [length]: 1 ] }\n</code></pre>\n"},{"tags":["node.js","mongodb","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13148875,"title":"MongoDB count() undefined","body":"<p>I'm very newbie on Javascript-NodeJS-MongoDB, I try to know the number of documents found by a query.</p>\n\n<pre><code>...\nvar page = req.params.page;  \n\nvar db = require('mongojs').connect('localhost:27017/foo', ['bar']); \n\nvar docs = db.bar.find({x:'MME'}).sort({y:1}).skip(10*(page-1)).limit(10); \n\nvar nbDocs = db.bar.find({x:'MME'}).count(); /*docs.count();*/\n\nconsole.log(nbDocs);\n</code></pre>\n\n<p>But unfortunately the log gives me 'undefined', the same if I code  </p>\n\n<pre><code>var nbDocs = docs.count();\n</code></pre>\n\n<p>Thank's a lot for your precious help.</p>\n\n<p>Gilles.</p>\n"},{"tags":["node.js","events","event-handling","eventemitter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13122923,"title":"Best way using events in node.js","body":"<p>Which is the best approach for listening/launching events in node.js?\nI've been testing event launching and listening in node.js by extending the model with EventEmitter and I'm wondering if it has sense this approach since the events are only listened when there is a instance of the model.\nHow can be achieved that events will be listened while the node app is alive??</p>\n\n<p>Example for extending the model using eventEmitter.</p>\n\n<pre><code>// myModel.js\n\nvar util = require('util');\nvar events2 = require('events').EventEmitter;\nvar MyModel = function() {\n\n        events2.call(this);\n        // Create a event listener\n        this.on('myEvent', function(value) {\n            console.log('hi!');\n        });\n    };\n\nMyModel.prototype.dummyFunction = function(params) {\n// just a dummy function.\n\n}\n\nutil.inherits(MyModel, events2);\nmodule.exports = MyModel;\n</code></pre>\n\n<p>EDIT: A more clear question about this would be: how to keep a permanent process that listens the events during the app execution and it has a global scope (something like a running event manager that listens events produced in the app).\nWould be a solution to require the file myModel.js in app.js?  How this kind of things are solved in node.js?</p>\n"},{"tags":["javascript","node.js","include","requirejs","gruntjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13148902,"title":"How to do static code inclusion in Javascript, using Grunt?","body":"<p>I'm using grunt to compose a script that I have broken in two parts: <code>main.js</code> loads an inline worker, <code>worker.js</code> is the actual code for the inline worker.</p>\n\n<p>And this means I have the following code to load the worker, inside <code>main.js</code>:</p>\n\n<pre><code>function setupWorker (workerCode) {\n    var blobBuilder = new BlobBuilder();\n    blobBuilder.append(workerCode);\n    var blob = blobBuilder.getBlob('text/javascript');\n    var url = URL.createObjectURL(blob);\n    return(url);\n}\n\nvar workerURL = setupWorker('worker code, contents of worker.js');\nvar worker = new Worker(workerURL);\n</code></pre>\n\n<p>Now the question is, using Grunt, how can I substitute <code>'worker code, contents of worker.js'</code> in the example, with the actual contents of <code>worker.js</code> ?</p>\n\n<p>Am I doing this right with static code inclusion ? Should I use one of the modules for require.js ?</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13146127,"title":"Node.js + Express passing an object","body":"<p>I'm building a small node.js/express project and have a function in configure.js that sets configuration options in my express app. For example:</p>\n\n<p>server.js </p>\n\n<pre><code>var express = require('express');\nvar server = ('./configure');\n\nvar app = express();\nserver.configure(app);\n</code></pre>\n\n<p>configure.js</p>\n\n<pre><code>exports.configure = function(app) {\n  app.set('title', 'Server');\n};\n</code></pre>\n\n<p>This doesn't work but I hope it explains what I'm trying to do. I want to make changes to the app instance in server.js. How do I do this?</p>\n\n<p>EDIT:</p>\n\n<p>Okay I think i can get this all working if i understand why this isn't working. Is it to do with timing of the callback? The second console.log() isn't called.</p>\n\n<p>configure.js</p>\n\n<pre><code>var fs = require('fs');\n\nvar StringDecoder = require('string_decoder').StringDecoder;\nvar decoder = new StringDecoder('utf8');\n\n\nfunction configure(app) {\n\n  var config = module.exports = {};\n\n    fs.readFile('config.txt', function (err, data) {\n      if (err) throw err;\n\n      config.title = decoder.write(data)\n      console.log(config.title)\n\n    });\n\n    if(config.title) console.log(config.title);\n    //app.set('title', config.title)\n}\n\nmodule.exports = function (app) {\n  configure(app);\n};\n</code></pre>\n\n<p>server.js</p>\n\n<pre><code>var express = require('express');\nvar cfg = require('./configure');\nvar fs = require('fs');\n\nvar app = express()\n\ncfg(app)\n</code></pre>\n\n<p>(config.txt is echo 'server' > config.txt)</p>\n"},{"tags":["node.js","memory","heap"],"answer_count":1,"favorite_count":7,"up_vote_count":11,"down_vote_count":1,"view_count":597,"score":10,"question_id":13126808,"title":"What's the node.js memory breakdown?","body":"<p>We are deploying a Node.js application. This app seems to be consuming way more RSS memory than it should. So we started to dive into things and we found the following, thanks to  <code>process.memoryUsage();</code></p>\n\n<ul>\n<li><p>The RSS memory grows quickly to about 400MB and stays more or less stable in a 400MB-500MB, with small ups and small downs (Garbage collector running?)</p></li>\n<li><p>The heapUsed quickly grows to 50MB and then stays at that level (between 20MB and 100MB).</p></li>\n<li><p>The heaptotal is always about 30MB more MB than the heapUsed.</p></li>\n</ul>\n\n<p>As you see there is a huge difference between the heap and the RSS, which is where I think we should focus. There doesn't seem to be any very significant leak in our heap.</p>\n\n<p>Now, what's in RSS that is not in the heap? I believe C extensions, and Buffers, right? If so, how can we debug that. What else should we look for?</p>\n"},{"tags":["node.js","spider"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":275,"score":1,"question_id":8822020,"title":"detect response body encoding with nodejs","body":"<p>I am writing a spider with jsdom and jquery like <a href=\"https://github.com/tmpvar/jsdom/blob/master/README.md\" rel=\"nofollow\">the example</a></p>\n\n<p>but just one problem: when the web page is not UTF-8 encoded and response header's content-type does not tell me the charset, how to detect the encoding of the response body?</p>\n\n<p>I know node-iconv can help, but the problem is i need to know the encoding first</p>\n\n<p>btw. how does web browsers auto detect the encoding of a web page?</p>\n\n<p>thanks</p>\n"},{"tags":["osx","node.js","homebrew"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12980166,"title":"Brew - node did not build","body":"<p>Homebrew 0.9.3\nOSX 10.8.2</p>\n\n<p>I'm wondering if you have seen anything like this?</p>\n\n<pre><code>==&gt; make install\nbrew: superenv removed: -O3 -gdwarf-2 -arch x86_64 -Wall -Wendif-labels -W -Wno-unused-parameter\n20 errors generated.\nmake[1]: *** [/private/tmp/node-tiuh/node-v0.8.12/out/Release/obj.target/uv/deps/uv/src/unix/darwin.o] Error 1\nmake[1]: *** Waiting for unfinished jobs....\nmake: *** [node] Error 2\n\nError: node did not build\nLogs: /Users/justin/Library/Logs/Homebrew/node/\nHelp: https://github.com/mxcl/homebrew/wiki/troubleshooting\n      https://github.com/mxcl/homebrew/issues/13282\n</code></pre>\n"},{"tags":["javascript","node.js","express","cors"],"answer_count":4,"favorite_count":8,"up_vote_count":7,"down_vote_count":0,"view_count":4518,"score":7,"question_id":7067966,"title":"How to allow CORS in Express/NodeJS?","body":"<p>I am trying to support CORS in my NodeJS application that uses the Express JS web framework. I have read <a href=\"http://groups.google.com/group/express-js/browse_thread/thread/71db58df2c74d06a\">a Google group discussion</a> about how to handle this, and read a few articles about how CORS works. First, I did this (code is written in CoffeeScript syntax):</p>\n\n<pre><code>app.options \"*\", (req, res) -&gt;\n  res.header 'Access-Control-Allow-Origin', '*'\n  res.header 'Access-Control-Allow-Credentials', true\n  # try: 'POST, GET, PUT, DELETE, OPTIONS'\n  res.header 'Access-Control-Allow-Methods', 'GET, OPTIONS'\n  # try: 'X-Requested-With, X-HTTP-Method-Override, Content-Type, Accept'\n  res.header 'Access-Control-Allow-Headers', 'Content-Type'\n  # ...\n</code></pre>\n\n<p>It doesn't seem to work. It seems like my browser (Chrome) is not sending the initial OPTIONS request. When I just updated the block for the resource I need to submit a cross-origin GET request to:</p>\n\n<pre><code>app.get \"/somethingelse\", (req, res) -&gt;\n  # ...\n  res.header 'Access-Control-Allow-Origin', '*'\n  res.header 'Access-Control-Allow-Credentials', true\n  res.header 'Access-Control-Allow-Methods', 'POST, GET, PUT, DELETE, OPTIONS'\n  res.header 'Access-Control-Allow-Headers', 'Content-Type'\n  # ...\n</code></pre>\n\n<p>It works (in Chrome). This also works in Safari.</p>\n\n<p>I have read that...</p>\n\n<blockquote>\n  <p>In a browser implementing CORS, each cross-origin GET or POST request is preceded by an OPTIONS request that checks whether the GET or POST is OK.</p>\n</blockquote>\n\n<p>So my main question is, how come this doesn't seem to happen in my case? Why isn't my app.options block called? Why do I need to set the headers in my main app.get block?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13147693,"title":"How to extract request http headers from a request using NodeJS connect","body":"<p>I'd like to get the \"Host\" header of a request made using Node JS's connect library bundle. My code looks like: </p>\n\n<pre><code>var app = connect()\n  .use(connect.logger('dev'))\n  .use(connect.static('public'))\n  .use(function(req, res){\n\n    var host = req.???\n\n  })\n .listen(3000);\n</code></pre>\n\n<p>The documentation for connect is here but I don't see anything detailing the API of the <code>req</code> object in the above code. <a href=\"http://www.senchalabs.org/connect/\" rel=\"nofollow\">http://www.senchalabs.org/connect/</a></p>\n\n<p><strong>Edit</strong>: Note a successful answer must point to the documentation (I need this to verify which version provided the API I'm looking for).</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13147140,"title":"Get the complete path, including the pound sign (#) in Node.js","body":"<p>I am working on a server based on Node.js, using Express. </p>\n\n<p>Use case:\nA user should be able to retreive his personal content from the server by making an HTTP GET with the following URL: <code>http://192.168.1.88:3000/content/[userID]</code></p>\n\n<p>I have defined a route like this:</p>\n\n<pre><code>app.get('/content/:userID', content.MyHandler);\n</code></pre>\n\n<p>In \"MyHandler\" I am able to read the <strong>userID</strong> and return the appropriate data to the user.</p>\n\n<p>The problem is that when \"<strong>userID</strong>\" contains a pound sign (#), I only get what is before the # in MyHandler, an consequently I am unable to find who is the user. </p>\n\n<p>So if the <strong>userID</strong> is \"123456\", everything is fine. But if the <strong>userID</strong> is \"1234#567\", I get only \"1234\" in MyHandler.</p>\n\n<p>MyHandler looks like this:</p>\n\n<pre><code>exports.MyHandler = function(req, res){\n  ...\n  var pathChunk = req.url.split(\"/\");\n  // sys.puts(\"--&gt; Path in chunks: \" + sys.inspect(pathChunk));\n  // Nothing after # sign\n  var userID = pathChunk[2];  // Will be incomplete if contains #\n};\n</code></pre>\n\n<p>Is there a way to retreive the full <strong>userID</strong> value in MyHandler, regardless of the pound (#) sign?</p>\n"},{"tags":["javascript","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13146936,"title":"Needed help in grabbing an HTTPS request made by the user from the browser window using Node.js","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13128681/need-help-in-setting-up-an-https-proxy-using-node-js-which-picks-up-all-the-htt\">Need help in setting up an HTTPS proxy using node.js, which picks up all the HTTPS requests from the browser window</a>  </p>\n</blockquote>\n\n\n\n<p>I wanted to grab the HTTPS requests made by a user from the browser window. I have written the code for grabbing an HTTP request </p>\n\n<pre><code>http.createServer(function(request, response) {\n    handleRequest(request, response);\n}).listen(8003);\n</code></pre>\n\n<p>I have added a proxy on my mac machine for grabbing all the HTTP requests, so whatever HTTP url the user puts in the browser window, my node server picks them up and this works like a charm. For HTTPS </p>\n\n<pre><code>https.createServer(options.https,function(request, response) {\n    handleRequest(request, response);\n}).listen(8004);\n</code></pre>\n\n<p>Thats the code, options.https are the privatekey and the certificate of the HTTPS node server. I added the proxy setting in the preferences for HTTPS. But it did not work. Any suggestions as to where I am going wrong? My best guess is there is an issue with the certificates. The way I am modifying the proxy setting in the Mac are, I get the ip addr from the terminal and put it in the proxy and 8004 as the port number. Thanks, in advance.</p>\n"},{"tags":["node.js","redis"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":350,"score":0,"question_id":10208237,"title":"node.js redis async query","body":"<p>Hope someone can assist with a (simple) async question on node-redis. I'm trying to load a set from a hash in the redis db and then use that populated set further on. Here's the code snippet :-</p>\n\n<pre><code>var redis_client = redis.createClient(REDIS_PORT, REDIS_URL); \n\nredis_client.hgetall(target_hash,function(e,o){\n\n    Object.keys(o).forEach(function(target){\n\n        // get the \"name\" from the hash         \n        redis_client.hget(o[target],\"name\",function(e,o){\n        if (e){\n                 console.log(\"Error occurred getting key: \" + e);\n              }\n        else {\n                 redis_client.sadd(\"newset\",o);\n             }\n    });\n\n});\n\n// the following line prints nothing - why ?? \n\nredis_client.smembers(\"newset\",redis.print);\n</code></pre>\n\n<p>When I examine the contents of \"newset\" in redis it is populated as expected, but at runtime it displayed as empty. I'm sure it's an async issue - any help much appreciated !</p>\n"},{"tags":["mongodb","node.js","crud","underscore.js"],"answer_count":3,"favorite_count":6,"up_vote_count":25,"down_vote_count":1,"view_count":2370,"score":24,"question_id":4291130,"title":"Is there a CRUD generator for Mongoose and Node.js and Underscore? Or a CRUD generator for a similar stack?","body":"<p>Is there a CRUD generator for Mongoose and Node.js and Underscore?  Or a CRUD generator for a similar stack?</p>\n\n<p>I want to generate something like this:</p>\n\n<p><a href=\"http://www.ivarvong.com/2010/08/node-js-connect-mongoose-and-underscore/\" rel=\"nofollow\">http://www.ivarvong.com/2010/08/node-js-connect-mongoose-and-underscore/</a></p>\n\n<p>But I want to generate the html template and other client-side code, and either have generic/monolithic save/query/reads or generate individualized ones for the Node.js code and the client side (jQuery or whatever), all of that based on the model.</p>\n\n<p>So something like using Underscore to fill in a few templates based on some Monogoose (MongoDB) models.  Based on the model you get an HTML form someone can fill in, some client and server-side code to save data in that model to MongoDB, and some code to display the data for that model in a list or table.</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13133071,"title":"Express next function, what is it really for?","body":"<p>Have been trying to find a good description of what the next() method does. In the Express documentation it says that next('route') can be used to jump to that route and skip all routes in between, but sometimes next is called without arguments. Anybody knows of a good tutorial etc that describes the next function?</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":30,"score":-2,"question_id":13145516,"title":"How can i reinstall my node?","body":"<p>Yesterday, i try to uninstall node.js from my ubuntu. But i can uninstall only npm from my computer, surely. Now i want to uninstall node.js from my ubuntu(12.04) and install again. Firstly, please let me know about uninstalling node.js after I'll install it again.</p>\n\n<p>I'm waiting..</p>\n"},{"tags":["javascript","node.js","meteor","stubs"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":171,"score":5,"question_id":12231712,"title":"When to use Meteor.methods and utilizing stubs","body":"<p>Using Meteor, I'm attempting to understand when to use server-side <code>Meteor.methods()</code> while still retaining instant UI updates. </p>\n\n<p>From Andrew Scala's <a href=\"http://andrewscala.com/meteor/\" rel=\"nofollow\">introductory tutorial</a>, he claims that <code>Meteor.methods()</code> should be used when you want to update and modify your database documents: </p>\n\n<blockquote>\n  <p>The idea is that you define all the functions on the server that do\n  dangerous stuff like modify and update data, and then let the client\n  call those functions and get return values like regular functions. The\n  client never sees the implementation and doesn’t personally modify the\n  data. The server does all the work.</p>\n</blockquote>\n\n<p>And following this advice, I implemented this in my code: </p>\n\n<p>Server-side: </p>\n\n<pre><code>Meteor.methods({\n\n  addMovie: function(data) {\n    var movie = Movies.insert({name: data});\n    return movie;\n  },\n\n  ...\n</code></pre>\n\n<p>Client-side: </p>\n\n<pre><code>Template.movies.events = ({\n\n  'click #add-movie': function(e) {\n\n    var name = document.getElementById('movie-name').value;\n    Meteor.call('addMovie', name);\n\n    return false;\n\n  }, \n\n  ...\n</code></pre>\n\n<p>This works, but it's slow. The UI doesn't update instantly like it would if you called <code>Movies.insert()</code> on the client-side. The <a href=\"http://docs.meteor.com/#meteor_methods\" rel=\"nofollow\">docs</a> indicate that, to rectify the problem, you can create stubs on the client-side: </p>\n\n<blockquote>\n  <p>Calling methods on the client defines stub functions associated with\n  server methods of the same name. You don't have to define a stub for\n  your method if you don't want to. In that case, method calls are just\n  like remote procedure calls in other systems, and you'll have to wait\n  for the results from the server.</p>\n</blockquote>\n\n<p>But what should these stubs look like? Should it basically look the same as the server-side method? If so, what's the point? I'm looking for a more comprehensive explanation of the use and purpose of <code>Meteor.methods()</code>, the point/use of stubs, and their implementation. </p>\n\n<p><strong>EDIT:\nDavid Greenspan has helped clarify the use of Meteor.methods() and stubs on <a href=\"https://groups.google.com/forum/#!topic/meteor-talk/BB-AfAYY52g\" rel=\"nofollow\">meteor-talk</a>.</strong> </p>\n"},{"tags":["node.js","forever"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13144823,"title":"Error Installing Forever Module NodeJs","body":"<p>I'm trying to install nodejs module forever as root but I get this error:</p>\n\n<blockquote>\n  <p>npm ERR! error installing colors@0.6.0-1\n      npm ERR! error installing broadway@0.1.15\n      npm ERR! error rolling back broadway@0.1.15 Error: UNKNOWN, unknown error\n  '/usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___optimist.npm/package'\n      npm ERR! error installing forever@0.9.2</p>\n\n<pre><code>npm ERR! Error: ENOENT, no such file or directory '/usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___cliff.npm/package/README.md'\nnpm ERR! You may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\nnpm ERR! \nnpm ERR! System Linux 2.6.32-220.23.1.el6.x86_64\nnpm ERR! command \"node\" \"/usr/local/bin/npm\" \"install\" \"-g\" \"forever\"\nnpm ERR! cwd /var/www/weduser/data\nnpm ERR! node -v v0.6.8\nnpm ERR! npm -v 1.1.0-2\nnpm ERR! path /usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___cliff.npm/package/README.md\nnpm ERR! fstream_path /usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___cliff.npm/package/README.md\nnpm ERR! fstream_type File\nnpm ERR! fstream_class FileWriter\nnpm ERR! code ENOENT\nnpm ERR! message ENOENT, no such file or directory '/usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___cliff.npm/package/README.md'\nnpm ERR! errno {}\nnpm ERR! fstream_stack Object.oncomplete (/usr/local/lib/node_modules/npm/node_modules/fstream/lib/writer.js:204:26)\n[2/2] cxx_link: build/Release/src/createpair_1.o -&gt; build/Release/createpair.node\n\nnpm ERR! Error: ENOENT, no such file or directory '/usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___eventemitter2.npm/package/README.md'\nnpm ERR! You may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\nnpm ERR! \nnpm ERR! System Linux 2.6.32-220.23.1.el6.x86_64\nnpm ERR! command \"node\" \"/usr/local/bin/npm\" \"install\" \"-g\" \"forever\"\nnpm ERR! cwd /var/www/weduser/data\nnpm ERR! node -v v0.6.8\nnpm ERR! npm -v 1.1.0-2\nnpm ERR! path /usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___eventemitter2.npm/package/README.md\nnpm ERR! fstream_path /usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___eventemitter2.npm/package/README.md\nnpm ERR! fstream_type File\nnpm ERR! fstream_class FileWriter\nnpm ERR! code ENOENT\nnpm ERR! message ENOENT, no such file or directory '/usr/local/lib/node_modules/forever/node_modules/broadway/node_modules/___eventemitter2.npm/package/README.md'\nnpm ERR! errno {}\nnpm ERR! fstream_stack Object.oncomplete (/usr/local/lib/node_modules/npm/node_modules/fstream/lib/writer.js:204:26)\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /var/www/weduser/data/npm-debug.log\nnpm not ok\nWaf: Leaving directory `/usr/local/lib/node_modules/forever/node_modules/node-fork/build'\n</code></pre>\n</blockquote>\n\n<p>I don´t know how to solve this error, I try to upgrade nodejs by nvm and I get another error\nThanks</p>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13143945,"title":"Dynamic Namespaces Socket.IO","body":"<p>How can i use dynamic namespaces in socket.io\nLooking in the (poor) documentation it says that namespaces must be used by\n<a href=\"http://socket.io/#how-to-use\" rel=\"nofollow\">http://socket.io/#how-to-use</a></p>\n\n<p><code>io.of('/news')</code></p>\n\n<p><code>io.of('/akfda')</code></p>\n\n<p>To use a namespace y do <code>io.of(\"/namespace\")</code>.</p>\n\n<p>Do i need to register every single namespace in the server? maybe i want a namespace for dynamic content.</p>\n\n<p>How can i do something like </p>\n\n<p><code>io.of('/:somethign/:id')</code></p>\n"},{"tags":["mysql","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13140384,"title":"Node.js + libmysql-client + pingSync + setInvterval = headache(true);","body":"<p>I've experienced a behaviour that makes me nuts and I can't solve it.</p>\n\n<p>I have a script that opens a few mysql connections and stores them in an array. In order to prevent MySQL from closing unused connections (the process is supposed to be running 24/7) I use setInterval to fire pingSync() frequently.\nThis approach has worked for me for many months in another project, but on a new host with node 0.8.14 the behaviour is weird.</p>\n\n<pre><code>setInterval(function () {\nvar count = 0;\nconsole.log('---------------------------------------------------------');\nconsole.log('Length: ');\nconsole.log(connections.length);\nconnections.forEach(function(connection){\n    var res = connection.pingSync();\n    console.log('PING mysql '+count+ ' / '+(new Date().getTime()));\n    console.log(res);\n    count++;\n});\nconsole.log('---------------------------------------------------------');\n}, 50000);\n</code></pre>\n\n<p>Expected result:</p>\n\n<pre><code>---------------------------------------------------------\nLength:\n4\nPING mysql 0 / 1351603868929\ntrue\nPING mysql 1 / 1351603868929\ntrue\nPING mysql 2 / 1351603868929\ntrue\nPING mysql 3 / 1351603868929\ntrue\n---------------------------------------------------------\n</code></pre>\n\n<p>The results I got:</p>\n\n<p><strong>#1</strong></p>\n\n<pre><code>---------------------------------------------------------\nLength:\n4\nPING mysql 0 / 1351603868929\ntrue\n4\nPING mysql 0 / 1351603868929\ntrue\nPING mysql 1 / 1351603868929\ntrue\nPING mysql 2 / 1351603868929\ntrue\nPING mysql 3 / 1351603868929\ntrue\n---------------------------------------------------------\n</code></pre>\n\n<p><strong>#2</strong></p>\n\n<pre><code>---------------------------------------------------------\nLength:\n4\nPING mysql 0 / 1351604113400\n4\nPING mysql 0 / 1351604113400\nPING mysql 1 / 1351604113400\nPING mysql 2 / 1351604113400\nPING mysql 3 / 1351604113400\n---------------------------------------------------------\nPING mysql 2 / 1351604113400\nPING mysql 3 / 1351604113400\n---------------------------------------------------------\n---------------------------------------------------------\n</code></pre>\n\n<p>It looks like my function - or, parts of my function - get executed twice in random order. </p>\n\n<p>Does anyone have an idea what could cause this behaviour? Or any advice how to track down the cause for this mess?\nSometimes I get the expected result quoted above... but most of the times I get the mixed results.</p>\n\n<p>EDIT: The setInterval() functions is only invoked once! (I've checked that dozens of times)</p>\n"},{"tags":["node.js","mongodb","express","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13143790,"title":"Sending huge amount of data from mongodb to rest api with node.js","body":"<p>I want to send huge amount of data from MongoDB with Mongoose to a restful api via POST.\nCurrently I have about 2 million+ entries in the MongoDB that needs to be shipped.</p>\n\n<p>I can easily stream the result from MongoDB with,</p>\n\n<pre><code>var stream = Rawdata.find().stream();\n\nstream.on('data', function (doc) {\n    console.log(doc);\n}).on('error', function (err) {\n    // handle the error\n}).on('close', function () {\n    // the stream is closed\n});\n</code></pre>\n\n<p>My question is, how can I send the stream via POST to oversea rest api (also mongodb, nodejs and express) in just the right chunk size? (json size limit?)</p>\n\n<p>And how should my receiver in the oversea rest api look like?</p>\n\n<pre><code>app.post('/api/rawdata', function (req, res){\n\n    // How can I receive and handle huge incoming json stream?\n\n    return res.send({status: 'ok'});\n});\n</code></pre>\n"},{"tags":["linux","node.js","mongodb","amazon-ec2"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13123818,"title":"mongodb EBS on EC2","body":"<p>I use mongodb and nodejs on ec2,I would like to deploy it in order to support 10,000 request a day.\nI would like to make sure that if the instance terminates or reboots(?) somehow the database won't be lost.\nI understand that i need to create an EBS volumes for storing the data.</p>\n\n<p>I tried <a href=\"http://www.mongodb.org/display/DOCS/Amazon+EC2+Quickstart#AmazonEC2Quickstart-ConfigureStorage\" rel=\"nofollow\">http://www.mongodb.org/display/DOCS/Amazon+EC2+Quickstart#AmazonEC2Quickstart-ConfigureStorage</a> but it didn't work. I get to the point where i should run \n[ec2-user@domU-... ~]$ sudo chown mongod:mongod /data\nbut I get :\nchown: invalid user: `mongod:mongod'</p>\n\n<p>solved it by : sudo chown mongod.mongod /data\nstill can't run mongod working : </p>\n\n<pre><code>$sudo /etc/init.d/mongod start\nStarting mongod: forked process: 1694\nall output going to: /log/mongod.log\n                                                           [FAILED][ec2-user@domU-... /]$ sudo mongod --dbpath=/data\nMon Oct 29 21:46:56 [initandlisten] MongoDB starting : pid=1675 port=27017 dbpath=/data 64-bit host=domU-...\nMon Oct 29 21:46:56 [initandlisten] db version v2.2.0, pdfile version 4.5\nMon Oct 29 21:46:56 [initandlisten] git version: f5e83eae9cfbec7fb7a071321928f00d1b0c5207\nMon Oct 29 21:46:56 [initandlisten] build info: Linux ... c8xen #1 SMP Fri Nov 20 17:48:28 EST 2009 x86_64 BOOST_LIB_VERSION=1_49\nMon Oct 29 21:46:56 [initandlisten] options: { dbpath: \"/data\" }\nMon Oct 29 21:47:00 [initandlisten] journal dir=/data/journal\nMon Oct 29 21:47:00 [initandlisten] recover : no journal files present, no recovery needed\nMon Oct 29 21:47:00 [initandlisten] \nMon Oct 29 21:47:00 [initandlisten] ERROR: Insufficient free space for journal files\nMon Oct 29 21:47:00 [initandlisten] Please make at least 3379MB available in /data/journal or use --smallfiles\nMon Oct 29 21:47:00 [initandlisten] \nMon Oct 29 21:47:00 [initandlisten] exception in initAndListen: 15926 Insufficient free space for journals, terminating\nMon Oct 29 21:47:00 dbexit: \nMon Oct 29 21:47:00 [initandlisten] shutdown: going to close listening sockets...\nMon Oct 29 21:47:00 [initandlisten] shutdown: going to flush diaglog...\nMon Oct 29 21:47:00 [initandlisten] shutdown: going to close sockets...\nMon Oct 29 21:47:00 [initandlisten] shutdown: waiting for fs preallocator...\nMon Oct 29 21:47:00 [initandlisten] shutdown: lock for final commit...\nMon Oct 29 21:47:00 [initandlisten] shutdown: final commit...\nMon Oct 29 21:47:00 [initandlisten] shutdown: closing all files...\nMon Oct 29 21:47:00 [initandlisten] closeAllFiles() finished\nMon Oct 29 21:47:00 [initandlisten] journalCleanup...\nMon Oct 29 21:47:00 [initandlisten] removeJournalFiles\nMon Oct 29 21:47:00 [initandlisten] shutdown: removing fs lock...\nMon Oct 29 21:47:00 dbexit: really exiting now\n</code></pre>\n\n<p>I DON'T UNDERSTAND A WORD IN THE GUIDE... is it only me...? Is there a more simple to understand guide for achieving  this goal?\nThank you!</p>\n"},{"tags":["javascript","eclipse","node.js","profiling","dtrace"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":38,"score":3,"question_id":13143422,"title":"Profiling Node.JS (code) execution time in Linux","body":"<p>I am looking for a method to do precise <code>Node.JS</code> <strong>profiling</strong> of script execution times on Linux.</p>\n\n<p>There are interesting projects like the <a href=\"http://nodetime.com/\" rel=\"nofollow\">NodeTime.com Performance Profiler</a>, but this profiles the timing of I/O httprequests and such, not <strong>execution time of lines of code</strong>.</p>\n\n<p>I am looking for a way to figure out exactly where I can optimize my Javascript, <strong>where most of the time is spent</strong>, etc.</p>\n\n<hr>\n\n<p>One interesting method I've seen is trying to <a href=\"http://dtrace.org/blogs/brendan/2011/12/16/flame-graphs/\" rel=\"nofollow\">create a FlameGraph using DTrace</a> to profile Node.JS.</p>\n\n<p>However, <code>dtrace</code> is very Solaris-specific.</p>\n\n<ul>\n<li>For Linux (Debian/Ubuntu), <code>dtrace</code> can be found in the <code>sytemtap-sdt-dev</code> package. However, <code>stap dtrace</code> is not the same, and lacks all relevant hooks/probes.</li>\n<li>Paul Fox made a port from the Unix version. It's more feature complete but somehow the hooks/probes don't work in userspace as the Solaris one, and also cannot be used to profile node.<br>\n<a href=\"ftp://crisp.dyndns-server.com/pub/release/website/dtrace/\" rel=\"nofollow\">ftp://crisp.dyndns-server.com/pub/release/website/dtrace/</a> (It's pretty easy to build, see README.)</li>\n<li>There's also an <code>Oracle</code> port, but noone <a href=\"http://dtrace.org/blogs/ahl/2011/10/10/oel-this-is-not-dtrace/\" rel=\"nofollow\">would recommend</a> it. Apparently, it only has about 0,1 percent of the probes the Paul Fox port. (Which is ironic, because <code>Oracle</code> was formerly <code>Sun</code>, original authors of <code>dtrace</code> for <code>Solaris</code>)</li>\n</ul>\n\n<hr>\n\n<p><strong>How, in Linux, using the terminal or using Eclipse, can I profile the code of my Node.JS scripts?</strong> I'm looking for something specific like the Zend Profiler shows execution times of each command in code of PHP scripts.</p>\n"},{"tags":["php","node.js","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":24,"score":-2,"question_id":13143252,"title":"How to use nodejs+socket.io on php-engine","body":"<p>I don't understand how to use nodejs+socket.io for my php engine.</p>\n\n<ol>\n<li>I have php-engine.</li>\n<li>I have server with installed nodejs+socket.io</li>\n<li>I'll don't know, how to send event (json - pref. etc.) from php-script's on socket.io the server, with privacy policy.</li>\n</ol>\n\n<p>Or, how to use this ? if this is not php - so how i take userid/username/images?</p>\n\n<p>All scripts what i see in the internet - without security and anyone can use not his username or userid (just change js), and nobody don't said, how to protect this.</p>\n\n<p>Maybe u can help me and say how do this - with example code :)</p>\n"},{"tags":["forms","class","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":13,"score":3,"question_id":13136366,"title":"nodejs forms module: how to add class to a field","body":"<p>I am trying to use forms module <a href=\"https://github.com/caolan/forms\" rel=\"nofollow\">https://github.com/caolan/forms</a> . I could easily get the forms created without any issues. But I am just wondering how do you add a new class name to the existing field. The documentation talks about the overriding the id. But I could not find a way to add a new class to the tag.</p>\n\n<p>tried the following..but it wont work!</p>\n\n<pre><code>  username: fields.string({\n    required: true,\n    label: 'So What',\n    classes: ['classtest']\n    }),\n</code></pre>\n\n<p>There is a attribute called widget (which in turn has attribute 'classes') for field. But could not get it working either. This is what I tried. Which also failed.</p>\n\n<pre><code>username: fields.string({\nrequired: true,\nlabel: 'So What',\nwidget: {\n  classes: 'testclass'\n}\n}),\n</code></pre>\n\n<p>Any help in this regard would help. Ultimately i am trying to style the forms with bootstrap</p>\n"},{"tags":["node.js","ssl","proxy","nginx","websocket"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":54,"score":3,"question_id":13142528,"title":"Reverse proxy websockets (SSL), traffic through Stunnel to many node.js apps","body":"<p>I'm looking for some ideas...</p>\n\n<p>I have a series of robust <code>node.js</code> apps that need to be delivered to specific users (post authentication), virtually no file serving, only the initial delivery of the index. The rest of the communication is all done via socket.io.</p>\n\n<ul>\n<li>ClientA (login) needs to be connected to an application on lets say :90001 </li>\n<li>ClientB (login) on :90002 </li>\n<li>ClientC (login) on :90003 </li>\n</ul>\n\n<p>*All HTTP/1.1 ws need to be secure</p>\n\n<p>I have tried a few configurations:</p>\n\n<ul>\n<li>stunnel/varnish/nginx</li>\n<li>stunnel/haproxy</li>\n<li>stunnel/nginx</li>\n</ul>\n\n<p>I was thinking a good approach would be to somehow use redis to store sessions and validate against a cookie, however that would most likely be done by (using node) exposing node.js on the frontend.</p>\n\n<p>questions:</p>\n\n<p>What are the risks in using <code>node-http-proxy</code> as the front piece?</p>\n\n<p>Is this something that i should deem possible (to have one piece that \"securely\" redirects ws traffic and manages specific sessions to many independent/exclusive backends).</p>\n\n<p>I am aware that nginx 1.3 (in dev) is to support ws, is this worth holding out for?</p>\n\n<p>Has anyone had any thorough experience with yao's <code>tcp_proxy</code> module for nginx (reliability / scalability)?</p>\n"},{"tags":["node.js","file-upload","socket.io"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13143098,"title":"File uploader with nodejs - Too slow","body":"<p>Ive built a file uploader with node,js and socket.io, since the browsers have upload limitations with forms.</p>\n\n<p>This is the <a href=\"http://pastebin.com/arzF1TgG\" rel=\"nofollow\">server</a> and this is the <a href=\"http://pastebin.com/16stYKMQ\" rel=\"nofollow\">client</a>.</p>\n\n<p>It works great, but it's really slow. To upload 2GB it takes more than 10 minutes to send 2.2GB from a computer to another in the same intranet. I've tried sending 1GB files with HTML forms and it takes substancially less time.</p>\n\n<p>Could someone tell me if they see a bottle neck in my code? Thanks</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13085824,"title":"Sort in MongooseJS 3.3.1 in ascending and descending order","body":"<p>I have REST based API in NodeJS and MongooseJS ODM. To <strong>GET</strong> the list of <em>departments</em> URL is <strong><em>http://localhost:25718/Department?SortBy=Name&amp;SortType=asc</em></strong>(desc-for descending). And sorting code is</p>\n\n<pre><code> var Query = Department.find();\n if(req.query.SortBy) {\n        Query.sort(req.query.SortBy, 1);\n        if(req.query.SortType) {\n            if(req.query.SortType.toLowerCase() == 'desc') {\n                Query.sort(req.query.SortBy, -1);\n            }\n        }\n    }\n</code></pre>\n\n<p>This dose not works with MongooseJS 3.3.1 . <strong>Query.sort(req.query.SortBy)</strong> gives sorted in ascending order.But not getting descending in any way.\nPlease give a solution.</p>\n"},{"tags":["java","node.js","websocket"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13141574,"title":"Issues with manipulating an array obtained from server with web sockets","body":"<p>I have some issues in manipulating an array obtained in the callback function in through websockets</p>\n\n<p>Server side code</p>\n\n<pre><code>var io = require('socket.io').listen(app);\n\nio.sockets.on('connection', function (socket) {\n    var currentTime = new Date().getTime();\n    var startTime = currentTime - (5*60*1000);\n    step = 30*1000;\n    var stats = [];\n    stats[\"values\"] = [1, 2, 3, 4, 3, 4, 5, 8, 2, 3, 4, 1];\n    stats[\"start\"] = startTime;\n    stats[\"end\"] = currentTime;\n\n    socket.emit('initial', { stats: stats }); \n    socket.on('echo', function (data) {\n\n    }); \n});\n</code></pre>\n\n<p>Client side code</p>\n\n<pre><code>var data;\n\nsocket.on('initial', function (stats) {\n  data = stats.stats;\n});\n</code></pre>\n\n<p>Now when I try to manipulate the data variable.Like using push and shift</p>\n\n<pre><code>data.values.push(10);\ndata.values.shift();\n</code></pre>\n\n<p>I was expecting it to have </p>\n\n<p>2, 3, 4, 3, 4, 5, 8, 2, 3, 4, 1, 10</p>\n\n<p>But I don't know shift operation completely removes all the elements and I get only 10 remaining in the array. What's going wrong?</p>\n"},{"tags":["javascript","node.js","node-dirty"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13139365,"title":"Formatting values fetched from dirty datastore","body":"<p>Is it possible to format data which is fetched from dirty? For example, 83647 to be formatted as 83,647. I have the following code for unformatted data:</p>\n\n<pre><code>db.on('load', function() {\n  db.set('john', {completed: '83647'});\n  console.log('John's completed tasks are: %s', db.get('john').completed);\n});\n</code></pre>\n"},{"tags":["javascript","node.js","coffeescript","towerjs","coffeekup"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12773634,"title":"TowerJS without CoffeeScript?","body":"<p>I'm just looking at the possibilities in Node.js web development. I'm used to coding in ASP.NET MVC 3, so TowerJS and Geddy looks friendly and familiar to me (because of the MVC pattern)</p>\n\n<p>However I don't really like CoffeeScript (because of its strange syntax and the debugging issues), so I would be happy if I could use Tower without using CoffeeScript - and if I could use simple JavaScript instead. Is it possible? If I go to their website, I see CoffeeScripts everywhere...</p>\n\n<p>(I would be happy, if I also could use another templating engine (because CoffeeKup uses CoffeeScript as well), and I change it into a more <a href=\"https://github.com/cstivers78/bliss/wiki\" rel=\"nofollow\">Razor-like engine</a>.)</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1906,"score":5,"question_id":6317054,"title":"Where is Express.js' API?","body":"<p>have known node.js and express several days ago. I feel they are really cool, however, lacking of something.</p>\n\n<p>I looked the official site, but it just point to Connect's API.\nBut I can't find a document which teach me how to use a simple function such as expressHTTPServer.get().</p>\n\n<p>Of course I read the nodejs's API, but the Express and Connect seems to extend them very much.</p>\n\n<p>For example, in Express official site:</p>\n\n<pre><code>app = express.createServer();\napp.get('/user/:id', function(req, res, next){\n   loadUser(req.params.id, function(err, user){\n     if (err)\n       return next(err);\n    res.send('Viewing user of csser.com ' + user.name);  }\n   );\n});\n</code></pre>\n\n<p>But sadly, no API document talk me there is expressHTTPServer.get and what it's callback arguments are.</p>\n\n<p>I like to read examples, but I really need an API to learn a new language/library/framework, anyone helps?</p>\n"},{"tags":["javascript","regex","node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":27,"score":2,"question_id":13140815,"title":"join result that is separated by a diffrent regex match","body":"<p>hello im doing something like <a href=\"http://stackoverflow.com/questions/13139162/how-to-replace-dots-inside-quote-in-sentence-with-regex/13139633#13139633\">how to replace dots inside quote in sentence with regex</a></p>\n\n<pre><code>var string = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. \"Vestibulum interdum dolor nec sapien blandit a suscipit arcu fermentum. Nullam lacinia ipsum vitae enim consequat iaculis quis in augue. Phasellus fermentum congue blandit. Donec laoreet, ipsum et vestibulum vulputate, risus augue commodo nisi, vel hendrerit sem justo sed mauris.\" Phasellus ut nunc neque, id varius nunc. In enim lectus, blandit et dictum at, molestie in nunc. Vivamus eu ligula sed augue pretium tincidunt sit amet ac nisl. \"Morbi eu elit diam, sed tristique nunc.\"';\n\n// seperate the quotes\nvar quotes = string.match(/\"(.)+?\"/g);\nvar test = [];\n\n// for each quotes\nfor (var i = quotes.length - 1; i &gt;= 0; i--) {\n\n    // replace all the dot inside the quote\n    test[i] = quotes[i].replace(/\\./g, '[dot]');\n};\n\nconsole.log(test);\n</code></pre>\n\n<p>lets say we already make the change with the regex, but im stuck at how can we join it back to the existing <code>var string</code> as my result is seperated in <code>var test</code> ? or theres a better way?</p>\n\n<p>the output should be something like</p>\n\n<blockquote>\n  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. \"Vestibulum interdum dolor nec     sapien blandit a suscipit arcu fermentum[dot]Nullam lacinia ipsum vitae enim consequat iaculis quis in augue[dot] Phasellus fermentum congue blandit[dot] Donec laoreet, ipsum et vestibulum vulputate, risus augue commodo nisi, vel hendrerit sem justo sed mauris[dot]\" Phasellus ut nunc neque, id varius nunc. In enim lectus, blandit et dictum at, molestie in nunc. Vivamus eu ligula sed augue pretium tincidunt sit amet ac nisl. \"Morbi eu elit diam, sed tristique nunc[dot]\"  </p>\n</blockquote>\n\n<p>*ps im not sure the title is corrent</p>\n\n<p>thanks</p>\n"},{"tags":["javascript","node.js","special-characters","parse.com"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13121942,"title":"Parse.com REST API - Special Characters","body":"<p>Through <a href=\"http://www.parse.com\" rel=\"nofollow\">parse.com</a> REST API i'm signing in user with their Facebook accounts in node.js. I get an error when I try to sign up users that have names such as <code>Martin Sánchez</code>. Are special characters something to be aware of when saving objects in Parse.com through the REST API?</p>\n\n<p>Note:\nI'm encountering this problem only on the REST API, meaning that it works fine in iOS and Android.\nI tried encoding the string but it gets saved literally(<code>Martin S\\\\u00e1nchez</code> as a string).</p>\n"},{"tags":["node.js","localhost","telnet"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13140511,"title":"Telnet: localhost on Windows 7 will not connet to localhost","body":"<p>I am running a simple Node.JS server with the code:</p>\n\n<pre><code>require('http').createServer(function (req, res) {\n  res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });\n  res.end('&lt;h1&gt;Hi there world&lt;/h1&gt;');\n}).listen(3000);\n</code></pre>\n\n<p>It works as expected. When I type \"http://localhost:3000\" the header \"Hi there world\" appears.</p>\n\n<p>When I use telnet however:</p>\n\n<pre><code>telnet localhost 3000\n</code></pre>\n\n<p>I only get the message:</p>\n\n<pre><code>Connecting To localhost...\n</code></pre>\n\n<p>Firewall is switched off. Telnet connects to external hosts without any problems.</p>\n"},{"tags":["javascript","node.js","node-dirty"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12802574,"title":"nodejs dirty check if key exists","body":"<p>I'm a newbie to Node.js. I am using Dirty to save data into a .db file, and I have no idea to check if the key I inserted through db.set() already exists.</p>\n\n<p>In other words: I want to check if the key exists, and if it does, do something.</p>\n"},{"tags":["javascript","node.js","node-dirty"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12821370,"title":"Node.js dirty how do i get data from [Object object]?","body":"<p>As the title says, how to i get the data from from [Object object]?\nI'm a newbie to Node.js, so I don't all the aspects of node.js</p>\n\n<p>Here is an example of what i'm trying to do.</p>\n\n<pre><code>// Get data with dirty\nvar data = db.get('/htmltest')\n\n// My test.db file\n{\"key\":\"foo\",\"val\":\"barwhat?\"}\n{\"key\":\"/htmltest\",\"val\":{\"title\":\"Html Test\",\"content\":\"&lt;span&gt;This is HTML&lt;/span&gt;\"}}\n\n\n// the console.log gives me [Object Object]\n// How do I get it to show the content of title (Html Test)\nconsole.log(data);\n</code></pre>\n"},{"tags":["javascript","node.js","node-dirty"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12860944,"title":"Node.js dirty Is it possible to reload a dirty database?","body":"<p>How do make the server reload the Dirty database when it's trying to get something from it? Because when I edit the database file with a text editor, and reload the browser, it doesn't update the page.</p>\n\n<p>\"reloadDB();\" is where I want to reload the db.\n<strong>Code example</strong></p>\n\n<pre><code>http.createServer(function (request, response) {\n    var pathname = url.parse(request.url).pathname;\n    var html = db.get(pathname);\n\n    //Check if the requsted file is CSS or JS\n    if (/\\.(css)$/.test(pathname) || /\\.(js)$/.test(pathname)){\n\n        fs.createReadStream(__dirname + pathname, {\n            'bufferSize': 4 * 1024\n        }).pipe(response);\n\n    } else if (!!html &amp;&amp; pathname !== '/admin' ) {\n        //Pages from our Dirty DB\n        response.writeHead(200, {'Content-Type': 'text/html'});\n                    //reloadDB();\n        response.end(html);\n    } else if (pathname === '/admin') {\n        //Display Admin page\n        response.writeHead(200, {'Content-Type': 'text/html'});\n        response.end('Admin!');\n    } else {\n        //Show 404 Page\n        response.writeHead(404, {'Content-Type': 'text/html'});\n        //reloadDB();\n                    response.end(db.get('404'));\n    }\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13134336,"title":"how to retrieve caller function js file global variable value in nodejs","body":"<p>Sample Code from nodejs:</p>\n\n<p>Code from JS1.js : </p>\n\n<pre><code>var js2=require(\"../../util\");\nvar dataName=\"Billy\";\nfunction hello1(){\n   js2.hello2(\"message\");\n}\n</code></pre>\n\n<p>Code from JS3.js :     </p>\n\n<pre><code>var js2=require(\"../../util\");\nvar dataName=\"Tom\";\nfunction hello3(){\n   js2.hello2(\"message\");\n}\n</code></pre>\n\n<p>Code from JS2.js :</p>\n\n<pre><code>exports.hello2=hello2;\nfunction hello2(arg1){\n   console.log(arg1);\n   //Here I need the data in global variable \"dataName\" of file JS1.js or JS3.js\n}\n</code></pre>\n\n<p>I need to access the global variable of caller js file.</p>\n"},{"tags":["node.js","npm"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1978,"score":3,"question_id":7559648,"title":"Is there a way to make npm install (the command) to work behind proxy?","body":"<p>Read about a proxy variable in a .npmrc file but it does not work. Trying to avoid manually downloading all require packages and installing.</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","ldap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13138770,"title":"Connect Node JS with LDAP","body":"<p>How to connect to LDAP using node js? Kindly help with sample code.\nI am not able to connect the LDAP as in post <a href=\"http://stackoverflow.com/questions/13134177/connect-ldap-using-node-js-segmentation-fault-error\">Connect LDAP using node JS ; Segmentation fault Error</a>. </p>\n"},{"tags":["node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13137277,"title":"fs.exists method doesnt exist anymore in node.js","body":"<p>Im using node v0.6.12</p>\n\n<p>This is my code:</p>\n\n<pre><code>var fs = require(\"fs\");\n\nfs.exists(\".\", function() {\n    console.log(\"Whatever);\n});\n</code></pre>\n\n<p>I get this output:</p>\n\n<pre><code>node.js:201\n        throw e; // process.nextTick error, or 'error' event on first tick\n              ^\nTypeError: Object #&lt;Object&gt; has no method 'exists'\n    at Object.&lt;anonymous&gt; (/home/dbugger/Projects/nodetest/test.js:3:4)\n    at Module._compile (module.js:441:26)\n    at Object..js (module.js:459:10)\n    at Module.load (module.js:348:32)\n    at Function._load (module.js:308:12)\n    at Array.0 (module.js:479:10)\n    at EventEmitter._tickCallback (node.js:192:41)\n</code></pre>\n\n<p>Has \"exists\" been deprecated? What can I use then?</p>\n"},{"tags":["javascript","arrays","node.js","casting"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13128610,"title":"How to sum an array of strings, representing ints","body":"<p>How to sum such an Array\n<code>\n[ '',\n  '4490449',\n  '2478',\n  '1280990',\n  '22296892',\n  '244676',\n  '1249',\n  '13089',\n  '0',\n  '0',\n  '0\\n' ]\n</code></p>\n\n<p>If I call something like that <code>['','4490449', ... , '0\\n' ].reduce(function(t,s){ return t+s)</code> on that array, the stings are joined and not summed.</p>\n\n<p>I've tried some casting with <code>parseInt()</code> but this results in <code>NaN</code> :)</p>\n"},{"tags":["node.js","express","node.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13127408,"title":"Node.io scrape job fails the 2nd time","body":"<p>I am essentially trying to scrape a page on the fly. When you hit this url, it ouputs the result from the scrape job. Everything works wonderfully the first time. The second time I try it (with different parameters passed through job.options.args) it won't even execute the node.io job's run() function. <code>scrape_result</code> returns empty the second time (I expect an object).</p>\n\n<p>Any thoughts? How can I ensure the new results get returned the 2nd time? For my scrape job I'm almost exactly using example #3 from here: <a href=\"https://github.com/chriso/node.io/wiki/Scraping\" rel=\"nofollow\">https://github.com/chriso/node.io/wiki/Scraping</a>    </p>\n\n<p>excerpt from scraper.js (the rest is like example #3: <a href=\"https://github.com/chriso/node.io/wiki/Scraping\" rel=\"nofollow\">https://github.com/chriso/node.io/wiki/Scraping</a>)</p>\n\n<pre><code>run: function() {\n    var book = this.options.args[0].book;\n    var chapter = this.options.args[0].chapter;\n\n    this.getHtml('http://www.url.com' + book + '/' + chapter + '?lang=eng', function(err, $) {\n</code></pre>\n\n<p>Then my app.js</p>\n\n<pre><code>var scrip_scraper = require('./scraper.js');\n\napp.get('/verses/:book/:chapter', function (req, res) {\n    var params = {\n        book: req.param('book'),\n        chapter: req.param('chapter')\n    }\n\n    scrip_scraper.job.options.args[0] = params;\n    //scrip_scraper.job.options.args.push(chapter);\n    console.log(scrip_scraper.job.options.args);\n\n\n\n    nodeio.start(scrip_scraper, function (err, scrape_result) {\n\n        console.log(scrape_result);\n    }, true);\n\n}); //app.get('/verses/:book/:chapter')\n</code></pre>\n"},{"tags":["xml","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13137120,"title":"Modify XML tags on \"NodeJS\"","body":"<p>Does anyone know how to modify a tag value of an XML file using NodeJS</p>\n\n<p>this is my XML file:</p>\n\n<pre><code>&lt;note&gt;\n    &lt;to&gt;Tove&lt;/to&gt;\n    &lt;from&gt;Jani&lt;/from&gt;\n    &lt;heading&gt;Reminder&lt;/heading&gt;\n    &lt;body&gt;Don't forget me this weekend!&lt;/body&gt;\n&lt;/note&gt;\n</code></pre>\n\n<p>I want to change the <code>&lt;node&gt;</code> to <code>&lt;n&gt;</code></p>\n\n<p>I'm running nodeJS on windows. SO far I have following code;</p>\n\n<pre><code>var parser = new xml2js.Parser();\nfunction xmltxt(response, postData){\n    fs.readFile( './foo.xml', function(err, data) {\n        parser.parseString(data, function (err, result) {\n            console.dir(result.note.to[0]);\n        });\n    });\n}\n</code></pre>\n\n<p>This reads the node value but I need to modify the tag value.\nPlease help.</p>\n"},{"tags":["javascript","c++","node.js","v8"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13136945,"title":"Unwrapping unknown objects in a nodejs addon","body":"<p>I am currently trying to write a small nodejs addon to allow me to use a taskmanaging system with a bunch of node child_processes as work-stealing-workers.</p>\n\n<p>The problem is I need to access the child_process api, but it is written in javascript and in the documentation only unwrapping already wrapped objects is mentioned.</p>\n\n<p>Is there a way to access an unknown object and test it for certain function, e.g.</p>\n\n<pre><code>var cluster = require('cluster'),\n    myaddon = require('myaddon');\n\nvar worker = cluster.fork();\nmyaddon.callSendFuncOfObject(worker);\n</code></pre>\n\n<p>And in the addon it would be something like this</p>\n\n<pre><code>Handle&lt;Value&gt; callSendFuncOfObject(const Arguments&amp; args) {\n   HandleScope scope;\n\n   // How to work with the custom non c wrapped object here?\n\n   return scope.Close(Undefined());\n}\n</code></pre>\n"},{"tags":["templates","node.js","ejs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":9574262,"title":"Add plugin to ejs?","body":"<p>how i can add my own custom functions to ejs?</p>\n\n<pre><code>&lt;%- custom_function('test') %&gt;\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["node.js","rest","hbase"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13119369,"title":"HBase Intra-row scanning","body":"<p>I am trying to find some information on intra-row scanning through HBase REST API. However, I have a hard time to see how it could be done according to the documentation, and I am wondering if anyone used this feature from the REST interface?</p>\n\n<p>References</p>\n\n<ul>\n<li><a href=\"http://hadoop-hbase.blogspot.jp/2012/01/hbase-intra-row-scanning.html\" rel=\"nofollow\">http://hadoop-hbase.blogspot.jp/2012/01/hbase-intra-row-scanning.html</a></li>\n<li><a href=\"http://wiki.apache.org/hadoop/Hbase/Stargate\" rel=\"nofollow\">http://wiki.apache.org/hadoop/Hbase/Stargate</a></li>\n</ul>\n\n<p>More specifically, I am looking into how I would do this from a Node.js application.</p>\n\n<p>Edit:</p>\n\n<p>I found this, but I have a hard time to see how intra-row scanning would be possible...</p>\n\n<p><a href=\"http://stackoverflow.com/questions/9302097/hbase-rest-filter-singlecolumnvaluefilter\">HBase REST Filter ( SingleColumnValueFilter )</a></p>\n"},{"tags":["node.js","memory-leaks"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":13078212,"title":"node.js script and possible memory leak","body":"<p>I am writing a node.js script that takes data from one connected socket and sends it to another connected socket. During testing I noticed that if I disconnect and reconnect a client over and over while a server is sending large amounts of data I get a memory leak. The following is the node.js code.</p>\n\n<pre><code>var net = require('net');\nvar logServer = net.createServer();  \nvar clientList = [];\nvar clientIPList = [];\nvar serverList = [];\nvar serverIPList = [];\nvar port = 6451;\n\nlogServer.on('connection', function(client) {\n    client.setEncoding('utf8');\n    client.once('data', function(data) {\n        if (data[0].toString() == 'S') {\n            var server = client;\n            client = undefined;\n            serverList.push(server);\n            serverIPList.push(server.remoteAddress + \":\" + server.remotePort);\n            console.log('Server connected: %s:%d', server.remoteAddress, server.remotePort);\n\n            server.on('data', function(data) {\n                for(var i=0;i&lt;clientList.length;i+=1) {\n                    try {\n                        clientList[i].write(data);\n                    } catch (err) {\n                        console.log('Error writing to client \"data event\": ' + clientIPList[i] );\n                        // close and null the socket on write error\n                        try {\n                            clientList[i] = null;\n                            clientList[i].end();\n                        } catch (err) {}\n                        clientList.splice(i, 1);\n                        clientIPList.splice(i, 1);\n                    }\n                }            \n            })\n\n            server.on('end', function() {\n                try {\n                    var d;\n                    if( (d = serverList.indexOf( server )) != -1 ) {\n                        console.log('Server disconnecting \"end event\": ' + serverIPList[d]);\n                        try {\n                            serverList[d] = null;\n                            serverList[d].end();\n                        } catch (err) {}\n                        serverList.splice(d, 1);\n                        serverIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Server disconnecting \"end event\": unknown server');                    \n                    }\n                } catch (err) {\n                    console.log('Error cleaning up server socket list on \"end event\"');\n                }\n            })\n\n            server.on('timeout', function() {\n                try {\n                    var d;\n                    if( (d = serverList.indexOf( server )) != -1 ) {\n                        console.log('Server disconnecting \"timeout event\": ' + serverIPList[d]);\n                        try {\n                            serverList[d] = null;\n                            serverList[d].end();\n                        } catch (err) {}\n                        serverList.splice(d, 1);\n                        serverIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Server disconnecting \"timeout event\": unknown server');                    \n                    }\n                } catch (err) {\n                    console.log('Error cleaning up server socket list on \"timeout event\"');\n                }\n            })\n\n            server.on('error', function(e) {\n                try {\n                    var d;\n                    if( (d = serverList.indexOf( server )) != -1 ) {\n                        console.log('Server disconnecting ' + e.code + ' \"error event\": ' + serverIPList[d]);\n                        try {\n                            serverList[d] = null;\n                            serverList[d].end();\n                        } catch (err) {}\n                        serverList.splice(d, 1);\n                        serverIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Server disconnecting \"error event\": unknown server');                  \n                    }\n                } catch (err) {\n                    console.log('Error cleaning up server socket list on \"error event\"');\n                }\n            })\n\n            server.on('close', function() {\n                try {\n                    var d;\n                    if( (d = serverList.indexOf( server )) != -1 ) {\n                        console.log('Server disconnecting \"close event\": ' + serverIPList[d]);\n                        try {\n                            serverList[d] = null;\n                            serverList[d].end();\n                        } catch (err) {}\n                        serverList.splice(d, 1);\n                        serverIPList.splice(d, 1);\n                    }\n                } catch (err) {\n                    console.log('Error cleaning up server socket list on \"close event\"');\n                }\n            })\n            server.on('drain', function() {\n            })\n        } \n\n        else {\n            clientList.push(client);\n            clientIPList.push(client.remoteAddress + \":\" + client.remotePort);\n            console.log('Client connected: %s:%d',client.remoteAddress, client.remotePort);\n\n            client.on('data', function(data) {\n                console.log('writing \"%s\" to %d servers', data.replace(/[\\r\\n]/g,''), serverList.length);\n                for(var i=0;i&lt;serverList.length;i+=1) {\n                    try {\n                        serverList[i].write(data);\n                    } catch (err) {\n                        console.log('Error writing to server \"data event\": ' + serverIPList[i] );\n                        try {\n                            serverList[i] = null;\n                            serverList[i].end();\n                        } catch (err) {}\n                        serverList.splice(i, 1);\n                        serverIPList.splice(i, 1);\n                    }\n                }\n            })\n\n            client.on('end', function() {\n                try {\n                    var d;\n                    if( (d = clientList.indexOf( client )) != -1 ) {\n                        console.log('Client disconnecting \"end event\": ' + clientIPList[d]);\n                        // close and null the socket\n                        try {\n                            clientList[d] = null;\n                            clientList[d].end();\n                        } catch (err) {}\n                        clientList.splice(d, 1);\n                        clientIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Client disconnecting \"end event\": unknown client');\n                    }               \n                } catch (err) {\n                    console.log('Error cleaning up socket client list on \"end event\"');\n                }\n            })\n\n            client.on('timeout', function() {\n                try {\n                    client.end();\n                } catch (err) {\n                    var d;\n                    if( (d = clientList.indexOf( client )) != -1 ) {\n                        console.log('Error closing client connection \"timeout event\": ' + clientIPList[d]);\n                    }\n                    else {\n                        console.log('Error closing client connection \"timeout event\": unknown client');                 \n                    }\n                }               \n                try {\n                    var d;\n                    if( (d = clientList.indexOf( client )) != -1 ) {\n                        console.log('Client disconnecting \"timeout event\": ' + clientIPList[d]);\n                        try {\n                            clientList[d] = null;\n                            clientList[d].end();\n                        } catch (err) {}\n                        clientList.splice(d, 1);\n                        clientIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Client disconnecting \"timeout event\": unknown client');\n                    }               \n                } catch (err) {\n                    console.log('Error cleaning up client socket list on \"timeout event\"');\n                }\n            })\n\n            client.on('error', function(e) {\n                try {\n                    var d;\n                    if( (d = clientList.indexOf( client )) != -1 ) {\n                        console.log('Client disconnecting ' + e.code + ' \"error event\": ' + clientIPList[d]);\n                        try {\n                            clientList[d] = null;\n                            clientList[d].end();\n                        } catch (err) {}\n                        clientList.splice(d, 1);\n                        clientIPList.splice(d, 1);\n                    }\n                    else {\n                        console.log('Client disconnecting ' + e.code + ' \"error event\": unknown client');\n                    }               \n                } catch (err) {\n                    console.log('Error cleaning up client socket list on \"error event\"');\n                }\n            })\n\n            client.on('close', function() {\n                try {\n                    var d;\n                    if( (d = clientList.indexOf( client )) != -1 ) {\n                        console.log('Client disconnecting \"close event\": ' + clientIPList[d]);\n                        try {\n                            clientList[d] = null;\n                            clientList[d].end();\n                        } catch (err) {}\n                        clientList.splice(d, 1);\n                        clientIPList.splice(d, 1);\n                    }\n                } catch (err) {\n                    console.log('Error cleaning up client socket list on \"close event\"');\n                }\n            })\n\n            client.on('drain', function() {\n                // nothing\n            })\n        }\n    })\n})\nlogServer.listen( port );\n</code></pre>\n\n<p>As far as I am aware, I am handing all critical 'net' events and I am cleaning up the sockets properly, once I detect a disconnect. Here are the two scripts that I am using to test. The first just connects and disconnects as a client over and over and the second sends data as a server. I run them both simultaneously. </p>\n\n<p>condiscon.rb: Connects and disconnects after registering itself as a client \"sends a newline once connected\". I run with './condiscon.rb 1000'</p>\n\n<pre><code>#!/usr/bin/ruby\n\nrequire 'rubygems'\nrequire 'socket'\n\ndef connectFlac\n    host = '10.211.55.10'\n    port = 6451\n\n    sock = TCPSocket.open( host, port )\n    sock.puts( \"\" )\n    sock\nend\n\nsock = connectFlac()\ndata = []\nuser_agents = {}\ninstances_lat = {}\n\ncount = ARGV.shift.to_i\n\nwhile( count &gt; 0 )\n    sock = connectFlac()\n    sleep( 0.05 )\n    sock.close()\n    sleep( 0.05 )\n    count-= 1\nend\n</code></pre>\n\n<p>dataflood.rb: Connects as a server and sends ~2600 byte packets of abcde with a counter. I run 'dataflood.rb 30000'</p>\n\n<pre><code>#!/usr/bin/ruby\n\nrequire 'socket'\n\ndef connectFlac\n    host = '10.211.55.10'\n    port = 6451\n\n    sock = TCPSocket.open( host, port )\n    sock.setsockopt(Socket::IPPROTO_TCP,Socket::TCP_NODELAY,1)\n    sock.puts( \"S\" )\n    sock\nend\n\ndef syntax()\n    print \"./script number_of_packets\\n\"\n    exit( 1 )\nend\n\ndata = \"\"\n(1..100).each {\n    data+= \"abcdefghijklmnopqrstuvwxyz\"\n}\n\nsock = connectFlac()\n\nnumpackets = ARGV.shift.to_i || syntax()\ncounter = 1\nbyteswritten = 0\n\nwhile( numpackets &gt; 0 )\n    r,w,e = IO.select( nil, [sock], nil, nil )\n    w.each do |sock_write|\n        print numpackets, \"\\n\"\n        sock.write( counter.to_s + \"|\" + data + \"\\n\" )\n        sock.flush()\n        byteswritten+= counter.to_s.length + 1 + data.length + 1\n        counter+= 1\n        numpackets-= 1\n    end\nend\nsock.close()\n\nprint \"Wrote #{byteswritten} bytes\\n\"\n</code></pre>\n\n<p>Here are some of the results that I am seeing. When running a memory profile on logserver.js before any testing it uses about 9 megabytes of resident memory. I am including a pmap to show the section of memory that the leak appears to occupy.</p>\n\n<pre><code>[root@localhost ~]# ps vwwwp 20658\n  PID TTY      STAT   TIME  MAJFL   TRS   DRS   **RSS** %MEM COMMAND\n20658 pts/4    Sl+    0:00      0  8100 581943 **8724**  0.8 /usr/local/node-v0.8.12/bin/node logserverdemo.js\n\n[root@localhost ~]# pmap 20658\n20658:   /usr/local/node-v0.8.12/bin/node logserverdemo.js    \n0000000000400000   8104K r-x--  /usr/local/node-v0.8.12/bin/node    \n0000000000de9000     76K rwx--  /usr/local/node-v0.8.12/bin/node    \n0000000000dfc000     40K rwx--    [ anon ]    \n**000000001408a000    960K rwx--    [ anon ]**    \n0000000040622000      4K -----    [ anon ]\n</code></pre>\n\n<p>After running the two ruby scripts above against the logserver at the ame time here is what memory looks like about 30 minute after the traffic stops. (I waited for all gc to happen)</p>\n\n<pre><code>[root@localhost ~]# ps vwwwp 20658\n  PID TTY      STAT   TIME  MAJFL   TRS   DRS   RSS %MEM COMMAND\n20658 pts/4    Sl+    0:01      0  8100 665839 **89368**  8.7 /usr/local/node-v0.8.12/bin/node logserverdemo.js\n\n[root@localhost ~]# pmap 20658\n20658:   /usr/local/node-v0.8.12/bin/node logserverdemo.js\n\n0000000000400000   8104K r-x--  /usr/local/node-v0.8.12/bin/node\n0000000000de9000     76K rwx--  /usr/local/node-v0.8.12/bin/node    \n0000000000dfc000     40K rwx--    [ anon ]    \n**000000001408a000  80760K rwx--    [ anon ]**\n0000000040622000      4K -----    [ anon ]\n0000000040623000     64K rwx--    [ anon ]\n</code></pre>\n\n<p>dataflood.rb wrote a total of 78198894 bytes of data and the leak is very close. I dumped the memory at 0x1408a000 and I saw that most of the packets I was sending from dataflood.rb were stuck in memory. </p>\n\n<pre><code>[root@localhost ~]# ./memoryprint 20658 0x1408a000 80760000 &gt; 20658.txt\n[root@localhost ~]# strings 20658.txt | grep '|abcde' | wc -l\n30644\n[root@localhost ~]# strings 20658.txt | grep '|abcde' | sort | uniq | wc -l\n29638\n</code></pre>\n\n<p>after waiting 24 hours the memory still had not freed. Any help that anyone can give me would be greatly appreciated.  </p>\n"},{"tags":["node.js","express","passport"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13135616,"title":"NodeJS: Express 3.0 with connect-flash( as advised in the passport local strategy), still finding exception for req.flash","body":"<p>I'm new to NodeJS and trying to build an app over Express3.0, included passport local strategy for authentication purpose. But the following exception(with respect to req.flash) blocks my progress.</p>\n\n<pre>\nException occurs in the following line.\nres.render('login', { user: req.user, message: req.flash('error') });\n</pre>\n\n<pre>\nExpress\n500 TypeError: Object # has no method 'flash'\n\n    at /Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/app.js:115:54\n    at callbacks (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/lib/router/index.js:162:37)\n    at param (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/lib/router/index.js:136:11)\n    at pass (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/lib/router/index.js:143:5)\n    at Router._dispatch (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/lib/router/index.js:171:5)\n    at Object.router (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/lib/router/index.js:33:10)\n    at next (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at store.get.next (/Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/node_modules/connect/lib/middleware/session.js:310:9)\n    at /Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/node_modules/connect/lib/middleware/session.js:333:9\n    at /Users/vivekanandan/Source/Git/ExpressApp/CosmicEnergyCoupled/node_modules/express/node_modules/connect/lib/middleware/session/memory.js:52:9\n\n\n</pre>\n\n<p>I have installed connect-flash to recover the deprecated req.flash method as advised by the author(passport-local-strategy). Please find the npm packages installed in the app.</p>\n\n<pre>\n├── connect-flash@0.1.0\n├── ejs@0.8.3\n├── ejs-locals@0.2.5\n├─┬ express@3.0.0\n│ ├── commander@0.6.1\n│ ├─┬ connect@2.6.0\n│ │ ├── bytes@0.1.0\n│ │ ├── formidable@1.0.11\n│ │ ├── pause@0.0.1\n│ │ ├── qs@0.5.1\n│ │ └─┬ send@0.0.4\n│ │   └── mime@1.2.6\n│ ├── cookie@0.0.4\n│ ├── crc@0.2.0\n│ ├── debug@0.7.0\n│ ├── fresh@0.1.0\n│ ├── methods@0.0.1\n│ ├── mkdirp@0.3.3\n│ ├── range-parser@0.0.4\n│ └─┬ send@0.1.0\n│   └── mime@1.2.6\n├─┬ passport@0.1.12\n│ └── pkginfo@0.2.3\n├─┬ passport-local@0.1.6\n│ ├── passport@0.1.12\n│ └── pkginfo@0.2.3\n├─┬ socket.io@0.9.10\n│ ├── policyfile@0.0.4\n│ ├── redis@0.7.2\n│ └─┬ socket.io-client@0.9.10\n│   ├─┬ active-x-obfuscator@0.0.1\n│   │ └── zeparser@0.0.5\n│   ├── uglify-js@1.2.5\n│   ├─┬ ws@0.4.22\n│   │ ├── commander@0.6.1\n│   │ ├── options@0.0.3\n│   │ └── tinycolor@0.0.1\n│   └── xmlhttprequest@1.4.2\n└─┬ stylus@0.30.1\n  ├── cssom@0.2.5\n  ├── debug@0.7.0\n  └── mkdirp@0.3.4\n</pre>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13134315,"title":"Node.js serve as a backend server for frontend app","body":"<p>I want to use Node.js run as a back-end server to serve front-end <strong>socket.io</strong> request.</p>\n\n<p>The samples I found, seems can only run pages from Node.js server.</p>\n\n<pre><code>&lt;script src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>The above js include is served by Node.js, how to include it if the front-end is a different application (e.g. PHP or static pages) ? Do I need to include all the dependent socket.io js libraries to make it work?</p>\n"},{"tags":["javascript","node.js","jsbin"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":39,"score":1,"question_id":13133901,"title":"How to download JS Bin to my computer to code","body":"<p>I'm new to JavaSript, and I like <a href=\"http://jsbin.com/\" rel=\"nofollow\">JS Bin</a>, but on desktop no thing is the same for development. Is there a way to work with JS Bin without access to the website?</p>\n"},{"tags":["node.js","wildcard","elasticsearch"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":13006816,"title":"elasticsearch wildcard search with and operator","body":"<p>I am developing an application that uses elastic search, and in some case I want to make a search that according to term and locales. I am testing this on localhost</p>\n\n<pre><code>http://localhost:9200/index/type/_search\n</code></pre>\n\n<p>and parameters</p>\n\n<pre><code>query : {\n                        wildcard : { \"term\" : \"myterm*\" }\n                    },\n                    filter : {\n                        and : [\n                            {\n                                term : { \"lang\" : \"en\" }\n                            },\n                            {\n                                term : { \"translations.lang\" : \"tr\" } //this is subdocument search\n                            },\n                        ]\n                    }\n</code></pre>\n\n<p>Here is an example document:</p>\n\n<pre><code>{\n    \"_index\": \"twitter\",\n    \"_type\": \"tweet\",\n    \"_id\": \"5084151d2c6e5d5b11000008\",\n    \"_score\": null,\n    \"_source\": {\n      \"lang\": \"en\",\n      \"term\": \"photograph\",\n      \"translations\": [\n        {\n          \"_id\": \"5084151d2c6e5d5b11000009\",\n          \"lang\": \"tr\",\n          \"translation\": \"fotoğraf\",\n          \"score\": \"0\",\n          \"createDate\": \"2012-10-21T15:30:37.994Z\",\n          \"author\": \"anonymous\"\n        },\n        {\n          \"_id\": \"50850346532b865c2000000a\",\n          \"lang\": \"tr\",\n          \"translation\": \"resim\",\n          \"score\": \"0\",\n          \"createDate\": \"2012-10-22T08:26:46.670Z\",\n          \"author\": \"anonymous\"\n        }\n      ],\n      \"author\": \"anonymous\",\n      \"createDate\": \"2012-10-21T15:30:37.994Z\"\n    }\n  }\n</code></pre>\n\n<p>I am trying to get terms with wildcard(for autocomplete) with input language \"en\", and output language \"tr\". It is getting terms that has \"myterm\" but doesnt apply, and operation on this. Any suggestion would be appreciated</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["javascript","node.js","ldap"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13134177,"title":"Connect LDAP using node JS ; Segmentation fault Error","body":"<p>Trying to connect to LDAP using the below code. But, getting segmentation fault error.\nActually I need username as the response. How to overcome this error?\nIs there anyother variable I need to pass as options\n<code>var sys = require('sys'),</code></p>\n\n<p><code>ldapauth = require('./ldapauth'); // Path to ldapauth.node</code></p>\n\n<p><code>var scheme    = 'ldap',</code></p>\n\n<p><code>ldap_host = 'ad.abc.com',</code></p>\n\n<p><code>ldap_port = 3268,</code></p>\n\n<p><code>username  = 'abcd',</code></p>\n\n<p><code>password  = '1234'</code></p>\n\n<p><code>base      = \"DC=ad,DC=abc,DC=com\";</code></p>\n\n<p><code>filter    = \"(&amp;(objectclass=user)(sAMAccountName=abcd))\";</code></p>\n\n<p><code>console.log(\"Authentication Check\");</code></p>\n\n<p><code>ldapauth.authenticate(scheme, ldap_host, ldap_port, username, password,</code></p>\n\n<p><code>function(err, result) {</code></p>\n\n<pre><code>`if (err) {`\n\n  `console.log(err);`\n\n`} else {`\n\n  `console.log('Authenticated ! ! ! ! ! : ' + result);`\n\n`}`\n</code></pre>\n\n<p><code>});</code></p>\n\n<p><code>//ldap authentication Search</code></p>\n\n<p><code>ldapauth.search(ldap_host, ldap_port, username, password, base, filter,</code></p>\n\n<p><code>function(err, result) {</code></p>\n\n<p><code>if (err) {</code></p>\n\n<p><code>sys.puts(err);</code></p>\n\n<p><code>} else {</code></p>\n\n<p><code>sys.puts('Search: ' + JSON.stringify(result));</code></p>\n\n<p><code>}</code></p>\n\n<p><code>});</code></p>\n"},{"tags":["windows","node.js","azure","sdk"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13131671,"title":"Windows Azure Node.js SDK - How to query Table Storage Efficiently","body":"<p>I've written a FB App and would like to add some more features and make it more social.  One of the things I am trying to do is query table storage according to the users friends and discover whether the users friends have \"watched\" a video within my app.  I can get the friend ids from FB fine, but I am not sure how to construct my query to table storage since the maximum number of friends a FB user can have is 5000 so potentially I could end up with a query like so:</p>\n\n<pre><code>var ts1 = azure.createTableService(config.storageAccount, config.storageAccessKey, config.tableHost);\nvar query = azure.TableQuery\n    .select()\n    .from('hits')\n    .where('PartitionKey eq ?', '0')\n\nfor (f in friends){\n    query.or('UserID eq ?', friends[f].UserID);\n}\n\nts1.queryEntities(query, function (err, result){\n    etc ...\n}\n</code></pre>\n\n<p>Resulting in one big fat query!</p>\n\n<p>My question is whether this is the most efficient and cost effective (minimal table storage transactions) when doing queries of this nature against Windows Azure Table Storage or is their a better way?</p>\n"},{"tags":["javascript","node.js","express","npm"],"answer_count":11,"favorite_count":10,"up_vote_count":20,"down_vote_count":0,"view_count":8144,"score":20,"question_id":5919629,"title":"Express module not found when installed with NPM","body":"<p>When I try to run the app.js file created by express, I get the following error:</p>\n\n<pre><code>$ node app.js\n\nnode.js:134\n        throw e; // process.nextTick error, or 'error' event on first tick\n        ^\nError: Cannot find module 'express'\n    at Function._resolveFilename (module.js:320:11)\n</code></pre>\n\n<p>When I type in 'express --version' I get a return statement of 2.3.3. I used npm to install express. I had to manually make npm using these instructions:</p>\n\n<pre><code>git clone http://github.com/isaacs/npm.git\ncd npm\nsudo make install\n</code></pre>\n\n<p>The error is <code>Error: Cannot find module 'express'</code>.</p>\n\n<p>Do I need to do something after installing npm and express in order to make express see the modules created by npm?</p>\n\n<p>My node is version: 0.4.6\nMy express is version: 2.3.3\nMy npm is version: 1.0.6</p>\n\n<p>Express is installed globally. I used the -g flag to install it.</p>\n\n<p>Edit: When I try \"node -e require.paths\" I get:</p>\n\n<p>[ '/home/user/.node_modules',\n  '/home/user/.node_libraries',\n  '/usr/local/lib/node' ]</p>\n\n<p>So, node isn't detecting the npm installation. How do I get node to detect the npm installation?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":66,"score":0,"question_id":13131626,"title":"TypeError: undefined is not a function in nodejs","body":"<p>This is my users.js model.</p>\n\n<pre><code>var mongoose = require('mongoose')\n  , crypto = require('crypto')\n  , mongoTypes = require('mongoose-types');\n\nmongoTypes.loadTypes(mongoose, 'email');\nmongoose.connect('mongodb://localhost/popbroker');\n\nfunction hash1 (msg, key) { \n  return crypto.createHmac('sha256', key).update(msg).digest('hex');\n};\n\nfunction required(val) { return val &amp;&amp; val.length; }\n\nvar Schema = mongoose.Schema\n  , ObjectId = Schema.ObjectId;\n\nvar UserSchema = new Schema({\n    username: {\n      type: String,\n      validate: [required,\"Username is required\"],\n      index: {unique: true}\n    },\n    email: {\n        type: mongoose.SchemaTypes.Email,\n        validate: [required, 'Email required'],\n        index: { unique: true }\n    },\n    password: {\n        type: String,\n        validate: [required, 'Password required'],\n    },\n    socialauth:{\n      type:String,\n      'default':\"Fioki\"\n    },\n    createdAt: {\n        type: Date,\n        'default': Date.now\n    }\n});\n\n\nvar UserApiSchema = new Schema({\n    user :ObjectId,\n    apiKey: {\n        type: String,\n        validate: [required, 'Senha é obrigatório'],\n    },\n    createdAt: {\n        type: Date,\n        'default': Date.now\n    }\n});\n\n\nUserSchema.path('email').validate(function (v, fn) {\n    User.count({email: v}, function (err, val) {\n        if (err) fn(false);\n        fn(val==0);\n    });\n}, 'Email exists!'); \n\nUserSchema.path('username').validate(function(v,fn){\n  User.count({username:v},function(err,val){\n    if(err) fn(false);\n    fn(val==0);\n  });\n},'Username exists');\n\nUserApiSchema.path('apiKey').validate(function(v,fn){\n  UserApi.count({apiKey:v},function(err,val){\n    if(err) fn(false);\n    fn(val == 0);\n  });\n}, 'Api Key wrong');\n\n\nUserSchema.statics.authenticate = function (email, password, fn) {\n    this.findOne({email: email}, function (err, user) {\n        if (!user) return fn(new Error('cannot find user'));\n        if (user.password == hash1(password, conf.secret)) return fn(null, user);\n        // Otherwise password is invalid\n        fn(new Error('invalid password'));\n    })\n;};\n\nUserApiSchema.statics.createApi = function(user,fn){\n  var instance = new UserApi();\n  instance.user = user;\n  instance.apiKey = \"asdasdacas121213dasasd\";\n  console.log(\"username is \" + user.username);\n  instance.save(function(err){\n    fn(err,instance);\n\n  });\n};\n\n\nUserSchema.statics.getUser = function(userid){\n  var user = mongoose.model('User', UserSchema);\n  var query = user.findOne({'_id':userid})\n  query.exec(function (err, user) {\n  if (err) return handleError(err);\n  console.log(user.username);\n  return user;\n});\n}\n\n\nUserApiSchema.statics.getUser = function(apiKey,fn){\n  var usAp = UserApiSchema\n  var userApi = mongoose.model('UserApi', UserApiSchema);\n  var user = mongoose.model('User', UserSchema);\n  var query = userApi.findOne({ 'apiKey': apiKey });\n\n\n  query.exec(function (err, userApi) {\n  if (err) return handleError(err);\n  console.log(userApi.user);\n  user = user.getUser(userApi.user);\n  fn(err, userApi);;// Space Ghost is a talk show host.\n});\n};\n\nUserSchema.statics.newUser = function (email, password,username, fn) {\n    var instance = new User();\n    var apiInstance = new UserApi();\n    instance.email = email;\n    instance.password = require('crypto').createHash('sha256').update(password).update('salt').digest('hex');\n    instance.username = username;\n\n    instance.save(function (err) {\n        fn(err, instance);\n    });\n};\n\nUserSchema.statics.resetPassword = function(userId, callback) {\n    var newPassword = '';\n    newPassword = newPassword.randomString(6);\n    var cripto = password;\n    var data = {} \n        data.password = crypto;\n\n    this.update({_id: userId}\n        , {$set: data}\n        , {multi:false,safe:true}\n        , function( error, docs ) {\n            if (error) {\n                callback(error);\n            }\n            else {\n                callback(null, newPassword);\n            }\n        });\n}\n\n\nvar LinkSchema = new Schema({\n\n  user: ObjectId,\n\n  text: {\n      type: String,\n      validate: [required,\"Text is required\"],\n      index: {unique: true}\n    },\n    body: {\n        type: String,\n        validate: [required, 'Body is required'],\n        index: { unique: true }\n    },\n    createdAt: {\n        type: Date,\n        'default': Date.now\n    }\n})\n\n/*\nExporting findByid function to return back a link based on an id.\n*/\n\nLinkSchema.statics.newLink = function (text, body,user, fn) {\n    var instance = new Link();\n    instance.text = text;\n    instance.body =body;\n    instance.user = user;\n\n    instance.save(function (err) {\n        fn(err, instance);\n    });\n};\n\n\n/*\nExport findAll function to return back all the links. \n*/\n\nexports.findAll = function(req,res){\n  console.log(\"Retrieving all the links\");\n  db.collection('links',function(err,collection){\n    collecction.find().toArray(function(err,items){\n      res.send(items);\n\n    });\n  });\n};\n\n\n\nLink = mongoose.model('Link', LinkSchema);\n\nexports.Link = Link;\n\n\nUser = mongoose.model('User', UserSchema);\nUserApi = mongoose.model('UserApi',UserApiSchema);\nexports.UserApi = UserApi;\nexports.User = User;\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>TypeError: undefined is not a function\n    at Promise.UserSchema.statics.newUser (/home/hiccup/nodejs/fiokijs/models/users.js:155:9)\n    at Promise.addBack (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/lib/promise.js:128:8)\n    at Promise.EventEmitter.emit (events.js:96:17)\n    at Promise.emit (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/lib/promise.js:66:38)\n    at Promise.complete (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/lib/promise.js:77:20)\n    at handleSave (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/lib/model.js:331:13)\n    at exports.tick (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/lib/utils.js:408:16)\n    at null.&lt;anonymous&gt; (/home/hiccup/nodejs/fiokijs/node_modules/mongoose/node_modules/mongodb/lib/mongodb/collection.js:322:9)\n    at g (events.js:193:14)\n    at EventEmitter.emit (events.js:123:20)\n</code></pre>\n\n<p>As I'm new to nodejs, it is very difficult to understand what this error means or why it happens. Thus, what does the error mean and how to get rid of it?</p>\n\n<p>Edit: This is my newUser call. </p>\n\n<pre><code>app.post(\n        '/signup/',\n        function(req, res) {\n             {console.log(req.body.username);\n                User.newUser(\n\n                    req.body.email, req.body.password,req.body.username,req.body.apiKey,\"pocket\",\n                    function (err, user) {\n                        if ((user)&amp;&amp;(!err)) {\n                            console.log(user.username)\n\n                            UserApi.createApi(\n                                    user,function(err,userapi){\n                                        if((!err)){\n                                            console.log(\"Api created\");\n                                            res.send(\"APi created\");\n\n                                        }\n                                        else{\n                                            if(err.errors.apiKey){\n                                                res.send(err);\n                                            }\n                                        }\n\n\n                                    });\n                            req.session.regenerate(function(){\n                                req.session.user = user._id;\n                                //res.send(\"Success here!\"); \n\n                            });\n                        } else {\n                            if (err.errors.email) {\n                              res.send(err) \n                              console.log(req.body.password);\n                              console.log(req.body.email);\n                              console.log(req.body);\n                            }                           \n                           if (err.errors.username) {\n                              res.send(err) \n                              console.log(req.body.password);\n                              console.log(req.body.email);\n                              console.log(req.body);\n                            }   \n                        }\n                    });\n\n\n            } \n        });\n</code></pre>\n"},{"tags":["image","node.js","base64"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13133765,"title":"I could not write image from base 64 format in node.js","body":"<pre><code>This is my base64 image.\n\ndata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAgAElEQVR4Xu19CXwUVdb9S6fT2RMSkpBAgLDKJqK4gooObrgguA0qKqijzudf58Nx/dSRcVcUdcYZxQ0ct3HXmVEZRWFcwRUVFRcUBNlJCNm7k87/nvverXpV6U4CJAaHtL+2O011Vd13zz333PteVSeozsdOPQIJO7X1ncarTgDs5CDoBEAnAHbyEdjJze9kgE4A7OQjsJOb38kAnQDYyUdgJze/kwE6AbCTj8BObn4nA3QCYCcfgZ3c/E4G6ATATj4CO7n5nQzQCYCOG4ELLrhgSHJychBnUE2Pv/71r9913Nm075EvuuiigYFAIAVHiUajtTNnzvymfY/Yur3/rAxwzjnnJHXt2vWU1NTUqcFgcBQ9kxISEhQNjGpsbFS1tbUNmzZt+m7Dhg1zS0tL5xIm5i1YsKC+dabsWFudeOKJif369ZtEtp4VCoVGJSYmJtu21tXVNZCNy1asWDGf7Hyho2z9uQCQcPvtt5+6ZcuW6wj9JZFIRNXXa79iUPCkAWIg4D1to6qqqtQPP/ywisBwSzgcnvXRRx9FdiwXxz0b2HrS5s2bb6Qt+sJO2BvLVtjb0NAA9oOta9evX3872XrXz2lrewAggdAfgMFPP/10dMKECdndu3efQ1FwLIwl5KuUlBR+JiUl8cBggMhw54nPwAgAQk1Njfr++++/ILaY9O677y7ZwUCA8YO9CWRrI72m5eXlPURp7UScOzEa20l/s60AN2zFE+MAm2Gn2AsgwFYap9MJBB//HLa2NQAC06dPD+66667Fb7311tlLly7dh1A+sJgeiARyokpLS+NIh2MR5XjFYOAzAonKyMhgu/EZnhgUDBgxQQ0N6tGfffbZG9s6MJdccskIcsZY2ueAnJycfNlPWVnZBnLQcnpdRlH42gsvvLC5FcdIoJQW3GuvvbqRnWd++eWXY8jBjq1gtPT0dGY22FhZWenYCiAAFBgL/DvsBFiwHUBBqaGGbN4uW1tx/pqVWrtha7Yj54dyc3MPff/99x8hh+ZUVFSwoYgCGAq0UxpQ5eXlTH14IDIADDwxCHA2Bg5AAGgwINiPedbSfg+iwV7UmvPBNiQ0k3fZZZfTiJIvARjxGaITT5wTjiuf4ZxwnJUrVy4mwD1N+XvOP/7xj9WxjgU9M3jw4EM+/PDDR2kfuXAw9kXf8dgKeyXdxbIV22dmZvJ4iK34DgVHLZ3jIV9//fU7rbV1W7ZrSwAEHnjggf3/85//vNytW7d0RPS6devYMAw2UI9oxisGCoOBiBf6AzgkH8IJ+Bv/LiCQCKJ9rKDnUNp3VQsGJ9xxxx0TKZpuo+P3wf4wwDiG6A684nOcK8Agn4szli9fXvfTTz89SWD8vzfeeOMn63iB66+/fl+K/FcLCgrSYQ8Bhs8VtuKxPbbiu3gSCNbSuQz58ccfy7bFua35TpsBgKI/7fPPP19cVFQ0gJ58bBo8tXHjRifPicjzn5hEJF4xiHAA2ADOkXwpKQE0SQN+67Jlyy7z7Qe2cEKlXJyRn5//ZwLZFKFg7FO0BxyGc8HxbP1hO1D2jfMggVZB4JlG0f4gPqfoT6N0sZCAvmthYSEDZ/Xq1YrSh3NK22MrgIrj4kn7vp2Of3FrnLkt27QVABJOO+20s2mQ76N0r2jw2YkAwNtvv8103qVLFx4oPOQVDpYnnIHv4AlHCBDAAqBEMIBEMG1TSamm6Isvvqik3QXI4cFevXoVUcQeS9sOIceP6dmz5yCJetCsUDOOLflWQIbtkKpwLBGqItLwigc5HN+755NPPjmf0sppVK4+bNu6Zs0a9c477/B+6NwcO21b8aGAvTlboY1wXMOeNQSm4lWrVpVui4Nb+k6bAAA1LznnLTJ8P0Q/HA4Ke+aZZxTRpMrOzlaUh1VWVpYzMLb69Q8KDBe1jH8jwabWrl3LjhOg0LHOo33ff8stt6QTzV9O6vn39J1kMASOh3PA4CPVgAXwXWgPpBcpy/yDg+3xXeRkYQc4AgCEPdg3nfdDJSUlfej4ByP6sS32TcJRkUBloA8cOHCbbcX3kU5wPLGVzv9/CWB3teTMbfn3NgHAuHHj8il61iPygX7QHwbk22+/VRdffDEbc++996pBgwbxgMnDjv5YDCBMgO0p17KmgEOwLR3vhZEjR55Kx3uCnDwewhHORcrBMSSvw2kkANnpUmkg0uUJcOAhjoYzkSIAIAEBvisaBNFJdkbJlgA1tRhc//rXv9SSJUvUtGnTmLnuueceD+Cx/62xFeMIEAjg6XzeoAAYuy0Obuk7bQWACeSE5zEgKG0+/vhj9cEHHzAIDj30UD6Ha6+9Vt18882KqJkj2h4QEYA2CIQVpB+Av6nG5jwLhiBnlk2aNGk2RfVFPXr0YKcTLXPakYc4F/uQnkO89CPHBhDgZPwNINhshM/hYAB6n332UbAXUQ/qf+ihh9TJJ5/MhyZWUn/84x8VUgS28dtq24n9i/22rQCBiGjaZQXZpumzjR9tAYAEcvIlFFG3gOIxgFQ6qdtuu02de+65nmh/5ZVX1FlnncUGw0A4BYNhGy5/I+qMo528ie0QmaByRDzV4PXk/CAGGjke0U86gP9dhJ6t+HEyovwlKm0BKhWLVAHYRkSoLRZhI0Dct29fjv4bbrgB5abH1vnz56spU6ZwFJNYbJWtcm5yTggmMA/Oh8a3O9m3po393zZ9gDFjxtxF0XYhVDbV6IoaQerJJ5/kc7VzPd6DjqliUI8//jg7A6IJDxFFkvvle3bTBNtJmYV00r9/f4XoR3oApUOoUW9dLVy4kCMPgATti+PtwWspKhHpIg6RWuAIW5fgfAFgnAeYLp6tVIpySohnq7/ywBjC8WKrgIECZgxVA2/ukACgSJxDBp6BwSZlrhYvXqwgkGSQZXBs1Q8gPPvss6wTABo4cI899mAqJ5Gl+vTpw+9JdStqi6o5c+Y4zRuAZr/99uPIguiEcMMAIwU89dRT6rvvvmMAwDlgCj8A7POw2UdAaFci+HfsH+CCGLQZA4Cg9jSnteZsBQsA8N988w3bise+++7L9oG98H2MF1InlZpq9uzZjq2SIqjKmUxNocd2SABQxM+mAZiCSDn99NPVpZde6kSEnwGaGygbKP48CedeeeWV6s0331Q0GGr48OEMAOgCAAJiDyCBBhgwYAA7ngZMDRs2jNNDrOiPJ8xsAEgXDyyDcxB9gPODAz/99NPtthXnIWUvjl1FbHP5FVeoefPmOTOlQ4cOPZ2C4ZEdEgAUabPpxKfACaj7UQnYURaLAZr7zON89ARMfwCDc/fdd7PApKlWpn7QPI714osvssOhxCE24azDDjuMPwMgZI7BH/2xGEBo2Rai2A7Hg84QdY7P4CScS2uB7d+uOVshLGEvHsR4Z9DY/m2HBAAN8GyiwymUCtT999/viYh4AxMPADYNN6AraLqDUQsEN9x4I5dfABpSB0owMANKTmrROkIPpdQZZ5yhIMigFeIpcr8KF1DY4JD32AfAJRoBip/6INsEgFi28memG4r3zz33nLr5llsaid3qiO3OO/roox9uSxBsVxVAs2uFJ5100iu33npr7nvvvdfrqquuUvR3qwAQKzV4BsRyuAwKmADdwGuuuYYjHxQMRQ4Rdvjhh3PjSZS0vf8ZM2awUgdYkGsh3vwi0Ha6pAB8Zitz+Y6oc0QvGAcVQHOMFwvsALTNbE3AIB1Rel3544/hUHJyiKqOuRRk43YYADz44INTKDfNxgCjFn7ppZdU7969txoAQrV2HvSDQZpCm4iCZ5KyhhOgmL/66isWZxCK0oL1gwsnBAGG1ADhCSBAF0idb89BSLvZHmSZupWVS1Kq4hxPOOEEBfu3BgACsHiAt1vhAMo66n0g7ZDueZQAcNoOAwBStpNJkD1Ca/lYvQIErRV9EhWSA8X5NtVLhPC/GVpc9v33nGYQxXDIokWLWGEfeeSRDvDsiPO/p5axeuKJJ7hXQbNsjuMAnt12202NGDGCmQVOhy1o+kCdo4eBtCPsIaBFowvn0xoAOPnepDab6hkUJuol9QlAoDtwbOo9TKWu65wdBgA0kCWU/3+A+qbJCjVr1qy4uTAmDVoTQE40WPnPiQRrO5R49913H1MzanOUgXPnzm2V82PpkXhgkZQgzSHk/euuu45ZTrqKcOghhxyiaBq8RQDEjHaxFToHy+R8aU+CoZRKUBKgNBz1Rcccc8zGHQYAOBFS5J+QOh0BwWXnQr/D/X83m+8RCWZAbEaAIAQABGhwCsAAJ8Si/a1xuP/8/G1pBgI9XyTmgAaR7ceOHasoFTYrArfVVrEd1VVJnz7zRo0apfvqbfjYLhGI8yDav5Jq4+uRYydOnNhiCpCBtfOuvwHjoUYT/TIY3y1bxgDA9zFzBoXf1s6X87HPVQAAEH5CKeGCCy/k3gMAgBQg+sA+F0kTtoiNaavFcH7A4+/crl03UfSfR0L3mTb0Pe9quwFADiihGvtbGoAg6uTmNIC/5vUr30gcCsSgiwNsAJx55pnqd7/7nRON2wsE22HxGADnAqcsNT0HysmK1vwzGAUEOKG4tsIWs97BpnzH8Wb/PDbmfUIgcAZNfLV5D6BNACCIpD71chqA3vEA4O/sOULHNxj2QDhRB/o1E0hIAZhpw3HQMqUp4ZgAiJfb433udzifhwDPZiG8R3qiV5SgaGVDOEJEinBsYqsAO5atPoazwS4ASAoEjpk0efK/2jr62xQAtETrOQLAxK2p70Xk2YNtO10GAJ+hbOtOzRz00i+//HL+mxafthj9rQGCCD2b5j2fCUWbriQzBZ3TRtIgtBiFe/mYGYQ4bK608/9bPLA7dpvjBJOSRtKKq3ZZJr7dKUBQSRrgQipV7rKFV9xIkHLHT/kxokEGKYNKM3Tz4HTMJo4ePdpTfrXk6Fj/HovyY0a+6UbaAMF34XxMaqEVLBNCtpNF5/j7G55jyBgI9duv7vt0mlqv3qEZgGYBh1KDZYndYYsFALvJ0STibNo1AyNOok4YT/9iiRlavheSCDv77LNbJQDjOT9WlItzHCdJ1CMNAaCWg+B8NKEwi4m5hnjNK7+dHiD5ACD2yiud+w9n/+Y3fdvD+W2aArAzmnhZRgDoGzPyrYWekueaHRgz0HY/ftDgwdyH//3vf88s8Ktf/WqbUkBMgefL81Fc0mWcboPCBkE5OR8P6oayAPQofLOgJZ6tHtFHx26EvdZTAikxGHx46tSpU34RAKDlUZfTQNzkoUGrp+3/vIngsQcAg2KtGsZ7aAC0gGkOgtcYStVh647mUkFMyvcLvVh0b0e/xQBgM6h/TBCJLmCGi1XNxDiOnA+c77eV/yZjKK1OoAmtF38RAKDFEbnUn/+BDMqCs53WptC5n+LF4fS5kzp8Tqd/0P9GIwDnY7EInI81hv5GT0vOF8qPl+e5PDMNH6b62PnY+TyN1hwwCAEaS9fEFHct2OrYaWyFbdTt/J7WV/RrL+e3eQrADqk3fz0N3JX+wbQHX2jURj7KvFiDwJ9pz/I49Ovfv4J645koveLV/X4gOMf2l3MWxXPUmh69ON5uBNnUL5GbmZW1gaI/P1Y1Y++D38OOZiLdBrrYTAA499RTT73vFwUAWpKVSit1vqYo6OlEUaz8hsGAX+1BYT8bIFhOdwCQkPARTT5Np8mai2iZ1sHNRXwsMeoXeM6UrLmkSwSe39k2G9h5mhjgVqr/j6PP+tsga5LLYzk+hq0a4hrsdP5fnHzKKcPa0/ntwgDYKa2SOZQMeIWeiU6eMxHAkRAj2u1ItwdCBoD2E6FKYCRdbv45LcPal3Lvey31+uNFfhOF76f6OH87wDD/HkpKuqRLbu5CmlZeEMtWFrC2rS043bG1sZEwF92fun8Lf5EAwEm/+uqrN1J0XyEOt0WOODtutMewmlT5lcefeCJuusAP6jzW0Pf5lit+INgRGLOhY/K1s53VdvU72RGOPhbD59T5O4Mo+m80VXxFICHhxri2WmnMTmcO0H320uqqq2hhzQ3t7fx2YwA5cZqmxTTZmSLi/A73UJ5lrac7RdO+9eHw4xOPP/5Ue0CoJfwm5cgDYjm/SeRbChwreT053hJnsfJ8rDQmJVtySspo6tC9i/N6+eWXHyQQbLut5rrJSDj8zHHHH3/iz+H8dgcADkDRMYcceoYgPxa9e4yVC0j57BLQb3+JaP9o/4BQQ+gqKpGus4WgLdr8ke9ZcGJHs0S/oXUPe5jtnBpd0hgARSmJzgkdOufWNQ7gNS1p8Wrex3Soz1ZajfQOdRcPobq/9r8GADCE0sH9NIhn81jEinTfQGjfJ/D1cTV1NeecNfUsvdLUenz8xcdD0oPpX+Ajf33vAYLVv/cINdvxlvPtiPc7XppSsIH6HZ/SVU4j/OdFtt5D3zvPbyvbpA3jr3je02e82ri6evrUs87648/lfOc82vuA8+e/PoVmi2djvZ08/ANgDwpoWpZr5ed3nTpx4vFzYp0jrQf8lJwyPFbk+xddNsn3sagfal2i3gg4J8X4+hNJAXXt6WeerVeGWA+aHidbA1tlK65lgM2FBXnTj514/H8XAObOn9s/JSHlOhqUSRhMWU6NCJeLN+WCzRpaf4flT3KJNxZ9kuOmjR8//s5YAFi0eNEFqYHUP3nqdWnIWHm/SUPHF/HsdHGwlGx0wHjVCm0bTa0r73fyb6ct9zr/lZKEhNSb/LZiG7kVjd9WLPbEGkTMbkajDXeOH3/stPYOSHv/bTYbaO90+uzpKcXZeb/OTyo+NqdL7gTi/QS7CoBDhE7xXm4bh366vWRbtqlJqHqzIrR5zm+O+J/Z9nFmPjUz9aD+B62gfeTb3T3PhR1+qrfyP/cg4Gh/ne53Pg5qKflAYuLzkydPPg4fzyZbCxKyTk7OKzksOSvv17Q/j622na2xNRSteDc7Wv5Q3ecbHj54+vR2v0dimwLgnMePyds1NOqGAtVnalIglIQrgMXZNgDivW9uW1wGVpW4pXR22R3XhtYUzZozdQ4LpZfffvn/5QZz/8ytZ9PQARhsMSedON6/Fe3SfYtXq2u/ezuRiP606jV7ZW/85KdI4W5XV2f2PichmJyES9TwaAt70V5Ob9yypftH1/6hqix5Vp/pC9pNFLYJAI6ZNTCvJhS9siJcc95pBdNSBqYPd+7O4QyiL4duzUBhpQ0WXIAhJr8zUdVnVK/NCeVd8vqxHzyK29LRurwPCAAj/E73iDh/K1aca3UemytT2Q56Zm/55pWSJY98nVS25rz1+09Lqep7YIu2OuLRNwaxAgHXLGB9Ad9jaOZRKi1h9dpQl4w/5N+0rokQbotUsd0AOOyRkt9uqQrfWh9tzEhMDKje6f3UtP43q2CivjEichzEX2sd7t8OKYFux8YTQUtKP1NTXz2Vpl0pp4YCKqco7fUB4SFTxqQf0W1Y5tBF5CC382jndWvg/fMNnqaUTfXmvQwyz8yFqxoHvfZ/tcG6LakBurFINL9ElZ94r0oIpWyTrX5g2LY2rv5KVd18lGpsQOeU6s284Fvhsvqz+j1b921bOF72sc0A2PvuHl3T0xMfK62oOzxIjk9MhKjTr/sXHKamDrjUue0a1u9j9QxoOpYWiJcSMM06ZMgQvdZORdUZL09SH675gAHQEMVt5RpVamZoU/eCbiddmH7p3gXB/JtidePsyI4Z5Waiye7S2Y7X7xtVrwW3qaz1n6kEsjEQpFvc0mvjoINVw/ib6X2Q7cXVw1iz4Le1JRbADSewrgDCF9FfOuNYVfcVXWhDtkYBAnqSuqgOpiRMHfBU+Km2AsE2AWDUrAK6HDb0amVduC+c7wdAIhmwT7eD1bnD/qBSg2k8MBgQ1Lpy75vmNAEWWIIG5RZsMPbGd69RDy6exU7nJ92Or4H+10hASEhUDd0Lekye0X3mcbTfE+OpdxZ8xtmxGjWxWrMyQFlfvayKPnlUBcjpCeR8fgUQiAkCg8eqpONvU4FkfWMqHAO24hYv9p3IYtmM9QS4etm2dfMTl6nyV/6qHV9P0DcAiBIYGolqGxPVDcNerr+6LUCw1QCA8+siifPD9Q09tfMp8oMU+XyzRbAAPel9IJCgirP6qt/u9ge1a/7ezo2gMUBYRoXlVHL7EwwMyiSUQxBAcocMGFgR3qKmv3WZ+se3z+uor0cXDiAAAPT9hBEdEGe7Fw7/7eU9r5pA+xvnONvqyMV0fjOjKL2KlOXvq+L/3OaJfDheA0ADIdi1WKWfcJtKHngQg0DuE9icrRCOctk6C8jqzars75epyjcf0zaZJ6cBiwkMIO75al7DBXQprr7l6jY+tgoAoH2VEP2oOtzQO0hRoCOfQEDOFvrHK5zPTwwQ2KD7werIvqeq3fJHqUQK19Y8NteVqn8ue0Y99Nm9al3lOlpwgWsDqI/A9b1mgahJA+R9Hizq4jUO7zbs1KtKrsEFlONizjD6crtzLqZD5+RG83fS6i9U91evU4kqQpFPtvkc77CAAULygNEqfcz5KjRwrEoI6NvQtvSI1mxWNQsfV1v+fYeqL13LUa8B4NK/sIB83hiJNkbqGmfs/lbUf8PMlg7n+fetAsDo+3u8urkifGiQBsKJfgOCRAaBG/1wPv7mSDCAyErJUbsXHKD6ZQ9VPTLoFjBJOSo7OVfV1teq0roNqrRmg1pW/o1avP4D9dHaD1RdfZgdz0+KfGI/43wDAkoDPDDc2NGAIEaoHZG9++gLB1w4LSspa7IT9a2IdGwiUY9XLPtOf/8xNfCnN5yc71K/jnzgmYFu3jMg6LZEiZl074IBY1SweKRKzBugAmldVSCD7hgWrlHRivX8rF/7lQov/0CFv12oonV0D0She5v2HTBoFnCZAbY3NNRWRH+z9yLl6Y9sDQJaDYCDHuh58frymhmu832537AAO14YgF8JABgciigeHBwR/8Pf9BpKSVQVVWEVIQdHyNH8Cmeb9w4ADBB0/hcW0GKQKVI7XwOiUX19xdArLh5dMPqfcqdPJ7LdEOd3/pY0/sbqILRnccubYRveUT2++5eV86EBtNNx/pIGhBkYEAQADQx6xTb0NxgxKT2gIpXUo4jQuVKLx+R0drzken4v1O8Awc8E7t8N4WhFpC46es/31Odb4/gm49Hcl0fOyiuK1Aa+o4FNQ873Cz/8DQN1xOt0IFEv6UAPhPvUAEA5F1RV1QQA4/AwAwFNHQ2IetC+AYSkARcAWgz6WQBgOKrHUe+cP+j80WAAdBrBEnSJlXa6b0JGQIBtcf+BtSTecI8hVCF5S55VeV88a8SfcbwV8R5GgOPhbE4T2ul41WNBtqYmqvpqutSd5g/Z4QQCdja/h5YhW/yvIgBtYIjNhhHqqurfWvauOnhb9ECrGGDvv3R/sCocOTPJKH4BgZ33JeodDWDAIEBg52PgBQT8nqgylKiqa+hHFOrp9rBkfFgi3wGASQEGCPqWMYYFOPdrMcg6gP4tI5CpJvU+WR3U7SCVGcz0lJ3oFPL1exYY8B30KczdufnmERCjouZT13+pij6cpVJqN3hEn1C+/1VHuxGI5hWfwf6kZGKAGmIAOBkM4AGApfg9yl8DJLYQROcR34tGa6qiZ+29UM3ZWhZoEQCI/toq9WMwkVaoS/Qb1c8VgKn9tehDNWAJQKZ9zQbwt8MABggAQICm1WpqaA0+AcDvfEkFnA5EBOIVlYCkAoqGYGNI7Z22rxqWPkyN7T2WhKb+DSLJ/61pQze3LXoAueXfqi5rFqqs5a87eV+DGUu3yQ7uC0jkCwBcBmC2S6LFLXVwvkQ9mEBHPWsYcTSnB/qMAWJeTarTlYFmDidV0BhEqhu+r2loHDbqPVWzNSBoEQD739/j+vKqyJVO9EMAguYZBF4AeCoAE+lMgwYUeNX5X+sAZgQalLpa+mEIRL/J/0z9kgocLWBSAdIBl4IU7cFcdWTWeDU6dV/aXYDLRzxjORyDsj1AQErgu5/VlKmEjx9RBSv+rQKNuP+woXjSBdT81D2COAxAvSLVELYoHw5mAJiSz9ICnvrfxwBORWBSge4XRBvrqqJT91yoHm5TAIz8c+H6hsbGfAaAUf/I9UGu+3XtL3lfBKCd/x0BaIDAVIABwis6afQ+XEfRbxwuItARhQKGCKgaN2mAEMlRB+SdpPbMPVrlU58gRItzZHrZP5vod/q2AgHX/vENpAm9i9bWqJzIelXy1WzVbeVrzALyDCZTUBCopRpg+0Ub0BhwtIuj+dUAwLCCaAJH7celf5cJmBGIIYgFFu3+duO+bQaAg+f0Grtpc+28JHI8nk3Fn1b5IgC5AWTUsS3+JNpFETML8BPkmsCORdRTc4mBAMrnV6MDwBAR2iahMahG552s9ss5gQAYYmZJV/WqMFDjtJ3hcCj/lqK9NUCQbdCcws0pAbK1FbXq/RWldN70iyZJQdW98ks1dPHNKrV2nUlzRPUpFCApGBfagykLOSjIZE31LgiIRMxnMQSgpwQ0zGGaQlz12B1CpMT6aH0kHB058i31WWtB0GwKOPCB4psra+ovc53vNn+k68e3ZTepQOge/+bQvin/pOyD0yV3NqJFjEUicDhFOItAmwnos5pquhafXnNDvdWEoitUblJP+rrWG0y19L4wKaq6JulbuknbGbd2lcUn2wMG3PWspKTE2fcbX/+kNhAI9LQyANyo0gP1ao+v71RFa+drgmNxS6Ivg36GxpSAzAJIQ3CcRDsDAfncZQGH+iUtML27+b5J/pdmkRHE9bX1V494U13fJgAYdW+PpRSZu9jR7xV+vhQgAtDK+47qlxRgAAAgYAA1AIi+pA8Q0WIwHI6q6koqD+nvXTLGqHEF0yiY9J3BMMAAADsceKJ990mnG0em6AkZUfCYgMLETGtnIm1WgJbAbWaR92WfS9eUqg+WrdGLWfj6FbOwBfM0dCLDfnpaDfl+tqF8pAKlQln08zQQh+x9AEAvQGHHGyZwQWAEovMOGPcAABcVSURBVCUI3R6B2wRyBCD25bSLdUVA7LJk13nRXbcbAPvNLE6NJEcqgok0sWt6/tAATs/f9P513tfU77SAfTU/D6ChQ5v64Xx+osQDCKj+BwPUEd1XltdxZXBA1ylqj8zjnVQjKQcsoB2DyNLCsiQrRRVnpzJDSD8eLIDfGMDT/OJH3PSAQYPDEfG4F4H08/H5io3lasEXy3XjyZpedoEAQEdVSdk7ap+ltxC+KWUhIIgJUrKJCRhdsszM9C5sABgt4PQFTOQ3nRBy28QuENy5Ak4DtdHue7ylNrQGBHFTwNjZvQ6tqKl/lfO/EYCgemfmzwGA6f1bAPDU/qL2MQVgVQEYuHo4H+1d80QqqK2rV1vKtPNH505Ru2ccp8tLUD6o3+yPiwlCFUeWYQK8zUlLVkMKu6iMZNIIDkg0IDBVi0kodPjsH23EdDPuCI7GD6Zj7Qeml5es3KA++3GdrrnZ+XC2Hwj6b3zeffOH6sAv/8AAgOeREpO7aBDomUpTkZgGEHcFmRGMc6VM9NG/BofbBdQ6wGIBwwgJgcZTB7/c8Ph2AWD/+4p/R9F5J5xvawAp9Zy+v9X/18rXOEkcj1cqf6QJ5FK/mdMXBoCKJQBs3kQ/nki0v3vmBLVf9lRdZbDzNdA4siXCDQOYfq5zxytsU5yTofp0pdvJpuifptvaBxy5enMlOX69KquiFVlwPlYlOFGsnS2AEOfLa+/1b6j9vrvNhD0JQ6oOkrODDgB4osrSA7jKgHv9Tk/AFYXSC3BFX4zGkHE+QBIIBW7e5cXwFa2xOS4D7Hdv9xkU7RcnBenHFU0DiMs+Fny6/nfKP3E69/p1CaRpH853m0CNiAh6cN6X6McrIR5/s/OpJCxKGabG511Hjk80jSWZYdQswP8ZASj0r9WA/9FIjJCi8jJSVV56CoMB5x/vUUesU1ZVo9aWV6tVZfTjjXXUQjZCD87i/C0RDDiYiMdGGgzCDLi0nDTBiofVkJVP0IcaB6EsCiaaD9ArUc3+0OhBZHN72ESz3RewUoEDAGYKN/KZmeRvOlZSSL3d//nIAdsFgMP+VvIKKfMjYke/mftnx3vzv6fpwzNkGgCgf5R8WIfLeR+0b16R/yu20G/1kOhLDmSpU4r+qlKC+tc+9NoCP/2bfQIIxp8CBMdovbwH+YEjl/+il7SkRJVC8w/Ynh1InoLjq8P0e77EPPwZO9c4G+/hePkMr5iBhwMtRvDoApMqaJm32v/zq1Xhpo/0qdAjrRv9SDaNiUaLEYSmCuCegDg87sxg/IkhSQnUcKoY8EKkVb8xFDccjnik7xckyobYHUCJeGEBR5D5qR+RL7NlovrJUxgDjn5xvqF/iL6N9EOgiKJx3S5TfdMOMFPLNFgm7wsIHOFn8r7k/6axb/zPLybvahjw2AM4cBpWFXnzud5erxQWEFgAMMBC1MGBzncFKA4bYB/062a1perQheeoULiC95dIv12Rlkc50QCA2cOkAmkKyaSQ0wp2UoMuF+02sDSB7LkCsGNGWiS/+xOqxdvKxgXAoX8rWUduLNAMoJW+5H3Jy56+v638ncjXzR4uy+gt5mwk8m0BuGk9fpMvonqm7abGF15Px9M/Ja/3b+jfyv1S/jnOlxqL/etGvI56E//Oq3YmGAAOslW9szxcvidUbdjDZRJN/87+OZJdTSCgYMfSdsU/var2/Jz0gAFUOrEANIEjBvG5MwuI97oyYlEYd2JIC0DPQhGnLFQqqyB4QPeHat5uKQ3EBcDhj5SUkvDKYQCYRo8s8NBAMCt+jDqXiNdToDr/Oy1fchCRq0X9LhBqaSJo/Rr6ZSwaqEm9Zqqi1MFaW1Dx3FT5+0s/ffpihDhI6D42ANyttIOQrw3la4+4wk6Sh9EBHkYwgPJqBCPsABizKpn3TZ4avfAi1bWULmWkfQVTqYNJIHD2h/1jaZupBtixDAgDAB8InFRh9QDczqAGRVpu4tk9H67ln7pt7hGfAeaU1KYkJyZz2WcBwBF//tofec2aApZuH6IVGsjO+7YA3LCmSlVXRVSfzJFqfHdaesXCT0c95hu08ncrAK77jRAU7+vySszUzhQQ6NwtKUA7345efdGIYQoj5NyU4f2eySQm/3v345SH7HB9TLkgBe+7bFysRr9DPwFsUkhmcZAbRXyucn5mpg+CELOBMlOo1wNK11CnAG9FIExgmEgD4Ori2bUtdgTjAuCox/o1OvQvy76l9jev/kkfZ5WMqfelRm+S940GqCPFv3rFFgbHiSU3qd4ZtHzKgI1TgHG8gMB1vruow0a3drxF+TqgjYAzke3gRNOzRD/Tts0AelcaSEY3OHt3AOYeS6oA3pZVudm/HIPCeu+3L1Z56xczZSVnJai0/EQvAITCfU0hT3PIUxXQuVlgYKCYiqBrn+DduXdUuz9mGIcG4gJg/N/7N0IA8syfzPNbQJDOH4PA5HyZC3Bqftq7P/qRc5kB6Fm6gX7WlUq/zFCB+s3AR8xxtOoX+gcbOCWlUf2OBrCM0r4Xh9hOd3WArdSxuZOrJfIN/etdmRxvgOAkDk0KGha+1OD2AvT39fI0LTLhmNw1i9Teb1F5noB5C6W69MX8MZ+I3imOz1O8Ruz5KgFZQiYrhD0sAL1grRTK6RWc0/Wu6qlx/O58HBcAx/59QGVyUiCdl3s5jnfrf3fVLwGAan1QvjRqpN0L6zzRbyKfAUCUtvL7zdzzH1U0WR3QbYqeXpbSDzoDnT7s19PR061fPnEpAbUgdwSf05wx9C80aztIAMDzBBLhNlsYQDlE4KQYYXGTTkxe0GLTRD98KqIQESoXw1Kr+4CXT1Pp1at5J+lFiSqUgb6ACwB8jiXvTlPI7g7aXT+PLtBMYC8Q6dIjOK/rn6pb/H2BuACY9NwuiyjS9m6y7MtUBBL5vBJGKgBp/pgWqFPnm4jXFYAWgFW0EHTNSqJ/+uC8YX9TucnFHgBw5LMYpFf4GkBgBjCNJfYMZ38Tj1pniDPdaDfRaKLbYQoT9Z4yTrSAk+ydlO05jp0a9KaGDQwD8bEdgYm8rIUmnn2WzFYDlsxh9IYyElRGd1MSWloATSQNAMMidlVgTxQZzRBrcqhrr+DcLjOrW/yBqbgA2Ovuoqt26ZVzXdNVP9ZSb1794nb+8F5W/DD12/W+Hf30HuJvcxldG59UoP5n2ONc+kn0S7XBPQDRAXiPYWMhIOHvJGlN5xati9jzt2u9Ezm249zoFZDY9GnkhfWRlW78wANcrGsTefrXiMJg5Vp10Iu/1qCmQqBLP1xDafBlQMmgAp2bMhAO9peFeg4AXUQ7+rUYxNKz1C7q6rw/b4cIHDwjZ9guvfM+z81I1vlYSj9R/3SQJm1f06vXNb/b7fM0fqAB6LniuzJe5DGyYII6vNfvzAUmqP+tawtMBzDR6f0bxxsMOKwskYtBxpNGkPs0EEROGrCcbbaz+/gCDGH+RsrTEukx86iwtj8FmHOxewGiB/hGFvTc56UzVXb59+z49KKgSs7UPQFdghowWPlcrxkEI4jD3YrAvygENielBMo2rqrpudurqmqbNQC+mHd1xhPj9u41KT2F5uHNpAwYwVkLbzd/zHtY5Wn1WkAQAYiy76cV5TwFPL7PZXTF0DjnKiNW/s7MH/UgnAaQG/12399oNS26DM1zKjDCizO8A4Sms3icfmV7szN+8daW8TDg5AhnPzYLmRITvQZu7pi00OeTB1T/Lx/hQ4SyAyqjUPcERATq90Ya+OYFWpoeDldHVcXG8HkjFqhZLTlfeDTudkP/kp+xYX3NK0fs1Xv/LDAB8rC5MFIrfrPsydIATWp+SQNWCkDnr2xjNQNg2u5PqqxQIQNAryo2/X9yPPcBHAFo6n9b/fGYaWfzmJn6GyITDnGbPJoJNCNY3/HrAAcAluJzRsdtN/E8gqU9WAU4QPICygGidfVS+vrP1X6vna/TAEmAHEoDsQCgUwGmgF0tYE8I6fc6BeB97ZYGtWVd/Z10uVirbzMTVwOI3QDB8hUV9+87tHDSrn27UvPCnfzxXOzB7V60V61eP9bwgwEcFtC6ANFfTUu9sMbv8j3/TesNqCliSj+Z/AHt6z6AOF7EH3eCOER40A1n2wwAR2sQSJ1v3gtYHOHmzuJ5U0AsAOh40ZNP+t81XgwYfCAU5uGUhH8z1QBfzxipU4c8cyTdzIA6PrS/7J5kP2atTdQLA+i/Rd1bKcCkAgFDAy01L/0xXB+uarhqj3fVLa2JfNmmRQDIhvnXZJxA7rhpn6Hd+u/SJ4cjVi6N0sJMz/Q5+T6OAMT6vhVU/mHBZ+/MEeq0Xe50o58crjuNhvqNpnBYgMfbe8q2qJOoF/HZLADEMZ7oddlEe9hMGrGbdfmpU4P+gFnAYMVhIcMq/k6gde0iM9Hu8y5U+Rs/5d2lUkMohRpDsQAAlOmqQDOBtIf5ughy/OZVYbVldWRBMIPIdIGiLtPWPVoNAN7tdBUsVJmT6yLR3w/rnzdsMAGhW146K/MohF8sp/s+q6Qp3/WrK5n+R+QfqY4uuVQvMWdxaVIAop/rf90E4uqCfW/V/3b0M71rygcI+NIxOMLU4rFvGuGbybPEm6EVPZIAnAGCnIMzxDiGAYRmIwMgBpeJXqcc1DStb2PTqPp+/BfV/9untA6gXkB6gV4nwKzieRqmMzSP6wqrNkZU+eqIqlgfmZvaJXj78Hn187bO7e7WWwcA6yjD/9Rt302ba35NVymf0K+4S3Gv7lmqqCCDLn+iuzXEAIIIwLKN1P0rreXLvEcVnqLGFp9jSkA4Wi8A4XRgegoaBHb+t07CDJjb0dM3jJC1hm4v3p/3RSNIxLsloMwIylFED9rLzgQUhgOsuQUXBAwAuxR0nK+BmvvD62qv96+jXdEKHhLYWT1lcqgpAOoqGsjp9apyPTl9XXgxrYh/JpChHtt9rlq+rY6X720zAOwDD7+r2zAq0scu/aHsoKzM5D3zc9OKc7vQCpysZJWRHlIpqUEVSg5yXkb0I/+Dwg7reQHdSeR4LfYsAQjnc6fR0wG0u38SdjpYGABWpGnNYc/zewEQtzeAfZmKwSR4Y6atP5gHjJdsDeIoA7f8NAzkCEEBAZ1fUukyNfb1s3g/sCyzB104WkuroasbVF05PcnpdSTqqkojSxrC6sPsHkn/qY1EFrSF023ftQkA/CgceFtmXmIobQQZNqh0c03v0vKaEnqfl5oWKonWRjNCoUAeqO6iMXepPXsdYmb9zBJzinhb/UMEavElAPA6HwjQDjXdNnoleaGpFpRslYC2UPT3ADygMFTuHSh9DtJ+5n/TCtQSosIAGnCeuQZuBrkdwTq6Ynn0XQeq+i11q2hJXGV9bSPdGUKtomVjy1OzE5fRrpc2pkSWDH1aVW5vlDf3/XYBQGtP+LWlKz+hgRohcwB6BtA0gqSt7J8Acv3PCVPnXem9m9vH+NR/cyVgU1BYJZ1ReCL+WAii2rHzg0ECKJ/h4FQaBgD4DEyArp0pU5EOw5F6lbzxm8FTTzllaWvHqz2262AA/EiXMCXs6qz74zUApv0rAOCgk/JLs4DWSFoF+su/BocJ4jtDxJozhWs5TZhBopcHHefAQtDHAIYFTFHo9gKM0x3gSYqSOQH6G8veE8t+HHf2Scfpnz7voEeHAmDe0pUrafCKmQFMz1/Uv8wsivPlRJ3oc6INjtaLOuA0N/c3k/e5anDZw1tK+noDBmjsfPPwVKKmGnEA6WMBaQNrlpLfDtIXwUS3bJj62+PHzekg3wu2O+7wr321ciP5vauz+pfFn04DPKFoVQD+s9TlknaiNFu4yeKJZi9D2DOEsgDE1gLectECkCYB92H1AtxWgGEkk5Kc/QJoVjmq0wB0Cj3raqaff9QBf+w4D/js+rlPRAMgoau9+JOZwAKA9F7sCMTgMvs6AlALLEw1N8nBvs/8FC8aIp4WsFNBLLqUMlHj0T0vPo7J+ZL77QmiBprdqamL3Pm/R49qddu2PfzToSmAROBGcqwFAN0B1Ff/mJzr5H+v+dx4saIdkS9Twl5nbn0JKPu1NYJbFvpKQHNa2vcCACMkJfpNNeIFAF35XFszZ9r4A6e2h2Nbu88OBcAbX6/6hIZshLv0W69A9gJAgKBNcsfZ28xxeu7CCltRArqAMWWc0Qd+kSis47YBXEVigt8CpaYopyNoVSZ6WrgRv4by6EXjD8Q9DTvs0aEAeO2rH2eS86c5AEAVIO1fXXOZtR/WaUrtzSnXLdnc3O+b8nUEn5cJhEHi5/04s4fiKl8tqPdH/8jgMceSV8NU3NM3awRx69zaSN3fLzrmwJM7zPsY4o48+KMLFk8sLMp7zl7/LwCQ9i/OT5+kWwcY/cd8II501gDwYLdcAtr6wT+h5EkhOIpTMUjrWHgfDqd/58Uj+lIzzRLuds57CEErFUTwK6UN0XP+95jR7XIb+Nb6tUMB8Jen5mfkFOZsLCoqSHbuLUCO1peBubNvVgEmfTffYOsVSPFavP4uX6tLQEdjaLZx28QaFE5KkJ6E4EJAyAB1n3p+QAvWquqqdZWfquLp0w9u918FaQ4MHQoAnNitT74yY/iwwRenpiQb9W8tBDVpwGOAkd3sAPp3iVZ/BdAcxW9VCegAS2idHEptXXa+5iDRfpp5DCu5XUqXkWTOooZuC7tp44Yzrz/zuNmtjdT22q7DAQAW2Fhd8cHofXcflEw3acQFRjIJ5GoAy3yTe5luaVtebcu9gKY5fmungZtNBbJ/o+wdR1sgcJ0vQPAKVey/jn5AY9XKVXNnnH9yiyt228vp9n47HAA4mb+8NL9w7epN8/fac/igrjnZdGdud+JF1v+ZaXk32qz8zwCwxFfc2T5/NFu52g+W2G1iQ+Gmvucox9yAxUZeHeAyFPBaXVWp1qxZsyC9MfGY6eef1K6TPK0Fzw4BAJzsHc/P77J69ZrZA/r2njB4YF8Vot8PcBjAqwFNzGnRJSlAHOaldx/92jndk5vNdlbOjgcAfbGnldtNLtDRrysAzgrW/usb6lXpplLK+zV3Jv/0+SX0O0cdmvd3OAawT+iah56fHA5HZgwe2Kewb0lPAwR7Bt4McCtLwNhq33VQTLYw7eWY1QQWYVrOFadzAcAAcIHQQEq/vLxclZWWLUlJDl0wferEBa2NzJ9rux2GAWyDp8+eT7da3HJudV3txX179Sgu6dld5XbJ4uiSPpzdw4/bAxDKZ9/YijzW8vAYbIHvWSUgg4Wv97OpXf8tJSm2qamuohtRVaqK8vIltNDl9tDqL/HrZjtM1O/QDOABwvT5wewh4Qmr1m08IyM9/YjexYXBwm55BIZsvSrLlFtbUwJ6un6+SI6b960SMBYAMNdPZZ2qJKdX0e/ghCORF9LTUh/cESPezyw7JAPEor9Z/5yfVx2OTli1Zt3hwUDiIXldu3TJz8tRXbKyVFZ2Jt3HGJdaS5THp/hYJWBzcweeFAJ6pxKwjm8vX0O3uacn3XquqqpmLcnQuZnZWS+qLTXzdhSB15o08osBgJ8ZsoZF6Je7A6NXr1m/JzHwCMqxw7KyMlU63RUsle71l0J9hVAoSSXjzmB03SGuPWzizCZUrgEUodU6eOKew3V086hwXZjKtzqavKnFr4DVUht3KfVyPszOzlpE7d23p089pkNX9bTG0fG2+UUCIJYx0A1p6ZFB9EsB/ak067dm7YZiMq6YRAP9pmsC3qcQSxTyjzg7fXyTu80OSXyim7icNqin+m4VfXdjWmryqlAohT6LriAxv1St+Oi7HTWfbwsQ/msAsC3Gd36ngyeDOh3Q8SPQyQAd74MOPYNOAHTo8Hf8wTsB0PE+6NAz6ARAhw5/xx+8EwAd74MOPYNOAHTo8Hf8wTsB0PE+6NAz6ARAhw5/xx/8/wOKgx4yCVoK/QAAAABJRU5ErkJggg==\n</code></pre>\n\n<p>when i use this base64 in  tag , its showing perpectly.</p>\n\n<pre><code>&lt;img src='above base64'/&gt;\n</code></pre>\n\n<p>When i write this base64 image Using node.js , its not properly working. I am getting damaged image.</p>\n\n<p>This is my node.js code:</p>\n\n<pre><code>var fs = require(\"fs\");\nfs.writeFile(\"arghhhh.jpg\", new Buffer(towrite, \"base64\"), function(err) {});\n</code></pre>\n"},{"tags":["node.js","rest"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":36,"score":0,"question_id":13121590,"title":"Steps to send a https request to a rest service in Node js","body":"<p>What are the steps to send a https request in node js to a rest service?\nI have an api exposed like <a href=\"https://133-70-97-54-43.sample.com/feedSample/Query_Status_View/Query_Status/Output1?STATUS=Joined%20school\" rel=\"nofollow\">https://133-70-97-54-43.sample.com/feedSample/Query_Status_View/Query_Status/Output1?STATUS=Joined%20school</a>  </p>\n\n<p>How to pass the request and what are the options I need to give for this API like\nhost, port, path and method?</p>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13133223,"title":"socket emits to different socket than it received from","body":"<p>If i do something like</p>\n\n<p>socket.on('herp', function(derp){\n  socket.emit('derp', derp);\n}</p>\n\n<p>The message goes to a different socket than the one that sent the original message</p>\n\n<p>This is how i intend to pass messages for a javascript multiplayer pig (dice game) tutorial i'm trying to put together</p>\n\n<p>the structure of the app is as follows\npig_server: <a href=\"https://github.com/hayksaakian/pig_server\" rel=\"nofollow\">https://github.com/hayksaakian/pig_server</a>\nmanages accounts/players and games, rolls dice, relays actions\npig: <a href=\"https://github.com/hayksaakian/pig\" rel=\"nofollow\">https://github.com/hayksaakian/pig</a>\nmanages ui, client side; emits actions</p>\n\n<p>How to recreate problem:\nfirst do\nnode helloworld.js\nto run the server</p>\n\n<p>from two different web browsers open pig/www/index.html (from the client directory)</p>\n\n<p>in each browser: create an account, click ladder, click find game. Once the game shows up on each browser, click on it from the ladder page's list. </p>\n\n<p>in the javascript console:\nsocket.emit('herp', 'derp');\n(do this from both browsers)</p>\n\n<p>two new messages should show up in just one browser</p>\n"},{"tags":["javascript","node.js","cross-browser","cryptography","cross-platform"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13133326,"title":"NodeJS encryption and Browser Side decryption","body":"<p>Recently, I need to encrypt plain text on server side node.js environment, return the value back to client side. Then browser does the job of decryption of data. It should not rely on any external cryptography environment such as openssl. </p>\n\n<p>I read the document of node cryptography library. It is just a wrapper of openssl. I also require the client side and server side cryptography algorithm to be consistent and transparent (i.e make use of decryption and encryption method of the same implementation of algorithm). </p>\n"},{"tags":["node.js","websocket","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13129928,"title":"Socket.io/Node.JS array elements transmission","body":"<p>I have an array of canvas elements, and each one is responsible for using the defined functions to interact with these elements.</p>\n\n<p>I do, although have a problem.</p>\n\n<p>Whenever I try to transmit the currently clicked canvas element through socket.io there seems to be a problem recognizing the previousInfo variable, which should store the information for where the cursor has been.</p>\n\n<p>Example:</p>\n\n<pre><code>canvas[i].onTouchStart = onTouchStartEventFunction;\n\ncanvas[i].onTouchMove = onTouchMoveEventFunction;\n\ncanvas[i].onTouchEnd = onTouchEndEventFunction;\n</code></pre>\n\n<p>this creates the canvas array and stores each instance on the array.</p>\n\n<p>The functions:</p>\n\n<pre><code>var onTouchStartEventFunction = function(info, index, count, event) {\ndraw(info.layerX, info.layerY, event.type, info.layerX, info.layerY, this);\n    socket.emit('touchevent', {\n        x: info.layerX,\n        y: info.layerY,\n        e: event.type,\n        px: info.layerX,\n        py: info.layerY,\n        idx: this\n});\n}\n\nvar onTouchMoveEventFunction = function(info, index, count, previousInfo, event) {\nif(previousInfo === null) \n{} \nelse {\n    document.getElementById(\"timer\").innerHTML = \"X: \" + info.layerX + \" Y: \" + info.layerY + \" pX:\" + previousInfo.layerX + \" pY:\" + previousInfo.layerY;\n    draw(info.layerX, info.layerY, event.type, previousInfo.layerX, previousInfo.layerY, this);\n    socket.emit('touchevent', {\n        x: info.layerX,\n        y: info.layerY,\n        e: event.type,\n        px: previousInfo.layerX,\n        py: previousInfo.layerY,\n        idx: this\n    });\n}\n}\n\nvar onTouchEndEventFunction = function(info, index, count, event) {\ndraw(info.layerX, info.layerY, event.type, info.layerX, info.layerY, this);\nsocket.emit('touchevent', {\n    x: info.layerX, \n    y: info.layerY,\n    e: event.type,\n    px: info.layerX,\n    py: info.layerY,\n    idx: this\n});\n}\n</code></pre>\n\n<p>Everything works fine if I don't pass the 'idx:this' through sockets, and the previousInfo works as expected.\nHowever, whenever I starting using the 'idx:this' the pX and pY (the previousInfo X and Y coordinates) are always the same, no changes.</p>\n\n<p>The worst is that this happens for every single instance, and wherever I click, the pX and pY points always stay the same.</p>\n\n<p>So, given this, can anyone point me to what I'm doing wrong?</p>\n\n<p>Best Regards</p>\n"},{"tags":["android","node.js","websocket","socket.io"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":319,"score":0,"question_id":10667826,"title":"Android SocketIOClient error: \"Scheme 'ws' not registered","body":"<p>I have a node.js/socket.io server and I wanted to create an Android app to comunicate via websockets. I found a library: <a href=\"https://github.com/koush/android-websockets\" rel=\"nofollow\">https://github.com/koush/android-websockets</a>\nBut when I try to use the sample code (Socket.IO Usage):</p>\n\n<pre><code>SocketIOClient client = new SocketIOClient(URI.create(\"ws://myIP:port\"), new SocketIOClient.Handler() {\n    String TAG = \"WebSocket Handler\";\n    @Override\n    public void onConnect() {\n            Log.d(TAG, \"Connected!\");\n    }\n\n    @Override\n    public void on(String event, JSONArray arguments) {\n        Log.d(TAG, String.format(\"Got event %s: %s\", event, arguments.toString()));\n    }\n\n    @Override\n    public void onDisconnect(int code, String reason) {\n        Log.d(TAG, String.format(\"Disconnected! Code: %d Reason: %s\", code, reason));\n    }\n\n    @Override\n    public void onError(Exception error) {\n        Log.e(TAG, \"Error!\", error);\n    }\n});\n\nclient.connect();\n</code></pre>\n\n<p>(using IP and port, or url:port)\nthe following error occurs:</p>\n\n<pre><code>Error!\n05-19 18:03:56.065: E/WebSocket Handler(629): java.lang.IllegalStateException: Scheme 'ws' not registered.\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.conn.scheme.SchemeRegistry.getScheme(SchemeRegistry.java:80)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.conn.DefaultHttpRoutePlanner.determineRoute(DefaultHttpRoutePlanner.java:107)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.client.DefaultRequestDirector.determineRoute(DefaultRequestDirector.java:565)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:292)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:555)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:487)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:465)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at android.net.http.AndroidHttpClient.execute(AndroidHttpClient.java:243)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at com.codebutler.android_websockets.SocketIOClient.downloadUriAsString(SocketIOClient.java:48)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at com.codebutler.android_websockets.SocketIOClient.access$1(SocketIOClient.java:45)\n05-19 18:03:56.065: E/WebSocket Handler(629):   at com.codebutler.android_websockets.SocketIOClient$3.run(SocketIOClient.java:200)\n</code></pre>\n\n<p>I can't find a solution</p>\n"},{"tags":["java","android","node.js","websocket"],"answer_count":3,"favorite_count":9,"up_vote_count":16,"down_vote_count":0,"view_count":3331,"score":16,"question_id":6499543,"title":"Android to node.js communication","body":"<p>I saw there are a couple of similar threads but i could not find my answer. </p>\n\n<p>I'm making and android app, an i want to use node as server for realtime communication. </p>\n\n<p>I really cannot get this to work.</p>\n\n<p>Probably i'm making many many things wrong but i like to try to understand.</p>\n\n<p>my server is as simple as</p>\n\n<pre><code>    var http = require('http'),  \n    io = require('socket.io'),\nserver = http.createServer(function(req, res){ \n     res.writeHead(200, {'Content-Type': 'text/html'}); \n     res.end(':)'); \n});\nserver.listen(8080);\nvar socket = io.listen(server); \nsocket.on('connection', function(client){\n    client.send(\"hello\");\n    console.log(\"connected!\");\n});\n</code></pre>\n\n<p>and this works... i tried his with a web app and i can connect.</p>\n\n<p>But i can't with java.. </p>\n\n<p>i tried <a href=\"http://code.google.com/p/kryonet/\">kryonet</a> but i get an exception like \"connected but timeout on registration\"</p>\n\n<p>i tried <a href=\"http://code.google.com/p/weberknecht/\">weberknecht</a> i get a \"error while creating socket to ws://184.xxxxxx:8080\"</p>\n\n<p>i tried <a href=\"https://github.com/TooTallNate/Java-WebSocket\">TooTallNate</a>, no luck, it just call onClose method.</p>\n\n<p>i tried <a href=\"http://jwebsocket.org/\">jWebSocket</a> but i couldn't get it to work... </p>\n\n<p>So i'm here, asking for help, does anyone knows how to get this done? any suggestion? </p>\n\n<p>P.S.\nfor TooTallNate i'm using something like this:</p>\n\n<pre><code>Net net=new Net(new URI(\"ws://184.xxxxxx:8080\"),WebSocketDraft.DRAFT76);\n</code></pre>\n\n<p>might the problem be here?</p>\n\n<p>UPDATE:\ni handled this! after a good sleep i had the idea, i was using socket.io, bad idea... know i use <a href=\"http://static.brandedcode.com/nws-docs/\">Node Websocket Server</a> with  <a href=\"http://code.google.com/p/weberknecht/\">weberknecht</a>. The server looks like this:</p>\n\n<pre><code>var ws = require(\"websocket-server\");\n\nvar server = ws.createServer();\n\nserver.addListener(\"connection\", function(client){\n    console.log(\"new connection\");\n    client.send(\"aaaaaa\");\n    client.addListener(\"message\", function(msg){\n    });\n});\n\nserver.listen(8080);\n</code></pre>\n\n<p>and the client:</p>\n\n<pre><code>try {\n            URI url = new URI(\"ws://184.106.69.64:8080/\");\n            WebSocket websocket = new WebSocketConnection(url);\n            websocket.setEventHandler(new WebSocketEventHandler() {\n                    public void onOpen(){\n                            System.out.println(\"--open\");\n                    }    \n                    public void onMessage(WebSocketMessage message){\n                            System.out.println(\"--received message: \" + message.getText());\n                    }   \n                    public void onClose(){\n                            System.out.println(\"--close\");\n                    }\n            });\n\n            websocket.connect();\n            websocket.send(\"hello world\");\n        }\n        catch (WebSocketException wse) {\n                wse.printStackTrace();\n        }\n        catch (URISyntaxException use) {\n                use.printStackTrace();\n        }\n</code></pre>\n\n<p>Thanks for your help!</p>\n"},{"tags":["android","node.js","websocket","socket.io"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":2171,"score":2,"question_id":7968457,"title":"Using the Socket.IO framework with native WebSocket clients","body":"<p>I am looking to leverage my existing (and quite simple) NodeJS+SocketIO server application with a new Android based client. This is not using the WebKit browser, but a native WebSocket client within the Android SDK.</p>\n\n<p>I have found the library \"Weberknecht\" and loaded it into my Android project, and when I attempt a connection to the WebSocket URL I see a <code>\"WARN - client not handshaken client should reconnect\"</code> message in my NodeJS trace.</p>\n\n<p>Presumably the SocketIO framework does some extra work pre-WebSocket and that is why I am having issues. Has anyone else done this kind of \"cross-library\" work against SocketIO, and if so could you offer any assistance please.</p>\n"},{"tags":["node.js","cross-compiling","raspberry-pi"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13115930,"title":"Cross compiled new version of node.js for Raspberry Pi results in 5X larger executable","body":"<p>I cross compiled a more recent version of node.js (v0.8.14) for the Raspberry Pi.\nComparing the new version to the node v0.6.19 installed via apt-get, I was surprised that the size of the executable jumped from 1.2Mb to 6.2Mb.</p>\n\n<p>Is the 5x increase in size due to </p>\n\n<ul>\n<li>Newer version of node: v0.6.19 --> v0.6.19</li>\n<li>GNU/Linux version:  2.6.26 --> 3.5.0</li>\n<li>something else?</li>\n</ul>\n\n<pre>\npi@raspberrypi ~ $ /usr/bin/node -v; ll -h /usr/bin/node; file /usr/bin/node\nv0.6.19\n-rwxr-xr-x 1 root root 1.2M Jun 30 18:55 /usr/bin/node\n/usr/bin/node: ELF 32-bit LSB executable, ARM, version 1 (SYSV), dynamically linked (uses shared libs), \nfor GNU/Linux 2.6.26,uildID[sha1]=0xb29e21fbf3e8a7db733fbcd0539e593264d88c94, stripped\n\npi@raspberrypi ~ $ ./node -v; ll -h ./node; file ./node\nv0.8.14\n-rwxr-xr-x 1 pi pi 6.2M Oct 28 20:43 ./node\n./node: ELF 32-bit LSB executable, ARM, version 1 (SYSV), dynamically linked (uses shared libs), \nfor GNU/Linux 3.5.0, stripped\n</pre>\n"},{"tags":["node.js","express","rename","fs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13132048,"title":"node.js fs.rename() error enoent","body":"<p>after uploaded a file to my server i try to move it to another folder(same disk), and i got thie error</p>\n\n<pre><code>{[Error:ENOENT,rename 'F\\myproject\\1b231234nsdifhoi2323']\n  errno:34,\n  code:ENOENT,\n  path:'F\\\\myproject\\\\1b231234nsdifhoi2323'\n}\n</code></pre>\n\n<p>am on windows and use</p>\n\n<pre><code>app.use(express.bodyParser({\n    uploadDir:'./Temp'\n}));\n</code></pre>\n\n<p>here is my rename code</p>\n\n<pre><code>exports.upload = function(req, res,next){\n    console.log( req.body);\n    console.log(req.files);\n    var tmp_path = req.files.product_video.path;\n    var target_path = '\\\\Video\\\\' + req.files.product_video.name;\n\n    console.log(tmp_path);       // Temp\\1b231234nsdifhoi2323\n    console.log(target_path);    // \\Video\\name\n\n    fs.rename(tmp_path, target_path, function(err) {\n        if (err) {\n            console.log(err)\n        };\n        fs.unlink(tmp_path, function() {\n            if (err){\n                console.log(err)\n            }else{\n                res.send('File uploaded to: ' + target_path + ' - ' + req.files.product_video.size + ' bytes');\n\n            }\n        });\n    });\n};\n</code></pre>\n\n<p>it looks like i get the path wrong,but i cannot figure it out !</p>\n"},{"tags":["node.js","mongodb","lucene","sphinx","elasticsearch"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":330,"score":2,"question_id":11809909,"title":"Ideas for full text search MongoDB & node.js","body":"<p>I am developing a search engine for my website and i want to add following features to it;</p>\n\n<ol>\n<li>Full text search</li>\n<li>Did you mean feature</li>\n<li>Data store in MongoDB</li>\n</ol>\n\n<p>I want to make a restful backend. I will be add data to mongodb manually and it will be indexed (which one i can prefer? Mongodb indexing or some other search indexing libraries like Lucene). I also want to use node.js. These are what i found from my researches. Any idea would be appreciated for the architecture</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["node.js","design-patterns","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13129969,"title":"Design pattern for many asynchronous tasks in node","body":"<p>I'm learning node and writing an API. One of my API calls takes a parameter called Tags, which will contain comma-delimited tags, each of which I want to save to disk (I'm using MongoDB + Mongoose). Typically when I save to DB in my API I pass a callback and carry on after the save inside of that callback, but here I have a variable number of objects to save to disk, and I don't know the cleanest way to save all of these tags to disk, then save the object which references them afterward. Can anyone suggest a clean async pattern to use? Thanks!</p>\n"},{"tags":["node.js","port","kill","pid"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13129464,"title":"How to find out which Node.js pid is running on which port","body":"<p>I'd like to restart one of many Node.js processes I have running on my server. If I run <code>ps ax | grep node</code> I get a list of all my Node proccesses but it doesn't tell me which port they're on. How do I kill the one running on port 3000 (for instance). What is a good way to manage multiple Node processes?</p>\n"},{"tags":["node.js","design"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13130923,"title":"Developing a simple node.js. I'm new to web programming, would like some design tips","body":"<p>I'm teaching myself node.js and a buddy of mine owns a store and he wants to create a simple employee information page.  I figured I'd use this as a pet project to teach myself some of the ins and outs of web application development.</p>\n\n<p>What I need help with, is some basic direction in a good design pattern, and which frameworks I should think about using.</p>\n\n<p>So far, I've decided on using node.js, because I have made a few simple apps (logging top scores from a game, for example) and I have some boilerplate code that I've been reusing for a simple http server with good routing and response handlers.\nI also think I'll host it on Heroku, I've used that toolkit to host another project. I think they recommend (maybe require) postgresql for their free DB, so I'll use that even though I'm more familiar with MySQL.</p>\n\n<p>Ok, so on to my application.  It is very simple. It really only has 1 view, a profile page of an employee that lists their vital information, and their training achievements. If the viewer is logged in as an administrator they can toggle these training achievements from uncompleted to completed.  That's it, down the line I'll create new admin interfaces with options to edit/add new employees, achievements, etc. But I want to get this view done first and for now I'll just enter the data into the DB manually (there aren't many employees).</p>\n\n<p>I know there is no \"right\" way to do this, but I'm just looking for recommendations/warning etc before I get started. Most of my projects with node, I'm actually spewing out raw HTML in my responses, rather than using any sort of front end (what I learned to do with PHP) like this:</p>\n\n<pre><code> var body = '&lt;html&gt;'+\n'&lt;head&gt;'+\n'&lt;meta http-equiv=\"Content-Type\" '+\n'content=\"text/html; charset=UTF-8\" /&gt;'+\n'&lt;/head&gt;'+\n'&lt;body&gt;'+\n'hello world' +\n'&lt;/body&gt;&lt;/html';\nresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\nresponse.write(body);\nresponse.end();\n</code></pre>\n\n<p>Is this going to bite me in the butt down the line? (having no static html/JS) I was going to design my view in Dreamweaver, and just have my response handler spit out my HTML (not sure how I'll handle the images) Is it worth having some sort of front end? Or can I get away with having my server/back end doing everything? If I were to have a static front end, that communicates with a node backend (to handle the DB queries, etc.) how should I design the front end?</p>\n\n<p>Any tips on how I should handle authentication? Again very simple, you either log in as an admin which adds a simple checkbox form, or you dont log in at all, and you choose an employee name and get to view their profile with no interactivity.</p>\n\n<p>Any other advice on my design patterns, other frameworks or NPM modules I should look at, or just HOW my app should look would be very appreciated.</p>\n"},{"tags":["node.js","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13130335,"title":"Where can I find documentation for the 'header' event?","body":"<p>ConnectJS uses the <a href=\"http://www.senchalabs.org/connect/responseTime.html\" rel=\"nofollow\">res.on('header'...</a> event to do some post processing on the response.  I have searched far and wide in the NodeJS documentation, but cannot find this event mentioned anywhere.  Can someone point me in the direction of some documentation for this?</p>\n"},{"tags":["node.js","async.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13130667,"title":"Return value in a async.forEach in node js?","body":"<p>I'm starting to learn node.js, and to aggregate multiple rss feeds in a single one, I'm fectching the feeds and then recreate a unique feed from the data I fecthed.</p>\n\n<p>So, in order to handle multiple http requests asynchronously I use <a href=\"https://github.com/caolan/async#forEach\" rel=\"nofollow\">https://github.com/caolan/async#forEach</a> which does the job.</p>\n\n<p>But I can't figure how to return a value (the rss xml feed in my case).</p>\n\n<p>Here is my code :</p>\n\n<pre><code>function aggregate(topic) { \n  async.forEach(topic.feeds, \n    function(item, callback) {\n      parseAndProcessFeed(item, callback);\n    }, \n    function(err) {\n      // sort items by date\n      items.sort(function(a, b) {\n       return (Date.parse(b.date) - Date.parse(a.name));\n      });\n      var rssFeed = createAggregatedFeed();\n      console.log(rssFeed);\n      return rssFeed;\n    }\n  );\n}\n</code></pre>\n\n<p>with <code>console.log(rssFeed)</code> I can see the rss feed, so I think I'm missing something obvious.</p>\n\n<p>How can I return the <code>rssFeed</code> value?</p>\n\n<p>Some help to get me back on seat would be great, thanks!</p>\n\n<p>Xavier</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1314,"score":0,"question_id":6543683,"title":"In Express.js, how do I make my template display the flash messages?","body":"<pre><code>app.get('/',function(req,res){\n    res.render('home'); // I want the template to be able to access the flash message..\n});\n\napp.get('/go',function(req,res){\n    req.flash(\"info\", \"You went GO, and got redirected to home!\");\n    res.redirect('/');\n});\n</code></pre>\n\n<p>The user first goes to \"/go\".  After that, he will be redirected to \"/\" and I want a flash message to show as a javascript alert. </p>\n\n<p>How can I do that?</p>\n"},{"tags":["node.js","express","passport"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":12873960,"title":"passport.js - facebook strategy logout issue","body":"<p>I'm trying to set up facebook authentication using this <a href=\"https://github.com/jaredhanson/passport-facebook/tree/master/examples/login\" rel=\"nofollow\">login example</a>. Example works but when I log out and try to log in again passport automatically lets me in without giving me an option to change facebook user. Any idea on how to change this behaviour? </p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13128681,"title":"Need help in setting up an HTTPS proxy using node.js, which picks up all the HTTPS requests from the browser window","body":"<p>I want to set up an HTTPS proxy server using node.js. It needs to pick up all the HTTPS requests from the browser window. I have a mac book and I have configured the proxy setting from the preferences for HTTPS. Below is the sample code for capturing any browser requests, is this code correct? I am generating the keys using the following commands.</p>\n\n<pre><code> openssl genrsa -out privatekey.pem 1024\n openssl req -new -key privatekey.pem -out certrequest.csr\n openssl x509 -req -in certrequest.csr -signkey privatekey.pem -out certificate.pem\n\nvar options = {\nhttps: {\n    key: fs.readFileSync('privatekey.pem', 'utf8'),\n    cert: fs.readFileSync('certificate.pem', 'utf8')\n},\ntarget: {\n    https: true\n}\n};\n\nhttps.createServer(options,function(request, response) {\nconsole.log(request);\nhandleRequest(request, response);\n}).listen(8877);\n</code></pre>\n\n<p>So the above code does not work, any suggestions how i can solve this problem, thanks in advance</p>\n"},{"tags":["javascript","node.js","mongodb","asynchronous","each"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":339,"score":1,"question_id":8853499,"title":"How to make async method call inside of another async `each` method (NodeJS)?","body":"<p>How to make async method call inside of another async <code>each</code> method (NodeJS)?</p>\n\n<p>Concrete example - working with a database, I need to delete all records. \nBut I can't just drop the whole collection, I need to destroy every record one by one, before deletion I need to read the record, perform some business logic in the app and only then delete it.</p>\n\n<p>So, let's try to implement our <code>deleteAll</code> method (actually it's a real API from node-mongodb-native driver):</p>\n\n<pre><code>deleteAll = function(selector, callback){\n  collection.find(selector).each(function(err, doc){\n    if(err){\n      callback(err)\n    }else{\n      if(doc === null){\n        // each returns null when there's no more documents, we are finished.\n        callback(null)      \n      }else{\n        doSomeBusinessLogicBeforeDelete(doc)\n\n        // How to delete it using asynchronous `remove` method?        \n        collection.remove({_id: doc._id}, function(err){\n          // What to do with this callback? \n          // And how to make `each` wait untill we \n          // deleting this record?\n          ???\n        })\n      }      \n    }\n  })\n}\n</code></pre>\n\n<p>There's actually a way to do it - using the <code>collection.nextObject</code> method instead of <code>collection.each</code>, but I want to know is this possible to solve this using <code>each</code> or not? Right now I believe that it's not possible, but maybe I'm wrong?</p>\n\n<p>UPDATE: the source of <code>each</code> method:</p>\n\n<pre><code>Cursor.prototype.each = function(callback) {\n  var self = this;\n\n  if (!callback) {\n    throw new Error('callback is mandatory');\n  }\n\n  if(this.state != Cursor.CLOSED) {\n    process.nextTick(function(){\n      // Fetch the next object until there is no more objects\n      self.nextObject(function(err, item) {        \n        if(err != null) return callback(err, null);\n\n        if(item != null) {\n          callback(null, item);\n          self.each(callback);\n        } else {\n          // Close the cursor if done\n          self.state = Cursor.CLOSED;\n          callback(err, null);\n        }\n\n        item = null;\n      });\n    });\n  } else {\n    callback(new Error(\"Cursor is closed\"), null);\n  }\n};\n</code></pre>\n"},{"tags":["javascript","node.js","coffeescript","npm","dependency-management"],"answer_count":5,"favorite_count":6,"up_vote_count":9,"down_vote_count":2,"view_count":542,"score":7,"question_id":12893046,"title":"How to do manage client-side JavaScript dependencies?","body":"<p>I have been researching different solutions and I cannot find exactly what I am looking for. I want to satisfy these 5 requirements:</p>\n\n<ol>\n<li>Manage my client side dependencies in a format similar to npm's <a href=\"http://package.json.jit.su/\">package.json</a> or <a href=\"http://twitter.github.com/bower/\">bower</a>'s component.json</li>\n<li>I should have the flexibility to point to GitHub repo or actual js files (either on web or locally) in my dependency.json file for lesser known libraries</li>\n<li>It should minify and namespace all libraries into a single file like <a href=\"http://ender.no.de/\">ender</a> - that's the only js file I would need to put in my script-tag in the client side</li>\n<li>It should have out of box support for coffeescript like <a href=\"http://boxjs.com/\">Box</a></li>\n<li><p>In the browser I can use either <a href=\"http://requirejs.org/\">require</a> style:</p>\n\n<pre><code>var $ = require('jquery');\nvar _ = require('underscore');\n</code></pre>\n\n<p>Or better, yet, do headjs style (<a href=\"http://headjs.com/\">headjs</a> does not actually do this):</p>\n\n<pre><code>require(['jquery', 'underscore', 'mylib'], function($, _, mylib) {\n  // executed on domready\n});\n</code></pre></li>\n</ol>\n\n<p>If no one such single tool exists, what is the best combination of tools i.e. a tool-chain that I can combine using something like <a href=\"http://volojs.org/\">volo</a> (or <a href=\"http://gruntjs.com/\">grunt</a>)?</p>\n\n<p>I have already researched all the tools I have linked to in here and they satisfy only upto 3 of my requirements at best individually. So, please don't post again about these tools. I would only accept an answer that provides a single tool that satisfies all 5 of my requirements or if someone posts a concrete workflow/script/working example of a toolchain of multiple such tools that also satisfies all my requirments. Thank you.</p>\n"},{"tags":["web-services","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13129707,"title":"Best method accessing statistics from a server continously","body":"<p>I am trying to create a time series application, where the client application continuously connects to the server to get the recent statistics and plot the graph from it. Like say for say for every 30 seconds it requests for the statistics for something and then gets the data and plot the results in a nice graph.</p>\n\n<p>I don't want the graph to be discontinuous. I mean I want the graph to be constantly updating showing the time series statistics. Something like shifting to the left and displaying the new one from the right in the graph. What is the right approach for this.</p>\n\n<p>I am not sure but should I fetch the data from the web server. I mean I was planning to use a web server which can provide the recent stats. I am not sure should I use http or use sockets to make a constant connection from the client and access stats. I was thinking to create a web server using node.js and the clients requesting for stats every 30 sec or so.</p>\n\n<p>Can you guys suggest what could be the best architecture for this? Are there any library for plotting this time series data. I mean I can use some to plot a static graph. But I want this graph to be constantly updated showing the recent stats.</p>\n"},{"tags":["node.js","heroku","express","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13129354,"title":"Node.js app running on heroku - can't find module ./http","body":"<p>I'm going crazy trying to figure this out. I have a node.js app using Express and MongoDB (mongoose). It runs perfectly fine locally. I deployed it to heroku seemingly without a problem, but when I try to actually launch the app it crashes. The heroku log says this:</p>\n\n<pre><code>macbook-pro-4:FF_Courtney cmitchell$ heroku logs\n2012-10-29T19:31:27+00:00 heroku[web.1]: State changed from crashed to starting\n2012-10-29T19:31:30+00:00 heroku[web.1]: Starting process with command `node web.js`\n2012-10-29T19:31:31+00:00 app[web.1]: \n2012-10-29T19:31:31+00:00 app[web.1]: module.js:340\n2012-10-29T19:31:31+00:00 app[web.1]:     throw err;\n2012-10-29T19:31:31+00:00 app[web.1]: Error: Cannot find module './http'\n2012-10-29T19:31:31+00:00 app[web.1]:           ^\n2012-10-29T19:31:31+00:00 app[web.1]:     at Function.Module._resolveFilename     (module.js:338:15)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Function.Module._load (module.js:280:25)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Module.require (module.js:362:17)\n2012-10-29T19:31:31+00:00 app[web.1]:     at require (module.js:378:17)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Object.&lt;anonymous&gt;  (/app/node_modules/express/node_modules/connect/lib/connect.js:13:18)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Module._compile (module.js:449:26)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Object.Module._extensions..js (module.js:467:10)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Module.load (module.js:356:32)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Function.Module._load (module.js:312:12)\n2012-10-29T19:31:31+00:00 app[web.1]:     at Module.require (module.js:362:17)\n2012-10-29T19:31:32+00:00 heroku[web.1]: Process exited with status 1\n</code></pre>\n\n<p>I have a package.json file with my dependencies:</p>\n\n<pre><code>{\n  \"name\": \"favorite-failure\",\n  \"version\": \"0.0.1\",\n  \"dependencies\": {\n    \"express\": \"2.5.6\",\n    \"ejs\" : \"latest\",\n    \"mongoose\" : \"3.3.1\",\n    \"request\" : \"2.11.4\",\n    \"moment\" : \"1.7.2\",\n    \"mongodb\" : \"0.9.6-7\",\n    \"connect-mongodb\": \"&gt;= 1.1.3\"\n  },\n  \"engines\": {\n      \"node\": \"&gt;= 0.8.12\",\n      \"npm\": \"&gt;= 1.1.49\"\n  }\n}\n</code></pre>\n\n<p>I'm a bit new to this, so any help would be greatly appreciated. Thanks!</p>\n"},{"tags":["css","node.js","stylus"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13125656,"title":"How do I do transparent vendor mixins in Stylus when the mixin function is an argument?","body":"<p>Making a mixin for properties like <code>border-radius</code> is easy:</p>\n\n<pre><code>vendor(name, args)\n    -webkit-{name} args\n    -moz-{name} args\n    -ie-{name} args\n    -o-{name} args\n    {name} args\n\nborder-radius()\n    vendor('border-radius', arguments)\n\n#test\n    border-radius 5px\n</code></pre>\n\n<p>But what if I want to create a transparent vendor mixin for <code>linear-gradient</code>? Unlike <code>border-radius</code>, <code>linear-gradient</code> is not a property but an argument, e.g.</p>\n\n<pre><code>#test\n    background-image linear-gradient(top, #f00 0%, #00f 100%)\n</code></pre>\n\n<p>I'm thinking I have to create a mixin called <code>background-image</code> and check if the first argument is <code>linear-gradient</code>. Is Stylus capable of such advanced logic? If so, how can I accomplish what I'm trying to do?</p>\n\n<p>Thanks for any help on the matter.</p>\n"},{"tags":["windows","node.js","file-io"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1301,"score":1,"question_id":7871058,"title":"Recursive directory creation for Node.js 0.5.x","body":"<p>I have a function that downloads a file and saves it in a nested directory structure based on parameters sent to it (ex: ./somedir/a/b/c or ./somedir2/a/d/b). I cannot trust that any directory along the way has been created so I need to have each directory along the filepath checked and created if it doesn't exist. Now, I have some code that works perfectly for Node 0.4.x, but something has broken in at least the Windows version of Node 0.5.x (tested on 0.5.10 specifically). </p>\n\n<p>I am terrible with understanding filesystems, so if someone could figure out how I could make this work or replace it with something else that works similarly, I would very much appreciate it. The goal is to have code that would function properly on both Unix and Windows as well as Node 0.4.x and 0.5.x.</p>\n\n<pre><code>// automatically create directories if they do not exist at a path\nfunction mkdirs(_path, mode, callback) {\n  var dirs = _path.split(\"/\");\n  var walker = [dirs.shift()];\n\n  var walk = function (ds, acc, m, cb) {\n    if (ds.length &gt; 0) {\n      var d = ds.shift();\n      acc.push(d);\n      var dir = acc.join(\"/\");\n\n      fs.stat(dir, function (err, stat) {\n        if (err) {\n          // file does not exist\n          if (err.errno == 2) {\n            fs.mkdir(dir, m, function (erro) {\n              if (erro &amp;&amp; erro.errno != 17) {\n                terminal.error(erro, \"Failed to make \" + dir);\n                return cb(new Error(\"Failed to make \" + dir + \"\\n\" + erro));\n              } else {\n                return walk(ds, acc, m, cb);\n              }\n            });\n          } else {\n            return cb(err);\n          }\n        } else {\n          if (stat.isDirectory()) {\n            return walk(ds, acc, m, cb);\n          } else {\n            return cb(new Error(\"Failed to mkdir \" + dir + \": File exists\\n\"));\n          }\n        }\n      });\n    } else {\n      return cb();\n    }\n  };\n  return walk(dirs, walker, mode, callback);\n};\n</code></pre>\n\n<p>Example Usage:</p>\n\n<pre><code>mkdirs('/path/to/file/directory/', 0777, function(err){\n</code></pre>\n\n<p>EDIT: Update for Node 0.8.x (in CoffeeScript):</p>\n\n<pre><code># \n# Function mkdirs\n# Ensures all directories in a path exist by creating those that don't\n# @params\n#    path:      string of the path to create (directories only, no files!)\n#    mode:      the integer permission level\n#    callback:  the callback to be used when complete\n# @callback\n#    an error object or false\n#\nmkdirs = (path, mode, callback) -&gt;\n  tryDirectory = (dir, cb) -&gt;\n    fs.stat dir, (err, stat) -&gt;\n      if err #the file doesn't exist, try one stage earlier then create\n        if err.errno is 2 or err.errno is 32 or err.errno is 34\n          if dir.lastIndexOf(\"/\") is dir.indexOf(\"/\") #only slash remaining is initial slash\n            #should only be triggered when path is '/' in Unix, or 'C:/' in Windows\n            cb new Error(\"notfound\")\n          else\n            tryDirectory dir.substr(0, dir.lastIndexOf(\"/\")), (err) -&gt;\n              if err #error, return\n                cb err\n              else #make this directory\n                fs.mkdir dir, mode, (error) -&gt;\n                  if error and error.errno isnt 17\n                    cb new Error(\"failed\")\n                  else\n                    cb()\n        else #unkown error\n          cb err\n      else\n        if stat.isDirectory() #directory exists, no need to check previous directories\n          cb()\n        else #file exists at location, cannot make folder\n          cb new Error(\"exists\")\n  path = (if path.indexOf(\"\\\\\") &gt;= 0 then path.replace(\"\\\\\", \"/\") else path) #change windows slashes to unix\n  path = path.substr(0, path.length - 1)  if path.substr(path.length - 1) is \"/\" #remove trailing slash\n  tryDirectory path, callback\n</code></pre>\n"},{"tags":["node.js","express","meteor"],"answer_count":2,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":911,"score":10,"question_id":10282623,"title":"How should I run a REST API with Meteor?","body":"<p>I need the Meteor server to handle a very simple POST request not coming from the application client. With Express, I'd just do something like <code>app.post('/something', function...</code>.</p>\n\n<p>Is there an equivalent in Meteor? If not, how should I set this up, startup an Express server in a <code>is_server</code> context?</p>\n"},{"tags":["node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":13128037,"title":"Problems with use fs.stat in nodejs","body":"<p>I trying make read file parameters. When I make this code:</p>\n\n<pre><code>  var fs = require('fs'),\n    size = new Object();\nfs.stat(file, function(err,stats){\n         if(!err){\n            size=stats;\n         }\n      })\n   console.log(size);\n</code></pre>\n\n<p>It`s ok, when i trying use function:</p>\n\n<pre><code> var fs = require('fs'),\n    size = new Object();\nfunction writeinfile(file){\n   fs.stat(file, function(err,stats){\n         if(!err){\n            size=stats;\n         }\n      })\n   console.log(size.size);  \n}\nwriteinfile('error.log');\n</code></pre>\n\n<p>It`s not work. Could you help me that variant 2 work?</p>\n"},{"tags":["node.js","debian","sftp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11690855,"title":"NODEJS - SFTP - Handling process output","body":"<p>At the moment I'm trying to use <a href=\"https://github.com/ajaxorg/node-sftp\" rel=\"nofollow\">node-sftp</a> in order to provide my nodejs script with the ability to SFTP with a private key.</p>\n\n<p>That module appears to be broken since v 0.6 of node (tty.open is no longer a method).\nSo i've tried to use a child process and spawn my sftp command.</p>\n\n<p>Now the connection appears to work fine (I checked the ftp servers logs @ /var/log/auth.log)\nI can also see some output in the Node window...</p>\n\n<pre><code>Permanently added '46.x.x.x' (RSA) to the list of known hosts.\nConnected to 46.x.x.x.\nChanging to: /home/deploy/somefolder\n</code></pre>\n\n<p>When I connect directly via the command line using the following command it ends up with a prompt like <strong>sftp></strong>, which is waiting for my FTP commands</p>\n\n<pre><code>sftp -o Port=22 -o PasswordAuthentication=no -o IdentityFile=private_key -o UserKnownHostsFile=/v/null -o StrictHostKeyChecking=no -o BatchMode=yes deploy@46.x.x.x:/home/deploy/somefolder\n</code></pre>\n\n<p>Does anyone have any suggestions on where I might be going wrong?</p>\n"},{"tags":["node.js","documentation","express"],"answer_count":3,"favorite_count":20,"up_vote_count":14,"down_vote_count":0,"view_count":4788,"score":14,"question_id":8144214,"title":"Learning Express for Node.js","body":"<p>Anyone have pointers to good resources for learning Express?  I'm aware of the documentation and the nodetuts.com videos.  Curious if there are any other good resources out there.</p>\n"},{"tags":["javascript","node.js","ftp","sftp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12073118,"title":"Node.js - Organising code and closures - SFTP/Inotify","body":"<p>I was hoping I could get some advice on why my nodejs program is behaving in the way it is.</p>\n\n<p>I am using two modules, node-sftp and node-inotify. I have setup node-inotify to watch a directory and call a function when something is written there, the function being an sftp upload.</p>\n\n<p>Now the problem I have is that processing one file at a time is fine but when I drop 4 files in one go there, the function is called four times but only one sftp upload goes through.</p>\n\n<p>Do I need to order my code in a particular way to ensure that the sftp upload occurs x times, is this something to do with closures perhaps?</p>\n\n<p>This is a basic version of my code...</p>\n\n<ul>\n<li>\"event_handler\" is called when something happens on a \"watched\" directory</li>\n<li>\"check_event\" figures out if this type of event is one we want, in this case it's a \"write\"</li>\n<li>\"ftp_to_server\" prepare connection details</li>\n<li><p>\"do_ftp\" basically uses the node-sftp module to perform the sftp upload</p>\n\n<pre><code>event_handler = function(event){\n    var supplier;\n    check_event(event, supplier, type, ftp_to_server);\n};\n</code></pre></li>\n</ul>\n\n<p>=================</p>\n\n<pre><code>    function check_event(event, handler)\n    {\n        if (event.type === 'xxxxxx') {\n            var file_to_process_name = 'abc';\n            var file_to_process_dir = 'abc';\n            var remote_dir = 'abc';\n            handler(file_to_process_name, file_to_process_dir, remote_dir);\n        }\n    }\n\n    function ftp_to_server(file_to_process_name, file_to_process_dir, remote_dir) {\n        var connection_details = conf.ftp.connections\n        do_ftp(connection_details, file_to_process_name, file_to_process_dir, remote_dir);    \n    }\n\n    function do_ftp(connection_details, file_to_process_name, file_to_process_dir, remote_dir) {\n\n        var credentials = {\n            // FTP settings here\n        };\n        var local_file = file_to_process_dir + file_to_process_name;\n        var remote_file = remote_dir + file_to_process_name;\n\n        connection = new sftp(credentials, function(err) {\n            if (err){\n                throw err;\n            }\n            connection.writeFile(remote_file, fs.readFileSync(local_file, \"utf8\"), null, function(err) {\n                if (err) {\n                    throw err;\n                }\n\n                console.info('FTP PUT DONE');\n\n            });\n        });\n    };\n</code></pre>\n"},{"tags":["javascript","node.js","jsdom"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1007,"score":4,"question_id":10226301,"title":"Building contextify under Windows 7 x64 (for NodeJS jQuery)","body":"<p>I try to get <strong>node-jquery</strong> working. <strong>contextify</strong> is one of the dependencies (required for <strong>jsdom</strong>).</p>\n\n<p><strong>contextify</strong> needs to be built somehow using Python. But this does not seem to work on Windows 7 x64. At least one my computer :)</p>\n\n<p>After some readings (<a href=\"https://github.com/brianmcd/contextify/issues/10\" rel=\"nofollow\">#10</a>, <a href=\"https://github.com/brianmcd/contextify/issues/12\" rel=\"nofollow\">#12</a>, <a href=\"https://github.com/brianmcd/contextify/pull/17\" rel=\"nofollow\">#17</a>) and trying some binaries provided by this <a href=\"https://github.com/Benvie/contextify\" rel=\"nofollow\">fork</a> and this <a href=\"https://github.com/springmeyer/contextify\" rel=\"nofollow\">one</a> I can get it work ...</p>\n\n<p>I've got the same error from <code>node-gyp configure</code> or from <code>node-gyp rebuild</code> (<code>npm install jquery</code>) :</p>\n\n<pre><code>info it worked if it ends with ok\ninfo downloading: http://nodejs.org/dist/v0.6.14/node-v0.6.14.tar.gz\ninfo downloading: http://nodejs.org/dist/v0.6.14/x64/node.lib\ninfo downloading: http://nodejs.org/dist/v0.6.14/node.lib\nspawn python [ 'D:\\\\Users\\\\ngryman\\\\.node-gyp\\\\0.6.14\\\\tools\\\\gyp_addon',\n  'binding.gyp',\n  '-ID:\\\\Users\\\\ngryman\\\\build\\\\config.gypi',\n  '-f',\n  'msvs',\n  '-G',\n  'msvs_version=2010' ]\n  File \"D:\\Users\\ngryman\\.node-gyp\\0.6.14\\tools\\gyp_addon\", line 40\n    print 'Error running GYP'\n                        ^\nSyntaxError: invalid syntax\nERR! Error: `gyp_addon` failed with exit code: 1\n  at ChildProcess.onCpExit (D:\\Users\\ngryman\\AppData\\Roaming\\npm\\node_modules\nnode-gyp\\lib\\configure.js:226:16)\n  at ChildProcess.emit (events.js:70:17)\n  at maybeExit (child_process.js:360:16)\n  at Process.onexit (child_process.js:396:5)\nERR! not ok\n</code></pre>\n\n<p>It seems there is a syntax error ... I am not very comfortable with Python.</p>\n\n<p>Here are my versions :</p>\n\n<ul>\n<li>Python: 3.2.3</li>\n<li>NodeJS: 0.6.14</li>\n</ul>\n\n<p>Anyone have an idea?</p>\n\n<p>Thanks!</p>\n"},{"tags":["javascript","node.js","winston"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12238199,"title":"Winston logger names","body":"<p>Flatiron's logging library Winston is quite useful, but I can not figure how to assign names to loggers. I am expecting an output similar to other logging libraries, for instance:</p>\n\n<pre><code> [&lt;date&gt;] [&lt;log level&gt;] &lt;logger name&gt; - &lt;the message&gt;\n</code></pre>\n\n<p>Is it possible to configure Winston in such a way?</p>\n\n<p>Thank you.</p>\n"},{"tags":["mysql","performance","node.js","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13126824,"title":"nodejs-mysql-native vs node-mysql - Special situation","body":"<p>I'm working on a NodeJS server that will interact a lot with a MySQL server. This will be an API server that handles authenticated responses from clients. The special situation here is that the back end will have multiple databases, which means that every client request would require a new database connection. Has someone work on an architecture similar? what module would you suggest?</p>\n\n<p>My concern is that the database selection for each query would slow down the application considerably.</p>\n"},{"tags":["node.js","connect"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":949,"score":1,"question_id":8335034,"title":"formidable Express 500 TypeError: Cannot call method 'complete' of undefined","body":"<p>I'm trying to upload files with NodeJS, I've tried the most common multipart libraries, but can't get it work.</p>\n\n<p>When I send the file I didn't get anything just a 500 error that doesn't exist method called complete. I tried a similar module alone and it work well. Is possible to have some var crashing? I made some console.log, util, and I didnt get anything of the variable form. </p>\n\n<p>This is a piece of code. If you have any brilliant idea to try to solve this and you need more code, feel free to ask it!</p>\n\n<pre><code> var express       = require('express');\n var form          = require('formidable');\n\n var app = module.exports = express.createServer(\n   express.favicon()\n   , express.bodyParser()\n   , express.cookieParser()\n   , express.session({secret: 'topsecret'})\n   , everyauth.middleware()\n   , express.router(routes)\n );\n\n\napp.configure(function(){\n\n  app.use(express.bodyParser());\n  app.use(express.cookieParser());\n  app.use(express.session({secret: \"aiudhasiudj12\" }));\n  app.use(everyauth.middleware());\n  app.use(app.router);\n  app.set('view engine', 'jade');\n  app.use('views', __dirname + '/views');\n  app.use(express.static(__dirname + '/public'));\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\n  app.use(form({ keepExtensions: true }));\n\n});\n\napp.configure('development', function(){\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true })); \n});\n\n everyauth.everymodule\n   .findUserById( function (userId, callback) {\n\n   Login.findLocalByEmail([userId], function (error, results) {\n     callback(null, { userId: userId, data: results});\n   });\n });\n\n everyauth.facebook...\n\n [...]\n\n app.get('/la', function(req, res){\n  res.send('&lt;form action=\"la\" method=\"post\" enctype=\"multipart/form-data\"&gt;'\n    + '&lt;p&gt;Image: &lt;input type=\"file\" name=\"image\" /&gt;&lt;/p&gt;'\n    + '&lt;p&gt;&lt;input type=\"submit\" value=\"Upload\" /&gt;&lt;/p&gt;'\n    + '&lt;/form&gt;');\n\n    //console.log(util.inspect(form, true, null));\n});\n\n app.post('/la', function(req, res) {\n\n  console.log(util.inspect(req.form, true, null));\n\n  req.form.complete(function(err, fields, files) {\n\n    console.log(fields);\n    console.log(files);\n\n    if(err) {\n      next(err);\n    } else {\n\n    }\n  });\n});\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["node.js","file-upload"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13125389,"title":"Upload HUGE file > 2GB to nodejs (n Firefox)","body":"<p>I've made my example as basic possible. I try to upload a huge file, more than 2 GB, to my server but I receive an error <strong>only in Firefox</strong>. In Chrome seems to work allright. It says something like \"Error: Connection broken\". Could someone explain me why and what could I do about it?</p>\n\n<pre><code>var http       = require(\"http\");\nvar url        = require(\"url\");\n\nhttp.createServer(function (request, response) {\n    switch(url.parse(request.url).pathname) {\n        case \"/\":\n            displayForm(request, response);\n            break;\n        case \"/upload\":\n            response.writeHeader(200, {\"Content-Type\":\"text/html\"});\n            response.end(\n                '&lt;h1&gt;File Uploaded!&lt;/h1&gt;'\n            );\n            break;\n    }\n}).listen(1234);\n\nvar displayForm = function(request, response) {\n    response.writeHeader(200, {\"Content-Type\":\"text/html\"});\n    response.end(\n        '&lt;form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\"&gt;' +\n            '&lt;input type=\"file\" name=\"uploadFile\"&gt;' +\n            '&lt;input type=\"submit\" value=\"Upload!\"&gt;' +\n        '&lt;/form&gt;'\n    );\n};\n</code></pre>\n\n<p><strong>EDIT</strong>: I just realized it only happens in <strong>Firefox</strong>, not in Chrome!</p>\n"},{"tags":["node.js","gyp","node-gyp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13126472,"title":"Node-gyp to generate non Node.js projects?","body":"<p>Can <code>node-gyp</code> by used to generate non Node.js addon projects?</p>\n\n<p>For instance, I'd like to use <code>node-gyp</code> to generate a typical \"Hello, World!\" C++ project. Can I do this, and how would I go about it? I'm finding the stock python GYP documentation to lack in examples and description of what I'm looking for.</p>\n"},{"tags":["json","flash","node.js","serialization","remoteobject"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":8656780,"title":"How to send JSON to Flash from Node.js","body":"<p>I want a simple example of how to send data from a nodeJS server as JSON to Flash, then Flash decodes the JSON. This is part of what I want:</p>\n\n<p><strong>Server</strong></p>\n\n<pre><code>json = {name : \"Person\", id: \"1\"}\n</code></pre>\n\n<p><strong>Flash</strong></p>\n\n<pre><code>myinput.text = json.id + \":\" + json.name\n</code></pre>\n"},{"tags":["javascript","ajax","node.js","ip","scan"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":24,"score":-1,"question_id":13126255,"title":"Opensource IP checker like whoer.net","body":"<p>Is there any open source analogue of IP checker script like whoer.net ?</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13125915,"title":"Needed assistance in installing http-proxy module in node.js","body":"<p>I am trying to install http-proxy on Node, so I can set up a HTTPS proxy, but am running with the following error. Any suggestions as to how I can get http-proxy or any other suggestions how I can set up a HTTPS proxy using node.js. Thanks in advance</p>\n\n<p>npm install http-proxy</p>\n\n<pre><code>npm http GET https://registry.npmjs.org/http-proxy\nnpm http 304 https://registry.npmjs.org/http-proxy\nnpm ERR! Error: ENOTDIR, mkdir '/Users/rshroff/tmp/npm-15272/1351528387771-0.3611239262390882'\nnpm ERR! If you need help, you may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\n\nnpm ERR! System Darwin 11.3.0\nnpm ERR! command \"node\" \"/usr/local/bin/npm\" \"install\" \"http-proxy\"\nnpm ERR! cwd /Users/rshroff\nnpm ERR! node -v v0.8.10\nnpm ERR! npm -v 1.1.65\nnpm ERR! path /Users/rshroff/tmp/npm-15272/1351528387771-0.3611239262390882\nnpm ERR! code ENOTDIR\nnpm ERR! errno 27\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /Users/rshroff/npm-debug.log\nnpm ERR! not ok code 0\n</code></pre>\n"},{"tags":["node.js","express","ejs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13120457,"title":"EJS layouts on Express 3","body":"<p>I am having some problem with the EJS layout file on Express 3. Express just can't seem to find the layout for rendering. It just skips the layout.ejs totally which means that the output misses out of all the stylesheets and such.</p>\n\n<pre><code>res.render('login', { user: req.user });\n</code></pre>\n\n<p>and the configuration part,</p>\n\n<pre><code>app.set('views', __dirname + '/views');\napp.set('view engine', 'ejs');\n</code></pre>\n\n<p>and in the layout.ejs I have added the body tag,</p>\n\n<pre><code>&lt;%- body %&gt;\n</code></pre>\n\n<p>I have been trying out Jade before and it worked just fine, so the problem is just EJS.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["node.js","postgresql","node-postgres"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13124711,"title":"Storing a file in postgres using node-postgres","body":"<p>I'm trying to store a small file into a postgres db using the node-postgres module. I understand that I should use the bytea data type to do this. The problem I'm having is when I do some thing like:</p>\n\n<pre><code>fs.readFile path, (err, data) -&gt;\n    client.query 'UPDATE file_table SET file = $1 WHERE key = $2', [data, key], (e, result) -&gt;\n    ....\n</code></pre>\n\n<p>The contents of the file column in the db is: \\x and nothing is stored. If I change the data buffer to hex i.e. data.toString('hex') the file is stored but all formatting is lost when I read the file back out. </p>\n\n<p>What is the correct way of storing a file into postgres using the node-postgres module?</p>\n"},{"tags":["node.js","gcc","compiler-errors"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":13023239,"title":"Compiling Node gives \"No-old-style-declaration\" flag error","body":"<p>I'm compiling Node.js for a foreign system (Scientific Linux) and I'm getting this error on compilation.  I have checked the prerequisites for building Node in the README and I have Python installed and my version of make is 3.81.  I'm not sure why that flag throws cc1 off...</p>\n\n<pre><code>make -C out BUILDTYPE=Release V=1\nmake[1]: Entering directory `/home/nick/node_src/out'\n...\n...\n...\ncc '-D_LARGEFILE_SOURCE' '-D_FILE_OFFSET_BITS=64' '-DL_ENDIAN' '-DOPENSSL_THREADS' '-DPURIFY' '-D_REENTRANT' '-DOPENSSL_NO_DGRAM' '-DOPENSSL_NO_DTLS1' '-DOPENSSL_NO_SCTP' '-DOPENSSL_NO_SOCK' '-DOPENSSL_NO_RDRAND' '-DOPENSSL_NO_GOST' '-DOPENSSL_NO_HW_PADLOCK' '-DENGINESDIR=\"/dev/null\"' '-DOPENSSLDIR=\"/etc/ssl\"' '-DTERMIOS' -I../deps/openssl -I../deps/openssl/openssl -I../deps/openssl/openssl/crypto -I../deps/openssl/openssl/crypto/asn1 -I../deps/openssl/openssl/crypto/evp -I../deps/openssl/openssl/crypto/md2 -I../deps/openssl/openssl/crypto/modes -I../deps/openssl/openssl/crypto/store -I../deps/openssl/openssl/include -I../deps/openssl/config/k8  -Wall -Wextra -Wno-unused-parameter -pthread -m64 -Wno-missing-field-initializers -Wno-old-style-declaration -O2 -fno-strict-aliasing -fno-tree-vrp -fno-tree-sink  -MMD -MF /home/nick/node_src/out/Release/.deps//home/nick/node_src/out/Release/obj.target/openssl/deps/openssl/openssl/ssl/bio_ssl.o.d.raw  -c -o /home/nick/node_src/out/Release/obj.target/openssl/deps/openssl/openssl/ssl/bio_ssl.o ../deps/openssl/openssl/ssl/bio_ssl.c\ncc1: error: unrecognized command line option \"-Wno-old-style-declaration\"\nmake[1]: ***     [/home/nick/node_src/out/Release/obj.target/openssl/deps/openssl/openssl/ssl/bio_ssl.o] Error 1\nmake[1]: Leaving directory `/home/nick/node_src/out'\nmake: *** [node] Error 2\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["node.js","database-design","sequelize.js"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13125050,"title":"Confused about Sequelize associations","body":"<p>I just found Sequelize as a good ORM framework to use in my node + MySQL webapp. But when I was designing my database tables, I got so confused about Sequelize associations.</p>\n\n<p>Just think about user and system notification in a webapp as a very simple case:</p>\n\n<ul>\n<li>The site has many users</li>\n<li>The site would send notifications to some or every users, and the same notification just save as one record</li>\n<li>Users could know any notification he/she received is read or not(by a read date)</li>\n</ul>\n\n<p>Then I design 3 tables as expect:</p>\n\n<ol>\n<li><code>User</code>: <code>id</code>, <code>name</code></li>\n<li><code>Notification</code>: <code>id</code>, <code>title</code>, <code>content</code>, <code>sendAt</code></li>\n<li><code>Notify</code>: <code>id</code>, <code>UserId</code>(as receiver), <code>NotificationId</code>, <code>readAt</code></li>\n</ol>\n\n<p>I can simply define <code>User</code> and <code>Notification</code> models by Sequelize. But I just don't know how to use associations to make <code>Notify</code> relate to the 2 tables, by foreign key <code>UserId</code> and <code>NotificationId</code>.</p>\n\n<p>I have tried to use <code>hasOne</code> associations like this:</p>\n\n<pre><code>Notify.hasOne(User);\nNotify.hasOne(Notification);\n</code></pre>\n\n<p>Then there comes a <code>NotifyId</code> column in both <code>User</code> and <code>Notification</code> tables. And this is not as my expect. Maybe I thought a wrong way to use associations, so I wanna know how to use it correctly?</p>\n\n<p>Additionally, if I want to get results as the JSON:</p>\n\n<pre><code>[\n    {id: 123, user: [Object some user], notification: [Object some notification], readAt: null},\n    {id: 124, user: [Object another user], notification: [Object some notification], readAt: \"Mon Oct 29 2012 20:44:54 GMT+0800\"}\n]\n</code></pre>\n\n<p>how can I use <code>find</code> method query just once like in a SQL I used before:</p>\n\n<pre><code>SELECT\n    Notify.id as 'Notify.id',\n    User.name as 'User.name',\n    Notification.title as 'Notification.title',\n    Notification.sendAt as 'Notification.sendAt',\n    Notify.readAt as 'Notify.readAt'\nFROM User, Notification, Notify\nWHERE\n    Notify.UserId = User.id AND\n    Notify.NotificationId = Notification.id;\n</code></pre>\n"},{"tags":["node.js","google-chrome","angularjs","expressjs"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13119402,"title":"Filtering a page with infinite scroll in AngularJS","body":"<p>I implemented an infinite scrolling feature on my AngularJS + Node.js app.</p>\n\n<p>It is based on this JSfiddle and works the same way: <a href=\"http://jsfiddle.net/vojtajina/U7Bz9/\" rel=\"nofollow\">http://jsfiddle.net/vojtajina/U7Bz9/</a>\nHTML:</p>\n\n<pre><code>&lt;div id=\"fixed\" when-scrolled=\"loadMore()\"&gt;\n  &lt;ul&gt;\n   &lt;li ng-repeat=\"i in items\"&gt;{{i.id}}&lt;/li&gt;\n  &lt;/ul&gt;  \n&lt;/div&gt;​\n</code></pre>\n\n<p>Javascript:</p>\n\n<pre><code>function Main($scope) {\n  $scope.items = [];\n\n  var counter = 0;\n   $scope.loadMore = function() {\n     for (var i = 0; i &lt; 5; i++) {\n        $scope.items.push({id: counter});\n        counter += 10;\n     }\n   };\n\n  $scope.loadMore();\n}\n\nangular.module('scroll', []).directive('whenScrolled', function() {\n  return function(scope, elm, attr) {\n    var raw = elm[0];\n\n    elm.bind('scroll', function() {\n        if (raw.scrollTop + raw.offsetHeight &gt;= raw.scrollHeight) {\n            scope.$apply(attr.whenScrolled);\n        }\n    });\n  };\n});\n</code></pre>\n\n<p>​</p>\n\n<p>My reasons for implementing the infinite scroll is in order to save my users bandwidth by not loading all 1000 results and their corresponding images unless the user wants to see all of it.</p>\n\n<p>However when searching within the results using an AngularJS filter I am encountering problems, because of course not all the results are there (unless the user has scrolled to the very bottom) so the search will only return a fraction of the required results.</p>\n\n<p>I then removed the infinite scrolling feature in order to have the search function work properly but this provided new issues on chrome (not on Firefox though) when I open the page the browser starts loading images from the top. If I then filter the results by searching for something starting with \"z\" (at the very bottom of the results) Firefox switches focus and loads the results starting with \"z\" first (as they are then the only ones being displayed). However chrome continues loading through the list and thus the user will only see the results of their search (for \"z\") once all the images in the app have been loaded.</p>\n\n<p>I am looking for a way to have angular provide both the infinite scroll and a proper search filter on the results at the same time. If this is not possible then a way to make chrome load the visible images first.</p>\n\n<p>I am currently trying some weird stuff with a bunch of different arrays in the scope but I haven't had any luck so far.</p>\n"},{"tags":["node.js","vows"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":9,"score":1,"question_id":13122542,"title":"Cannot find module eyes","body":"<p>I have installed vows using 'npm install vows' and made sure that i have 'eyes' but running 'npm install eyes' in the terminal. I have checked that there a eyes folder in the node_modules folder in the local user. But when i run some test using 'vows' keyword, i get this error for the eyes module. I have tried uninstalling and reinstalling vows and eyes multiple times, but it didn't work. Can anyone help me fix this.</p>\n\n<p>module.js:340\n    throw err;</p>\n\n<p>Error: Cannot find module 'eyes'</p>\n\n<pre><code>at Function.Module._resolveFilename (module.js:338:15)\nat Function.Module._load (module.js:280:25)\nat Module.require (module.js:362:17)\nat require (module.js:378:17)\nat Object.&lt;anonymous&gt; (/usr/bin/vows:32:15)\nat Module._compile (module.js:449:26)\nat Object.Module._extensions..js (module.js:467:10)\nat Module.load (module.js:356:32)\nat Function.Module._load (module.js:312:12)\nat Module.runMain (module.js:487:10)\n</code></pre>\n"},{"tags":["mongodb","node.js","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1717,"score":2,"question_id":5535610,"title":"Mongoose Unique index not working!","body":"<p>I'm trying to let MongoDB detect a duplicate value based on its index. I think this is possible in MongoDB, but through the Mongoose wrapper things appear to be broken. So for something like this:</p>\n\n<pre><code>User = new Schema ({\n  email: {type: String, index: {unique: true, dropDups: true}}\n})\n</code></pre>\n\n<p>I can save 2 users with the same email. Darn.</p>\n\n<p>The same issue has been expressed here: <a href=\"https://github.com/LearnBoost/mongoose/issues/56\" rel=\"nofollow\">https://github.com/LearnBoost/mongoose/issues/56</a>, but that thread is old and lead to nowhere.</p>\n\n<p>For now, I'm manually making a call to the db to find the user. That call is not expensive since \"email\" is indexed. But it would still be nice to let it be handled natively.</p>\n\n<p>Does anyone have a solution to this?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12293941,"title":"anonymous error in nodejs mongodb","body":"<p>Guys I am facing the below irrelevant error.</p>\n\n<pre><code>500 Error: Argument passed in must be a single String of 12 bytes or a string of 24 hex characters\nat Function.createFromHexString (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/node_modules/mongodb/node_modules/bson/lib/bson/objectid.js:214:11)\nat ArticleProvider.findById (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/articleprovider-mongodb.js:61:89)\nat ArticleProvider.getCollection (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/articleprovider-mongodb.js:39:10)\nat Db.collection (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/node_modules/mongodb/lib/mongodb/db.js:478:44)\nat ArticleProvider.getCollection (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/articleprovider-mongodb.js:37:11)\nat ArticleProvider.findById (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/articleprovider-mongodb.js:58:10)\nat /home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/trucy-mongodb-express-node.js-blog-37daddd/app.js:63:21\nat callbacks (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/node_modules/express/lib/router/index.js:272:11)\nat param (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/node_modules/express/lib/router/index.js:246:11)\nat param (/home/r121/Desktop/nilesh/cmarin-MongoDB-Node-Express-Blog-4a5e5e9/node_modules/express/lib/router/index.js:243:11)\n</code></pre>\n\n<p>While I am just calling the <code>/blog/search</code> method which looks like this</p>\n\n<pre><code>app.get('/blog/search', function(req, res) {\n\n        res.render('blog_search.ejs', {\n            title: 'Search Contact',\n            });\n                 });\n</code></pre>\n\n<p>My <code>blog_search.ejs</code> looks like this</p>\n\n<pre><code>&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;\n   &lt;form method=\"post\" action=\"/blog/search\"&gt;\n     &lt;input type=\"text\" name=\"title\"&gt;\n     &lt;input type=\"submit\" name=\"submit\"&gt;\n</code></pre>\n\n<p>Please help me out with this error.I get this error while accessing it with the URL as well as the a href.</p>\n"},{"tags":["javascript","node.js","mongodb","express","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13121449,"title":"mongoose sequence swapping values","body":"<p><strong>i want to replicate the query operation in <a href=\"http://mongoosejs.com/\" rel=\"nofollow\">mongoose</a></strong>.</p>\n\n<p><em>I implemented the task in mysql as follows :-</em></p>\n\n<p>I create a table and the row serial is made in a continuous sequence by using mysql user defined variable.</p>\n\n<p>ID     serial</p>\n\n<p>101     1</p>\n\n<p>103     2</p>\n\n<p>104     3</p>\n\n<p>110     4</p>\n\n<p>In this to move the item with serial 4 to 2</p>\n\n<pre><code>SET @a = 2;\nUPDATE tableName SET serial = @a:=@a + 1 WHERE serial &gt;= 2 AND serial &lt; 4  \nORDER BY    serial DESC;\nUPDATE tableName SET serial = 2 WHERE ID = 1;\n</code></pre>\n\n<p>This query will add 1 to all the serial values less than 4 and greater than 2 and then update the row with serial 4 with value 2.</p>\n\n<p>And to move item 2 to 4</p>\n\n<pre><code>SET @b = 4;\nUPDATE tableName SET ord = @b:=@b - 1 WHERE  serial &gt; 2 AND serial &lt; (4 + 1)  \nORDER BY serial DESC;\nUPDATE tableName SET serial = 4 WHERE ID = 1 ;\n</code></pre>\n\n<p>I am not talking about Auto Increment.In my case I need to order the values as user required.So i cannot use Auto increment.</p>\n"},{"tags":["node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13117474,"title":"node-mongo-native findAndModify callback","body":"<p>I have been trying to get code in callback executed for couple of days now but am I not sure what I am doing wrong. Following is the code which I am trying to execute. For some reason callback is not getting executed even though the sequence is getting incremented. </p>\n\n<p>Please help.</p>\n\n<pre><code>var seqCollection = new mongodb.Collection(client, 'seq');\nseqCollection.findAndModify(\n    {\"_id\": \"name\"}, [], {$inc: {\"seq\": 1}}, {},\n    function (err, result) {\n        if (err){\n            console.log('--------- There is a an error ------------');\n        } else{\n            console.log('--------- New Value:' + JSON.stringify(result) + '------------');\n        }\n});\n</code></pre>\n"},{"tags":["javascript","node.js","networking","udp"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":447,"score":4,"question_id":11413364,"title":"Node.js UDP for realtime multi-player game","body":"<p>I am building a real-time multi-player browser-based game using node.js. At the moment I have the client send user input to the game logic server via socket.io and a snapshot of the game world sent back to the client for rendering.</p>\n\n<p>Below is a simplified version of the code. Is it possible to use UDP to send data from the browser-based client to the server and vice-versa? I know Node.js has a <a href=\"http://nodejs.org/api/dgram.html\" rel=\"nofollow\">UDP module</a> but I am unsure how to implement it in this way. </p>\n\n<p>Any help would be appreciated. Thank you.</p>\n\n<p>Server:</p>\n\n<pre><code>var server = http.createServer(handler).listen(8888);\nvar iosocket = io.listen(server);\n\n// request/response handler\nfunction handler(req, res){\n\n    ...\n}\n\niosocket.sockets.on('connection', function(socket){\n    console.log(\"[x] Socket listener started\");\n\n    socket.on('msg', function(data){\n        console.log( \" [-] incoming message);\n    });\n});\n\n...\n\niosocket.sockets.emit(\"message\", msg);\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;Test&lt;/title&gt;\n        &lt;script type=\"text/javascript\" src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n        &lt;script type=\"text/javascript\"&gt;\n            socket.on('connect', function(){\n             console.log(\"connected to server\");\n            });\n\n            socket.on('message', function(message){\n            console.log('received message');\n            });\n\n        &lt;/script&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;canvas id='canvas' width=\"400\" height=\"400\"&gt;Canvas&lt;/canvas&gt;\n    &lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["node.js","mongodb","expressjs","gridfs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13120385,"title":"How to parse ajax file upload using gridform in nodejs/express?","body":"<p>I am using express 3.x and node 1.9 with mongo and gridfs. To upload files I used gridfrom and it is working fine in normal form submit but not working in ajax based form submit. I followed few site but no help. <a href=\"http://www.davidpirek.com/blog/nodejs-html5-file-uploader\" rel=\"nofollow\">http://www.davidpirek.com/blog/nodejs-html5-file-uploader</a></p>\n\n<pre><code>var gridform = require('gridform'),\n    mongoose = require('mongoose'),\n    mongo,\n    db,\n    app;\n\n\nexports.upload_file = function(req, res){\n    var conn = mongoose.createConnection();\n    conn.open('localhost', 'employee', 27017, function (){\n        db             = conn.db;\n        mongo          = mongoose.mongo;\n        gridform.db    = db; \n        gridform.mongo = mongo;    \n\n        if ('POST' == req.method){              \n        var form = gridform();  \n\n      form.parse(req, function(err, fields, files) {\n        res.end(\"File ID:\" + files.text.id);\n        });\n     }\n    });\n}\n</code></pre>\n\n<p>The above code is working fine for normal form request. But not ajax form request. Below is my client side ajax call.</p>\n\n<h2>Client Side</h2>\n\n<pre><code>jQuery(\"form#someform\").change(function(event){\n    var formData = new FormData();\n    formData.append(\"filePath\", document.getElementById(\"filePath\").files[0]);\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"load\", function (evt) {\n        var obj = jQuery.parseJSON(evt.target.responseText);\n        window.location.hash = 'File';\n        MVC.message.show({text: obj.message, hideDealy: 2000});\n      }, false);\n    xhr.open(\"POST\", \"/upload_file\");\n    xhr.send(formData);\n});\n</code></pre>\n"},{"tags":["node.js","backbone.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13114110,"title":"backbone boilerplate: How to start the development server","body":"<p>I've cloned Backbone boilerplate which comes with an example Todo app. I have also read that the boilerplate comes with a development server, but I don't know how to start it. In the tutorial, it says you can run this command</p>\n\n<pre><code>node build/server\n</code></pre>\n\n<p>but I get an error saying that it can't find the module  /build/server</p>\n\n<p>Can anyone explain?</p>\n"},{"tags":["java","php","android","node.js","encryption-symmetric"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":651,"score":7,"question_id":11190114,"title":"Encryption and Decryption between Android, PHP & node.js","body":"<p>I'm trying to encrypt a string in Java on Android, and then decrypt it using PHP and/or node.js</p>\n\n<p>I've tried <a href=\"http://www.androidsnippets.com/encrypt-decrypt-between-android-and-php\">http://www.androidsnippets.com/encrypt-decrypt-between-android-and-php</a>, but only the first half the returned hex string works.</p>\n\n<p>I want the encryption type of be AES with a 128 bit key (higher if possible).</p>\n\n<p>The encryption key will also need to be configurable, so my issue might be related to how I padded the strings.</p>\n\n<p>Java</p>\n\n<pre><code>String.format(\"%1$-\" + n + \"s\", s)\n</code></pre>\n\n<p>PHP</p>\n\n<pre><code>$key = str_pad($key,16);\n</code></pre>\n\n<p>Full Java Code:</p>\n\n<pre><code>    package com.giggsey.test;\n\n\n    import java.security.NoSuchAlgorithmException;\n\n    import javax.crypto.Cipher;\n    import javax.crypto.NoSuchPaddingException;\n    import javax.crypto.spec.IvParameterSpec;\n    import javax.crypto.spec.SecretKeySpec;\n\n    import android.util.Log;\n\n\n    public class SimpleCrypto {\n\n            private String iv = \"fedcba9876543210\";//Dummy iv (CHANGE IT!)\n            private IvParameterSpec ivspec;\n            private SecretKeySpec keyspec;\n            private Cipher cipher;\n\n            private String SecretKey = \"0123456789abcdef\";//Dummy secretKey (CHANGE IT!)\n\n            public void doKey(String key)\n            {\n                    ivspec = new IvParameterSpec(iv.getBytes());\n\n                    key = padRight(key,16);\n\n                    Log.d(\"hi\",key);\n\n                    keyspec = new SecretKeySpec(key.getBytes(), \"AES\");\n\n                    try {\n                            cipher = Cipher.getInstance(\"AES/CBC/NoPadding\");\n                    } catch (NoSuchAlgorithmException e) {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                    } catch (NoSuchPaddingException e) {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                    }\n            }\n\n            public byte[] encrypt(String text,String key) throws Exception\n            {\n                    if(text == null || text.length() == 0)\n                            throw new Exception(\"Empty string\");\n\n                    doKey(key);\n\n                    byte[] encrypted = null;\n\n                    try {\n                            cipher.init(Cipher.ENCRYPT_MODE, keyspec, ivspec);\n\n                            encrypted = cipher.doFinal(padString(text).getBytes());\n                    } catch (Exception e)\n                    {                       \n                            throw new Exception(\"[encrypt] \" + e.getMessage());\n                    }\n\n                    return encrypted;\n            }\n\n            public byte[] decrypt(String code,String key) throws Exception\n            {\n                    if(code == null || code.length() == 0)\n                            throw new Exception(\"Empty string\");\n\n                    byte[] decrypted = null;\n\n                    doKey(key);\n\n                    try {\n                            cipher.init(Cipher.DECRYPT_MODE, keyspec, ivspec);\n\n                            decrypted = cipher.doFinal(hexToBytes(code));\n                    } catch (Exception e)\n                    {\n                            throw new Exception(\"[decrypt] \" + e.getMessage());\n                    }\n                    return decrypted;\n            }\n\n\n\n            public static String bytesToHex(byte[] data)\n            {\n                    if (data==null)\n                    {\n                            return null;\n                    }\n\n                    int len = data.length;\n                    String str = \"\";\n                    for (int i=0; i&lt;len; i++) {\n                            if ((data[i]&amp;0xFF)&lt;16)\n                                    str = str + \"0\" + java.lang.Integer.toHexString(data[i]&amp;0xFF);\n                            else\n                                    str = str + java.lang.Integer.toHexString(data[i]&amp;0xFF);\n                    }\n                    return str;\n            }\n\n\n            public static byte[] hexToBytes(String str) {\n                    if (str==null) {\n                            return null;\n                    } else if (str.length() &lt; 2) {\n                            return null;\n                    } else {\n                            int len = str.length() / 2;\n                            byte[] buffer = new byte[len];\n                            for (int i=0; i&lt;len; i++) {\n                                    buffer[i] = (byte) Integer.parseInt(str.substring(i*2,i*2+2),16);\n                            }\n                            return buffer;\n                    }\n            }\n\n\n\n            private static String padString(String source)\n            {\n              char paddingChar = ' ';\n              int size = 16;\n              int x = source.length() % size;\n              int padLength = size - x;\n\n              for (int i = 0; i &lt; padLength; i++)\n              {\n                      source += paddingChar;\n              }\n\n              return source;\n            }\n\n            public static String padRight(String s, int n) {\n                return String.format(\"%1$-\" + n + \"s\", s);  \n              }\n    }\n</code></pre>\n\n<p>PHP</p>\n\n<pre><code>&lt;?php\nclass MCrypt\n    {\n            private $iv = 'fedcba9876543210'; #Same as in JAVA\n            private $key = '0123456789abcdef'; #Same as in JAVA\n\n            function encrypt($str,$key) {\n             $key = str_pad($key,16);\n              //$key = $this-&gt;hex2bin($key);\n              $iv = $this-&gt;iv;\n\n              $td = mcrypt_module_open('rijndael-128', '', 'cbc', $iv);\n\n              mcrypt_generic_init($td, $key, $iv);\n              $encrypted = mcrypt_generic($td, $str);\n\n              mcrypt_generic_deinit($td);\n              mcrypt_module_close($td);\n\n              return bin2hex($encrypted);\n            }\n\n            function decrypt($code,$key) {\n              //$key = $this-&gt;hex2bin($key);\n              $code = $this-&gt;hex2bin($code);\n              $iv = $this-&gt;iv;\n\n              $td = mcrypt_module_open('rijndael-128', '', 'cbc', $iv);\n\n              mcrypt_generic_init($td, $key, $iv);\n              $decrypted = mdecrypt_generic($td, $code);\n\n              mcrypt_generic_deinit($td);\n              mcrypt_module_close($td);\n\n              return utf8_encode(trim($decrypted));\n            }\n\n            protected function hex2bin($hexdata) {\n              $bindata = '';\n\n              for ($i = 0; $i &lt; strlen($hexdata); $i += 2) {\n                    $bindata .= chr(hexdec(substr($hexdata, $i, 2)));\n              }\n\n              return $bindata;\n            }\n\n    }\n\n$e = new MCrypt();\n$p =  $e-&gt;encrypt(\"This is a sample text message\",\"password\");\n\necho \"Encrypted: {$p}\" . PHP_EOL;\n\necho \"Decrypted: \";\necho $e-&gt;decrypt($p,\"password\") . PHP_EOL;\n\necho \"Java Decryption: \";\n\necho $e-&gt;decrypt(\"9cf46d007aeff7c0c3cf880c76762037278269ac508aecd55010ce68e9fd980f\",\"password\");\n\necho PHP_EOL;\n</code></pre>\n\n<p>Java Calling Script:</p>\n\n<pre><code>    String key = \"password\";\n    String message = \"This is a sample text message\";\n\n    String encrypted;\n    try {\n        SimpleCrypto s = new SimpleCrypto();\n        encrypted = SimpleCrypto.bytesToHex(s.encrypt(message, key));\n        Log.d(\"giggsey-test\",encrypted);\n\n    } catch (Exception e) {\n        // TODO Auto-generated catch block\n        e.printStackTrace();\n    }\n</code></pre>\n\n<p>Output of encrypted strings:</p>\n\n<p>Java: 9cf46d007aeff7c0c3cf880c76762037278269ac508aecd55010ce68e9fd980f</p>\n\n<p>PHP:  9cf46d007aeff7c0c3cf880c76762037a1778e93dd596e4ce745e1f3b0ba9062</p>\n\n<p>Full PHP Output:</p>\n\n<blockquote>\n  <p>Encrypted: 9cf46d007aeff7c0c3cf880c76762037a1778e93dd596e4ce745e1f3b0ba9062</p>\n  \n  <p>Decrypted: 'Ã½A==)nÃ¿|Ã¤Â¨</p>\n  \n  <p>xÃÃ¦Ã,ÃÃÂasV8gE</p>\n  \n  <p>Java Decryption: 'Ã½A==)nÃ¿|Ã¤Â¨</p>\n  \n  <p>xÃ1)Ã²ÃÃ®ÃÃAÂ½Ã</p>\n  \n  <p>rÂy</p>\n</blockquote>\n"},{"tags":["jquery","css","node.js","socket.io","dust.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":13108749,"title":"Blur entire <li> except last word","body":"<p>I've got a socket.IO application, which also saves the data to MongoDB.</p>\n\n<p>I'm trying to find a method that blur's the entire sentence except for the last word.</p>\n\n<p>The code for where the lines will be:</p>\n\n<pre><code>{#storylines}\n&lt;li&gt;{text}&lt;/li&gt;\n{/storylines}\n\n&lt;input id=\"newstoryline\" name=\"newstoryline\" class=\"StoryBoard\" type=\"text\" placeholder=\"\" onKeyDown=\"countChars()\" onKeyUp=\"countChars()\"/&gt;\n</code></pre>\n\n<p>Socket.IO:</p>\n\n<pre><code>socket.on('updatechat', function (username, data) {\n  $('#newstoryline').before('&lt;li&gt;' + data + '&lt;/li&gt;');\n});\n</code></pre>\n\n<p>The application will also send {maxlines} to the template will will include the number of lines left. Basically i'm looking for a way to say:</p>\n\n<p>if {maxlines} > 0 then blur the 'data' except for the last word. </p>\n\n<p>So if the message from the server was \"Hello my name is Jim!\" i would want to to be \"<strong><em></strong> *</em> *<em>*</em> ** Jim!\" so the user can only see the word Jim!</p>\n\n<p>I'm using Node.JS/Mongoose/Socket.IO</p>\n\n<p>Would i have to implement some sort of javascript function on the client side to check if {maxlines} > 0 and then apply the blur effec to the lines or would i do something on the server-side?</p>\n\n<p>Currently this is how the server sends information:</p>\n\n<pre><code>app.get('/s/:id', function(req, res){\n    Story.findOne({ sid: req.params.id }, function(err, story){\n            if (err) {\n            res.redirect('/')\n        }\n        else if(story == null) {\n            res.redirect('/')\n        }\n        else{\n    res.render('story', {\n        title: 'Storifi',\n        storytitle: story.title,\n        storylines: story.lines,\n        lines: story.maxlines,\n        storyid: story.sid\n            maxlines: story.maxlines   \n\n                });\n            }\n        });\n});\n</code></pre>\n\n<p>Socket.IO (server-side):</p>\n\n<pre><code>socket.on('sendchat', function (data) {\n    // we tell the client to execute 'updatechat' with 2 parameters\n    io.sockets.in(socket.room).emit('updatechat', socket.username, data);   \n</code></pre>\n"},{"tags":["node.js","socket.io","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12913141,"title":"installing from npm fails","body":"<p>I can't install any node module from the npm.</p>\n\n<pre><code>npm install socket.io\n</code></pre>\n\n<p>The above command resulted to below output, it is not able to install socket.io</p>\n\n<pre><code>npm http GET https://registry.npmjs.org/socket.io\n\nnpm ERR! Error: failed to fetch from registry: socket.io\nnpm ERR!     at /opt/node0610/lib/node_modules/npm/lib/utils/npm-registry-client/get.js:139:12\nnpm ERR!     at cb (/opt/node0610/lib/node_modules/npm/lib/utils/npm-registry-client/request.js:32:9)\nnpm ERR!     at Request._callback (/opt/node0610/lib/node_modules/npm/lib/utils/npm-registry-client/request.js:137:18)\nnpm ERR!     at Request.callback (/opt/node0610/lib/node_modules/npm/node_modules/request/main.js:109:22)\nnpm ERR!     at Request.&lt;anonymous&gt; (/opt/node0610/lib/node_modules/npm/node_modules/request/main.js:198:58)\nnpm ERR!     at Request.emit (events.js:88:20)\nnpm ERR!     at ClientRequest.&lt;anonymous&gt; (/opt/node0610/lib/node_modules/npm/node_modules/request/main.js:195:10)\nnpm ERR!     at ClientRequest.emit (events.js:67:17)\nnpm ERR!     at CleartextStream.&lt;anonymous&gt; (http.js:1134:11)\nnpm ERR!     at CleartextStream.emit (events.js:67:17)\nnpm ERR! You may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\nnpm ERR! \nnpm ERR! System Linux 2.6.18-194.el5\nnpm ERR! command \"node\" \"/opt/node0610/bin/npm\" \"install\" \"socket.io\"\nnpm ERR! cwd /opt/node0610/lib/node_modules\nnpm ERR! node -v v0.6.10\nnpm ERR! npm -v 1.1.0-3\nnpm ERR! message failed to fetch from registry: socket.io\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /opt/node0610/lib/node_modules/npm-debug.log\nnpm not ok\n</code></pre>\n\n<p>My NPM Version is :</p>\n\n<pre><code>[applmgr@dev node_modules]$ npm --version\n1.1.0-3\n</code></pre>\n\n<p>My NodeJS Version is :</p>\n\n<pre><code>[applmgr@dev node_modules]$ node --version\nv0.6.10\n</code></pre>\n"},{"tags":["node.js","ldapconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13118963,"title":"LDAP authentication Support in Node js","body":"<p>i have installed ldapauth using npm install ldapauth and i installed ldapjs.\ni tried with the following code </p>\n\n<pre><code>var sys   = require('sys'),\nldapauth  = require('./ldapauth'); \nvar scheme    = 'ldap',\n    ldap_host = 'abc.com',\n    ldap_port = 369,\n    username  = 'xxx',\n    password  = 'xxx'\n    base      = \"DC=abc,DC=xyz,DC=com\";\n    filter    = \"(&amp;(objectclass=user)(sAMAccountName= 3025141))\";\nconsole.log(\"Authentication Check\");\nldapauth.authenticate(scheme, ldap_host, ldap_port, username, password,\n  function(err, result) {\n      if (err) {\n          console.log(err);\n      } else {  \n          console.log('Authenticated ! ! ! ! ! : ' + result);\n      }\n  });\n\n//ldap authentication Search\nldapauth.search(ldap_host, ldap_port, username, password, base, filter,\n  function(err, result) {\n      if (err) {\n        sys.puts(err);\n      } else {\n        sys.puts('Search: ' + JSON.stringify(result));\n      }\n  });\n</code></pre>\n\n<p>I tried in mac but I am getting <code>Segmentation fault: 11</code> error. How can I fix this?</p>\n"},{"tags":["algorithm","node.js","logic","metadata","opengraph"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13050320,"title":"Scraping algorithm for open graph in nodejs","body":"<p>I'm trying to get open graph metadata from an URL using nodejs (with cheerio),\nusing the code bellow.</p>\n\n<p>I have this thing to fill:    <code>var result={};</code></p>\n\n<pre><code>  for (var ogCounter = 0; ogCounter &lt; metalist.length; ogCounter++) {\n    if (!utils.isEmpty(metalist[ogCounter].attribs.property) &amp;&amp; !utils.isEmpty(metalist[ogCounter].attribs.content)) {\n        if (metalist[ogCounter].attribs.property.indexOf('og') == 0) {\n            var ogname = metalist[ogCounter].attribs.property.split(':');\n            var property = ogname[1];\n            var content = metalist[ogCounter].attribs.content;\n\n            if (utils.isEmpty(result[property])) {\n                result[property] = content;\n            } else {\n                if (result[property].push) {\n                    result[property].push(content);\n                } else {\n                   result[property] = [result[property], content];\n                }\n            }\n\n        }\n    }\n}\n</code></pre>\n\n<p>After I populate the result I converted in a JSon and with this code I get something like:</p>\n\n<pre><code>type: \"video\",\nimage: \"http://i3.ytimg.com/vi/fWNaR-rxAic/mqdefault.jpg\",\nvideo: [\n\"http://www.youtube.com/v/fWNaR-rxAic?version=3&amp;amp;autohide=1\",\n\"application/x-shockwave-flash\",\n\"1920\",\n\"1080\"\n]\n</code></pre>\n\n<p>But the thing I want is something like:</p>\n\n<pre><code>type: \"video\",\nimage: \"http://i3.ytimg.com/vi/fWNaR-rxAic/mqdefault.jpg\",\nvideo: {\n\"http://www.youtube.com/v/fWNaR-rxAic?version=3&amp;amp;autohide=1\",\n{ \ntype:\"application/x-shockwave-flash\",\nwidth:\"1920\",\nheight:\"1080\"\n}\n}\n</code></pre>\n\n<p>I'm trying this \"if\" but it doesn't work:</p>\n\n<pre><code> if (utils.isEmpty(result[property])) {\n                    result[property] = content;\n                } else {\n                    if (result[property].push) {\n                        result[property].push(content);\n                    } else {\n                        var subresult={};\n                        subresult[name[2]]=content;\n                        subresult[property]=result[property] ;\n\n                        result[property] = subresult;\n                    }\n                }\n</code></pre>\n\n<p>I don't want to cycle all the meta 2 times and I'm not good with javascript and nodejs function... Any suggestion? Thanks</p>\n"},{"tags":["php","node.js","session","yii","memcached"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":61,"score":3,"question_id":13119203,"title":"Using memcached to store session data,is it safe?","body":"<p>I should develop web site to complete some data about books with great auto complete.\nEach page has around 1500 ajax request to server!</p>\n\n<p>So I decided to do main part of it with Yii framework and instead of using ajax,us Socket.IO of NodeJS for faster response.</p>\n\n<p>Now the problem is sync session data between two programming language. Is it safe to use memcached to store it?</p>\n\n<p>I mean save SESSIONID as key name in memcached and using JSON for value.\nso I can access it by PHP and NodeJS.\nIs it safe?</p>\n"},{"tags":["javascript","node.js","asynchronous","async.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":13099033,"title":"Recursively create directories from a multi-level JSON (with async.js)","body":"<p><strong>DEFINITION</strong></p>\n\n<pre><code>File#createDirectoriesFromJSON (json, cb);\n</code></pre>\n\n<p>json: JSON object.</p>\n\n<p>cb: Function. Parameters: error (Error), created (Boolean, true if at least one directory has been created).</p>\n\n<p>Supose that the File class contains a property named <code>_path</code> that contains the path of a directory.</p>\n\n<p><br/>\n<strong>USAGE</strong></p>\n\n<pre><code>var json = {\n    b: {\n        c: {\n            d: {},\n            e: {}\n        },\n        f: {}\n    },\n    g: {\n        h: {}\n    }\n};\n\n//this._path = \".\"\nnew File (\".\").createDirectoriesFromJSON (json, function (error, created){\n    console.log (created); //Prints: true\n\n    //callback binded to the File instance (to \"this\"). Hint: cb = cb.bind (this)\n    this.createDirectoriesFromJSON (json, function (error, created){\n        console.log (created); //Prints: false (no directory has been created)\n    });\n});\n</code></pre>\n\n<p><br/>\n<strong>RESULT</strong></p>\n\n<p>Under \".\" the directory tree showed in the json object has been created.</p>\n\n<blockquote>\n  <p>./b/c/d<br>\n  ./b/c/e<br>\n  ./b/f<br>\n  ./b/g/h  </p>\n</blockquote>\n\n<p><br/>\n<strong>IMPLEMENTATION</strong></p>\n\n<p>This is what I have <strong><em>without</em></strong> async.js:</p>\n\n<pre><code>File.prototype.createDirectoriesFromJSON = function (json, cb){\n    cb = cb.bind (this);\n\n    var created = false;\n    var exit = false;\n\n    var mkdir = function (path, currentJson, callback){\n        var keys = Object.keys (currentJson);\n        var len = keys.length;\n        var done = 0;\n\n        if (len === 0) return callback (null);\n\n        for (var i=0; i&lt;len; i++){\n            (function (key, i){\n                var dir = PATH.join (path, key);\n                FS.mkdir (dir, function (mkdirError){\n                    exit = len - 1 === i;\n\n                    if (mkdirError &amp;&amp; mkdirError.code !== \"EEXIST\"){\n                        callback (mkdirError);\n                        return;\n                    }else if (!mkdirError){\n                        created = true;\n                    }\n\n                    mkdir (dir, currentJson[key], function (error){\n                        if (error) return callback (error);\n                        done++;\n                        if (done === len){\n                            callback (null);\n                        }\n                    });\n                });\n            })(keys[i], i);\n        }\n    };\n\n    var errors = [];\n\n    mkdir (this._path, json, function (error){\n        if (error) errors.push (error);\n        if (exit){\n            errors = errors.length === 0 ? null : errors;\n            cb (errors, errors ? false : created);\n        }\n    });\n};\n</code></pre>\n\n<p>Just for curiosity I want to rewrite the function using async.js. The problem here is that the function is recursive and parallel. For example, the \"b\" folder is created in parallel with \"g\". The same for \"b/c\" and \"b/f\", and \"b/c/d\" and \"b/c/e\".</p>\n"},{"tags":["ios","json","node.js","nsurlrequest","afnetworking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13096746,"title":"Nested NSDictionary & NSArray with AFNetworking not working properly","body":"<pre><code>NSDictionary *customerDictionary = [NSDictionary dictionaryWithObjectsAndKeys:@\"blah@blah.com\", @\"email\", @\"1\", @\"facebook\", nil];\nNSArray *customerArray = [NSArray arrayWithObjects:customerDictionary, nil];\nNSDictionary *parameters = [NSDictionary dictionaryWithObjectsAndKeys:customerArray, @\"customers\", nil];\nNSURLRequest *request = [sharedHTTPClient requestWithMethod:@\"POST\" path:@\"/api/upload\" parameters:parameters];\nAFJSONRequestOperation *operation =\n    [AFJSONRequestOperation JSONRequestOperationWithRequest:request\n                                                    success:^(NSURLRequest *request, NSHTTPURLResponse *response, id JSON) {}\n                                                    failure:^(NSURLRequest *request, NSHTTPURLResponse *response, NSError *error, id JSON) {}];\n[operation start];\n</code></pre>\n\n<p>On a Node.JS backend, printing out the body shows:</p>\n\n<pre><code>{ customers: [ '1', 'blah@blah.com' ] }\n</code></pre>\n\n<p>Expected print should be:</p>\n\n<pre><code>{ customers: [{ facebook:'1', email:'blah@blah.com' }] }\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["flash","node.js","file-upload","ajaxuploader"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":44,"score":-3,"question_id":13118108,"title":"how to upload large file in node.js?","body":"<p>here is what i want:ajax upload file with progress bar and must support most browser(including IE6+), so i figure i have to use flash upload,but it seems it is a impossible mission with node.js backend,so hard.i almost try everything uploadify,jquery file upload, swfupload, its so complicate and all docs sucks.</p>\n\n<p>am using express.js and express.js handle the multipart base on formidable, honestly file upload in express.js is very simple, the difficult is how to show a progress bar .</p>\n\n<p>please please please help me!!! how to add a flash uploader in node.js</p>\n"},{"tags":["node.js","express","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13116242,"title":"Express js res.redirect() from mongoose callback not working","body":"<p>What I'm trying to do here is,</p>\n\n<p>from <code>/expense/new</code> page submitting <code>POST</code> request to <code>/expense/newPost</code></p>\n\n<p>on Expressjs, handling this way</p>\n\n<pre><code>app.post('/expense/newPost', function(req, res) { ...\n</code></pre>\n\n<p>continue, using <code>mongoose</code> I validate the collection as </p>\n\n<pre><code>tmpExp = new Expense(req.body);\n\ntmpExp.validate(function(err) {\n  if(err || !isValidForm) {\n    req.session.form.errField =  _.extend(req.session.form.errField, (err.errors || err ));\n    req.session.rePop = req.body;\n    res.redirect('/expense/new');\n  } else {\n    console.log('now saving') // successfully logs here.\n    tmpExp.save(expPost, function(err2, savedDoc) {\n      if(err2) {\n        req.session.flash = { \n            global: true\n          , css: \"error\"\n          , message: \"Internal Server Error\"\n        }\n        res.redirect('/expense/new');\n      } else {\n        res.redirect('/expense/new?success=' + savedDoc.bill_id);\n      }\n    });\n  }\n});\n</code></pre>\n\n<p>for shake of clearity I removed some of the validation code.</p>\n\n<p><strong>Now the problem is, after submitting the POST request by browser data is successfully saved in mongodb but browser not redirect and just waiting for response from server</strong></p>\n"},{"tags":["node.js","mongodb","mongoose","slug"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13116806,"title":"How to migrate existing objects when adding url slug identifier to mongoose schemas","body":"<p>I'm currently using Mongodb ObjectIds in my urls but I would like to use this module instead:\n<a href=\"https://github.com/dylang/shortid\" rel=\"nofollow\">https://github.com/dylang/shortid</a></p>\n\n<p>But none of the existing data will have these slugs yet. How can I migrate them all? Everywhere I look people are saying you don't need to migrate data in noSQL.</p>\n\n<p>Here's an example schema, I'm adding the 'shortid' field:</p>\n\n<pre><code>var ItemSchema = new Schema({\n    name    : { type: String, required: true, trim: true }\n    , description: { type: String, trim: true }\n    , comments  : [CommentSchema]\n    , shortid : { type: String, required: true }\n});\n</code></pre>\n\n<p>My intention is to use urls like /items/PPBqWA9 instead of /items/508cbd80c0e1a44277000003</p>\n\n<p>I will have a .pre('save') method that generates the shortid if it doesn't exist already.</p>\n\n<p>Or maybe I can have the default be a function that calls ShortId.generate()?</p>\n\n<p>Two requirements:\n1) Never change it\n2) Apply to existing objects retro-actively.</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13114474,"title":"Finding items by simpler ID's on MongooseJS","body":"<p>I'm playing with mongoose schemas. I have 3 items, each one with a corresponding ID field like this:</p>\n\n<pre><code>\"_id\": \"508dcb79cb1c8ad910000001\",\"\n\"_id\": \"508dcba389e2f32e11000002\",\"\n\"_id\": \"508dcba389e2f32e11000003\",\"\n</code></pre>\n\n<p>Is there any default way to process that big chunk of ID to get a cleaner one without having to set up custom id's numbers to just get the last numbers, corresponding the ID?\nOr should I use a regex or something to be able to get them by id like this:</p>\n\n<pre><code>app.get('/fields/:id', function(req, res) { ; });\n</code></pre>\n\n<p>And access them with <code>/field/1</code>, <code>/field/3</code> or whatever.</p>\n"},{"tags":["javascript","node.js","angular","html-rendering"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":335,"score":0,"question_id":12203192,"title":"Client Side HTML MVC Rendering vs Server Side Rending via NodeJS","body":"<p>We are looking for options on our team to decide between a Angular based client side MVC approach and a server side NodeJS / ExpressJS server side render approach. </p>\n\n<p>Our Angular app downloads as one index.html and makes XHR requests to populate the page. Since we need the page to be pre-rendered we have used PhantomJS to save off a copy of every page when the content changes to a location on the server. This allows support for SEO. </p>\n\n<p>Are there any examples of full page backbone applications or angular applications that people can point to for us to see if others are doing this. </p>\n\n<p>Alternatively are the examples of NodeJS server side rendered applications we can see in the wild. </p>\n\n<p>Lastly does anyone have opinions on this sort of architecture?</p>\n"},{"tags":["node.js","backbone.js","socket.io","backbone-relational"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13108151,"title":"Backbone.relational, real-time and handling large data","body":"<p>I'm building a real-time feed application using Backbone.js, node.js and socket.io.</p>\n\n<p>My <code>Feed</code> is a collection of <code>Update</code> models. Displaying these, overriding <code>Backbone.sync</code> for integration with <code>socket.io</code> works fine.</p>\n\n<p>The complication comes in that each <code>Update</code> has a set of comments associated with it. When I show each <code>Update</code> in the <code>Feed</code> view, I want to show a summary of the associated comments (number of comments and a single 'most poular' comment), and also have the ability to click through to a different view to display each <code>Update</code> on its own with a paginated list of comments with further data.</p>\n\n<p>I'm using <code>backbone-relational</code> to model the relationship between the <code>Update</code> model and <code>Comment</code> model, as follows:</p>\n\n<p><code>Feed (collection) -&gt; Update (model) -(has many)-&gt; Comment (model)</code></p>\n\n<p>I've been following this <code>backbone-relational</code> tutorial, but it seems to assume that I'd want to have all related data in memory at once in my <code>Feed</code> view, which I don't as there are potentially thousands of comments updating in real-time:</p>\n\n<p><a href=\"http://antoviaque.org/docs/tutorials/backbone-relational-tutorial/\" rel=\"nofollow\">http://antoviaque.org/docs/tutorials/backbone-relational-tutorial/</a></p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>How can I bring in summary data for comments to each <code>Update</code> in my <code>Feed</code> view without loading all comment data, and also maintain the ability to show paginated full data in my <code>Update</code> view?</li>\n<li>I'm using <code>backbone.layoutmanager</code> for rendering my views. How best should I break my views up to accomplish the above?</li>\n</ol>\n"},{"tags":["json","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13062586,"title":"node js and json.s","body":"<p>I am looking how I can use node.js to decode json.</p>\n\n<p>My Application is very simple.\nI will get a Request: PUT with json.\nI need to check the json body for some value if that is present send a succuess (200) response.</p>\n\n<p>how can I do in node to valid json.</p>\n\n<p>,</p>\n"},{"tags":["node.js","bug","promise"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13115925,"title":"Node promise-io - why crash?","body":"<p>I'm working my way through the <a href=\"http://www.nodebeginner.org/\" rel=\"nofollow\">Node Beginner Tutorial</a> while tailoring things to work with my development style. For example I'm selecting to use coffeescript, and requirejs. The later involves a great deal of callback-soup on top of the significant regular amount. Usually these are situations I like to deal with using promises. After some minimal research <a href=\"https://github.com/kriszyp/promised-io\" rel=\"nofollow\">promise-io</a> seems like a reasonable solution.  It works but suddenly I'm running into a problem combining promises using all (which seems analagous to jQuery.when - where this is a technique I use frequently).</p>\n\n<p>The following is my server.coffee file. As is it works perfectly, replacing the nested deferreds with the <code>all</code> call serves one request then hangs the server. Does anyone have any idea what the problem is?</p>\n\n<pre><code>exports.start = -&gt;\n    requirejs ['http', 'url', './route'], (http, url, route)-&gt;\n        console.log \"Starting server\"\n        server = http.createServer (request, response) -&gt;\n            pathdata = url.parse request.url\n\n            ###\n            #this breaks\n            promise.all(readingPost(request), route.promise).then (x) -&gt;\n                [postData, route] = x\n                route pathdata, response, postData\n            ###\n            #this works\n            readingPost(request).then (postData) -&gt; route.promise.then (route) -&gt;\n                route pathdata, response, postData\n\n        server.listen 8888\n\nreadingPost = (request) -&gt;\n    request.setEncoding 'utf-8'\n    data = ''\n    request.addListener 'data', (dataChunk) -&gt;\n        data += dataChunk\n    d = promise.Deferred()\n    request.addListener 'end', -&gt; d.resolve data\n    d\n</code></pre>\n"},{"tags":["node.js","url","file-download","formidable"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13116189,"title":"How to access an image in d file storage system via URL in nodejs?","body":"<p>I want to access an image(or a binary file) stored in the disk system via URL..\nUsing createWriteStream() we can save the file only if the server &amp; client running in the same system..\nAs I have seen from many websites there's an option of http.get to access the files even when the client is running on a different machine. But the problem is , there we have to specify an URL for that..\nSo, my question is , how can we map the files in disk system to particular URLs so that it can be accessed by any client on any machine connected to the server?\nOr if u have some other solutions please specify for the same problem.. \np.s I'm using formidable node module for uploading to the disk system in which the server is running..</p>\n"},{"tags":["node.js","websocket","socket.io","multiplayer"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":284,"score":4,"question_id":12973991,"title":"How expensive to build a realtime massive multiplayer game using node.js/socket.io?","body":"<p>Hi I am trying to build a realtime multiplayer game using node.js and socket.io.</p>\n\n<p>Now, implementing itself in terms of coding won't be so much of a problem, but coming from a traditional http request-response web programming model, I have no idea how expensive this would be in terms of traffic and server load. Basically during a game, a player's browser should track realtime mouse input events and keep broadcasting them to all other players in the same game.</p>\n\n<p>Here's an example, let's say my avatar follows around my mouse pointer on the screen, and it should be broadcasted to rest of the players on the screen in realtime. I would do something like:</p>\n\n<pre><code>// client side\n$(document).on(\"mousemove\", function(event){\n    io.emit(\"coordinate\", {x: event.pageX, y: event.pageY});\n});\n</code></pre>\n\n<p>and on the server:</p>\n\n<pre><code>// server side\nio.sockets.on(\"connection\", function(socket){\n    ...\n    socket.on(\"coordinate\", function(coordinate){\n        socket.get(\"username\", function(err, username){\n            socket.broadcast.emit(\"move\", {username: username, coordinate:coordinate});\n        });\n    });\n    ...\n});\n</code></pre>\n\n<p>I think this should work, but this requires the browser emitting several events per second to the server, which subsequently should broadcast them to rest of the players in the same game, and I am worried about the implication of this. One thing though is that the size of each fragment of data being transmitted is not that large (basically it's just an x and y coordinate). If this is too expensive, no matter how great this game is, I don't think I can ship it. Could anyone enlighten me? Thank you.</p>\n\n<p>[EDIT] To clarify, I am not asking about how to make this architecture more efficient. I just want to know if this type of system is realistic enough in terms of system load (and maintenance cost) For ordinary web services I can just estimate the cost by looking at page view numbers but websocket is an entirely new field I am not aware of, so I wanted to ask.</p>\n"},{"tags":["node.js","hosting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13114922,"title":"Trouble hosting website at home","body":"<p>I have setup a node.js server. And everything works from localhost to private IP. All devices in the private network can access the internet. I also established port forwarding, opened port on firewalls. And configured a DNS server for mapping the domain name and public IP. I can ping to the domain name and public IP without problem. But still the website is not online. What did I miss?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13113312,"title":"Mongo Express doesn't correctly display embedded documents","body":"<p>I'm using <a href=\"http://andzdroid.github.com/mongo-express/\" rel=\"nofollow\">Mongo Express</a> to view my data in my MongoDB instance during development. I also use the connect-mongo module to store my sessions in MongoDB. For some reason, Mongo Express has difficulties parsing embedded documents created by connect-mongo. The indention doesn't quite work and quotes are escaped. Documents created in connect-mongo do work, as well as those created with mongoose.</p>\n\n<p><img src=\"http://i.stack.imgur.com/FfMmF.png\" alt=\"\"></p>\n"},{"tags":["node.js","heroku","eventsource"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13063683,"title":"H15 on Heroku SSE request","body":"<p>I have a Node.js application on Heroku. I've recently switched a long query to use SSE (EventSource). While it works great and fast on my machine, I keep getting an <code>Error H15 (Idle connection)</code> on my GET request. The H15 description says I went over 55 seconds allowed per transaction. But my entire query doesn't take more than 4-5 seconds. </p>\n\n<p>Furthermore, after reading the description, I'm returning my first byte (just a number) immediately upon hitting the query, before it starts any heavy work - and it still doesn't work.</p>\n\n<p>My question/s are:</p>\n\n<ol>\n<li>What do I need to do in order to keep this thing going? An HTTP header parameter? Something on the client JS side? How do I avoid H15?</li>\n<li>Am I trying to do something not supported by Heroku? I don't think so, as I have another app on Heroku that uses EventSource successfully (<a href=\"http://express-eventsource.herokuapp.com\" rel=\"nofollow\">express-eventsource.herokuapp.com</a>, source on github: <a href=\"https://github.com/TravelingTechGuy/express-eventsource\" rel=\"nofollow\">https://github.com/TravelingTechGuy/express-eventsource</a>)</li>\n</ol>\n\n<p>As always, thanks for your time.</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13108543,"title":"Running multiple sites on node.js","body":"<p>I'm planning to do three sites using node.js. I have got some common templates among the sites. Should I run all three sites on single node.js instance? </p>\n\n<p>I'm aware of 'vhost' middleware that allows you to run multiple domains on single http server. Is there any better option to do this? </p>\n\n<p>I've also got some static html templates and not sure how to deal with these in node.js?</p>\n\n<p>Finally I would like to know hosting options for this kind of setup? </p>\n"},{"tags":["node.js","ffmpeg","thumbnails"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13115200,"title":"fluent-ffmpeg thumbnail creation error","body":"<p>i try to create a video thumbnail with fluent-ffmpeg here is my code </p>\n\n<pre><code>var ffmpeg = require('fluent-ffmpeg');\n\nexports.thumbnail = function(){\n    var proc = new ffmpeg({ source: 'Video/express2.mp4',nolog: true })\n    .withSize('150x100')\n    .takeScreenshots({ count: 1, timemarks: [ '00:00:02.000' ] }, 'Video/', function(err, filenames) {\n    console.log(filenames);\n    console.log('screenshots were saved');\n  });\n}\n</code></pre>\n\n<p>but i keep getting this error </p>\n\n<pre><code>  \"mate data contains no duration, aborting screenshot creation\"\n</code></pre>\n\n<p>any idea why,</p>\n\n<p>by the way am on windows, and i put the ffmpeg folder in c/ffmpeg ,and i added the ffmpeg/bin in to my environment varable， i dont know if fluent-ffmpeg need to know the path of ffmpeg,but i can successfully create a thumbnail with the code below</p>\n\n<pre><code>   exec(\"C:/ffmpeg/bin/ffmpeg -i Video/\" + Name  + \" -ss 00:01:00.00 -r 1 -an -vframes 1 -s 300x200 -f mjpeg Video/\" + Name  + \".jpg\")\n</code></pre>\n\n<p>please help me!!!</p>\n"},{"tags":["node.js","mocha"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13110322,"title":"Mocha prematurely exits from testing","body":"<p>I am using <a href=\"http://visionmedia.github.com/mocha/\" rel=\"nofollow\">Mocha</a> to run some tests on my <a href=\"http://brianmhunt.github.com/SnailMailAddressParser/\" rel=\"nofollow\">SnailMailAddressParser</a> project from the command-line. Unfortunately only some tests are run before Mocha exits.</p>\n\n<p>The test file is very straightforward. You can <a href=\"https://github.com/brianmhunt/SnailMailAddressParser/blob/master/test/test.coffee\" rel=\"nofollow\">see the test file here: test/test.coffee</a></p>\n\n<p>It seems there is a race condition somewhere. When I run <code>npm test</code>, it does one of two things:</p>\n\n<ol>\n<li>Runs <a href=\"https://github.com/brianmhunt/SnailMailAddressParser/blob/master/test/test.coffee#L13\" rel=\"nofollow\">one test</a>; or</li>\n<li>Runs 34 tests, starting at <a href=\"https://github.com/brianmhunt/SnailMailAddressParser/blob/master/test/test.coffee#L55\" rel=\"nofollow\">address_tester</a>.</li>\n</ol>\n\n<p>Clearly I am doing something asynchronous that needs to be caught, but I am not quite sure what yet. In any case, I do not know how to tell Mocha to wait for any asynchronous items to be reaped (i.e. some sort of <code>Mocha.wait_all</code>, if that is even possible - perhaps I have to add' <code>done()</code> calls, but I didn't think that was necessary for synchronous testing - which I thought this might be).</p>\n\n<p>I will experiment of course and post any answers I glean from my testing, but I would be grateful for any insight.</p>\n"},{"tags":["json","node.js","jquery-ajax"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13114146,"title":"line-based when sending a JSON through an ajax call","body":"<p>I need to perform an AJAX call to send some JSON object to a server</p>\n\n<pre><code>  $.ajax({\n    url: serviceURL+'stores/'+store_id+'/karaoke/song/new',\n    type: \"POST\",\n    contentType: \"application/json; charset=utf-8\",\n    data: { song: id, date: \"date\", user: \"test\", help: false, partners: [], likes: 0 },\n    dataType: \"json\"\n  });\n</code></pre>\n\n<p>that's what i got, I used wireshark to log what i was sending and what i was sending was this</p>\n\n<pre><code>JavaScript Object Notation: application/json\nLine-based text data: application/json\nsong=name&amp;date=date&amp;user=\"test\"&amp;help=false&amp;partners=[]&amp;likes=0\n</code></pre>\n\n<p>How could that call, with the specified dataType and contentType could transform a JSON into line based text data, how can i send the JSON object instead</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13113889,"title":"How would one integrate Google Docs into your web appilcation for Node.js?","body":"<p>I have a web application that currently stores documents for users on my site in my Amazon S3 bucket. I am looking to enable users to open and edit their documents from my S3 bucket using Google Docs. How would I do that?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13113622,"title":"Pass additional arguments to node.js callack","body":"<p>I have created a rest client to make calls outside of my application. I want to send the data I receive back from the rest calls to the client's web browser.</p>\n\n<p>Something like the following, but what is the best way to structure the code to allow access to the response to write back to the web browser with as loose coupling as possible? I don't want to define the rest client within a request handler.</p>\n\n<pre><code>var servReq = http.request(options, function(restResponse){\n    var status = restResponse.statusCode\n    var headers = restResponse.headers\n    restResponse.setEncoding(\"utf8\");\n    d='';\n    restResponse.on('data', function(chunk){\n        d += chunk;\n    })\n    restResponse.on('end', function(restResponse){\n        // res would be a response to write back to the client's web browser\n        // with the data received from the rest client.\n        res.writeHead(200, {\"content-type\":\"text/plain\"})    \n        res.write(d)\n        res.end();\n    })\n}\n</code></pre>\n"},{"tags":["node.js","web-scraping","phantomjs","jsdom"],"answer_count":2,"favorite_count":7,"up_vote_count":4,"down_vote_count":0,"view_count":595,"score":4,"question_id":9961254,"title":"How to manage a 'pool' of PhantomJS instances","body":"<p>I'm planning a webservice for my own use internally that takes one argument, a URL, and returns html representing the <em>resolved</em> DOM from that URL. By resolved I mean that the webservice will firstly get the page at that URL, then use PhantomJS to 'render' the page, and then return the resulting source after all DHTML, AJAX calls etc are executed. However launching phantom on a per-request basis (which I'm doing now) is <em>way</em> too sluggish. I would rather have a pool of PhantomJS instances with one always available to serve the latest call to my webservice.</p>\n\n<p>Has any work been done on this kind of thing before? I'd rather base this webservice on the work of others than write a pool manager / http proxy server for myself from scratch.</p>\n\n<p><strong>More Context</strong>: I've listed the 2 similar projects that I've seen so far below and why I've avoided each one, resulting in this question about managing a pool of PhantomJS instances instead.</p>\n\n<p>jsdom - from what I've seen it has great functionality for executing scripts on a page, but it doesn't attempt to replicate browser behaviour, so if I were use it as a general purpose \"DOM resolver\" there'd end up being a lot of extra coding to handle all kinds of edges cases, event calling, etc. The first example I saw was having to manually call the onload() function of the body tag for a test app I set up using node. It seemed like the beginning of a deep rabbit hole.</p>\n\n<p>Selenium - It just has soo many more moving parts, so setting up a pool to manage long lived browser instances will just be more complicated than using PhantomJS. I don't need any of it's macro recording / scripting benefits. I just want a webservice that is as performant at getting a webpage and resolving it's DOM as if I were browsing to that URL with a browser (or even faster if I can make it ignore images etc.)</p>\n"},{"tags":["javascript","node.js","array-sorting","v8"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13103895,"title":"Injecting object instead of function for Javascript array sort","body":"<p>I'm trying to sort an array of objects in javascipt. Sort order itself depends on two factors: object's properties and a value of a single external variable. I know that I can use array.sort(sortFunction) to inject custom function, but I need to use a different function depending on the external variable (which is fixed during sorting). </p>\n\n<p>I reduced the sorting to minimal test case which shows the problem and trying to inject \"descending/ascending\" parameter, although the real prolem is much more complex. I know I can reverse() the result, but that's not an issue here.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>var ar = [ 10, 3, 5, 17 ];\nvar ns = new nsort();\nar.sort(ns.sort);\nconsole.log(ar);\n\nfunction nsort()\n{\n    this.desc = true;\n    this.sort = function(a,b) {\n        console.log(this.desc);\n        if (this.desc)\n            return b-a;\n        else\n            return a-b;\n    }\n}\n</code></pre>\n\n<p>and here's the output (using Node.js)</p>\n\n<pre><code>undefined\nundefined\nundefined\nundefined\n[ 3, 5, 10, 17 ]\n</code></pre>\n\n<p>It looks like array sorting code extracts the function outside of parent object while sorting.</p>\n\n<p>Any ideas why is this happening and what would be the proper way to do it?</p>\n\n<p><strong>Update:</strong> I did find a way to make it work:</p>\n\n<pre><code>var ar = [ 10, 3, 5, 17 ];\nvar ns = new nsort(true);\nar.sort(ns.sort);\nconsole.log(ar);\n\nfunction nsort(desc)\n{\n    this.sort = function(a,b) {\n        if (desc)\n            return b-a;\n        else\n            return a-b;\n    }\n}\n</code></pre>\n\n<p>Is this a good idea? Or is there something better?</p>\n"},{"tags":["http","node.js","http-headers","express"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":291,"score":1,"question_id":10717685,"title":"how to remove X-Powered-By in ExpressJS","body":"<p>I want to remove X-Powered-By for Security,Save Bandwidth in ExpressJS(node.js). how to do it?\nit could be filter(app.use) ?</p>\n\n<pre><code>app.use(function(req,res,next_cb){ /* remove X-Powered-By header */ next_cb(); }\n</code></pre>\n"},{"tags":["javascript","node.js","http-headers","express"],"answer_count":7,"favorite_count":8,"up_vote_count":23,"down_vote_count":0,"view_count":2054,"score":23,"question_id":5867199,"title":"Can't get rid of header X-Powered-By:Express","body":"<p>I am running a server on nodejs with express. I can't seem to get rid of the header:</p>\n\n<pre><code>X-Powered-By:Express\n</code></pre>\n\n<p>I was wondering if there is any way to get rid of this header or do I have to live with it?</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13111892,"title":"Reading the content-length and Content-Type","body":"<p>How can I read in the node the incoming content-length and content-Type.</p>\n\n<p>I saw the \n<a href=\"http://nodejs.org/docs/v0.6.6/api/all.html#request.connection\" rel=\"nofollow\">http://nodejs.org/docs/v0.6.6/api/all.html#request.connection</a></p>\n\n<p>Looks i am missing some thing.</p>\n\n<p>How can I read the Content-length and content -type and any other general headers? like X-*</p>\n"},{"tags":["node.js","mongodb","schema-design"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13111367,"title":"MongoDB query by foreign key","body":"<p>I have two collections: </p>\n\n<p>USERS: </p>\n\n<ul>\n<li>{  id:\"aaaaaa\" age:19 , sex:\"f\"  }</li>\n<li>{  id:\"bbbbbb\" age:30 , sex:\"m\"  }</li>\n</ul>\n\n<p>REVIEWS:</p>\n\n<ul>\n<li>{   id:777777  , user_id:\"aaaaaa\"   , text:\"some review data\"  } </li>\n<li>{   id:888888  , user_id:\"aaaaaa\"   , text:\"some review data\"  }</li>\n<li>{   id:999999  , user_id:\"bbbbbb\"   , text:\"some review data\"  }</li>\n</ul>\n\n<p>I would like to findAll REVIEWS Where <code>sex=f</code> and <code>age&gt;18</code></p>\n\n<p>( I dont want to nest because the reviews collection will be huge )</p>\n"},{"tags":["node.js","sequelize.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":13110979,"title":"No 'test' folder in the Git repository of Sequelize","body":"<p>I wanted to use <a href=\"http://www.sequelizejs.com/\" rel=\"nofollow\"><code>Sequelize</code></a> but the examples aren't working since they look for config in test folder and this last isn't present.</p>\n\n<p>Am I missing something?</p>\n"},{"tags":["node.js","express","mustache"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":157,"score":1,"question_id":12209607,"title":"Using layout view in Express with Consolidate and Mustache","body":"<p>I just started going through Node using Express and finally got Consolidate JS working properly to use Mustache as the templating view system per the instructions on the <a href=\"https://github.com/visionmedia/consolidate.js\" rel=\"nofollow\">Consolidate JS Github page</a>.</p>\n\n<p>Mustache is loading properly, but I'm now wondering how to include the layout file along in the rendering of the template. The default Jade system loads the content of the .render method inside of the layout.jade file. I'm just wondering how to do the same, but with Mustache. Any help is greatly appreciated!</p>\n\n<p>Code:</p>\n\n<p><strong>index.js</strong></p>\n\n<pre><code> exports.index = function(req, res){\n    res.render('index', { title: \"Work pl0x?\" });\n });\n</code></pre>\n\n<p><strong>index.mustache</strong>\n     <h1>Welcome to {{title}}</h1></p>\n\n<p>I just want the index.mustache content to come in the \"{{content}}\" portion of the code below (layout.mustache). How can I do this?</p>\n\n<pre><code> &lt;!DOCTYPE html&gt;\n &lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n &lt;head&gt;\n &lt;meta charset=\"UTF-8\" /&gt;\n &lt;title&gt;Project Name | {{title}}&lt;/title&gt;\n &lt;link href=\"/stylesheets/style.css\" rel=\"stylesheet\" /&gt;\n &lt;/head&gt;\n\n &lt;body&gt;\n\n     {{content}}\n\n &lt;/body&gt;\n &lt;/html&gt;\n</code></pre>\n"},{"tags":["node.js","sockets","real-time"],"answer_count":6,"favorite_count":1,"up_vote_count":13,"down_vote_count":0,"view_count":356,"score":13,"question_id":12978168,"title":"How are Node.js+Socket.io+MongoDB webapps truly real-time?","body":"<p>I have a good old-style LAMP webapp. A week ago I needed to add a push notification mechanism to it.<br>\nTherefore, what I did was to add node.js+socket.io on the server and poll the MySQL database every 10 seconds using node.js to check whether there were new items: if so, I would have sent them to the client(s) with socket.io.<br>\nI was pretty happy with the result, even if that is not a proper realtime notification (as there is a lag of up to 10 secs).</p>\n\n<p>Now, I am about to build a new webapp which will need push notifications, too. I am wondering whether to go with the same approach as the first one (that I believe is more stable and mature) or to go totally Node.js, without PHP and Apache. As for the database, I have already decided to go for MongoDB.</p>\n\n<p>Finally, my question is: if I go for Node.js+Socket.io+MongoDB will I get a <strong>truly</strong> real-time webapp? I mean, as soon as a new record is inserted into MongoDB, will there be some sort of event triggered that I can catch via node.js, do some checking on it and, if relevant, send the notification to the client? Or will there be anyway some sort of polling on the db server-side and lag, as with my first LAMP webapp?</p>\n\n<p>A related question: can you build a realtime webapp on MySQL without doing any polling as I did with my first app. Or do you need MongoDB (or Redis)?</p>\n\n<p>I hope this question is not too silly - sorry, I am just starting with Node.js and co.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","mongodb","node-mongodb-native"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13106243,"title":"How should I keep an index of user info?","body":"<p>Say I need every users <code>name</code> often. Instead of querying for every document and then plucking this attribute what is the best way to keep an index I can quickly call?</p>\n\n<p>Should I add another document that is just an array of these attributes and then manually edit  it every time I add or remove a user? Is there a better way using mongo indexing or something?</p>\n\n<p>Thanks for any guidance. </p>\n"},{"tags":["node.js","sass","compass-css","gruntjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13110125,"title":"Compiling indivual .scss files with compass command line","body":"<p>Is there a way through the compass command line utility to compile indivually files?</p>\n\n<p>The reason I am asking is that I currently have a grunt tasks that runs the compass compile command for the directory however this is probably going to be a problem when the project get bigger and it try to compile dozen of files when one one file changes so I am trying to see if there is a way to do something like compass compile app/css/style.scss:app/css/style.css.</p>\n"},{"tags":["javascript","node.js","require"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13108936,"title":"Nodejs require returns same old file when requiring a second time after the file changed","body":"<p>So inside my nodejs server file I have the line:</p>\n\n<pre><code>tools=require(\"./tools.js\");\n</code></pre>\n\n<p>The tools file contains functions and thelike that I change alot, so I figured instead of restarting the server everytime I change something, I could simply add some way for me to re-require the tools.js, and so I did. However now the problem is, when I start the program, change the tools.js and make it re-require it, it requires it again as if it was still in the state it was when it was first required. What?</p>\n\n<p>Edit: I don't want to restart the app upon a file change, since that would be the same as restarting the server, which is what I want to prevent! So I need something that let's me re-require it, ignoring module caching or whatever.</p>\n\n<p>Any ideas what could help me here?</p>\n"},{"tags":["node.js","heroku","amazon-s3","knox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13097439,"title":"How to do pass-thru uploads to s3 on Heroku with node.js?","body":"<p>Here's my current code.  I'm using express and knox, and I don't think I'm doing anything unusual, but <code>s3.putFile</code> is responding 400 status code but null error, and the file does not get uploaded.</p>\n\n<pre><code>var express = require('express');\nvar knox = require('knox');\n\nvar app = express();\napp.use(express.bodyParser());\n\nvar s3 = knox.createClient({\n    key: process.env.AWS_ACCESS_KEY_ID,\n    secret: process.env.AWS_SECRET_ACCESS_KEY,\n    bucket: process.env.S3_BUCKET_NAME\n});\n\napp.post('/upload', function(req, res, next) {\n    var photo = req.files.photo;\n    var s3Headers = {\n      'Content-Type': photo.type,\n      'x-amz-acl': 'public-read'\n    };\n\n    s3.putFile(photo.path, photo.name, s3Headers, function(err, s3response){\n      //handle, respond\n    });\n});\n</code></pre>\n\n<p>This same code works fine even from the <a href=\"https://c9.io\" rel=\"nofollow\">cloud9</a> online editor/debugger, just not from Heroku.  I'm guessing it has something to do with the \"<a href=\"https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem\" rel=\"nofollow\">ephemeral file system</a>\", but that's just a guess.  However I was able to get s3 pass-thru uploads to work on Heroku in Clojure using <a href=\"http://webnoir.org/\" rel=\"nofollow\">noir</a> and <a href=\"https://github.com/weavejester/clj-aws-s3\" rel=\"nofollow\">weavejester's aws sdk</a>, so it must be possible in node as well.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13107976,"title":"Why does mongoose use schema when mongodb's benefit is supposed to be that it's schema-less?","body":"<p>I am a super newbie to mongodb. I am using mongoose to access mongodb from node.js, and know how to get things to work, but I don't think I understand why it works the way it does.</p>\n\n<p>Most importantly, I don't understand why mongoose has 'schema' when one of the standout features of mongodb is that it doesn't have schema. Could someone enlighten me? thank you.</p>\n"},{"tags":["node.js","facebook-graph-api"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":13108995,"title":"How to get facebook friends from facebook API with node.js","body":"<p>I'm working on a project with facebook connect in node.js.\nEverything is working great but now I want to get a list of friends from facebook for the connected user, I have the access token from the user\nbut i don't know how to start getting the data from facebook</p>\n\n<p>Any help?</p>\n"},{"tags":["node.js","webstorm"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13108900,"title":"Autocomplete not working with Node.js in webstorm","body":"<p>Just downloaded WebStorm and giving Node.js a try.</p>\n\n<p>Unfortunately the autocomplete does not seem to work.</p>\n\n<p>I have set the node js interpreter to node.exe but saw a post saying that I should set it to the Node.js file. When I used Node.exe, at least the version was populated in the Node.js configuration dialog, however when I download the code and select the Node.js file I get \"Version not found\".</p>\n\n<p>Either way, autocomplete does not work.</p>\n"},{"tags":["node.js","socket.io","nodejitsu"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13108602,"title":"Serving static file error (node.js)","body":"<p>I'm new to node.js and trying to serve my own css and js, i've tried the below code, but it didn't work.</p>\n\n<p><strong>Error Message, within the browser</strong></p>\n\n<pre><code>An error has occurred: {\"code\":\"ECONNRESET\"}\n</code></pre>\n\n<p><strong>server.js</strong></p>\n\n<pre><code>var fs = require('fs')\n\n, http = require('http')\n\n, path = require('path')\n\n, socketio = require('socket.io');\n\n\nvar server = http.createServer(function(req, res) {\n\n\nconsole.log('request starting...');\n\nvar filePath = '.' + req.url;\nif (filePath == './') filePath = './index.htm';\n\nvar extname = path.extname(filePath);\nvar contentType = 'text/html';\n\nswitch (extname) {\n    case '.js':\n       contentType = 'text/javascript';\n    break;\n    case '.css':\n       contentType = 'text/css';\n    break;\n}\n\npath.exists(filePath, function(exists) {\n\n    if (exists) {\n        fs.readFile(filePath, function(error, content) {\n            if (error) {\n               response.writeHead(500);\n            response.end();\n        }\n        else {\n            response.writeHead(200, { 'Content-Type': contentType      });\n             response.end(content, 'utf-8');\n        }\n    });\n}\n    else {\n        response.writeHead(404);\n        response.end();\n    }\n});\n\n// these lines work\n//res.writeHead(200, { 'Content-type': 'text/html'});\n//res.end(fs.readFileSync(__dirname + '/index.html'));\n}).listen(80, function() {\nconsole.log('Listening');\n});\n\n// the rest is socket.io stuff\n</code></pre>\n\n<p><strong>Configuration</strong></p>\n\n<p>Browser → Chrome 22.0.1229.94</p>\n\n<p>Server → Nodejitsu</p>\n\n<p>OS → OS X, 10.8.2</p>\n"},{"tags":["javascript","node.js","sinon"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13102693,"title":"Mocking Postgres for unit tests with Sinon.js in Node.js","body":"<p>I am having trouble getting my head round how i can use sinon to mock a call to postgres which is required by the module i am testing, or if it is even possible.</p>\n\n<p>I am not trying to test the postgres module itself, just my object to ensure it is working as expected, and that it is calling what it should be calling in this instance.</p>\n\n<p>I guess the issue is the require setup of node, in that my module requires the postgres module to hit the database, but in here I don't want to run an integration test I just want to make sure my code is working in isolation, and not really care what the database is doing, i will leave that to my integration tests.</p>\n\n<p>I have seen some people setting up their functions to have an optional parameter to send the mock/stub/fake to the function, test for its existence and if it is there use it over the required module, but that seems like a smell to me (i am new at node so maybe this isn't).</p>\n\n<p>I would prefer to mock this out, rather then try and hijack the require if that is possible.</p>\n\n<p><strong>some code</strong> (please note this is not the real code as i am running with TDD and the \nfunction doesn't do anything really, the function names are real)</p>\n\n<p><strong>TEST SETUP</strong></p>\n\n<pre><code>describe('#execute', function () {\nit('should return data rows when executing a select', function(){\n //Not sure what to do here\n});\n});\n</code></pre>\n\n<p><strong>SAMPLE FUNCTION</strong></p>\n\n<pre><code>PostgresqlProvider.prototype.execute = function (query, cb) {\nvar self = this;\n\nif (self.connection === \"\")\n    cb(new Error('Connection can not be empty, set Connection using Init function'));\n\nif (query === null)\n    cb(new Error('Invalid Query Object - Query Object is Null'))\n\nif (!query.buildCommand)\n    cb(new Error(\"Invalid Query Object\"));\n\n//Valid connection and query\n};\n</code></pre>\n\n<p>It might look a bit funny to wrap around the postgres module like this but there are some design as this app will have several \"providers\" and i want to expose the same API for them all so i can use them interchangeably.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I decided that my test was too complicated, as i was looking to see if the connect call had been made AND then returning data, which smelt to me, so i stripped it back and put it into two tests:</p>\n\n<p><strong>The Mock Test</strong></p>\n\n<pre><code>it('should call pg.connect when a valid Query object is parsed', function(){\n        var mockPg = sinon.mock(pg);\n        mockPg.expects('connect').once;            \n\n        Provider.init('ConnectionString');\n        Provider.execute(stubQueryWithBuildFunc, null, mockPg);\n\n        mockPg.verify();\n    });\n</code></pre>\n\n<p>This works (i think) as without the postgres connector code it fails, with it passes (Boom :))</p>\n\n<p>Issue now is with the second method, which i am going to use a stub (maybe a spy) which is passing 100% when it should fail, so i will pick that up in the morning.</p>\n\n<p><strong>Update 2</strong></p>\n\n<p>I am not 100% happy with the test, mainly because I am not hijacking the client.query method which is the one that hits the database, but simply my execute method and forcing it down a path, but it allows me to see the result and assert against it to test behaviour, but would be open to any suggested improvements.</p>\n\n<p>I am using a spy to catch the method and return null and a faux object with contains rows, like the method would pass back, this test will change as I add more Query behaviour but it gets me over my hurdle.</p>\n\n<pre><code>    it('should return data rows when a valid Query object is parsed', function(){\n\n        var fauxRows = [\n            {'id': 1000, 'name':'Some Company A'},\n            {'id': 1001, 'name':'Some Company B'}\n        ];\n\n       var stubPg = sinon.stub(Provider, 'execute').callsArgWith(1, null, fauxRows);\n\n       Provider.init('ConnectionString');\n       Provider.execute(stubQueryWithBuildFunc, function(err, rows){\n           rows.should.have.length(2);\n       }, stubPg);\n\n       stubPg.called.should.equal.true;\n       stubPg.restore();\n    });\n</code></pre>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13030760,"title":"Integrate nodejs into existing site","body":"<p>I am kind of new to nodejs. I learnt programming by myself so my programming routines are kind of messy. But here's something that's been bothering me for a while. I already have a site running on jquery, php and mysql. It has multiple features which it uses ajax for. These features (modules) include profile modules (facebook type wall), messaging modules, etc.</p>\n\n<p>Now I want to make server push updates to the client, like if a new message arrives or if someone posts on the wall. I don't want to create everything on nodejs again. I just need to tell client (dom) that new updates have arrived so ajax jquery functions that fetch data can now be triggered.</p>\n\n<p>So my question is, is this possible? If so how?</p>\n\n<p>EDIT: I found similar discussion here: <a href=\"http://stackoverflow.com/questions/10973071/node-now-js-model-view-control-pattern\">Node + now.js + Model-View-Control-Pattern</a></p>\n"},{"tags":["javascript","node.js","websocket","specifications"],"answer_count":2,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":191,"score":8,"question_id":13010354,"title":"Chunking WebSocket Transmission","body":"<p>since I'm using WebSocket connections on more regular bases, I was interested in how things work under the hood. So I digged into the endless spec documents for a while, but so far I couldn't really find anything about <em>chunking the transmission stream itself</em>.</p>\n\n<p>The WebSocket protocol calls it <em>data frames</em> (which describes the pure data stream, so its also called <em>non-control frames</em>). As far as I understood the spec, there is no defined max-length and no defined MTU (maximum transfer unit) value, that in turn means a single WebSocket data-frame may contain, by spec(!), an infinite amount of data (please correct me if I'm wrong here, I'm still a student on this).</p>\n\n<p>After reading that, I instantly setup my little <em>Node</em> WebSocket server. Since I have a strong <em>Ajax</em> history (also on streaming and Comet), my expectations originaly were like, \"<em>there must be some kind of interactive mode for reading data while it is transfered</em>\". But I am wrong there, ain't I ?</p>\n\n<p>I started out small, with <em>4kb</em> of data. </p>\n\n<p><strong>server</strong></p>\n\n<pre><code>testSocket.emit( 'data', new Array( 4096 ).join( 'X' ) );\n</code></pre>\n\n<p>and like expected this arrives on the client as one data-chunk</p>\n\n<p><strong>client</strong></p>\n\n<pre><code>wsInstance.onmessage = function( data ) {\n    console.log( data.length ); // 4095\n};\n</code></pre>\n\n<p>so I increased the payload and I actually was expecting again, that at some point, the client-side <code>onmessage</code> handler will fire repeatly, effectivley chunking the transmission. But to my shock, it never happened (<em>node-server</em>, tested on <em>firefox</em>, <em>chrome</em> and <em>safari</em> client-side). My biggest payload was <strong>80 MB</strong></p>\n\n<pre><code>testSocket.emit( 'data', new Array( 1024*1024*80 ).join( 'X' ) );\n</code></pre>\n\n<p>and it still arrived in one big data-chunk on the client. Of course, this takes a while even if you have a pretty good connection. Questions here are</p>\n\n<ul>\n<li><em>is there any possiblity to chunk those streams, similar to the XHR readyState3 mode</em> ?  </li>\n<li><em>is there any size limit for a single ws data-frame</em> ?  </li>\n<li><em>are websockets not supposed to transfer such large payloads? (which would make me wonder again why there isn't a defined max-size)</em></li>\n</ul>\n\n<p>I might still look from the wrong perspective on WebSockets, probably the need for sending large data-amounts is just not there and you should chunk/split any data logically yourself before sending ?</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":13105569,"title":"How do you run a javascript file using node.js and bash script?","body":"<p>I'm new to programming in javascript. I am given a task to write a .js file that will run some input.json. I'm supposed to run it as such: </p>\n\n<pre><code>./name.js input.json\n</code></pre>\n\n<p>How can I incorporate node.js in this process and how do I get terminal to accept that script? </p>\n\n<p>Thanks!</p>\n\n<p>Edit:\nI solved my problem! I can't answer my own problem yet because of rules, anyway...</p>\n\n<pre><code>#!/usr/bin/env node\nvar fs = require('fs');\n\nargs = []\nprocess.argv.forEach(function (val, index, array) \n{\n    args.push(val); \n});\n\nvar file = fs.readFileSync(args[2], \"UTF-8\", function (err, data) \n{\nif (err) throw err;\n});\n</code></pre>\n\n<p>This is essentially what I did. I spent some time searching and combining things I found from different posts and got this to work - maybe it's not the best way, but it works. This stores my .json file into the file variable, which then I passed in as a function argument elsewhere. Thanks everyone.</p>\n"},{"tags":["node.js","redirect","express"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":150,"score":2,"question_id":12442716,"title":"NodeJS + Express: res.redirect('back'); with params","body":"<p>I have a register form on every page of my website.  During registration some error may occur.  After catching the error, I have to return the user to the previous page, showing some error message.  The problem is that I do not know from which page the user performed the registration, so I use <code>res.redirect('back');</code>.  However, I cannot just redirect user back, I have to display the error message also, so I have to pass some argument.   But <code>res.redirect('back', (reg_error:'username')})</code> cannot be used directly because <code>res.redirect()</code> does not support parameters.  How can I render the previous page with some parameter?</p>\n"},{"tags":["linux","node.js","logging","forever"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13106471,"title":"How can I get the Forever to write to a different log file every day?","body":"<p>I have a cluster of production servers running a Node.JS app via Forever.  As far as I can tell, my options for log files are as follows:</p>\n\n<ol>\n<li>Let Forever do it on its own, in which case it will log to ~/.forever/XXXX.log</li>\n<li>Specify one specific log file for the entire life of the process</li>\n</ol>\n\n<p>What I'd like to do, however, is have it log to a different file every day.  eg. 20121027.log, 20121028.log, etc.</p>\n\n<p>Is this possible?  If so, how can it be done?</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13106300,"title":"Node.js Express: Execute hook on every HTTP request, before app.get() and app.post()?","body":"<p>I don't want to put an authentication function at the top of every <code>app.get()</code>, how can I execute code on every request, before <code>app.get()</code>?</p>\n"},{"tags":["node.js","express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13106096,"title":"Stream files in node/express to client","body":"<p>I want to stream content to clients which is possibly stored in db, which they would save as files.</p>\n\n<p>Obviously res.download would do the job nicely, but none of the response.* functions accept a stream, only file paths.</p>\n\n<p>I had a look at res.download impl and it just sets Content-Disposition header and then a sendfile.</p>\n\n<p>So I could achieve this using this post as a guide.\n<a href=\"http://stackoverflow.com/questions/8257544/node-js-pipe-stream-to-response-freezes-over-https\">Node.js: pipe stream to response freezes over HTTPS</a></p>\n\n<p>But it seems I would miss out on all the wrapping aspects that res.send performs.</p>\n\n<p>Am I missing something here or should I just do the pipe and not worry about it - what is best practice here?</p>\n\n<p>Currently creating temp files so I can just use res.download for now.</p>\n"},{"tags":["javascript","node.js","soap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13106039,"title":"Arrays in node-soap","body":"<p>I'm attemping to leverage <a href=\"https://github.com/milewise/node-soap\" rel=\"nofollow\">node-soap</a> to make a SOAP request containing an array. Requests without arrays seem to work fine however when attempting to pass an array I'm receiving the error 'not an ARRAY reference' from the server.</p>\n\n<p>Any idea? My script is as follows:</p>\n\n<pre><code>var soap = require('soap');\n\nvar url = 'http://example.com/example.wsdl';\n\nvar args = {\n    email: 'example',\n    password: 'xxxxx',\n    series: {\n        element: ['a', 'b', 'c', 'd']\n    }\n};\n\nsoap.createClient(url, function(err, client) {\n    if(err) throw err;\n\n    client.ExampleMethod(args, function(err, result) {\n        if(err) throw err;\n        console.log(result);\n    });\n});\n</code></pre>\n"},{"tags":["node.js","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13103775,"title":"expressjs req.body.username is undefined","body":"<p>I've seen several posts related to this but none seem to be the problem here.</p>\n\n<p>It's a very simple beginner nodejs app with expressjs on windows7</p>\n\n<pre><code>/**\n * Module dependencies.\n */\n\n\nvar express = require('express')\n    , connect = require('connect')\n    , http = require('http')\n\n\nvar app = express();\n\napp.configure(function(){\n  app.set('port', process.env.PORT || 3000);\n  // app.use(express.bodyParser());\n  app.use(connect.bodyParser());\n});\n\n/**\n * Routes\n */\n//get requests\n// app.get(\"/\", function(req, res){\n//   res.send(\"Hello, Express!\");\n// });\n\n// app.get(\"/hi\", function(req, res){\n//   var message = [\n//     \"&lt;h1&gt;Hello, Express!&lt;/h1&gt;\",\n//     \"&lt;p&gt;Welcome to 'Building Web Apps in Node.js with Express.'&lt;/p&gt;\",\n//     \"&lt;p&gt;You'll love Express because it's&lt;/p&gt;\",\n//     \"&lt;ul&gt;&lt;li&gt;Fast&lt;/li&gt;\",\n//     \"&lt;li&gt;Fun&lt;/li&gt;\",\n//     \"&lt;li&gt;Flexible&lt;/li&gt;\"\n//   ].join(\"\\n\");\n\n//   res.send(message);\n// });\n\n// app.get(\"/users/:userID\", function(req, res){\n//   res.send(\"&lt;h1&gt;Hello, User #\" + req.params.userID + \"!\");\n// });\n\n//post requests\napp.post(\"/users\", function(req, res){\n    // res.send(req.body);\n    res.send(req.body.username);\n});\n\n\nhttp.createServer(app).listen(app.get('port'), function(){\n  console.log(\"Express server listening on port \" + app.get('port'));\n});\n</code></pre>\n\n<p>As you can see I've commented out other routes just to ensure they aren't causing the problem and I've also tried installing and using 'connect' but both express.bodyParser() and connect.bodyParser() give me the same results.</p>\n\n<p>I've used chrome adv rest client extension and also tried the following simple php form.</p>\n\n<pre><code>&lt;form action=\"http://localhost:3000/users\" method=\"POST\" enctype=\"application/x-www-form-urlencoded\"&gt;\n    &lt;li&gt;\n        &lt;label for=\"username\"&gt;Username&lt;/label&gt;\n        &lt;input type=\"text\" name=\"username\" id=\"username\"&gt;\n    &lt;/li&gt;\n    &lt;li&gt;\n        &lt;input type=\"submit\" name=\"submit\" id=\"submit\"&gt;\n    &lt;/li&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>In all cases I get a empty or undefined req.body.username and when I try just req.body in the response I get a empty object {}</p>\n\n<p><strong>UPDATE:</strong> \nHere is the response/request header info from chrome:</p>\n\n<pre><code>Request URL:http://localhost:3000/users\nRequest Method:POST\nStatus Code:200 OK\nRequest Headersview source\nCache-Control:max-age=0\nConnection:keep-alive\nContent-Length:31\nHost:localhost:3000\nRequest Payload\nusername=isimmons&amp;submit=Submit\nResponse Headersview source\nConnection:keep-alive\nDate:Sat, 27 Oct 2012 23:01:45 GMT\nTransfer-Encoding:chunked\nX-Powered-By:Express\n</code></pre>\n\n<p>And Here is what I get when I send req.route</p>\n\n<pre><code>//result of console.log(req.route);\n{ path: '/users',\n  method: 'post',\n  callbacks: [ [Function] ],\n  keys: [],\n  regexp: /^\\/users\\/?$/i,\n  params: [] }\n</code></pre>\n\n<p>Node and Express versions:\nexpress 3.0\nnode 0.8.9</p>\n\n<p><strong>UPDATE2 PROBLEM SEMI SOLVED</strong>\nSee comments below. I should have just said it here. Anyway, here is the request header info from chrome when it works correctly.</p>\n\n<pre><code>Request URL:http://localhost:3000/users\nRequest Method:POST\nStatus Code:200 OK\nRequest Headersview source\nAccept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.3\nAccept-Encoding:gzip,deflate,sdch\nAccept-Language:en-US,en;q=0.8\nCache-Control:max-age=0\nConnection:keep-alive\nContent-Length:26\nContent-Type:application/x-www-form-urlencoded\nHost:localhost:3000\nOrigin:http://localhost\nReferer:http://localhost/nodeform.php\nUser-Agent:Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.16 (KHTML, like Gecko) Chrome/24.0.1305.3 Safari/537.16\nForm Dataview sourceview URL encoded\nusername:dfd\nsubmit:Submit\nResponse Headersview source\nConnection:keep-alive\nContent-Length:3\nContent-Type:text/html; charset=utf-8\nDate:Sun, 28 Oct 2012 01:12:23 GMT\nX-Powered-By:Express\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["node.js","asynchronous","bcrypt"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":11605943,"title":"Async or Sync bcrypt function to use in node.js in order to generate hashes?","body":"<p>I'm currently trying to make authentication module for my project in node.js?</p>\n\n<p>I've already seen some examples of using bcrypt to generate hashes, i.e.</p>\n\n<p><a href=\"https://github.com/bnoguchi/mongoose-auth/blob/master/lib/modules/password/plugin.js\" rel=\"nofollow\">https://github.com/bnoguchi/mongoose-auth/blob/master/lib/modules/password/plugin.js</a>\nhttps://github.com/Turbo87/locomotive-passport-boilerplate/blob/master/app/models/account.js</p>\n\n<p>However, for some reason they are using bcrypt.hashSync() function. Since bcrypt is good because it's time-consuming, wouldn't it be wiser to use asynchronous function instead in order to not block the code, i.e:</p>\n\n<pre><code>User.virtual('password')\n.get( function () {\n    return this.hash;\n})\n.set( function (password) {\n    bcrypt.hash('password', 10, function(err, hash) {\n        this.hash = hash;\n    });\n});\n</code></pre>\n\n<p>Could you please explain me which way is better and why? Thank you!</p>\n"},{"tags":["email","templates","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":288,"score":3,"question_id":7351030,"title":"Hijacking expressjs view engine outside http res context","body":"<p>I am building a small app primarily with socket io, however with a few things from expressjs.</p>\n\n<p>One function of the socket io piece is to send an email when a certain event occurs. I've got this working fine with node_mailer.</p>\n\n<p>The problem I'm running into is that I want to use the express view engine to render the emails from template files. The render method seems to be explicitly attached to the res object prototype.</p>\n\n<p>What I've done feels pretty dirty:</p>\n\n<pre><code>// setup express server\nvar render;\napp.get('/', function (req, res) {\n    if (typeof render == 'undefined') render = res.render;\n    res.end('Welcome to app');\n});\n\n// socket io code\nsocket.on('event', function (data) {\n    var email_content;\n    render('template', {}, function (err, result) { email_content = result; });\n});\n</code></pre>\n\n<p>Is there a better way to gain access to expressjs's components outside the context of an http request, or even a better way to approach this problem? I tried rigging up a call to the exported express.view.compile function but that both didn't work and seemed like a high hoo</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13105377,"title":"alternative to mongoose that validates in-place updates","body":"<p>The main benefit of Mongoose for our team is validations. However validations do not take place when we push() a sub-doc to an array or when we make an in-place updates just to some field. Our documents are big and Mongoose requires us to download them and do save() to utilize validations. This seems counterproductive for the whole purpose of in-place updates. Is there a different driver that support validations for in-place updates?</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":13104690,"title":"nodejs mongodb object id to string","body":"<p>IN nodejs, with mongodb, mongoosejs as orm</p>\n\n<p>I am doing this</p>\n\n<p>I have a model, User</p>\n\n<pre><code>User.findOne({username:'someusername'}).exec(function(err,user){\nconsole.log(user) //this gives full object with something like {_id:234234dfdfg,username:'someusername'}\n//but\n\nconsole.log(user._id) //give undefined.\n})\n</code></pre>\n\n<p>Why? And how to get the _id to string then?</p>\n"},{"tags":["node.js","deployment","script","directory","package"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13105051,"title":"deploying a directory structure to new path","body":"<p>I am using <a href=\"http://twitter.github.com/bower/\" rel=\"nofollow\">bower</a> packaging system to fetch files to local project however breaking conventions these files are useless on their own. They need to be injected in the proper location in the MVC framework I'm using so whatever bower fetches I need to essentially do a post action and copy the directory structure / files from <code>components/myexample/</code> to <code>application/</code></p>\n\n<p><strong>remote bower package:</strong></p>\n\n<pre><code>controllers\n   mycontroller.php\nmodels\n   mymodel.php\nview\n  layout\n     myview.php\ncomposer.json\n</code></pre>\n\n<p><strong>local project:</strong></p>\n\n<pre><code>composer.json\ncomponents\n  myexample\n      controllers\n        mycontroller.php\n      models\n       mymodel.php\n      view\n       layout\n         myview.php\n\napplication\n   controllers\n   models\n   view\n</code></pre>\n\n<p>I was thinking of upon retrieving the directory structure and files to zip it all and then do an extract to the right directory. I need the solution to be cross platform compatible. How would you do it and better yet how else would you implement this?</p>\n"},{"tags":["ios","node.js","push-notification","apple-push-notifications","apns"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13104335,"title":"How to debug if the message went through Apple Push Notification Service?","body":"<p>I am experimenting with Apple Push Notification Service with node.js as server. So far I've got it to work and when it works, it works as intended.</p>\n\n<p>However, sometimes the message doesn't arrive. I am not sure if this is natural (maybe I have bad connection and the message is not coming through because of that), or if it's a bug in my code. The situation is really random. Sometimes it comes through and sometimes it doesn't, even though I didn't change the code or anything.</p>\n\n<p>I am using node-apn (https://github.com/argon/node-apn), and according to the debug console, it's being registered as successfully going through--at least from the server side. Here's the debug message:</p>\n\n<pre><code>apn Initialising connection +19s\napn Initialising module +1ms\napn Connection established +383ms\napn Sending notification +0ms\napn Socket drained +1ms\napn Socket writeable +0ms\n</code></pre>\n\n<p>This message appears both when the message goes through and when it doesn't go through. So I guess node-apn itself is doing its job all right. Which means it's either:</p>\n\n<ol>\n<li>There's something happening between my server and apple push server</li>\n<li>There's something happening between apple push server and my iOS device</li>\n</ol>\n\n<p>But I don't know how to find out what's happening. So what I am trying to find is a solution to:</p>\n\n<ol>\n<li>Find out if my push notification is being registered by APNS</li>\n<li>Find out if APNS is sending out all the notifications to my iDevice</li>\n</ol>\n\n<p>Anyone know how to do this? Thank you so much!</p>\n"},{"tags":["javascript","node.js","documentation","jsdoc","promise"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13104411,"title":"How to specify resolution and rejection type of the promise in JSDoc?","body":"<p>I have some code that returns a promise object, e.g. using <a href=\"https://github.com/kriskowal/q\" rel=\"nofollow\">Q</a> library for NodeJS.</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var Q = require('q');\n\n/**\n * @returns ???\n */\nfunction task(err) {\n    return err? Q.reject(new Error('Some error')) : Q.resolve('Some result');\n}\n</code></pre>\n\n<p>How to document such a return value using JSDoc?</p>\n"},{"tags":["javascript","node.js","redis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13078833,"title":"building multi dimensional array","body":"<p>I am trying to build a multi dimensional array with node.js using redis as the data source. I am however not doing it right.</p>\n\n<p>the menuKey contains key containing a sorted set in redis, the sorted set contains values referencing other keys. e.g:</p>\n\n<pre><code>menu:main:sections contains [\"menu:main:section1\",\"menu:main:section2\"]\nmenu:main:section1 contains [\"option1\", \"option2\"]\nmenu:main:section2 contains [\"option1\"]\n</code></pre>\n\n<p>the array I am trying to build:</p>\n\n<pre><code>[[\"option1\", \"option2\"], [\"option1\"]]\n</code></pre>\n\n<p>This is the code I have but I am placing a callback wrong somehow? </p>\n\n<pre><code>function handleMenu(jsonrpc) {\n  var params = jsonrpc['params'];\n  var result = [];\n  var sections = [];\n\n  menuKey = 'menu:' + params['menu'] + ':sections';\n  async.series([\n      function (callback) {\n        redis.zrevrange(menuKey, 0, -1, function(err, sections) {\n          async.forEachSeries(sections, function(section, sectionCallback) {\n            redis.zrevrange(section, 0, -1, function(err, items) {\n              result.push(items); \n              sectionCallback();\n            });\n          }, callback);\n        });\n      }\n  ], function() {\n    console.log(result);\n  });\n}\n</code></pre>\n\n<p>I don't see what I am doing wrong, please advice.</p>\n"},{"tags":["javascript","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13103723,"title":"Node.js: Extracting the image urls of a webpage","body":"<p>I'm trying to get the images of a given webpage. I've tried using the modules <code>request</code> and <code>jsdom</code> as follows:</p>\n\n<pre><code>var request = require('request'),\n    jsdom = require('jsdom');\n\nrequest({ uri:'http://www.google.com' }, function (error, response, body) {\n  if (error &amp;&amp; response.statusCode !== 200) {\n    console.log('Error when contacting google.com')\n  }\n\n  jsdom.env({\n    html: body,\n    scripts: [\n      'http://code.jquery.com/jquery-1.8.2.min.js'\n    ]\n  }, function (err, window) {\n    var $ = window.jQuery;\n\n    $(function () {\n      console.log($('img').length);\n    })\n  });\n});\n</code></pre>\n\n<p>Unfortunately, <code>console.log($('img').length);</code> prints <code>0</code> despite the page <code>google.com</code> containing images...</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["node.js","module"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13092657,"title":"Node.js and unpublished global modules","body":"<p><code>npm install -g xyz</code> installs the module xyz gets to what I would call a 'global modules directory' i.e. <code>C:\\Users\\me\\AppData\\Roaming\\npm\\node_modules</code> in Windows 7.</p>\n\n<p>However, there seems to be no way to make all my node projects use these modules.</p>\n\n<p>If I have a project in <code>C:\\temp\\test.js</code> then <code>require('xyz')</code> cannot find the module. </p>\n\n<ol>\n<li>Setting environment variable <code>NODE_PATH</code> to the above global modules directory doesn't help</li>\n<li>AFAIK <code>npm link</code> only works with published modules not my own unpublished ones</li>\n</ol>\n\n<p>Short of putting all my projects in a sub-folder of the global modules directory (so that node traverses up and finds node_modules/) is there any way of re-using those global modules?</p>\n\n<p>If so, what is the point of -g and 'global' modules?</p>\n"},{"tags":["node.js","nservicebus","cqrs","message-bus"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13098463,"title":"Passing messages from Node.js to external systems?","body":"<p>I'm completely new to Node.JS, if I want to pass messages to external systems using a message/event/servicebus.. what alternatives are there that integrates well with Node?</p>\n\n<p>The messages are just JSON strings, and external systems can be whatever, e.g. a C# agent or some such.</p>\n\n<p>(Maybe this should be on some other part of the site cluser than stackoverflow since it's more of a tech question than programming)?</p>\n"},{"tags":["node.js","amazon-s3","amazon-ec2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13100746,"title":"Extract .zip and then store contents in S3 with Node.js","body":"<p>Most questions regarding NodeJS, S3 and Zips are the opposite of what I would like to do. Upload a zip, and extract the files onto S3. </p>\n\n<p>I have a quick app running on an Amazon EC2 instance, with Node.JS that accepts a file upload via a POST request. The aim is to upload a zip file full of images, extract them, and place each individual image on Amazon S3. </p>\n\n<p>I am using express.js to accept the posted file, and I have been playing with AdmZip to read the uploaded zip file. With AdmZip, I can extract the zip file to the servers disk, then loop over each extracted image in a temporary directory and then send that to Amazon S3, but this seems very inefficient. \nI've read quite a bit about streaming files from S3 to Node and zipping it on the fly. I guess what I want to know is if this is possible in reverse.</p>\n"},{"tags":["node.js","nginx","static-files","proxypass"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13102571,"title":"Nginx proxy_pass to Node server if no html files are found","body":"<p>I've set up an Nginx server which does a proxy_pass to a Node server if no html files are found. I can access my static html file just fine but when I hit the Node server I get a 403: Forbidden. Here is my Nginx conf if that helps: </p>\n\n<pre><code>proxy_cache_path  /var/cache/nginx levels=1:2 keys_zone=one:8m max_size=3000m inactive=600m;                                            \n\nupstream mysite_upstream { \n    server 127.0.0.1:8000; \n    keepalive 64; \n}       \n\nserver { \n\n    listen       80; \n    server_name  staging.mysite.org;                                                                                          \n    root /var/www/staging.mysite.org/public;                                                                                  \n\n    access_log /var/logs/staging.mysite.org.access.log; \n    error_log /var/logs/staging.mysite.org.error.log;                                                                         \n\n    error_page 404         /404.html; \n    error_page 500 503     /500.html;                                                                                               \n\n    location ~ ^/(images/|javascript/|js/|css/|style/|flash/|robots.txt|sitemap.xml|humans.txt|favicon.ico) { \n            access_log off; \n            expires max;                                                                                                            \n    } \n\n    location @node { \n            proxy_redirect                  off; \n            proxy_set_header                X-Real-IP $remote_addr; \n            proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for; \n            proxy_set_header                X-Forwarded-Proto $scheme;                                                              \n            proxy_set_header                Host $http_host; \n            proxy_set_header                X-NginX-Proxy true; \n            proxy_set_header                Connection \"\";   \n            proxy_http_version              1.1;                                                                                    \n            proxy_cache                     one; \n            proxy_cache_key                 sfs$request_uri$scheme;                                                                 \n            proxy_pass                      http://mysite_upstream;                                                           \n    } \n\n    location / { \n            try_files $uri $uri/ $uri.html @node; \n    } \n}  \n</code></pre>\n\n<p>I should mention that if I take out <code>try_files</code> and just <code>proxy_pass</code> directly from <code>/</code> the Node app is served up but I get a 404 for all my static html files. Also, this is working fine on my local machine (osx).  </p>\n"},{"tags":["javascript","node.js","heroku","express","doc"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":98,"score":3,"question_id":12902792,"title":"Parse Microsoft Office files in Node.JS","body":"<p>I'm working on a web application where users can upload Microsoft Office Document files. Right now, our server is running Node.JS with Express.js and we're hosted on Heroku. Because of this, I don't think that I can install programs such as abiword or catdoc. I can handle the file uploads, but can't parse the contents of the document. </p>\n\n<p>How can I read the contents of the doc file? The information will then be put into a database. It'd be nice to preserve basic formatting (bold, italic, underline), but not essential.</p>\n"},{"tags":["json","node.js","sockets","tcp"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13101247,"title":"streaming a series of JSON strings over Socket","body":"<p>This is probably more about socket/tcp behavior, than node.js. </p>\n\n<p>I am writing a server in node.js, which receives series of stringfied JSON objects over a socket (not HTTP).</p>\n\n<p>The client (iOS app) streams JSON strings over this socket. The size of each JSON string varies (from a few bytes to several K bytes), so as the timing. Each JSON string will be sent with a single \"write\" operation. </p>\n\n<p>When I receive data from a socket, I call JSON.parse(). </p>\n\n<p>Simple test case works great, but I am not sure if this is enough. </p>\n\n<p>I am wondering if I need to worry about the following cases,\n(1) 'data' contains multiple JSON objects\n(2) a single JSON object is sent over multiple data's.</p>\n"},{"tags":["node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13073982,"title":"Running arbitrary MongoDB scripts through Node.js driver","body":"<p>I have a combination of complex MongoDB scripts that runs from the command line as follows: </p>\n\n<pre><code>$ mongo mydb config.js task.js\n</code></pre>\n\n<p>Since I can't run shell scripts in my server environment and need to schedule the above task, I figured I could simply concatenate the above .js files and then run them from a Node script. Hence I am looking for an equavalent to:</p>\n\n<pre><code>db.runMyCustomRawCommands(string commands)\n</code></pre>\n\n<p>How can I do this, or what would be an alternative solution?</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13099396,"title":"Document Polymorphism in a MongoDb collection using Node.js / MongooseJs -","body":"<p>I need to maintain a collection 'users' of <strong>[User]</strong> documents for implementing an authentication mechanism for my site.</p>\n\n<p><strong>[User]</strong> ~ {color: string,  username:string, password-hash:string, password-salt: string}</p>\n\n<p>Additionally, each <strong>[User]</strong> can be one of 3 colors - <strong>[RedUser]</strong>, <strong>[BlueUser]</strong> and <strong>[GreenUser]</strong> and will have differing schemas depending on color. All extending from the <strong>[User]</strong> schema:</p>\n\n<pre><code>[RedUser] ~ Union( [User],  {redfield:string} )\n[GreenUser] ~ Union( [User],  {greenfield:boolean} )\n[BlueUser] ~ Union( [User],  {bluefield:number} )\n</code></pre>\n\n<p>e.g.  a green user - {color:'green',username:'bob',password-hash:'1313a...',password-salt:'...'}</p>\n\n<p>For authentication I want to query the 'users' collection using the general <strong>[User]</strong> schema, as all I need to know is the password-hash.</p>\n\n<p>However, I would like a function as follows (pseudocode):</p>\n\n<pre><code>Authenticate( username, password )\n    userDoc &lt;- users.findOne({username:username})\n    if badPassword(usersDoc.password-hash,password) throw error\n    else\n        if userDoc.color=='red'\n            return recast(userDoc, RedUser)\n        if userDoc.color=='green'\n            return recast(userDoc, BlueUser)\n        if userDoc.color=='blue'\n            return recast(userDoc, GreenUser)\n</code></pre>\n\n<p>So how could I do the up-casting from a <strong>[User]</strong> document to a <strong>[RedUser]</strong> for example?</p>\n\n<p>I am using Node.js/MongooseJs/Coffeescript</p>\n\n<p>thanks!</p>\n"},{"tags":["javascript","node.js","request","multipartform-data","multipart-form"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13101016,"title":"How do I post a multipart request with request.js","body":"<p>The title simply says it. I can not figure out how to send a a couple of fields vial multipart.</p>\n\n<p>I understand that there is an implementation with <a href=\"https://github.com/felixge/node-form-data\" rel=\"nofollow\">https://github.com/felixge/node-form-data</a></p>\n\n<p>I have all my fields available and would just to post it as multipart and work with the async result...</p>\n\n<p>For any examples better or for me more clearer than then the one on the authors github's page (https://github.com/mikeal/request) would be fantastic...</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","everyauth","restify"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13101259,"title":"Using everyauth with restify","body":"<p>I'm trying to use everyauth to handle authentication for a rest api created with restify.\nBut can't find a starting point. I'd expect to be doing something like:</p>\n\n<pre><code>var restify = require('restify');  \nvar everyauth = require('everyauth');\nvar server = restify.createServer();\nserver.use(everyauth.middleware());\n</code></pre>\n\n<p>but restify does not accept the everyauth middleware.</p>\n\n<p>How do I go about setting up restify and everyauth?</p>\n"},{"tags":["node.js","meteor"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13076788,"title":"Meteor blocking clarification","body":"<p>According to the meteor docs, inserts block:</p>\n\n<blockquote>\n  <p>On the server, if you don't provide a callback, then insert blocks\n  until the database acknowledges the write, or throws an exception if\n  something went wrong. If you do provide a callback, insert still\n  returns the ID immediately.</p>\n</blockquote>\n\n<p>So this would be wrong:</p>\n\n<pre><code>Meteor.methods({\n  post: function (options) {\n    return Stories.insert(options)\n  }\n});\n</code></pre>\n\n<p>I need to do this:</p>\n\n<pre><code>Meteor.methods({\n  post: function (options) {\n    return Stories.insert(options, function(){})\n  }\n});\n</code></pre>\n\n<p>Can somebody confirm that this is the case? The former will block the ENTIRE SERVER until the db returns?</p>\n"},{"tags":["javascript","node.js","cloudfoundry","expressjs"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":213,"score":0,"question_id":12649390,"title":"Node.js app, Express and Cloud Foundry","body":"<p>I am using out of the box expressjs app, and I'm using node 0.8.2. Works great locally, but when I push to the Cloud Foundry I get the following error, and I have no idea where to start with debugging. I'm assuming that this is caused by a configuration issue or a dependency issue, but I don't know what to do. </p>\n\n<p><strong>Express\n500 TypeError: Object # has no method 'randomBytes'</strong>\nat Object.uid (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/utils.js:122:17)\nat MemoryStore.generate (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/session.js:203:27)\nat generate (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/session.js:281:13)\nat Object.session [as handle] (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/session.js:290:7)\nat next (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/proto.js:190:15)\nat Object.cookieParser [as handle] (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/cookieParser.js:60:5)\nat next (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/proto.js:190:15)\nat Object.methodOverride [as handle] (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/methodOverride.js:37:5)\nat next (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/proto.js:190:15)\nat multipart (/var/vcap/data/dea/apps/dwgapp1-0-690016dc6c7142f385b44b144d3d380e/app/node_modules/express/node_modules/connect/lib/middleware/multipart.js:62:61)</p>\n\n<pre><code>    var express = require('express')\n       , routes = require('./routes')\n       , user = require('./routes/user')\n       , http = require('http')\n       , path = require('path');\n\n    var app = express();\n\n    app.configure(function(){\n       app.set('port', process.env.VCAP_APP_PORT || 3000);\n       app.set('views', __dirname + '/views');\n       app.set('view engine', 'ejs');\n       app.use(express.favicon());\n       app.use(express.logger('dev'));\n       app.use(express.bodyParser());\n       app.use(express.methodOverride());\n       app.use(express.cookieParser('your secret here'));\n       app.use(express.session());\n       app.use(app.router);\n       app.use(require('stylus').middleware(__dirname + '/public'));\n       app.use(express.static(path.join(__dirname, 'public')));\n    });\n\n    app.configure('development', function(){\n       app.use(express.errorHandler());\n    });\n\n    app.get('/', routes.index);\n    app.get('/users', user.list);\n\n    http.createServer(app).listen(app.get('port'), function(){\n       console.log(\"Express server listening on port \" + app.get('port'));\n    });\n</code></pre>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13097266,"title":"Querying nested documents using Mongoose (MongoDB)","body":"<p>I am starting out with mongodb and having hard time trying to query nested documents. I have two schemas:</p>\n\n<pre><code>var LinkSchema = new mongoose.Schema({\n    url: String,\n    name: String\n});\n\nvar UserSchema = new mongoose.Schema({\n    name: String,\n    links: [LinkSchema]\n});\n</code></pre>\n\n<p>As you can see, I am just tying to build a simple bookmarking tool. Each user has a name and a collection of links. Each link has a name and a url. </p>\n\n<p>Now, what I am trying to do is for example, see if a link already exists in someone's links array. I would like to be able to do something like this (Trying to get vlad's link collection and then see if the query link already belongs to the collection or not):</p>\n\n<pre><code>app.get(\"/:query\", function(req, res){\n  User.findOne({\"name\":\"vlad\"}, function(err, user){\n    user.links.find({\"url\":req.params.query}, function(err, foundLinks){\n      if(foundLinks){\n        res.send(\"link already exists!\");\n      } else {\n        res.send(\"link doesn't exist!\");\n      }\n    });\n  });\n});\n</code></pre>\n\n<p>Of course, this code doesn't work, because apparently I can't do a \"user.links.find()\". I guess I can just do a user.links.map to extract only urls and then run a membership query against it. But I think this would be far from the right solution. There's gotta be a way to do something like this natively using DB queries. Can someone help? Thank you!</p>\n"},{"tags":["node.js","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13097200,"title":"passing parameters to Node.js async waterfall","body":"<p>I need to pass some parameters to the initial function of async waterfall. The proposed method  <a href=\"https://github.com/caolan/async/issues/14\" rel=\"nofollow\">https://github.com/caolan/async/issues/14</a> does not work for me as I need to pass it the response from an ExpressJS function</p>\n\n<pre><code>exports.categories = (req, res) -&gt;\n    async.waterfall [           \n       (callback) -&gt;\n         # need req here...\n</code></pre>\n"},{"tags":["javascript","performance","node.js","object","garbage-collection"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":107,"score":1,"question_id":12539574,"title":"What's the best way (most efficient) to turn all the keys of an object to lower case?","body":"<p>I've come up with</p>\n\n<pre><code>function keysToLowerCase (obj) {\n  var keys = Object.keys(obj);\n  var n = keys.length;\n  while (n--) {\n    var key = keys[n]; // \"cache\" it, for less lookups to the array\n    if (key !== key.toLowerCase()) { // might already be in its lower case version\n        obj[key.toLowerCase()] = obj[key] // swap the value to a new lower case key\n        delete obj[key] // delete the old key\n    }\n  }\n  return (obj);\n}\n</code></pre>\n\n<p>But I'm not sure how will v8 behave with that, for instance, will it really delete the other keys or will it only delete references and the garbage collector will bite me later ?</p>\n\n<p>Also, I created <a href=\"http://jsperf.com/object-keys-to-lower-case\" rel=\"nofollow\">these tests</a>, I'm hoping you could add your answer there so we could see how they match up.</p>\n\n<p><strong>EDIT 1:</strong>\nApparently, according to the tests, it's faster if we don't check if the key is already in lower case, but being faster aside, will it create more clutter by ignoring this and just creating new lower case keys ? Will the garbage collector be happy with this ?</p>\n"},{"tags":["node.js"],"answer_count":7,"favorite_count":10,"up_vote_count":25,"down_vote_count":0,"view_count":598,"score":25,"question_id":12886438,"title":"Node.js app has periodic slowness and/or timeouts (does not accept incoming requests)","body":"<p>I've been trying to hunt down this bug for a long time. I'm out of ideas, and am looking for new suggestions. This problem is killing the stability of my production servers and really needs to be resolved ASAP.</p>\n\n<p>To recap, the basic idea is that my node server(s) sometimes intermittently slow down, sometimes resulting in Gateway Timeouts. As best as I can tell from my logs, something is blocking the node thread (meaning that the incoming request is not accepted), but I cannot for the life of me figure out what. </p>\n\n<p><em>The problem ranges in severity</em>. Sometimes what should be &lt;100ms requests take ~10 seconds to complete; sometimes they never even get accepted by the node server at all. <strong>In short, it is as though some random task is working and blocking the node thread for a period of time, thus slowing down (or even blocking) incoming requests; the one thing I can say for sure is that the need-to-fix-symptom is a \"Gateway Timeout\"</strong>.</p>\n\n<p><em>The issue comes and goes without warning</em>. I have not been able to correlate it against CPU usage, RAM usage, uptime, or any other relevant statistic. I've seen the servers handle a large load fine, and then have this error with a small load, so it does not even appear to be load-related. It is not unusual to see the error around 1am PST, which is the smallest load time of the day! Restarting the node app does seem to <em>maybe</em> make the problem go away <em>for a while</em>, but that really doesn't tell me much. I do wonder if <a href=\"https://groups.google.com/forum/?fromgroups=#!topic/nodejs/jncp6KM3EGM\">it might be a bug in node.js</a>... not very comforting, considering it is killing my production servers.</p>\n\n<ul>\n<li>The first thing I did was to make sure I had upgraded node.js to the latest (0.8.12), as well as all my  modules (<a href=\"http://pastebin.com/UFS6jW5X\">here they are</a>). Of course, I also have plenty of error catchers in place. I'm not doing anything funky like printing out lots to the console or writing to lots of files.</li>\n<li>At first, <a href=\"http://stackoverflow.com/questions/12868107/node-jsexpress-randomly-drops-requests-resulting-in-a-gateway-timeout\">I thought it was outbound HTTP requests blocking the incoming socket, because the express middleware was not even picking up the inbound request, but I gave up the theory because it looks like the node thread itself became busy</a>.</li>\n<li>Next, I went through all my code with JSHint and fixed literally every single warning, including a few accidental globals (forgetting to write \"var\") but this didn't help</li>\n<li>After that, I assumed that perhaps I was running out of memory. But, my heap snapshots via nodetime are looking pretty good now (described below).</li>\n<li><a href=\"http://stackoverflow.com/questions/12887062/node-v8-garbage-collector-how-to-debug-long-mark-sweep-times\">Still thinking that memory might be an issue, I took a look at garbage collection</a>. I enabled the --nouse-idle-notification flag and did some more code optimization to NULL objects when they were not needed.</li>\n<li>Still convinced that memory was the issue, I added the --expose-gc flag and executed the gc(); command every minute. This did not change anything, except to occasionally make requests a bit slower perhaps.</li>\n<li>In a desperate attempt, I setup the \"cluster\" module to use 2 workers and automatically restart them every 30 min. Still, no luck.</li>\n<li>I increased the ulimit to over 10,000 and kept an eye on the open files. There seem to be &lt; 300 open files (or sockets) per node.js app, and increasing the ulimit thus had no impact.</li>\n</ul>\n\n<p>I've been logging my server with nodetime and here's the jist of it:</p>\n\n<ul>\n<li>CentOS 5.2 running on the Amazon Cloud (m1.large instance)</li>\n<li>Greater than 5000 MB free memory at all times</li>\n<li>Less than 150 MB heap size at all times</li>\n<li>CPU usage is less than 60% at all times</li>\n</ul>\n\n<p>I've also checked my MongoDB servers, which have &lt;5% CPU usage and no requests are taking > 100ms to complete, so I highly doubt there's a bottleneck.</p>\n\n<p>I've wrapped (almost) all my code using Q-promises (<a href=\"http://stackoverflow.com/questions/12883370/reading-node-js-heap-snapshots-created-via-nodetime-why-are-my-objects-not#comment17444187_12883370\">see code sample</a>), and of course have avoided Sync() calls like the plague. I've tried to replicate the issue on my testing server (OSX), but have had little luck. Of course, this may be just because the production servers are being used by so many people in so many unpredictable ways that I simply cannot replicate via stress tests...</p>\n"},{"tags":["node.js","google-chrome","heap","profiler","snapshot"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13091037,"title":"Node.js Heap Snapshots and Google Chrome Snapshot Viewer","body":"<p>Is there any way to take a heap snapshot from a running Node.js process and then load it into the Google Chrome profiles viewer? It would be very awesome to be able to use the really useful Chrome profiles tab to view Node.js snapshots.</p>\n\n<p>If it is possible to do, can someone provide a step-by-step of how to produce a snapshot in Node.js and then load it into Chrome?</p>\n"},{"tags":["javascript","node.js","cross-domain","greasemonkey","local"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13093881,"title":"Crossdomain Communication Between Windows/tabs With Tampermonkey","body":"<p>For example</p>\n\n<p>I have  \"domain.com\" with localscript and push the button</p>\n\n<p>then at \"otherdomain.com\" (not iframe!) with second localscript (in other window or tab) popup alert </p>\n\n<p>Something exept nodejs ? </p>\n\n<p>Thanks</p>\n"},{"tags":["facebook","node.js","everyauth"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13097867,"title":"everyauth admin interface","body":"<p>I have a Node.JS apps where users log in using Facebook. I'd like to implement an admin panel so that I can administrate my database.</p>\n\n<p>How can I configure routes and everyauth such that certain routes (i.e. /admin) can only be accessed if I (the administrator facebook account) am logged in?</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","module","mongoose","mocha"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13057016,"title":"NodeJs, Mocha and Mongoose","body":"<p>I have the follow structure:</p>\n\n<pre>\n|server\n |db\n  |mongooseTest.js\n |test\n  |userModel.test.js\n |user\n  |userModel.js\n</pre>\n\n<p>With their code:</p>\n\n<p><em>mongooseTest.js</em></p>\n\n<pre>\n\n    var mongoose = require('mongoose');\n\n    module.exports = function() {\n        var db = mongoose.createConnection('localhost', 'dbUnitTest');\n\n        db.on('connected', function() {\n            console.log('DB: ' + db.name + ' local: ' + db.host + ':' + db.port);\n        });\n\n        db.on('error', function(err) {\n            console.log(err);\n        });\n\n        return db;\n    };\n\n</pre>\n\n<p><em>userModel.test.js</em></p>\n\n<pre>\n\n    var assert = require('assert'),\n        should = require('should'),\n        conn = require('../db/mongooseTest'),\n        UserModel = require('../user/userModel');\n\n    describe('User Model', function() {\n        describe('Save', function() {\n\n            it('Saving...', function() {\n                var db = conn();\n                var Model = db.model('User');\n                var userModel = new Model({\n                    name: 'My Name',\n                    email: 'contact@com.br',\n                    pass: 'anything123'\n                });\n\n                userModel.on('save', function(user) {\n                    console.log('Passed by save event handle from user');\n                });\n\n                userModel.save(function(err, user) {\n                    console.log('Passed by save from user');\n                    if(err) console.log(err);\n                    console.log(user);\n                });\n            });\n        })\n    })\n\n</pre>\n\n<p><em>userModel.js</em></p>\n\n<pre>\n\n    var mongoose = require('mongoose'),\n        crypto = require('crypto'),\n        Schema = mongoose.Schema;\n\n    var setPass = function(value) {\n            var salt = 'anyRandomSaltValue';\n            this.set('salt', salt);\n            var pass = hashPass(value + salt);\n            return pass;\n        }\n\n    var hashPass = function(value) {\n            return crypto.createHash('sha1').update(value).digest('HEX');\n        }\n\n    var userSchema = new Schema({\n        name: {\n            type: String,\n            required: true\n        },\n        email: {\n            type: String,\n            required: true,\n            unique: true\n        },\n        pass: {\n            type: String,\n            required: true,\n            set: setPass\n        },\n        salt: {\n            type: String,\n            required: true\n        }\n    });\n\n    userSchema.method({\n        validatePass: function(senha) {\n            var salt = this.get('salt');\n            var passSha = hashPass(senha + salt);\n            return passSha === this.get('senha');\n        },\n    });\n\n    userSchema.static({\n        findByEmail: function(email, success, error) {\n            this.findOne({\n                email: email\n            }, function(e, o) {\n                if(e) {\n                    if(error) error(e);\n                } else {\n                    if(success) success(o);\n                }\n            });\n        },\n    });\n\n    module.exports = mongoose.model(\"User\", userSchema);\n\n</pre>\n\n<p>The problem is...\nWhen I run \"mocha\" to execute my unit tests, the callback of the save function  is not performed.</p>\n\n<p>Thanks for all!</p>\n"},{"tags":["c","node.js","stream"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13096968,"title":"Pass readableStream to C binding","body":"<p>Is it possible to pass a readableStream into a Node.js C binding library in some way without having to buffer it first? I'm aware of using child_process.spawn with stdin and stdout and shell commands for similar sorts of tasks but is there a way to pass in a stream directly (assuming that would be more performant than a child process and stdin/stdout)? </p>\n\n<p>Thanks for any guidance!</p>\n"},{"tags":["node.js","coffeescript","requirejs","amd","javascript-module"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13093886,"title":"How to set up reusable modular CoffeeScript project","body":"<p>I have <a href=\"https://github.com/brianmhunt/jAddressParser\" rel=\"nofollow\">a CoffeeScript project (called jAddressParser)</a> that I am hoping to turn into reusable module. Unfortunately I am not overly familiar with how to modularize CoffeeScript for such a purpose, while maintaining sensible interoperability with an existing project.</p>\n\n<p>The <a href=\"https://github.com/brianmhunt/jAddressParser\" rel=\"nofollow\">project in question parses address strings</a> - <a href=\"http://stackoverflow.com/questions/16413\">no short order</a>, to be sure. However for the purpose of the project I am working on, this strategy should work and it is possible someone else may benefit from it and perhaps others may make some useful contributions. Everybody wins!</p>\n\n<p>So what I have is code laid out in a directory like this:</p>\n\n<pre><code>/\n  README.md\n  LICENSE\n  package.json\n  /src\n    main.js\n    main.coffee\n    canada.coffee\n    iso3166.js\n  /test\n  /build\n</code></pre>\n\n<p>In an ideal world, my workflow would be like this:</p>\n\n<ol>\n<li><p>Test the above javascript from the command line. I would think <a href=\"http://nodejs.org/\" rel=\"nofollow\">Node.js</a> is the most suitable way.</p></li>\n<li><p>Compile the files in <code>/src</code> to a <code>/build/jAddressParser.js</code> file. I would think <a href=\"https://github.com/jrburke/r.js/\" rel=\"nofollow\">r.js</a> would work well for this.</p></li>\n<li><p>When all is ready, copy the <code>jAddressParser.js</code> from the <code>/build</code> to my web project.</p></li>\n<li><p>Include the jAddressParser in my web project with the appropriate <code>requirejs</code> call (i.e. it would be AMD-ready) e.g. <code>require(['jAddressParser'], -&gt; ...)</code></p></li>\n</ol>\n\n<p>Since it seems I have to include the dependencies (lodash, requirejs, require-cs, XRegExp, CoffeeScript) I expect I will do this by putting specific versions in the <code>/lib</code> directory or by using git submodules (though submodules seems to be a bit of overkill for such a small project).</p>\n\n<p>I have never created a reusable CoffeeScript module, and I was essentially unable to find a good reference on how to perform the same for a web-module (there seem to be some decent examples for projects that are node.js-only - thought I would certainly love to see a list of more). I would be quite grateful for any thoughts or references that may shed light on the viability of the proposal above, or how you yourself might go about organizing such a project?</p>\n"},{"tags":["node.js","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13096856,"title":"Conditionally call async function in Node","body":"<p>I have the following example code - the first part can result in an async call or not - either way it should continue. I cannot put the rest of the code within the async callback since it needs to run when condition is false. So how to do this?</p>\n\n<pre><code>if(condition) {\n    someAsyncRequest(function(error, result)) {\n        //do something then continue\n    }\n}\n\n //do this next whether condition is true or not\n</code></pre>\n\n<p>I assume that putting the code to come after in a function might be the way to go and call that function within the async call above or on an else call if condition is false - but is there an alternative way that doesn't require me breaking it up in functions?</p>\n"},{"tags":["javascript","node.js","rc4-cipher","cryptojs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13058977,"title":"NodeJS Crypto with RC4 yields blank","body":"<p>I have a php function that generates an RC4 encrypted string. I would like to decode that string using Node - ideally using the built in Crypto module. But I am unable to do so - I just get a blank string.</p>\n\n<p>The PHP code is here <a href=\"http://code.google.com/p/rc4crypt/\" rel=\"nofollow\">http://code.google.com/p/rc4crypt/</a></p>\n\n<p>My JS code is</p>\n\n<pre><code>crypto = require('crypto');\ndecipher = crypto.createDecipher(\"rc4\", \"MY SECRET KEY\");\ntext = \"HELLO\";\ndecrypted = decipher.update(text, \"utf8\", \"hex\");\ndecrypted += decipher.final(\"hex\");\nconsole.log(decrypted);\n</code></pre>\n\n<p>I don't get any output. I have checked that my OpenSSL implementation has RC4 using openssl list-message-digest-algorithms</p>\n\n<p>I am on OSX 10.8, latest node.</p>\n\n<p>I am open to using another module to decrypt - I tried the cryptojs module but did not figure out how to make it work - gave me errors when I tried RC4.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","ffmpeg","audio-streaming","low-latency"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":13081609,"title":"Node.js Live Streaming: Avoid buffering","body":"<p>I've written a small nodeJS server that outputs system audio captured by ffmpeg on Windows (using DirectShow) to the browser as a streaming MP3 file. The audio needs to be as live as possible, with minimum/no buffering, and a \"skipping\" effect in the audio is perfectly acceptable.</p>\n\n<p>When I play the audio in Chrome using the HTML5 audio tag, there's a delay of about 8-10 secs over a low-latency LAN connection. I suspected this to be a client-side buffer, and used a Flash MP3 player on the client-side, which brought down the delay to 2-3 secs.</p>\n\n<p>Now, the buffering seems to taking place on the server-side. The documentation for NodeJS's response.write mentions that the data is written kernel buffers. How do I go about avoiding any buffering altogether or at least getting around it, so that the client always gets the latest audio data? Strategies for handling 'drain' events to always push live data?</p>\n\n<p>On the request object, I've used <a href=\"https://github.com/maxtaco/node-fast-msgpack-rpc/pull/1\" rel=\"nofollow\">setNoDelay(true)</a> to avoid the use of Nagle's algorithm. Following is a snippet of how data is written when the spawned ffmpeg process emits data. </p>\n\n<pre><code>var clients = []; //List of client connections currently being served\nffmpeg.stdout.on('data', function(data) {\n    for(var i = 0; i &lt; clients.length; i++){\n        clients[i].res.write(data);\n    }\n});\n</code></pre>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13096071,"title":"Node.js Inheritance","body":"<p>I have inherited a class from another JS, and added few prototype function over Parent functions. When i create a new instance of child, i want to call the constructor of parent. Please suggest a way.</p>\n\n<blockquote>\n  <p><strong>Parent</strong> </p>\n</blockquote>\n\n<pre><code>function Parent() { .. } \n    Parent.prototype.fn1 = function(){};\n    exports.create = function() {\n    return (new Parent());\n};\n</code></pre>\n\n<blockquote>\n  <p><strong>Child</strong> </p>\n</blockquote>\n\n<pre><code>var parent = require('parent');\nChild.prototype = frisby.create();\nfunction Child() { .. } \nChild.prototype.fn2 = function(){};\nexports.create = function() {\n    return (new Child());  \n};\n</code></pre>\n"},{"tags":["node.js","express","passport","node-redis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13090177,"title":"Updating cookie session in express not registering with browser","body":"<p>I've set up a working login test as follows:</p>\n\n<pre><code>var express = require('express');\nvar fs = require('fs');\nvar http = require('http');\nvar path = require('path');\nvar routes = require('./routes/index.coffee');\nvar passport = require('passport');\n\nvar LocalStrategy = require('passport-local').Strategy;\nvar User = require('./userdb.coffee');\nvar app = express();\nvar RedisStore = require('connect-redis')(express);\n\npassport.use(new LocalStrategy(function(username, password, done) {\n  return User.findOne({\n    username: username\n  }, function(err, user) {\n    if (err) {\n      return done(null, false, message: error);\n    }\n    if (!user) {\n      return done(null, false, {\n        message: 'Unknown user'\n      });\n    }\n    if (!user.validPassword(password)) {\n      return done(null, false, {\n        message: 'Invalid password'\n      });\n    } else {\n      return done(null, user);\n    }\n  });\n}));\n\npassport.serializeUser(function(user, done) {\n  return done(null, user);\n});\n\npassport.deserializeUser(function(user, done) {\n  return done(null, user);\n});\n\napp.configure(function() {\n  app.set('port', process.env.PORT || 5003);\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.enable('trust proxy');\n  app.use(express[\"static\"](path.join(__dirname, 'public')));\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(express.cookieParser('SOMESECRET'));\n  app.use(express.session({\n    cookie: {\n      maxAge: 10 * 60 * 1000\n    },\n    key: 'express.sid',\n    secret: 'SOMESECRET',\n    store: new RedisStore({\n      port: 6379,\n      host: 'localhost'\n    })\n  }));\n  app.use(passport.initialize());\n  app.use(passport.session());\n  return app.use(app.router);\n});\n\nvar check_auth = function(req, res, next) {\n  if (req.isAuthenticated()) {\n    console.log(req.session.cookie.expires);\n    return next();\n  }\n  return res.redirect('/login');\n};\n\napp.get('/', check_auth, routes.index);\napp.get('/login', routes.login);\napp.get('/logout', routes.logout);\napp.post('/authenticate', passport.authenticate('local', {\n  successRedirect: '/',\n  failureRedirect: '/login'\n}));\n\napp.listen(app.get('port'), '0.0.0.0');\n</code></pre>\n\n<p>The routes and User logic is omitted, as I take it they're irrelevant to my issue, but I'll happily share them if needed (they're very small, this is just to get a small proof of concept up and running).</p>\n\n<p><em>Login works, reading the session works, rendering templates based on session values work.</em>\n<strong>My problem is with maxAge/expires</strong>. I'm not sure where-in the problem lies, but I'll try to describe it:</p>\n\n<p>When I log in, the session is saves with <code>passport.js</code>, stored correctly in my <code>RedisStore</code>, and a cookie pointing at the session is returned to the browser.\nOn subsequent requests the cookie is successfully found and points to the correct session from my <code>SessionStore</code>. <code>req.session.cookie</code> show an UPDATED <code>expires</code> and in my <code>redis</code> server, the TTL is reset to 10 minutes (600).</p>\n\n<p><strong>My problem</strong> is that the cookie remains at the same expirary in the browser (Chrome, windows and Mac).</p>\n\n<p><strong>So my question is</strong>: How can I debug this further?\nAs req.session is updated (by <code>express</code>, <code>passport</code> and <code>connect-redis</code> internally/automatically), I'm wondering where the problem lies, and what I should do to fix this: <em>Cookie remains at the initial maxAges/expires</em>.</p>\n\n<p>Any tips, pointers or ideas are grately appreciated.</p>\n"},{"tags":["javascript","asynchronous","functional-programming","node.js"],"answer_count":10,"favorite_count":14,"up_vote_count":29,"down_vote_count":0,"view_count":5448,"score":29,"question_id":4234619,"title":"How to avoid long nesting of asynchronous functions in Node.js","body":"<p>I want to make a page that displays some data from a DB, so I have created some functions that get that data from my DB. I'm just a newbie in Node.js, so as far as I understand, if I want to use all of them in a single page (HTTP response) I'd have to nest them all:</p>\n\n<pre><code>http.createServer(function (req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  var html = \"&lt;h1&gt;Demo page&lt;/h1&gt;\";\n  getSomeDate(client, function(someData) {\n    html += \"&lt;p&gt;\"+ someData +\"&lt;/p&gt;\";\n    getSomeOtherDate(client, function(someOtherData) {\n      html += \"&lt;p&gt;\"+ someOtherData +\"&lt;/p&gt;\";\n      getMoreData(client, function(moreData) {\n        html += \"&lt;p&gt;\"+ moreData +\"&lt;/p&gt;\";\n        res.write(html);\n        res.end();\n      });\n    });\n  });\n</code></pre>\n\n<p>If there are many functions like that, then <strong>the nesting becomes a problem</strong>.</p>\n\n<p>Is there a way to avoid this? I guess it has to do with how you combine multiple asynchronous functions, which seems to be something fundamental.</p>\n"},{"tags":["ios","node.js","openssl"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12978019,"title":"Unpacking a PKCS7 payload from an iOS device (MDM enrollment)","body":"<p>I'm trying to build a MDM server, given ruby code by Apple is : </p>\n\n<pre><code>p7sign = OpenSSL::PKCS7::PKCS7.new(req.body)\nstore = OpenSSL::X509::Store.new\np7sign.verify(nil, store, nil, OpenSSL::PKCS7::NOVERIFY)\nsigners = p7sign.signers\n</code></pre>\n\n<p>I have this very basic NodeJS code to receive &amp; store the POST payload :</p>\n\n<pre><code>exports.profile = function(req, res) {\n    var queryData = \"\";\n    req.on('data', function(chunk) {\n        queryData += chunk;\n    });\n    req.on('end', function() {\n        fs.writeFileSync('out.p7s', queryData);\n    });\n    res.send('1');\n};\n</code></pre>\n\n<p>However the given file : <a href=\"https://dl.dropbox.com/u/2310128/ios-mdm.p7s\" rel=\"nofollow\">https://dl.dropbox.com/u/2310128/ios-mdm.p7s</a></p>\n\n<p>Can't seems to be recognized by openssl at all!!</p>\n\n<pre><code>openssl pkcs7 -in req.p7s -inform DER -print_certs\n</code></pre>\n\n<p>Is returning :</p>\n\n<pre><code>unable to load PKCS7 object\n140735186985436:error:0D07207B:asn1 encoding routines:ASN1_get_object:header too long:asn1_lib.c:150:\n</code></pre>\n\n<p>Any idea what could go wrong here? Is there some extra padding I should remove? Is the given file not PKCS7 at all?</p>\n\n<p>Request headers :</p>\n\n<pre><code>{ host: '192.168.22.39:3000',\n  'accept-encoding': 'gzip, deflate',\n  'content-type': 'application/pkcs7-signature',\n  'accept-language': 'fr-fr',\n  cookie: 'connect.sid=s%3Andcjz5pGCdb1AYXhNG8Us5mh.5szK2X1cOpnih9X5kCbqTUdpv8EyJRwNHl4VC6M5Gwk',\n  accept: '*/*',\n  'content-length': '3564',\n  connection: 'keep-alive',\n  'user-agent': 'Profile/1.0' }\n</code></pre>\n\n<p>Thanks!!</p>\n"},{"tags":["node.js","connect","port80"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1566,"score":0,"question_id":8792869,"title":"ECONNREFUSED on Port 80","body":"<p>I've written a web-server using Node.js.\nWhen I tried to test my server with the tester I've written for it, I succeed only if the port I'm using for the server is not 80.\nI've checked on netstat, and no other application is using port 80.\nThe error I'm getting on the console is:</p>\n\n<p>Error: connect ECONNREFUSED\n    at errnoException (net.js:640:11)\n    at Object.afterConnect [as oncomplete] (net.js:631:18)</p>\n\n<p>What can be done in this case?</p>\n\n<p>Thanks a lot.</p>\n"},{"tags":["node.js","coffeescript","express","jade","flash-message"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13092668,"title":"Connect-Flash and Express give me multiple messages but not type","body":"<p>I'm trying to ask a type to a multiple flash message in Connect-Flash - Express and gives me multiple string messages but not \"type\"</p>\n\n<p>In Route:</p>\n\n<pre><code>  app.get '/multiple-flash', (req, res) -&gt;\n    req.flash \"info\", [\"Welcome\", \"Benvenuto\"]\n    res.redirect '/'\n</code></pre>\n\n<p>In client:</p>\n\n<pre><code>doctype 5\nhtml\n  head\n    title= 'Login'\n\n  body\n    p layout\n\n      if message \n        p= message\n\n    -console.log(message)\n</code></pre>\n\n<p>GET /multiple-flash at localhost, but the output in the console does not show \"type\". </p>\n\n<pre><code>GET /multiple-flash 302 1ms - 90\n[ [ 'Welcome', 'Benvenuto', ] ]\n</code></pre>\n\n<p>How can I fix? thanks</p>\n"},{"tags":["node.js","asynchronous","good-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13092399,"title":"Asynchronous wait for an condition to be met","body":"<p>In my code I have three variables whose value depend on an external function call, they can be set to true in any moment and in any order, so, they are more like flags.</p>\n\n<p>I need a function to be only once these three variables are set to true.</p>\n\n<p>How can I perform a wait for these three variables to be true, without blocking my server, in an asynchronous way?</p>\n\n<p>(I do not want to be refered to external libraries)</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13093308,"title":"What would be the best possible way to generate API keys and hash passwords in Nodejs?","body":"<p>I am using my own authentication and sort of worried about the present security of my API. What would you suggest would be a good way to generate API keys? And what would be a better way to hash the password? </p>\n"},{"tags":["javascript","node.js","backbone.js","socket.io","nowjs"],"answer_count":4,"favorite_count":8,"up_vote_count":8,"down_vote_count":0,"view_count":6425,"score":8,"question_id":6657968,"title":"How to use backbone.js with websockets/socket-io/nowjs","body":"<p>I am just getting into backbone.js and am finding progress a little slow. My main problem is working out how to keep my client and server side models in sync using socket-io (technically I am using now.js but the same principal should apply). </p>\n\n<p>I think the best way is to override the sync method but some simple advice would be <strong>really</strong> welcome.</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":10163,"score":9,"question_id":4062260,"title":"Nodejs - Redirect url","body":"<p>When user enter the wrong url, the node js server will redirect to 404.html page, how can I implement this on nodejs.\nDo some search and it points me to expressjs ( looks like a nodejs wrapper ) but I want to write in nodejs.</p>\n\n<p>Thanks for reading .</p>\n"},{"tags":["windows","node.js","express"],"answer_count":2,"favorite_count":6,"up_vote_count":4,"down_vote_count":0,"view_count":2685,"score":4,"question_id":9091099,"title":"Node.js and Express on Windows","body":"<p>Tonight I decided I'd try to build a simple Node.js application using Express on my Windows 7 machine.  The installation went fairly smoothly, but Express refuses to cooperate.  Here are the steps I've taken:</p>\n\n<ol>\n<li>Installed Node.js using the MSI available at <a href=\"http://nodejs.org/dist/v0.6.9/node-v0.6.9.msi\" rel=\"nofollow\">http://nodejs.org/dist/v0.6.9/node-v0.6.9.msi</a></li>\n<li>Installed Express by running <code>npm install express g</code> from a command prompt.</li>\n<li>Created a directory for the application <code>c:\\source\\node&gt; mkdir newapp</code>.</li>\n<li>Changed directory to the application directory <code>c:\\source\\node&gt; cd newapp</code>.</li>\n<li>Ran Express: <code>c:\\source\\node\\newapp&gt; express --sessions --css stylus</code>.</li>\n</ol>\n\n<p>At this point the node.exe process fires up and runs endlessly at 25% CPU Time and continually uses more memory.  After running for 20+ minutes the node.exe process uses 300+ MB of Memory.  The <code>express</code> command never completes and the <code>newapp</code> directory remains unaltered.</p>\n\n<p>If I run <code>express --help</code> I see the help output in the console.  I've tried running the command prompt as and Administrator but still Express appears to hang.</p>\n\n<p>Does anyone have a clue what's going on or what I'm doing wrong?  Thanks in advance!</p>\n"},{"tags":["linux","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13092747,"title":"What happen when npm install -g was executed","body":"<p>this is a very newbie question. But I really cannot figure it out through Google search.\nI want to understand what happens when one executes </p>\n\n<pre><code>   sudo npm install -g \"node module name\"\n</code></pre>\n\n<p>I understand that the right module will be installed to, normally, /usr/local/....\nHowever, why would this be available globally?</p>\n\n<p>For example, I installed <strong>node-inspector</strong> locally in my project. But my shell does not understand when I type \"node-inspector\".</p>\n\n<p>But once I install it globally, </p>\n\n<blockquote>\n  <p>node-inspector &amp;</p>\n</blockquote>\n\n<p>command will does the right thing for me.\nI really want to understand how this happens.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","express","connect"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13086613,"title":"what is app.configure('production')","body":"<p>I am a new bie in NodeJS, what to do with the below setting which is given in express documation ?</p>\n\n<pre><code>app.configure('production', function(){\n  app.set('db uri', 'n.n.n.n/prod');\n});\n</code></pre>\n\n<p>Should I just copy and paste or should I need to change the 'db.uri' and 'n.n.n.n' ?</p>\n"},{"tags":["windows","iis","node.js"],"answer_count":7,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2382,"score":3,"question_id":5546326,"title":"Can you use node.js with IIS?","body":"<p>This may be an extremely simple quesiton, but can I use node.js in a windows server 2008 environment with IIS?  Is there a \"Microsoft\" library or some other solution that works better?</p>\n"},{"tags":["node.js","mongodb","backbone.js","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12978492,"title":"Loading related entities when dealing with Models and Collections from Backbone to Express / Mongoose","body":"<p>I have a <code>UserService</code> object that is essentially a <code>Service</code> with additional configuration parameters and is attached to a <code>User</code>. In my View I would like to render a list of these <code>UserServices</code> however the model is formed as such:</p>\n\n<pre><code>UserService = Backbone.Model.extend({\n    defaults: { \n        id: 0, \n        user_id: 0, // This needs to reference the user object somehow \n        service_id: 0, // This needs to reference the service object somehow\n        length: 216000, \n        price: 1000\n    }\n});\n</code></pre>\n\n<p>If I bind this model to the view, what is rendered ends up being the service_id instead of the parameter I need to render: <code>service.name</code>.</p>\n\n<p>My questions are:</p>\n\n<p>What should be stored in the <code>UserService</code> model at service? The full service object? Mongoose ID? Some other ID? (Please specify a suggestion)</p>\n\n<p>Where should I get the information for this <code>service.name</code> / When should I pull the <code>Service</code> object to get that information? It would be nice to be able to do <code>service.name</code> in the view when rendering...</p>\n\n<p>Is there a function to chain--upon loading the model, load related models that are needed?</p>\n\n<p>Overall I just need an understanding of how related models work in Backbone / Express / Mongoose.</p>\n\n<p>Any help is appreciated!</p>\n\n<p><strong>Update:</strong> After doing a bit of reading I have a couple different methods I can see:</p>\n\n<ol>\n<li>Within the <a href=\"http://backbonejs.org/#Model-constructor\" rel=\"nofollow\">constructor / initializer</a> load the <code>Service</code> object into the <code>UserService</code> object based on the reference ID returned from the server.</li>\n</ol>\n\n<p>My questions with that one then become... what is the reference ID? Where do I put the newly retrieved object into, possibly in place of the ID?</p>\n\n<ol>\n<li><p>Use the toJSON method to return an asthetic version of the UserService where it retreives the <code>Service</code> object and would return an object with the service name in it's place:</p>\n\n<p>{\n    id: ???, \n    service_name: \"this was retrieved from the service object in the toJSON method\", \n    length: \"1 hour\", // converted from within the toJSON method\n    price: 10.00 // converted from cents to dollars in the toJSON method\n}</p></li>\n</ol>\n\n<p>Or maybe a combination? Thoughts?</p>\n"},{"tags":["windows","node.js","posix","package","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":473,"score":1,"question_id":10396305,"title":"NPM package 'bin' script for Windows","body":"<p>Cucumber.js is supplying a command-line \"binary\" which is a simple <code>.js</code> file containing a <em>shebang</em> instruction:</p>\n\n<pre><code>#!/usr/bin/env node\nvar Cucumber = require('../lib/cucumber');\n// ...\n</code></pre>\n\n<p>The binary is specified in <code>package.json</code> with the <code>\"bin\"</code> configuration key:</p>\n\n<pre><code>{ \"name\" : \"cucumber\"\n, \"description\" : \"The official JavaScript implementation of Cucumber.\"\n// ...\n, \"bin\": { \"cucumber.js\": \"./bin/cucumber.js\" }\n// ...\n</code></pre>\n\n<p>This all works well on POSIX systems. Someone reported <a href=\"https://github.com/cucumber/cucumber-js/issues/60\" rel=\"nofollow\">an issue</a> when running Cucumber.js on Windows.</p>\n\n<p>Basically, the <code>.js</code> file seems to be executed through the JScript interpreter of Windows (not Node.js) and it throws a syntax error because of the shebang instruction.</p>\n\n<p>My question is: what is the recommended way of setting up a \"binary\" script that works on both UNIX and Windows systems?</p>\n\n<p>Thanks.</p>\n"},{"tags":["mongodb","node.js","mongoose"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":865,"score":0,"question_id":6714990,"title":"MongoDB 'error: non ascii character detected' on Node.js","body":"<p>I'm trying to parse a very large chunk of data into a new MongoDB database and when I run the job I keep getting an error when I do <code>db.myCollection.find()</code>.<br>\nThe error is <code>error: non ascii character detected</code>.  </p>\n\n<p>I am using Node.js and Mongoose to populate the database.  The only characters I have seen that might be causing problems are <code>'</code>, <code>,</code> and <code>-</code> but I have done a .replace on all of them.  I tried escaping them (<code>\\</code>) and I tried just removing them entirely and nothing seems to be working.  </p>\n\n<p>My biggest problem is that I don't get any errors when I am saving the objects, I just get that message when I try to view the collection.  </p>\n\n<p>Is there any information out there on sanitizing MongoDB input?</p>\n"},{"tags":["node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":856,"score":2,"question_id":9441287,"title":"how to find out the current NODE_ENV the express app is running under?","body":"<p>I was just wondering if i can find out what is the current value of <code>NODE_ENV</code> (i.e. either development or production) in a express code (so i can't use <code>app.configure('production' function(){})</code>).</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13087888,"title":"Getting the page title from a scraped webpage","body":"<pre><code>var http = require('http');\nvar urlOpts = {host: 'www.nodejs.org', path: '/', port: '80'};\nhttp.get(urlOpts, function (response) {\nresponse.on('data', function (chunk) {\nvar str=chunk.toString();\nvar re = new RegExp(\"(&lt;\\s*title[^&gt;]*&gt;(.+?)&lt;\\s*/\\s*title)\\&gt;\", \"g\")\nconsole.log(str.match(re));\n});\n\n});\n</code></pre>\n\n<p>Output</p>\n\n<blockquote>\n  <p>user@dev ~ $ node app.js [ 'node.js' ] null null</p>\n</blockquote>\n\n<p>I only need to get the title.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13086187,"title":"Error while using Node.js.","body":"<p>This is my model.</p>\n\n<pre><code>UserApiSchema.statics.createApi = function(user,fn){\n  var instance = new UserApi();\n  instance.user = user;\n  instance.apiKey = \"asdasdacasdasasd\";\n  console.log(\"username is \" + user.username);\n  instance.save(function(err){\n    fn(err,instance);\n  });\n};\n\nUserSchema.statics.newUser = function (email, password,username, fn) {\n    var instance = new User();\n    var apiInstance = new UserApi();\n    instance.email = email;\n    instance.password =password;\n    instance.username = username;\n\n    instance.save(function (err) {\n        fn(err, instance);\n    });\n};\n</code></pre>\n\n<p>This is my controller-users.js:</p>\n\n<p>app.post(\n    '/signup/',\n    function(req, res) {\n         {console.log(req.body.username);\n            User.newUser(</p>\n\n<pre><code>            req.body.email, req.body.password,req.body.username,\n            function (err, user) {\n                if ((user)&amp;&amp;(!err)) {\n                    console.log(user.username)\n\n                    UserApi.createApi(\n                            user,function(err,userapi){\n                                if((!err)){\n                                    res.send(\"APi created\")\n                                }\n                                else{\n                                    if(err.errors.apiKey){\n                                        res.send(err)\n                                    }\n                                }\n\n\n                            });\n                    req.session.regenerate(function(){\n                        req.session.user = user._id;\n                        res.send(\"Success here!\"); \n\n                    });\n                } else {\n                    if (err.errors.email) {\n                          res.send(err) \n                          console.log(req.body.password);\n                          console.log(req.body.email);\n                          console.log(req.body);\n                        }                           \n                   if (err.errors.username) {\n                      res.send(err) \n                      console.log(req.body.password);\n                      console.log(req.body.email);\n                      console.log(req.body);\n                    }   \n                }\n            });\n\n\n    } \n});\n</code></pre>\n\n<p>The concept is once the user-name/password is accepted, an API key is stored along with the username. Though, the username payload is getting accepted, when I do the UserApiSchema call to generate the api, no such api is generated. No errors either. </p>\n"},{"tags":["javascript","jquery","node.js","cloudinary"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":13080702,"title":"How to implement jQuery direct upload to Cloudinary on node.js","body":"<p>I'm trying to implement direct uploads to Cloudinary via their jQuery plugin to a Node.js application, and am wondering if anyone can help me close some gaps in their examples.</p>\n\n<p>Here's the blog post that explains how to do it:</p>\n\n<p><a href=\"http://cloudinary.com/blog/direct_image_uploads_from_the_browser_to_the_cloud_with_jquery\" rel=\"nofollow\">http://cloudinary.com/blog/direct_image_uploads_from_the_browser_to_the_cloud_with_jquery</a></p>\n\n<p>In the \"Other development frameworks and advanced usage\" section, the part I'm stuck on is:</p>\n\n<ul>\n<li>\"Set data-form-data to be JSON representation of the upload API params. The mandatory fields are api_key, timestamp, signature and callback.\",</li>\n</ul>\n\n<p>and more specifically:</p>\n\n<ul>\n<li>\"The signature needs to be generated on the server-side for correct authentication.\"</li>\n</ul>\n\n<p>There doesn't seem to be any example of exactly how to achieve this.</p>\n\n<p>The examples are:</p>\n\n<pre><code>&lt;input name=\"file\" type=\"file\" \n       class=\"cloudinary-fileupload\" data-cloudinary-field=\"image_upload\" \n       data-form-data=\" ... html-escaped JSON data ... \" &gt;&lt;/input&gt;\n</code></pre>\n\n<p>and the unescaped JSON content of data-form-data is:</p>\n\n<pre><code>{ \"timestamp\":  1345719094, \n  \"callback\": \"https://www.example.com/cloudinary_cors.html\",\n  \"signature\": \"7ac8c757e940d95f95495aa0f1cba89ef1a8aa7a\", \n  \"api_key\": \"1234567890\" }\n</code></pre>\n\n<p>How do you go about generating the signature? I understand I need to do this in node.js, and it seems like it needs to happen when the form is generated, although from what I can tell the signature needs to include the timestamp - which would surely be outdated by the time the user has filled out the form?</p>\n\n<p>The documentation for request authentication is here: <a href=\"http://cloudinary.com/documentation/upload_images#request_authentication\" rel=\"nofollow\">http://cloudinary.com/documentation/upload_images#request_authentication</a></p>\n\n<p>In the <a href=\"https://github.com/cloudinary/cloudinary_npm\" rel=\"nofollow\">cloudinary_npm</a> module, which I am using, there is a method in <code>uploader.coffee</code> called <code>direct_upload</code> which seems like a helper to make this happen, but I'm not clear on how to actually bind it all together.</p>\n\n<p>The two frameworks with real examples in the blog post, Rails and Django, abstract this complexity through their own helpers, e.g. in Django you add <code>{{ form.image }}</code> to your form, which outputs the result from <code>image = cloudinary.forms.CloudinaryJsFileField()</code> - unfortunately how to replicate this in any other server-side environment is not covered.</p>\n\n<p>If anyone can shed any light on this, or share a gist or example on how to make it work end-to-end, I'd greatly appreciate it.</p>\n"},{"tags":["javascript","node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13080588,"title":"Mongoose.js Error saving document with unusual but seemingly acceptable string value","body":"<p>I'm getting an error saving a document to mongoose.js from Node.js.  This code has worked fine for a while but it's now causing a problem with Javascript objects with key values that seem fine otherwise.  </p>\n\n<p>What's being saved is a document where one member is an associative array, which for simplicity have represented as <code>Schema.Types.Mixed</code>:</p>\n\n<pre><code>var formatSchema = new mongoose.Schema({\n  name: {type: String, required: true},\n  values: {type: mongoose.Schema.Types.Mixed, required: false}\n});\n</code></pre>\n\n<p>It's now failing when one object has a key like <code>\"0038-\"</code>.  Specifically, it's the dash <code>-</code> that's causing the problem.  If I take those values out (for testing, not for user satisfaction) it loads fine.  Having isolated it this far am now stumped as to how to proceed.</p>\n\n<pre><code>[\n  {\n    \"name\": \"INJURYF\",\n    \"values\": {\n        \"0\": \"No\",\n        \"1\": \"Yes\"\n    }\n  },\n  {\n    \"name\": \"RFVF\",\n    \"values\": {\n        \"10050\": \"Chills\",\n        \"10100\": \"Fever\",\n        \"10200\": \"General weakness\",\n        \"10250\": \"General ill feeling\",\n        \"00323\": \"Salmonella arthritis\",\n        \"00324\": \"Salmonella osteomyelitis\",\n        \"0038-\": \"Other specified salmonella infections\",   // PROBLEM STARTS HERE\n        \"0039-\": \"Salmonella infection, unspecified\",\n        \"0040-\": \"Shigella dysenteriae\",\n        ...\n      }\n    }, ...\n  ]\n</code></pre>\n\n<p>Here's the specific error message, </p>\n\n<pre><code>Express\n500 TypeError: Cannot call method 'path' of undefined\nat getPositionalPath (/myproject/node_modules/mongoose/lib/schema.js:380:22)\nat Schema.path (/myproject/node_modules/mongoose/lib/schema.js:199:9)\nat Query._getSchema (/myproject/node_modules/mongoose/lib/query.js:1789:27)\nat Query._walkUpdatePath (/myproject/node_modules/mongoose/lib/query.js:1721:16)\nat Query._walkUpdatePath (/myproject/node_modules/mongoose/lib/query.js:1716:25)\nat Query._castUpdate (/myproject/node_modules/mongoose/lib/query.js:1655:23)\nat castDoc (/myproject/node_modules/mongoose/lib/query.js:2160:18)\nat Query._findAndModify (/myproject/node_modules/mongoose/lib/query.js:2032:17)\nat Query.findOneAndUpdate (/myproject/node_modules/mongoose/lib/query.js:1941:15)\nat Function.Model.findOneAndUpdate (/myproject/node_modules/mongoose/lib/model.js:1127:16)\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/8874617/mongoose-positional-operator-errors\">Mongoose positional operator errors</a></p>\n"},{"tags":["javascript","node.js","filesystems"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":369,"score":1,"question_id":11194287,"title":"Convert a directory structure in the filesystem to JSON with Node.js","body":"<p>I have a file structure like this:</p>\n\n<pre><code>root\n|_ fruits\n|___ apple\n|______images\n|________ apple001.jpg\n|________ apple002.jpg\n|_ animals\n|___ cat\n|______images\n|________ cat001.jpg\n|________ cat002.jpg\n</code></pre>\n\n<p>I would like to, using Javascript and Node.js, listen to this root directory and all sub directories and create a JSON which mirrors this directory structure, each node contains type, name, path, and children:</p>\n\n<pre><code>data = [\n  {\n    type: \"folder\",\n    name: \"animals\",\n    path: \"/animals\",\n    children: [\n      {\n        type: \"folder\",\n        name: \"cat\",\n        path: \"/animals/cat\",\n        children: [\n          {\n            type: \"folder\",\n            name: \"images\",\n            path: \"/animals/cat/images\",\n            children: [\n              {\n                type: \"file\",\n                name: \"cat001.jpg\",\n                path: \"/animals/cat/images/cat001.jpg\"\n              }, {\n                type: \"file\",\n                name: \"cat001.jpg\",\n                path: \"/animals/cat/images/cat002.jpg\"\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n];\n</code></pre>\n\n<p>Here's a coffeescript JSON:</p>\n\n<pre><code>data = \n[\n  type: \"folder\"\n  name: \"animals\"\n  path: \"/animals\"\n  children  :\n    [\n      type: \"folder\"\n      name: \"cat\"\n      path: \"/animals/cat\"\n      children:\n        [\n          type: \"folder\"\n          name: \"images\"\n          path: \"/animals/cat/images\"\n          children: \n            [\n              type: \"file\"\n              name: \"cat001.jpg\"\n              path: \"/animals/cat/images/cat001.jpg\"\n            , \n              type: \"file\"\n              name: \"cat001.jpg\"\n              path: \"/animals/cat/images/cat002.jpg\"\n            ]\n        ]\n    ]\n]\n</code></pre>\n"},{"tags":["mysql","node.js","wamp","mamp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13085663,"title":"nodejs on mac error when connecting to mysql","body":"<p>This code works well on windows using nodejs and wamp but dont work on mac using mamp any idea why ? (the same username,password and db are used on both mac and pc !)</p>\n\n<p>Im receiving this error Error: connect ECONNREFUSED </p>\n\n<pre><code>var mysql = require('mysql');\nvar TEST_DATABASE = 'krekib';\nvar TEST_TABLE = 'users';\nvar client = mysql.createClient({\n  user: 'root',\n  password: '12345',\n});\n\n\nclient.query('USE '+TEST_DATABASE);\n\nclient.query(\n  'SELECT * FROM '+TEST_TABLE,\n  function selectCb(err, results, fields) {\n    if (err) {\n      throw err;\n    }\n\n    console.log(results);\n    console.log(fields);\n    client.end();\n  }\n);\n</code></pre>\n"},{"tags":["html","node.js","zip","request"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13066418,"title":"mikeal request bad formatted body","body":"<p>i'm using mikeal/request. I have a problems with some webpage when i use:</p>\n\n<pre><code>var url='http://www.youtube.com/watch?v=YbP1K-bQB6g&amp;list=SP018BE450221B431B';\nvar request = require('request');\nrequest(url, function (error, response, body) {      \n    console.log(body);      \n})\n</code></pre>\n\n<p>this print the body well-formatted in html. Sometimes with different urls it prints something like:</p>\n\n<pre><code>ÿÿ´Wmo7þ|ú¦{@ã »ZÉ9ŸãÄ2 ØªOl+¶Ü4W½K­èì’[’+K.úé~ ecc...\n</code></pre>\n\n<p>but when i navigate it trought the browser i can see the page clearly.\nAny suggestion? I already tried to decode it with StringDecoder but nothing... i'm using this url to get the error:</p>\n\n<pre><code>http://www.agi.it/estero/notizie/201210250805-est-rt10017-performance_stellari_e_10_ore_autonomia_e_gia_ipad_mini_mania\n</code></pre>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2681,"score":1,"question_id":2886191,"title":"How do i close a socket after a timeout in node.js?","body":"<p>I'm trying to close a socket after a connection times out after 1000ms. I am able to set a timeout that gets triggered after a 1000ms but I can't seem to destroy the socket... any ideas?</p>\n\n<pre><code>var connection = http.createClient(80, 'localhost');\nvar request = connection.request('GET', '/somefile.xml', {'host':'localhost'});\nvar start = new Date().getTime();\n\nrequest.socket.setTimeout(1000);\n\nrequest.socket.addListener(\"timeout\", function() {\n  request.socket.destroy();\n  sys.puts(\"socket timeout connection closed\");\n});\n\nrequest.addListener(\"response\", function(response) {\n  var responseBody = [];\n  response.setEncoding(\"utf8\");\n  response.addListener(\"data\", function(chunk) {\n    sys.puts(chunk);\n    responseBody.push(chunk);\n  });\n\n  response.addListener(\"end\", function() {\n\n  });\n});\n\nrequest.end();\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>socket timeout connection closed\nnode.js:29\n  if (!x) throw new Error(msg || \"assertion error\");\n                ^\nError: assertion error\n    at node.js:29:17\n    at Timer.callback (net:152:20)\n    at node.js:204:9\n</code></pre>\n"},{"tags":["node.js","callback"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13085155,"title":"NodeJS: process.nextTick vs Instant Callbacking","body":"<p>I write lots of modules which look like this:</p>\n\n<pre><code>function get(index, callback) {\n    if (cache[index] === null) {\n        request(index, callback); // Queries database to get data.\n    } else {\n        callback(cache[index]);\n    }\n}\n</code></pre>\n\n<p><em>Note: it's a bit simplified version of my actual code.</em></p>\n\n<p>That callback is either called in the same execution or some time later. This means users of the module aren't sure which code is run first.</p>\n\n<p>My observation is that such module reintroduces some problems of the multi-threading which was previously solved by JavaScript engine.</p>\n\n<p>Question: should I use <code>process.nextTick</code> or ensure it's safe for the callback to be called outside the module?</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13084614,"title":"insert some data after response on node.js","body":"<p>I wrote a website tracker for internal use, since Google Analytic don't meet the requirement. </p>\n\n<p>I use node.js with Express to develop that tracking system. Everything works well so far. But I want to confirm is, if there is some problem behind if I insert a log data after response a image.</p>\n\n<p>Thanks!</p>\n\n<pre><code>function image_response(req, res, next){\n    var buf = new Buffer([0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x01, 0x00, 0x01, 0x00, 0x80, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x02, 0x02, 0x44, 0x01, 0x00, 0x3b]);\n    res.send(200, buf);\n    next();\n}\n\napp.get('/tracker.gif', image_response, function(req, res){\n     // blah blah blah \n     // DB insert codes..\n}\n</code></pre>\n\n<p>Actually the \"image_response\" is completely end of the response and close the browser connection with client. Afterward, doing the logic to save the data to DB.</p>\n"},{"tags":["c++","windows","visual-studio","node.js","module"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13084165,"title":"Missing node.lib while building native modules","body":"<p>Just for evaluation, I wanted to write a C++ module for Node.js under Windows. I found <a href=\"http://joseoncode.com/2012/04/10/writing-your-first-native-module-for-node-dot-js-on-windows/\" rel=\"nofollow\">this useful post</a> which I wanted to reproduce.\nIt says that in order to build Node for Windows, I need to download the source code and just run the vcbuild.bat file. As far as I can see this worked\npretty well, but I could not create my project (the c++ module) under Visual Studio, because the node.lib file is missing. It should have been created while running\nthe vcbuild.bat but it didn't. Of course I included all the folders in the project as described in the tutorial.</p>\n\n<p>I tried several versions of the source code of node. Some create a release folder, some create a debug folder. But the node.lib is never included\nin any of these. Any idea what the problem is or what I may have missed? Help would be appreciated. Thanks in advance!</p>\n\n<p>/Erik</p>\n"},{"tags":["node.js","redis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13083472,"title":"How to sort an array in node.js based on time in milliseconds using Redis database","body":"<p>I'm trying to sort an array which contains Id and Time,based on time(milliseconds).</p>\n\n<pre><code>Map.sort(function(a,b){return a.Time-b.Time});\nfor (keys in Map) {\n    multi.hgetall(Map[key].id+':List');                     \n}\nmulti.exec(function(err,data){                       \n        res.send(data);\n});\n</code></pre>\n\n<p>Its not displaying any data.There are 3 Ids in that array. </p>\n"},{"tags":["database","node.js","variables"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13080771,"title":"node.js passing variables","body":"<p>I am looking for some direction here from some seasoned node.js programmers. The biggest issue I am running into is passing around variables into separate modules. For example in my server.js I have the following:</p>\n\n<pre><code>var db = mongoose.createConnection('localhost','test');\n</code></pre>\n\n<p>Now I am not running my routes inside of the server.js file they are separated into there own files. So for a blog example it might be like this:</p>\n\n<pre><code>app.get('/blog/post/:id',function(req,res){\n    //do something here\n}\n</code></pre>\n\n<p>Now this is where the problem comes in. I do not want to have to setup a database connection in each of my routes and not to mention I would think that it would make a ton of connections. How do I handle this, is there a sample \"REAL WORLD\" application out there because I cannot seem to find anything about this and I know people have had to have this problem before. I know that node caches the modules but I cant imagine that it would cache the connection given it was in its own module. I created a config module that just holds the site config so requiring this where I need it is not a problem. I imagine there are other things that I am gonna wanna do this with so it would be best to figure this out now.</p>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13082338,"title":"Set content length of request based on content in node","body":"<p>How to set the content length of the request based on the content?</p>\n\n<p>Ex. :\nPOST /Display HTTP/1.0\nContent-Type: application/json\nContent-Length: 125</p>\n\n<p>{\"QueryReq\":\n  {\n    \"Tid\": \"Tid-123456\",\n    \"SessionId\" : \"1350711351232058820\" \n  }\n}</p>\n\n<p>On posting this request in telnet I need to press enter many times till the content length is 125 that is empty chunks are received in the server. How can set the content length automatically based on the request content?</p>\n"},{"tags":["java","sql","perl","node.js","quickbooks"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":425,"score":3,"question_id":5722578,"title":"It it possible to grab SQL tables from a QuickBooks QBM file. Perhaps there is an SQLite Database in there?","body":"<p>It would simplify data import for our software if I could export the tables to SQL or CSV or other workable format. We often export from QuickBooks and import into our software and it would be simpler and faster if we could just get the customer's QBM file and then do the rest on our end. We have been exporting individual reports to CSV files, but that is a manual process which we would like to replace with a QBM to SQL tool (or CSV files or Tab Delimited files or other workable format).</p>\n"},{"tags":["node.js","stream","http-1.1"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2782,"score":4,"question_id":6068820,"title":"Node Js problems with response.write","body":"<p>When I try to utilize http stream connection for some reason write does not flush until I call\nresponse.end() \n<BR>\nI am taking the code straight from the demo and do not understand what my problem is.<BR>\nWhen I curl to the server my headers are correct.</p>\n\n<pre><code>HTTP/1.1 200 OK\nContent-Type: text/plain\nConnection: keep-alive\nTransfer-Encoding: chunked\n\n\nvar http = require('http');\n    http.createServer(function (req, res) {\n      res.writeHead(200, {'Content-Type': 'text/plain'});\n      res.write('hello');\n      res.write(':');\n      setTimeout(function(){ \n          res.end('World\\n'),\n          2000);\n    }).listen(1337, \"127.0.0.1\");\n    console.log('Server running at http://127.0.0.1:1337/');\n</code></pre>\n\n<p>Why is the server not sending the write data?</p>\n"},{"tags":["javascript","html5","node.js","canvas","webgl"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13082139,"title":"js Function queue","body":"<p>So essentially what I'm trying to do is have a queue of functions that I can add to. These functions are suppose to be drawing things to a canvas like in an requestAnimationFrame.</p>\n\n<p>What I've tried:</p>\n\n<pre><code>var drawQueue = [];\nfunction animate() {\n    while (drawQueue.length !== 0) {\n        drawQueue.shift()();\n    }\n    requestAnimationFrame(function () {\n        animate();\n    });\n}\n</code></pre>\n\n<p>With that I was trying to add things like:</p>\n\n<pre><code>drawQueue.push(drawthing(0,0,0,0));\n</code></pre>\n\n<p>this would just run the function and push undefined to the array, this does how work if you just do this:</p>\n\n<pre><code>drawQueue.push(function () {\n    console.log(\"derp\");\n});\n</code></pre>\n\n<p>or</p>\n\n<pre><code>drawQueue.push(functionName); //with no args\n</code></pre>\n\n<p>The but problem here is that I need to pass arguments to most of the functions I'm calling.</p>\n\n<p>my Second attempt:</p>\n\n<pre><code>var drawQueue = [];\nfunction animate() {\n    while (drawQueue.length !== 0) {\n        var data = drawQueue.shift();\n        Object.apply(data.func, data.args);\n    }   \n    requestAnimationFrame(function () {\n        animate();\n    }); \n}\n</code></pre>\n\n<p>while adding function to the queue like:</p>\n\n<pre><code>drawQueue.push({func: functionName, args: [0,0,0,0]});\n</code></pre>\n\n<p>but I couldn't get that to work either, not 100% how to use Object.apply() and what exactly its doing...</p>\n\n<p>So my question is how do I go about making my function queue or is there a better way to do this?</p>\n"},{"tags":["node.js","mongodb","find"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13076787,"title":"Node+MongoDB: find in collection","body":"<p>I just don't know why it's not working(( val.instruments is undefinded.</p>\n\n<pre><code>function getInstruments(callback) {\n    db.collection(\"settings\", function(error, settings) {\n        settings.find({ \"settings\" : \"settings\" }, function (err, val) {\n            console.log('from getInstruments ' + val.instruments);\n            if (val.instruments==undefined) {\n                callback(\"\");\n            } else {\n                callback(val.instruments);\n            }\n        });\n    });\n}\n</code></pre>\n\n<p>scheme:</p>\n\n<pre><code>{\n    \"_id\": {\n        \"$oid\": \"508677a3e5089a6df291631a\"\n    },\n    \"settings\": \"settings\",\n    \"instruments\": [\n        \"1\",\n        \"2\",\n        \"3\"\n    ]\n}\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>node app.js:\nfrom getInstruments undefined\n</code></pre>\n\n<p>Any suggestions? Thanks.</p>\n\n<p><strong>UPD</strong>: Modified code to:</p>\n\n<pre><code>function getInstruments(callback) {\ndb.collection(\"settings\", function(error, settings) {\n    settings.find({ \"settings\" : \"settings\" }).toArray(function(err, docs) {\n       console.dir(docs.instruments);\n    });\n});\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>[ { _id: 508677a3e5089a6df291631a,\nsettings: 'settings',\ninstruments: [ '1', '2', '3' ] } ]\n</code></pre>\n\n<p>Changed to:</p>\n\n<pre><code>function getInstruments(callback) {\n    db.collection(\"settings\", function(error, settings) {\n        settings.find({ \"settings\" : \"settings\" }).toArray(function(err, docs) {\n           console.dir(docs.instruments);\n        });\n    });\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>undefined\n</code></pre>\n\n<p>How it can be?</p>\n"},{"tags":["javascript","node.js","path","jsdom"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13079525,"title":"Node.js scraping, converting image src -> full URL","body":"<p>I'm using Cheerio (https://github.com/MatthewMueller/cheerio) to scrape websites and get images for a project I'm working on.  I'm wondering if there's an easy way with Node.js (or another package) to convert the $(img).attr('src') to a fully qualified URL?  Sometimes I'll get \"image.jpg\" and other times \"../../image.jpg\", and other times \"//somepath/image.jpg\".  Perhaps I'm just missing a regex of some sort...  Thanks for your time :) </p>\n"},{"tags":["node.js","express","railway.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":324,"score":0,"question_id":10032524,"title":"Where to define custom schema using RailwayJS","body":"<p>The docs simply say \"or define custom schema (non-juggling), for example, mongoose. Please note, in case of custom schema all jugglingdb features of course will be disabled.\"</p>\n\n<p>However..</p>\n\n<p>Where exactly should this schema be created?</p>\n"},{"tags":["node.js","console"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13052548,"title":"Node.js: How to attach to a running process and to debug the server with a console?","body":"<p>I use 'forever' to run my application. I want to attach to the running environment to inspect my application. So what can I do?  </p>\n"},{"tags":["node.js","microsoft","runtime-error","webmatrix","webmatrix-2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13079199,"title":"Error running node app in WebMatrix","body":"<p>I installed WebMatrix and followed <a href=\"http://www.iis.net/learn/install/installing-iis-7/installing-iis-on-windows-vista-and-windows-7\" rel=\"nofollow\">these</a> instructions to install IIS 7 on my Windows 7 machine.</p>\n\n<p>When I click 'Run' to run my express node app, the browser pops up and tells me</p>\n\n<blockquote>\n  <p>The iisnode module is unable to start the node.exe process. Make sure the node.exe executable is available at the location specified in the <a href=\"https://github.com/tjanczuk/iisnode/blob/master/src/samples/configuration/web.config\" rel=\"nofollow\">system.webServer/iisnode/@nodeProcessCommandLine</a> element of web.config. By default node.exe is expected to be installed in %ProgramFiles%\\nodejs folder on x86 systems and %ProgramFiles(x86)%\\nodejs folder on x64 systems.</p>\n</blockquote>\n\n<p>Here is my web.config:</p>\n\n<pre><code>&lt;configuration&gt;\n&lt;system.webServer&gt;\n\n&lt;handlers&gt;\n  &lt;!-- indicates that the app.js file is a node.js application to be handled by the iisnode module --&gt;\n  &lt;add name=\"iisnode\" path=\"app.js\" verb=\"*\" modules=\"iisnode\" /&gt;\n&lt;/handlers&gt;\n\n&lt;rewrite&gt;\n  &lt;rules&gt;\n    &lt;!-- Don't interfere with requests for logs --&gt;\n    &lt;rule name=\"LogFile\" patternSyntax=\"ECMAScript\" stopProcessing=\"true\"&gt;\n      &lt;match url=\"^[a-zA-Z0-9_\\-]+\\.js\\.logs\\/\\d+\\.txt$\" /&gt;\n    &lt;/rule&gt;\n\n    &lt;!-- Don't interfere with requests for node-inspector debugging --&gt;\n    &lt;rule name=\"NodeInspector\" patternSyntax=\"ECMAScript\" stopProcessing=\"true\"&gt;\n      &lt;match url=\"^app.js\\/debug[\\/]?\" /&gt;\n    &lt;/rule&gt;\n\n    &lt;!-- First we consider whether the incoming URL matches a physical file in the /public folder --&gt;\n    &lt;rule name=\"StaticContent\"&gt;\n      &lt;action type=\"Rewrite\" url=\"public{REQUEST_URI}\" /&gt;\n    &lt;/rule&gt;\n\n    &lt;!-- All other URLs are mapped to the Node.js application entry point --&gt;\n    &lt;rule name=\"DynamicContent\"&gt;\n      &lt;conditions&gt;\n        &lt;add input=\"{REQUEST_FILENAME}\" matchType=\"IsFile\" negate=\"True\" /&gt;\n      &lt;/conditions&gt;\n      &lt;action type=\"Rewrite\" url=\"app.js\" /&gt;\n    &lt;/rule&gt;\n  &lt;/rules&gt;\n&lt;/rewrite&gt;\n\n&lt;!-- You can control how Node is hosted within IIS using the following options --&gt;\n&lt;!--&lt;iisnode      \n      node_env=\"%node_env%\"\n      nodeProcessCountPerApplication=\"1\"\n      maxConcurrentRequestsPerProcess=\"1024\"\n      maxNamedPipeConnectionRetry=\"3\"\n      namedPipeConnectionRetryDelay=\"2000\"      \n      maxNamedPipeConnectionPoolSize=\"512\"\n      maxNamedPipePooledConnectionAge=\"30000\"\n      asyncCompletionThreadCount=\"0\"\n      initialRequestBufferSize=\"4096\"\n      maxRequestBufferSize=\"65536\"\n      watchedFiles=\"*.js\"\n      uncFileChangesPollingInterval=\"5000\"      \n      gracefulShutdownTimeout=\"60000\"\n      loggingEnabled=\"true\"\n      logDirectoryNameSuffix=\"logs\"\n      debuggingEnabled=\"true\"\n      debuggerPortRange=\"5058-6058\"\n      debuggerPathSegment=\"debug\"\n      maxLogFileSizeInKB=\"128\"\n      appendToExistingLog=\"false\"\n      logFileFlushInterval=\"5000\"\n      devErrorsEnabled=\"true\"\n      flushResponse=\"false\"      \n      enableXFF=\"false\"\n      promoteServerVars=\"\"\n     /&gt;--&gt;\n\n  &lt;iisnode     \n    nodeProcessCommandLine=\"&amp;quot;%programfiles%\\nodejs\\node.exe&amp;quot;\"\n    interceptor=\"&amp;quot;%programfiles%\\iisnode\\interceptor.js&amp;quot;\" \n  /&gt;\n&lt;/system.webServer&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>What is causing this problem, and how do I fix it?</strong></p>\n"},{"tags":["node.js","video","ffmpeg","thumbnails"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13079742,"title":"how to generate video thumbnail in node.js?","body":"<p>am building a app with node.js, i successfully uploaded the video but i need to generate a video thumbnail for it, currently i use node exec to excute a system command of ffmpeg to make the thumbnail</p>\n\n<pre><code>   exec(\"C:/ffmpeg/bin/ffmpeg -i Video/\" + Name  + \" -ss 00:01:00.00 -r 1 -an -vframes 1 -f mjpeg Video/\" + Name  + \".jpg\")\n</code></pre>\n\n<p>this code is coming from a tutorial from <a href=\"http://net.tutsplus.com/tutorials/javascript-ajax/how-to-create-a-resumable-video-uploade-in-node-js/\" rel=\"nofollow\">http://net.tutsplus.com/tutorials/javascript-ajax/how-to-create-a-resumable-video-uploade-in-node-js/</a></p>\n\n<p>the code above did generate a jpg file but its not a thumbnail but a video screen shot, i wonder is there any other method to generate video thumbnail,or how to exec the ffmpeg command to make a real thumbanil (resized),and i prefer png file, please help!!!</p>\n"},{"tags":["node.js","webserver"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":11890827,"title":"Host multiple site with node.js","body":"<p>I'm currently learning node.js and loving it. I noticing, however, that it seems that's it's really only fit for one site. So it's great for hosting mydomain.com, but what if I want to build an actual full web server with it. In other words, I would like to host mydomain.com, example.com, yourdomain.com and so on. What solutions (modules) are available for this? I was thinking of simply parsing the url from the request object and simply reading from the appropriate directory. For example if I get a request for example.com then read from the example_com directory or if I get a request from mydomain.com read from the mydomain_com directory. The issue here is I don't know how this will affect performance and scalability. </p>\n\n<p>I've looked into <a href=\"https://github.com/kriszyp/multi-node\" rel=\"nofollow\">Multi-node</a> but I don't fully follow the idea of processes yet (I'm a node beginner). </p>\n\n<p>Any suggestions are welcome.</p>\n"},{"tags":["javascript","mongodb","node.js","mongoose"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":1167,"score":3,"question_id":5929486,"title":"Unique index not working with Mongoose / MongoDB","body":"<p>I've got a problem with creating unique indexes using Mongoose / MongoDb and can't get it to work. I'm able to add two documents with the same attribute values when I have set a unique index.</p>\n\n<p>I've tried everything I can think of - restarting (everything) changing the syntax etc.</p>\n\n<h3>Code</h3>\n\nAddtion >>\n\n<p>This is the method that I'm using to save an entity:</p>\n\n<pre><code>  create  : function(entity, definition, successFn, errorFn){\n\n    var model = mongoose.model(entity);\n    newModel = new model(definition);\n\n    newModel.save(function(error) {\n      if(error){\n        if(!errorFn){\n          throw error;\n        }\n        errorFn(newModel);\n        return;\n      }\n\n      successFn(newModel);\n    });\n  }...\n</code></pre>\n\n<p>&lt;&lt;</p>\n\n<pre><code>var Something = new Schema({\n  objectId          : ObjectId,\n  name              : { type : String, index: { unique: true }}, \n  url               : { type : String, index: { unique: true }},\n...etc\nmongoose.model('Something', Something);\n</code></pre>\n\n<h3>Mongo output</h3>\n\n<pre><code> [conn1] insert xxxxx.agencies 1526ms\n [conn1] building new index on { name: 1 } for xxxxx.agencies\n [conn1] insert xxxxx.system.indexes exception 11000 E11000 duplicate key error    index: xxxxx.agencies.$name_1  dup key: { : \"something\" } 4ms\n [conn1] building new index on { url: 1 } for xxxxx.agencies\n [conn1] insert xxxxx.system.indexes exception 11000 E11000 duplicate key error index: xxxxx.agencies.$url_1  dup key: { : \"http://www.something.com\" } 1ms\n</code></pre>\n\n<p>When I checked in MongoHub the indexes don't appear, so they don't look like they have been created.</p>\n\n<p>This is a duplicate of <a href=\"http://stackoverflow.com/questions/5535610/mongoose-unique-index-not-working\">this question</a>, but it doesn't have an answer that works for me.</p>\n"},{"tags":["linux","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13051961,"title":"Proper way to reference files relative to application root in Node.JS","body":"<p>I have a Node.JS application running on Linux at AWS EC2 that uses the fs module to read in HTML template files.   Here is the current structure of the application:</p>\n\n<pre><code>/server.js\n/templates/my-template.html\n/services/template-reading-service.js\n</code></pre>\n\n<p>The HTML templates will always be in that location, however, the template-reading-service may move around to different locations (deeper subdirectories, etc.)  From within the template-reading-service I use fs.readFileSync() to load the file, like so:</p>\n\n<pre><code>var templateContent = fs.readFileSync('./templates/my-template.html', 'utf8');\n</code></pre>\n\n<p>This throws the following error:</p>\n\n<pre><code>Error: ENOENT, no such file or directory './templates/my-template.html'\n</code></pre>\n\n<p>I'm assuming that is because the path './' is resolving to the '/services/' directory and not the application root.  I've also tried changing the path to '../templates/my-template.html' and that worked, but it seems brittle because I imagine that is just resolving relative to 'up one directory'.  If I move the template-reading-service to a deeper subdirectory, that path will break.</p>\n\n<p>So, what is the proper way to reference files relative to the root of the application?</p>\n"},{"tags":["node.js","telnet"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12736564,"title":"Quitting client on localhost, without disconnecting a TCP connection to server on localhost (without FIN packet)","body":"<h1>Original Question</h1>\n\n<p>I am connecting to a node.js TCP server (on localhost) with telnet and I am trying to explore keep-alive probes.</p>\n\n<p>As a first test, I would like to connect to the server with telnet and kill the telnet session in a way that does not send a FIN packet. (Letting the server think the TCP socket is still 'healthy'.) Unfortunately I can't seem to find a clever way of testing this.</p>\n\n<ul>\n<li>When I quit telnet from the telnet prompt, the socket's <code>end</code> event fires in node. It clearly got a FIN packet.</li>\n<li>When I <code>kill</code> telnet's process, it also cleanly quits the connection with a FIN packet, before the process dies.</li>\n</ul>\n\n<p>Do you know of a way to quit telnet without sending a FIN packet (preferably not involving a network cable that's disconnected / producing a physical networking fault.)</p>\n\n<h1>Improved question</h1>\n\n<p>I want to simulate a network fault using just localhost / loopback (without actually disconnecting any interfaces / network cables). I want to open a TCP connection between a client and a server, both on localhost. Then I want the client to \"die\" without letting the server know that it's gone. (I.e. without sending a FIN packet.) This could happen in a real network, if a router goes down, for example.</p>\n\n<p>Thanks to the comments below, I've learned that the kernel will collect any open ports/sockets owned by a process when the process dies (or is forcefully killed), like my <code>telnet</code> above, and will close them for the process by sending a FIN packet. So I need to trick the kernel into not closing an existing connection.</p>\n\n<p>So how can I create a client process, keep it alive, but let it behave like a completely dead TCP connection?</p>\n\n<h2>Spoilers</h2>\n\n<ul>\n<li>(Answer 1 below: Use a raw socket (scapy), let it ignore any packets sent by the server after the initial connection &amp; some test data. (After a certain time, for example.))</li>\n<li>(Answer 2, Idea from colleague: configure <code>iptables</code> to cut off traffic between client and server. Actual <code>iptables</code> rule in comment below.)</li>\n</ul>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13078074,"title":"Nodejs: iterate over req.files properties","body":"<p>I'm quite new to nodejs and sometimes I come across  difficulties :)\nSo for example. I'm sending an image file via AJAX and recieve it successfully in my app.</p>\n\n<p>console.log(req.files) prints:</p>\n\n<pre><code>{\n    img_1351078491675: {\n        size: 354683,\n        path: '/tmp/f29009b6dc914c2ab27e2c5fde13e7d8.jpg',\n        name: 'nov10wallpaper-1_1600.jpg',\n        type: 'image/jpeg',\n        hash: false,\n        lastModifiedDate: Wed Oct 24 2012 13: 36: 55 GMT + 0200(CEST),\n        _writeStream: {\n            path: '/tmp/f29009b6dc914c2ab27e2c5fde13e7d8.jpg',\n            fd: 14,\n            writable: false,\n            flags: 'w',\n            encoding: 'binary',\n            mode: 438,\n            bytesWritten: 354683,\n            busy: false,\n            _queue: [],\n            _open: [Function],\n            drainable: true\n        },\n        length: [Getter],\n        filename: [Getter],\n        mime: [Getter]\n    }\n}\n</code></pre>\n\n<p>Because the image has a timestamp I cannot access with req.files.img_. So I was using for(file in reg.files) to get it (forEach didn't work - no idea why. seems to be a normal hash/object).\nBut now my problems actually start. How can I read out the attributes of that file? E.g. file.path doesn't work. It returns \"undefined\" but why?</p>\n\n<p>Could someone please give me a hint to understand such basics?</p>\n"},{"tags":["node.js","phantomjs","processbuilder","casperjs","apache-commons-exec"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13078156,"title":"Java processbuilder to run casperjs (threading concerns)","body":"<p>We are scraping a bank website that sets cookies and does SSO with some other third party web sites. I created a CasperJS (PhantomJS) based script which does the job effectively. Now we want to integrate this with our web app. Since PhantomJS runs as an executable process so I am wondering if there are any threading concerns I need to keep in mind if I spawn phantomjs process from every thread. I'll use either apache commons exec or jdk 1.5 processbuilder to do inter process communication.</p>\n"},{"tags":["performance","node.js","openssl","spawn"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13077869,"title":"What are the drawbacks of using child_process.spawn vs. native bindings in NodeJS","body":"<p>I'm currently working on a NodeJS SCEP server. It heavily uses the <code>openssl</code> executable to work.</p>\n\n<p>Basically, I'm using <code>child_process.spawn</code> to wrap openssl functionality.</p>\n\n<p>I'm probably sure it would be better to use native bindings to the openssl lib, but since it is not available (<code>crypto</code> does not have all the smime.verify smime.decrypt req.verify stuff), I had to find an easy way to make it work, but I'm not sure it is a viable solution.</p>\n\n<p>To me the first drawback is the unstable API, I do rely on a cli output that can change between servers, etc. But what about performance?</p>\n"},{"tags":["http","node.js","request","load-testing"],"answer_count":3,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":2638,"score":2,"question_id":6209042,"title":"Node.js Http.request slows down under load testing. Am I doing something wrong?","body":"<p>Here is my sample code:</p>\n\n<pre><code>var http = require('http');\n\nvar options1 = {\n          host: 'www.google.com',\n          port: 80,\n          path: '/',\n          method: 'GET'\n        };\n\nhttp.createServer(function (req, res) {\n\n        var start = new Date();\n        var myCounter = req.query['myCounter'] || 0;\n\n        var isSent = false;\n        http.request(options1, function(response) {\n            response.setEncoding('utf8');\n            response.on('data', function (chunk) {\n                var end = new Date();\n                console.log(myCounter + ' BODY: ' + chunk  + \" time: \" + (end-start) + \" Request start time: \" + start.getTime());\n\n                if (! isSent) {\n                    isSent = true;\n                    res.writeHead(200, {'Content-Type': 'application/xml'});\n                    res.end(chunk);\n                }\n            });\n        }).end();\n\n\n}).listen(3013);\n\nconsole.log('Server running at port 3013');\n</code></pre>\n\n<p>What i found out is that, if I connect to other server, (google or any other), the response will get slower and slower to few seconds.   It doesn't happen if I connect to another node.js server within the same network.  </p>\n\n<p>I use JMeter to test.  50 concurrent per sec with 1000 loop.</p>\n\n<p>I have no idea what the problem is...</p>\n\n<p>=========================</p>\n\n<p>Further investigation:</p>\n\n<p>I run the same script on Rackspace, and also on EC2 for testing.   And the script will use http.request to connect to: Google, Facebook, and also my another script that simply output data (like hello world) which is hosted by another EC2 instance. </p>\n\n<p>The test tool I just is jMeter on my desktop.</p>\n\n<p>Pre-node.js test:\n  jMeter -> Google    Result:  fast and consistent. \n  jMeter -> Facebook   result: fast and consistent.\n  jMeter -> My Simple Output Script     Result:  fast and consistent.</p>\n\n<p>Then I make a 50 Concurrent Threads /sec , with 100 loops, testing to my Rackspace nodejs, and then EC2 node.js which has the same king of performance issue \n  jMeter -> node.js -> Google    Result:  from 50 ms  goes to 2000 ms in 200 requsets.<br>\n  jMeter -> node.js -> Facebook Result:  from 200 ms goes  to 3000 ms after 200 requsets.<br>\n  jMeter -> node.js -> My Simple Output Script   Result:  from 100 ms goes  to 1000 ms after 200 requsets.<br>\n  The first 10-20 requests are fast, then start slowing down.  </p>\n\n<p>Then, when I change to 10 Concurrent Threads, things start changing..   The response is very consistent, no slow down.</p>\n\n<p>Something to do with # of concurrent threads that Node.js (http.request) can handle.  </p>\n\n<p>------------ <strong>More</strong> --------------</p>\n\n<p>I did more test today and here it is: \nI used http.Agent and increase the max socket.  However, the interesting this is that, on one testing server (EC2), it improves a lot and no more slow down.  HOwever, the other server (rackspace) only improves a bit.  It still shows slow down.  I even set \"Connection: close\" in the request header, it only improves 100ms. </p>\n\n<p>if http.request is using connection pooling, how to increase it?</p>\n\n<p>in both server, if I do \"ulimit -a\", the # of file open is 1024. </p>\n\n<p>------------- ** <strong>MORE AND MORE</strong> ** -------------------</p>\n\n<p>It seems that even I set maxSockets to higher number, it only works at some limit.  There seems to be a internal or OS dependent socket limitation.  However to bump it up? </p>\n\n<p>------------- ** AFTER EXTENSIVE TESTING ** ---------------</p>\n\n<p>After reading lots of post, I find out:</p>\n\n<hr>\n\n<hr>\n\n<p>quoted from: <a href=\"https://github.com/joyent/node/issues/877\" rel=\"nofollow\">https://github.com/joyent/node/issues/877</a></p>\n\n<hr>\n\n<p>1) If I set the headers with connection = 'keep-alive', the performance is good and can go up to maxSocket = 1024 (which is my linux setting).  </p>\n\n<pre><code>var options1 = {\n                  host: 'www.google.com',\n                  port: 80,\n                  path: '/',\n                  method: 'GET',\n    **headers: {\n            'Connection':'keep-alive'\n    }**\n                };\n</code></pre>\n\n<p>If I set it to \"Connection\":\"close\", the response time would be 100 times slower. </p>\n\n<p>Funny things happened here:</p>\n\n<p>1) in EC2, when I first test with Connection:keep-alive, it will take about 20-30 ms.  Then if I change to Connection:Close  OR set Agent:false, the response time will slow down to 300 ms. WIHTOUT restarting the server, if I change to Connection:keep-alive again, the response time will slow down even further to 4000ms.   Either I have to restart server or wait for a while to get back my 20-30ms lighting speed response.</p>\n\n<p>2) If I run it with agent:false, at first, the response time will slow down to 300ms.  But then, it will get faster again and back to \"normal\".   </p>\n\n<p>My guess is connection pooling still in effect even you set agent:false.   However, if you keep connection:keep-alive, then it will be fast for sure.  just don't switch it.</p>\n\n<hr>\n\n<hr>\n\n<hr>\n\n<p>Update on July 25, 2011</p>\n\n<p>I tried the latest node.js V0.4.9 with the http.js &amp; https.js fix from <a href=\"https://github.com/mikeal/node/tree/http2\" rel=\"nofollow\">https://github.com/mikeal/node/tree/http2</a>  </p>\n\n<p>the performance is much better and stable.</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":943,"score":5,"question_id":10808805,"title":"Accessing WebCam with NodeJS","body":"<p>Does anyone have any experience with trying to access a webcam through node? I can't seem to find any prior attempts at this.</p>\n\n<p>To expand a bit - I have a nodeJS server running, and I want to be able to access the webcam on the same box Node is running (so really, I'm using node more as a client implementation). Some things I wanted to do - get an image from the webcam, or, it'd be awesome if I could get a stream to the webcam that I pipe to another server and stream to other clients ;)</p>\n\n<p>Does anyone know how this can be done?</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","windows-7","64bit"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13076825,"title":"Rollback on node.js install on Windows 7 x64 PC","body":"<p>I've been trying to get node.js installed on my home PC for a while now with no luck. I've tried different versions for the past couple months and no matter what I try it starts rolling back the install at \"Creating shortcuts\" and it fails to install. I created an install log for anyone who wants to look at it and take a stab at helping me solve the problem. Thanks!</p>\n\n<p><a href=\"https://dl.dropbox.com/u/177486/MSIf99e3.LOG\" rel=\"nofollow\">https://dl.dropbox.com/u/177486/MSIf99e3.LOG</a></p>\n"},{"tags":["apache","node.js","socket.io","reverse-proxy"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":131,"score":2,"question_id":12424707,"title":"Socket.io with apache","body":"<p>I dont have much experience neither in Node.js not in socket.io, thus maybe I will ask silly questions and sorry for that first of all.</p>\n\n<p>I am trying to do following:</p>\n\n<ol>\n<li>Installed node on ubuntu where I have apache also installed.</li>\n<li><p>Created virtual host in apache and set it as proxy to node. My conf file looks like:</p>\n\n<pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin giorgi@omedia.ge\n    ServerName node.aidemo.info\n    ServerAlias www.node.aidemo.info\n\n    ProxyRequests off\n    &lt;Proxy *&gt;\n       Order deny,allow\n       Allow from all\n    &lt;/Proxy&gt;\n\n    &lt;Location /&gt;\n       ProxyPass http://127.0.0.1:8080\n       ProxyPassReverse http://127.0.0.1:8080\n    &lt;/Location&gt;\n\n&lt;/VirtualHost&gt;\n</code></pre></li>\n<li><p>Have created simple js file for server (first server example in socket.io website) and started server from cli with command: node server.js.\nIt starts perfectly and listens to 8080</p></li>\n<li><p>Created another virtualhost where I put clientside index.html (also from first example in socket.io). At first I had problem (and actually main problem is this), browser couldn't resolve path /socket.io/socket.io.js. Then I went to the url (http://localhost:8080/socket.io/socket.io.js) from lynx locally from terminal, downloaded that js and put locally with virtualhost near index.html. After this, browser could resolve that request, but I have error when socket.io.js itself is trying to get the url:     </p>\n\n<pre><code>http://localhost:8080/socket.io/1/?t=1347623348836\n</code></pre></li>\n</ol>\n\n<p>Do you have any ideas how can I solve this problem?\nMy main goal is to have web url from which I can access my node server and talk with it with socket.io - for example to create very simple chat.</p>\n\n<p>I hope I was clear.\nThank you everyone who will try to help.</p>\n"},{"tags":["node.js","websocket","express","socket.io"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":386,"score":0,"question_id":11635845,"title":"Serving the socket.io javascript file to a client via node.js/express","body":"<p>I'm trying to get a sample client connection working with socket.io and express (specifically, this one: <a href=\"http://www.catonmat.net/blog/nodejs-modules-socketio/\" rel=\"nofollow\">http://www.catonmat.net/blog/nodejs-modules-socketio/</a> with some pieces from the other examples at <a href=\"https://github.com/LearnBoost/socket.io/blob/master/examples/chat/app.js\" rel=\"nofollow\">https://github.com/LearnBoost/socket.io/blob/master/examples/chat/app.js</a>). </p>\n\n<p>I've gotten most of the pieces set up and working - the server runs, and I can hit / to get the index.jade file to the browser. However, once that happens, it does nothing. </p>\n\n<p>Server:</p>\n\n<pre><code>var io = require('socket.io');\nvar express = require('express')\n, stylus = require('stylus')\n, nib = require('nib');\n\nvar app = express.createServer()\nvar io = io.listen(app);\n\napp.configure(function () {\n  app.use(stylus.middleware({ src: __dirname + '/public', compile: compile }));\n  app.use(express.static(__dirname + '/public'));\n  app.set('views', __dirname);\n  app.set('view engine', 'jade');\n\n  function compile (str, path) {\n    return stylus(str)\n      .set('filename', path)\n      .use(nib());\n  };\n});\n\napp.get('/', function (req, res) {\n  res.render('index', { layout: false });\n});\n\n\napp.listen(8080);\n\nio.sockets.on('connection', function (socket) {\n  console.log('A socket connected!');\n  socket.emit('news', { hello: 'world' });\n  socket.on('my other event', function (data) {\n    console.log(data);\n  });\n  socket.on('disconnect', function () {\n    console.log('user disconnected');\n  });\n});\n</code></pre>\n\n<p>index.jade:</p>\n\n<pre><code>doctype 5\nhtml\n  head\n    link(href='/stylesheets/style.css', rel='stylesheet')\n    script(src='http://code.jquery.com/jquery-1.6.1.min.js')\n    script(src='/socket.io/socket.io.js')\n    script\n      // socket.io specific code\n      var socket = io.connect('http://localhost:8080');\n      socket.on('connect', function () {\n        alert('connected');\n      });\n      socket.on('news', function (data) {\n          console.log(data);\n          socket.emit('my other event', { my: 'data' });\n        });\n  body\n    #chat\n</code></pre>\n\n<p>It appears that the server isn't serving /socket.io/socket.io.js (http://localhost:8080/socket.io/socket.io.js yields an error). What do I need to do to get express to serve that file? I can't find that in any of the examples.</p>\n\n<p>Is there anything else I'm doing wrong here?</p>\n"},{"tags":["node.js","middleware"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13069591,"title":"nodejs middleware delaying requests","body":"<p>I'm writing a middleware which will perform a sequence of actions. After the sequence is done, I want the middleware to call next(). from this point on the middleware is redundant.\nI've written the following code: (here the sequence of actions is mocked by a call to setTimeout):</p>\n\n<pre><code>function myMiddleware(req, res, next){\n\n   console.info(\"inside myMiddleware\");\n\n   if (actionDone) {\n       console.info(\"middleware redundant. ActionDone, calling next\");\n       next();\n   }\n\n   setTimeout(doneWaiting, 30000);\n\n   function doneWaiting(){\n      actionDone = true;\n      next();\n   }\n}\n</code></pre>\n\n<p>This code will not work because if more than one request arrives before the action is done, setTimeout will be called again and again. I want setTimeout to be called only once, and only when it's done I want to call next() on all the requests which arrived so far.</p>\n\n<p>What is the best way to achieve this?</p>\n\n<p>Thanks,\nLi</p>\n"},{"tags":["javascript","http","node.js"],"answer_count":1,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1900,"score":6,"question_id":4966655,"title":"Node.js as a forwarding proxy but changing the URL path?","body":"<p>How do i let node.js act as a proxy and forward all requests sent from one server to another server but stripping /couchdb/ from the url path so that for example POST /couchdb/mydatabase will be POST /mydatabase. And when it receives the response it should send it to the first server.</p>\n\n<p>All I have done is this (using express) to get all requests where the URL path starts with /couchdb/</p>\n\n<pre><code>app.all(/^\\/couchdb\\/(?:.)*/, function(req, res) {\n\n});\n</code></pre>\n\n<p>Could someone guide me through. Thanks</p>\n"},{"tags":["node.js","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":1753,"score":6,"question_id":9268259,"title":"How do you install \"development only\" NPM modules for Node.js (package.json)?","body":"<p>I have this in my package.json file (shortened version):</p>\n\n<pre><code>{\n  \"name\": \"a-module\",\n  \"version\": \"0.0.1\",\n  \"dependencies\": {\n    \"coffee-script\":      \"&gt;= 1.1.3\"\n  },\n  \"devDependencies\": {\n    \"stylus\":             \"&gt;= 0.17.0\"\n  }\n}\n</code></pre>\n\n<p>I am using NPM version 1.1.1 on Mac 10.6.8.</p>\n\n<p>When I run the following command from the project root, it installs both the <code>dependencies</code> <em>and</em> <code>devDependencies</code>:</p>\n\n<pre><code>npm install\n</code></pre>\n\n<p>I was under the impression that this command installed the <code>devDependencies</code>:</p>\n\n<pre><code>npm install --dev\n</code></pre>\n\n<p>How do I make it so <code>npm install</code> only installs <code>dependencies</code> (so production environment only gets those modules), while something like <code>npm install --dev</code> installs both <code>dependencies</code> and <code>devDependencies</code>?</p>\n"},{"tags":["node.js","amazon-ec2","node-mysql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13076015,"title":"Node-Mysql running on Amazon - Unknown column 'map' in 'field list' - mysql/lib/protocol/sequences/Sequence.js:32:14","body":"<p>I am developing using node-mysql module and it work fine on my computer but on Amazon's EC2 it simply go nuts.</p>\n\n<p>Im using the last update, installed via</p>\n\n<pre><code>npm install mysql@2.0.0-alpha3\n</code></pre>\n\n<p>If you want to checkout the source code:\n<a href=\"https://github.com/melanke/SkillHunter/blob/master/server/dao/PlayerDao.js\" rel=\"nofollow\">https://github.com/melanke/SkillHunter/blob/master/server/dao/PlayerDao.js</a></p>\n\n<p>And the Stacktrace:</p>\n\n<pre><code>/home/ec2-user/node_server/SkillHunter/server/node_modules/trycatch/lib/trycatch.js:51\n        if (!origin) throw err\n                     ^\nError: ER_BAD_FIELD_ERROR: Unknown column 'map' in 'field list'\n    at Query._packetToError (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/sequences/Sequence.js:32:14)\n    at Query.ErrorPacket (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/sequences/Query.js:77:18)\n    at Protocol._parsePacket (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/Protocol.js:156:23)\n    at Parser._onPacket (native)\n    at Parser.write (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/Parser.js:60:12)\n    at Protocol.write (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/Protocol.js:31:16)\n    at Socket.ondata (stream.js:38:26)\n    at Socket._TOKEN_ (/home/ec2-user/node_server/SkillHunter/server/node_modules/trycatch/lib/trycatch.js:22:16)\n    at Socket.emit (events.js:67:17)\n    at TCP.onread (net.js:367:14)\n    --------------------\n    at Query.Sequence (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/sequences/Sequence.js:15:21)\n    at new Query (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/sequences/Query.js:11:12)\n    at Protocol.query (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/protocol/Protocol.js:40:24)\n    at Connection.query (/home/ec2-user/node_server/SkillHunter/server/node_modules/mysql/lib/Connection.js:89:25)\n    at Object.selectByUsername (/home/ec2-user/node_server/SkillHunter/server/dao/PlayerDao.js:24:16)\n    at Object.getPlayerEnvironment (/home/ec2-user/node_server/SkillHunter/server/process/PlayerServices.js:50:14)\n    at /home/ec2-user/node_server/SkillHunter/server/Main.js:29:14\n    at callbacks (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/router/index.js:162:11)\n    at param (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/router/index.js:136:11)\n    at pass (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/router/index.js:143:5)\n    at Router._dispatch (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/router/index.js:170:4)\n    at Object.router [as handle] (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/router/index.js:33:10)\n    at next (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at multipart (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/multipart.js:62:61)\n    at /home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:57:9\n    at urlencoded (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/urlencoded.js:52:72)\n    at /home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:55:7\n    at json (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/json.js:56:55)\n    at Object.bodyParser [as handle] (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/bodyParser.js:53:5)\n    at next (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at Object.methodOverride [as handle] (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/methodOverride.js:37:5)\n    at next (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at Object.expressInit [as handle] (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/lib/middleware.js:31:5)\n    at next (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at Object.query [as handle] (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/middleware/query.js:44:5)\n    at next (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:190:15)\n    at Function.handle (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/proto.js:198:3)\n    at Server.app (/home/ec2-user/node_server/SkillHunter/server/node_modules/express/node_modules/connect/lib/connect.js:66:31)\n    at Server._TOKEN_ (/home/ec2-user/node_server/SkillHunter/server/node_modules/trycatch/lib/trycatch.js:22:16)\n    at Server.emit (events.js:70:17)\n    at HTTPParser.onIncoming (http.js:1610:12)\n    at HTTPParser.parserOnHeadersComplete [as onHeadersComplete] (http.js:91:29)\n    at Socket.ondata (http.js:1506:22)\n    at TCP.onread (net.js:374:27)\n</code></pre>\n"},{"tags":["javascript","node.js","testing","continuous-integration","ncrunch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13066026,"title":"Concurrent/Continuous Testing for nodejs (ncrunch for nodejs)","body":"<p>I'm a big fan of the continuous testing setup offered by <a href=\"http://www.ncrunch.net\" rel=\"nofollow\">NCrunch</a> in Visual Studio, and would love to have a similar setup with nodejs.</p>\n\n<p>When writing JavaScript in node I use Sublime Text 2 as my editor, with tests written using Mocha.</p>\n\n<p>I wondered if there was software (or a ST2 plugin) for achieving similar concurrent testing to that offered by NCrunch when writing .NET code?</p>\n"},{"tags":["javascript","node.js","express","viewengine","underscore.js"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1909,"score":4,"question_id":6825325,"title":"Example of Node.js Express registering Underscore.js as view engine?","body":"<p>Underscore.js does not have a compile function like ejs and jade, but does work as a Node.js module. Would someone please provide an example of how to make it work inside an Express app?</p>\n"},{"tags":["php","node.js","winston"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":187,"score":0,"question_id":10233672,"title":"How to rotate Winston logs from separate script?","body":"<p>we are using node.js and winston to right out log files. we have a custom log rotation script written in PHP that we would like to use on those log files. but the script just moves the file which doesn't work in this case since winston has an open stream on that file. </p>\n\n<p>how can i move a winston log file using PHP so winston knows to create a new log file once i move it?</p>\n"},{"tags":["node.js","file-download","export-to-csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13070194,"title":"Prompt a csv file to download as pop up using node.js and node-csv-parser (node module)","body":"<p>Recently I have started working with node.js. While going through a requirement in one of my projects I am facing an issue where I should be able to write some data to a csv file dynamically and let it prompt as a popup to download for user (with save and cancel options - as we normally see). After googling for some time I decided to use csv npm module <a href=\"https://github.com/wdavidw/node-csv-parser\" rel=\"nofollow\">https://github.com/wdavidw/node-csv-parser</a>. I am able to write data into a file and save it using this module. I want to prompt a popup for saving this file with/without saving the file.</p>\n\n<p>my code looks something like this: </p>\n\n<pre><code>    // Sample Data \n    var data = [[\"id\", \"subject1\", \"subject2\", \"subject3\"], [\"jack\", 85, 90, 68], [\"sam\", 77, 89, 69]]\n\n    // Server Side Code    \n    var csv = require('../../node_modules/csv');            \n    var fs = require('fs');\n\n    createCSV = function(data, callback) {\n        csv().from(data).to(fs.createWriteStream('D:/test.csv')) // writing to a file           \n    }\n\n    // Client side call sample\n    $(\"#exportToCSV\").click(function() {\n        callToServer.createCSV(data);\n       return false;\n    });\n</code></pre>\n\n<p>This is working good as far as writing the csv file is concerned. </p>\n\n<ul>\n<li>I want to prompt this file immediately to download for users.</li>\n<li>If this can be done without saving the file, that will be great.</li>\n<li>How can I set content-type and content-disposition as we do in PHP</li>\n</ul>\n\n<p>Any help is greatly appreciated.\n-Thanks</p>\n"},{"tags":["node.js","logging","express","connect","winston"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12736430,"title":"nodejs / winston logging -- I want several log files, one with all requests, one with only POST's, another GET's (details inside)","body":"<p>The code below logs all requests to two files, one of which is JSON formatted.  This has the side effect of logging each request to the console twice.  Why is that?  I am sure I'm using Winston incorrectly, any feedback would be appreciated.</p>\n\n<pre><code>var winston = require('winston');\n\n\nwinston.loggers.add('main_nojson', {\n    file: {\n        filename: '/home/stu/logs/winston_txt.log',\n        json: false\n    }\n});\n\nwinston.loggers.add('main_json', {\n    file: {\n        filename: '/home/stu/logs/winston_json.log',\n        json: true\n    }\n});\n\nvar winlog1 = winston.loggers.get('main_nojson');\nvar winlog2 = winston.loggers.get('main_json');\n\nvar winstonStream = {\n    write: function(message, encoding){\n        winlog1.info(message);\n        winlog2.info(message);\n    }\n};\n\napp.use(express.logger({stream:winstonStream,  format: ':remote-addr - [:date] \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" \":user-agent\" :response-time' }));\n</code></pre>\n"},{"tags":["node.js","backbone.js","jade"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13057270,"title":"Render Backbone Template Variable In Quotes","body":"<p>Hi I'm using Backbone to render a Jade template into HTML. The view looks like this:</p>\n\n<pre><code>script(type=\"text/template\",id=\"waiting_call_template\") \n    div(class=\"call-code\") &lt;%= channelId %&gt;\n    div(style=\"display: inline-block; vertical-align: top; margin-right: 20px; width: 130px;\")\n      div(class=\"statistic\", title='&lt;%= fullPage %&gt;') &lt;%= page %&gt;\n</code></pre>\n\n<p>When that renders, the HTML output looks like this: </p>\n\n<pre><code>&lt;div title=\"&amp;lt;%= fullPage%&amp;gt;\" class=\"statistic\"&gt;test.html&lt;/div&gt;\n</code></pre>\n\n<p>This is happening because the fullPage variable is in quotes. How do I get Backbone to recognize that fullPage is a variable even though it's in quotes?</p>\n"},{"tags":["node.js","fedora","node-gyp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12812625,"title":"node-gyp configure always fails with EXDEV error","body":"<p>I am trying to compile the following MWE, taken essentially from <a href=\"http://nodejs.org/api/addons.html\" rel=\"nofollow\">the official Node.js documentation</a>:</p>\n\n<pre><code>#include&lt;v8.h&gt;\n#include&lt;node.h&gt;\n\nusing namespace v8;\n\nHandle&lt;Value&gt; Method (const Arguments&amp; _args) {\n    HandleScope Scp;\n    return Scp.Close (String::New (\"world\"));\n}\n\nvoid Initialize (Handle&lt;Object&gt; _target) {\n    _target-&gt;Set (\n        String.NewSymbol (\"hello\"),\n        FunctionTemplate::New (Method)-&gt;GetFunction ()\n    );\n}\n\nNODE_MODULE (\"Hello\", Initialize)\n</code></pre>\n\n<p>The corresponding <code>binding.gyp</code> file is as follows:</p>\n\n<pre><code>{\n    \"targets\": [\n        {\n            \"target_name\": \"hello\",\n            \"sources\": [\"hello.cpp\"]\n        }\n    ]\n}\n</code></pre>\n\n<p>When I attempt to run <code>node-gyp configure</code>, I get the following errors:</p>\n\n<pre><code>$ node-gyp configure\ninfo it worked if it ends with ok\ninfo downloading http://nodejs.org/dist/v0.6.18/node-v0.6.18.tar.gz\nERR! Error: EXDEV, link '/usr/lib/nodejs/node-gyp/legacy/tools/gyp/pylib/gyp/easy_xml.pyc'\nERR! not ok\n$\n</code></pre>\n\n<p>I am running the 64-bit version of Fedora 17.  Here is the output of <code>uname -a</code>:</p>\n\n<pre><code>Linux localhost.localdomain 3.5.5-2.fc17.x86_64 #1 SMP Wed Oct 3 13:20:37 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre>\n\n<p>Here is some more system information:</p>\n\n<pre><code>$ rpm -q nodejs\nnodejs-0.6.18-1.fc17.x86_64\n$ rpm -q node-gyp\nnode-gyp-0.4.1-2.fc17.noarch\n</code></pre>\n\n<p>Thanks in advance for your help.</p>\n"},{"tags":["javascript","regex","node.js","unicode","xregexp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12800517,"title":"Javascript Node.js Unicode Regular Expression","body":"<p>I need input validation, good input validation to keep everything clean. So I want a strict regular expression on \"full name\", international so I need Unicode support. I downloaded XRegExp, which compiles \"their format\" to regular expressions and supports Unicode however:</p>\n\n<p>Correct names:</p>\n\n<ul>\n<li>John Elkjærd</li>\n<li>André Svenson</li>\n<li>Marco d'Almeida</li>\n<li>Kristoffer la Cour</li>\n</ul>\n\n<p>Incorrect names:</p>\n\n<ul>\n<li>Hans</li>\n<li>H4nn3 Andersen</li>\n<li>Martin Henriksen!</li>\n</ul>\n\n<p>So I need:</p>\n\n<ol>\n<li>Match unicode letter (a, æ)</li>\n<li>Match unicode accents (á, Ë etc.)</li>\n<li>Match unicode hyphens (- _ etc)</li>\n</ol>\n\n<p>In PHP I can do the following operations to match:</p>\n\n<pre><code>\\p{L} (unicode letter)\n\\p{Mn} (unicode accents)\n\\p{Pd} (unicode hyphens)\n</code></pre>\n\n<p>What I figured out, that I can do with XRegExp:</p>\n\n<p>^\\p{L}+$ would match '日本' so only the letter one works, but how can I figure out how to do these unicode accents, hypens?</p>\n\n<p>Thanks for help.</p>\n"},{"tags":["node.js","batch-file","shortcut"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13047447,"title":"Node Shortcut or BAT","body":"<p>I am tired of manually typing the path and run in the command prompt.</p>\n\n<p>Here is what I need:</p>\n\n<ol>\n<li>Run Command Prompt</li>\n<li><code>cd c:\\socket\\nodejs</code></li>\n<li>Execute <code>node test.js</code></li>\n</ol>\n\n<p>How can I create a BAT or shortcut for this?</p>\n"},{"tags":["node.js","routes","express"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13067792,"title":"routes and views","body":"<p>I am using nodejs with express. On a get-request to the root path I want to route to an index file. If there is a get-request to the path \"/game\" I want to route to a different source. </p>\n\n<pre><code>app.get('/', function(req, res){\n    res.render( \"index\", {locals : { myLocal : \"myValue\"}} );\n});\n\napp.get('/game', function(req, res){\n    res.render(\"/game/index\", {locals : { myLocal : \"myValue\"}} );\n});\n</code></pre>\n\n<p>The first \"get\" works nice but the second sends this exception:</p>\n\n<pre><code>500 Error: failed to locate view \"/game/index\"\nat Function.exports.compile (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\view.js:61:15)\nat ServerResponse.res._render (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\view.js:417:18)\nat ServerResponse.res.render (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\view.js:318:17)\nat exports.game (D:\\Webstorm\\myExpress\\routes\\index.js:12:9) at callbacks                  (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\router\\index.js:272:11)\nat param (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\router\\index.js:246:11)\nat pass (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\router\\index.js:253:5)\nat Router._dispatch (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\router\\index.js:280:5)\nat Object.middleware [as handle] (D:\\Webstorm\\myExpress\\node_modules\\express\\lib\\router\\index.js:45:10)\nat next (D:\\Webstorm\\myExpress\\node_modules\\express\\node_modules\\connect\\lib\\http.js:204:15)\n</code></pre>\n\n<p>This is my folder-structure:</p>\n\n<pre><code>views\n  |--- game\n  |      |---index.jade\n  |      |---layout.jade\n  |---index.jade\n  |---layout.jade \n</code></pre>\n\n<p>UPDATE ########</p>\n\n<p>I checked express itself (file: \"\\express\\lib\\view.js\", function:\"_render\") and printed out the local \"options.root\". The value is: \"D:\\Webstorm\\myExpress/views\".. that does not seem to be right. But I still wonder why the root-request works. I changed this line:</p>\n\n<pre><code>app.set('views', __dirname + '/views');\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>app.set('views', __dirname + '\\\\views');\n</code></pre>\n\n<p>with no success.</p>\n"},{"tags":["node.js","scalability","load-balancing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13070853,"title":"How to make a node.js server with rooms scalable","body":"<p>I have designed a Node.JS server that allows users to log in, join a room and exchange data with other users in this room using websockets. However I am now looking for a way to make this setup scalable.</p>\n\n<p>I spend all afternoon researching various loadbalancers such as nginx and haproxy, but I still can't figure out how to organise my setup.</p>\n\n<p>Initally users can login and view the active rooms. No biggie to makes this part scalable. However then they can join a specific room and at that point they need to be connected to the same node.js instance as the others in the room. It's this part I have trouble figuring out.</p>\n\n<p>For now my solution exists out of creating two different types of node.js instances. One generic type to handle the login and room overview request methods and one roomtype that handle a number of rooms. The generic type then keeps track of which specific instance is responsible for which room and can deliver the correct address to the user's application.</p>\n\n<p>However I am not satisfied with this solution, so I am open for suggestions. I understand that this is a rather vague question, but I am not looking for a exact solution, rather hints as to how to organize everything.</p>\n"},{"tags":["android","node.js","youtube","nodes","remote-access"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":30,"score":-4,"question_id":13072032,"title":"how Youtube remote application works","body":"<p>I am thinking about how Youtube remote application works,\nhow to make such application. I don't know from where start.\nI have a good background knowledge in programming languages and in web technologies stuff.</p>\n\n<p>I'm suprised how when somebody plays a video in the android app or youtube remote app, it reflects on the desktop pc.</p>\n\n<p>Could you please give me a rough idea from where to start or how does that work?</p>\n"},{"tags":["node.js","mocha","should.js"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":24,"score":2,"question_id":13069366,"title":"Testing Errors passed back with Callbacks with mocha and should","body":"<p>I am getting into Node.js and trying to do some Behaviour Driven Development(BDD) with Mocha and should.js (and sinon in there as well at some point).  </p>\n\n<p>One thing i am having problems with is testing errors returned by a call back, for instance this simple test:</p>\n\n<pre><code>it('should return an error if you try and execute an invalid Query object', function () {\n        var stubQuery = {}; \n\n        Provider.execute(stubQuery, function (err) {\n            //should.not.exist(err);\n            should.have.property('message', 'Invalid Query Object');\n        });\n    });\n</code></pre>\n\n<p>with the function:</p>\n\n<pre><code>PostgresqlProvider.prototype.execute = function (query, cb) {\n</code></pre>\n\n<p>};</p>\n\n<p>It doesn't matter what i try and test, the test always passes (should.exist, etc), and the only way i can get it to fail first is by adding cb(null); into the execute function, which kinda goes against what i am doing as i am trying to test before adding behaviour, not adding behaviour to fail a test.</p>\n\n<p>I know i am doing some real newb mistake here, probably on a few levels but i am not grasping the testing of an error passed as a call back with is not thrown (which i am sure i could test easier)! </p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Using the code from Herman, i adjusted and that indeed words (the test is failing with no behavior defined)</p>\n\n<pre><code>        it('should return an error if you try and execute an invalid Query object', function () {\n        var stubQuery = {};\n        Provider.execute(stubQuery, function (err) {\n            if (err) throw new Error(err);\n        }).should.throw();\n    });\n</code></pre>\n\n<p>issue now is i can't \"catch\" the error if sent in the callback to pass the test, the <strong>should.throw</strong> method doesn't get called, it just states that expected a throw to happen but didnt even though i am returning an error to the callback from my method.  This could be down to scope \nbut i am unsure if i should add some form of closure, and at what level.</p>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>Figured it out, i needed to wrap the call to the function inside a closure, not the callback (Doh!) and then place the assert (should.throw) at the end of the closure;</p>\n\n<pre><code>        it('should return an error if you try and execute an invalid Query object', function () {\n        var stubQuery = {};\n        (function(){\n            Provider.execute(stubQuery, function (err) {     \n                if (err) \n                    throw err;\n            });\n         }).should.throw();\n    });\n</code></pre>\n"},{"tags":["node.js","templates","express","assets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13070233,"title":"Handling assets in node.js with express","body":"<p>ok so what I am trying to do is manually handle my assets when using express. What I mean is that I do not what to have to have every stylesheet/javascript file on every page. So I wanted to be able to specify in each route whether I wanted to use another javascript file or not. Ex:</p>\n\n<pre><code>app.get('/testing',function(req,res,next){\n      assets.addJS('my-javascript-file');\n      res.render('testing');\n});\n</code></pre>\n\n<p>So now when the template goes to render I want all of those javascript files that have been added in a local variable. I do not want to pass them on each call to render because I will want to add javascript in other places and may not necessarily need to send anything to the template which would cause me not to pass it by accident. Another thing that I want to implement is caching. I know by default it sends back the 304 not modified once it has the asset but I dont even want it making that request so I was hoping to do a query string on the files when they are output with maybe the last time they were modified and that way if I change them it will automatically tell the users browser to get the newest files but other than that it will cache them saving me bandwidth / requests (amazon s3 charges for these). If anyone can point me in the right direction or if there is already a plugin out there for this please let me know. Thanks.</p>\n"},{"tags":["performance","node.js","redis"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":791,"score":4,"question_id":5709866,"title":"Redis performance issues?","body":"<p>I was trying to put some heavy load on my Redis for testing purposes and find out any upper limits. First I loaded it with 50,000 and 100,000 keys of size 32characters with values around 32 characters. It took no more than 8-15 seconds in both key sizes. Now I try to put 4kb of data as value for each key. First 10000 keys take 800 milli seconds to set. But from that point it slows down gradually and to set whole 50,000 keys it takes aroudn 40 minutes. I am loading the database using NodeJs with <a href=\"http://github.com/mranney/node_redis\" rel=\"nofollow\">node_redis (Mranney)</a> . Is there any mistake I am doing or is Redis just that slow with big values of size 4 KB?</p>\n\n<p>One more thing I found now is when I run another client parallel to the current one and update keys this 2nd client finishes up loading the 50000 keys with 4kb values within 8 seconds while the first client still does its thing forever. Is it a bug in node or the redis library? This is alarming and not acceptable for production.</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13069769,"title":"FileReader.readAsDataURL upload to express.js","body":"<p>I have the following code to upload to my Node.js/Express.js backend.</p>\n\n<pre><code>var reader = new FileReader();\nreader.readAsDataURL(file);\n\nreader.onload = function (e) {\n  var result = http.post('/files', e.target.result);\n  result.success(function () { \n    alert('done'):\n  });\n}\n</code></pre>\n\n<p>My route looks like:</p>\n\n<pre><code>app.post('/files', function (req, res) {\n  var cws = fs.createWriteStream(__dirname + '/media/file');\n  req.pipe(cws);\n  res.send('success');\n});\n</code></pre>\n\n<p>When I open /media/file with an image app I get a warning that it cannot read it. When I open the image file with a text-editor I see the base64 encoded string inside. Do I need to convert the string first before writing it to desk?</p>\n"},{"tags":["html5","node.js","socket.io","webrtc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":13027302,"title":"saving a video/audio session created through webrtc peerConnection","body":"<p>I have created an application where I am able to start a video conference between two clients using <strong>webRTC peerConnection api</strong>.<br/>I have used <strong>node.js</strong> for server side scripting and <strong>socket.io</strong> for socket implementation. Now I want to record this live video chat session and save it.<br/>How to go about it? I tried to find out but haven't got anything. Maybe I am not looking at the right place. Please help.</p>\n"},{"tags":["node.js","express","websocket","redis","socket.io"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13069659,"title":"socket.io, node cluster, express, session store with redis","body":"<p>I'm not exactly sure how to describe this, but I'm running a node app with a cluster on 4 cores, port 80, using RedisStore as the socket.io store, express.js, and socket.io listens on it.</p>\n\n<p>Some interesting behavior that happens is that on around 40% of clients that connect to socket.io using Chrome (and Firefox, but we stopped bothering using different browsers because it seems to be across the board), it connects and works fine for the first 25-30 seconds, then after that there is 60 seconds of dead time where requests are sent from the client but none are received or acknowledged by the server, and at 1.5 min - 1.6 min, the client starts a new websocket connection. Sometimes that new websocket connection has the same behavior, at other times the connection \"catches\" and is persistent for the next few hours and is absolutely fine.</p>\n\n<p>What's funny is that this behavior doesn't happen on our test server that runs on a different port (which also uses a cluster); and moreover it doesn't happen on any of our local development servers (some of which implement clusters, others of which don't).</p>\n\n<p>Any ideas?</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13069522,"title":"Modifying a HTML file in NodeJS","body":"<p>Let me preface with two things.  I am currently using grunt for these tasks and I also know about Yeoman which has what I am asking for.  I do really like Yeoman however it is just a little too opinionated for this particular project I am working on.</p>\n\n<p>So I have the following HTML file:</p>\n\n<pre><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\n        &lt;title&gt;&lt;/title&gt;\n        &lt;meta name=\"description\" content=\"\"&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width\"&gt;\n\n        &lt;!-- START-CSS-MIN:css/build/min.css --&gt;\n        &lt;link rel=\"stylesheet\" href=\"css/bootstrap/bootstrap-2.1.1.css\"&gt;\n        &lt;link rel=\"stylesheet\" href=\"css/normalize.css\"&gt;\n        &lt;link rel=\"stylesheet\" href=\"css/boilerplate.css\"&gt;\n        &lt;!-- END-CSS-MIN --&gt;\n\n        &lt;!-- START-JS-MIN:js/build/modernizr.js --&gt;\n        &lt;script src=\"js/libraries/modernizr.js\"&gt;&lt;/script&gt;\n        &lt;!-- END-JS-MIN --&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;!--[if lt IE 7]&gt;\n            &lt;p class=\"chromeframe\"&gt;You are using an outdated browser. &lt;a href=\"http://browsehappy.com/\"&gt;Upgrade your browser today&lt;/a&gt; or &lt;a href=\"http://www.google.com/chromeframe/?redirect=true\"&gt;install Google Chrome Frame&lt;/a&gt; to better experience this site.&lt;/p&gt;\n        &lt;![endif]--&gt;\n\n        &lt;p&gt;Hello world! This is a basline HTML5 template (based on HTML5 Boilerplate).&lt;/p&gt;\n\n        &lt;!-- START-JS-MIN:js/build/libraries.js --&gt;\n        &lt;script src=\"js/libraries/underscore.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"js/libraries/jquery/jquery.js\"&gt;&lt;/script&gt;\n        &lt;!-- END-JS-MIN --&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Now you can see the CSS-MIN and JS-MIN comments.  Right now I already have a custom grunt build task that properly collects all those files in the comments (using htmlparser) and then minifies and concats them as directly based on the comments.  The last step in the build process is to create a new version of that HTML file (for production use) that replaces the comments with the new file.  For example, the code above would be turned into this:</p>\n\n<pre><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\n        &lt;title&gt;&lt;/title&gt;\n        &lt;meta name=\"description\" content=\"\"&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width\"&gt;\n\n        &lt;link rel=\"stylesheet\" href=\"css/build/min.css\"&gt;\n\n        &lt;script src=\"js/build/modernizr.js\"&gt;&lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;!--[if lt IE 7]&gt;\n            &lt;p class=\"chromeframe\"&gt;You are using an outdated browser. &lt;a href=\"http://browsehappy.com/\"&gt;Upgrade your browser today&lt;/a&gt; or &lt;a href=\"http://www.google.com/chromeframe/?redirect=true\"&gt;install Google Chrome Frame&lt;/a&gt; to better experience this site.&lt;/p&gt;\n        &lt;![endif]--&gt;\n\n        &lt;p&gt;Hello world! This is a basline HTML5 template (based on HTML5 Boilerplate).&lt;/p&gt;\n\n        &lt;script src=\"js/build/libraries.js\"&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>The question I have is how would I be able to do this in NodeJS?  The htmlparser NPM module is great for parsing HTML however I now need something where I am modifying the HTML (removing and adding certain elements in specific locations).  Is there any good packages/tutorials on how to do this in NodeJS code?</p>\n"},{"tags":["node.js"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":10613270,"title":"The concept of how NodeJS runs and the space for each request","body":"<p>I have been tinkering on NodeJS for a while now. I still don't seem to understand how Node actually runs. Maybe it's just that I can't shed off the PHP mindset. I know it's pretty different from PHP, but still I can't grasp the idea - especially when they keep repeating the terms <em>event-loop</em>, <em>event-driven</em> and <em>REPL</em>.</p>\n\n<ul>\n<li><p>Does the code run \"forever\" when it gets started? Is it <em>like</em> a big 'ol browser window in the back-end that the all the clients <em>look at</em> and which listens to some sort of <em>onRequest</em> event from them?</p></li>\n<li><p>Or is every request an isolated sandbox? Where the code runs for every request, separated from the other requests?</p></li>\n</ul>\n\n<p>I've seen demos of socket connection chat in the videos, and it seems like it runs like the first point describes. But wouldn't that be \"wierd\" where all people access the same \"space\"?</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13067208,"title":"To Find the average of a particular type in MongooseJs","body":"<p>I have a MongoDB collection \"Marks\" as shown below</p>\n\n<pre><code> _id   Student_id   Subject  Mark\n   1    111          AAA      9\n   2    111          BBB      5\n   3    111          CCC      7\n   4    222          AAA      10\n   5    222          CCC      6\n   6    222          BBB      8\n</code></pre>\n\n<p>I need to find the average mark scored by student_id=111 in 3 subjects using <strong>MONGOOSEJS</strong> .I got a solution</p>\n\n<pre><code>var Mark = mongoose.model('mark', new Schema({\n  Student_id: Number,\n  Subject: String,\n  Mark: Number\n}));\n\nMark.aggregate([\n    { $group: {\n        _id: '$Student_id',\n        markAvg: { $avg: '$Mark'}\n    }}\n], function (err, results) {\n    if (err) {\n        console.error(err);\n    } else {\n        console.log(results);\n    }\n}\n);\n</code></pre>\n\n<p>Output is </p>\n\n<pre><code>    [ { _id: 222, markAvg: 8 }, { _id: 111, markAvg: 7 } ]\n</code></pre>\n\n<p>I Want only <code>{_id:111,markAvg:7}</code> when I pass student_id:111 as parameter.\nAnyone please suggest an answer.</p>\n"},{"tags":["django","node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13067682,"title":"Django+MongoDB vs Node.js+MongoDB","body":"<p>I have up and running a website with sync services that built using Python(Django)+MySQL. For a long time I'm looking to the Node.js and MongoDB side. I'm close to make a decision to move to MongoDB part of the system that hosts data from user's desktop clients and used by sync service to sync data between clients. </p>\n\n<p>I'd like to keep the rest of the system running on Django+MySQL.</p>\n\n<p>My question is should I rewrite sync service on Node.js or keep it running on Django? Is there any advantages for Node.js with MongoDB against Django?</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13067814,"title":"Node.js asynchronous programming - copy binary file stream","body":"<p>I want to read all bytes in file A, subtract 0x80 from each byte, and write the results to file B.</p>\n\n<p>Here's some pseudocode:</p>\n\n<pre><code>try:\n    open file A for reading\n    open file B for writing\n\n    loop until EOF:\n        x = next byte from file A\n        x = x - 0x80;\n        write x to file B\n\nfinally:\n   close file A\n   close file B\n</code></pre>\n\n<p>How can this be done in node.js using the <strong>asynchronous</strong> file system functions?</p>\n\n<p>I gave it a shot, but gave up when my code got half a dozen levels deep with callbacks and exception handling. Please teach me clean asynchronous programming. :)</p>\n"},{"tags":["node.js","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":28,"score":3,"question_id":13066532,"title":"how to uninstall npm modules in node js?","body":"<p>As commonly known, any npm module can be installed by running a simple command: <code>npm install &lt;module_name&gt;</code>.</p>\n\n<p>I have installed a few modules that I do not use anymore and I just want to get them off. I have a few questions regarding this:</p>\n\n<ul>\n<li><p>Do we have any command or process to uninstall a module from the root (something like <code>npm uninstall &lt;module_name&gt;</code>)\nor will simply removing the module files do?</p></li>\n<li><p>How does it affect us if we keep the unused modules?</p></li>\n</ul>\n"},{"tags":["node.js","mongodb","file-upload"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13066337,"title":"Error in uploading file in node.js","body":"<p>Guys whenever I try uploading the file through node.js without the use of any framework through <code>formidable</code> I get an error.The snippet for the said error is</p>\n\n<pre><code> res.write('&lt;div id=\"capslide_img_cont6\" class=\"ic_container\"&gt;');\n                         res.write('&lt;div class=\"overlay\" style=\"display:none;\"&gt;&lt;/div&gt;&lt;div class=\"ic_caption\"&gt;\"'+comment[i]+'\"&lt;/br&gt;&lt;div class =\"show_addframe\" style=\"display:none;\"&gt;')\n                         res.write('&lt;form method=\"post\" action=\"/add_new_frame_inputs\"&gt;&lt;input type=\"submit\" name=\"add\" value=\"add\"/&gt;&lt;/form&gt;');\n                         res.write('&lt;form method=\"post\" action=\"/change_pic\" enctype=\"multipart/form-data\"&gt;&lt;input type = \"button\" value = \"Change Pic\" onclick=javascript:document.getElementById(\"imagefile\").click();&gt;&lt;input type=\"submit\" name=\"submit\"/&gt;');\n                         res.write('&lt;input id = \"imagefile\" type=\"file\" style=\"visibility: hidden;\" name=\"upload\" multiple=\"multiple\"/&gt;&lt;input type=\"hidden\" name=\"id\" value=\"'+id[i]+'\"&gt;&lt;/form&gt;&lt;/br&gt;');\n                         res.write('&lt;form method=\"post\" action=\"/deletenode\"&gt;&lt;input type=\"hidden\" name=\"name\" value=\"'+namet[i]+'\"/&gt;&lt;input type=\"submit\" name=\"submit\" value=\"delete\"&gt;&lt;/form&gt;&lt;/div&gt;&lt;/div&gt;');\n                         res.write('&lt;img src=\"http://localhost/'+img[i]+'\" height=\"300\" width=\"250\"/&gt;&lt;br&gt;');\n                         res.write('&lt;/div&gt;&lt;/div&gt;');\n                         if(i==(namet.length-1)){\n                            res.end('&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;');\n</code></pre>\n\n<p>This code handles the file upload and it calls this code</p>\n\n<pre><code>var form    = new formidable.IncomingForm();\n                    form.parse( req, function( error, fields, files ){\n                      fs.rename(files.upload.path, \"/var/www/\"+files.upload.name);\n                      im.resize({\n                      srcPath: \"/var/www/\" + files.upload.name,\n                      dstPath: \"/var/www/\" + files.upload.name,\n                      width:   '500',\n                      height: '500'\n                        }, function(err, stdout, stderr){\n                        if (err) throw err\n                        console.log('resized++++')\n                            });\n                            console.log(\"Aftr resized\");\n                      img_path=files.upload.name;\n                      pic_tags=fields.pic_tags;\n                      var objectid=new ObjectID();\n                      pic_id=objectid.toHexString();\n                      docname=fields.name;\n                      docparent=fields.parent;\n                      doccomments=fields.comments;\n                      db.frames.update({pic_id:fields.id},{$set:{pic_id:pic_id}},false,true);\n                      db.pictures.insert({imgs:img_path,_id:pic_id,pic_tags:null});\n                        });\n                    console.log(\"updated frames\");\n                     res.writeHead(302,{'location':'/main_menu'});\n                     res.end();\n                        break;  \n</code></pre>\n\n<p>The error which I get is this</p>\n\n<pre><code> if (err) throw err\n                                       ^\nError: Command failed: convert: no decode delegate for this image format `/var/www/' @ error/constitute.c/ReadImage/532.\nconvert: missing an image filename `/var/www/' @ error/convert.c/ConvertImageCommand/3011.\n\n    at ChildProcess.&lt;anonymous&gt; (/home/r121/Desktop/nilesh/node_modules/imagemagick/imagemagick.js:88:15)\n    at ChildProcess.EventEmitter.emit (events.js:91:17)\n    at maybeClose (child_process.js:634:16)\n    at Process._handle.onexit (child_process.js:676:5)\n</code></pre>\n\n<p>Now when I remove the <code>im.resize</code> method the file doesnt gets uploaded at all.Can anyone help me out with this please.Thankx to everyone in Advance.Also the database shows null values for that.</p>\n"},{"tags":["node.js","heroku","environment-variables"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12905932,"title":"Retrieve local and heroku application hostname outside a request","body":"<p>I have to configure one of the module in my application and give it a specific URL, based on the hostname. Something like <code>http://localhost</code> locally and <code>http://myapp.herokuapp.com</code>. I know I can just hardcode the value depending on <code>NODE_ENV</code>, or even store it as an environment value and use <code>process.env.CUSTOMVAR_HOSTNAME</code>. But somehow it feels wrong, since <code>myapp</code> is already configured in the Heroku admin panel. And I can't use <code>request.headers.host</code> since the module configuration happens at the start of the application, before any request can be handled.</p>\n\n<p>Is there a way to retrieve the Heroku application name from the code ? Or from an environment variable ? I want my code to stay the same whether I'm executing code locally or on Heroku (or any other place actually).</p>\n"},{"tags":["javascript","node.js","mongodb","angularjs","stackoverflow"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":5,"view_count":131,"score":-1,"question_id":13065397,"title":"stackoverflow type app with Node.js, Angular.js, and MongoDB","body":"<p>I am really wanting to push my skill set to the next level, So for a completely non-profit personal project I am wanting to create a much simpler version of Stack Overflow using some of the latest JS technologies. </p>\n\n<p>The technologies I want to use are: Node.js, Angular.js, and MongoDB</p>\n\n<p>I have a few questions before I take it any further though.</p>\n\n<ol>\n<li><p>Whilst I know its possible to do it with the aforementioned technologies is it a good idea? Or would MySQL be a better choice of DB.</p></li>\n<li><p>Am I taking on way to much work for a pretty poor outcome as these technologies aren't really supposed to be used for such projects?</p></li>\n</ol>\n\n<p>Im really trying to get peoples opinion of these technologies being used together on a project of this manner and how they might perform.</p>\n\n<p>Thanks guys.</p>\n"},{"tags":["node.js","http","curl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13065332,"title":"I need to send a image file to POST API endpoint written in nodejs from another nodejs program","body":"<p>I need to send a image file to POST API endpoint written in nodejs from another nodejs program using http module.</p>\n\n<p>How to use http post request to send a file to POST API which accepts the file as multipart/form data type.</p>\n\n<p>I can able to do using curl -f file=image.jpg API</p>\n\n<p>but I am not able to do that using http module.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13065121,"title":"Selecting particular fields in MongooseJs","body":"<p>I have a NodeJS application with Mongoose ODM.\nI want to select three particular fields from a collection.\nExample my collection is \"Users\" having fields '_id','username','email','usertype','password'...\nI want to select only 'username','email'&amp;'usertype' .\nThis was <strong>my code</strong></p>\n\n<pre><code> var query = models.User.find({}).select('UserName', 'Email', 'UserType');\n</code></pre>\n\n<p>This was working fine with mongoose 2 version,I updated to Mongodb 2.2 and Mongoose 3.3.1.\nNow I am getting error</p>\n\n<pre><code>500 TypeError: Invalid select() argument. Must be a string or object.\n</code></pre>\n\n<p>Can anyone please suggest a solution?</p>\n"},{"tags":["node.js","audio-streaming","red5","rtmp","webrtc"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":13052530,"title":"NodeJS and RED 5 media server via RTMP","body":"<p>This is more a conceptual question rather than a direct \"how to do this\". </p>\n\n<p><em>Is it generally possible to implement a flash-like solution to stream the audio (independent of where we get the stream data from, e.g. webRTC or other) in HTML5 and nodeJS/binaryJS. If so, how would you go about this?</em></p>\n\n<p>There has been only one inquire on stackoverflow <a href=\"http://stackoverflow.com/questions/11891818/rtmp-implementation-in-nodejs-is-possible\">found here</a> and its from 2010. NodeJS and HTML5 have grown and matured since then.</p>\n\n<p><strong>What people usually do:</strong>\nWhen using multimedia streaming (i.e. video or audio) to a server, there is definitely nothing that beats Flash at the current point in time till the full arrival of <a href=\"http://dev.w3.org/2011/webrtc/editor/getusermedia.html\" rel=\"nofollow\">getUserMedia()</a> - which quite honestly might <a href=\"http://caniuse.com/#search=getusermedia\" rel=\"nofollow\">take a while</a> till 99% of the browser users will get to use it at all.</p>\n\n<p>General practice to stream data to the server is by using a client Flash or Flex application which is then connecting to a RTMP protocol powered media server like <a href=\"http://www.red5.org/\" rel=\"nofollow\">RED5</a>, <a href=\"http://www.adobe.com/products/adobe-media-server-family.html\" rel=\"nofollow\">FMS</a> or <a href=\"http://www.wowza.com\" rel=\"nofollow\">Wowza</a>. For example, the client app sending the microphone input over RTMP could look like (simplified version)</p>\n\n<pre><code>import flash.net.NetStream;\n\nprivate var myMic:Microphone;\nprivate var nc:NetConnection;\nprivate var ns:NetStream\n\nnc = new NetConnection();    \nns = new NetStream(nc);\nnc.connect(rtmp://localhost/serverApp);\nmyMic = Microphone.getMicrophone();\nns.attachAudio(myMic);\n</code></pre>\n\n<p>Together with a server application one is easibly able to stream data to the server.</p>\n\n<p><strong>What I would like to do:</strong>\nHave an app server running on <a href=\"http://nodejs.org/\" rel=\"nofollow\">nodeJS</a> (possibly implementing <a href=\"http://socket.io/\" rel=\"nofollow\">socketIO</a> and <a href=\"http://binaryjs.com/\" rel=\"nofollow\">binaryJS</a>) that catches the incoming RTMP stream. Something like</p>\n\n<pre><code>//require\nvar rtmp = require('node-rtmp'),\nvar fs = require('fs');\n\n//rtmp server address\nvar rtmpServer = 'rtmp://localhost';\n\n//create a binary server listening that receives stream data\nvar RTMPServer = rtmp.RTMPServer();\nvar server = RTMPServer ({port: 1935});\n\nserver.on('connection', function(client){\n //check if user is allowed to do so\n rtmp.newStream(client.stream);\n});\n</code></pre>\n\n<p>Possibly it might be better to use socketIO to differentiate between user interactions via eventEmitters.</p>\n\n<p><strong>What might be the advantages:</strong> Generally speaking it seems like a bit overhead to make this kind of approach, but for me there might be advantages and I'd also like you to comment on this.</p>\n\n<ul>\n<li>easy validation of user interaction by running e.g. <a href=\"http://expressjs.com/\" rel=\"nofollow\">express</a> and socketIO</li>\n<li>hybrid implementation of a flash (via RTMP) and getUserMedia() (via binary transport mechanisms by adding binaryJS and the Mozilla AudioAPI)</li>\n<li>if getUserMedia() gets fully supported, flash implementations can be dropped easily</li>\n<li>more control over the rtmp followup and user interaction in general</li>\n<li>easier implementation into server frameworks</li>\n</ul>\n\n<p><strong>UPDATE:</strong>\nI've talked to Mr. Malcontenti-Wilson who is responsible for the <a href=\"https://github.com/adammw/node-rtmp\" rel=\"nofollow\">only node-rtmp package</a> that was written but discontinued 8 months ago as it was poorly written and he hit a roadblock. Anyone who used this or was able to check the code?</p>\n"},{"tags":["debugging","node.js","stack"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13064587,"title":"How to keep the stack or the callers of async methods when this stack is quite big (node.js)?","body":"<p>I have an app that has async into async many times and I'm having difficulties in knowing from where that call came and with which variables. There is any workaround?</p>\n\n<p>The reason I'm having problems is because in qooxdoo the fireDataEvent is very complicated and I cannot get the callback method linked to the event.</p>\n\n<p>thanks</p>\n"},{"tags":["facebook","node.js","facebook-graph-api","express","socket.io"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":722,"score":3,"question_id":10805335,"title":"facebook and socket.io node.js","body":"<p>I have a some god idea, but I have some problems... how to connect facebook user to node app - socket.io </p>\n\n<p>I was created an socket.io chat but now want to allow facebook users to come to chat to create something like facebook group CHAT. I think that idea is fine?</p>\n\n<p>Here is my code for chat:</p>\n\n<p>server side file - app.js</p>\n\n<pre><code>var app = require('express').createServer()\nvar io = require('socket.io').listen(app);\n\napp.listen(8080);\n\n// routing\napp.get('/', function (req, res) {\n  res.sendfile(__dirname + '/index.html');\n});\n\n// usernames which are currently connected to the chat\nvar usernames = {};\n\n// rooms which are currently available in chat\nvar rooms = ['room1','room2','room3'];\n\nio.sockets.on('connection', function (socket) {\n\n    // when the client emits 'adduser', this listens and executes\n    socket.on('adduser', function(username){\n        // store the username in the socket session for this client\n        socket.username = username;\n        // store the room name in the socket session for this client\n        socket.room = 'room1';\n        // add the client's username to the global list\n        usernames[username] = username;\n        // send client to room 1\n        socket.join('room1');\n        // echo to client they've connected\n        socket.emit('updatechat', 'SERVER', 'you have connected to room1');\n        // echo to room 1 that a person has connected to their room\n        socket.broadcast.to('room1').emit('updatechat', 'SERVER', username + ' has connected to this room');\n        socket.emit('updaterooms', rooms, 'room1');\n    });\n\n    // when the client emits 'sendchat', this listens and executes\n    socket.on('sendchat', function (data) {\n        // we tell the client to execute 'updatechat' with 2 parameters\n        io.sockets.in(socket.room).emit('updatechat', socket.username, data);\n    });\n\n    socket.on('switchRoom', function(newroom){\n        // leave the current room (stored in session)\n        socket.leave(socket.room);\n        // join new room, received as function parameter\n        socket.join(newroom);\n        socket.emit('updatechat', 'SERVER', 'you have connected to '+ newroom);\n        // sent message to OLD room\n        socket.broadcast.to(socket.room).emit('updatechat', 'SERVER', socket.username+' has left this room');\n        // update socket session room title\n        socket.room = newroom;\n        socket.broadcast.to(newroom).emit('updatechat', 'SERVER', socket.username+' has joined this room');\n        socket.emit('updaterooms', rooms, newroom);\n    });\n\n    // when the user disconnects.. perform this\n    socket.on('disconnect', function(){\n        // remove the username from global usernames list\n        delete usernames[socket.username];\n        // update list of users in chat, client-side\n        io.sockets.emit('updateusers', usernames);\n        // echo globally that this client has left\n        socket.broadcast.emit('updatechat', 'SERVER', socket.username + ' has disconnected');\n        socket.leave(socket.room);\n    });\n});\n</code></pre>\n\n<p>and index.html</p>\n\n<pre><code>&lt;script src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n    var socket = io.connect('http://localhost:8080');\n\n    // on connection to server, ask for user's name with an anonymous callback\n    socket.on('connect', function(){\n        // call the server-side function 'adduser' and send one parameter (value of prompt)\n        socket.emit('adduser', prompt(\"What's your name?\"));\n    });\n\n    // listener, whenever the server emits 'updatechat', this updates the chat body\n    socket.on('updatechat', function (username, data) {\n        $('#conversation').append('&lt;b&gt;'+username + ':&lt;/b&gt; ' + data + '&lt;br&gt;');\n    });\n\n    // listener, whenever the server emits 'updaterooms', this updates the room the client is in\n    socket.on('updaterooms', function(rooms, current_room) {\n        $('#rooms').empty();\n        $.each(rooms, function(key, value) {\n            if(value == current_room){\n                $('#rooms').append('&lt;div&gt;' + value + '&lt;/div&gt;');\n            }\n            else {\n                $('#rooms').append('&lt;div&gt;&lt;a href=\"#\" onclick=\"switchRoom(\\''+value+'\\')\"&gt;' + value + '&lt;/a&gt;&lt;/div&gt;');\n            }\n        });\n    });\n\n    function switchRoom(room){\n        socket.emit('switchRoom', room);\n    }\n\n    // on load of page\n    $(function(){\n        // when the client clicks SEND\n        $('#datasend').click( function() {\n            var message = $('#data').val();\n            $('#data').val('');\n            // tell server to execute 'sendchat' and send along one parameter\n            socket.emit('sendchat', message);\n        });\n\n        // when the client hits ENTER on their keyboard\n        $('#data').keypress(function(e) {\n            if(e.which == 13) {\n                $(this).blur();\n                $('#datasend').focus().click();\n            }\n        });\n    });\n\n&lt;/script&gt;\n&lt;div style=\"float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;overflow:scroll-y;\"&gt;\n    &lt;b&gt;ROOMS&lt;/b&gt;\n    &lt;div id=\"rooms\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div style=\"float:left;width:300px;height:250px;overflow:scroll-y;padding:10px;\"&gt;\n    &lt;div id=\"conversation\"&gt;&lt;/div&gt;\n    &lt;input id=\"data\" style=\"width:200px;\" /&gt;\n    &lt;input type=\"button\" id=\"datasend\" value=\"send\" /&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>and how to allow users to come to chta with their facebook account via fbLogin button:</p>\n\n<p>Here is fb login code, but HOW to implemet this code to my chat script to allow users to come with facebook accounts.</p>\n\n<pre><code>&lt;button id=\"fb-auth\"&gt;Login&lt;/button&gt;\n\n&lt;script&gt;\nfunction updateButton(response) {\n  Log.info('Updating Button', response);\n  var button = document.getElementById('fb-auth');\n\n  if (response.status === 'connected') {\n    button.innerHTML = 'Logout';\n    button.onclick = function() {\n      FB.logout(function(response) {\n        Log.info('FB.logout callback', response);\n      });\n    };\n  } else {\n    button.innerHTML = 'Login';\n    button.onclick = function() {\n      FB.login(function(response) {\n        Log.info('FB.login callback', response);\n        if (response.status === 'connected') {\n          Log.info('User is logged in');\n        } else {\n          Log.info('User is logged out');\n        }\n      });\n    };\n  }\n}\n</code></pre>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13063350,"title":"node js incoming request sourceIP","body":"<p>For example:</p>\n\n<pre><code>http.createServer(function (request, response) {\n   request.on(\"end\", function () {\n\n   });\n});\n</code></pre>\n\n<p>Using <a href=\"http://nodejs.org/api/http.html#http_event_request\" rel=\"nofollow\">Request</a>, how I can I find the source IP of the request?</p>\n"},{"tags":["node.js","tcpclient"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13049005,"title":"Node.js: client doesn't die when TCP connection closes","body":"<p>I built a simple tcp server and a simple tcp client in Node.js</p>\n\n<p>Now, when the client send \"exit\" to the server, the connection was successfully closed, server delete the socket from his sockets list and send \"Bye bye!\" to the client.</p>\n\n<p>Connection on the client is closed but the app is still waiting for other inputs, so it doesn't die and I'm forced to type CTRL+C for closing my little client.</p>\n\n<p>I tried with <strong>process.exit()</strong> but it doesn't work:</p>\n\n<p><strong>CLIENT CODE:</strong></p>\n\n<pre><code>var net = require('net'),\n    config = require(__dirname + '/config.json'),\n    connection = net.createConnection(config.port, config.host);\n\nconnection.setEncoding('utf8');\n\nconnection.on('connect', function () {\n    console.log('Connected');\n});\n\nconnection.on('error', function (err) {\n    console.error(err);\n});\n\nconnection.on('data', function (data) {\n    console.log('» ' + data);\n});\n\nconnection.on('close', function() {\n    console.log('Connection closed');\n});\n\nprocess.stdin.on('data', function (data) {\n\n    if ((new String(data)).toLowerCase() === 'exit') {\n        connection.end();\n        process.exit();\n    }\n    else {\n        connection.write(data);\n    }\n\n});\n\nprocess.stdin.resume();\n</code></pre>\n\n<p><strong>SERVER CODE:</strong></p>\n\n<pre><code>var server = require('net').createServer(),\n    config = require(__dirname + '/config.json'),\n    sockets = [];\n\nserver.on('connection', function (socket) {\n    socket.setEncoding('UTF-8');\n\n    socket.on('data', function (data) {\n\n        console.log('Received data: ' + data);\n\n        if (data.trim().toLowerCase() === 'exit') {\n            socket.write(\"Bye bye!\\n\");\n            socket.end();\n        }\n        else {\n            sockets.forEach(function (client) {\n                if (client &amp;&amp; client != socket) {\n                    client.write(data);\n                }\n            });\n        }\n\n    });\n\n    socket.on('close', function () {\n        console.log('Connection closed');\n        sockets.splice(sockets.indexOf(socket), 1);\n\n        console.info('Sockets connected: ' + sockets.length);\n    });\n\n    sockets.push(socket);\n});\n\nserver.on('listening', function () {\n    console.log('Server listening');\n});\n\nserver.on('close', function () {\n    console.log('Server is now closed');\n});\n\nserver.on('error', function (err) {\n    console.log('error:', err);\n});\n\nserver.listen(config.port);\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Client connection close event added. So, the string \"Connection closed\" is now printed by the server and by the client.</p>\n"},{"tags":["node.js","templates","express","connect","mustache"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13044884,"title":"node.js - templates / rendering -- how can I exclude or specify an alternate layout.mustache for one of my views?","body":"<p>Currently all pages are rendered from a <code>views/layout.mustache</code> file and a page-specific   <code>views/page.mustache</code> template</p>\n\n<p>I want to use an alternate <code>layout.mustache</code> and/or skip the <code>layout.mustache</code> all-together when rendering a certain view within my application.  What is the ideal way to go about doing this?</p>\n\n<p>Here's a snippet of my <code>app.configure</code>:</p>\n\n<pre><code>app.configure(function(){\n    ...\n    app.set('views', __dirname + '/views');\n    app.register(\".mustache\", require('stache'));\n    ...\n});\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13063138,"title":"node js getting the HTTP Request name","body":"<pre><code>   http.createServer(function (request, response) {\n   request.on(\"end\", function () {\n\n    if(request.method='PUT')\n    {\n    buf1='This is PUT';\n    console.log('received PUT');\n    }\n\n       response.writeHead(200, {\n         'Content-Type': 'text/plain'\n      });  \n      response.end('Hello HTTP!'+buf1);\n   });\n</code></pre>\n\n<p>I see that even I just try to do a GET also, the PUT command is gettingexecuted. is there anything basic I am missing? all I need is my program should read all headers based on method.</p>\n"},{"tags":["node.js","azure","azure-web-roles"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13060900,"title":"windows azure sdk localhost for node.js","body":"<p>I am running a helloworld program using node.js and windows azure sdk.</p>\n\n<p>If I keep :    127.0.0.1:81</p>\n\n<p>This link works and I get the hello world printed on the browser.</p>\n\n<p>But when I try:</p>\n\n<p>--http://192.168.1.6:81/</p>\n\n<p>This link is not working. 192.168.1.6 is the localIP of the machine I am running this application.</p>\n\n<p>Can you please let me know how I can get this working with a IP address</p>\n\n<p>I have the node.js helloworld application from:</p>\n\n<p><a href=\"http://www.windowsazure.com/en-us/develop/nodejs/tutorials/getting-started/\" rel=\"nofollow\">http://www.windowsazure.com/en-us/develop/nodejs/tutorials/getting-started/</a></p>\n\n<p>before I deploy this in cloud I want to  run my application with the IP address of the host</p>\n"},{"tags":["php","node.js","mongodb","xampp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13061062,"title":"Mongodb running with node and PHP","body":"<p>I am new to Node.js and MongoDB. I have successfully got the mongoDB running with node.js and am able to start it up and store data inside of collections.  So the server is already running on localhost:27017 and works when accessing localhost:28017 .</p>\n\n<p>Now that I have it running and working within Node, I wanted to test MongoDB out with PHP on my Xampp server running on Ubuntu, but am not able to get the phpinfo() to say it is using mongo yet.<br>\nI have followed the steps <a href=\"https://github.com/mongodb/mongo-php-driver\" rel=\"nofollow\">here</a> to configure and install the driver. I have moved the mongo.so file to my xampps extensions and added the appropriate line in php.ini + restarted. But phpinfo() still doesn't show it.</p>\n\n<p>I guess i am confused on the aspect of where do i put the mongo-php-driver folder? is this installed into the Xampp server as well, if so where do i put it? </p>\n\n<p>It is already running and working using node.js , so was just getting confused why it wasn't working properly or getting connected. </p>\n\n<p>Also while I'm at it, Is it possible to have php and node.js use the same mongoDB server running on port 27017?</p>\n\n<p>EDIT:\nI was able to get the server to at least give me an error message about the file after i edited the extension_dir to the correct path </p>\n\n<pre><code>extension_lib = \"/opt/lampp/lib/php/extensions/no-debug-zts-20090626\"\n</code></pre>\n\n<p>i am now getting this error</p>\n\n<pre><code>Warning: PHP Startup: Unable to load dynamic library '/opt/lampp/lib/php/extensions/no-debug-non-zts-20090626/mongo.so'  - /opt/lampp/lib/php/extensions/no-debug-non-zts-20090626/mongo.so: wrong ELF class: ELFCLASS64 in Unknown on line 0\n</code></pre>\n\n<p>i guess I needed to change that php.ini option to get it to load properly.  but it seems I have compiled the wrong mongo.so build. I try again. </p>\n\n<p>Thanks</p>\n"},{"tags":["node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":143,"score":1,"question_id":12627586,"title":"Is node.js rmdir recursive ? Will it work on non empty directories?","body":"<p>The documentation for <a href=\"http://nodejs.org/api/fs.html#fs_fs_rmdir_path_callback\" rel=\"nofollow\">fs.rmdir</a> is very short and doesn't explain the behavior of rmdir when the directory is not empty.</p>\n\n<p><strong>Q</strong>: What happens if I try to use this API to delete a non empty directory ?</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12229879,"title":"Return an associative array instead of a document array in mongoose","body":"<p>Let's suppose I have a Word model with this schema</p>\n\n<pre><code>var Word = new Schema({\n  name: { type: String, required: true },\n  disambiguation: String,\n  partOfSpeech: { type: ObjectId, ref: \"PartOfSpeech\", required: true },\n  attributes: [{ type: ObjectId, ref: \"Attribute\"}],\n  root: [{ type: ObjectId, ref: \"Word\"}],\n  language: { type: ObjectId, ref: \"Language\", required: true }\n});\n</code></pre>\n\n<p>I want to perform a query that returns an object, with word names as keys with and values as arrays of documents containing words with the corresponding name. </p>\n\n<p>As an example, here is the sort of output I would like. Most fields are ommitted for brevity.</p>\n\n<pre><code>{\n  stick: [{\n    _id: \"5024216f6df57b2b68834079\",\n    partOfSpeech: \"noun\"      \n  }, {\n    _id: \"678451de6da54c2b68837345\",\n    partOfSpeech: \"verb\"\n  }],\n  dog: [{\n    _id: \"47cc67093475061e3d95369d\",\n    partOfSpeech: \"noun\"\n  }]\n}\n</code></pre>\n\n<p>This way, I can have random access to the list of words so I don't have to iterate over it repeatedly. Is there a built-in way to do this in mongoose?</p>\n"},{"tags":["node.js","gzip","piping"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":545,"score":1,"question_id":5771140,"title":"How to gZip content that's passed through a piped readStream","body":"<p>Im currently working on a project that requires the content to be gZip-ed before it's sent back to the browser.</p>\n\n<p>Im currently using a simple read stream and piping the data to the response of a request, but im not sure the best way to gZip content without blocking requests</p>\n\n<p>The line that send the data is:</p>\n\n<pre><code>require('fs').createReadStream(self.staticPath + Request.url).pipe(Response);\n</code></pre>\n\n<p>See the following class is the static handler object:</p>\n\n<pre><code>(function(){\n\n    var StaticFeeder = function()\n    {\n        this.staticPath = process.cwd() + '/application/static';\n        this.contentTypes = require('./contenttypes')\n    }\n\n    StaticFeeder.prototype.handle = function(Request,Response,callback)\n    {\n        var self = this;\n        if(Request.url == '/')\n        {\n            return false;\n        }\n\n        if(Request.url.indexOf('../') &gt; -1)\n        {\n            return false;\n        }\n\n        require('path').exists(this.staticPath + Request.url,function(isthere){\n\n            /*\n             * If no file exists, pass back to the main handler and return\n             * */\n            if(isthere === false)\n            {\n                callback(false);\n                return;\n            }\n\n            /*\n             * Get the extention if possible\n             * */\n            var ext = require('path').extname(Request.url).replace('.','')\n\n            /*\n             * Get the Content-Type\n             * */\n            var ctype = self.contentTypes[ext] !== undefined ? self.contentTypes[ext] : 'application/octet-stream';\n\n            /*\n             * Send the Content-Type\n             * */\n            Response.setHeader('Content-Type',ctype);\n\n            /*\n             * Create a readable stream and send the file\n             * */\n            require('fs').createReadStream(self.staticPath + Request.url).pipe(Response);\n\n            /*\n             * Tell the main handler we have delt with the response\n             * */\n            callback(true);\n        })\n    }\n\n    module.exports = new StaticFeeder();\n})();\n</code></pre>\n\n<p>Can anyone help me get around this problem, i haven't a clue on how to tell the piping to compress with gZip.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":8831508,"title":"Parseable output from NPM","body":"<p>I am trying to write a small application that wraps some functions inside of NPM from another language.  \"npm list\" is giving me output with a nice visual tree, but I need something easier to parse.  -parsable is giving me a flat list of modules, but I would like to have some of the metadata available in \"npm ll\".  Is there a switch or something for NPM that lets me get JSON output?  Right now the only way I can figure to do this is to write a node app that uses the npm module to push json to the standard output. </p>\n"},{"tags":["node.js","http","webserver"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13053708,"title":"Serving a static file with node.js works but not for the linked images/css/js","body":"<p>I am just starting out with node.js and am trying to serve a static index.html file, which of course loads CSS, JS, and images. I have tried by reading the index.html file both by using fs.readFile and with node-static's serveFile.</p>\n\n<p>Both serve the file, but then it cannot find the included CSS, JS, and images. Perhaps it is my paths that are wrong, but here is my directory structure.</p>\n\n<p><img src=\"http://i.stack.imgur.com/FxMzc.png\" alt=\"Workspace structure\"></p>\n\n<p>I have used relative paths to these referenced files from the index.html file. So simply css/main.css. Also, in case they needed to be relative to the server.js file, I did ../css/main.css. And finally in case the path needed to be absolute and the index.html directory was root, so /css/main.css. Nothing is loaded.</p>\n\n<p>What am I doing wrong?</p>\n\n<pre><code>var http = require('http'),\n    fs = require('fs');\n\n\nfs.readFile('../index.html', function (err, html) {\n    if (err) {\n        throw err; \n    }       \n    http.createServer(function(request, response) {  \n        response.writeHeader(200, {\"Content-Type\": \"text/html\"});  \n        response.write(html);  \n        response.end();  \n    }).listen(8080);\n});\n</code></pre>\n\n<p>This serves the file fine.</p>\n\n<p>As I say, I'm still learning.</p>\n\n<p>The node-static 'API' is not very thorough so I reverted back the above route.</p>\n\n<p>Thanks.</p>\n"},{"tags":["javascript","node.js","express","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13058063,"title":"Express and Mongoose based REST API - filter out some properties of an object before returning it to the user","body":"<p>I am building a RESTful API using Express and Mongoose on top of Node.js</p>\n\n<p>I am using certain fields/properties in my Schemas that are reserved for internal use only, they should not be seen by the API users at all.</p>\n\n<p>What is the best way to remove them before I res.send() them? Do I have to do it manually per each route (get, post, update) or is there a general way to filter them out?</p>\n\n<p>I tried using custom middleware, but that did not work - when I placed my middleware before I did use( app.router ) the res.body was undefined, and if i placed it after, my middleware was never called. Also, since in the middleware I am dealing with both single documents and arrays of documents, I'd rather find a way to do it per-document.</p>\n"},{"tags":["node.js","module","require"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13039825,"title":"How to Use one module feature within another module in nodejs require()","body":"<p>I want to use one module feature within another module</p>\n\n<p>file main.js</p>\n\n<pre><code>var _ = require(\"./underscore.js\");\nvar foo = require(\"./bar.js\");\nfoo.publish(...);\n</code></pre>\n\n<p>file bar.js</p>\n\n<pre><code>(function(e) {\n    var array = [...];\n    e.publish = function(t, args) {\n        _.each(array, function(...) {...});\n    });\n})(exports);\n</code></pre>\n\n<p>I've tried a couple of variations, but I am not sure of the best way around this error:</p>\n\n<pre><code>ReferenceError: _ is not defined\n</code></pre>\n"},{"tags":["unit-testing","node.js","mocha"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":185,"score":0,"question_id":10753288,"title":"How to specify test directory for mocha?","body":"<p><a href=\"http://visionmedia.github.com/mocha/\" rel=\"nofollow\">Mocha</a> tries to find test files under <code>test</code> by default, how to specify another dir, e.g. <code>server-test</code>?</p>\n"},{"tags":["node.js","coffeescript","redis","mocha"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12977935,"title":"why won't redis commands work from within my mocha test for coffee script files?","body":"<pre><code>class ThingWithRedis\n  constructor: (@config) -&gt;\n    @redis = require('redis').createClient()\n\n  push: (key, object) -&gt;\n    @redis.set(key, object)\n  fetch: (key, amount) -&gt;\n    @redis.get key, (err, replies) -&gt;\n      console.log \"|#{replies}|\"\n\nmodule.exports = ThingWithRedis\n\n#if you uncomment these lines and run this file, redis works\n\n#twr = new ThingWithRedis('some config value')\n#twr.push('key1', 'hello2')\n#twr.fetch('key1', 1)\n#twr.redis.quit()\n</code></pre>\n\n<p>but from the test:</p>\n\n<pre><code>ThingWithRedis = require '../thing_with_redis'\n\nassert = require('assert')\n\ndescribe 'ThingWithRedis', -&gt;\n  it 'should return the state pushed on', -&gt;\n\n    twr = new ThingWithRedis('config')\n    twr.push('key1', 'hello1')\n    twr.fetch('key1', 1)\n\n    assert.equal(1, 1)\n</code></pre>\n\n<p>you never see 'hello1' be printed.</p>\n\n<p>but when I run coffee thing_with_redis.coffee directly with the bottom lines un-commented you do see 'hello2' printed.</p>\n\n<p>it's when I run:</p>\n\n<p>mocha --compilers coffee:coffee-script</p>\n\n<p>redis seems to just stop working.  Any ideas?</p>\n"},{"tags":["node.js","connect","npm"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1246,"score":2,"question_id":9571239,"title":"Mac OS X NodeJS: has no method 'router' error","body":"<p>Installed NodeJS v0.6.12 on MAC OS X using Mac Ports.  </p>\n\n<pre><code>    win764:node iwaldman$ which node\n         /opt/local/bin/node\n\n    win764:node iwaldman$ node -v\n         v0.6.12\n</code></pre>\n\n<p>Installed connect using npm install connect.</p>\n\n<p>Wrote a simple program, connectServer.js:</p>\n\n<pre><code>    var connect = require('connect');\n    var util    = require('util');\n\n    function sendJSON(response, obj) {\n        response.writeHead(200, {'Content-Type':'application/json'});\n        var objStr = JSON.stringify(obj);\n        util.debug('SENDJSON: ' + objStr);\n        response.end(objStr);\n    }\n\n    var server = connect.createServer(\n    connect.router(function(app){\n        app.get('/foo', function(req, res){\n            sendJSON(res, {path: 'foo'});\n        })\n        app.get('/bar', function(req, res){\n            sendJSON(res, {parth: 'bar'});\n        })\n    })\n    );\n\n    server.listen(3000);\n\n    util.debug('Server running at http://127.0.0.1:3000');\n</code></pre>\n\n<p>Run node connectServer.js.</p>\n\n<p>Get the following error:</p>\n\n<pre><code>    win764:node iwaldman$ node connectserver.js \n\n    node.js:201\n            throw e; // process.nextTick error, or 'error' event on first tick\n                  ^\n    TypeError: Object function createServer() {\n      function app(req, res){ app.handle(req, res); }\n      utils.merge(app, proto);\n      utils.merge(app, EventEmitter.prototype);\n      app.route = '/';\n      app.stack = [].slice.apply(arguments);\n      return app;\n    } has no method 'router'\n        at Object.&lt;anonymous&gt; (/Users/iwaldman/dev/node/connectserver.js:12:10)\n        at Module._compile (module.js:441:26)\n        at Object..js (module.js:459:10)\n        at Module.load (module.js:348:31)\n        at Function._load (module.js:308:12)\n        at Array.0 (module.js:479:10)\n        at EventEmitter._tickCallback (node.js:192:40)\n</code></pre>\n\n<p>Any ideas are appreciated.</p>\n"},{"tags":["node.js","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13049339,"title":"Socket.io-client on node.js works only once","body":"<p>I want to create new sockei.io-client on the server side (with node.js) every time when server gets request. But the code below works only once and then sockei.io-client does't response. Application doesn't stop, no errors.</p>\n\n<pre><code>var http = require(\"http\");\n\n\nhttp.createServer(function(request, response) {\n\nvar io = require('socket.io-client'); \nlocalSocket = io.connect('http://localhost:9876/');\nlocalSocket.on('connect', function (data) {\n                         response.writeHead(200, {\"Content-type\": \"text/plain\"});\n                         response.write(data.name);\n                         response.end();\n                         localSocket.disconnect();\n       });\n\n\n}).listen(8080);\n</code></pre>\n\n<p>Socket.io server (on localhost:9876) works well - it serves clients with names (which is</p>\n\n<pre><code> data.name\n</code></pre>\n\n<p>in the code here).</p>\n\n<p>What is wrong?</p>\n\n<p><b>UPDATE:</b> The problem is solved by myself: To run multiple connection for socket.io-client need to add connect option {'force new connection': true}, like that: </p>\n\n<pre><code>localSocket = io.connect('http://localhost:9876/', {'force new connection': true});\n</code></pre>\n\n<p>Thank you!</p>\n"},{"tags":["javascript","node.js","backbone.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13057664,"title":"Backbone.js client model save issue on server-side error","body":"<p>Wondering if any one can help me out here.</p>\n\n<p>I have a single page on the client side running backbone.js</p>\n\n<p>The server is running socket.io.</p>\n\n<p>I have replaced Backbones default sync with the backbone.iobind sync to support socket.io.</p>\n\n<p>I have a backbone model that on save gets an error response from the server (which is planned), and triggers the save's error function, <strong>however my model on the client side still updates to the new value</strong>. I have included wait:true which from my understanding waits for a success response from the server before updating, however this does not happen for me.</p>\n\n<p><strong>Server side socket.io code</strong></p>\n\n<pre><code>io.sockets.on('connection', function (socket) {\n  socket.on('test:create', function (data, callback) {\n    //err - used to fake an error for testing purposes\n    var err = true;\n    if (err) {\n      // error\n      callback('serv error');\n    } else {\n      // success\n      // The callback accepts two parameters: error and model. If no error has occurred, send null for error.\n      callback(null, data);\n    }\n  });\n</code></pre>\n\n<p><strong>Client Side Code</strong></p>\n\n<pre><code>  //HTML Code\n  //&lt;div id=\"callBtns\"&gt;\n    //&lt;button id=\"runTest\"&gt;Create&lt;/button&gt;\n  //&lt;/div&gt;\n\n\n  var CommunicationType = Backbone.Model.extend({\n    defaults: {\n      runTest: 'default'\n    },\n    urlRoot : '/test',\n    validate: function(attrs) {\n            //return 'error';    \n    }\n  }); \n\n  var BasicView = Backbone.View.extend({    \n    el: $('#callBtns'), \n\n    initialize: function(){\n      _.bindAll(this); \n    },\n\n    events: {\n    \"click #runTest\": \"runTestFn\"\n    },\n\n    runTestFn: function() {\n\n      //causing the issue?\n      communicationType.set({runTest: 'value from set'});     \n\n      communicationType.save({},{\n        success:function(model, serverResponse){\n          console.log('Success');\n          console.log(serverResponse);\n        },\n        error:function(model, serverResponse){\n          console.log('Error');\n          console.log(serverResponse);\n          console.log(JSON.stringify(communicationType));\n        },\n        wait: true\n      });\n    }\n\n  });\n\n  var communicationType = new CommunicationType(); \n  var basicView = new BasicView();\n</code></pre>\n\n<p><strong>I have noticed that this problem looks to be caused by the fact that I'm using set to update my model directly</strong> (<em>communicationType.set({runTest: 'value from set'});</em>)</p>\n\n<p>If I don't set any values before saving, and pass the value in directly to save, like in the code below, it works correctly e.g.</p>\n\n<pre><code>communicationType.save({runTest: 'value from save'},{\n            success:function(....\n</code></pre>\n\n<p>However this then means that I can't ever set any new values/update my model without it going via the save function :/</p>\n\n<p><strong>So my question is, how can I get this working correctly (get the client model to not update if there is a server-side error) while still being able to use set?</strong></p>\n\n<p>Any answers are really appreciated! Many Thanks</p>\n"},{"tags":["javascript","node.js","module","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13057291,"title":"connect.router error and how to re-write it in node","body":"<p>I'm reading \"Beginning Mobile Application Development in the Cloud\" by Richard Rodger and some sample codes use Connect which, I have found, no longer allows direct request processing to the router layer. Here is a sample that gives a 'has no method router' error:</p>\n\n<pre><code>var common = require('./common.js');\nvar util    = common.util;\nvar connect = common.connect;\nvar mongo   = common.mongo;\n\n\nvar server = connect.createServer( \n  connect.router(function(app){ //gives the error: \"has no method 'router'\n\n    // POST {id:&lt;string&gt;}\n    app.post('/todo/stats/init',function(req,res,next){\n      common.readjson(req,function(json){\n        common.sendjson(res,{ok:true,id:json.id});\n      })\n    })\n\n    // POST {time:&lt;UTC-millis&gt;,total:&lt;todos&gt;,done:&lt;done todos&gt;}\n    app.post('/todo/stats/collect/:id',function(req,res,next){\n      var id = req.params.id;\n      common.sendjson(res,{ok:true,id:id});\n      common.readjson(req);\n    })\n  })\n);\n\n\nmongo.init('todo','localhost');\nmongo.open()\n\nserver.listen(3000);\n</code></pre>\n\n<p>Most of the books about node include code that doesn't work and it is very frustrating for someone who begins now to learn and un-learn a minute later. Open Source framework undergoes amazingly fast changes! I just need to learn how to do this the right way. Any thoughts?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":235,"score":0,"question_id":10640749,"title":"Access the list of valid values for an Enum field in a Mongoose.js Schema","body":"<p>The other day I saw a comment on the Web somewhere telling one how to access the list of values defined for an Enum field in a Mongoose.js Schema.  Sadly, I didn't commit that tidbit or its URL to memory and now I need it!</p>\n\n<p>Does anyone know how to do this?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["node.js","static","socket.io","share"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":11274439,"title":"Serve custom static files with socket.io nodejs","body":"<p>I try to share my code betwen server and client I use following code (app.js):</p>\n\n<pre><code>var io = require('socket.io').listen(8000), \n  Static = require('socket.io').Static; \n\nio.configure(function () {\n  var _static = new Static(io); \n\n  // some methods to add my custom files \n\n  _static.add('\\public\\test.js');\n  io.set('static', _static);\n});\n</code></pre>\n\n<p>My file structure looks like this:</p>\n\n<ol>\n<li>root\n<ul>\n<li>app.js</li>\n<li>public\n<ul>\n<li>test.js</li>\n</ul></li>\n</ul></li>\n</ol>\n\n<p>When I type \"http://localhost:8000/public.test.js\" Browser download default file \"Welcome to socket.io\"</p>\n"},{"tags":["windows","node.js","socket.io","nowjs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":614,"score":2,"question_id":11981057,"title":"How to install socket.io on windows 7 x64 (node.js)","body":"<p>Running on a Windows 7 Home Premium 64-bits</p>\n\n<p>Downloaded:</p>\n\n<ul>\n<li>node.js (0.8.7-x64) as a windows msi from the official site</li>\n<li>make-3.81 from <a href=\"http://gnuwin32.sourceforge.net/packages/make.htm\" rel=\"nofollow\">http://gnuwin32.sourceforge.net/packages/make.htm</a> (Complete package, except sources)</li>\n<li>Microsoft visual Studio 2012 Express for web</li>\n</ul>\n\n<p>And then followed the steps at <a href=\"http://blog.nowjs.com/running-nowjs-natively-on-windows\" rel=\"nofollow\">http://blog.nowjs.com/running-nowjs-natively-on-windows</a>, which implied on:</p>\n\n<ul>\n<li>installing the Microsoft Visual C++ Runtime (I got the x64 version)</li>\n<li>grabbing a 'fixed-for-windows' version of now.js from github.com/Flotype/now/zipball/windows</li>\n</ul>\n\n<p>With everything set in place, running any example that requires the 'now' module results in a request for socket.io module.</p>\n\n<p>Running 'npm install socket.io -g' outputs:</p>\n\n<pre><code>C:\\Windows\\System32&gt;npm install socket.io -g\nnpm http GET https://registry.npmjs.org/socket.io\nnpm http 304 https://registry.npmjs.org/socket.io\nnpm http GET https://registry.npmjs.org/policyfile/0.0.4\nnpm http GET https://registry.npmjs.org/socket.io-client/0.9.10\nnpm http GET https://registry.npmjs.org/redis/0.7.2\nnpm http 304 https://registry.npmjs.org/policyfile/0.0.4\nnpm http 304 https://registry.npmjs.org/socket.io-client/0.9.10\nnpm http 304 https://registry.npmjs.org/redis/0.7.2\nnpm http GET https://registry.npmjs.org/hiredis\nnpm http GET https://registry.npmjs.org/uglify-js/1.2.5\nnpm http GET https://registry.npmjs.org/xmlhttprequest/1.4.2\nnpm http GET https://registry.npmjs.org/ws\nnpm http GET https://registry.npmjs.org/active-x-obfuscator/0.0.1\nnpm http 304 https://registry.npmjs.org/hiredis\nnpm WARN package.json hiredis@0.1.14 No README.md file found!\n\n&gt; hiredis@0.1.14 preinstall C:\\Program Files\\nodejs\\node_modules\\socket.io\\node_\nmodules\\redis\\node_modules\\hiredis\n&gt; make || gmake\n\ncd deps/hiredis &amp;&amp; make static\nprocess_begin: CreateProcess(NULL, sh -c \"type cc &gt;/dev/null 2&gt;/dev/null &amp;&amp; echo\n cc || echo gcc\", ...) failed.\nprocess_begin: CreateProcess(NULL, sh -c \"uname -s 2&gt;/dev/null || echo not\", ...\n) failed.\nmake[1]: Entering directory `C:/Program Files/nodejs/node_modules/socket.io/node\n_modules/redis/node_modules/hiredis/deps/hiredis'\nstd=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g\n-ggdb net.c\n'std' não é reconhecido como um comando interno\nou externo, um programa operável ou um arquivo em lotes.\nmake[1]: [net.o] Error 1 (ignored)\nstd=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g\n-ggdb hiredis.c\n'std' não é reconhecido como um comando interno\nou externo, um programa operável ou um arquivo em lotes.\nmake[1]: [hiredis.o] Error 1 (ignored)\nstd=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g\n-ggdb sds.c\n'std' não é reconhecido como um comando interno\nou externo, um programa operável ou um arquivo em lotes.\nmake[1]: [sds.o] Error 1 (ignored)\nstd=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g\n-ggdb async.c\n'std' não é reconhecido como um comando interno\nou externo, um programa operável ou um arquivo em lotes.\nmake[1]: [async.o] Error 1 (ignored)\nar rcs libhiredis.a net.o hiredis.o sds.o async.o\nprocess_begin: CreateProcess(NULL, ar rcs libhiredis.a net.o hiredis.o sds.o asy\nnc.o, ...) failed.\nmake (e=2): O sistema não pode encontrar o arquivo especificado.\nmake[1]: *** [libhiredis.a] Error 2\nmake[1]: Leaving directory `C:/Program Files/nodejs/node_modules/socket.io/node_\nmodules/redis/node_modules/hiredis/deps/hiredis'\nmake: *** [all] Error 2\n'gmake' não é reconhecido como um comando interno\nou externo, um programa operável ou um arquivo em lotes.\nnpm WARN optional dep failed, continuing hiredis@0.1.14\nnpm http 304 https://registry.npmjs.org/uglify-js/1.2.5\nnpm http 304 https://registry.npmjs.org/xmlhttprequest/1.4.2\nnpm http 304 https://registry.npmjs.org/active-x-obfuscator/0.0.1\nnpm http 304 https://registry.npmjs.org/ws\nnpm http GET https://registry.npmjs.org/zeparser/0.0.5\nnpm http GET https://registry.npmjs.org/commander\nnpm http GET https://registry.npmjs.org/tinycolor\nnpm http GET https://registry.npmjs.org/options\nnpm http 304 https://registry.npmjs.org/zeparser/0.0.5\nnpm http 304 https://registry.npmjs.org/commander\nnpm http 304 https://registry.npmjs.org/tinycolor\nnpm http 304 https://registry.npmjs.org/options\n\n&gt; ws@0.4.21 install C:\\Program Files\\nodejs\\node_modules\\socket.io\\node_modules\\\nsocket.io-client\\node_modules\\ws\n&gt; node install.js\n\n[ws v0.4.21] Attempting to compile blazing fast native extensions.\n[ws v0.4.21] Native code compile failed (but the module will still work):\n[ws v0.4.21] The native extensions are faster, but not required.\n[ws v0.4.21] On Windows, native extensions require Visual Studio and Python.\n[ws v0.4.21] On Unix, native extensions require Python, make and a C++ compiler.\n\n[ws v0.4.21] Start npm with --ws:verbose to show compilation output (if any).\nsocket.io@0.9.10 C:\\Program Files\\nodejs\\node_modules\\socket.io\n+-- policyfile@0.0.4\n+-- redis@0.7.2\n+-- socket.io-client@0.9.10 (xmlhttprequest@1.4.2, uglify-js@1.2.5, active-x-obf\nuscator@0.0.1, ws@0.4.21)\n</code></pre>\n\n<p>Am I missing something? Also tried with versions 0.8.6-x64 and 0.8.5-x64 of node.js, both also packaged as msi.</p>\n\n<p>Additionally, placing the fixed-for-windows version of now.js directly in a node_modules folder insite the helloworld_server.js example and running 'node helloworld_server.js' produces:</p>\n\n<pre><code>[Error: no errorc:\\xampp\\htdocs\\node-tcg\\node_modules\\now\\bin\\proxy.node]\nError: no errorc:\\xampp\\htdocs\\node-tcg\\node_modules\\now\\bin\\proxy.node\n    at Object.Module._extensions..node (module.js:485:11)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (c:\\xampp\\htdocs\\node-tcg\\node_modules\\now\\lib\\proxy.j\ns:10:13)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n</code></pre>\n"},{"tags":["javascript","node.js","google-chrome","garbage-collection","v8"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13056591,"title":"Does V8 garbage collection free memory?","body":"<p>I was reading the <a href=\"https://developers.google.com/v8/design#garb_coll\" rel=\"nofollow\">V8 docs</a> and it says that the garbage collector \"reclaims\" memory.</p>\n\n<p>My question is does it \"reclaim\" the memory to be used in its own heap or does it free it?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["node.js","putty","remote-access"],"answer_count":5,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":714,"score":6,"question_id":5662784,"title":"how to run node js remotely","body":"<p>I am running node using putty. but it doesn't work when putty session expire. How can I start node js permanently, should not be terminated if putty session end.</p>\n"},{"tags":["node.js","mongodb","express","restify"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":13044801,"title":"Node.js/Mongojs nested db callbacks return","body":"<p>I am implementing a restify middleware for session authentication. The function contains nested asynchronous db calls: db.sessions.remove() within the callback of db.sessions.findOne(). </p>\n\n<p>The 'return' statements are confusing me because I'm not sure if I am returning next() or next(err) from the callback back to verifyUserSession(), or is it just returning from verifyUserSessions? Am I doing this right?</p>\n\n<pre><code>function verifyUserSession(req, res, next) {\n\n\nif (req.headers.sessionKey) \n{\n    db.sessions.findOne(req.headers.sessionKey, function(err, session) {\n\n        if (err) \n        {\n            return next(err);\n        }\n        if (!session) \n        {\n            return next(new Error({'message': 'Session does not exist'}));\n        }\n\n        if ((new Date().getTime() - session.timestamp.getTime())/86400000 &gt; 60)\n        {\n            db.sessions.remove({sessionKey: req.headers.sessionKey}, function(err){\n                if (err) \n                {\n                    return next(err);\n                }\n                return next(new Error({'message': 'Session expired'}));\n            });\n        }\n        else\n        {\n            // session ok\n        }\n    });\n}\n}\n</code></pre>\n"},{"tags":["node.js","mongodb","heroku","replication","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13026756,"title":"Heroku + mongoose connection error: no primary server found in set","body":"<p>I have a mongodb replica set on mongolab. </p>\n\n<p>I'm using nodejs + mongoose. When I'm trying to connect from my local machine everything goes ok. \nBut after deployment to heroku something wrong happens and mongoose got strange error: </p>\n\n<pre><code>[Error: no primary server found in set]\n</code></pre>\n\n<p>Here some code (server.js): </p>\n\n<pre><code>async.series([\n  function(callback){\n    console.log('DB Connection: ' + siteConf.mongo_url);\n    mongoose.connect(siteConf.mongo_url, siteConf.mongo_options, callback);\n  },      \n  function(callback){\n    http.createServer(app).listen(siteConf.port, callback);\n  }\n],\nfunction(err, results){\n\n if (err) {\n   console.log(err);\n }\n\n console.log('Running in ' + (process.env.NODE_ENV || 'development') + ' mode @ ' + siteConf.uri);\n  }\n);\n</code></pre>\n\n<p>This url I'm using as connection string: </p>\n\n<pre><code>mongodb://username:password@someid-a0.mongolab.com:39897/pm_prod,mongodb://someid-a1.mongolab.com:39897\n</code></pre>\n\n<p>The main thing I can't understand is: what is the differences between my maching and heroku cloud hosting. </p>\n\n<p>I already tried to remove node_modules and npm install them to be sure that I have same versions as on heroku. (Because heroku do this on each deploy). </p>\n\n<p>Thanks, and sorry for my bad english</p>\n"},{"tags":["node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13053788,"title":"Node js check if a var is a function","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5999998/how-can-i-check-if-a-javascript-variable-is-function-type\">How can I check if a javascript variable is function type?</a>  </p>\n</blockquote>\n\n\n\n<p>How i check if a variable is a function\nfor Array exist <code>Array.isArray()</code>\nbut <code>Function.isFunction</code> dos'nt exist</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13049309,"title":"Creating a Stack like behavior is JavaScript/Node","body":"<p>So I have a block of code that looks like this:</p>\n\n<pre><code>  stack.forEach(function(element){\n    //sys.puts(sys.inspect(element, false, null));\n    console.log('-----element start-----');\n    console.log(element.type + ':' + element.raw);\n    console.log('-----element end-----');\n\n    if(element.children){\n      element.children.forEach(function(childElement){\n        stack.push(childElement);\n      });\n    }\n  });\n</code></pre>\n\n<p>The issue is that this is not behaving like I would except a stack to behave and wondering if this in an issue with JavaScript itself.  The issue I am seeing if that when I call the stack.push for each child to add it to the stack for processing, the initial stack.forEach() does not seem to be picking it up and it is only logging to top level elements. If I try to do another stack.forEach() directly after this one, it then displays the next level of child elements so I know .push is diffidently adding the child elements to the stack.  </p>\n\n<p>It almost seems like .forEach() grabs the data as it is and does not get an updates if they happen within the foreach.  Is this true for JavaScript?  Is there a different way I can accomplish the same thing (be able to process a top level element and all levels of children elements below it)?</p>\n"},{"tags":["node.js","phantomjs","casperjs"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":649,"score":2,"question_id":11531448,"title":"grab the resource contents in casperjs or phantomjs","body":"<p>I see that casperjs has download function and on resource received callback but I do not see the contents of a resource in the callback and I don't want to download the resource to the filesystem. I want to grab the contents of the resource so that I can do somethiing with it in my script.  Is this possible with casperjs or phantomjs?</p>\n"},{"tags":["node.js","pubsubhubbub","superfeedr"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13052810,"title":"Pubsubhubbub library for NodeJs","body":"<p>I have a system where various rss feeds are added. I want to follow the content and be notified when new content is added in the feeds without having to check them one by one.</p>\n\n<p>I found out there is a pubsubhubbub protocol and that publishers can use various hubs which implement this protocol in their feeds. This is how I found out about superfeedr and I'm trying to work with their XMPP API. I installed their nodejs library (http://blog.superfeedr.com/node-superfeedr/) and made a few subscribe tests that worked fine.</p>\n\n<p>Now, here come the questions:</p>\n\n<ul>\n<li>is it possible to use the node superfeedr module to subscribe to a feed that doesn't use superfeedr? For example I found one that has:</li>\n</ul>\n\n<p>link rel='hub' href='http://pubsubhubbub.appspot.com/'</p>\n\n<ul>\n<li><p>if not, is there any other node library that I can use for pubsubhubbub hubs?</p></li>\n<li><p>do I have to handle each hub separately or I can just send them the same requests based on the protocol?</p></li>\n</ul>\n\n<p>Thank you in advance for your help.</p>\n"},{"tags":["node.js","express"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1522,"score":1,"question_id":8393275,"title":"How to programmatically simulate a 404 error with Express/Node?","body":"<p>I want to simulate a 404 error on my Express/Node server. How can I do that?</p>\n"},{"tags":["javascript","node.js","request","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13051619,"title":"node.js service request a secured website","body":"<p>I want to request or better pull data from a 3rd party website and parse the information afterwords. Parsing is not the topic here. I am interessted in the automatical request. What are my options and how to handle the security thing (authentication, authorization).</p>\n\n<p>I have a simple node server just using connect. I also use the npm module \"request\" to process my request to the 3rd party website. I have also a url and the user and password. But I have not much information than the 3rd party website is a JSP (XSP) Webapplication running on tomcat which places a JSESSIONID after login.\nI tryed to add the header \"Authorization\": \"Basic\" with user:password as byte64 which did not work. Any other options, ideas?</p>\n\n<p>Thanks for any comments and tips..</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13051381,"title":"Library for client using socket.io","body":"<p>I'm new to node.js, so my question might be totally idiotic, but here we go:</p>\n\n<p>I've read many articles about how to use socket.io, and to build the server is quite straightforward, but when it comes the client, it always start with:</p>\n\n<pre><code>&lt;script src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>and I have no idea where is this file coming from.</p>\n\n<p>Can someone please explain me what I'm missing?</p>\n\n<p>index.html:</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"utf-8\"/&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;WE DO Chat&lt;/h1&gt;\n\n        &lt;script src=\"http://localhost:1180/nodetest/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>main.js:</p>\n\n<pre><code>var io = require('socket.io').listen(1180);\n\nio.sockets.on('message', function (message, callback) {\n    socket.broadcast.emit(message);\n});\n\nio.sockets.on('connect', function (socket) {\n    console.log(\"Client connected\");\n});\n</code></pre>\n"},{"tags":["mysql","node.js","architecture","asynchronous"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13051056,"title":"mysql insert at the same time?","body":"<p>im fetching simultaneous data from some api using nodejs. my database is mysql.</p>\n\n<p><code>INSERT into mysql(tabels) values (values)</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/ABaPj.png\" alt=\"enter image description here\"></p>\n\n<p>the problem is sometimes the api doesnt run nor stop maybe becouse a timeout error(sometimes) or something;</p>\n\n<ol>\n<li><p>what happens if the we query insert at the same time?</p></li>\n<li><p>how do you insert hundreds of data async simultaneously from many source? </p></li>\n<li><p>how do you do it? is there any database like mangodb or anything maybe already built for something like this?</p></li>\n</ol>\n"},{"tags":["node.js","express","mustache"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":387,"score":3,"question_id":10358053,"title":"Node.js + Express - How to get Mustache partials working?","body":"<p>I'm trying to get Mustache working properly with Express, and as one can guess, I'm having troubles.</p>\n\n<p>The following line initializes Mustache nice and clean. Variables render as expected.</p>\n\n<pre><code>app.register('html', require(__dirname+'/public/js/libs/mustache.js'));\n</code></pre>\n\n<p>However, the problems start to rise when partials are thrown in the mix. With Mustache, this here partial should invoke header view/partial.</p>\n\n<pre><code>{{&gt; header}}\n</code></pre>\n\n<p>But alas, nothing happens. :/ Even when I offer the partial directly, Mustache fails to render it.</p>\n\n<pre><code>app.get('/', function(req, res) {\n    res.render('welcome', {\n        partials: {\n            header: '&lt;h1&gt;Header&lt;/h1&gt;'           \n        }\n    });\n});\n</code></pre>\n\n<p>So, it seems that the partials aren't working at all. I've found one hack that get's the partials somewhat working:</p>\n\n<p><a href=\"http://bitdrift.com/post/2376383378/using-mustache-templates-in-express\" rel=\"nofollow\">http://bitdrift.com/post/2376383378/using-mustache-templates-in-express</a></p>\n\n<p>After that the partials render when offered directly at render call (see above), but it still fails on rendering the partials directly to views/layouts:</p>\n\n<p><strong>Layout looks something like this:</strong></p>\n\n<pre><code>Behold, the header\n{{&gt; header}}\n&lt;p&gt;Let's move to more important stuff...&lt;/p&gt;\n</code></pre>\n\n<p><strong>Header view looks something like this:</strong></p>\n\n<pre><code>&lt;h1&gt;Header&lt;/h1&gt;\n</code></pre>\n\n<p>Express can load the views by themselves just ok, but it doesn't know how to handle the Mustache partials...</p>\n"},{"tags":["node.js","redis","pipeline"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13050656,"title":"What's pipelining in node.js?","body":"<p><a href=\"https://github.com/mranney/node_redis\" rel=\"nofollow\">node_redis</a> states</p>\n\n<blockquote>\n  <p>The performance of node_redis improves dramatically with pipelining, \n  which happens automatically in most normal programs.</p>\n</blockquote>\n\n<p>I'm writing the program myself, so what's meant here? Does that mean simply <code>non-blocking</code>?</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":1444,"score":7,"question_id":8837236,"title":"How to connect two node.js servers with websockets?","body":"<p>Here's my problem:</p>\n\n<p>I have server A, running node.js and using socket.io for communicating with clients (web browsers). This all is running fine and dandy.</p>\n\n<p>However, now that I have server B, which also needs to connect to server A through websockets, I have hit a wall. None of the node.js websocket clients I've found won't work with the socket.io on the server A.</p>\n\n<p>So, this is the case I'm striving for:</p>\n\n<pre><code>.--------.      .----------.      .----------.\n| CLIENT | &lt;--&gt; | SERVER A | &lt;--&gt; | SERVER B |\n'--------'      '----------'      '----------'\n</code></pre>\n\n<p>Client-server A connection is done through socket.io</p>\n\n<p>Now, Server B (running node.js) should connect to server A via websocket (in order to go through port 80). But...</p>\n\n<p>Even the example code in socket.io-client module doesn't work... :/</p>\n\n<pre><code>// Connect to server\nvar socket = new io.Socket('localhost', {port: 8080});\nsocket.connect();\n\n// Add a connect listener\nsocket.on('connect', function(socket) { \n    console.log('Connected.');\n});\n</code></pre>\n\n<p>The code just passes without any errors and execution ends after few seconds.</p>\n\n<p>Update: Code samples</p>\n\n<p>Server (which works just fine) looks like this:</p>\n\n<pre><code>// Load requirements\nvar http = require('http'),\n    io = require('socket.io');\n\n// Create server &amp; socket\nvar server = http.createServer(function(req, res){\n\n    // Send HTML headers and message\n    res.writeHead(404, {'Content-Type': 'text/html'});\n    res.end('&lt;h1&gt;Aw, snap! 404&lt;/h1&gt;');\n});\nserver.listen(8080);\nio = io.listen(server);\n\n// Add a connect listener\nio.sockets.on('connection', function(socket) { \n\n    console.log('Client connected.');\n\n    // Disconnect listener\n    socket.on('disconnect', function() {\n        console.log('Client disconnected.');\n    });\n});\n</code></pre>\n\n<p>Client looks like this</p>\n\n<pre><code>console.log('1');\n\n// Connect to server\nvar io = require('socket.io-client')\nvar socket = new io.Socket('localhost', {port: 8080});\nsocket.connect();\n\nconsole.log('2');\n\n// Add a connect listener\nsocket.on('connect', function(socket) { \n    console.log('Connected!');\n});\n\nconsole.log('3');\n</code></pre>\n\n<p>1, 2 and 3 prints out just fine, no errors, and few seconds later the process just exits</p>\n\n<p>Also, server A doesn't output anything to the log, even though I have the socket.io logging set on \"everything\".</p>\n"},{"tags":["node.js","https","express","tls"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13050151,"title":"node.js + express + secureConnection event in https","body":"<p>I am a beginner in node.js. Here is what I am trying to do using express + https.<br>\n- node.js https server on port 443 <br>\n- C client connects to sever<br>\n- Mobile client connects to server and does GET<br>\n- node.js server sends GET request to C client and sends response back to mobile device</p>\n\n<p>While sending GET request from node.js to C client, I could not get hold of TLS socket instance. </p>\n\n<p>The node.js https documentation says </p>\n\n<pre><code>Class: https.Server# \n\nThis class is a subclass of tls.Server and emits events same as http.Server. See\nhttp.Server for more information.\n</code></pre>\n\n<p>after storing socket <br> </p>\n\n<pre><code>https.on('connection', function(socket) {\nglobal_https_obj[0]=socket;\n});\n</code></pre>\n\n<p>and doing <code>global_https_obj[0].write(\"DEADBEEF\")</code> .. it sends plain text traffic without SSL header and client blocks on <code>SSL_read() [openSSL]</code>[ C client does receives GET request but openSSL gives decryption alert and fails to decrypt it ]  </p>\n\n<p>It seems TLS socket is accessible through <code>secureConnection</code> event and is not emitted by https. </p>\n\n<p>guys is there any way get hold of TLS socket? or is it possible to add secureConnection event listener in https?</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13048437,"title":"Nodejs + expressjs replays request after server timeout","body":"<p>I am trying to import huge amount of data in a node + express app via app.get(\"/importdata\" , callback).  At the timeout and if the request is not complete, it replays the request again and my server starts importing the same data again.</p>\n\n<p>I am not able to find the exact reason why the request is being replayed after the connection timeout ?</p>\n\n<p>A portion of problem is solved if i set my timeOut period to some huge number but i am not understanding exactly why the request is played again ?</p>\n\n<p>Thanks a lot in advance.</p>\n\n<p>piece from my server.js</p>\n\n<pre><code>app.get('/impdata', function(req, res){\nreq.connection.setTimeout(600000);\nconsole.log(\"impstore---------------&gt;\");\n    Q.when( getData(req.data), function(resp){\n        res.json(resp);\n    }); });\n</code></pre>\n\n<p>Piece from my console </p>\n\n<p>impstore--------------->\nuserid \ntime stamp Wed Oct 24 2012 16:35:28 GMT+0530 (IST)\nListings got 100\nuserid \nims 1\ntime stamp recursive\nListings got 200\nuserid \nims 1\ntime stamp recursive\nListings got 300\nuserid \nims 1\ntime stamp recursive\nListings got 400\nuserid \nims 1\ntime stamp recursive\nListings got 500\nuserid \nims 1\ntime stamp recursive\nListings got 600\nuserid \nims 1\ntime stamp recursive\nListings got 700\nuserid \nims 1\ntime stamp recursive\nListings got 800\nuserid \nims 1\ntime stamp recursive\nListings got 900\nuserid \nims 1\ntime stamp recursive\nimpstore--------------->\nuserid \ntime stamp Wed Oct 24 2012 16:37:28 GMT+0530 (IST)\nListings got 1000\nuserid \nims 1\ntime stamp recursive\nListings got 100\nuserid \nims 1</p>\n\n<p>For information : I am getting data in chunks of 100\nI receive 900 data listings and then the server times out but as we can see on the console the request is made again  check the last 2 sets , 1st one shows the next 100 i.e listings now increase to 1000 and the second one says listings are 100 and when the whole process is complete , i have 2 similar objects .</p>\n\n<p>Hopefully i explained well.</p>\n"},{"tags":["performance","apache","node.js","apache2"],"answer_count":6,"favorite_count":5,"up_vote_count":17,"down_vote_count":0,"view_count":2375,"score":17,"question_id":6634299,"title":"Node.js slower than Apache","body":"<p>I am comparing performance of Node.js (0.5.1-pre) vs Apache (2.2.17) for a very simple scenario - serving a text file.</p>\n\n<p>Here's the code I use for node server:</p>\n\n<pre><code>var http = require('http')\n  , fs = require('fs')\n\nfs.readFile('/var/www/README.txt',\n    function(err, data) {\n        http.createServer(function(req, res) {\n            res.writeHead(200, {'Content-Type': 'text/plain'})\n            res.end(data)\n        }).listen(8080, '127.0.0.1')\n    }\n)\n</code></pre>\n\n<p>For Apache I am just using whatever default configuration which goes with Ubuntu 11.04</p>\n\n<p>When running Apache Bench with the following parameters against <strong>Apache</strong></p>\n\n<pre><code>ab -n10000 -c100 http://127.0.0.1/README.txt\n</code></pre>\n\n<p>I get the following runtimes:</p>\n\n<pre><code>Time taken for tests:   1.083 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      27630000 bytes\nHTML transferred:       24830000 bytes\nRequests per second:    9229.38 [#/sec] (mean)\nTime per request:       10.835 [ms] (mean)\nTime per request:       0.108 [ms] (mean, across all concurrent requests)\nTransfer rate:          24903.11 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.8      0       9\nProcessing:     5   10   2.0     10      23\nWaiting:        4   10   1.9     10      21\nTotal:          6   11   2.1     10      23\n\nPercentage of the requests served within a certain time (ms)\n  50%     10\n  66%     11\n  75%     11\n  80%     11\n  90%     14\n  95%     15\n  98%     18\n  99%     19\n 100%     23 (longest request)\n</code></pre>\n\n<p>When running Apache bench against <strong>node</strong> instance, these are the runtimes:</p>\n\n<pre><code>Time taken for tests:   1.712 seconds\nComplete requests:      10000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      25470000 bytes\nHTML transferred:       24830000 bytes\nRequests per second:    5840.83 [#/sec] (mean)\nTime per request:       17.121 [ms] (mean)\nTime per request:       0.171 [ms] (mean, across all concurrent requests)\nTransfer rate:          14527.94 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.9      0       8\nProcessing:     0   17   8.8     16      53\nWaiting:        0   17   8.6     16      48\nTotal:          1   17   8.7     17      53\n\nPercentage of the requests served within a certain time (ms)\n  50%     17\n  66%     21\n  75%     23\n  80%     25\n  90%     28\n  95%     31\n  98%     35\n  99%     38\n 100%     53 (longest request)\n</code></pre>\n\n<p>Which is clearly slower than Apache. This is especially surprising if you consider the fact that Apache is doing a lot of other stuff, like logging etc.</p>\n\n<p>Am I doing it wrong? Or is Node.js really slower in this scenario?</p>\n\n<p><strong>Edit 1</strong>: I do notice that node's concurrency is better - when increasing a number of simultaneous request to 1000, Apache starts dropping few of them, while node works fine with no connections dropped.</p>\n"},{"tags":["node.js","express","connect"],"answer_count":5,"favorite_count":5,"up_vote_count":5,"down_vote_count":0,"view_count":2066,"score":5,"question_id":8749907,"title":"What is a good session store for a single-host Node.js production app?","body":"<p>I'm using Node's Express w/ Connect middleware.  Connect's memory session store isn't fit for production:</p>\n\n<blockquote>\n<pre><code>Warning: connection.session() MemoryStore is not designed for a production environment, as it will leak memory, and obviously only work within a single process.\n</code></pre>\n</blockquote>\n\n<p>For larger deployments, mongo or redis makes sense.  </p>\n\n<p>But what is a good solution for a single-host app in production? </p>\n"},{"tags":["node.js"],"answer_count":4,"favorite_count":10,"up_vote_count":12,"down_vote_count":0,"view_count":2610,"score":12,"question_id":4213351,"title":"Make node.js not exit on error","body":"<p>I am working on a websocket oriented node.js server using Socket.IO. I noticed a bug where certain browsers aren't following the correct connect procedure to the server, and the code isn't written to gracefully handle it, and in short, it calls a method to an object that was never set up, thus killing the server due to an error.</p>\n\n<p>My concern isn't with the bug in particular, but the fact that when such errors occur, the entire server goes down. Is there anything I can do on a global level in node to make it so if an error occurs it will simply log a message, perhaps kill the event, but the server process will keep on running?</p>\n\n<p>I don't want other users' connections to go down due to one clever user exploiting an uncaught error in a large included codebase.</p>\n"},{"tags":["javascript","node.js","redis","socket.io"],"answer_count":0,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":84,"score":4,"question_id":13028613,"title":"Nodejs Publish from Client in pub/sub","body":"<p>I am trying to build a small app in nodejs to publish and subscribe. I am stucked in how I can publish from client side. Here is the code I have. </p>\n\n<p>Here is my server code (server.js)</p>\n\n<pre><code>var express = require('express'),\napp = express(),\nhttp = require('http'),\nserver = http.createServer(app);\napp.use(express.bodyParser());\n\napp.get('/', function(req, res) {\n  res.sendfile(__dirname + '/public/index.html');  \n});\n\napp.post('/publish/:channel/:event/', function(req, res) {\n  console.log(\"**************************************\");\n  var params = req.params;\n  console.log(req.params);\n  console.log(req.body);\n  var data = req.body;\n  console.log(\"**************************************\");\n  var result = io.sockets.emit(params.channel,{event:params.event,data:data});\n  //console.log(result);\n  console.log(\"**************************************\"); \n  res.sendfile(__dirname + '/public/index.html');  \n});\n\n//include static files\napp.use(express.static(__dirname + '/public'));\n\nserver = server.listen(3000);\nvar io = require('socket.io').listen(server);\n\nio.sockets.on('connection', function (s) {\n  socket = s\n  socket.emit('c1', { hello: 'world' });\n\n  socket.on('test', function (data) {\n    socket.emit('c1', { hello: 'world' });\n    console.log('test');console.log(data);\n  });\n});\n</code></pre>\n\n<p>And here is client code</p>\n\n<pre><code>var narad = {};\nnarad.url = 'http://192.168.0.46:3000';\n\nnarad.lisentingChannels = {}\n\nvar socket = io.connect(narad.url);\n\nfunction Channel(channelName) {\n  this.channelName = channelName; //serviceObject is the object of \n  this.events = {};\n};\n\nChannel.prototype.bind = function (event, callback) {\n   this.events[event] = callback;\n};\n\nnarad.subscribe = function (channelName)  {\n  var channel = new Channel(channelName)\n  this.lisentingChannels[channelName] = channel;\n\n  socket.on(channelName, this.callbackBuilder(channel))\n\n  return this.lisentingChannels[channelName];\n}\n\nnarad.callbackBuilder = function (channel) {\n  return function (data) {\n    var callback = channel.events[data[\"event\"]];\n    callback(data.data);\n  }\n}\n</code></pre>\n"},{"tags":["node.js","mongodb","csv","remote-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13047880,"title":"I need to call mongoexport remotely and get the result from node.js","body":"<p>I'm not sure how to go about this, I need to export a mongodb collection as an .csv. Calling mongoexport with spawn.child_process in node will accomplish this but my mongodb server and node server are currently on separate machines. </p>\n\n<p>How can I remotely call mongoexport on my mongo server from my node server and then get the .csv to the node server?</p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":34,"up_vote_count":96,"down_vote_count":0,"view_count":28337,"score":96,"question_id":5311334,"title":"What is the purpose of NodeJS module.exports and how do you use it?","body":"<p>I cant seem to find any info on this but it appears to be a rather important part of NodeJS as I often see it in source code.  </p>\n\n<p>According to the <a href=\"http://nodejs.org/docs/v0.4.2/api/globals.html#module\" rel=\"nofollow\">node docs</a> :</p>\n\n<blockquote>\n  <p><strong>module</strong> </p>\n  \n  <p>A reference to the current\n  <code>module</code>. In particular <code>module.exports</code>\n  is the same as the exports object. See\n  <code>src/node.js</code> for more information.</p>\n</blockquote>\n\n<p>But this doesnt really help.</p>\n\n<p>Can anyone explain what exactly <code>module.exports</code> does, and maybe give a simple example.</p>\n\n<p>Thanks</p>\n"},{"tags":["process","node.js","binary"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":2463,"score":6,"question_id":6164095,"title":"Reading binary data from a child process in Node.js","body":"<p>When trying to read data in Node.js from an ImageMagick child process, it comes out corrupted.</p>\n\n<p>A simple test case would be the following:</p>\n\n<pre><code>var fs = require('fs');\nvar exec = require('child_process').exec;\n\nvar cmd = 'convert ./test.jpg -';\nexec(cmd, {encoding: 'binary', maxBuffer: 5000*1024}, function(error, stdout) {\n  fs.writeFileSync('test2.jpg', stdout);\n});\n</code></pre>\n\n<p>I would expect that to be the equivalent of the command line <code>convert ./test.jpg - &gt; test2.jpg</code> that does write the binary file correctly.</p>\n\n<p>Originally there was a problem with the maxBuffer option being too small and resulting in a truncated file. After increasing that, the file now appears slightly larger than expected and still corrupted.\nThe data from stdout is required to send over HTTP.</p>\n\n<p>What would be the correct way to read this data from the ImageMagick stdout?</p>\n"},{"tags":["node.js","express","mongoose","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13043795,"title":"Node.js, Expressjs, Mongo, Jade: `new` action passing initialized mongo instance resulting in 'ReferenceError: jade is not defined'","body":"<p>Source: <a href=\"https://github.com/davidglivar/simplecompviewer\" rel=\"nofollow\">github</a></p>\n\n<p>In trying to pass a freshly instantiated mongoose.model through expressjs' <code>render</code> function, I come upon the following error: \"ReferenceError: jade is not defined\"</p>\n\n<p>The controller...</p>\n\n<pre><code>var mongoose = require(\"mongoose\")\n  , Client = mongoose.model(\"Client\")\n\nexports.new = function (req, res) {\n    res.render(\"clients/new\", {\n        headline: \"New Client\",\n        client: new Client({})\n    })\n}\n</code></pre>\n\n<p>I have also tried <code>client: new Client()</code>, storing the instantiated object in a var then passing it to the final render object with no change. Removing the <code>new Client({})</code> bit gets past the 500 error, but does not solve the issue at hand.</p>\n\n<p>Some config...</p>\n\n<pre><code>app.set(\"views\", __dirname + \"/app/views\")\napp.set(\"view engine\", \"jade\")\n</code></pre>\n\n<p>The model...</p>\n\n<pre><code>var mongoose = require(\"mongoose\")\n  , Schema = mongoose.Schema\n\nvar Client = new Schema({\n    company: { type: String },\n    contact: {\n        name: { type: String },\n        phone: { type: String },\n        email: { type: String }\n    },\n    created: { type: Date, default: Date.now }\n})\n\nmongoose.model(\"Client\", Client)\n</code></pre>\n\n<p>Node v0.8.12<br>\nExpress >= v3.0.0<br>\nMongoose v3.3.1<br>\nJade v0.27.6  </p>\n\n<p>Source: <a href=\"https://github.com/davidglivar/simplecompviewer\" rel=\"nofollow\">github</a></p>\n"},{"tags":["javascript","node.js"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":475,"score":1,"question_id":7381583,"title":"Node.js ReadStream never calls 'data' listener","body":"<p>I have a file called a.txt which I can open and read using fs.readFile. However, I can't seem to read it with createReadStream:</p>\n\n<pre><code>var fs = require('fs');\n\nvar stream = fs.createReadStream('a.txt');\nstream.on('data', function() { console.log('data present'); });\n</code></pre>\n\n<p>This never prints anything, what am I missing?</p>\n"},{"tags":["node.js","express"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":13036286,"title":"express.js sample apps","body":"<p>I am starting an express.js project. I want to look at code of exiting large apps, especially their file system structure. Anyone knows of apps that use express.js and are on github?</p>\n"},{"tags":["node.js","browser","headless","zombie.js"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13042599,"title":"Zombie.js browser not returning full html?","body":"<p>I'm trying to figure out Zombie.js.</p>\n\n<p>I have this script:</p>\n\n<pre><code>var Browser = require(\"zombie\");\nvar assert = require(\"assert\");\n\nBrowser.visit(\"http://web.mit.edu\", function (e,browser) {\n  console.log(browser.html());\n});\n</code></pre>\n\n<p>That just visits the page and logs the html, but I'm getting html that doesn't match what the source file I get in a normal browser.</p>\n\n<p>Zombie.js output:</p>\n\n<pre><code>&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n  &lt;head&gt;\n    &lt;title&gt;MIT - Massachusetts Institute of Technology&lt;/title&gt;\n    &lt;meta name=\"keywords\" content=\"Massachusetts Institute of Technology, MIT\" /&gt;\n    &lt;meta name=\"description\" content=\"MIT is devoted to the advancement of knowledge and education of students in areas that contribute to or prosper in an environment of science and technology.\" /&gt;\n    &lt;meta name=\"robots\" content=\"index,follow,noodp,noydir\" /&gt;\n    &lt;meta name=\"allow-search\" content=\"yes\" /&gt;\n    &lt;meta name=\"language\" content=\"en\" /&gt;\n    &lt;meta name=\"distribution\" content=\"global\" /&gt;\n    &lt;meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\" /&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;\n    &lt;meta http-equiv=\"Expires\" content=\"Tue, 01 Jan 1980 1:00:00 GMT\" /&gt;\n    &lt;meta http-equiv=\"Pragma\" content=\"no-cache\" /&gt;\n    &lt;meta http-equiv=\"cache-control\" content=\"no-store\" /&gt;\n    &lt;link rel=\"canonical\" href=\"http://web.mit.edu\" /&gt;\n    &lt;link rel=\"image_src\" href=\"http://web.mit.edu/img/MIT_logo.gif\" /&gt;\n    &lt;link rel=\"search\" type=\"application/opensearchdescription+xml\" href=\"http://web.mit.edu/opensearch.xml\" title=\"MIT - Massachusetts Institute of Technology\" /&gt;\n    &lt;link href=\"https://plus.google.com/104984516469461796485/\" rel=\"publisher\" /&gt;\n    &lt;!-- icons --&gt;\n    &lt;link rel=\"shortcut icon\" href=\"/favicon.ico\" /&gt;\n    &lt;!-- rss --&gt;\n    &lt;link rel=\"alternate\" type=\"application/rss+xml\" title=\"MIT - Home Page News\" href=\"http://feeds.feedburner.com/mit/news-homepage\" /&gt;\n    &lt;!-- style sheets - global --&gt;\n    &lt;link href=\"styles/style3536.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\" /&gt;\n    &lt;script src=\"http://dnn506yrbagrg.cloudfront.net/pages/scripts/0011/6778.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\" src=\"http://www.google-analytics.com/ga.js\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\"&gt; \n        var _gaq = _gaq || [];\n        _gaq.push(\n            ['_setAccount', 'UA-1592615-11'],\n            ['_trackPageview','/'],\n            ['rollup._setAccount', 'UA-31439876-1'],\n            ['rollup._trackPageview', '/mit/www/']\n        );\n        (function() {\n        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n        })();   \n    &lt;/script&gt;\n    &lt;style type=\"text/css\" media=\"screen\"&gt;#flashcontent {visibility:hidden}#flashcontent {visibility:visible}&lt;/style&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;a href=\"http://events.mit.edu/\"&gt;Tuesday, October 23, 2012&lt;/a&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And the real source is really long, check it out at <a href=\"http://web.mit.edu\" rel=\"nofollow\">http://web.mit.edu</a></p>\n\n<p>What's going on?</p>\n"},{"tags":["node.js","express","template-engine"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":144,"score":1,"question_id":12471043,"title":"node express template engine that supports layouts and partials","body":"<p>Is there a good way of doing templating (that allows me to write html -- not jade), that will support layouts and partials?</p>\n\n<p>I have only been able to use ejs with express-partials npm plugin to get this behavior. However I feel the ejs site is out of date and not well supported.</p>\n\n<p>I'm looking for good examples.</p>\n\n<p>I want to create a main layout that would have header + footer and include a separate template for the nav for example.</p>\n\n<p>Knockoutjs looks well supported, but I cannot find many examples of using it with express.</p>\n\n<p>Update: I found a pretty good article here from LinkedIn's evaluation of js templates: <a href=\"http://engineering.linkedin.com/frontend/client-side-templating-throwdown-mustache-handlebars-dustjs-and-more\" rel=\"nofollow\">http://engineering.linkedin.com/frontend/client-side-templating-throwdown-mustache-handlebars-dustjs-and-more</a></p>\n"},{"tags":["javascript","node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":47,"score":3,"question_id":13044685,"title":"Socket.io node.js Math.random get different results on all users","body":"<p>I'm currently developing a poker texas holdem application using node.js, socket.io and javascript. </p>\n\n<p>The problem I'm having is when I try to shuffle the deck using a math.random function it shuffles the deck as intended but it shuffles the deck differently to for each user connected to the the application. </p>\n\n<p>Basically I want to be able to shuffle the deck using some kind of random function but still shuffle it the same way for all users.</p>\n\n<p>I'm using io.sockets.emit(); to use the shuffle function on all users.</p>\n"},{"tags":["javascript","debugging","node.js"],"answer_count":8,"favorite_count":86,"up_vote_count":171,"down_vote_count":0,"view_count":47137,"score":171,"question_id":1911015,"title":"How to debug node.js applications","body":"<p>How do I debug a node.js server application? Right now I'm mostly using <em>alert debugging</em> with print statements like this:</p>\n\n<pre><code>sys.puts(sys.inspect(someVariable));\n</code></pre>\n\n<p>There must be a better way to debug. I know that google Chrome has a command line debugger. Is this debugger available for node.js as well?</p>\n"},{"tags":["javascript","linux","node.js","fifo"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13042556,"title":"Writing to fifo from node.js","body":"<p>I'm trying to write to a fifo in my node.js server whenever a web request comes in.  I'm using the fifo as a task queue, so that another program can read from it and do some time-consuming work.</p>\n\n<p>So far I have code for my node.js server like this:</p>\n\n<pre><code>fs = require('fs');\n\n...\n\nvar fifoPath = '/tmp/myfifo';\nvar input = 'some input';\nfs.open(fifoPath, 'wx', 0644, function(error, fd) {\n  if (error) {\n    if (fd) {\n      fs.close(fd);\n    }\n    console.log('Error opening fifo: ' + error);\n    return;\n  }\n\n  fs.write(fd, input, 0, input.length, null, function(error, written, buffer) {\n    if (fd) {\n      fs.close(fd);\n    }\n    if (error) {\n      console.log('Error writing to fifo: ' + error);\n    } else {\n      if (written == input.length) {\n        console.log('Input has been written successfully!';\n      } else {\n        console.log('Error: Only wrote ' + written + ' out of ' + input.length + ' bytes to fifo.');\n      }\n    }\n  });\n});\n</code></pre>\n\n<p>When this code runs, it outputs the following:</p>\n\n<pre><code>Error: EEXIST, open '/tmp/myfifo'\n</code></pre>\n\n<p>Am I doing this incorrectly?</p>\n\n<p>Note: I'm using <code>fs.open(...)</code> with <code>'wx'</code> flags to make sure the input get written to the fifo sequentially, e.g. when 10 requests come in at the same time, so they don't all write to the fifo at the same time.</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":3481,"score":9,"question_id":5695107,"title":"Socket.io: How many concurrent connections can WebSockets handle?","body":"<p>I am wondering if you have any data on concurrent connections to websockets? I am using Socket.io on Node.js server. How many clients can connect to socket and receive data without bringing my server down? 1000? 1000.0000?</p>\n\n<p>Thanks!</p>\n"},{"tags":["node.js","http","post"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13042841,"title":"node.js http POST not working","body":"<p>I am having trouble getting my node.js server to do an http POST request to another node.js server. I am fairly certain that the problem lies with the http library or how I am using it because I can write a small HTML page that performs the POST exactly as I want.</p>\n\n<p>Here is how the server receiving the POST is set up</p>\n\n<pre><code>var server = restify.createServer({\n   name: 'some server',\n   version: \"1.0.0\"\n});\n\nserver.use(restify.acceptParser(server.acceptable));\nserver.use(restify.bodyParser());    \nserver.post('/theurl/', handler.handlePost);\n\nserver.listen(config.port, function() {\n   console.log(\"starting server on port %d\", server.address().port);\n});\n</code></pre>\n\n<p>Inside the handlePost method I am doing this:</p>\n\n<pre><code>exports.handlePost = function(req, res, next) {\n   console.log(\"body: %s\", JSON.stringify(req.body));\n   console.log(\"params: %s\", JSON.stringify(req.params));\n}\n</code></pre>\n\n<p>Here is the how the server that is sending the POST is doing it (this was taken directly from <a href=\"http://nodejs.org/api/http.html#http_http_request_options_callback\" rel=\"nofollow\">the node.js http docs</a>)</p>\n\n<pre><code>var options = {\n   host: '127.0.0.1',\n   port: 8090,\n   path: '/theurl/',\n   method: 'POST'\n};\n\nvar req = http.request(options, function(res) {\n   ses.setEncoding('utf8');\n   res.on('data', function (chunk) {\n      console.log('BODY: ' + chunk);\n   });\n});\n\nreq.on('error', function(e) {\n   console.log('problem with request: ' + e.message);\n});\n\nreq.write(\"&lt;some&gt;xml&lt;/some&gt;\");\nreq.end();\n</code></pre>\n\n<p>When I run the POST, both req.body and req.params are undefined inside the handlePost method.</p>\n\n<p>But if I put the following HTML in a browser, I can post to the service just fine.</p>\n\n<pre><code>&lt;html&gt;\n   &lt;head&gt;\n     &lt;script&gt;\n       function doPost()\n       {\n         var xmlhttp = new XMLHttpRequest();\n         xmlhttp.open(\"POST\",\"http://localhost:8090/theurl/\",false);\n         xmlhttp.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n         xmlhttp.send(\"&lt;some&gt;xml&lt;/some&gt;\");\n       }\n     &lt;/script&gt;\n   &lt;/head&gt;\n   &lt;body&gt;\n      &lt;button type=\"button\" onclick=\"doPost()\"&gt;POST data&lt;/button&gt;   \n   &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>So am I doing something wrong with the node.js http library?</p>\n"},{"tags":["javascript","node.js","global-variables","express","global"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":496,"score":2,"question_id":9699796,"title":"Sharing objects and avoiding globals in node.js","body":"<p>What would be the most appropriate way of sharing the database connection in the below snippet ( the <code>db</code> variable) with my routers/controllers without turning the <code>db</code> variable into a global?</p>\n\n<pre><code>var mongo = require('mongoskin'),\ndb = mongo.db(config.db.adress);\n\napp.use(function(req, res, next) {\n    db.open(function(err, data) {\n        (err) ? res.send('Internal server error', 500) : next();\n    });\n});\n\n// Setting up controllers here\napp.post('/users', require('./controllers/users').create);\n</code></pre>\n\n<p>Coming from a PHP background, I came to think about <em>Dependency Injection</em>, but I have no idea if that's appropriate in node.</p>\n"},{"tags":["javascript","mvc","node.js","backbone.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13041777,"title":"Understanding TodoMVC Example","body":"<p>Starting to learn node.js and backbone.js and am using the TodoMVC example as my guide. There are a couple parts I am having trouble wrapping my head around. See below.</p>\n\n<p>Here is app.js. </p>\n\n<pre><code>var express = require('express')\n  , http = require('http')\n  , mongoose = require('mongoose')\n  , models = require('./models')\n  , routes = require('./routes')\n  , app = express();\n\napp.configure(function () {\n  app.set('views', __dirname + '/views');\n  app.set('view engine', 'jade');\n  app.use(express.favicon());\n  app.use(express.logger('dev'));\n  app.use(require('stylus').middleware({ src: __dirname + '/public' }));\n  app.use(express.static(__dirname + '/public'));\n  app.use(express.bodyParser());\n  app.use(express.methodOverride());\n  app.use(app.router);\n});\n\napp.configure('development', function () {\n  app.use(express.errorHandler());\n});\n\nroutes.init(app);\n\n\nmongoose.connect(\"127.0.0.1\", \"todomvc\", 27017);\n\nhttp.createServer(app).listen(3000);\n\nconsole.log(\"Express server listening on port 3000\");\n</code></pre>\n\n<p>Heres is ./models:</p>\n\n<pre><code>var mongoose = require('mongoose'),\n\n  TodoSchema = new mongoose.Schema({\n    title: { 'type': String, 'default': 'empty todo...' },\n    order: { 'type': Number },\n    done: { 'type': Boolean, 'default': false }\n  });\n\nmodule.exports = mongoose.model('Todo', TodoSchema);\n</code></pre>\n\n<p>Andy finally, here is ./routes:</p>\n\n<pre><code>(function (exports) {\n\n  \"use strict\";\n\n  var mongoose = require('mongoose')\n    , crudUtils = require('../utils/crudUtils')\n    , Todo = mongoose.model('Todo');\n\n  function index(req, res) {\n    res.render('index', { 'title': 'Backbone.js, Node.js, MongoDB Todos' });\n  }\n\n  exports.init = function (app) {\n    app.get('/', index);\n    crudUtils.initRoutesForModel({ 'app': app, 'model': Todo });\n  };\n\n}(exports));\n</code></pre>\n\n<p>So my question is, how is the 'Todo' model in mongoose.model('Todo') in the routes module available in this scope? I see that the models module is exporting mongoose.model('Todo', TodoSchema); so I have to believe that is how the routes module has access to it, but I don't know why. What am I missing? I have a feeling its just not a complete understanding of scope in this situation. Also, I am not sure of the reasoning of having the routes function anonymous. </p>\n\n<p>Many thanks!</p>\n"},{"tags":["javascript","node.js","mongodb","csv","export-to-csv"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13041648,"title":"Call mongoexport from javascript Node.js","body":"<p>I would like to export a Mongo Collection to an .csv. Mongo provides a solution for this but it is limited to the shell.</p>\n\n<p><a href=\"http://docs.mongodb.org/manual/reference/mongoexport/\" rel=\"nofollow\">http://docs.mongodb.org/manual/reference/mongoexport/</a></p>\n\n<p>I'm using the native driver for node.js and would like to be able to do this in a script as opposed to being invoked from the shell.</p>\n"},{"tags":["node.js","jade"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":691,"score":3,"question_id":9522542,"title":"How to compile jade templates in to JavaScript functions to use them on client side?","body":"<p>I want to use compiled jade templates on client side. How should I compile them to get javascript files ?\n<a href=\"https://github.com/visionmedia/jade\" rel=\"nofollow\">https://github.com/visionmedia/jade</a></p>\n"},{"tags":["javascript","json","node.js","socket.io"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":10451243,"title":"When I send a JS object to a Node.js server and ask for the same object back, the server sends back a modified object","body":"<p>I have a web page that establishes communication with a <code>node.js</code> server. I am sending it objects and having it return the same object that it received. However, the object that is returned is different - all of its methods are gone.</p>\n\n<p>Here's code that shows what I'm doing. I send an event with an object:</p>\n\n<pre><code>editor.getSession().on('change', function(event) {\n    socket.emit('modificarCodigo', event);\n});\n</code></pre>\n\n<p>And I return it like this:</p>\n\n<pre><code>socket.on('modificarCodigo', function(data) {\n    socket.broadcast.to(socket.grupo).emit('actualizarCodigo', data);\n});\n</code></pre>\n\n<p>How can I get <code>node.js</code> to return the object that I send to it intact instead of modifying it? I have a guess that the behavior I'm seeing now is by design - if that's true, how can I change it?</p>\n"},{"tags":["javascript","node.js","application","websocket","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":13023703,"title":"Socket.io - Manual reconnect after client-side disconnect","body":"<p>I use <code>node.js</code> and <code>socket.io</code> to create a real time web application. I will give the users full control of the socket connection, like manual disconnect and (re)connect.</p>\n\n<pre><code>function socket_connect()\n{\n    console.log('func socket_connect');\n    socket = io.connect('http://url/to/the/app');\n}\n\nfunction socket_reconnect()\n{\n    console.log('func socket_reconnect');\n    socket_connect();\n}\n\nfunction socket_disconnect ()\n{\n    console.log('func socket_disconnect');\n    if (socket) socket.disconnect();\n}\n</code></pre>\n\n<p>On client start up the <code>socket_connect()</code> function works fine, but after using <code>socket.disconnect()</code>, no new connection starts.</p>\n"},{"tags":["node.js","gtalk","hubot"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":13040012,"title":"Working Hubot with gtalk","body":"<p>I would like someone to help me get a working version of Hubot on Gtalk running on my Ubuntu 11.10 server.</p>\n\n<p>I have tried many different tutorials, been through numerous attempts, and they all end in some version conflict, or obscure error along the way.</p>\n\n<p>It would be great if someone using a working version of Hubot on Gtalk could give me their:</p>\n\n<ul>\n<li>Node Version</li>\n<li>Ubuntu Version</li>\n<li>Hubot Version</li>\n<li>Any other points that might prove helpful</li>\n</ul>\n"},{"tags":["node.js","express","npm"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2409,"score":2,"question_id":9484829,"title":"npm can't find package.json","body":"<p>I'm trying to install the dependencies of some example Express apps I've downloaded but all of the apps throw the same error:</p>\n\n<pre><code>c:\\node\\stylus&gt;npm install -d\nnpm info it worked if it ends with ok\nnpm info using npm@1.1.1\nnpm info using node@v0.6.11\nnpm ERR! Couldn't read dependencies.\n\nnpm ERR! Error: ENOENT, no such file or directory 'c:\\node\\stylus\\package.json'\nnpm ERR! You may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\nnpm ERR!\nnpm ERR! System Windows_NT 6.1.7600\nnpm ERR! command \"C:\\\\Program Files (x86)\\\\nodejs\\\\\\\\node.exe\" \"C:\\\\Program File\ns (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\" \"install\" \"-d\"\nnpm ERR! cwd c:\\node\\stylus\nnpm ERR! node -v v0.6.11\nnpm ERR! npm -v 1.1.1\nnpm ERR! path c:\\node\\stylus\\package.json\nnpm ERR! code ENOENT\nnpm ERR! message ENOENT, no such file or directory 'c:\\node\\stylus\\package.json'\n\nnpm ERR! errno {}\nnpm ERR!\nnpm ERR! Additional logging details can be found in:\nnpm ERR!     c:\\node\\stylus\\npm-debug.log\nnpm not ok\n</code></pre>\n\n<p>Does anyone know what might be the root of this problem? <br>\nI'm running:</p>\n\n<ul>\n<li>Windows 7 64 bit</li>\n<li>npm 1.1.1</li>\n<li>node 6.11</li>\n<li>express 2.5.8</li>\n</ul>\n"},{"tags":["mongodb","node.js","coffeescript","mongoose","upsert"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":672,"score":2,"question_id":8490519,"title":"How can I upsert using Mongoose based on _id?","body":"<p>When I do this:</p>\n\n<pre><code>client_id = req.param(\"client_id\") ? null\nclient =\n  name: req.param \"clientName\"\n  status: 'active'\n\nClient.update {_id: client_id}, client, {upsert: true}, (err, updRes) -&gt;\n  if err\n    res.json\n      error: \"Couldn't create client\"\n  else\n    res.json client\n</code></pre>\n\n<p>It will create a new client record, except with a <code>null</code> <code>_id</code> field. I assume that's because the insert part of the upsert looks to the <code>query</code> to create the document. How can I do it so that if no doc is found, then insert a new <code>ObjectId</code>?</p>\n"},{"tags":["javascript","node.js","socket.io","multiplayer"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13038359,"title":"2x Javascript: .split Multiplayer Performance and Possible package loss","body":"<p>Hey I am still new to javascript.</p>\n\n<p>I am working on a multiplayer server using NodeJS, socket.io and javascript.</p>\n\n<p>I am playing around with a serverscript I found on a website.  It uses .split to send several strings of information to the Client.\nThe client then uses an array to determine what to use the .split data for according to the order it received it in.</p>\n\n<pre><code>int(Socket.LastDataElement(2))\nint(Socket.LastDataElement(3))\n</code></pre>\n\n<p>My first Question would be if there is a chance that these packages could come in the wrong order, or not be cleared properly? </p>\n\n<p><strong>Possible Result:</strong></p>\n\n<p>Health = Watermelon</p>\n\n<p>Speed = Cheesecake</p>\n\n<p><strong>OR</strong></p>\n\n<p>The wrong player shoots the Bullet!</p>\n\n<hr>\n\n<p><strong>Second Question:</strong> </p>\n\n<p>From my current point of view, sending <strong>.split</strong> strings sounds very smart compared to the alternative of sending Health, X, Y, Z, Attack, etc... as single packages. \nBut does it actually save bandwidth and time? Or does it only look this way because I am a noob.</p>\n\n<p>Cheers</p>\n"},{"tags":["node.js","mongodb","express","mongoose"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":102,"score":3,"question_id":13026486,"title":"How to populate a sub-document in mongoose after creating it?","body":"<p>I am adding a comment to an item.comments list. I need to get the comment.created_by user data before I output it in the response. How should I do this?</p>\n\n<pre><code>    Item.findById(req.param('itemid'), function(err, item){\n        var comment = item.comments.create({\n            body: req.body.body\n            , created_by: logged_in_user\n        });\n\n        item.comments.push(comment);\n\n        item.save(function(err, item){\n            res.json({\n                status: 'success',\n                message: \"You have commented on this item\",\n\n//how do i populate comment.created_by here???\n\n                comment: item.comments.id(comment._id)\n            });\n        }); //end item.save\n    }); //end item.find\n</code></pre>\n\n<p>I need to populate the comment.created_by field here in my res.json output:</p>\n\n<pre><code>                comment: item.comments.id(comment._id)\n</code></pre>\n\n<p>comment.created_by is a user reference in my mongoose CommentSchema. It currently is only giving me a user id, I need it populated with all the user data, except for password and salt fields.</p>\n\n<p>Here is the schema as people have asked:</p>\n\n<pre><code>var CommentSchema = new Schema({\n    body          : { type: String, required: true }\n  , created_by    : { type: Schema.ObjectId, ref: 'User', index: true }\n  , created_at    : { type: Date }\n  , updated_at    : { type: Date }\n});\n\nvar ItemSchema = new Schema({\n    name    : { type: String, required: true, trim: true }\n  , created_by  : { type: Schema.ObjectId, ref: 'User', index: true }\n  , comments  : [CommentSchema]\n});\n</code></pre>\n"},{"tags":["python","node.js","hmac"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13036675,"title":"Preparing a string for HMAC","body":"<p>I am writing a webservice which uses HMAC for message authentication.  I am having some issues preparing the 'data' for digest, and am getting different digests for the same 'data' in Python vs NodeJS.</p>\n\n<p>I am fairly sure that this issue is due to encoding, but I am not sure how to best approach this.</p>\n\n<p>Python code:</p>\n\n<pre><code>import hmac\nfrom hashlib import sha1\n\nf = open('../test.txt')\nraw = f.read()\n\nraw = raw.strip()\n\nhm = hmac.new('12345', raw, sha1)\nres = hm.hexdigest()\nprint res\n\n&gt;&gt; 5bff447a0fb82f3e7572d9fde362494f1ee2c25b\n</code></pre>\n\n<p>NodeJS (coffee) code:</p>\n\n<pre><code>fs = require 'fs'\nhttp = require 'http'\n{argv} = require 'optimist'\ncrypto = require 'crypto'\n\n# Load the file\nfile = fs.readFileSync argv.file, 'utf-8'\nfile = file.trim()\n\n# Create the signature\nhash = crypto.createHmac('sha1', '12345').update(file).digest('hex')\nconsole.log(hash)\n\n&gt;&gt; a698f82ea8ff3c4e9ffe0670be2707c104d933aa\n</code></pre>\n\n<p>Edit:  Also, the length of raw is 2 characters longer than file, but I cant work out where these two characters come from.</p>\n"},{"tags":["javascript","node.js","v8","evented-io"],"answer_count":10,"favorite_count":260,"up_vote_count":357,"down_vote_count":0,"view_count":60503,"score":357,"question_id":1884724,"title":"What is node.js?","body":"<p>I don't fully get what <a href=\"http://nodejs.org/\" rel=\"nofollow\">node.js</a> is all about. Maybe it's because I am mainly a web based business app developer. Can someone please explain what it is and the use of it? Thanks.</p>\n\n<p>My understanding so far is that:</p>\n\n<ol>\n<li>The programming model is event driven, especially the way it handles IO.</li>\n<li>It uses javascript and the parser is V8.</li>\n<li>It can be easily used to create concurrent server apps.</li>\n</ol>\n\n<p>Are my understandings correct? If yes, then what are the benefits of evented IO, is it just more for the concurrency stuffs? Also is the direction of node.js to become a framework like, javascript based (v8 based) programming model?</p>\n"},{"tags":["node.js","express","passport"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13008860,"title":"Error: failed to serialize user into session. Wrong function passed to serializeUser()?","body":"<p>I'm trying to do my first steps with the Express framework for Node. I was trying to implement a tiny authentication example, using Passport. However, I can't make it work; I keep getting the error: <code>Error: failed to serialize user into session</code>.</p>\n\n<p>I installed node-inspector to try to see what's going on. Apparently, my serialization function is being called, and it executes <code>done(null, 0)</code> as expected. I tried taking a look at Passport code, but I couldn't understand what the problem is. This is pretty much my first attempt at a Node application so I'm not familiar with the code. Can someone give me a hint? Thanks.</p>\n\n<pre><code>var express = require('express');\nvar jade = require('jade');\n\nvar passport = require('passport');\nvar LocalStrategy = require('passport-local').Strategy;\n\nvar app = express();\n\n/*\n * Settings\n */\n\napp.configure(function(){\n    app.set('views', __dirname + '/views');\n    app.set('view engine', 'jade');\n\n    app.use(express.logger());\n    app.use(express.cookieParser());\n    app.use(express.bodyParser());\n    app.use(express.session({ secret: 'cat in the bag' }));\n    app.use(passport.initialize());\n    app.use(passport.session());\n\n    passport.use(new LocalStrategy(\n        function(username, password, done) {\n            done(null, { id: 0, username: 'juancito' });\n        }\n    ));\n\n    passport.serializeUser(function(user, done) {\n        done(null, user.id);\n    });\n\n    passport.deserializeUser(function(id, done) {\n        done(null, 'juancito');\n    });\n});\n\n\n\n/*\n * Routes\n */\n\napp.get('/', function(req, res) {\n    res.render('index', { title: 'Welcome!' });\n});\n\napp.get('/login', function(req, res) {\n    if (req.user)\n        return res.redirect('/');\n\n    res.render('login', { title: 'Log in' });\n});\n\napp.post('/login',\n    passport.authenticate('local', {\n        successRedirect: '/',\n        failureRedirect: '/login'\n    })\n);\n\napp.get('/logout', function(req, res) {\n    req.logOut();\n    res.redirect('/');\n});\n\napp.listen(3000);\nconsole.log('Listening on port 3000.');\n</code></pre>\n"},{"tags":["node.js","architecture","functional-programming","lua","closures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":150,"score":1,"question_id":12327447,"title":"Design patterns for building loosely-coupled systems in dynamic/scripting languages ","body":"<p>I have lots of experience building enterprise apps using Java/C# and have become accustomed to all the trappings that come with object-oriented, statically typed languages. Specifically, I've become quite adept at dealing with system complexity by using the standard tools of the trade: </p>\n\n<ul>\n<li>interfaces/abstract types</li>\n<li>object composition</li>\n<li>dependency inversion</li>\n</ul>\n\n<p>I'm being asked to engineer a fairly complex back-end message processing system using a dynamic, functional language (Lua).  Functional languages are all the rage these days (NodeJs, JavaScript etc), so I'm happy to use this as an opportunity to jump on said bandwagon.  </p>\n\n<p>Can anyone suggest a sample application or architecture I can use to learn about using things such as  first class functions, closures, currying to build a complex, loosely coupled system?   </p>\n\n<p>Many thanks!</p>\n"},{"tags":["javascript","arrays","node.js","underscore.js"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13033371,"title":"Using Javascript and Underscore.js, how can I compare 2 arrays and replace properties if a match?","body":"<p>I have 2 arrays like so:</p>\n\n<pre><code>var arrayOne = [\n    {page:'1',tags:['foo','bar']},\n    {page:'2',tags:['oh','boy']}\n];\nvar arrayTwo = [\n    {page:'1',tags:['go','out']},\n    {page:'9b',tags:['red','blue','green']}\n];\n</code></pre>\n\n<p>I want to compare the two arrays, and if the <code>page</code> property is the same, replace the <code>tags</code> property in <code>arrayOne</code> with the <code>tags</code> property from <code>arrayTwo</code>.</p>\n\n<p>So given the example arrays above, only the tags for <code>page: 1</code> of <code>arrayOne</code> would get replaced with <code>page: 1</code>'s values from <code>arrayTwo</code>.</p>\n\n<p>I'm thinking I can do this with <code>underscore.js</code>, but I'm struggling to see how.</p>\n\n<p>Ideas?</p>\n"},{"tags":["node.js","native","iisnode"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13035760,"title":"Node.js native module is not a valid Win32 application error","body":"<p>Trying to make Hello World native module for node.js</p>\n\n<p>Got an Win32 Project in VS 2012 with one file:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;node.h&gt;\n#include &lt;v8.h&gt;\n\nusing namespace v8;\n\nHandle&lt;Value&gt; Method(const Arguments&amp; args) {\n  HandleScope scope;\n  return scope.Close(String::New(\"world\"));\n}\n\nvoid init(Handle&lt;Object&gt; target) {\n  target-&gt;Set(String::NewSymbol(\"hello\"),\n      FunctionTemplate::New(Method)-&gt;GetFunction());\n}\nNODE_MODULE(hello, init)\n</code></pre>\n\n<p>That`s compiles to hello.node.<br>\nOptions:<br>\n- Dynamic Library (.dll)<br>\n- No Common Language Runtime Support  </p>\n\n<p>Use it like:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>hello = require './hello'\nconsole.log hello.hello()\n</code></pre>\n\n<p>It works on local machine (win8 x64, node: 0.8.12)<br>\nBut on remote server (windows server 2008 x64, node: 0.8.12, iisnode: 0.1.21 x64, iis7) it throws this error:</p>\n\n<blockquote>\n  <p>Application has thrown an uncaught exception and is terminated: Error:<br>\n  %1 is not a valid Win32 application.  </p>\n  \n  <p>C:\\inetpub\\test\\lib\\server\\hello.node<br>\n      at Object.Module._extensions..node (module.js:485:11)<br>\n      at Module.load (module.js:356:32)<br>\n      at Function.Module._load (module.js:312:12)<br>\n      at Module.require (module.js:362:17)<br>\n      at require (module.js:378:17)<br>\n      at Object. (C:\\inetpub\\test\\lib\\server\\index.js:32:9)<br>\n      at Module._compile (module.js:449:26)<br>\n      at Object.Module._extensions..js (module.js:467:10)<br>\n      at Module.load (module.js:356:32)<br>\n      at Function.Module._load (module.js:312:12)  </p>\n</blockquote>\n\n<p>What I tryed:<br>\nPlaying with app pool settings (enable win32 apps) does not helped.<br>\nIisnode x86 does not install on x64 os.<br>\nCan`t compile to x64 because of error: Error  2 error LNK1112: module machine type 'X86' conflicts with target machine type 'x64' C:\\derby\\hello\\build\\node.lib(node.exe) hello</p>\n\n<p>Does anyone have any suggestions?</p>\n"},{"tags":["django","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13034268,"title":"node.js / django mini apps","body":"<p>I was impressed by the mini-app concept in the <a href=\"https://peepcode.com/products/full-stack-nodejs-i\" rel=\"nofollow\">peepcode node.js tutorial</a>. Instead of having global folders:</p>\n\n<pre><code>/site/models\n/site/views\n</code></pre>\n\n<p>you create another level of seperation per application area:</p>\n\n<pre><code>/site/login/models\n/site/catalog/models\n</code></pre>\n\n<p>AFAIU application areas must know nothing on each other. This creates some questions as for where to put shared db models, and if too much shared models imply that the wrong mini-app seperation was made. I'm trying to find more material on this mini-app concept. The webcast mentions that it is common in django. Anyone has experience or material about it in node (preferred) or django?</p>\n"},{"tags":["node.js","iisnode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13031273,"title":"With a Node.js cluster, how do I share connections?","body":"<p>I have an Azure hosted application (iisnode) that accepts direct connections from multiple client services. This application streams data between the various connections. If running on a system with multiple instances of node.js, the actual TCP connections will be connecting to different instances.</p>\n\n<p>Is there a way to somehow \"move\" or \"share\" the in-memory connection from one instance to another?</p>\n\n<p>Sure, I could build some inter-instance communication to route data, but I don't think the application will scale since it's entire purpose is to move data around quickly. For example, I would have 4 instances, 100 connections to each, and I would spend as many resources moving the data between instances as I would spend moving the data between the client connections.</p>\n"},{"tags":["node.js","v8"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13035080,"title":"What objects in V8 I can use in my node.js http app?","body":"<p>I was looking around for an inherit way to parse/stringify json in node.js and found that I can use the global V8 exposed object \"JSON (so JSON.parse() and JSON.stringify()\".  Now, I am wondering what other V8 exposed object I can use in my node.js application.  I searched the web and one instance was referring to the V8 specification.  However, I am not at a level that I can read and decipher what can be reused from the V8 spec in a node.js app.  Can anyone with a deeper knowledge on V8/node.js help me? Thanks!</p>\n"},{"tags":["mongodb","node.js","mongoose"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":2646,"score":6,"question_id":5370846,"title":"How do you use Mongoose without defining a schema?","body":"<p>In previous versions of Mongoose (for node.js) there was an option to use it without defining a schema</p>\n\n<pre><code>var collection = mongoose.noSchema(db, \"User\");\n</code></pre>\n\n<p>But in the current version the \"noSchema\" function has been removed. My schemas are likely to change often and really don't fit in with a defined schema so is there a new way to use schema-less models in mongoose?</p>\n"},{"tags":["javascript","node.js","variable-scope"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":13034194,"title":"Why can't I re-use a variable name inside of a callback?","body":"<p>I'm trying to re-use a variable named <code>user</code> in the following function:</p>\n\n<pre><code>UserModel.prototype.authenticate = function (doc, callback) {\n\n    // check to see if the username exists\n    this.users.findOne({ username: doc.username }, function (err, user) {\n\n        if (err || !user)\n            return callback(new Error('username not found'));\n\n        // hash the given password using salt from database\n        crypto.pbkdf2(doc.password, user.salt, 1, 32, function (err, derivedKey) {\n\n            if (err || user.password != derivedKey)\n                return callback(new Error('password mismatch'));\n\n            // explicitly define the user object\n            var user = {\n\n                _id: user._id,\n                type: user.type,\n                username: user.username,\n                displayname: user.displayname\n\n            };\n\n            return callback(err, user);\n\n        });\n\n    });\n\n};\n</code></pre>\n\n<p>I attempt to redefine the <code>user</code> variable inside of the <code>pbkdf2</code> callback function. This does not work as I would expect. The lines where I compare <code>user.password != derivedKey</code> breaks, because <code>user</code> is undefined here during run-time. Shouldn't <code>user</code> still be the instance from the <code>findOne</code> callback method parameter? If I change either of the two <code>user</code> variables to be called something else, it works.</p>\n\n<p>I could just rename the variables, but that would still leave me wondering.</p>\n"},{"tags":["node.js","websocket","javascript-objects","faye"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":80,"score":0,"question_id":13028604,"title":"sending a javascript object through websockets with","body":"<p>Hi all I'm trying to send a javascript object through websockets:</p>\n\n<p>the faye-websockets documentation says:</p>\n\n<p><strong>send(message)</strong> <em>accepts either a String or a Buffer and sends a text or binary message over the connection to the other peer.</em></p>\n\n<p>server side I'm using node and faye.</p>\n\n<pre><code>var WebSocket = require('faye-websocket');\nvar http = require('http');\n\nvar server = http.createServer();\nserver.addListener('upgrade', function(request, socket, head) {\n    var ws = new WebSocket(request, socket, head);\n    ws.send({topic:'handshake', data:'sdf487rgiuh7'});\n});\nserver.listen(8000);\n</code></pre>\n\n<p>client side:</p>\n\n<pre><code>&lt;script&gt;\n    var ws = new WebSocket('ws://localhost:8000');\n    ws.onmessage = function(e) {\n        console.log(e.data); //prints [Object object] string and not the object\n    };\n&lt;/script&gt;\n</code></pre>\n\n<p>what is my error? Thanks</p>\n"},{"tags":["xml","node.js","dom","xml-dom","processing-instruction"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13032046,"title":"Is it possible to get all the processing instruction elements from the DOM","body":"<p>I have an XML file that contains processing instructions in the form of <code>&lt;?myinst contents ?&gt;</code>. I need to get all of them in a collection, with a single DOM query, if possible. Is this possible without having the iterate over all the tree?</p>\n"},{"tags":["windows","node.js","cmd"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13032044,"title":"node.js and command line (cmd.exe)","body":"<p>I'm looking for solution or NPM for calling Windows command line from node.js application.</p>\n\n<p>What I want is call some batch files and run them on machine with node.js, of course with parameters and also read their output.</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":13032649,"title":"How to accomplish this without using eval","body":"<p><em>Sorry for the title but I don't know how to explain it.</em></p>\n\n<p>The function takes an URI, eg: /foo/bar/1293. The object will, in case it exists, be stored in an object looking like {foo: { bar: { 1293: 'content...' }}}. The function iterates through the directories in the URI and checks that the path isn't undefined and meanwhile builds up a string with the code that later on gets called using eval(). The string containing the code will look something like <em>delete memory[\"foo\"][\"bar\"][\"1293\"]</em></p>\n\n<p>Is there any other way I can accomplish this? Maybe store the saved content in something other than \nan ordinary object?</p>\n\n<pre><code>remove : function(uri) {\n        if(uri == '/') {\n            this.flush();\n            return true;\n        }        \n        else {\n            var parts = trimSlashes(uri).split('/'),\n                memRef = memory,\n                found = true,\n                evalCode = 'delete memory';\n\n            parts.forEach(function(dir, i) {\n                if( memRef[dir] !== undefined ) {\n                    memRef = memRef[dir];\n                    evalCode += '[\"'+dir+'\"]';\n                }\n                else {\n                    found = false;\n                    return false;    \n                }\n\n                if(i == (parts.length - 1)) {\n                    try {\n                        eval( evalCode ); \n                    } catch(e) {\n                        console.log(e);\n                        found = false;\n                    }\n                }\n            });\n\n            return found;\n        }        \n    }\n</code></pre>\n"},{"tags":["node.js","node-http-proxy"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12755865,"title":"Rewrite response headers with node-http-proxy","body":"<p>I'm using <a href=\"https://github.com/nodejitsu/node-http-proxy/\" rel=\"nofollow\">node-http-proxy</a> and want to watch for a particular response\nheader and rewrite it if necessary. Anyone here have suggestions on to\ndo this?</p>\n\n<p>My proxy server sits in front of a couple different node servers as\nwell as a java webapp.  The java app is setting a cookie, but the\ncookie has a path that is relative the the webapp's context. I need\nthe cookie to be secure and have a path to root without modifying the Java\napplication.</p>\n\n<p>In other words, the following header is returned:</p>\n\n<pre><code>set-cookie: MYSPECIALCOOKIE=679b6291-d1cc-47be; Path=/app; HttpOnly\n</code></pre>\n\n<p>And I'd like to rewrite the Path value to:</p>\n\n<pre><code>set-cookie: MYSPECIALCOOKIE=679b6291-d1cc-47be; Path=/; HttpOnly; Secure\n</code></pre>\n\n<p>I'm not clear how I would do this using node-http-proxy. Suggestions?\nIs there middleware to help with this?</p>\n"},{"tags":["unit-testing","node.js","testing","tdd","mongoose"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":13002506,"title":"What could I do to improve my testing?","body":"<p>Lately I've tried to get my head around good test driven development in Node JS with Mongoose as MongoDB wrapper. </p>\n\n<p>My question is am I doing it right. Am I testing the right stuff, should I do more test that cover empty values etc. What of the things do you think I could improve? Feel free to criticize as much as you like.</p>\n\n<p><strong>Test:</strong></p>\n\n<pre><code>var assert = require(\"assert\"),\n    mongoose = require(\"mongoose\"),\n    sugar = require(\"sugar\"),\n    Factory = require(\"factory-lady\"),\n    Timekeeper = require(\"timekeeper\"),\n    Link = require(\"./../app/models/link\");\n\nmongoose.connect(\"mongodb://localhost/link_test\");\n\nFactory.define(\"link\", Link, {\n  createdAt: new Date(\"2012-04-04\"),\n  title: \"Example\",\n  updatedAt: new Date(\"2012-04-05\"),\n  url: \"http://www.example.com\"\n});\n\ndescribe(\"Link\", function() {\n\n  describe(\"validation for\", function() {\n\n    [\"url\", \"title\"].forEach(function(property) {\n      it(\"must have a \" + property, function(done) {\n        Factory.build(\"link\", function(link) {\n          link[property] = null;\n          link.validate(function(err) {\n            assert.notEqual(err, null);\n            assert.notEqual(err.errors[property], null);\n            done();\n          });\n        });\n      });\n    });\n\n    it(\"should default the title to url if missing\", function(done) {\n      Factory.build(\"link\", function(link) {\n        link.title = undefined;\n        link.validate(function(err) {\n          assert.equal(link.title, link.url);\n          done();\n        });\n      });\n    });\n\n    describe(\"url\", function() {\n\n      [\"http://example.com\", \"http://www.example.com\",\n       \"http://nodejs.org/api/assert.html#assert_assert_deepequal_actual_expected_message\"].forEach(function(url) {\n        it(url + \" should be valid url\", function(done) {\n          Factory.build(\"link\", { url: url }, function(link) {\n            link.validate(function(err) {\n              assert.equal(err, null);\n              done();\n            });\n          });\n        });\n      });\n\n      [\"Invalid url\", \"example.com\"].forEach(function(url) {\n        it(url + \" should be invalid url\", function(done) {\n          Factory.build(\"link\", { url: url }, function(link) {\n            link.validate(function(err) {\n              assert.notEqual(err, null);\n              assert.notEqual(err.errors.url, null);\n              done();\n            });\n          });\n        });\n      });\n\n    });\n\n    describe(\"missing createdAt or updatedAt\", function() {\n\n      beforeEach(function() {\n        Timekeeper.freeze(new Date());\n      });\n\n      afterEach(function() {\n        Timekeeper.reset();\n      });\n\n      [\"createdAt\", \"updatedAt\"].forEach(function(property) {\n        it(\"should default the \" + property + \" to now if missing\", function(done) {\n          Factory.build(\"link\", function(link) {\n            link[property] = undefined;\n            link.validate(function(err) {\n              assert.deepEqual(link[property], new Date());\n              done();\n            });\n          });\n        });\n      });\n\n      [\"createdAt\", \"updatedAt\"].forEach(function(property) {\n        it(\"should leave the \" + property + \" unchanged if it's given\", function(done) {\n          Factory.build(\"link\", function(link) {\n            var date = new Date(\"2012-01-01\");\n            link[property] = date;\n            link.validate(function(err) {\n              assert.deepEqual(link[property], date);\n              done();\n            });\n          });\n        });\n      });\n\n      it(\"should default the updatedAt to now if missing when performing an update\", function(done) {\n        Factory(\"link\", function(link) {\n          link.validate(function(err) {\n            assert.equal(link.updatedAt, new Date());\n            done();\n          });\n        });\n      });\n\n      it(\"should leave the updatedAt unchanged if it's given when performing an update\", function(done) {\n        Factory(\"link\", function(link) {\n          var date = new Date(\"2012-01-01\");\n          link.updatedAt = date;\n          link.validate(function(err) {\n            assert.deepEqual(link.updatedAt, date);\n            done();\n          });\n        });\n      });\n\n    });\n\n  });\n\n});\n</code></pre>\n\n<p><strong>Model:</strong></p>\n\n<pre><code>var mongoose = require(\"mongoose\"),\n    Schema = mongoose.Schema;\n\nvar linkSchema = new Schema({\n  createdAt: { type: Date, required: true },\n  title: { type: String, required: true },\n  updatedAt: { type: Date, required: true },\n  url: { type: String, required: true, validate: [validUrl, \"invalid url\"] }\n});\n\nfunction validUrl(url) {\n  if ((url instanceof String || typeof url == 'string') &amp;&amp; url.length) {\n    return url.match(/^\\b((?:https?:\\/\\/|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()&lt;&gt;]+|\\(([^\\s()&lt;&gt;]+|(\\([^\\s()&lt;&gt;]+\\)))*\\))+(?:\\(([^\\s()&lt;&gt;]+|(\\([^\\s()&lt;&gt;]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,&lt;&gt;?«»“”‘’]))$/i); \n  }\n}\n\nlinkSchema.pre(\"validate\", function (next) {\n  if (typeof this.title === \"undefined\" &amp;&amp; typeof this.url !== \"undefined\") {\n    this.title = this.url;\n  }\n  if (typeof this.createdAt === \"undefined\") {\n    this.createdAt = new Date();\n  }\n  if (typeof this.updatedAt === \"undefined\" || !this.isModified(\"updatedAt\")) {\n    this.updatedAt = new Date();\n  }\n  next();\n});\n\nmodule.exports = mongoose.model(\"Link\", linkSchema);\n</code></pre>\n"},{"tags":["javascript","node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13026355,"title":"Node.JS HTTP Response Returns Nothing?","body":"<p>I am attempting to iterate through a MongoDB cursor object and return all records from a collection and then using the respond method in Node outout to the browser.</p>\n\n<p>The problem I have is no response seems to be fired.</p>\n\n<p>I have tried putting response.end() inside the loop but it then doesn't iterate through the results.</p>\n\n<p>I have tried response.end() in different places also. Here is the code</p>\n\n<pre><code>db.open(function(err, db) {\n            if(!err) {\n                console.log(\"Nodelistr is connected to MongoDB\\n\");\n                response.writeHead(200);\n\n                db.collection('todo', function(err, collection){            \n                    collection.find(function(err, cursor) {\n                        cursor.each(function(err, doc) {\n                            for(docs in doc){\n                                if(docs == \"_id\"){\n                                }else{\n                                    var test = docs + \" : \" + doc[docs];\n                                }\n                            }\n                            data = data.toString(\"utf8\").replace(\"{{TEST}}\", test);\n                            response.write(data);\n\n                            //console.dir(doc);\n                        })           \n                        response.end();         \n                    });\n                });\n\n            };\n\n        });\n</code></pre>\n"},{"tags":["javascript","regex","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13027562,"title":"reading all the submatches in regexp multiple matches","body":"<p>today i'm trying to parse a 'ps aux' output (issued from a node.js server)</p>\n\n<p>so i made an happy regex to parse the values, and i wanted to put all those fancy informations into a simple JSON object :-)</p>\n\n<p>problem is, the regex i've made has 3 match groups, doing multiple matches... and i don't even know if it's possible to have it all the matches returned.</p>\n\n<pre><code>var spawn = require(\"child_process\").spawn;\n\nfunction exec(http_req, http_resp){\n    var re_ps = /(?:([\\d\\.\\w\\-\\?\\/\\+]+)\\s+){8}(?:((?:\\d+\\:\\d+)|(?:\\w+\\d+))\\s+){2}([^\\n]+)/g,\n        result_re_ps,\n        array_re_ps = [];\n    //[USER, PID, %CPU, %MEM, VSZ, RSS, TTY, STAT], dates[START, TIME], COMMAND\n    var ps_process = spawn(\"ps\", [\"aux\"]);\n    ps_process.stdout.on(\"data\", function(data){\n        var split_data = data.toString().split('\\n');\n        for (var i=1; i &lt; 2; i++){\n            while ((result_re_ps = re_ps.exec(split_data[i])) != null){\n                console.log(\"--- while iteration ---\");\n                console.dir(result_re_ps);\n                //console.dir(result_re_ps);\n            }\n        }\n        //http_resp.write(data);\n    });\n    ps_process.on(\"exit\", function (code) {\n        if (code !== 0) {\n            console.log(\"ps_process exited with code \" + code);\n        }\n        http_resp.end();\n    });\n}\n\nexports.exec = exec;\n</code></pre>\n\n<p>the \"--- while iteration ---\" it's just one per each line, instead, it should be multiples!</p>\n\n<p>I will link a fancy screenshot to let you visually understand what kind of data i'm expecting <img src=\"http://i.stack.imgur.com/UPFJQ.gif\" alt=\"enter image description here\"></p>\n\n<p>As you can see the above are 3 groups of data, each one with multiple occurrences</p>\n\n<p>Any help? :p</p>\n\n<p><strong>EDITED TO CLARIFY:</strong></p>\n\n<p>This is the result of a line like:</p>\n\n<pre><code>root      5213  0.0  2.1   8688  2760 ?        Ss   11:33   0:01 sshd: root@pts/0 \n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/MoTNi.png\" alt=\"enter image description here\"></p>\n\n<p>As you can see, the resulting array is 1-dimensional, instead for the results to be contained entirely it <strong>HAS</strong> to be at least 2-dimensional</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>For now i've solved the problem changin my code like this:</p>\n\n<pre><code>var spawn = require(\"child_process\").spawn;\n\nfunction exec(http_req, http_resp){\n    var array_re_ps = [];\n    var re_ps1 = /(?:([\\d\\.\\w\\-\\?\\/\\+]+)\\s+)/g,\n        re_ps2 = /(?:((?:\\d+\\:\\d+)|(?:\\w+\\d+))\\s+)/g,\n        re_ps3 = /([^\\n]+)/g;\n    //[USER, PID, %CPU, %MEM, VSZ, RSS, TTY, STAT], dates[START, TIME], COMMAND\n    var ps_process = spawn(\"ps\", [\"aux\"]);\n    ps_process.stdout.on(\"data\", function(data){\n        var split_data = data.toString().split('\\n');\n        for (var i=20; i &lt; 21; i++){\n            array_re_ps[0] = [], array_re_ps[1] = [];\n            for (var j=0; j&lt;8; j++){\n                array_re_ps[0].push(re_ps1.exec(split_data[i])[1]);\n            }\n            re_ps2.lastIndex = re_ps1.lastIndex;\n            for (var j=0; j&lt;2; j++){\n                array_re_ps[1].push(re_ps2.exec(split_data[i])[1])\n            }\n            re_ps3.lastIndex = re_ps2.lastIndex;\n            array_re_ps[2] = re_ps3.exec(split_data[i])[1];\n            console.dir(array_re_ps);\n        }\n    });\n    ps_process.on(\"exit\", function (code) {\n        if (code !== 0) {\n            console.log(\"ps_process exited with code \" + code);\n        }\n        http_resp.end();\n    });\n}\n\nexports.exec = exec;\n</code></pre>\n\n<p>Basically i split my long regexp, in 3 smaller ones, and i do cycle through their results.\nIf you try the code i formatted the resulting array exactly as i wanted, but i still think that it's a side-solution.</p>\n\n<p>Since Regular Expressions lets you \"multiple parse group multiple times\", it is possible to have that functionality in javascript?</p>\n"},{"tags":["git","node.js","clone","require","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13022417,"title":"Should I clone a node library inside node_modules to modify it?","body":"<p>I'm using <a href=\"https://github.com/jsantell/poet\" rel=\"nofollow\">Poet</a> for a blogging/static site generator engine and it's great.</p>\n\n<p>It is currently a dependency listed in my packages.json, so I simply <code>npm install</code> it and <code>require</code> it in my express app.</p>\n\n<p>However, I'd like to change one behavior in the library (especifically the way a \"post.preview\" is constructed, which right now simply gets the first line, and I'd like to perhaps be able to configure a number of lines for each post).</p>\n\n<p>To do that, I'm considering cloning the repo and making the change.</p>\n\n<p>But I'm wondering if I should:</p>\n\n<ul>\n<li>Clone it directly to my blog/node_modules/poet and <code>require</code> it as usual or,</li>\n<li>Clone it to a different folder and <code>require</code> it from a different path.</li>\n</ul>\n\n<p>Keep in mind that I'd like to publish soon to Heroku or Nodejitsu.</p>\n\n<p>What are your thoughts on that?</p>\n\n<p><strong>UPDATE</strong>: I had a few problems having a git repo with the cloned lib under my git repo. It somehow added the whole folder as a file. I promptly removed '.git' from the lib folder and everything went back to normal... I don't know the cause of this behavior!</p>\n"},{"tags":["performance","node.js","loggly"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13020546,"title":"What is the maximum throughput of Loggly?","body":"<p>How many requests per second from a client can Loggly handle? I am only able to get around 10–20 requests processed per second and I am wondering if this is normal.</p>\n"},{"tags":["node.js","ssl","https","client","certificate"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":13019982,"title":"Node.JS + HTTPS + Client Cert = Problems","body":"<p>I've been trying to get Node.JS to work with SSL and client certificates. Originally, I had tried to get it to work with restify (see my question <a href=\"http://stackoverflow.com/questions/12826711/node-js-restify-requiring-client-certificate\">here</a>). When I couldn't get that to work, I backed up and tried to find an example that illustrated what I was trying to accomplish. I tried <a href=\"http://vanjakom.wordpress.com/2011/08/11/client-and-server-side-ssl-with-nodejs/\" rel=\"nofollow\">this one</a>, and I'm receiving an odd error.</p>\n\n<p>Code is as follows:</p>\n\n<p>Server:</p>\n\n<pre><code>var sys = require(\"sys\");\nvar fs = require(\"fs\");\nvar https = require(\"https\");\n\nvar options = {\n  key: fs.readFileSync(\"../certs/server.key\"),\n  cert: fs.readFileSync(\"../certs/server.crt\"),\n  ca: fs.readFileSync(\"../certs/ca.crt\"),\n  requestCert: true,\n  rejectUnauthorized: true\n};\n\nhttps.createServer(options, function (req, res) {\n  console.log(req);\n  res.writeHead(200);\n  sys.puts(\"request from: \" + req.connection.getPeerCertificate().subject.CN);\n  res.end(\"Hello World, \" + req.connection.getPeerCertificate().subject.CN + \"\\n\");\n}).listen(8080);\n\nsys.puts(\"server started\");\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>var https = require('https');\nvar fs = require(\"fs\");\n\nvar options = {\n    host: 'localhost',\n    port: 8080,\n    path: '/hello',\n    method: 'GET',\n    key: fs.readFileSync(\"../certs/user.key\"),\n    cert: fs.readFileSync(\"../certs/user.crt\"),\n    ca: fs.readFileSync(\"../certs/ca.crt\"),\n    passphrase: 'thepassphrase'\n};\n\nvar req = https.request(options, function(res) {\n    console.log(\"statusCode: \", res.statusCode);\n    console.log(\"headers: \", res.headers);\n\n    res.on('data', function(d) {\n        process.stdout.write(d);\n    });\n});\n\nreq.end();\n\nreq.on('error', function(e) {\n    console.error(e);\n});\n</code></pre>\n\n<p>Running test-client.js yields this:</p>\n\n<pre><code>{ [Error: socket hang up] code: 'ECONNRESET' }\n</code></pre>\n\n<p>Attempting the same sort of thing with curl:</p>\n\n<pre><code>curl -k -v --key user.key --cert user.crt:thepassphrase --cacert ca.crt https://localhost:8080/hello\n</code></pre>\n\n<p>yields:</p>\n\n<pre><code>* About to connect() to localhost port 8080 (#0)\n*   Trying 127.0.0.1... connected\n* successfully set certificate verify locations:\n*   CAfile: ca.crt\n  CApath: /etc/ssl/certs\n* SSLv3, TLS handshake, Client hello (1):\n* SSLv3, TLS handshake, Server hello (2):\n* SSLv3, TLS handshake, CERT (11):\n* SSLv3, TLS handshake, Request CERT (13):\n* SSLv3, TLS handshake, Server finished (14):\n* SSLv3, TLS handshake, CERT (11):\n* SSLv3, TLS handshake, Client key exchange (16):\n* SSLv3, TLS handshake, CERT verify (15):\n* SSLv3, TLS change cipher, Client hello (1):\n* SSLv3, TLS handshake, Finished (20):\n* Unknown SSL protocol error in connection to localhost:8080 \n* Closing connection #0\ncurl: (35) Unknown SSL protocol error in connection to localhost:8080\n</code></pre>\n\n<p>If I want to go the extra step to require a client certificate, how would I go about it?</p>\n"},{"tags":["php","javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":13024801,"title":"Running php code inside a node.js socket server script","body":"<p>I am running a normal TCP socket in javascript and uses node to execute. Before I send a response back to the client, I want to validate the data with some some php (mysql) code.\nHow can I execute this code inside this javascript file?  All similar questions in STACKOVERFLOW asks about this code in HTML. (which is okay and I understand that part), But  this is a normal javascript file (executed in node).  The javascript code is below and I've marked the validation function call.</p>\n\n<pre><code>var net = require('net');\n\nvar HOST = '192.168.0.6';\nvar PORT = 8765;\n\nnet.createServer(function(sock) {\n\n    console.log('CONNECTED: ' + sock.remoteAddress +':'+ sock.remotePort);\n\n    sock.on('data', function(data) {\n        var output;\n        var validScan;\n\n        //This is the function call to a php file\n        **validScan = validateScanTag(data);**\n\n        console.log('DATA ' + sock.remoteAddress + ': ' + data);\n        sock.write(validScan);\n\n    });\n\n    // Closing this instance of socket\n    sock.on('close', function(data) {\n        console.log('CLOSED: ' + sock.remoteAddress +' '+ sock.remotePort);\n    });\n\n}).listen(PORT, HOST);\n\nconsole.log('Server listening on ' + HOST +':'+ PORT);\n</code></pre>\n\n<p>The validateScanTag executes a line lke :</p>\n\n<pre><code>$.post('getperiod.php', {hours:hrs, minutes:mins, seconds:secs, ddd:day},\n</code></pre>\n\n<p>But this dont work.  How can I call this 'geteriod.php' file from a javascript file?</p>\n"},{"tags":["node.js","azure","iisnode"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12483782,"title":"Cannot Get Azure Node.js Logging Enabled","body":"<p>I am unable to get logging to work for a node application I am deploying to Windows Azure. I am overriding the web.config with the iisnode.yml file option. </p>\n\n<p>Here's the yml file contents:</p>\n\n<pre><code>node_env: development\nnodeProcessCountPerApplication: 1\nmaxConcurrentRequestsPerProcess: 1024\nmaxNamedPipeConnectionRetry: 24\nnamedPipeConnectionRetryDelay: 250\nmaxNamedPipeConnectionPoolSize: 512\nmaxNamedPipePooledConnectionAge: 30000\nasyncCompletionThreadCount: 0\ninitialRequestBufferSize: 4096\nmaxRequestBufferSize: 65536\nwatchedFiles: *.js;iisnode.yml\nuncFileChangesPollingInterval: 5000\ngracefulShutdownTimeout: 60000\nloggingEnabled: true\nlogDirectory: iisnode\ndebuggingEnabled: true\ndebuggerPortRange: 5058-6058\ndebuggerPathSegment: debug\nmaxLogFileSizeInKB: 128\nmaxTotalLogFileSizeInKB: 1024\nmaxLogFiles: 20\ndevErrorsEnabled: true\nflushResponse: false\nenableXFF: false\n</code></pre>\n\n<p>Here's the contents of the web.config file that's being overriden:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n    &lt;system.webServer&gt;\n        &lt;modules runAllManagedModulesForAllRequests=\"false\" /&gt;\n        &lt;iisnode configOverrides=\"iisnode.yml\" debuggingEnabled=\"true\" loggingEnabled=\"true\" logDirectory=\"iisnode\" devErrorsEnabled=\"true\" nodeProcessCommandLine=\"&amp;quot;%programfiles(x86)%\\nodejs\\node.exe&amp;quot;\"  /&gt;\n        &lt;handlers&gt;\n            &lt;add name=\"iisnode\" path=\"server.js\" verb=\"*\" modules=\"iisnode\" /&gt;\n        &lt;/handlers&gt;\n        &lt;rewrite&gt;\n            &lt;rules&gt;\n                &lt;clear /&gt;\n                &lt;rule name=\"app\" enabled=\"true\" patternSyntax=\"ECMAScript\" stopProcessing=\"true\"&gt;\n                    &lt;match url=\"server\\.js.+\" negate=\"true\" /&gt;\n                    &lt;conditions logicalGrouping=\"MatchAll\" trackAllCaptures=\"false\" /&gt;\n                    &lt;action type=\"Rewrite\" url=\"server.js\" /&gt;\n                &lt;/rule&gt;\n                &lt;rule name=\"LogFile\" patternSyntax=\"ECMAScript\" stopProcessing=\"true\"&gt;\n                    &lt;match url=\"iisnode\"/&gt;\n                &lt;/rule&gt;\n                &lt;rule name=\"NodeInspector\" patternSyntax=\"ECMAScript\" stopProcessing=\"true\"&gt;\n                    &lt;match url=\"^server.js\\/debug[\\/]?\" /&gt;\n                &lt;/rule&gt;\n                &lt;rule name=\"StaticContent\"&gt;\n                    &lt;action type=\"Rewrite\" url=\"public{{REQUEST_URI}}\"/&gt;\n                &lt;/rule&gt;\n                &lt;rule name=\"DynamicContent\"&gt;\n                    &lt;conditions&gt;\n                        &lt;add input=\"{{REQUEST_FILENAME}}\" matchType=\"IsFile\" negate=\"True\"/&gt;\n                    &lt;/conditions&gt;\n                    &lt;action type=\"Rewrite\" url=\"server.js\"/&gt;\n                &lt;/rule&gt;\n            &lt;/rules&gt;\n        &lt;/rewrite&gt;\n    &lt;/system.webServer&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>I'm pretty sure I have enabled every logging option I can in both, but neither seems to be picked up by Azure during deployment and when I access the typical logging location, <a href=\"http://mysite.com/iisnode/index.html\" rel=\"nofollow\">http://mysite.com/iisnode/index.html</a> or <a href=\"http://mysite.com/iisnode/\" rel=\"nofollow\">http://mysite.com/iisnode/</a> I receive a 404 error.</p>\n\n<p>Any help or ideas would be appreciated.</p>\n"},{"tags":["node.js","cloudfoundry","sizzle","jsdom","appfog"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12761475,"title":"JSDom Alternative with full Sizzle support?","body":"<p>For a bit of scope, I have a scraping app that I am running on cloudfoundry. Due to the Contextify problem discussed <a href=\"http://stackoverflow.com/questions/12083190/jsdom-scraping-on-cloudfoundry-doesnt-work\">here</a>, I am unable to use jsdom to do this.</p>\n\n<p>To get around this problem I started to replace jsdom with <a href=\"https://github.com/MatthewMueller/cheerio\" rel=\"nofollow\">Cheerio</a>, however I have now realised it does not fully support the Sizzle selectors I need to use to process the scraped data.</p>\n\n<p>After a little research I'm beginning to think I've hit a brick wall - is there another way around this problem?</p>\n\n<p>Thanks!</p>\n"},{"tags":["javascript","html5","node.js","websocket","web-worker"],"answer_count":6,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":754,"score":9,"question_id":9554896,"title":"Sharing websocket across browser tabs?","body":"<p>We want to have one socket per browser rather than one per tab in a browser. How can we achieve it? I read about shared web workers which was promising. A reference for that too is appreciated. Unfortunately shared web workers are  not yet implemented by mozilla or internet explorer to the best of my knowledge. So what to do in this case ? We are working on node.js on server side.</p>\n"},{"tags":["node.js","soundcloud"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13025654,"title":"soundcloud node npm","body":"<p>Is there an official or \"blessed\" Node.js NPM module for interacting with SoundCloud.  </p>\n\n<p>There are a few wrapper API's around.  I'm wondering whether there is a favoured one by the community.</p>\n\n<p>Thanks.</p>\n"},{"tags":["javascript","node.js","express","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":98,"score":-2,"question_id":12998058,"title":"express Error: Cannot find module '../..'","body":"<p>I'm a beginer with node.js.\nI installed node on Ubuntu 12.04 and it works fine for simple simple apps.\nI also installed express using:</p>\n\n<pre><code>npm install -g express\n</code></pre>\n\n<p>I believe the installation worked fine since I get no errors but right now I want to run one of their apps from the examples (the mvc one) and I get the following error:</p>\n\n<pre><code>module.js:340\n    throw err;\n          ^\nError: Cannot find module '../..'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (/home/andreii/Desktop/node/mvc/index.js:2:15)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.runMain (module.js:492:10)\n</code></pre>\n\n<p>Any ideas about how can I solve this problem?\nThanks a lot guys!</p>\n"},{"tags":["node.js","upload","express","progress-bar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":13022282,"title":"How to use jquery file upload with express.js?","body":"<p>since uploading file with progress can not be done in all browser with pure js, </p>\n\n<p>i want to give jquery file upload a shot，but the doc is really not good , </p>\n\n<p>so can anyone help me, or do u have any good tutorials?</p>\n"},{"tags":["asp.net","node.js","azure","azure-web-roles"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13014805,"title":"Mixing node.js and ASP.NET projects in a single Azure Web Role?","body":"<p>It's quite easy to host multiple ASP.NET projects on a single Azure Web Role (<a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/gg433110.aspx\" rel=\"nofollow\">tutorial</a>) but is it possible to use a single Web Role to host both ASP.NET and node.js projects?</p>\n"},{"tags":["node.js","bcrypt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13023361,"title":"How does node.bcrypt.js compare hashed and plaintext passwords without the salt?","body":"<p>From <a href=\"https://github.com/ncb000gt/node.bcrypt.js/\" rel=\"nofollow\">github</a>:</p>\n\n<p>To hash a password:</p>\n\n<pre><code>var bcrypt = require('bcrypt');\nbcrypt.genSalt(10, function(err, salt) {\n    bcrypt.hash(\"B4c0/\\/\", salt, function(err, hash) {\n        // Store hash in your password DB.\n    });\n});\n</code></pre>\n\n<p>To check a password:</p>\n\n<pre><code>// Load hash from your password DB.\nbcrypt.compare(\"B4c0/\\/\", hash, function(err, res) {\n    // res == true\n});\nbcrypt.compare(\"not_bacon\", hash, function(err, res) {\n    // res = false\n});\n</code></pre>\n\n<p>From above, how can there be no salt values involved in the comparisons? What am I missing here?</p>\n"},{"tags":["asp.net","node.js","session","tempdata"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12976716,"title":"Simulate ASP.NET TempData in nodejs","body":"<p>How can I create object like TempData in nodejs? I thought maybe I can set flag 'IsTempData' to session and at the end of an application I would clear sessions which have this flag selected. But there is a problem: I have many asynchronous functions where I use tempdata, so application may end before I use tempdata. I hope you understand what I mean by ending application:</p>\n\n<pre><code>connect()\n.use(connect.bodyParser())\n.use(connect.query())\n.use(connect.favicon())\n.use(connect.cookieParser())\n.use(connect.session({ secret: 'your secret here' }))\n.use(function (req, res) {\n    somefunction();\n\n    // end of application, here I will clear sessions which have tempdata flag selected\n}).listen(1234);\n</code></pre>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13006659,"title":"Node JS possible EventEmitter memory leak detected","body":"<p>I read answers at <a href=\"http://stackoverflow.com/questions/9768444/possible-eventemitter-memory-leak-detected\">location</a> and tried many ways to resolve my issue but could not - hence posting this query from my side.</p>\n\n<p>Basically I have a list of services in an array - which comes to ~ 1500 in numbers running on a different box other that where my NodeJS application is running. As per my code I ssh to the/a box and <strong>via expect script</strong>, then cd to a specific directory to get each service version / build id which is stored in a specific file at specific individual path for each service. There are chances that for some of the services the same file (having version / build information) may be stored at a different location in the box. So I have algo in app that in case attempt to get the details fails for the first path I will use other script to look for information at different path:</p>\n\n<p>Main Block of code:</p>\n\n<pre><code>exports.getservicedetails = function(box,res) {\n        var job = [];\n        for (i = 0; i &lt; services.length; i++ )\n        {\n                var children = new Object();\n                children.server = services[i];\n                children.box = box;\n                children.process = spawn('./scripts/info.sh', [children.server , children.box , getStageURL(children.box)]);\n                children.runstate = 1;\n                job.push(children);\n                createChildEvents(job, i, res);\n        }\n}\n</code></pre>\n\n<p>Now I set all events for each spawned tasks:</p>\n\n<pre><code>function createChildEvents(child, id, res){\n        (child[id]).process.stderr.on('data', function (data) {\n                (child[id]).runstate = 0;\n        });\n        (child[i]).process.on('exit', function (code) {\n                (child[id]).runstate = 0;\n                checkstate(child, res); // function to check if all spawned tasks has exited\n        });\n        (child[id]).process.stdout.on('data', function (data) {\n                var result = data.toString().split(\"\\r\\n\"); // split the stdout outputted lines\n                for (var i = 0; i &lt; result.length; i++)\n                {\n                       console.log('Server : ' +  (child[id]).server + \" PID : \" + (child[id]).process.pid + ' ' + (child[id]).box);\n                        if ((child[id]).box.length &gt; 0 &amp;&amp; result[i].match(/No such file or directory/gi) != null) {\n                                (child[id]).process = spawn('./scripts/info2.sh ',[(child[id]).server, (child[id]).box, getStageURL((child[id]).box)]);\n                                (child[id]).box = '';\n                                (child[id]).runstate = 1;\n                                createChildEvents(child, id, res);\n                                break;\n                        }\n                        if(result[i].match(/release_version*/) != null || result[i].match(/app.version*/) != null)\n                                (child[id]).serversion = (result[i].split('='))[1];\n                        if(result[i].match(/release_number*/) != null || result[i].match(/app.id*/) != null)\n                                (child[id]).serproduct = (result[i].split('='))[1];\n                }\n        });\n}\n</code></pre>\n\n<p>The issue is that after getting 11th console logs as mentioned below I see error:</p>\n\n<pre><code>Server : a PID : 27200 myboxname\nServer : b PID : 31650 myboxname\nServer : d PID : 31644 myboxname\nServer : e PID : 31664 myboxname\nServer : f PID : 28946 myboxname\nServer : g PID : 32507 myboxname\nServer : h PID : 29329 myboxname\nServer : i PID : 29905 myboxname\nServer : j PID : 29883 myboxname\nServer : k PID : 481 myboxname\nServer : l PID : 777 myboxname\n(node) warning: possible EventEmitter memory leak detected. 11 listeners added. Use emitter.setMaxListeners() to increase limit.\nTrace\n    at EventEmitter.addListener (events.js:168:15)\n    at EventEmitter.once (events.js:189:8)\n    at Transport.logException (src/node_modules/winston/lib/winston/transports/transport.js:118:8)\n    at logAndWait (src/node_modules/winston/lib/winston/logger.js:613:15)\n    at async.forEach (src/node_modules/winston/node_modules/async/lib/async.js:86:13)\n    at Array.forEach (native)\n    at _forEach (src/node_modules/winston/node_modules/async/lib/async.js:26:24)\n    at Object.async.forEach (src/node_modules/winston/node_modules/async/lib/async.js:85:9)\n    at Logger._uncaughtException (src/node_modules/winston/lib/winston/logger.js:636:9)\n    at process.EventEmitter.emit (events.js:115:20)\n(node) warning: possible EventEmitter memory leak detected. 11 listeners added. Use emitter.setMaxListeners() to increase limit.\nTrace\n    at EventEmitter.addListener (events.js:168:15)\n    at EventEmitter.once (events.js:189:8)\n    at Transport.logException (src/node_modules/winston/lib/winston/transports/transport.js:117:8)\n    at logAndWait (src/node_modules/winston/lib/winston/logger.js:613:15)\n    at async.forEach (src/node_modules/winston/node_modules/async/lib/async.js:86:13)\n    at Array.forEach (native)\n    at _forEach (src/node_modules/winston/node_modules/async/lib/async.js:26:24)\n    at Object.async.forEach (src/node_modules/winston/node_modules/async/lib/async.js:85:9)\n    at Logger._uncaughtException (src/node_modules/winston/lib/winston/logger.js:636:9)\n    at process.EventEmitter.emit (events.js:115:20)\n</code></pre>\n\n<p>I tried adding 'process.setMaxListeners(0);' at many points in my code but still I keep seeing this error?</p>\n\n<p>Any idea how can I solve this issue? Thanks in advance.</p>\n"},{"tags":["node.js","backbone.js"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1031,"score":6,"question_id":9023291,"title":"template rendering with node.js and backbone.js","body":"<p>Has anyone found a good solution for developing templates for backbone.js that can be used on the server and the client?</p>\n\n<p>This is really desirable with the backbone.js history stack, as users can share and link to real urls in the browser location bar, and the node.js server can render the page on first page view, while using the same templates in the client to rebuild pages on subsequent page views.</p>\n\n<p>This would also provide an ideal output for both users and for search engines that spider the links and won't have to parse or execute javascript to see a fully rendered and working page.</p>\n\n<p>Updated with more info:</p>\n\n<p>Two possible approaches to this appear to be:</p>\n\n<p>1) bones - <a href=\"https://github.com/developmentseed/bones\">https://github.com/developmentseed/bones</a></p>\n\n<p>Bones has some quirks to install and currently needs an old version of node and npm.</p>\n\n<p>2) capsule - <a href=\"https://github.com/andyet/capsule\">https://github.com/andyet/capsule</a></p>\n\n<p>I haven't tried this yet, but it seems similar. I'd be interested if anyone has interest with either of these projects.</p>\n"},{"tags":["api","node.js","express","integration-testing","mongoose"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13023253,"title":"Functional/integration testing a NodeJS ReST API implementation","body":"<p>I've built a NodeJS application using mongoose and express. This application exposes resources in a ReSTful manner, and I'm trying to build a suite of functional/integraiton tests.</p>\n\n<p>This suite, when executed, should fire up my application in an isolated environment (running on localhost is fine), with a custom set of configuration settings (the path to which can be provided as an environment variable). Any other custom setup actions should be performed.</p>\n\n<p>After completing the suite of tests, the (mongodb) database should be dropped, and any custom teardown actions should be performed.</p>\n\n<p>What are some NodeJS frameworks/modules/etc exist to help achieve this goal?</p>\n\n<p>Thanks,\nTharsan</p>\n"},{"tags":["ios","node.js","uiwebview"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13022516,"title":"send message to Node.js function with UIWebview","body":"<p>There is a Node.js function  as <code>getdate(data1, date2)</code>.  I would like to send message to <code>getdate(\"hi\",\"hello\")</code> from UIWebview.  Can anyone tell me how to do this?</p>\n"},{"tags":["javascript","node.js","requirejs"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13022288,"title":"Modular Client/Server Javascript","body":"<p>What is the best way to write a Javascript middle-ware library that would be used on both the client and the server?</p>\n\n<p>Say we have a data abstraction layer, let's call it <a href=\"http://jefri.org\" rel=\"nofollow\">JEFRi</a>. The JEFRi runtime needs to run the same in both the client and the server, so that all parts of the application using the DAL can reference the same implementation, API, etc. JEFRi has dependencies (specifically underscore), and has submodules that depend on it (Mongo storage, LocalStore storage).</p>\n\n<p>What pattern(s) should be used to allow easiest code sharing between the browser and node?</p>\n\n<p>It must:</p>\n\n<ul>\n<li>be installable on the server using NPM</li>\n<li>be loadable in the server using CommonJS require() calls</li>\n<li>be installable for a  browser project using one of: ender, bower, npm</li>\n<li>be installable for a browser project by copying a <code>.min.js</code> that does not have library dependencies within the file.</li>\n<li>be loadable on a page using  tags (and registering itself in the global scope)</li>\n<li>be loadable on a page using AMD <code>define()</code> and <code>require()</code> calls</li>\n</ul>\n\n<p>Any number of build steps are acceptable.</p>\n"},{"tags":["node.js","brackets"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12490220,"title":"Adobe Brackets - debugging Node.js & Node-inspector","body":"<p>Quick question: Is it possible to use Adobe Brackets to debug Node.js using Node-inspector. Like be able to step debug in Adobe Brackets?</p>\n\n<p>Thanks\nRegards\nChris</p>\n"},{"tags":["html5","node.js","facebook-graph-api","notifications","websocket"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":314,"score":1,"question_id":12253762,"title":"HTML5 Websocket + Node.js Realtime Notification System","body":"<p>in the last weeks I have built a small notification system using <strong>HTML5 Websockets and node.js with socket.io.</strong> \nThere are still some things that I haven´t solved, yet.</p>\n\n<p>I have read that realtime notification using node.js should be the best performance solution vs long polling etc because of non blocking i/o operations.</p>\n\n<p>Now assume we have to notify friends of this user. Something like \"I have bought a new iphone\". How do I teach node.js to realtime notify specific user 1:n? Till know I have only got sending and receiving message 1-1 communication.\nThis means I have to go check against facebook api friendlist first and find out which facebook_id is connected with which socket_id somehow. Then check the users privacy settings, if he would like to receive notifications and then send and save it into the database.</p>\n\n<p>So to me this somehow seems not to be the most effective solution...</p>\n\n<p>At the moment <strong>I would use mongo-db native driver for node.js and have db operations done by serversided javascript.\nI still need to implement facebooks javascript sdk to get the friendslist, but I would have trouble with the users privacy settings.</strong> Doesn´t this destroy all the advantages of non-blocking I/O?</p>\n\n<p>How do you actually solve this. To me, it seems very complex.</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["node.js","local-storage"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":429,"score":0,"question_id":10358100,"title":"How to access localStorage in node.js?","body":"<p>I tried searching the web for a node module that can access the client's localStorage but wasn't able to find anything. Anyone know of one?</p>\n"},{"tags":["javascript","node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13020889,"title":"Iterating Objects in Node.JS for HTTP response","body":"<p>I have an object array in Node.JS and I wish to response.write(); it to the screen, I can manage to get the first object out but the loop stops and only the first is outputted, can anybody point me in the right direction...</p>\n\n<pre><code>db.collection('todo', function(err, collection){            \n                    collection.find(function(err, cursor) {\n                        cursor.each(function(err, doc) {\n                            for(docs in doc){\n                                if(docs == \"_id\"){\n\n                                }else{\n                                    var test = docs + \" : \" + doc[docs];\n\n\n                                }\n\n                            }\n                            data = data.toString(\"utf8\").replace(\"{{TEST}}\", test);\n                            response.write(data);\n                            response.end(); \n                        })                    \n                    });\n                });\n</code></pre>\n"},{"tags":["node.js","npm"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":396,"score":1,"question_id":10081293,"title":"Install NPM into home directory with distribution nodejs package (Ubuntu)","body":"<p>I'd like to use the distribution Node.js packages (or the <a href=\"https://launchpad.net/~chris-lea/+archive/node.js/\" rel=\"nofollow\">chris-lea ppa</a> for more recent releases) but install NPM to my home directory. </p>\n\n<p>This may seem picky, but it's a pretty idiomatic way for polyglot/github-using developers to setup language runtime/library environments under Linux: distro packages for the runtime, 3rd-party libraries in per-user environment (see virtualenv, RVM - RVM will also build Ruby for you if you want). If necessary I will build node locally but it's a PITA since Node is becoming an incidental development requirement for lots of projects.</p>\n\n<ul>\n<li><a href=\"http://increaseyourgeek.wordpress.com/2010/08/18/install-node-js-without-using-sudo/\" rel=\"nofollow\">Instructions for installing node+npm to home directory</a></li>\n<li><a href=\"http://tnovelli.net/blog/blog.2011-08-27.node-npm-user-install.html\" rel=\"nofollow\">Another method for installing node+npm to home</a></li>\n</ul>\n\n<p>The second link seems like it might work with distribution nodejs packages, but it seems pretty sketchy.</p>\n\n<p><strong>Update</strong> <a href=\"http://pastebin.com/VMG7qiGj\" rel=\"nofollow\">this paste</a> sums up the second link above, but doesn't work for me (it seems like npm ignores ~/.npmrc, at least during install).</p>\n"},{"tags":["javascript","jquery","ajax","node.js"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2638,"score":3,"question_id":3725928,"title":"Node.js ajax file uploader","body":"<p>I am trying to make a node.js file uploader with a ajax progress bar.</p>\n\n<pre><code>var formidable = require('./formidable'), http = require('http'), sys = require('sys');\n http.createServer(function(req, res) {\n  if (req.url == '/upload' &amp;&amp; req.method.toLowerCase() == 'post') {\n    // parse a file upload\n    var form = new formidable.IncomingForm();\n    form.uploadDir = './node_uploads';\n    form.keepExtensions = true;\n    //print the upload status in bytes\n    form.addListener(\"progress\", function(bytesReceived, bytesExpected) {\n        //progress as percentage\n        progress = (bytesReceived / bytesExpected * 100).toFixed(2);\n        mb = (bytesExpected / 1024 / 1024).toFixed(1);\n        sys.print(\"Uploading \"+mb+\"mb (\"+progress+\"%)\\015\");\n    });\n    //enter here after upload complete\n    form.parse(req, function(fields, files) {\n        sys.debug(\"Upload Complete\");\n        res.writeHead(200, {'content-type': 'text/plain'});\n        res.write('received upload:\\n\\n');\n        res.end());\n    });\n    return;\n  }\n  if (req.url == '/update') {\n        res.writeHead(200, {'content-type': 'text/plain'});\n        res.write('&lt;?xml version=\"1.0\"?&gt;&lt;response&gt;&lt;status&gt;1&lt;/status&gt;&lt;message&gt;'+ 000 +'&lt;/message&gt; &lt;/response&gt;');\n        res.end();\n\n    }\n  // show a file upload form\n  res.writeHead(200, {'content-type': 'text/html'});\n  res.end\n    ( '&lt;form action=\"/upload\" enctype=\"multipart/form-data\" method=\"post\"&gt;'\n    + '&lt;p id=\"statuslabel\"&gt;&lt;/p&gt;&lt;p id=\"anotherlabel\"&gt;&lt;/p&gt;' \n    + '&lt;input type=\"text\" name=\"title\" id=\"title\"&gt;&lt;br&gt;'\n    + '&lt;input type=\"file\" name=\"upload\" multiple=\"multiple\"&gt;&lt;br&gt;'\n    + '&lt;input type=\"submit\" value=\"Upload\" id=\"uploadform\"&gt;'\n    + '&lt;/form&gt;'\n    );\n}).listen(8000, '127.0.0.1');\n</code></pre>\n\n<p>The jquery is quite lengthy so I have cut it out but all it does is start a timer and request data from update and set on the label.</p>\n\n<p>With this code will node accept multiple uploads from different hosts ?\nAlso firefox doesnt seem to work but safari/chrome does any idea ?\nHow would I request a status for the file upload ? </p>\n\n<p>Thanks, Alex</p>\n"},{"tags":["mysql","node.js","node-mysql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13018227,"title":"Reproduce MySQL error: The server closed the connection (node.js)","body":"<p>I'm trying to reproduce a MySQL error I'm seeing in my node.js app on EC2 with the <a href=\"https://github.com/felixge/node-mysql\" rel=\"nofollow\">node mysql library</a>:</p>\n\n<blockquote>\n  <p>Connection lost: The server closed the connection.</p>\n</blockquote>\n\n<p>I  am unable to reproduce the error locally- killing the database is handled just fine by my code- it just rechecks every few seconds and reconnects to the db once it is restarted. On EC2, it happens around 4am Pacific, but the db is still up and running fine.</p>\n\n<p>I'd like to</p>\n\n<ol>\n<li>Reproduce the crash with my local mysql</li>\n<li>Add whatever logic I need in my mysql helper module to handle this</li>\n</ol>\n\n<hr>\n\n<p>Here's the error in my node.js app:</p>\n\n<blockquote>\n  <p>2012-10-22T08:45:40.518Z - error: uncaughtException date=Mon Oct 22\n  2012 08:45:40 GMT+0000 (UTC), pid=14184, uid=0, gid=0,\n  cwd=/home/ec2-user/my-app, execPath=/usr/bin/nodejs,\n  version=v0.6.18, argv=[/usr/local/bin/node,\n  /home/ec2-user/my-app/app.js, --my-app], rss=15310848,\n  heapTotal=6311392, heapUsed=5123292, loadavg=[0.0029296875,\n  0.0146484375, 0.04541015625], uptime=3238343.511107486, trace=[column=13,\n  file=/home/ec2-user/my-app/node_modules/mysql/lib/protocol/Protocol.js,\n  function=Protocol.end, line=63, method=end, native=false, column=10,\n  file=stream.js, function=Socket.onend, line=80, method=onend,\n  native=false, column=20, file=events.js, function=Socket.emit,\n  line=88, method=emit, native=false, column=51, file=net.js,\n  function=TCP.onread, line=388, method=onread, native=false],\n  stack=[Error: Connection lost: The server closed the connection.,<br>\n  at Protocol.end\n  (/home/ec2-user/my-app/node_modules/mysql/lib/protocol/Protocol.js:63:13),     at Socket.onend (stream.js:80:10),     at Socket.emit\n  (events.js:88:20),     at TCP.onread (net.js:388:51)]</p>\n</blockquote>\n\n<p>Here's my code (mysql helper module):</p>\n\n<pre><code>module.exports = function (conf,logger) {\n  var mysql = require('mysql');\n\n  var connectionState = false;\n  var connection = mysql.createConnection({\n    host: conf.db.hostname,\n    user: conf.db.user,\n    password: conf.db.pass,\n    database: conf.db.schema,\n    insecureAuth: true\n  });\n\n  function attemptConnection(connection) {\n    if(!connectionState){\n      connection = mysql.createConnection(connection.config);\n      connection.connect(function (err) {\n        // connected! (unless `err` is set)\n        if (err) {\n          logger.error('mysql db unable to connect: ' + err);\n          connectionState = false;\n        } else {\n          logger.info('mysql connect!');\n          connectionState = true;\n        }\n      });\n      connection.on('close', function (err) {\n        logger.error('mysqldb conn close');\n        connectionState = false;\n      });\n      connection.on('error', function (err) {\n        logger.error('mysqldb error: ' + err);\n        connectionState = false;\n\n        /*\n        if (!err.fatal) {\n          return;\n        }\n        if (err.code !== 'PROTOCOL_CONNECTION_LOST') {\n          throw err;\n        }\n        */\n      });\n    }\n  }\n  attemptConnection(connection);\n\n  var dbConnChecker = setInterval(function(){\n    if(!connectionState){\n      logger.info('not connected, attempting reconnect');\n      attemptConnection(connection);\n    }\n  }, conf.db.checkInterval);\n\n  return connection;\n};\n</code></pre>\n"},{"tags":["json","node.js","rest","express","jsonschema"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":13002898,"title":"nodejs json-schema fail to read schema","body":"<p>I have an express app, which has a post method(the post is a json type):</p>\n\n<p>server.js(simplified version):</p>\n\n<pre><code>   app.post('/listener/v1/event/', function(req, res) {\n            .\n            .\n            var event = req.body;\n            var validator = require(\"./validator\");\n            validator.validate(event);\n    }\n</code></pre>\n\n<p>validator.js contains the validation for the json:</p>\n\n<pre><code>var jsonschemavalidate = require(\"json-schema\");\nvar basicSchema = require('fs').readFileSync('./schema.json', 'utf8');\n\nexports.validate = function (event) {\n    console.log(jsonschemavalidate.validate(event, basicSchema).errors);\n}\n</code></pre>\n\n<p>The schema.json: </p>\n\n<pre><code>{ \n    name : \"test\",\n    type : 'object', \n    properties : { \n        event_id : { type : 'string' }, \n        timestamp : { type : 'string' } \n    }\n}\n</code></pre>\n\n<p>For the input I use curl:</p>\n\n<pre><code>curl -i -X POST -H 'Content-Type: application/json' -d '{\"event_id\": \"NedaleGassss\", \"timestamp\": \"a2009321\"}' http://localhost:3000/listener/v1/event/\n</code></pre>\n\n<p>The output is as follows:</p>\n\n<pre><code>[ { property: '',\n    message: 'Invalid schema/property definition {\\n    name : \"test\",\\n    type : \"object\",\\n    additionalProperties : false,\\n    properties :\\n    {\\n        event_id            : { type : \"string\" },\\n        timestamp        \\t: { type : \"string\" }\\n    }\\n}' } ]\n</code></pre>\n"},{"tags":["node.js","requirejs","r.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13005982,"title":"Specifying an r.js output directory from the command line","body":"<p>I am running r.js in a build step of my project to concatenate and minify javascript. I would like to specify the output for the built scripts from the command line instead of in the bulid script.</p>\n\n<p>For the curious; my build script looks something like the following</p>\n\n<pre><code>({\n   mainConfigFile: 'main.js',\n   modules: [\n\n        //Main\n        {\n           name: 'main',\n           exclude: ['loadKoTemplate']\n        },\n        {\n           name: 'AnotherScreen',\n           exclude: [\"knockout\"]\n        }            \n   ],\n   dir: 'Built' //I would like to exclude this line\n})\n</code></pre>\n\n<p>And during an MSBuild I call out to it like so</p>\n\n<pre><code>&lt;Exec Command=\"$(ProjectDir)Dependencies\\node\\node $(ProjectDir)Dependencies\\node\\node_modules\\requirejs\\bin\\r.js -o $(ProjectDir)scripts\\app.build.js\" /&gt;\n</code></pre>\n\n<p>I would like to put the built scripts in an intermediate build folder (an obj folder) before I copy them to their final location. This allows me to build differently depending on the project configuration.</p>\n\n<p>Is there a way to do this?</p>\n"},{"tags":["query","node.js","mongodb","geddy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13001245,"title":"Query mongodb with geddy","body":"<p>While trying out the node.js framework geddy (on windows) and i've run into a bit of a problem.</p>\n\n<p>I'm trying to query mongodb, in my controller, using the .first() method from my Users Model like so:</p>\n\n<pre><code>geddy.model.User.first({name: 'jdoe'}, function (err, data) {\n  if (err) {\n    throw err;\n  } else {\n    console.log(data);\n  }\n\n});\n</code></pre>\n\n<p>Strangely enough i'm not getting any output, error, nothing. The user jdoe exists in the collection so it should output something, right ? Am i doing something wrong ?</p>\n\n<p>My model is defined as:</p>\n\n<pre><code>var User = function () {\n\n    this.defineProperties({\n      username: {type: 'string', required: true},\n      password: {type: 'string', required: true},\n    });\n\n    this.autoIncrementId = true;\n\n};\n\nUser = geddy.model.register('User', User);\n</code></pre>\n\n<p>The default adapter is set to mongo in development.js, when i ran geddy for the first time it created my database and it has inserted the Users collection correctly.</p>\n\n<p>Any idea on whats going wrong here ?</p>\n\n<p>UPDATE:</p>\n\n<p>added development.js as requested</p>\n\n<pre><code>var config = {\n  detailedErrors: true\n, debug: true\n, hostname: null\n, port: 4000\n, model: {\n    defaultAdapter: 'mongo',\n    }\n,db: {\n    mongo: {\n        dbname: 'knowledgebase'\n    }\n}\n, sessions: {\n    store: 'memory'\n  , key: 'sid'\n  , expiry: 14 * 24 * 60 * 60\n  }\n};\n\nmodule.exports = config;\n</code></pre>\n\n<p>also my collections on mongo ( created by geddy )</p>\n\n<pre><code>&gt; show collections\nUser\nsystem.indexes\nusers\n</code></pre>\n\n<p>note that somehow geddy is creating two collections instead of one</p>\n"},{"tags":["java","javascript","node.js"],"answer_count":1,"favorite_count":3,"up_vote_count":2,"down_vote_count":1,"view_count":85,"score":1,"question_id":13019855,"title":"Is node.js ready for replacing server tasks?","body":"<p>I am watching node.js and its apps for a year now and I would love to replace bigger parts of my good old Java code with node.js.</p>\n\n<p>The problem I noticed with node.js is that </p>\n\n<ul>\n<li>it looks like a chaos, from version to version things don't work anymore </li>\n<li>bad documentation, really bad</li>\n<li>no idea what libraries have been ported or will be ported any time soon</li>\n<li>multi core managment, does it ? </li>\n<li>uses 100% of the CPU power regardless of what it actually does (ie : pauses in loops). Thats not green and this is important to us.</li>\n</ul>\n\n<p>Regarding security concerns I would put it behind a reverse proxy and only my old and real Java server would be able to use it.</p>\n\n<p>update : funny this question gets closed because its not constructive. how can the question be constructive when I don't have any glue? Thats why also I am aksing here ! You moderators here really suck sometimes.</p>\n\n<p>However, would you rather suggest to wait before moving to node ? Or do you think its time to move over ?</p>\n\n<p>I'm writing loads of Java server side code and I would start building my own base framework and then port piece by piece!?  </p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13014997,"title":"Nodejs - Frisby testing","body":"<p>Node Script have to call a URL , and  get the response and use the some variable of the response to call the next url. is it possible?</p>\n\n<p>in below example, i'm using token in other scripts.</p>\n\n<pre><code>var http = require('http');\nvar options = {\n    host: 'url' ,\n    path: '/path',\n    method: 'POST'\n};\nvar req = http.request(options, function(res) {\n    token=\"hi\"; // to be populated by res\n});\nreq.end();\nexports.token = token\n</code></pre>\n"},{"tags":["node.js","express","handlebars.js","mustache","momentjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":13008326,"title":"Expressjs + handlebars formatting date","body":"<p>i've got this object</p>\n\n<pre><code>{ title: 'A TITLE',\n  description: 'Lorem Ipsum...',\n  _id: 50806930bbf612a858000013,\n  __v: 0,\n  screenings: \n   [ { venue: 'Venue1', dates: [Object] },\n     { venue: 'Venue2', dates: [Object] } ] }\n</code></pre>\n\n<p>coming out of my mongoDB.</p>\n\n<p><code>dates</code> is a list of dates (dah!).</p>\n\n<p>My issue is now I want to have them formatted with momentjs <strong>server-side</strong>.</p>\n\n<p>It would look like I should be using mustache lambdas, but it appears impossible using my stack (<strong>expressjs</strong>, <strong>consolidate</strong>, <strong>handlebars</strong>...)</p>\n\n<p>Anybody solved this?</p>\n\n<p>Here's what I'm trying now</p>\n\n<pre><code>Theatre.find({\"screenings.dates\":{$gte:lastSunday, $lte:nextSunday}}, function(err, entities){\n    res.render('index', {\n        entities: entities,\n        giveitatry: function(a) {\n            return moment(a).format(\"MMM Do YY\")\n        }\n    });\n});\n</code></pre>\n\n<p>and on my template I have:</p>\n\n<pre><code>{{#entities}}\n&lt;div class=\"span3\"&gt;{{#giveitatry}} {{dates.0.}} {{/giveitatry}}&lt;/div&gt;\n{{/entities}}\n</code></pre>\n\n<p>Here's part of the expressjs conf</p>\n\n<pre><code>var moment = require('moment');\n\nvar express = require('express')\n  , cons = require('consolidate')\n  , name = 'mustache';\n\napp.configure(function(){\n app.set('view engine', 'hjs');\n app.engine('.hjs', cons.mustache);\n ...\n</code></pre>\n\n<p>yes, extension's still hjs 'cause i started using hogan but i wasn't able to do it with hogan so i moved to consolidate+mustache.</p>\n\n<p>i'm using node v0.8.8 and expressjs 3.0.0rc4</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13017071,"title":"Passing unknown number of params to NodeJS routes","body":"<p>How can I pass an unknown number of params to NodeJS routes, and save them to an array?:</p>\n\n<pre><code>http://127.0.0.1:3000/param1/param2/param3...\n</code></pre>\n\n<p>I thought about doing:</p>\n\n<pre><code>app.get('/*', myHandler);\n</code></pre>\n\n<p>And just tokenize the string, but there should be a better way.</p>\n"},{"tags":["node.js","heroku","dtrace","restify"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13014712,"title":"Error deploying node js restify application to heroku","body":"<p>I'm having an issue deploying a restify application to Heroku.</p>\n\n<pre><code>npm ERR! dtrace-provider@0.0.9 install: `node-waf clean ; node-waf configure build`\nnpm ERR! `sh \"-c\" \"node-waf clean ; node-waf configure build\"` failed with 1\nnpm ERR!\nnpm ERR! Failed at the dtrace-provider@0.0.9 install script.\nnpm ERR! This is most likely a problem with the dtrace-provider package,\nnpm ERR! not with npm itself.\n</code></pre>\n\n<p>It seems as if Heroku has an issue with dtrace, which restify makes use of, although doesn't require, I've read that you can bypass this by removing dtrace from restify's package.json file, however I have attempted this with no success.</p>\n\n<p>I'm new to node and using Heroku and git so I'm sure there's something I'm missing, restify's package.json file contains the following:</p>\n\n<pre><code>\"dependencies\": {\n    \"dtrace-provider\": \"0.0.9\",\n},\n\"optionalDependencies\": {\n    \"dtrace-provider\": \"0.0.9\"\n},\n</code></pre>\n\n<p>I have removed these lines but still receive the same error message as above after committing to git and pushing to Heroku.</p>\n\n<p>Can anyone see what I'm missing?</p>\n"},{"tags":["windows","node.js","ms-access","odbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13017024,"title":"Libraries for connecting node.js to odbc on Windows?","body":"<p>I'm looking for a library that allows node.js to connect to ODBC on windows.  All the libraries I have found thus far seem to work with UnixODBC but not windows, can someone please suggest a library that will work with Windows?</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13009750,"title":"nodejs: action need to be done before requests are handled","body":"<p>My app needs to do some action first (and once) and only then start handling the requests and run other actions.\nI'm looking for some middleware that will get the first action and a bunch of handlers. It should first will invoke the action, and only when it's done it will call all the handlers without calling the first action again.</p>\n\n<p>Edit: suppose my first action takes a while. I can register the app.get handlers in my first action's callback, but then any request arriving before my first action is done will be lost. Instead, I want to store the requests in a queue until the first action finishes, and only then call the handlers on the pending request. Afterwards, I want my middleware to delete itself, so that only the request handlers will handle the new requests.</p>\n\n<p>Do you know such a middleware?</p>\n\n<p>Thanks,\nLi</p>\n"},{"tags":["node.js","iisnode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13011269,"title":"iisnode failed to process http response status line","body":"<p>I'm using IISnode 0.1.21 x64 on Windows 2008 R2 and Node 0.8</p>\n\n<p>My application is running successfully with 4 threads. But after sometime (say 3-4 hours) the responses don't make it from IISnode to the client and the user doesn't get the data on the page (but the rest of the application is working). I tried creating a log in the IISnode folder but didn't get anything from there.</p>\n\n<p>If I remove even one node.exe process from the task manager, the application starts working properly. Then again after a couple of hours, i'm back to square one.</p>\n\n<p>I got the ETW log and this is what it shows:</p>\n\n<pre><code>&lt;Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\"&gt;\n    &lt;System&gt;\n        &lt;Provider Guid=\"{1040dfc4-61db-484a-9530-584b2735f7f7}\" /&gt;\n        &lt;EventID&gt;0&lt;/EventID&gt;\n        &lt;Version&gt;0&lt;/Version&gt;\n        &lt;Level&gt;2&lt;/Level&gt;\n        &lt;Task&gt;0&lt;/Task&gt;\n        &lt;Opcode&gt;0&lt;/Opcode&gt;\n        &lt;Keywords&gt;0x0&lt;/Keywords&gt;\n        &lt;TimeCreated SystemTime=\"2012-10-21T13:21:56.783161800Z\" /&gt;\n        &lt;Correlation ActivityID=\"{00000000-0000-0000-0000-000000000000}\" /&gt;\n        &lt;Execution ProcessID=\"2468\" ThreadID=\"3484\" ProcessorID=\"0\" KernelTime=\"195\" UserTime=\"435\" /&gt;\n        &lt;Channel /&gt;\n        &lt;Computer /&gt;\n    &lt;/System&gt;\n        &lt;Data&gt;{00000000-0000-0000-6E02-0080000000CA}: iisnode failed to process http response status line&lt;/Data&gt;\n&lt;/Event&gt;\n&lt;Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\"&gt;\n    &lt;System&gt;\n        &lt;Provider Guid=\"{1040dfc4-61db-484a-9530-584b2735f7f7}\" /&gt;\n        &lt;EventID&gt;0&lt;/EventID&gt;\n        &lt;Version&gt;0&lt;/Version&gt;\n        &lt;Level&gt;5&lt;/Level&gt;\n        &lt;Task&gt;0&lt;/Task&gt;\n        &lt;Opcode&gt;0&lt;/Opcode&gt;\n        &lt;Keywords&gt;0x0&lt;/Keywords&gt;\n        &lt;TimeCreated SystemTime=\"2012-10-21T13:21:56.783171500Z\" /&gt;\n        &lt;Correlation ActivityID=\"{00000000-0000-0000-0000-000000000000}\" /&gt;\n        &lt;Execution ProcessID=\"2468\" ThreadID=\"3484\" ProcessorID=\"0\" KernelTime=\"195\" UserTime=\"435\" /&gt;\n        &lt;Channel /&gt;\n        &lt;Computer /&gt;\n    &lt;/System&gt;\n        &lt;Data&gt;{00000000-0000-0000-6E02-0080000000CA}: iisnode request processing failed for reasons unrecognized by iisnode&lt;/Data&gt;\n&lt;/Event&gt;\n</code></pre>\n"},{"tags":["javascript","database","node.js","mongodb","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13014548,"title":"What is the recommended way to drop indexes using Mongoose?","body":"<p>I need to create several deployment scripts like data migration and fixtures for a MongoDB database and I couldn't find enough information about how to drop indexes using Mongoose API. This is pretty straight-forward when using the official MongoDB API:</p>\n\n<blockquote>\n  <p>To delete all indexes on the specified collection:<br /><br />\n  <code>db.collection.dropIndexes();</code></p>\n</blockquote>\n\n<p>However, I would like to use Mongoose for this and I tried to use <code>executeDbCommand</code> adapted from <a href=\"https://groups.google.com/forum/?fromgroups=#!topic/mongoose-orm/bvdS3B_oNcM\" rel=\"nofollow\">this post</a>, but with no success:</p>\n\n<pre><code>mongoose.connection.db.executeDbCommand({ dropIndexes: collectionName, index: '*' },\n  function(err, result) { /* ... */ });\n</code></pre>\n\n<p>Should I use the official MongoDB API for Node.js or I just missed something in this approach?</p>\n"},{"tags":["node.js","mongodb","insert","exists","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":13010290,"title":"NodeJS + Mongo: Insert if not exists, otherwise - update","body":"<p>I have a an object in my mongodb collection. Its schema is:</p>\n\n<pre><code>{\n    \"instruments\": [\"A\",\"B\",\"C\"],\n    \"_id\": {\n        \"$oid\": \"508510cd6461cc5f61000001\"\n    }\n}\n</code></pre>\n\n<p>My collection may have such object, but may not. I need to check if object with key \"instruments\" exists (<strong>please, notе, I don't know what value \"instrument\" is ay this time, it may contain any value or an array</strong>), and if exists - perform updation, otherwise – insert a new value. How can I do this?</p>\n\n<pre><code>collection.find( {  \"instruments\" : { $exists : true } }, function(err, object){\n    if (object) {\n        //update\n    } else {\n        //insert\n    }\n});\n</code></pre>\n\n<p>doesn't work ((</p>\n"},{"tags":["node.js","module"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13014874,"title":"nodejs - module dependencies","body":"<p>Let's say I have module A.js and B.js.</p>\n\n<p><strong>A.js</strong></p>\n\n<pre><code>var b = require('./B');\n[...some code here...]\n</code></pre>\n\n<p><strong>B.js</strong></p>\n\n<pre><code>var a = require('./A');\n[...some code here...]\n</code></pre>\n\n<p>than in my <strong><code>app.js</code></strong> I have something like:</p>\n\n<p><strong>app.js</strong></p>\n\n<pre><code>var a = require('./A');\n[some code here]\n</code></pre>\n\n<p>The thing is that the <code>var a</code> in <strong><code>B.js</code></strong> is always an empty object <strong><code>{}</code></strong> when I do like <strong><code>node app.js</code></strong> while If I directly do <strong><code>node B.js</code></strong> it is properly initialized.</p>\n\n<p>What instead I would expect is that calling <strong><code>node app.js</code></strong> it triggers <strong><code>A.js</code></strong> (that requires <strong><code>B.js</code></strong>) and so, in turn it initialtes its own <strong><code>a</code></strong> variable.... but it is not like this apparently....</p>\n"},{"tags":["javascript","json","node.js","backbone.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13005812,"title":"Why is backbone sending model information inside {model: {model_property:value ,...} } when i save a model","body":"<p>I'm writing an app with node.js and backbone.js. However when I try to save a model it is nesting the JSON of the model inside a model dictionary.</p>\n\n<pre><code>node = new NodeModel({prop1:\"value1\", prop2:\"value2\"});\nnode.save();\n</code></pre>\n\n<p>The results of console.log(req.body); inside my node controler show...</p>\n\n<pre><code>{model: {\"prop1\":\"value1\", \"prop2\":\"value2\"} }\n</code></pre>\n\n<p>If i use a standard html form to post to the same node controller the results of console.log(req.body); show...</p>\n\n<pre><code>{prop1:\"value1\", prop2:\"value2\"}\n</code></pre>\n\n<p>How can i get the node.save(); function to post the same JSON that the regular HTML does?</p>\n"},{"tags":["node.js","backbone.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12109976,"title":"Access element which belongs to another page","body":"<p>I have one master page view ( like master page in normal asp.net website) and I have on another child page ( let say activity page ). </p>\n\n<p>I have one label on my master page, which is showing no. of unread activities count to user. When I am watching activity page, at that time I don't want to show activities count, but want to add recent activity directly to list on activity page.</p>\n\n<p>I had already written code in one function, which is fetch data from my database on activity page. Now I would like to access this method (of activity page) from my master page. </p>\n\n<p>How can I do this is within node.js ?</p>\n"},{"tags":["node.js","redirect","iis7","port"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13002090,"title":"IIS7: Redirect request to internal port","body":"<p>I have a NodeJS application. I want to create a different instance of this application for each of my clients. My initial thoughts were to have each instance in a different port, and then launch a Node instance listening to those ports:</p>\n\n<p>Client 1: <a href=\"http://client1.myapp:81\" rel=\"nofollow\">http://client1.myapp:81</a>  (an instance of my Node app listening port 81)</p>\n\n<p>Client 2: <a href=\"http://client2.myapp:82\" rel=\"nofollow\">http://client2.myapp:82</a>  (an instance of my Node app listening port 82)</p>\n\n<p>...</p>\n\n<p>I wouldn't want to open so many ports externally, so I'd like to know if it's possible to have my clients accessing their apps through port 80:</p>\n\n<p>Client 1: <a href=\"http://client1.myapp\" rel=\"nofollow\">http://client1.myapp</a></p>\n\n<p>Client 2: <a href=\"http://client2.myapp\" rel=\"nofollow\">http://client2.myapp</a></p>\n\n<p>...</p>\n\n<p>and then have IIS redirect each request to its corresponding INTERNAL port, where the specific NodeJS app instance would be listening.</p>\n\n<p>This way I only need port 80 opened externally.</p>\n\n<p>Is this possible? Is this common practice?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["node.js","websocket","redis","scalability","load-balancing"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":13012394,"title":"How to Scale Node.js WebSocket Redis Server?","body":"<p>I'm writing a chat server for <a href=\"http://www.acani.com\" rel=\"nofollow\">Acani</a>, and I have some questions about <a href=\"http://stackoverflow.com/questions/4710420/scaling-node-js\">Scaling node.js</a> and <a href=\"http://stackoverflow.com/questions/8627295/websockets-with-load-balancer-scalability\">websockets with load balancer scalability</a>.</p>\n\n<ol>\n<li><p>What exactly does it mean to load balance Node.js? Does that mean there will be <em>n</em> independent versions of my server application running, each on a separate server?</p></li>\n<li><p>To allow one client to broadcast a message to all the others, I store a set of all the <code>webSocketConnections</code> opened on the server. But, if I have <em>n</em> independent versions of my server application running, each on a separate server, then will I have <em>n</em> different sets of <code>webSocketConnections</code>?</p></li>\n<li><p>If the answers to 1 &amp; 2 are affirmative, then how do I store a universal set of <code>webSocketConnections</code> (across all servers)? One way I think I could do this is use Redis Pub/Sub and just have every <code>webSocketConnection</code> subscribe to a channel on Redis.</p></li>\n<li><p>But, then, won't the single Redis server become the bottleneck? How would I then scale Redis? What does it even mean to scale Redis? Does that mean I have <em>m</em> independent versions of Redis running on different servers? Is that even possible?</p></li>\n<li><p>I heard Redis doesn't scale. Why would someone say that. What does that mean? If that's true, is there a better solution to for pub/sub and/or storing a list of all broadcasted messages?</p></li>\n</ol>\n\n<p>Note: If your answer is that Acani would never have to scale, even if each of all seven billion people (and growing) on Earth were to broadcast a message every second to everyone else on earth, then please give a valid explanation.</p>\n"},{"tags":["node.js","nodester"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13013870,"title":"Nodester user setup error","body":"<p>I have account on nodester and I want upload my node.js app. When I enter in console </p>\n\n<pre><code>nodester\n</code></pre>\n\n<p>i get error below. Please tell me why I get this error when I try login on nodester over GIT? </p>\n\n<p>I generate .ssh key with </p>\n\n<pre><code> ssh-keygen -t rsa  \n</code></pre>\n\n<p>command, and install cli interface with </p>\n\n<pre><code> npm install nodester-cli -g \n</code></pre>\n\n<p>Error is: </p>\n\n<pre><code>Users\\User\\AppData\\Roaming\\n\n auth += c.final(\"utf8\");\n       ^\n eError: DecipherFinal fail\n at decryptAuth (C:\\Users\\Vlat\nib\\config.js:71:15)\n at Object.exports.parse (C:\\U\nter-cli\\lib\\config.js:165:13)\n  at Object.&lt;anonymous&gt; (C:\\Use\nr-cli\\lib\\commands.js:58:21)\n at Module._compile (module.js\n  at Object.Module._extensions.\n  at Module.load (module.js:356\n  at Function.Module._load (mod\nat Module.require (module.js:\n at require (module.js:378:17)\n at Object.&lt;anonymous&gt; (C:\\Use\n r-cli\\bin\\nodester.js:11:11) \n</code></pre>\n"},{"tags":["php","node.js","pusher"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12371406,"title":"Pusher library for Node.js or PHP which can subscribe to channels?","body":"<p>I'am trying to build server-side client for Pusher. Client shoud be able to subscribe to channels and react to events... After getting info from DB etc it shoud send info to another clients (Javascript, Arduino).</p>\n\n<p>Problem is I cant find any server side library which will be able subscribing to Pusher channel and binding to events... </p>\n\n<p>Is something like this already written? Do you have some tips?</p>\n"},{"tags":["node.js","deployment","heroku"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13011881,"title":"Node.js: Simple app not working on Heroku","body":"<p>I've written a basic node.js application and I've managed to deploy it on Heroku without having any problem. I've created my <b>package.json</b> and <b>Procfile</b>, however from logs I see that there is no running processes, thus cannot get any response. What could be the problem?</p>\n\n<p><b>PS: </b> I do not want to use the <b>Express</b> framework</p>\n\n<p><b>My Code: </b></p>\n\n<pre><code>var http = require(\"http\");\n\nhttp.createServer(function(request, response) {\n  response.writeHead(200, {\"Content-Type\": \"text/plain\"});\n  response.write(\"Hello World\");\n  response.end();\n\n  console.log(\"I am working\");\n}).listen(8888);\n</code></pre>\n\n<p><b>My package.json: </b></p>\n\n<pre><code>{\n  \"name\": \"node-example\",\n  \"version\": \"0.0.1\",\n  \"dependencies\": {\n  },\n  \"engines\": {\n    \"node\": \"0.8.x\",\n    \"npm\": \"1.1.x\"\n  }\n}\n</code></pre>\n\n<p><b>Logs: </b></p>\n\n<pre><code>2012-10-22T12:36:58+00:00 heroku[slugc]: Slug compilation started\n2012-10-22T12:37:07+00:00 heroku[slugc]: Slug compilation finished\n2012-10-22T12:40:55+00:00 heroku[router]: Error H14 (No web processes running) -&gt; GET aqueous-bastion-6914.herokuapp.com/ dyno= queue= wait= service= status=503 bytes=\n2012-10-22T12:50:44+00:00 heroku[router]: Error H14 (No web processes running) -&gt; GET aqueous-bastion-6914.herokuapp.com/ dyno= queue= wait= service= status=503 bytes=\n</code></pre>\n"},{"tags":["osx","node.js","fs"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":262,"score":3,"question_id":10762630,"title":"NodeJS fs.watch on directory only fires when changed by editor, but not shell or fs module","body":"<p>When the code below is ran, the watch is only triggered if I edit and save tmp.txt manually, using either my ide, TextEditor.app, or vim.</p>\n\n<p>It doesn't by method of the write stream or manual shell output redirection (typing echo \"test\" > /path/to/tmp.txt\").</p>\n\n<p>Although if I watch the file itself, and not its dirname, then it works.</p>\n\n<pre><code>var fs, Path, file, watchPath, w;\n\nfs = require('fs' );\nPath = require('path');\nfile = __dirname + '/tmp.txt';\nwatchPath = Path.dirname(file); // changing this to just file makes it trigger\n\nw = fs.watch ( watchPath, function (e,f) {\n    console.log(\"will not get here by itself\");\n    w.close();\n});\nfs.writeFileSync(file,\"test\",\"utf-8\");\n\nfs.createWriteStream(file, {\n    flags:'w',\n    mode: 0777\n} )\n.end('the_date=\"'+new Date+'\";' ); // another method fails as well\n\nsetTimeout (function () {\n    fs.writeFileSync(file,\"test\",\"utf-8\");\n},500); // as does this one\n// child_process exec and spawn fail the same way with or without timeout\n</code></pre>\n\n<p>So the questions are: why? and how to trigger this event programmatically from a node script?</p>\n\n<p>Thanks!</p>\n"},{"tags":["json","node.js","pagination","express","tumblr"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13001084,"title":"Numbered page navigation for blog using Node.js and Express","body":"<p>I'm developing a webapp using Node.js and Express. Inside this app, I manage a stream of JSON data to create a blog reader using Tumblr APIs.</p>\n\n<p>I wrote the route as:</p>\n\n<pre><code>app.get('/blog', function(req, res) {\n\n  var Tumblr = require('tumblr').Tumblr\n    , keys = require('./keystore');\n\n  // Instancing Tumblr object to connect with a certain blog.\n  var blog = new Tumblr('myblog.tumblr.com', keys.tumblrConsumerSecret);\n\n  // Using Tumblr API to retrieve posts from a remote blog.\n  // For more info about methods and parameters to use, read the\n  // documentation for Tumblr's API v2.\n  blog.posts({offset: 0, limit: 5}, function(err, tumblr) {\n    if (err) {\n       res.send('Error page... I suppose!');\n    }\n    else {\n      res.render('blog',\n      {\n        blog: tumblr.posts\n      });\n    }\n  }); \n});\n</code></pre>\n\n<p>And <code>blog.jade</code>:</p>\n\n<pre><code>each post in blog\n  h2 #{post.title}\n  .justified\n    != post.body\n</code></pre>\n\n<p>Now, I would like to add numbered page navigation function (as server-side) to the reader.</p>\n\n<pre><code>page 1: posts from 1 to 5\npage 2: posts from 6 to 10\n(etc...)\n</code></pre>\n\n<p>What can I do that?</p>\n\n<p>Best regards, Vi.</p>\n"},{"tags":["javascript","node.js","coffeescript","towerjs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":13011290,"title":"Cannot find module 'coffee-script'","body":"<p>Trying to get a basic site set up with TowerJS as a test, but ran into this error when running the scaffold generator.</p>\n\n<pre><code>Macbook:app john$ tower generate scaffold Post title:string body:text belongsTo:user\n{ [Error: Cannot find module 'coffee-script'] code: 'MODULE_NOT_FOUND' }\n\nmodule.js:340\n    throw err;\n          ^\nError: Cannot find module '/Users/john/Sites/tower/app/app/config/shared/application'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Function.Tower.Application.Application.reopenClass.instance (/usr/local/lib/node_modules/tower/lib/tower-application/server/application.js:42:15)\n    at _.extend.namespace (/usr/local/lib/node_modules/tower/lib/tower-support/shared/shared.js:218:30)\n    at GeneratorScaffoldGenerator.Tower.GeneratorResources.buildApp (/usr/local/lib/node_modules/tower/lib/tower-generator/server/resources.js:273:66)\n    at GeneratorScaffoldGenerator.Generator (/usr/local/lib/node_modules/tower/lib/tower-generator/server/generator.js:57:23)\n    at new GeneratorScaffoldGenerator (/usr/local/lib/node_modules/tower/lib/tower-generator/server/generators/tower/scaffold/scaffoldGenerator.js:21:61)\n    at Function.run (/usr/local/lib/node_modules/tower/lib/tower-generator/server/generator.js:22:12)\n</code></pre>\n"},{"tags":["node.js","redis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":194,"score":1,"question_id":9817999,"title":"Does the node-redis client.auth callback substitute for the ready event?","body":"<p>From <a href=\"https://github.com/mranney/node_redis\" rel=\"nofollow\">node-redis</a> documentation on github:</p>\n\n<blockquote>\n  <p>NOTE: Your call to client.auth() should not be inside the ready\n  handler. If you are doing this wrong, client will emit an error that\n  looks something like this Error: Ready check failed: ERR operation not\n  permitted</p>\n</blockquote>\n\n<p>So does that mean that when client.auth executes a callback passed to it, it is safe to assume that this connection is ready for normal commands as well? If no then is one supposed to juggle two callback functions, determining which one was called second?</p>\n"},{"tags":["javascript","node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13010554,"title":"Javascript referenced value not updated?","body":"<p>I basically have an object, but this object will only be filled after user input. But the other classes are using this object also. But then after I fill the object with the real object, it doesn't get updated in the other classes.</p>\n\n<p>Example :</p>\n\n<pre><code>var x = {\n  text: null\n}\nvar y = {\n  text: x.text\n}\n\nx.text = 'trlalala';\n\nconsole.log(y.text);\nconsole.log(x.text);\n</code></pre>\n\n<p>but when I run it, y.text will print out null. But the value should be updated already. One of my friend told me it's because y.text copy the structure of x.text instead of the reference. Been stuck for a while. :\\</p>\n\n<p>Any input will be appreciated, thanks!</p>\n"},{"tags":["node.js","socket.io"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13010753,"title":"nodejs response data multiply","body":"<p>i made an app with socket.io.my problem is when i close node and open again server response count is up.first time 1 resutlset sending but second time 2 and third time 3 and so on? what is the problem</p>\n\n<p>client code is</p>\n\n<pre><code>&lt;script&gt;\nvar socket = io.connect('http://10.0.0.192:8888');\n\nsocket.on('connecting', function () {\n    console.log('connecting');\n});\n\nsocket.on('connect', function(s){\n    console.log('connect');\n    socket.emit('Baglan');\n    console.log('emit-Baglan');\n    socket.on('guncelle',function(data){\n        console.log(new Date().getMilliseconds());\n        console.dir(data);\n    });\n});\n\nsocket.on('reconnecting', function () {\n    console.log('reconnecting');\n});\n\nsocket.on('reconnect', function () {\n    console.log('reconnect');\n});\n\nsocket.on('reconnect_failed', function () {\n    console.log('reconnect_failed');\n});\n&lt;/script&gt;\n</code></pre>\n\n<p>and server</p>\n\n<pre><code>function getDataForClients() {\nvar d = new Array();\nd.push({records:res});\n//console.log(d);\nreturn d;}\nfunction onRequest(request, response) {\n    var pathname = url.parse(request.url).pathname;\n    //console.log(\"Request for \" + pathname + \" received.\");\n    route(handle, pathname, response, request);\n}\nserver = http.createServer(onRequest);\nio = require('socket.io').listen(server);\nio.set('log level', 1);\nio.sockets.on('connection', function (client) {\n    //console.log(client);\n    client.on(\"Baglan\",function(){\n        //console.log(\"user connected\");\n        __sockets.push(client);\n        client.room=\"weather\";\n        client.records=[];\n        client.join(client.room);\n        if(!res)\n            guncelle(false,client);\n        else\n            client.emit(\"guncelle\",getDataForClients());\n    });\n    client.on('disconnect', function(){\n        var i = __sockets.indexOf(client);\n        __sockets.splice(i,1);\n        client.leave(client.room);\n        //console.log(\"user leave\");\n    }); \n});\n\nserver.listen(8888);\n  function guncelle(v,c) {\n//console.log(\"update\");\nvar db = mysql.createClient({\n    user: 'user',\n    password: '***',\n});\ndb.query('USE '+TEST_DATABASE);\ndb.query(\n    \"select * from table\",\n    function selectCb(err, results, fields) {\n        if (err) {\n            throw err;\n        }\n        res = results;\n        var _data = getDataForClients();\n        if(v)\n            io.sockets.emit(\"guncelle\",_data);\n        else\n            c.emit(\"guncelle\",_data);\n        db.end();\n    }\n);\n</code></pre>\n\n<p>}</p>\n\n<p>there are 5 result between 15 ms.</p>\n\n<p>sorry i cant post image.</p>\n"},{"tags":["javascript","jquery","node.js","expressjs"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13009215,"title":"Cookies handling using javascript or Express.js or node.js?","body":"<p>I just want to know which one is the best way to handle the cookies?\nUsing Express.js? Node.js or client side javascript jquery?</p>\n\n<p>I am little confuse with security perspective.</p>\n\n<p>Thanks for all your help/information. </p>\n"},{"tags":["javascript","node.js","email","smtp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13009471,"title":"Haraka SASL authentication failed. said: 500 plugin timeout","body":"<p>I have mail relay server having Haraka installed to process inbound mails. When I send mails, it randomly throws plugin time out error.</p>\n\n<p>What I want to achieve is to set the time out limit a little higher or may be unlimited. But I don't have any idea how to set configuration globally or specific to the plugin.</p>\n\n<p>I tried to dig into this error and the only thing I could find is to create config/.timeout file to set the configuration. So I put \"plugin_timeout = 0\"  in this file. But this does'nt change anything. Still have the same error.</p>\n\n<p>Please help!\nThanks </p>\n"},{"tags":["javascript","html","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13009210,"title":"how to use the scrollTop in chat application with using node.js","body":"<pre><code>&lt;!DOCTYPE html&gt;\n  &lt;head&gt;\n  &lt;script&gt;\n      function scrollTop () {\n         window.scrollTo(0, 100);\n         $(\"data_recieved\").focus();\n      }\n  &lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n&lt;div data-role=\"page\" data-theme=\"e\" id=\"page1\"&gt;\n&lt;div data-role=\"header\" data-position=\"fixed\" data-theme=\"e\"&gt;\n    &lt;h1&gt;Let's chat&lt;/h1&gt;\n&lt;/div&gt;\n\n&lt;div data-role=\"content\"&gt;   \n  &lt;div&gt;  \n          &lt;label for=\"messageText\"&gt;Your message&lt;/label&gt;\n  &lt;input  data-theme=\"e\" type=\"text\" id=\"msg\"&gt;&lt;/input&gt;\n  &lt;button  data-theme=\"e\"&gt;Click me&lt;/button&gt;\n  &lt;div&gt;\n     &lt;p id=\"log\"&gt;&lt;/p&gt;\n  &lt;p id=\"data_recieved\"&gt;&lt;/p&gt;\n    &lt;/div&gt;\n   &lt;/div&gt;\n  &lt;/div&gt;\n &lt;/div&gt;\n  &lt;/body&gt;\n &lt;/html&gt;\n</code></pre>\n\n<p>how to use scroll Top in chat application with using node.js ?        </p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":277,"score":5,"question_id":9988166,"title":"nodejs buffers vs typed arrays","body":"<p>What is more efficient - nodejs buffers or typed arrays? What should I use for better performance?\nI think that only those who know interiors of V8 and NodeJs could answer this question.</p>\n"},{"tags":["node.js","nginx","websocket","webrtc","sdp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13009026,"title":"How can I get the SDP by websocket","body":"<p>I need to implement a client side to make the establishment with nginx-server and get video stream.</p>\n\n<p>Now I encounter problem before getting SDP, follow the RFC 6455 :</p>\n\n<p>This is server feedback :</p>\n\n<p>\"HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: VOtGS9ihraSCGmiWbKLJYDPlm0Y=\n..1::.35:::{\"name\":\"getRoom\",\"args\":[{\"roomId\":\"970704\"}]}.,5:::{\"name\":\"recupererMessages\",\"args\":[[]]} \"</p>\n\n<p>and the server seems to wait me send something to it.\nthe problem is I can't understand what need I send if I wanna get the SDP??</p>\n\n<p>(PS.I checked the packets from chrome to this server by wirecheck, there are two packets, one is 45 bytes and the other one is 1405 bytes.)</p>\n\n<p>Thanks for your attention!!</p>\n"},{"tags":["node.js","upload","express","progress-bar"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":13008232,"title":"how to upload large file in express with progress bar?","body":"<p>currently i use socket.io to upload the video with progress bar(here is the tutorial <a href=\"http://net.tutsplus.com/tutorials/javascript-ajax/how-to-create-a-resumable-video-uploade-in-node-js/\" rel=\"nofollow\">http://net.tutsplus.com/tutorials/javascript-ajax/how-to-create-a-resumable-video-uploade-in-node-js/</a>)\nbut ie dose not support this method, but i really need upload the video in all browser.</p>\n\n<p>i check the express doc, since express is base on node-formidable , so i think there is way to build a upload system with progress bar right? becase node-formidable has a progress event.</p>\n\n<p>i just dont know how? please help me. and node-formidable ie enabled right?</p>\n\n<p>any way is it possible to build a file upload system in pure epress.js with progress bar?</p>\n"},{"tags":["windows","node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12914167,"title":"Installing javascript driver Mongodb-native on Windows server 2008","body":"<p>I have nodejs running with mongodb database and i'm trying to install the javascript driver mongodb-native.. When i try \"npm install -g mongodb --mongodb:native\"</p>\n\n<p>I tried installing the same configuration on a Windows 7 machine and it works just fine. Any idea why it is not working with Windows server 2008 ?</p>\n\n<p>here is the output i get from the npm install command:</p>\n\n<pre><code>npm http GET https://registry.npmjs.org/mongodb\nnpm http GET https://registry.npmjs.org/mongodb\nnpm http GET https://registry.npmjs.org/mongodb\nnpm http GET https://registry.npmjs.org/bson/0.1.5\nnpm http GET https://registry.npmjs.org/bson/0.1.5\nnpm http GET https://registry.npmjs.org/bson/0.1.5\n\n&gt; bson@0.1.5 install C:\\Users\\xxx\\AppData\\Roaming\\npm\\node_modules\\mongodb\\no\nde_modules\\bson\n&gt; node install.js || (exit 0)\n\n================================================================================\n\n=                                                                              =\n\n=  Attempting to build bson c++ extension                                      =\n\n=   Windows: no build will be attempted as binaries are prepackaged            =\n\n=   Unix: on failure the package will still install without the C++ extension  =\n\n=                                                                              =\n\n================================================================================\n\nmongodb@1.1.11 C:\\Users\\xxx\\AppData\\Roaming\\npm\\node_modules\\mongodb\n└── bson@0.1.5\n\nC:\\Users\\xxx&gt;npm ls\nC:\\Users\\xxx\n└── (empty)\n</code></pre>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13006232,"title":"Passing a variable from the Server (Node.JS) to the Client","body":"<p>How is it possible to send a variable from the Server Side to the Client Side in Node.JS?</p>\n\n<p>I have an app.js file and a public directory which holds an index.html template.</p>\n\n<p>The app.js uses a basic server and the <code>readFile</code> function to open and display the HTML template.</p>\n\n<p>The problem is I want to display a MongoDB query result on the client side in index.html</p>\n\n<p>How is this possible, without the use of a framework such as Express, as I am trying to avoid that.</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","asynchronous","map"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12997276,"title":"How to correctly perform async I/O in map iterator in node.js?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9518414/cannot-use-map-function-within-async-module\">Cannot use “map” function within async module</a>  </p>\n</blockquote>\n\n\n\n<p>I've got a problem like this:</p>\n\n<pre><code>    var paths = ['path1', 'path2', 'path3', ...]; //Some arbitrary array of paths\n\n    var results; //I need to collect an array of results collected from these paths\n\nresults = paths.map(function(path){\n  var tempResult;\n\n  GetData(path, function(data){ //Third-party async I/O function which reads data from path\n    tempResult = data;\n  });\n\n  return tempResult;\n});\n\nconsole.log(results); //returns something like [nothing, nothing, nothing, ...]\n</code></pre>\n\n<p>I can imagine why it happens (<code>return tempResult</code> fires before the async function returned any data - it's slow after all), but can't quite see how to make it right.</p>\n\n<p>My guess is <a href=\"https://github.com/caolan/async#map\" rel=\"nofollow\">async.map</a> might help, but I fail to see how right away.</p>\n\n<p>Maybe someone more experienced in asynchronous programming might explain the way?</p>\n"},{"tags":["node.js","sequelize.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13002873,"title":"sequelize fetching associations on find (1.6)","body":"<p>sequelize 1.6 has the following in the changelog:</p>\n\n<blockquote>\n  <p>[FEATURE] added association prefetching for find and findAll</p>\n</blockquote>\n\n<p>The question is HOW? </p>\n\n<p>I have the following models defined:</p>\n\n<pre><code>var self = {\n    Medium: client.define(\"Medium\", {\n        name: Sequelize.STRING,\n        description: Sequelize.TEXT\n    },\n\n    User: client.define(\"User\", {\n        firstName: Sequelize.STRING,\n        lastName: Sequelize.STRING,\n        email: Sequelize.STRING,\n        aboutArt: Sequelize.TEXT,\n        bio: Sequelize.TEXT,\n        password: Sequelize.STRING,\n        description: Sequelize.TEXT\n    }\n};\nself.User.hasMany(self.Medium, { as: 'Media' });\nself.Medium.hasMany(self.User);\n\nfor(var key in self){\n    var model = self[key];\n    model.sync();\n}\n</code></pre>\n\n<p>later when i fetch a user like this:</p>\n\n<pre><code> User.find(id)\n    .success(function(record) {\n        //record has no media!\n    })\n</code></pre>\n\n<p>the User instance does not have a list media. How do i auto fetch associations?</p>\n"},{"tags":["node.js","express"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12634694,"title":"How to proxy an image in node express?","body":"<p>I have this image from Filepicker.io: <a href=\"https://www.filepicker.io/api/file/9H-1AxgZTwqct8tjkmkZ\" rel=\"nofollow\">https://www.filepicker.io/api/file/9H-1AxgZTwqct8tjkmkZ</a></p>\n\n<p>But when I open it in the browser, it will download the file directly, I thought that's because the response header or something, so I'm wondering how to  proxy it so that I can view it in browser like other images, like this one : <a href=\"https://distilleryimage1.s3.amazonaws.com/84d490a4071811e285a622000a1d039f_5.jpg\" rel=\"nofollow\">https://distilleryimage1.s3.amazonaws.com/84d490a4071811e285a622000a1d039f_5.jpg</a></p>\n"},{"tags":["linux","node.js","command-line"],"answer_count":5,"favorite_count":15,"up_vote_count":26,"down_vote_count":0,"view_count":15756,"score":26,"question_id":5650169,"title":"Uninstall Node.JS using Linux command line?","body":"<p>How do you uninstall node.js using the cmd line in linux?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13004413,"title":"How to enable Mongojs Safe Option?","body":"<p>Consider the following nodejs code:</p>\n\n<pre><code>db = require('mongojs')('database', ['users, sessions']);\ndb.users.insert(\n{\n  'email': email,\n  'password': password,\n  'firstname': firstname,\n  'lastname': lastname\n}, \nfunction(err) {\n  // will there ever be output?     \n});\n</code></pre>\n\n<p>In this case, is safe mode enabled for mongodb to output error? If not, how do I enable it?</p>\n"},{"tags":["java","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12698086,"title":"convert byte array key from java to node.js as a string","body":"<p>It must be simple issue but I'm newbi in node.js.<br>\nI generate a key in java. result is byte array. I need to convert it textually in order to use it as a string in the node.js.<br>\nI saw there is a method to convert byte array to a readable text in java by using BigInteger but couldn't find the complementary code in node.js.<br>\nThe java code:</p>\n\n<pre><code>SecretKey key = generateKey();\nSystem.out.println(\"key=\"+ Arrays.toString(key.getEncoded()));\n</code></pre>\n\n<p>Now I need to use it in node.js as a string for using crypto.createDecipher....\nI tried to initiate Buffer with the array, but it didn't work.\nAny ideas?</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":137,"score":4,"question_id":8549145,"title":"execute some code and then go into interactive node","body":"<p>Is there a way to execute some code (in a file or from a string, doesn't really matter) before dropping into interactive mode in node.js?</p>\n\n<p>So for example, I might have <code>__preamble__.js</code> which looks like:</p>\n\n<pre><code>console.log(\"preamble executed! poor guy!\");\n</code></pre>\n\n<p>and then, when a user types <code>node ???</code> they get</p>\n\n<pre><code>preamble executed! poor guy!\n&gt; [interactive mode]\n</code></pre>\n"},{"tags":["javascript","node.js","build","requirejs","amd"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12995986,"title":"Build, compile javascript library","body":"<p>I got a javascript library which currently uses requirejs.</p>\n\n<p>To keep things readable I have structered everything into directories.\nI would now like to compile all modules together into one javascript file for production but make the files still workable without compilation for developing so that I do not have to recompile everything when I test something.</p>\n\n<p>How do I accomplish this task?</p>\n"},{"tags":["javascript","node.js","object","stream","pipes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":12868969,"title":"Piping/streaming JavaScript objects in Node.js","body":"<p>I'm trying to wrap my head around Node.js streams, not that I'm pretty new to JavaScript and node, the last languages I really got were Perl and PHP :-D</p>\n\n<p>I've read the Buffer/Streams documentation @ nodejs.org, watched James Halliday @ <a href=\"https://www.youtube.com/watch?v=lQAV3bPOYHo\" rel=\"nofollow\">LXJS</a>, read his stream-handbook and Thorsten Lorenz <a href=\"http://thlorenz.com/#/blog/post/event-stream\" rel=\"nofollow\">event-stream post</a>. I start to understand the basics :)</p>\n\n<p>I process data which is serialized in RDF (which is neither JSON nor XML). I manage to fetch the data (in real code via request) and parse it into a JS object using <code>rdfstore</code> module.</p>\n\n<p>So far I do this:</p>\n\n<pre><code>s.createReadStream('myRDFdata.ttl').pipe(serialize()).pipe(process.stdout);\n</code></pre>\n\n<p>Where <code>serialize()</code>does the job of parsing an serializing the code at the same time right now. I use <code>through</code> module to interface to the stream.</p>\n\n<p>Now I have some more methods (not the real function declaration but I hope you get the point):</p>\n\n<ul>\n<li><code>getRecipe(parsedRDF)</code> -> takes the parsed RDF (as a JavaScript object) and tells me how to use it</li>\n<li><code>createMeal(parsedRDF, recipe)</code> ->  takes the parsed RDF and the recipe from above and creates a new RDF object out of it</li>\n<li>this new object needs to get serialized and sent to the browser</li>\n<li>(In the real world <code>getRecipe</code> will have to do a user interaction in the browser)</li>\n</ul>\n\n<p>I like the idea of chaining this together via pipes for higher flexibility when I enhance the code later. But I don't want to serialize it to a RDF serialization every time but just send around the JS object. From what I've read in the documentation I could use the <code>stringify</code> module to get a string out of each step for piping it to the next step. But:</p>\n\n<ul>\n<li>does this actually make sense? In terms of do I add unnecessary overhead or is this negligible?</li>\n<li>I don't see how I could give the parsedRDF to both methods with the dependency that <code>getRecipe</code> would have to be called first and the output is input for <code>createMeal</code> as well. Are there modules which help me on that?</li>\n<li>It might be that I have to ask the user for the final recipe selection so I might need to send stuff to the browser there to get the final answer. Can I do something like this over sockets while the pipe is \"waiting\"?</li>\n</ul>\n\n<p>I hope this shows what I'm trying to do, if not I will try to give more details/rephrase.</p>\n\n<p>Update: After sleeping over it I figured out some more things:</p>\n\n<ul>\n<li>It probably doesn't make sense to serialize a format like RDF into something non-standard if there are official serialization formats. So instead of using <code>stringify</code> I will simply pass an official RDF serialization between the steps</li>\n<li>This does imply that I parse/serialize the objects in each step and this surely does add overhead. Question is do I care? I could extend the RDF module I use to parse from stream and serialize into one</li>\n<li>I can solve the problem with the dependency between <code>getRecipe</code> and <code>createMeal</code> by simply adding some information from <code>getRecipe</code> to <code>parseRDF</code>, this can be done very easily with RDF without breaking the original data model. But I would still be interested to know if I could handle dependencies like this with pipes</li>\n</ul>\n"},{"tags":["json","node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13002601,"title":"MongoDB Collections format","body":"<p>I need to store restaurants with their corresponding menu items, so i did something like this</p>\n\n<pre><code>{ name: 'Foo',\n  menu: \n [ { item: 'foo',\n   description: '...',\n   price: 20 },\n { item: 'bar',\n   description: '...',\n   price: 30 } ]\n}\n</code></pre>\n\n<p>The problem is i sometimes need to access this items, but it's not easy doing this, should i instead use something like this?</p>\n\n<pre><code>{ name: 'Foo',\nmenu: \n{ \"0\": { item: 'foo',\n   description: '...',\n   price: 20 },\n \"1\": { item: 'bar',\n   description: '...',\n   price: 30 } }\n}\n</code></pre>\n\n<p>I think it's cheaper to find an specific item.</p>\n"},{"tags":["ios","node.js","audio-streaming","html5-audio"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":443,"score":2,"question_id":10924955,"title":"Using Node.js to stream audio to html5 audio tag and bypass iOS limitation","body":"<p>I'm currently working on a project that use HTML5 audio and we have problems with the limitations on iOS devices (mostly multiple audio channels limitation).</p>\n\n<p>I was thinking that it may be possible to control the sounds server-side using node.js. The client would connect to a single audio url and the node server will stream live sounds trough this single channel doing all the mixing and transitions live on the server.</p>\n\n<p>Is it technically possible? Can you parse audio on node.js and do some live mixing? Do you think the server will explode with more than 5 simultaneous clients?</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","stub","stubbing","nodeunit"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12968153,"title":"Overriding functions in other modules in node.js","body":"<p>I'm trying to stub a function with nodeunit in a Node.js app. Here's a simplified version of what I'm trying to do:</p>\n\n<p>In <code>lib/file.js</code>:</p>\n\n<pre><code>var request = require('request');\n\nvar myFunc = function(input, callback){\n    request(input, function(err, body){\n        callback(body);\n    });\n};\n</code></pre>\n\n<p>In <code>test/test.file.js</code>:</p>\n\n<pre><code>var file = require('../lib/file');\n\nexports['test myFunc'] = function (test) {\n    request = function(options, callback){\n        callback('testbody');\n    };\n\n    file.myFunc('something', function(err, body){\n        test.equal(body, 'testbody');\n        test.done();\n    });\n};\n</code></pre>\n\n<p>It seems like I'm not overriding <code>request</code> properly, because when I try to run the test, the actual non-stub <code>request</code> is getting called, but I can't figure out what the correct way to do it is. </p>\n\n<p>EDIT:</p>\n\n<p>To expand on Ilya's answer below, with my example above.</p>\n\n<p>in <code>lib/file/js</code>:</p>\n\n<pre><code>module.exports = function(requestParam){\n    return {\n        myFunc: function(input, callback){\n            requestParam(input, function(err, body){\n                callback(body);\n            });\n        }\n    }\n}\n</code></pre>\n\n<p>Then in <code>test/test.file.js</code>:</p>\n\n<pre><code>var fakeRequestFunc = function(input, callback){\n// fake request function\n}\n\nvar file = require('../lib/file')(fakeRequestFunc)(\n//test stuff\n}\n</code></pre>\n"},{"tags":["node.js","mongodb","express","socket.io","mongoose"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":86,"score":1,"question_id":13001871,"title":"How to add data to an array (MongoDB) from Socket.IO? (node.js)","body":"<p>I've got the following MongoDB Schema's</p>\n\n<pre><code>//MongoDB Schema    \n\nvar Line = new Schema({\n    id    : Number,\n    user  : String,\n    text  : String,\n});\n\n\nvar Story = new Schema ({\n    sid: {type: String, unique: true, required: true},\n    maxlines: {type: Number, default: 10}, // Max number of lines per user\n    title: {type: String, default: 'Select here to set a title'},\n    lines: [Line],\n});\n</code></pre>\n\n<p>For a particular story the data in MogoDB looks like this:</p>\n\n<pre><code>{\n__v: 0,\n_id: ObjectId(\"5084559945a0a23c1b000002\"),\nlines: [{\n        \"id\": 1,\n        \"user\": \"Joe\",\n        \"text\": \"This is line number 1\"\n    },\n    {\n        \"id\": 2,\n        \"user\": \"Adam\",\n        \"text\": \"This is line number 2\"\n    },\n    {\n        \"id\": 3,\n        \"user\": \"John\",\n        \"text\": \"This is line number 3\"\n    },\n],\nmaxlines: 10,\nsid: \"lJOezsysf\",\ntitle: \"A New Story!\"\n}\n</code></pre>\n\n<p>I'm using Socket.Io to communicate with the server and push the messages to other users</p>\n\n<pre><code>// when the client emits 'sendline', this listens and executes\n    socket.on('sendline', function (data) {\n        // we tell the client to execute 'updatestory' with 2 parameters\n        io.sockets.in(socket.room).emit('updatestory', socket.username, data);  \n        Story.findOne({ sid: socket.room }, function(err, story){\n\n           **    What would go here to update MongoDB? **\n\n            console.log(socket.room);\n        });\n    });\n</code></pre>\n\n<p>How can i use the above to add the data from socket.io and save it to MogoDB?</p>\n\n<pre><code>socket.room has the same value as sid on Mongo so it finds the correct entry.\nsocket.username = user\ndata = text\n</code></pre>\n\n<p>I've tried to use the below, to save the data but i get an error, i want it to create a new entry in the 'Line' array with the next id. </p>\n\n<pre><code>Story.Lines.User = socket.username;\nStory.Lines.text = data;\nStory.save();\n</code></pre>\n\n<p>What method would i use to push this to the db?</p>\n\n<p><em><strong></em>* EDIT <em>*</em></strong></p>\n\n<p>Managed to get it to work, seems like i was using Story rather than story.</p>\n\n<p>Code i used below:</p>\n\n<pre><code>    Story.findOne({ sid: socket.room }, function(err, story){   \n    story.lines.push({ \n    user: socket.username, \n    text: data,\n     });\n</code></pre>\n\n<p>The data is stored to the database correctly, however when retrieving the data from MongoDB it shows up as JSON on the webpage</p>\n\n<pre><code>{ Id: 3, user: 'John', text: 'This is line number 3' }\n</code></pre>\n\n<p>I'm using Dust.JS as the templating library and using the below to pass the data:</p>\n\n<pre><code>res.render('story', {\n    storytitle: story.title,\n    storylines: story.lines,\n    lines: story.maxlines,\n    storyid: story.sid   \n</code></pre>\n\n<p>How would i change it so it only sends the text to storylines?</p>\n"},{"tags":["linux","node.js","web","uninstall","npm"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12984494,"title":"Completely clean server from NodeJs and npm","body":"<p>I have upgraded one <strong>nodejs</strong> installation from <code>0.4.2</code> to <code>0.8.12</code> but, since then, the js server I have, started crashing with <code>seg fault</code>. As I inherited this application, I have no idea what was previously installed and how was it was maintained. <code>Npm</code> seems to be installed only locally, but I can't seem to call it the right way. </p>\n\n<p>So this is all the info about the problem. My question is: </p>\n\n<p>Can I completely remove <code>nodejs</code> and <code>npm</code> so I can do a fresh install?</p>\n"},{"tags":["php","mysql","node.js","websocket"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":4,"view_count":55,"score":-4,"question_id":13001504,"title":"How can you create multiple live chats like Omegle?","body":"<p>How can you create multiple live chats like in Omegle? Or how can you create multiple live chats with nodeJS? I checked nodejs, but I saw an example just for one chat. Or maybe there are options other than nodeJS?</p>\n"},{"tags":["node.js","jsdom"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12927551,"title":"node.js and jsdom - no way to detect that an http 500 error was returned?","body":"<p>I'm using jsdom with node.js and I'm trying to get it to provide me with some indication that an http error has occurred. I've set up a test server that simply returns an http 500 header for all requests, but when I attempt to load it with jsdom, jsdom doesn't throw any error and doesn't seem to provide me with any information that would identify that an http 500 error was returned. What's the best way to detect an http 500 error?</p>\n"},{"tags":["node.js","web-applications","nginx","express","varnish"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12998384,"title":"Do I need 2 separate applications in Node.js, one for visitors and one for CRUD admins?","body":"<h3>Intro</h3>\n\n<p>I'm trying out Node.js right now ( coming from PHP background). </p>\n\n<p>I'm already catching the <strong><em>vibe</em></strong> of the workflow with it (events, promises, inheritance..<em>haven't figured out streams yet</em>).</p>\n\n<p>I've chosen a graphic portfolio web app as my first nodejs project. I know node.js might not fit best for this use case but I it's a good playground and I need to do this anyway.</p>\n\n<p>The concept:</p>\n\n<ol>\n<li><p>The visitors will only browse through pretty pictures in albums, no\nlogging in or subscirptions, nothing.</p></li>\n<li><p>The administrators will add,modify, reorder.. CRUD the photo\nalbums. So I need there Auth, ACL, Validation, imagemagick... a lot\nmore than just on the frontend.</p></li>\n</ol>\n\n<p>Currently I'm running one instance of Node.js, so both admin and visitor code is in one shared codebase and shared node memory runtime, which to me looks unnecessary performance-wise. </p>\n\n<hr>\n\n<h1>Question</h1>\n\n<p><em>For both performance and usability:</em></p>\n\n<p>Should I <strong>continue running one instance</strong> of node for both admin and visitor areas of the web app or should I run them as <strong>2 separate instances</strong>? (or subtasks? - honestly i haven't worked with subtasks/child processes)</p>\n\n<hr>\n\n<h3>Ideas floating around</h3>\n\n<ul>\n<li>Use nginx as proxy if splitting into 2 applications </li>\n<li>Look into <a href=\"http://stackoverflow.com/a/5683938/339872\">http://stackoverflow.com/a/5683938/339872</a>. There's some interesting\nmentions of tools to help manage processes.</li>\n</ul>\n"},{"tags":["node.js","express","ejs"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12998547,"title":"Rendering layout with ejs","body":"<p>I can't render layout with ejs, express:</p>\n\n<pre><code>app.configure(function () {\n    app.use(express.static(__dirname + '/public'));\n    app.use(express.basicAuth('username', 'password'));\n    app.set('views', __dirname + '/views');\n    app.set('view engine', 'ejs');\n});\n</code></pre>\n\n<p>layout.ejs is in /views folder. I render /views/home/index.ejs but it is <em>NOT</em> in layout:</p>\n\n<pre><code>res.render('home/index');\n</code></pre>\n\n<p>layout.ejs:</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;&lt;/title&gt;\n      &lt;script type=\"text/javascript\" src=\"/content/scripts/jquery-1.6.2.min.js\"&gt;&lt;/script&gt;\n      &lt;script type=\"text/javascript\" src=\"/content/scripts/jquery-ui-1.8.11.min.js\"&gt;&lt;/script&gt;\n      &lt;script type=\"text/javascript\" src=\"/content/scripts/jquery.unobtrusive-ajax.min.js\"&gt;&lt;/script&gt;\n      &lt;script type=\"text/javascript\" src=\"/content/scripts/jquery.validate.min.js\"&gt;&lt;/script&gt;\n      &lt;script type=\"text/javascript\" src=\"/content/scripts/jquery.validate.unobtrusive.min.js\"&gt;&lt;/script&gt;\n      &lt;script type=\"text/javascript\" src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n      &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/content/styles/site.css\" /&gt;\n      &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/content/styles/themes/base/jquery.ui.all.css\"/&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n      &lt;%- body %&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["asp.net-mvc","node.js","architecture","backbone.js","knockout.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13000961,"title":"Web Mobile Hybrid","body":"<p>I would like to create web site using mvc 4. I need to create <strong>web site</strong>,*<em>mobile web site</em>*, and <strong>hybrid apps</strong> for apple and anroid using <strong>phonegap</strong>. I also like to use real time notifications using <strong>nodejs</strong>. I also like (optional) to use backbone.js or Knockout.js.</p>\n\n<p>The problem is i need map all these technologies in to one project. I need an answer to how to do this?</p>\n\n<p>I mean how to setup my architecture of the project. I need that steps that i need to fallow.</p>\n\n<p>ex: \nDo i need to separate mvc project to two areas (mobile, web)? </p>\n\n<p>It is good to use Knockout.js or normal razor view?</p>\n\n<p>Then  how to add Knockout.js?</p>\n\n<p>Then what are the step i need to do if i using phonegap?</p>\n"},{"tags":["javascript","node.js","sockets"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13000872,"title":"Closing socket connection with XHR-polling","body":"<p>Does anyone know why my socket connection does not close when using xhr-polling? This is the server code I would like to execute, but does not fire when using xhr-polling. The socket connection works fine ( I am running behind varnish with stunnel, since this a secure socket). I tried manually emitting a disconnect event on the browser unload, but this isnt an optimal solution for me.</p>\n\n<pre><code>client.on('disconnect', function () {\n\n    delete connected_clients[id];\n    console.log('   debug - ' + 'client ' + client.id + 'is disconnected');\n    console.log('   debug - ' + 'total number of connected clients is ' + Object.keys(connected_clients).length);               \n\n});\n</code></pre>\n\n<p>In my client side code, I am connecting the socket like this:</p>\n\n<pre><code>socket = io.connect(BASE_URL, {\n    \"sync disconnect on unload\":true\n});\n</code></pre>\n\n<p>and my server side settings are this:</p>\n\n<pre><code>    io.enable('browser client minification');  // send minified client\n    io.enable('browser client etag');          // apply etag caching logic based on version number\n    io.enable('browser client gzip');          // gzip the file\n    io.set('log level', 3);                    // reduce logging\n    io.set('match origin protocol', true);     // ssl support\n    io.set('sync disconnect on unload', true);\n    io.set('transports', [                     // enable all transports (optional if you want flashsocket)\n        'xhr-polling',\n        'websocket',\n        'flashsocket',\n        'htmlfile',\n        'jsonp-polling'\n    ]);  \n</code></pre>\n\n<p>This is the debug message I get when the client exits the browser</p>\n\n<pre><code>debug: xhr-polling closed due to exceeded duration\n</code></pre>\n\n<p>I am using socket.io version 0.9.10 with node 0.8.8. </p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12995071,"title":"Can't reach Node.js testing from Chrome on a usb tethered Android device","body":"<p>I can't reach Node.js testing from a usb tethered Android device (Chrome) using IPv4 address. </p>\n\n<p>Node hello world running on Win7 PC works great locally using computer name,  IPv4 address, localhost, etc, etc. on ports 1337, 8080, etc.</p>\n\n<p>No problems though reaching Apache in the same manner from Android (using IPv4 address)!</p>\n\n<p>Is it a configuration issue?</p>\n\n<p>Code :</p>\n\n<pre><code>var portNum = 8080;  //1337;\nhttp.createServer(_handler).listen( portNum );\n</code></pre>\n"},{"tags":["node.js","rpc","socketstream"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":52,"score":-1,"question_id":12964495,"title":"SocketStream.js without client side how to?","body":"<p>I am interested in develop a rt module for my website with socketstream + node.js. I am only interested in do the server side in socketstream, not the client side. How can I access the socketstream from a normal php/html app, wich js i have to include ?  I am mainly interested in rpc, pub/sub and authentication/session.</p>\n"},{"tags":["node.js","socketstream"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13000714,"title":"SocketStream - Detect when client disconnect from server side","body":"<p>Is there a way to detect when a client disconnect from the server side?</p>\n\n<p>app.js</p>\n\n<p>ss.event.on(\"close\",function(session){</p>\n\n<p>console.log(client disconnected);\n});</p>\n\n<p>thanks</p>\n"},{"tags":["javascript","node.js","express","template-engine","hogan.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13000292,"title":"Any way to render templates into a variable with Express3.x?","body":"<p>in express3.x, the api talks about app.render('view', data, callback);\nit is supposed to do the same thing as res.render, but with a callback with the rendered data, instead of sending it as a response.\nIs there a way to use app.render in a route file. It's not possible since there is no app variable anywhere but app.js\nmaybe there is some other easy way to just render a template and store it a variable.\nI need it to send html emails.\nI'm using hogan.js templates in my app.</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","template-engine","node.js"],"answer_count":24,"favorite_count":55,"up_vote_count":132,"down_vote_count":0,"view_count":39239,"score":132,"question_id":1787716,"title":"Is there a template engine for Node.js?","body":"<p>I'm kind of falling in love with Node.js not because you write app code in javascript but because of its performance. </p>\n\n<p>I really don't care a lot about how beautiful a server side language might be but how many requests per second it can handle.</p>\n\n<p>So anyway I'm looking forward to experimenting building an entire webapp using Node.js (and going back to the actual question) is there a template engine similar to let's say the django template engine or something similar (that at least allows you to extend base templates) available for Node.js?</p>\n"},{"tags":["windows","node.js","mocha"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1097,"score":2,"question_id":9779700,"title":"Mocha requires make. Can't find a make.exe that works on Windows","body":"<p>Mocha (test framework for Node.js) uses make.</p>\n\n<p>For the life of me I can't find a compatible make.exe for Windows. </p>\n\n<p>Everything works fine on my Mac.</p>\n\n<p>I've tried using VS's nmake.exe and a make.exe I found that was ported from Unix. But they are all incompatible. </p>\n\n<p>It can't just be me</p>\n\n<p>Here's the makefile:</p>\n\n<pre><code>test:\n    @./node_modules/.bin/mocha -u tdd -R spec\n\n.PHONY: test\n</code></pre>\n\n<p>make barfs on the . in PHONY, and even if I remove it, it never runs the mocha command (or at least there's no output).</p>\n\n<p>Running <code>./node_modules/.bin/mocha -u -tdd -R spec</code> directly gives me my test report:</p>\n\n<pre><code>first suite -\n  ? ten should always be equal to 9+1\n  ? zero is less all positive numbers\n  ? There is no i in team\n\n ? 3 tests complete (8ms)\n</code></pre>\n\n<h2>EDIT 3/25/12</h2>\n\n<ul>\n<li>In the end, the easiest way to deal with this is to use Cygwin and ensure that the developer packages for Cygwin are installed. In PowerShell I did <code>Set-Alias make \"c:\\dev\\utils\\cygwin\\bin\\make.exe\"</code> and now <code>make test</code> works on standard Mocha Makefiles.</li>\n</ul>\n"},{"tags":["node.js","sockets"],"answer_count":0,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12999740,"title":"NodeJS socket FIN_WAIT2","body":"<p>I have a running nodejs server for socket communication with clients. After a period of time (few days) nodejs gets to 100% CPU usage. Looking at netstat for node port I found more than 1k connections with FIN_WAIT2 status (there should be only about 50 active connections). I'm using timeout function for connections, calling end() after specific timeout. But it doesn't seems to close the connection. So is end() valid way to close socket connection or should something else be used?</p>\n"},{"tags":["javascript","node.js","post","httprequest"],"answer_count":4,"favorite_count":20,"up_vote_count":44,"down_vote_count":1,"view_count":28497,"score":43,"question_id":6158933,"title":"HTTP POST request in node.js","body":"<p>How can I make an HTTP POST request with data in node.js?</p>\n"},{"tags":["javascript","html5","node.js","websocket"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12997717,"title":"Communication delay in HTML5 websocket with nodejs","body":"<p>Hi everyone and thanks for reading this.\nI'm using NodeJS with WS module on server side and HTML5 WebSocket API in Firefox on client side. The operating system is windows 7 64 bit. Whenever I make a connection from the client to server, the connection forms instantaneously, but when I send some data there is a huge delay. Sometimes the messages seem to reach the server instantly, other times they reach after some seconds and even minutes and most of the time they fail to reach the server at all. I'm attaching the code from both client and server sides. If someone can help me, I'd be really thankful.</p>\n\n<p>Client Side Code</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;script&gt;\n            var ws = new WebSocket(\"ws://localhost:5225\");\n            ws.onopen = function (){\n                alert(\"Sending\");\n                ws.send(\"SOME DATA !\");\n            }\n        &lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Server Side Code</p>\n\n<pre><code>var WebSocketServer = require('./ws').Server;\nvar wss = new WebSocketServer({port:5225});\nvar ws;\n\nwss.on('connection',function (wsock){\n    console.log(\"Connection Recieved\");\n\n    ws = wsock;\n\n    ws.on('message',onnMessage);\n\n    ws.on('close',onnClose);\n});\n\nfunction onnMessage(data){\n        console.log(\"Data Recieved : \"+data);\n}\n\nfunction onnClose(){\n        console.log(\"Connection closed\");\n}\n</code></pre>\n"},{"tags":["javascript","node.js","date","time","timestamp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12999202,"title":"Node.JS - Converting UNIX Timestamp to Time - timezones shift","body":"<p>I have a function, that converts timestamp to time:</p>\n\n<pre><code>function convertUnixTimeToTime(UNIX_timestamp) {\n    var a = new Date(UNIX_timestamp);\n    var fin_hour = String(a.getHours())\n    if (fin_hour.length == 1) {\n        fin_hour = '0' + fin_hour;\n    }\n    var fin_minutes = String(a.getMinutes())\n    if (fin_minutes.length == 1) {\n        fin_minutes = '0' + fin_minutes;\n    }\n    var time = fin_hour + ':' + fin_minutes;\n    return time;\n}\n</code></pre>\n\n<p>I'm tesing my app locally, my computer's timeshift is +4.\nWhen I try to get current time from node app:</p>\n\n<pre><code>console.log('Current time is: ' + convertUnixTimeToTime(new Date().getTime()));\n</code></pre>\n\n<p>I get my <strong>current local</strong> time. As I supposed, Date().getTime() should return absolute UNIX time in milliseconds. My function convertUnixTimeToTime() does not specify any time shift, that's why I should get clear time without any shifts. Why am I getting shifted +4 time? Thanks.</p>\n"},{"tags":["html","css","node.js","stylesheet"],"answer_count":5,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":1039,"score":13,"question_id":4894081,"title":"\"Compile\" CSS into HTML as inline styles","body":"<p>I am writing an e-mail HTML template, and some e-mail clients do not support <code>&lt;style&gt;</code> for specifying CSS.  The only alternative for applying CSS is to use inline styles (<code>style</code> attribute).  Is there a tool or library (Node.JS) for applying a stylesheet to some HTML and getting back the HTML with the styles applied?</p>\n\n<p>The tool does not have to support many selectors; id, class, and element name selectors should be sufficient for my needs.</p>\n\n<p>Example of what is needed:</p>\n\n<pre><code>// stylesheet.css\na { color: red; }\n\n// email.html\n&lt;p&gt;This is a &lt;a href=\"http://example.com/\"&gt;test&lt;/a&gt;&lt;/p&gt;\n\n// Expected result\n&lt;p&gt;This is a &lt;a href=\"http://example.com/\" style=\"color: red;\"&gt;test&lt;/a&gt;&lt;/p&gt;\n</code></pre>\n"},{"tags":["javascript","windows","node.js","exe"],"answer_count":4,"favorite_count":8,"up_vote_count":14,"down_vote_count":0,"view_count":3055,"score":14,"question_id":8173232,"title":"Make exe from node.js app","body":"<p>I have a node app that I wrote, that I run as follows:</p>\n\n<p><code>node.exe app.js inputArg</code></p>\n\n<p>Is there some way I can package this into a .exe by itself? So I can just do something like this?</p>\n\n<p><code>App.exe inputArg</code></p>\n\n<p>I have some way of faking this by using a batch file, so I can do this:</p>\n\n<p><code>App.bat inputArg</code></p>\n\n<p>But this requires that I have all the dependencies and node in that folder, which is not ideal.</p>\n"},{"tags":["node.js","express","mocha"],"answer_count":5,"favorite_count":6,"up_vote_count":13,"down_vote_count":0,"view_count":5446,"score":13,"question_id":8831984,"title":"How do i test my express app with mocha?","body":"<p>I've just added shouldjs and mocha to my express app for testing, but I'm wondering how to test my application. I would like to do it like this:</p>\n\n<pre><code>app = require '../app'\nroutes = require '../src/routes'\n\ndescribe 'routes', -&gt;\n  describe '#show_create_user_screen', -&gt;\n    it 'should be a function', -&gt;\n      routes.show_create_user_screen.should.be.a.function\n    it 'should return something cool', -&gt;\n      routes.show_create_user_screen().should.be.an.object\n</code></pre>\n\n<p>Of course, the last test in that test-suite just tells med that the res.render function (called within show_create_user_screen) is undefined, probably becouse the server is not running and the config has not been done. So I wonder how other people set up their tests?</p>\n"},{"tags":["javascript","node.js","variables","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12943987,"title":"Object/Method/Variabe access in node.js/socket.io","body":"<p>I believe this is some scope/variable access issue but I am not sure about it so I am going to tell you the whole context.  </p>\n\n<p>The idea is to have a node.js-\"application\" which lets you enter a number in a HTML frontend which is sent to the server via socket.io and then saved to mongodb with mongoose. And then, in return to get the number from the database and do something with it in the client-side script.  </p>\n\n<p>A real-life example would be that you are able to enter the mileage of your car/whatever on the clientside, then fire a socket.io event that transfers this information to the node.js server and save it there to monogodb using mongoose. That works. Now say I also want to be able to keep and save some preferences.<br>\nI have a <code>Preferences</code> object that keeps the variable numDigits and some methods/functions.<br>\nSaving <code>numDigits</code> to the server works, querying the entry from the server works.<br>\nHowever, saving the number into <code>Preferences.numDigits</code> does not.  </p>\n\n<p><strong>client.js</strong></p>\n\n<pre><code>//init.js\n//var Preferences;\n\nvar Preferences = {\n    numDigits: 'default',\n    parse: function(){\n        this.numDigits = parseInt($('#preferences &gt; #num-digits').val());\n    },\n    get: function(){\n        socket.emit('req-preferences', function(responseData) {\n            this.numDigits = responseData.numDigits;\n            console.log('#1: ' + this.numDigits);\n        });\n        console.log('#1: ' + this.numDigits);\n        // 2 different outputs (scopes?) here\n\n    },\n    save: function(){\n        socket.emit('save-preferences', this);\n    }\n}\n\nvar UI = {\n    numDigits: Preferences.numDigits,\n    build: function() {\n        Preferences.get();\n        console.log(Preferences.numDigits);\n        for (i=0; i&lt;Preferences.numDigits;i++) {\n            $('#input-km').append('&lt;input type=\"text\"&gt;&lt;/input&gt;');\n        }   \n    }\n}\n\n$(document).ready(function() {\n\n    socket = io.connect('http://127.0.0.1:8080');\n\n\n    function print(data) {\n        console.log(data);\n        if (data.length == 0) {\n            $('#results').html('no entries!');\n        } else {\n            for (i = 0; i &lt; data.length; i++) {\n                $('#results').append(data[i].date + ' - ' + data[i].km + '&lt;br /&gt;');\n            }   \n        }\n    }\n\n    socket.on('res-entries', function(entries){\n        print(entries);\n    });\n\n    $('#submit').click(function() {\n        var kmStand = $('#km').val();\n        socket.emit('submit', kmStand, function(){\n        });\n    });\n\n    $('#req-entries').click(function(){\n        socket.emit('req-entries', function() {\n        });\n    });\n\n\n    $('#remove-all').click(function() {\n        socket.emit('remove-all', function() {\n            console.log('remove all');\n        });\n    });\n\n    $('#save-preferences').click(function() {\n        Preferences.parse();\n        Preferences.save();\n    });\n\n    //Preferences.get();\n    UI.build();\n});\n</code></pre>\n\n<p><strong>server.js</strong></p>\n\n<pre><code>var http = require('http');\nvar connect = require('connect');\nvar io = require('socket.io');\nvar mongoose = require('mongoose');\n\nvar server = http.createServer(connect()\n    .use(connect.static(__dirname))).listen(8080);\n\nvar socket = io.listen(server);\nsocket.set('log level', 2);\n\nvar db = mongoose.createConnection('localhost', 'mileagedb');\ndb.on('error', console.error.bind(console, 'connection error:'));\ndb.once('open', function() {\n\n    var entrySchema = new mongoose.Schema({\n        km: String,\n        date: {\n            type:Date, \n            default:Date.now\n        }\n    });\n\n    var preferencesSchema = new mongoose.Schema({\n        numDigits: Number,\n        objId: Number\n    });\n\n    var Preferences = db.model('Preferences', preferencesSchema);\n\n    var Entry = db.model('Entry', entrySchema);\n\n    socket.sockets.on('connection', function(socket){ \n\n        socket.on('submit', function(kmStand){\n            var eintrag = new Entry({\n                km: kmStand,\n            });\n\n            eintrag.save(function(err) {\n                if (err) {\n                    console.log('error while saving');\n                } else {\n                    console.log('saved');\n                }\n            });\n\n            Entry.find(function(err, entries) {\n                console.log('all entries:');\n                console.log(entries);\n            });\n        });\n\n        socket.on('req-entries', function() {\n            Entry.find(function(err, entries) {\n                socket.emit('res-entries', entries);\n            });\n        });\n\n        socket.on('remove-all', function() {\n            Entry.find().remove();\n            Preferences.find().remove();\n        });\n\n        socket.on('save-preferences', function(prefObj) {\n\n            Preferences.update(Preferences.findOne(), {$set: { numDigits: prefObj.numDigits }}, { upsert: true }, function(err){\n                if (err) {\n                    console.log('error saving');\n                }\n            });\n\n            Preferences.find(function(err, prefs) {\n                console.log('all preferences:');\n                console.log(prefs);\n            });\n        });\n\n        socket.on('req-preferences', function(fn) {\n            Preferences.findOne(function(err, prefs) {\n                fn(prefs);\n            })\n        });\n\n    });\n});\n\n\n\n/* maybe:\nsocket.on('get-entries'), function(requestSpecification) {\n            ...\n        }*/\n</code></pre>\n\n<p>The console output on the client side is:</p>\n\n<pre><code>(on body load, UI.build() fires)\n#2: default (line 14)\n#1: 5 (line 12)\n\n&gt;Preferences.get();\n#2: default (line 14)\n&lt;-undefined\n#1: 5 (line 12)\n\n&gt;Preferences.numDigits\n\"default\"\n</code></pre>\n\n<p>the for-loop in UI.build() also doesnt fire so I take the value it has there is \"default\" too.  As mentioned before, I am pretty sure it is a variable/scope issue somewhere in <code>Preferences.get();</code> but I just cant understand the problem on my own. It would be too nice if someone of you could help me out on that.  </p>\n\n<p>Thanks a lot in advance!</p>\n\n<p><em>edit: pasted wrong code</em></p>\n"},{"tags":["node.js","socket.io","chat"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12972609,"title":"facebook like chat","body":"<p>I've created a simple chat with socket.io. \nI decided to go ahead and create facebook like chat.\nThe problems:</p>\n\n<ol>\n<li>Each user has his own online friends and how to show to user his own online friends</li>\n<li>How and where store users and their messages</li>\n<li>Update buddy list of certain user if somebody of his freinds disconnects</li>\n<li>How to emit an event only to friends of a specific person (not to all connected users)</li>\n</ol>\n"},{"tags":["internet-explorer","node.js","socket.io","opera"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12993704,"title":"IE and Socket.io compatibility","body":"<p>I make some chat example like here: <a href=\"http://psitsmike.com/2011/09/node-js-and-socket-io-chat-tutorial/\" rel=\"nofollow\">http://psitsmike.com/2011/09/node-js-and-socket-io-chat-tutorial/</a></p>\n\n<p>When i use Chrome and Firefox everything worked like a charm. With IE9 or Opera some socket.io events not firing (etc. disconnect) or firing too late, and data receiving is too slow. \nI install node.js and socket.io module with npm method.</p>\n\n<p>Please help.</p>\n"},{"tags":["node.js","express","npm"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":539,"score":0,"question_id":8119027,"title":"NPM - path to root of the application","body":"<p>I am developing a NPM package, which needs to require a module from the application root. Think of it as the package requiring a properties module, which is placed in the application root by the user. </p>\n\n<p>How do I get the path to root of the application?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>To summarize what I am trying to do, express allows you to do something like this:</p>\n\n<pre><code>app.use(express.router(myNPMModule.router));\n</code></pre>\n\n<p>The router function will get <code>app</code> as the parameter. The idea is to allow the users to specify the routes in a separate file, and they just need to follow certain conventions like putting their controllers in <code>/controllers</code> folder, and my module will be able to dynamically parse the path, and then invoke the correct method in the correct module. I have already got it working, but just realized that if I package it in NPM, I no longer have access to the path of the app, so I can't invoke a controller module's method dynamically.</p>\n"},{"tags":["node.js","opencv","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12947145,"title":"Error: \"pre\" versions of node cannot be installed, use the --nodedir flag instead","body":"<p>I'm trying to install <a href=\"https://github.com/peterbraden/node-opencv\" rel=\"nofollow\">opencv</a> for node. I don't think this has anything to do with opencv directly, rather it has to do with node-gyp. \nI had success in installing opencv on my mac but when I try to do the exact same on Ubuntu server I get the following error after doing 'npm install opnecv':</p>\n\n<pre><code>npm http GET https://registry.npmjs.org/opencv\nnpm http 304 https://registry.npmjs.org/opencv\n\n&gt; opencv@0.0.7 preinstall /home/demo/node_modules/opencv\n&gt; node-gyp rebuild\n\ngyp ERR! configure error \ngyp ERR! stack Error: \"pre\" versions of node cannot be installed, use the --nodedir flag instead\ngyp ERR! stack     at install (/usr/local/lib/node_modules/node-gyp/lib/install.js:69:16)\ngyp ERR! stack     at Object.commands.forEach.self.commands.(anonymous function) [as install] (/usr/local/lib/node_modules/node-gyp/lib/node-gyp.js:56:37)\ngyp ERR! stack     at getNodeDir (/usr/local/lib/node_modules/node-gyp/lib/configure.js:181:20)\ngyp ERR! stack     at /usr/local/lib/node_modules/node-gyp/lib/configure.js:101:9\ngyp ERR! stack     at ChildProcess.exithandler (child_process.js:538:7)\ngyp ERR! stack     at ChildProcess.EventEmitter.emit (events.js:96:17)\ngyp ERR! stack     at maybeClose (child_process.js:638:16)\ngyp ERR! stack     at Process._handle.onexit (child_process.js:680:5)\ngyp ERR! System Linux 3.2.0-29-generic\ngyp ERR! command \"node\" \"/usr/local/bin/node-gyp\" \"rebuild\"\ngyp ERR! cwd /home/demo/node_modules/opencv\ngyp ERR! node -v v0.8.13-pre\ngyp ERR! node-gyp -v v0.7.1\ngyp ERR! not ok \nnpm ERR! opencv@0.0.7 preinstall: `node-gyp rebuild`\nnpm ERR! `sh \"-c\" \"node-gyp rebuild\"` failed with 1\nnpm ERR! \nnpm ERR! Failed at the opencv@0.0.7 preinstall script.\nnpm ERR! This is most likely a problem with the opencv package,\nnpm ERR! not with npm itself.\nnpm ERR! Tell the author that this fails on your system:\nnpm ERR!     node-gyp rebuild\nnpm ERR! You can get their info via:\nnpm ERR!     npm owner ls opencv\nnpm ERR! There is likely additional logging output above.\n\nnpm ERR! System Linux 3.2.0-29-generic\nnpm ERR! command \"/usr/local/bin/node\" \"/usr/local/bin/npm\" \"install\" \"opencv\"\nnpm ERR! cwd /home/demo\nnpm ERR! node -v v0.8.13-pre\nnpm ERR! npm -v 1.1.63\nnpm ERR! code ELIFECYCLE\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /home/demo/npm-debug.log\nnpm ERR! not ok code 0\n</code></pre>\n\n<p>I also tried downloading the source code and doing 'node-gyp rebuild' with similar results:</p>\n\n<pre><code>demo@camera:~/src/node$ node-gyp rebuild\ngyp info it worked if it ends with ok\ngyp info using node-gyp@0.7.1\ngyp info using node@0.8.13-pre | linux | x64\ngyp ERR! configure error \ngyp ERR! stack Error: \"pre\" versions of node cannot be installed, use the --nodedir flag instead\ngyp ERR! stack     at install (/usr/local/lib/node_modules/node-gyp/lib/install.js:69:16)\ngyp ERR! stack     at Object.commands.forEach.self.commands.(anonymous function) [as install] (/usr/local/lib/node_modules/node-gyp/lib/node-gyp.js:56:37)\ngyp ERR! stack     at getNodeDir (/usr/local/lib/node_modules/node-gyp/lib/configure.js:181:20)\ngyp ERR! stack     at /usr/local/lib/node_modules/node-gyp/lib/configure.js:101:9\ngyp ERR! stack     at ChildProcess.exithandler (child_process.js:538:7)\ngyp ERR! stack     at ChildProcess.EventEmitter.emit (events.js:96:17)\ngyp ERR! stack     at maybeClose (child_process.js:638:16)\ngyp ERR! stack     at Process._handle.onexit (child_process.js:680:5)\ngyp ERR! System Linux 3.2.0-29-generic\ngyp ERR! command \"node\" \"/usr/local/bin/node-gyp\" \"rebuild\"\ngyp ERR! cwd /home/demo/src/node\ngyp ERR! node -v v0.8.13-pre\ngyp ERR! node-gyp -v v0.7.1\ngyp ERR! not ok \n</code></pre>\n\n<p>Has anyone had this issue before?</p>\n"},{"tags":["javascript","node.js","towerjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12996645,"title":"Error installing Tower.js","body":"<p>Strugging to get tower.js installed on my snow leopard macbook. Here is the command and the error:</p>\n\n<pre><code>My-Macbook:tower john$ tower new app\n\nnode.js:201\n        throw e; // process.nextTick error, or 'error' event on first tick\n              ^\nTypeError: Object #&lt;Object&gt; has no method 'existsSync'\n    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/tower/index.js:6:21)\n    at Module._compile (module.js:441:26)\n    at Object..js (module.js:459:10)\n    at Module.load (module.js:348:31)\n    at Function._load (module.js:308:12)\n    at Module.require (module.js:354:17)\n    at require (module.js:370:17)\n    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/tower/bin/tower:15:3)\n    at Module._compile (module.js:441:26)\n    at Object..js (module.js:459:10)\n</code></pre>\n"},{"tags":["javascript","node.js","asynchronous"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12952182,"title":"Node.js: Better way to process a result composed from asynchronous callbacks","body":"<p>In my node.js app, I have a code snipplet to compose a csv array:</p>\n\n<pre><code>function process(alerts, callback) {\n    var csvList = [];\n    var alertsLength = alerts.length;\n\n    alerts.forEach(function(alert) {\n        var name = alert.name;\n        var msg = alert.msg;\n\n        // retrieve from database\n        // NOTE: the asynchronous part!\n        PersonDao.getContact(name, function(error, contact) {\n            var csv = \"csv:\" + contact + \"|\" + msg;\n            csvList.push(csv);\n\n            if (csvList.length == alertsLength) {\n                // execute callback with the csvList\n                callback(csvList);\n            }\n        });\n\n    }); // end of alerts loop\n\n}\n</code></pre>\n\n<p>Is there any more elegant (or correct) way to do this?</p>\n"},{"tags":["php","regex","node.js","nginx"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12995497,"title":"Modifying an Nginx regular expression so that it is applied only in some cases","body":"<p>I'm creating a hybrid PHP/Node.js application. For PHP, I'm using the Yii framework. Within Node.js, I use express.</p>\n\n<p>PHP is running through Nginx. I use the proxy_pass directive to funnel any request starting with /node to the Node server running on port 3000 (e.g. server.com/node/api is proxyed to server.com:3000/api.)</p>\n\n<p>This works well, for the most part. However, one of the directives in my Nginx configuration file ensures that requests for non-existent static files are not passed on to Yii. Instead, a simple 404 error is returned. The original version of this directive looks like this:</p>\n\n<pre><code>location ~ \\.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar|txt)$ {\n    try_files $uri =404;\n    #For production servers you can set expires header with a long period\n    expires 3M;\n}\n</code></pre>\n\n<p>The problem with this directive is that some static files (notably the socket.io client) are served by Node.js. When the browser requests server.com/node/socket.io/socket.io.js, the above rule gets fired, and Nginx returns the 404.</p>\n\n<p>What I want to do is modify the rule so that the 404 is returned only when the request for a static file is NOT preceded by /node/. I've tried various combinations of rules, but none of them seem to work. After consulting the perl regular expression documentation, here's one that I thought might work, but doesn't:</p>\n\n<pre><code>location ~* (?&lt;!/node/)\\.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar|txt)$ {\n    try_files $uri =404;\n    expires 3M;\n}\n</code></pre>\n\n<p>I thought the negative/look-behind part of the rule, <code>(?&lt;!/node/)</code>, would work to exclude requests starting with /node/, but it doesn't. Instead, the rule gets fired for both genuinely non-existent js files and for socket.io.js (and various other static files served from Node.js.) So in both cases I get a 404.</p>\n\n<p>How should I change the regular expression so that the rule only gets applied when the request does NOT start with /node/?</p>\n"},{"tags":["curl","node.js"],"answer_count":5,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":5990,"score":7,"question_id":6819143,"title":"Curl equivalent in nodejs?","body":"<p>I'm looking to use information from an HTTP request using nodejs (i.e. call a remote web service and echo the response to the client).</p>\n\n<p>In PHP I would have used curl to do this.  What is the best practice in node?</p>\n"},{"tags":["javascript","node.js","express"],"answer_count":5,"favorite_count":6,"up_vote_count":11,"down_vote_count":1,"view_count":4187,"score":10,"question_id":4840879,"title":"NodeJS: How to get the server's port?","body":"<p>You often see example hello world code for Node that creates an Http Server, starts listening on a port, then followed by something along the lines of:</p>\n\n<pre><code>console.log('Server is listening on port 8000');\n</code></pre>\n\n<p>But ideally you'd want this instead:</p>\n\n<pre><code>console.log('Server is listening on port ' + server.port);\n</code></pre>\n\n<p>How do I retrieve the port the server is currently listening on without storing the number in a variable prior to calling <code>server.listen()</code>?</p>\n\n<p>I've seen this done before but I can't find it in the Node documentation. Maybe it's something specific to express?</p>\n"},{"tags":["node.js","express"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1759,"score":5,"question_id":10183291,"title":"How to get the full url in express.js?","body":"<p>Let's say my sample url is: <a href=\"http://mysampleurl.com/one/two\">http://mysampleurl.com/one/two</a> and I say</p>\n\n<pre><code>app.get('/one/two', function (req, res) {\n    var url = req.url;\n}\n</code></pre>\n\n<p>The value of \"url\" will be \"/one/two\"</p>\n\n<p>How do I get the full url value? What I want \"url\" to be is \"http://mysampleurl.com/one/two\"</p>\n\n<p>EDIT: Updated question since it's really about express and not vanilla node.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":12994594,"title":"how should i store likes/dislikes and rating in mongoose/mongdb using node.js","body":"<p>I have a schema for an item and a user. I want to allow a user to like or dislike an item and I also want to store a ratings association on the item as well as the user. </p>\n\n<pre><code>var UserSchema = new Schema({\n    username    : { type: String, required: true, index: { unique: true }\n   , likes : [{ type: Schema.ObjectId, ref: 'Item'}]\n   , dislikes : [{ type: Schema.ObjectId, ref: 'Item'}]\n   , ratings: [???]\n});\n\nvar ItemSchema = new Schema({\n    name: { type: String},\n   , likes : [{ type: Schema.ObjectId, ref: 'User'}]\n   , dislikes : [{ type: Schema.ObjectId, ref: 'User'}]\n   , ratings: [???]\n});\n</code></pre>\n\n<p>The user stores an item ref, and the item stores a user ref for likes/dislikes. I am not sure how to store ratings for as an attribute though, since I want both the user and the value they rated the item.</p>\n\n<pre><code>item.ratings.forEach(function(rating){\n  &lt;%= rating.user.username %&gt; gave &lt;%= item.name %&gt; a &lt;%= rating.value %&gt;.\n});\n</code></pre>\n\n<p>I also want to get a list of items a user has rated along with the rating value:</p>\n\n<pre><code>user.ratings.forEach(function(rating){\n  &lt;%= user.username %&gt; has rated &lt;%= rating.item.name %&gt; and gave it a &lt;%= rating.value %&gt;\n});\n</code></pre>\n\n<p>What should my \"ratings\" schema look like? Is it possible to store two values? a user object id and a rating value (integer) and have a collection of these?</p>\n\n<p>The other problem I see with my method is that mongoose doesn't support deep populate yet, so I would have to either use a module for it (https://github.com/JoshuaGross/mongoose-subpopulate), that is largely un-tested or store it in a different manner that won't have more than one level of nesting, so I can get my data with .populate()</p>\n\n<p>Any feedback is appreciated, as I'm new to noSQL and perhaps I'm overcomplicating this.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12157933,"title":"Closing DB in Mongoose","body":"<p>I have the following code to insert record in Mongo by using Mongoose. </p>\n\n<pre><code>var mongoose = require('mongoose');\nvar config      = require ('config');\n\n\nvar db = mongoose.createConnection(config.database.address, config.database.dbName);\nvar strCollectionName = 'category';\n\nvar CategorySchema = new mongoose.Schema({\n      categoryName          : {type: String, required: true , unique: true }, \n      categoryTag           : {type: String},\n      categoryDescription   : {type: String},\n      createDate             : {type: Date, default: Date.now}\n});\n\n\nvar createCategory = function (objCategory)\n{\n\n        var Category = db.model(strCollectionName, CategorySchema );\n\n        var objSchema = new Category(objCategory);\n        objSchema.save(function (err)\n        {\n            if (err)\n                console.log (\"Error\");\n            else\n                console.log (\"Success !!\");\n\n\n        });\n\n\n}\n</code></pre>\n\n<p>I managed to make it work. But if i try to issue db.close () command inside save it throws error otherwise it is good. My questions is I should not have to close the connection at all ? Will Mongoose automatically takes care it ? - Im worried if the connection pool goes beyond the limit then the entire DB might crash.</p>\n"},{"tags":["osx","node.js"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2803,"score":1,"question_id":6167496,"title":"Problem installing node on Mac OSX 10.6.7","body":"<p>I'm getting this error when I try and install node on my new mac</p>\n\n<p>error: could not configure a cxx compiler!</p>\n\n<p>The error always occurs when I get to the ./configure part of the installation</p>\n\n<p>I found this problem which applies to a linux build with the same error, but the solution does not seem to apply in my case:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/3329355/node-js-could-not-configure-a-cxx-compiler\">Node.js could not configure a cxx compiler!</a></p>\n\n<p>I also took a look at the troubleshoot guide on the node wiki here:</p>\n\n<p><a href=\"https://github.com/joyent/node/wiki/Troubleshooting-Installation\" rel=\"nofollow\">https://github.com/joyent/node/wiki/Troubleshooting-Installation</a></p>\n\n<p>and tried this solution:</p>\n\n<pre><code>export PATH=/Developer/usr/bin:$PATH\nISYSROOT=\"-isysroot /Developer/SDKs/MacOSX10.5.sdk\"\nexport LINKFLAGS=$ISYSROOT CXXFLAGS=$ISYSROOT CFLAGS=$ISYSROOT\n./configure --prefix=$HOME --without-ssl\nmake\n</code></pre>\n\n<p>But I get the same problem when I get to the ./configure step</p>\n\n<p>Any advice, insights or help would be much appreciated here.</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","mongodb"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12775807,"title":"Difference between 'db.collection' vs 'new mongo.Collection'","body":"<p>Are there any differences (besides method 1 being async) between method 1 and 2 to obtain a reference to a mongodb collection shown below?</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>var mongo = require('mongodb');\nvar db= new mongo.Db('blog', new mongo.Server(host, port, {auto_reconnect: true}, {}));\ndb.open(function(){\n    //Method 1\n    db.collection('articles', function(err, result){\n        var collection1 = result;\n    });\n\n    //Method 2\n    var collection2 = new mongo.Collection(db, 'articles');\n});\n</code></pre>\n"},{"tags":["node.js","prototypejs","prototype"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12943283,"title":"How to capture streaming results with Prototype Ajax.request","body":"<p>High Level Overview:</p>\n\n<p>I have a nodejs expressjs server that makes use of the PostgreSQL nodejs driver called pg.  I have a html file served to the client browser that when you click a button invokes a expressjs route on my expressjs server. This route will select data out of a PostgreSQL database and return it to the client html file.  The problem is the route emits a response for every row selected in the query to the database. All the client (html browser) gets is the first row.  I can write to the nodejs console server side and get all the rows to be displayed, but obviously that does me know good on my webpage.</p>\n\n<p>Question:\nHow do I get my client html file to write to console on the client for every row emitted out of my expressjs route /pg?  My assumption was on the client that the onSuccess would be fired for every row emitted out of my expressJS route.</p>\n\n<p>NodeJS\\ExpressJS Server File:</p>\n\n<pre><code>var express = require('express');\nvar pg = require('pg');\n\nvar app = express();\n\nvar MemoryStore = express.session.MemoryStore;\n\nvar conString = \"postgres://joe_user:password@localhost/dev_db\";\n\nvar client = new pg.Client(conString);\nclient.connect();\n\n\n\napp.get('/home', function(req,res){\n res.sendfile(__dirname + '/views/index.html');\n});\napp.use(express.bodyParser());\napp.use(express.cookieParser());\napp.use\n(\nexpress.session\n(\n{ \n    key: 'some-key',\n    secret: 'some-We1rD sEEEEEcret!',\n    cookie: { secure: true },\n    store: new MemoryStore({ reapInterval: 60000 * 10 }) \n}\n)\n);\n\n\n\napp.use\n(\nfunction(err, req, res, next)\n{\n  // logic\n  console.error(err.stack);\n  res.send(500, 'Something broke!');\n}\n);\n\napp.get('/pg', function(req, res)\n{\n\n\n   var  query = client.query(\"SELECT * FROM junk_data;\"); //Returns 7000 rows with 8 columns total\n\n\nquery.on('row', function(row) \n{\n   res.send(row);\n   console.log(row);\n}\n\n);\n\n\n\n}\n\n);\n\nprocess.on('uncaughtException', function (err) {\n    console.log(err);\n});\n\napp.listen(4000);\n</code></pre>\n\n<p>HTML File:</p>\n\n<pre><code>&lt;!DOCTYPE HTML&gt;\n&lt;html lang=\"en\"&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;title&gt;Demo: dojo/request/xhr&lt;/title&gt;\n        &lt;!--&lt;link rel=\"stylesheet\" href=\"style.css\" media=\"screen\"&gt;--&gt;\n        &lt;!--&lt;link rel=\"stylesheet\" href=\"../../../resources/style/demo.css\" media=\"screen\"&gt;--&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;Demo: dojo/request/xhr&lt;/h1&gt;\n        &lt;p&gt;Click the button below to see dojo/request/xhr in action.&lt;/p&gt;\n        &lt;div&gt;\n\n            &lt;button id=\"textButton2\" onclick=\"SubmitPGRequest();\"&gt;Call Express Route For PostgreSQL&lt;/button&gt;\n            &lt;!--&lt;input type=\"button\" value=\"Submit\" onclick=\"SubmitRequest();\"/&gt; --&gt;\n        &lt;/div&gt;\n        &lt;br /&gt;&lt;br /&gt;\n        &lt;div id=\"resultDiv\"&gt;\n        &lt;/div&gt;\n        &lt;!-- load dojo and provide config via data attribute --&gt;\n        &lt;script type=\"text/javascript\" src=\"http://ajax.googleapis.com/ajax/libs/prototype/1.7/prototype.js\"&gt;&lt;/script&gt;\n        &lt;script&gt;\n\nfunction SubmitPGRequest()\n{\n            new Ajax.Request( '/pg', {\n              method:  'get',\n              onSuccess:  function(response){\n                &lt;!--alert(response.responseText); --&gt;\n                if(response.done) {\n                alert('Done!');\n                }else {\n                console.log(response.responseText);}\n              },\n              onFailure:  function(){\n                alert('ERROR');\n              }\n});\n}\n        &lt;/script&gt;\n    &lt;\n</code></pre>\n\n<p>/body>\n</p>\n"},{"tags":["ruby","node.js","timeout","sinatra"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12224678,"title":"Is it possible to emulate JS's setTimeout in Sinatra / Synchrony?","body":"<p>I'm possibly looking for an alternative to node.js - some really nice things about it are setTimeout() and setInterval().</p>\n\n<p>I found that Sinatra has a <a href=\"https://github.com/igrigorik/em-synchrony\" rel=\"nofollow\">plugin called Synchrony</a> which looks like something I might actually use.</p>\n\n<p>Is it reasonable to just make a new thread and have it do a busywait or something?</p>\n"},{"tags":["node.js","rest","backbone.js","express"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":257,"score":0,"question_id":11552527,"title":"Node.js REST service - express + backbone","body":"<p>I am looking to build a site using backbone and express. I am new to this so I'd like to know if there's any difference between having both the express APIs and backbone client side code on the same server as opposed to having the APIs and client side code deployed on separate servers? If I put both on the same server, how do I structure the app to use both express and backbone?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["node.js","socket.io"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":3605,"score":4,"question_id":5856422,"title":"Simple nodeJS example not working with socket.io","body":"<p>Have been struggling all day trying to make this simple example work using socket.io. I've tried initially on Windows 7 with Cygwin. Have since also tried on OS X, with the same result.</p>\n\n<p>When running the script, it shows this...</p>\n\n<pre><code>2 May 20:57:47 - socket.io ready - accepting connections\n</code></pre>\n\n<p>But visiting the index.html page doesnt show a client has even connected.</p>\n\n<p>index.html</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n&lt;script type=\"text/javascript\" src=\"socket.io.js\"&gt;&lt;/script&gt; \n&lt;script type=\"text/javascript\"&gt; \n    var socket = new io.Socket('localhost',{'port':8090});\n\n    socket.connect();\n\n    socket.on('connect', function(){\n        console.log('connected');\n        socket.send('hi!'); \n    });\n\n    socket.on('message', function(data){ \n        console.log('message recived: ' + data);\n    });\n\n    socket.on('disconnect', function(){\n        console.log('disconected');\n    });\n&lt;/script&gt; \n&lt;/head&gt;\n&lt;body&gt;&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>server.js</p>\n\n<pre><code>var http = require('http'), io = require('socket.io'),\n\nserver = http.createServer(function(req, res){ \n    res.writeHead(200, {'Content-Type': 'text/html'}); \n    res.end('&lt;h1&gt;Hello world&lt;/h1&gt;'); \n});\nserver.listen(8090);\n\nvar socket = io.listen(server); \nsocket.on('connection', function(client){ \n    console.log('client connected');\n\n    client.on('message', function(){ \n        console.log('message arrive');\n        client.send('some message');\n    });\n\n    client.on('disconnect', function(){\n        console.log('connection closed');\n    });\n});\n</code></pre>\n\n<p>Any ideas on what I could be doing wrong? No console messages whatsoever are being displayed. Notably, when i use Firebug to look at the index.html page, no scripts are being embedded, which is odd..Not sure what could be causing that.</p>\n"},{"tags":["node.js","parse.com"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":21,"score":-1,"question_id":12992976,"title":"Signing in with Facebook using the Node SDK for Parse","body":"<p>How do I sign in with Facebook with the Node SDK for Parse?</p>\n"},{"tags":["javascript","http","node.js","websocket"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12992748,"title":"Server WebSockets and server http with node.js","body":"<p>All\nI am developing an application which needs to communicate with WebSockets with customers online in the browser. For this I started with Node.js to create the server, so far so good, my problem is that there is another application that must communicate via http POST to my server then passes this information to my server my server passes to clients web.\nI am new to the use of this technology so I apologize if I say nonsense.</p>\n\n<p>1 - I can send a POST request to my server WebSocket, the application that connects customers via WebSocket, Server, may also receive the POST request and send this information to each client by ws?</p>\n\n<p>2 - There is a way to open a client socket with a tag that allows me, server, send information to that client only and not at all, depending on a parameter. I want to know that each socket belongs to a specific customer and only send information to that client.</p>\n"},{"tags":["node.js","mongodb","mongoose","aggregate-functions","aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":12990415,"title":"Calculating count and average with MongoDB aggregation","body":"<p>I have a simple db layout like this:</p>\n\n<pre><code>client\n    id\n    sex (male/female)\n    birthday (date)    \n\nclient\n    id\n    sex (male/female)\n    birthday (date)  \n\n(...)\n</code></pre>\n\n<p>I'm trying to write an aggregation command that outputs how many male and female clients I've got, and I'd also like to output the average age of males and females, not sure I can do this in the same command or I need 2 separate ones?</p>\n\n<pre><code>// Count of males/females, average age\nClients.aggregate({\n    $project : {\"sex\"      : 1,\n            \"sexCount\" : 1,\n            \"birthday\" : 1,\n            \"avgAge\"   : 1\n               } \n    },\n    {\n        $match: {\"sex\": {$exists: true}} \n    },\n    {\n        $group: {\n                    _id      : \"$sex\",\n            sexCount : { $sum: 1 },\n            avgAge   : { $avg: \"$birthday\" },\n            }\n    },\n    { $sort: { _id: 1 } }\n    , function(err, sex_dbres) {\n            if (err)\n                throw err;\n            else{\n                (...)\n            }\n        });         \n</code></pre>\n\n<p>With the code above I get the counts of male/female, but avgAge comes as 0. Any ideas?</p>\n\n<p>Many thanks</p>\n"},{"tags":["node.js","subdomain"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":39,"score":0,"question_id":12992424,"title":"Node.js subdomains not working on ec2","body":"<p>I made an application using Node.js(With express) with 2 subdomains: </p>\n\n<p>foo.example.com and example.com</p>\n\n<p>It is working fine in my computer. I follow some instructions found on this link <a href=\"http://stackoverflow.com/questions/5791260/how-can-i-configure-multiple-sub-domains-in-express-js-or-connect-js\">How can I configure multiple sub domains in Express.js or Connect.js</a>.</p>\n\n<p>Also, to work I set on my hosts files some configurations:</p>\n\n<p>127.0.0.1 foo.example.com<br>\n127.0.0.1 example.com</p>\n\n<p>Today I was deploying this application to ec2 and the subdomains is not working. I have a 404 error when I try to access a page on a subdomain. On EC2 I am using NGNIX(I do not have much experience). In my computer I did not use <code>Ngnix</code>(I just decide to use ngnix now.. )</p>\n\n<p>At this point, I have some doubts.</p>\n\n<p><strong>What I have made:</strong></p>\n\n<ul>\n<li>Created a ngnix.config and setup some configuration to serve static files: I putted on Jsfiddle to not pollute this much screen(<a href=\"http://jsfiddle.net/HYXjj/\" rel=\"nofollow\">http://jsfiddle.net/HYXjj/</a>)</li>\n<li>Created a file with my domain on /etc/ngnix/sites-available/mydomain</li>\n</ul>\n\n<p>This file is above:</p>\n\n<pre><code>server { \nlisten   80;\nserver_name  example.com *.example.com;\n\naccess_log  /vol/log/nginx/nginx_access.log vhosts;\nerror_log  /vol/log/nginx/nginx_error.log;\n\nlocation / {\n    root   /var/www/;\n    index  index.html index.htm;\n}\nerror_page   500 502 503 504  /50x.html;\nlocation = /50x.html {\n    root   /var/www/nginx-default;\n}\n# deny access to .htaccess files, if Apache's document root\n# concurs with nginx's one\n#\nlocation ~ /\\.ht {\n    deny  all;\n}\n} ​\n</code></pre>\n\n<p>of course, on the original file example is my correct domain.</p>\n\n<p>When I try to access the application on my node.js application, I have a 404 error. Now, I'm lost and do not know what to do. </p>\n\n<p>What is wrong?</p>\n"},{"tags":["javascript","node.js","google-maps","google-maps-api-3","google-earth"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12992150,"title":"Point to latlng conversion from Google Earth KML file","body":"<p>Im having issue to extracting the Google Earth coordinates, because I need it to be in latlng and not GPoint, and need to expose to my Google Map app, Im aware that I can use those points to show my data in the gmap, but still need to convert to latlng, my nodejs script its</p>\n\n<pre><code>var fs = require('fs'),\n    xml2js = require('xml2js');\n\nvar parser = new xml2js.Parser();\nfs.readFile(__dirname + '/doc.xml', function(err, data) {\n    parser.parseString(data, function (err, result) {\n        var data = [];\n        for (var i in result.data.Placemark) {\n            var row = result.data.Placemark[i];\n            var point = row.Point[0].coordinates.toString().split(',');\n            row = {\n                name            : row.name[0]\n                , description   : row.description[0]\n                , geolocation   : [point[0], point[1]]\n            };\n            data.push(row);\n        }\n\n        console.log(data);\n    });\n});\n</code></pre>\n\n<p>At this point Im able to extract all the data I want (I just removed all the unnecessary tags from the KML). But I need to normalize it to latlng because my other database documents (noSQL) are all in latlng.</p>\n"},{"tags":["javascript","ubuntu","node.js","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":233,"score":0,"question_id":7090415,"title":"unable to run node.js and npm example chat","body":"<p>I am trying to run different chat examples like\n<a href=\"http://www.giantflyingsaucer.com/blog/?p=2535\" rel=\"nofollow\">http://www.giantflyingsaucer.com/blog/?p=2535</a>\nI have installed npm and also node properly and its working fine. But when ever I trying to run the example code I am getting this error, which I am not able to resolve it.</p>\n\n<pre><code>node.js:134\n        throw e; // process.nextTick error, or 'error' event on first tick\n        ^\nError: Cannot find module 'express'\n    at Function._resolveFilename (module.js:317:11)\n    at Function._load (module.js:262:25)\n    at require (module.js:346:19)\n    at Object.&lt;anonymous&gt; (/home/jeevandongre/Desktop/LearnBoost-socket.io-fbb268f/examples/chat/app.js:12:15)\n    at Module._compile (module.js:402:26)\n    at Object..js (module.js:408:10)\n    at Module.load (module.js:334:31)\n    at Function._load (module.js:293:12)\n    at Array.&lt;anonymous&gt; (module.js:421:10)\n    at EventEmitter._tickCallback (node.js:126:26)\n</code></pre>\n"},{"tags":["node.js","npm"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":265,"score":0,"question_id":8116775,"title":"In node, why does require() fail to find a module I just installed with npm?","body":"<p>In a case that looks similar to <a href=\"http://stackoverflow.com/questions/5594032/npm-module-installed-but-not-available\">this problem,</a> I have installed a module with npm, but <code>require('module')</code> can't find it.</p>\n\n<pre><code>my-machine:projectname me$ npm install express-csrf\nnpm info it worked if it ends with ok\nnpm info version 0.2.1\nnpm info install express-csrf@0.3.3\nnpm info activate express-csrf@0.3.3\nnpm info build Success: express-csrf@0.3.3\nnpm ok\n</code></pre>\n\n<p>So far, so good. But then...</p>\n\n<pre><code>my-machine:projectname me$ node\n&gt; require('express-csrf')\nError: Cannot find module 'express-csrf'\nat Function._resolveFilename (module.js:317:11)\nat Function._load (module.js:262:25)\nat require (module.js:346:19)\nat [object Context]:1:1\nat Interface.&lt;anonymous&gt; (repl.js:171:22)\nat Interface.emit (events.js:64:17)\nat Interface._onLine (readline.js:153:10)\nat Interface._line (readline.js:408:8)\nat Interface._ttyWrite (readline.js:585:14)\nat ReadStream.&lt;anonymous&gt; (readline.js:73:12)\n</code></pre>\n\n<p>npm says the package is there:</p>\n\n<pre><code>my-machine:projectname me$ npm ls express-csrf\nnpm info it worked if it ends with ok\nnpm info version 0.2.1\nexpress-csrf@0.3.3             active installed\nnpm ok\n</code></pre>\n\n<p>Note that the new module doesn't appear in the /usr/local/lib/node directory, but it does appear under /usr/local/lib/node/.npm</p>\n\n<pre><code>my-machine:projectname me$ ls /usr/local/lib/node/express-csrf*\nls: /usr/local/lib/node/express-csrf*: No such file or directory\nmy-machine:projectname me$ ls /usr/local/lib/node/.npm/express-csrf*\n0.3.3   active\n</code></pre>\n\n<p>Update: I should mention that everything works when I fully qualify the path in the <code>require</code> statements like so:</p>\n\n<pre><code>require('/usr/local/lib/node/.npm/express-csrf/active/package/index.js')\n</code></pre>\n"},{"tags":["node.js","npm"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":650,"score":3,"question_id":7436986,"title":"NPM basics with nave and Node.js","body":"<p>I recently installed node.js and was told that express was the way to go for routing and getting set up with web application development.</p>\n\n<p>I installed the lastest version of node which apparently is incompatible with the latest express. </p>\n\n<p>I looked up and found nave... Like RVM, nave allows you to switch versions of node. So I ran nave.sh install 0.4.11... That worked successfully and I was able to run.</p>\n\n<p>npm install express -g.</p>\n\n<p>This I thought, should install express globally.</p>\n\n<p>So I run express testapp</p>\n\n<p>which creates</p>\n\n<p>create : testapp\n   create : testapp/package.json\n   create : testapp/app.js\n   create : testapp/public/stylesheets\n   create : testapp/public/stylesheets/style.css\n   create : testapp/public/images\n   create : testapp/public/javascripts\n   create : testapp/views\n   create : testapp/views/layout.jade\n   create : testapp/views/index.jade</p>\n\n<p>then i \n   cd testapp/\n   node app.js</p>\n\n<p>I get \n   Error: Cannot find module 'express'</p>\n\n<p>Is this usual behavior? </p>\n\n<p>Since express is in packages.json, if i run npm install -d, it will create a node_modules directory in my application and not just symlink to the node_modules in my node path. </p>\n"},{"tags":["bash","node.js","express","npm"],"answer_count":3,"favorite_count":6,"up_vote_count":8,"down_vote_count":0,"view_count":3291,"score":8,"question_id":6103121,"title":"express command not found in bash after installing it with npm","body":"<p>just installed new ubuntu vm to test around with node\ninstalled things in this order:</p>\n\n<pre><code>node\nmongodb-server\nnpm\nexpress\nmongoose\n</code></pre>\n\n<p>now, trying to create a new app i noticed express cannot be used in the shell.\n<code>express -v</code>  returns\nexpress: command not found</p>\n\n<p>i installed npm like this</p>\n\n<pre><code>curl http://npmjs.org/install.sh | sudo sh\n</code></pre>\n\n<p>and i installed express this way</p>\n\n<pre><code>npm install express\n</code></pre>\n\n<p>any ideas?</p>\n"},{"tags":["http","node.js","permission-denied"],"answer_count":4,"favorite_count":2,"up_vote_count":14,"down_vote_count":0,"view_count":4874,"score":14,"question_id":9164915,"title":"Node.js EACCES error when listening on most ports","body":"<p>I'm testing out an app (hopefully to run on heroku, but am having issues locally as well).  It's giving me an EACCES error when it runs http.Server.listen() - but it only occurs on some ports.</p>\n\n<p>So, locally I'm running:</p>\n\n<pre><code>joe@joebuntu:~$ node\n&gt; var h = require('http').createServer();\n&gt; h.listen(900);\nError: EACCES, Permission denied\n    at Server._doListen (net.js:1062:5)\n    at net.js:1033:14\n    at Object.lookup (dns.js:132:45)\n    at Server.listen (net.js:1027:20)\n    at [object Context]:1:3\n    at Interface.&lt;anonymous&gt; (repl.js:150:22)\n    at Interface.emit (events.js:42:17)\n    at Interface._onLine (readline.js:132:10)\n    at Interface._line (readline.js:387:8)\n    at Interface._ttyWrite (readline.js:564:14)\n</code></pre>\n\n<p>I don't have anything running on port 900 (or any of the other 20 ports I've tried), so this should work.  The weird part is that it <strong>does</strong> work on some ports.  For instance, port 3000 works perfectly.</p>\n\n<p>What would cause this?  </p>\n\n<h2>Update 1:</h2>\n\n<p>I figured out that on my local computer, the EACCES error is coming because I have to run node as root in order to bind to those certain ports.  I don't know why this happens, but using sudo fixes it.  However, this doesn't explain how I would fix it on Heroku.  There is no way to run as root on Heroku, so how can I listen on port 80?</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":347,"score":1,"question_id":12127293,"title":"Writing a node application and encountering an error when running 'node server.js'","body":"<p>I'm writing a node application and I recently switched from port 3000 to port 80 on my Mac Os X Lion machine (running 10.7.4) and whenever I run node server.js I get the following error</p>\n\n<pre><code>events.js:66\n    throw arguments[1]; // Unhandled 'error' event\n                   ^\nError: listen EACCES\n    at errnoException (net.js:768:11)\n    at HTTPServer.Server._listen2 (net.js:891:19)\n    at listen (net.js:935:10)\n    at HTTPServer.Server.listen (net.js:984:5)\n    at Object.&lt;anonymous&gt; (/Users/ajain/Documents/Projects/Time-Feed/server.js:127:5)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.runMain (module.js:492:10)\n</code></pre>\n\n<p>Any idea on what I have to do to fix the issue?</p>\n"},{"tags":["node.js","canvas","android-emulator","vnc","vnc-viewer"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12847271,"title":"Connecting to Android Emulator through VNC","body":"<p>How can we connect to Android emulator through VNC with the help of <a href=\"http://kanaka.github.com/noVNC/noVNC/vnc.html\" rel=\"nofollow\">noVNC</a> using javascript?\ni would like to render the emulator on my browser.How can that be done.thanks</p>\n"},{"tags":["node.js","powershell","windows-7","express","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12990656,"title":"node.js express app creation equivalent in Windows 7","body":"<p>I'm following <a href=\"http://shapeshed.com/creating-a-basic-site-with-node-and-express/\" rel=\"nofollow\">this</a> tutorial on node.js and express.</p>\n\n<p>The author is on a UNIX machine. To create the app skeleton with express, jade, and stylus, the author says to run the command</p>\n\n<pre><code>./node_modules/express/bin/express -t jade -c stylus\n</code></pre>\n\n<p>However, I'm on a Windows 7 machine, so this command doesn't work. <code>./node_modules/express/bin/express jade stylus</code> doesn't do what is desired either.</p>\n\n<p>What is the equivalent of the author's command for Windows PowerShell?</p>\n"},{"tags":["node.js","postgresql","asynchronous","express"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":131,"score":3,"question_id":12991083,"title":"NodeJS less visible callbacks and more structure","body":"<p>One of the advantages of NodeJS is its async and non-blocking I/O, which in my case is great on the one hand, but breaks my neck every day on the other hand.</p>\n\n<p>I consider myself a NodeJS / Async novice and I often end up having such code:</p>\n\n<pre><code>function(req, res) {\n            req.assert(\"name\", \"Lobbyname is required\").notEmpty();\n            req.assert(\"name\", \"Lobbyname length should be between 4 and 64 characters\").len(4, 64);\n            req.assert(\"game\", \"Game not found\").isInt();\n\n            req.sanitize(\"game\").toInt();\n            var userId = req.user.id;\n\n            var errors = req.validationErrors();\n            var pg_errors = [];\n            var games = null;\n            if (errors) {\n                console.log(errors);\n                client.query(\"SELECT * FROM games\", function(err, result) {\n                    if (!err) {\n                        games = result.rows;\n                        res.render(\"lobby/create\", {\n                            title: \"Create a new lobby\",\n                            games: games,\n                            errors: errors.toString()\n                        });\n                    }\n                    else {\n                        res.send(\"error\");\n                    }\n                });\n            }\n            else {\n                errors = null;\n                client.query(\"SELECT COUNT(*) as in_lobbies FROM users u RIGHT JOIN lobby_userlist ul ON ul.user_id = u.id WHERE u.id = $1\", [userId], function(err, result) {\n                    if (!err) {\n                        console.log(result.rows[0]);\n                        if (result.rows[0].in_lobbies &lt; 1) {\n                            client.query(\"SELECT COUNT(*) as hosting_lobbies FROM lobbies WHERE owner = $1\", [userId], function(err, result) {\n                                if (!err) {\n                                    if (result.rows[0].hosting_lobbies &lt; 1) {\n                                        client.query(\"INSERT INTO lobbies(name, game, owner) VALUES($1, $2, $3)\", [req.param(\"name\"), req.param(\"game\"), userId], function(err, result) {\n                                            if (!err) {\n                                                res.redirect(\"/lobby\");\n                                            }\n                                            else {\n                                                pg_errors.push(err);\n                                                console.log(err);\n                                            }\n                                        });\n                                    }\n                                    else {\n                                        errors = \"You can only host one lobby at a time\";\n                                    }\n                                }\n                                else {\n                                    pg_errors.push(err);\n                                    client.query(\"SELECT * FROM games\", function(err, result) {\n                                        if (!err) {\n                                            games = result.rows;\n\n                                            res.render(\"lobby/create\", {\n                                                title: \"Create a new lobby\",\n                                                games: games,\n                                                errors: errors\n                                            });\n                                        }\n                                        else {\n                                            pg_errors.push(err);\n                                        }\n                                    });\n                                }\n                            });\n                        }\n                        else {\n                            pg_errors.push(err);\n                        }\n                    }\n                });\n\n                console.log(\"pg_errors\");\n                console.log(pg_errors);\n                console.log(\"pg_errors _end\");\n\n                if (pg_errors.length &lt; 1) {\n                    console.log(\"no errors\");\n                }\n                else {\n                    console.log(pg_errors);\n                    res.send(\"error service operation failed\");\n                }\n            }\n        }\n</code></pre>\n\n<p>This an example I have written using the following npm packages:</p>\n\n<ul>\n<li>pg (native)</li>\n<li>express</li>\n<li>express-validator (middleware of node-validator)</li>\n<li>passport (auth middleware)</li>\n</ul>\n\n<p>Checking whether the input given by the user is valid or not is the least problem, I have this checks where I assert the variables and give back a rendered version of the page printing out the errors to the user.</p>\n\n<p>BUT if we pass the validation errors in the first place we assume the \"lobby\" is ready to be inserted into the database, before I want to ensure that the user has no other lobby open and is not member of another lobby.\nWell now I end up putting one query into another and theoretically I would have to put my view render function (res.render()) into every query callback if the query encounters an error or returns a result which inidicates that the user is not allowed to create a lobby.\nI don't want that and it doesn't seem very practicable. </p>\n\n<p>I tried removing the render logic and every other logic from the query callbacks and instead let the query callbacks set error arrays or variables which would indicate a success or a failure and below my query code I would check if(errors) renderPageWithErrors.</p>\n\n<p>This lead to strange errors due to the async behaviour of nodejs in which case res.redirect() was called after res.render() and stuff like that.\nI had to move my res.render back into the query callbacks.</p>\n\n<p>Is there a proper way of doing this?</p>\n"},{"tags":["javascript","mvc","node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":141,"score":0,"question_id":12990771,"title":"Creating a NodeJS + Mongo DB MVC, any ideas how to start?","body":"<p>I use PHP with most of my projects/startups, I'm thinking of moving into NodeJS because I heard it's cool, I just need few tips or links to start with creating an MVC in NodeJS and MongoDb.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12985591,"title":"Get line number of every statement that is evaluated in a script","body":"<p>In Node.js, I'm trying to get the line number of each function that is called in a script. Is there any way to generate a summary of each function that is called in a script? I'd like to get a list of line numbers that are called by each function in the script, so that I can comment out one of the function calls (which I'm still trying to find.)</p>\n\n<p>An example:</p>\n\n<pre><code>function printStuff(){\n    console.log(\"This is an example.\");\n}\nprintStuff();\nprintStuff();\n</code></pre>\n\n<p>Now I'd like to get a summary of all the events in this script (without modifying the script). It might look something like this:</p>\n\n<pre><code>calling printStuff at line 4\ncalling console.log at line 2\ncalling printStuff at line 5\ncalling console.log at line 2\n</code></pre>\n\n<p>Are there any testing/debugging tools that make it possible to do this?</p>\n"},{"tags":["node.js","http-post","mocha","restify"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12989982,"title":"Node.js - simple Restify POST Mocha test failing","body":"<p>I have a simple Node.js  Rest server with a single POST service using Restify. I am trying to write a simple Mocha test, however it fails with a timeout, although succeeds with a REST Console test (browser plugin).</p>\n\n<p>My server code:</p>\n\n<pre><code>/**\n * Module dependencies\n */\n\nvar restify = require('restify');\nvar events = require('events');\nvar util = require('util');\n\n\n/**\n * Create App\n */\n\nvar server = restify.createServer({\n  name: 'test',\n    version: '0.0.1'\n    });\n\nvar eventsEmitter = new events.EventEmitter();\n\n/**\n * Configuraion\n */\n\nserver.use(restify.acceptParser(server.acceptable));\nserver.use(restify.queryParser());\nserver.use(restify.bodyParser());\n\n\n/**\n * Routes\n */\n\n\nserver.post('/post', function (req, res, next) {\n  var text = \"\";\n  req.setEncoding(\"utf8\");\n\n  req.on(\"data\", function (chunk) {\n    text += chunk;\n  });\n  req.on(\"end\", function () {\n    res.send(200, {ok: 'ok'});   \n  });\n\n  return next();\n});\n\n\n/**\n * Listen\n */ \n\nserver.listen(8080, function () {\n  console.log('%s listening at %s', server.name, server.url);\n});\n</code></pre>\n\n<p>The Mocha test is as follows:</p>\n\n<pre><code>var restify = require('restify');\nvar assert = require('assert');\n\n// init the test client\nvar client = restify.createJsonClient({\n  url: 'http://127.0.0.1:8080',\n  version: '*'\n});\n\ndescribe('service: post endpoint', function() {\n\n// Test #1\ndescribe('200 response check', function() {\n    it('should get a 200 response', function(done) {\n        client.post('/post', { hello: 'world' }, function(err, req, res, data) {                \n            if (err) {\n                throw new Error(err);\n            }\n            else {\n\n                if (data.code != 200) {\n                    throw new Error('invalid response from /post');\n                }\n                done();\n            }\n        });\n    });\n});\n\n});\n</code></pre>\n\n<p>Can anyone advise why the test would timeout (I have tested with increasing the timeout in Mocha), but succeed through a browser?</p>\n"},{"tags":["javascript","node.js","share"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12989398,"title":"How share a variable between two files in Node.js","body":"<p>Using Node.js, if I write <code>app.js</code> as:</p>\n\n<pre><code>  var commons = {\n    title: 'myTitle',\n    description: 'MyDesc',\n    menu: {\n      home: {\n        label: 'Home',\n        url: '/',\n      },\n      contacts: {\n        label: 'Contacts',\n        url: '/contacts'\n      }\n    }\n  }\n\n  console.log(commons);\n</code></pre>\n\n<p>I've this output...</p>\n\n<pre><code>  {\n    title: 'myTitle',\n    description: 'MyDesc',\n    menu: {\n      home: {\n        label : 'Home',\n        url: '/'\n      },\n      contacts: {\n        label: 'Contacts',\n        url: '/contacts'\n      }\n    }\n  }\n</code></pre>\n\n<p>...and it works fine.\nBut, if I would load a variable in <code>app.js</code> from another file (in the same path)...</p>\n\n<p><code>commons.js</code>:</p>\n\n<pre><code>exports.commons = {\n    title: 'myTitle',\n    description: 'MyDesc',\n    menu: {\n      home: {\n        label: 'Home',\n        url: '/',\n      },\n      contacts: {\n        label: 'Contacts',\n        url: '/contacts'\n      }\n    }\n  }\n</code></pre>\n\n<p><code>app.js</code>:</p>\n\n<pre><code>var commons = require('./commons');      \nconsole.log(commons);\n</code></pre>\n\n<p>I've as output:</p>\n\n<pre><code>commons: {\n        {\n        title: 'myTitle',\n        description: 'MyDesc',\n        menu: {\n            home: [Object],\n            contacts: [Object]\n        }\n    }\n }\n</code></pre>\n\n<p>Why is this happening? How can I pass the variable across the two files correctly?</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12989199,"title":"Retrieve records from mongodb by array of IDs","body":"<p>Using node/mongodb/mongoose, how do I retrieve a set of records via an array list of their IDs.</p>\n\n<p>Have had no luck with:</p>\n\n<pre><code>var ids = ['50829a8f558866ad21000921',\n    '50829a8f558866ad21000920',\n    '50829a8f558866ad2100091d',\n    '50829a8f558866ad21000915',\n    '50829a8f558866ad2100090b',\n    '50829a8f558866ad21000906'];\n\nSchema\n    .find()\n    .in(\"_id\", ids)\n    .run(callback);\n</code></pre>\n\n<p>Guessing Query.in() is not the way to go.</p>\n"},{"tags":["node.js","templates","express","template-engine"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12919397,"title":"Having a Node.JS Express template engine with multiple templates in one file","body":"<p>I wrote a custom template engine to let me use my old templates in a rewrite of my current project. Everything is working except that Express.JS always sends a </p>\n\n<pre><code>Error: Failed to lookup view (template name)\n</code></pre>\n\n<p>I have multiple templates in one file and I dont't need one file for each template...but how can I tell that Express?</p>\n\n<p>I can't get my head around this...\nAny help is appreciated</p>\n\n<p>EDIT: Some Code:</p>\n\n<pre><code>My Express Setup: (app.js)\n\nvar express = require('express');\nvar app = express();\nvar gclosure = require('./templateEngine');\nvar fs = require('fs');\n\n/**\n * Setup Express\n */\napp.configure(function(){\n\n    app.engine('test', gclosure.__express);\n\n    app.set('views', __dirname + '/public/templates');\n    app.set('view engine', 'test');\n\n    app.use(express.favicon());\n    app.use(express.bodyParser());\n    app.use(express.cookieParser());\n    app.use(express.methodOverride());\n\n    app.use(require('less-middleware')({\n        src: __dirname + '/public'\n    }));\n\n    app.use(express.static(__dirname + '/public'));\n});\n</code></pre>\n\n<p>My Custom Template Engine (templateEngine.js)</p>\n\n<pre><code>exports.renderFile =  function(path, options, fn){\n\n  if ('function' == typeof options) {\n    fn = options, options = {};\n  }\n\n  try {\n\n    fm(null, \"This is a test output\");\n\n  } catch (err) {\n    fn(err);\n  }\n};\n</code></pre>\n\n<p>My test route in express: </p>\n\n<pre><code>  app.get('/', function(req, res, next) {\n\n    res.render('simple',{\n              title: 'Sources',\n              data: 'lala',\n              options: 'miep'\n          }); \n\n  });\n</code></pre>\n\n<p>The Clou is...When i create a file named simple.test in the template folder everything is working and I can see the test output string. When I change the name to something that doesn't exist the out put is </p>\n\n<pre><code>Error: Failed to lookup view (template name)\n</code></pre>\n"},{"tags":["node.js","windows-8","watch"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12978924,"title":"fs.watch fired twice when I change the watched file","body":"<pre><code> fs.watch( 'example.xml', function ( curr, prev ) {\n   // on file change we can read the new xml\n   fs.readFile( 'example.xml','utf8', function ( err, data ) {\n     if ( err ) throw err;\n     console.dir(data);\n     console.log('Done');\n   });\n });\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<blockquote>\n  <ul>\n  <li>some data</li>\n  <li>Done  X 1</li>\n  <li>some data</li>\n  <li>Done  X 2</li>\n  </ul>\n</blockquote>\n\n<p>It is my usage fault or ..?  </p>\n"},{"tags":["jquery","node.js","popup","socket.io"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12980910,"title":"Socket.IO chat in html popup window","body":"<p>I try making Socket.IO chat using generated popup window for private message.\nI use windows.opener var in popup window code to acess variables and functions in main page. In Firefox and Chrome window.opener.socket.on(...) function successfully start from popup window code, but IE9 wont. Node.js server in background send and receive events. I use following code:</p>\n\n<pre><code>     //in index.php\n    var socket = io.connect('http://localhost:8080');\n     //other code\n    $(\"#users .user\").live('click',function(){\n    //other code\n    popUpWin[client_id]=window.open('private.php', client_id, 'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbar=no,resizable=no,copyhistory=yes,width=300,height=400,left=' + left + ', top=' + top + ',screenX=' + left + ',screenY=' + top + '');         \n    //other code        \n    });\n\n\n    //in private.php\n    //other code\n    window.opener.socket.emit('popup',window.opener.client_id);//This work!         \n    window.opener.socket.on('private_message', function (data) {This not work, private message event is send!\n        $(\"#private_data_recieved\").append('&lt;div&gt;&lt;b&gt;'+data.nick+':&lt;/b&gt; '+parseString(data.message)+'&lt;/div&gt;');\n        playSound();                        \n    }); \n        //other code\n</code></pre>\n"},{"tags":["node.js","express"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":251,"score":0,"question_id":10834849,"title":"How can I create an Express EJS project from the command line?","body":"<p>I have tried</p>\n\n<p><code>express -e myproject</code></p>\n\n<p>However this does not work as expected</p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12987590,"title":"In express what is the common way to associate a default file extension with static content requests?","body":"<p>I use Express (v3) on my backend and it also serves my static content, like this:</p>\n\n<pre><code>app.use(allowCrossDomain);\napp.use(disableETag);\napp.use(app.router);\napp.use(express[\"static\"](webRootDir));\napp.use(express.methodOverride());\napp.use(express.bodyParser());\napp.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\napp.set('view engine', 'html');\napp.set('views', webRootDir);\napp.engine(\"html\", handlebarsEngine);\n</code></pre>\n\n<p>So, a request for \"/customers.html\" is served by the <code>express.static</code> middleware. However, requesting \"/customers\" does not work, because there is no \"customers\" file and there is no such dynamic content route either.</p>\n\n<p>Of course, I could serve the file \"customers.html\" from the dynamic route by following the path explained in <a href=\"http://stackoverflow.com/questions/11569181/serve-static-files-on-a-dynamic-route-using-express\">Serve Static Files on a Dynamic Route using Express</a>. </p>\n\n<p>However, I think it is an overkill, such sort of things should be simply configurable through the default file extension, but I just could not find how. Can anyone show me?</p>\n"},{"tags":["node.js","installer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12704241,"title":"Getting rollback in creating shortcuts on installation of node js in windows 7","body":"<p>I'm trying to install nodejs server on my Windows 7 machine. I've downloaded the latest version of node (node-v0.8.11-x64.msi) from the official site and tried to install it.</p>\n\n<p>When the process reaches \"Creating of shortcuts \" I'm getting rollback installation with an error.</p>\n\n<p>Does anybody has the same problem?</p>\n"},{"tags":["javascript","node.js","websocket","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12847526,"title":"How to debug Node.js with Socket.io","body":"<p>I'm using the Google Chrome Developer Tools plugin for Eclipse to debug my Node.js server. This server uses Socket.io for the websocket connection between my web client and the server. The problem comes when I set a breakpoint in my server and start stepping through the code. The client soon decides the server isn't there anymore because there's no longer a heartbeat or any communication, so it disconnects. Meanwhile, as I'm stepping through, my code tries to do something with the socket and then it dies since the socket is now shutdown. It makes it a bit tricky trying to debug like this.</p>\n\n<p>So the question is, how can I debug a server like this with an open websocket connection and not close the connection? I don't know that there's a good solution, but I thought I'd put it out there and see if anyone has a genius idea.</p>\n"},{"tags":["node.js","express","connect","express.js"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":722,"score":1,"question_id":8928738,"title":"in express.js, any way to capture request to both json and html in one function?","body":"<p>Does anybody know a way in <b>express.js</b> to capture requests in a single function for both html and json? </p>\n\n<p>Essentially I want a single route for both <code>/users</code> and <code>/users.json</code> - like rails does with its routes -> controller.  </p>\n\n<p>That way, I can encapsulate the logic in a single function and decide to render either html or json. </p>\n\n<p>Something like:</p>\n\n<pre><code>app.get('/users[.json]', function(req, res, next, json){\n  if (json)\n    res.send(JSON.stringfy(...));\n  else\n    res.render(...); //jade template\n});\n</code></pre>\n\n<p>Could I use a param perhaps? </p>\n"},{"tags":["node.js","redis","chat","publish-subscribe","cookbook"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12983356,"title":"Redis Cookbook Chat Recipe","body":"<p>I am a new starter to Node.Js and Redis. I got the Redis cookbook and was trying out the Chat client &amp; Server recipe.</p>\n\n<p>I was wondering if anybody got the code to work or if there is some bug in the code.</p>\n\n<p>I dont see where the sent messages from the client get invoked on the server.</p>\n\n<p>Any help would be great.</p>\n\n<p>Regards,\nTom</p>\n\n<p>Client Code:</p>\n\n<pre><code>&lt;?php\n\n?&gt; \n\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;&lt;/title&gt;\n\n\n&lt;script src=\"http://192.168.0.118:8000/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js\"&gt;&lt;/script&gt;\n\n&lt;script&gt;\n\n\nvar socket = io.connect('192.168.0.118',{port:8000});\n\nsocket.on('message', function(data){\nalert(data);\n//var li = new Element('li').insert(data);\n//$('messages').insert({top: li});\n});\n\n\n&lt;/script&gt;\n\n&lt;/head&gt;\n\n&lt;body&gt;\n\n&lt;ul id=\"messages\"&gt;\n&lt;!-- chat messages go here --&gt;\n&lt;/ul&gt;\n\n&lt;form id=\"chatform\" action=\"\"&gt;\n&lt;input id=\"chattext\" type=\"text\" value=\"\" /&gt;\n&lt;input type=\"submit\" value=\"Send\" /&gt;\n&lt;/form&gt;\n&lt;script&gt;\n\n$('#chatform').submit(function() {\nsocket.emit('message', 'test'); //$('chattext').val());\n$('chattext').val(\"\"); // cleanup the field\nreturn false;\n});\n\n&lt;/script&gt;\n\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Server Code:</p>\n\n<pre><code>var http = require('http');\nio = require('socket.io');\n\nredis = require('redis');\nrc = redis.createClient();\n//rc1 = redis.createClient();\n\nrc.on(\"connect\",function(){\nrc.subscribe(\"chat\");\nconsole.log(\"In Chat Stream\");\n});\n\nrc.on(\"message\",function (channel,message){\n\n console.log(\"Sending hope: \" + message);\n //rc1.publish(\"chat\",\"hope\");\n socketio.sockets.emit('message',message);\n});\n\nserver = http.createServer(function(req,res){\n\nres.writeHead(200,{'content-type':'text/html'});\nres.end('&lt;h1&gt;hello world&lt;/h1&gt;');\n\n});\n\nserver.listen(8000);\n\nvar socketio = io.listen(server);\n</code></pre>\n"},{"tags":["javascript","node.js","mocha"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":572,"score":4,"question_id":9736429,"title":"How can I execute async Mocha tests (NodeJS) in order?","body":"<p>This question relates to the Mocha testing framework for NodeJS.</p>\n\n<p>When running async tests, I would like to run each test <em>after</em> the async part of the one before has been called.</p>\n\n<p>The default behaviour seems to be to start all the tests, then process the async callbacks as they come in.</p>\n\n<p>How can I do this?</p>\n\n<p>Thanks,</p>\n\n<p>Chris.</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1247,"score":4,"question_id":8682313,"title":"Mongoose populate","body":"<p>So here is my test code and I can't seem to figure out why the hell it isn't working. It is very similar to test <a href=\"https://github.com/LearnBoost/mongoose/blob/master/test/model.ref.test.js#L1109\" rel=\"nofollow\">'populating multiple children of a sub-array at a time'</a>.</p>\n\n<pre><code>var mongoose = require('mongoose'),\n    Schema = mongoose.Schema,\n    ObjectId = Schema.ObjectId;\n\nmongoose.connect('mongodb://localhost/testy');\n\nvar UserSchema = new Schema({\n    name: String\n});\n\nvar MovieSchema = new Schema({\n    title: String,\n    tags: [OwnedTagSchema]\n});\n\nvar TagSchema = new Schema({\n    name: String\n});\n\nvar OwnedTagSchema = new Schema({\n    _name: {type: Schema.ObjectId, ref: 'Tag'},\n    _owner: {type: Schema.ObjectId, ref: 'User'}\n});\n\nvar Tag = mongoose.model('Tag', TagSchema),\n    User = mongoose.model('User', UserSchema),\n    Movie = mongoose.model('Movie', MovieSchema);\n    OwnedTag = mongoose.model('OwnedTag', OwnedTagSchema);\n\nUser.create({name: 'Johnny'}, function(err, johnny) {\n    Tag.create({name: 'drama'}, function(err, drama) {\n        Movie.create({'title': 'Dracula', tags:[{_name: drama._id, _owner: johnny._id}]}, function(movie) {\n\n            // runs fine without 'populate'\n            Movie.find({}).populate('tags._owner').run(function(err, movies) {\n                console.log(movies);\n            });\n        });\n    })\n});\n</code></pre>\n\n<p>Produced error is</p>\n\n<pre><code>node.js:201\n        throw e; // process.nextTick error, or 'error' event on first tick\n              ^\nTypeError: Cannot call method 'path' of undefined\n    at /Users/tema/nok/node_modules/mongoose/lib/model.js:234:44\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>Got rid from OwnedTag and rewrote MovieSchema like this</p>\n\n<pre><code>var MovieSchema = new Schema({\n    title: String,\n    tags: [new Schema({\n        _name: {type: Schema.ObjectId, ref: 'Tag'},\n        _owner: {type: Schema.ObjectId, ref: 'User'}\n    })]\n});\n</code></pre>\n\n<p>Working code <a href=\"https://gist.github.com/1541219\" rel=\"nofollow\">https://gist.github.com/1541219</a></p>\n"},{"tags":["sql","node.js","mongodb","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12982069,"title":"does mongoose support virtual fields in select like SQL","body":"<p>In SQL I can make the following SELECT statement with the 'status' virtual field:</p>\n\n<pre><code>SELECT \n   CASE \n      WHEN field = 1 THEN 'sale'\n      ELSE 'none'\n   END as status\n</code></pre>\n\n<p>Does something like is in mongoose?</p>\n"},{"tags":["node.js","deployment","azure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12969001,"title":"Is jQuery on Node and Windows Azure Hosting possible?","body":"<p>I'm struggling to deploy a node app to Azure really hard. Because I use jQuery and it's dependant on Contextify (which seems to have a problem with windows) I'm just going in circles.</p>\n\n<p>Has anyone managed to successfully deploy a node app to Azure which uses jQuery, and if so, how!?!?</p>\n"},{"tags":["javascript","html","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12981387,"title":"Include libraries or external stylesheets in Express","body":"<p>I am building a todo app using express framework on node server...I have an index.ejs file as the starting point for my application, In the same folder I put my jquery.min.js file, when I try to include the jquery file as</p>\n\n<pre><code>&lt;script src=\"jquery.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>My app fails to load it, when I see the network in my chrome it looks for <pre>https://localhost:3000/jquery.min.js</pre>\nHow do I load the file ??</p>\n\n<p>PS: I am accustomed to loading scripts via <b>cloud.google.com</b> by placing the url in the src tag , But I want my application to load faster by this approach</p>\n"},{"tags":["javascript","node.js","download"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":186,"score":2,"question_id":12057433,"title":"Take Binary data and save it as an .mp3 file Javascript","body":"<p>So I have a <code>Node.js</code> script and a Javascript file communicating with each other, and everything works except the <code>Node.js</code> is supposed to return data for an <code>.mp3</code> file.</p>\n\n<p>The data is binary, it looks like gibberish, how would I take that data it returns and allow the user to download it on a webpage using Javascript?</p>\n\n<p>It gets data using <code>http.responseText</code> by the way.</p>\n\n<p>Node.js Code </p>\n\n<pre><code>//initilization\nvar querystring = require('querystring');\nvar http = require('http');\nvar url = require('url');\nvar fileSystem = require('fs');\nvar path = require('path');\nvar util = require('util');\n\n//convert function\nfunction convert(voiceToUse, textToConvert, response)\n{\n    console.log(\"Sending Convert Request...\");\n\n    //data to send as a query\n    var data = querystring.stringify(\n    {\n        username: 'user',\n        password: 'pass',\n        action: 'convert',\n        voice: voiceToUse,\n        text: textToConvert\n    });\n\n    //options to use\n    var options = {\n        host: 'ws.ispeech.org',\n        port: 80,\n        path: '/api/rest/1.5',\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Content-Length': data.length\n        }\n    };\n\n    //http post request\n    var req = http.request(options, function (res)\n    {\n        res.setEncoding('utf8');\n        res.on('data', function (chunk)\n        {\n            console.log(\"Body: \" + chunk);\n            var fileId = chunk.substr(chunk.indexOf(\"fileid\") + 7);\n            console.log(\"Converting File...\");\n            download(fileId.substr(0, fileId.search(\"&amp;\")), response);\n\n        });\n    });\n\n\n    req.on('error', function (e)\n    {\n        console.log('problem with request: ' + e.message);\n    });\n\n    req.write(data);\n    req.end();\n}\n\n//download function\nfunction download(id, response)\n{\n\n    //data to send as a query\n    var data = querystring.stringify(\n    {\n        username: 'user',\n        password: 'pass',\n        action: 'download',\n        fileid: id\n    });\n\n    //options to use\n    var options = {\n        host: 'ws.ispeech.org',\n        port: 80,\n        path: '/api/rest/1.5',\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Content-Length': data.length\n        }\n    };\n\n    //http post request\n    var req = http.request(options, function (res)\n    {\n        res.on('data', function (chunk)\n        {\n            if (JSON.stringify(res.headers).indexOf(\"audio/mp3\") != -1)\n            {\n                console.log(\"Downloading Chunk...\");\n                /*var fs = require('fs'),\n                   str = 'string to append to file';\n                fs.open('test.mp3', 'a', 666, function (e, id)\n                {\n                    fs.write(id, chunk, 0, chunk.length, 0, function ()\n                    {\n                        fs.close(id, function ()\n                        {\n                        });\n                    });\n                });*/\n                response.write(chunk, \"binary\");\n            }\n            else\n            {\n                download(id, response);\n            }\n\n        });\n\n        res.on('end', function ()\n        {   \n            if (JSON.stringify(res.headers).indexOf(\"audio/mp3\") != -1){\n            response.end();\n            }\n        });\n    });\n\n\n    req.on('error', function (e)\n    {\n        console.log('problem with request: ' + e.message);\n    });\n\n    req.write(data);\n    req.end();\n}\nhttp = require('http');\nfs = require('fs');\nserver = http.createServer( function(req, res) {\n\n    console.dir(req.param);\n\n    if (req.method == 'POST') {\n        console.log(\"POST\");\n        var body = '';\n        req.on('data', function (data) {\n            body += data;\n            console.log(\"Partial body: \" + body);\n        });\n        req.on('end', function () {\n            console.log(\"Body: \" + body);\n            if(body){\n                convert('engfemale1', body, res);\n                res.writeHead(200, {\n                    'Content-Type': 'audio/mp3', \n                    'Content-Disposition': 'attachment; filename=\"tts.mp3\"'\n                });\n            }\n        });\n\n    }\n});\n\nport = 8080;\nserver.listen(port);\nconsole.log('Listening at port ' + port);\n</code></pre>\n\n<p>Javascript code</p>\n\n<pre><code>console.log('begin');\n        var http = new XMLHttpRequest();\n        var params = \"text=\" + bodyText;\n        http.open(\"POST\", \"http://supersecretserver:8080\", true);\n\n        http.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n        //http.setRequestHeader(\"Content-length\", params.length);\n        //http.setRequestHeader(\"Connection\", \"close\");\n\n        http.onreadystatechange = function() {\n            console.log('onreadystatechange');\n            if (http.readyState == 4 &amp;&amp; http.status == 200) {\n                alert(http.responseText);//response text is binary mp3 data\n            }\n            else {\n                console.log('readyState=' + http.readyState + ', status: ' + http.status);\n            }\n        }\n\n        console.log('sending...')\n        http.send(params);\n        console.log('end');\n</code></pre>\n"},{"tags":["node.js","redis","socket.io"],"answer_count":1,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":2298,"score":3,"question_id":7463714,"title":"Redis pub/sub for chat server in node.js","body":"<p>I'm trying to work the Redis Cookbook example:</p>\n\n<pre><code>var http = require('http'),\nio = require('socket.io')\nfs = require('fs'),\nredis = require('redis'),\nrc = redis.createClient(9189, \"pike.redistogo.com\");\nrc.auth(\"passwd\", function() {\n    console.log(\"Connected! to redistogo!\");});\n\nrc.on(\"connect\", function() {\n    rc.subscribe(\"chat\");\n    console.log(\"rc connect event\");\n});\n</code></pre>\n\n<p>I am successful through here but never get \"message.\"</p>\n\n<pre><code>rc.on(\"message\", function (channel, message) {\n console.log(\"Sending: \" + message);\n socketio.sockets.emit('message', message);\n});\n\nwebpage = http.createServer(function(req, res){\nconsole.log('webpage request starting...');\n\nfs.readFile('./index.htm', function(error, content) {\n    if (error) {\n        res.writeHead(500);\n        res.end();\n    }\n    else {\n        res.writeHead(200, { 'Content-Type': 'text/html' });\n        res.end(content, 'utf-8');\n     }\n });\n });\n\n webpage.listen(7777);\n</code></pre>\n\n<p>my client side index.htm is this</p>\n\n<pre><code>&lt;!docttype html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;script src =\"https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js\"&gt;     &lt;/script&gt;\n       &lt;script src=\"http://www.heaphash.com:7777/socket.io/socket.io.js\"&gt;&lt;/script&gt;\n       &lt;script&gt;\n        var socket = io.connect('www.heaphash.com', { port: 7777});\n            socket.on('message', function(data){\n               var li = new Element('li').insert(data);\n               $('messages').insert({top: li});\n           }\n        &lt;/script&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;title&gt;Chat with Redis&lt;/title&gt;\n &lt;/head&gt;\n &lt;body&gt;\n        &lt;ul id=\"messages\"&gt;\n            &lt;!-- chat messages go here --&gt;\n        &lt;/ul&gt;\n        &lt;form id=\"chatform\" action=\"\"&gt;\n         &lt;input id=\"chattext\" type=\"text\" value=\"\" /&gt;\n         &lt;input type=\"submit\" value=\"Send\" /&gt;\n        &lt;/form&gt;\n        &lt;script&gt;\n                $('#chatform').submit(function(){\n                        socket.emit('message', $('chattext').val());\n                        $('chattext').val(\"\"); //cleanup the field\n                        return false;\n                });\n        &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>how does a client publish to a specific Redis \"chat\" channel.</p>\n"},{"tags":["javascript","ruby-on-rails","ajax","node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12979923,"title":"Large video upload and processing timeout","body":"<p>I am working on a rails application where users upload some videos. Apache with passenger is my server. The videos can be as big as 500MB or 1 GB. After the video is uploaded it is converted to mp4 and played.</p>\n\n<p>I am using <a href=\"https://github.com/valums/file-uploader\" rel=\"nofollow\">https://github.com/valums/file-uploader</a> to upload the files. With this i can upload as large as a 500MB video file easily. I want to display the mp4 preview of the video as soon as the upload is complete. I am using ffmpeg to process convert the video to mp4. This conversion may take as long as 10+ minutes some times and my request times out after 5 mins due to the default apache timeout. </p>\n\n<p>So, the problem here is the ajax upload keeps the request alive only till 5 minutes after the upload to complete. I need the request to stay alive for about 10-20 minutes after the file upload is complete. It would be great to know in case any other javascipt based solutions available to keep this request alive till the video processing completes and the preview can be shown to the user. </p>\n"},{"tags":["javascript","visual-studio-2010","node.js","editor"],"answer_count":2,"favorite_count":1,"up_vote_count":15,"down_vote_count":0,"view_count":4749,"score":15,"question_id":9108686,"title":"Develop nodejs with visual studio 2010","body":"<p>Is it possible to develop NodeJS applications with VS2010. I'm talking plain ol' Javascript, not Azure or any fancy stuff like that. I just want to use VS2010 as the Javascript editor as I'm from .NET background and I'm very comfortable with it.</p>\n\n<p>If I can, then please tell me how to configure VS2010 to be able to code NodeJS applications.</p>\n"},{"tags":["node.js","mongodb","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12980702,"title":"Check value in array without $in","body":"<p>Let's say I have the following documents:</p>\n\n<pre><code>{\n  title: 'Some title',\n  items: [1,5,9,4]\n}\n\n{\n  title: 'Some title',\n  items: [5,7]\n}\n\n{\n   title: 'Some title',\n   items: [1,2]\n}\n</code></pre>\n\n<p>I need to get a documents where items have 5. So I make the following query in mongoose:</p>\n\n<pre><code>Model.find({items: {$in: [5]}}, function (err, docs) {\n   // docs.length == 2\n});\n</code></pre>\n\n<p>And I'm getting it. But I've found that if I make the follows query then I get the same:</p>\n\n<pre><code>Model.find({items: 5}, function (err, docs){\n   // docs.length == 2\n});\n</code></pre>\n\n<p>Is is correct to use the second approach to find docs in my case?</p>\n"},{"tags":["jquery","node.js","npm"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12979531,"title":"Errors using JQuery with node.js","body":"<p>I have a fresh install of node.js running on Windows 7, and I am trying to run a very basic JQuery script, named <code>a.js</code>, which contains just:</p>\n\n<pre><code>require(\"jquery\");\n$().jquery;\n</code></pre>\n\n<p>Unfortunately, this will not run with JQuery, giving me a TypeError:</p>\n\n<pre><code>C:\\Users\\Ian&gt;node a.js\n\nC:\\Users\\Ian\\node_modules\\jquery\\lib\\node-jquery.js:10\n    window.XMLHttpRequest.prototype.withCredentials = false;\n                         ^\nTypeError: Cannot read property 'prototype' of undefined\n    at create (C:\\Users\\Ian\\node_modules\\jquery\\lib\\node-jquery.js:10:26)\n    at C:\\Users\\Ian\\node_modules\\jquery\\lib\\node-jquery.js:9435:18\n    at Object.&lt;anonymous&gt; (C:\\Users\\Ian\\node_modules\\jquery\\lib\\node-jquery.js:9437:2)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at Object.&lt;anonymous&gt; (C:\\Users\\Ian\\a.js:1:63)\n</code></pre>\n\n<p>I have found a few bug reports on this error through Google, most of which suggest downgrading JQuery. However, when I do that, I just get a different error. The below is with JQuery 1.6.3:</p>\n\n<pre><code>C:\\Users\\Ian&gt;node a.js\n\nmodule.js:340\n    throw err;\n      ^\nError: Cannot find module 'location'\n    at Function.Module._resolveFilename (module.js:338:15)\n    at Function.Module._load (module.js:280:25)\n    at Module.require (module.js:362:17)\n    at require (module.js:378:17)\n    at create (C:\\Users\\Ian\\node_modules\\jquery\\node-jquery.js:6:33)\n    at C:\\Users\\Ian\\node_modules\\jquery\\node-jquery.js:9065:18\n    at Object.&lt;anonymous&gt; (C:\\Users\\Ian\\node_modules\\jquery\\node-jquery.js:9067:2)\n    at Module._compile (module.js:449:26)\n    at Object.Module._extensions..js (module.js:467:10)\n    at Module.load (module.js:356:32)\n</code></pre>\n\n<p>Can anyone suggest what may be wrong? I have tried various reinstallations of the software with no luck. I have tried both <code>npm install -g</code> and <code>npm install</code> for both the default version of jquery and also jquery@1.6.3.</p>\n\n<p>Edit: <a href=\"http://stackoverflow.com/questions/12063058/keep-getting-error-for-browserless-jquery-in-node?rq=1\">This question</a> - as yet unanswered - seems related.</p>\n"},{"tags":["node.js","mongodb","express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12979087,"title":"MongoDB native driver for Node.js is not returning a result when querying '_id'","body":"<p>I am trying to query my database for a matching '_id' but the results are coming back null, but in the mongodb shell it is coming back with the correct results. Here is the code I am using.</p>\n\n<pre><code>var collection = new mongodb.Collection(client, 'products');\ncollection.findOne({ _id : 50738ebbe3d87c6beaddb6f2 }, function(err, result){\n  res.send(result);\n  console.log(result);\n});\n</code></pre>\n\n<p>I've also tried using, </p>\n\n<pre><code>\"ObjectId('50738ebbe3d87c6beaddb6f2')\"\n</code></pre>\n\n<p>but that also come back 'null'.</p>\n"},{"tags":["node.js","phantomjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12979723,"title":"Passing value from PhantomJs to NodeJS","body":"<p>I have a phantom script that get executed via a <a href=\"http://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback\" rel=\"nofollow\">exec()</a> call in a NojeJs Script. \nNow i need to return a string from the Phantom script so that it can be utilize back in node. \nIs there a way to achieve that ?</p>\n\n<p><strong>Node app:</strong></p>\n\n<pre><code>child = exec('./phantomjs dumper.js',\n    function (error, stdout, stderr) {\n        console.log(stdout, stderr);      // Always empty\n    });\n</code></pre>\n\n<p><strong>dumper.js (Phantom)</strong></p>\n\n<pre><code>var system = require('system');\nvar page = require('webpage').create();\npage.open( system.args[1], function (status) {\n    if (status !== 'success') {\n        console.log('Unable to access the network!');\n    } else {\n\n        return \"String\"; // Doesn't work\n    }\n    phantom.exit('String2'); //Doesn't work either\n});\n</code></pre>\n"},{"tags":["jquery","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12705735,"title":"Flash a message with JQuery, similar to rails flash or connect-flash in node","body":"<p>I am flashing messages to the client from the server using connect-flash in my node.js app. Similar to how you can flash messages in Rails apps.</p>\n\n<p>I need to have this same sort of dynamic message flashing but on the client side using jQuery.</p>\n\n<p>I think the only way is to save a message in a cookie, then redirect and on page load read from the cookie to add the message to the page and delete the cookie.</p>\n\n<p>Is there a plugin that will do this?</p>\n\n<p>Some requirements are that I can flash info and error messages.</p>\n\n<ul>\n<li>make ajax call to delete an item</li>\n<li>set cookie with success messsage</li>\n<li>redirect to another page that shows the message.</li>\n</ul>\n"},{"tags":["javascript","node.js","gui","icons","system-tray"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12979727,"title":"System tray icon in node.js application","body":"<p>This is what I need in my node.js application:</p>\n\n<ul>\n<li>System tray icon</li>\n<li>changing this icon during application work</li>\n<li>menu after clicking on icon</li>\n<li>creation of windows with fields for login / password and confirmation buttons</li>\n</ul>\n\n<p>This is what I found:</p>\n\n<ul>\n<li><a href=\"https://github.com/appjs/appjs\" rel=\"nofollow\">https://github.com/appjs/appjs</a> - It looks good, but there is still no system tray support (it looks it will be done in some time)</li>\n<li><a href=\"https://github.com/zcbenz/node-gui\" rel=\"nofollow\">https://github.com/zcbenz/node-gui</a> - It looks there is support for all I need, but I can't install it (I think this project is dead...)</li>\n</ul>\n\n<p>Do you have any recommendations? I need something <strong>reliable</strong>, <strong>easy to install</strong> and as <strong>cross-system</strong> as possible.</p>\n"},{"tags":["node.js","iisnode"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12975149,"title":"iisnode hang issue","body":"<p>I am presently using node 0.8 with iisnode 0.1.21.</p>\n\n<p>I have set nodeProcessCountPerApplication=\"4\"  in the web.config under the iisnode tag.</p>\n\n<p>My application starts perfectly with 4 node processes but it hangs after some time. It does not crash.</p>\n\n<p>I observed that this happens once any one of the processes starts using more than 200mb of memory. Does any body know if this is a memory issue or is it something else?</p>\n\n<p>Furthermore if i shutdown/endtask any one of the processes from the task manager, every thing starts working perfectly.</p>\n"},{"tags":["node.js","cookies","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12979081,"title":"persistant cookies using nodejs","body":"<p>I want to save some cookies in my browser using node.js. Any one knows how I can achieve this behavior? My purpose is when the user has checked the checkbox(\"keep me logged in\") then the checkbox state and the cookies should be stored.</p>\n"},{"tags":["javascript","node.js","sockets","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12967164,"title":"socket.io : How do I call upon my socket methods dynamically from an object?","body":"<p>I have this:</p>\n\n<pre><code>io.sockets.on('connection', function(socket) {\n    socket.on(\"action1\", function(data){\n        socket.emit(\"action1\", data);\n    });\n    socket.on(\"action2\", function(data){\n        socket.emit(\"action2\", data);\n    });\n    socket.on(\"action3\", function(data){\n        socket.emit(\"action3\", data);\n    });\n});\n</code></pre>\n\n<p>I want this:</p>\n\n<pre><code>var socketMethods = {\n    action1:function(data, socket){\n        socket.emit(\"action1\", data);\n    },\n    action2:function(data, socket){\n        socket.emit(\"action2\", data);\n    },\n    action3:function(data, socket){\n        socket.emit(\"action3\", data);\n    }\n}\n\nio.sockets.on('connection', function(socket) {\n    for(key in socketMethods){\n        socket.on(key, socketMethods[key]);\n    }\n});\n</code></pre>\n\n<p>However, I can't pass the socket into the method and I end up with</p>\n\n<pre><code>C:\\__server\\nodejs.js:217\n    socket.emit('action1', {msg:\"No account\"}\n               ^\nTypeError: Cannot call method 'emit' of undefined\n</code></pre>\n\n<p>I have tried passing the socket through the function :</p>\n\n<pre><code>io.sockets.on('connection', function(socket) {\n    for(key in socketMethods){\n        socket.on(key, function(data, socket){\n            socketMethods[key](data, socket);\n        });\n    }\n});\n</code></pre>\n\n<p>The socket doesn't get passed into the function.</p>\n\n<p>How can I call the methods dynamically, and still be able to use socket within the method?</p>\n\n<p>UPDATE:</p>\n\n<p>With this EXACT code:</p>\n\n<pre><code>io.sockets.on('connection', function(socket) {\n    for(key in socketMethods){\n        socket.on(key, function(data){\n            socketMethods[key](data, socket);\n        });\n    }\n});\n</code></pre>\n\n<p>I've found something very interesting.</p>\n\n<p>It DOES work, and I can run socket.emits from the method!</p>\n\n<p>HOWEVER, now, it just runs the LAST method.  In this case, action3 is called no matter what's asked for.  If you ask for action1, or action 2, action 3 is still called.</p>\n\n<p>UPDATE:</p>\n\n<p>Running a console.log(socket._events), I see that the functions error:[function], action1:[function], action2:[function], action3:[function] ARE attached.  When I try to see what's in each of those functions, all I get are.</p>\n\n<pre><code>function ack() {\n      self.packet({\n          type: 'ack'\n        , args: io.util.toArray(arguments)\n        , ackId: packet.id\n      });\n    }\n</code></pre>\n\n<p>Regardless of the function I send back to myself. I've also set action2, to be the last thing in the object, and action2 is what is called.  Yet.  When I attached socket.on methods the -normal- way, they look exactly the same in socket._events.</p>\n\n<p>I had a theory that all the methods are being overwritten by the \"last\" action(action3).</p>\n\n<p>Can't sleep</p>\n"},{"tags":["node.js","session","redis","passport"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":176,"score":3,"question_id":12947965,"title":"Nodejs + Passport.js + Redis: how to store sessions in Redis","body":"<p>I've read this topic <a href=\"http://stackoverflow.com/questions/10164312/node-js-express-js-passport-js-stay-authenticated-between-server-restart\">Node.js + express.js + passport.js : stay authenticated between server restart</a> and I need exactly the same thing, but for Redis. I used such code:</p>\n\n<pre><code>var RedisStore = require('connect-redis')(express);\napp.use(express.session({\n    secret: \"my secret\",\n    store: new RedisStore,\n        cookie: { secure: true, maxAge:86400000 }\n}));\n</code></pre>\n\n<p>And it doesn't work. To connect Redis I use connect-redis module. What I'm doing wrong? Thanks!</p>\n\n<p><strong>UPD</strong>: I don't get any errors. To ensure auth processes succesfully, I added log-line, and it executes.</p>\n\n<pre><code>function(email, password, done) {\n    // asynchronous verification, for effect...\n    process.nextTick(function() {\n        findByEmail(email, function(err, user) {\n            if (!user) {\n                return done(null, false, {\n                    message: 'Unknown user ' + email\n                });\n            }\n            if (user.password != password) {\n                return done(null, false, {\n                    message: 'Invalid password'\n                });\n            }\n            //just logging that eveything seems fine\n            console.log(\"STATUS: User \" + email + \" authentificated succesfully\");\n            return done(null, user);\n        })\n    });\n}));\n</code></pre>\n\n<p>Log with express.logger() enabled was:</p>\n\n<pre><code>127.0.0.1 - - [Fri, 19 Oct 2012 05:49:09 GMT] \"GET /ico/favicon.ico HTTP/1.1\" 404 - \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4\"\nSTATUS: User admin authentificated succesfully\n</code></pre>\n\n<p>I <strong>do</strong> suppose that there is nothing wrong with auth/users/credentials/serializing/deserializing itself. The problem is just passport cannot set cookie to Redis and the read it.</p>\n"},{"tags":["ajax","node.js","file-upload","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12472906,"title":"Node.js + Express: Upload a file without reloading page","body":"<p>I am creating a chat application using Node.js, and would like to have a file upload feature. While I can get the file uploaded, the browser would always be redirected to another link or page refreshed, and this of course disrupts the chat.</p>\n\n<p><strong>First</strong> I tried using Express to do it:</p>\n\n<p>index.html:</p>\n\n<pre><code>&lt;form id=\"fileSendButton\" action=\"/\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n    &lt;input type=\"text\" name=\"title\"&gt;&lt;br&gt;\n    &lt;input type=\"file\" name=\"upload\" multiple=\"multiple\"&gt;&lt;br&gt;\n    &lt;input type=\"submit\" value=\"Upload\"&gt;\n&lt;/form&gt; \n</code></pre>\n\n<p>app.js:</p>\n\n<pre><code>app.post('/', function(req, res){\n    //some validation and rename file\n    res.send();\n    return false;\n});\n</code></pre>\n\n<p><strong>Next</strong> I tried using AJAX, but still couldnt do it, whenever the AJAX POST to the Node.js server, it would reload the page. My AJAX code anyway:</p>\n\n<p>index.html:</p>\n\n<pre><code>$.ajax({  \n    type: \"POST\",  \n    url: \"/\",  \n    data: formdata,  \n    processData: false,\n    contentType: false,\n    success: function (res) {\n        document.getElementById(\"chatText\").innerHTML = res; \n    } \n});  \nreturn false;\n</code></pre>\n\n<p><strong>Third</strong> I went to look at Uploadify, but didnt want to add Flash dependancy to my site, so I didnt implement it.</p>\n\n<p>Anyone can help me please? I dont want a page reload when a file is uploaded.</p>\n"},{"tags":["node.js","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12977719,"title":"How much data can I send through a socket.emit?","body":"<p>So I am using node.js and socket.io.  I have this little program that takes the contents of a text box and sends it to the node.js server.  Then, the server relays it back to other connected clients.  Kind of like a chat service but not exactly.</p>\n\n<p>Anyway, what if the user were to type 2-10k worth of text and try to send that?  I know I could just try it out and see for myself but I'm looking for a practical, best practice limit on how much data I can do through an emit.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12978169,"title":"RangeError: length > kMaxLength while reading massive text file with NodeJS","body":"<p>I have a huge(~1.5 gig) text file to read with 'fs' and it gives me back this error:</p>\n\n<pre><code>RangeError\nRangeError: length &gt; kMaxLength\n    at new Buffer (buffer.js:242:21)\n    at fs.js:130:16\n    at Object.oncomplete (fs.js:297:15)\n</code></pre>\n\n<p>Here is part of my code:</p>\n\n<pre><code>var fs = require('fs');\nfs.readFile('file.txt', 'ASCII', function (err, data) {\n  console.log(data)\n});\n</code></pre>\n\n<p>It gets me back error even though i use this command: node --max-old-space-size=8000 file.js\nAny suggestions are welcome:) \nThank you!</p>\n"},{"tags":["javascript","node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":12944328,"title":"Mongoose.js Never Save Field Via Set","body":"<p>Is there any way to mark a field as NOT modified in mongoose?</p>\n\n<p>I have a mongoose schema:</p>\n\n<pre><code>var schema = mongoose.Schema({\n    field          : { type : String   }\n  , fieldGenerated : { type : [String] }\n});\n</code></pre>\n\n<p>I want to make it so that <code>fieldGenerated</code> NEVER gets set via <code>model.set( ... )</code>.</p>\n\n<p>The only way it should be set is in the pre-save middleware:</p>\n\n<pre><code>schema.pre( 'save', function( next ) {\n\n    // Any way to mark fieldGenerated as NOT modified here?\n\n    // I only want to set fieldGenerated if field was set.\n    // I don't want fieldGenerated to be set any other way.\n    if ( this.field &amp;&amp; this.isModified( 'field' ) ) {\n        this.fieldGenerated = this.field.split( ' ' );\n        this.markModified( 'fieldGenerated' );\n    }\n\n    next();\n}\n</code></pre>\n\n<p>Is there any way to accomplish this?</p>\n"},{"tags":["actionscript-3","node.js","tcp"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12966250,"title":"Building a networking event system, what data format should I use?","body":"<p>I'm using Node.js to build an event based game server (to a flash client). But, I'm having trouble finding examples of how I should architect this message passing.</p>\n\n<p>To simplify things, I was thinking in using a json:</p>\n\n<pre><code>{signature: 'event_name', { /* event data /*} }\n</code></pre>\n\n<p>So I can easily write to socket using any serialization library. Is it a good idea? Please point me to articles, tutorials or books if you think I don't know what I'm doing at all (which I think is the case)</p>\n"},{"tags":["javascript","node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":272,"score":1,"question_id":8187507,"title":"Is the 'on' method in this node.js code a JavaScript method or a node method?","body":"<p>I couldn't find this answer on Google because 'on' is such a common word.\nIn this node.js example:</p>\n\n<pre><code>conn.on('close', function() {\nvar pos =   connections.indexOf(conn);\n    if (pos &gt;= 0) {\n        connections.splice(pos, 1);\n    }\n});\n</code></pre>\n\n<p>There is a <code>.on</code> method(?). What it does? It is a JavaScript method? Or it is something you only find in node? I'm kind of confused because I think I saw something like <code>.on</code> on jQuery. Is it similar to the jQuery <code>.live</code> event handler?</p>\n\n<p>Can anyone explain this to me?</p>\n"},{"tags":["http","node.js","authorization"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":137,"score":1,"question_id":12850646,"title":"Cant get digest auth to work with node.js","body":"<p>I'm trying to get a simple (!) digest authentication working with node js using an an API from gathercontent.com.</p>\n\n<p>Everything seems to be working except I still get a \"Wrong credentials\" response that looks like this:</p>\n\n<pre><code>{ success: false, error: 'Wrong Credentials!' }\n</code></pre>\n\n<p>The code looks like this:</p>\n\n<pre><code>var https = require('https'),\n    qs = require('querystring');\napikey = \"[my api key goes in here]\",\n    pwd = \"[my password goes in here]\",\n    crypto = require('crypto');\n\n\nmodule.exports.apiCall = function () {\n\n    var options = {\n        host:'abcdefg.gathercontent.com',\n        port:443,\n        path:'/api/0.1/get_pages_by_project/get_me',\n        method:'POST',\n        headers:{\n            \"Accept\":\"application/json\",\n            \"Content-Type\":\"application/x-www-form-urlencoded\"\n        }\n    };\n\n    var req = https.request(options, function (res) {\n\n        res.on('data', function (d) {\n            var creds = JSON.parse(d);\n\n\n            var parsedDigest = parseDigest(res.headers['www-authenticate']);\n            console.log(parsedDigest);\n            var authopts = {\n                host:'furthercreative.gathercontent.com',\n                port:443,\n                path:'/api/0.1/get_pages_by_project/get_me',\n                method:'POST',\n                headers:{\n                    \"Accept\":\"application/json\",\n                    \"Content-Type\":\"application/x-www-form-urlencoded\",\n                    \"Authorization\" : getAuthHeader(parsedDigest, apikey, parsedDigest['Digest realm'], pwd)\n                }\n            };\n\n            console.log(authopts);\n            console.log('\\n\\n\\n');\n            var req2 = https.request(authopts, function (res2) {\n                console.log(\"statusCode: \", res2.statusCode);\n                console.log(\"headers: \", res2.headers);\n\n\n                res2.on('data', function (d2) {\n                    var result = JSON.parse(d2);\n\n                });\n            });\n\n            req2.end();\n\n\n\n        });\n\n    });\n\n\n    req.write('id=1234');\n\n    req.end();\n\n    req.on('error', function (e) {\n        console.error(e);\n    });\n\n};\n\nfunction parseDigest(s){\n\n    var parts = s.split(',');\n    var obj = {};\n    var nvp = '';\n\n    for(var i = 0; i &lt; parts.length; i++){\n\n        nvp = parts[i].split('=');\n        obj[nvp[0]] = nvp[1].replace(/\"/gi, '');\n    }\n\n\n\n    return obj;\n}\n\nfunction getAuthHeader(digest, apikey, realm, pwd){\n    var md5 = crypto.createHash('md5');\n    var s = '';\n\n    var nc = '00000001';\n    var cn = '0a4f113b';\n\n    var HA1in = apikey+':'+realm+':'+pwd;\n    md5 = crypto.createHash('md5');\n    md5.update(HA1in);\n    var HA1out = md5.digest('hex');\n\n    var HA2in = 'POST:/api/0.1/get_pages_by_project/get_me';\n    md5 = crypto.createHash('md5');\n    md5.update(HA2in);\n    var HA2out = md5.digest('hex');\n\n    md5 = crypto.createHash('md5');\n    var respIn = HA1out + ':' + digest.nonce + ':'+nc+':'+cn+':'+digest.qop+':'+ HA2out;\n    md5.update(respIn);\n    var resp = md5.digest('hex');\n\n\n    s = [   'Digest username=\"',apikey,'\", ',\n        'realm=\"',digest['Digest realm'],'\", ',\n        'nonce=\"',digest.nonce,'\", ',\n        'uri=\"/api/0.1/get_pages_by_project/get_me\", ',\n        'cnonce=\"',cn,'\", ',\n        'nc=\"',nc,'\", ',\n        'qop=\"',digest.qop,'\", ',\n        'response=\"',resp,'\", ',\n        'opaque=\"',digest.opaque,'\"'].join('')\n\n    return s;\n}\n</code></pre>\n\n<p>I'd try and Curl to it but I'm not sure how!</p>\n\n<p>Any help appreciated!</p>\n"},{"tags":["node.js","mongodb","express","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12970560,"title":"I am getting a duplicate key error index: when I am trying to save data in mongodb","body":"<p>I have a schema :</p>\n\n<pre><code>  var RegisterInfoSchema= new Schema({\n  Organization:String,\n  NGOName:String,\n  Acronym:String,\n  Address:String,\n  Province:String,\n  District:String,\n  Tehsil:String,\n  Telephone_number:String,\n  Website:String,\n  Demographics:String,\n  Username:{type:String ,index: {unique:true}},\n  Password:String\n  })\n\nexports.savePersonalInfo = function (req,res){\nconsole.log(\"savePersInfo CALLED\");\n\nvar receivedObj = new RegisterInfo({\n    Organization:           req.body.regOrgType ,\n    NGOName:                req.body.regName,\n    Acronym:                req.body.regAcronym ,\n    Address:                req.body.regAddress ,\n    Province:               req.body.regProvince,\n    District:               req.body.regDistrict,\n    Tehsil:                 req.body.regTehsil ,\n    Telephone_number:       req.body.regTelNo  ,\n    Website:                req.body.regWebAddr,\n    Demographics:           req.body.regDemographics,\n    Username:               req.body.regUserName ,\n    Password:               req.body.regPsw\n      });\n\n     receivedObj.save(function(err){\n    console.log(\"inside Save \");\n    if(err){                        \n        console.log(err);\n    }\n    else{\n        console.log(\"Saved!!\");\n        res.send(\"\");\n\n    }\n\n   });\n   }\n</code></pre>\n\n<p>There is indexing in Username\nWhen I am trying to save data using save() method then it gives the following error:</p>\n\n<p><strong>{ [MongoError: E11000 duplicate key error index: testdb.registerinfos.$username_1  dup key: { : null }]\n  name: 'MongoError',\n  err: 'E11000 duplicate key error index: testdb.registerinfos.$username_1  dup key: { : null }',\n  code: 11000,\n  n: 0,\n  lastOp: 0,\n  connectionId: 339527,\n  ok: 1 }</strong></p>\n"},{"tags":["javascript","jquery","node.js","express","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12960575,"title":"how to pass an array of objects to jade template?","body":"<p>i want to pass an array of objects from mongodb to the client...</p>\n\n<p>this is the object</p>\n\n<pre><code>var objeto_img=\n                            {\n                                name:'name of the file',\n                                image:'image.jpg url',\n                                title:'title of the image',\n                                caption:'descripcion of the image',\n                                link:\"#\",\n                            };\n</code></pre>\n\n<p>in some profiles the are many images so the is an array of objects like this</p>\n\n<pre><code>[var objeto_img=\n                            {\n                                name:'name of the file',\n                                image:'image.jpg url',\n                                title:'title of the image',\n                                caption:'descripcion of the image',\n                                link:\"#\",\n                            },var objeto_img=\n                            {\n                                name:'name of the file',\n                                image:'image.jpg url',\n                                title:'title of the image',\n                                caption:'descripcion of the image',\n                                link:\"#\",\n                            },var objeto_img=\n                            {\n                                name:'name of the file',\n                                image:'image.jpg url',\n                                title:'title of the image',\n                                caption:'descripcion of the image',\n                                link:\"#\",\n                            };]\n</code></pre>\n\n<p>this is the server code </p>\n\n<pre><code>res.render('index/perfil_publicacion_contenido',\n    {\n        datos:datosRecibidos\n    })\n</code></pre>\n\n<p>datosRecibidos is an array of objects from mongodb</p>\n\n<p>and im trying to put in a variable inside jade </p>\n\n<pre><code>input(type='hidden',id='imagenes',value=datos.img)\n</code></pre>\n\n<p>but when i try to get the objects</p>\n\n<pre><code>var fotos=$('#imagenes1').val();\n            for(foto in fotos)\n            {\n                console.log(fotos[foto].image)\n                console.log(fotos[foto].name)\n                console.log(fotos[foto].caption)\n                console.log(fotos[foto].title)\n            }\n</code></pre>\n\n<p>the console log print undefined</p>\n\n<p>why is that??? how can i get the information from db correctly in the client???\ntnx all</p>\n"},{"tags":["node.js","mongodb","mongoose","restify"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12974230,"title":"Response will not return when trying to save model with Mongoose in Restify API","body":"<p>I am building an API using Restify and Mongoose for NodeJS. In the method below after finding the user and verifying their password, I am trying to save some login information before sending the response back to the user. The problem is the response will never return. If I place the response outside and after the save call, the data never gets persisted to MongoDB. Am I doing something wrong? And help would be great as I have been working on this for the past 2 days.</p>\n\n<pre><code>    login: function(req, res, next) {\n        // Get the needed parameters\n        var email = req.params.email;\n        var password = req.params.password;\n\n        // If the params contain an email and password\n        if (email &amp;&amp; password) {\n            // Find the user\n            findUserByEmail(email, function(err, user) {\n                if (err) {\n                    res.send(new restify.InternalError());\n                    return next();\n                }\n\n                // If we found a user\n                if (user) {\n                    // Verify the password\n                    user.verifyPassword(password, function(err, isMatch) {\n                        if (err) {\n                            res.send(new restify.InternalError());\n                            return next();\n                        }\n\n                        // If it is a match\n                        if (isMatch) {\n                            // Update the login info for the user\n                            user.loginCount++;\n                            user.lastLoginAt = user.currentLoginAt;\n                            user.currentLoginAt = moment.utc();\n                            user.lastLoginIP = user.currentLoginIP;\n                            user.currentLoginIP = req.connection.remoteAddress;\n\n\n                            user.save(function (err) {\n                                if (err) {\n                                    res.send(new restify.InternalError());\n                                    return next();\n                                }\n\n                                // NEVER RETURNS!!!!\n\n                                // Send back the user\n                                res.send(200, user);\n                                return next();\n                            });\n                        }\n                        else {\n                            res.send(new restify.InvalidCredentialsError(\"Email and/or password are incorrect.\"));\n                            return next();\n                        }\n                    });\n                }\n                else {\n                    res.send(new restify.InvalidCredentialsError(\"Email and/or password are incorrect.\"));\n                    return next();\n                }\n            });\n        }\n        else {\n            res.send(new restify.MissingParameterError());\n            return next();\n        }\n    },\n</code></pre>\n"},{"tags":["linux","node.js","init.d","forever"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12973777,"title":"How to run a shell script at startup","body":"<p>On an amazon linux instance, I have two scripts called <code>start_my_app</code> and <code>stop_my_app</code> which start and stop forever (which in turn run my node.js app). I use these scripts to manually start and stop my node app. So far so good.</p>\n\n<p>My problem: I also want to set it up such that <code>start_my_app</code> is run whenever the system boots up. I know that I need to add a file inside <code>init.d</code> and I know how to symlink it to the proper directory within <code>rc.d</code>, but can't figure out what actually needs to go inside the file that I place in <code>init.d</code>. I'm thinking it should be just one line, like, <code>start_my_app</code>, but that hasn't been working for me.</p>\n\n<p>Any help would be appreciated. Thanks.</p>\n"},{"tags":["node.js","terminal","sublimetext2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":181,"score":0,"question_id":12124544,"title":"can not run node app with nodejs sublime plugin","body":"<p>I installed this plugin</p>\n\n<p><a href=\"https://github.com/tanepiper/SublimeText-Nodejs\" rel=\"nofollow\">https://github.com/tanepiper/SublimeText-Nodejs</a></p>\n\n<p>It basically lets me launch node app in terminal by pressing ctrl+r. It works for the first time I tried. However later it keep saying this error</p>\n\n<pre><code>Node binary could not be found in PATH\n\nConsider using the node_command setting for the Node plugin\n\nPATH is: /usr/bin:/bin:/usr/sbin:/sbin\n</code></pre>\n\n<p>What could be the problem?</p>\n"},{"tags":["javascript","jquery","html","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12972435,"title":"How to get the number of tabs opened of my web in a browser using jquery?","body":"<p>I am looking a way to know how many tabs are opened of my web in a browser. Basically my purpose is to handle \"keep me logged in\" check. But the issue is when I do not checked that checkbox and open multiple tabs then if I close a single tab, It removes my session. I want to know if the user has not checked the \"keep me logged in\" checkbox and then he closes the last tab of my web then I should destroy his session.</p>\n"},{"tags":["javascript","node.js","geolocation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12972297,"title":"Node.JS Geolocation by IP","body":"<p>Are there any good Geolocation NPM Moduals for Node.JS?</p>\n\n<p>I need to be able to find a Long/Lat in order to work out a WOEID from Yahoo to find Twitter Trends, is this possible?</p>\n\n<p>Thanks.</p>\n"},{"tags":["node.js","github","debian"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12970550,"title":"reinstall node.js on a debian machine, over a pre-version","body":"<p>I'm new to Node ( less every day )\nI've got many problems, running express3,request and socket.io :\n-  Double log on app.post\n- \"Can't set headers after they are sent\" in the http middleware </p>\n\n<p>When the first problem was corrected ( here on stackoverflow ), then the second one happens ...</p>\n\n<p>Samples taken from natives site show me the same errors.</p>\n\n<p>So, i made a node -v\nThe version is v0.9.3-pre, installed from Git ( current is 0.8.12 )</p>\n\n<p>I believe this is my main problem, so how can i be sure of the version i am going to reinstall ?\nCan this be done by Git ?</p>\n\n<p>On : debian  squeeze</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","javascript-events","timer","settimeout"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":12970989,"title":"NodeJS Set Timeout","body":"<p>I'm using the phidgets library to interact with physical devices via nodejs. I've got it all connected physically, all I want to do is ensure my timings for the on/off's are precise.</p>\n\n<p>This would be the issue, as I can't even get things to console.log out properly regarding setTimout's.</p>\n\n<p>Essentially, I'm attempting to do the following:</p>\n\n<pre><code>    for ( var i = 0; i &lt; 4; i++ ) {\n        setTimeout( function(i){\n            console.log('Input: \"' + i + '\", Executed with timeout of ' + i*1000 + 'ms');\n        }(i), i*1000 );\n    };\n</code></pre>\n\n<p>But my console just spits out the below, with no timeouts. It's instant.</p>\n\n<pre><code>Input: \"0\", Executed with timeout of 0ms\nInput: \"1\", Executed with timeout of 1000ms\nInput: \"2\", Executed with timeout of 2000ms\nInput: \"3\", Executed with timeout of 3000ms\n</code></pre>\n\n<p>Which is far from what I want.</p>\n\n<p>Any ideas as to what'a going on?</p>\n"},{"tags":["node.js","node-inspector"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":25,"score":3,"question_id":12968001,"title":"Using Node Inspector with multiple node processes","body":"<p>I started using Node Inspector to debug some of my Node applications. However, one thing i am not sure how to do is, once Node-inspector is attached to one Node app, how to detach and attach it to another Node app running on same box?</p>\n\n<p>can i attach to multiple processes at the same time?</p>\n"},{"tags":["javascript","json","node.js","express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12970186,"title":"Possible to pass or access server side model data to client side js","body":"<p>Developed a simple prototype using nodejs with MVC controller action. My requirement is passing the model data to client js for validation purpose. Pls let me know is there any way to access the model data from client js?</p>\n"},{"tags":["javascript","node.js","sockets","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12969220,"title":"socket.io Using a for loop to add socket.on methods","body":"<p>Assume</p>\n\n<pre><code>socketMethods:{\n    update:function(data){\n        this.emit(\"test\", data);\n        console.log(\"socket.update\");\n    },\n    test:function(data){\n        this.emit(\"test\", data);\n        console.log(\"socket.test\");\n    }\n}\n</code></pre>\n\n<p>This below is possible, and allows me to emit \"test\" and \"update\", and \"test\" and \"update\" will be called</p>\n\n<pre><code>socket.on(\"test\", function(data){\n    dummy.socketMethods.test.call(socket, data);\n});\nsocket.on(\"update\", function(data){\n    dummy.socketMethods.update.call(socket, data);\n});\n</code></pre>\n\n<p>These below are NOT possible...  EACH one will instead call \"test\", if I emit \"test\" OR \"update\".  If I use a FOR loop, all methods will become the \"last\" method called.</p>\n\n<p>That is:  If I switched update and test so that test is first, and update is second in the socketMethods object.  \"update\" would always be called, regardless of whether I asked for \"test\" or \"update\"</p>\n\n<pre><code>for(key in dummy.socketMethods){\n    socket.on(key, function(data){\n        dummy.socketMethods[key].call(socket, data);\n    });\n}\n\n\n\nvar methods = [\"test\", \"update\"];\nwhile(methods.length !== 0){\n    var method = methods.pop();\n    console.log(method);\n    socket.on(method, function(data){\n        dummy.socketMethods[method].call(socket, data);\n    });\n}\n\n\n\nvar methods = [\"test\", \"update\"];\nfor(var i = 0; i &lt; methods.length; i++){\n    console.log(i);\n    socket.on(methods[i], function(data){\n        console.log(i);\n        dummy.socketMethods[methods[i]].call(socket, data);\n    });\n}\n</code></pre>\n\n<p>CLUE : The for loop using 'i', has two console.logs.  The second console.log returns \"2\"</p>\n\n<p>Why does this happen?  And how could I use a for loop to attach my socketMethods?</p>\n"},{"tags":["javascript","json","performance","node.js"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12969597,"title":"Javascript: Removing an object from array by checking it's attribute","body":"<p>I might have written a pretty confusing title but my question is rather simple. </p>\n\n<p>I'm looking for an efficient way to remove an item from an array. But my array is full objects that has been <b>stringified</b> (I'm writing my app on Node.js and I'm using <b>JSON.stringify</b> method). So my array is like this;</p>\n\n<pre><code>\"{\\\"userID\\\":\\\"15\\\",\n  \\\"possibleFollowers\\\":[\n      {\\\"followerID\\\":\\\"201\\\",\\\"friends\\\":716},\n      {\\\"followerID\\\":\\\"202\\\",\\\"friends\\\":11887},\n      {\\\"followerID\\\":\\\"203\\\",\\\"friends\\\":11887}],\n  \\\"name\\\":\\\"John\\\",\n  \\\"lon\\\":\\\"Doe\\\"}\"\n</code></pre>\n\n<p><P>My question is on Javascript(or Node). If I wanted to remove the from possibleFollowers with \"followerID: 202\", how would I be able to do that <b>efficiently</b>?</p></p>\n"},{"tags":["javascript","node.js","module"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":12968520,"title":"How to expand nodejs module","body":"<p>I would like to expand <code>nodeJs</code> module.</p>\n\n<p>For example, I want to add a function into <a href=\"http://nodejs.org/api/util.html\" rel=\"nofollow\">Utilities</a> module.</p>\n\n<p>like detect empty <strong>JSON</strong> object</p>\n\n<pre><code>function isEmptyObject(obj) {\n  return !Object.keys(obj).length;\n}\n</code></pre>\n\n<p>So, I can use <code>util.isEmptyObject()</code> to detect empty <strong>JSON</strong> object.</p>\n\n<p>Is it a  good way to expand <code>nodeJs</code> module?</p>\n"},{"tags":["node.js","haxe"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12938317,"title":"asynchronous exception handling in HaXe","body":"<p>what is best practice to handle exceptions in haxe with asynchronous node.js?</p>\n\n<p>This code dont displays \"haha: test\" instead it displays \"test\".</p>\n\n<pre><code>import js.Node;\n\nclass Main {\n\n    public static function handleRequest(req: NodeHttpServerReq, res: NodeHttpServerResp) {\n        res.setHeader(\"Content-Type\",\"text/plain\");\n        res.writeHead(200);\n        res.end('Hello World\\n');\n        throw \"test\";\n    }\n\n    public static function main() {\n        try {\n            var server = Node.http.createServer(handleRequest);\n            server.listen(1337,\"localhost\");\n        } catch(e: String) {\n            trace(\"haha: \" + e);\n        }\n\n        trace( 'Server running at http://127.0.0.1:1337/' );\n    }\n}\n</code></pre>\n\n<p>I know why the exception is not get catched. The question is what is best practice for handling exceptions in HaXe.</p>\n"},{"tags":["node.js","long-polling","polling"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12946381,"title":"Node.js options to push updates to some microcontrollers that have an HTTP 1.1 stack","body":"<p>The title pretty well says it.\nI need the microcontrollers to stay connected to the server to receive updates within a couple of seconds and I'm not quite sure how to do this.\nThe client in this case is very limited to say the least and it seems like all the solutions I've found for polling or something like socket.io require dropping some significant JavaScript to the client.\nIf I'm left having to reimplement one of those libraries in C on the micro I could definitely use some pointers on the leanest way to handle it.</p>\n\n<p>I can't just pound the server with constant requests because this is going to increase to a fair number of connected micros.</p>\n"},{"tags":["node.js","redis","socket.io","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12886843,"title":"socket.io + redis - ghost sockets - is it possible?","body":"<p>I've made an app with node.js, socket.io, clusters, redis and it run in 8 processes.\nIs it possible that each process has a some ghost-sockets? I mean sockets which has already disconnected but not every process knows about it and still has them.</p>\n\n<p>My app send to client an online count(socket count from two rooms) in connection event. And process called \"HEAD\" send every 3 sec, to all sockets \"online count\" too. Why Am I telling it? When I connect to app in browser first get \"online count\" from one of 8 processes, let it be 60, and after 3 sec, i get from HEAD process \"online count\" but then it is very different number.</p>\n\n<p>So I think some things aren't sync through Redis to processes. Is it possible?</p>\n"},{"tags":["javascript","node.js","oauth","coffeescript","twitter-oauth"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":916,"score":1,"question_id":7313122,"title":"How do I setup Twitter OAuth on Node.js?","body":"<p>I am trying to authenticate to Twitter using the access token and secret from my account, and I don't know how to do what I thought I was doing. I am using node-oauth, but I am open to other solutions.</p>\n\n<p>PS: This is an app w/o a frontend. It is pretty much a twitter bot (don't worry, not a spammer). What I need to be able to do is access the Streaming API, which I need to POST after authenticating. IDK how to use basic auth, but if that would be easier, let me know.</p>\n"},{"tags":["node.js","mongodb","node-mongodb-native"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12892146,"title":"Confused about node-mongodb-native syntax","body":"<p>I'm just getting into node and mongodb and came across the first obstacle.</p>\n\n<p>I'm walking through a tutorial where the code looks something like this:</p>\n\n<pre><code>var db = new mongo.Db(\"database\", new mongo.Server(host, port, {}));\ndb.open(function(error){\n  db.collection(\"user\", function(err, collection){\n    collection.find({\"id\":\"1\"}, function(error, cursor){\n      cursor.toArray(function(err, users){\n        if(users.length == 0){\n          console.log(\"no such user\");\n        } else if {\n          console.log(\"user found: \", users[0]);\n        }\n     });\n   });\n });\n</code></pre>\n\n<p>However the code failed to work saying that <strong>users</strong> is null. (I do have a code where it inserts entries) Anyway, while trying to figure out what's going on, I've come across the documentation where it uses a synchronous pattern for <strong>find</strong> instead of using callback to retrieve cursor. The code goes something like this:</p>\n\n<pre><code>var cursor = collection.find({\"id\":\"1\"});\n</code></pre>\n\n<p>In fact, I cannot find anywhere in the documentation where it mentions a usage of <strong>find</strong> with a callback that returns a cursor. I am really confused. Is the tutorial outdated? And what is wrong with this code?</p>\n"},{"tags":["node.js","websocket"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":34,"score":-1,"question_id":12966854,"title":"How to detect if the websocket connection is still opened in Node?","body":"<p>I tried to send message to the browser via websocket as the time mark(<code>time</code>) was modified by another callback function. And I used the <code>ws</code> module:</p>\n\n<pre><code>  record = time\n  me = repeat 100, -&gt;\n    if time isnt record\n      show ws\n      ws.send 'reload'\n  ws.on 'close', -&gt;\n    clearInterval me\n</code></pre>\n\n<p>I planed to clear that interval as the connection being closed.\nBut I got this error:</p>\n\n<pre><code>Error: not opened\n    at WebSocket.send (/opt/app/doodle/node_modules/ws/lib/WebSocket.js:175:16)\n    at Timer.&lt;anonymous&gt; (/opt/app/doodle/lib/doodle-server.js:43:19)\n    at Timer.exports.setInterval.timer.ontimeout (timers.js:234:14)\n</code></pre>\n\n<p>So I want to detect if the connection is still on. But how to write that?</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12965672,"title":"Wait until foreach finishes","body":"<p>Currently I am using node-mysql (https://github.com/felixge/node-mysql) and for each result it returns from the database I have to perform several functions. Currently, it attempts to complete everything at once, however is there anyway to make it wait until each function is complete before moving to the next result from mysql? </p>\n\n<pre><code>connection.query('select * from data', function(err, rows) {\nfor (var i = 0; i &lt; rows.length; i++) {\n     doThis(rows[i].axn, rows[i].dnq, rows[i].bgq);\n }\n});\n</code></pre>\n\n<p>In the doThis function, if certain requirements are met than it passes the data to another function. How can I make sure that those are completed <em>first</em> before moving until the next query row?</p>\n\n<p>Thank you in advance! </p>\n"},{"tags":["node.js","express"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":47,"score":0,"question_id":12963423,"title":"What is the best cloud platform for a node.js/express application?","body":"<p>I have looked at Heroku, AWS, Azure, and Nodejitsu and am extremely undecided. I worked with AWS and ruby on rails before and really appreciated their support for it using the \"aws-sdk gem\". Unfortunately I have not found a similar sdk existing for Node.js and Express. Also, I am looking for an inexpensive solution with the utmost performance. Please help...</p>\n"},{"tags":["node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12905094,"title":"Complete chat solution in NodeJs","body":"<p>I don't know if it is the right place to answer this, but is there any cometchat-like solution for Node ?</p>\n\n<p>(But perhaps I should migrate the question to meta?)</p>\n"},{"tags":["node.js","https","webstorm"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12964517,"title":"how to log OUTGOING https requests from node within webstorm","body":"<p>I'm hacking together some node.js code that calls an external webservice and I'm getting bad results.  I'd like to log the raw request and response so that I can inspect it.</p>\n\n<p>Here's the thing:  <strong>I'm not consuming the http library directly</strong>, I'm consuming it through an OAuth library.  </p>\n\n<p>I'm already adding debug statements in the oauth library code and I don't like it.  Now it looks like I'm going to have to go into http library and start messing with that?  This can't be correct.</p>\n\n<p>If I was on windows, I'd fire up fiddler.  A friend mentioned wireshark but wireshark tells me I have to install X11.  Really?  I'm not going down that rabbit hole.</p>\n\n<p>Then I tried node-inspector, but I think that is for server code not client code.  It says your suppose to start your node process before attaching.  Well my node process is a test case (vows) that ends shortly after is starts... so no luck there.</p>\n\n<p>I guess this would difficult with any stack but jeez, it makes me miss .net!</p>\n\n<p>So, how can I inspect what's going over the wire when using node.js as client to external webservice on mountain lion?</p>\n\n<p>thanks!\nDan</p>\n"},{"tags":["process","background","node.js","daemon"],"answer_count":7,"favorite_count":26,"up_vote_count":30,"down_vote_count":0,"view_count":18442,"score":30,"question_id":4018154,"title":"Node.js as a background service","body":"<p>I want my node.js server to run in the background, ie: when I close my terminal I want my server to keep running. I've googled this and came up with <a href=\"http://kevin.vanzonneveld.net/techblog/article/run_nodejs_as_a_service_on_ubuntu_karmic/\" rel=\"nofollow\">this tut</a>, however it doesn't work as intended. So instead of using that daemon script, I thought I just used the output redirection (the <code>2&gt;&amp;1 &gt;&gt; file</code> part), but this too does not exit (I get a blank line in my terminal, like it's waiting for output/errors).</p>\n\n<p>I've also tried to put the process in the background, but as soon as I close my terminal the process is killed as well.</p>\n\n<p>So how can I leave it running when I shut down my computer?</p>\n"},{"tags":["node.js","npm"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":12959215,"title":"Cannot make npm install -g work for my package","body":"<p>I am trying to add CLI functionality to my npm package intercept-proxy. I couldn't find any good documentation so I basically copied and modified stuff from express.js.</p>\n\n<p>I added:</p>\n\n<pre><code>\"bin\": {\n    \"intercept-proxy\": \"./bin/intercept-proxy\"\n}\n</code></pre>\n\n<p>...to my package.json file and created a /bin/intercept-proxy.js which contains the CLI stuff.</p>\n\n<p>When I run:</p>\n\n<pre><code>npm install -g intercept-proxy\n</code></pre>\n\n<p>... everything works until the linking part. Then it fails, saying:</p>\n\n<pre><code>npm ERR! Error: ENOENT, chmod 'C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules\\intercept-proxy\\bin\\intercept-proxy\n</code></pre>\n\n<p>... and the log says:</p>\n\n<pre><code>381 info linkStuff intercept-proxy@0.2.4\n382 verbose linkBins intercept-proxy@0.2.4\n383 verbose link bins [ { 'intercept-proxy': './bin/intercept-proxy' },\n383 verbose link bins   'C:\\\\Users\\\\johan.obrink.24HRCOM\\\\AppData\\\\Roaming\\\\npm',\n383 verbose link bins   true ]\n384 verbose linkMans intercept-proxy@0.2.4\n385 verbose rebuildBundles intercept-proxy@0.2.4\n386 verbose rebuildBundles [ 'commander', 'mkdirp', 'underscore' ]\n387 info C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules\\intercept-proxy unbuild\n388 verbose from cache C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules\\intercept-proxy\\package.json\n389 info preuninstall intercept-proxy@0.2.4\n390 info uninstall intercept-proxy@0.2.4\n391 verbose true,C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules,C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules unbuild intercept-proxy@0.2.4\n392 verbose C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm,[object Object] binRoot\n393 info postuninstall intercept-proxy@0.2.4\n394 error Error: ENOENT, chmod 'C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules\\intercept-proxy\\bin\\intercept-proxy'\n395 error If you need help, you may report this log at:\n395 error     &lt;http://github.com/isaacs/npm/issues&gt;\n395 error or email it to:\n395 error     &lt;npm-@googlegroups.com&gt;\n396 error System Windows_NT 6.1.7601\n397 error command \"c:\\\\Program Files\\\\nodejs\\\\node.exe\" \"c:\\\\Program Files\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\" \"install\" \"-g\" \"intercept-proxy\"\n398 error cwd c:\\src\n399 error node -v v0.8.9\n400 error npm -v 1.1.61\n401 error path C:\\Users\\johan.obrink.24HRCOM\\AppData\\Roaming\\npm\\node_modules\\intercept-proxy\\bin\\intercept-proxy\n402 error code ENOENT\n403 error errno 34\n404 verbose exit [ 34, true ]\n</code></pre>\n\n<p>I tried googling ENOENT, chown + Windows but don't seem to get any further.</p>\n\n<p>The full code is up at <a href=\"https://github.com/JohanObrink/intercept-proxy\" rel=\"nofollow\">https://github.com/JohanObrink/intercept-proxy</a></p>\n\n<p>Edit: I have now tried it on OS X and the problem is the same. Not windows related - just me-being-a-n00b related apparently. Still cannot find what's wrong though.</p>\n"},{"tags":["php","image","node.js","nginx","phantomjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12963496,"title":"Simple example on how to render a webpage to an Image on the server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/757675/website-screenshots-using-php\">Website screenshots using PHP</a>  </p>\n</blockquote>\n\n\n\n<p>I cannot seem to find a simple example of how to render a webpage to an image via a web server. </p>\n\n<p>Right now I have a backend running Nginx and serving a PHP app, I also have a reverse Proxy serving Node on the same backend. </p>\n\n<p>What I need to achieve is an API to which I can hand a URL and have it rendered as a PNG then stock somewhere on the hard drive. (If this whole process could be asynchronous that would be perfect.)</p>\n\n<p>What would be the best approach to achieve this?</p>\n"},{"tags":["javascript","node.js","rest","request","express"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12962097,"title":"Use Express JS .all() method: detect which VERB was actually used","body":"<p>I'm going to create an <code>/api</code> endpoint blindly proxying requests and responses back and forth to the legacy RESTful API system (written in Ruby and hosted on a different domain).</p>\n\n<p>This an intermediary transitional step, so that should just work.</p>\n\n<p>So, I see how that can be easily achieved with <code>app.all()</code>. But as the API is RESTful I do also have to maintain the HTTP verb used for the request - so, can I detect it from the <code>req</code> object? If not, of course I can subscribe 5 handlers for GET, PUT, POST, DELETE, OPTIONS, but it will be much better to avoid this.</p>\n\n<p>Also, how should I deal with the request body (query string and payload)?\nI assume I'll need to manually recreate the query string from the parsed <code>req.query</code> and pass <code>req.body</code> to <code>request</code> <a href=\"https://github.com/mikeal/request\" rel=\"nofollow\">https://github.com/mikeal/request</a> as is - is it right?</p>\n"},{"tags":["node.js","express","connect"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":12963176,"title":"How do I write to the Node.js Connect/Express logger?","body":"<p>I have an Express project and I have it set up to log to a file:</p>\n\n<pre><code>logPath = '/mnt/log/api.log'\nlogfile = fs.createWriteStream logPath, {flags: 'a'} \n\nloggingOptions = \n  format: 'default'\n  stream: logfile\n\napp.use express.logger(loggingOptions)\n</code></pre>\n\n<p>This works for logging requests, but I want to add my own messages to the log, but I can't figure out how. <code>console.log</code> isn't redirected, and there doesn't seem to be a \"logger\" object created that I can write to.</p>\n\n<p>So is my only option to pass around a reference to the file stream and write to that?</p>\n"},{"tags":["node.js","http-headers","express","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12959570,"title":"Is ExpressJS using invalid set-cookie headers?","body":"<p>I'm using the ExpressJS res.cookie function to add cookies to the header\n<code>res.cookie('mycookie', x, y);</code></p>\n\n<p>But digging into ExpressJS and Connect I found that the joins used to string parameters together for the cookie function doesnt append a trailing semicolon</p>\n\n<p>express/res.js</p>\n\n<pre><code>res.cookie = function(name, val, options){\n  options = options || {};\n  if ('maxAge' in options) options.expires = new Date(Date.now() + options.maxAge);\n  if (undefined === options.path) options.path = this.app.set('basepath');\n  var cookie = utils.serializeCookie(name, val, options);\n  this.header('Set-Cookie', cookie);\n};\n</code></pre>\n\n<p>connect/utils.js</p>\n\n<pre><code>exports.serializeCookie = function(name, val, obj){\n  var pairs = [name + '=' + encodeURIComponent(val)]\n    , obj = obj || {};\n\n  if (obj.domain) pairs.push('domain=' + obj.domain);\n  if (obj.path) pairs.push('path=' + obj.path);\n  if (obj.expires) pairs.push('expires=' + obj.expires.toUTCString());\n  if (obj.httpOnly) pairs.push('httpOnly');\n  if (obj.secure) pairs.push('secure');\n  //this doesnt append semi colon\n  return pairs.join('; ');\n};\n</code></pre>\n\n<p>Then I looked up the spec for Set-Cookie header ( <a href=\"http://www.ietf.org/rfc/rfc2109.txt\" rel=\"nofollow\">http://www.ietf.org/rfc/rfc2109.txt</a> )</p>\n\n<p>The syntax for the Set-Cookie response header is</p>\n\n<pre><code>   set-cookie      =       \"Set-Cookie:\" cookies\n   cookies         =       1#cookie\n   cookie          =       NAME \"=\" VALUE *(\";\" cookie-av)\n   NAME            =       attr\n   VALUE           =       value\n   cookie-av       =       \"Comment\" \"=\" value\n                   |       \"Domain\" \"=\" value\n                   |       \"Max-Age\" \"=\" value\n                   |       \"Path\" \"=\" value\n                   |       \"Secure\"\n                   |       \"Version\" \"=\" 1*DIGIT\n</code></pre>\n\n<p>The language structure seems to imply that there should be a trailing semi-colon.</p>\n\n<p>I just wanted to be clear on this because some parsers I have running against cookies Ive set using res.cookie() are returning 'invalid Set-Cookie header' errors.</p>\n\n<p>Is ExpressJS setting invalid Set-Cookie headers via Connect.js ?</p>\n"},{"tags":["web-services","api","node.js","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12958071,"title":"What's the best way to process array of JSON messages posted to Nodejs server?","body":"<p>A client sends an array of JSON messages to be stored at Nodejs server; but client will require some sort of acknowledgement for each message (through unique id), that it was properly stored at server, and hence doesn't need to be sent again. </p>\n\n<p>At server I want to parse the JSON array, then loop through it, store each message in db, store response for this message in JSON array named responses, and finally send this responses array to the client. But as the db operations are async, all other code is executed before any result returned from db storing methods. My question is how to keep updating the responses array, untill all db operations are complete? </p>\n\n<pre><code>var message = require('./models/message');\nvar async = require('async');\n\nvar VALID_MESSAGE = 200;\nvar INVALID_MESSAGE = 400;\nvar SERVER_ERROR = 500;\n\nfunction processMessage(passedMessage, callback) { \nvar msg = null;\nvar err = null;  \nvar responses = [];\n\nisValidMessage(passedMessage, function(err, result) {\nif(err) {\n  callback( createResponse(INVALID_MESSAGE, 0) );\n}else{ \n var keys = Object.keys(result);\nfor(var i=0, len = keys.length; i&lt;len; i++) {\nasync.waterfall([     \n  //store valid json message(s)\n  function storeMessage(callback) {   \n    (function(oneMessage) {\n      message.processMessage(result[i], function(res) {\n        callback(res, result[i].mid, callback);  \n      });\n    })(result[i]);\n    console.log('callback returns from storeMessage()');\n  },\n\n  //create a json response to send back to client\n  function createResponse(responseCode, mid, callback) {\n    var status = \"\";\n    var msg = \"\";\n\n    switch(responseCode) {\n    case VALID_MESSAGE: { \n      status = \"pass\";\n      msg = \"Message stored successfuly.\";\n      break;\n    }\n    case INVALID_MESSAGE: {\n      status = \"fail\";\n      msg = \"Message invalid, please send again with correct data.\";\n      break;\n    }\n    case SERVER_ERROR: {\n      status = \"fail\";\n      msg = \"Internal Server Error! please contact the administrator.\";\n      break;\n    }\n    default: {\n\n      responseCode = SERVER_ERROR;\n      status = \"fail\";\n      msg = \"Internal Server Error! please contact the administrator.\";\n      break;\n    }\n  }\n  var response = { \"mid\": mid, \"status\": status, \"message\": msg, \"code\": responseCode};   \n  callback(null, response );   \n  }                     \n],\n\nfunction(err, result) {\n  console.log('final callback in series: ', result);\n  responses.push(result);          \n});\n}//loop ends\n}//else ends\nconsole.log('now we can send response back to app as: ', responses);  \n});//isValid finishes\n}\n</code></pre>\n"},{"tags":["node.js","redis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12948313,"title":"redis shutdow with exitcode=1","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12957090/redis-client-closed-connection-error\">Redis ‘Client closed connection’ error</a>  </p>\n</blockquote>\n\n\n\n<p>I have just published my website, and I am using redis 2.4.5 64bit for storing my some keys, but have found the following error after 3-4 hours. After that I have to restart my server and site will run perfectly.\nI have got following errors in redis log file :</p>\n\n<p>Redis has been shutdown (exitCode=1); but we didn't ask it to shutdown. Check if the configuration file exists and is valid</p>\n\n<p>I have checked config file, it is proper and exist on that path where we have redis-server.exe</p>\n"},{"tags":["javascript","node.js","rendering","phantomjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12957239,"title":"Using the 'webpage' Phantom module in node.js","body":"<p>I am trying to wrap a PhantomJS script in a node.js process. The phantom script grabs a url from the arguments provided on the command line and outputs a pdf (much similar to the rasterize.js example included with the pahntom install).</p>\n\n<p>The phantom script I have works fine, it's just my employer wants a node script if possible. No problem, I can use the <a href=\"https://github.com/alexscheelmeyer/\" rel=\"nofollow\">node-phantom</a> node module to wrap it.</p>\n\n<p>But now I've hit a stumbling block, my phantom script has:</p>\n\n<pre><code>var page = require('webpage').create();\n</code></pre>\n\n<p>So, node.js is trying to find a module called 'webpage', the 'webpage' module is built into the phantom install so node can't find it. As far as I can tell, there is no npm module called 'webpage'.</p>\n\n<p>'webpage' is used like this:</p>\n\n<pre><code>page.open(address, function (status) {\n\n    if (status !== 'success') {\n\n        // --- Error opening the webpage ---\n        console.log('Unable to load the address!');\n\n    } else {\n\n        // --- Keep Looping Until Render Completes ---\n        window.setTimeout(function () {\n            page.render(output);\n            phantom.exit();\n        }, 200);\n    }\n});\n</code></pre>\n\n<p>where address is the url specified on the command line and output is another argument, the name and type of the file.</p>\n\n<p>Can anyone help me out? This is quite an abstract one so I'm not expecting much if I'm honest, worth a try though.</p>\n\n<p>Thanks.</p>\n\n<p>EDIT - Approx 2hrs later</p>\n\n<p>I now have this which throws out a PDF:</p>\n\n<pre><code>var phanty = require('node-phantom');\n\nvar system = require('system');\n\nphanty.create(function(err,phantom) {\n\n    //var page = require('webpage').create();\n\n    var address;\n    var output;\n    var size;\n\n    if (system.args.length &lt; 4 || system.args.length &gt; 6) {\n\n        // --- Bad Input ---\n\n        console.log('Wrong usage, you need to specify the BLAH BLAH BLAH');\n        phantom.exit(1);\n\n    } else {\n\n        phantom.createPage(function(err,page){\n\n            // --- Set Variables, Web Address, Output ---\n            address = system.args[2];\n            output = system.args[3];\n            page.viewportSize = { width: 600, height: 600 };\n\n\n            // --- Set Variables, Web Address ---\n            if (system.args.length &gt; 4 &amp;&amp; system.args[3].substr(-4) === \".pdf\") {\n\n                // --- PDF Specific ---\n                size = system.args[4].split('*');\n                page.paperSize = size.length === 2 ? { width: size[0], height: size[1], margin: '0px' }\n                                                   : { format: system.args[4], orientation: 'portrait', margin: '1cm' };\n            }\n\n            // --- Zoom Factor (Should Never Be Set) ---\n            if (system.args.length &gt; 5) {\n                page.zoomFactor = system.args[5];\n            } else {\n                page.zoomFactor = 1;\n            }\n\n            //----------------------------------------------------\n\n            page.open(address ,function(err,status){\n\n                if (status !== 'success') {\n\n                    // --- Error opening the webpage ---\n                    console.log('Unable to load the address!');\n\n                } else {\n\n                    // --- Keep Looping Until Render Completes ---\n                    process.nextTick(function () {\n                        page.render(output);\n                        phantom.exit();\n                    }, 200);\n                }\n\n            });\n\n        });\n    }\n});\n</code></pre>\n\n<p>But! It's not the right size! The page object created using the phantom 'webpage' create() function looks like this before it's passed the URL:</p>\n\n<p><img src=\"http://i.stack.imgur.com/LpSQB.png\" alt=\"phantom returned page\"></p>\n\n<p>Whereas mine in my node script, looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/jRFIJ.png\" alt=\"my page\"></p>\n\n<p>Is it possible to hard code the properties to achieve A4 formatting? What properties am I missing?</p>\n\n<p>I'm so close!</p>\n"},{"tags":["javascript","node.js","logging","asynchronous","parallel-processing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12959474,"title":"grouped logging of parallel executed functions in node?","body":"<p>in my node.js app I have alot of things that happen in parallel. Now, if I log from somewhere in my parallel execution, the msg gets outputtet one after each other, which makes sense since console.log was called in that order.</p>\n\n<p>I was wondering if there is a possibility/module that would order/group all console.logs of a parallel executing function so I can trace what happened more easily.</p>\n\n<p>I've checked out winston, bunyan and other logging utilities, but they don't seem to provide such a functionality. Any ideas or thoughts?</p>\n"},{"tags":["node.js","requirejs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12959559,"title":"Requirejs in Node","body":"<p>I am new to JavaScript, and am having trouble understanding what I need to do to use requirejs with nodejs.</p>\n\n<p>I'm sure I'm missing something simple, but I don't understand why the following code does not work.</p>\n\n<pre><code>var requirejs = require('requirejs');\n\nrequirejs.config({\nnodeRequire: require\n});\n\nrequirejs(['foo'],\nfunction (foo) {\n    console.log(foo);\n});\n</code></pre>\n\n<p>I have tried various things, including using requirejs(['./foo'].  I'm unable to get anything to work.</p>\n\n<p>I have a file foo.js in the same directory as the main file (the one with the above code).  I run the main file with node and foo is undefined.  From the examples given on requirejs.org it looks like I am doing it right, but I am certain I am misinterpreting something.</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["node.js","mongodb","typescript"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":184,"score":1,"question_id":12950716,"title":"Communicating with MongoDB from TypeScript using NodeJS","body":"<p>As far as I understand , one have to use async callbacks for all IO in NodeJS (?)</p>\n\n<p>I'm trying to wrap my head around <a href=\"http://typescript.codeplex.com/SourceControl/changeset/view/fe3bc0bfce1f#samples%2fimageboard%2fdb.ts\" rel=\"nofollow\">this example code</a> provied by Microsoft.</p>\n\n<p>They start with a db.open(function() {});\nThat is, no code is provided in the callback of \"open\"..</p>\n\n<p>So all code that interacts with the db object will execute before open has completed.\nHow can their sample work?</p>\n\n<p>For me in my own code to be able to write any data to the DB I have to provide the writing code as a callback to the db.open function.</p>\n\n<p>another weird problem when running my code, after the data is written, the nodejs server doesnt exit even though all user code have completed.\nWhy is that?</p>\n"},{"tags":["node.js","typescript"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":332,"score":1,"question_id":12958479,"title":"TypeScript module import in nodejs","body":"<p>What is best practice for importing modules in nodejs with typescript? I come from c# background so I want to do something like this</p>\n\n<p><strong>MyClass.ts</strong></p>\n\n<pre><code>module MyNamecpace {\n    export class MyClass {\n    }\n}\n</code></pre>\n\n<p><strong>app.ts</strong></p>\n\n<pre><code>// something like using MyNamespace\nnew MyNamespace.MyClass();\n</code></pre>\n\n<p>or</p>\n\n<p><strong>MyClass.ts</strong></p>\n\n<pre><code>export class MyClass {\n}\n</code></pre>\n\n<p><strong>app.ts</strong></p>\n\n<pre><code>import MyClass = module(\"MyClass\")\nnew MyClass();\n</code></pre>\n\n<p>I know I can do this and it will work, but then I have to think up for two names for each class</p>\n\n<pre><code>import MyClass2 = module(\"MyClass\")\nnew MyClass2.MyClass();\n</code></pre>\n\n<p>Point is separating classes to multiple .ts files (preferably one file per class). So question is, how is this done?</p>\n"},{"tags":["javascript","node.js","callback","coffeescript"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12947303,"title":"Node.js | loop over an array , make post calls and accumulate result in an array","body":"<p>I wish to make a call in Node.js somethine like this (i m using coffeescript for node.js)</p>\n\n<pre><code>test = [] //initially an empty array\nlist = []//an array with 10 json object\n\nfor li in list\n  get_data url , li, (err,data) -&gt; test.push data\n</code></pre>\n\n<p><strong>my get_data method look like</strong></p>\n\n<pre><code>get_data: (url, json_data, callback) -&gt;\n  throw \"JSON obj is required\" unless _.isObject(json_data) \n  post_callback = (error, response) -&gt;\n    if error\n      callback(error)\n    else\n      callback(undefined, response)\n    return\n  request.post {url: url, json: json_data}, post_callback\n  return\n</code></pre>\n\n<p><strong>problem is I am not able to collect the result from request.post into the 'test' array</strong>\nI Know I am doing something wrong in the for loop but not sure what</p>\n"},{"tags":["node.js","global-variables","require"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12957821,"title":"Global variable vs. require.cache in NodeJS","body":"<p>I know using the <code>global</code> variable is discouraged in node, but assuming I need to store some data globally, which is a worse approach:</p>\n\n<ol>\n<li>using <a href=\"http://nodejs.org/api/globals.html#globals_global\" rel=\"nofollow\">global</a></li>\n<li><p>Using the <a href=\"http://nodejs.org/api/globals.html#globals_require_cache\" rel=\"nofollow\">require cache</a> directly to store an object, i.e.</p>\n\n<p><code>require.cache[\"myGlobalVar\"] == {};</code></p></li>\n</ol>\n\n<p>I suspect that option 2 is worse because the require cache is intended to be used for modules.  </p>\n\n<p>More details:\nI thought about using require(\"myLibrary\").myGlobalVar but that would require having myLibrary accessible to all the files calling it, which might not be possible in practice. I'm making a code coverage tool so I can expect the user to install \"myLibrary\" in their dev/test modules, but not necessarily in their src node_modules directory, to which the instrumented code files would refer.</p>\n"},{"tags":["javascript","algorithm","node.js","optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12958712,"title":"Running out of memory using Node.js to optimise route pairings with mongodb database","body":"<p>Ive been trying to crack this for days, any help would be <strong>GREATLY</strong> appreciated.  Basically im trying to iterate through this array of destination pairings and see if the overall distance can be improved by recalculating the mileage on each \"inverted\" pair.  If the total mileage for the inverted pair is better than the original, I replace the original pairs with their inverted versions.  </p>\n\n<p>The Problem im finding is that I either run out of memory is I leave this process running, or the results aren't optimized in the way I expect ( i gain mileage).</p>\n\n<p>I appreciate, I'm being a little sketchy here but im not sure where im going wrong. To put it into a constructive question: Can anyone help create a function/algorithm in JavaScript that can iterate through an array of pairings and optimise the same? ...please?</p>\n\n<pre><code>var firstResult = [{\"from\":\"DE55 7RA\",\"to\":\"DE55 4XJ\",\"oNum\":\"3740003654\",\"dNum\":\"3650645273\",\"metres\":\"536\"},{\"from\":\"WF2 0XF\",\"to\":\"WF2 0XE\",\"oNum\":\"3740003632\",\"dNum\":\"3650645256\",\"metres\":\"304\"},{\"from\":\"WF9 2RH\",\"to\":\"WF9 3AP\",\"oNum\":\"3740003657\",\"dNum\":\"3650645279\",\"metres\":\"4132\"},{\"from\":\"LS10 1BG\",\"to\":\"LS9 8HY\",\"oNum\":\"3740003637\",\"dNum\":\"3650645266\",\"metres\":\"2941\"},{\"from\":\"WF10 5UA\",\"to\":\"WF8 4QD\",\"oNum\":\"3740003646\",\"dNum\":13,\"metres\":\"7248\"},{\"from\":\"HD2 1UA\",\"to\":\"WF15 6JL\",\"oNum\":\"3740003641\",\"dNum\":\"3650645270\",\"metres\":\"6745\"},{\"from\":\"HU14 3HJ\",\"to\":\"HU15 2PE\",\"oNum\":\"3740003640\",\"dNum\":\"3650645259\",\"metres\":\"13309\"},{\"from\":\"WF2 0XF\",\"to\":\"WF5 8NE\",\"oNum\":\"3740003631\",\"dNum\":\"3650645262\",\"metres\":\"9862\"},{\"from\":\"WF9 2XX\",\"to\":\"WF8 4QD\",\"oNum\":\"3740003656\",\"dNum\":83,\"metres\":\"13705\"},{\"from\":\"WF9 2XX\",\"to\":\"WF8 4QD\",\"oNum\":\"3740003647\",\"dNum\":67,\"metres\":\"13705\"},{\"from\":\"WF9 2XR\",\"to\":\"WF8 4QD\",\"oNum\":\"3740003636\",\"dNum\":59,\"metres\":\"13545\"},{\"from\":\"DN14 6XL\",\"to\":\"DN14 0SB\",\"oNum\":\"3740003642\",\"dNum\":\"3650645268\",\"metres\":\"20763\"},{\"from\":\"NG16 4HY\",\"to\":\"NG15 0DR\",\"oNum\":\"3740003635\",\"dNum\":\"3650645258\",\"metres\":\"13165\"},{\"from\":\"DN6 7FB\",\"to\":\"S73 0UN\",\"oNum\":\"3740003639\",\"dNum\":\"3650645255\",\"metres\":\"18835\"},{\"from\":\"LS25 6JH\",\"to\":\"WF6 1GX\",\"oNum\":\"3740003652\",\"dNum\":\"3650645253\",\"metres\":\"22861\"},{\"from\":\"DN3 3FF\",\"to\":\"DN9 1LB\",\"oNum\":\"3740003660\",\"dNum\":\"3650645264\",\"metres\":\"21343\"},{\"from\":\"DN6 7FB\",\"to\":\"S71 3HQ\",\"oNum\":\"3740003638\",\"dNum\":\"3650645278\",\"metres\":\"19268\"},{\"from\":\"S43 4UX\",\"to\":\"S6 1LY\",\"oNum\":\"3740003633\",\"dNum\":\"3650645276\",\"metres\":\"30365\"},{\"from\":\"S43 4UX\",\"to\":\"S6 1LY\",\"oNum\":\"3740003651\",\"dNum\":\"3650645275\",\"metres\":\"30365\"},{\"from\":\"DN14 6XL\",\"to\":\"HU3 4UW\",\"oNum\":\"3740003667\",\"dNum\":\"3650645277\",\"metres\":\"41502\"},{\"from\":\"LS25 6JH\",\"to\":\"LS7 1PZ\",\"oNum\":\"3740003653\",\"dNum\":\"3650645274\",\"metres\":\"25194\"},{\"from\":\"LS25 6JH\",\"to\":\"BD4 0SG\",\"oNum\":\"3740003658\",\"dNum\":\"3650645269\",\"metres\":\"43788\"},{\"from\":\"DN14 6XL\",\"to\":\"HU7 0XS\",\"oNum\":\"3740003648\",\"dNum\":\"3650645265\",\"metres\":\"49066\"},{\"from\":\"NG90 1BS\",\"to\":\"DE6 1EX\",\"oNum\":\"3740003643\",\"dNum\":\"3650645261\",\"metres\":\"44283\"},{\"from\":\"S80 3YY\",\"to\":\"HD6 1LJ\",\"oNum\":\"3740003665\",\"dNum\":\"3650645260\",\"metres\":\"80026\"},{\"from\":\"S80 2RZ\",\"to\":\"BD8 9HQ\",\"oNum\":\"3740003634\",\"dNum\":\"3650645263\",\"metres\":\"95649\"},{\"from\":\"NG90 1BS\",\"to\":\"HU7 0YW\",\"oNum\":\"3740003650\",\"dNum\":\"3650645272\",\"metres\":\"156190\"},{\"from\":\"NG90 1BS\",\"to\":\"HU12 8TB\",\"oNum\":\"3740003644\",\"dNum\":\"3650645267\",\"metres\":\"160285\"},{\"from\":\"NG90 1BS\",\"to\":\"YO17 6YA\",\"oNum\":\"3740003645\",\"dNum\":\"3650645257\",\"metres\":\"172388\"},{\"from\":\"NG90 1BS\",\"to\":\"YO17 9HG\",\"oNum\":\"3740003649\",\"dNum\":\"3650645271\",\"metres\":\"176868\"}],\n    fs = require('fs'),\n    _ = require('underscore'),\n    mongoose = require('mongoose'),\n    Schema = mongoose.Schema,\n    logPostals = fs.createWriteStream('postals.txt', {'flags' : 'w'}),\n    db = mongoose.connect('mongodb://localhost/legs');\n\nvar Leg = new Schema({\n      from: {\n        type: String,\n        validate: /^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$/i,\n        trim: true\n      },\n      to: {\n        type: String,\n        validate: /^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$/i,\n        trim: true\n      },\n\n      time: Number,\n      distance: Number\n    })\n\nvar legModel = mongoose.model('Leg', Leg);\n\nvar legIndex = 0, armIndex= 0 , inverted = 0, original = 0;\nvar goCompare = function(){\n   _.each(firstResult , function(leg){\n     _.each(firstResult , function(arm){\n      if(leg.from !== arm.from){\n              legModel.find({\n              from: leg.from,\n              to: arm.to\n            }, function(err, data) {      \n              if (data.length &gt; 0) {\n                legModel.find({\n                  from: arm.from,\n                  to : leg.to\n                },function(e,d){\n                   inverted = data[0].distance +  d[0].distance;\n                   original = (leg.metres*1) + (arm.metres*1) ;\n                   if( original  &gt;  inverted ){\n                   legIndex = firstResult.indexOf(leg);\n                   armIndex = firstResult.indexOf(arm);\n\n                  firstResult[legIndex] ={\n                    from : leg.from,\n                    to : arm.to,\n                    metres : data[0].distance,\n                    oNum : leg.oNum,\n                    dNum : arm.dNum\n                   };\n                   firstResult[armIndex] = {\n                    from : arm.from,\n                    to : leg.to,\n                    metres : d[0].distance,\n                    oNum : arm.oNum,\n                    dNum : leg.dNum\n                   };\n\n                   _.each(firstResult , function( item ){\n                      logPostals.write(item.from +'\\t'+ item.to +'\\t'+item.metres +'\\r\\n')\n                   })\n\n                  goCompare();\n                 }else{\n\n                 }//end of if distance comparison\n                })//end of function callback from search\n              }//end of if data...\n            }//end of err...data\n        )//end of find\n      }\n    })\n  })\n}//end of go compare###############\ngoCompare();\n</code></pre>\n"},{"tags":["node.js","express","jade"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12734850,"title":"Access current request in Express/Jade view","body":"<p>I have a layout Jade view that has a menu via unordered list, and I want to set the <code>&lt;li&gt;</code> to be <code>&lt;li class=\"active\"&gt;...&lt;/li&gt;</code> when the current page is rendered in the browser.</p>\n\n<p>I assume I will have to access the current request to determine when to set the attribute on the <code>&lt;li&gt;</code></p>\n\n<p>I can't find any examples of how to do this so hoping someone can help</p>\n\n<p>Thanks</p>\n"},{"tags":["string","node.js","sockets","buffer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12956853,"title":"how to concatenate buffer.toString() output with another string in Node.js","body":"<p>I'm using a simple socket script to establish an rcon connection to my Battlefield heroes server. I need to grab the seed from the returned data then concatenate it with the password to use in creating the login hash I need. But the strings won't concatenate with the normal string methods. If I output the strings separately they display fine, but they simply won't combine so I can hash them.</p>\n\n<pre><code>var net = require('net');\nvar crypto = require('crypto');\nvar md5sum = crypto.createHash('md5');\n\nvar HOST = '&lt;ip address&gt;', PORT = &lt;port&gt;,\nPASSWORD = '&lt;password&gt;';\nvar client = new net.Socket();\nclient.connect(PORT, HOST, function() {\n    console.log('CONNECTED TO: ' + HOST + ':' + PORT);\n});\n\nclient.on('data', function(data) {\n    console.log(data.toString());\n    response = data.toString();\n    if (data.toString().slice(0,10) == \"### Digest\") {\n        var seed = response.slice(17); \n        auth = seed.concat(PASSWORD);\n        console.log('auth: '+auth);\n        hash = require('crypto').createHash('md5').update(auth).digest(\"hex\");\n        console.log(hash);\n        //client.write('login '+hash+' \\n');\n    }\n    //client.destroy();\n});\n\nclient.on('close', function() {\n    //do something on close\n});\n\nclient.on('error', function(err) {\n    console.log(err);\n});\n</code></pre>\n"},{"tags":["javascript","css","node.js","svg","less"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12958042,"title":"Javascript in LESS appears hobbled: workaround?","body":"<p>I am finding that LESS has a hobbled JavaScript evaluator, at least the way I am using it, which is to compile *.less files into *.css on a client before uploading them to the web server.</p>\n\n<p>I'm aware that compilation may be more often done server-side, but for performance &amp; simplicity we only want CSS files on the server.  I'm compiling the LESS files on Fedora Linux with the <code>lessc</code> ruby gem installed into Node Package Manager as in <a href=\"http://lists.fedoraproject.org/pipermail/devel/2012-February/163070.html\" rel=\"nofollow\">these instructions</a>.</p>\n\n<p>The compiler is working perfectly, but as far as I can tell the JavaScript expression evaluation is sorely limited.  I believe this also applies to server-side JavaScript expression evaluation based on <a href=\"http://stackoverflow.com/questions/9254549/is-javascript-evaluation-working-in-less-leaner-css\">this posting</a> which suggests uncertainty about how the JavaScript engine is plugged into the LESS environment.</p>\n\n<p>All I can use are simple, comma-separated expressions, like the following:</p>\n\n<pre><code>@bar: `\n\"ignored-string-expression\"\n,\n5\n`;\ndiv.test-thing { content: ~\"@{bar}\"; }\n</code></pre>\n\n<p>which compiles into:</p>\n\n<pre><code>div.test-thing {\n  content: 5;\n}\n</code></pre>\n\n<p>When I try to define a function, the compiler barfs (whether or not the semicolon in the expression is backslash-escaped):</p>\n\n<pre><code>[719] anjaneya% cat testfunc.less\n@bar: `function foo() {return 5}; foo()`;\ndiv.test-thing { content: ~\"@{bar}\"; }\n\n[720] anjaneya% lessc testfunc.less\nSyntaxError: JavaScript evaluation error: `function foo() {return 5}; foo()` ...\n</code></pre>\n\n<p>There also doesn't seem to be any way of looping, even if you try to trick it into evaluating a loop as you would the \"ignored-string-expression\" above, like:</p>\n\n<pre><code>@foo: `x = 0,\nfor (var n = 0; n &lt;= 10; n++) { x++; },\nx\n`;\ndiv.test-thing { content: ~\"@{bar}\"; }\n</code></pre>\n\n<p>which says:</p>\n\n<pre><code>ParseError: Syntax Error on line 1 ...\n</code></pre>\n\n<p><em><strong>Why bother?</em></strong>  To be able to compile this LESS:</p>\n\n<pre><code>@svgSource: '&lt;svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\"&gt;&lt;linearGradient id=\"g\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"&gt;&lt;stop offset=\"0\" stop-color=\"@{start}\" /&gt;&lt;stop offset=\"1\" stop-color=\"@{end}\" /&gt;&lt;/linearGradient&gt;&lt;rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#g)\" /&gt;&lt;/svg&gt;';\n</code></pre>\n\n<p>into this CSS:</p>\n\n<pre><code>background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxsaW5lYXJHcmFkaWVudCBpZD0iZyIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iIzU3OWRkYiIgLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMwMDAwMjIiIC8+PC9saW5lYXJHcmFkaWVudD48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2cpIiAvPjwvc3ZnPg==);\n</code></pre>\n\n<p>using a <a href=\"http://www.webtoolkit.info/javascript-base64.html\" rel=\"nofollow\">program like this</a>, whether the algorithm is implemented in JavaScript, PHP, Perl, UNIX shell, or anything else.  This processing might be done without function definitions but not without looping, and without functions you can't even have recursion.</p>\n\n<p>Given that both functions and looping are compound statements that probably aren't evaluated as expressions (it's not LISP), that is probably the basis for the failure...  it's not really a full JavaScript interpreter.  So I'm hoping someone who really knows the LESS compiler will:</p>\n\n<ul>\n<li>clarify the limitation above, so I can use JavaScript &amp; LESS portably for this task</li>\n<li>say how this problem can be worked around (e.g., with a \"shell escape\" or any evaluation environment that can process strings iteratively) and/or</li>\n<li>say how to extend the LESS compiler with such text processing capabilities, like a \"real\" JavaScript engine.</li>\n</ul>\n"},{"tags":["node.js","production"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12955597,"title":"Node.js - do I need to reinstall all the modules on the production server when deploying the Node.js app","body":"<p>I have developed my first Node.js pp. For now, it just sits on my laptop.</p>\n\n<p>During development I had to install some modules:</p>\n\n<pre><code>npm install socket.io\nnpm install mysql@2.0.0-alpha3\nnpm install iniparser\nnpm install js-yaml\nnpm install nodemailer\n</code></pre>\n\n<p>I have installed all of them \"per-project\", not globally.</p>\n\n<p>The directory of my project looks like this (my code is all in push_server.js):</p>\n\n<pre><code>|\n|--- push_server.js\n|\n|--- node_modules\n     |--- iniparser\n     |--- js-yaml\n     |--- mysql\n     |--- socket.io\n     |--- nodemailer\n</code></pre>\n\n<p>Now I want to push this project to the production server.</p>\n\n<p>My question is: can I upload the whole codebase (including installed modules) or should I upload just the code of my app and re-install the modules one-by-one on the server?</p>\n\n<p>Note: my dev machine runs Ubuntu 10.04, the production server runs CentOS 5.3</p>\n\n<p>I think all those modules are made up of js files only, therefore it should be allright.<br>\nHowever, is it possible that a module installed by npm compiles some code on the local machine, therefore that code is likely not to work on another machine. Also, how can I know whether a module does that?</p>\n\n<p>Hope the question is not too silly - I have just started with Node.js.</p>\n\n<p>Thanks.</p>\n"},{"tags":["mvc","node.js","express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12943553,"title":"What is the difference between a node.js express route and a controller?","body":"<p>Is there anything that is different or more powerful with a traditional controller over an express route?  </p>\n\n<p>If you have an express app and define models, does it become an MVC application, or is there more necessary?</p>\n\n<p>I'm just wondering if I'm missing out on extra/easier functionality in my node express apps by not upgrading to a more legitimate 'controller'.  If there is such a thing.</p>\n\n<p>Thanks!</p>\n\n<p>Edit:  To clarify, if you use a route like so:</p>\n\n<pre><code>// routes/index.js\nexports.module = function(req, res) {\n  // Get info from models here, \n  res.render('view', info: models);\n}\n</code></pre>\n\n<p>What makes it any different from a controller?  Is a controller able to do more?  </p>\n"},{"tags":["query","node.js","mongodb","date","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12855280,"title":"Querying by date, regardless time part","body":"<p>I want to show my blog posts, paginated by creation date. I will have a page for 5 posts written in 2012-10-01, a page for 11 posts written in 2012-10-03 and no page at all for 2012-10-02 (no posts written)</p>\n\n<p>Each post document is stored with a creation date which is a datetime value, here's a mongoose snippet:</p>\n\n<pre><code>var postSchema = new Schema({\n    url: String,\n    creationDate: {type: Date, default: Date.now},\n    contenuto: String,\n});\n</code></pre>\n\n<p>so it will have something like 2012-10-01 18:45:03... know what I mean.</p>\n\n<p>In my code, I will create a </p>\n\n<pre><code>var searchDate = new Date(yy,mm,dd);\n</code></pre>\n\n<p><strong>How can I use that for querying the posts collection, without considering the \"time part\" of creationDate?</strong></p>\n\n<p>I'm not sure this would always work:</p>\n\n<pre><code>Post.find({ creationDate:dataRicerca })\n</code></pre>\n"},{"tags":["node.js","redis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12957090,"title":"Redis 'Client closed connection' error","body":"<p>I just launched a site running on redis.</p>\n\n<p>After a few hours, redis stops working and I have to restart the server to get it working again.</p>\n\n<p>This is what the log shows:</p>\n\n<pre><code>[3336] 18 Oct 17:59:18 - DB 0: 1339 keys (1337 volatile) in 512 slots HT.\n[3336] 18 Oct 17:59:18 - 5 clients connected (0 slaves), 1903440 bytes in use\n[3336] 18 Oct 17:59:21 - Client closed connection\n[3336] 18 Oct 17:59:23 - DB 0: 1341 keys (1339 volatile) in 512 slots HT.\n[3336] 18 Oct 17:59:23 - 4 clients connected (0 slaves), 1896008 bytes in use\n</code></pre>\n\n<p>It stopped working exactly when the 'Client closed connection' showed up in the log.</p>\n\n<p>Any idea why that might be happening?</p>\n\n<p><strong>Update: It shut down again. This time I checked the memory and it was beyond 3.5 GB. Does that have anything to do with it?</strong></p>\n"},{"tags":["ios","node.js","encryption","cryptography","pkcs7"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12956995,"title":"PKCS#7 data payload unpacking with NodeJS?","body":"<p>I'm working on an MDM NodeJS server for iOS. On the Apple docs, the following ruby code is given :</p>\n\n<pre><code>  p7sign = OpenSSL::PKCS7::PKCS7.new(req.body)\n  store = OpenSSL::X509::Store.new\n  p7sign.verify(nil, store, nil, OpenSSL::PKCS7::NOVERIFY)\n  signers = p7sign.signers\n</code></pre>\n\n<p>What would be the equivalent in NodeJS?\nThe idea is to access <code>p7sign.data</code> that contains an xml plist.</p>\n\n<p>Is this possible using either <code>crypto</code> or an external node lib (<code>ursa</code>, etc)?</p>\n"},{"tags":["windows","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":779,"score":3,"question_id":7966992,"title":"Node.Js + Now.js on windows: cannot load module node-proxy","body":"<p>I am trying to create a chatclient for mobile devices using node.js and now.js. The problem is that the server must run on a windowsserver. Getting node.js working is not the problem. </p>\n\n<p>The problem is now.js. I have already installed node.js and the modules: now.js and it's dependencies socket.io, socket.io-client. But socket.io still needs the module node-proxy. And that wont work on windows because it has to be build after installing.</p>\n\n<p>Does anyone know how to get the module node-proxy for node.js working on windows? I have read something about building with cygwin but i dont have experience ( or knowledge) about cygwin.</p>\n"},{"tags":["javascript","node.js","memcached","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":12956669,"title":"How to get All memcached data in node.js?","body":"<p>First, my purpose is when the user close the browser then the user session data should expire. Now the problem is that, my Server requires memcached to work properly. So, I want to delete that specific user session from memcached who has closed his browser. I dont want to clear all memcached so that the remaining users' session should still exist.</p>\n"},{"tags":["node.js","neo4j","graph-databases"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":141,"score":2,"question_id":12936273,"title":"Where to use Neo4j","body":"<p>I'm actually trying to learn new things...</p>\n\n<p>I used SQL for a long time, using MySQL and recently discovered document-oriented databases.</p>\n\n<p>I came across graph-databases &amp; Neo4j and want to try it through NodeJS but I really don't get the point.</p>\n\n<p>Should I use Neo4j coupled with another DB? Like storing my data into MySQL &amp; relationships in Neo4j?</p>\n\n<p>Or may I use Neo4j to store data (like posts)?</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12955154,"title":"NodeJS read and parse each line of stdout","body":"<p>I have a NodeJS script that 'exec's a child process to capture cat dump of a file:</p>\n\n<pre><code>var exec = require('child_process').exec;\nvar result = '';\nvar child = exec('./scripts/first.sh',function(err, stdout, stderr) {\n    result = stdout.split(\"=\");\n});\n</code></pre>\n\n<p>If in case the file is not there I would take dump of a different file:</p>\n\n<pre><code>var result = '';\nvar child = exec('./scripts/first.sh',function(err, stdout, stderr) {\n    result = stdout.split(\"=\");\n    if(stdout.indexOf('No such file or directory') != -1){\n        var child = exec('./scripts/second.sh', function(err, stdout, stderr) {\n            result = stdout.split(\"=\");\n    });\n});\n</code></pre>\n\n<p>Finally I log the value of result variable:</p>\n\n<pre><code>console.log(result);\n</code></pre>\n\n<p>The files would have data like mentioned below:</p>\n\n<pre><code>line_1 = 7888\nline_2 = 8998\nline_3 = 9090\nline_4 = 9097\n</code></pre>\n\n<p>I need to parse and extract values of line_1 and line_3? </p>\n\n<p>The result variable does not shows any value. My idea was to get the stdout data in a string variable and use some search mechanism. </p>\n\n<p>Though I am not sure of the approach as I am not much experience on JS / NodeJS.</p>\n\n<p>==EDIT==</p>\n\n<p>Please find a replica of the function I have written.</p>\n\n<pre><code>var exec = require('child_process').exec;\n\nfunction getdetail() {\n        var result = '';\n        var child = exec('./scripts/first.sh', function(err, stdout, stderr) {\n                if(stdout.indexOf('No such file or directory') != -1){\n                        var child = exec('./scripts/second.sh',function(err, stdout, stderr) {\n                        result = stdout.toString().split(\"=\");\n                        console.log(result);\n                        });\n                }\n                else\n                {\n                        result = stdout.toString().split(\"=\");\n                        console.log(result);\n                }\n        });\n}\n</code></pre>\n\n<p>The tostring() on stdout stream object did the trick but I get console logs as mentioned below:</p>\n\n<pre><code>[ 'spawn ssh -o UserKnownHostsFile',\n  '/dev/null -o StrictHostKeyChecking',\n  'no user@www.mybox.com cat ver.txt\\r\\nWarning: Permanently added \\'www.mybox.com,XX.XX.XX.XX\\' (RSA) to the list of known hosts.\\r\\r\\nuser@www.mybox.com\\'s password: \\r\\line_1',\n  '9400\\r\\nline_2',\n  '3508\\r\\nline_3',\n  '77f3\\r\\nline_4',\n  '/tmp\\r\\nline_5',\n  '/tmp/ramdisk/\\r\\nline_5',\n  '77f3\\r\\n' ]\n</code></pre>\n\n<p>How can I extract value of line_1 and line_3?</p>\n"},{"tags":["django","node.js","internationalization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":226,"score":0,"question_id":8018678,"title":"node.js i18n like django","body":"<p>Any node.js module can generate i18n files like django does?</p>\n\n<p>I have check several node.js i18n module, it just do something ilke get/set things, but nothing about generate</p>\n"},{"tags":["javascript","node.js","internationalization","gettext","crowdsourcing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":391,"score":0,"question_id":8121575,"title":"JavaScript - po files and gettext() vs json and custom i18n library?","body":"<p>I need to develop or find some sort of lightweight gettext-like library in JavaScript for browser-side translations. (Preferably the same library could be used by node.js if I'd like to translate server-side instead).</p>\n\n<p><strong>1) But, what are really the pros and cons of using .po files and a JavaScript gettext library?</strong><br>\n(As opposed to JSON and jQuery Globalize or similar?)</p>\n\n<p><strong>2) And is there any workflow/service that'll allow crowdsourcing of translations that can be exported to a format (.po/json) that can be used by a JavaScript i18n library (gettext implementation, Globalize.js etc.)?</strong></p>\n"},{"tags":["javascript","node.js","canvas"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12946303,"title":"Is it possible to transform a regular Javascript library into a NodeJS library?","body":"<p>I've been working with a Javascript library, namely, <a href=\"http://sourceforge.net/projects/html-canvas-lib/\" rel=\"nofollow\">canvas-lib</a> and I'm using Node.JS/Socket.io on the server side so I can pass events between clients.</p>\n\n<p>I'm using an architecture in which only 1 client at a time is allowed control over the canvas since I'm making kind of a \"scratch\" game which is controlled by a mobile device and displayed on an second (bigger) screen.</p>\n\n<p>You can see a diagram of the architecture <a href=\"https://cacoo.com/diagrams/oVVGfA1pJK1ghNVM\" rel=\"nofollow\">here</a>.</p>\n\n<p>The thing is, currently the canvas interaction is done on the client side on a script for that effect which causes the some problems:</p>\n\n<ul>\n<li>There's no way of scaling the canvas</li>\n<li>There's not a unified time limit counter</li>\n<li>I have to manually load the page on the external screen</li>\n</ul>\n\n<p>My objectives are:</p>\n\n<ul>\n<li>To have the server pass the time to both devices (or screens)</li>\n<li>To have the canvas loaded on the mobile device and scaled to the external screen (on new connection, and done automatically once the mobile device is connected, or out of the queue and into current active)</li>\n</ul>\n\n<p>In order to achieve this, I believe I must get the canvas-lib to work on node, so how can I achieve this since the lib is not ready for that yet?\nHow can I turn a regular library into a Node library?</p>\n"},{"tags":["node.js","readxml"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12955783,"title":"Read write XML node values in \"NodeJs\"","body":"<p>Can anyone guide me with how to read/ write XML nodevalues parsed by xml2js.Parser() in 'NodeJS'? So far my code is as flows:</p>\n\n<pre><code>var parser = new xml2js.Parser();\nfs.readFile( './foo.xml', function(err, data) {\n    parser.parseString(data, function (err, result) {\n        console.dir(result);\n    });\n});\n</code></pre>\n\n<p>I want to read the values of <code>result</code> as follows</p>\n\n<pre><code>result.to\n</code></pre>\n\n<p>my XML:</p>\n\n<pre><code>&lt;note&gt;\n    &lt;to&gt;Tove&lt;/to&gt;\n    &lt;from&gt;Jani&lt;/from&gt;\n    &lt;heading&gt;Reminder&lt;/heading&gt;\n    &lt;body&gt;Don't forget me this weekend!&lt;/body&gt;\n&lt;/note&gt;\n</code></pre>\n"},{"tags":["python","node.js","ipc"],"answer_count":4,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":1823,"score":4,"question_id":10775351,"title":"Combining node.js and Python","body":"<p>Node.js is a perfect match for our web project, but there are few computational tasks for which we would prefer Python. We also already have a Python code for them.\nWe are highly concerned about speed, what is the most elegant way how to call a Python \"worker\" from node.js in an asynchronous non-blocking way?</p>\n"},{"tags":["node.js","mongodb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":151,"score":-3,"question_id":12065759,"title":"How do I use mongoexport and mongoimport?","body":"<p>I need to use mongoexport to store some documents and the mongoimport to put them on a remote server.  I've looked over the manual pages and looked around a little for some good examples, but I haven't seen anything specific enough yet.</p>\n\n<p>I have a bunch of documents of type \"Office\" in my database that I want to export, but I don't have a clue how to use mongoexport properly.  Any tips or links to good examples are greatly appreciated.  Thanks!</p>\n"},{"tags":["javascript","node.js","mongodb","mongoose"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12948511,"title":"Taking sum/average of columns in mongoosejs","body":"<p>I have a MongoDB collection \"Marks\" with fields student_id,Subject,Mark.\nI want to the average value of marks scored by a particular student.\nMy project is in NodeJs and I am using MongooseJS for object modeling.\nHow to query the this using MOngooseJS?</p>\n\n<p><strong>EXAMPLE</strong></p>\n\n<pre><code>     Student_id   Subject  Mark\n     111          AAA      9\n     111          BBB      5\n     111          CCC      7\n     222          AAA      10\n     222          CCC      6\n     222          BBB      8\n</code></pre>\n\n<p>I want average of marks scored by student(id) 111 i.e((9+5+7)/3)=7)</p>\n"},{"tags":["javascript","ruby-on-rails","node.js","expressjs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":12951247,"title":"nodejs & Expressjs documentation like railscast","body":"<p>I don't want turn this conversation to w one is best expressjs or rails.</p>\n\n<p>I am just curious how you people learn expressjs ??? I got really bad time learning it, cause its so new and changes alot, so old tutorials dont work w new expressjs versions and its really hard find and up to date example. Took me long time to create just a simple REST app on expressjs linked to mongoBD with user authentication.</p>\n\n<p>It's there a up-to-date site like railscasts that covers 'basic' features so you can learn expressjs basics ?? I know nodetuts was good but not updated atm.</p>\n"},{"tags":["javascript","json","node.js","express","google-api"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12945913,"title":"How do you make a request to google-api using node.js and Express? Getting Request is not defined Error","body":"<p>I am working on a node.js server and want to call the Google Shopping Service and retrieve results for a search query.  I think I am applying the search query string correctly, but I am getting a 500 Reference Error: Request is not defined.  My code is below:</p>\n\n<p>googleShoppingService.js</p>\n\n<pre><code>//Shopping Search Factory\n\nmodule.exports = function(productSearch){\n    return new productKey('---API-KEY-GOES-HERE---');\n};\n//constructor\n\nfunction productKey(key) {\n\n    this.key=key;\n}\n// Search API\n\nfunction toJSON(str){\n    var result;\n    try {\n        result=JSON.parse(str);\n    } catch(err){}\n    return result;\n }\n\nproductKey.prototype.search = function (req, done) {\n    request.get('https://www.googleapis.com/shopping/search/v1/public/products')\n        .send({key:this.key})\n        .send({country:'US'})\n        .send({q:req.body.searchQuery.value})\n        .end(function (err, res) {\n            var body = toJSON(res.text);\n            var result = body &amp;&amp; body.product || [];\n            return done(err, result);\n        });\n};\n</code></pre>\n\n<p>app.js</p>\n\n<pre><code>var productSearch = require('./apis/googleShoppingSearch.js');\nvar products = productSearch('---API-KEY-GOES-HERE---')\n\napp.get('/productResults', function(req, res){\n    products.search(process.argv[2], function (err, results) {\n        var returnedData = \"\"\n        for (var i=0;i &lt; results.length; i++) {\n            returnedData += (results[i].title + '&lt;br /&gt;')\n        }\n        res.send (returnedData)\n    });\n});\n</code></pre>\n\n<p>Any suggestions to solve my problem would be greatly appreciated.  Thanks for the help in advance.</p>\n"},{"tags":["unit-testing","node.js","gruntjs"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12952506,"title":"How do I run the GruntJS tests?","body":"<p>I just cloned the <a href=\"https://github.com/gruntjs\" rel=\"nofollow\">gruntjs repository</a>.</p>\n\n<p>How do I actually run the tests for GruntJS?</p>\n\n<p>(I don't mean I want to run my own tests using GruntJS. I mean that I want to run the tests for GruntJS itself.)</p>\n"},{"tags":["javascript","node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12953761,"title":"Javascript: new vs return object","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10079544/function-vs-object-literal-notaion-is-there-a-diifference\">Function vs. Object Literal Notaion - is there a diifference?</a>  </p>\n</blockquote>\n\n\n\n<p>I'm playing around in nodejs and I got to a place where I can do the same thing in two different ways.</p>\n\n<pre><code>var x = function(arr) {\n    this.get = function(index) {\n        return arr[index];\n    }\n}\nvar myVar = new x([1,2,3,4]);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var y = function(arr) {\n    return {\n        get: function(index) {\n            return arr[index];\n        }\n    }\n}\nvar myVar = y([1,2,3,4]);\n</code></pre>\n\n<p>There's obviously some difference between these two methods, my question is which?\nThanks</p>\n"},{"tags":["javascript","node.js","minify"],"answer_count":8,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":2659,"score":5,"question_id":6539837,"title":"Concat and minify JS files in Node","body":"<p>Is there any module in NodeJS to concatenate and minify JavaScript files?</p>\n"},{"tags":["node.js","railway.js"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":102,"score":-1,"question_id":12952085,"title":"RailwayJS tutorial?","body":"<p>We are going to develop a large application with node.js.\nTherefore we need a serverside MVC framework. RailwayJS looks promising, but we can't find a tutorial covering the basic usage of RailwayJS.</p>\n\n<p>Does anyone know a good tutorial to help us on the way learning RailwayJS?</p>\n"},{"tags":["c++","c","linux","node.js","process"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12945189,"title":"Make child process spawned with system() keep running after parent gets kill signals and exits","body":"<p>In a Linux/C++ library I'm launching a process via the system() call,</p>\n\n<pre><code>system(\"nohup processName &gt; /dev/null&amp;\");\n</code></pre>\n\n<p>This seems to work fine with a simple test application that exits on it's own, but if I use this from inside of a Nodejs/V8 extension which gets a kill signal, the child process gets killed. I did find that running,</p>\n\n<pre><code>system(\"sudo nohup processName &gt; /dev/null&amp;\");\n</code></pre>\n\n<p>With the sudoers file set up to not require a password manages to make this run even when the parent process (node) exits. Is there someway to entirely detach the child process so signals sent to the parent and the parent exiting have no effect on the child anymore? Preferably within the system() call and not something that requires getting the process ID and doing something with it.</p>\n"},{"tags":["node.js","mongodb","heroku","npm","bson"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12951292,"title":"Is it possible to make Heroku install the mongodb NPM package with the C++ BSON parser?","body":"<p>Locally, I can run <code>npm install --mongodb:native</code> to get npm to compile and install the C++ BSON parser, but I can't replicate the same action on Heroku.</p>\n\n<p>I tried adding a pre-install command <code>npm install mongodb --mongodb:native</code> to <code>package.json</code> but <code>npm</code> isn't actually available on the path in the Heroku environment.</p>\n\n<p>Looking at <a href=\"https://github.com/christkv/node-mongodb-native/blob/master/install.js\" rel=\"nofollow\">the source</a> for the mongodb package, it looks like it's looking for an environment variable (created by npm based on the command line argument I guess). Maybe there's a way of injecting that into the Heroku build environment?  </p>\n\n<p>BSON (de)serialisation is becoming a big CPU + memory hog for my app, and the C++ parser helps alleviate this.</p>\n"},{"tags":["node.js"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":12701259,"title":"How to make a node.js application run permanently?","body":"<p>On a Debian server, I installed Node.js.\nI understand how to launch an app from putty with this command line :\n <em>node /srv/www/MyUserAccount/server/server.js</em>\nand get to it on the address 50.51.52.53:8080 (IP and port).</p>\n\n<p>But as soon as I close putty, then I cannot reach the address 50.51.52.53:8080 anymore.</p>\n\n<p>How to make a node.js application run permanently ?</p>\n\n<p>As you can guess, I am a beginner with Linux and Node.js.\nThank you</p>\n"},{"tags":["javascript","node.js","callback"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12944022,"title":"I can't update an object property inside the callback of readFile() in Node.js","body":"<p>I have the next object in Node.js:</p>\n\n<pre><code>function myObject(){\n    this.allowed = false;\n    this.rawData;\n}\n\nmyObject.prototype.checkAccess = function(){\n\n    var self = this;\n\n    if (!this.allowed){\n        fs.readFile(\"./file.key\", function(err, data){\n            if (err) return;\n            self.rawData = data;\n            self.allowed = true;\n        })\n        return;\n    }\n\n    // several operations with rawData\n    // not intended to be called when file.key is read\n    // but next time checkAccess is called, by example\n    console.log(this.rawData);\n\n    // or, by example, use its content to decrypt \n    // another file or data from a socket...\n    var isCorrectlyDecrypted = this.decrypt(this.rawData);\n    if (!isCorrectlyDecrypted) this.allowed = false;\n}\n</code></pre>\n\n<p>I periodically call checkAccess with setInterval but what I found is that, existing file.key, I never have the rawData property updated, being always undefined, while allowed property updates sucessfully.</p>\n\n<p>Can someone, please, explain what's happening and tell me what I'm doing wrong and what's the best way of doing it?</p>\n\n<p>EDITED:</p>\n\n<p>So, as I said, in the code that uses this class I have:</p>\n\n<pre><code>var myObjectInstance = new myObject();\n\nsetInterval(function(){\n\n    // here some previous code\n\n    myObjectInstance.checkAccess();\n\n   // and here more code\n}, 25)\n</code></pre>\n\n<p>What <code>checkAccess()</code> does is to look periodically for a <code>file.key</code> to read if present, and then wait until the next call to work with its content. SO, <code>console.log()</code> is not intended to be used right after <code>file.key</code> is readed, BUT the next times <code>checkAccess()</code> is called and subsecuently. That's why <code>console.log()</code> is not placed inside the callback.</p>\n"},{"tags":["node.js","mongodb","asynchronous"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12948616,"title":"How to get rid of the asynchoronous code here","body":"<p>I have been trying to retrieve the data using the MongoJS driver for node.js.The Code which I am using is as follows</p>\n\n<pre><code>     req.on('end', function(){\n             var decodedBody = querystring.parse(fullBody);\n             story=decodedBody.name;\n             var z=new Array();\n             console.log(story);\n         res.writeHead(200,{'Content-Type': 'text/html'});\n         res.write('&lt;html&gt;&lt;body&gt;');\n             db.frames.find({str_id:story}).toArray(function(err,doc){\n             console.log(doc);\n             for(var t=0;t&lt;doc.length;t++)\n                 {\n                     var picid=doc[t].pic_id;\n                     console.log(picid);               \n                     db.pictures.find({_id:picid}).toArray(function(err,pic){\n                      res.write('&lt;img src=\"'+pic[0].name+'\"/&gt;');\n             });\n           } \n        }) \n        res.end('&lt;/body&gt;&lt;/html&gt;'); \n   });\n</code></pre>\n\n<p>The problem here is that because of the asynchronous nature of the code the response gets ends first and then the code inside the block of database gets executed and because of that nothing gets displayed on the browser i.e an image in this case .Thankx in advance.</p>\n"},{"tags":["node.js","qunit","vows","nodeunit","expresso"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12948581,"title":"How to create a data driven test in Node.js","body":"<p>In <code>Node.js</code> unit tests, what is the way to create data driven <code>unit tests</code>?</p>\n\n<p>For Example, I've a common <code>function / method</code>, which I want to re-use in multiple unit tests with different sets of data. I tried looking into <code>nodeunit, vows, whiskey, qunit, expresso</code>; But I wasn't able to figure out a way to achieve this functionality.</p>\n\n<p>I was not looking at calling the function literally in multiple tests, but rather use the common <code>method</code> in a loop to pick up the data in each iteration and execute it, as a <code>unittest</code></p>\n\n<p>The reason for this is, I've atleast 1000 rows of parameterized data, for which I want to write <code>unittest</code>. Obviously I cannot go on writing 1000 <code>unittests</code> physically.</p>\n\n<p>Anyone could you please point me a way to achieve the above.</p>\n"},{"tags":["javascript","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12948146,"title":"javascript self and arguments usage","body":"<p>im new to javascript. i have a simple question here.</p>\n\n<p>i see below code snipet:</p>\n\n<pre><code>var self = this;\n.....\nself.push = function () {\n    var args = [].concat.apply([], arguments);\n    args.forEach(self.write);\n    return self;\n};\n\nself.write is another function.\n</code></pre>\n\n<p>q1: why set self = this.</p>\n\n<p>q2: why we can not write the push function as simple as arguments.forEach(self.write);</p>\n"},{"tags":["node.js","install","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12926416,"title":"socket.io install errors","body":"<p>When I try to install socket.io, I'm getting a bunch of errors. I'm not sure what it means when it can't find the node path. The terminal output is below, and the npm-debug file is at: <a href=\"http://pastebin.com/B5TfUyWr\" rel=\"nofollow\">http://pastebin.com/B5TfUyWr</a>.  I've deleted the node-modules folder, and tried to reinstall socket.io. I've also tried to install globally, but that doesn't work, either. I'd appreciate any insight anybody might have.</p>\n\n<pre><code>$npm install socket.io\nnpm http GET https://registry.npmjs.org/socket.io\nnpm http 304 https://registry.npmjs.org/socket.io\nnpm http GET https://registry.npmjs.org/socket.io-client/0.9.10\nnpm http GET https://registry.npmjs.org/policyfile/0.0.4\nnpm http GET https://registry.npmjs.org/redis/0.7.2\nnpm http 304 https://registry.npmjs.org/redis/0.7.2\nnpm http 304 https://registry.npmjs.org/policyfile/0.0.4\nnpm http 304 https://registry.npmjs.org/socket.io-client/0.9.10\nnpm http GET https://registry.npmjs.org/hiredis\nnpm http 304 https://registry.npmjs.org/hiredis\nnpm WARN package.json hiredis@0.1.14 No README.md file found!\n\n&gt; hiredis@0.1.14 preinstall /media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis\n&gt; make || gmake\n\ncd deps/hiredis &amp;&amp; make static\nmake[1]: Entering directory `/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis/deps/hiredis'\nnpmcc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb net.c\n http GET https://registry.npmjs.org/uglify-js/1.2.5\nnpm http GET https://registry.npmjs.org/ws\nnpm http GET https://registry.npmjs.org/xmlhttprequest/1.4.2\nnpm http GET https://registry.npmjs.org/active-x-obfuscator/0.0.1\ncc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb hiredis.c\ncc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb sds.c\ncc -std=c99 -pedantic -c -O3 -fPIC  -Wall -W -Wstrict-prototypes -Wwrite-strings -g -ggdb async.c\nar rcs libhiredis.a net.o hiredis.o sds.o async.o\nmake[1]: Leaving directory `/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis/deps/hiredis'\nnode-waf configure build\nSetting srcdir to                        : /media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis \nSetting blddir to                        : /media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis/build \nChecking for program g++ or c++          : /usr/bin/g++ \nChecking for program cpp                 : /usr/bin/cpp \nChecking for program ar                  : /usr/bin/ar \nChecking for program ranlib              : /usr/bin/ranlib \nChecking for g++                         : ok  \nChecking for node path                   : not found \nChecking for node prefix                 : ok /usr \n'configure' finished successfully (0.213s)\nWaf: Entering directory `/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis/build'\n[1/3] cxx: hiredis.cc -&gt; build/Release/hiredis_1.o\nnpm http 304 https://registry.npmjs.org/uglify-js/1.2.5\nnpm http 304 https://registry.npmjs.org/active-x-obfuscator/0.0.1\nnpm http 304 https://registry.npmjs.org/xmlhttprequest/1.4.2\nnpm http 304 https://registry.npmjs.org/ws\nnpm http GET https://registry.npmjs.org/zeparser/0.0.5\n[2/3] cxx: reader.cc -&gt; build/Release/reader_1.o\nnpm http 304 https://registry.npmjs.org/zeparser/0.0.5\n[3/3] cxx_link: build/Release/hiredis_1.o build/Release/reader_1.o -&gt; build/Release/hiredis.node\nnpm http GET https://registry.npmjs.org/commander\nnpm http GET https://registry.npmjs.org/tinycolor\nnpm http GET https://registry.npmjs.org/options\nWaf: Leaving directory `/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/redis/node_modules/hiredis/build'\n'build' finished successfully (10.809s)\nnpm http 304 https://registry.npmjs.org/tinycolor\nnpm http 304 https://registry.npmjs.org/commander\nnpm http 304 https://registry.npmjs.org/options\nnpm ERR! error rolling back Error: UNKNOWN, unlink '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html'\nnpm ERR! error rolling back  socket.io-client@0.9.10 { [Error: UNKNOWN, unlink '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html']\nnpm ERR! error rolling back   errno: -1,\nnpm ERR! error rolling back   code: 'UNKNOWN',\nnpm ERR! error rolling back   path: '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html' }\nnpm ERR! error rolling back Error: UNKNOWN, unlink '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html'\nnpm ERR! error rolling back  socket.io@0.9.10 { [Error: UNKNOWN, unlink '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html']\nnpm ERR! error rolling back   errno: -1,\nnpm ERR! error rolling back   code: 'UNKNOWN',\nnpm ERR! error rolling back   path: '/media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/benchmark.html' }\nnpm ERR! Error: EROFS, symlink '../ws/bin/wscat'\nnpm ERR! If you need help, you may report this log at:\nnpm ERR!     &lt;http://github.com/isaacs/npm/issues&gt;\nnpm ERR! or email it to:\nnpm ERR!     &lt;npm-@googlegroups.com&gt;\n\nnpm ERR! System Linux 3.2.0-32-generic-pae\nnpm ERR! command \"nodejs\" \"/usr/bin/npm\" \"install\" \"socket.io\"\nnpm ERR! cwd /media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat\nnpm ERR! node -v v0.8.12\nnpm ERR! npm -v 1.1.63\nnpm ERR! path ../ws/bin/wscat\nnpm ERR! code EROFS\nnpm ERR! errno 56\nnpm ERR! \nnpm ERR! Additional logging details can be found in:\nnpm ERR!     /media/sf_Data/webSites/exoLang/sites/all/modules/exoticlang_chat/npm-debug.log\nnpm ERR! not ok code 0\n</code></pre>\n"},{"tags":["javascript","node.js","nowjs"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12020511,"title":"Node.js / nowjs - A lot of users","body":"<p>I've made a server in nowjs, and with about 80 users online it get slow and sometimes people get disconnect. I've heared about that I have to change the workers count. But how to do it? and is it a solution? Or maybe there are another advices.</p>\n"},{"tags":["node.js","heroku","express","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12943079,"title":"Heroku bash: node: command not found","body":"<p>Have someone out there got this error when starting a node app on heroku before? </p>\n\n<pre><code>2012-10-17T20:28:52+00:00 heroku[web.1]: Starting process with command `node app.js`\n2012-10-17T20:28:53+00:00 app[web.1]: bash: node: command not found\n</code></pre>\n\n<p>It seems like the Heroku app are missing node. </p>\n\n<p>The app starts just fine locally. Both foreman start and node app.js.</p>\n\n<pre><code>{\n    \"name\": \"app-name\",\n    \"description\": \"some desc\",\n    \"version\": \"0.0.1\",\n    \"private\": true,\n    \"engines\": {\n        \"node\": \"0.8.12\",\n        \"npm\":  \"1.1.49\"\n    },\n    \"dependencies\": {\n        \"express\" : \"2.5.9\",\n        \"mongoose\" : \"&gt;=2.6.0\",\n        \"colibri\" : \"*\",\n        \"jade\": \"&gt;= 0.0.1\"\n    }\n}\n</code></pre>\n"},{"tags":["javascript","ios","node.js","rpc","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":420,"score":1,"question_id":7050695,"title":"Remote procedural calls over socket.io in native iOS applications?","body":"<p>Is it possible to do remote procedural calls over socket.io in native iOS applications?</p>\n\n<p>Would it be easier to do in a Titanium built application?</p>\n"},{"tags":["node.js","mongodb","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12946714,"title":"Mongoose query inside a loop","body":"<p>I'm trying to develop a simple application with mongoose.\nGiven an array of username 'group.contacts', I want to get the corresponding IDs of these user. However, the loop does not work as expected: the loop continues before the .find() method finish so I cannot get all the IDs of people. How can I solve this problem?</p>\n\n<pre><code>for(var v = 0; v &lt; group.contacts.length; v++) {\n    PersonModel.find({\n        name: group.contacts[v]\n    }, function (err, person) {\n        if(!err &amp;&amp; person) {\n            console.log('Found ' + person._id + ' ' + v); \n        }\n\n    });\n}\n</code></pre>\n"},{"tags":["node.js","coffeescript","gruntjs","towerjs"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12940889,"title":"grunt watch using lots of cpu on Ubuntu 12.04","body":"<p>I'm using grunt to watch my coffeescript files in a towerjs project and recompile them as they change. The configuration for this is generated by towerjs and seems fairly sane. The problem is, that once I start this process I will see it pegging a cpu core (actually, just one hyperthread). If I remove a lot of the paths from being watched I can get it down to around 25% of a CPU, but that is still pretty terrible. </p>\n\n<p>I've found a few references to some known issues and cross-platform inconsistence with the Node's fs API and even the fs.watch <a href=\"https://github.com/isaacs/node-supervisor/issues/71\" rel=\"nofollow\">in particular</a>. Tried <a href=\"https://github.com/unbalanced/grunt-simple-watch\" rel=\"nofollow\">grunt-simple-watch</a> but it did not do any better.</p>\n\n<p>I could setup Guard but it may be fiddlesome to get it working just right and functionally grunt seems to be just fine - I am curious though if anyone else has any other suggestions. </p>\n"},{"tags":["node.js","websocket","socket.io"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":118,"score":3,"question_id":11632969,"title":"How configure reconnecting in socket.io?","body":"<p>I create socket.io connection with next code</p>\n\n<pre><code>   var socket = new io.connect('http://localhost:8181', {\n        'reconnect': true,\n        'reconnection delay': 500,\n        'max reconnection attempts': 50\n    });\n</code></pre>\n\n<p>But when I kill server CTRL+C and start it again, reconnection isn't happening. But disconnect event raised on client side. What maybe reason of it?</p>\n"},{"tags":["node.js","browser"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12943516,"title":"Trouble running a nodejs file in the browser","body":"<p>I am discovering nodejs. So I created a simple file display a simple \"hello world!\". When I run it in my console, it works just fine. Now I am trying to launch it from the browser (I am listening the 8080 port). But I have an error message, telling me that my browser couldn't find that URL. </p>\n\n<p>I am using MAMP. And, in the root configured with it, I tried to listen the port 8888 (the one that I use launching my PHP local sites, of course changing the port in my nodejs file), but it still doesn't work. </p>\n\n<p>For information, my app.js node file is also in the root directory configured with my MAMP server. Is it a firewall problem? If yes, how can I fix it? Should I change something in my /etc/hosts file?</p>\n"},{"tags":["unit-testing","node.js","rest","mongoose","expressjs"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":150,"score":1,"question_id":12245624,"title":"How to unit test a NodeJs REST API server built using Express + Mongoose?","body":"<p>I have a REST API server that uses Express, Mongoose and <a href=\"https://github.com/lorenwest/node-config\" rel=\"nofollow\">config</a>. I want to unit test my API. Basically, bring up a temporary web server on port x, an empty mongo-database on port y, do some API calls (both gets and puts) and validate what I get back and then shutdown temporary server and drop test database once my tests finish. What is the best way to do this? I have been looking at <a href=\"http://visionmedia.github.com/mocha/\" rel=\"nofollow\">mocha</a>/<a href=\"http://jhnns.github.com/rewire/\" rel=\"nofollow\">rewire</a> but not sure how to set up temporary server and db and not sure what the best practices are.</p>\n"},{"tags":["node.js","express","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12944152,"title":"node 'extends layout' does not show block content","body":"<p>I have tried this in a couple different projects with same result. This is a node app with express 2.5.8 and jade 0.20.3 (but updating to newer version of jade and express dont change the problem below). </p>\n\n<p>I have a simple jade layout:</p>\n\n<p>\"layout.jade\"</p>\n\n<pre><code>doctype 5\nhtml\n  head\n    title MongoDB example\n  body\n    h1 My first MongoDB app\n    hr\n    block body\n</code></pre>\n\n<p>Then an index content page that should inherit the layout and show the content:</p>\n\n<p>\"index.jade\"</p>\n\n<pre><code>extends layout\nblock body\nif (authenticated)\n  p Welcome back, #{me.first}\n  a(href=\"/logout\") Logout\nelse\n  p Welcome new visitor!\n  ul\n    li: a(href=\"/login\") Login\n    li: a(href=\"/signup\") Signup\n</code></pre>\n\n<p>In server.js I have (pertaining to jade):</p>\n\n<pre><code>app.set('view options', { layout: false });\n</code></pre>\n\n<p>But when I run the server and load the page I only get the content on the layout and not the index page. If I remove 'extends layout' then I get the content from the index page but not the layout. So, the output I get is:</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;&lt;title&gt;MongoDB example&lt;/title&gt;&lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;My first MongoDB app&lt;/h1&gt;&lt;hr&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Figure this must be something simple I have overlooked but no love on googling around on this. </p>\n"},{"tags":["node.js","deployment","debian","jake"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":846,"score":0,"question_id":11739216,"title":"sudo: no tty present and no askpass program specified","body":"<p>I tried <a href=\"https://github.com/mde/jake\" rel=\"nofollow\">jake</a> together with <a href=\"https://github.com/bengourley/launch\" rel=\"nofollow\">launch</a> a little but when I want to deploy my node.js app I get this during the process:</p>\n\n<pre><code>$ ssh mydomain.com sudo stop site.WebApp-production &amp;&amp; sudo start site.WebApp-production\nsudo: no tty present and no askpass program specified\n\n✘  Failed to restart site\n\njake aborted.\nError\n  at fail (/usr/local/lib/node_modules/jake/lib/api.js:235:13)\n  at /Users/udo/Projects/WebApp/Jakefile.coffee:31:16\n  at ChildProcess.exports.remote (/Users/udo/Projects/WebApp/node_modules/launch/lib/action.js:39:5)\n  at ChildProcess.EventEmitter.emit (events.js:91:17)\n  at Process._handle.onexit (child_process.js:674:10)\n</code></pre>\n\n<p>Do you know how to get rid of this? I'm using Debian 6 on my remote machine.</p>\n\n<p>Thanks</p>\n"},{"tags":["javascript","node.js","asynchronous","twitter-api"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12943060,"title":"node-ntwitter and twitter API Limites","body":"<p>Question related to the API limits, It might be something I'm just missing, not sure though:</p>\n\n<p>If I do this:</p>\n\n<pre><code> twit.showUser(ids, function(error, response) {\n   console.log(response)\n }\n</code></pre>\n\n<p>Where {ids} is an Array, with length &lt; 100, all is well.</p>\n\n<p>When I do the same and IDs is > 100, it fails.</p>\n\n<p>This is based on:\n<a href=\"https://dev.twitter.com/docs/api/1.1/get/users/lookup\" rel=\"nofollow\">https://dev.twitter.com/docs/api/1.1/get/users/lookup</a></p>\n\n<p>And specifically:</p>\n\n<blockquote>\n  <p>for up to 100 users per request</p>\n</blockquote>\n\n<p>Is this somehow managed in ntwitter module or do I need to manage this outside? if so, any recommendation on how to manage that?</p>\n\n<p>Or, outside of the node-ntwitter module, how would you recommend solving this in a clean way if I want to send back a composite json of all <em>responses</em> from showUser() ?</p>\n"},{"tags":["security","node.js"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12932731,"title":"How to protect Node.JS web soket server against connection bomb?","body":"<p>Anyone can request to connect to my real-time application server written by Node.JS which started on port 80.</p>\n\n<p>That means anyone can send large number of curl requests to bomb my socket server causes the connection overflow.\nAny way to detect curl request and reject them?</p>\n\n<p>Thank you.</p>\n"},{"tags":["javascript","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12942568,"title":"Is it possible to fork child processes and wait for them to return in Node/JS?","body":"<p>I have to do a certain calculation many many times.  I want to split it over multiple cores, so I want to use child_process.fork(), and then pass each child a chunk of the work.</p>\n\n<p>This works fine, except that my main process (the one that does the fork()) just keeps going after fork()ing and has already terminated by the time the children complete their work.</p>\n\n<p>What I really want to do is wait for the children to finish before continuing execution.</p>\n\n<p>I can't find any good way to do this in Node.  Any advice?</p>\n"},{"tags":["http","node.js"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12941732,"title":"How to handle http.get() when received no data in nodejs?","body":"<p>Let's say that I have a service that returns customer information by a given id. If it's not found I return null.</p>\n\n<p>My app calls this services like this: </p>\n\n<pre><code>http.get('http://myserver/myservice/customer/123', function(res) {\n    res.on('data', function(d) {\n        callback(null, d);\n    });\n}).on('error', function(e) {\n    callback(e);\n});\n</code></pre>\n\n<p>Currently my service responds with 200 but no data.</p>\n\n<p>How do I handle when no data is returned?</p>\n\n<p>Should I change it to return a different http code? In this case how to handle this? I tried many different approaches without success.</p>\n"},{"tags":["node.js","express","couchdb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12939599,"title":"Cant get view to render","body":"<p>I am developing an application with node.js, express, couchDB and using nano to communicate with couch.\nI am using a jquery get request from client javascript. Using fiddler i can see that i get my view in the RAW result but the view is never rendered.</p>\n\n<p>client:</p>\n\n<pre><code>$.get('employee/'+customerId, function(data){\n        return;\n    });\n</code></pre>\n\n<p>route:</p>\n\n<pre><code>app.get('/employee/:id', employee.viewEmployee);\n</code></pre>\n\n<p>viewEmployee:</p>\n\n<pre><code>exports.viewEmployee = function(req, res){\n    db.get(req.params['id'], { revs_info: false }, function(err, body, header) {\n        res.render('employee/single', {employee: body});\n    });\n};\n</code></pre>\n\n<p>Everything works with no errors and i get the 'employee/single' view html in the raw response. my question is why the view is not rendered? why is the html just sent back in the raw and how can i get this to work?</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12941891,"title":"In node.js, how can I create a 'ServerResponse' instance using a socket object?","body":"<p>I need to dispatch some requests(depending on the path and other request attributes) to a child process. TCP connections can be sent to child processes <a href=\"http://nodejs.org/api/child_process.html#child_process_child_send_message_sendhandle\" rel=\"nofollow\">as described here</a>, but how can I re-create the 'http.ServerResponse' instance on the child process so it can finish handling the request without going back to the process that received the request?</p>\n"},{"tags":["node.js","expressjs","node-modules"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12890494,"title":"improving express.js module usage","body":"<p>There is something small but it annoys me. When you want to use a node module you have to manually install it, required it and add it in package.json. If you don't want to use it it's the same thing backwards.</p>\n\n<p>Is there a tool that install/remove to/from node_modules &amp; add/remove to/from package.json automatically after module is required.</p>\n\n<p>It's something simple that must exists if not now later on. </p>\n"},{"tags":["bash","node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12941083,"title":"Get the output of a shell command in node.js","body":"<p>In a node.js, I'd like to find a way to obtain the output of a Unix terminal command. Is there any way to do this?</p>\n\n<pre><code>function getCommandOutput(commandString){\n    //now how can I implement this function?\n    //getCommandOutput(\"ls\") should print the terminal output of the shell command \"ls\"\n}\n</code></pre>\n"},{"tags":["validation","node.js","express","connect","jade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12940317,"title":"Repopulate form values in express/connect","body":"<p>I just started a new nodejs app, which will contain a notable amount of forms for creating and editing/updating database values. My question is: How can I repopulate form entries if the given data is invalid?</p>\n\n<p>Example: Somebody tries to login. If the credentials are wrong I'm using something like the following to display the login page again:</p>\n\n<pre><code>res.render('sessions/new')\n</code></pre>\n\n<p>Thing is, the username is not populated with the request data. I was wondering how to accomplish this both easy and clean. Since there is no <code>form_for</code> like in rails, I guess I have to implement that manually, right? My first approach was to bypass the request body/params as locals to the <code>render</code> function and set the value within my jade template like so:</p>\n\n<pre><code>// In controller/route\nres.render('sessions/new', req.body)\n\n// In template\ninput(type='text', name='username', value=locals.username)\n</code></pre>\n\n<p>Is there a better or more unobtrusive solution? I mean the example above works and is pretty easy to implement, just wondering if I missed something. This is also interesting for stuff like adding an error class to invalid form fields. Couldn't really find anything on the web.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["node.js"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12939253,"title":"Node.js App with API endpoints which take 20sec+ :: Connections Left Open :: How to Optimize?","body":"<p>I have a Node.js RESTful API returning JSON data. One of the API calls can (and frequently does) take 10 - 20 seconds to finish. This long RTT is due to connecting to external APIs, like DiffBot, MailChimp, Facebook, Twitter, etc. I wish I could make the API call shorter, but I cannot. </p>\n\n<p>Of course, I've implemented the node code in a nice async way, but the problem is that the client's inbound connection (to the node app) is alive while it waits for the server to finish, and thus might be killing my performance. In fact, I'm currently guessing that this may explain <a href=\"http://stackoverflow.com/questions/12886438/node-js-app-has-periodic-slowness-and-or-timeouts-does-not-accept-incoming-requ\">my long-running timeout issue in node</a>.</p>\n\n<p>I've already increased maxSockets to a huge number...</p>\n\n<pre><code>require('http').globalAgent.maxSockets = 9999;\n</code></pre>\n\n<p>For the sake of interest, I'm printing out the active sockets each time a new connection is made (<a href=\"http://pastebin.com/pnhpxV5g\" rel=\"nofollow\">here's the code</a>).</p>\n\n<p>Which gives me output like this:</p>\n\n<pre><code>SOCKETS: {} { 'graph.facebook.com:443': 5, 'api.instagram.com:443': 1 }\n</code></pre>\n\n<p>Nothing too enlightening there. The max connections I ever see is around 20 or so, total, across all hosts. But this doesn't really tell me anything about incoming connections, or how to optimize them so that my server does not choke when there are many of them alive at once (which I suspect it is).</p>\n"},{"tags":["node.js","install","fedora"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":250,"score":1,"question_id":11133742,"title":"Node.js symbol lookup error on Fedora 16","body":"<p>I installed Node.JS on Fedora 16, but when i'm started daemon it's throw error:</p>\n\n<pre><code>sdfnode: symbol lookup error: node: undefined symbol: _ZN2v82V816IdleNotificationEv\n</code></pre>\n\n<p>To solve the problem I reinstalled from this repository: <a href=\"http://nodejs.tchol.org/\" rel=\"nofollow\">http://nodejs.tchol.org/</a>, it did not help. How to fix it?</p>\n"},{"tags":["node.js","load","jmeter","performance-testing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":29,"score":-3,"question_id":12938957,"title":"What are some common tools to load test a nodejs application? Would I use something like jmeter, to stress test my app?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1754427/jmeter-alternative\">Jmeter alternative</a>  </p>\n</blockquote>\n\n\n\n<p>I realize jMeter is there, but I was wondering if there are some alternative tools to jMeter.</p>\n\n<p>Thanks!</p>\n"},{"tags":["javascript","algorithm","hash","node.js"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":868,"score":3,"question_id":4483952,"title":"nodejs consistent hash library","body":"<p>base on the information by STFW, guess that CRC32, KETAMA are almost best consistent hash algorithms currently, but I didn't found any libraries implement them. </p>\n"},{"tags":["node.js","ios6","mobile-safari","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":86,"score":-1,"question_id":12938335,"title":"Why does my node.js / socket.io app not work on iOS6?","body":"<p>I thought the whole point of socket.io was to not have to worry about modern browsers?  lol</p>\n\n<p>Anyway, I am new to socket programming.  I have a small app that simply mimics mouse movements.</p>\n\n<p>You open several browsers and when you move the mouse, your actions are recorded in the other browsers.  It moves a small square.  Kinda cool.  However, when I open it on my iPad (iOS6) nothing!  Sockets isn't connecting.  I even put an alert message in the <code>connect</code> event and nothing.</p>\n\n<p>Works in IE, FF and Chrome just fine on my laptop.  The only difference is that my dev machine uses <code>localhost</code> while the iPad uses my machine's IP.  However, when I connect to my local IP on my laptop, it still works.  Just not in Safari/iPad.</p>\n\n<p>Here is my server.</p>\n\n<pre><code>    var app = require('http').createServer(handler),\n        io = require('socket.io').listen(app),\n        fs = require('fs');\n\n\n    app.listen(80);\n\n    function handler(req, res) {\n        var file = __dirname + '/public/index.html';\n        fs.readFile(file, \n            function(err, data) {\n                if(err) {\n                    res.writeHead(500);\n                    return res.end('Error loading index.html');\n                }\n\n                res.writeHead(200);\n                res.end(data);\n            }\n        );\n    }\n\n\n    var rooms = ['abc', 'test1'];\n\n    var sockets = [];\n    io.sockets.on('connection', function(socket) {\n        sockets.push(socket);\n\n        socket.on('m', function(data) {\n            socket.broadcast.to(socket.room).emit('relay', {msg: 'MouseX: ' + data.x + ' MouseY: ' + data.y, x: data.x, y: data.y});\n        });\n\n        socket.on('join', function(room) {\n            socket.join(room);\n            socket.emit('updateStatus', {msg: 'Joined room ' + room});\n            console.log('Joined room ' + room);\n        });\n\n    });\n</code></pre>\n\n<p>Here is my client:</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;style&gt;\n            body {\n                padding: 40px;\n            }\n            #cursor {\n                background:white;\n                border:1px solid black;\n                color: white;\n                display: block;\n                height:24px;\n                padding:6px;\n                position:absolute;\n                width:24px;\n                z-index:20;\n            }\n        &lt;/style&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n\n        &lt;input id='msg' type='text' size='100' /&gt;&lt;br /&gt;\n        &lt;input id='box' type='text' size='100' /&gt;\n        &lt;div id='cursor'&gt;&lt;/div&gt;\n\n        &lt;script src='/socket.io/lib/socket.io.js'&gt;&lt;/script&gt;\n        &lt;script&gt;\n            var socket = io.connect('http://localhost');\n            var b = document.getElementById('box');\n            var m = document.getElementById('msg');\n            var c = document.getElementById('cursor');\n\n            // join custom room\n            socket.on('connect', function() {\n                socket.emit('join', 'abc');\n            });\n\n            // update status messages from server\n            socket.on('updateStatus', function(data) {\n                m.setAttribute('value', data.msg);\n            });\n\n            socket.on('relay', function(data) {\n                b.setAttribute('value', data.msg);\n                c.style.left = parseInt(data.x) + 'px';\n                c.style.top = parseInt(data.y) + 'px';\n            });\n\n            document.onmousemove = function(event) {\n                event = event || window.event;\n                socket.emit('m', {x: event.clientX, y: event.clientY});\n            }\n\n\n        &lt;/script&gt;\n\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["node.js","passport"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12919166,"title":"Which passport authentication to use","body":"<p>I'm using several Passport authentication strategies in my site, which works great, however, I need a <code>Demo</code> or (we could call <code>session</code> ) Strategy which automatically authorize the user by it's session id, Now I'm doing it manually, when the user navigates to the <code>/demo</code> page, I run a query on the db (mongodb), with the session id, and if the user exists, I render the page with that user, if not I create one.</p>\n\n<pre><code>app.get('/demo', function(req,res) {\n  db.User.findOne({ 'accounts.kind': 'demo', 'accounts.sid': req.sessionID }, function(err, user) {\n    if (user) {\n      res.render( 'home', {\n        user: user\n      });\n    } else {\n      var user = new db.User();\n      user.accounts.push({\n        kind: 'demo',\n        sid: req.sessionID,\n        created: Date.now\n      });\n      req.session.userId = user._id;\n\n      user.save(function(err) {\n        if(err) { throw err; }\n        res.render( 'home', {\n          user: user\n        });\n      });\n    }\n  });\n});\n</code></pre>\n\n<p>the user schema looks like this:</p>\n\n<pre><code>UserSchema = new Schema({\n  uname: {type: String},\n  accounts: [],\n  docs:[{type:Schema.Types.ObjectId, ref:'Doc'}]\n})\n</code></pre>\n\n<p>It works, but I need to set a session variable, because this method does not log in the user, I mean there is no <code>req.user</code> in the requests, but with that session variable I can check whether the user is a demo user.</p>\n\n<pre><code>if (req.user) {\n    userid = req.user._id.toString();\n  } else {\n    userid = req.session.userId;\n  }\n</code></pre>\n\n<p>I'm sure there's a more elegant way of doing this, with one of the existing passport Strategies. I see that there's <a href=\"https://github.com/jaredhanson/passport-http\" rel=\"nofollow\">passport-http</a>, and <a href=\"https://github.com/jaredhanson/passport-anonymous\" rel=\"nofollow\">passport-anonymous</a>, and several others, but I'm not sure which should I use. </p>\n\n<p>It's important to me to create a database entry for the user. So later I can attach to it an another account.</p>\n"},{"tags":["node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12922219,"title":"Node.js + Cluster :: Restarting Workers Without Downtime?","body":"<p>For reasons I'll breeze over here, I want to cause the workers started by cluster (in node.js) to live for 1 hour each, before restarting themselves.</p>\n\n<p>The caveat is that I need to have zero downtime. Thus, simply executing a destroy() on each worker is not acceptable, as it takes down the cluster until the workers are restarted.</p>\n\n<p>Here's my base code:</p>\n\n<pre><code>if(cluster.isMaster) {\n    for(var i=0; i&lt;2; i++)\n    {\n        cluster.fork();\n    }\n    return;\n}\nrequire('./api').startup(settings, process.argv, function(error, api){\n    if(error)\n    {\n        console.log('API failed to start: '+error);\n    }\n    else \n    {\n        console.log('API is running');\n    }\n});\n</code></pre>\n\n<p>The api.js script implements express to start a pretty standard RESTful JSON API.</p>\n"},{"tags":["node.js","websocket"],"answer_count":4,"favorite_count":37,"up_vote_count":24,"down_vote_count":0,"view_count":10201,"score":24,"question_id":4445883,"title":"node-websocket-server: possible to have multiple, separate \"broadcasts\" for a single node.js process?","body":"<p>I'd like to know if it's possible to broadcast on different websocket \"connections\" running from the same <a href=\"https://github.com/miksago/node-websocket-server\" rel=\"nofollow\">node-websocket-server</a> app instance? Imagine a chatroom server with multiple rooms, only broadcasting messages to the participants specific to each room, on a single node.js server process. I've successfully implemented a one-chatroom-per-process solution, but I want to take it to the next level.</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["node.js","haxe"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":28,"score":-1,"question_id":12937755,"title":"How to handle asynchronous Programming for node.js in HaXe?","body":"<p>HaXe is a nice language but targeting multiple platforms with the same codebase is difficult in some cases. I want to target PHP, C++ and Node.js with HaXe but the Problem is that in Node IO is asynchronous and in PHP it is synchronous. How to deal with this difference?</p>\n"},{"tags":["javascript","html","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":60,"score":4,"question_id":12932680,"title":"How to store a captured image into MySQL database using JavaScript and Node.js","body":"<p>I am capturing image using canvas and i want to store a captured image in MySQL Database using Javascript.</p>\n\n<p>This is my code:</p>\n\n<pre><code>&lt;html&gt;  \n      &lt;head&gt;\n            &lt;meta charset=\"utf-8\"&gt;\n            &lt;meta name=\"viewport\" content=\"width=device-width, maximum-scale=1.0\"&gt;\n            &lt;style&gt;\n                body {width: 100%;}\n                canvas {display: none;}\n            &lt;/style&gt;\n            &lt;title&gt;Instant Camera - Remote&lt;/title&gt;\n            &lt;script&gt;\n\n                var video, canvas, msg;\n                var load = function () {\n                    video  = document.getElementById('video');\n                    canvas = document.getElementById('canvas');\n                    msg    = document.getElementById('error');\n                    if( navigator.getUserMedia ) {\n                        video.onclick = function () {\n                            var context = canvas.getContext(\"2d\");\n                            context.drawImage(video, 0, 0, 240, 320);\n                            var image1 = canvas.toDataURL(\"image/png\");\n                    document.write('&lt;img src=\"' + image1 + '\" /&gt;');         \n                        };\n\n                    } else {\n                        msg.innerHTML = \"Native web camera not supported :(\";\n                    }\n                };\n\n                window.addEventListener('DOMContentLoaded', load, false);\n            &lt;/script&gt;\n        &lt;/head&gt;\n        &lt;body&gt;\n            &lt;video  id=\"video\" width=\"240\" height=\"320\" autoplay&gt; &lt;/video&gt;\n            &lt;p      id=\"error\"&gt;Click on the video to send a snapshot to the receiving screen&lt;/p&gt;\n            &lt;canvas id=\"canvas\" width=\"240\" height=\"320\"&gt; &lt;/canvas&gt;\n        &lt;/body&gt;\n        &lt;/html&gt;\n</code></pre>\n"},{"tags":["python","node.js","azure","ssh","virtual-machine"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12927528,"title":"Running Node or Python app from a Linux Azure VM","body":"<p>I can't seem to figure this out. I created a new Ubuntu VM on Azure and I can SSH into it. I installed Node (which I've done many times) and I tried to run the test app from nodejs.org:</p>\n\n<pre><code>var http = require('http');\nhttp.createServer(function (req, res) {\n  res.writeHead(200, {'Content-Type': 'text/plain'});\n  res.end('Hello World\\n');\n}).listen(1337, '127.0.0.1');\nconsole.log('Server running at http://127.0.0.1:1337/');\n</code></pre>\n\n<p>However, when I go to the IP (which is the same one I SSHed into the box from) + :1337 it just never loads. I tried :80 too, but still no luck. I also tried running python -m SimpleHTTPServer on :8000 and I still can't view the site. I must be missing something. </p>\n\n<p>Just so you know, I'm just trying to setup a simple dev box with a bunch of projects on it. I want to be able to work on my projects anywhere. Some are 100% front-end JS projects so SimpleHTTPServer would be fine. Some are Node projects too. In either case, I just want to be able to hit some port and see what I'm working on.</p>\n\n<p>Oh also I opened up the Azure firewall to the VM, redirecting traffic from port 80 to port 1337 (<a href=\"https://www.evernote.com/shard/s5/sh/3aef8e76-04f6-48cb-84f9-32462bc425a7/f0cd749773a9d09cee66d00fe3e707c0\" rel=\"nofollow\">https://www.evernote.com/shard/s5/sh/3aef8e76-04f6-48cb-84f9-32462bc425a7/f0cd749773a9d09cee66d00fe3e707c0</a>)</p>\n"},{"tags":["api","node.js"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":122,"score":3,"question_id":12882543,"title":"using node.js as middle tier","body":"<p>I am developing an application whose front-end is built using jquery mobile. This application requires database access to fetch various information. It will also need to update the database.</p>\n\n<p>To sync my application front-end, I am thinking of using node.js as a middle tier. The choice of node.js was made because we want it to scale properly. This middle tier will serve the front-end with all the required data that it needs. It will also receive data from the front-end and update the back-end database.</p>\n\n<p>The problem is the data that will have pretty complex structure and relations. Converting the data model to and from plain JSON by hand can become a real pain. So I was thinking of using some other module/framework also. I tried with <a href=\"http://jaydata.org/\" rel=\"nofollow\">Jaydata</a> so that I can form data models and then expose them using OpenData protocol, but the documentation of it seems to be lacking. I also though about using <a href=\"http://sequelizejs.com/\" rel=\"nofollow\">Sequelize</a> but I think it doesn't have pretty good support for database at this point (triggers, procedures and all). </p>\n\n<p>So what can I use at this point to fulfill my requirements? Is there any node module/framework which fulfills my requirements or do I have to use raw code to fetch data from the back-end, convert it to proper models and serve them?</p>\n\n<p>I am using Postgresql as my back-end database. For the time being my front-end is made using jquery mobile but I may choose to use different technology (PHP/ASP.NET) to build it.</p>\n"},{"tags":["node.js"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12924526,"title":"In NodeJS: is it possible for two callbacks to be executed exactly at the same time?","body":"<p>Let's say I have this code:</p>\n\n<pre><code>function fn(n)\n{\n  return function()\n  {\n    for(var k = 0; k &lt;= 1000; ++k) {\n      fs.writeSync(process.stdout.fd, n+\"\\n\");\n    }\n  }\n}\n\nsetTimeout(fn(1), 100);\nsetTimeout(fn(2), 100);\n</code></pre>\n\n<p>Is it possible that <code>1</code> and <code>2</code> will be printed to <code>stdout</code> interchangeably (e.g. <code>12121212121...</code>)?</p>\n\n<p>I've tested this and they did NOT apper interchangeably, i.e. <code>1111111...222222222...</code>, but few tests are far from proof and I'm worried that something like <code>111111211111...2222222...</code> could happen.</p>\n\n<p>In other words: when I register some callbacks and event handlers in Node can two callbacks be executed exactly at the same time?</p>\n\n<p>(I know this could be possible with launching two processes, but then we would have two <code>stdout</code> and the above code would be splitted into separate files, etc.)</p>\n\n<p>Another question: Forgetting the Node and speaking generally: in any language on single process is it possible for two functions to be executed at exactly the same time (i.e. in the same manner as above)?</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12934080,"title":"Can a Mongoose schema be inspected to determine if a field is required?","body":"<p>I have a Mongoose schema (excerpt below):</p>\n\n<pre><code>var PersonSchema = new Schema({\n  name : { \n      first: { type: String, required: true } \n    , last: { type: String, required: true }   \n  } \n  ...\n</code></pre>\n\n<p>I would like to inspect the schema to identify which fields are required then validate those fields are present in user input. I can test the 'required' attribute of name.first as follows:</p>\n\n<pre><code>var person_schema = require('../models/person');\n\nif (person_schema.schema.paths['name.first'].isRequired) {\n  req.assert('first', messages.form_messages.msg_required).notEmpty();\n</code></pre>\n\n<p>But feel this is unsafe as the internal schema details could change. Is there a better way?</p>\n"},{"tags":["node.js","chat"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12935287,"title":"Chat with node.js always on top on all pages","body":"<p>I am building a person to person chat using node.js in a php website (using zf)\nI am wondering how facebook (for example) is doing to always have the footbar visible even when navigating from pages to pages.\nI first thought they used ajax everywhere so the page is never realy reloaded but it appears not as you can use the browser back/forward buttons to navigate (and I don't realy see any ajax call in my browser developper tools). So, my second thought is that all facebook is build with a kind of node.js alternative so everything works with js sockets ?</p>\n\n<p>Any idea how to do a similar system, to have my chat windows always visible even when navigating my website?</p>\n\n<p>Thanks</p>\n"},{"tags":["node.js","socket.io"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12935338,"title":"Why are my socket.io events not being handled on multiple browsers?","body":"<p>So I am writing a small 'co-browsing' demo.  Mostly for educational purposes.</p>\n\n<p>Anyway, the plan is this.  Users open their browser to my server and move their mouse around.  When doing so, the browser sends the mouse coordinates to the server and the server relays the coordinates back to any browser subscribing to the channel.  The coordinates are then displayed in a text box.</p>\n\n<p>I am using <code>nodejs</code> and <code>socket.io</code>.</p>\n\n<p>Here is my server.js:</p>\n\n<pre><code>var app = require('http').createServer(handler),\n    io = require('socket.io').listen(app),\n    fs = require('fs');\n\n\napp.listen(80);\n\nfunction handler(req, res) {\n    var file = __dirname + '/public/index.html';\n    fs.readFile(file, \n        function(err, data) {\n            if(err) {\n                res.writeHead(500);\n                return res.end('Error loading index.html');\n            }\n\n            res.writeHead(200);\n            res.end(data);\n        }\n    );\n}\n\n\nio.sockets.on('connection', function(socket) {\n    socket.on('m', function(data) {\n        socket.emit('relay', {msg: 'MouseX: ' + data.x + ' MouseY: ' + data.y});\n    });\n});\n</code></pre>\n\n<p>Here is my client:</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n\n        &lt;input id='box' type='text' size='200' /&gt;\n\n        &lt;script src='/socket.io/lib/socket.io.js'&gt;&lt;/script&gt;\n        &lt;script&gt;\n\n            var socket = io.connect('http://localhost');\n            var b = document.getElementById('box');\n\n            socket.on('relay', function(data) {\n                b.setAttribute('value', data.msg);\n            });\n\n            document.onmousemove = function(event) {\n                event = event || window.event;\n                socket.emit('m', {x: event.clientX, y: event.clientY});\n            }\n\n\n        &lt;/script&gt;\n\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Now, if I open two browsers and point both to localhost I can move the mouse over a window and the textbox at the top works.  It shows the coordinates.  However, the OTHER browser doesn't do anything.  But if I move the mouse over to the other browser, it then displays the coordinates on its window.  It's like it only relays to the browser I am currently hovering over.  The server console shows movements on both browsers.  </p>\n\n<p>But since both browser windows are responding to the <code>relay</code> event (channel), shouldn't both browsers echo the coordinates?  So that browser 1's mouse movement is echoed to browser 2 and when I go over to browser two, its coordinates are echoed over to browser 1?</p>\n\n<p>Hope that makes sense.</p>\n\n<p>Thanks</p>\n\n<p>** SOLUTION **</p>\n\n<p>Thanks to Victor Stanciu for the quick answer.  Here is what I did to fix the server.  </p>\n\n<pre><code>var app = require('http').createServer(handler),\n    io = require('socket.io').listen(app),\n    fs = require('fs');\n\n\napp.listen(80);\n\nfunction handler(req, res) {\n    var file = __dirname + '/public/index.html';\n    fs.readFile(file, \n        function(err, data) {\n            if(err) {\n                res.writeHead(500);\n                return res.end('Error loading index.html');\n            }\n\n            res.writeHead(200);\n            res.end(data);\n        }\n    );\n}\n\nvar sockets = [];\nio.sockets.on('connection', function(socket) {\n    sockets.push(socket);\n\n    socket.on('m', function(data) {\n        io.sockets.emit('relay', {msg: 'MouseX: ' + data.x + ' MouseY: ' + data.y});\n    });\n});\n</code></pre>\n"},{"tags":["node.js","fs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12932500,"title":"How to make the fs.readDir to read a folder from a relative path? where the root is not the entry point of the node process","body":"<p>I have the fs.readDir in file \"/subfolder/a\" and the file \"/subfolder/a\" is called from \"/b\". When I run the fs.readDir it shows me the files in the \"/\" which is b. I would like to know if there is anyway to \"say\" to the fs.readDir to set as it's root to be \"/subfolder/\" instead of \"/\".</p>\n\n<p><strong>Update:</strong>\nOf course I could use the path relative to the node entry point, but I would like to use something like \"./\" (current folder) from the file \"/subfolder/a\" and get the contents of the folder \"/subfolder/\" and not the folder \"/\".</p>\n"},{"tags":["node.js","session","authentication","express","socket.io"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":258,"score":5,"question_id":12801027,"title":"Since connect doesn't use the parseCookie method anymore, how can we get session data using express?","body":"<p><strong>UPDATE</strong></p>\n\n<p>Ok I got <code>session.socket.io</code> working on my server. And as I suspected, I got stuck at the point of authorizing. I think I might be going about this the wrong way, so feel free to correct me. In my Redis database, I will have user's information. The first time that they login, I want to update their cookie so it contains their user information. Then the next time they come back to the site, I want to check if they have a cookie and if the user information is there. If it is not there, I want to send them to the login screen. At the login screen, when a user submits information, it would test that information against the Redis database, and if it matches, it would update the cookie with user information. My questions are these: </p>\n\n<p><strong>1) How can I update/change a cookie through RedisStore?</strong> </p>\n\n<p><strong>2) It looks like session data is saved only in cookies. How can I keep track of user information from page to page if someone has cookies turned off?</strong></p>\n\n<p>Here is my applicable code:</p>\n\n<pre><code>//...hiding unapplicable code...\nvar redis = require('socket.io/node_modules/redis');\nvar client = redis.createClient();\nvar RedisStore = require('connect-redis')(express);\nvar redis_store = new RedisStore();\nvar cookieParser = express.cookieParser('secret');\n\napp.configure(function(){\n  //...hiding unapplicable code...\n  app.use(cookieParser);\n  app.use(express.session({secret: 'secret', store: redis_store}));\n});\n\n//...hiding code that starts the server and socket.io\n\nvar SessionSockets = require('session.socket.io');\nvar ssockets = new SessionSockets(io, redis_store, cookieParser);\n\nio.configure(function(){\n  io.set('authorization', function(handshake, callback){\n    if(handshake.headers.cookie){\n      //var cookie = parseCookie(handshake.headers.cookie);\n      //if(cookie.user){\n      //  handshake.user = cookie.user;\n      //}\n    }\n    callback(null, true);\n  });\n});\n\nssockets.on('connection', function(err, socket, session){ ... });\n</code></pre>\n\n<p><hr>\nIn node.js and express, there are many examples showing how to get session data. </p>\n\n<ul>\n<li><a href=\"http://iamtherockstar.com/blog/2012/02/14/nodejs-and-socketio-authentication-all-way-down/\" rel=\"nofollow\">Node.js and Socket.io</a></li>\n<li><a href=\"http://www.danielbaulig.de/socket-ioexpress/\" rel=\"nofollow\">Express and Socket.io - Tying it all Together</a></li>\n<li><a href=\"http://stackoverflow.com/questions/4641053/socket-io-and-session\">Socket.io and Session?</a></li>\n</ul>\n\n<p>As you can see when you visit the 3rd link, it's a link to StackOverflow. There was a good answer, but as pointed out in those comments by @UpTheCreek, connect no longer has the parseCookie method. I have just run into this problem as well. All of the tutorials I have found uses connect's <code>parseCookie</code> method which now doesn't exist. So I asked him how we can get the session data and he said he doesn't know the best approach so I thought I'd post the question here. When using <code>express@3.0.0rc4</code>, <code>socket.io</code>, and <code>redis</code>, how can we get session data and use that to authorize the user? I've been able to use <code>require('connect').utils.parseSignedCookie;</code>, but when I do that, I always get a warning/error when handshaking, </p>\n\n<pre><code>warn - handshake error Error\n</code></pre>\n\n<p>and from what I've read it sounds like that isn't a permanent solution anyways.</p>\n"},{"tags":["node.js","mongoose"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12929476,"title":"MongooseArray#indexOf not working with object ids","body":"<p>I'm trying to use mongoose's built in indexOf() method to see if an object id exists in a doc array. But it does not appear to work with object ids, even though the documentation says it should.</p>\n\n<pre><code>var UserSchema = new Schema({\n  , following : [{ type: Schema.ObjectId, ref: 'User'}]\n  , followers : [{ type: Schema.ObjectId, ref: 'User'}]\n});\n</code></pre>\n\n<p>This is giving me -1</p>\n\n<pre><code>user1.followers.indexOf(user2._id);\n</code></pre>\n\n<p>For the following data:</p>\n\n<pre><code>console.log( user1.followers ) # =&gt; [ '505e2f1de888c7d701000001' ]\nconosle.log( user2._id ) # =&gt; 505e2f1de888c7d701000001\nconsole.log( user1.followers.indexOf( user2._id ) ) # =&gt; -1\n</code></pre>\n\n<p>I have also tried passing just user2 object, but same problem:</p>\n\n<pre><code>console.log( user1.followers.indexOf( user2 ) ) # =&gt; -1\n</code></pre>\n\n<p>I should be seeing 1 in the last log here, not -1.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>Here is the mongoose documentation:\n<a href=\"http://mongoosejs.com/docs/api.html#types_array_MongooseArray-indexOf\" rel=\"nofollow\">http://mongoosejs.com/docs/api.html#types_array_MongooseArray-indexOf</a></p>\n"},{"tags":["bash","node.js","amazon-ec2","sudo","command-path"],"answer_count":7,"favorite_count":8,"up_vote_count":14,"down_vote_count":0,"view_count":4795,"score":14,"question_id":4976658,"title":"On EC2: sudo node command not found, but node without sudo is ok","body":"<p>I have just installed nodejs on a new EC2 micro instance.</p>\n\n<p>I installed it normally, ./configure -> make -> sudo make install.</p>\n\n<p><strong>Problem:</strong> When I run \"node\" under ec2-user, it runs perfectly. When I run \"sudo node\", it fails.</p>\n\n<p>I found out that node is in:</p>\n\n<pre><code>[ec2-user@XXXX ~]$ whereis node\nnode: /usr/local/bin/node /usr/local/lib/node\n</code></pre>\n\n<p>and the current path is</p>\n\n<pre><code>[ec2-user@XXXX ~]$ echo $PATH\n/usr/local/bin:/bin:/usr/bin:/opt/aws/bin:/home/ec2-user/bin\n</code></pre>\n\n<p>but, the sudo path is</p>\n\n<pre><code>[root@ip-10-112-222-32 ~]# echo $PATH\n/usr/local/sbin:/sbin:/bin:/usr/sbin:/usr/bin:/opt/aws/bin:/root/bin\n</code></pre>\n\n<p>then I tried to edit the root PATH to include the paths to node, so \"node\" runs when I'm logged in as root - but it still won't work when I log in as ec2-user and run \"sudo node\".</p>\n\n<p>I need this to install npm properfly. Any idea on how to include the node path while running \"sudo node\"?</p>\n"},{"tags":["node.js","cli","interactive"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":12929821,"title":"Nodejs library / module for developing interactive CLI apps?","body":"<p>been googling for this and searching stackoverflow, but am not coming across anything. I want to develop an interactive shell with node, and wondering on the best approach for this. Is there a library that anyone could recommend to use?</p>\n\n<p>I have written a library, and now want a CLI interface to interact with it, by 2 methods: running the app with parameters, or via interactive shell. e.g.</p>\n\n<pre><code>$ node myapp doSomething\nApp Result: I did something\n$ node myapp cli\nEntering interactive mode...\nmyapp&gt;\nmyapp&gt; doSomething\nApp Result: I did something\nmyapp&gt;\n</code></pre>\n\n<p>Any suggestions?</p>\n"},{"tags":["facebook","node.js","facebook-graph-api"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12927389,"title":"facebook api getting full posts with > 2 comments or > 4 likes","body":"<p>when I make the user/feed request on the Facebook Open Graph API, I get a feed object where posts with > 2 comments or > 4 likes don't reveal the detailed information for those specific comments. </p>\n\n<p>I am using <a href=\"https://github.com/Thuzi/facebook-node-sdk\" rel=\"nofollow\">https://github.com/Thuzi/facebook-node-sdk</a> to make requests but it is very similar to the 'request' NodeJS library.</p>\n\n<p>I can get the full posts individually by making a separate request for that post's Open Graph ID, but this doesn't lend itself to fun code because requests are asynchronous and nesting more asynchronous calls within asynchronous calls doesn't lend itself to fun code.</p>\n\n<p>Any way I can obtain the full posts?</p>\n"},{"tags":["node.js","elasticsearch"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12704107,"title":"node.js: data indexing in elasticsearch by using user defined id","body":"<p>I need to index multiple jsons in elasticsearch and indexing id should be given by user not by automatically created by elasticserach.</p>\n\n<p>Can any please tell me how to stop elasticsearch from creating automatic index id and how can I use my desired id for data indexing.</p>\n\n<p>Below is the part of node.js code for indexing data:</p>\n\n<pre><code>elasticSearchClient.index('index_name', 'type', json)\n                .on('data', function(data) {\n                    console.log(\"************ \"+data+\" ****************\")\n                })\n                .exec()\n</code></pre>\n\n<p>Any help will be greatly appreciated!</p>\n\n<p>Regards</p>\n"},{"tags":["node.js","node-mysql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12891513,"title":"mysql module in node.js not works in my case","body":"<p>So i have next test code, which i found <a href=\"http://net.tutsplus.com/tutorials/javascript-ajax/node-js-for-beginners/\" rel=\"nofollow\">here</a></p>\n\n<pre><code>// Include http module,\nvar http = require('http'),\n// And mysql module you've just installed.\n   mysql = require(\"mysql\");\n// Create the connection.\n// Data is default to new mysql installation and should be changed according to your configuration.\nvar connection = mysql.createConnection({\n   user: \"root\",\n   password: \"pass\",\n   database: \"db_name\"\n});\n// Create the http server.\nhttp.createServer(function (request, response) {\n   // Attach listener on end event.\n   request.on('end', function () {\n      // Query the database.\n      connection.query('SELECT * FROM your_table;', function (error, rows, fields) {\n         response.writeHead(200, {\n            'Content-Type': 'x-application/json'\n         });\n         // Send data as JSON string.\n         // Rows variable holds the result of the query.\n         response.end(JSON.stringify(rows));\n      });\n   });\n// Listen on the 8080 port.\n}).listen(8080);\n</code></pre>\n\n<p>i download mysql module, install mysql of course, and run next script, and get no results. Can you give me advice what i do wrong?</p>\n\n<p>When i trying to load </p>\n\n<pre><code>http://localhost:8080/\n</code></pre>\n\n<p>browser trying to load page several minutes, and also no result.</p>\n\n<p>Thanks.</p>\n\n<p><strong>update</strong>\n<img src=\"http://i.stack.imgur.com/1dS5u.png\" alt=\"enter image description here\"></p>\n"},{"tags":["javascript","mysql","query","node.js","image-uploading"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":4,"view_count":98,"score":-2,"question_id":12927939,"title":"How to store image into a MySQL database using node.js and Javascript","body":"<p>I am developing web application using node.js. I want to store an image into MySQL database.Please give some suggestions.</p>\n\n<pre><code>var Client = require('mysql').Client,\n    client = new Client();\nclient.user = DB_USER;\nclient.password = DB_PASS;\nclient.host = DB_HOST;\nclient.connect(function(error, results) {\n    if(error) {\n        client.end();\n        return;\n    }\n    client.query('USE ' + DB_SCHEME, function(error, results) {\n        if(error) {\n            client.end();\n            return;\n        }\n\n        var sql = \"INSERT INTO b SET `data` = ?\";\n        var values = [buf];\n\n        client.query(sql, values,\n            function(error, results) {\n                if(error) {\n                    return;\n                }\n                return;\n            }\n        );\n    });\n});\n</code></pre>\n\n<p>Here <strong>data</strong> is blob type.</p>\n"},{"tags":["node.js","skinning"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":52,"score":-5,"question_id":12920684,"title":"NodeJS Skinning","body":"<p>Is there a module or similar things that support skinning in NodeJS? I want to build a NodeJS website, and want to be able to re-skin the website as I like without much efforts, like in Wordpress.</p>\n\n<p>Is skinning supported in NodeJS?</p>\n"},{"tags":["ruby-on-rails","css","node.js","less"],"answer_count":3,"favorite_count":2,"up_vote_count":10,"down_vote_count":0,"view_count":2408,"score":10,"question_id":5226889,"title":"Is More (Less CSS plugin for Rails) still recommended?","body":"<p>The Less gem has been superseded by less.js, which runs on the server with Node.js. More, the \"official\" Less plugin for Rails, hasn't been updated since June 14, 2010.</p>\n\n<p>In light of all that, what is the recommended way to use Less with Rails these days? I suppose I could always just use client-side JS for this, which everyone seems to be embracing. But I'm not crazy about relying on client-side JS just to transform a stylesheet, especially considering that I'd like to degrade gracefully. I realize that Less.js is considered very fast, but as a matter of principle, I don't want my CSS to be utterly dependent on the browser's JS engine.</p>\n\n<p>Assuming I want to compile Less server-side, what is the best practice these days for use with Rails? I know you can run Less using Node.js, but I'm looking for nice Rails integration such as we once had with More.</p>\n\n<p>I'm looking for something that will work on Linux and Mac. Ideally, it would be a gem or a Rails plugin, not a standalone app.</p>\n\n<p><strong>Update:</strong> I'm looking into whether The Ruby Racer can be used to embed Less.js into a Rails app. Does anyone have opinions on that?</p>\n\n<p><strong>Update 2:</strong> This question is really old, but for anyone who's still interested, I just wanted to point out that Rails 3 comes with SCSS integration out of the box. SCSS is a LESS competitor, and I'm quite happy with it.</p>\n"},{"tags":["json","node.js","restify"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12925001,"title":"Node.js Restify - Simple service","body":"<p>I'm trying to make a server which stores Json posts, here is the server so far:</p>\n\n<pre><code>var restify = require('restify');\nvar server = restify.createServer();\nserver.post('/message/', function create(req, res, next) {\n    console.log(req.params)\n    return next();\n});\n\nserver.listen(8080, function() {\n    console.log('%s listening at %s', server.name, server.url);\n});\n</code></pre>\n\n<p>I'm using the Restify client to make the posts</p>\n\n<pre><code>var restify = require('restify');\n\nvar client = restify.createJsonClient({\n  url: 'http://localhost:8080',\n  version: '*'\n});\n\nclient.post('/message/', { hello: 'world' }, function(err, req, res, obj) {\n  console.log('%d -&gt; %j', res.statusCode, res.headers);\n  console.log('%j', obj);\n});\n</code></pre>\n\n<p>The problem is that req.params is empty. What's missing?</p>\n"}]}
